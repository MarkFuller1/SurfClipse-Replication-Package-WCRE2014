<html>
<head>
<title>
Chapter 2: TroubleShooting Jini
</title>
</head>
<body>

<a>
<!--webbot bot="Include" U-Include="../../../nav/top.html" TAG="BODY" startspan -->

<!-- New to Java -->
<p align=left><font color="green" size="2"><a style="color: #008080">New to
Java? We'll help you get started with our </a></font><a href="../../../tutorials/gettingstarted/index.html" style="color: #008080"><font color="green" size="2">revised
beginner's tutorial</font></a><font color="green" size="2"><a style="color: #008080" href="../javanotesv3/index.html">,</a><a style="color: #008080">
or our</a></font> <a style="color: #008080" href="../javanotesv3/index.html"><font color="green" size="2">free
online textbook.</font></a></p>
<div align="center">
  <center>
  <table border="0" cellpadding="0" cellspacing="0" width="600">
	 <!-- Advertising to support JavaCoffeeBreak -->
    <tr>
      <!-- Left table contains 480x600 advertising banner for our sponsors -->
      <td valign="top" align="left">


<p align="center">


<!-- BEGIN RICH-MEDIA BURST! CODE -->
<script language="JavaScript">
rnum=Math.round(Math.random() * 100000);

document.write('<scr'+'ipt src="http://www.burstnet.com/cgi-bin/ads/ad2350a.cgi/v=2.0S/sz=468x60A/'+rnum+'/RETURN-CODE/JS/"></scr'+'ipt>');

</script>
<noscript><a href="http://www.burstnet.com/ads/ad2350a-map.cgi/ns/v=2.0S/sz=468x60A/" target="_top">
<img src="http://www.burstnet.com/cgi-bin/ads/ad2350a.cgi/ns/v=2.0S/sz=468x60A/" border="0" alt="Click Here"></a>
</noscript>
<!-- END BURST CODE -->

  


</p>



      </td>
      <!-- Right table contains 120x60  button for our sponsors -->
      <td valign="top" align="right">
         


        <a href="http://www.amazon.com/exec/obidos/redirect?tag=davidreillysprog&amp;path=subst/books/computers/java/java.html"><img border="0" src="../../../images/javashop.gif" width="120" height="60"></a><br>
        <font face="Times New Roman" size="1"><a href="http://www.amazon.com/exec/obidos/redirect?tag=davidreillysprog&amp;path=subst/books/computers/java/java.html">Get the latest Java books</a></font>


      </td>
    </tr>
    <!-- JavaCoffeeBreak branding and navigation -->
    <tr>
      <td colspan="2">
        <div align="center">
          <font size="1">h t t p : / /w w w . j a v a c o f f e e b r e a k . c
          o m /</font>
          <table border="1" cellpadding="0" cellspacing="0" width="400" bgcolor="#000000">
            <tr>
              <td>
                <p align="center"><img src="../../../images/header.gif" alt="Java Coffee Break" width="400" height="50"></td>
            </tr>
          </table>
        </div>
      </td>
    </tr>
  </table>
  </center>
</div>

<!--webbot bot="Include" endspan i-checksum="59104" -->
<h1 align="center">Chapter 2: 
TroubleShooting Jini
</h1></a>

<blockquote>

<a>
<h1 align="center">
Contents
</h1></a>

<ul>

<li>
  <a  href = "#The Chapter that Shouldn't Exist">
    The Chapter that Shouldn't Exist
  </a>
</li>
<li>
  <a  href = "#Java Packages">
    Java Packages
  </a>
</li>
<li>
  <a  href = "#Jini Versions">
    Jini Versions
  </a>
</li>
<li>
  <a  href = "#Jini Packages">
    Jini Packages
  </a>
</li>
<li>
  <a  href = "#Lookup Service">
    Lookup Service    
  </a>
</li>
<li>
  <a  href = "#RMI Stubs">
    RMI Stubs
  </a>
</li>
<li>
  <a  href = "#Debugging">
    Debugging
  </a>
</li>
</ul>

</blockquote>


<blockquote>
<em>

<p>
This chapter looks at some of the problems that can arise in a Jini
system. Most of them are configuration problems of some kind.
This chapter is woefully incomplete :-((( Contributions welcome!!!
</p>

</em>
</blockquote>




<a name = "The Chapter that Shouldn't Exist">
<h2> 2.1. 
The Chapter that Shouldn't Exist
</h2>
</a>

<p>
Jini is advertised as ``network plug and play''. This carries the idea of
``zero administration'' where you buy a device, switch it on and
<em>voila</em> it is there and available. Well, this may
happen in the future, but right now there are a number of back-room games
that you have to succeed at. Once you have won at these, ``network plug and
play'' <em>does</em> work, but if you lose at any stage then
it can be all uphill!
</p>


<p>
What is hard is issues of getting the right files in the right places with
the right permissions. About 50% of the messages in the Jini mailing list
are all about these configuration problems. These shouldn't occur, and that
is why this is ``The Chapter that Shouldn't Exist''. 
</p>


<p>
This is the second chapter in this book, so right now you shouldn't have
managed to fail at anything! Each of the early sections contains instructions
on what to do to get the example programs working. 
So skip on to the next chapters, but come back
here when things go wrong. Your luck may vary: I got quite a reasonable way
on my first attempts without problems, and some are even luckier. 
Some aren't...
</p>





<a name = "Java Packages">
<h2> 2.2. 
Java Packages
</h2>
</a>

<p>
Typical error:
<pre><code>
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: 
         basic/InvalidLookupLocator
</code></pre>


<p>
Most of the code in this tutorial is organised into packages. To run
the examples the classes must be accessible from your class path. For
example, one of the programs in the <code>basic</code> directory is
<code>InvalidLookupLocator.java</code>. This defines the class
<code>InvalidLookupLocator</code> in the package <code>basic</code>.
The program must be run using the fully qualified path name, as in
<pre><code>
java basic.InvalidLookupLocator
</code></pre>

(Note the `.', not a `/'.)


<p>
In order to find this class, the classpath must be set correctly for
the Java runtime. If you have copied the zip file <code>classes.zip</code>
then the class files for this tutorial are in there. You only need to
reference this
<pre><code>
CLASSPATH=classes.zip:...
</code></pre>


<p>
If you have downloaded the source files, then they are all in subdirectories
such as <code>basic</code>, <code>complex</code>, etc. After compilation the
class files should also be in these subdirectories, such as
<code>basic/InvalidLookupLocator.class</code>. An alternative to using
<code>classes.zip</code> is to set the classpath to include the
directory containing those subdirectories. For example, if the full path
is say <code>/home/jan/classes/basic/InvalidLookupLocator.class</code>,
then set classpath to
<pre><code>
CLASSPATH=/home/jan/classes:...
</code></pre>


<p>
An alternative to setting the <code>CLASSPATH</code> environment variable
is to use the <code>-classpath</code> option to the Java runtime engine
<pre><code>
java -classpath /home/jan/classes basic.InvalidLookupLocator
</code></pre>




<a name = "Jini Versions">
<h2> 2.3. 
Jini Versions
</h2>
</a>

<p>
There are currently two versions of Jini: 1.0 and a version of 1.1 in alpha.
The core classes are all the same. The only changes in version 1.1 for 
the programmer are that some classes from Jini 1.0 have been specified better
and are in different packages, and that some classes are new.
</p>


<p>
The main ones that have changed are 
<ol>

<li>
<code>JoinManager</code>
</li>

<li>
<code>LeaseRenewalManager</code>
</li>

<li>
<code>ServiceIDListener</code>
</li>

</ol>


<p>
The main new ones are 
<ol>

<li>
<code>LookupLocatorDiscovery</code>
</li>

<li>
<code>LookupDiscoveryManager</code>
</li>

<li>
<code>ClientLookupManager</code>
</li>

</ol>


<p>
If you get syntax errors or runtime errors relating to these, then it is possible
that you are using Jini 1.0 instead of Jini 1.1. If you get ``deprecated''
warnings, then it is likely that you are using the Jini 1.0 classes in a 
Jini 1.1 environment. The old classes are supported for now, but are not approved.
</p>




<a name = "Jini Packages">
<h2> 2.4. 
Jini Packages
</h2>
</a>

<p>
Typical error
<pre><code>
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: 
             net/jini/discovery/DiscoveryListener
</code></pre>


<p>
The Jini class files are all in <code>jar</code> files.
The Jini distribution has them in a subdirectory <code>lib</code>
when it is unpacked.
There are a whole bunch of these jar files:
<pre><code>
jini-core.jar         mahalo-dl.jar         sun-util.jar
jini-examples-dl.jar  mahalo.jar            tools.jar
jini-examples.jar     reggie-dl.jar
jini-ext.jar          reggie.jar
</code></pre>


<p>
The jar file <code>jini-core.jar</code> contains the major packages of Jini
<pre><code>
net.jini.core
net.jini.core.discovery
net.jini.core.entry
net.jini.core.event
net.jini.core.lease
net.jini.core.lookup
net.jini.core.transaction
</code></pre>

If the Java compiler or runtime can't find a class in one of
these packages then you need to make sure that the
<code>jini-core.jar</code> is in your classpath.


<p>
The jar file <code>jini-ext.jar</code> contains a set of packages
which are not in the core, but are still heavily used
<pre><code>
net.jini.admin
net.jini.discovery
net.jini.entry
net.jini.lease
net.jini.lookup
net.jini.lookup.entry
net.jini.space
</code></pre>

If the Java compiler or runtime can't find a class in one of
these packages then you need to make sure that the
<code>jini-ext.jar</code> is in your classpath.


<p>
The jar file <code>sun-util.jar</code> contains the packages
from the <code>com.sun.jini</code> hierarchy. 
These contain a number of ``convenience'' classes that are
not essential but can be useful. These are less frequently
used.
</p>


<p>
A compile or run of a Jini application will typically have an
environment set something like
<pre><code>
JINI_HOME=wherever_Jini_home_is
CLASSPATH=.:$JINI_HOME/lib/jini-core.jar:$JINI_HOME/lib/jini-ext.jar
</code></pre>




<a name = "Lookup Service">
<h2> 2.5. 
Lookup Service
</h2>
</a>



<p>Typical error
<pre><code>
java.rmi.activation.ActivationException: ActivationSystem not running;
nested exception is: 
        java.rmi.NotBoundException: java.rmi.activation.ActivationSystem
java.rmi.NotBoundException: java.rmi.activation.ActivationSystem
</code></pre>

The command <code>rmid</code> starts the ``activation system'' running.
If this cannot start properly or dies just after starting, you will get 
this message. Usually it is caused by incorrect file permissions.


<a name = "RMI Stubs">
<h2> 2.6. 
RMI Stubs
</h2>
</a>

<p>
Typical error
<pre><code>
java.rmi.StubNotFoundException: 
         Stub class not found: rmi.FileClassifierImpl_Stub; 
nested exception is: 
        java.lang.ClassNotFoundException: rmi.FileClassifierImpl_Stub
</code></pre>


<p>
Many of the examples export services as remote RMI objects.
These objects are subclasses of <code>UnicastRemoteObject</code>.
What gets exported is not the object itself, but a <em>stub</em>
that will act as proxy for the object (which continues to run back
in the server). The stub has to be created using the <code>rmic</code>
compiler as in
<pre><code>
rmic -v1.2 -d . rmi.FileClassifierImpl
</code></pre>

This will create a <code>FileClassifierImpl_Stub.class</code> in the
<code>rmi</code> subdirectory. The stub class file needs to be accessible
to the Java runtime in the same way as the original class file.


<p>
Another typical error is
<pre><code>
java.rmi.ServerException: RemoteException occurred in server thread; nested exception is: 
        java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is: 
        java.lang.ClassNotFoundException: rmi.FileClassifierImpl_Stub
</code></pre>

This arises when an object is trying to get a remote reference to the 
<code>FileClassifierImpl</code>, and it is trying to load the class file for the
stub from an HTTP server. 
What makes this one particularly annoying is that it may not be referring
to the <code>FileClassifierImpl_Stub</code> at all! The class will often implement
a remote interface such as <code>RemoteFileClassifier</code>. This in turn implements
the common class <code>FileClassifier</code>. <em>Class files for these
also have to be available!</em> The HTTP server must carry not only the
class files for the stubs, but the class files for all superclasses and interfaces
that are not available to all.






<a name = "Debugging">
<h2> 2.7. 
Debugging
</h2>
</a>

<p>
Debugging a Jini application is difficult because there are so many bits
to it, and these bits are all running separately: the server for a service,
the client, lookup services, remote activation daemons and HTTP servers.
There are a few (not many) errors within the Jini objects themselves,
but more importantly many of these objects are implemented using multiple
threads and the flow of execution is not always clear. There are no magic
``debug'' flags that can be turned on to show what is happening.
</p>


<p>
On either the client or service side, a debugger such as <code>jdb</code>
can be used to step through or trace execution of each one. Lots of
print statements help too. There are also three flags that can be turned
on to help:
<pre><code>
java -Djava.security.debug=access \
     -Dnet.jini.discovery.debug=1 \
     -Djava.rmi.server.logCalls=true ...
</code></pre>

The don't give complete information, but they do give some, and can at least
tell you if the application parts are still living!




<hr>
This file is Copyright (&copy;) 1999, 2000 by Jan Newmarch
<a href = "http://pandonia.canberra.edu.au/">(http://pandonia.canberra.edu.au)</a>
<a href = "mailto:jan@ise.canberra.edu.au">jan@ise.canberra.edu.au</a>.
<br>
This material may be distributed only subject to the terms and conditions set forth
in the Open Publication License, v0.4 or later (the latest version is presently
available at
<a href = "http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/)</a>.
Distribution of the work or derivative of the work in any standard (paper) book form
is prohibited unless prior permission is obtained from the copyright holder.<!--webbot
bot="Include" U-Include="../../../_private/footer.html" TAG="BODY" startspan -->

<p align="center"><a href="../../../index.html">Back to main</a></p>

<hr>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
  <tr>
    <td width="451">
      <div align="left">
        <address>
          <font face="Arial" size="2">Copyright 1998, 1999, 2000 David Reilly</font>
        </address>
      </div>
    </td>
    <td width="310">
      <p align="right"><font face="Arial" size="2"><a href="../../../legal/privacy.html">Privacy</a>
      | <a href="../../../legal/index.html">Legal</a> | <a href="../../../legal/linking.html">Linking</a>
      | <a href="../../../advertising/index.html" style="color: #FF9966">Advertise!</a></font></td>
  </tr>
  <tr>
    <td width="451">
      <div align="left">
        <address>
          <font face="Arial" size="2">Last updated: 
          Monday, June 05, 2006</font>
        </address>
      </div>
    </td>
    <td width="310"></td>
  </tr>
</table>
<!--webbot
bot="Include" endspan i-checksum="22182" -->



</body>
</html>
