



<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
 
 <meta name="ROBOTS" content="NOARCHIVE">
 
 <link rel="icon" type="image/vnd.microsoft.icon" href="http://www.gstatic.com/codesite/ph/images/phosting.ico">
 
 
 <script type="text/javascript">
 
 
 
 
 var codesite_token = null;
 
 
 var CS_env = {"projectName": "jmockit", "loggedInUserEmail": null, "assetHostPath": "http://www.gstatic.com/codesite/ph", "domainName": null, "relativeBaseUrl": "", "token": null, "projectHomeUrl": "/p/jmockit", "profileUrl": null, "assetVersionPath": "http://www.gstatic.com/codesite/ph/3076573747170053082"};
 var _gaq = _gaq || [];
 _gaq.push(
 ['siteTracker._setAccount', 'UA-18071-1'],
 ['siteTracker._trackPageview']);
 
 (function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
 
 </script>
 
 
 <title>Issue 239 - 
 jmockit -
 
 JMockit gets stuck when running with Emma - 
 A developer testing toolkit for Java - Google Project Hosting
 </title>
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/3076573747170053082/css/core.css">
 
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/3076573747170053082/css/ph_detail.css" >
 
 
 
 
<!--[if IE]>
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/3076573747170053082/css/d_ie.css" >
<![endif]-->
 <style type="text/css">
 .menuIcon.off { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -42px }
 .menuIcon.on { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -28px }
 .menuIcon.down { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 0; }
 
 
 .attachments { width:33%; border-top:2px solid #999; padding-top: 3px; margin-left: .7em;}
 .attachments table { margin-bottom: 0.75em; }
 .attachments table tr td { padding: 0; margin: 0; font-size: 95%; }
 .preview { border: 2px solid #c3d9ff; padding: 1px; }
 .preview:hover { border: 2px solid blue; }
 .label { white-space: nowrap; }
 .derived { font-style:italic }
 .cursor_on .author {
 background: url(http://www.gstatic.com/codesite/ph/images/show-arrow.gif) no-repeat 2px;
 }
 .hiddenform {
 display: none;
 }

 
 </style>
</head>
<body class="t3">
<script type="text/javascript">
 window.___gcfg = {lang: 'en'};
 (function() 
 {var po = document.createElement("script");
 po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";
 var s = document.getElementsByTagName("script")[0];
 s.parentNode.insertBefore(po, s);
 })();
</script>
<div class="headbg">

 <div id="gaia">
 

 <span>
 
 
 <a href="#" id="projects-dropdown" onclick="return false;"><u>My favorites</u> <small>&#9660;</small></a>
 | <a href="https://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=http%3A%2F%2Fcode.google.com%2Fp%2Fjmockit%2Fissues%2Fdetail%3Fid%3D239&amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fjmockit%2Fissues%2Fdetail%3Fid%3D239" onclick="_CS_click('/gb/ph/signin');"><u>Sign in</u></a>
 
 </span>

 </div>

 <div class="gbh" style="left: 0pt;"></div>
 <div class="gbh" style="right: 0pt;"></div>
 
 
 <div style="height: 1px"></div>
<!--[if lte IE 7]>
<div style="text-align:center;">
Your version of Internet Explorer is not supported. Try a browser that
contributes to open source, such as <a href="http://www.firefox.com">Firefox</a>,
<a href="http://www.google.com/chrome">Google Chrome</a>, or
<a href="http://code.google.com/chrome/chromeframe/">Google Chrome Frame</a>.
</div>
<![endif]-->



 <table style="padding:0px; margin: 0px 0px 10px 0px; width:100%" cellpadding="0" cellspacing="0"
 itemscope itemtype="http://schema.org/CreativeWork">
 <tr style="height: 58px;">
 
 
 
 <td id="plogo">
 <link itemprop="url" href="/p/jmockit">
 <a href="/p/jmockit/">
 
 
 <img src="/p/jmockit/logo?cct=1371916174"
 alt="Logo" itemprop="image">
 
 </a>
 </td>
 
 <td style="padding-left: 0.5em">
 
 <div id="pname">
 <a href="/p/jmockit/"><span itemprop="name">jmockit</span></a>
 </div>
 
 <div id="psum">
 <a id="project_summary_link"
 href="/p/jmockit/"><span itemprop="description">A developer testing toolkit for Java</span></a>
 
 </div>
 
 
 </td>
 <td style="white-space:nowrap;text-align:right; vertical-align:bottom;">
 
 <form action="/hosting/search">
 <input size="30" name="q" value="" type="text">
 
 <input type="submit" name="projectsearch" value="Search projects" >
 </form>
 
 </tr>
 </table>

</div>

 
<div id="mt" class="gtb"> 
 <a href="/p/jmockit/" class="tab ">Project&nbsp;Home</a>
 
 
 
 
 <a href="/p/jmockit/downloads/list" class="tab ">Downloads</a>
 
 
 
 
 
 <a href="/p/jmockit/w/list" class="tab ">Wiki</a>
 
 
 
 
 
 <a href="/p/jmockit/issues/list"
 class="tab active">Issues</a>
 
 
 
 
 
 <a href="/p/jmockit/source/checkout"
 class="tab ">Source</a>
 
 
 
 
 
 
 
 
 <div class=gtbc></div>
</div>
<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0" class="st">
 <tr>
 
 
 
 
 
 <td class="subt">
 <div class="issueDetail">
<div class="isf">
 
 
 <span class="inIssueEntry">
 <a class="buttonify" href="entry" onclick="return _newIssuePrompt();">New issue</a>
 </span> &nbsp;
 
 <span class="inIssueList">
 <span>Search</span>
 <form action="list" method="GET" style="display:inline">
 <select id="can" name="can">
 
<option disabled="disabled">Search within:</option>
<option value="1" >&nbsp;All issues</option>
<option value="2" selected=selected>&nbsp;Open issues</option>

<option value="6" >&nbsp;New issues</option>
<option value="7" >&nbsp;Issues to verify</option>

 </select>
 <span>for</span>
 <span id="qq"><input type="text" size="38" id="searchq" name="q"
 value="" autocomplete="off"
 
 onkeydown="_blurOnEsc(event)"></span>
 
 
 <span id="search_colspec"><input type="hidden" name="colspec" value="ID Tool Type Status Summary Modified" ></span>
 
 
 
 <input type="hidden" name="cells" value="tiles" >
 <input type="submit" value="Search">
 </form>
 </span> &nbsp;
 <span class="inIssueAdvSearch">
 <a href="advsearch">Advanced search</a>
 </span> &nbsp;
 <span class="inIssueSearchTips">
 <a href="searchtips">Search tips</a>
 </span> &nbsp;
 <span class="inIssueSubscriptions">
 <a href="/p/jmockit/issues/subscriptions">Subscriptions</a>
 </span>
</div>
</div>
 </td>
 
 
 
 
 <td align="right" valign="top" class="bevel-right"></td>
 </tr>
</table>


<script type="text/javascript">
 var cancelBubble = false;
 function _go(url) { document.location = url; }
</script>
<div id="maincol"
 
>

 






 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 


 

<div id="color_control" class="closed_colors">
<div id="issueheader">
<table cellpadding="0" cellspacing="0" width="100%"><tbody>
 <tr>
 <td class="vt h3" nowrap="nowrap" style="padding:0 5px">
 
 
 Issue <a href="detail?id=239">239</a>:
 </td>
 <td width="90%" class="vt">
 <span class="h3" >JMockit gets stuck when running with Emma</span>
 </td>
 <td>
 
 </td>
 </tr>
 <tr>
 <td></td>
 <td nowrap="nowrap">
 
 
 5 people starred this issue and may be notified of changes.
 
 
 
 </td>
 <td align="center" nowrap="nowrap">
 
 <a href="http://code.google.com/p/jmockit/issues/list?cursor=jmockit%3A239">Back to list</a>
 
 </td>
 </tr>
 
</tbody></table>
</div>
<table width="100%" cellpadding="0" cellspacing="0" border="0" class="issuepage" id="meta-container">
<tbody class="collapse"> 
 <tr>
 <td id="issuemeta">
 <div id="meta-float">
 
<table cellspacing="0" cellpadding="0">
 <tr><th align="left">Status:&nbsp;</th>
 <td width="100%">
 
 <span title="The requested non-coding task was completed">Done</span>
 
 </td>
 </tr>
 
 
 
 
 <tr><th align="left">Owner:&nbsp;</th><td>
 
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
>
 
 </td>
 </tr>
 
 
 <tr><th align="left" valign="top">Closed:&nbsp;</th>
 <td align="left" valign="top" width="100%">
 Sep 2012
 </td>
 </tr>
 
 
 <tr><td colspan="2">
 
 
 
 <div style="padding-top:2px">
 
 <a href="list?q=label:Type-Other"
 title="Some other kind of issue"
 class="label"><b>Type-</b>Other</a>
 
 </div>
 
 
 
 
 <div style="padding-top:2px">
 
 <a href="list?q=label:Priority-Low"
 title="Might slip to later release"
 class="label"><b>Priority-</b>Low</a>
 
 </div>
 
 
 
 
 <div style="padding-top:2px">
 
 <a href="list?q=label:Tool-Other"
 title="Something else"
 class="label"><b>Tool-</b>Other</a>
 
 </div>
 
 
 </td></tr>
 
</table>
<div class="rel_issues">
 
 
 
</div>


 <br><br>
 
 
 <div style="white-space:nowrap"><a href="https://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=http%3A%2F%2Fcode.google.com%2Fp%2Fjmockit%2Fissues%2Fdetail%3Fid%3D239&amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fjmockit%2Fissues%2Fdetail%3Fid%3D239">Sign in</a> to add a comment</div>
 
 


 
 </div>&nbsp;
 </td>
 <td class="vt issuedescription" width="100%" id="cursorarea" >
 
<div class="cursor_off vt issuedescription" id="hc0">
 
 
 <div class="author">
 
 Reported by
 

 <a class="userlink"
 href="/u/107395932743956465855/">alex.rad...@gmail.com</a
>,
 <span class="date" title="Tue Aug 21 07:46:06 2012">Aug 21, 2012</span>
 
 </div>
<pre>
This issue is probably related to #30 although it is not exactly duplicate:
<a href="http://code.google.com/p/jmockit/issues/detail?id=30" rel="nofollow">http://code.google.com/p/jmockit/issues/detail?id=30</a>


Here is what happens. 
I have maven based maven based project where I use JMocit. I also use Emma  via Eclipse plugin and Sonar. Tests that belong to projects that include JMockit into dependencies get stuck even if they do not use JMockit when trying to check test coverage using Emma.

The same happens when working with Sonar (command mvn sonar:sonar gets stuck on the first test from project that depends on jmockit).

To reproduce the problem I created very small project that contains only one test that does nothing and 2 depend test-scope dependencies: jmockit and junit. When jmockit dependency is defined after junit the test passes. When jmockit is defined before junit (as it must be defined to be able to work) the test gets stuck forever. 


I am using 

SpringSource Tool Suite, Version: 2.7.2.RELEASE, Build Id: 201109131000
JMockit 0.999.14
Junit 4.8.2
JDK build 1.7.0_05-b06

Please find the test project that reproduces the problem. Please take a look on the comment into the pom.xml file. 
</pre>

</div>

 


 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc1">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Aug 21 08:22:11 2012">
 Aug 21, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c1" href="/p/jmockit/issues/detail?id=239#c1">#1</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
Thanks, but I think you forgot to attach the example Maven project?
</pre>
 
 
 <div class="updates">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 
 <b>Labels:</b>
 Tool-Other
 
 <br>
 
 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc2">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Aug 21 08:24:40 2012">
 Aug 21, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c2" href="/p/jmockit/issues/detail?id=239#c2">#2</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
More importantly, which version of Emma is being used? Or is it EclEmma, which uses JaCoCo?
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc3">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Aug 21 08:33:54 2012">
 Aug 21, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c3" href="/p/jmockit/issues/detail?id=239#c3">#3</a>
 

 <a class="userlink"
 href="/u/107395932743956465855/">alex.rad...@gmail.com</a
></span>
 
<pre>
Attaching the test project that reproduces the problem.
</pre>
 
 <div class="attachments">
 
 
 
 




 <table cellspacing="3" cellpadding="2" border="0">
 <tr><td width="20">
 <a href="//jmockit.googlecode.com/issues/attachment?aid=2390003000&amp;name=mytest.zip&amp;token=8T_PcaWAMPiwnsnpay8OU85Q2q4%3A1386977711354">
 <img width="15" height="15" src="http://www.gstatic.com/codesite/ph/images/paperclip.gif" border="0" >
 </a>
 </td>
 <td style="min-width:16em" valign="top">
 
 <b >mytest.zip</b>
 <br>
 3.5 KB
 
 
 &nbsp; <a href="//jmockit.googlecode.com/issues/attachment?aid=2390003000&amp;name=mytest.zip&amp;token=8T_PcaWAMPiwnsnpay8OU85Q2q4%3A1386977711354">Download</a>
 
 </td>
 
 </tr>
 
 </table>


 
 </div>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc4">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Aug 21 08:36:22 2012">
 Aug 21, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c4" href="/p/jmockit/issues/detail?id=239#c4">#4</a>
 

 <a class="userlink"
 href="/u/107395932743956465855/">alex.rad...@gmail.com</a
></span>
 
<pre>
I am using
EclEmma Java Code Coverage	2.1.2.201205091942	com.mountainminds.eclemma.feature.feature.group	Mountainminds GmbH &amp; Co. KG

Sorry that I forgot to mention this.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc5">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Aug 21 10:20:28 2012">
 Aug 21, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c5" href="/p/jmockit/issues/detail?id=239#c5">#5</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
Yes, this is not a problem with EMMA or even EclEmma, but with the JaCoCo Java agent.
(Since EclEmma 2.0, JaCoCo is the coverage library actually used, not EMMA. And JaCoCo, just like JMockit, relies on java.lang.instrument. The EclEmma plugin is probably adding &quot;-javaagent:jacocoagent.jar&quot; to the JVM command line.)

I found out that simply adding &quot;-javaagent:&lt;proper path&gt;/jacocoagent.jar&quot; as a JVM initialization parameter reproduces the hang up. During this period, a thread dump shows the following (with irrelevant parts removed for clarity):

&quot;Attach Listener&quot; daemon prio=10 tid=0x0076cc00 nid=0x618 in Object.wait() [0x00eee000]
   java.lang.Thread.State: RUNNABLE
	at sun.misc.Unsafe.ensureClassInitialized(Native Method)
	at sun.reflect.UnsafeFieldAccessorFactory.newFieldAccessor(UnsafeFieldAccessorFactory.java:43)
	at sun.reflect.ReflectionFactory.newFieldAccessor(ReflectionFactory.java:140)
	at java.lang.reflect.Field.acquireFieldAccessor(Field.java:949)
	at java.lang.reflect.Field.getFieldAccessor(Field.java:930)
	at java.lang.reflect.Field.set(Field.java:680)
	at org.jacoco.agent.rt_cdwjjf.core.runtime.AbstractRuntime.disconnect(AbstractRuntime.java:90)
	at org.jacoco.agent.rt_cdwjjf.CoverageTransformer.transform(CoverageTransformer.java:90)
	at sun.instrument.TransformerManager.transform(TransformerManager.java:188)
	at sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:424)
	at sun.instrument.InstrumentationImpl.redefineClasses0(Native Method)
	at sun.instrument.InstrumentationImpl.redefineClasses(InstrumentationImpl.java:170)
	at mockit.internal.startup.Startup.redefineMethods(Startup.java:124)
	at mockit.internal.startup.Startup.redefineMethods(Startup.java:118)
	at mockit.internal.annotations.MockClassSetup.applyClassModifications(MockClassSetup.java:162)
	at mockit.internal.annotations.MockClassSetup.redefineMethodsInClassHierarchy(MockClassSetup.java:128)
	at mockit.internal.annotations.MockClassSetup.redefineMethods(MockClassSetup.java:117)
	at mockit.internal.annotations.MockClassSetup.setUpStartupMock(MockClassSetup.java:111)
	at mockit.internal.startup.JMockitInitialization.setUpInternalStartupMock(JMockitInitialization.java:56)
	at mockit.internal.startup.JMockitInitialization.loadInternalStartupMocksForJUnitIntegration(JMockitInitialization.java:48)
	at mockit.internal.startup.JMockitInitialization.initialize(JMockitInitialization.java:26)
	at mockit.internal.startup.Startup.initialize(Startup.java:68)
	at mockit.internal.startup.Startup.agentmain(Startup.java:62)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:601)
	at sun.instrument.InstrumentationImpl.loadClassAndStartAgent(InstrumentationImpl.java:382)
	at sun.instrument.InstrumentationImpl.loadClassAndCallAgentmain(InstrumentationImpl.java:407)

&quot;main&quot; prio=6 tid=0x0034c000 nid=0x10d0 runnable [0x0069e000]
   java.lang.Thread.State: RUNNABLE
	at sun.tools.attach.WindowsVirtualMachine.connectPipe(Native Method)
	at sun.tools.attach.WindowsVirtualMachine.execute(WindowsVirtualMachine.java:100)
	at sun.tools.attach.HotSpotVirtualMachine.loadAgentLibrary(HotSpotVirtualMachine.java:58)
	at sun.tools.attach.HotSpotVirtualMachine.loadAgentLibrary(HotSpotVirtualMachine.java:79)
	at sun.tools.attach.HotSpotVirtualMachine.loadAgent(HotSpotVirtualMachine.java:103)
	at mockit.internal.startup.JDK6AgentLoader.loadAgentAndDetachFromThisVM(JDK6AgentLoader.java:117)
	at mockit.internal.startup.JDK6AgentLoader.loadAgent(JDK6AgentLoader.java:61)
	at mockit.internal.startup.AgentInitialization.initializeAccordingToJDKVersion(AgentInitialization.java:21)
	at mockit.internal.startup.Startup.initializeIfNeeded(Startup.java:98)
	at mockit.internal.startup.Startup.initializeIfPossible(Startup.java:112)
	at org.junit.runner.Runner.&lt;clinit&gt;(Runner.java:22)
	at ... (other JUnit and IDE-specific entries)

Above, the &quot;main&quot; thread is running JMockit code which is attempting to initialize itself by loading its Java agent through the Attach API. The call to &quot;WindowsVirtualMachine#connectPipe(...)&quot; never returns, because the &quot;Attach Listener&quot; thread (which is responsible for answering an agent loading request) ends up blocked in an &quot;Object#wait()&quot; call.

So, a deadlock occurs when the JaCoCo CoverageTransformer makes the call to &quot;runtime.disconnect(classBeingRedefined)&quot;. I don't know what exactly is going on here, but it seems that this can only be solved through changes in the JaCoCo implementation.
</pre>
 
 
 <div class="updates">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 
 <b>Labels:</b>
 -Type-Defect Type-Other
 
 <br>
 
 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc6">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Aug 21 10:26:06 2012">
 Aug 21, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c6" href="/p/jmockit/issues/detail?id=239#c6">#6</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
A workaround is to use the &quot;-javaagent:&lt;proper path&gt;/jmockit.jar&quot; JVM parameter to initialize JMockit. This way, it never attempts to use the Attach API.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc7">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Aug 21 10:48:23 2012">
 Aug 21, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c7" href="/p/jmockit/issues/detail?id=239#c7">#7</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
I submitted a new issue to the EclEmma/JaCoCo bugtracker:

<a href="http://sourceforge.net/tracker/?func=detail&amp;aid=3560414&amp;group_id=177969&amp;atid=883351" rel="nofollow">http://sourceforge.net/tracker/?func=detail&amp;aid=3560414&amp;group_id=177969&amp;atid=883351</a>
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc8">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Aug 22 09:22:02 2012">
 Aug 22, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c8" href="/p/jmockit/issues/detail?id=239#c8">#8</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
Only now I tested the attached Eclipse project (see comment 3). I used Eclipse 4.2 and the latest EclEmma (2.1.4), however. There is no problem. The test runs fine, with EclEmma showing 100% coverage. Maybe this problem has already been fixed in EclEmma, or it is specific to SpringSource Tool Suite?
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc9">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Aug 22 09:22:19 2012">
 Aug 22, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c9" href="/p/jmockit/issues/detail?id=239#c9">#9</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
<i>(No comment was entered for this change.)</i>
</pre>
 
 
 <div class="updates">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 
 <b>Status:</b>
 NotYetReproduced
 
 <br>
 
 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc10">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Aug 22 09:49:07 2012">
 Aug 22, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c10" href="/p/jmockit/issues/detail?id=239#c10">#10</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
Ok, now I tested with Eclipse 3.7.1 (and EclEmma 2.1.4). There is a problem where the JUnit plugin UI isn't updated when running the test, when running through EclEmma with jmockit.jar before junit-4.10.jar in the classpath, and no &quot;-javaagent&quot; parameter.

However, if I add &quot;-javaagent:/jmockit/jmockit.jar&quot; (your exact path may vary) in the &quot;VM arguments&quot; field of the &quot;Run configurations&quot; window, then it works. It also works if instead I add &quot;-javaagent:/jmockit/jmockit.jar&quot; in the &quot;Default VM arguments&quot; field of the &quot;Edit JRE&quot; window (under &quot;Preferences -&gt; Installed JREs -&gt; &lt;the JDK being used&gt; -&gt; Edit&quot;).
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc11">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Mon Aug 27 06:58:26 2012">
 Aug 27, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c11" href="/p/jmockit/issues/detail?id=239#c11">#11</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
<i>(No comment was entered for this change.)</i>
</pre>
 
 
 <div class="updates">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 
 <b>Status:</b>
 NotReproducedYet
 
 <br>
 
 <b>Labels:</b>
 -Priority-High Priority-Low
 
 <br>
 
 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc12">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Mon Sep  3 11:54:11 2012">
 Sep 3, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c12" href="/p/jmockit/issues/detail?id=239#c12">#12</a>
 

 <a class="userlink"
 href="/u/112150874253264777993/">rliesenf...@gmail.com</a
></span>
 
<pre>
I will monitor the related EclEmma issue (see link in comment 7). Apart from that, I don't see what else can be done at this time on JMockit's side.
</pre>
 
 
 <div class="updates">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 
 <b>Status:</b>
 Done
 
 <br>
 
 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc13">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Nov 30 14:21:11 2012">
 Nov 30, 2012
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c13" href="/p/jmockit/issues/detail?id=239#c13">#13</a>
 

 <a class="userlink"
 href="/u/104971529425812353718/">mce2...@gmail.com</a
></span>
 
<pre>
Hi,

I ran into the same problem when I upgraded my EclEmma Eclipse plugin.
investigation in the sources of jmockit and JaCoCo finally gave the right hint when I found this comment in the CoverageTransformer class of JaCoCo:
// Don't instrument classes of the bootstrap loader:

this is well hidden in the filter method of the CoverageTransformer.
Anyway, I didn't actually debug the startup phase of the Junit test, but I am pretty sure that the deadlock happens because JaCoCo wants to instrument the jmockit classes that are initialized in the startup phase of Junit.

I am uncertain if it is possible to change the startup of jmockit to prevent this deadlock, but I doubt it.

anyway. a working workaround is to set the exclude filter for the EclEmma Plugin to exclude mockit.*
This is set in Eclipse preferences:  Java-&gt;Code Coverage

</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc15">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Jan  4 15:17:24 2013">
 Jan 4, 2013
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c15" href="/p/jmockit/issues/detail?id=239#c15">#15</a>
 

 <a class="userlink"
 href="/u/114450049302780217596/">jameslee...@gmail.com</a
></span>
 
<pre>
Unfortunately, tried the workaround and still get an immediate hang.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc16">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Jan  8 15:48:39 2013">
 Jan 8, 2013
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c16" href="/p/jmockit/issues/detail?id=239#c16">#16</a>
 

 <a class="userlink"
 href="/u/113243688704237763119/">andrewin...@gmail.com</a
></span>
 
<pre>
Add the following line to your maven-sure-fire plug in: 

&lt;argLine&gt;-javaagent:&quot;${settings.localRepository}&quot;/com/googlecode/jmockit/jmockit/1.0/jmockit-1.0.jar&lt;/argLine&gt;

The plug in look like this:

			&lt;plugin&gt;
				&lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
				&lt;version&gt;2.12.4&lt;/version&gt;
				&lt;configuration&gt;
					&lt;argLine&gt;-javaagent:&quot;${settings.localRepository}&quot;/com/googlecode/jmockit/jmockit/1.0/jmockit-1.0.jar&lt;/argLine&gt;					
				&lt;/configuration&gt;
			&lt;/plugin&gt;
		
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc17">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Mar 14 05:50:44 2013">
 Mar 14, 2013
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c17" href="/p/jmockit/issues/detail?id=239#c17">#17</a>
 

 <a class="userlink"
 href="/u/112504679180744827149/">jo...@sciencerockstars.com</a
></span>
 
<pre>
Hi,

I'm running into the same problem: running the tests hang when using JMockit and Jacoco (via Maven).
I tried the solution above from Andrwin and added the maven-surefire-plugin config to my pom.
The tests now can run, but I have no coverage report because Jacoco does not create the jacoco.exec file.
Any thoughts?

I have tried several different Jacoco, surefire-plugin, JMockit versions, but no luck.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc18">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Apr  4 02:50:35 2013">
 Apr 4, 2013
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c18" href="/p/jmockit/issues/detail?id=239#c18">#18</a>
 

 <a class="userlink"
 href="/u/105135295857016909689/">barte...@gmail.com</a
></span>
 
<pre>
I'm having the same problem with jmockit 1.1 and maven. -javaagent solution helps.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc19">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Wed Jul 17 05:49:39 2013">
 Jul 17, 2013
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c19" href="/p/jmockit/issues/detail?id=239#c19">#19</a>
 

 <a class="userlink"
 href="/u/110514788600576783864/">Nadirow...@gmail.com</a
></span>
 
<pre>
I've run to the similar issue today with JMockit 1.3 hanging on the new MockUp() call inside spock test. The javaagent trick helped.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc20">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Mon Aug 12 01:08:10 2013">
 Aug 12, 2013
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c20" href="/p/jmockit/issues/detail?id=239#c20">#20</a>
 

 <a class="userlink"
 href="/u/116706089707038560458/">juergen....@gmail.com</a
></span>
 
<pre>
Any action on this issue ? 
The javaagent trick unfortunately doesn't work for me. If I use it I get spammed with exceptions like this.

java.lang.instrument.IllegalClassFormatException: Error while instrumenting class de/heuboe/ddp/Connection.
        at org.jacoco.agent.rt.internal_5d10cad.CoverageTransformer.transform(CoverageTransformer.java:91)
        at sun.instrument.TransformerManager.transform(TransformerManager.java:188)
        at sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:424)
        at sun.instrument.InstrumentationImpl.redefineClasses0(Native Method)
        at sun.instrument.InstrumentationImpl.redefineClasses(InstrumentationImpl.java:170)
        at mockit.internal.startup.Startup.redefineMethods(Startup.java:235)
        at mockit.internal.RedefinitionEngine.redefineClasses(RedefinitionEngine.java:24)
        at mockit.internal.expectations.mocking.BaseTypeRedefinition.redefineClass(BaseTypeRedefinition.java:167)
        at mockit.internal.expectations.mocking.BaseTypeRedefinition.redefineClassAndItsSuperClasses(BaseTypeRedefinition.java:143)
        at mockit.internal.expectations.mocking.BaseTypeRedefinition.redefineMethodsAndConstructorsInTargetType(BaseTypeRedefinition.java:130)
        at mockit.internal.expectations.mocking.BaseTypeRedefinition.redefineTargetClassAndCreateInstanceFactory(BaseTypeRedefinition.java:197)
        at mockit.internal.expectations.mocking.BaseTypeRedefinition.redefineType(BaseTypeRedefinition.java:55)
        at mockit.internal.expectations.mocking.TypeRedefinition.redefineType(TypeRedefinition.java:48)
        at mockit.internal.expectations.mocking.SharedFieldTypeRedefinitions.redefineTypeForMockField(SharedFieldTypeRedefinitions.java:58)
        at mockit.internal.expectations.mocking.FieldTypeRedefinitions.redefineFieldType(FieldTypeRedefinitions.java:58)
        at mockit.internal.expectations.mocking.FieldTypeRedefinitions.redefineFieldTypes(FieldTypeRedefinitions.java:45)
        at mockit.internal.expectations.mocking.SharedFieldTypeRedefinitions.redefineTypesForTestClass(SharedFieldTypeRedefinitions.java:41)
        at mockit.integration.internal.TestRunnerDecorator.handleMockFieldsForWholeTestClass(TestRunnerDecorator.java:131)
        at mockit.integration.internal.TestRunnerDecorator.updateTestClassState(TestRunnerDecorator.java:32)
        at mockit.integration.junit4.internal.JUnit4TestRunnerDecorator.handleMockingOutsideTestMethods(JUnit4TestRunnerDecorator.java:98)
        at mockit.integration.junit4.internal.JUnit4TestRunnerDecorator.invokeExplosively(JUnit4TestRunnerDecorator.java:31)
        at mockit.integration.junit4.internal.MockFrameworkMethod.invokeExplosively(MockFrameworkMethod.java:29)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at mockit.internal.util.MethodReflection.invokeWithCheckedThrows(MethodReflection.java:95)
        at mockit.internal.annotations.MockMethodBridge.callMock(MockMethodBridge.java:76)
        at mockit.internal.annotations.MockMethodBridge.invoke(MockMethodBridge.java:41)
        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java)
        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
        at org.junit.runners.BlockJUnit4ClassRunner.runNotIgnored(BlockJUnit4ClassRunner.java:79)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:71)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:49)
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
        at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
        at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252)
        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141)
        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189)
        at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165)
        at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85)
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75)
Caused by: java.lang.IllegalStateException: Class de/heuboe/ddp/Connection is already instrumented.
        at org.jacoco.agent.rt.internal_5d10cad.core.internal.instr.ClassInstrumenter.assertNotInstrumented(ClassInstrumenter.java:138)
        at org.jacoco.agent.rt.internal_5d10cad.core.internal.instr.ClassInstrumenter.visitField(ClassInstrumenter.java:81)
        at org.jacoco.agent.rt.internal_5d10cad.asm.ClassVisitor.visitField(Unknown Source)
        at org.jacoco.agent.rt.internal_5d10cad.asm.ClassReader.a(Unknown Source)
        at org.jacoco.agent.rt.internal_5d10cad.asm.ClassReader.accept(Unknown Source)
        at org.jacoco.agent.rt.internal_5d10cad.asm.ClassReader.accept(Unknown Source)
        at org.jacoco.agent.rt.internal_5d10cad.core.instr.Instrumenter.instrument(Instrumenter.java:74)
        at org.jacoco.agent.rt.internal_5d10cad.core.instr.Instrumenter.instrument(Instrumenter.java:87)
        at org.jacoco.agent.rt.internal_5d10cad.CoverageTransformer.transform(CoverageTransformer.java:89)
        ... 51 more
</pre>
 
 
 </div>
 


 


 </td>
 </tr>

 
 <tr>
 <td></td>
 <td class="vt issuecomment">
 <span class="indicator">&#9658;</span> <a href="https://www.google.com/accounts/ServiceLogin?service=code&ltmpl=phosting&continue=http%3A%2F%2Fcode.google.com%2Fp%2Fjmockit%2Fissues%2Fdetail%3Fid%3D239&amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fjmockit%2Fissues%2Fdetail%3Fid%3D239"
 >Sign in</a> to add a comment
 </td>
 </tr>
 

</tbody>
</table>
<br>
<script type="text/javascript" src="http://www.gstatic.com/codesite/ph/3076573747170053082/js/dit_scripts.js"></script>



 

</div> 
<form name="delcom" action="delComment.do?q=&amp;can=2&amp;groupby=&amp;sort=&amp;colspec=ID+Tool+Type+Status+Summary+Modified" method="POST">
 <input type="hidden" name="sequence_num" value="">
 <input type="hidden" name="mode" value="">
 <input type="hidden" name="id" value="239">
 <input type="hidden" name="token" value="">
</form>

<div id="helparea"></div>
<script type="text/javascript">
 _onload();
 function delComment(sequence_num, delete_mode) {
 var f = document.forms["delcom"];
 f.sequence_num.value = sequence_num;
 f.mode.value = delete_mode;
 
 f.submit();
 return false;
 }
 
 _floatMetadata();
</script>
<script type="text/javascript" src="http://www.gstatic.com/codesite/ph/3076573747170053082/js/kibbles.js"></script>
<script type="text/javascript">
 _setupKibblesOnDetailPage(
 'http://code.google.com/p/jmockit/issues/list?cursor\x3djmockit%3A239',
 '/p/jmockit/issues/entry',
 '',
 '',
 '', 'jmockit', 239,
 false, false, codesite_token);
</script>
 
 
 
 <script type="text/javascript" src="http://www.gstatic.com/codesite/ph/3076573747170053082/js/ph_core.js"></script>
 
 
 
 
</div> 

<div id="footer" dir="ltr">
 <div class="text">
 <a href="/projecthosting/terms.html">Terms</a> -
 <a href="http://www.google.com/privacy.html">Privacy</a> -
 <a href="/p/support/">Project Hosting Help</a>
 </div>
</div>
 <div class="hostedBy" style="margin-top: -20px;">
 <span style="vertical-align: top;">Powered by <a href="http://code.google.com/projecthosting/">Google Project Hosting</a></span>
 </div>

 
 


 
 </body>
</html>

