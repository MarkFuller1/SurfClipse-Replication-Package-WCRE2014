<!DOCTYPE html>
<!--[if lt IE 9 ]>
<html class="ltie9" lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:nitro="http://www.bunchball.com/nitro">
<![endif]-->
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:nitro="http://www.bunchball.com/nitro">
<head>
	<script type="text/javascript" src="/javascript/error_logging.js">

	</script>
				<base href="http://www.coursehero.com/">		
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		
	
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,300,600,700" rel="stylesheet" type="text/css"/>
			<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width"/>
	

		
	
			<script src="/javascript/jquery-1.7.2.min.js"></script>
			
	
		
	
	<script>
		jQuery(document).ready(function(){
			var ua = navigator.userAgent.toLowerCase();
			var isAndroid = ua.indexOf("android") > -1;
			if(isAndroid) {
				jQuery('#ch-primary-navigation-list-container li').doubleTapToGo();
			}
		})
	</script>

	<!--[if IE 8]>
		<script type="text/javascript" src="/javascript/selectivizr-min.js">
		</script>
	<![endif]-->
		
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
	
	
            <title>Iowa State : CPRE 556 : 2007 01</title>
    

<link rel="stylesheet" href="/min/?f=/css/v2/ch-master-style.css,/css/v2/jquery-styles/jquery.ui.css,/css/v2/study-documents/ch-document-thumbnail.css,/css/v2/study-documents/ch-doc-landing.css,/css/v2/ch-universal-widgets.css" type="text/css" media="screen" charset="utf-8">
<script src="/min/?f=/javascript/tracker_pageview.js,/javascript/error_logging.js,/javascript/header.js,/javascript/ajax_load.js,/javascript/doubletaptogo.min.js" type="text/javascript" charset="utf-8"></script>
</head>


<body class="">
<div>

<script type="text/javascript">
	var __basic = false;
	appId = 126130834105126;
</script>

<script>

  // Load the SDK's source Asynchronously
  // Note that the debug version is being actively developed and might 
  // contain some type checks that are overly strict. 
  // Please report such bugs using the bugs tool.
  (function(d, debug){
	 var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
	 if (d.getElementById(id)) {return;}
	 js = d.createElement('script'); js.id = id; js.async = true;
	 js.src = "//connect.facebook.net/en_US/all" + (debug ? ("/" + "debug") : "") + ".js";
	 ref.parentNode.insertBefore(js, ref);
   }(document, /*debug*/ false));
  
</script>


						<div id="ch-primary-navigation-wrapper" class="ch-wrapper">
	<div class="container">
		<div id="ch-brand-navigation">
			<a href="/?no_redir=1"><img src="/img/CourseHero_Logo_white.png" alt="Course Hero"/></a>
		</div>
		<div id="ch-primary-navigation-container">
			<a href=""  onClick="return false;" class="ch-primary-show-mobile-nav"><i class="icon-th-list"></i></a>
			<ul id="ch-primary-navigation-list-container">
																								<li>
							<a href="/study-materials/" class="ch-product-navigation-single-link">Study Documents</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/study-materials/" class="ch-product-sub-navigation-link">Find Documents</a></li>
										
																																																										<li><a href="/textbooks/" class="ch-product-sub-navigation-link">Textbook Help</a></li>
										
																																							<li><a href="/uploads.php" class="ch-product-sub-navigation-link">Upload Documents</a></li>
										
																											</ul>
													</li>
																				<li>
							<a href="/tutors/" class="ch-product-navigation-single-link">Tutors</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/qa_ask_question.php" class="ch-product-sub-navigation-link">Ask a Question</a></li>
										
																																																																													<li><a href="/become-a-tutor/" class="ch-product-sub-navigation-link">Become a Tutor</a></li>
										
																																							<li><a href="/qa/about_tutors.php" class="ch-product-sub-navigation-link">About Tutors</a></li>
										
																											</ul>
													</li>
																				<li>
							<a href="/flashcards/" class="ch-product-navigation-single-link">Flashcards</a>
															
								<ul class="ch-primary-sub-navigation">
																																																<li><a href="/flashcards/browse/" class="ch-product-sub-navigation-link">Find Flashcards</a></li>
										
																																							<li><a href="/flashcards/create.php" class="ch-product-sub-navigation-link">Create Flashcards</a></li>
										
																																							<li><a href="/flashcards/" class="ch-product-sub-navigation-link">About Flashcards</a></li>
										
																											</ul>
													</li>
																				<li>
							<a href="/courses/" class="ch-product-navigation-single-link">eCourses</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/courses/" class="ch-product-sub-navigation-link">Find eCourses</a></li>
										
																																																										<li><a href="/courses/my_editable_courses.php" class="ch-product-sub-navigation-link">Create/Edit an eCourse</a></li>
										
																																							<li><a href="/courses/about.php" class="ch-product-sub-navigation-link">About eCourses</a></li>
										
																											</ul>
													</li>
																				<li>
							<a href="/contact.php" class="ch-product-navigation-single-link">Support</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/contact.php" class="ch-product-sub-navigation-link">Contact Us</a></li>
										
																																							<li><a href="/faq.php" class="ch-product-sub-navigation-link">FAQ</a></li>
										
																											</ul>
													</li>
																		<li class="ch-user-navigation" id="ch-user-signup">
													<a class="ch-nav-sign-up-action" href="/registerForm.php" rel="nofollow">Sign up</a>
											</li>
					<li class="ch-user-navigation">
													<a href="/login.php" rel="nofollow">Log-in</a>
											</li>
							</ul>
		</div>
		<div id="ch-primary-mobile-search-container">
			<a href="/study-materials/"  class="ch-primary-show-mobile-search"><i class="icon-search"></i></a>
		</div>
	</div>
</div>
	<div id="ch-primary-navigation-search-wrapper" class="ch-wrapper">
	<div class="container">
		<div id="ch-primary-navigation-search-container">
			<form id="global-search" action="/search_result.php" method="POST">
				<fieldset>
					<input type="hidden" name='header' value="v2"/>
                    <input type="hidden" name='filters_product' value="documents"/>
					<input type="text" id="stx_global" name="stx" placeholder="Search for educational resources to help you learn"/>
					<a href="#" id="ch-primary-navigation-search-btn">Search</a>
				</fieldset>
			</form>
		</div>
	</div>
</div>
<script>
	jQuery(document).ready(function(){
		jQuery("#stx_global").keypress(function(event) {
			if ( event.which == 13 ) {
				event.preventDefault();
				jQuery('#global-search').submit();
			}
		});
		jQuery("#ch-primary-navigation-search-btn").click(function(){
			jQuery('#global-search').submit();
			return false;
		})
	});
</script>

				

<div class="ch-wrapper" id="ch-content-wrapper">
	<div id="doc-landing-banner" class="ch-banner light-blue-bg">
		<div class="container">
			<div class="page-heading-wrapper">
				<h1 class="intro-page-heading">
					Register now to access <span class="txt-green">7 million</span> high quality study materials
				</h1>
				<a class="whats-coursehero-tooltip">(What's Course Hero?)
					<span>
					Course Hero is the premier provider of high quality online educational resources. With millions of study documents, online tutors, digital flashcards and free courseware, Course Hero is helping students learn more efficiently and effectively. Whether you're interested in exploring new subjects or mastering key topics for your next exam, Course Hero has the tools you need to achieve your goals.
					</span>
				</a>
			</div>
			<div id="doc-landing-about-document-container" temprop="mainContentOfPage" itemscope itemtype="http://schema.org/CreativeWork">
				<div class="ch-doc-image-thumbnail">
					<div class="ch-doc-image-thumbnail-view">
												<img itemprop="image" id="doc-image" src="/thumb/b480030c31abdf0490e58367a7380d1747df1816_180.jpg" onerror="image_error_backup(this, '/view_thumbnail.php?filehash=b480030c31abdf0490e58367a7380d1747df1816&size=180')" alt="2007-01"/>
											</div>
										<div class="ch-doc-pageno">401 Pages</div>
									</div>
				<div class="ch-doc-summary">
					<h4 itemprop="name">							2007-01
											</h4>
																		<p><strong>Course: </strong>CPRE 556, Spring 2012</p>
												<p><strong>School: </strong>Iowa State</p>
																<p><strong>Word Count: </strong> 85333</p>
										<p><strong>Rating: </strong> <span id="doc-rating" data-score="5"></span></p>
				</div>
				<div id="ch-doc-text-preview">
					<h6>Document Preview</h6>
					<div class="ch-doc-preview-contents">
																				<p>support RMI not marshalling IDLEntity CORBA objects correctly.
The RMI support is marshalling all IDLEntity interface objects by value. The support needs to check to see if the object instance is a CORBA object and delay the decision to marshal as an CORBA object or value object until run time.
org.omg.CORBA_2_4.portable.ObjectImpl needs to extend org.omg.CORBA_2_3.portable.ObjectImpl
The class...</p>
																		</div>
					<div class="coa-wrapper">
						<a href="/registerForm.php?reg_only=1" class="orange-btn l registerForm-link" id="ch-register-link">Register Now</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container" id="doc-landing-container">
<div class="search-bar light-blue-bg studydocs-body-search-widget">
	<form id="search-form" action="/search_result.php" method="GET">
		<fieldset>
			<input type="hidden" id="je" name="je" value="0">
			<input type="hidden" id="autocomp" name="autocomp" value="0">
			<input type="hidden" id="fromqa" name="fromqa" value="1">
			<input type="text" class="search-bar-input" id="stx" name="stx" placeholder="Search by department, course, subject or keyword. Or ask a question" maxlength="500" />
			<a href="#" class="blue-btn search_bar_widget_submit"><i class="icon-search"></i><span>Search</span></a>
		</fieldset>
	</form>
</div>
<script type="text/javascript">
    jQuery(".search_bar_widget_submit").click(function(e){
        jQuery(this).parent().parent().submit();
        e.preventDefault();
        return false;
    });
</script>
        <div id="most_popular_materials_from_subject" class="ajax_load" data-params="school_type=HIGHER&school_name=Iowa State&dept_acro=CPRE&course_num=556&db_filename=7204791"></div>
        <div id="what_course_hero_offers" class="ajax_load"></div>
        <div id="qa_ask_question_widget" class="ajax_load" data-params="heading_inside=<strong>Cannot find the right document?</strong> Our tutors are available 24/7 to answer your questions."></div>
        <div id="horizontal_register_now" class="ajax_load"></div>
		<div class="doc-landing-doc-excerpt light-grey-bg">
			<h5>Unformatted Document Excerpt</h5>
							<a href="/">Coursehero</a> >> <a href="/sitemap/states/Iowa/">Iowa</a> >>
				<a href="/sitemap/schools/864-Iowa-State/">Iowa State</a> >>
				<a href="/sitemap/schools/864-Iowa-State/departments/2012-CPRE/">CPRE 556</a>
						<p>Course Hero has millions of student submitted documents similar to the one<br/>below including study guides, practice problems, reference materials, practice exams, textbook help and tutor support.</p>
			<p>Course Hero has millions of student submitted documents similar to the one below including study guides, practice problems, reference materials, practice exams, textbook help and tutor support.</p>
			<div title="Sign up now to view the formatted text.">
								<span itemprop="text">
											support RMI not marshalling IDLEntity CORBA objects correctly.
The RMI support is marshalling all IDLEntity interface objects by value. The support needs to check to see if the object instance is a CORBA object and delay the decision to marshal as an CORBA object or value object until run time.
org.omg.CORBA_2_4.portable.ObjectImpl needs to extend org.omg.CORBA_2_3.portable.ObjectImpl
The class org.omg.CORBA_2_4.portable.ObjectImpl is extending the org.omg.CORBA.portable.ObjectImpl version, not the correct org.omg.CORBA_2_3.ObjectImpl. This means that new methods introduced in the 2.3 version are not available with the 2.4 implementation that Yoko uses.
Errors in handling indirections when writeReplace() is involved.
There are a couple of errors in value serialization when writeReplace() operations are involved:
1) If the replacement value is a String, the logic for writing out the replacement value attempts to write out the original value as a string, which will cause a ClassCastException.
2) If there is a replacement value, both the original value object and the replacement need to be recorded in the indirection table.
Class names created from repository ids much remove unicode escape sequences.
Deserialization of inner classes needs to remove the unicode escape sequences from the class names. The Sun ORB is constructing the repository IDs for inner classes using &quot;outer\U0024inner&quot; rather than &quot;outer$inner&quot;. This is causing class loading failures.
PortableServer.Delegate.this_object() using wrong POA instance to activate object.
The PortableServer.Delegate.this_object() implementation is using the rootPOA instance to activate the object. This causes a failure for any non-system generated object IDs because the rootPOA is always created with the SYSTEM_ID id generation policy. this_object() needs to obtain the POA from the request current context rather than use the root.
XmlCursor.getTextValue returns concatenation of child text, comment, and processing instruction nodes
According to the XmlBeans javadocs, if the XmlCursor corresponds to an element then non-text content such as comments and processing instructions are ignored. However, as the following test shows, this is not the case:
String xml = &quot;&lt;element&gt;&lt;!--A Comment--&gt;999&lt;?PI A Processing Instruction?&gt;&lt;/element&gt;&quot;;
XmlObject xo = XmlObject.Factory.parse(xml);
XmlCursor xc = xo.newCursor();
xc.toFirstChild();
System.out.println(xc.currentTokenType()); // Verify that we are positioned at the start of an element
System.out.println(xc.getTextValue());
This prints out:
START
A Comment 999A Processing Instruction
Analysis:
In this case, the call stack is as follows:
org.apache.xmlbeans.impl.store.Cursor.getTextValue 
org.apache.xmlbeans.impl.store.Cursor._getTextValue
org.apache.xmlbeans.impl.store.Locale.getTextValue
In this method, the text value is built up with the text of instances of Cur for which the isText method returns true. I believe the org.apache.xmlbeans.impl.store.Cur.isText method should be as follows:
boolean isText ( ) { assert isPositioned(); return _pos &gt; 0 &amp;&amp; kindIsContainer(_xobj.kind()); }
This would exclude comments and processing instructions.
Deferred DOM: TypeInfo incorrect when an element's type is a union.
When the type of an element is a union, the [member type definition] will not be available until the end of the element (the exception being if the element is empty). The DOMParser is currently setting the TypeInfo [1] in startElement. To get the member type it needs to be set in endElement.
[1] http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/core.html#TypeInfo
[XML 1.0] - E13 of third edition errata needs to be implemented.
E13 [1] of the XML 1.0 3rd edition errata clarifies that even internal parameter entity references are enough to make undeclared entities into mere validity errors rather than well-formedness errors. Xerces will currently report a fatal error for such a document. I see alot of REVISITs in the code so this is probably broken for all references to parameter entities (not just internal ones).
[1] http://www.w3.org/XML/xml-V10-3e-errata#E13
Using 'list' or 'union' for finalDefault in schema element causes incorrect validation errors
I am trying to test parsing using 'list' or 'union' for finalDefault and I'm getting parsing errors from the validation parser for a valid schema:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xs:schema
xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
targetNamespace=&quot;http://www.quovadx.com/schema_test&quot;
xmlns:st=&quot;http://www.quovadx.com/schema_test&quot;
finalDefault=&quot;list union&quot;
&gt;
&lt;xs:element name=&quot;root&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;gst0&quot; type=&quot;st:gst_explicit_none&quot;&gt;&lt;/xs:element&gt;
&lt;xs:element name=&quot;gst1&quot; type=&quot;st:gst_none&quot;&gt;&lt;/xs:element&gt;
&lt;xs:element name=&quot;gst2&quot; type=&quot;st:gst_r&quot;&gt;&lt;/xs:element&gt;
&lt;xs:element name=&quot;gst3&quot; type=&quot;st:gst_u&quot;&gt;&lt;/xs:element&gt;
&lt;xs:element name=&quot;gst4&quot; type=&quot;st:gst_rl&quot;&gt;&lt;/xs:element&gt;
&lt;xs:element name=&quot;gst5&quot; type=&quot;st:gst_ru&quot;&gt;&lt;/xs:element&gt;
&lt;xs:element name=&quot;gst6&quot; type=&quot;st:gst_lu&quot;&gt;&lt;/xs:element&gt;
&lt;xs:element name=&quot;gst7&quot; type=&quot;st:gst_rlu&quot;&gt;&lt;/xs:element&gt;
&lt;xs:element name=&quot;gst8&quot; type=&quot;st:gst_all&quot;&gt;&lt;/xs:element&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:simpleType name=&quot;gst_explicit_none&quot; final=&quot;&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;xs:simpleType name=&quot;gst_none&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;xs:simpleType name=&quot;gst_r&quot; final=&quot;restriction&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;xs:simpleType name=&quot;gst_l&quot; final=&quot;list&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;xs:simpleType name=&quot;gst_u&quot; final=&quot;union&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;xs:simpleType name=&quot;gst_rl&quot; final=&quot;restriction list&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;xs:simpleType name=&quot;gst_ru&quot; final=&quot;restriction union&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;xs:simpleType name=&quot;gst_lu&quot; final=&quot;list union&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;xs:simpleType name=&quot;gst_rlu&quot; final=&quot;restriction list union&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;xs:simpleType name=&quot;gst_all&quot; final=&quot;#all&quot;&gt;&lt;xs:union memberTypes=&quot;xs:int&quot;&gt;&lt;/xs:union&gt;&lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;
And the following xml instance
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;st:root xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xsi:schemaLocation=&quot;http://www.quovadx.com/schema_test schema_test.xsd&quot;
xmlns:st=&quot;http://www.quovadx.com/schema_test&quot;&gt;
&lt;gst0&gt;1&lt;/gst0&gt;
&lt;gst1&gt;2&lt;/gst1&gt;
&lt;gst2&gt;3&lt;/gst2&gt;
&lt;gst3&gt;4&lt;/gst3&gt;
&lt;gst4&gt;5&lt;/gst4&gt;
&lt;gst5&gt;6&lt;/gst5&gt;
&lt;gst6&gt;7&lt;/gst6&gt;
&lt;gst7&gt;8&lt;/gst7&gt;
&lt;gst8&gt;9&lt;/gst8&gt;
&lt;/st:root&gt;
Produces the following errors running PParse:
Error at file C:\CurrentProject\5.5\AR\10237\Xerces_bug\schema_test.xsd, line 7,
char 6
Message: Invalid final value: list union
Error at file C:\CurrentProject\5.5\AR\10237\Xerces_bug\schema_test.xsd, line 7,
char 6
Message: Invalid final value: list union
I believe the issue is with the validation. Currently 'list' and 'schema' are only allowed for simpleType definitions, but should be allowed in the schema's finalDefault attribute as well.
xs:unique is used like xs:key
&lt;xs:unique name=&quot;uniqueLNodeType&quot;&gt;
&lt;xs:selector xpath=&quot;scl:LNodeType&quot;/&gt;
&lt;xs:field xpath=&quot;@id&quot;/&gt;
&lt;xs:field xpath=&quot;@iedType&quot;/&gt;
&lt;/xs:unique&gt;
This xs:unique seems to be validated like xs:key.
In my xml-file there is a &lt;LNodeType id=&quot;IED_0001/PROT/LPHD1&quot; lnClass=&quot;LPHD&quot;&gt;
Xerces tells me, there are not enough values specified for &lt;unique&gt;
If I add an iedType like here: &lt;LNodeType id=&quot;IED_0001/PROT/LLN0&quot; lnClass=&quot;LLN0&quot; iedType=&quot;frranz&quot;&gt;
Xerces seems to be satisfied.
But this is not correct: the fields of an unique needn't to be required. They may be optional and so they may be missing.
Combobox requires 2 clicks to activate the drop down
Combobox activates the dropdown on the first click, but then requires 2 clicks for it to activate again once clicked.
Cannot remove a row from a parent row
This either does not work well or at all, rowBridge and row are missing any logic to handle this.
Widgets: Window: Width and height attributes don't work when window is created.
This is the similar to issue XAP-87, which said width and height attributes didn't work for windows. The report left out that it happened with windows when they were created, not those that already existed.
A window will not assume its given size when it is created. However, width and height can be changed with an mco or macro. See window widget example
Widgets: TreeTable: Expandable row doesn't hide expand/collapse button when last child row deleted
Create a teetable with one row with another row inside it. Delete the inside row, and the parent row doesn't lose its expand/collapse button
Xmodify: Append can only append one row to a table at a time
I tried to do a multirow append into a table and nothing happened. Breaking it down into single row appends worked fine, however.
Widgets: Window: width and height attributes are not working
width and height attributes are not working for &lt;window /&gt;
Widgets: Table: Alternating row color doesn't adjust itself correctly when branch with odd number of leaves expands.
Create a table with an expanding row. This row should have an odd number of children.
The background colors of the rows by default alternate between grey and white.
When a branch is expanded, all of the rows below should change their background color to the other color if the expanded row had an odd number of children. However, they don't in the current version.
Widgets: Table: Removing a row messes up alternating row colors.
1) Create a table with a few rows. Every other row will have a grey background, while the others have a white background
2) Remove a row from the middle. The following rows should switch their colors to keep the colors alternating. However, they don't, so the table shows two background colors that are the same next to each other.
Widgets: Table: Removing expanded row leaves children behind
1) Create a table with an expandable branch
2) Expand the branch
3) Remove the expanded parent row (not its leaf)
The children remain behind, They do not remain if the row was collapsed beforehand, though. The XAL DOM is correct, though.
Inconsistent flushing of serializers
The new serializers do not flush the underlying writer during the endDocument() call. This leads to inconsistent behavior with respect to the old serializers. Normally, it's not a problem, but it can lead to confusing in users' code, and it does mean that the final buffer of output is not flushed until the underlying XalanPrintWriter is destroyed.
Broken cast in ElemTemplateElement::findTemplateToTransformChild()
This function has an illegal cast of XalanText and XalanCDATASection node types to XalanAttributute. The bug was introduced in the fix for XALANC-609.
A patch will follow.
The key() function does not work when the context node is the root node of a result tree fragment obtained through exsl:node-set()
The key() function does not work when the context node is the root node of a result tree fragment obtained through exsl:node-set().
Consider the following stylesheet (applied to any input document, the actual input does not matter):
&lt;?xml version=&quot;1.0&quot; encoding = &quot;ISO-8859-1&quot;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:exsl=&quot;http://exslt.org/common&quot;&gt;
&lt;xsl:key name=&quot;lookup-by-name&quot; match=&quot;*&quot; use=&quot;local-name()&quot;/&gt;
&lt;xsl:variable name=&quot;test-tree-rtf&quot;&gt;&lt;N1&gt;&lt;N2&gt;&lt;N3&gt;&lt;/N3&gt;&lt;/N2&gt;&lt;/N1&gt;&lt;/xsl:variable&gt;
&lt;xsl:variable name=&quot;test-tree&quot; select=&quot;exsl:node-set($test-tree-rtf)/*&quot;/&gt;
&lt;xsl:template match=&quot;/&quot;&gt;
&lt;!-- key() with context within the result tree fragment. --&gt;
&lt;xsl:for-each select=&quot;$test-tree&quot;&gt;
&lt;xsl:for-each select=&quot;.&quot;&gt;
&lt;xsl:variable name=&quot;n1&quot; select=&quot;key('lookup-by-name', 'N1')&quot;/&gt;
&lt;xsl:choose&gt;
&lt;xsl:when test=&quot;count($n1)=1&quot;&gt;&lt;xsl:message&gt;OK &lt;/xsl:message&gt;&lt;/xsl:when&gt;
&lt;xsl:otherwise&gt;&lt;xsl:message&gt;BUG &lt;/xsl:message&gt;&lt;/xsl:otherwise&gt;
&lt;/xsl:choose&gt;
&lt;/xsl:for-each&gt;
&lt;/xsl:for-each&gt;
&lt;!-- key() with context being the root of the result tree fragment. --&gt;
&lt;xsl:for-each select=&quot;$test-tree&quot;&gt;
&lt;xsl:for-each select=&quot;/&quot;&gt;
&lt;xsl:variable name=&quot;n1&quot; select=&quot;key('lookup-by-name', 'N1')&quot;/&gt;
&lt;xsl:choose&gt;
&lt;xsl:when test=&quot;count($n1)=1&quot;&gt;&lt;xsl:message&gt;OK &lt;/xsl:message&gt;&lt;/xsl:when&gt;
&lt;xsl:otherwise&gt;&lt;xsl:message&gt;BUG &lt;/xsl:message&gt;&lt;/xsl:otherwise&gt;
&lt;/xsl:choose&gt;
&lt;/xsl:for-each&gt;
&lt;/xsl:for-each&gt;
&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
In the two cases, the key() function should return the N1 node belonging to the result tree fragment
(because the result tree fragment is acting as the &quot;context document&quot; in both cases).
However, it works only in the first case (it prints &quot;OK&quot;), not the second (it prints &quot;BUG&quot;).
I could find that the cause of the bug is in the function getKeyNode() of StylesheetRoot.cpp.
This function does not work when the context node is a DOCUMENT_FRAGMENT_NODE to start with.
I rewrote it so that it works in that case too (see attachment).
Best regards,
Alain Le Guennec.
Version information missing for XalanMessages_1_10.dll
If I right click on Xalan-C_1_1.dll from a Windows Explorer and select properties I get the properties dialog.
This properties dialog contains a version tab indicating the current version of this DLL (1.10.0.0 in this case)
However if I do the same thing with XalanMessages_1_10.dll the properties dialog does not contain a version tab.
This version information is important if you are putting DLLs into a symbol server for example.
EXSLT date-time function missing + or - before timezone offset
The exslt function date-time() returns a datetime that is not conform the specification.
It is missing the + or - sign before the timezone offset.
It should be e.g:
2006-01-18T18:55:41+01:00
But the function returns:
2006-01-18T18:55:4101:00
This is not conform specification.
see: http://exslt.org/date/functions/date-time/index.html
Sample stylesheet:
&lt;xsl:transform xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
version=&quot;1.0&quot;
xmlns:date=&quot;http://exslt.org/dates-and-times&quot; 
&gt;
&lt;xsl:template match=&quot;/&quot;&gt;
&lt;foo&gt;&lt;xsl:value-of select=&quot;date:date-time()&quot; /&gt;&lt;/foo&gt;
&lt;/xsl:template&gt;
&lt;/xsl:transform&gt;
Wrong bean package name in Pell plugin
The bean definition in struts-plugin.xml for the pell plugin is wrong.
css_xhtml dateTimePicker is missing controlheader and controlfooter
The datetimepicker.ftl in the css_xhtml template is missing the controlheader and controlfooter includes found in the other contols of that template. This leads to a datetimepicker without the corresponding labels and field error messages. I'll attach a patch.
Problem with dev-mode error.ftl with only one msg
The version of error.ftl in struts 2.0.4 has a problem when only one message is in msgs. It was working find in struts 2.0.3. I have the build environment set up now, so I'll attach a patch.
DateTimePicker is broken in Freemarker results
The &lt;@s.datetimepicker&gt; tag results in this error:
freemarker.core.InvalidReferenceException: on line 22, column 7 in WEB-INF/clients/clientList.ftl s.datepicker not found.
I think the problem is that the /views/freemarker/tags/StrutsModels.java class has a method called getDropdownDateTimePicker() instead of the new getDateTimePicker() [see WW-1596 for the name change]
I haven't been able to make the change a do a complete new build to test it, but I can confirm that &lt;@s.dropdownDateTimePicker&gt; makes the error go away. The resulting html/js still doesn't actually work, though, since it refers to dojoType=&quot;dropdowndatepicker&quot;
global-results not inherited when using zero config
Using the latest Struts 2 trunk code, it seems that zero-configged Action classes don't get access to global-results defined in parent packages.
See attached war for an example of this issue. In this war, example.annotated.AnnotationAction is annotated like so:
@ParentPackage(&quot;tmpPkg&quot;)
@Namespace(&quot;&quot;)
@Results({
@Result(name=&quot;l3&quot;, value=&quot;/example/Login.jsp&quot;)
})
The parent package, tmpPkg, is setup like this:
&lt;package name=&quot;tmpPkg&quot; extends=&quot;example&quot;&gt;
&lt;global-results&gt;
&lt;result name=&quot;l2&quot;&gt;/example/Login.jsp&lt;/result&gt;
&lt;/global-results&gt;
&lt;/package&gt;
tmpPkg's parent package, example, has the following global-results defined:
&lt;global-results&gt;
&lt;result name=&quot;l1&quot;&gt;/example/Login.jsp&lt;/result&gt; 
&lt;result name=&quot;hello&quot;&gt;/example/HelloWorld.jsp&lt;/result&gt; 
&lt;/global-results&gt;
To demonstrate this problem, you can pass the AnnotationAction the &quot;res&quot; request parameter. If the value is &quot;local&quot; the action will return the locally defined (via @Result) result. This case works. If the value is &quot;parent&quot;, the action will return tmpPkg's &quot;l2&quot; result. If the value is &quot;parentparent&quot;, the action will return the example package's &quot;l1&quot; results. The latter two cases don't work, and result in the following error:
No result defined for action example.annotated.AnnotationAction and result l1
NullPointerException when using the optgroup tag
Using a select box with an option group causes a NullPointerException. The HTML for the select box and its option groups are correctly constructed and rendered, but an error is reported in the log and console. To reproduce the problem simply use the example for an option group from http://struts.apache.org/2.x/docs/optgroup.html.
struts.custom.i18n setting ignored if set by constant configuration
The struts.custom.i18n.resources setting works from a struts.properties file, but the same setting is ignored by a constant setting in struts.xml. 
struts.properties works:
struts.custom.i18n.resources=resources
struts.xml does not work:
&lt;struts&gt;
&lt;constant name=&quot;struts.custom.i18n.resources&quot; value=&quot;resources&quot;/&gt;
NullPointerException in ServletRedirectResult
I've found a case where actionMapper can be null in ServletRedirectResult. 
We have a custom ActionMapper, which is based on DefaultActionMapper. One of the differences
between the two is that our implementation of getUriFromActionMapping() sometimes returns values without a / on the front. This results in an NPE during our login process.
Login is setup like this:
o Login.jsp submits to LoginAction 
o On a successful login, LoginAction redirects (via a &quot;redirect-action&quot; result in struts.xml) to HomeAction. 
o HomeAction redirects to different actions based on the logged in users role.
An NPE is thrown when trying to redirect after HomeAction.execute() returns. The NPE occurs in ServletRedirectResult.java at line 127. It is thrown because actionMapper is null. The ActionMapper isn't being injected into ServletRedirectResult via setActionMapper(). I'm guessing this is because ServletRedirectResult.doExecute() is being called from ServletActionRedirectResult (via super.execute()), as opposed to the framework creating a new instance. I was able to fix it by removing the actionMapper instance from ServletActionRedirectResult.java, and making
ServletRedirectResult's actionMapper protected instead of private. I not sure if this is really a valid fix. Our custom mapper includes the changes made in DefaultActionMapper to fix WW-1571, so I think this may be a separate issue.
I've created an updated version of the Struts 2 blank application which demonstrates the problem. This includes a version of the struts2-core jar which includes some debug, as well as a tweak to DefaultActionMapper that removes the leading / from URIs returned by getUriFromActionMapping(). This is to simulate what our custom ActionMapper does. To cause the NPE, all you need to do is attempt to login.
Error rendering error template when error occurs deeper than action level
In my application, whenever I have an error deeper than the action level ( i.e. an exception thrown by one of my DAOs, Managers, or JDBC calls ), instead of the seeing the actual error, as rendered by error.ftl ( i have devMode enabled ),
I get the following error from FreeMarker trying to render the template :
HTTP Status 500 - Unable to show problem report: freemarker.core.NonStringException: Error on line 45, column 27 in org/apache/struts2/dispatcher/error.ftl Expecting a string, date or number here, Expression msg is instead a freemarker.ext.beans.SimpleMethodModel
type Status report
message Unable to show problem report: freemarker.core.NonStringException: Error on line 45, column 27 in org/apache/struts2/dispatcher/error.ftl Expecting a string, date or number here, Expression msg is instead a freemarker.ext.beans.SimpleMethodModel
description The server encountered an internal error (Unable to show problem report: freemarker.core.NonStringException: Error on line 45, column 27 in org/apache/struts2/dispatcher/error.ftl Expecting a string, date or number here, Expression msg is instead a freemarker.ext.beans.SimpleMethodModel) that prevented it from fulfilling this request.
The full stack trace is :
freemarker.core.NonStringException: Error on line 45, column 27 in org/apache/struts2/dispatcher/error.ftl
Expecting a string, date or number here, Expression msg is instead a freemarker.ext.beans.SimpleMethodModel
at freemarker.core.Expression.getStringValue(Expression.java:126)
at freemarker.core.Expression.getStringValue(Expression.java:93)
at freemarker.core.DollarVariable.accept(DollarVariable.java:76)
at freemarker.core.Environment.visit(Environment.java:196)
at freemarker.core.MixedContent.accept(MixedContent.java:92)
at freemarker.core.Environment.visit(Environment.java:196)
at freemarker.core.IteratorBlock$Context.runLoop(IteratorBlock.java:172)
at freemarker.core.Environment.visit(Environment.java:351)
at freemarker.core.IteratorBlock.accept(IteratorBlock.java:95)
at freemarker.core.Environment.visit(Environment.java:196)
at freemarker.core.MixedContent.accept(MixedContent.java:92)
at freemarker.core.Environment.visit(Environment.java:196)
at freemarker.core.IfBlock.accept(IfBlock.java:82)
at freemarker.core.Environment.visit(Environment.java:196)
at freemarker.core.MixedContent.accept(MixedContent.java:92)
at freemarker.core.Environment.visit(Environment.java:196)
at freemarker.core.Environment.process(Environment.java:176)
at freemarker.template.Template.process(Template.java:231)
at org.apache.struts2.dispatcher.Dispatcher.sendError(Dispatcher.java:737)
at org.apache.struts2.dispatcher.Dispatcher.serviceAction(Dispatcher.java:514)
at org.apache.struts2.dispatcher.FilterDispatcher.doFilter(FilterDispatcher.java:421)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at com.opensymphony.module.sitemesh.filter.PageFilter.parsePage(PageFilter.java:119)
at com.opensymphony.module.sitemesh.filter.PageFilter.doFilter(PageFilter.java:55)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.struts2.dispatcher.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:99)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.springframework.orm.jpa.support.OpenEntityManagerInViewFilter.doFilterInternal(OpenEntityManagerInViewFilter.java:113)
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:77)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:204)
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
at org.apache.coyote.http11.Http11AprProcessor.process(Http11AprProcessor.java:833)
at org.apache.coyote.http11.Http11AprProtocol$Http11ConnectionHandler.process(Http11AprProtocol.java:639)
at org.apache.tomcat.util.net.AprEndpoint$Worker.run(AprEndpoint.java:1285)
at java.lang.Thread.run(Unknown Source)
Can't specify method to call on action in portlet mode
When you generate urls or specify a method on a submit button, the portlet dispatcher doesn't know how to parse the method name out of the &quot;url&quot;.
2.0.4 Omnibus
General ticket for miscellaneous commits for 2.0.4
Restful2ActionMapper has NullPointerException when used with codebehind
As described here :
http://www.nabble.com/-S2--possible-NPE-in-Restful2--tf3022218.html
The actual error message is :
java.lang.NullPointerException
org.apache.struts2.dispatcher.mapper.Restful2ActionMapper.getMapping(Restful2ActionMapper.java:97)
org.apache.struts2.dispatcher.FilterDispatcher.doFilter(FilterDispatcher.java:393)
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
com.opensymphony.module.sitemesh.filter.PageFilter.parsePage(PageFilter.java:119)
com.opensymphony.module.sitemesh.filter.PageFilter.doFilter(PageFilter.java:55)
This occurs because restful2 doesn't check to see if the mapping returned by the super call in it's getMapping() method is not null before calling getName() on it.
The patch just adds a check for null, and returns immediately if that's the case.
TabbedPanel is not assigning &quot;id&quot; attribute properly
Error messages when invoking portlets
I have a small portlet app.
Works, parameters from forms are passed.
But what is interesting I can see some error messages from struts internals.
I am not sure what causes these errors but it is definitely not my code which does basic things, like logging and redirecting to a JSP.
2007-01-11 11:06:35 com.opensymphony.xwork2.interceptor.ParametersInterceptor setParameters
SEVERE: ParametersInterceptor - [setParameters]: Unexpected Exception catched: Error setting expression 'id' with value '[Ljava.lang.String;@9caeb2'
2007-01-11 11:06:35 com.opensymphony.xwork2.interceptor.ParametersInterceptor setParameters
SEVERE: ParametersInterceptor - [setParameters]: Unexpected Exception catched: Error setting expression 'struts.portlet.action' with value '[Ljava.lang.String;@9042c8'
2007-01-11 11:06:35 com.opensymphony.xwork2.interceptor.ParametersInterceptor setParameters
SEVERE: ParametersInterceptor - [setParameters]: Unexpected Exception catched: Error setting expression 'struts.portlet.mode' with value '[Ljava.lang.String;@1109962'
2007-01-11 11:06:35 com.opensymphony.xwork2.interceptor.ParametersInterceptor setParameters
SEVERE: ParametersInterceptor - [setParameters]: Unexpected Exception catched: Error setting expression 'templateDir' with value '[Ljava.lang.String;@c60a18'
2007-01-11 11:06:35 com.opensymphony.xwork2.interceptor.ParametersInterceptor setParameters
SEVERE: ParametersInterceptor - [setParameters]: Unexpected Exception catched: Error setting expression 'theme' with value '[Ljava.lang.String;@1c0cac6'
SAVE: dostalem osobe: Person:id=null:firstName=:lastName=a
2007-01-11 11:06:35 com.opensymphony.xwork2.interceptor.ParametersInterceptor setParameters
SEVERE: ParametersInterceptor - [setParameters]: Unexpected Exception catched: Error setting expression 'struts.portlet.action' with value '[Ljava.lang.String;@19274f9'
2007-01-11 11:06:35 com.opensymphony.xwork2.interceptor.ParametersInterceptor setParameters
SEVERE: ParametersInterceptor - [setParameters]: Unexpected Exception catched: Error setting expression 'struts.portlet.eventAction' with value '[Ljava.lang.String;@3da1e2'
2007-01-11 11:06:35 com.opensymphony.xwork2.interceptor.ParametersInterceptor setParameters
SEVERE: ParametersInterceptor - [setParameters]: Unexpected Exception catched: Error setting expression 'struts.portlet.mode' with value '[Ljava.lang.String;@4f27a3'
PortletActionContext.getDefaultActionForMode - ClassCastException
Simple action in the portlet environment, and a call
System.out.println(&quot;PORTLET: defaultActionForMode: &quot; + PortletActionContext.getDefaultActionForMode());
causes stacktrace:
2007-01-11 10:40:22 org.apache.struts2.portlet.dispatcher.Jsr168Dispatcher serviceAction
SEVERE: Could not execute action
java.lang.ClassCastException: org.apache.struts2.dispatcher.mapper.ActionMapping cannot be cast to java.lang.String
at org.apache.struts2.portlet.context.PortletActionContext.getDefaultActionForMode(PortletActionContext.java:184)
at pl.impaq.web.struts.view.person.PersonManagementAction.edit(PersonManagementAction.java:56)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:597)
at com.opensymphony.xwork2.DefaultActionInvocation.invokeAction(DefaultActionInvocation.java:408)
at com.opensymphony.xwork2.DefaultActionInvocation.invokeActionOnly(DefaultActionInvocation.java:262)
at com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:224)
Most likely the action mapping is not a simple String but an org.apache.struts2.dispatcher.mapper.ActionMapping instance.
The method should return the mapping object instead of a String.
Unused text message lookup
See: http://jira.opensymphony.com/browse/WW-1375
&quot;FileUploadInterceptor.intercept() calls &quot;getTextMessage(&quot;webwork.messages.current.file&quot;, new Object[]{inputName, contentType[index], fileName[index], files[index]}, ActionContext.getContext().getLocale());&quot; but ignores the result.&quot;
ww:div shall be block directive in velocity view
See: http://jira.opensymphony.com/browse/WW-1372
Adding:
-------------------
public int getType() {
return BLOCK;
}
-------------------
to com.opensymphony.webwork.views.velocity.components.DivDirective
magically turns it into block directive which it really should be instead
of line...
HTML &lt;script&gt; tags in templates missing type attribute, causing invalid HTML
See: http://jira.opensymphony.com/browse/WW-1405
The &lt;script&gt; tags generated by WebWork should have the type attribute, per the HTML 4 specification. One specific example is in the /simple/form-close.ftl template, in the customOnSubmit script. Simply changing the template to do &lt;script type=&quot;text/javascript&quot;&gt; instead of &lt;script&gt; solves the problem.
ScopeInterceptor handling of null values for session attributes breaks under some circumstances
See: http://jira.opensymphony.com/browse/WW-1386
With the &lt;distributable /&gt; flag set in the web.xml file and the web application deployed to Tomcat, when the ScopeInterceptor tries to set a null value, which in this case is a ScopeInterceptor.NULL object, there is an exception thrown because this object is not serializable.
The problem seems to be the nullConvert() method which takes the null and makes it an object of an anonymous class, a custom ScopeInterceptor which doesn't do this conversion works fine under these circumstances.
The stack trace is this exception is:
java.lang.IllegalArgumentException: setAttribute: Non-serializable attribute
org.apache.catalina.session.StandardSession.setAttribute(StandardSession.java:1255)
org.apache.catalina.session.StandardSession.setAttribute(StandardSession.java:1233)
org.apache.catalina.session.StandardSessionFacade.setAttribute(StandardSessionFacade.java:129)
com.opensymphony.webwork.dispatcher.SessionMap.put(SessionMap.java:161)
com.opensymphony.webwork.interceptor.ScopeInterceptor.beforeResult(ScopeInterceptor.java:324)
com.opensymphony.xwork.DefaultActionInvocation.invoke(DefaultActionInvocation.java:200)
com.opensymphony.xwork.DefaultActionProxy.execute(DefaultActionProxy.java:113)
com.opensymphony.webwork.dispatcher.DispatcherUtils.serviceAction(DispatcherUtils.java:225)
com.opensymphony.webwork.dispatcher.FilterDispatcher.doFilter(FilterDispatcher.java:202)
com.opensymphony.module.sitemesh.filter.PageFilter.parsePage(PageFilter.java:118)
com.opensymphony.module.sitemesh.filter.PageFilter.doFilter(PageFilter.java:52)
com.opensymphony.webwork.dispatcher.ActionContextCleanUp.doFilter(ActionContextCleanUp.java:88)
com.atsva.glin.web.SetCharacterEncoding.doFilter(SetCharacterEncoding.java:47)
Missing treenode in freemarker tags
See http://jira.opensymphony.com/browse/WW-1383
UIBean component sets malformed default ID with ONGL expression for name parameter
When using a ONGL expression for the 'name' property of a JSP UI tag, UIBean sets the default value of the 'id' property to the string value of 'name' without parsing 'name' for an ONGL expression. This results in malformed HTML IDs:
&lt;ww:textfield name=&quot;propertyName[%{'1'}].id&quot;/&gt;
results in:
&lt;input type=&quot;text&quot; name=&quot;propertyName[1].id&quot; value=&quot;&quot; id=&quot;groupSave_%{'1'}__id'}&quot;/&gt; 
See http://jira.opensymphony.com/browse/WW-1360
Apache Struts 2 Documentation &gt; Home &gt; Guides &gt; Core Developers Guide &gt; Action Chaining's next link error
Apache Struts 2 Documentation &gt; Home &gt; Guides &gt; Core Developers Guide &gt; Action Chaining's next link link to &quot;http://cwiki.apache.org/test/actionmapper.html&quot;, but it should be linked to &quot;Apache Struts 2 Documentation &gt; Home &gt; Guides &gt; Core Developers Guide &gt; ActionMapper&quot;
optiontransferselect allowUpDownOnLeft allowUpDownOnRight not specified in tld
Everything except the tld definitions are implemented. Without, you can't get rid of the reordering buttons.
Autocompleter &quot;list&quot; attribute is not required
overwrite the base setList method which is required don the base
Remote forms page on showcase is using the wrong attributes for submit
use &quot;onLoadJS&quot; and &quot;preInvokeJS&quot; instead of &quot;afterLoading&quot; and &quot;beforeLoading&quot;
DropdownDateTimePicker is not rendering label
add DropdownDateTimePicker to the xhtml theme
Codebehind Plugin causing multiple issues with the showcase.
The codebehind plugin is throwing a null pointer exceptions which causes several pages (including the front page and what appears to be all &quot;view sources&quot; pages, to fail). Here's the root cause, which is nested within 4 other wrapped exceptions.
java.lang.NullPointerException
org.apache.struts2.codebehind.CodebehindUnknownHandler.setConfiguration(CodebehindUnknownHandler.java:80)
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
java.lang.reflect.Method.invoke(Method.java:585)
com.opensymphony.xwork2.inject.ContainerImpl$MethodInjector.inject(ContainerImpl.java:287)
com.opensymphony.xwork2.inject.ContainerImpl.inject(ContainerImpl.java:451)
DatePicker and TimePicker are not working at all
These two tags were not creating hidden fields for their values (quite useless :) ), a workaround for a Dojo inconsistency was also needed.
ExecuteAndWaitInterceptor no longer works after upgrading from WebWork 2.2.4
After upgrading from WebWork 2.2.4 to Struts 2.0.2-SNAPSHOT the actions that use the ExecuteAndWaitInterceptor no longer work. Looking at the changes to the interceptor it appears that the changes to add the &quot;executeAfterValidationPass&quot; property are causing the problem.
To support this feature a new local variable &quot;secondTime&quot;, which defaults to true, was added to the doIntercept() method. Later in the code are various checks to determine what result should be returned. The following is a condensed version of the if-else:
if (!secondTime &amp;&amp; bp != null &amp;&amp; !bp.isDone()) {
return WAIT;
} else if (!secondTime &amp;&amp; bp != null &amp;&amp; bp.isDone()) {
return bp.getResult();
} else {
return actionInvocation.invoke();
}
Looking at the code I can't see how the &quot;secondTime&quot; variable can ever be set to false except on the first iteration or if you're using the &quot;executeAfterValidationPass&quot; property.
The workaround for now is to use the ExecuteAndWaitInterceptor that ships with WebWork 2.2.4. 
OptionTransferSelect doubleSize is ignored in lieu of size property
Submit tag webapp root repeats when path saved to local variable
Same problem as in [WW-1537] but on the Submit tag
RequestContextImpl is not cleaned up on undeploy
RequestContextImpl maintains a threadlocal with a reference to a context. Since the value is an array of type RequestContextImpl and the threadlocal is never cleared on undeploy of the application the application as a whole cannot be redeployed.
Either add logic to clear this threadlocal, or change the type of the array to Object[], which should allow the RequestContextImpl class to be GC'ed.
DefaultActionMapper ignores &quot;/&quot; between the namespace and action name when there are &quot;/&quot; in action name
when namespace is &quot;/test&quot; and action name is &quot;*/abc&quot;
Then &quot;http://localhost/myapp/test/hh/abc&quot; can access my action.
However, &quot;http://localhost/myapp/test.hh/abc&quot; can access my action too. It's not expected.
Tooltips display twice
The tooltips are displaying twice, once by the field, and a second time, in a larger font, farther down the screen. 
This behavior predates the fix for WW-1425. 
WW 2.2.3, which uses a different Javascript library, displays the tooltips once, by the field. 
To confirm, in the Showcase, see Tag Examples/UI Tags/UI Example, and hover over a tooltip. The first tooltip will appear, and after a moment, the tip will render again farther down the screen. 
WSSecTimestamp should allow a non-expiring timeToLive
Since the Expires element is optional in the WS-Security timestamp, there should (or must) be a way to tell WSSecTimestamp not to add it. For example, a negative timeToLive value.
Thanks!
Validation structure of interface methods should be cleaned up
The component and document validation classes both contain an interface validation method that is pretty long. These methods should be broken up by element. This structure will make the classes more readable immediately, will provide a way to validate individual elements and should allow for easier refactoring to support validation extensions.
Testcases MessageTest-1G, 2G, 3G, 4G failing due to canonicalization error
These 4 testcases were previously 'green'. The WSDL has been changed recently, but it looks like the canonicalization of the Woden wsdlcm file has to be changed too. The non-canonical Woden wsdlcm files do have the 'expected' content.
http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Woden/MessageTest-1G/SOAPservice.results.xml?content-type=application/xml
http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Woden/MessageTest-2G/HTTPservice.results.xml?content-type=application/xml
http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Woden/MessageTest-3G/HTTPservice.results.xml?content-type=application/xml
http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Woden/MessageTest-4G/SOAPservice.results.xml?content-type=application/xml
Testcase HTTPBinding-2G fails
This testcase is fails on the WSDL 2.0 interop Dashboard:
http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Woden/HTTPBinding-2G/Echo.results.xml?content-type=application/xml
There seems to be a problem canonicalizing the Woden interchange results (the non-canonical wsdlcm file looks OK).
The canonical results suggest that Woden has it's Service and Endpoint elements mixed up. Should be 2 services with 1 endpoint in each service, but the Woden canonical results show 1 service with 2 endpoints. 
When I test this with my own test client it's fine. Here's some output:
Client: About to read wsdl at location: http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/documents/good/HTTPBinding-2G/Echo.wsdl
Service components:
EchoService
PostEchoHTTPEndpoint
SafeEchoService
EchoHTTPEndpoint
Component model should contain ALL schema elements and types
As discussed via the WSDL 2.0 mailing list [1], the component model should contain the global element declarations and type definitions for ALL schemas accessible within the WSDL tree, not just those schemas inlined or imported directly within the wsdl:types elements. This includes any schemas nested within other schemas via xs:import, xs:include or xs:redefines.
This change will fix WODEN-101 and WODEN-102 which capture WSDL 2.0 testcase failures for SparqlQuery-1G and SparqlQuerySimplified-1G respectively.
Problem in Obtaining Mep (of operation Guaranteed Fault) in MessageTest-1G
Hi,
I obtain the mep of an interfaceOperation using 
interfaceOperation.getMessageExchangePattern().toString();
But in the case of operation Guaranteed fault the value returned by the above statement is 
http://www.w3.org/2006/01/wsdl/in-out
The WSDL says &quot;http://www.w3.org/2006/01/wsdl/robust-in-only&quot;
Is this a bug or am I using a wrong method.
Thanks,
Keith
NPE when &lt;import&gt; location does not resolve to a document
A null pointer exception occurs when reading a WSDL document containing a &lt;wsdl:import&gt; that does not resolve to a document. Woden correctly issues a warning message (WSDL503,Could not locate the WSDL document at URL ...) but later in the code it attempts to use a null DescriptionElement reference.
The offending code in DescriptionImpl.getNestedDescriptions is:
if(desc != null) descs.add(desc);
collectIncludedDescriptions(descs, desc);
but it should be: 
if(desc != null) {
descs.add(desc);
collectIncludedDescriptions(descs, desc);
}
MessageTest-2G does not return httplocation correctly
Hi,
When parwing the WSDL in MessageTest-2G I get the following errors from woden,
Woden[Error],0:0,WSDL506,Could not create a URI from the string &quot;?first={FirstName};middle={MiddleName};last={LastName}&quot;.,java.net.URISyntaxException:Illegal character in query at index 7: ?first={FirstName};middle={MiddleName};last={LastName}
Woden[Error],0:0,WSDL506,Could not create a URI from the string &quot;?first={FirstName};last={LastName}&quot;.,java.net.URISyntaxException:Illegal character in query at index 7: ?first={FirstName};last={LastName}
Woden[Error],0:0,WSDL506,Could not create a URI from the string &quot;?first={FirstName}&quot;.,java.net.URISyntaxException:Illegal character in query at index 7: ?first={FirstName}
Woden[Error],0:0,WSDL506,Could not create a URI from the string &quot;?first={FirstName};middle={MiddleName};last={LastName}&quot;.,java.net.URISyntaxException:Illegal character in query at index 7: ?first={FirstName};middle={MiddleName};last={LastName}
This causes the httplocation of these binding operations to be null. Therefore I cannot get the httplocation for all binding operations. We faced this error when trying to interop using messageTest-2G.
Thanks,
Keith.
Resolve Errors in W3C Test SparqlQuerySimplified-1G
There are 69 errors reported. [1]
[1] http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Woden/SparqlQuerySimplified-1G/sparql-protocol-query.results.xml?content-type=application/xml
Resolve Errors in W3C Test SparqlQuery-1G
There are 81 errors reported [1].
[1] http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Woden/SparqlQuery-1G/sparql-protocol-query.results.xml?content-type=application/xml
Resolve Errors in W3C Test Schema-1G
There are 3 errors reported [1].
[1] http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Woden/Schema-1G/string.results.xml?content-type=application/xml
Resolve Errors in W3C Test MessageTest-2G
There are 63 errors reported. [1]
[1] http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Woden/MessageTest-2G/HTTPservice.results.xml?content-type=application/xml
Generate and Resolve Results for W3C Test LocationTemplate-1G
There are no results published. [1] 
Generate the results and resolve any errors.
[1] http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/results/Interchange.html
MessageTest-1G, Woden lacks support for IRI with variable substitution used by HTTP location
MessageTest-1G contains the XML:
whttp:location=&quot;?op=EchoInt;int={int};&quot;&gt;
This is a valid IRI, but Woden currently handles URIs only so it does not create a URI to represent this value in the model and issues the error message:
Woden[Error],0:0,WSDL506,Could not create a URI from the string &quot;?op=EchoInt;int={int};&quot;.,java.net.URISyntaxException:Illegal character in query at index 16: ?op=EchoInt;int={int};
For HTTP location, a new Woden class is required, instead of java.net.URI. to represent this IRI and handle the variable substitution curly braces syntax described for this property in the Part 2 Adjucts spec. This class could convert the IRI to a URI per the conversion described in RFC 3987 'IRI' (at least, convert the curly braces) then use the URI ctor to check that it is a valid URI, then store it internally in whatever format is appropriate (e.g. seperate fields, string, ...) and expose the IRI via the public methods of this new class. This class probably needs a toString method to return the original IRI string value.
Test Case Failure: test-suite/documents/good/SparqlQuery-1G/sparql-protocol-query.wsdl
This test case uses the SOAP 1.2 binding. Woden is reporting wrong error messages. The document looks OK. Here are the error messages:
Woden[Error],0:0,Binding-0055,The binding 'querySoap' does not define bindings for the interface operation '{http://www.w3.org/2005/08/sparql-protocol-query/#}query'. When a binding specifies an interface it must specify bindings for all of the interfaces operations.
Woden[Error],0:0,BindingFault-0058,The interface fault specified for this binding fault has already been specified on another binding fault. Each binding fault within a binding must specify a unique interface fault.
Test Case Failure: test-suite/documents/good/SchemaId-1G/schemaIds.wsdl
This test is failing because a schema location uses a fragment identifier to refer to a schema located in the same document. The schema parser incorrectly assumes the URL points to a schema document, i.e. it ignores the fragment identifier.
'element' attribute is not treated as OPTIONAL by validator
The 'element' attribute of interface fault and message reference is optional [1], so I tried a test with this attribute missing from an interface &lt;fault&gt;. It caused a NPE in WSDLDocumentValidator.validateInterfaces(..) at the point where it calls testAssertionSchema0016(..). A similar test should be done on interface &lt;input&gt; and &lt;output&gt; (i.e. interface message reference).
[1] http://www.w3.org/TR/2006/CR-wsdl20-20060106/#InterfaceFault_XMLRep
The WSDL used was:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;description xmlns=&quot;http://www.w3.org/2005/08/wsdl&quot;
targetNamespace=&quot;http://greath.example.com/2004/services/updateDetails&quot;
xmlns:tns=&quot;http://greath.example.com/2004/services/updateDetails&quot;
xmlns:details=&quot;http://greath.example.com/2004/schemas/reservationDetails&quot;
xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xsi:schemaLocation=
&quot;http://www.w3.org/2005/08/wsdl http://www.w3.org/2005/08/wsdl/wsdl20.xsd 
http://www.w3.org/2001/XMLSchema http://www.w3.org/2001/XMLSchema.xsd&quot;
&gt;
&lt;documentation&gt;
Test that the 'element' attribute of an interface fault is treated as optional.
&lt;/documentation&gt;
&lt;types&gt;
&lt;xs:schema id=&quot;items&quot;
targetNamespace=&quot;http://greath.example.com/2004/schemas/reservationItems&quot;&gt;
&lt;xs:element name=&quot;confirmationNumber&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;checkInDate&quot; type=&quot;xs:date&quot; /&gt;
&lt;xs:element name=&quot;checkOutDate&quot; type=&quot;xs:date&quot; /&gt;
&lt;xs:element name=&quot;roomType&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;smoking&quot; type=&quot;xs:boolean&quot; /&gt;
&lt;/xs:schema&gt;
&lt;/types&gt;
&lt;interface name=&quot;reservationInterface&quot;&gt;
&lt;fault name=&quot;invalidDataFault1&quot; element=&quot;details:confirmationNumber&quot; /&gt;
&lt;fault name=&quot;invalidDataFault2&quot; /&gt;
&lt;/interface&gt;
&lt;/description&gt;
The stack trace is:
java.lang.NullPointerException
at org.apache.woden.internal.wsdl20.validation.WSDLDocumentValidator.validateInterfaces(WSDLDocumentValidator.java:171)
at org.apache.woden.internal.wsdl20.validation.WSDLDocumentValidator.validate(WSDLDocumentValidator.java:80)
at org.apache.woden.internal.DOMWSDLReader.readWSDL(DOMWSDLReader.java:153)
at jktest.ReadWsdlTest.main(ReadWsdlTest.java:75)
element attr of interface-&gt;input can contain a type and no validation error is reported
This WSDL [1] has the following:
&lt;wsdl:interface name=&quot;EchoInterface&quot;&gt;
&lt;wsdl:operation name=&quot;Echo&quot; pattern=&quot;http://www.w3.org/2005/08/wsdl/in-out&quot;&gt;
&lt;wsdl:input element=&quot;xs:string&quot;/&gt;
&lt;wsdl:output element=&quot;xs:string&quot;/&gt;
&lt;/wsdl:operation&gt;
&lt;/wsdl:interface&gt;
According to the spec [2], the element attribute value must resolve to an element declaration from the element declarations of the Description. xs:string isn't such an element as it is a simple type defined in XML schema [3]
[1] http://dev.w3.org/cvsweb/~checkout~/2002/ws/desc/test-suite/documents/bad/Service-1B/Service.wsdl
[2] http://www.w3.org/TR/2005/WD-wsdl20-20050803/#InterfaceMessageReference_Mapping
[3] http://www.w3.org/2001/XMLSchema.xsd
WicketServlet deprecation and WicketFilter
Hi,
I'm one of the maintainer of ops4j-pax-wicket. Atm, I'm trying to
migrate pax-wicket to wicket-2.0 that can be found at
(https://scm.ops4j.org/repos/ops4j/branches/pax/wicket-2.0).
One of the problem that I found during migration is the fact that
WicketFilter uses reflection to instantiate application factory by
using the FilterConfig.getInitParam( &quot;applicationFactoryClassName&quot; ).
Since this is not advisable in OSGi (Due to problem of ensuring
whoever export the wicket bundle must have it's classloader be able to
load the application factory) and HttpService does not support Filter.
It would be better if the old pattern of WicketServlet is supported.
&lt;code&gt;
public class WicketServlet
{
protected WicketFilter newWicketFilter()
{
return new WicketFilter();
}
public void init()
{
wicketFilter = newWicketFilter();
filter.init(new FilterConfig()
{
...
});
}
}
&lt;/code&gt;
This way, I would be able to override the instantiation of
WicketFilter without having to reimplement my FilterConfig.
For example, my wicket servlet will look like like:
&lt;code&gt;
final class MyWicketServlet extends WicketServlet
{
private final IWebApplicationFactory m_appFactory;
MyWicketServlet( IWebApplicationFactory factory )
{
m_appFactory = factory;
}
protected final WicketFilter newWicketFilter()
{
return new WicketFilter()
{
protected IWebApplicationFactory getApplicationFactory()
{
return MyWicketServlet.this.m_appFactory;
}
};
}
}
&lt;/code&gt;
This way, reflection will not be used anymore in both instantiating
WebApplication (bypassing ContextParamWebApplicationFactory class) and
IWebApplicationFactory.
Regards,
Edward Yakop
Note:
Can we please remove the log.info part to mark WicketServlet is deprecated.
&lt;code&gt;
public WicketServlet()
{
// log warning
log.info(&quot;********************************************&quot;);
log.info(&quot;DEPRECATED! Please use WicketFilter instead.&quot;);
log.info(&quot;********************************************&quot;);
}
&lt;/code&gt;
Reply from Johan Compagner (jcompagner@gmail.com)
We will remove the warnings about the deprication when we will release 1.3/2.0
for now we want to point people as much as possible to the wicket filter.
The wicket servlet will still be there.
So you just want a factory method in wicket servlet where you can make the wicket filter?
can you add a RFE for this:
https://issues.apache.org/jira/secure/IssueNavigator.jspa?reset=true&amp;mode=hide&amp;pid=12310561&amp;sorter/order=DESC&amp;sorter/field=priority&amp;resolution=-1&amp;component=12311420
then i will add the factory method asap.
johan
[Patch] NPE if FilterPath is null
In our application, filter path is null so an NPE is threw in WebRequestCodingStrategy
Palette tries to initialize values in constructor
When using a CompoundPropertyModel, the model is defined in the parent widgets. However Palette tries to initialize its values in the constructor. See patch attached. Note that the model is read in onAttach() already.
http://foo/app/ doesn't work, but http://foo/app does, with WicketFilter.
As summary.
ChuckDeal's take on it is this:
When tracing through the WicketFilter code, it looks like isWicketRequest() can't deal with it so it delegates to webApplication.getRequestCycleProcessor().getRequestCodingStrategy().urlCodingStrategyForPath(path) which returns null because it specifically excludes the '/'. You can't mount '/' because mount(...) will throw IllegalArgumentException(&quot;The mount
path '/' is reserved for the application home page&quot;). Is this a loophole, or have I missed something.
WicketFilter doesn't work with mod_proxy and setContextPath()
If one sets up mod_proxy as here: http://cwiki.apache.org/WICKET/wicket-behind-a-front-end-proxy.html (see &quot;why this doesn't always work&quot;) isWicketRequest() in WicketFilter always returns false.
ajax requests increment page version
Ajax requests increase page version. Johan promised to fix this soon. here's the incentive!
Fixing AjaxTimerBehaviorTest
This is an attempt to fix failing testcase:
target/surefire-reports/wicket.ajax.AjaxTimerBehaviorTest.txt
-------------------------------------------------------------------------------
Test set: wicket.ajax.AjaxTimerBehaviorTest
-------------------------------------------------------------------------------
Tests run: 2, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 0.113 sec &lt;&lt;&lt; FAILURE!
testAddToAjaxUpdate(wicket.ajax.AjaxTimerBehaviorTest) Time elapsed: 0.063 sec &lt;&lt;&lt; FAILURE!
junit.framework.AssertionFailedError: There should be 1 and only 1 script in the markup for this behavior,but 0 were found exp
ected:&lt;1&gt; but was:&lt;0&gt;
at junit.framework.Assert.fail(Assert.java:47)
at junit.framework.Assert.failNotEquals(Assert.java:282)
at junit.framework.Assert.assertEquals(Assert.java:64)
at junit.framework.Assert.assertEquals(Assert.java:201)
at wicket.ajax.AjaxTimerBehaviorTest.validateTimerScript(AjaxTimerBehaviorTest.java:178)
at wicket.ajax.AjaxTimerBehaviorTest.validate(AjaxTimerBehaviorTest.java:143)
at wicket.ajax.AjaxTimerBehaviorTest.testAddToAjaxUpdate(AjaxTimerBehaviorTest.java:99)
testAddToWebPage(wicket.ajax.AjaxTimerBehaviorTest) Time elapsed: 0.026 sec &lt;&lt;&lt; FAILURE!
junit.framework.AssertionFailedError: There should be 1 and only 1 script in the markup for this behavior,but 0 were found exp
ected:&lt;1&gt; but was:&lt;0&gt;
at junit.framework.Assert.fail(Assert.java:47)
at junit.framework.Assert.failNotEquals(Assert.java:282)
at junit.framework.Assert.assertEquals(Assert.java:64)
at junit.framework.Assert.assertEquals(Assert.java:201)
at wicket.ajax.AjaxTimerBehaviorTest.validateTimerScript(AjaxTimerBehaviorTest.java:178)
at wicket.ajax.AjaxTimerBehaviorTest.validate(AjaxTimerBehaviorTest.java:155)
at wicket.ajax.AjaxTimerBehaviorTest.testAddToWebPage(AjaxTimerBehaviorTest.java:127)
The attached patch properly handles the case when the callback script is added in body onload. Also, AbstractAjaxTimerBehavior needs to handle AjaxRequestTarget properly, because adding a body onload has no effect in an ajax request.
WicketFilter fails for filter mapping /* and non-root context
The problem happens:
* With servlet context path /something
* With filter mapping /*
* Without any filterPath init parameter declared
In this case Wicket returns a 404 error.
The attached patch fixes the problem. Thanks in advance!
Undo of page with ajax requests gives exception with backbutton
Ajax together with ListView gives exceptions when the backbutton is pressed (this is the hypothesis):
[2007-01-10 11:34:28,985] [TP-Processor20] RequestCycle.step(1059) | Cannot remove [MarkupContainer [Component id = 3, page = &lt;No Page&gt;, pat
h = 3.ListItem]] from null parent!
java.lang.IllegalStateException: Cannot remove [MarkupContainer [Component id = 3, page = &lt;No Page&gt;, path = 3.ListItem]] from null parent!
at wicket.Component.remove(Component.java:1464)
at wicket.version.undo.Add.undo(Add.java:80)
at wicket.version.undo.ChangeList.undo(ChangeList.java:92)
at wicket.version.undo.UndoPageVersionManager.undo(UndoPageVersionManager.java:216)
at wicket.version.undo.UndoPageVersionManager.getVersion(UndoPageVersionManager.java:166)
at wicket.Page.getVersion(Page.java:604)
at wicket.protocol.http.SecondLevelCacheSessionStore$SecondLevelCachePageMap.get(SecondLevelCacheSessionStore.java:82)
at wicket.Session.getPage(Session.java:518)
at wicket.request.compound.DefaultRequestTargetResolverStrategy.resolveRenderedPage(DefaultRequestTargetResolverStrategy.java:220)
at wicket.request.compound.DefaultRequestTargetResolverStrategy.resolve(DefaultRequestTargetResolverStrategy.java:163)
at wicket.request.compound.AbstractCompoundRequestCycleProcessor.resolve(AbstractCompoundRequestCycleProcessor.java:47)
at wicket.RequestCycle.step(RequestCycle.java:1008)
at wicket.RequestCycle.steps(RequestCycle.java:1100)
at wicket.RequestCycle.request(RequestCycle.java:454)
at wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:243)
at wicket.protocol.http.WicketServlet.doGet(WicketServlet.java:136)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:689)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:199)
at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:282)
at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:754)
at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:684)
at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:876)
at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)
at java.lang.Thread.run(Thread.java:595)
SelectMultiple cannot be used with SelectOption
SelectOption checks its hieararchy for Select but SelectMultiple does not extend Select
mounted URLs fail if filterPath is blank
The path in RequestParameters needs to begin with a &quot;/&quot; or it will not be found when checking against mounted paths. The slash is prefixed in WicketFilter line 545 when checking isWicketRequest(), but it is not prefixed later when looking for the request target. Proposed fix in patch (to be attached) performs this operation in ServletWebRequest.getPath(); I'm not sure if that is the ideal spot, but I've confirmed that it fixes the problem.
fix dependency list in jar-dependencies.xml
xdocs/docs/jar-dependencies.xml is inconsistent with
xdocs/docs/build.xml. Specifically the list of dependencies is
missing antlr and junit.
add notes on jar upgrade to README
We should highlight changes in the jar dependencies. Even though this occurred Velocity 1.4 -&gt; 1.5, it would still be useful notes for user's upgrading. Suggested text:
This release is a drop-in replacement for earlier versions of
Velocity. No changes to your application should be required other than
changes to the dependent jar files. 
When upgrading from Velocity 1.3, these jar file requirements have been changed
* JDOM has been upgraded to 1.0
* Commons Collection has been upgraded to 3.1
* Commons Lang 2.1 has been added
In addition,
* Ant 1.6 or greater is required for building.
* Java CC 3.2 or greater is now required for compiling parser files.
* HSQLDB 1.7.1 is required for running unit tests.
Method arguments are evaluated twice
Method arguments are evaluated twice in ASTMethod - no apparent reason.
Building Velocity on JDK 1.3.1 throws java.lang.ClassCircularityError
VelTTools66TestCase throws a ClassCircularityError when building Velocity 1.5 beta 2 on JDK 1.3.1
Testcase: testVelTools66 took 0.202 sec
Caused an ERROR
org/apache/velocity/test/issues/VelTools66TestCase$TestObject
java.lang.ClassCircularityError: org/apache/velocity/test/issues/VelTools66TestCase$TestObject
at java.lang.Class.forName0(Native Method)
at java.lang.Class.forName(Class.java:115)
at org.apache.velocity.test.issues.VelTools66TestCase$TestSecurityManager.class$(VelTools66TestCase.java:89)
at org.apache.velocity.test.issues.VelTools66TestCase$TestSecurityManager.checkMemberAccess(VelTools66TestCase.java:120)
at java.lang.Class.checkMemberAccess(Class.java:1332)
at java.lang.Class.newInstance(Class.java:230)
at sun.io.Converters.newConverter(Converters.java:115)
at sun.io.Converters.newDefaultConverter(Converters.java:206)
at sun.io.CharToByteConverter.getDefault(CharToByteConverter.java:50)
at java.lang.String.getBytes(String.java:751)
at java.io.UnixFileSystem.getBooleanAttributes0(Native Method)
at java.io.UnixFileSystem.getBooleanAttributes(UnixFileSystem.java:114)
at java.io.File.exists(File.java:543)
at sun.misc.URLClassPath$FileLoader.getResource(URLClassPath.java:780)
at sun.misc.URLClassPath.getResource(URLClassPath.java:133)
at java.net.URLClassLoader$1.run(URLClassLoader.java:187)
at java.security.AccessController.doPrivileged(Native Method)
at java.net.URLClassLoader.findClass(URLClassLoader.java:183)
at java.lang.ClassLoader.loadClass(ClassLoader.java:294)
at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:288)
at java.lang.ClassLoader.loadClass(ClassLoader.java:250)
at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:310)
at java.lang.Class.forName0(Native Method)
at java.lang.Class.forName(Class.java:115)
at org.apache.velocity.test.issues.VelTools66TestCase$TestSecurityManager.class$(VelTools66TestCase.java:89)
at org.apache.velocity.test.issues.VelTools66TestCase$TestSecurityManager.checkMemberAccess(VelTools66TestCase.java:120)
at java.lang.Class.checkMemberAccess(Class.java:1332)
at java.lang.Class.getMethod(Class.java:882)
RuntimeInstance.getProperty() should check overridingProperties when not yet initialized
For consistency, RuntimeInstance.getProperty() should return the values previously set with setProperty() event when it hasn't already been initialized.
runtimeInstance.setProperty(&quot;foo&quot;,&quot;bar&quot;);
System.out.println(runtimeInstance.getProperty(&quot;foo&quot;)); // output &quot;null&quot;
runtimeInstance.init();
System.out.println(runtimeInstance.getProperty(&quot;foo&quot;)); // output &quot;bar&quot;
#set not parsed in #macro
#set statements are not being parsed in #macros in VM_global_library.
Worked in 1.3.1, doesn't in 1.4.
I'm going to attach the #macro and the diff'd 1.3.1 vs 1.4 output.
-Mike
bold italics highlighting does not work in code sections of the html documentation
The bold italics highlighting in code sections does not work in HTML document. The same section in the pdf documentation looks fine. 
E.g. search for &quot;CATALINA&quot; in the tutorials_and_users_guides and see the next xml fragment code section. Within this section there should be some
highlights but they are not displayed correctly in the HTML document.
ClassNotFoundException for org.apache.uima.adapter.ServiceDataCargo when SOAP service should be deployed
ClassNotFoundException for org.apache.uima.adapter.ServiceDataCargo when SOAP service should be deployed
Drop &quot;XCAS&quot; from name of Annotation Viewer GUI
This was done in the docs, but not in the code. The &quot;XCAS&quot; part doesn't make much sense as it also supports the XMI format, which is preferred.
CPE GUI on exit says settings have been changed even when they haven't
Open the CPE GUI. Click in one of the text fields to move the focus. Then close the GUI. It will tell you that the parameter settings have changed and ask if you want to save the CPE descriptor. It seems that even moving the focus is enough to cause the GUI to be marked dirty.
CAS Multiplier &quot;internal&quot; CASes should have identical type system to CPE CAS Pool
Currently the type systems are not identical and so Type and Feature handles can't be shared in a CAS Multiplier, which is very inconvenient.
See http://www.mail-archive.com/uima-dev@incubator.apache.org/msg01670.html
I'll see if this is easy enough to fix in 2.1.
CAS View caching works incorrectly
The CASImpl retains references to CAS views in its sofa2tcasmap field, across calls to CAS.reset. However, during the CAS.reset, the view's mySofaRef is seto to 0. So the next time someone calls getView(Sofa), the Sofa is looked up in the sofa2tcasmap, and since there is a view there, it is retrieved from the map and returned to the caller. But the View now has a null Sofa and will not work properly.
CPEGUI clearAll doesn't reset file chooser directory consistently
If the first thing you do after launching the CPE GUI is File - Clear All, it doesn't reset the collection reader file chooser to its default state like it is supposed to.
CPE GUI sometimes won't start if JList widgets are in use
There's a race condition that can cause a NullPointerException on startup of the CPE GUI. The GUI loads the last known CPE descriptor and attempts to populate the GUI. If there are JList widgets needed (for multi-valued parameters) you can sometimes get a NullPointerException in javax.swing.plaf.basic.BasicListUI.updateLayoutState. Sometimes this error prevents the CPE GUI from starting (other times it is just printed on the console).
Swing isn't thread-safe and I think we aren't doing proper synchronization here.
Bad error message if aggregate descriptor flow contains undefined key
If an aggregate descriptor's &lt;fixedFlow&gt; references a delegate key that's not defined anywhere, you get a NullPointerException instead of a helpful error message.
org.apache.uima.analysis_engine.AnalysisEngineProcessException
at org.apache.uima.analysis_engine.asb.impl.ASB_impl$AggregateCasIterator.processUntilNextOutputCas(ASB_impl.java:574)
at org.apache.uima.analysis_engine.asb.impl.ASB_impl$AggregateCasIterator.&lt;init&gt;(ASB_impl.java:393)
at org.apache.uima.analysis_engine.asb.impl.ASB_impl.process(ASB_impl.java:326)
at org.apache.uima.analysis_engine.impl.AggregateAnalysisEngine_impl.processAndOutputNewCASes(AggregateAnalysisEngine_impl.java:259)
at org.apache.uima.analysis_engine.impl.AnalysisEngineImplBase.process(AnalysisEngineImplBase.java:202)
at org.apache.uima.collection.impl.cpm.engine.ProcessingUnit.processNext(ProcessingUnit.java:1221)
at org.apache.uima.collection.impl.cpm.engine.ProcessingUnit.run(ProcessingUnit.java:668)
Caused by: java.lang.NullPointerException
at org.apache.uima.flow.impl.FixedFlowController$FixedFlowObject.next(FixedFlowController.java:181)
at org.apache.uima.analysis_engine.asb.impl.FlowContainer.next(FlowContainer.java:83)
at org.apache.uima.analysis_engine.asb.impl.ASB_impl$AggregateCasIterator.processUntilNextOutputCas(ASB_impl.java:506)
... 6 more
Distribution docs directory includes XXX_pdf_src.xml files
These are intermediate files and should not be included.
In uimaj-examples some resource files are under src/main/java instead of src/main/resources
Because of this they aren't copied to the examples directory of our distribution, or included in uima-examples.jar. The corresponding example annotators then fail to run.
JAR file name changes not mentioned in documentation or handled by migration script
We changed the jar file names (e.g. uima_core.jar -&gt; uima-core.jar), but this is not mentioned in the migration chapter of the documentation and the migration tool doesn't handle it. It would not be difficult to add this to the set of replacements that the migration tool does, and it would save users some trouble if we can migrate their script files and such things automatically.
JavaDoc is not being built
For some reason no JavaDocs are being built when I execute mvn assembly:assembly
adjustExamplePaths.sh has incorrect jar file names in classpath
needs to be uima-core.jar, not uima_core.jar. The .bat file was updated but the.sh was missed.
DocumentAnalyzer shouldn't have to re-contact service to get the typesystem
Currently when running a remote AE in the Document Analyzer, after anlaysis is complete but before the analysis results window is launched, the service is re-contacted to obtain its type system. In some situations this can be a noticeable delay. It would be better if the DocumentAnalyzer could &quot;remember&quot; the
type system that was obtained earlier.
DocumentAnalyzer/RunAE tools don't support XML detagging and Remote Vinci AEs
It generates invalid XCASes as output if you try to do this. This is because Sofa mapping is used to do XML detagging, but Sofa mapping isn't implemented correctly for Vinci services (in fact it seems completely broken now). Anyway it is slated to be completely removed for v2.1 (see UIMA-122).
It may be possible to do Sofa mapping differently so that the detagged text is stored in the _InitialView, so that Sofa mapping isn't needed for the remote. Failing that, we'd just need to put in a better error message until such time as we implement Sofa mapping for remotes in a reliable way.
FeatureStructure.equals returns false for same FS obtained through different views
This is because the implementation of FeatureStructure.equals checks that the FS are both pointing to the same CAS object. But the CAS reference of an FS is currently being set to whichever view that FS was created off of. So if you obtain a reference to an FS through two different views, equals() will always return false because the CAS references don't match. This broke the CasCopier utility which relies on equals() to work correctly.
I will attach a simple patch for the SofaTest testcase that demonstrates the problem.
Documentation errors
Reported by User:
Javadocs for createView say:
Create a view and its underlying Sofa (subject of analysis). The view provides access to the Sofa data and the index repository that contains metadata (annotations and other feature structures) pertaining to that Sofa. 
presumably should say only the view is created ... the Sofa must be added with one of the setSofa... calls. 
(Adam: I think the Sofa FS is created, but the data is not set. This could be clearer.)
In section 6.2.7 of the SDK UG there is an example of createView with a 2nd arg of mime-type &amp; an unsupported createDefaultTextView
CAS casView = cas.createView(&quot;mySofaName&quot;, mime-type);
// (OR)
CAS casView = cas.createDefaultText View();
setSofaDataXXX(xxx, mime) methods do not set sofa mime feature
Reported by user. Methods such as setSofaDataString(text, mime) do not set the Sofa mime feature.
AnalysisEngineDescription.getDelegateAnalysisEngineSpecifiers() should only resolve delegate imports, not other imports
Currently this is resolving all imports in the aggregate, which doesn't make sense and is causing trouble in the CDE.
Excessive releases of CAS on error in Aggregate CasMultiplier
Careful checking of the log file for AnalysisEngine_implTest shows that there are &quot;CAS returned to pool from which it was not checked out&quot; warnings that are logged by the unit tests that check error conditions. This is because CAS.release() is being called multiple times on the same CAS, which should not happen.
JMX Support has problems with AE names containing special characters (e.g. commas)
JMX MBean registration fails, logging a warning message, if an AE &lt;name&gt; contains a comma or other characters prohibited by JMX (comma, quote, question mark, asterisk, or backslash).
Our unit tests expose this error and log &quot;JMX registration failed&quot; messages.
CPE Test Cases fail when run with &quot;mvn test&quot;
There are tests in cpm, which only fail with
&gt; mvn test
but not with
&gt; mvn install
Or when run from Eclipse.
The failing tests are:
org.apache.uima.collection.impl.CollectionProcessingEngine_implTest
org.apache.uima.collection.impl.cpm.SofaCPE_SofaUnawareCC_Test
org.apache.uima.collection.impl.cpm.SofaCPE_Test
org.apache.uima.collection.impl.cpm.SofaMixedCPE_Test
TypePriorityTest.testMain() fails with Sun Java 1.6
Type priorities come out wrong with Java 1.6.
IteratorTest.testIterator() fails with Sun Java 1.6
Logging test fails when logger properties file and log file are specified for unit tests
Not sure this is a bug, but it would be nice if it could be fixed. I'm trying to run our test cases with logging to a file instead of a console, so I don't get deluged with logging info. When I specify, for example, -Djava.util.logging.config.file=../uimaj-distr/src/main/properties/Logger.properties -Djava.util.logging.config.file=uima.log, JSR47Logger_implTest.testIsLoggable() fails with a NullPointerException.
PEAR Encoding Test gives NullPointerException under Sun Java 1.4.2
java.lang.NullPointerException
at org.apache.uima.pear.util.PearEncodingTest.testUTF8WithSignature(PearEncodingTest.java:54)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128)
at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)
Schema validation doesn't work with Sun Java 1.4, causes fatal error.
This is caught by the unit tests when run under Sun Java 1.4.2. This exception is reported:
org.apache.uima.util.InvalidXMLException: Invalid descriptor at file:/C:/alally/dev/workspace_apache/uimaj-core/target/test-classes/TypePrioritiesImplTest/SimpleTypePriorities.xml.
at org.apache.uima.util.impl.XMLParser_impl.parse(XMLParser_impl.java:183)
at org.apache.uima.util.impl.XMLParser_impl.parseTypePriorities(XMLParser_impl.java:663)
at org.apache.uima.util.impl.XMLParser_impl.parseTypePriorities(XMLParser_impl.java:651)
at org.apache.uima.resource.metadata.impl.TypePriorities_implTest.testBuildFromXmlElement(TypePriorities_implTest.java:66)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128)
at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)
Caused by: org.xml.sax.SAXNotRecognizedException: Feature: http://apache.org/xml/features/validation/schema
at org.apache.crimson.parser.XMLReaderImpl.setFeature(XMLReaderImpl.java:219)
at org.apache.uima.util.impl.XMLParser_impl.parse(XMLParser_impl.java:143)
... 21 more
CDE: adding feature value type in default namespace does not work correctly
When adding a feature in the type system editor, try choosing a type in the default (i.e., empty) namespace. The type will be added with a leading period. Seems like the code does not check for the empty namespace.
Type priority test case failing with IBM JDK 1.5
The reason the test case fails seems to be due to the incorrect setup of the test case. The way the test is set up, the type priority sort order is initialized more than once, resulting in erratic behavior.
Maven building on *nix platforms including Mac OS X broken in several ways
There are many places where there is a specification for the &quot;current&quot; directory, specified as &quot;/&quot;. This apparently works on Windows, but on *nix it goes to the root directory. A fix which might work is to change these to &quot;./&quot;.
The maven build is setting the permissions of the jar files strangely, maybe. The evidence: on a Mac platform, run the build, then look at the uima-runtime plugin: unzip it using the built-in Mac tool for this. The resulting files have permissions set as follows:
--w----r-T
This makes Eclipse not able to load the jar classes. When changed to the normal -rw-r--r--, Eclipse works.
I have not confirmed that Maven is at fault here - it could be the unzipper program - not sure how this all works on a Mac.
AnalysisEngine_implTest incorrectly failing on PowerMac platform
The uima core AnalysEngine_implTest has this code in it:
// test that CAS Consumer ran
File outFile = JUnitExtension.getFile(&quot;CpmOutput.txt&quot;);
assertTrue(outFile.lastModified() &gt;= startTime);
On the PowerMac platform, this test fails (but not in &quot;debug&quot; Eclipse running !). It fails because the lastModified() always returns 000 as the least significant digits of the time, whereas the starTime is apparantly accurate to all significant digits.
Need to come up with a more robust way to determine the CAS Consumer ran.
getSofaDataString() is documented in the manual but does not exist in the code
It's exactly equivalent to getDocumentText() but I would vote to add it for consistency.
AnalysisEngine.setResultSpecification doesn't clear out previously cached result specification information
Problem exposed by this line in AnalysisEngine_implTest, previously commented out:
// TODO: resultSpec not supported assertEquals(resultSpec, TestAnnotator.lastResultSpec);
Need JCAS fixes for DocumentatAnnotation and type merging
The current build has the DocumentAnnotation JCas cover class in uima-core.jar. This creates a problem for anyone who has added features to this type and run JCasGen.
Fixes as suggested by Marshall and agreed by Adam:
&gt; a) Do the work to make it easy to get singletons (or whatever we're
&gt; calling this feature) out of the CAS
&gt;
&gt; b) Change JCasGen to not generate DocumentAnnotation if the merged
&gt; version = the base
&gt;
&gt; c) Add the DocumentAnnotation jar back to the build, with instructions
&gt; to remove it from the
&gt; deployment and substitute a JCasGenerated one if the application needs a
&gt; special one.
CpeCasProcessors.removeCasProcessor always throws &quot;invalid index&quot; exception
I think there's a missing &quot;else&quot; in this code :-)
public void removeCpeCasProcessor(int aPosition) throws CpeDescriptorException {
if (aPosition &lt;= casProcessors.size()) {
casProcessors.remove(aPosition);
}
throw new CpeDescriptorException(CpmLocalizedMessage.getLocalizedMessage(
CPMUtils.CPM_LOG_RESOURCE_BUNDLE, &quot;UIMA_CPM_EXP_invalid_array_index__WARNING&quot;,
new Object[] { Thread.currentThread().getName() }));
}
DocBook formatting fixes - style sheets and CSS wrong for table centering, plus fixes for CVD
The CVD doc conversion found multiple problems with figures. Some of these were traced to incorrect CSS and XSL-FO customization layers. Fix these to properly center tables and figures.
Also careful checking showed line space slightly off - change from 1.4 to 1.35. 
Also - specify the width parameter on the CVD Jpegs so the width for html is the same as specifying no-widths; this causes the PDFs to be reasonably sized.
DebugFSLogicalStructure - fix cache setting for Unexpanded Feature Structures (found by Findbugs)
Findbugs found cache value never being set in DebugFSLogicalStructure.The &quot;items&quot; field of Unexpanded FeatureStructures inner class was only ever set to null.
Calls to URL.equals and URL.hashCode should be removed
Marshall wrote:
Findbugs has just been updated to find additional issues- the current
version is 1.1.3.
One of the new things it finds is uses of java.net.URL.equals(...) and
hashCode(). It turns out
these methods make blocking calls to DNS services on the internet.
See:
http://michaelscharf.blogspot.com/2006/11/javaneturlequals-and-hashcode-make.html
JCas version of getLocalFSData() returning wrong type
The Sofa method getLocalFSData() returns a CAS Array of primitive CAS types like integers, bytes, etc. But the return value for this method in the JCas is FSArray - which is an array of Feature Structures. Change this to return FeatureStructure (a supertype of TOP).
Example MeetingFinderCPE_withXmlDetagging.xml doesn't work
Reported by user on alphaWorks forum:
I recently started working with UIMA and have still some problems especially with one Collection Processing Engine, that was provided with UIMA examples. 
The CPE's name is MeetingFinderCPE_WithXmlDetagging. I haven't yet changed anything about the Java or XML code and it seems to me there is an error which originates either from distribution incompabilities or maybe there is an error in some part of the code. 
I keep receiving an error message that reads:
com.ibm.uima.analysis_engine.AnalysisEngineProcessException: Annotator processing failed. 
Caused by: CASRuntimeException: No sofaFS with name xmlDocument found.
As I have only found a bad solution to this problem, it would be great if someone might take care of it, especially since it is an example that is not mentioned in the tutorial. 
-----------------------------------------------------------------------------
Adam:
There are two issues: 
(a) The CPE GUI doesn't support sofaMappings at all.
(b) The example descriptor tried to supply a CollectionReader sofa Mapping that mapped the Collection Reader's initialView to a CPE Sofa called &quot;rawDocument&quot;. This isn't supported - it results in an error saying &quot;rawDocument&quot; is not found before the CollectionReader is even called. Should this be supported?
Sofa mapping should be removed from Vinci services
Sofa mapping for services is only implemented for Vinci services connected via the aggregate engine code path. Mapping is not implemented for Vinci services connected via the CPM, nor for all other [binary-CAS] connected services. This inconsistency is confusing for users and developers.
There is a good work-around for services which do not have Sofa mapping in the communication path: implement the Sofa mapping in an aggregate descriptor on the service side.
Also, there is a problem with the current Sofa mapping code if multiple &quot;Default&quot; Sofas are involved. Instead of fixing this bug, better would be to remove the code altogether and implement Sofa mapping for all services in a consistent way, along with configuration parameters.
CVD Help-&gt;Manual menu item gives &quot;invalid url&quot; error dialog.
The TCAS class should be dropped
The introduction of multiples views per CAS was initially implemented using the CAS interface for the base CAS and the TCAS interface for all views. Process method signatures for both TCAS and CAS were proprogated, and the result was a complicated situation for users.
In v2 the entire TextAnalysisEngine interface is deprecated. The TCAS no longer serves a useful purpose. Since Apache UIMA requires some source code changes, now is a good time to eliminate the TCAS. Migration for almost all user code would be to replace TCAS with CAS and getTCAS() with getView(). This change has already been applied to the upcoming uima C++ code.
CDE incorrect tooltip for configuration parameter value field
The tooltip that's displayed when you hover over the &quot;Value&quot; field on the Configuration Parameter Settings page always says &quot;Use the combo pulldown to select either true or false&quot;, even for non-boolean parameter types.
Example: Open PersonTitleAnnotator.xml in the CDE, go to the Parameter Settings page, and select the &quot;Containing Annotation Type&quot; parameter from the list at the left. Hover the mouse over the &quot;Value&quot; field at the top right.
CDE's &quot;Find AE&quot; Dialog does not work on Mac.
On the CDE's Aggregate page, in the Find AE dialog, the use selected a descriptor and clicked OK. The dialog closed but the selected AE was not added to the aggregate. Appears to occur only on a Mac.
feature values containing &quot;&lt;&gt;&quot; are not displayed correctly in CVD
feature value containing &quot;&lt;&gt;&quot; are not displayed correctly in CVD. 
For example, a String feature value &quot;&lt;ALPHANUM&gt;&quot; is displayed as &quot;&quot; in CVD.
[SDO for C++] setCString is inconsistent when assigning data type
The various setCString methods are inconsistent in assigning a type to the value that they create. If adding a value to a property that has a definition, then the assigned type is &quot;String&quot;, however if adding a value to an undefined property (ie adding cointent to an open property) the assigned type is &quot;Bytes&quot; ie a fixed length string. The code works in both cases, however the inconsistency complicates the solution to TUSCANY-547.
ReadMe on how to write SCA Integration Test Cases
A ReadMe on how to write SCA Integration Test Cases. 
Per request from Raymond, I have created this readme. It is in the same style as the readme for GettingStarted on Tuscany. This readme is currently stored in tuscany/java/testing/sca/itest dir. If you would change the location of the readme while committing, then please make changes to the following code in the source so that the format is mainted.
@import url(&quot;../../../javadoc/css/maven-base.css&quot;);
@import url(&quot;../../../javadoc/css/maven-theme.css&quot;);
@import url(&quot;../../../javadoc/css/site.css&quot;);
&lt;/style&gt;
&lt;link href=&quot;../../../javadoc/css/print.css&quot; media=&quot;print&quot;
Grovvy classloader is not being initialized correctly
Per antelder said in mail listing, the detailed info this issue is below:
In the GroovyComponentBuilder the ClassLoader from the DeploymentContext is
the wrong one to be using, its null as we have seen. It really wants the
application ClassLoader which is available in the DeploymentContext passed
into the load method of the ImplementationLoader class in the Groovy
package. I think what needs to happen is GroovyImplementation should have a
ClassLoader field added with getter/setters, the
ImplementationLoader.loadmethod should set the Classloader on the
GroovyImplementation from the
DeploymentContext, then the GroovyComponentBuilder should create the
GroovyClassLoader using the ClassLoader from the GroovyImplementation (the
implementation variable) instead of the DeploymentContext.
I am trying to provide a draft patch here, the related java source code is here:
1.ImplementationLoader.java : add two fields with getter/setters.
applicationLoader, this will be used for construct GroovyClassloader
scriptResourceName, this is script resource name, will be used for generate side file name (componentType)
2. ImplementationLoader.loader()
add following statement:
implementation.setApplicationLoader(deploymentContext.getClassLoader());
implementation.setScriptResourceName(script);
3. GroovyComponentBuilder.build
groovyClassLoader = new GroovyClassLoader(implementation.getApplicationLoader());
4. GroovyComponentType.java
Adding two constructor method , it is similar with what did in javaScriptComponentType
5. GroovyComponentTypeLoader.java
adding sild file(ComponentType) support, just like what we have in JavaScript.
TODO: i did not implement &quot;loadFromIntrospection&quot; now, I am not sure whether it will use the same logic as javaScript. So mark it as TODO section in this patch now.
6. GroovyComponentTypeLoaderTestCase
enhancement due to corresponding modification above.
NPE in MemoryStore.insertRecord() when @SCOPE(&quot;CONVERSATION&quot;)
r494421
test-CallBackSetCallbackConv
- This test attempts to use @Scope(&quot;CONVERSATION&quot;). Upon launch of test case using integration test environment the 
following NPE occurs. 
-------------------------------------------------------------------------------
Test set: org.apache.tuscany.sca.test.CallBackSetCallbackConvITest
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.02 sec &lt;&lt;&lt; FAILURE!
testCallBackSetCallback(org.apache.tuscany.sca.test.CallBackSetCallbackConvITest) Time elapsed: 0.01 sec &lt;&lt;&lt; ERROR!
java.lang.NullPointerException
at java.util.concurrent.ConcurrentHashMap.hash(ConcurrentHashMap.java:172)
at java.util.concurrent.ConcurrentHashMap.containsKey(ConcurrentHashMap.java:760)
at org.apache.tuscany.core.services.store.memory.MemoryStore.insertRecord(MemoryStore.java:110)
at org.apache.tuscany.core.component.scope.ConversationalScopeContainer.getInstance(ConversationalScopeContainer.java:92)
at org.apache.tuscany.core.implementation.PojoAtomicComponent.getTargetInstance(PojoAtomicComponent.java:122)
at org.apache.tuscany.core.implementation.java.JavaTargetInvoker.getInstance(JavaTargetInvoker.java:127)
at org.apache.tuscany.core.implementation.java.JavaTargetInvoker.invokeTarget(JavaTargetInvoker.java:75)
at org.apache.tuscany.spi.extension.TargetInvokerExtension.invoke(TargetInvokerExtension.java:67)
at org.apache.tuscany.core.wire.InvokerInterceptor.invoke(InvokerInterceptor.java:44)
at org.apache.tuscany.spi.wire.AbstractInboundInvocationHandler.invoke(AbstractInboundInvocationHandler.java:45)
at org.apache.tuscany.core.wire.jdk.JDKInboundInvocationHandler.invoke(JDKInboundInvocationHandler.java:122)
at $Proxy22.run(Unknown Source)
at org.apache.tuscany.sca.test.CallBackSetCallbackConvITest.testCallBackSetCallback(CallBackSetCallbackConvITest.java:12)
NPE with Pass By Value Interceptor during multiple callbacks
r494421 - NullPointerException is thrown by PassByValueInterceptor when processing the 2 nd of 3 callbacks. A multiple callbacks issue was fixed in JIRA-976 and this integration testcase was functioning. This issue that is now occurring appears to be completely different than -976. Please see the testcase attached to -976 to reproduce. 
.apache.org/repo/m2-incubating-repository/)
Downloading: http://ws.zones.apache.org/repository/woodstox/poms/wstx-asl-3.0.1.
pom
[WARNING] Unable to get resource from repository apache.ws.m1.snapshots (http://
ws.zones.apache.org/repository)
Downloading: http://repo1.maven.org/maven2/woodstox/wstx-asl/3.0.1/wstx-asl-3.0.
1.pom
[WARNING] Unable to get resource from repository central (http://repo1.maven.org
/maven2)
[INFO] [tuscany-itest:start {execution: start}]
[INFO] Starting Tuscany...
[INFO] [tuscany-itest:test {execution: test}]
[INFO] Executing tests...
CallBackBasicServiceImpl message received: Knock Knock
Entering callback callBackMessage: Who's There
CallBackBasicServiceImpl message received: No Reply Desired
CallBackBasicServiceImpl No response desired
java.lang.NullPointerException
at org.apache.tuscany.core.databinding.impl.PassByValueInterceptor.copy(
PassByValueInterceptor.java:110)
at org.apache.tuscany.core.databinding.impl.PassByValueInterceptor.invok
e(PassByValueInterceptor.java:71)
at org.apache.tuscany.core.wire.NonBlockingBridgingInterceptor$1.run(Non
BlockingBridgingInterceptor.java:79)
at org.apache.tuscany.core.services.work.jsr237.Jsr237WorkScheduler$Jsr2
37Work.run(Jsr237WorkScheduler.java:212)
at org.apache.tuscany.core.services.work.jsr237.workmanager.ThreadPoolWo
rkManager$DecoratingWork.run(ThreadPoolWorkManager.java:206)
CallBackBasicServiceImpl message received: Call me back 3 times
Entering callback increment: Who's There 1
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExec
utor.java:665)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor
.java:690)
at java.lang.Thread.run(Thread.java:797)
[INFO] Test results: {skipped=0, completedCount=1, failures=1, errors=0}
[INFO] ------------------------------------------------------------------------
[ERROR] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] There were test failures
[INFO] ------------------------------------------------------------------------
[INFO] Trace
org.apache.maven.BuildFailureException: There were test failures
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(Defa
ultLifecycleExecutor.java:555)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalWithLi
fecycle(DefaultLifecycleExecutor.java:475)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoal(Defau
ltLifecycleExecutor.java:454)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalAndHan
dleFailures(DefaultLifecycleExecutor.java:306)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeTaskSegmen
ts(DefaultLifecycleExecutor.java:273)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.execute(DefaultLi
fecycleExecutor.java:140)
at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:322)
at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)
at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:615)
at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)
at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)
at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)
at org.codehaus.classworlds.Launcher.main(Launcher.java:375)
Caused by: org.apache.maven.plugin.MojoFailureException: There were test failure
s
at org.apache.tuscany.sca.plugin.itest.TuscanyITestMojo.execute(TuscanyI
TestMojo.java:80)
at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPlugi
nManager.java:412)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(Defa
ultLifecycleExecutor.java:534)
... 16 more
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 37 seconds
[INFO] Finished at: Wed Jan 10 09:43:18 EST 2007
[INFO] Final Memory: 10M/23M
[INFO] ------------------------------------------------------------------------
C:\Tuscany\LousTestCases\testing\sca\itest\test-CallBackBasic&gt;
mvn dependency:unpack not working for Standalone SCA samples
I'm trying to run the Calculator standalone sample app following the instructions available on the readme.html
Seems that :mvn dependency:unpack is not working, and gives me the following message :
[INFO] ------------------------------------------------------------------------
[ERROR] BUILD ERROR
[INFO] ------------------------------------------------------------------------
[INFO] Failed to resolve artifact.
GroupId: org.apache.tuscany.sca
ArtifactId: distribution
Version: 1.0-incubator-SNAPSHOT
Reason: Unable to download the artifact from any repository
Try downloading the file manually from the project website.
Then, install it using the command:
mvn install:install-file -DgroupId=org.apache.tuscany.sca -DartifactId=distribution \
-Dversion=1.0-incubator-SNAPSHOT -Dpackaging=zip -Dfile=/path/to/file
org.apache.tuscany.sca:distribution:zip:1.0-incubator-SNAPSHOT
from the specified remote repositories:
central (http://repo1.maven.org/maven2),
apache.incubator (http://people.apache.org/repo/m2-incubating-repository/),
apache.ws.m1.snapshots (http://ws.zones.apache.org/repository),
apache.snapshots (http://people.apache.org/repo/m2-snapshot-repository)
[INFO] ------------------------------------------------------------------------
[INFO] For more information, run Maven with the -e switch
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2 seconds
[INFO] Finished at: Mon Jan 08 17:44:50 PST 2007
[INFO] Final Memory: 2M/4M
[INFO] ------------------------------------------------------------------------
Autowire should support all compatible services interfaces in class hierarchy
When a component registers as an autowire target other components should be able to autowire to is using any super-interface rather than just the interface it registers with. For example, if X1 extends X and a component offers service X1 then it should be a valid target for clients with X references.
Running the Samples section of java-projects page is obsolete and has broken link
The contents of the &quot;Running the Samples&quot; section of the java-projects page are obsolete and do not match either the M2 distribution or the current state of trunk. This section also contains a broken link to a nonexistent page GettingStarted.htm.
@SessionID injection is not working..
When using the @SessionID annotation and instance variable protected String sessionID the session is not being injected and sessionID is null.
Components do not support multiple services
I have a component that implements multiple service interfaces at runtime the locateService() receives an exception indicating that components can only have 1 service. The C&amp;I spec states that a component can declare using @Service an array of interfaces. 
@Service(interfaces={ConversationsClient.class,ConversationsClient2.class})
public class ConversationsClientImpl implements ConversationsClient, ConversationsClient2, ConversationsCallback { 
-------------------------------------------------------------------------------
Test set: org.apache.tuscany.sca.test.ConversationsITest
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.02 sec &lt;&lt;&lt; FAILURE!
testCallBackSetCallback(org.apache.tuscany.sca.test.ConversationsITest) Time elapsed: 0 sec &lt;&lt;&lt; ERROR!
org.apache.tuscany.spi.component.TargetException: Component must have exactly one service
at org.apache.tuscany.core.implementation.java.JavaAtomicComponent.getServiceInstance(JavaAtomicComponent.java:72)
at org.apache.tuscany.spi.extension.CompositeComponentExtension.locateService(CompositeComponentExtension.java:268)
at org.apache.tuscany.core.launcher.CompositeContextImpl.locateService(CompositeContextImpl.java:65)
at org.apache.tuscany.sca.test.ConversationsITest.setUp(ConversationsITest.java:17)
at junit.framework.TestCase.runBare(TestCase.java:125)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:615)
at org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.java:210)
at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:135)
at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:122)
at org.apache.tuscany.sca.plugin.itest.TuscanyITestMojo.run(TuscanyITestMojo.java:122)
at org.apache.tuscany.sca.plugin.itest.TuscanyITestMojo.runSurefire(TuscanyITestMojo.java:88)
at org.apache.tuscany.sca.plugin.itest.TuscanyITestMojo.execute(TuscanyITestMojo.java:77)
at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPluginManager.java:412)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(DefaultLifecycleExecutor.java:534)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalWithLifecycle(DefaultLifecycleExecutor.java:475)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoal(DefaultLifecycleExecutor.java:454)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalAndHandleFailures(DefaultLifecycleExecutor.java:306)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeTaskSegments(DefaultLifecycleExecutor.java:273)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.execute(DefaultLifecycleExecutor.java:140)
at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:322)
at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)
at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:615)
at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)
at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)
at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)
at org.codehaus.classworlds.Launcher.main(Launcher.java:375)
Failure to load SCA webapps into TomCat with multiple exceptions
I start to see this recently while working on DAS container, but i saw same thing just trying BigBank sample app...
Here is the stacktrace on the logs
Dec 13, 2006 8:58:56 AM org.apache.catalina.core.StandardContext listenerStart
SEVERE: Error configuring application listener of class org.apache.tuscany.runtime.webapp.TuscanyContextListener
java.lang.ClassNotFoundException: org.apache.tuscany.runtime.webapp.TuscanyContextListener
at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1352)
at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1198)
at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3677)
at org.apache.catalina.core.StandardContext.start(StandardContext.java:4187)
at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759)
at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739)
at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524)
at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:608)
at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:535)
at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:470)
at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1122)
at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:310)
at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1021)
at org.apache.catalina.core.StandardHost.start(StandardHost.java:718)
at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1013)
at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:442)
at org.apache.catalina.core.StandardService.start(StandardService.java:450)
at org.apache.catalina.core.StandardServer.start(StandardServer.java:709)
at org.apache.catalina.startup.Catalina.start(Catalina.java:551)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:294)
at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:432)
Dec 13, 2006 8:58:56 AM org.apache.catalina.core.StandardContext listenerStart
SEVERE: Skipped installing application listeners due to previous error(s)
Dec 13, 2006 8:58:57 AM org.apache.catalina.core.ApplicationContext log
INFO: org.apache.webapp.balancer.BalancerFilter: init(): ruleChain: [org.apache.webapp.balancer.RuleChain: [org.apache.webapp.balancer.rules.URLStringMatchRule: Target string: News / Redirect URL: http://www.cnn.com], [org.apache.webapp.balancer.rules.RequestParameterRule: Target param name: paramName / Target param value: paramValue / Redirect URL: http://www.yahoo.com], [org.apache.webapp.balancer.rules.AcceptEverythingRule: Redirect URL: http://jakarta.apache.org]]
Dec 13, 2006 8:58:57 AM org.apache.catalina.core.ApplicationContext log
INFO: ContextListener: contextInitialized()
Dec 13, 2006 8:58:57 AM org.apache.catalina.core.ApplicationContext log
INFO: SessionListener: contextInitialized()
Dec 13, 2006 8:58:57 AM org.apache.catalina.core.ApplicationContext log
INFO: ContextListener: contextInitialized()
Dec 13, 2006 8:58:57 AM org.apache.catalina.core.ApplicationContext log
INFO: SessionListener: contextInitialized()
Dec 13, 2006 9:06:14 AM org.apache.catalina.core.ApplicationContext log
SEVERE: org.apache.tuscany.spi.loader.UnrecognizedElementException: {http://incubator.apache.org/tuscany/xmlns/databinding/sdo/1.0-incubator}import.sdo [{http://incubator.apache.org/tuscany/xmlns/databinding/sdo/1.0-incubator}import.sdo]
Context stack trace: [Tuscany Bigbank Web UI sample]
org.apache.tuscany.runtime.webapp.ServletLauncherInitException: org.apache.tuscany.spi.loader.UnrecognizedElementException: {http://incubator.apache.org/tuscany/xmlns/databinding/sdo/1.0-incubator}import.sdo [{http://incubator.apache.org/tuscany/xmlns/databinding/sdo/1.0-incubator}import.sdo]
Context stack trace: [Tuscany Bigbank Web UI sample]
at org.apache.tuscany.runtime.webapp.WebappRuntimeImpl.initialize(WebappRuntimeImpl.java:159)
at org.apache.tuscany.runtime.webapp.TuscanyContextListener.contextInitialized(TuscanyContextListener.java:74)
at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3729)
at org.apache.catalina.core.StandardContext.start(StandardContext.java:4187)
at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759)
at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739)
at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524)
at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:809)
at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:497)
at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1204)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.commons.modeler.BaseModelMBean.invoke(BaseModelMBean.java:503)
at com.sun.jmx.mbeanserver.DynamicMetaDataImpl.invoke(DynamicMetaDataImpl.java:213)
at com.sun.jmx.mbeanserver.MetaDataImpl.invoke(MetaDataImpl.java:220)
at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:815)
at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:784)
at org.apache.catalina.manager.ManagerServlet.check(ManagerServlet.java:1377)
at org.apache.catalina.manager.HTMLManagerServlet.doPost(HTMLManagerServlet.java:213)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:709)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:524)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)
at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)
at java.lang.Thread.run(Thread.java:595)
Caused by: org.apache.tuscany.spi.loader.UnrecognizedElementException: {http://incubator.apache.org/tuscany/xmlns/databinding/sdo/1.0-incubator}import.sdo [{http://incubator.apache.org/tuscany/xmlns/databinding/sdo/1.0-incubator}import.sdo]
Context stack trace: [Tuscany Bigbank Web UI sample]
at org.apache.tuscany.core.loader.LoaderRegistryImpl.load(LoaderRegistryImpl.java:93)
at org.apache.tuscany.core.implementation.composite.CompositeLoader.load(CompositeLoader.java:88)
at org.apache.tuscany.core.implementation.composite.CompositeLoader.load(CompositeLoader.java:64)
at org.apache.tuscany.core.loader.LoaderRegistryImpl.load(LoaderRegistryImpl.java:95)
at org.apache.tuscany.core.loader.LoaderRegistryImpl.load(LoaderRegistryImpl.java:113)
at org.apache.tuscany.core.implementation.composite.CompositeComponentTypeLoader.loadFromSidefile(CompositeComponentTypeLoader.java:65)
at org.apache.tuscany.core.implementation.composite.CompositeComponentTypeLoader.load(CompositeComponentTypeLoader.java:57)
at org.apache.tuscany.core.implementation.composite.CompositeComponentTypeLoader.load(CompositeComponentTypeLoader.java:39)
at org.apache.tuscany.core.loader.LoaderRegistryImpl.loadComponentType(LoaderRegistryImpl.java:165)
at org.apache.tuscany.core.deployer.DeployerImpl.load(DeployerImpl.java:101)
at org.apache.tuscany.core.deployer.DeployerImpl.deploy(DeployerImpl.java:76)
at org.apache.tuscany.core.runtime.AbstractRuntime.deployApplicationScdl(AbstractRuntime.java:136)
at org.apache.tuscany.runtime.webapp.WebappRuntimeImpl.initialize(WebappRuntimeImpl.java:137)
... 37 more
Exception in Test set: echo.DataBindingIntegrationTestCase
The following exception is happening in E:\dev\tuscany\java\samples\sca\echo.databinding testcase:
something with the lastest passbyvalue code and the tc having non-serializable data
PER IRC chat: I think we need to fix the pass-by-value code to support OMElement in this case
-------------------------------------------------------------------------------
Test set: echo.DataBindingIntegrationTestCase
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1.735 sec &lt;&lt;&lt; FAILURE!
testTransform(echo.DataBindingIntegrationTestCase) Time elapsed: 1.688 sec &lt;&lt;&lt; ERROR!
java.lang.IllegalArgumentException: Pass-by-value is not supported for the given object
at org.apache.tuscany.core.databinding.impl.PassByValueInterceptor.copy(PassByValueInterceptor.java:126)
at org.apache.tuscany.core.databinding.impl.PassByValueInterceptor.copy(PassByValueInterceptor.java:79)
at org.apache.tuscany.core.databinding.impl.PassByValueInterceptor.invoke(PassByValueInterceptor.java:49)
at org.apache.tuscany.core.wire.SynchronousBridgingInterceptor.invoke(SynchronousBridgingInterceptor.java:41)
at org.apache.tuscany.core.databinding.impl.DataBindingInteceptor.invoke(DataBindingInteceptor.java:70)
at org.apache.tuscany.spi.wire.AbstractOutboundInvocationHandler.invoke(AbstractOutboundInvocationHandler.java:91)
at org.apache.tuscany.core.wire.jdk.JDKOutboundInvocationHandler.invoke(JDKOutboundInvocationHandler.java:149)
at $Proxy22.echo(Unknown Source)
at echo.ComponentBImpl.call(ComponentBImpl.java:43)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tuscany.core.implementation.java.JavaTargetInvoker.invokeTarget(JavaTargetInvoker.java:89)
at org.apache.tuscany.spi.extension.TargetInvokerExtension.invoke(TargetInvokerExtension.java:65)
at org.apache.tuscany.core.wire.InvokerInterceptor.invoke(InvokerInterceptor.java:44)
at org.apache.tuscany.core.databinding.impl.PassByValueInterceptor.invoke(PassByValueInterceptor.java:50)
at org.apache.tuscany.core.databinding.impl.PassByValueInterceptor.invoke(PassByValueInterceptor.java:50)
at org.apache.tuscany.core.wire.SynchronousBridgingInterceptor.invoke(SynchronousBridgingInterceptor.java:41)
at org.apache.tuscany.core.databinding.impl.DataBindingInteceptor.invoke(DataBindingInteceptor.java:70)
at org.apache.tuscany.spi.wire.AbstractOutboundInvocationHandler.invoke(AbstractOutboundInvocationHandler.java:91)
at org.apache.tuscany.core.wire.jdk.JDKOutboundInvocationHandler.invoke(JDKOutboundInvocationHandler.java:149)
at $Proxy21.call(Unknown Source)
at echo.ComponentAImpl.call(ComponentAImpl.java:50)
at echo.DataBindingIntegrationTestCase.testTransform(DataBindingIntegrationTestCase.java:34)
Caused by: java.lang.IllegalArgumentException: Pass-by-value is not supported for the given object
at org.apache.tuscany.core.databinding.impl.PassByValueInterceptor.copy(PassByValueInterceptor.java:123)
... 50 more
NoRegisteredCallbackException not thrown to client
NoRegisteredCallbackException not thrown to client. 
The client does not implement the callback interface and does not call setCallback prior to calling the service. I was expecting to receive an exception and instead the service was invoked. 
try
{
aCallBackService.knockKnock(&quot;Knock Knock&quot;);
}
catch (NoRegisteredCallbackException NotRegEx)
{
correctException = true; 
} 
catch (Exception ex)
{
ex.printStackTrace(); 
} 
[INFO] [tuscany-itest:start {execution: start}]
[INFO] Starting Tuscany...
[INFO] [tuscany-itest:test {execution: test}]
[INFO] Executing tests...
CallBackBasicServiceImpl message received: Knock Knock
java.lang.NullPointerException
at org.apache.tuscany.sca.test.CallBackSetCallbackServiceImpl.knockKnock
(CallBackSetCallbackServiceImpl.java:29)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:615)
at org.apache.tuscany.core.implementation.java.JavaTargetInvoker.invokeT
arget(JavaTargetInvoker.java:71)
at org.apache.tuscany.spi.extension.TargetInvokerExtension.invoke(Target
InvokerExtension.java:64)
at org.apache.tuscany.core.wire.InvokerInterceptor.invoke(InvokerInterce
ptor.java:44)
at org.apache.tuscany.core.wire.NonBlockingBridgingInterceptor$1.run(Non
BlockingBridgingInterceptor.java:80)
at org.apache.tuscany.core.services.work.jsr237.Jsr237WorkScheduler$Jsr2
37Work.run(Jsr237WorkScheduler.java:212)
at org.apache.tuscany.core.services.work.jsr237.workmanager.ThreadPoolWo
rkManager$DecoratingWork.run(ThreadPoolWorkManager.java:206)
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExec
utor.java:665)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor
.java:690)
at java.lang.Thread.run(Thread.java:797)
[INFO] Test results: {skipped=0, completedCount=1, failures=1, errors=0}
[INFO] ------------------------------------------------------------------------
[ERROR] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] There were test failures
[INFO] ------------------------------------------------------------------------
[INFO] For more information, run Maven with the -e switch
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 9 seconds
[INFO] Finished at: Wed Dec 06 14:06:57 EST 2006
[INFO] Final Memory: 7M/19M
[INFO] ------------------------------------------------------------------------
Scope object factory not registered for scope [CONVERSATION]
Conversation scope is not recognized. 
[INFO] [tuscany-itest:start {execution: start}]
[INFO] Starting Tuscany...
[INFO] ------------------------------------------------------------------------
[ERROR] FATAL ERROR
[INFO] ------------------------------------------------------------------------
[INFO] Scope object factory not registered for scope [CONVERSATION]
[INFO] ------------------------------------------------------------------------
[INFO] Trace
org.apache.tuscany.spi.component.ScopeNotFoundException: Scope object factory n
t registered for scope [CONVERSATION]
at org.apache.tuscany.core.component.scope.ScopeRegistryImpl.getScopeCo
tainer(ScopeRegistryImpl.java:65)
at org.apache.tuscany.core.implementation.java.JavaComponentBuilder.bui
d(JavaComponentBuilder.java:76)
at org.apache.tuscany.core.implementation.java.JavaComponentBuilder.bui
d(JavaComponentBuilder.java:53)
at org.apache.tuscany.core.builder.BuilderRegistryImpl.build(BuilderReg
stryImpl.java:115)
at org.apache.tuscany.core.implementation.composite.CompositeBuilder.bu
ld(CompositeBuilder.java:93)
at org.apache.tuscany.core.builder.BuilderRegistryImpl.build(BuilderReg
stryImpl.java:115)
at org.apache.tuscany.core.deployer.DeployerImpl.build(DeployerImpl.jav
:115)
at org.apache.tuscany.core.deployer.DeployerImpl.deploy(DeployerImpl.ja
a:81)
at org.apache.tuscany.core.runtime.AbstractRuntime.deployApplicationScd
(AbstractRuntime.java:136)
at org.apache.tuscany.sca.plugin.itest.MavenEmbeddedRuntime.initialize(
avenEmbeddedRuntime.java:85)
at org.apache.tuscany.sca.plugin.itest.TuscanyStartMojo.execute(Tuscany
tartMojo.java:102)
at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPlug
nManager.java:412)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(Def
ultLifecycleExecutor.java:534)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalWithL
fecycle(DefaultLifecycleExecutor.java:475)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoal(Defa
ltLifecycleExecutor.java:454)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalAndHa
dleFailures(DefaultLifecycleExecutor.java:306)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeTaskSegme
ts(DefaultLifecycleExecutor.java:273)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.execute(DefaultL
fecycleExecutor.java:140)
at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:322)
at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)
at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl
java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcce
sorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:615)
at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)
at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)
at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430
at org.codehaus.classworlds.Launcher.main(Launcher.java:375)
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 7 seconds
[INFO] Finished at: Wed Dec 06 13:43:48 EST 2006
[INFO] Final Memory: 6M/17M
[INFO] ------------------------------------------------------------------------
HttpSessionScopeContainer requires a session to exist
In M1, the HttpSessionScopeContainer was able to lazy-initialize an HTTP session. (Look at the class LazyHTTPSessionId to see how it worked.) Now the HttpSessionScopeContainer requires a preexisting session. If a session does not exist, a NullPointerException occurs when it tries to look up the instance using a null key.
InstanceWrapper ctx = wrappers.get(key);
The problem can be circumvented by creating a session in the web app client. JSPs have sessions by default. Servlets can call getSession(true) to ensure a session exists before invoking an SCA component that requires session scope.
default value of property( anntated with @Property) is set to null by default.
I define@Property on the attribute. I give the property a default value in java class. However I noticed when I define Component with the implemenation.java, even though I did not override the property value, the value is always set to null. Is the behavior expected?
Current Tuscany driver Spec API inconsistence with Spec 0.95
1.API(annotation) differences between the current driver and 0.95 spec
CompositeContext:
0.95 Spec v.s. current Tuscany driver (incubator-M2)
getName --&gt; getCompositeName
getURI --&gt; getCompositeURI
getMetaData --&gt; none
Annotation difference: 
there is no annotation @ComponentMetadata.
Async samples fail in stanalone launcher
Simplecallback sample fails in stanalone launcher with the following exception:
C:\SCA\SVN\TRUNK\samples\sca\simplecallback&gt;java -jar ..\..\..\..\..\StandaloneT\bin\launcher.jar target\sample-simplecallback-1.0-incubator-M2-SNAPSHOT.jar Main thread Thread[main,5,main]
java.lang.IllegalStateException: Scope not running [6] 
at org.apache.tuscany.core.component.scope.AbstractScopeContainer.checkInit(AbstractScopeContainer.java:124)
at org.apache.tuscany.core.component.scope.ModuleScopeContainer.getInstanceWrapper(ModuleScopeContainer.java:118)
at org.apache.tuscany.core.component.scope.AbstractScopeContainer.getInstance(AbstractScopeContainer.java:105) 
at org.apache.tuscany.core.implementation.PojoAtomicComponent.getTargetInstance(PojoAtomicComponent.java:117)
at org.apache.tuscany.core.implementation.java.JavaTargetInvoker.getInstance(JavaTargetInvoker.java:94) 
at org.apache.tuscany.core.implementation.java.JavaTargetInvoker.invokeTarget(JavaTargetInvoker.java:59)
at org.apache.tuscany.spi.extension.TargetInvokerExtension.invoke(TargetInvokerExtension.java:60) 
at org.apache.tuscany.core.wire.InvokerInterceptor.invoke(InvokerInterceptor.java:44) 
at org.apache.tuscany.core.wire.NonBlockingBridgingInterceptor$1.run(NonBlockingBridgingInterceptor.java:70)
at org.apache.tuscany.core.services.work.jsr237.Jsr237WorkScheduler$Jsr237Work.run(Jsr237WorkScheduler.java:212) 
at org.apache.tuscany.core.services.work.jsr237.workmanager.ThreadPoolWorkManager$DecoratingWork.run(ThreadPoolWorkManager.java:206) 
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source) 
at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) 
at java.lang.Thread.run(Unknown Source)
NPE occurs on binding.ws when JAXB data type gets involved in service
Caused by: java.lang.NullPointerException
at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:570)
at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:522)
at org.apache.tuscany.databinding.jaxb.JAXBContextHelper.createJAXBContext(JAXBContextHelper.java:55)
at org.apache.tuscany.databinding.jaxb.JAXB2Node.transform(JAXB2Node.java:45)
Enclosed web app is modified from the axis2 helloworldws sample and it could be used to reproduce this error:
1) &quot;mvn package&quot; and deploy the generated war to tomcat
2) visit http://localhost:8080/sample-helloworldws/helloworld.jsp to check for error
Web deployment broken
Web deployment is broken
Fix Property Value Loading from Component Definitions
Currently property loading for application components does not work. There is NPE exception thrown when creating a property instance factory based on the property value defined in the Component Defn. 
Also the property loading works only for simply types whose values can be represented as a simple xml text content.
SynchronousBridgingInterceptor seems to be catching NPE
Trying the plain inner.composite sample without a fix for TUSCANY-767, gives the failure below. It seems like the SynchronousBridgingInterceptor may be having a problem. Having tried to look yet. It may be related to TUSCANY-767, but in case it is not.
-------------------------------------------------------
T E S T S
-------------------------------------------------------
Running innercomposite.InnerCompositeTestCase
Main thread Thread[main,5,main]
org.apache.tuscany.spi.wire.InvocationRuntimeException: java.lang.NullPointerExc
eption
at org.apache.tuscany.core.databinding.impl.DataBindingInteceptor.invoke
(DataBindingInteceptor.java:76)
at org.apache.tuscany.core.wire.AbstractOutboundInvocationHandler.invoke
(AbstractOutboundInvocationHandler.java:65)
at org.apache.tuscany.core.wire.jdk.JDKOutboundInvocationHandler.invoke(
JDKOutboundInvocationHandler.java:121)
at $Proxy17.clientMethod(Unknown Source)
at innercomposite.InnerCompositeTestCase.test(InnerCompositeTestCase.jav
a:39)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.jav
a:210)
at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTes
tSet(AbstractDirectoryTestSuite.java:135)
at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(Ab
stractDirectoryTestSuite.java:122)
at org.apache.maven.surefire.Surefire.run(Surefire.java:129)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(Su
refireBooter.java:269)
at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.j
ava:788)
Caused by: java.lang.NullPointerException
at org.apache.tuscany.core.databinding.impl.DataBindingInteceptor.invoke
(DataBindingInteceptor.java:71)
at org.apache.tuscany.core.wire.SynchronousBridgingInterceptor.invoke(Sy
nchronousBridgingInterceptor.java:41)
at org.apache.tuscany.core.wire.SynchronousBridgingInterceptor.invoke(Sy
nchronousBridgingInterceptor.java:41)
at org.apache.tuscany.core.databinding.impl.DataBindingInteceptor.invoke
(DataBindingInteceptor.java:71)
at org.apache.tuscany.core.wire.AbstractOutboundInvocationHandler.invoke
(AbstractOutboundInvocationHandler.java:65)
at org.apache.tuscany.core.wire.jdk.JDKOutboundInvocationHandler.invoke(
JDKOutboundInvocationHandler.java:121)
at $Proxy18.someMethod(Unknown Source)
at innercomposite.SourceImpl.clientMethod(SourceImpl.java:43)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tuscany.core.wire.PojoTargetInvoker.invokeTarget(PojoTarge
tInvoker.java:63)
at org.apache.tuscany.core.wire.PojoTargetInvoker.invoke(PojoTargetInvok
er.java:72)
at org.apache.tuscany.core.wire.InvokerInterceptor.invoke(InvokerInterce
ptor.java:44)
at org.apache.tuscany.core.wire.SynchronousBridgingInterceptor.invoke(Sy
nchronousBridgingInterceptor.java:41)
at org.apache.tuscany.core.databinding.impl.DataBindingInteceptor.invoke
(DataBindingInteceptor.java:71)
... 30 more
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.862 sec
Results :
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
Version information should not be in war plugin source code
The version of the runtime to use should be a configuration property of the war plugin and not hard coded in Dependency.
Ideally, the default value for runtime version should come from a POM property, perhaps the version of the POM plugin itself. A user of the plugin should be able to override this in their own project with a configuration property
Position of &lt;property&gt; not consistent between composite, component and componentType
In a composite properties are defined after services and before components and before references.
In component and componentType properties appear after references.
This is confusing, the position of properties should be consistent between composites, components and componentTypes.
I will raise that issue to the OSOA spec workgroup.
Launcher only runs from jars on the file system
The o.a.t.core.launcher.LauncherImpl method getInstallDirectory throws an exception if the LauncherImpl class is not loaded from a jar on the file system. This isn't the case when running in a webapp using the new TuscanyContextListener.
In sca-core.xsd, component should not contain property type definition elements
Sca-core.xsd defines a single complexType for two very different things:
- the definition of a property type (in a Type definition, i.e. a component type or a composite, which I view like a partial definition of a concrete type)
- the configuration of a property on a component (an instance of a type)
As far as I know we're not supporting the definition of property types on instances yet, some programming languages do that and it's useful but we don't support this on components yet :) so Component should define its &lt;property&gt; element differently. We should have two different types:
- PropertyType - representing the definition of a property type
- Property - representing the configuration of a property on a component
I will bring this issue to the OSOA spec workgroup.
Here's what I propose:
&lt;complexType name=&quot;PropertyType&quot;&gt;
&lt;complexContent&gt;
&lt;extension base=&quot;anyType&quot;&gt;
&lt;attribute name=&quot;name&quot; type=&quot;NCName&quot; use=&quot;required&quot; /&gt;
&lt;attribute name=&quot;type&quot; type=&quot;QName&quot; use=&quot;required&quot; /&gt;
&lt;attribute name=&quot;many&quot; type=&quot;boolean&quot; default=&quot;false&quot; use=&quot;optional&quot; /&gt;
&lt;attribute name=&quot;override&quot; type=&quot;sca:OverrideOptions&quot; default=&quot;may&quot; use=&quot;optional&quot; /&gt;
&lt;anyAttribute namespace=&quot;##any&quot; processContents=&quot;lax&quot; /&gt;
&lt;/extension&gt;
&lt;/complexContent&gt;
&lt;/complexType&gt;
&lt;complexType name=&quot;Property&quot;&gt;
&lt;complexContent&gt;
&lt;extension base=&quot;anyType&quot;&gt;
&lt;attribute name=&quot;name&quot; type=&quot;NCName&quot; use=&quot;required&quot; /&gt;
&lt;attribute name=&quot;source&quot; type=&quot;string&quot; use=&quot;optional&quot; /&gt;
&lt;anyAttribute namespace=&quot;##any&quot; processContents=&quot;lax&quot; /&gt;
&lt;/extension&gt;
&lt;/complexContent&gt;
&lt;/complexType&gt;
Note: I also propose to change the definition of PropertyType and Property to extend anyType instead of containing an &lt;xsd:any&gt;. The way the 0.95 XSD is defined you cannot assign a simple value to a property or define a simple default value on a property... for example the following SCDL will cause an XMLSchema validation error complaining that property can only contain &quot;element only&quot; content:
&lt;property name=&quot;currency&quot; type=&quot;xs:string&quot;&gt;USD&lt;/property&gt;
I'm not an XSD expert so maybe there's a better - simpler? :) way to support this very simple case than extending anyType... but this definitely needs to be fixed.
In sca-core.xsd, Wire still allows for both URIs and EPRs.
In sca-core.xsd, Wire can contain both URIs (xsd:anyURI) and EPRs (defined as xsd:anyType).
The SCA assembly spec level 0.95 does not mention EPRs anywhere. Either EPRs are supported as source and target of a Wire and this should be described in the spec and IMO supported as well on references, or EPRs are not supported and the XSD should be changed to reflect that.
I will bring this issue to the OSOA spec workgroup.
Assuming that EPRs are not supported we can simplify the XSD and change this:
&lt;element name=&quot;source&quot; type=&quot;anyType&quot;/&gt;
&lt;element name=&quot;target&quot; type=&quot;anyType&quot;/&gt;
&lt;element name=&quot;source.uri&quot; type=&quot;anyURI&quot; substitutionGroup=&quot;sca:source&quot;/&gt;
&lt;element name=&quot;target.uri&quot; type=&quot;anyURI&quot; substitutionGroup=&quot;sca:target&quot;/&gt;
&lt;complexType name=&quot;Wire&quot;&gt;
&lt;sequence&gt;
&lt;element ref=&quot;sca:source&quot; minOccurs=&quot;1&quot; maxOccurs=&quot;1&quot;/&gt;
&lt;element ref=&quot;sca:target&quot; minOccurs=&quot;1&quot; maxOccurs=&quot;1&quot;/&gt;
&lt;any namespace=&quot;##other&quot; processContents=&quot;lax&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/sequence&gt;
&lt;/complexType&gt;
&lt;element name=&quot;source.epr&quot; type=&quot;anyType&quot; substitutionGroup=&quot;sca:source&quot;/&gt;
&lt;element name=&quot;target.epr&quot; type=&quot;anyType&quot; substitutionGroup=&quot;sca:target&quot;/&gt;
To the following (much simpler):
&lt;complexType name=&quot;Wire&quot;&gt;
&lt;sequence&gt;
&lt;element name=&quot;source&quot; type=&quot;anyURI&quot; minOccurs=&quot;1&quot; maxOccurs=&quot;1&quot; /&gt;
&lt;element name=&quot;target&quot; type=&quot;anyURI&quot; minOccurs=&quot;1&quot; maxOccurs=&quot;1&quot; /&gt;
&lt;any namespace=&quot;##other&quot; processContents=&quot;lax&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot; /&gt;
&lt;/sequence&gt;
&lt;anyAttribute namespace=&quot;##any&quot; processContents=&quot;lax&quot; /&gt;
&lt;/complexType&gt;
Cannot mix both WS Entrypoint and WS External Service
A component invoked via a WS Entrypoint fails after invoking a WS External Service. I believe this is a problem with freeing memory in Axis2C &amp; have asked a question on the Axis2C mailing list. Currently this causes the server to crash. 
A workaround can be used - comment out the block that frees the Axis2C service client in Axis2Client.cpp at line 169:
// if (svc_client)
// {
// AXIS2_SVC_CLIENT_FREE(svc_client, env);
// svc_client = NULL;
// } 
Unfortunately this can cause memory leakage problems.
Bigbank sample should demonstrate the SCA async PM
The Bigbank sample should demonstrate the SCA async PM. Rick, Jim, could you please add comments to this JIRA with your suggestions to improve the sample to demonstrate the SCA async PM? Thanks.
ModuleContext locateService should return a proxy if any interceptors are present in the invocation chain
ModuleContext.locateService always returns the target service instance, instead of returning a proxy configured with the invocation chain for the particular service. If there are any interceptors in the invocation chain, they will never be invoked.
This blocks development of any samples and test cases that use the SCA async PM from a simple client (JSP or J2SE client). Right now the helloworldasync sample must go through an intermediate component with a reference to the target service to be able to do any async invocation.
Ambiguous references in subsystem wires.
As currently specified, subsystem wires can contain ambiguous references in a wire source and/or target. For example (not precisely according to schema);
&lt;wire&gt;
&lt;source&gt;Fred&lt;/source&gt;
&lt;target&gt;Foo/Bar&lt;/target&gt;
&lt;/wire&gt;
where the target Foo/Bar could be a reference to either:
Subsystem Foo, ModuleComponent Bar (with the optional service omitted because there's only 1)
or
ModuleComponent Foo, Service Bar (in the current subsystem, because it has beem ommitted)
Test watchers
Test bug with attachment
RequestContextFactory and SkinFactory can lock ClassLoaders into memory
If Trinidad is deployed as a shared library, the RequestContextFactory and SkinFactory classes can lead to each webapp ClassLoader being locked into memory. In each case, a HashMap&lt;ClassLoader, ...&gt; should be a WeakHashMap&lt;ClassLoader, ...&gt;.
convertNumber component does not work with a target type of BigDecimal
With a convertNumber component in an inputText whose value is bound to a property type of BigDecimal in the bean, an Exception will occur when the page is submitted. This works fine with property types of Double or Float, but fails with BigDecimal. Since many currecny values are stored in a BegDecimal, the convertNumber should support that type.
tr:validateDateTimeRange has incorrect hint when only minimum attribute is set.
If I have the following:
&lt;tr:inputText value=&quot;#{demoInput.date}&quot;
label=&quot;Input date:&quot;
shortDesc=&quot;Value will fail validation for dates earlier than 2007&quot;&gt;
&lt;tr:convertDateTime/&gt;
&lt;tr:validateDateTimeRange minimum=&quot;2007-01-01&quot;/&gt;
&lt;/af:inputText&gt;
It will produce 2 validator hints: &quot;The date cannot be after 12/31/1969&quot; and &quot;The date cannot be before 1/1/2007.
The first validator hint is incorrect.
JSF 1.2: &quot;validator&quot; attribute use results in ELException instead of proper FacesMessage
In the JSF 1.2 branch, set the &quot;validator&quot; attribute on an input component, and enter content that fails validation. You get a big stack trace of an ELException around a ValidatorException, instead of getting a proper FacesMessage added to the page.
JSF 1.2: forEach &quot;first&quot; and &quot;last&quot; varStatus doesn't work
&quot;first&quot; and &quot;last&quot; aren't really implemented at all in tr:forEach, at least not in the 1.2 version.
'-tr-inhibit: all inhibits all after include styles in skin css files
'-tr-inhibit all clears out properties AFTER the include of another styleclass. This is wrong. It should inhibit all first.
Example:
.portlet-form-input-field {
/* Bug in Trinidad: */
-tr-inhibit: all;
padding: 8px;
-tr-rule-ref: selector(&quot;.AFLightAccentBackground::alias&quot;);
}
.PortletHeaderLink {
/* works fine */
-tr-inhibit: text-decoration;
color: pink;
}
generates:
.PortletHeaderLink,.xaz {color:pink}
.portlet-form-input-field,.xbw {padding:8px}
.PortletHeaderLink/.PortletSugHeaderLink works fine. The problem is .portlet-form-input-field. It should generate
.portlet-form-input-field,.xbw {background-color:#e9e8e8;padding:8px}
The same thing works in the xss format. We should do the same thing as what is done in xss.
&lt;style selector=&quot;.portlet-form-input-field&quot; resetProperties=&quot;true&quot;&gt;
&lt;property name=&quot;padding&quot;&gt;4px&lt;/property&gt;
&lt;includeStyle name=&quot;AFLightAccentBackground&quot;/&gt;
&lt;/style&gt;
&lt;style selector=&quot;.PortletHeaderLink&quot; &gt;
&lt;property name=&quot;text-decoration&quot;/&gt;
&lt;property name=&quot;color&quot;&gt;blue&lt;/property&gt;
&lt;/style&gt;
generates:
.PortletHeaderLink,.xaz {color:blue}
.portlet-form-input-field,.xbw {background-color:#e9e8e8;padding:4px}
Placing tr:train outside of a form results in an exception instead of a descriptive warning.
When a tr:train component appears outside of a form, an exception gets generated that stops the application, rather than logging a descriptive warning. The exception appears as follows:
java.lang.NullPointerException
at org.apache.myfaces.trinidadinternal.renderkit.core.desktop.TrainRenderer$Train.&lt;init&gt;(TrainRenderer.java:913)
at org.apache.myfaces.trinidadinternal.renderkit.core.desktop.TrainRenderer.encodeAll(TrainRenderer.java:175)
at org.apache.myfaces.trinidad.render.CoreRenderer.encodeEnd(CoreRenderer.java:181)
at org.apache.myfaces.trinidad.component.UIXComponentBase.encodeEnd(UIXComponentBase.java:712)
at org.apache.myfaces.trinidad.component.UIXCollection.encodeEnd(UIXCollection.java:490)
at org.apache.myfaces.trinidad.component.UIXComponentBase.__encodeRecursive(UIXComponentBase.java:1258)
at org.apache.myfaces.trinidad.component.UIXComponentBase.encodeAll(UIXComponentBase.java:732)
at javax.faces.component.UIComponent.encodeAll(UIComponent.java:889)
at com.sun.facelets.FaceletViewHandler.renderView(FaceletViewHandler.java:578)
at javax.faces.application.ViewHandlerWrapper.renderView(ViewHandlerWrapper.java:178)
at org.apache.myfaces.trinidadinternal.application.ViewHandlerImpl.renderView(ViewHandlerImpl.java:171)
at com.sun.faces.lifecycle.RenderResponsePhase.execute(RenderResponsePhase.java:133)
at com.sun.faces.lifecycle.LifecycleImpl.phase(LifecycleImpl.java:244)
at com.sun.faces.lifecycle.LifecycleImpl.render(LifecycleImpl.java:140)
at javax.faces.webapp.FacesServlet.service(FacesServlet.java:245)
at org.apache.catalina.core.ApplicationFilterChain.servletService(ApplicationFilterChain.java:397)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:303)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:184)
at org.apache.myfaces.trinidadinternal.webapp.TrinidadFilterImpl._invokeDoFilter(TrinidadFilterImpl.java:327)
at org.apache.myfaces.trinidadinternal.webapp.TrinidadFilterImpl._doFilterImpl(TrinidadFilterImpl.java:291)
at org.apache.myfaces.trinidadinternal.webapp.TrinidadFilterImpl.doFilter(TrinidadFilterImpl.java:214)
at org.apache.myfaces.trinidad.webapp.TrinidadFilter.doFilter(TrinidadFilter.java:90)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:216)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:184)
at org.apache.myfaces.webapp.filter.ExtensionsFilter.doFilter(ExtensionsFilter.java:144)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:216)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:184)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:276)
at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:566)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:536)
at org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:240)
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:179)
at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:566)
at com.sun.enterprise.web.WebPipeline.invoke(WebPipeline.java:73)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:182)
at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:566)
at com.sun.enterprise.web.VirtualServerPipeline.invoke(VirtualServerPipeline.java:120)
at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:939)
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:137)
at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:566)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:536)
at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:939)
at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:239)
at com.sun.enterprise.web.connector.grizzly.ProcessorTask.invokeAdapter(ProcessorTask.java:667)
at com.sun.enterprise.web.connector.grizzly.ProcessorTask.processNonBlocked(ProcessorTask.java:574)
at com.sun.enterprise.web.connector.grizzly.ProcessorTask.process(ProcessorTask.java:844)
at com.sun.enterprise.web.connector.grizzly.ReadTask.executeProcessorTask(ReadTask.java:287)
at com.sun.enterprise.web.connector.grizzly.ReadTask.doTask(ReadTask.java:212)
at com.sun.enterprise.web.connector.grizzly.TaskBase.run(TaskBase.java:252)
at com.sun.enterprise.web.connector.grizzly.WorkerThread.run(WorkerThread.java:75)
An example template that generates this error appears as follows:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot; ?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; 
&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html
xmlns=&quot;http://www.w3.org/1999/xhtml&quot;
xmlns:ui=&quot;http://java.sun.com/jsf/facelets&quot;
xmlns:f=&quot;http://java.sun.com/jsf/core&quot;
xmlns:h=&quot;http://java.sun.com/jsf/html&quot;
xmlns:t=&quot;http://myfaces.apache.org/tomahawk&quot;
xmlns:tr=&quot;http://myfaces.apache.org/trinidad&quot;
lang=&quot;en&quot;
xml:lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta
http-equiv=&quot;Content-Type&quot;
content=&quot;text/html; charset=ISO-8859-1&quot; /&gt;
&lt;meta
name=&quot;description&quot;
content=&quot;description&quot; /&gt;
&lt;meta
name=&quot;keywords&quot;
content=&quot;keyword phrase1, keyword phrase 2, etc.&quot; /&gt;
&lt;!-- &lt;meta name=&quot;robots&quot; content=&quot;noindex,nofollow&quot; /&gt; --&gt;
&lt;title&gt;&lt;ui:insert name=&quot;title&quot;&gt;Default Title&lt;/ui:insert&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;f:view&gt;
&lt;div id=&quot;wrap&quot;&gt;
&lt;ui:insert name=&quot;header&quot;&gt;
&lt;ui:include src=&quot;header.xhtml&quot; /&gt;
&lt;/ui:insert&gt; 
&lt;tr:train
var=&quot;foo&quot;
value=&quot;#{processTrainMenuModel}&quot;&gt;
&lt;f:facet name=&quot;nodeStamp&quot;&gt;
&lt;tr:commandNavigationItem
text=&quot;#{foo.label}&quot;
action=&quot;#{foo.getOutcome}&quot;
immediate=&quot;#{processTrainMenuModel.immediate}&quot;
readOnly=&quot;#{processTrainMenuModel.readOnly}&quot; /&gt;
&lt;/f:facet&gt;
&lt;/tr:train&gt; 
&lt;ui:insert name=&quot;content&quot;&gt;
&lt;ui:include src=&quot;content.xhtml&quot; /&gt;
&lt;/ui:insert&gt; 
&lt;ui:insert name=&quot;footer&quot;&gt;
&lt;ui:include src=&quot;footer.xhtml&quot; /&gt;
&lt;/ui:insert&gt; 
&lt;/div&gt;
&lt;!-- end #wrap div--&gt;
&lt;/f:view&gt;
&lt;/body&gt;
&lt;/html&gt;
Update ASF license headers in trinidad core
trinidad-api is already fixed
-build
-impl
-demo
need some more overhauling.
This is a show stopper for releasing Trinidad Core
input component's label has no space between label and field.
To reproduce, run the inputText demo. Notice the space between the Label and the input field. It is about 8 px. Now change your browser's language to a RTL language and refresh the page. You will see the Label is now on the right of the field (this is correct), but there is no space between the label and in the input field. This is the bug.
The problem is that in base-desktop.xss the AFEndPadding is the same (padding-right) for rtl mode as it is for the ltr mode.
Provide setXxx Methods on ExternalContextDecorator (JSF 1.2)
in jsf 1.2 there are four new setXxx() methods available on the externalCtx clazz.
We need to add them to our ExternalContextDecorator, like:
@Override
public void setResponse(Object response)
{
getExternalContext().setResponse(response);
}
selectOrderShuttle problems
From Martin Koci:
Bug can be reproduced with trinidad-demo.war. Go to to
selectOrderShuttle component demo and select value &quot;Third&quot; as first and
value &quot;Second&quot; as second.
After sumbit is &quot;Third&quot; moved to second position and &quot;Second&quot; to first -
simply component doesn't hold order ...
Problem is in render response phase, because submitted values are ok,
update model phase sets right values, but component display values in
unexpected order.
Tree's &quot;disclosedRowKeys&quot; is saved under the wrong name for change manager
The ChangeManager is supposed to be maintaining the state of the disclosedRowKeys automatically.
However, it is saving this attribute (in HierarchyUtils.__handleBroadcast()) under &quot;expandedRowKeys&quot;, the
wrong name.
org.apache.myfaces.trinidadinternal.renderkit.RenderKitTestCase: move call to _initGlobal to Constructor.
Currently, the private method _initGlobal tries to get some system properties and is called from a static block. This effectlively means that these system properties must be set before any junit tests that extend this class are run. If they are not set prior to running the junit test (in the environment), an NPE results. Putting the call to _initGlobal in the constructor delays the getting of these system properties so that they can set in the extending class as a static block -- thus the system properties can be set either in the enviroment, prior to running the test, or in a static block in the extending class.
tr:SelectOneRadio client side validation problem - JavaScript Error - faces-1_2-070102 branch
Clientside validation does not work for the tr:selectOneRadio component. If the component is marked as required and no selection is made, then you do not get an error when attempting to navigate to the next page. No validation message occurs and as the post back is aborted due to the JavaScript error. There is no visual indication for the problem other than simple remaining on the same page when clicking the next button. The problem is reproducable using the following jspx:
&lt;?xml version='1.0' encoding='windows-1252'?&gt;
&lt;jsp:root xmlns:jsp=&quot;http://java.sun.com/JSP/Page&quot; version=&quot;2.1&quot;
xmlns:h=&quot;http://java.sun.com/jsf/html&quot;
xmlns:f=&quot;http://java.sun.com/jsf/core&quot;
xmlns:tr=&quot;http://myfaces.apache.org/trinidad&quot;
xmlns:trh=&quot;http://myfaces.apache.org/trinidad/html&quot;&gt;
&lt;jsp:output omit-xml-declaration=&quot;true&quot; doctype-root-element=&quot;html&quot;
doctype-system=&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;
doctype-public=&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;/&gt;
&lt;jsp:directive.page contentType=&quot;text/html;charset=windows-1252&quot;/&gt;
&lt;f:view&gt;
&lt;trh:html&gt;
&lt;trh:head title=&quot;Dialog&quot;&gt;
&lt;meta http-equiv=&quot;Content-Type&quot;
content=&quot;text/html; charset=windows-1252&quot;/&gt;
&lt;/trh:head&gt;
&lt;trh:body&gt;
&lt;tr:form&gt;
&lt;tr:panelFormLayout&gt;
&lt;tr:selectOneRadio
id=&quot;effort&quot;
layout=&quot;vertical&quot;
label=&quot;Test&quot;
required=&quot;true&quot;&gt;
&lt;tr:selectItem 
value=&quot;true&quot; 
label=&quot;Yes&quot; /&gt;
&lt;tr:selectItem 
value=&quot;false&quot; 
label=&quot;No&quot; /&gt;
&lt;/tr:selectOneRadio&gt;
&lt;/tr:panelFormLayout&gt;
&lt;tr:panelButtonBar id=&quot;pageNav&quot;&gt;
&lt;tr:commandButton
action=&quot;continue&quot;
text=&quot;continue&quot; /&gt;
&lt;/tr:panelButtonBar&gt;
&lt;/tr:form&gt;
&lt;/trh:body&gt;
&lt;/trh:html&gt;
&lt;/f:view&gt;
&lt;/jsp:root&gt;
A stack trace for the JavaScript using firebug appears as follows:
a0.ownerDocument has no properties Common11-m7.js (line 4507)
_isShowing Common11-m7.js (line 4507)
_setFocus Common11-m7.js (line 4240)
_multiValidate Common11-m7.js (line 4332)
_j_id6Validator quickDetails.jspx(line 42)
_validateForm Common11-m7.js (line 3484)
submitForm Common11-m7.js (line 3735)
onclick quickDetails.jspx (line 1)
The actual code affect appears as:
4505 if(!_agent.isNav&amp;&amp;!_agent.isSafari&amp;&amp;!_agent.isPIE&amp;&amp;!_agent.isBlackBerry)
4506 {
4507 var a2=a0.ownerDocument.defaultView.getComputedStyle(a0,
4508 null);
4509 return((a2[&quot;visibility&quot;]!=&quot;hidden&quot;)&amp;&amp;
4510 (a2[&quot;display&quot;]!=&quot;none&quot;));
4511}
IndexOutOfBoundsException in UIXCollection.restoreStampState when transient components are included
A long-standing bug: if you have transient contents in a table - f:verbatim, or ordinary template text in Facelets (sometimes even whitespace!), you can get an IndexOutOfBoundsException from UIXCollection.restoreStampState(). UIXCollection is storing stamp state by index - but if a transient component is gone on postback, those indices are now wrong.
This seems related to ADFFACES-350, but that bug describes a NullPointerException.
TranslationsResourceLoader Get Wrong Resourcebundle For Locales Who Have Country Code
From an internal Oracle filer:
org.apache.myfaces.trinidadinternal.resource.TranslationsResourceLoader.java, 
the locale is get using the following mechanism:
.
protected String getLocaleString(FacesContext context)
{
Object localeObj = context.getExternalContext().getRequestParameterMap().
get(&quot;loc&quot;);
return (localeObj == null || &quot;&quot;.equals(localeObj))
? null : localeObj.toString();
}
which returns a string with language code and country code separated by a 
underscore, e.g. zh_cn
.
then it tries to get a Locale object using the following code:
.
Locale locale = LocaleUtils.getLocaleForIANAString(localeStr);
.
while, LocaleUtils.getLocaleForIANAString(String localeStr) can handle only 
locale strings which use a dash as the separator for language code and 
country code, since the parameter passed into this method is separated by a 
underscore, so the parameter is treated as a whole representing language 
code. then a wrong locale object is returned, i.e. new Locale(&quot;zh_CN&quot;,&quot;&quot;) is 
returned instead of new Locale(&quot;zh&quot;,&quot;CN&quot;). finally, the system cannot find a 
resource bundle file whose language code is zh_CN, so it return the resource 
bundle file suffixed by the defult locale of the platform.
.
Generator ant task ignores torque.subpackage.* properties
The ant task for the generator does not pass on any of the torque.subpackage.* properties to the Velocity templates. So the classes end up being generated for the wrong package.
Sandbox dojolayouts.FloatingPaneTag iconSrc error
The implementation of the iconSrc property in the FloatingPaneTag is defective. The property never gets set correctly in the FloatingPaneBase which causes that the property is missing in the dojo widget initialization.
The reason for seems to be, that the iconSrc property is implemented in different upper/lower case combinations throughout the file. The bottom line is that the TAG_PARAM_iconSrc used in setProperties() doesn't match the property name in the FloatingPaneBase.
&lt;t:selectOneCountry&gt; empty selection does not work
&lt;t:selectOneCountry emptySelection=&quot;&quot; 
value=&quot;#{bean.country}&quot;
valueChangeListener=&quot;#{ bean.countryChanged}&quot; 
/&gt; 
When changing country from US to Canada, or from empty selection to US, everything worked fine. But changing from US to empty selection, the backing bean variable &quot;country&quot; was not changed, and the valueChangeListener was not called. I expected the country variable to become null when user selected empty selection. 
Also the empty selection should be turned on/off programactically? OFF - the empty selection does not show up if the country is required.
possible bug in the tomahawk taglib tld the dojo part
Someone reported this bug on the mailing list:
Jan 12, 2007 5:07:21 PM EST&gt; &lt;Error&gt; &lt;HTTP&gt; &lt;BEA-101020&gt; &lt;[ServletContext(id=29811921,name=GISWeb,context-path=/GISWeb)] Servlet failed with Exception
weblogic.servlet.jsp.JspException: (line 4): Error in using tag library uri='http://myfaces.apache.org/tomahawk' prefix='t': type mismatch for property 'debug', for Tag class 'org.apache.myfaces.custom.dojo.DojoInitializerTag': tld says java.lang.Boolean, implementation type is java.lang.String
This seems to be a bug in the tld implementation on the java side of the tag or the tld def itself, it should be boolean, I will look later tonight into it. Somehow weblogic might be more critical in those issues, otherwise Tomcat would have failed as well (which I am testing normally against)
tableSuggestAjax not processing cursor keys properly
Hello,
tableSuggestAjax in current Snapshot of Myfaces Sandbox ( as downloaded 9th of january 2007 from http://people.apache.org/maven-snapshot-repository/org/apache/myfaces/) does not process key events correctly.
Earlier, it was possible to move with cursor keys through the table once it has popped up. Now, 1st row is selected after table has popped up and entering cursor keys up/down shows NO effect any more.
The problem appears with both IE 6.0 and Firefox 2.0. The problem can easily be verified on the IRIAN website:
http://www.irian.at/myfaces-sandbox/home.jsf
What could be the reason for this? Is there a workaround?
Thank you and kind regards,
Robin Lhoest
displayValueOnly on input elements who are required triggers validation
Hi,
using the latest SVN snapshot, I get a validation error message when I use an UIInput (for example InputText) with displayValueOnly=&quot;true&quot; and required=&quot;true&quot;. It is simple to reproduce:
&lt;f:view&gt;
&lt;h:form id=&quot;form&quot;&gt;
&lt;t:inputText id=&quot;input&quot; value=&quot;Test&quot; required=&quot;true&quot; displayValueOnly=&quot;true&quot;/&gt;
&lt;h:commandButton id=&quot;button&quot; value=&quot;press me&quot; action=&quot;success&quot;/&gt;
&lt;h:message id=&quot;message&quot; for=&quot;input&quot;/&gt;
&lt;/h:form&gt;
&lt;/f:view&gt;
The replacement of my value bean lookups by static strings hasn't affected the outcome, a validation error (&quot;input&quot;: Value is required.) is always triggered.
FacesIO is not working with the latest DOJO updates
Beginning from dojo version 0.3.x, FacesIO started to fail and ajax components stopped working when state saving is set to client side.
Wrong urls for JsCookMenu images when cookies are disabled
This issue was originally reported in a comment in:
https://issues.apache.org/jira/browse/TOMAHAWK-11#action_12411892
When cookies are disabled session ids are appended to the theme directory before the actual image path and they don't work in Internet explorer.
In order to reproduce the problem you can simply try the example webapp with IE set to refuse all cookies.
descendants of button with immediate=true can't be immediate=false
following situation:
a button with immediate=true, a popup-facet on this button.
inside this popup a button with no immediate, (or immediate=false).
the action of the button inside the popup is execuded in applyRequestValue phase instead of in invokeApplication.
due to the implementation of queueEvent() in jsf api (tested with myfaces and RI) immediate of UICommand components 
are passed to all descendants
Components inside TabGroup inherits immediate value from TabGroup
required has no effect for tc:file
target attribute of tc:link doesn't work if you specify an action
Avoid double ajax requests
readonly has no effect in tc:selectBooleanCheckbox
The readonly attribute of tc:selectBooleanCheckbox has no effect. It is not rendered into the HTML code.
Binding attribute of TabChangeListenerTag doesn't work in a managed bean
menu mode of the tree doesn't respect width of the layout-manager
DatePicker can't closed when inside other popup
TabGroup has problems if the tabs have a value bindung for rendered
Problem with input validation and tab group
I've got a problem with input validation in a tabGroup with
switchType=&quot;reloadTab&quot;. When I enter an invalid value in an input field
on a tab, I can switch to another tab. The validation of the field is
excuted and failes, but switching tabs is not blocked. When I switch
back to the tab with the invalid field, the field is not marked as
invalid.
With switchType=&quot;reloadPage&quot;, I cannot switch to another tab and the
field is marked as invalid. This is, what I'm expecting.
Exception when using umlauts in confirm component
ButtonRenderer throws an IllegalStateException: Cannot write attribute when start-tag not open. name = 'style'value = 'null'property = 'style' (ButtonRenderer.java:82)
when confirm text contains characters which must be encoded e.g. german umlauts.
AJAX-reload of scrollable Sheets resets scrollbar to top position
A workaround could be to store the scrollbar position before reloading and to set it to the original after the reload is completed ( see attached code fragment exchange-energy-trade_win.js)
This does work theoretically, but the marked lines in the second code fragment (tobago-sheet.js) are resetting the sheet completely again.
-------------
exchange-energy-trade_win.js
function eetReloadOverviewWin() {
// -------- neu von hier--------
var dataDiv = Tobago.element(&quot;marketPage:overviewSheet_data_div&quot;);
var scrollTop = dataDiv.scrollTop;
var scrollLeft = dataDiv.scrollLeft;
// -------- bis hier --------
var options = {
insertion: function(receiver, response) {
if (response.substring(0, 20) == &quot;&lt;status code=\&quot;304\&quot;/&gt;&quot;) {
// no update needed, do nothing
receiver.skipUpdate = true;
} else if (response.substring(0, 11) == &quot;&lt;input id=\&quot;&quot;) {
// update content
Element.update(receiver, response);
// -------- neu von hier--------
var dataDiv2 = Tobago.element(&quot;marketPage:overviewSheet_data_div&quot;);
dataDiv2.scrollTop = scrollTop;
dataDiv2.scrollLeft = scrollLeft;
// -------- bis hier --------
} else {
// unknown response do full page reload
LOG.debug(&quot;initiating full reload&quot;);
var mos = Tobago.element(&quot;marketPage:overviewSheet&quot;);
if (mos != null) {
Tobago.submitAction(&quot;marketPage:overviewSheet&quot;);
} 
}
if (eetOverviewTimeoutWin) {
clearTimeout(eetOverviewTimeoutWin);
}
eetOverviewTimeoutWin = setTimeout(eetReloadOverviewWin, eetGetConfigWin().overviewSheetReloadTimeout);
},
createOverlay: false
};
Tobago.reloadComponent(&quot;marketPage:overviewSheet&quot;, &quot;marketPage:overviewSheet&quot;, options);
}
-------------
resources/html/standard/standard/script/tobago-sheet.js
Tobago.Sheet.prototype.setup = function() {
...
// Problematisches Codefragment, dessen Sinn mir sich nicht erschliet,
// dessen Auskommentierung jedoch das Problem lst. :-)
// -------- von hier --------
// ToDo: find a better way to fix this problem
// IE needs this in case of ajax loading of style classes
var outerDiv = Tobago.element(this.outerDivId);
outerDiv.className = outerDiv.className;
outerDiv.innerHTML = outerDiv.innerHTML;
// -------- bis hier --------
...
}
-------------
css classes for tree are missing after renaming tree to treeOld
the renaming to TreeOldRenderer results in rendering &quot;tobago-treeOld-default&quot; as css class name.
this class is not found in style.css
not possible to collapse a expanded treenode
The renaming of tree to treeOld breaks the possibility to collapse tre nodes. 
tc:box with height on tree display was not able to display scroable body anymore.
I have a tree with a lot of nodes and leafs, It works on tobago 1.0.8 when the tree nodes expanded and reached the max of 200px, it display a vertical scroll bar. Now it does not work anymore on tobago 1.0.9.
&lt;tc:box height=&quot;200px&quot; label=&quot;tree structure&quot;&gt;
&lt;tc:panel&gt; 
&lt;tc:tree value=&quot;#{riskIdentifyController.categoriesTree}&quot;
state=&quot;#{riskIdentifyController.selectedCategories}&quot;
id=&quot;categoriesTree&quot; idReference=&quot;userObject.id&quot;
nameReference=&quot;userObject.name&quot; showIcons=&quot;true&quot; showJunctions=&quot;true&quot;
showRootJunction=&quot;true&quot; showRoot=&quot;true&quot; selectable=&quot;multiLeafOnly&quot;
mutable=&quot;false&quot;&gt;
&lt;/tc:tree&gt;
&lt;/tc:panel&gt;
&lt;/tc:box&gt;
tobago throws an exception after validation form in not English locale
when Tobago validates the form fields it tries to write &quot;title&quot; attribute in not English locale and throws an exception. 
Facelets calls 
renderKit.createResponseWriter(NullWriter.Instance, contentType, encoding); 
with null encoding, and then HtmlWriterUtil.writeEncodedValue calls TobagoResponseWriter.write 
I think TobagoRenderKit should validate encoding and set it to UTF-8 if it's null.
full stack trace.
java.lang.IllegalStateException: Cannot write attribute when start-tag not open. name = 'style'value = 'null'property = 'style' (InRenderer.java:105)
at org.apache.myfaces.tobago.webapp.TobagoResponseWriter.writeAttribute(TobagoResponseWriter.java:361)
at org.apache.myfaces.tobago.webapp.TobagoResponseWriter.writeAttribute(TobagoResponseWriter.java:314)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.InRenderer.encodeEndTobago(InRenderer.java:105)
at org.apache.myfaces.tobago.renderkit.RendererBase.encodeEnd(RendererBase.java:108)
at javax.faces.component.UIComponentBase.encodeEnd(UIComponentBase.java:536)
at org.apache.myfaces.tobago.renderkit.RenderUtil.encode(RenderUtil.java:90)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.GridLayoutRenderer.encodeChildrenOfComponent(GridLayoutRenderer.java:286)
at org.apache.myfaces.tobago.component.UILayout.encodeChildrenOfComponent(UILayout.java:72)
at org.apache.myfaces.tobago.component.UIGridLayout.encodeChildrenOfComponent(UIGridLayout.java:261)
at org.apache.myfaces.tobago.component.UIPanel.encodeChildren(UIPanel.java:44)
at org.apache.myfaces.tobago.renderkit.RenderUtil.encode(RenderUtil.java:82)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.GridLayoutRenderer.encodeChildrenOfComponent(GridLayoutRenderer.java:286)
at org.apache.myfaces.tobago.component.UILayout.encodeChildrenOfComponent(UILayout.java:72)
at org.apache.myfaces.tobago.component.UIGridLayout.encodeChildrenOfComponent(UIGridLayout.java:261)
at org.apache.myfaces.tobago.component.UIPanel.encodeChildren(UIPanel.java:44)
at org.apache.myfaces.tobago.renderkit.RenderUtil.encode(RenderUtil.java:82)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.DefaultLayoutRenderer.encodeChildrenOfComponent(DefaultLayoutRenderer.java:55)
at org.apache.myfaces.tobago.component.UILayout.encodeChildrenOfComponent(UILayout.java:72)
at org.apache.myfaces.tobago.renderkit.RenderUtil.encodeChildren(RenderUtil.java:61)
at org.apache.myfaces.tobago.renderkit.html.speyside.standard.tag.TabGroupRenderer.encodeContent(TabGroupRenderer.java:68)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.TabGroupRenderer.renderTabGroupView(TabGroupRenderer.java:294)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.TabGroupRenderer.encodeEndTobago(TabGroupRenderer.java:152)
at org.apache.myfaces.tobago.renderkit.RendererBase.encodeEnd(RendererBase.java:108)
at javax.faces.component.UIComponentBase.encodeEnd(UIComponentBase.java:536)
at org.apache.myfaces.tobago.component.UITabGroup.encodeEnd(UITabGroup.java:90)
at org.apache.myfaces.tobago.renderkit.RenderUtil.encode(RenderUtil.java:90)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.DefaultLayoutRenderer.encodeChildrenOfComponent(DefaultLayoutRenderer.java:55)
at org.apache.myfaces.tobago.component.UILayout.encodeChildrenOfComponent(UILayout.java:72)
at org.apache.myfaces.tobago.component.UIPanel.encodeChildren(UIPanel.java:44)
at org.apache.myfaces.tobago.renderkit.RenderUtil.encode(RenderUtil.java:82)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.GridLayoutRenderer.encodeChildrenOfComponent(GridLayoutRenderer.java:286)
at org.apache.myfaces.tobago.component.UILayout.encodeChildrenOfComponent(UILayout.java:72)
at org.apache.myfaces.tobago.component.UIGridLayout.encodeChildrenOfComponent(UIGridLayout.java:261)
at org.apache.myfaces.tobago.component.UIPanel.encodeChildren(UIPanel.java:44)
at org.apache.myfaces.tobago.renderkit.RenderUtil.encode(RenderUtil.java:82)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.GridLayoutRenderer.encodeChildrenOfComponent(GridLayoutRenderer.java:286)
at org.apache.myfaces.tobago.component.UILayout.encodeChildrenOfComponent(UILayout.java:72)
at org.apache.myfaces.tobago.component.UIGridLayout.encodeChildrenOfComponent(UIGridLayout.java:261)
at org.apache.myfaces.tobago.component.UIPanel.encodeChildren(UIPanel.java:44)
at org.apache.myfaces.tobago.renderkit.RenderUtil.encode(RenderUtil.java:82)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.GridLayoutRenderer.encodeChildrenOfComponent(GridLayoutRenderer.java:286)
at org.apache.myfaces.tobago.component.UILayout.encodeChildrenOfComponent(UILayout.java:72)
at org.apache.myfaces.tobago.component.UIGridLayout.encodeChildrenOfComponent(UIGridLayout.java:261)
at org.apache.myfaces.tobago.renderkit.html.scarborough.standard.tag.PageRenderer.encodeEndTobago(PageRenderer.java:126)
at org.apache.myfaces.tobago.renderkit.RendererBase.encodeEnd(RendererBase.java:108)
at javax.faces.component.UIComponentBase.encodeEnd(UIComponentBase.java:536)
at com.sun.facelets.tag.jsf.ComponentSupport.encodeRecursive(ComponentSupport.java:242)
at com.sun.facelets.tag.jsf.ComponentSupport.encodeRecursive(ComponentSupport.java:239)
at com.sun.facelets.FaceletViewHandler.renderView(FaceletViewHandler.java:580)
at org.apache.myfaces.lifecycle.LifecycleImpl.render(LifecycleImpl.java:384)
at javax.faces.webapp.FacesServlet.service(FacesServlet.java:138)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:78)
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:77)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:174)
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:77)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at com.fortifier.web.controllers.SecurityFilter.doFilter(SecurityFilter.java:33)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)
at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)
at java.lang.Thread.run(Unknown Source)
Tree on a Tab panel breaks switchtype=reloadTab functionality
A tabgroup with switchtype=reloadTab (ajax reloading) always decodes the first tab, 
this fails if a tree is on the first tab, but another tab was submitted.
This is a problem of the viewId sequence. 
A ajax request should store the view under the same sequenceId that the restored view was.
ServletTilesRequestContext always uses include, causing content-type problems
ServletTilesRequestContext implements the dispatch() method of TilesRequestContext by always using requestDispatcher.include() which means that requests from the template (&quot;outermost&quot; JSP) to set the content type are disregarded. It should use requestDispatcher.forward() unless the response is committed.
PutListTag does not manage its own list
It seems that in the porting to Tiles2, the behavior of the PutListTag managing a list of attributes was lost. I'm not a heavy user of the PutListTag -- I only came across it in testing a fix for TILES-1 -- so it would be good if others could review. Will commit a fix shortly.
Typing in autocompleter does not display dropdown values
Typing in the autocompleter box does not bring back corresponding values for autocompleting. Clicking on arrow does bring up the list, however.
ResourceMatcherImpl not thread safe on multi-CPU system
Load testing on a multi-CPU system uncovered another thread safety issue. I'm not sure why, because I'm unclear on the call flow, but the RegexpMatcher instance held by ResourceMatcherImpl can be called by two threads at once. This leads to predictable ArrayIndexOutOfBounds errors down in the ORO Perl5Matcher class, because that class has instance state that is being accessed by both threads, similar to the SimpleDateFormat issue in TAPESTRY-1229.
I turned it into a ThreadLocal, which worked, but I think that loses some of the pattern caching performance benefits. Not sure what the best solution is, but a ThreadLocal is guaranteed to be safe.
Integration tests in tapestry-core fails because of differences in date formats (locale)
The integration tests fails with the following message:
-------------------------------------------------------------------------------
Test set: Tapestry Core
-------------------------------------------------------------------------------
Tests run: 501, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 89.77 sec &lt;&lt;&lt; FAILURE!
org.apache.tapestry.integration.IntegrationTests.instance_mixin(org.apache.tapestry.integration.IntegrationTests.instance_mixin) Time elapsed: 1.19 sec &lt;&lt;&lt; FAILURE!
java.lang.AssertionError: Page did not contain source '[Ljava.lang.String;@9cf2df'.
at org.apache.tapestry.integration.IntegrationTests.assertSourcePresent(IntegrationTests.java:517)
at org.apache.tapestry.integration.IntegrationTests.instance_mixin(IntegrationTests.java:264)
This seems to be due to hardcoded US formattede dates in the test case in question. Comparing these to dates formatted according to the JVM's or the HTTP sessions locale ends up failing the test.
HTTP headers setting through WebResponse is ignored
The Refresh header is not included into HTTP response. It works fine in 4.1.1.
public void pageBeginRender(PageEvent event) {
getResponse().setIntHeader(&quot;Refresh&quot;, 5);
}
abstract public WebResponse getResponse();
When scriptInFlight, tapestry.loadScriptContent is reinvoked with wrong arguments
tapestry.loadScriptContent is reinvoked using the element's contents as first argument (instead of the element itself)
FaultmediatorFactory does not recognize the the output generated by fault mediator serializer
Following issue was observed when serializing fault mediator.
I inserted following element in to makefault mediator of the synapse configuration.
&lt;code value=&quot;tns:Receiver&quot; xmlns:tns=&quot;http://www.w3.org/2003/05/soap-envelope&quot;/&gt;
When serializing it, the following was generated.
&lt;code value=&quot;{http://www.w3.org/2003/05/soap-envelope}Receiver&quot;/&gt;
This serialized output does not pick up by the fault mediator factory. 
Exception thrown when changing the log level mediator to 'headers'
Following exception is returned when executing the client script with setting the &lt;log level=&quot;headers&quot;/&gt; property in synapse_sample_0.xml file.
stockquote:
[java] org.apache.axis2.AxisFault: unknown
[java] at org.apache.axis2.description.OutInAxisOperationClient.execute(OutInAxisOperation.java:312)
[java] at org.apache.axis2.client.ServiceClient.sendReceive(ServiceClient.java:579)
[java] at org.apache.axis2.client.ServiceClient.sendReceive(ServiceClient.java:508)
[java] at samples.userguide.StockQuoteClient.main(Unknown Source)
[java] Caused by: java.lang.Exception: java.lang.ClassCastException: org.apache.axiom.soap.impl.llom.soap11.SOAP11HeaderBlockImpl
[java] at org.apache.synapse.mediators.builtin.LogMediator.getHeadersLogMessage(LogMediator.java:122)
[java] at org.apache.synapse.mediators.builtin.LogMediator.getLogMessage(LogMediator.java:84)
[java] at org.apache.synapse.mediators.builtin.LogMediator.mediate(LogMediator.java:68)
[java] at org.apache.synapse.mediators.AbstractListMediator.mediate(AbstractListMediator.java:49)
[java] at org.apache.synapse.mediators.base.SynapseMediator.mediate(SynapseMediator.java:55)
[java] at org.apache.synapse.core.axis2.Axis2SynapseEnvironment.injectMessage(Axis2SynapseEnvironment.java:76)
[java] at org.apache.synapse.core.axis2.SynapseMessageReceiver.receive(SynapseMessageReceiver.java:50)
[java] at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:497)
[java] at org.apache.axis2.transport.http.HTTPTransportUtils.processHTTPPostRequest(HTTPTransportUtils.java:326)
[java] at org.apache.axis2.transport.http.HTTPWorker.service(HTTPWorker.java:230)
[java] at org.apache.axis2.transport.http.server.DefaultHttpServiceProcessor.doService(DefaultHttpServiceProcessor.java:190)
[java] at org.apache.http.protocol.HttpService.handleRequest(HttpService.java:123)
[java] at org.apache.axis2.transport.http.server.DefaultHttpServiceProcessor.run(DefaultHttpServiceProcessor.java:262)
[java] at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:665)
[java] at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:690)
[java] at java.lang.Thread.run(Thread.java:595)
[java] at org.apache.axis2.AxisFault.&lt;init&gt;(AxisFault.java:159)
[java] ... 4 more
Steps to rerpoduce:
===============
1. Start the Synapse configuration numbered 0: i.e. synapse -sample 0
2. Start the Axis2 server and deploy the SimpleStockQuoteService
3. Change log level in synapse_sample_0.xml file (Change to &quot;headers&quot;)
3. Execute the smart client (i.e:-ant stockquote)
LinkTag renders the link twice
The LinkTag now renders the link twice. The doEndTag() method has the following line duplicated:
TagUtils.getInstance().write(pageContext, results.toString());
[NO_EXTENSIONS] stringbuf::str(const char*) inaccessible
$ cat t.cpp &amp;&amp; make t CPPOPTS=-D_RWSTD_NO_EXTENSIONS
#include &lt;sstream&gt;
int main ()
{
std::stringbuf sb;
sb.str (&quot;&quot;);
}
eccp -c -I/build/sebor/dev/stdlib/include/ansi -D_RWSTDDEBUG -D_RWSTD_USE_CONFIG -I/build/sebor/dev/stdlib/include -I/build/sebor/eccp-3.8-11s/include -I/build/sebor/dev/stdlib/include/ansi -I/build/sebor/PlumHall/lvs06a/conform -I/build/sebor/PlumHall/lvs06a/dst.3 -D_RWSTD_NO_EXTENSIONS -A -x --template_directory=/build/sebor/eccp-3.8-11s/lib -g --display_error_number --remarks --diag_suppress 193,236,340,401,261,479,487,678,679,815 --diag_suppress 177,381,191,68,550,611,997,549 t.cpp
&quot;t.cpp&quot;, line 7: error #265-D: function &quot;std::basic_stringbuf&lt;_CharT, _Traits,
_Allocator&gt;::str(const _CharT *, unsigned int) [with _CharT=char,
_Traits=std::char_traits&lt;char&gt;, _Allocator=std::allocator&lt;char&gt;]&quot;
(declared at line 139 of &quot;/build/sebor/dev/stdlib/include/sstream&quot;)
is inaccessible
sb.str (&quot;&quot;);
^
1 error detected in the compilation of &quot;t.cpp&quot;.
make: *** [t.o] Error 2
std::ios_base::io_state not an integer type
depr.ios.members, p2 requires that std::ios_base::io_state be an integer type. The program below fails to compile, indicating that in stdcxx it is not:
$ cat t.cpp &amp;&amp; make t
#include &lt;ios&gt;
int main ()
{
const int i = 1;
std::ios_base::io_state s = i;
}
eccp -c -I/build/sebor/dev/stdlib/include/ansi -D_RWSTDDEBUG -D_RWSTD_USE_CONFIG -I/build/sebor/dev/stdlib/include -I/build/sebor/eccp-3.8-11s/include -I/build/sebor/dev/stdlib/include/ansi -I/build/sebor/PlumHall/lvs06a/conform -I/build/sebor/PlumHall/lvs06a/dst.3 -A -x --template_directory=/build/sebor/eccp-3.8-11s/lib -g --display_error_number --remarks --diag_suppress 193,236,340,401,261,479,487,678,679,815 --diag_suppress 177,381,191,68,550,611,997,549 t.cpp
&quot;t.cpp&quot;, line 6: error #144: a value of type &quot;int&quot; cannot be used to
initialize an entity of type &quot;std::ios_base::io_state&quot;
std::ios_base::io_state s = i;
^
1 error detected in the compilation of &quot;t.cpp&quot;.
make: *** [t.o] Error 2
std::div_t, std::ldiv_t missing members quot and rem
The C standard(7.20.6.2, p3) requires the structs div_t and ldiv_t to contain the members quot and rem. We seem to be missing them:
$ cat t.cpp &amp;&amp; make t
#include &lt;cstdlib&gt;
int main ()
{
const std::div_t x = { };
const std::ldiv_t y = { };
return x.quot + x.rem + y.quot + y.rem;
}
eccp -c -I/build/sebor/dev/stdlib/include/ansi -D_RWSTDDEBUG -D_RWSTD_USE_CONFIG -I/build/sebor/dev/stdlib/include -I/build/sebor/eccp-3.8-11s/include -I/build/sebor/dev/stdlib/include/ansi -I/build/sebor/PlumHall/lvs06a/conform -I/build/sebor/PlumHall/lvs06a/dst.3 -A -x --template_directory=/build/sebor/eccp-3.8-11s/lib -g --display_error_number --remarks --diag_suppress 193,236,340,401,261,479,487,678,679,815 --diag_suppress 177,381,191,68,550,611,997,549 t.cpp
&quot;t.cpp&quot;, line 8: error #135: class &quot;std::div_t&quot; has no member &quot;quot&quot;
return x.quot + x.rem + y.quot + y.rem;
^
&quot;t.cpp&quot;, line 8: error #135: class &quot;std::div_t&quot; has no member &quot;rem&quot;
return x.quot + x.rem + y.quot + y.rem;
^
&quot;t.cpp&quot;, line 8: error #135: class &quot;std::ldiv_t&quot; has no member &quot;quot&quot;
return x.quot + x.rem + y.quot + y.rem;
^
&quot;t.cpp&quot;, line 8: error #135: class &quot;std::ldiv_t&quot; has no member &quot;rem&quot;
return x.quot + x.rem + y.quot + y.rem;
^
4 errors detected in the compilation of &quot;t.cpp&quot;.
make: *** [t.o] Error 2
std::div(long, long) overload missing from &lt;cstdlib&gt;
The well-formed program below fails to compile with 4.1.2. According to c.math, p8, the C++ header &lt;cstdlib&gt; adds an overload of div(long, long) that returns ldiv_t to the C function div(int, int) that returns div_t. Looks like we're missing that overload.
$ cat t.cpp &amp;&amp; make t
#include &lt;cstdlib&gt;
int main ()
{
std::ldiv_t x = std::div (1L, 1L);
}
eccp -c -I/build/sebor/dev/stdlib/include/ansi -D_RWSTDDEBUG -D_RWSTD_USE_CONFIG -I/build/sebor/dev/stdlib/include -I/build/sebor/eccp-3.8-11s/include -I/build/sebor/dev/stdlib/include/ansi -I/build/sebor/PlumHall/lvs06a/conform -I/build/sebor/PlumHall/lvs06a/dst.3 -A -x --template_directory=/build/sebor/eccp-3.8-11s/lib -g --display_error_number --remarks --diag_suppress 193,236,340,401,261,479,487,678,679,815 --diag_suppress 177,381,191,68,550,611,997,549 t.cpp
&quot;t.cpp&quot;, line 5: error #312: no suitable user-defined conversion from
&quot;std::div_t&quot; to &quot;std::ldiv_t&quot; exists
std::ldiv_t x = std::div (1L, 1L);
^
1 error detected in the compilation of &quot;t.cpp&quot;.
make: *** [t.o] Error 2
std::complex&lt;T&gt;::operator=(complex&lt;U&gt;) inaccessible
The well-formed program below fails to compile:
$ cat t.cpp &amp;&amp; make t
#include &lt;complex&gt;
int main ()
{
std::complex&lt;float&gt; a;
std::complex&lt;double&gt; b;
a = b;
}
eccp -c -I/build/sebor/dev/stdlib/include/ansi -D_RWSTDDEBUG -D_RWSTD_USE_CONFIG -I/build/sebor/dev/stdlib/include -I/build/sebor/eccp-3.8-11s/include -I/build/sebor/dev/stdlib/include/ansi -I/build/sebor/PlumHall/lvs06a/conform -I/build/sebor/PlumHall/lvs06a/dst.3 -A -x --template_directory=/build/sebor/eccp-3.8-11s/lib -g --display_error_number --remarks --diag_suppress 193,236,340,401,261,479,487,678,679,815 --diag_suppress 177,381,191,68,550,611,997,549 t.cpp
&quot;/build/sebor/dev/stdlib/include/complex&quot;, line 150: error #265-D: member
&quot;std::complex&lt;double&gt;::_C_re&quot; (declared at line 280) is inaccessible
return (_C_re = __rhs._C_re), (_C_im = __rhs._C_im), *this;
^
detected during instantiation of &quot;std::complex&lt;float&gt;
&amp;std::complex&lt;float&gt;::operator=(const std::complex&lt;_TypeT&gt;
&amp;) [with _TypeT=double]&quot; at line 8 of &quot;t.cpp&quot;
&quot;/build/sebor/dev/stdlib/include/complex&quot;, line 150: error #265-D: member
&quot;std::complex&lt;double&gt;::_C_im&quot; (declared at line 280) is inaccessible
return (_C_re = __rhs._C_re), (_C_im = __rhs._C_im), *this;
^
detected during instantiation of &quot;std::complex&lt;float&gt;
&amp;std::complex&lt;float&gt;::operator=(const std::complex&lt;_TypeT&gt;
&amp;) [with _TypeT=double]&quot; at line 8 of &quot;t.cpp&quot;
2 errors detected in the compilation of &quot;t.cpp&quot;.
make: *** [t.o] Error 2
[EDG eccp] error passing SIG_ERR, SIG_IGN to signal()
$ cat t.cpp &amp;&amp; make t
#include &lt;csignal&gt;
int main ()
{
std::signal (SIGABRT, SIG_DFL);
std::signal (SIGABRT, SIG_ERR);
std::signal (SIGABRT, SIG_IGN);
}
eccp -c -I/build/sebor/dev/stdlib/include/ansi -D_RWSTDDEBUG -D_RWSTD_USE_CONFIG -I/build/sebor/dev/stdlib/include -I/build/sebor/eccp-3.8-11s/include -I/build/sebor/dev/stdlib/include/ansi -I/build/sebor/PlumHall/lvs06a/conform -I/build/sebor/PlumHall/lvs06a/dst.3 -A -x --template_directory=/build/sebor/eccp-3.8-11s/lib -g --display_error_number --remarks --diag_suppress 193,236,340,401,261,479,487,678,679,815 --diag_suppress 177,381,191,68,550,611,997,549 t.cpp
&quot;t.cpp&quot;, line 6: error #167: argument of type &quot;int&quot; is incompatible with
parameter of type &quot;void (*)(int) C&quot;
std::signal (SIGABRT, SIG_ERR);
^
&quot;t.cpp&quot;, line 7: error #167: argument of type &quot;int&quot; is incompatible with
parameter of type &quot;void (*)(int) C&quot;
std::signal (SIGABRT, SIG_IGN);
^
2 errors detected in the compilation of &quot;t.cpp&quot;.
make: *** [t.o] Error 2
std::valarray::cshift uses uninitialized storage
The program below is designed to detect memory corruption (such as the use of uninitialized storage) in valarray. When compiled with the latest trunk it aborts at runtime. 
$ cat t.cpp &amp;&amp; nice gmake t &amp;&amp; ./t
#include &lt;cassert&gt;
#include &lt;valarray&gt;
struct S {
const S* const self;
S (): self (this) { }
S (const S &amp;s): self (this) { assert (&amp;s == s.self); }
~S () { assert (this == self); }
void operator= (const S &amp;s) { assert (this == self &amp;&amp; &amp;s == s.self); }
};
int main ()
{
const std::valarray&lt;S&gt; a (2);
a.cshift (1);
} 
aCC -c -I/nfs/devco/sebor/dev/stdlib/include/ansi -I/usr/include -D_RWSTDDEBUG -mt -D_RWSTD_USE_CONFIG -I/nfs/devco/sebor/dev/stdlib/include -I/build/sebor/aCC-3.70-15S/include -I/nfs/devco/sebor/dev/stdlib/examples/include -Aa +nostl -g +d +DD64 +w +W392 +W655 +W684 +W818 +W819 +W849 t.cpp
aCC t.o -o t -Aa +nostl -Wl,+s -Wl,+vnocompatwarnings -mt +DD64 -L/build/sebor/aCC-3.70-15S/lib -lstd15S -lm 
Assertion failed: this == self &amp;&amp; &amp;s == s.self, file t.cpp, line 10
ABORT instruction (core dumped)
XML parsing error with resin-3.0.21
When the resin XML parser starts, it gets the following error trying to parse the config file:
[00:25:35.025] Caused by: java.lang.NumberFormatException: empty String
[00:25:35.025] at
sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:994)
[00:25:35.025] at java.lang.Float.parseFloat(Float.java:394)
[00:25:35.025] at org.apache.solr.core.Config.getFloat(Config.java:174)
[00:25:35.025] at
org.apache.solr.schema.IndexSchema.readConfig(IndexSchema.java:273)
see: http://www.mail-archive.com/solr-dev@lucene.apache.org/msg01852.html
Webconsole does not work in Internet Explorer 7
I find that the webconsole for Servicemix does not work in Internet Explorer 
7. It works fine in Firefox, though. 
The HTML code is generated and returned to IE, but that browser does not 
render the HTML, but just displays a blank page. 
useless include log framwork into jboss deployer
Exception raise when commons-logging and log4j jar are included into sar jboss deployer
00:51:07,136 INFO [Server] JBoss (MX MicroKernel) [4.0.5.GA (build: CVSTag=Branch_4_0 date=200610162339)] Started in 1m:58s:2ms
00:51:22,446 ERROR [STDERR] log4j:ERROR A &quot;org.jboss.logging.util.OnlyOnceErrorHandler&quot; object is not assignable to a &quot;org.apache.log4j.spi.ErrorHandler&quot; variable.
00:51:22,447 ERROR [STDERR] log4j:ERROR The class &quot;org.apache.log4j.spi.ErrorHandler&quot; was loaded by 
00:51:22,447 ERROR [STDERR] log4j:ERROR [org.jboss.mx.loading.UnifiedClassLoader3@108f060{ url=file:/home/keo/EclipseWorkspace/workspace_3.2.SMX.TEST/jboss-4.0.5.GA/server/default/tmp/deploy/tmp61318servicemix-jboss-deployer-3.1-SNAPSHOT.sar ,addedOrder=40}] whereas object of type 
00:51:22,447 ERROR [STDERR] log4j:ERROR &quot;org.jboss.logging.util.OnlyOnceErrorHandler&quot; was loaded by [org.jboss.system.server.NoAnnotationURLClassLoader@19616c7].
00:51:22,489 ERROR [STDERR] log4j:ERROR Could not create an Appender. Reported error follows.
00:51:22,489 ERROR [STDERR] java.lang.ClassCastException: org.jboss.logging.appender.DailyRollingFileAppender
00:51:22,490 ERROR [STDERR] at org.apache.log4j.xml.DOMConfigurator.parseAppender(DOMConfigurator.java:175)
00:51:22,490 ERROR [STDERR] at org.apache.log4j.xml.DOMConfigurator.findAppenderByName(DOMConfigurator.java:150)
00:51:22,490 ERROR [STDERR] at org.apache.log4j.xml.DOMConfigurator.findAppenderByReference(DOMConfigurator.java:163)
00:51:22,490 ERROR [STDERR] at org.apache.log4j.xml.DOMConfigurator.parseChildrenOfLoggerElement(DOMConfigurator.java:425)
00:51:22,491 ERROR [STDERR] at org.apache.log4j.xml.DOMConfigurator.parseRoot(DOMConfigurator.java:394)
00:51:22,491 ERROR [STDERR] at org.apache.log4j.xml.DOMConfigurator.parse(DOMConfigurator.java:829)
00:51:22,491 ERROR [STDERR] at org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:712)
00:51:22,491 ERROR [STDERR] at org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:618)
00:51:22,491 ERROR [STDERR] at org.apache.log4j.helpers.OptionConverter.selectAndConfigure(OptionConverter.java:468)
00:51:22,491 ERROR [STDERR] at org.apache.log4j.LogManager.&lt;clinit&gt;(LogManager.java:122)
00:51:22,491 ERROR [STDERR] at org.apache.log4j.Logger.getLogger(Logger.java:104)
00:51:22,491 ERROR [STDERR] at org.apache.commons.logging.impl.Log4JLogger.getLogger(Log4JLogger.java:283)
00:51:22,491 ERROR [STDERR] at org.apache.commons.logging.impl.Log4JLogger.&lt;init&gt;(Log4JLogger.java:108)
00:51:22,491 ERROR [STDERR] at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
00:51:22,491 ERROR [STDERR] at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
00:51:22,491 ERROR [STDERR] at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
00:51:22,492 ERROR [STDERR] at java.lang.reflect.Constructor.newInstance(Constructor.java:494)
00:51:22,492 ERROR [STDERR] at org.apache.commons.logging.impl.LogFactoryImpl.createLogFromClass(LogFactoryImpl.java:1040)
00:51:22,492 ERROR [STDERR] at org.apache.commons.logging.impl.LogFactoryImpl.discoverLogImplementation(LogFactoryImpl.java:838)
00:51:22,492 ERROR [STDERR] at org.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactoryImpl.java:601)
00:51:22,492 ERROR [STDERR] at org.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:333)
00:51:22,492 ERROR [STDERR] at org.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:307)
00:51:22,492 ERROR [STDERR] at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:645)
00:51:22,492 ERROR [STDERR] at org.apache.servicemix.jbi.container.JBIContainer.&lt;clinit&gt;(JBIContainer.java:95)
00:51:22,492 ERROR [STDERR] at org.servicemix.jboss.deployment.JBIService.&lt;init&gt;(JBIService.java:45)
Remove the CONTENT_DOCUMENT_PROPERTY property in SourceTransformer to avoid using an old message when properties are forwarded between components
See http://www.nabble.com/Correlation-ID-lost-after-XSLT-component-tf2945039s12049.html
Note that this logic could be put inside the NormalizedMessage itself,
as it would be safe. Same for the POJO stuff.
[patch] Unique Column Names for JdbcComponent
HI 
using the JdbcComponent with a SQL Statement returing a ResultSet with two or more equal columnnames results in an invalid XML document.
Example:
SQL Statement
SELECT * FROM TABLE1, TABLE2 WHERE TABLE1.ID = TABLE2.ID
Resulting XML:
--- 8&lt; ---
&lt;sqlResults&gt;
&lt;resultSet&gt;
&lt;row id=&quot;1&quot; id=&quot;1&quot;/&gt;
...
--- 8&lt; ---
The column Names in this example are not unique.
The attached patch solves this issue.
The resulting document would look like this:
--- 8&lt; ---
&lt;sqlResults&gt;
&lt;resultSet&gt;
&lt;row id=&quot;1&quot; id_1=&quot;1&quot;/&gt;
...
--- 8&lt; ---
Test Case available.
Kristian
Remove Xalan dependency in SourceTransformer (was: Servicemix jboss deployer)
The servicemix-jboss-deployer-3.1-SNAPSHOT.sar file generated by the jboss depolyer does not include the xalan-2.7.0.jar file in the lib. This is required by servicemix and is not included in jboss.
Adding the jar to the .sar file fixed the issue.
Incompatible BPELWSDLLocator between wsdl4j-1.5.2 and wsdl4j-1.6.1
There is a incompatiblity with the new version of wsdl4j 1.6.2.
we have this runtime exception when we deploy loan-broker-bpel (sample) 
into the standard SMX. 
java.lang.AbstractMethodError: org.apache.ode.bpe.deployment.bpel.BPELWSDLLocator.close()V
at com.ibm.wsdl.xml.WSDLReaderImpl.readWSDL(Unknown Source)
at org.apache.ode.bpe.deployment.bpel.ExtensibilityArtifacts.getRootWSDL(ExtensibilityArtifacts.java:759)
at org.apache.ode.bpe.deployment.bpel.ExtensibilityArtifacts.&lt;init&gt;(ExtensibilityArtifacts.java:130)
at org.apache.ode.bpe.deployment.bpel.BPELRepositoryHandler.&lt;init&gt;(BPELRepositoryHandler.java:92)
at org.apache.ode.bpe.deployment.bpel.BPELSAXHandler.&lt;init&gt;(BPELSAXHandler.java:63)
at org.apache.ode.bpe.deployment.bpel.BPELParser.parseBPEL(BPELParser.java:94)
at org.apache.ode.bpe.deployment.bpel.BPELDeploy.deployJar(BPELDeploy.java:177)
at org.apache.ode.bpe.bped.unmanaged.BPELDeployerSLImpl.loadDefinition(BPELDeployerSLImpl.java:78)
at org.apache.servicemix.bpe.BPEDeployer.deploy(BPEDeployer.java:86)
org.apache.ode.bpe.deployment.bpel.BPELWSDLLocator didn't implements any close method
to close m_source object attribut. 
NB: to work around use instead wsdl5j-1.5.2.jar
a first fix could be into org.apache.ode.bpe.deployment.bpel.BPELWSDLLocator
/**
* @see javax.wsdl.xml.WSDLLocator#close()
*/
public void close() {
// Nothing To Do, m_source doesn't have any close method
}
Regards
Grgoire A.
Documentation for XPath Router is missing examples
The page that documents the XPath Router has blank areas where the examples should be. See the page at http://www.servicemix.org/site/xpath-router.html, which includes sentences such as &quot;The following is an example routing and transformation template,&quot; followed by a couple of blank lines.
Based on a similar CodeHaus page (http://servicemix.codehaus.org/XPath+Router), which also fails to show the examples, but which displays error messages, I believe the problem is due to bad server-side includes.
The files which are intended to be included on the page seem to be the following (all of which are distributed with the ServiceMix release):
src/servicemix-components/src/test/resources/org/apache/servicemix/components/xslt/router-example.xml
src/servicemix-components/src/test/resources/org/apache/servicemix/components/xslt/router.xsl
src/servicemix-components/src/test/resources/org/apache/servicemix/components/xslt/split.xsl
Refactor the Auditor MBean interface to avoid method overloading (which cause problems with JMX)
can not deploy bridge-sa in apache-servicemix-3.1-incubating-SNAPSHOT + Geronimo 1.2 Beta
deploy bridge-sa in apache-servicemix-3.1-incubating-SNAPSHOT + Geronimo 1.2 Beta
get the following exception:
16:36:22,180 INFO [FileSystemXmlApplicationContext] Unable to locate ApplicationEventMulticaster with name 'applicationEventMulticaster': using default [org.springframework.context.event.SimpleApplicationEventMulticaster@96d979]
16:36:22,180 INFO [DefaultListableBeanFactory] Pre-instantiating singletons in factory [org.springframework.beans.factory.support.DefaultListableBeanFactory defining beans [org.apache.servicemix.jms.JmsEndpoint,connectionFactory]; root of BeanFactory hierarchy]
16:36:22,190 INFO [ServiceUnitLifeCycle] Starting service unit: bridge-http-su
16:36:22,210 INFO [ServiceAssembly] doFail called for JBI service assembly: bridge-sa
16:36:22,210 ERROR [GBeanInstanceState] Error while starting; GBean is now in the FAILED state: abstractName=&quot;servicemix-assemblies/bridge-sa/0.0/car?jbiType=JBIServiceAssembly,name=bridge-sa&quot;
java.lang.NoClassDefFoundError: javax/xml/stream/XMLStreamWriter
at org.apache.servicemix.http.processors.ConsumerProcessor.&lt;init&gt;(ConsumerProcessor.java:79)
at org.apache.servicemix.http.HttpEndpoint.createConsumerProcessor(HttpEndpoint.java:300)
at org.apache.servicemix.soap.SoapEndpoint.activate(SoapEndpoint.java:346)
at org.apache.servicemix.common.ServiceUnit.start(ServiceUnit.java:55)
at org.apache.servicemix.common.BaseServiceUnitManager.start(BaseServiceUnitManager.java:151)
at org.apache.servicemix.jbi.framework.ServiceUnitLifeCycle.start(ServiceUnitLifeCycle.java:103)
at org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(ServiceAssemblyLifeCycle.java:130)
at org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(ServiceAssemblyLifeCycle.java:105)
at org.apache.servicemix.geronimo.ServiceMixGBean.register(ServiceMixGBean.java:201)
at org.apache.servicemix.geronimo.ServiceMixGBean$$FastClassByCGLIB$$fcdcf76b.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:820)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.servicemix.geronimo.Container$$EnhancerByCGLIB$$d7d47bd7.register(&lt;generated&gt;)
at org.apache.servicemix.geronimo.ServiceAssembly.doStart(ServiceAssembly.java:55)
at org.apache.geronimo.gbean.runtime.GBeanInstance.createInstance(GBeanInstance.java:984)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:267)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.startRecursive(GBeanInstanceState.java:124)
at org.apache.geronimo.gbean.runtime.GBeanInstance.startRecursive(GBeanInstance.java:543)
at org.apache.geronimo.kernel.basic.BasicKernel.startRecursiveGBean(BasicKernel.java:379)
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:378)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:527)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:508)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:820)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$e4cc81a5.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.deployment.plugin.local.StartCommand.run(StartCommand.java:67)
at java.lang.Thread.run(Thread.java:595)
Cannot start Bridge-SA in Geronimo 1.1 + Servicemix 3.0.1 plugin
Installed deployer-3.0.1-incubating.car &amp; servicemix-3.0.1-incubating.car plugin in Geronimo 1.1, and deploy all Servicemix 3.0.1 components in Geronimo 1.1,
. servicemix-bpe-3.0.1-incubating-installer.zip 
. servicemix-eip-3.0.1-incubating-installer.zip 
. servicemix-http-3.0.1-incubating-installer.zip 
. servicemix-jms-3.0.1-incubating-installer.zip 
. servicemix-jsr181-3.0.1-incubating-installer.zip 
. servicemix-lwcontainer-3.0.1-incubating-installer.zip 
. servicemix-sca-3.0.1-incubating-installer.zip 
. servicemix-shared-3.0.1-incubating-installer.zip 
. servicemix-wsn2005-3.0.1-incubating-installer.zip 
then deploy bridge-sa-3.0.1-incubating.zip and get the following error
17:33:56,166 INFO [BrokerService] ActiveMQ 4.0.2 JMS Message Broker (localhost) is starting
17:33:56,166 INFO [BrokerService] For help or more information please see: http://incubator.apache.org/activemq/
17:33:56,506 INFO [ServiceAssembly] doFail called for JBI service assembly: bridge-sa
17:33:56,506 ERROR [GBeanInstanceState] Error while starting; GBean is now in the FAILED state: abstractName=&quot;servicemix-assemblies/bridge-sa/0.0/car?jbiType=JBIServiceAssembly,name=bridge-sa&quot;
java.lang.NoClassDefFoundError: org/apache/derby/jdbc/EmbeddedDataSource
at org.apache.activemq.store.DefaultPersistenceAdapterFactory.createDataSource(DefaultPersistenceAdapterFactory.java:187)
at org.apache.activemq.store.DefaultPersistenceAdapterFactory.getDataSource(DefaultPersistenceAdapterFactory.java:96)
at org.apache.activemq.store.DefaultPersistenceAdapterFactory.createPersistenceAdapter(DefaultPersistenceAdapterFactory.java:54)
at org.apache.activemq.broker.BrokerService.createPersistenceAdapter(BrokerService.java:968)
at org.apache.activemq.broker.BrokerService.getPersistenceAdapter(BrokerService.java:559)
at org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:929)
at org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:888)
at org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:458)
at org.apache.activemq.broker.BrokerService.start(BrokerService.java:361)
at org.apache.activemq.transport.vm.VMTransportFactory.doCompositeConnect(VMTransportFactory.java:102)
at org.apache.activemq.transport.vm.VMTransportFactory.doConnect(VMTransportFactory.java:48)
at org.apache.activemq.transport.TransportFactory.doConnect(TransportFactory.java:42)
at org.apache.activemq.transport.TransportFactory.connect(TransportFactory.java:76)
at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:223)
at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:211)
at org.apache.activemq.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:158)
at org.apache.servicemix.jms.AbstractJmsProcessor.start(AbstractJmsProcessor.java:74)
at org.apache.servicemix.soap.SoapEndpoint.activate(SoapEndpoint.java:351)
at org.apache.servicemix.common.ServiceUnit.start(ServiceUnit.java:50)
at org.apache.servicemix.common.BaseServiceUnitManager.start(BaseServiceUnitManager.java:149)
at org.apache.servicemix.jbi.framework.ServiceUnitLifeCycle.start(ServiceUnitLifeCycle.java:103)
at org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(ServiceAssemblyLifeCycle.java:130)
at org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(ServiceAssemblyLifeCycle.java:105)
at org.apache.servicemix.geronimo.ServiceMixGBean.register(ServiceMixGBean.java:216)
at org.apache.servicemix.geronimo.ServiceMixGBean$$FastClassByCGLIB$$fcdcf76b.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.servicemix.geronimo.Container$$EnhancerByCGLIB$$6a556a4d.register(&lt;generated&gt;)
at org.apache.servicemix.geronimo.ServiceAssembly.doStart(ServiceAssembly.java:55)
at org.apache.geronimo.gbean.runtime.GBeanInstance.createInstance(GBeanInstance.java:981)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:267)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.startRecursive(GBeanInstanceState.java:124)
at org.apache.geronimo.gbean.runtime.GBeanInstance.startRecursive(GBeanInstance.java:540)
at org.apache.geronimo.kernel.basic.BasicKernel.startRecursiveGBean(BasicKernel.java:379)
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:374)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:512)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:493)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$774d701b.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.deployment.plugin.local.StartCommand.run(StartCommand.java:67)
at java.lang.Thread.run(Thread.java:595)
I modify the file servicemix-3.0.1/geronimo/servicemix/src/plan/geronimo-service.xml, and bridge-sa can work fine.
...
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;woodstox&lt;/groupId&gt;
&lt;artifactId&gt;wstx-asl&lt;/artifactId&gt;
&lt;version&gt;${woodstox-version}&lt;/version&gt;
&lt;type&gt;jar&lt;/type&gt;
&lt;/dependency&gt;
&lt;!--add derby dependency --&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.apache.derby&lt;/groupId&gt;
&lt;artifactId&gt;derby&lt;/artifactId&gt;
&lt;version&gt;10.1.1.0&lt;/version&gt;
&lt;type&gt;jar&lt;/type&gt;
&lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;/environment&gt;
Xiaoxiong, Duan
build fails under java 6
mvn -Dmaven.test.skip=true -Dprofile=step2 install
...
[INFO] [compiler:compile]
Compiling 114 source files to /home/tbiernat/work/servicemix/apache-servicemix-3.0-incubating/src/servicemix-components/target/classes
[INFO] ------------------------------------------------------------------------
[ERROR] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Compilation failure
/home/tbiernat/work/servicemix/apache-servicemix-3.0-incubating/src/servicemix-components/src/main/java/org/apache/servicemix/components/script/ScriptComponent.java:[210,36] cannot find symbol
symbol : method createNamespace()
location: interface javax.script.ScriptEngine
/home/tbiernat/work/servicemix/apache-servicemix-3.0-incubating/src/servicemix-components/src/main/java/org/apache/servicemix/components/script/ScriptComponent.java:[261,26] cannot find symbol
symbol : method eval(javax.script.Namespace)
location: class javax.script.CompiledScript
/home/tbiernat/work/servicemix/apache-servicemix-3.0-incubating/src/servicemix-components/src/main/java/org/apache/servicemix/components/script/ScriptComponent.java:[269,14] cannot find symbol
symbol : method eval(java.lang.String,javax.script.Namespace)
location: interface javax.script.ScriptEngine
Broken links in 'Shale Commons Validator Integration'
The section 'Shale Commons Validator Integration' has some broken links. Below is the patch to correct them:
--- index.xml 2007-01-23 16:05:20.796875000 -0300
+++ index-corrected.xml 2007-01-23 16:19:44.437500000 -0300
@@ -53,9 +53,9 @@
&lt;subsection name=&quot;Services Provided&quot;&gt;
&lt;p&gt;Shale provides three JSP tags that let you use the Commons Validator:
- &lt;a href=&quot;shale-core/tagreference-taglib.html#s:commonsValidator&quot;&gt;&lt;code&gt;s:commonsValidator&lt;/code&gt;&lt;/a&gt;,
- &lt;a href=&quot;shale-core/tagreference-taglib.html#s:validatorVar&quot;&gt;&lt;code&gt;s:validatorVar&lt;/code&gt;&lt;/a&gt;,
- and &lt;a href=&quot;shale-core/tagreference-taglib.html#s:validatorScript&quot;&gt;&lt;code&gt;s:validatorScript&lt;/code&gt;&lt;/a&gt;. The
+ &lt;a href=&quot;tagreference.html#commonsValidator&quot;&gt;&lt;code&gt;s:commonsValidator&lt;/code&gt;&lt;/a&gt;,
+ &lt;a href=&quot;tagreference.html#validatorVar&quot;&gt;&lt;code&gt;s:validatorVar&lt;/code&gt;&lt;/a&gt;,
+ and &lt;a href=&quot;tagreference.html#validatorScript&quot;&gt;&lt;code&gt;s:validatorScript&lt;/code&gt;&lt;/a&gt;. The
first two lets you attach a commons validator to a JSF input component and
the third generates JavaScript validation code for validating each JSF component
that has one or more Commons validators in a particular form. You can attach as 
@@ -155,12 +155,12 @@
&lt;p&gt;To replace one of the provided rules,
place a modified copy of 
- &lt;a href=&quot;http://svn.apache.org/repos/asf/shale/framework/trunk/shale-core/src/main/resources/org/apache/shale/validator/validator-rules.xml&quot;&gt;validator-rules.xml&lt;/a&gt;
+ &lt;a href=&quot;http://svn.apache.org/repos/asf/shale/framework/trunk/shale-validator/src/main/resources/org/apache/shale/validator/validator-rules.xml&quot;&gt;validator-rules.xml&lt;/a&gt;
in your webapp, and refer to it instead of the default file.&lt;/p&gt;
&lt;p&gt;To add messages for your own validation rules, or to
customize the 
- &lt;a href=&quot;http://svn.apache.org/repos/asf/shale/framework/trunk/shale-core/src/main/resources/org/apache/shale/validator/messages.properties&quot;&gt;provided messages,&lt;/a&gt;
+ &lt;a href=&quot;http://svn.apache.org/repos/asf/shale/framework/trunk/shale-validator/src/main/resources/org/apache/shale/validator/messages.properties&quot;&gt;provided messages,&lt;/a&gt;
configure a message bundle for your application in 
/WEB-INF/faces-config.xml.&lt;/p&gt;
ConcurrentModificationException in ViewPhaseListener.afterRenderResponse
RENDER_RESPONSE(6) afterPhase
java.util.ConcurrentModificationException
at java.util.HashMap$HashIterator.nextEntry(HashMap.java:942)
at java.util.HashMap$KeyIterator.next(HashMap.java:978)
at com.ibm.ws.webcontainer.srt.SRTServletRequest$1.nextElement(SRTServletRequest.java:177)
at org.apache.myfaces.context.servlet.AbstractAttributeMap$KeyIterator.next(AbstractAttributeMap.java:210)
at org.apache.myfaces.context.servlet.AbstractAttributeMap$EntryIterator.next(AbstractAttributeMap.java:306)
at org.apache.shale.view.faces.ViewPhaseListener.afterRenderResponse(ViewPhaseListener.java:233)
at org.apache.shale.view.faces.ViewPhaseListener.afterPhase(ViewPhaseListener.java:106)
at org.apache.myfaces.lifecycle.PhaseListenerManager.informPhaseListenersAfter(PhaseListenerManager.java:89)
at org.apache.myfaces.lifecycle.LifecycleImpl.render(LifecycleImpl.java:391)
at javax.faces.webapp.FacesServlet.service(FacesServlet.java:138)
at org.apache.myfaces.webapp.MyFacesServlet.service(MyFacesServlet.java:74)
at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1282)
at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1239)
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:136)
at org.apache.myfaces.webapp.filter.ExtensionsFilter.doFilter(ExtensionsFilter.java:144)
at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:142)
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:121)
at org.ajax4jsf.framework.ajax.xmlfilter.BaseXMLFilter.doXmlFilter(BaseXMLFilter.java:67)
at org.ajax4jsf.framework.ajax.xmlfilter.BaseFilter.doFilter(BaseFilter.java:223)
at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:142)
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:121)
at org.firsttest.webapp.filter.MessageFilter.doFilter(MessageFilter.java:45)
at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:142)
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:121)
at org.tuckey.web.filters.urlrewrite.UrlRewriteFilter.doFilter(UrlRewriteFilter.java:375)
at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:142)
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:121)
at net.sf.ehcache.constructs.web.filter.GzipFilter.doFilter(GzipFilter.java:75)
at net.sf.ehcache.constructs.web.filter.Filter.doFilter(Filter.java:89)
at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:142)
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:121)
at org.displaytag.filter.ResponseOverrideFilter.doFilter(ResponseOverrideFilter.java:125)
Missing source file headers
Attaching a patch to add missing source file headers - mainly site.xml, but also three java tests in clay
Missing &quot;&lt;&lt;&quot; nav element on the calendar
The good news is that I found and fixed the problem. The bad news is that the fix is fairly extensive. I have made the fix in the Roller trunk and so we'll get it in a later release. If we really need this fix now, we can probably figure out a way -- but it won't be fun.
- Dave
On Dec 11, 2006, at 6:20 PM, David M Johnson wrote:
&gt; I was able to reproduce this bug in my dev environment. I'm still trying to find the root cause.
&gt;
&gt; - Dave
&gt;
&gt;
&gt; On Dec 9, 2006, at 3:07 PM, Linda Skrocki wrote:
&gt;
&gt;&gt; Indeed. The previous &quot;&lt;&lt;&quot; calendar arrows drop off my blog here:
&gt;&gt; http://blogs.sun.com/lskrocki/date/200606
&gt;&gt;
&gt;&gt; Oddly enough, they show up for the following month on Andreas' calendar:
&gt;&gt; http://blogs.sun.com/andreas/date/200503
&gt;&gt;
&gt;&gt; But drop off the next moth:
&gt;&gt; http://blogs.sun.com/andreas/date/200504
&gt;&gt;
&gt;&gt; And show up from July, 2006 forward:
&gt;&gt; http://blogs.sun.com/andreas/date/200607
&gt;&gt;
&gt;&gt; Dave, can you have a look?
&gt;&gt;
&gt;&gt; Thanks!
&gt;&gt; Linda
&gt;&gt;
&gt;&gt;
&gt;&gt; Andreas Sterbenz wrote:
&gt;&gt;
&gt;&gt;&gt; There seems to be something wrong with showWeblogEntryCalendar() in the new Roller. There are no links generated that would allow be to get to months earlier than May 2006 even though I have had the blog since 2004.
&gt;&gt;&gt;
&gt;&gt;&gt; See http://blogs.sun.com/andreas/date/200605
&gt;&gt;&gt;
&gt;&gt;&gt; Andreas.
WeakReferenceMessageHandle uses a singleton so when body is purged by gc it cannot be reset
in addContentBodyFrame if there is only one content body a singleton was created this resulted in a OperationNotSupportedException if the _contentBodies was purged by the GC. Changed to use an ArrayList of size 1.
Message Properties on non Qpid Messages are not preserved
The MessageConverter handles all message conversions however when the BasicMessageProducer send is called with a message that is a not a message type we can retrieve the content from an empty message is created and sent. 
The MessageConverter should take a Message and return a new Qpid style message with the properties intact.
Message reference count not being incremented when message added to UnacknowledgeMap
The reference count for the message is not incremeneted when it is added to the UnacknowledgedMessageMap. Thus by the time the acknowledge is received, the message may have been purged from the store.
Patch to follow
Tests may hang instead of fail if message does not get through
There are several tests where session.receive() is called. If there is a bug in the code, then the message may not get through, in which case the test will wait forever, and not fail. Calls to receive should instead pass a timeout value.
Patch to follow
Management console needs to be be updated for displaying all mbeans under Virtual Host hierarchy
Now the mbeans have virtual host as parent mbean. The navigation view and the server registry needs to be updated with this info.
Each mbean should be displayed with proper hierarchy under virtual host
Remove dependency on JMS from common and broker modules
Currently the common and broker modules require the JMS API. 
In Common the dependency is in the BasicContentHeaderProperties class where a number of method exist for making the properties FieldTable perform type conversions in the way that is expected of JMSHeaders
In the Broker the dependencies are in code which is used for MessageSelectors. Mostly this is throwing of JMSExceptions which can and should be replaced by the throwing of AMQExceptions.
Dispatcher pause logic is not thread safe.
There is missing locking causing the Main thread to call notify before the Dispatcher thread has called wait.
AMQSession. closeProducersAndConsumers
Any JMSException thrown here is masked by simply logging the exception out and not propogating it.
Fix invalid filemode settings in assembly files bin-test.xml and bin.xml
Invalid filemodes (493) in bin-test.xml and bin.xml assemblies causing distribution to fail. Problem became visible after upgrade to 2.2-SNAPSHOT of maven assmebly plugin in main file.
Filemode values should be a sum of 4/2/1 so 9 is invalid. Correct value is 473.
Management console Eclipse plug-in grabbing 100% CPU
User reported:
Possible management console bug - if you stop the broker with the Eclipse manager open, the Eclipse process grabs 100% CPU and stays there.
Once you reconnect CPU drops back down.
Sounds like the mgt plug-in might be thrashing when the broker connection is down ?
FailoverException is throw to clients
If an error occurs on the broker causing a connection close and failover occurs the start of failover is signaled by a FailoverException and this is what is being shown here in client code.
This is due to BlockingMethodFrameListener wrapping all exceptions in an AMQException. FailoverExeceptions should simply be passed.
main 2007-01-16 10:20:14,328 ERROR [apache.qpid.client.AMQSession] Error closing session: javax.jms.JMSException: Error closing consumer: org.apache.qpid.AMQException: Woken up due to exception
javax.jms.JMSException: Error closing consumer: org.apache.qpid.AMQException: Woken up due to exception
at org.apache.qpid.client.BasicMessageConsumer.close(BasicMessageConsumer.java:406)
at org.apache.qpid.client.AMQSession.closeConsumers(AMQSession.java:669)
at org.apache.qpid.client.AMQSession.closeProducersAndConsumers(AMQSession.java:556)
at org.apache.qpid.client.AMQSession.close(AMQSession.java:513)
at org.apache.qpid.client.AMQTopicSessionAdaptor.close(AMQTopicSessionAdaptor.java:138)
Messages not being correctly requeued when transacted session closed
When using a transacted session, on closing the session (channel) the uncommitted delivered messages should be requeued and delivered to subsequent consumers. Currently this is not occuring as the requeue operation is creating a new transaction which is never committed.
The fix is to change the method close in AMQChannel by adding an explicit commit:
public void close(AMQProtocolSession session) throws AMQException
{
_txnContext.rollback();
unsubscribeAllConsumers(session);
requeue();
&gt;&gt; _txnContext.commit();
}
Race condition in establishing client connection
Recent changes have created a race condition when establishing a client connection.
In AMQConnection we do:
private void makeBrokerConnection(BrokerDetails brokerDetail) throws IOException, AMQException
{
try
{
TransportConnection.getInstance(brokerDetail).connect(_protocolHandler, brokerDetail);
// this blocks until the connection has been set up or when an error
// has prevented the connection being set up
_protocolHandler.attainState(AMQState.CONNECTION_OPEN);
_failoverPolicy.attainedConnection();
//Again this should be changed to a suitable notify
_connected = true;
}
Where the AMQProtocolHandler.attainState( ) method looks like
public void attainState(AMQState s) throws AMQException
{
_protocolSession.getStateManager().attainState(s);
}
However, _protocolSession may not yet have been set, as it is only created when the MINA thread calls AMQProtocolHandler.sessionCreated( ... )
To fix this issue, we must create the StateManager in ProtocolHandler, and then pass this StateManager to the ProtocolSession
Patch to be attached shortly
AMQConnection does not support IP addresses
Trying to construct AMQConnection with e.g. &quot;127.0.0.1:5672&quot; causes the stack trace below. &quot;localhost:5672&quot; does work. You can easily try this using the ServiceProvidingClient performance test.
Attempting to
127.0.0.1:5672
^
Illegal character in scheme name between indicies 0 and 1 
127.0.0.1:5672
^
at org.apache.qpid.url.URLHelper.parseError(URLHelper.java:146)
at org.apache.qpid.url.URLHelper.parseError(URLHelper.java:141)
at org.apache.qpid.client.AMQBrokerDetails.&lt;init&gt;(AMQBrokerDetails.java:173)
at org.apache.qpid.client.AMQConnectionURL.processOptions(AMQConnectionURL.java:204)
at org.apache.qpid.client.AMQConnectionURL.&lt;init&gt;(AMQConnectionURL.java:138)
at org.apache.qpid.client.AMQConnection.&lt;init&gt;(AMQConnection.java:148)
at org.apache.qpid.requestreply.ServiceRequestingClient.createConnection(ServiceRequestingClient.java:274)
at org.apache.qpid.requestreply.ServiceRequestingClient.&lt;init&gt;(ServiceRequestingClient.java:192)
at org.apache.qpid.requestreply.ServiceRequestingClient.main(ServiceRequestingClient.java:296)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at com.intellij.rt.execution.application.AppMain.main(AppMain.java:90)
Potential race condition in AMQChannel
When adding an item to the unacknowledge message map the channel suspension check must be performed synchronously to ensure that the map isn't emptied by incomming acks before the channel gets a chance to be unsuspended
[Performance] Remove unnecessary Map creation for each server side message
Each message as processed by the broker is creating two Maps. One of these maps is only used by the clustered server, so does not need to be initialised at all in the standard broker. Move this Map to be lazily initialiased.
A second map is used to map a decorator onto the message. However the decorator is not adding real value, and can easily be removed.
Fanout Exchange not implemented
There is currently no implementation of the fanout exchange. This causes some of the python tests to fail.
Add getType method to Exchange so it is possible to identify which type of exchange is mapped to by a given name
Currently the broker (and client) have very poor support for anything other than the default exchange names. To better support the concept of different exchange classes, and multiple exchanges of the same type, add a getType() method to the Exchange interface, and implement in all current exchanges.
PropertiesFileInitialContextFactory doesn't lookup PROVIDER_URL correctly
PropertiesFileInitialContextFactory should use containsKey rather than contains to check for the Provider_URL.
If the code generation fails then it will not be recompiled.
The return code from the code generator is not used to control the 'touch' of the time stamp. 
If the build of the framing code fails then it will not be re executed on the next mvn call requiring the user to perform a mvn clean before the framing code will be regenerated.
Existing windows classpath setting will cause code generation to fail.
Currently if the environment has a CLASSPATH set then this will cause the code generation to fail.
In cygwin:
$echo $CLASSPATH
.;C:\PROGRAM FILES\XML SPY\XMLSPY\XMLSPYINTERFACE.JAR;C:\Program Files\Java\jre1.6.0\lib\ext\QTJava.
zip
after unset-ing CLASSPATH the code generation completes correctly.
We shouldn't require users to change their existing CLASSPATH value.
[Performance] In PoolingFilter Event objects are created needlessley
In org.apache.qpid.pool.PoolingFilter an Event object is created for every io event that occurs. The event type is then compared against a set of event types (which in practice only ever has one entry) and then the event is either processed synchronously or asynchronously.
Due to the huge numbers of events, the creation and processing of these objects creates a noticeable overhead.
Patch will follow.
field table type codes conflict with spec
The Java framing library uses it's own set of type codes for field table values. Some of these are to support extra types not defined in the spec, but some of the conflict with the type codes defined in the spec, for example 'S' means longstr in the spec and unsighed short according to the java. This breaks interoperability with other AMQP implementations, e.g. the entire python interop test suite.
C++ client cannot connect to Java broker.
Date: Wed, 3 Jan 2007 18:20:31 +0000
From: &quot;Robert Greig&quot; &lt;robert.j.greig@gmail.com&gt;
A problem actually arose today when I gave the guys a new build with
the latest (trunk) of C++. When they try to connect ot a java broker -
either trunk or one from November they get:
pool-2-thread-1 2007-01-03 18:13:27,783 ERROR
[qpid.server.protocol.AMQProtocolSession] Received incorrect protocol
init
iation
org.apache.qpid.framing.AMQProtocolVersionException: Protocol version
0.0 not found in protocol version list.
at org.apache.qpid.framing.ProtocolInitiation.checkVersion(ProtocolInitiation.java:175)
at org.apache.qpid.server.protocol.AMQMinaProtocolSession.dataBlockReceived(AMQMinaProtocolSession.java:162)
at org.apache.qpid.server.protocol.AMQPFastProtocolHandler.messageReceived(AMQPFastProtocolHandler.java:203)
at org.apache.mina.common.support.AbstractIoFilterChain$2.messageReceived(AbstractIoFilterChain.java:189)
at org.apache.mina.common.support.AbstractIoFilterChain.callNextMessageReceived(AbstractIoFilterChain.java:502)
at org.apache.mina.common.support.AbstractIoFilterChain.access$1000(AbstractIoFilterChain.java:52)
at org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.messageReceived(AbstractIoFilterChain.java:7
77)
at org.apache.qpid.pool.Event.process(Event.java:80)
at org.apache.qpid.pool.PoolingFilter.fireEvent(PoolingFilter.java:71)
at org.apache.qpid.pool.PoolingFilter.messageReceived(PoolingFilter.java:143)
at org.apache.mina.filter.ReferenceCountingIoFilter.messageReceived(ReferenceCountingIoFilter.java:96)
at org.apache.mina.common.support.AbstractIoFilterChain.callNextMessageReceived(AbstractIoFilterChain.java:502)
at org.apache.mina.common.support.AbstractIoFilterChain.access$1000(AbstractIoFilterChain.java:52)
at org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.messageReceived(AbstractIoFilterChain.java:7
77)
at org.apache.mina.filter.codec.support.SimpleProtocolDecoderOutput.flush(SimpleProtocolDecoderOutput.java:60)
at org.apache.mina.filter.codec.ProtocolCodecFilter.messageReceived(ProtocolCodecFilter.java:185)
at org.apache.mina.common.support.AbstractIoFilterChain.callNextMessageReceived(AbstractIoFilterChain.java:502)
at org.apache.mina.common.support.AbstractIoFilterChain.access$1000(AbstractIoFilterChain.java:52)
at org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.messageReceived(AbstractIoFilterChain.java:7
77)
at org.apache.qpid.pool.Event.process(Event.java:80)
at org.apache.qpid.pool.Job.processAll(Job.java:81)
at org.apache.qpid.pool.Job.run(Job.java:103)
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
at java.lang.Thread.run(Thread.java:619)
Any ideas about that? In the meantime I'm going to try building an
older C++ client.
RG
IllegalMonitorStateException in ConcurrentSelectorDeliveryManager
An IllegalMonitorStateException is being thrown occaisionally in the deliver() method of the ConcurrentSelectorDeliveryManager.
This is due to the following code:
finally
{
//ensure lock is released
if (_lock.isLocked())
{
_lock.unlock();
}
}
_lock.isLocked() will report true if the lock is being held by a different thread. The unlock will then throw an IllegalMonitorStateException.
The correct check should be if(_lock.isHeldByCurrentThread())
Calling recover in onMessage() should stop Auto-ACK being sent for current message
If using a MessageListener, calling Session.recover() while in the onMessage() processor, should stop the auto-acknowledgement of the current message.
Calling close() on a connection or session, any pending receive() should retrun null
Currently the application will hang indefinitely on the blocking receive() call. The spec says it should return null if the connection is closed
NullPointerException in broker when message sent with no routingKey
NullPointerException when message sent with no routingKey, as attempt to look in ConcurrentHashMap with null key
Management module causes mvn idea target to error
Currently the management module causes the mvn idea:idea target to error (run mvn -e for output). Resulting ipr file can be opened in Idea 6 but not 5. Workaround for Idea 5 users is to remove management module from top level pom (locally only !) until this is resolved.
Client ID should not be resettable
The JMS specification does not allow the resetting of the client id. Currently we do not throw any exception.
A closely related issue is that with AMQP it is not possible to create a connection without a client id - if one if not specified the system generates one that is unique. However it is not entirely clear from the documentation of Connection whether to be JMS compliant you need to be able to set the client id separately from connection creation (it does indicate that the client id if set separately must be done before any other operation on the connection).
Implement support for MessageListener interface
See AMQSession.get/setMessageListener methods which currently throw UnsupportedOperationException.
See javadoc/JMS spec.
The snippet below talks a little about the MessageListener interface (from JMS specification):
9.3.1 Receiving Messages Asynchronously
In order to receive message asynchronously as they are delivered to the message consumer, the client program needs to create a message listener that implements the MessageListener interface. An implementation of the MessageListener interface, called StockListener.java, might look like this:
import javax.jms.*;
public class StockListener implements MessageListener
{
public void onMessage(Message message) {
/* Unpack and handle the messages received */
...
}
}
The client program registers the MessageListener object with the MessageConsumer object in the following way:
StockListener myListener = new StockListener();
/* Receiver is MessageConsumer object */
receiver.setMessageListener(myListener);
The Connection must be started for the message delivery to begin. The MessageListener is asynchronously notified whenever a message has been published to the Queue. This is done via the onMessage method in the MessageListener interface. It is up to the client to process the message there.
JMS Example Code?April 12, 2002 105
9
public void onMessage(Message message)
{
String newStockData;
/* Unpack and handle the messages received */
newStockData = message.getText();
if(...)
{
/* Logic related to the data */
}
}
FacesContextFactoryImpl.getFacesContext takes a config as first parameter instead of a context as specified in JSF spec
FacesContextFactoryImpl class that implements the JSF FacesContextFactory interface is not respecting the specification of the getFacesContext method.
Indeed JSF spec says the signature of the method is the following:
getFacesContext(java.lang.Object context, java.lang.Object request, java.lang.Object response, javax.faces.lifecycle.Lifecycle lifecycle) 
So you would expect to pass as the first object the PortletContext object (and that's actually what the reference implementation JSF bridge is expecting).
However FacesContextFactoryImpl version is taking as the first parameter a PortletConfig instead of a PortletContext.
This cause third party software to crash.
PortletViewHandlerImpl.getResourceURL() always prepends the context path.
When running an application on the MyFaces JSF portal bridge, I noticed the context path is always appended to the URI path in PortletViewHandlerImpl.getResourceURL() even if the path parameter already contains the context path.
My JSF portal application loads image resources and css files and when using the Sun portal bridge all the resources resolved. When attempt to use the MyFaces JSF portal bridge, the application failed to find the resources citing a java.io.FileNotFoundException for the resources. The resources that already contained the context path are prepened with another context path. The getResourceURL() method of PortletViewHandlerImpl ALWAYS prepends the context path to the path parameter without checking if it is already there. 
I believe changing the getResourceURL() code to delegate this call to the handler.getResourceURL() method of (javax.faces.application.ViewHandler) would resolve the problem. I made this small change in my sandbox. The URLs with the context path did not get prepended and the application found all resources. 
Is there a reason the PortletViewHandlerImpl does not delegate the getResourceURL() method that I am missing? If there is not a compelling reason not to delegate the call to the included ViewHandler, then perhaps we should delegate the call to javax.faces.application.ViewHandler. If there is a compelling reason perhaps we should add a check if the context path already exists in the path parameter.
The method setDefaultView() sets the PortletSession attribute with a null value.
The method: org.apache.portals.bridges.jsf.FacesPortlet.setDefaultView(FacesContext, String, String) contains an else branch that is entered when the viewRoot value is null (line 589). 
This else branch creates a new viewRoot, a new view id, and sets both on the facesContext object. The code then creates a view root key and calls portal session set attribute with this key using the null viewRoot value, instead of the viewRoot object that was just created. The portlet session attribute map will contain a valid viewRoot key, but a null viewRoot value. This appears to be an error, because the viewRoot is always going to be null when this branch of code is entered.
I propose that the method call (on line 594 of FacesPortlet) should look like this:
portletRequest.getPortletSession().setAttribute(createViewRootKey(facesContext, view, viewId), facesContext.getViewRoot() );
This will store the newly created viewRoot in the portlet session where it can be retrieved.
JSF portal bridge attempting to encode URL twice fails
I evaluating the MyFaces portlet bridge with a sample JSF portal app and I ran into a problem. The portlet worked with the Sun portlet bridge, but does not even complete the render phase when I try to use the MyFaces portlet bridge.
The exception I am seeing is:
javax.servlet.ServletException: only absolute URLs or full path URIs are allowed
Caused by: java.lang.IllegalArgumentException: only absolute URLs or full path URIs are allowed
at com.ibm.ws.portletcontainer.core.impl.PortletResponseImpl.encodeURL(PortletResponseImpl.java:143)
at org.apache.portals.bridges.jsf.PortletExternalContextImpl.encodeActionURL(PortletExternalContextImpl.java)
I hooked up a remote debugger to see what was happening. The String URL that is passed into PortletExternalContextImpl is: pa.do?_pa=-1088437171&amp;_rid=-507a2aba:10f977651ed:-7fee&amp;.pa=true
As you can see the URL is already encoded and the encodeActionURL( String ) method attempts to call this.portletResponse.encodeURL(s). The PortletResponse tries to encode the string URL again, leading to the Exception. 
I tracked down the difference in Sun's version of ExternalContextImpl. I found a Sun portlet bridge bug # 6243708 that addresses the same problem of double encoding the value from the portlet environment. The Sun portlet bridge fixed this bug in their com.sun.faces.portlet.ExternalContextImpl.encodeActionURL( String ) method to return the string url instead of attempting to encode it again.
I suggest that the PortletExternalContextImpl will always get portal encoded URL strings, and should return the string passed to it to avoid this Exceptional case.
EntityManager.getDelegate should throw an IllegalStateException
EntityManager.getDelegate() should throw an IllegalStateException if the EntityManager has been closed. 
I noticed then when debugging other problems. According to the javadoc http://java.sun.com/javaee/5/docs/api/javax/persistence/EntityManager.html#getDelegate() we need to throw an exception if the EM has been closed. 
In case I missed anything here's what I did to reproduce the problem. 
EntityManagerFactory _emf = Persistence.createEntityManagerFactory(&quot;test&quot;);
EntityManager em = _emf.createEntityManager();
em.close();
try {
Object o = em.getDelegate();
fail();
}
catch(IllegalStateException ise) {
System.out.println(&quot;Caught expected exception&quot;);
}
OpenJPA does not detach instances on rollback()
Section 3.3.2 of the JPA spec states that instances must be detached at rollback. OpenJPA does not do this.
Default Listeners not being processed correctly
The basic problem is this: I'm attempting to specify some entity listeners in my orm.xml , but I continue to get the following TRACE message:
322664 my persistence unit TRACE [main] openjpa.MetaData - OpenJPA does not currently support XML element &quot;pre-persist&quot;. Ignoring.
The following discussion is from the openjpa-dev mailing list...
------------------------------------------------------------
Marc,
Thanks for the background on the earlier drafts of the JPA spec. That helps explain some of the processing that I see. I also now see that elements tagged as MetaDataTags have corresponding annotation support associated with them. So, it looks like I just need to provide similar callback processing for the pre-* and post-* methods at the &quot;system&quot; level as exist at the &quot;class&quot; levels. Thanks for your insights.
Kevin
- Hide quoted text -
On 1/16/07, Marc Prud'hommeaux &lt;mprudhom@apache.org&gt; wrote:
Kevin-
The draft of the JPA spec said that &quot;pre-persist&quot; was only supported
beneath the &quot;entity-listeners&quot; (note plural) element, rather than
&quot;entity-listener&quot;. This appears to have been corrected in the final
version of the spec, but it looks like we never updated that part of
the code (and the CTS doesn't test for it). This is indeed a bug.
As for how the parser works, I'm afraid I don't know all that much
about it (aside from sharing your observation that it is complex).
Hopefully, though, my comment above will make the problem make a
little more sense to you...
On Jan 16, 2007, at 3:20 PM, Kevin Sutter wrote:
&gt; Looking for some assistance (that is, background information) on
&gt; how the
&gt; orm.xml parsing is supposed to work. I'm attempting to specify
&gt; some entity
&gt; listeners in my orm.xml , but I continue to get the following TRACE
&gt; message:
&gt;
&gt; 322664 my persistence unit TRACE [main] openjpa.MetaData -
&gt; OpenJPA does
&gt; not currently support XML element &quot;pre-persist&quot;. Ignoring.
&gt;
&gt; My orm.xml looks like this:
&gt;
&gt; &lt;entity-mappings
&gt; xmlns=&quot;http://java.sun.com/xml/ns/persistence/orm&quot;
&gt; xmlns:xsi=&quot; http://www.w3.org/2001/XMLSchema-instance&quot;
&gt; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence/orm
&gt; http://java.sun.com/xml/ns/persistence/orm_1_0.xsd&quot;
&gt; version=&quot;1.0&quot;&gt;
&gt; &lt;persistence-unit-metadata&gt;
&gt; &lt;persistence-unit-defaults&gt;
&gt; &lt;entity-listeners&gt;
&gt; &lt;entity-listener class=&quot;
&gt; com.ibm.ws.persistence.tests.simple.TestEntity&quot;&gt;
&gt; &lt;pre-persist method-name=&quot;prePersist&quot; /&gt;
&gt; &lt;post-persist method-name=&quot;postPersist&quot; /&gt;
&gt; &lt;pre-remove method-name=&quot;preRemove&quot; /&gt;
&gt; &lt;post-remove method-name=&quot;postRemove&quot; /&gt;
&gt; &lt;pre-update method-name=&quot;preUpdate&quot; /&gt;
&gt; &lt;post-update method-name=&quot;postUpdate&quot; /&gt;
&gt; &lt;post-load method-name=&quot;postLoad&quot; /&gt;
&gt; &lt;/entity-listener&gt;
&gt; &lt;/entity-listeners&gt;
&gt; &lt;/persistence-unit-defaults&gt;
&gt; &lt;/persistence-unit-metadata&gt;
&gt; &lt;/entity-mappings&gt;
&gt;
&gt; I've started to debug this problem, but I have some general
&gt; questions on how
&gt; the SAX parser is supposed to work. I see in the
&gt; CFMetaDataParser.startElement() where these &quot;entity-listener&quot;
&gt; related tags
&gt; are treated as System Elements -- we end up calling
&gt; XMLPersistenceMetaDataParser.startSystemElement().
&gt;
&gt; The processing in this method is dependent on whether the given
&gt; element is a
&gt; MetaDataTag or not. When we process the &quot;entity-listener&quot; element,
&gt; it's
&gt; treated like a &quot;normal&quot; element and we fall past the switch
&gt; statement and
&gt; eventually call startEntityListener(). This processing all seems
&gt; to depend
&gt; on whether the _elems hashmap contains a string entry or a
&gt; MetatDataTag for
&gt; a given Element. What is the significance of being a MetaDataTag
&gt; or not?
&gt;
&gt; In this simple orm.xml, I have noticed that persistence-unit-metadata,
&gt; persistence-unit-defaults, and entity-listener are not
&gt; MetaDataTags. But,
&gt; entity-listeners and the individual pre-persist, post-persist, etc
&gt; elements
&gt; are all MetaDataTags.
&gt;
&gt; When one of these pre-* or post-* MetaDataTag elements are
&gt; processed in the
&gt; startSystemElement() method, we fall into the default leg of the
&gt; switch
&gt; statement and produce the TRACE message outlined above.
&gt;
&gt; Any pointers would be appreciated. Thanks!
&gt;
&gt; Kevin
------------------------------------------------------------
&lt;jar-file&gt; entries failing to be processed for persistence unit rooted in an EAR
&lt;jar-file&gt; entries in the persistence.xml file of a jar in the root of an EAR fail to be parsed properly. OpenJPA incorrectly interprets the entries as URLs for orm.xml files, and attempts to parse them as XML instead of scanning them for annotated types.
Openejb RMI stub serialization causing some RMI failures.
openejb is using a special Yoko hook for managing RMI Stub interactions. Part of the openejb implementation of that hook overrides the stub serialization and instead replaces this with an instance of CORBAEJBMemento. As a general solution, this doesn't work, as the correct contexts are not set up to deserialize the method argument until after the request has been deserialized. This is a chicken-and-egg problem. It turns out, the Yoko RMI support is handling everything just fine, and the specialized replacement object is not required, so this method can just be deleted.
Workaround for maven misresolving ${pom.version}
see http://jira.codehaus.org/browse/MNG-2796
The geronimo build has been having problems due to maven resolving ${pom.version} in dependencies which should be 3.0-incubating-SNAPSHOT to the timestamped version of the current pom rather than trying to resolve it for the dependency itself. 
The workaround seems to be to define a ${version} property ourselves. jdillon did this quite a while ago in the geronimo build to workaround lots of similar issues.
Rules for SSL client transport selection need refinement.
This is sort of a difficult situation to describe. In the past release, an ORB created by a CSSBean was created with a SocketFactory instance that would select the appropriate type of transport for a client connection. This decision was not made based on the CSSBean configuration, but rather based on the information encoded in the connection IOR. 
With the reference implementation, it is fairly typical for the IORs to use a primary port address for a plain socket connection, but also have at least one alternate port encoded for a secure connection. The SocketFactory instance is recognizing this secure transport alternative, and selecting the most secure transport for the connection. 
In the prior release, this worked ok because the SSL certificate information was configured using system properties, so it was global to the entire VM. In the new release, we're relying on the Geronimo KeystoreManager API for SSL factory creation and cert management. The SocketFactory has a fallback to the old way of processing, but when this is used, the connection will fail because the correct SSL certs cannot be located. The SocketFactory port selection logic needs to recognize that the ORB is not properly configured for SSL connections and use the primary plain socket connection.
Yoko SocketFactory can create mismatched connection types when alternate connections are used.
The Yoko ORB has support for alternate IIOP connections as defined in the profile. If the IOR has alternate connections and an SSLTransport defined in the IOR profile, the ORB can make a connection request using the SSL configured port number, but in a way that causes the SocketFactory to make a plain connection to the server. This results in the server just closing the connection without giving any error information. 
The openejeb socket factory needs to use the primary connection port for a plain connection, and if an SSL connection is configured and not explicitly disabled by NoProtection being defined in the profile, then the SSL connection should be used.
Several errors in the yoko socket factory when dealing with SSL sockets.
There are a couple of problems in the logic for dealing with SSL connections. These errors are mostly canceling each other out, but they can cause an incorrect result in some situations.
1) The test for NoProtection also needs to recognize a requires value of 0 means no SSL. 
2) The createSSLSocket() method is using the serverSocketFactory for retrieving the supported cipher suites. If this ORB has never created a secure server socket, this will quietly die with a NullPointerException and end up creating a plain socket instead. This error is offsetting the error in 1) above.
Generated IORs do not have a zero IIOP profile port value when SSL transports are used.
CSIv2 security requires the IOR IIOP profile contain zero for a port number when the port and host are encoded in the SSL transport information. The Yoko project added a policy to allow the port to be forced to a zero value. This change implements the openejb enablement of that support.
Starting and ending spaces not trimmed in openejb during unmarshalling of descriptors.
During unmarshalling, the leading and trailing whitespaces in the deployment descriptors are not trimmed
RMI stub interceptors not working with Yoko.
Yoko has implemented a different model for generating RMI stub classes that doesn't use the hooked Util.loadClass() method. As a result, the RMI method invocations are not getting intercepted by openejb to set up the correct serialization contexts. Yoko has implemented a new hook for Geronimo to use, and this code hooks into that mechanism.
Class loading problems with latest version of CORBAHandle
The changes in CORBAHandle introduced in OPENEJB-436 are causing other failures. Passing an interface class back in the CORBAHandle instance places class loading requirements on the client that shouldn't exist. Since this interface class is only used for a single error check, an alternate approach is required that does not required serializing the interface class.
Exception when remove(handle) is called on a stateless session bean.
remove(handle) is throwing an exception when called with a handle for a stateless session bean. This is occurring because an isInstance() test is getting performed on a sub object that has been created via a narrow() operation using the EJBObject class. The created stub does not implement the interface, even though the underlying real object does.
Transaction support not wired in MDB Container
The Transaction support in the MDB container is not working properly. This needs to be fixed
Executing bin/openejb with no parameters causes usage to be printed 4 times
$ bin/openejb 
OPENEJB_HOME = /Users/dain/work/openejb/trunk/openejb3/target/openejb
Usage: openejb help [command]
COMMANDS:
deploy - Deploy an ejb jar into OpenEJB.
start - Start the OpenEJB Remote Server for accessing beans in client/server mode.
stop - Stop the OpenEJB Remote Server.
validate - Validate an ejb jar
Try 'openejb help &lt;command&gt;' for more information about the command.
Apache OpenEJB -- EJB Container System and EJB Server.
For updates and additional information, visit
http://incubator.apache.org/openejb
Bug Reports to &lt;openejb-user@incubator.apache.org&gt;
OPENEJB_HOME = /Users/dain/work/openejb/trunk/openejb3/target/openejb
Usage: openejb help [command]
COMMANDS:
deploy - Deploy an ejb jar into OpenEJB.
start - Start the OpenEJB Remote Server for accessing beans in client/server mode.
stop - Stop the OpenEJB Remote Server.
validate - Validate an ejb jar
Try 'openejb help &lt;command&gt;' for more information about the command.
Apache OpenEJB -- EJB Container System and EJB Server.
For updates and additional information, visit
http://incubator.apache.org/openejb
Bug Reports to &lt;openejb-user@incubator.apache.org&gt;
OPENEJB_HOME = /Users/dain/work/openejb/trunk/openejb3/target/openejb
Usage: openejb help [command]
COMMANDS:
deploy - Deploy an ejb jar into OpenEJB.
start - Start the OpenEJB Remote Server for accessing beans in client/server mode.
stop - Stop the OpenEJB Remote Server.
validate - Validate an ejb jar
Try 'openejb help &lt;command&gt;' for more information about the command.
Apache OpenEJB -- EJB Container System and EJB Server.
For updates and additional information, visit
http://incubator.apache.org/openejb
Bug Reports to &lt;openejb-user@incubator.apache.org&gt;
&quot;query by example&quot;ignore inherited fields (using 'table per subclass' mapping)
using class Manager---&gt;Executive---&gt;Employee (with inheritance, base class is Employee) and
Manager tmp = new Manager();
tmp.setName(&quot;manager_&quot; + name);
//Query q = QueryFactory.newQuery(tmp);
Query q = QueryFactory.newQueryByExample(tmp);
Manager newM1 = (Manager) broker.getObjectByQuery(q);
The generated sql completely ignore the value of the inherited field 'name'
Bug in displaying order items when using old style calcTax service
There is a bug in orderitems.ftl when using old style calcTax service.
I attached a patch file for this bug.
Ismail Cansiz
&lt;textarea&gt; bug in maincss.css file
First sweep caused the &lt;textarea&gt; HTML elements to revert back to their default fixed-pitch font.
Warnings introduced after Asset Maintenance component was added to Ofbiz
Database warnings were introduced after Asset Maintenance component was added to Ofbiz.
Bug in /applications/party/config/PartyEntityLabels.properties
in /applications/party/config/PartyEntityLabels.properties, start from line 103 to 119, the last point in each line should be =
RoleType.description.BUYER.Buyer -&gt; RoleType.description.BUYER=Buyer
RoleType.description.CASHIER.Cashier -&gt; RoleType.description.CASHIER=Cashier
RoleType.description.DEPARTMENT.Department -&gt; RoleType.description.DEPARTMENT=Department
RoleType.description.DIVISION.Division -&gt; RoleType.description.DIVISION=Division
RoleType.description.FAMILY_MEMBER.Family Member -&gt; RoleType.description.FAMILY_MEMBER=Family Member
RoleType.description.MANAGER.Manager -&gt; RoleType.description.MANAGER=Manager
RoleType.description.ORDER_CLERK.Order Clerk -&gt; RoleType.description.ORDER_CLERK=Order Clerk
RoleType.description.OTHER_INTERNAL_ORGAN.Other Internal -&gt; RoleType.description.OTHER_INTERNAL_ORGAN=Other Internal
RoleType.description.OTHER_ORGANIZATION_U.Other Organization Unit -&gt; RoleType.description.OTHER_ORGANIZATION_U=Other Organization Unit
RoleType.description.PARENT_ORGANIZATION.Parent Organization -&gt; RoleType.description.PARENT_ORGANIZATION=Parent Organization
RoleType.description.PACKER.Packer -&gt; RoleType.description.PACKER=Packer
RoleType.description.PICKER.Picker -&gt; RoleType.description.PICKER=Picker
RoleType.description.RECEIVER.Receiver -&gt; RoleType.description.RECEIVER=Receiver
RoleType.description.SHIPMENT_CLERK.Shipment Clerk -&gt; RoleType.description.SHIPMENT_CLERK=Shipment Clerk
RoleType.description.STOCKER.Stocker -&gt; RoleType.description.STOCKER=Stocker
RoleType.description.SUBSIDIARY.Subsidiary -&gt; RoleType.description.SUBSIDIARY=Subsidiary
RoleType.description.WORKER.Worker -&gt; RoleType.description.WORKER=Worker
Sorry, I cannot submit a Eclipse patch file because I cannot connect to apache svn server now ( can visit the website, svn connection timeout).
Shi Yusen/Beijing Langhua Ltd.
&quot;force new transaction&quot; param in CheckoutHelper.processPayment method service call to &quot;authOrderPayments&quot; needs to be false
&quot;force new transaction&quot; param in CheckoutHelper.processPayment method service call to &quot;authOrderPayments&quot; needs to be false. While true, it causes the OrderHeader entity generated in the createOrder method above to not be found.
services_shipment.xml
Found in the log of a recent svn build:
2007-01-15 21:04:59,665 (main) [ UtilXml.java:646:ERROR] XmlFileLoader: File /wrk/ofbiz/ofbiz/applications/product/servicedef/services_shipment.xml process error. Line: 494. Error message: cvc-complex-type.2.4.a: Invalid content was found starting with element 'attribute'. One of '{override}' is expected.
Creating a purchase order allows shipping information step to be skipped
1. Go to ordermgr/control/orderentry
2. Select for Internal Organization a value of &quot;ACCOUNTING&quot; (or some party with
no contact mechanism of type &quot;Postal Address&quot; for shipping purposes).
3. Select a supplier that has something to sell (say DemoSupplier).
4. Add an order item to your PO (say GZ-1000 if using DemoSupplier).
5. Click &quot;Finalize Order&quot;. And click through till the &quot;Shipping&quot; tab.
6. You'll see that there are no shipping addresses to choose from. Click
&quot;Continue&quot;.
7. You're back to the &quot;Add Order Item&quot; screen. You see error message &quot;Please
enter a shipping address&quot;.
8. Click &quot;Finalize Order&quot; again. You've just skipped the &quot;Order&quot; tab (right
after &quot;Shipping&quot; tab) and are now on to &quot;Parties&quot; tab!
9. Select option &quot;I do not wish to add additional parties&quot;. Click
&quot;Continue&quot;.
10. Back to &quot;Shipping&quot; tab. Again, no shipping addresses to choose from. Click
&quot;Continue&quot;.
11. Back to &quot;Add Order Item&quot; screen with same error message as before. Click
&quot;Finalize Order&quot; again.
You're at &quot;Order Confirmation&quot;! There's no shipping information at all for this PO! Go on to create this incomplete PO. You'll see a whole host of problems associated with this PO, including the inability to include shipping information or to correct it otherwise.
WORKEFFORTMGR missing in base permission in workEffort component
ofbiz-component.xml for WorkEffort component is mission WORKEFFORTMGR in its list of required base permissions.
Thanks to Scott for help with this.
A long selectAllForm's table will overlap with addVariantsToVirtual's table
Bug in file QuickAddVariants.ftl.
I switched the position of the &lt;div&gt; containing the addVariantsToVirtual form to below the selectAllForm form. I also put the selectAllForm form into a &lt;div style=&quot;float: left&quot;&gt;.
So there are now 2 &lt;div&gt;s instead 1: the 1st &lt;div&gt; floats left and contains the selectAllForm, the 2nd &lt;div&gt; floats right as usual and contains the addVariantsToVirtual form.
This way, if the selectAllForm is not too wide, both forms sit side by side as usual. Otherwise, the addVariantsToVirtual form gets bumped down the page.
&quot;Add to cart&quot; button still active even though last feature is not selected
Bug in Order module webapp/ordermgr/entry/catalog/productdetail.ftl . Try buying a WG-9943, select black, then 3-wheel, then size. You'll see that the text box left of &quot;Add to cart&quot; is still enabled.
I've attached a tiny patch.
In the patch, I've also added a display of &quot;Product ID: ---&quot; right below the features selection. Upon selecting the last feature, the chosen variant's product Id will appear. You can cut out this part if it doesn't fit into OFBiz.
DemoShipping data causes problems
the DemoShipping.xml data file uses ShipmentCostEstimates that share the same QuantityBreak entities, this isn't supported in the UI when attempting to delete a ShipmentCostEstimate as the code attempts to delete related QuantityBreaks causing foreign key exceptions. The service code that fails is removeShipmentEstimate in ShipmentServices.java.
I kept the priority as major because this causes a stumbling block for newcomers using the Production Setup Guide.
date-time calendar does not pop up(webtools)
Hi,
If you try to use the little calendar icon to insert a date when u create or update entity(webtools), the calendar does not pop up at all. I guess it is because of a typo error in ViewGeneric.ftl
I have applied a patch - ViewGeneric.patch
Valentina
some misses in properties files
During my Chinese localization, I found the following misses, you may not find them in English locale:
in /framework/common/config/CommonUiLabels.properties, the following keys should be changed:
Geo.geoName.SCT =&gt; Geo.geoName.SCOT
Geo.geoName.ENG =&gt; Geo.geoName.ENGL
Geo.geoName.NIR =&gt; Geo.geoName.NIRL
Geo.geoName.WLS =&gt; Geo.geoName.WALS
in /framework/common/config/CommonUiLabels.properties, the following maps should be added:
Geo.geoName.ARM=Armenia
Geo.geoName.BGD=Bangladesh
Geo.geoName.BWA=Botswana
in /applications/content/config/ContentEntityLabels.properties, the following maps should be added:
MimeType.description.application/x-zip-compressed=ZIP compressed file
MimeType.description.application/vnd.ms-powerpoint=Microsoft PowerPoint
MimeType.description.application/vnd.ms-excel=Microsoft Excel
MimeType.description.image/pjpeg=Progressive JPEG/JPG Image
MimeType.description.text/csv=Comma Separated Value Text
in /applications/content/config/ContentUiLabels.properties, the following key(s) are duplicated:
FormFieldTitle_caContentIdTo
Regards,
Shi Yusen/Beijing Langhua Ltd.
Wrong service invocation when removing Agreement Item Term
If we try to remove an Agreement Item Term, a &quot;removeAgreementTerm&quot; service that doesn't exist is called. 
This patch fixes that problem.
Regards ,
Rashko Rejmer
Shipping a serialized inventory item not handled correctly
When an order with serialized inventory items is shipped, the InventoryItem remains in the Promised status and hence is still counted in QOH. It should be changed automatically to DELIVERED and no longer counted as inventory.
The statusvalidchange from DELIVERED back to AVAILABLE should be removed, as once the item has been shipped out, it should no longer be marked as AVAILABLE, just RETURNED if it is returned.
UtilCache - fileStore location incorrect
I stumbled across this while playing with pos
The fileStore location for UtilCache should be &quot;framework/data/util&quot; and not &quot;data/util&quot;
purgeOldStoreAutoPromos removing wrong entity?
This one I could not figure out: the service purgeOldStoreAutoPromo says &quot;purge Expired ProductStorePromoAppl Records...&quot; but the actual code says:
GenericValue productStorePromo = delegator.makeValue(&quot;ProductStorePromo&quot;, null);
productStorePromo.setAllFields(productStorePromoAndAppl, true, null, null);
productStorePromo.remove();
and there is no ProductStorePromo entity. Is it just a typo? Should it be ProductStorePromoAppl?
Incorrect Product Supplier update and delete in some locales
It is an issue with product suppliers.
When trying to modify a supplier product by clicking in the &quot;Update&quot;
button next to each row, it doesnt get all the suppliers product
information, and Minimum Order Quantity is being multiplied by 10.
* This happens in several languages, but not in english nor french.
Another problem is that it isn't possible to delete a row, in any of the affected locales, giving the following error:
*In remove-value a value was not found with the specified valueAcsr: sprod, not removing
This was confirmed by Jacopo Cappellato who says that it is related to the way
numbers are parsed according to the locale.
USPS Rate Estimation
This is a copy of the old Jira issue http://jira.undersunconsulting.com/browse/OFBIZ-657 from Daniel Kunkel
===========================================================
The USPS automatic Rate Inquiry module has numerous flaws. 
I was able to find and fix them, albeit, with potentially unacceptable techniques. 
Specifically: 
1.) USPS now uses Get and does not Post any longer. 
2.) Pounds must be a integer number. 
3.) The calculation for breaking a weight into pounds and ounces was inaccurate. (UPS module too) 
4.) The HttpClient HTTP GET was inserting &amp;amp; between the value pairs instead of &amp; 
!!!! My fix for this issue may not be appropriate! 
5.) No provision for converting other units of measure to Pounds. Other parts of the program seem to default to the ounce, while shipping defaulted to the pound. 
Remaining Issues... 
Must find a way to disable the estimator during an error. The system currently defaults to $1, which is a believeable, yet money loosing postage. 
Need to add International Shipping Support. 
Finally... This is my first patch contribution... It will need extra time and attention to verify! 
Thanks 
Daniel 
All Comments Work Log Change History Sort Order: 
Comment by Daniel Kunkel [08/Jan/06 02:13 AM] [ Permlink ] 
My fixes which SEEM to work. Your milage may vary. 
Comment by Marco Risaliti [13/Sep/06 01:43 AM] [ Permlink ] 
Can be closed ? 
Thanks 
Marco 
Comment by Daniel Kunkel [13/Sep/06 02:09 AM] [ Permlink ] 
I think it would be a waste to close this issue without first applying the patch... Granted it was my first patch and even I don't like the code, but it did get the domestic USPS postal calculator working which has been a real boon for our business. Furthermore it allowed for the conversion of product weights to lbs for the usps, another feature we needed. 
PS. I do have an iCLA signed. 
Incorrect rendering of international characters in PDF reports created using XSL:FO
International characters in XSL:FO reports are replaced with # even if in the database, ecommerce webapp, catalog webapp, etc. characters are displayed correctly.
UPS Shipping Options show ($1.00) for options that are not found
When doing UPS Shipping, if the options are correctly set up, but are not found in the UPS response, the value reads ($1.00) instead of not being present.
I've attached a screen shot so that anyone who has time to pick this up - can. Currently, I'm going to just remove EXPRESS and STANDARD from my list as they're not options that I've used in the past anyways.
Fault handling in JBI
Alexander Logvinov &lt;alogvinov@softech.ru&gt; reported on ode-user@ the following bug on 12/22/06:
Hi,
I've got a problem with handling SOAP fault in my BPEL process.
I run ODE as a service engine in Servicemix.
My BPEL process calls the web service that runs in Tomcat. The service is implemented using XFire.
It has the following operation (this WSDL is generated by XFire):
&lt;wsdl:portType name=&quot;WarehousePortType&quot;&gt;
&lt;wsdl:operation name=&quot;OrderBook&quot;&gt;
&lt;wsdl:input name=&quot;OrderBookRequest&quot; message=&quot;tns:OrderBookRequest&quot;/&gt;
&lt;wsdl:output name=&quot;OrderBookResponse&quot; message=&quot;tns:OrderBookResponse&quot;/&gt;
&lt;wsdl:fault name=&quot;OrderException&quot; message=&quot;tns:OrderException&quot;/&gt;
&lt;/wsdl:operation&gt;
&lt;/wsdl:portType&gt;
that can throw the following fault:
&lt;wsdl:message name=&quot;OrderException&quot;&gt;
&lt;wsdl:part name=&quot;OrderException&quot; element=&quot;tns:OrderException&quot;/&gt;
&lt;/wsdl:message&gt;
... of the following type:
&lt;xsd:complexType name=&quot;OrderException&quot;&gt;
&lt;xsd:sequence&gt;
&lt;xsd:element minOccurs=&quot;0&quot; name=&quot;orderMessage&quot; nillable=&quot;true&quot; type=&quot;xsd:string&quot;/&gt;
&lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;
&lt;xsd:element name=&quot;OrderException&quot; type=&quot;tns:OrderException&quot;/&gt;
My BPEL invokes this operation with the following code:
&lt;scope name=&quot;Scope1&quot;&gt;
&lt;faultHandlers&gt;
&lt;catchAll&gt;
&lt;empty/&gt;
&lt;/catchAll&gt;
&lt;/faultHandlers&gt;
&lt;invoke name=&quot;callWarehouse&quot;
partnerLink=&quot;warehousePartnerLink&quot;
operation=&quot;OrderBook&quot;
portType=&quot;warehouse:WarehousePortType&quot;
inputVariable=&quot;orderBookIn&quot;
outputVariable=&quot;orderBookOut&quot;/&gt;
&lt;/scope&gt;
The service replies with the following fault:
&lt;soap:Envelope
xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;
xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;
xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
&lt;soap:Body&gt;
&lt;soap:Fault&gt;
&lt;faultcode&gt;soap:Server&lt;/faultcode&gt;
&lt;faultstring&gt;unknown book: Design Patterns&lt;/faultstring&gt;
&lt;detail&gt;
&lt;OrderException xmlns=&quot;http://Warehouse.HelloBook.softech.com&quot;&gt;
&lt;orderMessage&gt;There was an error processing the order.&lt;/orderMessage&gt;
&lt;/OrderException&gt;
&lt;/detail&gt;
&lt;/soap:Fault&gt;
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
The log contains the following:
It receives the full SOAP message from the server:
21:44:44,508 | DEBUG | Thread-13 | header | apache.commons.httpclient.Wire 69 | &lt;&lt; &quot;HTTP/1.1 500 Internal Server Error[\r][\n]&quot;
21:44:44,524 | DEBUG | Thread-13 | header | apache.commons.httpclient.Wire 69 | &lt;&lt; &quot;Content-Type: text/xml;charset=UTF-8[\r][\n]&quot;
21:44:44,524 | DEBUG | Thread-13 | header | apache.commons.httpclient.Wire 69 | &lt;&lt; &quot;Transfer-Encoding: chunked[\r][\n]&quot;
21:44:44,524 | DEBUG | Thread-13 | header | apache.commons.httpclient.Wire 69 | &lt;&lt; &quot;Date: Fri, 22 Dec 2006 18:44:44 GMT[\r][\n]&quot;
21:44:44,524 | DEBUG | Thread-13 | header | apache.commons.httpclient.Wire 69 | &lt;&lt; &quot;Server: Apache-Coyote/1.1[\r][\n]&quot;
21:44:44,524 | DEBUG | Thread-13 | header | apache.commons.httpclient.Wire 69 | &lt;&lt; &quot;Connection: close[\r][\n]&quot;
21:44:44,524 | DEBUG | Thread-13 | content | apache.commons.httpclient.Wire 83 | &lt;&lt; &quot;1&quot;
21:44:44,524 | DEBUG | Thread-13 | content | apache.commons.httpclient.Wire 83 | &lt;&lt; &quot;e&quot;
21:44:44,524 | DEBUG | Thread-13 | content | apache.commons.httpclient.Wire 83 | &lt;&lt; &quot;9&quot;
21:44:44,524 | DEBUG | Thread-13 | content | apache.commons.httpclient.Wire 83 | &lt;&lt; &quot;[\r]&quot;
21:44:44,524 | DEBUG | Thread-13 | content | apache.commons.httpclient.Wire 69 | &lt;&lt; &quot;[\n]&quot;
21:44:44,539 | DEBUG | Thread-13 | content | apache.commons.httpclient.Wire 83 | &lt;&lt; &quot;&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;&lt;soap:Body&gt;&lt;soap:Fault&gt;&lt;faultcode&gt;soap:Server&lt;/faultcode&gt;&lt;faultstring&gt;unknown book: Design Patterns&lt;/faultstring&gt;&lt;detail&gt;&lt;OrderException xmlns=&quot;http://Warehouse.HelloBook.softech.com&quot;&gt;&lt;orderMessage&gt;There was an error processing the order.&lt;/orderMessage&gt;&lt;/OrderException&gt;&lt;/detail&gt;&lt;/soap:Fault&gt;&amp;
lt;/soap:Body&gt;&lt;/soap:Envelope&gt;&quot;
Then the fault message is truncated and the JBI message will not contain faultstring and faultcode:
21:44:44,555 | DEBUG | Thread-12 | DeliveryChannelImpl | .messaging.DeliveryChannelImpl 300 | Accepted: InOut[
id: ID:alogvinov-3320-1166813006883-6:0
status: Active
role: consumer
service: {http://Warehouse.HelloBook.softech.com}Warehouse
endpoint: WarehouseHttpPort
operation: {http://Warehouse.HelloBook.softech.com}OrderBook
in: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;OrderBook xmlns=&quot;http://Warehouse.HelloBook.softech.com&quot; xmlns:warehouse=&quot;http://Warehouse.HelloBook.softech.com&quot;&gt;
&lt;customerID&gt;123&lt;/customerID&gt;
&lt;bookName&gt;Design Patterns&lt;/bookName&gt;
&lt;/OrderBook&gt;
fault: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;OrderException xmlns=&quot;http://Warehouse.HelloBook.softech.com&quot;&gt;&lt;orderMessage&gt;There was an error processing the order.&lt;/orderMessage&gt;&lt;/OrderException&gt;
]
After a while I've got an error:
21:44:44,899 | ERROR | pool-3-thread-2 | Receiver | org.apache.ode.jbi.Receiver$1 192 | Error processing JBI message.
java.lang.AssertionError: todo
at org.apache.ode.jbi.OdeConsumer$2.call(OdeConsumer.java:199)
at org.apache.ode.jbi.OdeConsumer$2.call(OdeConsumer.java:183)
at org.apache.ode.bpel.scheduler.quartz.QuartzSchedulerImpl.execTransaction(QuartzSchedulerImpl.java:212)
at org.apache.ode.jbi.OdeConsumer.outResponse(OdeConsumer.java:182)
at org.apache.ode.jbi.OdeConsumer.onJbiMessageExchange(OdeConsumer.java:134)
at org.apache.ode.jbi.JbiMessageExchangeEventRouter.onJbiMessageExchange(JbiMessageExchangeEventRouter.java:40)
at org.apache.ode.jbi.Receiver$1.run(Receiver.java:190)
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:417)
at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:269)
at java.util.concurrent.FutureTask.run(FutureTask.java:123)
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)
at java.lang.Thread.run(Thread.java:595)
It seems that it is raised by the following code in OdeConsumer.java
Fault jbiFlt = jbiMex.getFault();
if (jbiFlt != null) {
// TODO: How are we supposed to figure out the fault type exactly?
throw new AssertionError(&quot;todo&quot;);
}
invoking more than one service causes in 90% a NPE
Invoking more than one service in a BPEL process or using a &lt;flow&gt; causes the following NPE:
19:21:40,490 | ERROR | pool-2-thread-2 | OdeConsumer | org.apache.ode.jbi.OdeConsumer 214 | error delivering RESPONSE: 
java.lang.NullPointerException
at org.apache.ode.jbi.OdeConsumer$2.call(OdeConsumer.java:187)
at org.apache.ode.jbi.OdeConsumer$2.call(OdeConsumer.java:183)
at org.apache.ode.bpel.scheduler.quartz.QuartzSchedulerImpl.execTransaction(QuartzSchedulerImpl.java:211)
at org.apache.ode.jbi.OdeConsumer.outResponse(OdeConsumer.java:182)
at org.apache.ode.jbi.OdeConsumer.onJbiMessageExchange(OdeConsumer.java:134)
at org.apache.ode.jbi.JbiMessageExchangeEventRouter.onJbiMessageExchange(JbiMessageExchangeEventRouter.java:40)
at org.apache.ode.jbi.Receiver$1.run(Receiver.java:190)
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:417)
at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:269)
at java.util.concurrent.FutureTask.run(FutureTask.java:123)
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)
at java.lang.Thread.run(Thread.java:595)
After stopping SM, cleaning the data directory, removing the ode-bpel SA, restarting SM and deploy the ode-bpel SA again in some cases the NPE was not thrown and the process work's fine.
This behaviour and ODE-80 looks like serious synchronisation problems.
java.io.EOFException in newer nightlies in mergesegs or indexing from hadoop.io.DataOutputBuffer
The nightly builds have not been working at all for the past couple of weeks. Sami Siren has narrowed it down to HADOOP-331.
To replicate: download the nightly, then:
bin/nutch inject crawl/crawldb urls/ # a single URL is in urls/urls -- http://apache.org
bin/nutch generate crawl/crawldb crawl/segments
bin/nutch fetch crawl/segments/2007...
bin/nutch updatedb crawl/crawldb crawl/segments/2007...
# generate a new segment with 5 URIs
bin/nutch generate crawl/crawldb crawl/segments -topN 5
bin/nutch fetch crawl/segments/2007... # new segment
bin/nutch updatedb crawl/crawldb crawl/segments/2007... # new segment
# merge the segments and index
bin/nutch mergesegs crawl/merged -dir crawl/segments
..
We get a crash in the mergesegs. This crash, with the exact same script and start URI, configuration and plugins, does not happen on a nightly from early January.
2007-01-18 14:57:11,411 INFO segment.SegmentMerger - Merging 2 segments to crawl/merged_07_01_18_14_56_22/20070118145711
2007-01-18 14:57:11,482 INFO segment.SegmentMerger - SegmentMerger: adding crawl/segments/20070118145628
2007-01-18 14:57:11,489 INFO segment.SegmentMerger - SegmentMerger: adding crawl/segments/20070118145641
2007-01-18 14:57:11,495 INFO segment.SegmentMerger - SegmentMerger: using segment data from: content crawl_generate crawl_fetch crawl_parse parse_data parse_text
2007-01-18 14:57:11,594 INFO mapred.InputFormatBase - Total input paths to process : 12
2007-01-18 14:57:11,819 INFO mapred.JobClient - Running job: job_5ug2ip
2007-01-18 14:57:12,073 WARN mapred.LocalJobRunner - job_5ug2ip
java.io.EOFException
at java.io.DataInputStream.readFully(DataInputStream.java:178)
at org.apache.hadoop.io.DataOutputBuffer$Buffer.write(DataOutputBuffer.java:57)
at org.apache.hadoop.io.DataOutputBuffer.write(DataOutputBuffer.java:91)
at org.apache.hadoop.io.UTF8.readChars(UTF8.java:212)
at org.apache.hadoop.io.UTF8.readString(UTF8.java:204)
at org.apache.hadoop.io.ObjectWritable.readObject(ObjectWritable.java:173)
at org.apache.hadoop.io.ObjectWritable.readFields(ObjectWritable.java:61)
at org.apache.nutch.metadata.MetaWrapper.readFields(MetaWrapper.java:100)
at org.apache.hadoop.mapred.MapTask$MapOutputBuffer.spill(MapTask.java:427)
at org.apache.hadoop.mapred.MapTask$MapOutputBuffer.sortAndSpillToDisk(MapTask.java:385)
at org.apache.hadoop.mapred.MapTask$MapOutputBuffer.access$200(MapTask.java:239)
at org.apache.hadoop.mapred.MapTask.run(MapTask.java:188)
at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:109)
integer overflow in HashComparator.compare
There's a integer overflow problem in HashComparator wich leads to fetchlist not to be sorted properly by hash of url. This leads to slower fetching speeds if there are many urls from same host as they are not evenly distributed.
parse-js skips parsing if found URL fails java.net.URL parse
The parse-js plugin in getJSLinks tries a regex looking for likely URLs against a string of javascript. Any matches that do not begin 'www' are given to java.net.URL with base URL to test 'URLness'. Often this test will fail. Currently, when it fails, nutch skips processing any more of the javascript snippet logs an error.
parse-js pollutes anchor text with base URL of source page
Parse-js plugin always adds URL -- usually page base URL -- as anchor text for any link discovered parsing javascript. Anchor text is tokenized when indexed and by default gets a heavy weighting. The upshot is often pages show high in search results for no reason other than query term appears in (URL) anchors. 
See http://www.mail-archive.com/nutch-user%40lucene.apache.org/msg06935.html for related user list postings.
Here is extract from linkdb exhibiting the problem:
https://www2.westpac.com.au/emarket/check_merch.cfm?id=900030 Inlinks: 
fromUrl: http://premier.ticketek.com.au/content/buyers/buyers_step1.aspx anchor: http://premier.ticketek.com.au/content/buyers/buyers_step1.aspx
fromUrl: http://premier.ticketek.com.au/content/outlets/agencies_qld.aspx anchor: http://premier.ticketek.com.au/content/outlets/agencies_qld.aspx
fromUrl: http://premier.ticketek.com.au/shows/show.aspx?sh=TSSWANS05 anchor: http://premier.ticketek.com.au/shows/show.aspx?sh=TSSWANS05
fromUrl: http://premier.ticketek.com.au/content/outlets/agencies_vic.aspx anchor: http://premier.ticketek.com.au/content/outlets/agencies_vic.aspx
fromUrl: http://premier.ticketek.com.au/Venues/VenueDetails.aspx?v=NMO&amp;s=6547 anchor: http://premier.ticketek.com.au/Venues/VenueDetails.aspx?v=NMO&amp;s=6547
fromUrl: http://premier.ticketek.com.au/content/buyers/buyers_step5.aspx anchor: http://premier.ticketek.com.au/content/buyers/buyers_step5.aspx
fromUrl: http://premier.ticketek.com.au/content/outlets/agencies_nsw.aspx anchor: http://premier.ticketek.com.au/content/outlets/agencies_nsw.aspx
DeleteDuplicates.HashPartitioner depends on the order of IndexDocs
DeleteDuplicates.HashPartitioner.reduce():
// byScore case
if (value.score &gt; highest.score) {
highest.keep = false;
LOG.debug(&quot;-discard &quot; + highest + &quot;, keep &quot; + value);
output.collect(highest.url, highest); // delete highest
highest = value;
}
// !byScore is also similar
So assume two docs with same hash are in values.If the first has higher score than the second than second doc will be deleted. But if the first has lower score than the second then none will be deleted. AFAICS, there should be an else condition to delete value and keep highest as it is.
Javadoc warnings
Warnings aren't so good even if it build's successfully.
[javadoc] Building tree for all the packages and classes...
[javadoc] /usr/local/src/nutch-0.9/src/java/org/apache/nutch/net/URLNormalizers.java:74: warning - Tag @link: reference not found: org.apache.nutch.net.urlnormalizer.pass.PassURLNormalizer
[javadoc] /usr/local/src/nutch-0.9/src/java/org/apache/nutch/net/URLNormalizers.java:273: warning - @return tag has no arguments.
[javadoc] /usr/local/src/nutch-0.9/src/java/org/apache/nutch/plugin/PluginManifestParser.java:73: warning - @return tag has no arguments.
[javadoc] /usr/local/src/nutch-0.9/src/java/org/apache/nutch/protocol/ProtocolFactory.java:37: warning - Missing closing '}' character for inline tag: &quot;{@link Protocol#X_POINT_ID).&quot;
[javadoc] /usr/local/src/nutch-0.9/src/java/org/apache/nutch/protocol/ProtocolFactory.java:64: warning - @return tag has no arguments.
[javadoc] /usr/local/src/nutch-0.9/src/java/org/apache/nutch/scoring/ScoringFilter.java:139: warning - Tag @param cannot be used in inline documentation. It can only be used in the following types of documentation: class/interface, constructor, method.
[javadoc] /usr/local/src/nutch-0.9/src/java/org/apache/nutch/scoring/ScoringFilter.java:139: warning - Tag @param cannot be used in inline documentation. It can only be used in the following types of documentation: class/interface, constructor, method.
[javadoc] /usr/local/src/nutch-0.9/src/java/org/apache/nutch/util/DomUtil.java:51: warning - @return tag has no arguments.
[javadoc] /usr/local/src/nutch-0.9/src/java/org/apache/nutch/scoring/ScoringFilter.java:139: warning - Tag @param cannot be used in inline documentation. It can only be used in the following types of documentation: class/interface, constructor, method.
[javadoc] Building index for all the packages and classes...
[javadoc] Building index for all classes...
[javadoc] Generating /usr/local/src/nutch-0.9/build/docs/api/stylesheet.css...
[javadoc] 10 warnings
[copy] Copying 1 file to /usr/local/src/nutch-0.9/build/docs/api/org/apache/nutch/plugin/doc-files
tag class generator (datatable . setVar())
setVar() on generated DataTable tag clazz file should take string instead of valueExpression
something like &lt;h:dataTable var=&quot;#{foo&quot;}&gt; makes it hard to access the underlying beans in a row.
selectManyListbox calls converter getAsString passing in string value during form post
Problem is pretty much the same as described in bug MYFACES-624 except that I'm experiencing it with the selectManyListbox. I first encountered this problem when switching to myfaces-1.1.0 from the version shipped with JBoss AS 4.0.3RC2. Sorry, I don't know what version was in RC2, but the MD5 sums look like this:
41db995e4201acaec1599f8a933926dc myfaces-api.jar
72cf887cb90f6ecfb7405d674de3a7cf myfaces-impl.jar
I just tried again with the 20051019 nightly build and run into the same converter getAsString problem.
For more on my particular setup, see:
http://www.jboss.com/index.html?module=bb&amp;op=viewtopic&amp;t=70678
WSDL4J 1.6.1 causes stacktrace in WSDLUtils
The OSGi deployment provides a WSDLLocator service to allow 'local' references to WSDLs and XSDs provided by other bundles. The locator throws an &quot;UnimplementedMethodException&quot; when the close method is invoked. It should just return, as there's no real work to do.
ServiceGroup.add must return a fault if it can not process a given InitialTerminationTime
I tried to add a Resource to a ServiceGroup with an InitialTerminationTime
by using the standard WS-ServiceGroupEntry-1_2.wsdl.
But the Entries were never destroyed...
I figured out that I didn't declare the wsrl-TerminationTime and
wsrl-CurrentTime properties and I didn't declare the
ScheduledTermination-Capability.
The SimpleServiceGroup capability checks for the
ScheduledTermination-Capability and only if it gets it it schedules the
terminaton of the entry.
When looking for the fault I found a incompatibility to the specification.
According to the standard the add() method should fail when it can not
schedule the termnination:
From http://docs.oasis-open.org/wsrf/wsrf-ws_service_group-1.2-spec-os.pdf
- line 493
---
If the ServiceGroup is unable or unwilling to set the TerminationTime
resource property of the ServiceGroupEntry resource to the given value of
the &quot;absolute time&quot; form or a value greater, then the Add request MUST
fault&quot;
---
So I think the createEntry-method of the SimpleServiceGroup should throw a
AddRefusedFault when it can't find the &quot;scheduled-termination&quot;-capability.
Axis Environment adds dupilicate namespaces when converting axiom nodes to dom nodes
The convertToDOM method in AxisEnvironment declares identical namespaces - i.e. namespaces with the same prefix and same namespace uri - when converting axiom nodes to DOM nodes. This leads to unexpected 500 errors in the axis engine. 
I fixed the code to ensure that no identical namespaces are declared on the DOM. I will be attaching a patch.
dynamic wsresource creation and destruction
We're currently trying out the muse frameworks ability to create and destroy WDSM enabled WsResources, but we seem to have run into a slight problem with the correct way to destroy these resources.
A fast overview goes as follows:
1) We've a factory to create resources on the fly.
2) We change a couple of the values held by the resource (to get the on-change WS-N sent out)
3) Next we attempt to clean up, by destroying the WsResources
4) We run the whole thing again from 1) without restarting the Tomcat server
Notes regarding software usage:
MUSE 2.0.0
Java SDK 1.5_07
Axis 2.0
The printout from the shutdown (destruction) process is:
11-Jan-2007 14:21:27 org.apache.muse.core.SimpleResource shutdown
INFO: [ID = 'ResourceDestroyed'] The resource at 'WsResource' has been destroyed.
Though it seems as if, even though the prepareShutdown() function has been overridden, that our override doesn't run.
** overridden initializeComplete()
public void initializeCompleted() throws SoapFault {
super.initializeCompleted(); 
publishMessage(&quot;we have been created&quot;);
}
** overridden prepareShutdown()
public void prepareShutdown() throws SoapFault {
super.prepareShutdown();
getLog().info(&quot;calling shutdown&quot;);
}
Our problem is that upon the 2nd run of the process (without shutting down the server) we get the following error message from the SimpleAdvertisement:
INFO: [ID = 'ResourceInitialized'] The resource at 'SubscriptionManager' has been initialized.
java.lang.NullPointerException
at org.apache.muse.ws.dm.muws.adv.impl.SimpleAdvertisement.isAdvertised(SimpleAdvertisement.java:32)
at org.apache.muse.ws.dm.muws.adv.impl.AbstractAdvertisement.resourceAdded(AbstractAdvertisement.java:96)
at org.apache.muse.core.SimpleResourceManager.addResource(SimpleResourceManager.java:108)
at org.apache.muse.ws.notification.impl.SimpleNotificationProducer.subscribe(SimpleNotificationProducer.java:575)
at org.apache.muse.ws.dm.muws.adv.impl.AbstractAdvertisement.subscribeInitialConsumer(AbstractAdvertisement.java:175)
... and a lot more
False WSRP Change Notifications
I want to reduce message exchanges when getting the
ServiceGroupEntry-Properties by buffering the content elements instead of
getting it directly from the member-resource at every call.
Fro doing so, I tried to extend the SimpleEntry class by buffering the
content element and get notified by updates via WSRP change notifications.
That for the ServiceGroupEntry subscribes itself to the content-properties
(in my simple case the OperationalStatus) of the member-resource at the end
of its initializeCompleted-method:
public void initializeCompleted() throws SoapFault {
super.initializeCompleted();
subscribeToMemberProperties();
}
private void subscribeToMemberProperties(){
try {
ServiceGroup sg =
(ServiceGroup)getServiceGroup().getCapability(WssgConstants.SERVICE_GROUP_URI);
NotificationConsumer consumerCap =
(NotificationConsumer)getResource().getCapability(WsnConstants.CONSUMER_URI);
EndpointReference producerEPR = getMemberEPR();
EndpointReference myEPR = getResource().getEndpointReference();
NotificationProducerClient producer = new
NotificationProducerClient(producerEPR);
if(logger.isDebugEnabled()){
producer.setTrace(true);
}
//get the Property-QNames for the properties to subscribe for
QName[] contentNames = sg.getContentElements();
for (QName topic : contentNames) {
//
// Step 1: subscribe myself to the producer resource
//
TopicFilter filter = new TopicFilter(topic);
this.subscriptionClient = producer.subscribe(myEPR, filter,
null);
// Add MessageListener for the topic (a simple private
innerClass that accepts all messages when the subscriptionReferenceEPR
equals the saved subscriptionClient.getEPR())
EntryMessageListener listener = new
EntryMessageListener(topic);
consumerCap.addMessageListener(listener);
}
} catch (BaseFault e) {
logger.error(&quot;subscribeToMemberProperties()&quot;, e);
} catch (SoapFault e) {
logger.error(&quot;subscribeToMemberProperties()&quot;, e);
}
}
Can I create a single Filter for all contentElements? Could I do that with
the new FilterSet (JIRA - MUSE-122) ?
With having two Resources I have the following subscriptions when
registering the resources to the ServiceGroup:
ServiceGroupEntry - MuseResource-2 subscribes to WsResource -
MuseResource-1
&lt;soap:Envelope xmlns:soap=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;
&lt;soap:Header&gt;
&lt;wsa:To
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://134.100.14.93:8080/DefaultService/services/WsResource&lt;/wsa:To&gt;
&lt;wsa:Action
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://docs.oasis-open.org/wsn/bw-2/NotificationProducer/SubscribeRequest&lt;/wsa:Action&gt;
&lt;wsa:MessageID
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;uuid:9c01d504-eebd-5801-154e-22a17bc3a008&lt;/wsa:MessageID&gt;
&lt;wsa:From xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;wsa:Address&gt;http://www.w3.org/2005/08/addressing/role/anonymous&lt;/wsa:Address&gt;
&lt;/wsa:From&gt;
&lt;muse-wsa:ResourceId
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;
wsa:IsReferenceParameter=&quot;true&quot;
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-1&lt;/muse-wsa:ResourceId&gt;
&lt;/soap:Header&gt;
&lt;soap:Body&gt;
&lt;wsnt:Subscribe xmlns:wsnt=&quot;http://docs.oasis-open.org/wsn/b-2&quot;&gt;
&lt;wsnt:ConsumerReference&gt;
&lt;wsa:Address
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://192.168.28.1:8080/RegistryService/services/ServiceGroupEntry&lt;/wsa:Address&gt;
&lt;wsa:ReferenceParameters
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;muse-wsa:ResourceId
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-2&lt;/muse-wsa:ResourceId&gt;
&lt;/wsa:ReferenceParameters&gt;
&lt;/wsnt:ConsumerReference&gt;
&lt;wsnt:Filter&gt;
&lt;wsnt:TopicExpression
Dialect=&quot;http://docs.oasis-open.org/wsn/t-1/TopicExpression/Concrete&quot;
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;&gt;muws2:OperationalStatus&lt;/wsnt:TopicExpression&gt;
&lt;/wsnt:Filter&gt;
&lt;/wsnt:Subscribe&gt;
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
ServiceGroupEntry - MuseResource-3 subscribes to WsResource -
MuseResource-2
&lt;soap:Envelope xmlns:soap=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;
&lt;soap:Header&gt;
&lt;wsa:To
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://134.100.14.93:8080/DefaultService/services/WsResource&lt;/wsa:To&gt;
&lt;wsa:Action
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://docs.oasis-open.org/wsn/bw-2/NotificationProducer/SubscribeRequest&lt;/wsa:Action&gt;
&lt;wsa:MessageID
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;uuid:993f6ca5-ea17-ce36-c9c3-ac45351da5ad&lt;/wsa:MessageID&gt;
&lt;wsa:From xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;wsa:Address&gt;http://www.w3.org/2005/08/addressing/role/anonymous&lt;/wsa:Address&gt;
&lt;/wsa:From&gt;
&lt;muse-wsa:ResourceId
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;
wsa:IsReferenceParameter=&quot;true&quot;
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-2&lt;/muse-wsa:ResourceId&gt;
&lt;/soap:Header&gt;
&lt;soap:Body&gt;
&lt;wsnt:Subscribe xmlns:wsnt=&quot;http://docs.oasis-open.org/wsn/b-2&quot;&gt;
&lt;wsnt:ConsumerReference&gt;
&lt;wsa:Address
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://192.168.28.1:8080/RegistryService/services/ServiceGroupEntry&lt;/wsa:Address&gt;
&lt;wsa:ReferenceParameters
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;muse-wsa:ResourceId
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-3&lt;/muse-wsa:ResourceId&gt;
&lt;/wsa:ReferenceParameters&gt;
&lt;/wsnt:ConsumerReference&gt;
&lt;wsnt:Filter&gt;
&lt;wsnt:TopicExpression
Dialect=&quot;http://docs.oasis-open.org/wsn/t-1/TopicExpression/Concrete&quot;
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;&gt;muws2:OperationalStatus&lt;/wsnt:TopicExpression&gt;
&lt;/wsnt:Filter&gt;
&lt;/wsnt:Subscribe&gt;
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
When changing the OperationalStatus of WsResource - MuseResource-1 to
Unavailable by:
&lt;soap:Envelope xmlns:soap=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;
&lt;soap:Header&gt;
&lt;wsa:To
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://134.100.14.93:8080/DefaultService/services/WsResource&lt;/wsa:To&gt;
&lt;wsa:Action
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://docs.oasis-open.org/wsrf/rpw-2/SetResourceProperties/SetResourcePropertiesRequest&lt;/wsa:Action&gt;
&lt;wsa:MessageID
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;uuid:be807ac5-5dbb-96ed-6d1d-61c7629b0694&lt;/wsa:MessageID&gt;
&lt;wsa:From xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;wsa:Address&gt;http://www.w3.org/2005/08/addressing/role/anonymous&lt;/wsa:Address&gt;
&lt;/wsa:From&gt;
&lt;muse-wsa:ResourceId
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;
wsa:IsReferenceParameter=&quot;true&quot;
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-1&lt;/muse-wsa:ResourceId&gt;
&lt;/soap:Header&gt;
&lt;soap:Body&gt;
&lt;wsrf-rp:SetResourceProperties
xmlns:wsrf-rp=&quot;http://docs.oasis-open.org/wsrf/rp-2&quot;&gt;
&lt;wsrf-rp:Update&gt;
&lt;muws2:OperationalStatus
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;&gt;Unavailable&lt;/muws2:OperationalStatus&gt;
&lt;/wsrf-rp:Update&gt;
&lt;/wsrf-rp:SetResourceProperties&gt;
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
I get the following Notifications from both WsResources:
WsResource - MuseResource-1 notifies its entry (as it should be)
&lt;soap:Envelope xmlns:soap=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;
&lt;soap:Header&gt;
&lt;wsa:To
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://192.168.28.1:8080/RegistryService/services/ServiceGroupEntry&lt;/wsa:To&gt;
&lt;wsa:Action
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://docs.oasis-open.org/wsn/bw-2/NotificationConsumer/NotifyRequest&lt;/wsa:Action&gt;
&lt;wsa:MessageID
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;uuid:10e4f1ff-0b96-fe39-3766-81a50ea820db&lt;/wsa:MessageID&gt;
&lt;wsa:From xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;wsa:Address&gt;http://134.100.14.93:8080/DefaultService/services/WsResource&lt;/wsa:Address&gt;
&lt;wsa:ReferenceParameters&gt;
&lt;muse-wsa:ResourceId
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-1&lt;/muse-wsa:ResourceId&gt;
&lt;/wsa:ReferenceParameters&gt;
&lt;/wsa:From&gt;
&lt;muse-wsa:ResourceId
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;
wsa:IsReferenceParameter=&quot;true&quot;
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-2&lt;/muse-wsa:ResourceId&gt;
&lt;/soap:Header&gt;
&lt;soap:Body&gt;
&lt;wsnt:Notify xmlns:wsnt=&quot;http://docs.oasis-open.org/wsn/b-2&quot;&gt;
&lt;wsnt:NotificationMessage
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;
xmlns:wsnt=&quot;http://docs.oasis-open.org/wsn/b-2&quot;
xmlns:wsrf-rp=&quot;http://docs.oasis-open.org/wsrf/rp-2&quot;&gt;
&lt;wsnt:SubscriptionReference&gt;
&lt;wsa:Address
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://134.100.14.93:8080/DefaultService/services/SubscriptionManager&lt;/wsa:Address&gt;
&lt;wsa:ReferenceParameters
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;muse-wsa:ResourceId
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-2&lt;/muse-wsa:ResourceId&gt;
&lt;/wsa:ReferenceParameters&gt;
&lt;/wsnt:SubscriptionReference&gt;
&lt;wsnt:Topic
Dialect=&quot;http://docs.oasis-open.org/wsn/t-1/TopicExpression/Concrete&quot;
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;&gt;muws2:OperationalStatus&lt;/wsnt:Topic&gt;
&lt;wsnt:ProducerReference&gt;
&lt;wsa:Address
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://134.100.14.93:8080/DefaultService/services/WsResource&lt;/wsa:Address&gt;
&lt;wsa:ReferenceParameters
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;muse-wsa:ResourceId
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-1&lt;/muse-wsa:ResourceId&gt;
&lt;/wsa:ReferenceParameters&gt;
&lt;/wsnt:ProducerReference&gt;
&lt;wsnt:Message&gt;
&lt;wsrf-rp:ResourcePropertyValueChangeNotification
xmlns:wsrf-rp=&quot;http://docs.oasis-open.org/wsrf/rp-2&quot;&gt;
&lt;wsrf-rp:OldValues&gt;
&lt;muws2:OperationalStatus
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;&gt;Available&lt;/muws2:OperationalStatus&gt;
&lt;/wsrf-rp:OldValues&gt;
&lt;wsrf-rp:NewValues&gt;
&lt;muws2:OperationalStatus
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;&gt;Unavailable&lt;/muws2:OperationalStatus&gt;
&lt;/wsrf-rp:NewValues&gt;
&lt;/wsrf-rp:ResourcePropertyValueChangeNotification&gt;
&lt;/wsnt:Message&gt;
&lt;/wsnt:NotificationMessage&gt;
&lt;/wsnt:Notify&gt;
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
And WsResource - MuseResource-2 notifies its Entry of an
PropertyValueChange (that is my problem)
&lt;soap:Envelope xmlns:soap=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;
&lt;soap:Header&gt;
&lt;wsa:To
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://192.168.28.1:8080/RegistryService/services/ServiceGroupEntry&lt;/wsa:To&gt;
&lt;wsa:Action
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://docs.oasis-open.org/wsn/bw-2/NotificationConsumer/NotifyRequest&lt;/wsa:Action&gt;
&lt;wsa:MessageID
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;uuid:29bdb8a0-6936-1185-9b7f-d31ddc978590&lt;/wsa:MessageID&gt;
&lt;wsa:From xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;wsa:Address&gt;http://134.100.14.93:8080/DefaultService/services/WsResource&lt;/wsa:Address&gt;
&lt;wsa:ReferenceParameters&gt;
&lt;muse-wsa:ResourceId
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-2&lt;/muse-wsa:ResourceId&gt;
&lt;/wsa:ReferenceParameters&gt;
&lt;/wsa:From&gt;
&lt;muse-wsa:ResourceId
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;
wsa:IsReferenceParameter=&quot;true&quot;
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-3&lt;/muse-wsa:ResourceId&gt;
&lt;/soap:Header&gt;
&lt;soap:Body&gt;
&lt;wsnt:Notify xmlns:wsnt=&quot;http://docs.oasis-open.org/wsn/b-2&quot;&gt;
&lt;wsnt:NotificationMessage
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;
xmlns:wsnt=&quot;http://docs.oasis-open.org/wsn/b-2&quot;
xmlns:wsrf-rp=&quot;http://docs.oasis-open.org/wsrf/rp-2&quot;&gt;
&lt;wsnt:SubscriptionReference&gt;
&lt;wsa:Address
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://134.100.14.93:8080/DefaultService/services/SubscriptionManager&lt;/wsa:Address&gt;
&lt;wsa:ReferenceParameters
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;muse-wsa:ResourceId
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-3&lt;/muse-wsa:ResourceId&gt;
&lt;/wsa:ReferenceParameters&gt;
&lt;/wsnt:SubscriptionReference&gt;
&lt;wsnt:Topic
Dialect=&quot;http://docs.oasis-open.org/wsn/t-1/TopicExpression/Concrete&quot;
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;&gt;muws2:OperationalStatus&lt;/wsnt:Topic&gt;
&lt;wsnt:ProducerReference&gt;
&lt;wsa:Address
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://134.100.14.93:8080/DefaultService/services/WsResource&lt;/wsa:Address&gt;
&lt;wsa:ReferenceParameters
xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;muse-wsa:ResourceId
xmlns:muse-wsa=&quot;http://ws.apache.org/muse/addressing&quot;&gt;MuseResource-2&lt;/muse-wsa:ResourceId&gt;
&lt;/wsa:ReferenceParameters&gt;
&lt;/wsnt:ProducerReference&gt;
&lt;wsnt:Message&gt;
&lt;wsrf-rp:ResourcePropertyValueChangeNotification
xmlns:wsrf-rp=&quot;http://docs.oasis-open.org/wsrf/rp-2&quot;&gt;
&lt;wsrf-rp:OldValues&gt;
&lt;muws2:OperationalStatus
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;&gt;Available&lt;/muws2:OperationalStatus&gt;
&lt;/wsrf-rp:OldValues&gt;
&lt;wsrf-rp:NewValues&gt;
&lt;muws2:OperationalStatus
xmlns:muws2=&quot;http://docs.oasis-open.org/wsdm/muws2-2.xsd&quot;&gt;Unavailable&lt;/muws2:OperationalStatus&gt;
&lt;/wsrf-rp:NewValues&gt;
&lt;/wsrf-rp:ResourcePropertyValueChangeNotification&gt;
&lt;/wsnt:Message&gt;
&lt;/wsnt:NotificationMessage&gt;
&lt;/wsnt:Notify&gt;
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
When getting the ResourcePropertiesDocument of WsResource - MuseResource-2
the OperationalStatus is still &quot;Available&quot; as it should be. Although the
notification of a change was sent.
I don't know what I am doing wrong, am I handling the subscription process
right?
Sorry for this long email, I hope the xml-output will be readable.
Muse 2.2.0 deploy structure changed, can't find muse.xml and other files
Ramesh brought this issue up earlier, and Dan submitted a fix, but I don't think it's the correct fix.
In 2.0.0, the muse.xml, wsdl folder, and router-entries folder were in the WEB-INF/services/muse folder. But now, 2.1.0 only works if these items are moved to the /classes folder. I don't think this is right as I don't see why any non-class files are supposed to be in the /classes folder.
During the 2.1.0 pre-release voting period, this issue arose and Dan fixed the build.xml in the samples to automatically copy these files to the /classes folder, so the samples work when deployed. But, my current 2.0.0 project breaks in 2.1.0 because of the changed dir structure.
If these dir changes are permanent going forward, then nothing needs to be done, but the architecture change should be described to the community in some release details. If this is not the intended change for 2.1.0, then there is a bug in the Muse code, and all the build.xml files in the samples need to be fixed back to 2.0.0 dir style.
all samples are broken out of the box, missing services.xml
All samples for the latest Muse 2.1.0 release are broken and can't be run out of the box. The /config/services.xml file is missing, and the build.xml no longer looks for this file when generating the war. Most of the samples worked fine out of the box in 2.0.0.
GetCurrentMessage response does not include NotificationMessage element (wrapper) on property change events
The rest of the NotificationMessage payload is in the GetCurrentMessageResponse element, but the root element of the message is missing. This causes parsing errors on the client side. This problem was noticed with resource property change messages, but may have been introduced for other messages as well. I will have to investigate both.
Clean up sample WSDLs and make sure wsdl2java consumes them properly
The WSDL bindings need to specifiy a 'literal' style instead of 'encoded' - the WSDLs are actually for doc-literal services, but the 'encoded' part crept in through some cut and paste error. This may also lead to a change in the WSDL generation in wsdl2java.
We should also change the soapAction attribute in the binding operations to match the WS-A Action URIs that are in the portType messages.
Neither of these things is needed by the Muse runtime but will help people using other tools that consume WSDL to interpret them the same way Muse does.
Schema validation fails for NonNilable ResourceProperties, when child elements of the resource properties are optional (minOccours=&quot;0&quot;)
I have the following declaration for ResourceProperties in my wsdl-file:
&lt;xs:complexType name=&quot;MyPropertiesType&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element ref=&quot;tns:MyType&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;xs:element name=&quot;MyType&quot; type=&quot;tns:MyType1&quot; /&gt;
&lt;xs:complexType name=&quot;MyType1&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element ref=&quot;tns:MyType2&quot; minOccurs=&quot;0&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
However, the schema validation (validateSchema() in SimpleResourcePropertyCollection) does not honor that the property may be empty (e.g. &lt;MyType/&gt;) and recognizes it as nil. Therefore the schema validation process breaks.
// some sort of &quot;can be empty check&quot; is missing here
if (!isNillable)
{
for (int n = 0; n &lt; instances.length; ++n)
{
//
// check for child elements, attributes, and text, all of 
// which qualify an element as &quot;not null&quot;
//
if (!instances[n].hasChildNodes() &amp;&amp; 
!instances[n].hasAttributes() &amp;&amp; 
XmlUtils.extractText(instances[n]) == null)
throw new SchemaValidationFault(message);
}
}
Child topics in topic set documents are being parsed as root topics by notification producer
The addTopic routines in SimpleNotificationProducer, which parse topic set documents to TopicNameSpace objects, are treating child topics in the topic set document as root topics. 
Lets say I have this topic set doucment (root and children belong to same namespace):
&lt;root1&gt;
&lt;child1/&gt;
&lt;child2/&gt;
&lt;/root1&gt;
Here is the sequence of events which leads to the erroneous behavior:
1) createTopicSetDocument in SimpleNotificationProducer calls addTopics on all root topics in document.
2) addTopics calls addTopic to add root1, and then recursively calls itself for all children of root.
3) Now, when addTopic is called with child1, the following code is executed (in the addTopic method):
Topic topic = new SimpleTopic(localName, topicSpace);
topicSpace.addTopic(topic);
This causes the child1 to be added as a root topic as this code is executed in SimpleTopicSpace.addTopic: &quot;_rootTopics.put(name, topic);&quot;
where the name is child1. Same applies to child2.
The problem was exposed when I tried to evaluate a concrete topic expression against this topic set document; it was treating child1 and child2 as root topics in the namespace, instead of child topics of root1.
Problems with the muse tutorial
While trying to do the tutorial ran into a number of problems. See attached files for more information. Not really insight into which components exactly are affected since I was doing the tutorial to learn more about muse.
Input array parameters are not correctly generated
When using this kind of input message in a WSDL file:
.......
&lt;xsd:element name=&quot;Lookup&quot;&gt;
&lt;xsd:complexType&gt;
&lt;xsd:sequence&gt;
&lt;xsd:element name=&quot;Entry&quot; type=&quot;xsd:string&quot; minOccurs=&quot;0&quot;
maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;
&lt;/xsd:element&gt;
.......
It is expected to obtain a method with an Array as input but instead I get this kind method signature:
String lookup(String param0) throws Exception;
Instead of the expected
String lookup(String[] param0) throws Exception;
I also tried defining the input as 
&lt;xsd:element name=&quot;Lookup&quot;&gt;
&lt;xsd:complexType&gt;
&lt;xsd:sequence&gt;
&lt;xsd:element name=&quot;Entries&quot; type=&quot;tns:EntriesType&quot;/&gt;
&lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;
&lt;/xsd:element&gt;
&lt;xsd:complexType name=&quot;PackagesType&quot;&gt;
&lt;xsd:sequence&gt;
&lt;xsd:element name=&quot;Entry&quot; type=&quot;xsd:string&quot; minOccurs=&quot;0&quot;
maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;
But then I get the following method signature:
String lookup(Element param0) throws Exception;
I think maybe the WSDL generation tool ignores the minOccurs - MaxOccurs attributes of the input message so it does not treat it like an Array.
some bug in .net 1.*
some bug in .net 1.*
if use sort() then we meet memory leak error.
must be readerCache.Clear(); in Store() method.
open Search\FieldSortedHitQueue.cs 
and add method.
internal static void Close(IndexReader reader) 
{ 
lock (Comparators.SyncRoot) 
{ 
System.Collections.Hashtable readerCache = (System.Collections.Hashtable) Comparators[reader]; 
if (readerCache != null) 
{ 
readerCache.Clear(); 
} 
Comparators.Remove(reader);
} 
} 
and... FieldCacheImpl.cs add method,too
public virtual void Close(IndexReader reader)
{ 
lock (this) 
{ 
System.Collections.Hashtable readerCache = (System.Collections.Hashtable) cache[reader]; 
if (readerCache != null) 
{ 
readerCache.Clear(); 
readerCache = null;
}
cache.Remove(reader); 
} 
} 
and then, edit Close() method of IndexSearcher class 
public override void Close()
{
FieldSortedHitQueue.Close(reader); 
Lucene.Net.Search.FieldCache_Fields.DEFAULT.Close(reader);
if (closeReader)
reader.Close();
}
And there is an omission in the article that I made.
Additionaly the FieldCacheImpl Class was inherited an 'FieldCache interface (FirldCache.cs)' 
and you should define its 'close() method' as a 'void Close (IndexReader reader);'
i wanna become lucene.net committer.
how can i do?
Problem with multiple indices and multisearcher
Hi,
I am working on a project where we have created an application that searches an index that is created by a service. The service continually watches a directory and updates the index. This part works fine. I have now added a second index created by another application. I would like to be able to search across both indexes. So I made changes to my first application so that it uses multisearcher passing in an array of searchers for both of the indexes I want to search. However, this seems to result in an error (shown further down). Also, both indexes have the same fields and either one works fine by itself, it is just when multisearcher is introduced that I end up with a problem.
Here is the error I get:
Object reference not set to an instance of an object.
at Lucene.Net.Store.FSIndexInput.ReadInternal(Byte[] b, Int32 offset, Int32 len) in C:\development\Lucene.Net.1.9.rc7\Store\FSDirectory.cs:line 740
at Lucene.Net.Store.BufferedIndexInput.ReadBytes(Byte[] b, Int32 offset, Int32 len) in C:\development\Lucene.Net.1.9.rc7\Store\BufferedIndexInput.cs:line 53
at Lucene.Net.Index.CompoundFileReader.CSIndexInput.ReadInternal(Byte[] b, Int32 offset, Int32 len) in C:\development\Lucene.Net.1.9.rc7\Index\CompoundFileReader.cs:line 246
at Lucene.Net.Store.BufferedIndexInput.Refill() in C:\development\Lucene.Net.1.9.rc7\Store\BufferedIndexInput.cs:line 74
at Lucene.Net.Store.BufferedIndexInput.ReadByte() in C:\development\Lucene.Net.1.9.rc7\Store\BufferedIndexInput.cs:line 36
at Lucene.Net.Store.IndexInput.ReadVInt() in C:\development\Lucene.Net.1.9.rc7\Store\IndexInput.cA first chance exception of type 'System.NullReferenceException' occurred in Lucene.Net.dll
s:line 63
at Lucene.Net.Index.TermBuffer.Read(IndexInput input, FieldInfos fieldInfos) in C:\development\Lucene.Net.1.9.rc7\Index\TermBuffer.cs:line 70
at Lucene.Net.Index.SegmentTermEnum.Next() in C:\development\Lucene.Net.1.9.rc7\Index\SegmentTermEnum.cs:line 130
at Lucene.Net.Index.SegmentTermEnum.ScanTo(Term term) in C:\development\Lucene.Net.1.9.rc7\Index\SegmentTermEnum.cs:line 166
at Lucene.Net.Index.TermInfosReader.ScanEnum(Term term) in C:\development\Lucene.Net.1.9.rc7\Index\TermInfosReader.cs:line 175
at Lucene.Net.Index.TermInfosReader.Get(Term term) in C:\development\Lucene.Net.1.9.rc7\Index\TermInfosReader.cs:line 168
at Lucene.Net.Index.TermInfosReader.Terms(Term term) in C:\development\Lucene.Net.1.9.rc7\Index\TermInfosReader.cs:line 236
at Lucene.Net.Index.SegmentReader.Terms(Term t) in C:\development\Lucene.Net.1.9.rc7\Index\SegmentReader.cs:line 317
at Lucene.Net.Search.PrefixQuery.Rewrite(IndexReader reader) in C:\development\Lucene.Net.1.9.rc7\Search\PrefixQuery.cs:line 49
at Lucene.Net.Search.BooleanQuery.Rewrite(IndexReader reader) in C:\development\Lucene.Net.1.9.rc7\Search\BooleanQuery.cs:line 514
at Lucene.Net.Search.IndexSearcher.Rewrite(Query original) in C:\development\Lucene.Net.1.9.rc7\Search\IndexSearcher.cs:line 276
at Lucene.Net.Search.MultiSearcher.Rewrite(Query original) in C:\development\Lucene.Net.1.9.rc7\Search\MultiSearcher.cs:line 333
at Lucene.Net.Search.Query.Weight(Searcher searcher) in C:\development\Lucene.Net.1.9.rc7\Search\Query.cs:line 98
at Lucene.Net.Search.Hits..ctor(Searcher s, Query q, Filter f) in C:\development\Lucene.Net.1.9.rc7\Search\Hits.cs:line 41
at Lucene.Net.Search.Searcher.Search(Query query, Filter filter) in C:\development\Lucene.Net.1.9.rc7\Search\Searcher.cs:line 54
at Lucene.Net.Search.Searcher.Search(Query query) in C:\development\Lucene.Net.1.9.rc7\Search\Searcher.cs:line 45
Thanks,
Vivek Gupta
RAMDirectory not Serializable
The current implementation of RAMDirectory throws a NotSerializableException when trying to serialize, due to the inner class KeySet of HashMap not being serializable (god knows why)
java.io.NotSerializableException: java.util.HashMap$KeySet
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1081)
Caused by line 43:
private Set fileNames = fileMap.keySet();
EDIT:
while we're at it: same goes for inner class Values 
java.io.NotSerializableException: java.util.HashMap$Values
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1081)
Collection files = fileMap.values();
Exception in deleteDocument, undeleteAll or setNorm in IndexReader can fail to release write lock on close
I hit this while working on LUCENE-140
We have 3 cases in the IndexReader methods above where we have this pattern:
if (directoryOwner) acquireWriteLock();
doSomething();
hasChanges = true;
The problem is if you hit an exception in doSomething(), and hasChanges was not already true, then hasChanges will not have been set to true yet the write lock is held. If you then try to close the reader without making any other changes, then the write lock is not released because in IndexReader.close() (well, in commit()) we only release write lock if hasChanges is true.
I think the simple fix is to swap the order of hasChanges = true and doSomething(). I already fixed one case of this under LUCENE-140 commit yesterday; I will fix the other two under this issue.
Nightly build archives do not contain Java source code.
Under the Lucene News section of the Overview page, this item's link:
26 January 2006 - Nightly builds available
http://cvs.apache.org/dist/lucene/java/nightly/
goes to a directory with several 1.9M files, none of which have the src/java tree in them.
docs out of order
Hello,
I can not find out, why (and what) it is happening all the time. I got an
exception:
java.lang.IllegalStateException: docs out of order
at
org.apache.lucene.index.SegmentMerger.appendPostings(SegmentMerger.java:219)
at
org.apache.lucene.index.SegmentMerger.mergeTermInfo(SegmentMerger.java:191)
at
org.apache.lucene.index.SegmentMerger.mergeTermInfos(SegmentMerger.java:172)
at org.apache.lucene.index.SegmentMerger.mergeTerms(SegmentMerger.java:135)
at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:88)
at org.apache.lucene.index.IndexWriter.mergeSegments(IndexWriter.java:341)
at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:250)
at Optimize.main(Optimize.java:29)
It happens either in 1.2 and 1.3rc1 (anyway what happened to it? I can not find
it neither in download nor in version list in this form). Everything seems OK. I
can search through index, but I can not optimize it. Even worse after this
exception every time I add new documents and close IndexWriter new segments is
created! I think it has all documents added before, because of its size.
My index is quite big: 500.000 docs, about 5gb of index directory.
It is _repeatable_. I drop index, reindex everything. Afterwards I add a few
docs, try to optimize and receive above exception.
My documents' structure is:
static Document indexIt(String id_strony, Reader reader, String data_wydania,
String id_wydania, String id_gazety, String data_wstawienia)
{
Document doc = new Document();
doc.add(Field.Keyword(&quot;id&quot;, id_strony ));
doc.add(Field.Keyword(&quot;data_wydania&quot;, data_wydania));
doc.add(Field.Keyword(&quot;id_wydania&quot;, id_wydania));
doc.add(Field.Text(&quot;id_gazety&quot;, id_gazety));
doc.add(Field.Keyword(&quot;data_wstawienia&quot;, data_wstawienia));
doc.add(Field.Text(&quot;tresc&quot;, reader));
return doc;
}
Sincerely,
legez
XMLLayoutTestCase fails on compilers that do not provide location info
XMLLayoutTestCase depends on __LOG4CXX_FUNC__ containing the current class and method name which is only the case for VC6 and later and gcc and results in the test failing on Solaris where __LOG4CXX_FUNC__ is currently defined as &quot;&quot;. Testing __LOG4CXX_FUNC__ is not related to testing the XMLLayout, so the test has been modified to redefine __LOG4CXX_FUNC__ to the fixed expected value. Ideally other tests would be written to check that __LOG4CXX_FUNC__ works as expected.
XMLSocketAppender is disabled
XMLSocketAppender had the statement that actually sent the formatted event to the socket commented out from the earlier Unicode rework. In the original code, Microsoft Platform SDK conversion macro T2A was used to convert from TCHAR to the current code page before sending the content to the socket. The associated patch restores the functionality by using the LOG4CXX_ENCODE_CHAR macro which does effectively the same thing. Neither is correct however since it would use the current code page instead of UTF-8 which would be what an XML parser would expect, but that is another bug.
Using RollingFileAppender increases the working set with each rollover
There seems to be a memory leak in APR 1.2.7 (see http://issues.apache.org/bugzilla/show_bug.cgi?id=40955) which can be reproduced using RollingFileAppenders:
I have observed that our application increases its working set in 8k steps. I have tracked it down to happen whenever the log file rolls over:
log4cxx::rolling::RollingFileAppender::rollover() (Line 153) calls WriterAppender::closeWriter() which allocates a new APR pool. Before this pool is freed, a call
to allocator_free() comes from a FileOutputStream destructor, followed by the allocator_free() call for the closeWriter pool. Because of the above APR bug, only one of these pools is deallocated...
Perusing the guide lines for APR pools (http://svn.apache.org/viewvc/apr/apr/trunk/docs/pool-design.html?view=co), I suppose that closeWriter doesn't need its own pool (&quot;Objects should not have their own pools.&quot;). When I changed the log4cxx source accordingly, I couldn't reproduce the leak anymore. (UPDATE: that's not true)
helpers/object.h: DECLARE_LOG4CXX_OBJECT macro definition is missing virtual destructor declaration
Hi,
the macro DECLARE_LOG4CXX_OBJECT declares a new class with a virtual function, but doesn't declare a virtual destructor. gcc 3.2.3 complains this...
The following is the new macro definition fixing the bug (for the code in CVS head):
#define DECLARE_LOG4CXX_OBJECT(object)\
public:\
class Class##object : public helpers::Class\
{\
public:\
Class##object() : helpers::Class() {}\
virtual ~Class##object() {}\
virtual const log4cxx::logchar* getName() const { return LOG4CXX_STR(#object); } \
virtual helpers::ObjectPtr newInstance() const\
{\
return new object();\
}\
};\
The DECLARE_ABSTRACT_LOG4CXX_OBJECT macro has the same problem, but only in CVS head, not in 0.9.7.
make install fails since @manual_dest@ replacement is missing in Makefiles
after building, &quot;make install&quot; fails. The reason is that the new replacement variable @manual_dest@ which is used in the Doxygen configuration file is not yet known by the autoconf build system.
'-xarch=v8plus should be removed from Makefile.in
To be able to build both 32bits and 64bits versions of log4cxx on Solaris the hardcoding of &quot;-xarch=v8plus&quot; should be removed from Makefile.in line 207 and 208.
The user can then set the correct arch value in CXXFLAGS when running configure. If no arch value is set, Sun Studio default value will be used.
Javadoc missing from distribution
The javadoc is missing from the 1.2 zip file. Broken links in the user guide and elsewhere in the documentation reference the missing directory at docs/apidocs where the javadoc should be.
Error while running jetspeed seed scripts when using a path containing spaces
When I use the maven goal &quot;j2:db.entities&quot; I get the following error :
[echo] running _db.seed with data: D:/DEV/7.x/HR Projects/HR Portal/target/portal-sql/ arguments: -b target/portal-sql/assembly/boot/ -c target/portal-sql/assembly/ database-url: jdbc:mysql://localhost/hrportal
[java] Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Unknown argument: Projects
[java] at org.apache.jetspeed.serializer.JetspeedSerializerApplication.main(JetspeedSerializerApplication.java:163)
[java] [ERROR] Java Result: 1
That's because the path I use contains spaces.
To correct this issue, I think you can edit the file maven-plugin/plugin.jelly and replace :
&lt;arg line=&quot;-I ${DATAFILE} -b ${temp.assembly.dir}/boot/ -c ${temp.assembly.dir}/ -dc ${org.apache.jetspeed.database.driver} -ds ${org.apache.jetspeed.database.url} -du ${org.apache.jetspeed.database.user} -dp ${org.apache.jetspeed.database.password}&quot;/&gt;
with : 
&lt;arg line=&quot;-I &amp;quot;${DATAFILE}&amp;quot; -b ${temp.assembly.dir}/boot/ -c ${temp.assembly.dir}/ -dc ${org.apache.jetspeed.database.driver} -ds ${org.apache.jetspeed.database.url} -du ${org.apache.jetspeed.database.user} -dp ${org.apache.jetspeed.database.password}&quot;/&gt;
More Derby &quot;ERROR 40XL1&quot; issues with multithreaded tests
I see the same DERBY error: &quot;ERROR 40XL1: A lock could not be obtained within the time requested&quot; as reported in JDO-324 for two different test cases: 
- RefreshAllWithArraySideEffects 
- RefreshAllWithCollectionSideEffects
The reason might be that I switched to a dual core machine.
JDO-324 fixed test case RefreshAllNoParameterSideEffects. Maybe we need to apply the same fix to the other test cases RefreshAllWithArraySideEffects and RefreshAllWithCollectionSideEffects.
PropertyReadMethodsTest.testIsSame leaks session
The test case obtains a second session but doesn't logout().
XPath parser ignores parent axis
The query handler in Jackrabbit does not support the parent axis and should throw an invalid query exception in that case.
Example query:
//foo/..
Missing jackrabbit-rmi-service.xml from jackrabbit-jcr-rmi-1.2.1.jar
The file jackrabbit-rmi-service.xml is missing from the jackrabbit-jcr-rmi-1.2.1.jar.
The cause of the issue appears that the directory structure of the jackrabbit-jcr-rmi sub-project doesn't match the Maven 2 standard. 
To fix: src/resources should be moved to src/main/resources.
ConcurrentModificationException during registration of nodetypes
During the registration of a set of nodetypes this exception may be encountered:
java.util.ConcurrentModificationException
at org.apache.commons.collections.map.AbstractReferenceMap$ReferenceEntrySetIterator.checkMod(AbstractReferenceMap.java:761)
at org.apache.commons.collections.map.AbstractReferenceMap$ReferenceEntrySetIterator.hasNext(AbstractReferenceMap.java:735)
at org.apache.jackrabbit.core.nodetype.NodeTypeRegistry.notifyRegistered(NodeTypeRegistry.java:1750)
at org.apache.jackrabbit.core.nodetype.NodeTypeRegistry.registerNodeTypes(NodeTypeRegistry.java:223)
It seems that the copying of the listeners triggered this exception:
private void notifyRegistered(QName ntName) {
// copy listeners to array to avoid ConcurrentModificationException
NodeTypeRegistryListener[] la =
new NodeTypeRegistryListener[listeners.size()];
Iterator iter = listeners.values().iterator();
int cnt = 0;
1750: while (iter.hasNext()) {
la[cnt++] = (NodeTypeRegistryListener) iter.next();
}
for (int i = 0; i &lt; la.length; i++) {
if (la[i] != null) {
la[i].nodeTypeRegistered(ntName);
}
}
}
The methods &quot;notifyReRegistered&quot; and &quot;notifyUnregistered&quot; will probably suffer from the same problem.
Reproduction of this exception may be tricky; it only occurred once in our application. It is probably a race condition: another thread might access the listeners during the copy. It may be helpful to use a debugger and set a breakpoint in the middle of the copy giving other threads the opportunity to access the listeners...
We think that a possible solution is the following:
/**
* Notify the listeners that a node type &lt;code&gt;ntName&lt;/code&gt; has been registered.
*/
private void notifyRegistered(QName ntName) {
// copy listeners to array to avoid ConcurrentModificationException
NodeTypeRegistryListener[] la;
synchronized (listeners) {
la = (NodeTypeRegistryListener[]) listeners.values().toArray(new NodeTypeRegistryListener[listeners.size()]);
}
for (int i = 0; i &lt; la.length; i++) {
if (la[i] != null) {
la[i].nodeTypeRegistered(ntName);
}
}
}
NPE Exception Thrown By FileJournal During Commit Operation
The following exception stack traces appearing repeatedly during a performance test of a JCR cluster at a customer site. 
ERROR - Unexpected error while preparing log entry.
java.lang.NullPointerException
at org.apache.jackrabbit.core.cluster.FileRevision.unlock(FileRevision.java:117)
at org.apache.jackrabbit.core.cluster.FileRevision.get(FileRevision.java:146)
at org.apache.jackrabbit.core.cluster.FileJournal.sync(FileJournal.java:296)
at org.apache.jackrabbit.core.cluster.FileJournal.begin(FileJournal.java:435)
at org.apache.jackrabbit.core.cluster.ClusterNode.updatePrepared(ClusterNode.java:399)
at org.apache.jackrabbit.core.cluster.ClusterNode.access$000(ClusterNode.java:40)
at org.apache.jackrabbit.core.cluster.ClusterNode$WorkspaceUpdateChannel.updatePrepared(ClusterNode.java:559)
at org.apache.jackrabbit.core.state.SharedItemStateManager$Update.begin(SharedItemStateManager.java:647)
at org.apache.jackrabbit.core.state.SharedItemStateManager.beginUpdate(SharedItemStateManager.java:778)
at org.apache.jackrabbit.core.state.SharedItemStateManager.update(SharedItemStateManager.java:808)
at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:326)
at org.apache.jackrabbit.core.state.XAItemStateManager.update(XAItemStateManager.java:313)
at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:302)
at org.apache.jackrabbit.core.state.SessionItemStateManager.update(SessionItemStateManager.java:295)
at org.apache.jackrabbit.core.ItemImpl.save(ItemImpl.java:1204)
at org.apache.jackrabbit.core.SessionImpl.save(SessionImpl.java:821)
ERROR - Unexpected error while committing log entry.
java.lang.NullPointerException
at org.apache.jackrabbit.core.cluster.FileJournal.commit(FileJournal.java:660)
at org.apache.jackrabbit.core.cluster.ClusterNode.updateCommitted(ClusterNode.java:425)
at org.apache.jackrabbit.core.cluster.ClusterNode$WorkspaceUpdateChannel.updateCommitted(ClusterNode.java:566)
at org.apache.jackrabbit.core.state.SharedItemStateManager$Update.end(SharedItemStateManager.java:712)
at org.apache.jackrabbit.core.state.SharedItemStateManager.update(SharedItemStateManager.java:808)
at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:326)
at org.apache.jackrabbit.core.state.XAItemStateManager.update(XAItemStateManager.java:313)
at org.apache.jackrabbit.core.state.LocalItemStateManager.update(LocalItemStateManager.java:302)
at org.apache.jackrabbit.core.state.SessionItemStateManager.update(SessionItemStateManager.java:295)
at org.apache.jackrabbit.core.ItemImpl.save(ItemImpl.java:1204)
at org.apache.jackrabbit.core.SessionImpl.save(SessionImpl.java:821)
Select * does not return declared properties of node type in FROM clause
The query only returns the default columns: jcr:primaryType, jcr:score and jcr:path
NullPointerException in DatabasePersistenceManager and DatabaseFileSystem after a failed reconnection attempt
As reported on the dev mailing-list, this is what happens:
The reconnection/retry mechanism in DatabasePersistenceManager/DatabaseFileSystem seems to behave fine when the connection times out or is killed for some reason, and the DB server is in fact still running.
However there is a problem if the connection cannot be re-established directly, for example if a transient network outage lasts longer than the few reconnection attempts.
Inside DatabasePersistenceManager.reestablishConnection(), initConnection() will fail, and the preparedStatements map will stay empty.
This in turn will trigger a nasty NullPointerException (never caught) next time executeStmt() is called, because the map is still empty, and there is no check for that.
The following proposed fix from Stefan Guggisberg has been tested to work when applied on 1.2-rc2:
&gt; the simplest fix would be to remove line 783 in
&gt; DatabasePersistenceManager.java and line 1010 in
&gt; DatabaseFileSystem.java,
&gt; i.e. the following stmt:
&gt; 
&gt; preparedStatements.clear();
SearchManager might throw when handling cluster event
When handling events that are generated from another node in the cluster, the SearchManager might try to index an index that does no longer exist. This results in an error message or even a NPE. The scenario looks as follows (A and B are nodes in a repository cluster)
1: A adds node N
2: A saves changes
3: A removes node N
4: A saves changes
Upon receiving the event of a newly created node, B starts indexing node N. If this process hasn't been concluded before step 3 above, it will throw.
Range queries fail on large repositories
As discussed on the user mailing list, queries on large repositories with date constraints like &quot;field &gt; constant&quot; treat the constraint as always true, returning results that should not be returned.
PdfTextExtractor does not close temp file in case of an error
If PDF parsing fails in PDFParser.parse() a temp file is not closed and results in an open file handle.
Tests fail with NoClassDefFoundError: org/w3c/dom/ranges/DocumentRange
The nekohtml dependency in jackrabbit-text-extractors brings in a transitive xerces 2.4.0 dependency without the extra XML API classes required by Xerces. This causes test failures in jackrabbit-core and jackrabbit-jca because the Xerces dependency included in the test classpath overrides the default XML parser. Then, when the test cases try to parse XML documents, the missing XML API dependency causes a NoClassDefFoundError.
Repository requires access to external resource
With the changes from JCR-626 jackrabbit requires access to the resource at the URL http://jackrabbit.apache.org/dtd/repository-1.2.dtd. If no connection to the internet is available jackrabbit will refuse to start. At least that's the case when I run the test cases in the above mentioned environment.
I'm not an XML expert, but shouldn't the doctype declaration use a public identifier? Otherwise the ConfigurationEntityResolver class doesn't make much sense.
The attached patch solve the issue for me, please comment. I've also targetted this issue for 1.2 because it seems rather serious to me if you can't start jackrabbit when you don't have an internet connection, or am I the only one with this issue?
ValidSenderDomainHandler it does not work as it would have
I have enabled in smtp-handler chain the ValidSenderDomain, but don't work very good...
&lt;handler class=&quot;org.apache.james.smtpserver.core.filter.fastfail.ValidSenderDomainHandler&quot; command=&quot;MAIL&quot;&gt;
&lt;action&gt; reject &lt;/action&gt;
&lt;checkAuthClients&gt; false &lt;/checkAuthClients&gt;
&lt;checkAuthUsers&gt; false &lt;/checkAuthUsers&gt;
&lt;/handler&gt;
------------------------------------------------
220 JAMES SMTP Server
HELO x
250 10.1.xxx.xx Hello x (xxx.xxxx. [xxx.x.xx.xxx])
MAIL FROM: x@fake
501 5.1.7 sender x@fake contains a domain with no valid MX records
RCPT TO: x@localhost
250 2.1.5 Recipient &lt;x@localhost&gt; OK
DATA
354 Ok Send data ending with &lt;CRLF&gt;.&lt;CRLF&gt;
Ooops
.
250 2.6.0 Message received
------------------------------------------------
Logs....
------------------------------------------------
2007-01-27 22:21:26,932 INFO [smtpserver] Connection from xxx.xxxx. (xxx.x.xx.xxx)
2007-01-27 22:21:33,258 INFO [dnsserver] Couldn't resolve MX records for domain fake.
2007-01-27 22:21:33,258 ERROR [dnsserver] Couldn't resolve IP address for host fake.
2007-01-27 22:21:33,258 INFO [smtpserver] Sender x@fake contains a domain with no valid MX records
2007-01-27 22:22:03,240 INFO [smtpserver] Successfully spooled mail Mail1169932922671-1 from x@fake on xxx.x.xx.xxx for [x@localhost]
------------------------------------------------
This is... bad :-(
DoS in MAIL / RCPT without domain
With each MAIL/RCPT without @Domain... the DomainList grow, grow, grow,... without limit... and log grows and grows still more...
sendmail.py use localhost to connect to local smtpserver. We should use 127.0.0.1
At the moment we use:
server = smtplib.SMTP('localhost')
This should be modified to:
server = smtplib.SMTP('127.0.0.1')
localhost is not resolvable on all systems!
MailAddress not check for valid syntax if new MailAddress(user, domain) is used
At the moment we check not for valid syntax if new MailAddress(user, domain) is used
MBoxMailRepository.remove(String key) causes ClassCastException
It calls
ArrayList keys = new ArrayList();
keys.add(key);
this.remove(keys);
although remove(Collection) expects Mail objects
02/12/06 20:25:14 ERROR pop3server: Some deleted messages were not removed: java.lang.String
java.lang.ClassCastException: java.lang.String
at org.apache.james.mailrepository.MBoxMailRepository$3.messageAction(MBoxMailRepository.java:702)
at org.apache.james.mailrepository.MBoxMailRepository.parseMboxFile(MBoxMailRepository.java:277)
at org.apache.james.mailrepository.MBoxMailRepository.remove(MBoxMailRepository.java:691)
at org.apache.james.mailrepository.MBoxMailRepository.remove(MBoxMailRepository.java:767)
public void remove(Mail mail) {
// Convert the message into a key
Vector delVec = new Vector();
delVec.addElement(mail);
remove(delVec);
}
Works, but the comment is wrong. 
ServerConnection doesn't properly handle the TCP/IP backlog
ServerConnection calls accept() even when the configured connection limit has been reached, thereby purging the TCP/IP backlog and expending cycles in the process. This is inefficient, drops connections, and renders the backlog configuration setting largely worthless.
sendmail.py crashes on line &quot;from_addr = os.environ['USER'] + '@' + socket.getfqdn()&quot;
This line in sendmail.py:
from_addr = os.environ['USER'] + '@' + socket.getfqdn()
causes my mail-delivery to crash:
&lt;---snip---&gt;
Traceback (most recent call last):
File &quot;/usr/sbin/sendmail&quot;, line 126, in ?
main(sys.argv)
File &quot;/usr/sbin/sendmail&quot;, line 77, in main
from_addr = os.environ['USER'] + '@' + socket.getfqdn()
File &quot;/usr/lib/python2.3/UserDict.py&quot;, line 19, in __getitem__
def __getitem__(self, key): return self.data[key]
KeyError: 'USER'
&lt;/---snip---&gt;
I think it's an permission-thing, but didn't went any further.
I just changed it to
from_addr = &quot;postmaster@localhost&quot;
(since the sender is pased by &quot;-f&quot;) and now it works.
sendmail.py doesn't handle multiple TO-recipients
I got a problem with the sendmail.py-script from the /bin-directory:
Wenn I try to send a mail to two TO-recipients from a PHP-Script, only
the first one will be delivered :-(
&lt;?PHP mail(&quot;stephan@one.de,stephan@two.de&quot;, &quot;hallo&quot;, &quot;moep&quot;, &quot;From: stephan@three.de&quot;, &quot;-fstephan@three.de&quot;); ?&gt;
(yes, sendmail-option &quot;-t&quot; is set: phpinfo() -&gt; &quot;sendmail_path: /usr/sbin/sendmail -t&quot;)
I'm no Python-guy, but this doesn't look like there's a extraction of multiple (comma-seperated) recipients:
[...]
if header.startswith(&quot;To:&quot;):
if extract:
to = header[3:]
to_addrs.append(to[(&quot;&lt;&quot; + to).rfind(&quot;&lt;&quot;):(to + &quot;&gt;&quot;).find(&quot;&gt;&quot;)])
[...]
Constructor MailImpl(MimeMessage) doesn't take all recipients
Constructor MailImpl(MimeMessage) doesn't take all recipients, it take only recipients TO. Shouldn' tit work like MailContext.sendmail(MimeMessage) which get all recipients ???
PomModuleDescriptorParser fails with nested profile dependency.
I recently started working with struts 2.0 series. Do the complexity of all the dependent libraries, I thought it would be a good time to test drive ivy as well. Unfortunately, it was unable to handle one of the struts 2.0 poms found at http://people.apache.org/maven-snapshot-repository/org/apache/struts/struts2-core/2.0.2-SNAPSHOT/struts2-core-2.0.2-SNAPSHOT.pom. A &quot;no groupId found in pom&quot; message was being displayed when trying to resolve this pom.
After a little debugging and a small refresher course in SAX(its been a while since using straight SAX :)), I noticed the PomModuleDescriptorParser was resetting the instance variable prematurely due to nested dependency elements under a maven build profile. This must not be a common feature in maven, but I am by no means a maven expert. Anyway, I will attach the patch I applied to resolve the issue.
Minor issues in html doc. tags not closed closed early or invalid
IOException during publish causes NullPointerException
I get the following exception when I try to publish. I'm not sure of the underlying problem because the NullPointerException hides the IOException.
do-publish:
[property] Loading /tmp/delivery.properties
[property] Unable to find property file: /tmp/delivery.properties
[ivy:publish] :: delivering :: [ lcc | litenejava | 1.3.1 ] :: 1.3.1 :: integration :: Wed Jan 03 17:09:04 CST 2007
[ivy:publish] validate = true
[ivy:publish] delivering ivy file to /shared/lcc94/disk1/work/devBuilds/CC/checkout/litenejava/build/ivy.xml
[ivy:publish] deliver done (32ms)
[ivy:publish] :: publishing :: [ lcc | litenejava ]
[ivy:publish] validate = true
[ivy:publish] /usr/local/devh/ivy/lcc/litenejava/1.3.1/jars/litenejava.jar already exists, nothing done
BUILD FAILED
/shared/lcc94/disk1/work/devBuilds/CC/checkout/litenejava/build/ant-support/lcc-ant-targets.xml:267: impossible to publish artifacts for [ lcc | litenejava | 1.3.1 ]: java.lang.NullPointerException
at fr.jayasoft.ivy.ant.IvyPublish.execute(IvyPublish.java:232)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
at org.apache.tools.ant.Task.perform(Task.java:348)
at org.apache.tools.ant.Target.execute(Target.java:357)
at org.apache.tools.ant.Target.performTasks(Target.java:385)
at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
at org.apache.tools.ant.Main.runBuild(Main.java:698)
at org.apache.tools.ant.Main.startAnt(Main.java:199)
at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)
at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)
Caused by: java.lang.NullPointerException
at fr.jayasoft.ivy.repository.AbstractRepository.fireTransferError(AbstractRepository.java:86)
at fr.jayasoft.ivy.repository.file.FileRepository.copy(FileRepository.java:52)
at fr.jayasoft.ivy.repository.file.FileRepository.put(FileRepository.java:44)
at fr.jayasoft.ivy.repository.AbstractRepository.put(AbstractRepository.java:123)
at fr.jayasoft.ivy.resolver.RepositoryResolver.put(RepositoryResolver.java:175)
at fr.jayasoft.ivy.resolver.RepositoryResolver.publish(RepositoryResolver.java:170)
at fr.jayasoft.ivy.Ivy.publish(Ivy.java:2389)
at fr.jayasoft.ivy.Ivy.publish(Ivy.java:2372)
at fr.jayasoft.ivy.Ivy.publish(Ivy.java:2348)
at fr.jayasoft.ivy.ant.IvyPublish.execute(IvyPublish.java:209)
... 17 more
--- Nested Exception ---
java.lang.NullPointerException
at fr.jayasoft.ivy.repository.AbstractRepository.fireTransferError(AbstractRepository.java:86)
at fr.jayasoft.ivy.repository.file.FileRepository.copy(FileRepository.java:52)
at fr.jayasoft.ivy.repository.file.FileRepository.put(FileRepository.java:44)
at fr.jayasoft.ivy.repository.AbstractRepository.put(AbstractRepository.java:123)
at fr.jayasoft.ivy.resolver.RepositoryResolver.put(RepositoryResolver.java:175)
at fr.jayasoft.ivy.resolver.RepositoryResolver.publish(RepositoryResolver.java:170)
at fr.jayasoft.ivy.Ivy.publish(Ivy.java:2389)
at fr.jayasoft.ivy.Ivy.publish(Ivy.java:2372)
at fr.jayasoft.ivy.Ivy.publish(Ivy.java:2348)
at fr.jayasoft.ivy.ant.IvyPublish.execute(IvyPublish.java:209)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
at org.apache.tools.ant.Task.perform(Task.java:348)
at org.apache.tools.ant.Target.execute(Target.java:357)
at org.apache.tools.ant.Target.performTasks(Target.java:385)
at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
at org.apache.tools.ant.Main.runBuild(Main.java:698)
at org.apache.tools.ant.Main.startAnt(Main.java:199)
at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)
at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)
Comments in ivy.xml duplicated
When I publish an Ivy module, comments in the ivy.xml file that are outside the &lt;ivy-module&gt; element get duplicated. For example, this
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!-- crazy --&gt;
&lt;ivy-module version=&quot;1.0&quot;&gt;
&lt;!-- normal --&gt;
&lt;info organisation=&quot;foo&quot; module=&quot;bar&quot; revision=&quot;1.0&quot;/&gt;
&lt;/ivy-module&gt;
becomes this
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!-- crazy --&gt;
&lt;!-- crazy --&gt;&lt;!-- crazy --&gt;&lt;!-- crazy --&gt;&lt;ivy-module version=&quot;1.0&quot;&gt;
&lt;!-- normal --&gt;
&lt;info organisation=&quot;foo&quot; module=&quot;bar&quot; revision=&quot;1.0&quot; status=&quot;milestone&quot; publication=&quot;20061106134429&quot;/&gt;
&lt;/ivy-module&gt;
ivy.xml doesn't contain all the dependencies
The ivy.xml file doesn't contain all the required dependencies. It is missing 'junit.jar' and 'ant.jar'.
This patch fixes this:
Index: C:/projects/ivy/ivy/ivy.xml
===================================================================
--- C:/projects/ivy/ivy/ivy.xml (revision 215)
+++ C:/projects/ivy/ivy/ivy.xml (working copy)
@@ -4,8 +4,10 @@
status=&quot;integration&quot;
/&gt;
&lt;dependencies&gt;
+ &lt;dependency org=&quot;apache&quot; name=&quot;ant&quot; rev=&quot;1.6.5&quot; conf=&quot;default&quot; /&gt;
&lt;dependency org=&quot;apache&quot; name=&quot;commons-httpclient&quot; rev=&quot;3.0&quot; conf=&quot;default&quot;/&gt;
&lt;dependency org=&quot;apache&quot; name=&quot;commons-cli&quot; rev=&quot;1.0&quot; conf=&quot;default&quot;/&gt;
+ &lt;dependency org=&quot;apache&quot; name=&quot;junit&quot; rev=&quot;3.8.1&quot; conf=&quot;default&quot; /&gt;
&lt;dependency org=&quot;apache&quot; name=&quot;oro&quot; rev=&quot;2.0.8&quot; conf=&quot;default&quot;/&gt;
&lt;/dependencies&gt;
&lt;/ivy-module&gt;
The download CGI of Jakarta/BCEL makes the wrong URL for source.
The download CGI of Jakarta/BCEL (*) makes the wrong URL for source.
(*) http://jakarta.apache.org/site/downloads/downloads_bcel.cgi
The CGI makes the download URL for source as follows:
http://ftp.kddilabs.jp/infosystems/apache/jakarta/bcel/binaries/bcel-5.2-src.tar.gz
But the correct URL is:
http://ftp.kddilabs.jp/infosystems/apache/jakarta/bcel/source/bcel-5.2-src.tar.gz
The directory of source is wrong. It is not &quot;binaries&quot;, but &quot;source&quot;. 
Please modify this. This was reported from a user of our server.
All files under minotaur.org:/www/ws.apache.org are owned by dims
I'm a developer on the Apache Muse project, and our team is having some trouble with file permissions. About two weeks ago, all of our files had ownership transferred to Davanum Srinivas (dims); it looks like all other files in all other web services projects had this happen as well. We probably would not have noticed except that some of our files are only owner-writable, not group-writable (because of forgetfulness, not because they need to be). Files that we create today will have the proper ownership, but &gt; 95% of our web site is existing files that just need to be updated.
Because of this problem, we have not been able to update a significant part of our web site. We have tried contacting dims to see if he's aware of the problem, but haven't received a response. Can someone on the Apache team help us figure out why ownership was changed and if it can be reset?
Screen-copy feature problem
When I click to add the screen copy I get to the place where you manage attached file but the screen copy is not there.
Thanks
JIRA no longer allows a comment when uploading files
Hi, 
I've noticed of late that we can no longer add a comment while attaching a file to an issue. 
It was quite useful as it allowed you to describe exactly what it is that you are uploading without having to add another comment afterwards (resulting in two emails being sent out).
Could someone please take a look when you get a chance?
Many Thanks
Scott
Personal key on p.o.a is misconfigured
There's a glitch with my key setup on people.apache.org (~husted). The key works on brutus but not on minotaur. I tried to conform the configurations, but it didn't help.
Bugzilla links broken in main JIRA
Following the update to 3.7, the bugzilla link is broken (not configured by the look of it):
Import URL not configured.
See jira.importid.prefix property in WEB-INF/classes/jira-application.properties
Requesting sudo access on brutus
Hi,
When issues.apache.org was on ajax, I had sudo access to help admin the SpamAssassin Bugzilla instance. It appears that after moving to brutus, I've lost sudo access:
Sorry, user felicity may not run sudo on brutus.
:( Can I (re)gain sudo access on brutus?
Thanks! :)
Commits not added to issues anymore
Hi folks,
i notice that no commits are added to jira issues anymore. In the past the were automaticly added when i did inlcude the issue id in the commit log. Maybe this were broken since the servers moved.
bye
Norman
anti-virus filtering overzealous for one specific list
One of the subscribers to friends at SpamAssassin.apache.org just attempted to post a snippet of HTML code to the list, and received a bounce saying:
From: Mail Delivery Subsystem &lt;MAILER-DAEMON at feynman.cliq.com&gt;
Message-Id: &lt;200502252119.j1PLJDql031950 at feynman.cliq.com&gt;
To: &lt;spambouncer at feynman.cliq.com&gt;
MIME-Version: 1.0
Content-Type: multipart/report; report-type=delivery-status;
boundary=&quot;j1PLJDql031950.1109366353/feynman.cliq.com&quot;
Subject: Returned mail: see transcript for details
Auto-Submitted: auto-generated (failure)
This is a MIME-encapsulated message
--j1PLJDql031950.1109366353/feynman.cliq.com
The original message was received at Fri, 25 Feb 2005 13:19:04 -0800 (PST)
from IDENT:spambouncer at localhost [127.0.0.1]
----- The following addresses had permanent fatal errors -----
&lt;friends at spamassassin.apache.org&gt;
(reason: 552 Virus Found: HTML.Phishing.Bank-1 )
----- Transcript of session follows -----
... while talking to mail.apache.org.:
&gt;&gt;&gt; DATA
&lt;&lt;&lt; 552 Virus Found: HTML.Phishing.Bank-1 
554 5.0.0 Service unavailable
&lt;snip rest&gt;
The HTML code was, indeed, a part of the code from a phish message. However, we need to be able to discuss these techniques on-list, if at all possible, because it's a form of spam and that's what the list is there for. ;)
Is there any way to turn off clamav scanning for this list (and dev@SpamAssassin as well if possible)?
QueryForDictionary does not process select property
Reported by Christopher DeGuise
ConcurrentModificationException thrown by DefaultConnectingIOReactor.processTimeouts() when 2 worker threads are used
I am seeing a ConcurrentModificationException thrown by DefaultConnectingIOReactor.processTimeouts() when a load test is being performed. The Javadocs for the Selector.keys() states that the returned Set is not directly modifiable, but a key is removed only after it has been cancelled and its channel deregistered. I have started the DefaultConnectingIOReactor with two worker nodes
Exception in thread &quot;HttpCoreNIOSender&quot; java.util.ConcurrentModificationException
at java.util.HashMap$HashIterator.nextEntry(HashMap.java:841)
at java.util.HashMap$KeyIterator.next(HashMap.java:877)
at java.util.Collections$UnmodifiableCollection$1.next(Collections.java:1010)
at org.apache.http.nio.impl.reactor.DefaultConnectingIOReactor.processTimeouts(DefaultConnectingIOReactor.java:151)
at org.apache.http.nio.impl.reactor.DefaultConnectingIOReactor.execute(DefaultConnectingIOReactor.java:92)
at org.apache.axis2.transport.nhttp.HttpCoreNIOSender.executeClientEngine(HttpCoreNIOSender.java:103)
at org.apache.axis2.transport.nhttp.HttpCoreNIOSender.access$000(HttpCoreNIOSender.java:57)
at org.apache.axis2.transport.nhttp.HttpCoreNIOSender$1.run(HttpCoreNIOSender.java:80)
at java.lang.Thread.run(Thread.java:595)
DefaultConnectingIOReactor.execute propagates IOException, but isn't really re-callable
I'm trying to figure out what to do when DefaultConnectingIOReactor.execute throws an exception. It doesn't seem like I can just call execute() again after handling the exception, since that will recreate all the state in DCIOR.
Seems to me that there needs to be a different way to handle exceptions, or the execute method should be callable more than once.
For reference, here's the stack trace of an exception:
{code}
2007-01-23T16:23:19.800 | ERROR | urceInvoker | | NewResourceInvoker | Invalid argument: sun.nio.ch.Net.setIntOption
java.net.SocketException: Invalid argument: sun.nio.ch.Net.setIntOption
at sun.nio.ch.Net.setIntOption0(Native Method)
at sun.nio.ch.Net.setIntOption(Net.java:154)
at sun.nio.ch.SocketChannelImpl$1.setInt(SocketChannelImpl.java:406)
at sun.nio.ch.SocketOptsImpl.setBoolean(SocketOptsImpl.java:38)
at sun.nio.ch.SocketOptsImpl$IP$TCP.noDelay(SocketOptsImpl.java:284)
at sun.nio.ch.OptionAdaptor.setTcpNoDelay(OptionAdaptor.java:48)
at sun.nio.ch.SocketAdaptor.setTcpNoDelay(SocketAdaptor.java:268)
at org.apache.http.nio.impl.reactor.DefaultConnectingIOReactor.prepareSocket(DefaultConnectingIOReactor.java:171)
at org.apache.http.nio.impl.reactor.DefaultConnectingIOReactor.processEvent(DefaultConnectingIOReactor.java:158)
at org.apache.http.nio.impl.reactor.DefaultConnectingIOReactor.processEvents(DefaultConnectingIOReactor.java:134)
at org.apache.http.nio.impl.reactor.DefaultConnectingIOReactor.execute(DefaultConnectingIOReactor.java:94)
at com.electriccloud.commander.domain.NewResourceInvoker.innerRun(NewResourceInvoker.java:304)
at com.electriccloud.util.FailsafeRunnable.run(FailsafeRunnable.java:105)
at java.lang.Thread.run(Thread.java:619)
{code}
DefaultConnectingIOReactor needs to queue new channels and call register() outside of select()
DefaultConnectingIOReactor.connect() shouldn't call SocketChannel.register() while the Selector.select() is being called.
Last chunk not flushed when using chunking for responses
I am using HttpCore with NIO extensions and trying to use chunked encoding for the response if the version is HTTP 1.1. However, it seems that the last chunk does not get written back to the client.. The output sent back to the client is as follows
HTTP/1.1 200 OK
Content-Type: text/xml; charset=UTF-8
Date: Fri, 12 Jan 2007 05:27:20 GMT
Server: Synapse-HttpComponents-NIO/1.1
Transfer-Encoding: chunked
Connection: Keep-Alive
396
&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;soapenv:Envelope xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot; xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;...................&lt;/soapenv:Envelope&gt;
Threading issue with NIO extensions for client side code
I would like to write a non-blocking client based on the NIO extensions, but encounter an issue, which could be reproduced with a modified NHttpClient example code as follows:
I want to start off a ConnectingIOReactor, and leave it running continuously. Now, whenever I want to send a request through this reactor, I would want to execute something like
ioReactor.connect(
new InetSocketAddress(&quot;www.yahoo.com&quot;, 80),
null,
new HttpHost(&quot;www.yahoo.com&quot;));
However, if I execute the above before I execute ioReactor.execute(ioEventDispatch), i.e position 1, then everything works fine. If I try it after (i.e. position 2) the outcome is unpredictable - i.e. works sometimes, NPE, etc..
It is not clear to me why connecting to the reactor after its execute() method is invoked should be any different..?
public static void main(String[] args) throws Exception {
HttpParams params = new DefaultHttpParams(null);
.....
NHttpClientHandler handler = new MyNHttpClientHandler(params);
final IOEventDispatch ioEventDispatch = new DefaultClientIOEventDispatch(handler, params);
// position 1 Thread t = new Thread(new Runnable() {
public void run() {
try {
ioReactor.execute(ioEventDispatch);
} catch (Exception e) {
e.printStackTrace();
}
}
}
);
t.start();
// position 2
}
connection close fails with SSLSocket
When closing a connection, output and input streams are shut down explicitly before the socket itself is closed. IOException get ignored. SSL sockets do not implement the partial shutdown. They throw an UnsupportedOperationException, which is not ignored.
SUN stack trace:
Exception in thread &quot;main&quot; java.lang.UnsupportedOperationException: The method shutdownOutput() is not supported in SSLSocket
at com.sun.net.ssl.internal.ssl.BaseSSLSocketImpl.shutdownOutput(BaseSSLSocketImpl.java:192)
at org.apache.http.impl.SocketHttpClientConnection.close(SocketHttpClientConnection.java:151)
IBM stack trace:
Exception in thread &quot;main&quot; java.lang.UnsupportedOperationException: The method shutdownOutput() is not supported in SSLSocket
at com.ibm.jsse2.ic.shutdownOutput(ic.java:109)
at org.apache.http.impl.SocketHttpClientConnection.close(SocketHttpClientConnection.java:151)
at org.apache.http.examples.conn.OperatorConnectProxy.main(OperatorConnectProxy.java:152)
cheers,
Roland
leak in MultiThreadedHttpConnectionManager.ConnectionPool.mapHosts
Once entries are added to MultiThreadedHttpConnectionManager.ConnectionPool.mapHosts, they are never cleaned up unless MultiThreadedHttpConnectionManager is shutdown.
[drlvm][smoke tests] smoke tests gc.WeakReferenceTest and gc.PhantomReferenceTest fail in some environment
gc.WeakReferenceTest and gc.PhantomReferenceTest fail intermittently on Windows XP.
Investigation showed up that the tests invoke ReferenceQueue.poll() method to check that a reference is enqueued immediately after gc() call but the spec says that newly-cleared weak references can be enqueued a little bit later. 
It's reasonable to add some waiting to the tests.
[drlvm][ipf][smoke tests] Cleanup of the smoke tests' excluded list
The excluded list of smoke tests is rather outdated and does not reflect the current situation. I ran the excluded tests iteratively on SUSE9 ipf and found out that most of them passed.
Some tests failed and I filed HARMONY-3032, HARMONY-3033, and HARMONY-3038 to record the current status quo. These tests remain in the excluded list.
[drlvm] support option -Xfuture for compatibility with RI
J2SE documentation for java launcher [1] describes option -Xfuture:
-Xfuture
Perform strict class-file format checks. For purposes of backwards compatibility, the default format checks performed by the Java 2 SDK's virtual machine are no stricter than the checks performed by 1.1.x versions of the JDK software. The -Xfuture flag turns on stricter class-file format checks that enforce closer conformance to the class-file format specification. Developers are encouraged to use this flag when developing new code because the stricter checks will become the default in future releases of the Java application launcher.
But DRLVM rejects this option:
&gt; java -Xfuture HelloWorld
Unknown option -Xfuture
Use java -help to get help on command line options
Since developers are encouraged to use this option, this may prevents them from using Harmony/DRLVM in their work. It makes sense to enable this option in DRLVM.
[1] http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/java.html
[classlib][lang-management] Interpreting the abstract classes as a tests
There are several abstract classes in lang-management test suites:
modules/lang-management/src/test/impl/java/org/apache/harmony/lang/management
DynamicMXBeanImplTest.java 
SingleInstanceDynamicMXBeanImplTest.java 
MultiInstanceDynamicMXBeanImplTest.java 
They are treated as real tests by out test system. I suggest renaming them from *Test.java to *TestBase.java
Just a test bug to test JIRA for me
I am trying to find out why JIRAs which are resolved/closed still appear in my &quot;Assigned to me&quot; list.
[drlvm][resolution] missing class leads to crash in interpreter mode
Test from HARMONY-2083 fails in interpreter mode.
The test is already in regression suite as a fix for HARMONY-2721
Fix attached.
[doc][drlvm] DRLVM documentation must be updated to reflect change in CLI: -XD instead of -D for internal properties
The DRLVM documentation should be updated to reflect a new format of setting internal VM and JIT properties: -XD prefix must be specified now instead of -D.
Particularly this is true for options starting with '-Djit.' - they should be replaced with '-XDjit.'. There are probably other changes in DRLVM properties.
Also, another 2 issues aboud JIT documentation should be fixed:
1. The page http://harmony.apache.org/subcomponents/drlvm/JIT_PMF.html contains a broken link to an image
2. The page http://harmony.apache.org/subcomponents/drlvm/JIT.html contains a broken link to the PMF document.
[classlib][luni]JarURLConnection.getEntryName() returns incorrect value
following testcase passes on RI but fails on Harmony
URL url = new URL(&quot;jar:file:///bar.jar!/foo.jar!/Bugs/HelloWorld.class&quot;);
assertEquals(&quot;foo.jar!/Bugs/HelloWorld.class&quot;,((JarURLConnection)url.openConnection()).getEntryName());
[drlvm][smoke tests] Three smoke can be removed from exclude lists
The following smoke tests pass now:
gc/SynchronizedFinilazersTest.java
init/ErrorInInitializer.java
thread/InfiniteFinalizer.java
They were kept in exclude lists about two or even more months ago because they failed intermittently. I returned back to them recently to investigate and found out that they pass. I ran them iteratively hundreds times on SLES9 x86, x86_64, Windows 2003 server. 
Possibly some commits that happened during these months fixed the issues.
We need to remove the tests from the exclude lists.
[DRL VM] Not possible to set custom security manager via system property
The following test behaives on RI as expected but fails in DRL VM
------------------ MySecurityManager.java ----------------
import java.security.Permission;
public class MySecurityManager extends SecurityManager {
public void checkPermission(Permission perm) {
}
}
------------------ test.java ----------------
public class test {
public static void main(String[] av) throws Exception {
System.out.println(System.getSecurityManager().getClass().getName());
}
}
=============DRL VM output=========================
$java -Djava.security.manager=MySecurityManager test
Uncaught exception in main:
java.lang.NullPointerException
at test.main(test.java:4)
[classlib][security]MessageDigestSpi.engineDigest(byte[], int, int) returns 0 while RI throws NPE
Consider the following test case:
public void testDigestbyteArrayintint() throws Exception {
MyMessageDigest1 md = new MyMessageDigest1(&quot;ABC&quot;);
byte[] b = {1, 2, 3, 4, 5};
try {
md.digest(b, 2, 3)
fail(&quot;should throw NullPointerException&quot;);
}catch (NullPointerException e) {
// expected
}
}
RI passes while Harmony fails.
I'll attach a patch soon.
[drlvm][jvmti] VM fails to initialize wtih an agent specified by -agentlib: option
VM started with -agentlib:&lt;agent_library&gt; command line option fails to initialize.
Fails on assertion in jvmti.cpp line:495 Expression:vm_libs.
It seems to be a side effect of [r497495] commit.
[drlvm][kernel tests] RuntimeTest2 is unstable and should be fixed
CC reported java.lang.RuntimeTest2 failure twice yesterday.
It probably fails because of unconditioned waiting for 2000 ms which could be not enough.
I updated the test so that it waits longer checking some condition is met. 
We should see if this is a root cause.
[classlib][instrument]Releases byte array too early in the native code of redefine classes.
In instrument.c, Java_org_apache_harmony_instrument_internal_InstrumentationImpl_redefineClasses_1native, we have:
Line 237:
class_bytes = (*env)-&gt;GetByteArrayElements(env, jclass_bytes, &amp;copy);
if(NULL == class_bytes){
hymem_free_memory(class_definitions);
return;
}
class_byte_count = (*env)-&gt;GetArrayLength(env, jclass_bytes);
if(copy == JNI_TRUE){
(*env)-&gt;ReleaseByteArrayElements(env,jclass_bytes, class_bytes, JNI_ABORT);
}
//construct a jvmtiClassDefinition element 
class_definitions[index].klass=klass;
class_definitions[index].class_bytes=class_bytes;
class_definitions[index].class_byte_count=class_byte_count;
}
//perform redefinition
err=(*jvmti)-&gt;RedefineClasses(jvmti, length, class_definitions);
the class_bytes are freed before RedefineClasses of JVM_TI uses them.
[swing] method javax.swing.plaf.metal.MetalLookAndFeel.getCurrentTheme is missing
Not implemented method...
[drlvm][jit][opt] codegen runs HLO::dce in server mode on EM64T
This is not a joke.
There is a missprint in server.emconf
This bug leads SPECjbb2005 to a crash on EM64T in server mode.
server.emconf for Ia32 is OK.
As it is SPEC failure I can not create a regression test in reasonable time.
[classlib][luni]GregorianCalendar.get(Calendar.DAY_OF_MONTH) and get(Calendar.MONTH) return incorrect value
methods get(Calendar.DAY_OF_MONTH) and get(Calendar.MONTH) return incorrect value in the year at which the calendar changed to gregorian.
following testcase illustrates this problem
public void test() {
Date date = new Date(Date.parse(&quot;Feb 28 00:00:01 GMT 2000&quot;));
GregorianCalendar gc = new GregorianCalendar();
gc.setGregorianChange(date);
gc.setTimeInMillis(Date.parse(&quot;Dec 1 00:00:01 GMT 2000&quot;));
assertEquals(1, gc.get(Calendar.DAY_OF_MONTH));
assertEquals(11, gc.get(Calendar.MONTH));
}
[swing] javax.swing.plaf.metal.MetalScrollBarUI class has two redundant fields
thumbColor and thumbHighlightColor are inherited from javax.swing.plaf.basic.BasicScrollBarUI and should be marked as private
[swing] field javax.swing.JTree.AccessibleJTree.AccessibleJTreeNode.accessibleParent is redundant
This field is inhereted from javax.accessibility.AccessibleContext and should be marked as private in javax.swing.JTree.AccessibleJTree.AccessibleJTreeNode
[swing] field javax.swing.JPasswordField.accessibleContext is missing
This field is inherited from JComponent but marked private
[swing] field javax.swing.JTextField.accessibleContext is missing
This field is inherited from JComponent but marked private
[swing] field javax.swing.JTextArea.accessibleContext is missing
This field is inherited from JComponent but marked private
[swing] field javax.swing.text.JTextComponent.accessibleContext is missing
This field is inherited from JComponent but marked as private
[swing] field javax.swing.JScrollBar.listenerList is missing
listenerList is inherited from JComponent class but marked as private.
[swing] constructor javax.swing.DefaultComboBoxModel has incorrect signature
Here is corresponding japitools message:
constructor javax.swing.DefaultComboBoxModel(java.util.Vector&lt;?&gt;): parameters (java.util.Vector&lt;?&gt;) in jdk15.client, but parameters (java.util.Vector) in harmony.client 
[swing] method javax.swing.text.html.StyleSheet.removeAttributes has invalid signature
Method javax.swing.text.html.StyleSheet.removeAttributes has invalid signature. Here is corresponding japitools report:
method javax.swing.text.html.StyleSheet.removeAttributes(javax.swing.text.AttributeSet, java.util.Enumeration&lt;?&gt;): parameters (javax.swing.text.AttributeSet, java.util.Enumeration&lt;?&gt;) in jdk15.client, but parameters (javax.swing.text.AttributeSet, java.util.Enumeration) in harmony.client 
[classlib][sql] Several methods signatures are not compatible with spec in javax.sql.rowset.serial package.
Several methods signatures are not compatible with spec in javax.sql.rowset.serial package. Here're details:
1. constructor javax.sql.rowset.serial.SerialJavaObject(java.lang.Object): throws javax.sql.rowset.serial.SerialException in jdk15, but doesn't throw javax.sql.rowset.serial.SerialException in harmony 
2. method javax.sql.rowset.serial.SerialJavaObject.getObject(): throws javax.sql.rowset.serial.SerialException in jdk15, but doesn't throw javax.sql.rowset.serial.SerialException in harmony 
3. method javax.sql.rowset.serial.SerialRef.getBaseTypeName(): doesn't throw java.sql.SQLException in jdk15, but throws java.sql.SQLException in harmony 
4.method javax.sql.rowset.serial.SerialRef.getBaseTypeName(): throws javax.sql.rowset.serial.SerialException in jdk15, but doesn't throw javax.sql.rowset.serial.SerialException in harmony 
[drlvm][jit][opt]SPECjbb2005 silently exit on EM64T (OPT mode)
Release build exits right after printing:
Calling Reporter
Debug build now is falling with assertion. But last year (in december) when I started the investigations it was also failing at the same point with SIGSEGV somwhere in managed code.
Investigations shows that the problem was in Ia32StackInfo and Ia32StackLayout.
Wrong types of some variables led to incorrect value in 'rsp' register after context restoration before exception hadler entering.
[swing][tree] method DefaultTreeSelectionModel.notifyPathChange has wrong signature
This method shoud has the following signature according to spec:
protected void notifyPathChange(Vector&lt;javax.swing.tree.PathPlaceHolder&gt; changedPaths, TreePath oldLeadSelection)
[swing][text] japitools reports additional public class and interface in javax.swing.text package
interface javax.swing.text.TextInterval.TextIntervalPainter: missing in jdk15.javax.swing 
class javax.swing.text.html.FormViewComponentFactory.InputImageIcon: missing in jdk15.javax.swing
These classes should be changed to package private
[drlvm][interpreter] VM crashes instead of throwing NullPointerException
[drlvm][interpreter] VM crashes instead of throwing NullPointerException if null object is used for synchronization
The following test demonstrates that interpreter crashes when object which was not initialized (null) is used for synchronization.
-----------------NullSynchTest.java---------------
public class NullSyncTest {
static Object objNull = null;
public static void main(String[] args) { 
try {
syncNull();
System.out.println(&quot;Test failed: NullPointerException should be thrown&quot;);
} catch (NullPointerException e) { 
System.out.println(&quot;Test passed: &quot; + e);
} catch (Throwable e) { 
e.printStackTrace();
System.out.println(&quot;Test failed: unexpected &quot; + e);
}
}
public static void syncNull() {
synchronized (objNull) {
objNull = new Object();
}
}
}
------------------------
On Windows this test reports
An unhandled error (4) has occurred.
HyGeneric_Signal_Number=00000004
ExceptionCode=c0000005
ExceptionAddress=10003974
ContextFlags=0001003f
Handler1=00401100
Handler2=111072C0
InaccessibleAddress=00000004
EDI=020A86E0
ESI=0013F6DC
EAX=00000004
EBX=0013F718
ECX=00000000
EDX=00000004
EIP=10003974
ESP=0013F520
EBP=0013F634
Module= ...HYTHR.dll
On Linux this test finishes with Segmentation fault
On Jitrino this test passes.
[drlvm][em64t] Eclipse does not start
The DRLVM fails to start Eclipse 3.1 and 3.2 on Linux@x64. Both release and debug builds segfault, debug build gives the following diagnostics:
working_vm/build/lnx_em64t_gcc_debug/deploy/jdk/jre/bin/java -jar startup.jar vf_debug: verifying class org/eclipse/ui/plugin/AbstractUIPlugin (method createImageRegistry()Lorg/eclipse/jface/resource/ImageRegistry;) couldn't load class &quot;org/eclipse/swt/SWTError&quot;vf_debug: VerifyError: org/eclipse/swt/SWTError
java: /nfs/ins/proj/drl/coreapi/avarlamo/harmony/linux.x64/svn-repo/trunk/working_vm/vm/vmcore/src/jit/ini.cpp:37: void vm_execute_java_method_array(_jmethodID*, jvalue*, jvalue*): Assertion `!exn_raised()' failed.
Fatal error
Segmentation fault
[drlvm] patch to build jitrino in debug mode with gcc 4.1.0
Patch fixes a trivial compilation error.
[drlvm][jit] assertion fires when running dacapo eclipse with -Xem:server
Note that to see the assert fire you must build jitrino in debug mode (remove &quot;-Dvm.jitrino.cfg=release&quot; from build.sh).
&gt;java -showversion -Xem:server -jar dacapo-2006-10-MR1.jar eclipse
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicabl
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r494559, (Jan 10 2007), Linux/ia32/gcc 3.4.6, debug build
http://incubator.apache.org/harmony
===== DaCapo eclipse starting =====
&lt;setting up workspace...&gt;
&lt;creating projects..............................................................&gt;
&lt;running tests at level 0...&gt;
&lt;performing build tests...&gt;
org.apache.ant (not open) opening cleaning building
org.junit (not open) opening cleaning building
org.eclipse.osgi (not open) opening cleaning buildingjava: /home/dcsfiles/neelakan/Sandbox/Harmony/stablorking_vm/vm/jitrino/src/codegenerator/ia32/Ia32RCE.cpp:154: virtual void Jitrino::Ia32::RCE::runImpl(): Asserti`0' failed.
SIGABRT in VM code.
Stack trace:
1: ?? (??:-1)
2: ?? (??:-1)
3: ?? (??:-1)
4: Jitrino::Ia32::RCE::runImpl() (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/jitrino/scodegenerator/ia32/Ia32RCE.cpp:158)
5: Jitrino::Ia32::SessionAction::run() (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/jito/src/codegenerator/ia32/Ia32IRManager.cpp:2155)
6: Jitrino::runPipeline(Jitrino::CompilationContext*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/wong_vm/vm/jitrino/src/main/Jitrino.cpp:226)
7: Jitrino::compileMethod(Jitrino::CompilationContext*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/king_vm/vm/jitrino/src/main/Jitrino.cpp:261)
8: Jitrino::Jitrino::CompileMethod(Jitrino::CompilationContext*) (/home/dcsfiles/neelakan/Sandbox/Harmontable/working_vm/vm/jitrino/src/main/Jitrino.cpp:286)
9: JIT_compile_method_with_params (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/jitrino//vm/drl/DrlJITInterface.cpp:278)
10: Dll_JIT::compile_method_with_params(void*, Method*, OpenMethodExecutionParams) (/home/dcsfiles/neela/Sandbox/Harmony/stable/working_vm/vm/vmcore/include/dll_jit_intf.h:86)
11: compile_do_compilation_jit(Method*, JIT*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vmcore/src/jit/compile.cpp:645)
12: vm_compile_method (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/class_supt/C_Interface.cpp:2462)
13: DrlEMImpl::compileMethod(Method*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/em/sDrlEMImpl.cpp:545)
14: CompileMethod (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/em/src/em_intf.cpp:49)
15: compile_do_compilation (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/jit/pile.cpp:752)
16: compile_me(Method*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/jit/come.cpp:772)
17: IP is 0xB6972162 &lt;native code&gt;
18: ?? (??:-1)
19: org/eclipse/jdt/internal/compiler/parser/Scanner.getNextToken()I (Scanner.java:-1)
20: org/eclipse/jdt/internal/compiler/parser/Parser.parse()V (Parser.java:-1)
21: org/eclipse/jdt/internal/compiler/parser/Parser.parse(Lorg/eclipse/jdt/internal/compiler/env/ICompilonUnit;Lorg/eclipse/jdt/internal/compiler/CompilationResult;II)Lorg/eclipse/jdt/internal/compiler/ast/CompilatioitDeclaration; (Parser.java:-1)
22: org/eclipse/jdt/internal/compiler/parser/Parser.parse(Lorg/eclipse/jdt/internal/compiler/env/ICompilonUnit;Lorg/eclipse/jdt/internal/compiler/CompilationResult;)Lorg/eclipse/jdt/internal/compiler/ast/CompilationUDeclaration; (Parser.java:-1)
23: org/eclipse/jdt/internal/compiler/SourceElementParser.parseCompilationUnit(Lorg/eclipse/jdt/internalmpiler/env/ICompilationUnit;Z)Lorg/eclipse/jdt/internal/compiler/ast/CompilationUnitDeclaration; (SourceElementPer.java:-1)
24: org/eclipse/jdt/internal/core/search/indexing/SourceIndexer.indexDocument()V (SourceIndexer.java:-1)
25: org/eclipse/jdt/internal/core/search/JavaSearchParticipant.indexDocument(Lorg/eclipse/jdt/core/searcearchDocument;Lorg/eclipse/core/runtime/IPath;)V (JavaSearchParticipant.java:-1)
26: org/eclipse/jdt/internal/core/search/indexing/IndexManager.indexDocument(Lorg/eclipse/jdt/core/searcearchDocument;Lorg/eclipse/jdt/core/search/SearchParticipant;Lorg/eclipse/jdt/internal/core/index/Index;Lorg/ecle/core/runtime/IPath;)V (IndexManager.java:-1)
27: org/eclipse/jdt/internal/core/search/indexing/IndexManager$1.execute(Lorg/eclipse/core/runtime/IProgsMonitor;)Z (IndexManager.java:-1)
28: org/eclipse/jdt/internal/core/search/processing/JobManager.run()V (JobManager.java:-1)
29: java/lang/Thread.run()V (??:-1)
30: vm_invoke_native_array_stub (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/srcil/ia32/base/invoke_native_stub_ia32.asm:41)
31: JIT_execute_method_default(void*, _jmethodID*, jvalue*, jvalue*) (/home/dcsfiles/neelakan/Sandbox/Hany/stable/working_vm/vm/vmcore/src/util/ia32/base/ini_iA32.cpp:199)
32: DrlEMImpl::executeMethod(_jmethodID*, jvalue*, jvalue*) (/home/dcsfiles/neelakan/Sandbox/Harmony/sta/working_vm/vm/em/src/DrlEMImpl.cpp:514)
33: ExecuteMethod (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/em/src/em_intf.cpp:43)
34: vm_execute_java_method_array(_jmethodID*, jvalue*, jvalue*) (/home/dcsfiles/neelakan/Sandbox/Harmonyable/working_vm/vm/vmcore/src/jit/ini.cpp:51)
35: call_method_no_ref_result (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/jjni_method.cpp:188)
36: CallVoidMethodA(JNIEnv_External*, _jobject*, _jmethodID*, jvalue*) (/home/dcsfiles/neelakan/Sandbox/mony/stable/working_vm/vm/vmcore/src/jni/jni_method.cpp:226)
37: wrapper_proc (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/thread/src/thread_java_ba.c:101)
38: thread_start_proc (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/thread/src/thread_nae_basic.c:723)
39: dummy_worker (threadproc/unix/thread.c:139)
40: ?? (??:-1)
41: ?? (??:-1)
&lt;end of stack trace&gt;
Abort
[classlib][luni]not able to instance a GregorianCalendar with TimeZone whose offset is greater than 24 hours
not able to instance a GregorianCalendar with TimeZone whose offset is greater than 24 hours.
following testcase passes on RI but throws IllegalArgumentException on Harmony.
public void test() {
SimpleTimeZone timezone = new SimpleTimeZone(-3600 * 24 * 1000 * 2, &quot;GMT&quot;);
GregorianCalendar gc = new GregorianCalendar(timezone);
}
[jit] segfault with -Xem:server option
The problem seems to occur with any long running program, but you can trigger it with the DaCapo benchmarks:
&gt;java -showversion -Xem:server -jar dacapo-2006-10.jar fop
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r494559, (Jan 9 2007), Linux/ia32/gcc 3.4.6, debug build
http://incubator.apache.org/harmony
SIGSEGV in VM code.
Stack trace:
1: Jitrino::Ia32::edge_comparator::getEdgeExecCount(Jitrino::Edge const*) (??:-1)
2: ?? (00180234
:180234)
3: ?? (0017f79e
:17)
4: ?? (0017f7b0
:17)
5: ?? (0017f7b0
:17)
6: ?? (0017f7b0
:17)
7: ?? (0017f6d3
:17)
8: Jitrino::Ia32::BottomUpLayout::linearizeCfgImpl() (??:-1)
9: Jitrino::Ia32::Linearizer::linearizeCfg() (??:-1)
10: Jitrino::Ia32::Linearizer::doLayout(Jitrino::Ia32::Linearizer::LinearizerType, Jitrino::Ia32::IRManager*) (??:-1)
11: Jitrino::Ia32::Layouter::runImpl() (??:-1)
12: Jitrino::Ia32::SessionAction::run() (??:-1)
13: Jitrino::runPipeline(Jitrino::CompilationContext*) (??:-1)
14: Jitrino::compileMethod(Jitrino::CompilationContext*) (??:-1)
15: Jitrino::Jitrino::CompileMethod(Jitrino::CompilationContext*) (??:-1)
16: JIT_compile_method_with_params (??:-1)
17: Dll_JIT::compile_method_with_params(void*, Method*, OpenMethodExecutionParams) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/include/dll_jit_intf.h:86)
18: compile_do_compilation_jit(Method*, JIT*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/jit/compile.cpp:645)
19: vm_compile_method (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/class_support/C_Interface.cpp:2462)
20: DrlEMImpl::compileMethod(Method*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/em/src/DrlEMImpl.cpp:545)
21: CompileMethod (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/em/src/em_intf.cpp:49)
22: compile_do_compilation (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/jit/compile.cpp:752)
23: compile_me(Method*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/jit/compile.cpp:772)
24: IP is 0xB6972162 &lt;native code&gt;
25: ?? (??:-1)
26: dacapo/parser/ConfigFileTokenManager.jjStartNfa_0(IJ)I (ConfigFileTokenManager.java:-1)
27: dacapo/parser/ConfigFileTokenManager.jjMoveStringLiteralDfa2_0(JJ)I (ConfigFileTokenManager.java:-1)
28: dacapo/parser/ConfigFileTokenManager.jjMoveStringLiteralDfa1_0(J)I (ConfigFileTokenManager.java:-1)
29: dacapo/parser/ConfigFileTokenManager.jjMoveStringLiteralDfa0_0()I (ConfigFileTokenManager.java:-1)
30: dacapo/parser/ConfigFileTokenManager.getNextToken()Ldacapo/parser/Token; (ConfigFileTokenManager.java:-1)
31: dacapo/parser/ConfigFile.jj_consume_token(I)Ldacapo/parser/Token; (ConfigFile.java:-1)
32: dacapo/parser/ConfigFile.config()Ldacapo/parser/Config; (ConfigFile.java:-1)
33: dacapo/parser/ConfigFile.configFile()Ldacapo/parser/Config; (ConfigFile.java:-1)
34: dacapo/parser/Config.parse(Ljava/io/InputStream;)Ldacapo/parser/Config; (Config.java:-1)
35: dacapo/TestHarness.&lt;init&gt;(Ljava/io/InputStream;)V (TestHarness.java:-1)
36: dacapo/TestHarness.main([Ljava/lang/String;)V (TestHarness.java:-1)
37: vm_invoke_native_array_stub (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/util/ia32/base/invoke_native_stub_ia32.asm:41)
38: JIT_execute_method_default(void*, _jmethodID*, jvalue*, jvalue*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/util/ia32/base/ini_iA32.cpp:199)
39: DrlEMImpl::executeMethod(_jmethodID*, jvalue*, jvalue*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/em/src/DrlEMImpl.cpp:514)
40: ExecuteMethod (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/em/src/em_intf.cpp:43)
41: vm_execute_java_method_array(_jmethodID*, jvalue*, jvalue*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/jit/ini.cpp:51)
42: call_static_method_no_ref_result (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/jni/jni_method.cpp:1155)
43: CallStaticVoidMethodA(JNIEnv_External*, _jobject*, _jmethodID*, jvalue*) (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/jni/jni_method.cpp:1563)
44: invoke_primitive_method (/home/dcsfiles/neelakan/Sandbox/Harmony/stable/working_vm/vm/vmcore/src/kernel_classes/native/java_lang_reflect_VMReflection.cpp:184)
Segmentation fault
[classlib][luni]GregorianCalendar.getActualMaximum(Calendar.DAY_OF_YEAR) returns incorrect value
Follwing testcase passes on RI but fails on harmony due to that it does not cut over the days between Julian and Gregorian 
public void testActualDayOfYear() { 
Date date = new Date(Date.parse(&quot;Jan 15 00:00:01 GMT 2000&quot;)); 
GregorianCalendar gc = new GregorianCalendar(); 
gc.setGregorianChange(date); 
gc.setTimeInMillis(Date.parse(&quot;Jan 16 00:00:01 GMT 2000&quot;)); 
assertEquals(353, gc.getActualMaximum(Calendar.DAY_OF_YEAR)); 
}
[luni][util]Locale lacks some ISO countries and languages.
public void test()
{
Locale locale = new Locale(&quot;an&quot;);
assertEquals(&quot;arg&quot;,locale.getISO3Language());
List&lt;String&gt; languages = Arrays.asList(Locale.getISOLanguages());
assertTrue(languages.contains(&quot;ak&quot;));
}
[classlib][test][luni]SocketTest fails in running alone due to shortage of necessary permissions.
Since the MockSecurityManager lacks to give the permission to the &quot;getProperty.package.access&quot; Security Permission, so it will fails in loading the class of Permission unless the Permission class has been loaded before the MockSecurityManager is set as system security manager.
CLONE -[testing][buildtest] update vm options from '-D' to '-XD'
The interface to vm was changed so option is updated. Also change 'property' to 'jvmarg' for proxy settings to improve stability.
[classlib][luni]GregorianCalendar.getLeastMaximum(Calendar.WEEK_OF_YEAR) always return 50
GregorianCalendar.getLeastMaximum(Calendar.WEEK_OF_YEAR) always return 50 in Harmony.
But spec says that it should take into consideration the current values of the getFirstDayOfWeek, getMinimalDaysInFirstWeek, getGregorianChange and getTimeZone methods.
For example, following testcase fails on Harmony but passes on RI.
public void test() {
Date date = new Date(Date.parse(&quot;Jan 1 00:00:01 GMT 2000&quot;));
GregorianCalendar gc = new GregorianCalendar();
gc.setGregorianChange(date);
gc.setMinimalDaysInFirstWeek(7);
assertEquals(52, gc.getLeastMaximum(Calendar.WEEK_OF_YEAR));
}
[classlib][luni]No Exception was thrown when shutdown the input/output of a Socket twice
Following testcase throws SocketException on RI whereas returns silently on Harmony 
public void test() throws IOException {
Socket s = new Socket(&quot;0.0.0.0&quot;,0,false);
s.shutdownInput();
s.shutdownInput();
}
[classlib][luni]SocketImpl.shutdownInput/Output leads to VM crash
Following testcase throws IOException on RI whereas leads to vm crash on Harmony
public void test() throws IOException {
MySocketImpl s = new MySocketImpl();
s.test();
}
class MySocketImpl extends SocketImpl {
public void test() throws IOException {
shutdownInput();
}
@Override
protected void accept(SocketImpl newSocket) throws IOException {
}
@Override
protected int available() throws IOException {
return 0;
}
@Override
protected void bind(InetAddress address, int port) throws IOException {
}
@Override
protected void close() throws IOException {
}
@Override
protected void connect(String host, int port) throws IOException {
}
@Override
protected void connect(InetAddress address, int port)
throws IOException {
}
@Override
protected void connect(SocketAddress remoteAddr, int timeout)
throws IOException {
}
@Override
protected void create(boolean isStreaming) throws IOException {
}
@Override
protected InputStream getInputStream() throws IOException {
return null;
}
@Override
protected OutputStream getOutputStream() throws IOException {
return null;
}
@Override
protected void listen(int backlog) throws IOException {
}
@Override
protected void sendUrgentData(int value) throws IOException {
}
public Object getOption(int optID) throws SocketException {
return null;
}
public void setOption(int optID, Object val) throws SocketException {
}
}
[classlib][luni]UDP socket is not able to send package to 0.0.0.0
Following testcase passes on RI whereas throws SocketException on Harmony.
public void test() throws IOException {
Socket s = new Socket(&quot;0.0.0.0&quot;, 80, false);
OutputStream os = s.getOutputStream();
os.write(1);
}
[classlib][luni]No exception was thrown when parseURL with limit = Integer.MIN_VALUE
RI throws exception in following testcase whereas harmony return silently
public class URLStreamHandlerTest extends TestCase
static class MyURLStreamHandler extends URLStreamHandler {
@Override
protected URLConnection openConnection(URL arg0) throws IOException {
return null;
}
public void parse(URL url, String spec, int start, int end) {
parseURL(url, spec, start, end);
}
}
static class MyURLStreamHandlerFactory implements URLStreamHandlerFactory {
public static MyURLStreamHandler handler = new MyURLStreamHandler();
public URLStreamHandler createURLStreamHandler(String arg0) {
handler = new MyURLStreamHandler();
return handler;
}
}
public void test_parseURL() throws MalformedURLException {
URL.setURLStreamHandlerFactory(new MyURLStreamHandlerFactory());
URL url = new URL(&quot;http://localhost&quot;);
MyURLStreamHandler handler = MyURLStreamHandlerFactory.handler;
try {
handler.parse(url, &quot;//&quot;, 0, Integer.MIN_VALUE);
fail(&quot;Should throw SIOOBE.&quot;);
} catch (StringIndexOutOfBoundsException e) {
// expected;
}
}
}
[classlib] [luni] Ignored Exceptions (FindBugs)
FindBugs has flagged up some Exceptions in luni that are caught and then ignored. I am going to attach a patch to URLClassloader, where I think the Exception should not be caught, and a patch for the FindBugs exclusion filter to filter out the other Exceptions that I think are ignored for a reason.
[classlib][luni]no NPE was thrown when send a DatagramPacket with no dest addresss.
RI throws NPE when send DatagramPacket with no destination address, where harmony return silently.
testcase below passes on RI whereas fails on harmony,
public void test_send() throws IOException {
InetAddress i = InetAddress.getByName(&quot;127.0.0.1&quot;);
DatagramSocket d = new DatagramSocket(80,i);
try{
d.send(new DatagramPacket(new byte[]{1}, 1));
fail(&quot;should throw NPE.&quot;);
}catch(NullPointerException e){
//expected;
}finally{
d.close();
}
}
[classlib][luni]InetAddress.getByName does not support some textual representations
InetAddress.getByName does not support following textual representations 
d.d.d
d.d
d
testcase below shows the problem
public void test_getByName_ddd() throws IOException {
InetAddress i = InetAddress.getByName(&quot;1.2.3&quot;);
assertEquals(&quot;1.2.0.3&quot;,i.getHostAddress());
}
public void test_getByName_dd() throws IOException {
InetAddress i = InetAddress.getByName(&quot;1.2&quot;);
assertEquals(&quot;1.0.0.2&quot;,i.getHostAddress());
}
public void test_getByName_d() throws IOException {
InetAddress i = InetAddress.getByName(String.valueOf(0xffffffffL));
assertEquals(&quot;255.255.255.255&quot;,i.getHostAddress());
}
[classlib][luni]UDP socket behaves incorrectly
testcase below passed on RI whereas threw SocketException on harmony
public void test() throws IOException {
Socket s = new Socket(&quot;127.0.0.1&quot;, 0, false);
OutputStream o = s.getOutputStream();
o.write(1);
}
[classlib][security] KeyStoreSpi.engineLoad(KeyStore.LoadStoreParameter) catches exception improperly
I mocked a simple KeyStoreSpi and KeyStore.LoadStoreParameter as following:
class MyKeyStoreSpi extends KeyStoreSpi {
public Key engineGetKey(String alias, char[] password)
throws NoSuchAlgorithmException, UnrecoverableKeyException {
return null;
}
public Certificate[] engineGetCertificateChain(String alias) {
return null;
}
public Certificate engineGetCertificate(String alias) {
return null;
}
public Date engineGetCreationDate(String alias) {
return new Date(0);
}
public void engineSetKeyEntry(String alias, Key key, char[] password,
Certificate[] chain) throws KeyStoreException {
throw new KeyStoreException(
&quot;engineSetKeyEntry is not supported in myKeyStoreSpi&quot;);
}
public void engineSetKeyEntry(String alias, byte[] key, Certificate[] chain)
throws KeyStoreException {
throw new KeyStoreException(
&quot;engineSetKeyEntry is not supported in myKeyStoreSpi&quot;);
}
public void engineSetCertificateEntry(String alias, Certificate cert)
throws KeyStoreException {
throw new KeyStoreException(
&quot;engineSetCertificateEntry is not supported in myKeyStoreSpi&quot;);
}
public void engineDeleteEntry(String alias) throws KeyStoreException {
throw new KeyStoreException(
&quot;engineDeleteEntry is not supported in myKeyStoreSpi&quot;);
}
public Enumeration engineAliases() {
return null;
}
public boolean engineContainsAlias(String alias) {
return false;
}
public int engineSize() {
return 0;
}
public boolean engineIsKeyEntry(String alias) {
return false;
}
public boolean engineIsCertificateEntry(String alias) {
return false;
}
public String engineGetCertificateAlias(Certificate cert) {
return &quot;&quot;;
}
public void engineStore(OutputStream stream, char[] password)
throws IOException, NoSuchAlgorithmException, CertificateException {
if (!(stream instanceof ByteArrayOutputStream)) {
throw new IOException(&quot;Incorrect stream&quot;);
}
if (((ByteArrayOutputStream) stream).size() == 0) {
throw new IOException(&quot;Incorrect stream size &quot;);
}
}
public void engineLoad(InputStream stream, char[] password)
throws IOException, NoSuchAlgorithmException, CertificateException {
throw new IOException();
}
}
class MyLoadStoreParams implements KeyStore.LoadStoreParameter {
KeyStore.ProtectionParameter protPar;
public MyLoadStoreParams() { 
}
public MyLoadStoreParams(KeyStore.ProtectionParameter p) {
if (p == null) {
throw new NullPointerException(&quot;null parameter&quot;);
}
this.protPar = p;
}
public KeyStore.ProtectionParameter getProtectionParameter() {
return protPar;
}
}
Run the test below:
public class KeyStoreSpiTest { 
public static void main(String[] args) throws Exception {
KeyStore.LoadStoreParameter lParam = new MyLoadStoreParams(new KeyStore.PasswordProtection(new char[0]));
KeyStoreSpi spi = new MyKeyStoreSpi();
spi.engineLoad(lParam);
}
}
Harmony throws IllegalArgumentException which does not follow spec. IMO, it should simply throws IOException to indicate there is an I/O problem. 
Finally , thanks for reading so far :-)
[classlib][luni]java.net.Socket cann't bind the local address when constructed with proxy
Test:
public void test_SocketWithProxy() throws IOException {
//Confiure a available proxy here
InetSocketAddress isa = new InetSocketAddress(InetAddress.getByName(&quot;Your proxy host&quot;), 80);
Socket socket = new Socket(new Proxy(Proxy.Type.SOCKS, isa));
InetAddress address = InetAddress.getByName(&quot;localhost&quot;);
int port = 23232;
socket.bind(new InetSocketAddress(address, port));
assertEquals(port, socket.getLocalPort());
assertEquals(address, socket.getLocalAddress());
}
Result:
RI passes
Harmony fails
While constructing a new socket with proxy, in contrast with RI, Harmony will keep the address and port zero.
[drlvm][jvmti][em64t] Incorrect JVMTI monitor exit stub
When JVMTI is enabled, rth_get_lil_monitor_exit_generic() function generates special stub version for monitor exit.
But LIL code for JVMTI is incorrect, so assertion occurs on lil_is_valid() check.
[drlvm][interpreter] Use vm stack limit instead of harcoded value
Changed interpreter code to use VM&lt;&gt;interpreter interfaces to access stack size information for StackOverflowError support.
Previously hardcoded constant (500 000) has limited the stack size.
[classlib][swing] j.s.text.BoxView incorrectly layouts where its child views are resizable
If one puts a resizable view into a javax.swing.ParagraphView row, the view will be layout incorrectly where there's not enough of space to display the view reduces lower than its preferred span.
[drlvm][jvmti] java.lang.VerifyError is thrown for instrumented class
DRLVM (r) cannot execute HelloWorld class instrumented by Eclipse TPTP profiler either statically or dynamically. The following exception is thrown:
2. run instrumented class
Uncaught exception in main:
java.lang.VerifyError: (class: mytests/HelloWorld, method: &lt;init&gt;()V) Uninitialized reference usage
at java.lang.VMClassRegistry.defineClass(Native Method)
at java.lang.ClassLoader.defineClass(Unknown Source)
at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:70)
at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1137)
at java.net.URLClassLoader$4.run(URLClassLoader.java:616)
at java.net.URLClassLoader$4.run(URLClassLoader.java)
at java.security.AccessController.doPrivilegedImpl(Unknown Source)
at java.security.AccessController.doPrivileged(Unknown Source)
at java.net.URLClassLoader.findClass(URLClassLoader.java:614)
at java.lang.ClassLoader.loadClass(Unknown Source)
at java.lang.ClassLoader$SystemClassLoader.loadClass(Unknown Source)
at java.lang.ClassLoader.loadClass(Unknown Source)
FAILED to invoke JVM.
To reproduce this error get test attached to HARMONY-2200 and run it against DRLVM build. Only case 1 with original not instrumented class is finished successfully. In all three other cases, where instrumented class is executed, VerifyError is thrown. RI works fine with this instrumented class.
[classlib][swing] j.s.plaf.basic.BasicOptionPaneUI.getIconForType() doesn't throw NPE
javax.swing.plaf.basic.BasicOptionPaneUI.getIconForType(int) returns non-null icon whereas RI throws NPE:
java.lang.NullPointerException
at sun.swing.DefaultLookup.get(DefaultLookup.java:81)
at javax.swing.plaf.basic.BasicOptionPaneUI.getIconForType(BasicOptionPaneUI.java:551)
at Test$TestBasicOptionPaneUI.getIconForType(Test.java:8)
at Test.main(Test.java:14)
Note: if UI is associated with a JOptionPane, then RI returns an icon too and no exception is thrown.
(Add the following line before System.out:
bop.installUI(new JOptionPane());
)
======= Code to Reproduce =======
import javax.swing.Icon;
import javax.swing.plaf.basic.BasicOptionPaneUI;
public class Test {
private static class TestBasicOptionPaneUI extends BasicOptionPaneUI {
@Override
public Icon getIconForType(int i) {
return super.getIconForType(i);
}
}
public static void main(String[] args) {
TestBasicOptionPaneUI bop = new TestBasicOptionPaneUI();
System.out.println(bop.getIconForType(0));
}
}
======= end of code =======
[classlib][swing] j.s.plaf.basic.BasicOptionPaneUI.getMaxCharactersPerLineCount doesn't throw NPE
Calling javax.swing.plaf.basic.BasicOptionPaneUI.getMaxCharactersPerLineCount() does not throw NPE on Harmony, but it does on RI.
[classlib][swing] several methods of j.s.plaf.basic.BasicOptionPaneUI throw NPE
The following methods javax.swing.plaf.basic.BasicOptionPaneUI throw NPE whereas RI works without exceptions.
These methods are:
* getButtons()
* getInitialValueIndex()
* uninstallListeners()
[classlib][swing] javax.swing.plaf.basic.BasicComboBoxUI.paintCurrentValueBackground throws unspecified NPE on RI and doesn't on Harmony
javax.swing.plaf.basic.BasicComboBoxUI.paintCurrentValueBackground throws unspecified NPE on RI and doesn't on Harmony.
See test case to reproduce, it passes on RI and fails on Harmony:
------------ test.java ----------
import java.awt.image.BufferedImage;
import javax.swing.plaf.basic.BasicComboBoxUI;
import javax.swing.plaf.basic.BasicTextUI;
import junit.framework.TestCase;
import junit.textui.TestRunner;
public class test extends TestCase {
public static void main(String args[]) {
TestRunner.run(test.class);
}
public void test1Run() {
BasicComboBoxUI localBasicComboBoxUI = new BasicComboBoxUI();
try {
localBasicComboBoxUI.paintCurrentValueBackground(new BufferedImage(
6, 6, BufferedImage.TYPE_4BYTE_ABGR).createGraphics(),
new BasicTextUI.BasicCaret(), true);
fail(&quot;NullPointerException expected&quot;);
} catch (NullPointerException e) {
// expected
}
}
}
-----------------------------------
[classlib][swing] Compatibility: javax.swing.plaf.basic.BasicComboBoxUI. getAccessibleChildrenCount(null) does not throw unspecified NPE
There is no mention of any exception in the specification.
RI throws unspecified NPE for javax.swing.plaf.basic.BasicComboBoxUI.getAccessibleChildrenCount(null) while Harmony does not.
Next test case passes on RI and fails on Harmony:
--------- test.java ----------
import javax.swing.plaf.basic.BasicComboBoxUI;
import junit.framework.TestCase;
import junit.textui.TestRunner;
public class test extends TestCase {
public static void main(String args[]) {
TestRunner.run(test.class);
}
public void testRun() {
BasicComboBoxUI cb = new BasicComboBoxUI();
try {
cb.getAccessibleChildrenCount(null);
fail(&quot;NullPointerException expected&quot;);
} catch (NullPointerException e) {
// expected
}
}
}
--------------------------------
[classlib][swing] javax.swing.plaf.basic.BasicTabbedPaneUI.createScrollButton(int) does not throw IllegalArgumentException in case of incorrect direction
Specification says that this method should throw IllegalArgumentException, if direction is not one of NORTH, SOUTH, EAST or WEST. But Harmony does not throw IllegalArgumentException instead of RI.
Test to reproduce:
---------------------------------------------
import javax.swing.*;
import javax.swing.plaf.basic.*;
class lBasicTabbedPaneUI extends BasicTabbedPaneUI {
public lBasicTabbedPaneUI() {
super();
}
public JButton createScrollButton(int direction) {
return super.createScrollButton(direction);
}
}
public class TestForBugReproduce 
{
public static void main(String args[]) {
lBasicTabbedPaneUI localBasicTabbedPaneUI = new
lBasicTabbedPaneUI();
int localVariable0 = 80;
JButton returnValue =
localBasicTabbedPaneUI.createScrollButton(localVariable0);
System.out.println(&quot;Ok&quot;);
}
}
----------------------------------
Output on RI:
===========
Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Direction must
be one of: SOUTH, NORTH, EAST or WEST
at
javax.swing.plaf.basic.BasicTabbedPaneUI.createScrollButton(BasicTabbedPaneUI.java:275)
at lBasicTabbedPaneUI.createScrollButton(TestForBugReproduce.java:9)
at TestForBugReproduce.main(TestForBugReproduce.java:19)
Output on Harmony:
================
Ok
[classlib][swing] Compatibility: javax.swing.plaf.basic.BasicComboBoxUI.ComboBoxLayoutManager.minimumLayoutSize(null) returns valid result while RI throws NPE
javax.swing.plaf.basic.BasicComboBoxUI.ComboBoxLayoutManager.minimumLayoutSize(null)
returns valid result while RI throws NPE.
Test for reproducing:
------------- Test.java -------------
import javax.swing.plaf.basic.BasicComboBoxUI;
import junit.framework.TestCase;
import junit.textui.TestRunner;
public class test extends TestCase {
public static void main(String args[]) {
TestRunner.run(test.class);
}
public void testRun() {
BasicComboBoxUI lb = new BasicComboBoxUI();
BasicComboBoxUI.ComboBoxLayoutManager b = lb.new ComboBoxLayoutManager();
try {
b.minimumLayoutSize(null);
fail(&quot;NPE expected&quot;);
} catch (NullPointerException e) {
// expected
}
}
}
------------------------------
Output on RI
==========
.
Time: 0.281
OK (1 test)
Output on Harmony:
================
.F
Time: 4.979
There was 1 failure:
1) testRun(test)junit.framework.AssertionFailedError: NPE expected
at test.testRun(test.java:17)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at test.main(test.java:9)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
[drlvm][em64t][jitrino] Jitrino doesn't support heap size &gt;= 2Gb
Simple test crashes on DRLVM/Jitrino when running with 2.5Gb heap: java -Xmx2500m -Xms2500m Test 
public class Test {
public static void main(String[] args) {
while (true) {
byte[] b = new byte[10240];
}
}
}
It works fine using interpreter.
[classlib][swing] j.s.plaf.basic.BasicSliderUI.createScrollListener throws unspecified NPE
Calling javax.swing.plaf.basic.BasicSliderUI.createScrollListener(null) throws NPE on Harmony and works silently on RI.
[classlib][swing] j.s.plaf.basic.BasicSliderUI.uninstallUI should throw IllegalComponentStateException
javax.swing.plaf.basic.BasicSliderUI.uninstallUI should throw IllegalComponentStateException where the instance passed to uninstallUI does not coincide with the instance of JSlider with which the UI is associated.
[classlib][swing] javax.swing.plaf.basic.BasicFileChooserUI.getApproveButtonToolTipText(null) returns null while RI throws NPE
javax.swing.plaf.basic.BasicFileChooserUI.getApproveButtonToolTipText(null) returns null while RI throws NPE. The current implementation of this method simply ignores the passed parameter. Probably, it shouldn't be ignored.
The following test case demonstrates this behavior:
-----------------------------------------------------------------------------------
import junit.framework.TestCase;
import javax.swing.plaf.basic.BasicFileChooserUI;
import javax.swing.*;
public class Test0 extends TestCase {
public void testcase1() {
BasicFileChooserUI b = new BasicFileChooserUI(new JFileChooser(&quot;&quot;));
try {
b.getApproveButtonToolTipText(null);
fail(&quot;NPE should be thrown&quot;);
} catch ( NullPointerException e) {
//expected
}
}
}
[classlib][swing] javax.swing.plaf.basic.BasicFileChooserUI.installDefaults(null) returns null while RI throws NPE
javax.swing.plaf.basic.BasicFileChooserUI.installDefaults(null) returns null on Harmony while RI throws NPE.
Current implementation of BasicFileChooserUI.installDefaults(JFileChooser fc) simply ignores the parameter, so it doesn't throw this unspecified NPE. I suggest to treat this as a non-bug difference.
The following testcase demonstrates this behavior:
--------------------------------------------------------------------------------------
import junit.framework.TestCase;
import javax.swing.plaf.basic.BasicFileChooserUI;
import javax.swing.*;
import java.lang.reflect.InvocationTargetException;
public class Test0 extends TestCase {
public void testcase1() {
BasicFileChooserUI jm = new BasicFileChooserUI(null);
java.lang.reflect.Method mt = null;
Class cls = BasicFileChooserUI.class;
try{
mt = cls.getDeclaredMethod( &quot;installDefaults&quot;, JFileChooser.class);
} catch(Exception e) {
e.printStackTrace();
}
mt.setAccessible(true);
Object[] obj ={null};
try {
mt.invoke(jm, obj );
fail(&quot;NPE should be thrown&quot;);
} catch ( IllegalAccessException ae) {
ae.printStackTrace();
} catch ( InvocationTargetException ie) {
}
}
}
[classlib][swing] j.s.text.JTextComponent.fireCaretUpdate(null) throws unspecified NPE
RI works silently but Harmony throws NPE in the following code.
======== Code to Reproduce =======
import javax.swing.JEditorPane;
import javax.swing.event.CaretEvent;
public class Test {
private static class Editor extends JEditorPane {
@Override
public void fireCaretUpdate(CaretEvent ce) {
super.fireCaretUpdate(ce);
}
}
public static void main(String[] args) {
Editor editor = new Editor();
editor.fireCaretUpdate(null);
}
}
======= end of code =======
[classlib][awt] JUnit AWT-based TestRunner can't be started
Trying to launch AWT-based TestRunner of JUnit throws NPE:
java.exe -cp junit.jar junit.awtui.TestRunner
Exception in thread &quot;main&quot; java.lang.NullPointerException
at java.awt.List.getMaxCharSize(List.java:1413)
at java.awt.List.getMinimumSize(List.java:875)
at java.awt.List.getPreferredSize(List.java:890)
at java.awt.List.updatePrefWidth(List.java:1486)
at java.awt.List.addNotify(List.java:842)
at java.awt.Container.addNotify(Container.java:443)
at java.awt.Panel.addNotify(Panel.java:69)
at java.awt.Container.addNotify(Container.java:443)
at java.awt.Window.addNotify(Window.java:29)
at java.awt.Frame.addNotify(Frame.java:187)
at java.awt.Component.mapToDisplay(Component.java:1413)
at java.awt.Container.mapToDisplay(Container.java:1189)
at java.awt.Window.pack(Window.java:693)
at junit.awtui.TestRunner.createUI(TestRunner.java:287)
at junit.awtui.TestRunner.start(TestRunner.java:530)
at junit.awtui.TestRunner.main(TestRunner.java:382)
Swing-based TestRunner works fine.
[drlvm] VM crashes instead of throwing VerifyError when used class overrides final method
VM crashes when it tries to load class which contains overridden final method.
The following test which uses attached synthetic classes demonstrates this issue:
----------finTest.java----------
public class finTest {
public static void main(String args[]) {
try {
new finTest1().test();
System.out.println(&quot;Test failed. VerifyError was not thrown&quot;);
} catch (VerifyError e) {
System.out.println(&quot;Test passed: &quot;+e);
} catch (Throwable e) {
System.out.println(&quot;Test failed: unexpected &quot;+e);
e.printStackTrace();
}
}
}
----------------finTest1.jj--------------
.class public finTest1
.super java/lang/Object
;
; standard initializer
.method public &lt;init&gt;()V
aload_0
invokespecial java/lang/Object/&lt;init&gt;()V
return
.end method 
; final method
.method public final testMethod()I
.limit locals 2
.limit stack 2
sipush 1
ireturn
.end method
;
.method public test()V
.limit stack 2
.limit locals 2
new finTest2
dup
invokespecial finTest2/&lt;init&gt;()V
aload 0
invokevirtual finTest2/testMethod()V
return
.end method
--------------finTest2.jj------------------
.class public finTest2
.super finTest1
;
; standard initializer
.method public &lt;init&gt;()V
aload_0
invokespecial finTest1/&lt;init&gt;()V
return
.end method 
;
.method public final testMethod()I
.limit locals 2
.limit stack 2
sipush 2
ireturn
.end method
-----------------
[drlvm][jit] StackTest and gc.Mark fail if Jitrino built in debug mode
I am a JIT developer and as a result I generally run DRLVM with jitrino build in debug mode. However, the drlvm tests do not pass in this mode.
[classlib][awt] Compatibility: java.awt.image.ComponentSampleModel.getSamples(int,int,int,int,int[],DataBuffer) does not throw NPE while RI does
Under some specific circumstances java.awt.image.ComponentSampleModel.getSamples(int,int,int,int,int[],DataBuffer) does not throw NPE on Harmony, but RI does. This is a case when integer overflow occurs with the passed coordinates/width/height values. NPE is not documented in the API spec. I don't think that this is a big issue and suggest to treat this as a non-bug difference from RI. The following testcase demonstrates this behavior:
------------------------------------------------------------------------------------------
import junit.framework.TestCase;
import java.awt.image.*;
public class Test0 extends TestCase {
public void testcase0() {
ComponentSampleModel csm = new ComponentSampleModel(3, 10, 10, 1, 10, new int[]{0});
try {
int[] returnValue =
csm.getSamples(Integer.MAX_VALUE,4,1,1,0,new int[]{0},(DataBuffer) null);
fail(&quot;No exception&quot;);
} catch(NullPointerException expectedException) {
System.out.println(expectedException +&quot; was thrown&quot;);
}
}
}
------------------------------------------------------------------------------------------
Harmony:
No exception
junit.framework.AssertionFailedError
at Test0.testcase0(Test0.java:33)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:25)
------------------------------------------------------------------------------------------
RI:
java.lang.NullPointerException was thrown
[java][awt] Compatibility: java.awt.image.IndexColorModel.getDataElement() throws ArrayIndexOutOfBoundsException on RI and doesn't on Harmony
java.awt.image.IndexColorModel.getDataElement() throws ArrayIndexOutOfBoundsException on RI and doesn't on Harmony.
Test to reproduce:
---------------- test.java ---------------
import java.awt.image.IndexColorModel;
import junit.framework.TestCase;
import junit.textui.TestRunner;
public class test extends TestCase {
public static void main(String args[]) {
TestRunner.run(test.class);
}
public void testRun() {
int bits = 4;
int size = 166;
IndexColorModel localIndexColorModel = new IndexColorModel(bits, size,
new byte[size], new byte[size], new byte[size]);
int[] components = new int[] { 0, 0, 0, 0, 0, 0, 0 };
int offset = 6;
try {
int returnValue = localIndexColorModel.getDataElement(components, offset);
fail(&quot;ArrayIndexOutOfBoundsException expected&quot;);
} catch (ArrayIndexOutOfBoundsException unexpectedException) {
unexpectedException.printStackTrace();
}
}
}
--------------------------------------------
Output RI:
========
.java.lang.ArrayIndexOutOfBoundsException
at java.awt.image.IndexColorModel.getDataElement(IndexColorModel.java:1089)
at test.testRun(test.java:20)
at jrockit.reflect.VirtualNativeMethodInvoker.invoke(Ljava.lang.Object;[Ljava.lang.Object;)Ljava.lang.Object;(Unknown Source)
at java.lang.reflect.Method.invoke(Ljava.lang.Object;[Ljava.lang.Object;I)Ljava.lang.Object;(Unknown Source)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at junit.textui.TestRunner.doRun(TestRunner.java:116)
at junit.textui.TestRunner.doRun(TestRunner.java:109)
at junit.textui.TestRunner.run(TestRunner.java:72)
at junit.textui.TestRunner.run(TestRunner.java:57)
at test.main(test.java:9)
Time: 0,05
OK (1 test)
Output Harmony:
==============
.F
Time: 0.07
There was 1 failure:
1) testRun(test)junit.framework.AssertionFailedError: ArrayIndexOutOfBoundsException expected
at test.testRun(test.java:21)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at test.main(test.java:9)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
[classlib][awt] java.awt.image.IndexColorModel.getNormalizedComponents() throws UnsupportedOperationException while RI throws NPE
Harmony throws specified UnsupportedOperationException for java.awt.image.IndexColorModel.getNormalizedComponents(Object pixel,float[]
normComponents,int normOffset) while RI throws unspecified NPE.
Spec says:&quot;Throws: ClassCastException - if pixel is not a primitive array of type transferType &quot;.
Test case to reproduce:
----------------------- test.java -------------------------
import java.awt.image.IndexColorModel;
import junit.framework.TestCase;
import junit.textui.TestRunner;
public class test extends TestCase {
public static void main(String args[]) {
TestRunner.run(test.class);
}
public void testRun() {
int size = 2;
int bits = 4;
IndexColorModel cm = new IndexColorModel(bits, size, new byte[size],
new byte[size], new byte[size]);
float[] normComponentes = new float[] {};
int normOffset = 5;
Object pixel = null;
try {
cm.getNormalizedComponents(pixel, normComponentes, normOffset);
fail(&quot;NPE exception expected!&quot;);
} catch (NullPointerException npe) {
npe.printStackTrace();
}
}
}
-------------------------------------------------------------
Output RI:
========
.java.lang.NullPointerException
at java.awt.image.IndexColorModel.getComponents(IndexColorModel.java:1047)
at java.awt.image.ColorModel.getNormalizedComponents(ColorModel.java:1414)
at test.testRun(test.java:24)
at jrockit.reflect.VirtualNativeMethodInvoker.invoke(Ljava.lang.Object;[Ljava.lang.Object;)Ljava.lang.Object;(Unknown Source)
at java.lang.reflect.Method.invoke(Ljava.lang.Object;[Ljava.lang.Object;I)Ljava.lang.Object;(Unknown Source)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at junit.textui.TestRunner.doRun(TestRunner.java:116)
at junit.textui.TestRunner.doRun(TestRunner.java:109)
at junit.textui.TestRunner.run(TestRunner.java:72)
at junit.textui.TestRunner.run(TestRunner.java:57)
at test.main(test.java:9)
Time: 0,06
OK (1 test)
Output Harmony:
=============
.E
Time: 0.371
There was 1 error:
1) testRun(test)java.lang.UnsupportedOperationException: This transferType is not supported by this color model
at java.awt.image.IndexColorModel.getComponents(IndexColorModel.java:462)
at java.awt.image.ColorModel.getNormalizedComponents(ColorModel.java)
at test.testRun(test.java:21)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at test.main(test.java:9)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
[classlib][awt]java.awt.image.IndexColorModel.getNormalizedComponents throws ArrayIndexOutOfBoundsException on Harmony while it does not on RI
According to the specification for getNormalizedComponents(int[] components, int offset, float[] normComponents, int normOffset):
&quot;If the normComponents array is null, a new array will be allocated&quot; and &quot;an ArrayIndexOutOfBoundsException is thrown if the normComponents array is not null and is not large enough to hold all the color and alpha components (starting at normOffset)&quot;.
Test listed below sets normComponents==null. 
In this case RI does not throw an exception according to the specification while Harmony throws.
---------------- test.java-------------------
import junit.framework.TestCase;
import java.awt.*;
import java.awt.image.*;
public class test extends TestCase { 
public void test1 () { 
IndexColorModel obj=new IndexColorModel(1,1,new byte[]{1,1,1},0,
false);
obj.getNormalizedComponents(new int[] {1,-23,5,67,89,0}, 1, null,
1002);
}
}
----------------------------------------
Output on Sun 1.5:
==================
.
Time: 0
OK (1 test)
Output on Harmony:
==================
.E
Time: 0.016
There was 1 error:
1) test1(test)java.lang.ArrayIndexOutOfBoundsException
at
java.awt.image.ColorModel.getNormalizedComponents(ColorModel.java:294)
at test.test1(test.java:7)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Note: The same issue is for IndexColorModel.getUnnormalizedComponents()
[classlib][awt] java.awt.image.IndexColorModel.getNormalizedComponents throws IllegalArgumentException on Harmony instead of ArrayIndexOutOfBoundsException
According to the specification for getNormalizedComponents(int[] components, int offset, float[] normComponents, int normOffset)
&quot;an ArrayIndexOutOfBoundsException is thrown if the normComponents array is not null and is not large enough to hold all the color and alpha components (starting at normOffset)&quot;.
Test listed below shows that Harmony throws IllegalArgumentException instead of
ArrayIndexOutOfBoundsException.
Test for reproducing:
------------- test.java -------------------
import junit.framework.TestCase;
import java.awt.*;
import java.awt.image.*;
public class test extends TestCase { 
public void test1 () { 
try { 
IndexColorModel obj=new IndexColorModel(1,1,new byte[]{1,1,1},0,false);
obj.getNormalizedComponents(new int[] {1,-23,5,67,89,0}, 1, new float[] {1,-23,5,67,89,0}, 200); 
fail(&quot;ArrayIndexOutOfBoundsException should be thrown&quot;);
} catch (ArrayIndexOutOfBoundsException e) {
//expected 
}
} 
}
-------------------------------------------
Output on RI:
==================
.
Time: 0
OK (1 test)
Output on Harmony:
==================
1) test1(test)java.lang.IllegalArgumentException: The length of normComponents minus normOffset is less than numComponents
at
java.awt.image.ColorModel.getNormalizedComponents(ColorModel.java:270)
at test.test1(test.java:7)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
Note: The same issue is for IndexColorModel.getUnnormalizedComponents.
[java][security]CodeSource fails to get ObjectStreamField for field &quot;location&quot;.
Here is a testcase:
public void testSerialization()
{
ObjectStreamClass objectStreamClass = ObjectStreamClass.lookup(CodeSource.class);
ObjectStreamField objectStreamField = objectStreamClass.getField(&quot;location&quot;);
assertNotNull(objectStreamField);
}
RI passes.
Harmony fails.
[classlib][awt] Compatibility: java.awt.image.ComponentSampleModel.getPixels(int,int,inrt,int,int[],DataBuffer) does not throw ArrayIndexOutOfBoundsException while RI throws it
The behavior of Harmony implementation of the constructor ComponentSampleModel.getPixels(int,int,inrt,int,int[],DataBuffer) differs from RI in case of integer overflow. The following testcase demostrates this difference:
--------------------------------------------------------------------------------------------------
import junit.framework.TestCase;
import java.awt.image.ComponentSampleModel;
import java.awt.image.DataBufferInt;
public class Test0 extends TestCase {
public void testcase0(){
ComponentSampleModel csm = new ComponentSampleModel(0, 10, 10, 1, 10, new int[]{0});
DataBufferInt dbi = new DataBufferInt(100);
try {
int[] returnValue = csm.getPixels(8, Integer.MAX_VALUE, 1, 1, (int[])null, dbi);
fail(&quot;Exception expected&quot;);
} catch(ArrayIndexOutOfBoundsException expectedException) {
System.out.println(expectedException + &quot; was thrown&quot;);
}
}
}
--------------------------------------------------------------------------------------------------
Harmony:
junit.framework.AssertionFailedError: Exception expected
at Test0.testcase0(Test0.java:32)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:25)
RI:
java.lang.ArrayIndexOutOfBoundsException: -2 was thrown
[classlib][swing] j.s.text.DefaultCaret.adjustVisibility throws NPE whereas RI doesn't
javax.swing.text.DefaultCaret.adjustVisibility(null) throws NullPointerException whereas RI works silently. The spec says nothing about exceptions.
======= Code to Reproduce =======
import java.awt.Rectangle;
import javax.swing.text.DefaultCaret;
public class Test {
private static class DefCaret extends DefaultCaret {
@Override
public void adjustVisibility(Rectangle r) {
super.adjustVisibility(r);
}
}
public static void main(String[] args) {
new DefCaret().adjustVisibility(null);
System.err.println(&quot;silent&quot;);
}
}
======= end of code =======
------ Harmony Output -------
Exception in thread &quot;main&quot; java.lang.NullPointerException
at javax.swing.text.DefaultCaret.adjustVisibility(DefaultCaret.java:415)
at Test$DefCaret.adjustVisibility(Test.java:9)
at Test.main(Test.java:14)
------- end of output -------
------- RI Output -------
silent
------ end of output -------
[classlib][swing] j.s.text.AbstractDocument.BranchElement.get{Start, End}Offset throw ArrayIndexOutOfBoundsException rather than NPE
The spec states that getEndOffset throws NPE if the element has no children [1].
The spec doesn't say anything about exceptions for getStartOffset() [2]. However, it also throws NPE in this case. The behavior of these methods should be similar in respect to exceptions.
[1] http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/text/AbstractDocument.BranchElement.html#getEndOffset()
[2] http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/text/AbstractDocument.BranchElement.html#getStartOffset()
======= Code to Reproduce =======
import javax.swing.text.PlainDocument;
import javax.swing.text.AbstractDocument.BranchElement;
public class Test {
public static void main(String[] args) {
PlainDocument doc = new PlainDocument();
BranchElement branch = doc.new BranchElement(null, null);
try {
System.err.println(branch.getStartOffset());
} catch (Exception e) {
System.err.println(&quot;getStartOffset:&quot;);
e.printStackTrace();
}
try {
System.err.println(branch.getEndOffset());
} catch (Exception e) {
System.err.println(&quot;getEndOffset:&quot;);
e.printStackTrace();
}
}
}
======= end of code =======
------- Harmony Output -------
getStartOffset:
java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 0
at javax.swing.text.AbstractDocument$BranchElement.getStartOffset(AbstractDocument.java:419)
at Test.main(Test.java:9)
getEndOffset:
java.lang.ArrayIndexOutOfBoundsException: Array index out of range: -1
at javax.swing.text.AbstractDocument$BranchElement.getEndOffset(AbstractDocument.java:48)
at Test.main(Test.java:15)
------- end of Harmony -------
------- RI Output -------
getStartOffset:
java.lang.NullPointerException
at javax.swing.text.AbstractDocument$BranchElement.getStartOffset(AbstractDocument.java:2331)
at Test.main(Test.java:9)
getEndOffset:
java.lang.NullPointerException
at javax.swing.text.AbstractDocument$BranchElement.getEndOffset(AbstractDocument.java:2343)
at Test.main(Test.java:15)
------- end of RI -------
[classlib][swing] j.s.text.BoxView.childAllocation does not throw NPE whereas RI does
Consider the following example:
import java.awt.Rectangle;
import javax.swing.text.BoxView;
import javax.swing.text.Element;
import javax.swing.text.PlainDocument;
import javax.swing.text.View;
public class Test {
private static class BV extends BoxView {
public BV(final Element element, final int axis) {
super(element, axis);
}
@Override
public void childAllocation(final int index, final Rectangle alloc) {
super.childAllocation(index, alloc);
}
}
public static void main(String[] args) {
BV bv = new BV(new PlainDocument().getDefaultRootElement(), View.Y_AXIS);
bv.childAllocation(0, null);
System.err.println(&quot;silent&quot;);
}
}
======= end of code =======
Harmony prints:
silent
RI prints:
java.lang.NullPointerException
at javax.swing.text.BoxView.childAllocation(BoxView.java:669)
at Test$BV.childAllocation(Test.java:59)
at Test.main(Test.java:65)
[classlib][swing] javax.swing.plaf.basic.BasicSplitPaneUI.getLastDragLocation() returns -1 while RI returns 0
Compatibility issue. There is no mention of getLastDragLocation() initial value
in the specification. RI returns 0 while Harmony returns -1.
import junit.framework.TestCase;
import javax.swing.plaf.basic.*;
public class test extends TestCase { 
public void testcase1() { 
BasicSplitPaneUI pui = new BasicSplitPaneUI(); 
System.out.println(&quot;getLastDragLocation()==&quot;+pui.getLastDragLocation()); 
}
}
Output on Sun 1.5:
=================
.getLastDragLocation()==0
Time: 0
OK (1 test)
Output on Harmony:
==================
.getLastDragLocation()==-1
Time: 0.015
OK (1 test)
[classlib][swing] DefaultTreeSelectionModel.getSelectionRows() returns empty array while RI returns null
According to the specification method returns &quot;all of the currently selected rows. This will return null (or an empty array) if there are no selected TreePaths or a RowMapper has not been set&quot;. 
Harmony returns empty array while RI returns null. 
It is compatibility issue.
import junit.framework.TestCase;
import javax.swing.tree.*;
public class test extends TestCase { 
public void testcase1() { 
DefaultTreeSelectionModel t=new DefaultTreeSelectionModel(); 
int [] a=t.getSelectionRows();
assertEquals(0, a.length); 
} 
}
Output on RI:
.E
Time: 0
There was 1 error:
1) testcase1(test)java.lang.NullPointerException
at test.testcase1(test.java:9)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
OK (1 test)
Output on Harmony:
.
Time: 0.016
OK (1 test)
[classlib][swing] javax.swing.plaf.basic.BasicSplitPaneUI.getMaximumSize(JScrollBar sb) throws NPE while RI does not
Harmony throws unspecified NPE for javax.swing.plaf.basic.BasicSplitPaneUI.getMaximumSize(JScrollBar sb) while RI works silently.
junit test for reproducing:
import junit.framework.TestCase;
import javax.swing.JScrollBar;
import java.awt.Dimension;
import javax.swing.plaf.basic.BasicSplitPaneUI;
public class test extends TestCase 
{
public void testcase0()
{ 
BasicSplitPaneUI localBasicSplitPaneUI = new
BasicSplitPaneUI();
JScrollBar localJScrollBar = new JScrollBar();
try 
{
localBasicSplitPaneUI.getMaximumSize(localJScrollBar);
System.out.println(&quot;works silently&quot;);
assertEquals(true, true);
} 
catch (NullPointerException unexpectedException) 
{fail(&quot;Unspecified &quot;+unexpectedException+&quot; was thrown&quot;);
}
}
}
OUTPUT:
Harmony+j9:
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as
app
licable.
.F
Time: 1.391
There was 1 failure:
1) testcase0(test)junit.framework.AssertionFailedError: Unspecified
java.lang.Nu
llPointerException was thrown
at test.testcase0(test.java:19)
at
java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
------------------------------------------------------------------------
SUN
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.works silently
Time: 0.703
OK (1 test)
[classlib][swing] javax.swing.plaf.basic.BasicListUI.getCellBounds() does not throw unspecified NPE while RI does
There is no mention of any exception in the specification for getCellBounds(JList list,int index1, int index2).
Harmony throws unspecified NPE if JList == null and index1&gt;0. RI also throws NPE.
But Harmony does not throw NPE if JList == null and index1&lt;0 while RI does.
import javax.swing.plaf.basic.BasicListUI;
import javax.swing.UIDefaults;
import javax.swing.*;
public class test {
public static void main(String[] args) {
try {
BasicListUI bl = new BasicListUI();
bl.getCellBounds((JList) null, -1, 9);
} catch (Exception e) {
e.printStackTrace();
}
try {
BasicListUI bl = new BasicListUI();
bl.getCellBounds((JList) null, 1, 9);
} catch (Exception e) {
e.printStackTrace();
}
}
}
Output on RI:
java.lang.NullPointerException
at
javax.swing.plaf.basic.BasicListUI.updateLayoutState(BasicListUI.java:1125)
at
javax.swing.plaf.basic.BasicListUI.maybeUpdateLayoutState(BasicListUI.java:1105)
at
javax.swing.plaf.basic.BasicListUI.getCellBounds(BasicListUI.java:746)
at test.main(test.java:10)
java.lang.NullPointerException
at
javax.swing.plaf.basic.BasicListUI.updateLayoutState(BasicListUI.java:1125)
at
javax.swing.plaf.basic.BasicListUI.maybeUpdateLayoutState(BasicListUI.java:1105)
at
javax.swing.plaf.basic.BasicListUI.getCellBounds(BasicListUI.java:746)
at test.main(test.java:16)
Output on Harmony +j9:
java.lang.NullPointerException
at
javax.swing.plaf.basic.BasicListUI.getCellBounds(BasicListUI.java:375)
at test.main(test.java:16)
[classlib][swing] javax.swing.plaf.basic.BasicInternalFrameUI. createNorthPane(null) does not throw unspecified NPE
There is no mention of any exception in the specification.
RI throws unspecified NPE for createNorthPane(null) while Harmony does not.
Note, both RI and Harmony don't throw NPE for
createSouthPane(null)
createEastPane(null)
createWestPane(null).
import javax.swing.plaf.basic.*;
import javax.swing.*;
public class test {
public static void main(String[] args) { 
try { 
testBasicInternalFrameUI fr = new testBasicInternalFrameUI(null);
fr.createNorthPane(null); 
} catch (Exception e) { 
e.printStackTrace();
} 
} 
}
class testBasicInternalFrameUI extends BasicInternalFrameUI {
testBasicInternalFrameUI (JInternalFrame c){
super(c); 
}
public JComponent createNorthPane(JInternalFrame c) {
return super.createNorthPane(c); 
} 
}
Output on RI:
java.lang.NullPointerException
at
javax.swing.plaf.basic.BasicInternalFrameTitlePane.installListeners(BasicInternalFrameTitlePane.java:139)
at
javax.swing.plaf.basic.BasicInternalFrameTitlePane.installTitlePane(BasicInternalFrameTitlePane.java:98)
at
javax.swing.plaf.basic.BasicInternalFrameTitlePane.&lt;init&gt;(BasicInternalFrameTitlePane.java:93)
at
javax.swing.plaf.basic.BasicInternalFrameUI.createNorthPane(BasicInternalFrameUI.java:332)
at testBasicInternalFrameUI.createNorthPane(test.java:31)
at test.main(test.java:8)
Output on Harmony +j9:
(no output)
[classlib][swing] j.s.text.AbstractDocument.BranchElement.getElementIndex may return -1 instead of 0 in RI
javax.swing.text.AbstractDocument.BranchElement.getElementIndex may return -1 in Harmony in case where RI returns 0.
[drlvm][verifier] vm fails with -Xverify flag set
Failed to create Java VM if flag -Xverifier is set.
java -showversion -Xverify 
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot; 
pre-alpha : not complete or compatible
svn = r487506, (Dec 15 2006), Windows/ia32/msvc 1310, debug build
http://incubator.apache.org/harmony
vf_debug: VerifyError: (class: java/util/Collections, method: max(Ljava/util/Collection;)Ljava/lang/Object;) Incompatible argument for function
HMYEXEL062E Internal VM error: Failed to create Java VM
FAILED to invoke JVM.
[classlib][swing] j.s.text.Utilities.getNextWord throws IllegalArgumentException rather than BadLocationException
javax.swing.text.Utilities.getNextWord(JTextComponent, int) throws IllegalArgumentException where RI throws BadLocationException.
To reproduce, use the following code:
Utilities.getNextWord(new JEditorPane(&quot;text/plain&quot;, &quot;&quot;), 0);
------- Harmony -------
java.lang.IllegalArgumentException
at java.text.RuleBasedBreakIterator.validateOffset(RuleBasedBreakIterator.java:71)
at java.text.RuleBasedBreakIterator.following(RuleBasedBreakIterator.java:61)
at org.apache.harmony.awt.text.TextUtils.getNextWord(TextUtils.java:144)
at javax.swing.text.Utilities.getNextWord(Utilities.java:49)
------- end -------
------- RI -------
javax.swing.text.BadLocationException: No more words
at javax.swing.text.Utilities.getNextWordInParagraph(Utilities.java:524)
at javax.swing.text.Utilities.getNextWord(Utilities.java:498)
------- end -------
[classlib][awt] java.awt.image.Raster.createCompatibleWritableRaster() throws unspecified IllegalArgumentException
Harmony throws unspecified IllegalArgumentException for
java.awt.image.Raster.createCompatibleWritableRaster(int w,int h)
while RI throws specified RasterFormatException.
The testcase: 
public void test_createCompatibleWritableRaster() {
MultiPixelPackedSampleModel localMultiPixelPackedSampleModel =
new MultiPixelPackedSampleModel(0, 5, 22, -1, -25, 40825);
Point localPoint = new Point();
Raster localRaster = Raster.createWritableRaster(localMultiPixelPackedSampleModel,localPoint);
try {
localRaster.createCompatibleWritableRaster(-32,8);
fail(&quot;Exception expected&quot;);
} catch (RasterFormatException expectedException) {
System.out.println(expectedException +&quot; was thrown&quot;);
} catch (IllegalArgumentException expectedException) {
fail(expectedException +&quot; was thrown&quot;);
}
}
[drlvm][kernel] j.l.ClassLoader.definePackage() is not thread-safe
There is possible data race in java.lang.ClassLoader.definePackage(): it performs check and then updates internal collections in non-atomical way, so API contract can be violated in multi-thread environment, concurrent call may result in non-unique instance returned.
[classlib][swing] javax.swing.plaf.basic.BasicArrowButton.paintTriangle() throws unexpected NPE when incorrect 'direction' parameter is passed in
Use the following code to reproduce:
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import javax.swing.plaf.basic.BasicArrowButton;
import junit.framework.TestCase;
public class Test extends TestCase {
private static final int INCORRECT_DIRECTION = 10;
public void testcase1() { 
try {
Graphics2D g2D = new BufferedImage(6, 6, BufferedImage.TYPE_INT_RGB).createGraphics();
BasicArrowButton ab = new BasicArrowButton(0);
ab.paintTriangle(g2D, 0, 0, 0, INCORRECT_DIRECTION, true);
} catch (NullPointerException e) {
fail(&quot;NPE thrown&quot;);
}
}
}
[classlib][swing] javax.swing.plaf.basic.BasicMenuBarUI.uninstallDefaults() throws unspecified NPE
Compatibility.
There is no mention of any exception in the specification.
Harmony throws unspecified NPE for uninstallDefaults() while RI does not.
Use the following code to reproduce:
import javax.swing.plaf.basic.BasicMenuBarUI;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testcase1() { 
try {
testBasicMenuBarUI menuBarUI = new testBasicMenuBarUI();
menuBarUI.uninstallDefaults();
} catch (NullPointerException e) {
fail(&quot;NPE thrown&quot;);
}
}
}
class testBasicMenuBarUI extends BasicMenuBarUI {
public void uninstallDefaults() {
super.uninstallDefaults();
}
}
[classlib][swing] javax.swing.plaf.basic.BasicMenuItemUI.uninstallUI(new JOptionPane()) throws unspecified NPE while RI throws ClassCastException
There is no mention of any exception in the specification.
Harmony throws unspecified NPE for uninstallUI(new JOptionPane()) while RI
throws ClassCastException
Use the following code to reproduce:
import javax.swing.JOptionPane;
import javax.swing.plaf.basic.BasicMenuItemUI;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testcase1() { 
try {
BasicMenuItemUI bm = new BasicMenuItemUI();
bm.uninstallUI(new JOptionPane());
} catch (NullPointerException e) {
fail(&quot;NPE thrown&quot;);
} catch (ClassCastException e) {
// expected
}
}
}
Seems like RI uses the parameter passed to this method while Harmony uses member variable menuItem within this method
[classlib][swing] javax.swing.plaf.basic.BasicProgressBarUI.getBoxLength(int, int) returns value greater than RI returns
Compatibility
According to specification for getBoxLength(int availableLength,
int otherDimension))the method &quot;returns the size of the box dimension being
determined; must be no larger than availableLength&quot;
Use the following code to reproduce:
import javax.swing.plaf.basic.BasicProgressBarUI;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testcase1() { 
testBasicProgressBarUI pb = new testBasicProgressBarUI(); 
assertEquals(0, pb.getBoxLength(0, 1)); 
} 
public void testcase2() { 
testBasicProgressBarUI pb = new testBasicProgressBarUI(); 
assertEquals(8, pb.getBoxLength(50, 1)); 
} 
}
class testBasicProgressBarUI extends BasicProgressBarUI {
public int getBoxLength(int a, int b) {
return super.getBoxLength(a, b); 
} 
}
[classlib][swing] javax.swing.plaf.basic.BasicProgressBarUI.setAnimationIndex(int newValue) throws unspecified ArithmeticException while RI throws NPE
There is no mention of any exception in the specification.
Harmony for setAnimationIndex(int newValue) protected method
throws unspecified ArithmeticException while RI throws NPE.
Compatibility issue.
Use the following code to reproduce:
import javax.swing.plaf.basic.BasicProgressBarUI;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testcase1() { 
try { 
testBasicProgressBarUI pb = new testBasicProgressBarUI(); 
pb.setAnimationIndex(5);
} catch (ArithmeticException e) { 
fail(&quot;ArithmeticException thrown&quot;);
} catch (NullPointerException e) {
// expected
}
} 
}
class testBasicProgressBarUI extends BasicProgressBarUI {
public void setAnimationIndex(int c) {
super.setAnimationIndex(c);
} 
}
[classlib][awt][compatibility] java.awt.image.RescaleOp(float[] scaleFactors, float[] offsets, RenderingHints hints) throws IllegalArgumentException if an array is empty
Specification doesn't mention any exceptions for
RescaleOp(float[] scaleFactors,float[] offsets,RenderingHints hints)
constructor.
Harmony throws IllegalArgumentException if scaleFactors or offsets is empty while RI does not.
Testcase:
import java.awt.image.*;
import junit.framework.TestCase;
import java.awt.*;
public class test extends TestCase {
public void testcase1() { 
float[] array0 = new float[] {};
float[] array1 = new float[] { 0.75F};
new RescaleOp(array1, array0, null); 
}
public void testcase2() { 
float[] array0 = new float[] {};
float[] array1 = new float[] { 0.75F};
new RescaleOp(array0, array1, null); 
} 
}
Output on RI:
..
Time: 0,016
OK (2 tests)
Output on Harmony+drlvm/j9:
.E.E
Time: 0
There were 2 errors:
1) testcase2(test)java.lang.IllegalArgumentException: The number of scale
factors should not be zero
at java.awt.image.RescaleOp.&lt;init&gt;(RescaleOp.java:47)
at test.testcase2(test.java:11)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:25)
2) testcase3(test)java.lang.IllegalArgumentException: The number of scale
factors should not be zero
at java.awt.image.RescaleOp.&lt;init&gt;(RescaleOp.java:47)
at test.testcase3(test.java:16)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:25)
FAILURES!!!
Tests run: 2, Failures: 0, Errors: 2
[classlib][swing] javax.swing.JOptionPane.getOptions() returns array of Objects on Harmony while RI returns null
javax.swing.JOptionPane.getOptions() returns array of Objects on Harmony while RI returns null
Next test case passes on RI and fails on Harmony:
------------ Test.java -------------
import junit.framework.TestCase;
import javax.swing.*;
public class Test extends TestCase { 
public void testcase1() {
JOptionPane jm = new JOptionPane();
assertEquals(null, jm.getOptions());
} 
}
--------------------------------------
[classlib][awt] java.awt.image.RescaleOp.getOffsets() throws unexpected IAE if an array has zero legth size.
There is no mention about any exception in the specification.
Harmony throws IAE for RescaleOp.getOffsets(float[] offsets) if offsets is empty array while RI returns empty array.
The same problem is for getScaleFactors(float[] scaleFactors) method.
-------------- test.java -----------------
import java.awt.image.*;
import junit.framework.TestCase;
import java.awt.*;
public class test extends TestCase {
public void testcase1() { 
RescaleOp res = new RescaleOp(new float[1],new float[2],null); 
assertEquals(res.getOffsets(new float[] {}).length, 0); 
}
public void testcase2() { 
RescaleOp res = new RescaleOp(new float[1],new float[2],null); 
assertEquals(res.getScaleFactors(new float[] {}).length, 0); 
} 
}
--------------------------------------
Output on RI
=================
..
Time: 0
OK (2 tests)
Output on Harmony_drlvm/j9:
===========================
.E.E
Time: 0
There were 2 errors:
1) testcase1(test)java.lang.ArrayIndexOutOfBoundsException
at java.lang.System.arraycopy(System.java:249)
at java.awt.image.RescaleOp.getOffsets(RescaleOp.java:92)
at test.testcase1(test.java:8)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:25)
2) testcase2(test)java.lang.ArrayIndexOutOfBoundsException
at java.lang.System.arraycopy(System.java:249)
at java.awt.image.RescaleOp.getScaleFactors(RescaleOp.java:83)
at test.testcase2(test.java:12)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:25)
FAILURES!!!
Tests run: 2, Failures: 0, Errors: 2
This issue can be treated as non-bug difference, because it is unclear what is the appropriate result if sizes of given array and sizes of offsets and scaleFactors arrays in RescaleOp object are different. Otherwise, to be compatible with RI I can suggest to use min between argument array and RescaleOp object's array length as length param in j.l.System.arraycopy() call.
[classlib][awt] java.awt.BufferCapabilities.isMultiBufferAvailable() returns true on Harmony while it returns false on RI
java.awt.BufferCapabilities.isMultiBufferAvailable() returns true on Harmony while it returns false on RI. 
Next test case passes on RI and fails on Harmony: 
-------------- test.java --------------- 
import java.awt.BufferCapabilities; 
import java.awt.ImageCapabilities; 
import junit.framework.TestCase; 
import junit.textui.TestRunner; 
public class test extends TestCase { 
public static void main(String args[]) { 
TestRunner.run(test.class); 
} 
public void testRun() { 
BufferCapabilities bfc = new BufferCapabilities(
new ImageCapabilities(false),
new ImageCapabilities(false),
null);
assertFalse(bfc.isMultiBufferAvailable());
} 
} 
------------------------------------------
[classlib][awt] java.awt.BufferCapabilities.isFullScreenRequired() returns true on Harmony while it returns false on RI
java.awt.BufferCapabilities.isFullScreenRequired() returns true on Harmony while it returns false on RI.
Next test case passes on RI and fails on Harmony:
-------------- test.java ---------------
import java.awt.BufferCapabilities;
import java.awt.ImageCapabilities;
import junit.framework.TestCase;
import junit.textui.TestRunner;
public class test extends TestCase {
public static void main(String args[]) {
TestRunner.run(test.class);
}
public void testRun() {
BufferCapabilities bfc = new BufferCapabilities(
new ImageCapabilities(false),
new ImageCapabilities(false),
null);
assertFalse(bfc.isFullScreenRequired());
}
}
------------------------------------------
[classlib][security]AlgorithmParameters fails to getInstance from &quot;OAEP&quot;
Here is a testcase:
public void test_algorithmParameters_getInstance() throws Exception
{
assertNotNull(AlgorithmParameters.getInstance(&quot;OAEP&quot;));
}
RI passes.
Harmony fails.
It seems that there is no org.bouncycastle.jce.provider.JDKAlgorithmParameters$OAEP.class, but another three classes seeming related:
RSAESOAEPparams.class, OAEPEncoding.class and JCERSACipher$OAEPPadding.class.
[classlib][swing] javax.swing.plaf.basic.BasicProgressBarUI.startAnimationTimer() throws unspecified NPE while RI does not
Harmony for startAnimationTimer/stopAnimationTimer() protected methods
throws unspecified NPE while RI does not.
Use the following code to reproduce:
import javax.swing.plaf.basic.BasicProgressBarUI;
import junit.framework.TestCase;
public class Test extends TestCase { 
public void testcase1() { 
try {
testBasicProgressBarUI pb = new testBasicProgressBarUI();
pb.startAnimationTimer();
} catch (NullPointerException e) { 
fail(&quot;NPE thrown&quot;);
}
}
public void testcase2() { 
try { 
testBasicProgressBarUI pb = new testBasicProgressBarUI();
pb.stopAnimationTimer();
} catch (NullPointerException e) { 
fail(&quot;NPE thrown&quot;);
}
} 
}
class testBasicProgressBarUI extends BasicProgressBarUI {
public void startAnimationTimer() {
super.startAnimationTimer(); 
}
public void stopAnimationTimer() {
super.stopAnimationTimer(); 
} 
}
[classlib][swing] javax.swing.plaf.metal.BasicInternalFrameTitlePane(null) doesn't throw unspecified NPE while RI does
There is no mention of any exception in the specification.
Harmony does not throw unspecified NPE for MetalInternalFrameTitlePane(null)
while RI does.
Use the following code to reproduce:
import javax.swing.JInternalFrame;
import javax.swing.plaf.basic.BasicInternalFrameTitlePane;
import junit.framework.TestCase;
public class Test extends TestCase { 
public static void main(String[] args) { 
try { 
new BasicInternalFrameTitlePane((JInternalFrame) null); 
} catch (Exception e) { 
e.printStackTrace();
} 
} 
}
Inconsistency is that in Harmony's implementation of this constructor 
installTitlePane() is not called when null parameter is passed in
[classlib][swing] javax.swing.plaf.basic.BasicDesktopIconUI.getInsets(null) returns valid result while RI throws NPE
javax.swing.plaf.basic.BasicDesktopIconUI.getInsets(null) returns valid result
while RI throws NPE.
for reproducing:
import junit.framework.TestCase;
import javax.swing.plaf.basic.*;
public class Test extends TestCase { 
public void testcase1() {
BasicDesktopIconUI b = new BasicDesktopIconUI();
try {
b.getInsets(null);
fail(&quot;NPE should be thrown&quot;);
} catch ( NullPointerException e) { 
//expected
}
}
}
[classlib][swing][plaf] javax.swing.plaf.basic.BasicSplitPaneUI.getDividerLocation(null) doesn't throw unspecified NPE
Compatibility issue.
javax.swing.plaf.basic.BasicSplitPaneUI.getDividerLocation(null) throws NPE in RI but works silently in Harmony
Code to reproduce:
import javax.swing.plaf.*;
import javax.swing.plaf.basic.*;
public class Test {
public static void main(String[] argv) {
BasicSplitPaneUI localBasicSplitPaneUI = new BasicSplitPaneUI();
localBasicSplitPaneUI.getDividerLocation(null);
}
}
Output in RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
Exception in thread &quot;main&quot; java.lang.NullPointerException
at javax.swing.plaf.basic.BasicSplitPaneUI.getDividerLocation(Unknown So
urce)
at Test.main(Test.java:8)
Output in Harmony:
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r486529, (Dec 13 2006), Windows/ia32/msvc 1310, debug build
http://incubator.apache.org/harmony
[classlib][swing][plaf] javax.swing.plaf.basic.BasicListUI.locationToIndex(.., null) doesn't throw unspecified NPE
Compatibility ussue. 
javax.swing.plaf.basic.BasicListUI.locationToIndex(JList, null) doesn't throw unspecified NPE while RI does
Code to reproduce:
import javax.swing.plaf.*;
import javax.swing.plaf.basic.*;
import javax.swing.*;
public class Test {
public static void main(String[] argv) {
BasicListUI localBasicListUI = new BasicListUI();
JList localJList = new JList();
localBasicListUI.locationToIndex(localJList, null);
}
}
Output in RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
Exception in thread &quot;main&quot; java.lang.NullPointerException
at javax.swing.plaf.basic.BasicListUI.updateLayoutState(Unknown Source)
at javax.swing.plaf.basic.BasicListUI.maybeUpdateLayoutState(Unknown Sou
rce)
at javax.swing.plaf.basic.BasicListUI.locationToIndex(Unknown Source)
at Test.main(Test.java:11)
Output in Harmony:
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r485537, (Dec 11 2006), Windows/ia32/msvc 1310, debug build
http://incubator.apache.org/harmony
[classlib][swing] javax.swing.plaf.basic.BasicPopupMenuUI.installKeyboardActions() throws unspecified NPE
Harmony throws unspecified NullPointerException for javax.swing.plaf.basic.BasicPopupMenuUI.installKeyboardActions() RI while works silently.
Use the following code to reproduce:
import javax.swing.plaf.basic.BasicPopupMenuUI;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testcase1() {
BPMUI localBasicPopupMenuUI = new BPMUI();
try {
localBasicPopupMenuUI.iinstallKeyboardActions();
} catch (NullPointerException expectedException) { 
fail(&quot;NPE&quot;);
}
}
}
class BPMUI extends BasicPopupMenuUI {
public void iinstallKeyboardActions () {
installKeyboardActions();
}
}
[classlib][swing] javax.swing.plaf.basic.BasicComboBoxEditor.getItem() is inconsistent with RI
Use the code attached to reproduce the inconcistencies
[classlib][swing] javax.swing.plaf.basic.BasicComboBoxRenderer.getHorizontalAlignment() returns LEFT while RI returns LEADING
javax.swing.plaf.basic.BasicComboBoxRenderer.getHorizontalAlignment() returns SwingConstants.LEFT
while RI returns SwingConstants.LEADING.
Compatibility issue.
Use the following code to reproduce:
import javax.swing.SwingConstants;
import javax.swing.plaf.basic.BasicComboBoxRenderer;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testcase1() {
BasicComboBoxRenderer m = new BasicComboBoxRenderer();
assertEquals(SwingConstants.LEADING, m.getHorizontalAlignment());
}
}
[classlib][swing] javax.swing.plaf.basic.BasicButtonListener.propertyChange(null) does not throw unspecified NPE
javax.swing.plaf.basic.BasicButtonListener.propertyChange(null) does not throw
unspecified NPE while RI does.
Trere is no mention of any exception in the specification.
Compatibility issue.
Use the following code to reproduce:
import junit.framework.TestCase;
import javax.swing.*;
import javax.swing.plaf.basic.BasicButtonListener;
public class Test extends TestCase { 
public void testcase1() {
BasicButtonListener m = new BasicButtonListener(new JButton());
try {
m.propertyChange(null);
fail(&quot;NPE should be thrown&quot;);
} catch ( NullPointerException e) { 
//expected
}
}
}
[classlib][swing] javax.swing.plaf.basic.BasicLabelUI.uninstallDefaults(JLabel label) throws NPE while RI doesn't
javax.swing.plaf.basic.BasicLabelUI.uninstallDefaults(null) throws unspecified NPE while RI doesn't
Use the following code to reproduce:
import javax.swing.JLabel;
import javax.swing.plaf.basic.BasicLabelUI;
import junit.framework.TestCase;
class testBasicLabelUI extends BasicLabelUI {
public testBasicLabelUI(){
super();
}
public void uninstallDefaults(JLabel l) {
super.uninstallDefaults(l);
}
}
public class Test extends TestCase {
public void testcase1() {
testBasicLabelUI bu = new testBasicLabelUI();
try {
bu.uninstallDefaults(null);
} catch (NullPointerException e) {
fail(&quot;NPE thrown&quot;);
}
}
}
[classlib][swing] javax.swing.plaf.basic.BasicSeparatorUI.uninstallDefaults(JSeparator s) throws NPE while RI doesn't
Harmony throws unspecified NPE for javax.swing.plaf.basic.BasicSeparatorUI.uninstallDefaults(null) while RI works silently.
Use the following code to reproduce:
import javax.swing.JSeparator;
import javax.swing.plaf.basic.BasicSeparatorUI;
import junit.framework.TestCase;
class BSPUI extends BasicSeparatorUI
{
public int testt(JSeparator s){
uninstallDefaults(s);
return 1;
}
}
public class Test extends TestCase {
public void testcase0(){ 
BSPUI localBasicSeparatorUI = new BSPUI();
try {
localBasicSeparatorUI.testt(null);
System.out.println(&quot;works silently&quot;);
assertEquals(true, true);
} catch (NullPointerException e) {
e.printStackTrace();
fail(&quot;Unspecified exception thrown:&quot; + e);
}
}
}
[classlib][swing] javax.swing.plaf.basic.BasicArrowButton.getBackground() returns wrong value
getBackground() method on RI returns the same value that was passed to the constructor as a &quot;background&quot; parameter:
BasicArrowButton(int direction,
Color background,
Color shadow,
Color darkShadow,
Color highlight)
Harmony returns a different value.
Use the following code to reproduce:
import java.awt.Color;
import javax.swing.plaf.basic.BasicArrowButton;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testcase1() {
final Color c = Color.red;
BasicArrowButton b = new BasicArrowButton(240, c, c, c, c); 
System.out.println(&quot;parameter background == &quot; + c);
System.out.println(&quot;getBackground()==&quot; + b.getBackground()); 
assertSame(c, b.getBackground());
}
}
[classlib][swing] JSplitPane.add(null) does not throw unspecified NPE
javax.swing.JSplitPane.add(null) does not throw unspecified NPE while RI does.
Trere is no mention of any exception in the specification.
Compatibility issue.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.*;
import java.awt.Component;
public class Test extends TestCase { 
public void testcase1() {
JSplitPane s = new JSplitPane();
try {
s.add(null);
fail(&quot;NPE should be thrown&quot;);
} catch ( NullPointerException e) { 
//expected
}
} 
}
Output on Sun 1.5
=================
.
Time: 0.328
OK (1 test)
Output on Harmony:
==================
.F
Time: 0.921
There was 1 failure:
1) testcase1(Test)junit.framework.AssertionFailedError: NPE should be thrown
at Test.testcase1(Test.java:11)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
[classlib][swing] JTextField.getScrollOffset() returns 5 while RI returns 0
javax.swing.JTextField.getScrollOffset() returns 5 while RI returns 0.
Compatibility issue.
Code for reproducing:
import junit.framework.TestCase;
import javax.swing.*;
public class Test extends TestCase { 
public void testcase1() {
JTextField s = new JTextField();
assertEquals(0, s.getScrollOffset());
}
}
Output on Sun 1.5
=================
.
Time: 0.391
OK (1 test)
Output on Harmony:
==================
.F
Time: 1.953
There was 1 failure:
1) testcase1(Test)junit.framework.AssertionFailedError: expected:&lt;0&gt; but
was:&lt;5&gt;
at Test.testcase1(Test.java:7)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
[classlib][swing] javax.swing.JMenuBar.getMenu(int) does not throw unspecified ArrayIndexOutOfBoundsException
Test case:
-------------
import javax.swing.JMenuBar;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
JMenuBar jm = new JMenuBar();
try {
jm.getMenu(0);
fail(&quot;ArrayIndexOutOfBoundsException expected&quot;);
} catch ( ArrayIndexOutOfBoundsException e) { 
}
}
}
[classlib][swing] JScrollBar() throw unspecified NPE instead of IAE
According to J2SE API 5.0 specifications of javax.swing.JScrollBar(int,int,int,int,int) constructor: 
&quot;Throws: IllegalArgumentException - if orientation is not one of VERTICAL, HORIZONTAL&quot;.
Harmony throws NPE while RI throws IllegalArgumentException.
JScrollBar() throw unspecified NPE instead of IllegalArgumentException.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.*;
public class Test extends TestCase { 
public void testcase1() {
try {
new JScrollBar(2000, 512, 128, 16, 10001);
fail(&quot;IllegalArgumentException should be thrown&quot;);
} catch ( IllegalArgumentException e) { 
//expected
}
} 
}
Output on Sun 1.5
=================
.
Time: 0.015
OK (1 test)
Output on Harmony:
==================
.E
Time: 0.609
There was 1 error:
1) testcase1(Test)java.lang.NullPointerException
at
javax.swing.plaf.basic.BasicScrollBarUI.installComponents(BasicScrollBarUI.java:356)
at
javax.swing.plaf.basic.BasicScrollBarUI.installUI(BasicScrollBarUI.java:419)
at javax.swing.JComponent.setUI(JComponent.java:1211)
at javax.swing.JScrollBar.setUI(JScrollBar.java:138)
at javax.swing.JScrollBar.updateUI(JScrollBar.java:146)
at javax.swing.JScrollBar.&lt;init&gt;(JScrollBar.java:134)
at Test.testcase1(Test.java:7)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
[classlib][swing] Compatibility: javax.swing.JMenuBar.processKeyBinding() for incorrect parameterds throws NPE on Harmony instead of IllegalArgumentException on RI
Method javax.swing.JMenuBar.processKeyBinding(KeyStroke ks, KeyEvent e, int condition, boolean pressed) with params set (e ==null) &amp;&amp; !(condition == JComponent.WHEN_IN_FOCUSED_WINDOW || JComponent.WHEN_FOCUSED || Component.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT) throws NPE on Harmony while IllegalArgumentException is thrown on RI. 
Spec keeps silence about any exception for this method.
Test to reproduce:
---------------test.java---------------
import java.awt.event.KeyEvent;
import javax.swing.JMenuBar;
import javax.swing.KeyStroke;
import junit.framework.TestCase;
import junit.textui.TestRunner;
public class test extends TestCase {
public static void main(String args[]) {
TestRunner.run(test.class);
}
private class MyJMenuBar extends JMenuBar {
public boolean processKeyBinding(KeyStroke ks, KeyEvent e,
int condition, boolean pressed) {
return super.processKeyBinding(ks, e, condition, pressed);
}
}
public void testNullEvent() {
MyJMenuBar jm = new MyJMenuBar();
KeyStroke ks = (KeyStroke) KeyStroke.getKeyStroke('x');
try {
System.out.println(&quot;pass: result = &quot;
+ jm.processKeyBinding(ks, null, -1, true));
fail(&quot;IllegalArgumentException expected but wasn't thrown!&quot;);
} catch (IllegalArgumentException e) {
// expected exception
}
}
}
------------------------------
Output RI:
========
.
Time: 1,172
OK (1 test)
Output Harmony:
==============
.E
Time: 2.173
There was 1 error:
1) testNullEvent(test)java.lang.NullPointerException
at javax.swing.JMenuBar.processKeyBinding(JMenuBar.java:191)
at test$MyJMenuBar.processKeyBinding(test.java)
at test.testNullEvent(test.java:26)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at test.main(test.java:12)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
I would like to add: in case, when condition is one of the appropriate values and event is null - RI works silently and Harmony throws NPE. But combination of incorrect params that was shown in the head should be taken into account to be compatible in order of thrown exceptions.
[classlib][swing] DefaultBoundedRangeModel(Integer.MAX_VALUE,1,2,4) expected IAE
According to the specification for DefaultBoundedRangeModel(int value,int extent,int min,int max) constructor must throw an IllegalArgumentException if the following constraints aren't satisfied: min &lt;= value &lt;= value+extent &lt;= max
Harmony does not throw an exception for test listed below while RI does.
import javax.swing.*;
public class test {
public static void main(String[] args { 
new DefaultBoundedRangeModel(Integer.MAX_VALUE,1,2,4); 
} 
}
Output on RI:
java.lang.IllegalArgumentException: invalid range properties
at
javax.swing.DefaultBoundedRangeModel.&lt;init&gt;(DefaultBoundedRangeModel.java:85)
at test.main(test.java:16)
Output on Harmony:
(no output)
[classlib][swing] javax.swing.MenuSelectionManager.processMouseEvent(null) does not throw unspecified NPE
Test case:
--------------
import javax.swing.MenuSelectionManager;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
MenuSelectionManager m = new MenuSelectionManager();
try {
m.processMouseEvent(null);
fail(&quot;NPE expected&quot;);
} catch (NullPointerException e) {
}
}
}
[classlib][swing] javax.swing.LayoutFocusTraversalPolicy.getComponentAfter() throws NPE instead of IllegalArgumentException
Test case:
--------------
import javax.swing.JButton;
import javax.swing.LayoutFocusTraversalPolicy;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
LayoutFocusTraversalPolicy p = new LayoutFocusTraversalPolicy();
try {
p.getComponentAfter(null, new JButton());
fail(&quot;IllegalArgumentException expected&quot;);
} catch (IllegalArgumentException e) {
}
}
}
Harmony output:
-------------------
.E
Time: 0.932
There was 1 error:
1) testcase1(TheTest)java.lang.NullPointerException
at javax.swing.LayoutFocusTraversalPolicy.getComponentAfter(LayoutFocusTraversalPolicy.java:48)
at TheTest.testcase1(TheTest.java:15)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:9)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
[classlib][swing] j.s.undo.UndoManager.redoTo doesn't throw ArrayIndexOutOfBoundsException
javax.swing.undo.UndoManager.redoTo(edit) does not throw ArrayIndexOutOfBoundsException where edit is not found in the list of UndoableEdits, whereas RI throws the exception in this case.
[classlib][swing] javax.swing.plaf.basic.BasicInternalFrameTitlePane.MoveAction has inconsistencies with RI
1. javax.swing.plaf.basic.BasicInternalFrameTitlePane.MoveAction.getKeys() 
returns array that contains Action.NAME key.
2. javax.swing.plaf.basic.BasicInternalFrameTitlePane.MoveAction.actionPerformed(null)
throws unspecified NPE while RI does not.
The code to reproduce this bug is to be attached
[classlib][swing] javax.swing.plaf.basic.BasicInternalFrameTitlePane.SizeAction.actionPerformed(null) throws NPE
javax.swing.plaf.basic.BasicInternalFrameTitlePane.SizeAction.actionPerformed(null)
throws unspecified NPE while RI does not.
Here's the code to reproduce:
import javax.swing.JInternalFrame;
import javax.swing.plaf.basic.BasicInternalFrameTitlePane;
import javax.swing.plaf.metal.MetalInternalFrameTitlePane;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testcase1() {
String str = &quot;test string&quot;;
JInternalFrame jf = new JInternalFrame(str);
MetalInternalFrameTitlePane jp = new MetalInternalFrameTitlePane(jf);
BasicInternalFrameTitlePane.SizeAction m = jp.new SizeAction();
try {
m.actionPerformed(null);
} catch (NullPointerException e) {
fail(&quot;NPE shouldn't be thrown&quot;);
}
}
}
[classlib][swing] j.s.undo.CompoundEdit.getPresentationName throws NPE
Code to reproduce:
import java.util.Hashtable;
import javax.swing.undo.CompoundEdit;
import javax.swing.undo.StateEdit;
import javax.swing.undo.StateEditable;
public class Test {
private static StateEdit getStateEdit() {
return new StateEdit(new StateEditable() {
public void storeState(Hashtable arg0) {
}
public void restoreState(Hashtable arg0) {
}
});
}
public static void main(String[] args) {
CompoundEdit ce = new CompoundEdit();
ce.addEdit(getStateEdit());
try {
System.err.println(&quot;'&quot; + ce.getPresentationName() + &quot;'&quot;);
System.err.println(ce.getPresentationName() == null);
} catch (Exception e) {
e.printStackTrace();
}
}
}
------ end of code ------
=== Harmony output ===
java.lang.NullPointerException
at javax.swing.undo.CompoundEdit.getPresentationName(CompoundEdit.java:111)
at Test.main(Test.java:22)
===================
=== RI output ===
'null'
true
=============
[classlib][awt] java.awt.image.ConvolveOp.filter(Raster ,WritableRaster) throws NegativeArraySizeException while RI throws ImagingOpException
In some cases ConvolveOp.filter throws NegativeArraySizeException on Harmony, while RI throws ImagingOpException. See the attached testcase, which passes on RI and fails on Harmony.
[classlib][swing] javax.swing.JLayeredPane.setPosition(null, int) does not throw unspecified NPE
Test case:
--------------
import javax.swing.JLayeredPane;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
try {
JLayeredPane lp = new JLayeredPane();
lp.setPosition(null, 20);
fail(&quot;NPE expected&quot;);
} catch ( NullPointerException e) { 
}
}
}
[classlib][swing] javax.swing.JInternalFrame.JDesktopIcon.getDesktopPane() throws NPE
Test case:
--------------
import javax.swing.JInternalFrame;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
JInternalFrame jf = new JInternalFrame();
JInternalFrame.JDesktopIcon fc = new JInternalFrame.JDesktopIcon(jf);
fc.setInternalFrame(null);
assertNull(fc.getDesktopPane());
}
}
[classlib][awt] java.awt.Graphics2D.drawLine throws NPE if color is set to null
java.awt.Graphics2D.drawLine throws NPE if color is set to null while RI doesn't
here's the code to reproduce:
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testcase1() {
Graphics2D g = new BufferedImage(56, 56,
BufferedImage.TYPE_INT_RGB).createGraphics(); 
g.setColor(null);
try {
g.drawLine(0, 0, 10, 10);
} catch (NullPointerException e) {
fail(&quot;NullPointerException is thrown&quot;);
}
}
}
[classlib][swing] javax.swing.plaf.basic.BasicSliderUI.ActionScroller.isEnabled() returns false while RI returns true
javax.swing.plaf.basic.BasicSliderUI.ActionScroller.isEnabled() returns false
while RI returns true.
Compatibility issue.
Use the following code to reproduce: 
import javax.swing.JSlider;
import javax.swing.plaf.basic.BasicSliderUI;
import junit.framework.TestCase;
public class Test extends TestCase { 
public void testcase1() {
BasicSliderUI jp = new BasicSliderUI(new JSlider());
BasicSliderUI.ActionScroller m = jp.new ActionScroller(new JSlider(),
3, true);
assertTrue(m.isEnabled());
}
}
[classlib][swing] javax.swing.plaf.basic.BasicInternalFrameTitlePane.SizeAction.getKeys() returns empty array
javax.swing.plaf.basic.BasicInternalFrameTitlePane.SizeAction.getKeys() 
returns empty array while RI returns valid result containing the key Action.Name.
Here's the code to reproduce:
import junit.framework.TestCase;
import javax.swing.plaf.metal.MetalInternalFrameTitlePane;
import javax.swing.plaf.basic.BasicInternalFrameTitlePane;
import javax.swing.JInternalFrame;
import javax.swing.Action;
public class Test extends TestCase { 
public void testcase1() {
String str = &quot;test string&quot;;
JInternalFrame jf = new JInternalFrame(str);
MetalInternalFrameTitlePane jp = new MetalInternalFrameTitlePane(jf);
BasicInternalFrameTitlePane.SizeAction m = jp.new SizeAction();
assertEquals(1, m.getKeys().length);
String key = (String)m.getKeys()[0];
assertEquals(Action.NAME, key);
assertEquals(&quot;Size&quot;, m.getValue(key));
}
}
[classlib][swing] javax.swing.JFileChooser(File, null) throws unspecified NPE while RI does not
Test case:
--------------
import java.io.File;
import javax.swing.JFileChooser;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
new JFileChooser(new File(&quot;a&quot;), null);
}
}
[classlib][swing] javax.swing.Box.createRigidArea(null) throws NPE
javax.swing.Box.createRigidArea(null) throws unspecified NPE while RI does not.
Code to reproduce:
import javax.swing.*;
public class Test 
{ 
public static void main(String args[]) { 
Box.createRigidArea(null);
System.out.println(&quot;PASSED&quot;);
} 
}
Output in RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
PASSED
Output in Harmony:
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r485537, (Dec 11 2006), Windows/ia32/msvc 1310, debug build
http://incubator.apache.org/harmony
Uncaught exception in main:
java.lang.NullPointerException
at java.awt.Dimension.&lt;init&gt;(Dimension.java)
at javax.swing.Box.createRigidArea(Box.java:124)
at Test.main(Test.java)
[classlib][swing] javax.swing.JEditorPane.setEditorKitForContentType() does not throw unspecified NPE
Test case:
---------------
import javax.swing.JEditorPane;
import javax.swing.text.DefaultEditorKit;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
try {
JEditorPane ep = new JEditorPane();
ep.setEditorKitForContentType(&quot;abc&quot;, null);
fail(&quot;NPE expected&quot;);
} catch (NullPointerException e) {
}
}
public void testcase2() {
try {
JEditorPane ep = new JEditorPane();
ep.setEditorKitForContentType(null, new DefaultEditorKit());
fail(&quot;NPE expected&quot;);
} catch (NullPointerException e) {
}
}
public void testcase3() {
try {
JEditorPane ep = new JEditorPane();
ep.setEditorKitForContentType(null, null);
fail(&quot;NPE expected&quot;);
} catch (NullPointerException e) {
}
}
}
[classlib][swing] javax.swing.JComponent.paintImmediately(null) does not throw unspecified NPE
Compatibility issue.
javax.swing.JComponent.paintImmediately(null) does not throw unspecified NPE.
No exceptions are mentioned in the spec.
Code to reproduce:
import javax.swing.*;
public class Test 
{ 
public static void main(String args[]) { 
new JComponent(){}.paintImmediately(null);
System.out.println(&quot;PASSED&quot;);
} 
}
Output in RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
Exception in thread &quot;main&quot; java.lang.NullPointerException
at javax.swing.JComponent.paintImmediately(Unknown Source)
at Test.main(Test.java:6)
Output in Harmony:
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r485537, (Dec 11 2006), Windows/ia32/msvc 1310, debug build
http://incubator.apache.org/harmony
PASSED
[classlib][swing] javax.swing.JEditorPane.setContentType(null) does not throw NPE
Test case:
----------------
import javax.swing.JEditorPane;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
try {
JEditorPane ep = new JEditorPane();
ep.setContentType(null);
fail(&quot;NPE expected&quot;);
} catch (NullPointerException e) {
}
}
}
[classlib][swing] javax.swing.JEditorPane.registerEditorKitForContentType(null, null) does not throw unspecified NPE
Test case:
--------------
import javax.swing.JEditorPane;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
try {
JEditorPane.registerEditorKitForContentType(null, null);
fail(&quot;NPE expected&quot;);
} catch (NullPointerException e) {
}
}
}
[classlib][swing] j.s.text.GapContent.getChars throws NPE rather than BadLocationException
Consider the following code:
import javax.swing.text.GapContent;
public class Test {
public static void main(String[] args) {
GapContent content = new GapContent();
try {
content.getChars(1, Integer.MAX_VALUE, null);
} catch (Exception e) {
e.printStackTrace();
} 
}
}
------------ end of code ------------
Running this application on Harmony produces the output:
java.lang.NullPointerException
at javax.swing.text.GapContent.getChars(GapContent.java:152)
at Test.main(Test.java:7)
------------ end of Harmony output ------------
Whereas RI throws BadLocationException:
javax.swing.text.BadLocationException: Invalid location
at javax.swing.text.GapContent.getChars(GapContent.java:169)
at Test.main(Test.java:7)
------------ end of RI output ------------
[classlib][swing]javax.swing.text.GapContent.getString() throws different exceptions on Harmony and RI
Harmony throws unspecified StringIndexOutOfBoundsException for javax.swing.text.GapContent.getString(int where,int len) while Ri throws
specified BadLocationException. Check output of the test case test.java.
-------------- test.java -------------
import javax.swing.text.BadLocationException;
import javax.swing.text.GapContent;
public class test {
public static void main(String args[]) {
try {
GapContent localGapContent = new GapContent();
localGapContent.getString(3, Integer.MAX_VALUE);
} catch (BadLocationException unexpectedException) {
unexpectedException.printStackTrace();
}
}
}
---------------------------------------------
Output Harmony:
=============
Uncaught exception in main:
java.lang.StringIndexOutOfBoundsException
at java.lang.String.&lt;init&gt;(String.java:456)
at javax.swing.text.Segment.toString(Segment.java:145)
at javax.swing.text.GapContent.getString(GapContent.java:185)
at test.main(test.java:7)
Output RI:
========
javax.swing.text.BadLocationException: Invalid location
at javax.swing.text.GapContent.getChars(GapContent.java:169)
at javax.swing.text.GapContent.getString(GapContent.java:150)
at test.main(test.java:8)
[classlib][swing] javax.swing.DebugGraphics() throws NPE
javax.swing.DebugGraphics() throws NPE but spec says:
Constructs a new debug graphics context that supports slowed down drawing. 
Test case to reproduce:
import javax.swing.*;
public class Test 
{ 
public static void main(String args[]) { 
new DebugGraphics();
System.out.println(&quot;PASSED&quot;);
} 
}
Output in RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
PASSED
C:\temp\tests&gt;anced\drlvm\trunk\build\deploy\jdk\jre\bin\java -showversion Test
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r483966, (Dec 8 2006), Windows/ia32/msvc 1310, debug build
http://incubator.apache.org/harmony
Uncaught exception in main:
java.lang.NullPointerException
at javax.swing.DebugGraphics.&lt;init&gt;(DebugGraphics.java:170)
at javax.swing.DebugGraphics.&lt;init&gt;(DebugGraphics.java)
at Test.main(Test.java:5)
[classlib][swing] javax.swing.JComponent.putClientProperty(null, Object) does not throw unspecified NPE
javax.swing.JComponent.putClientProperty(null, Object) does not throw
unspecified NPE.
There is no mention of any exceptions in the specificarion.
Compatibility issue.
Test for reprodicing:
import javax.swing.*;
public class Test { 
public static void main(String args[]) { 
JComponent jc = new JComponent() {};
jc.putClientProperty(null, new Object());
System.out.println(&quot;PASSED&quot;);
} 
}
Output in RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
Exception in thread &quot;main&quot; java.lang.NullPointerException
at javax.swing.JComponent.putClientProperty(Unknown Source)
at Test.main(Test.java:5)
Output in Harmony:
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r483966, (Dec 8 2006), Windows/ia32/msvc 1310, debug build
http://incubator.apache.org/harmony
PASSED
[classlib][awt] PointerPointer's methods set/get, set/getAddress don't use pointer size.
The following methods of org.apache.harmony.awt.nativebridge.PointerPointer
don't multiply index to elemnt size PP_SIZE_FACTOR: set(int, VoidPointer),
get(int), setAddress(int, long), getAddress(int).
Here's a small testcase:
import org.apache.harmony.awt.nativebridge.NativeBridge;
import org.apache.harmony.awt.nativebridge.PointerPointer;
public class PointerPointerTest {
public static void main(String[] args) {
PointerPointer p = NativeBridge.getInstance().createPointerPointer(2, false);
p.setAddress(0, 0xFFFFFFFF);
System.out.println(&quot;*(p+1) = &quot; + Long.toHexString(p.getAddress(1)) + &quot; should be 0&quot;);
}
}
[classlib][swing] javax.swing.undo.StateEdit(null) does not throw NPE while RI does
There is no mention of any exception in the specification.RI throws NPE for StateEdit(null) and StateEdit(null, &quot;str&quot;) while Harmony does not.
import javax.swing.undo.*;
public class test { 
public static void main(String[] args) { 
try { 
StateEdit localStateEdit = new StateEdit(null);
System.out.println(&quot;Test1 failed&quot;); 
} catch (NullPointerException e){ 
System.out.println(&quot;Test1 passed&quot;); 
} catch (Throwable t){ 
t.printStackTrace();
}
try { 
StateEdit localStateEdit = new StateEdit(null,&quot;str&quot;);
System.out.println(&quot;Test2 failed&quot;); 
} catch (NullPointerException e){ 
System.out.println(&quot;Test2 passed&quot;); 
} catch (Throwable t){ 
t.printStackTrace();
} 
} 
}
Harmony output:
Test1 failed
Test2 failed
RI output:
Test1 passed
Test2 passed
[classlib][awt]Component.paint method should check if passed parameter in null
RI implementations of paint methods checks if passed Graphics parameter is null. I've found several bugs[1] in Sun's database indicating activity on adding check to paint methods. In most of the real cases null value was passed because the component was clipped or invisible(and it seems to be OK).
[1] http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4036712
http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4191142
Attached test passes on RI and throws NPE on harmony implementation.
RI
java test
true
true
true
true
true
true
Harmony:
false
java.lang.NullPointerException
at java.awt.Container.paintComponentsImpl(Container.java)
at java.awt.Container.paint(Container.java:930)
at test.testPaint(test.java:58)
at test.main(test.java:119)
false
java.lang.NullPointerException
at java.awt.Container.paintComponentsImpl(Container.java)
at java.awt.Container.paintComponents(Container.java:977)
at test.testPaintComponents(test.java:70)
at test.main(test.java:122)
false
java.lang.NullPointerException
at java.awt.Container.paintComponentsImpl(Container.java)
at java.awt.Container.paint(Container.java:930)
at java.awt.Container.print(Container.java:318)
at test.testPrint(test.java:82)
at test.main(test.java:123)
false
java.lang.NullPointerException
at java.awt.Container.paintComponentsImpl(Container.java)
at java.awt.Container.paintComponents(Container.java:977)
at java.awt.Container.printComponents(Container.java:968)
at test.testPrintComponents(test.java:94)
at test.main(test.java:124)
false
java.lang.NullPointerException
at java.awt.Container.paintComponentsImpl(Container.java)
at java.awt.Container.paint(Container.java:930)
at java.awt.Component.update(Component.java:3447)
at java.awt.Container.update(Container.java:339)
at test.testUpdate(test.java:106)
at test.main(test.java:125)
false
[classlib][beans] Harmony implementation of PropertyChangeSupport.hasListeners() differs from RI's
It seems there is a bug in RI implementation of the java.beans.propertyChangeSupport.hasListeners() method. It works incorrectly if PropertyChangeListenerProxy was added instead of the regular PropertyChangeListener. RI cannot find such listeners with hasListeners(). However, the getPropertyChangeListeners() returns correct value. Please see the test case below:
---I
import java.beans.*;
public class TestPropertyChangeListener {
public static class MyBean {
public int getProp1() {
return 1;
}
public void setProp1(int val) {}
}
public static class MyListener implements PropertyChangeListener {
public void propertyChange(PropertyChangeEvent evt) {}
}
public static void main(String argv[]) {
MyBean source = new MyBean();
final String prop = &quot;prop1&quot;;
PropertyChangeListener l1 = new MyListener();
PropertyChangeListener l2 = new PropertyChangeListenerProxy(prop, new MyListener());
PropertyChangeSupport sup;
sup = new PropertyChangeSupport(source);
sup.addPropertyChangeListener(prop, l1);
System.out.println(&quot;Total listeners: &quot; + sup.getPropertyChangeListeners(prop).length);
if (!sup.hasListeners(prop)) {
System.out.println(&quot;FAIL at point 1&quot;);
}
sup = new PropertyChangeSupport(source);
sup.addPropertyChangeListener(prop, l2);
System.out.println(&quot;Total listeners: &quot; + sup.getPropertyChangeListeners(prop).length);
if (!sup.hasListeners(prop)) {
System.out.println(&quot;FAIL at point 2&quot;);
}
}
}
---
The output on RI is:
Total listeners: 1
Total listeners: 1
FAIL at point 2
Such a behavior is inconsistent and against the spec for PropertyChangeSupport class. Harmony implementation does not follow it. This test passes on Harmony.
[classlib][jndi] javax.naming.CompoundName add(String), add(int, String) methods should follow exception throwing compatibility
The behaviour of add(String), add(int, String) methods where String parameter is null is not explicitly specified.
It is only said in the specification that String parameter have to be non-null.
1) add(null)
RI: no exceptions are thrown
Harmony: InvalidNameException is thrown
2) add(int, null)
RI: no exceptions are thrown or IndexOutOfBoundsException is thrown
Harmony: InvalidNameException is thrown
The following test reproduces the problem:
import junit.framework.TestCase;
import java.util.*;
import javax.naming.*;
public class ExceptionCompatibilityTest extends TestCase {
public void test1() {
try {
CompoundName name = new CompoundName(&quot;&quot;, new Properties());
name.add(null);
} catch (InvalidNameException e) {
fail(e + &quot; should not be thrown&quot;);
}
}
public void test2() {
try {
CompoundName name = new CompoundName(&quot;&quot;, new Properties()); 
name.add(0, null);
} catch (InvalidNameException e) {
fail(e + &quot;should not be thrown&quot;);
}
}
public void test3() {
try {
CompoundName name = new CompoundName(&quot;&quot;, new Properties()); 
name.add(10, null);
} catch (InvalidNameException e) {
fail(&quot;ArrayIndexOutOfBoundsException should be thrown&quot;);
} catch (ArrayIndexOutOfBoundsException e) {
//passed
}
}
}
[classlib][swing] j.s.text.JFormattedTextField(Object) throws NPE when Object.toString() == null
[classlib][swing] j.s.text.JTextPane.updateUI() throws NPE
import javax.swing.JTextPane;
public class Test {
public static void main(String[] args) {
new JTextPane().updateUI();
System.out.println(&quot;passed OK&quot;);
}
}
This simple code causes NPE on Harmony:
Exception in thread &quot;main&quot; java.lang.NullPointerException
at java.util.Hashtable.put(Hashtable.java:698)
at javax.swing.text.SimpleAttributeSet.addAttribute(SimpleAttributeSet.java:50)
at javax.swing.text.StyleContext.addAttribute(StyleContext.java:477)
at javax.swing.text.StyleContext$NamedStyle.addAttribute(StyleContext.java:77)
at javax.swing.plaf.basic.BasicTextPaneUI.propertyChange(BasicTextPaneUI.java:52)
at javax.swing.plaf.basic.BasicTextUI$Listener.propertyChange(BasicTextUI.java:32)
at java.beans.PropertyChangeSupport.doFirePropertyChange(PropertyChangeSupport.java:334)
at java.beans.PropertyChangeSupport.firePropertyChange(PropertyChangeSupport.java:59)
at java.awt.Component.firePropertyChangeImpl(Component.java:1666)
at java.awt.Component.firePropertyChange(Component.java:1680)
at java.awt.Component.setForeground(Component.java:322)
at javax.swing.plaf.basic.BasicTextUI.uninstallDefaults(BasicTextUI.java:866)
at javax.swing.plaf.basic.BasicTextUI.uninstallUI(BasicTextUI.java:929)
at javax.swing.JComponent.setUI(JComponent.java:1273)
at javax.swing.text.JTextComponent.updateUI(JTextComponent.java:1587)
at Test.main(Test.java:5)
The code runs without any errors on RI.
[classlib][awt] Compatibility: java.awt.RenderingHints(Map&lt;RenderingHints.Key,?&gt; init) constructor throws NPE on Harmony while it works silently on RI
If you create java.awt.RenderingHints(Map&lt;RenderingHints.Key,?&gt; init) from the overridden Map implementation and this object may return null on entrySet, then RenderingHints object fails in the constructor on Harmony while it works silently on RI. In case of RI no entries added to the RenderingHints map. Take a look at the test case for the details:
-------- test.java --------
import java.awt.RenderingHints;
import java.util.Collection;
import java.util.Map;
import java.util.Set;
import junit.framework.TestCase;
import junit.textui.TestRunner;
public class test extends TestCase {
public static void main(String args[]) {
TestRunner.run(test.class);
}
public void testRun() {
Map&lt;RenderingHints.Key,?&gt; localMap = new testMap();
RenderingHints rh = new RenderingHints(localMap);
assertTrue(rh.isEmpty());
}
}
class testMap implements Map&lt;RenderingHints.Key, Object&gt; {
public void clear() {
return;
}
public boolean containsKey(Object p0) {
return false;
}
public boolean containsValue(Object p0) {
return false;
}
public Set entrySet() {
return null;
}
public boolean equals(Object p0) {
return false;
}
public Object get(Object p0) {
return null;
}
public int hashCode() {
return 0;
}
public boolean isEmpty() {
return false;
}
public Set keySet() {
return null;
}
public Object put(RenderingHints.Key p0, Object p1) {
return null;
}
public void putAll(Map p0) {
return;
}
public Object remove(Object p0) {
return null;
}
public int size() {
return 0;
}
public Collection values() {
return null;
}
}
-----------------------
===== Output RI ======
.
Time: 0,03
OK (1 test)
===== Output Harmony ======
.E
Time: 0.03
There was 1 error:
1) testRun(test)java.lang.NullPointerException
at java.awt.RenderingHints.putAll(RenderingHints.java:125)
at java.awt.RenderingHints.&lt;init&gt;(RenderingHints.java:83)
at test.testRun(test.java:17)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at test.main(test.java:12)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
[classlib][swing] javax.swing.text.Segment.toString() throws unspecified NPE
javax.swing.text.Segment.toString() throws unspecified NPE on Harmony, but RI doesn't.
============ Test =============
import junit.framework.TestCase;
import javax.swing.text.Segment;
public class Test extends TestCase {
public void testcase() {
System.out.println(&quot;s.toString() = &quot; + new Segment().toString());
}
}
============ Harmony ==========
.java.lang.NullPointerException
at javax.swing.text.Segment.toString(Segment.java:144)
at Test.testcase(Test.java:11)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at java.lang.reflect.Method.invoke(Unknown Source)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at junit.textui.TestRunner.doRun(TestRunner.java:115)
at junit.textui.TestRunner.start(TestRunner.java:172)
at junit.textui.TestRunner.main(TestRunner.java:138)
F
Time: 0.016
There was 1 failure:
1) testcase(Test)junit.framework.AssertionFailedError
at Test.testcase(Test.java:15)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
=========== RI ============
.s.toString() = 
Time: 0
OK (1 test)
[classlib][swing] compatibility: javax.swing.text.StyledEditorKit.getInputAttributes() returns null on Harmony
Compatibility problem: javax.swing.text.StyledEditorKit.getInputAttributes()
returns null on Harmony and not null value on RI.
Test to reproduce:
import junit.framework.TestCase;
import javax.swing.text.MutableAttributeSet;
import javax.swing.text.StyledEditorKit;
public class Test extends TestCase {
public void testcase() {
StyledEditorKit sek = new StyledEditorKit();
MutableAttributeSet result = null;
result = sek.getInputAttributes();
System.out.println(&quot;result = &quot; + result);
assertTrue(&quot;result != null&quot;, (result != null));
}
}
Output on Harmony:
C:\WS\tst_my&gt;echo off 
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software
Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot; 
pre-alpha : not complete or compatible
svn = rsvn: '.' is not a working copy, (Sep 20 2006), Windows/ia32/msvc 1310,
release build
http://incubator.apache.org/harmony
.result = null
F
Time: 0.062
There was 1 failure:
1) testcase(Test)junit.framework.AssertionFailedError: result != null
at Test.testcase(Test.java:13)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
res = 1
Output on RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.result = 
Time: 0.032
OK (1 test)
res = 0
[classlib][awt] java.awt.event.KeyEvent.getKeyText() throws unexpected StringIndexOutOfBoundsException for unknown key code
Test case:
--------------
import java.awt.AWTKeyStroke;
import java.awt.Container;
import java.awt.event.KeyEvent;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
KeyEvent evt = new KeyEvent(new Container(), 1, 2, 3, 4, 'a');
AWTKeyStroke str = AWTKeyStroke.getAWTKeyStrokeForEvent(evt);
assertNull(str);
}
public void testcase2() {
assertEquals(&quot;Unknown keyCode: 0x4&quot;, KeyEvent.getKeyText(4));
}
}
RI output:
-------------
..
Time: 0,15
OK (2 tests)
Harmony output:
-------------
.F.E
Time: 0.501
There was 1 error:
1) testcase2(TheTest)java.lang.StringIndexOutOfBoundsException
at java.lang.String.charAt(String.java:591)
at java.awt.event.KeyEvent.getDefaultName(KeyEvent.java:488)
at java.awt.event.KeyEvent.getKeyText(KeyEvent.java:476)
at TheTest.testcase2(TheTest.java:20)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:10)
There was 1 failure:
1) testcase1(TheTest)junit.framework.AssertionFailedError
at TheTest.testcase1(TheTest.java:15)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:10)
FAILURES!!!
Tests run: 2, Failures: 1, Errors: 1
[classlib][awt] java.awt.Tollkit.getImage(null) throws NPE while RI doesn't
Test case:
--------------
import java.awt.Toolkit;
import java.net.URL;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
Toolkit tk = Toolkit.getDefaultToolkit();
assertNotNull(tk.getImage((String) null));
}
public void testcase2() {
Toolkit tk = Toolkit.getDefaultToolkit();
assertNotNull(tk.getImage((URL) null));
}
}
RI output:
-------------
..
Time: 1,272
OK (2 tests)
Harmony output:
-------------
.E.E
Time: 0.591
There were 2 errors:
1) testcase1(TheTest)java.lang.NullPointerException
at java.util.Hashtable.get(Hashtable.java)
at java.awt.ToolkitImpl.getImage(ToolkitImpl.java:412)
at java.awt.ToolkitImpl.getImage(ToolkitImpl.java)
at TheTest.testcase1(TheTest.java:13)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:9)
2) testcase2(TheTest)java.lang.NullPointerException
at java.util.Hashtable.get(Hashtable.java)
at java.awt.ToolkitImpl.getImage(ToolkitImpl.java:431)
at java.awt.ToolkitImpl.getImage(ToolkitImpl.java)
at TheTest.testcase2(TheTest.java:18)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:9)
FAILURES!!!
Tests run: 2, Failures: 0, Errors: 2
[classlib][awt] GridBagConstraints(,,,,,,,,null,,) throws unspecified NPE while RI does not
Trere is no mention of any exception in the specificarion. java.awt.GridBagConstraints(,,,,,,,,null,,) throws unspecified NPE while RI does not.
=============== Test ============
import junit.framework.TestCase;
import java.awt.*;
public class test extends TestCase { 
public void test1 () { 
new GridBagConstraints(1,1,1,1,7.9,7.9,1,1,null,1,1); 
} 
}
Output on Sun 1.5
=================
Time: 0,016
OK (1 test)
Output on Harmony:
==================
.java.lang.NullPointerException
at test.test1(test.java:12)
at java.lang.reflect.VMReflection.invokeMethod()
at java.lang.reflect.Method.invoke()
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at junit.textui.TestRunner.doRun(TestRunner.java:115)
at junit.textui.TestRunner.start(TestRunner.java:172)
Time: 0.063
[classlib][awt] java.awt.dnd.addNotify(null) throws NPE while RI doesn't
Test case:
--------------
import java.awt.dnd.DropTarget;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
DropTarget dt = new DropTarget();
dt.addNotify(null);
}
}
RI output:
-------------
.
Time: 0,981
OK (1 test)
Harmony output:
--------------
.E
Time: 0.581
There was 1 error:
1) testcase1(TheTest)java.lang.NullPointerException
at org.apache.harmony.awt.datatransfer.windows.WinDTK.createDropTargetContextPeer(WinDTK.java:87)
at java.awt.dnd.DropTarget.addNotify(DropTarget.java:121)
at TheTest.testcase1(TheTest.java:12)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:8)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
[classlib][net]ContentHandler.getContent(Class[]) determines returned object incorrectly
The attached test(which queries new URL(&quot;http://www.intel.com&quot;).getContent({ Object.class })) fails to return content type properly as RI does:
RI:
java test
content= sun.net.www.protocol.http.HttpURLConnection$HttpInputStream@1b65ab
Harmony:
./java test
content= null
Content is null
While getContent(_void_) method returns org.apache.harmony.luni.internal.net.www.protocol.http.HttpURLConnection$LimitedInputStream@2061b4bc
The problem here is that in HARMONY implmentation of ContentHandler.getContent(Class[]) uses reference equality to determine returned object instead of instanceof operator, while specification reads that:
&quot;The instanceof operator should be used to determine the specific kind of object returned&quot;.
see code sample from ContentHandlers below.
public Object getContent(URLConnection uConn, Class[] types)
throws IOException {
Object content = getContent(uConn);
Class&lt;?&gt; cl = content.getClass();
for (int i = 0; i &lt; types.length; i++) {
if (cl == types[i]) { //ERROR HERE isInstance should be used !!!
return content;
}
}
return null;
}
[classlib][annotation] java.lang.annotation.IncompleteAnnotationException(null,String ) does not throw NullPointerException (RI compatibility issue)
java.lang.IncompleteAnnotationException(Class&lt;? extends Annotation&gt; annotationType,String elementName) does not throw 
NullPointerException if annotationType == null while RI throws. But there is no mention of any exceptions in the specificarion. 
So this is a compatibility issue.
The code to reproduce the issue:
import junit.framework.TestCase;
import java.lang.annotation.IncompleteAnnotationException;
public class TestIncompleteAnnotationException extends TestCase { 
public void test1 () { 
try { 
IncompleteAnnotationException obj 
= new IncompleteAnnotationException(null, &quot;str&quot;);
fail(&quot;NullPointerException must be thrown&quot;); 
} catch (NullPointerException e) {
//expected
}
}
}
[classlib][luni][test] Harmony unit test org.apache.harmony.luni.tests.java.lang.PackageTest.test#isCompatibleWithLjava_lang_String is incorect
According to J2SE API 5.0 specifications of java.lang.Package class:
&quot;Specification version numbers use a syntax that consists of positive decimal 
integers separated by periods &quot;.&quot;, for example &quot;2.0&quot; or &quot;1.2.3.4.5.6.7&quot;. This 
allows an extensible number to be used to represent major, minor, micro, etc. 
versions. The version specification is described by the following formal 
grammar: 
SpecificationVersion: 
Digits RefinedVersionopt 
RefinedVersion: 
. Digits 
. Digits RefinedVersion 
Digits: 
Digit 
Digits 
Digit: 
any character for which Character.isDigit(char) returns true, e.g. 0, 1, 
2, ... 
&quot;
But the following Harmony unit test 
org.apache.harmony.luni.tests.java.lang.PackageTest.test invokes
Package.isCompatibleWith(String) with incorrect argument &quot;2.1.9.&quot; to compare
package's specification version with a desired version.
See test case &quot;test_isCompatibleWithLjava_lang_String&quot;.
As the result this test case fails on RI and reports:
test_isCompatibleWithLjava_lang_String(org.apache.harmony.luni.tests.java.lang.PackageTest)junit.framework.AssertionFailedError:
Exception during isCompatibleWith test : For input string: &quot;&quot;
at
org.apache.harmony.luni.tests.java.lang.PackageTest.test_isCompatibleWithLjava_lang_String(PackageTest.java:331)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[classlib][awt] java.awt.Choice.insert(null, 0) does not throw NPE while RI throws it
Test case:
--------------
import java.awt.Choice;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
Choice c = new Choice();
try {
c.insert(null, 0);
fail(&quot;NPE expected&quot;);
} catch (NullPointerException e) {
}
}
}
RI output:
-------------
.
Time: 0,13
OK (1 test)
Harmony output:
-------------
.F
Time: 0.621
There was 1 failure:
1) testcase1(TheTest)junit.framework.AssertionFailedError: NPE expected
at TheTest.testcase1(TheTest.java:15)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:8)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
[classlib][awt] java.awt.Component.processEvent(null) throws NPE while RI does not
Test case:
----------------
import java.awt.AWTEvent;
import java.awt.Component;
import java.awt.MenuItem;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
TestMenuItem mi = new TestMenuItem();
mi.processEvent((AWTEvent) null);
}
public void testcase2() {
TestComponent c = new TestComponent();
c.processEvent((AWTEvent) null);
}
public void testcase3() {
TestComponent c = new TestComponent();
TestEvent e = new TestEvent(c, 2000);
c.processEvent(e);
}
static class TestMenuItem extends MenuItem {
TestMenuItem() {
super();
}
public void processEvent(AWTEvent e) {
super.processEvent(e);
}
}
static class TestComponent extends Component {
TestComponent() {
super();
}
public void processEvent(AWTEvent e) {
super.processEvent(e);
}
}
class TestEvent extends AWTEvent {
public TestEvent(Object source, int id) {
super(source, id);
}
}
}
RI output:
--------------
...
Time: 0,111
OK (3 tests)
Harmony output:
--------------
.E.E.E
Time: 0.581
There were 3 errors:
1) testcase1(TheTest)java.lang.NullPointerException
at java.awt.AWTEvent$EventTypeLookup.getEventMask(AWTEvent.java)
at java.awt.MenuItem.processEvent(MenuItem.java:367)
at TheTest$TestMenuItem.processEvent(TheTest.java)
at TheTest.testcase1(TheTest.java:15)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:11)
2) testcase2(TheTest)java.lang.NullPointerException
at java.awt.AWTEvent$EventTypeLookup.getEventMask(AWTEvent.java)
at java.awt.Component.processEvent(Component.java:3630)
at TheTest$TestComponent.processEvent(TheTest.java)
at TheTest.testcase2(TheTest.java:20)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:11)
3) testcase3(TheTest)java.lang.NullPointerException
at java.awt.AWTEvent$EventTypeLookup.getEventMask(AWTEvent.java)
at java.awt.Component.processEvent(Component.java:3630)
at TheTest$TestComponent.processEvent(TheTest.java)
at TheTest.testcase3(TheTest.java:26)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:11)
FAILURES!!!
Tests run: 3, Failures: 0, Errors: 3
[classlib][awt] MenuItem.dispatchEvent(AWTEvent) throws unspecified NPE
java.awt.MenuItem.dispatchEvent(AWTEvent) throws unspecified NPE while RI does
not.
========= Test =================
import junit.framework.TestCase;
import java.awt.*;
public class test extends TestCase { 
public void test1 () { 
MenuItem obj=new MenuItem(&quot;ABC&quot;);
obj.dispatchEvent( new AWTEventImpl(new Button(), 1)); 
} 
}
class AWTEventImpl extends AWTEvent{
public AWTEventImpl(Event event){
super(event);
}
public AWTEventImpl(Object source, int id){
super(source, id);
}
}
Output on Sun 1.5:
==================
.
Time: 0
OK (1 test)
Output on Harmony:
==================
.E
Time: 0.203
There was 1 error:
1) test1(test)java.lang.NullPointerException
at java.awt.AWTEvent$EventTypeLookup.getEventMask(AWTEvent.java:294)
at java.awt.MenuItem.processEvent(MenuItem.java:356)
at java.awt.MenuComponent.dispatchEvent(MenuComponent.java:424)
at test.test1(test.java:7)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
[classlib][awt] java.awt.DefaultFocusManager.upFocusCycle(Component aComponent) throws unexpected NPE
Test case:
---------------------
import javax.swing.DefaultFocusManager;
import javax.swing.JCheckBoxMenuItem;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() { 
DefaultFocusManager mn = new DefaultFocusManager();
mn.upFocusCycle(new JCheckBoxMenuItem()); 
} 
}
RI output:
--------------
.
Time: 2,24
OK (1 test)
Harmony output:
--------------
.E
Time: 0.81
There was 1 error:
1) testcase1(TheTest)java.lang.NullPointerException
at java.awt.Component.transferFocusUpCycle(Component.java:3178)
at java.awt.DefaultKeyboardFocusManager.upFocusCycle(DefaultKeyboardFocusManager.java:545)
at TheTest.testcase1(TheTest.java:14)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:9)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
[classlib][awt] java.awt.DefaultKeyboardFocusManager.setDefaultFocusTraversalKeys() does not throw IllegalArgumentException if second argument is null
Test case:
----------------
import java.awt.DefaultKeyboardFocusManager;
import java.awt.KeyboardFocusManager;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
DefaultKeyboardFocusManager dkm = new DefaultKeyboardFocusManager();
try {
dkm.setDefaultFocusTraversalKeys(
KeyboardFocusManager.BACKWARD_TRAVERSAL_KEYS, null);
fail(&quot;IAE expected&quot;);
} catch (IllegalArgumentException e) {
} catch (Exception e) {
fail(e.getMessage());
}
}
}
RI output:
--------------
.
Time: 0,701
OK (1 test)
Harmony output:
--------------
.F
Time: 0.491
There was 1 failure:
1) testcase1(TheTest)junit.framework.AssertionFailedError: IAE expected
at TheTest.testcase1(TheTest.java:17)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:9)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
[classlib][awt] java.awt.DefaultKeyboardFocusManager.dispatchEvent(null) does not throw NPE
Test case:
----------------
import java.awt.DefaultKeyboardFocusManager;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
DefaultKeyboardFocusManager dkm = new DefaultKeyboardFocusManager();
try {
System.out.println(dkm.dispatchEvent(null));
fail(&quot;NPE expected&quot;);
} catch (NullPointerException e) {
} catch (Exception e) {
fail(e.getMessage());
}
}
}
RI output:
-------------
.
Time: 1,983
OK (1 test)
harmony output:
--------------
.false
F
Time: 0.511
There was 1 failure:
1) testcase1(TheTest)junit.framework.AssertionFailedError: NPE expected
at TheTest.testcase1(TheTest.java:15)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:8)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
[classlib][awt] java.awt.DisplayMode.equals(null) throws NPE instead of returning false
Test case:
------------------
import java.awt.DisplayMode;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
DisplayMode dm = new DisplayMode(1,2,3,10);
assertFalse(dm.equals((DisplayMode) null)); 
}
}
RI Output:
---------------
.
Time: 0,111
OK (1 test)
Harmony output:
---------------
.E
Time: 0.01
There was 1 error:
1) testcase1(TheTest)java.lang.NullPointerException
at java.awt.DisplayMode.equals(DisplayMode.java)
at TheTest.testcase1(TheTest.java:12)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:8)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
[classlib][awt] java.awt.Robot(null) throws NPE instead of IllegalArgumentException
Test case:
---------------------
import java.awt.Robot;
import junit.framework.TestCase;
public class TheTest extends TestCase {
public static void main(String args[]) {
junit.textui.TestRunner.run(TheTest.class);
}
public void testcase1() {
try {
new Robot(null);
fail(&quot;IAE expected&quot;);
} catch (IllegalArgumentException e) {
} catch (Exception ex) {
fail(ex.getClass().getName());
}
}
}
RI output:
----------------
.
Time: 0,04
OK (1 test)
Harmony output:
----------------
.F
Time: 0.5
There was 1 failure:
1) testcase1(TheTest)junit.framework.AssertionFailedError: java.lang.NullPointerException
at TheTest.testcase1(TheTest.java:17)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at TheTest.main(TheTest.java:8)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
[drlvm] out of memory creating unused Threads
Simple test which fails with OOME:
public class Test extends Thread {
public static void main(String args[]) {
for(;;) {
new Test();
}
}
}
[classlib][awt] Raster.createPackedRaster(...) throws RasterFormatException while RI throws IAE
java.awt.image.Raster.createPackedRaster(int datatype, int w, int h, int[],Point) throws RasterFormatException while RI throws IllegalArgumentException when datatype is not valid.
java 1.5.0 spec says:
&quot;Throws: RasterFormatException - if w or h is less than or equal to zero, or computing
either location.x + w or location.y + h results in integer overflow 
IllegalArgumentException - if dataType is not one of the supported data types,
which are DataBuffer.TYPE_BYTE, DataBuffer.TYPE_USHORT or DataBuffer.TYPE_INT&quot;.
It's a compatibility issue of exception order throwing.
============ Test ==============
import junit.framework.TestCase;
import java.awt.Point;
import java.awt.image.WritableRaster;
import java.awt.image.Raster;
public class test extends TestCase 
{
public void testcase1() 
{
int localVariable0 = 109;
int localVariable1 = -28;
int localVariable2 = 3;
int[] array0 = new int[] {};
Point localPoint2 = new Point();
Point localPoint1 = new Point(localPoint2);
Point localPoint = new Point(localPoint1);
try 
{
Raster.createPackedRaster(
localVariable0,
localVariable1,
localVariable2,
array0,
localPoint);
assertEquals(true, false);
} 
catch (IllegalArgumentException e) 
{e.printStackTrace();
assertEquals(true, true);
}
}
}
OUTPUT:
DEV :
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software
Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = rsvn: '.' is not a working copy, (Sep 29 2006), Windows/ia32/msvc 1310,
de
bug build
http://incubator.apache.org/harmony
.E
Time: 0.031
There was 1 error:
1) testcase1(test)java.awt.image.RasterFormatException: w or h is less than or
e
qual to zero
at java.awt.image.Raster.createPackedRaster(Raster.java:476)
at test.testcase1(test.java:16)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
-----------------------------------------------------------------------
SUN
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.java.lang.IllegalArgumentException: Unsupported data type 109
at java.awt.image.Raster.createPackedRaster(Raster.java:462)
at test.testcase1(test.java:19)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at junit.textui.TestRunner.doRun(TestRunner.java:116)
at junit.textui.TestRunner.start(TestRunner.java:172)
at junit.textui.TestRunner.main(TestRunner.java:138)
Time: 0.094
OK (1 test)
[classlib][awt] Different order of exceptions on j.a.print.Book.setPage(,,)
According to the specification the method java.awt.print.Book.setPage throws: 
IndexOutOfBoundsException - if the specified page is not already in this Book 
NullPointerException - if the painter or page argument is null RI throws NPE if the painter or page argument is null while Harmony at first checks the condition for IndexOutOfBoundsException. 
============ Test ===============
import junit.framework.TestCase;
import java.awt.print.*;
import java.awt.*;
public class test extends TestCase {
public void test1 () { 
Book d=new Book(); 
try { 
d.setPage(63, null, new PageFormat() );
fail(&quot;NullPointerException should be thrown&quot;);
} catch (NullPointerException e) {
//expected 
} 
} 
public void test2 () { 
Book d=new Book(); 
try { 
d.setPage(63, new testPrintable(), null);
fail(&quot;NullPointerException should be thrown&quot;);
} catch (NullPointerException e) {
//expected 
} 
} 
}
class testPrintable implements Printable {
public int print(Graphics p0, PageFormat p1, int p2) {
return 0;
}
}
Output on Sun 1.5
==================
..
Time: 0
OK (2 tests)
Output on Harmony_drlvm
=======================
.E.E
Time: 0.016
There were 2 errors:
1) test1(test)java.lang.IndexOutOfBoundsException: pageIndex is more than book
size
at java.awt.print.Book.setPage(Book.java:102)
at test.test1(test.java:9)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
2) test2(test)java.lang.IndexOutOfBoundsException: pageIndex is more than book
size
at java.awt.print.Book.setPage(Book.java:102)
at test.test2(test.java:19)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 2, Failures: 0, Errors: 2
[classlib][awt] SinglePixelPackedSampleModel.getSamples() expected ArrayIndexOutOfBoundsException
According to the specification for getSamples(int x,
int y,
int w,
int h,
int b,
int[] iArray,
DataBuffer data)
ArrayIndexOutOfBoundsException may be thrown if the coordinates are not in bounds. 
Harmony does not throw ArrayIndexOutOfBoundsException if some int argument equals Integer.MAX_VALUE while RI does. The same problem is for setPixels(int x,
int y,
int w,
int h,
int[] iArray,
DataBuffer data) method.
import java.awt.image.*;
import junit.framework.TestCase;
import java.awt.*;
public class test extends TestCase {
public void testcase1() { 
SinglePixelPackedSampleModel model = new SinglePixelPackedSampleModel(3,216,1,new int[851]); 
model.getSamples(
6,7,14,Integer.MAX_VALUE,0, 
new int[] { 0,0,0},
new DataBufferDouble(7,5)); 
} 
public void testcase2() { 
SinglePixelPackedSampleModel model = new SinglePixelPackedSampleModel(1,127,3,0,new int[970]); 
model.setPixels(
Integer.MAX_VALUE,1,13,1, 
new int[] {},
new DataBufferDouble(7,5)); 
} 
}
Output on Sun 1.5
=================
.E.E
Time: 0,016
There were 2 errors:
1) testcase1(test)java.lang.ArrayIndexOutOfBoundsException: 1518
at java.awt.image.DataBufferDouble.getElem(DataBufferDouble.java:166)
at
java.awt.image.SinglePixelPackedSampleModel.getSamples(SinglePixelPackedSampleModel.java:542)
at test.testcase1(test.java:8)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
2) testcase2(test)java.lang.ArrayIndexOutOfBoundsException: 2147483647
at java.awt.image.DataBufferDouble.getElem(DataBufferDouble.java:166)
at
java.awt.image.SinglePixelPackedSampleModel.setPixels(SinglePixelPackedSampleModel.java:667)
at test.testcase2(test.java:15)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
FAILURES!!!
Tests run: 2, Failures: 0, Errors: 2
Output on Harmony+drlvm/j9:
===========================
..
Time: 0,015
OK (2 tests)
[classlib][awt] DropTargetEvent(null) throws IAE while RI throws NPE
'============= Test ===============
import java.awt.dnd.DropTargetEvent;
public class Test {
public static void main(String[] args) { 
new DropTargetEvent(null);
} 
}
=========== RI ==============
java.lang.NullPointerException
at java.awt.dnd.DropTargetEvent.&lt;init&gt;(DropTargetEvent.java:45)
at Test.main(Test.java:6)
=========== Harmony ========
Uncaught exception in main:
java.lang.IllegalArgumentException
at Test.main(Test.java:6)
[classlib][archive] [compatibility] Harmony checks correctness of java.util.zip.GZIPInputStream.read(BII) arguments even if EOF was reached but RI returns -1
According to J2SE API 5.0 specifications of java.lang.zip.GZIPInputStream
class:
public int read(byte[] buf, int off, int len) throws IOException
Returns:
the actual number of bytes read, or -1 if the end of the compressed input 
stream is reached 
Specification of overriden read method from IputStream class says that
method read throws IndexOutOdBoundsException when off or len is negative and
when off + len is greater than buffer length.
When the end of input stream was reached then RI returns -1 and does not
compare off+len with buf.length and does not check that off and len are 
positive.
But Harmony verifies arguments even if EOF was reached and throws 
ArrayIndexOutOfBoundsException when off or len is negative, or when off+len is
greater than array length.
Harmony unit test 
unitHarmony_org_apache_harmony_archive_tests_java_util_zip_GZIPInputStreamTest
(test_read$BII)
verifies that ArrayIndexOfBoundsException should be thrown after EOF if
off_len &gt; buf.length.
This test fails on RI.
Code for reproducing:
To reproduce this run the following test:
--------------HT7.java--------------
import java.util.*;
import java.io.*;
import java.net.*;
import java.util.zip.*;
public class HT7 {
public static void main (String[] args) {
byte outBuf[] = new byte[100];
try {
int result = 0; 
URL gInput = new URL(&quot;file:hyts_gInput.txt.gz&quot;);
GZIPInputStream inGZIP = new GZIPInputStream(
gInput.openConnection().getInputStream());
try {
inGZIP.read(outBuf, 100, 1);
System.out.println(&quot;Test failedL IOOBE was not thrown&quot;);
return;
} catch (IndexOutOfBoundsException e) {
System.out.println(e + &quot; was thrown as expected&quot;);
}
while (true) {
result = inGZIP.read(outBuf, 0,5);
if (result == -1) {
System.out.println(&quot;EOF was reached&quot;);
break;
}
}
result = -10;
try {
result = inGZIP.read(outBuf, 100, 1);
System.out.println(&quot;Test passed. After EOF read(buf,100,1) ==
&quot;+result);
} catch (IndexOutOfBoundsException e) {
System.out.println(&quot;Test failed. After EOF read(buf, 100,1)
throws: &quot;+e);
}
try {
result = inGZIP.read(outBuf, -100, 1);
System.out.println(&quot;Test passed. After EOF read(buf,-100,1) ==
&quot;+result);
} catch (IndexOutOfBoundsException e) {
System.out.println(&quot;Test failed. After EOF read(buf,-100,1)
throws: &quot;+e);
}
try {
result = inGZIP.read(outBuf, -1, 1);//100, 1);
System.out.println(&quot;Test passed. After EOF read(buf,1,-1) ==
&quot;+result);
} catch (IndexOutOfBoundsException e) {
System.out.println(&quot;Test failed. After EOF read(buf,1,-1)
throws: &quot;+e);
}
} catch (IOException e) {
e.printStackTrace();
}
}
}
-------------------
Steps to Reproduce:
Create HT7 class and run it
java -cp . HT7
Output:
On RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
java.lang.IndexOutOfBoundsException was thrown as expected
EOF was reached
Test passed. After EOF read(buf,100,1) == -1
Test passed. After EOF read(buf,-100,1) == -1
Test passed. After EOF read(buf,1,-1) == -1
On Harmony:
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software
Foundation or its l
icensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = rsvn: '.' is not a working copy, (Sep 22 2006), Windows/ia32/msvc 1310,
debug build
http://incubator.apache.org/harmony
java.lang.ArrayIndexOutOfBoundsException was thrown as expected
EOF was reached
Test failed. After EOF read(buf, 100,1) throws:
java.lang.ArrayIndexOutOfBoundsException
Test failed. After EOF read(buf,-100,1) throws:
java.lang.ArrayIndexOutOfBoundsException
Test failed. After EOF read(buf,1,-1) throws:
java.lang.ArrayIndexOutOfBoundsException
[classlib][regex] java.util.regex.Matcher.usePattern(Pattern) throws NPE instead of specified IllegalArgumentException
Problem: According to specification Matcher.usePattern should throw
IllegalArgumentException when argument is null.
Test to reproduce:
import junit.framework.TestCase;
import java.util.regex.*;
public class Test extends TestCase {
public void testcase() {
Matcher m = Pattern.compile(&quot;(.)+&quot;). matcher(&quot;as&quot;);
try {
m.usePattern(null);
}catch (NullPointerException e) {
e.printStackTrace();
fail(&quot;Got Unexpected NullPointerException&quot;);
} catch (IllegalArgumentException e) {
e.printStackTrace();
System.out.println(&quot;Got Expected
IllegalArgumentException&quot;);
} 
}
}
Output on Harmony:
C:\WS\tst_my&gt;echo off 
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software
Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot; 
pre-alpha : not complete or compatible
svn = rsvn: '.' is not a working copy, (Sep 20 2006), Windows/ia32/msvc 1310,
release build
http://incubator.apache.org/harmony
.java.lang.NullPointerException
at java.util.regex.Matcher.usePattern(Matcher.java:511)
at Test.testcase(Test.java:10)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
at java.lang.reflect.Method.invoke(Unknown Source)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at junit.textui.TestRunner.doRun(TestRunner.java:115)
at junit.textui.TestRunner.start(TestRunner.java:172)
at junit.textui.TestRunner.main(TestRunner.java:138)
F
Time: 0.016
There was 1 failure:
1) testcase(Test)junit.framework.AssertionFailedError: Got Unexpected
NullPointerException
at Test.testcase(Test.java:13)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
res = 1
Output on RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.java.lang.IllegalArgumentException: Pattern cannot be null
at java.util.regex.Matcher.usePattern(Matcher.java:250)
at Test.testcase(Test.java:10)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at junit.textui.TestRunner.doRun(TestRunner.java:116)
at junit.textui.TestRunner.start(TestRunner.java:172)
at junit.textui.TestRunner.main(TestRunner.java:138)
Got Expected IllegalArgumentException
Time: 0.016
OK (1 test)
[classlib][logging] Compatibility: java.util.logging.Level.getLocalizedName() returns non-localized string name
When Level is created as some ResourceBundle, getLocalizedName() returns
non-localized string name. This equals the result of getName().
But on RI getLocalizedName() returns the same value as the 
resourceBundle.getString(levelName)
Code for reproducing:
To reproduce this bug run the following test:
---------------HT1_resource.java-------------
import java.util.ListResourceBundle;
public class HT1_resource extends ListResourceBundle {
public Object[][] getContents() {
return contents;
}
static final Object[][] contents = {
{&quot;Level_error&quot;, &quot;Name&quot;},
{&quot;Localized&quot;, &quot;Localized message&quot;},
};
}
----------------HT1.java--------------
import java.text.*;
import java.util.*;
import java.util.logging.*;
import java.io.*;
import junit.framework.TestCase;
public class HT1 extends TestCase {
public final String bundleName = &quot;HT1_resource&quot;;
public void testT() {
String levelName = &quot;Level_error&quot;;
Level newLevel = new myLevel(levelName, 600, bundleName);
//getLocalizedName() should return the same value as 
//resourceBundle.getString(levelName)
ResourceBundle rb = ResourceBundle.getBundle(bundleName);
String lName = newLevel.getLocalizedName();
String rName = rb.getString(levelName);
if (!lName.equals(rName)) {
fail(&quot;getLocalizedName() returns &quot;
+ lName
+ &quot; but should return the same value as &quot; 
+ rName);
}
}
}
class myLevel extends Level {
public myLevel (String name, int value) {
super(name, value);
}
public myLevel (String name, int value, String resourceBundleName) {
super(name, value, resourceBundleName);
}
}
------------------------
Steps to Reproduce:
1) Create HT1 and HT1_resource classes
2) Run test
java -cp .:junit.jar -showversion junit.textui.TestRunner HT1
Output:
On RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.
Time: 0.015
OK (1 test)
On Harmony:
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software
Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot; 
pre-alpha : not complete or compatible
svn = rsvn: '.' is not a working copy, (Sep 26 2006), Linux/ia32/gcc 3.3.3,
release build
http://incubator.apache.org/harmony
.F
Time: 0.113
There was 1 failure:
1) testT(HT1)junit.framework.AssertionFailedError: getLocalizedName() returns
Level_error but should return the same value as Name
at HT1.testT(HT1.java:22)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
On Harmony+j9
.F
Time: 0.047
There was 1 failure:
1) testT(HT1)junit.framework.AssertionFailedError: getLocalizedName() returns
Level_error
but should return the same value as Name
at HT1.testT(HT1.java:22)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:25)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
[classlib][logging]Compatibility: message format of java.util.logging.Logger.log() on Harmony diffes from RI message
J2SE API specifications of java.util.logging.Logger.log() do not define the
format of reported message.
But output messages on Harmony and RI have different format:
The problems may be with the string parsing: 
1. RI message consists of 2 lines, Harmony message - only 1
2. The order of the fields in the output message is different; 
3. The implementatios use different separator of class and method names: 
RI - ' ' but Harmony - '.'
Code for reproducing:
To reproduce this run HT1 test:
-------------HT1.java------------
import java.util.logging.*;
import junit.framework.TestCase;
public class HT1 extends TestCase {
public void test001() { 
Logger logger = Logger.getLogger(&quot;someName&quot;); 
logger.log(Level.INFO, &quot;this is a small test.&quot;); 
} 
} 
------------------
[classlib][awt] j.a.EventQueue.getCurrentEvent() returns null inside invokeAndWait()
java.awt.EventQueue.invokeAndWait is implemented by posting an instance of InvocationEvent to the event queue. When the Runnable is executed the current event in the EventQueue is null on Harmony.
[classlib][luni] java.io.BufferedInputStream(null,9) returns another internal buffer that RI
Compatibility issue.
According to the specification &quot;protected volatile byte[] buf - The internal
buffer array where the data is stored. When necessary, it may be replaced by
another array of a different size&quot;.
Harmony returns for BufferedInputStream(InputStream in, int size) buf==null if
in==null. RI returns non-null buf with length==size. 
Test for reproducing:
import junit.framework.TestCase;
import java.io.*;
public class test extends TestCase { 
public void test1 () { 
try { 
testBufferedInputStream obj=new testBufferedInputStream(null,9); 
assertEquals(9,testBufferedInputStream.buf.length);
} catch (IOException e) {
fail(&quot;Unexpected IOException&quot;);
}
} 
}
class testBufferedInputStream extends BufferedInputStream {
static byte[] buf; 
testBufferedInputStream(InputStream is, int size) throws IOException {
super(is, size);
buf=super.buf; 
} 
}
Output on Sun 1.5:
==================
.
Time: 0
OK (1 test)
Output on Harmony:
==================
.E
Time: 0.015
There was 1 error:
1) test1(test)java.lang.NullPointerException
at test.test1(test.java:8)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
[classlib][awt] j.a.e.KeyEvent.getKeyText(int) thows StringIndexOutOfBoundsException while RI doesn't
For java.awt.event.KeyEvent.getKeyText(int keyCode) method - Harmony throws java.lang.StringIndexOutOfBoundsException if keyCode does not equal a key constant for a physical key on the keyboard while RI does not. There is no mention about this situation in java spec
============ Test ==============
import java.awt.event.KeyEvent;
import java.awt.event.KeyEvent;
public class Test {
public static void main(String[] argv) {
KeyEvent.getKeyText(4); 
}
}
========= RI ========
noting
======== Harmony =====
java.lang.StringIndexOutOfBoundsException
at java.lang.String.charAt(String.java:585)
at java.awt.event.KeyEvent.getDefaultName(KeyEvent.java:486)
at java.awt.event.KeyEvent.getKeyText(KeyEvent.java:474)
at Test.main(Test.java:11)
[classlib] [beans] Method addAll() in class BeanContextSupport doesn't throw UnsupportedOperationException
According to specification the following code shoud throw UnsupportedOperationException:
import java.beans.beancontext.BeanContextServicesSupport;
public class Bug9278 {
public static void main(String[] args) {
try {
BeanContextServicesSupport s1 = new BeanContextServicesSupport();
BeanContextServicesSupport s2 = new BeanContextServicesSupport();
s1.addAll(s2);
System.out.println(
&quot;UnsupportedOperationException should be thrown&quot;);
} catch (UnsupportedOperationException e) {
System.out.println(&quot;PASSED&quot;); 
}
}
}
[classlib][luni] tests.api.java.net.ServerSocketTest failed intermittently
The test failed 2 times from 162 on DRLVM r479662.
The DRLVM fails to start if -Djava.library.path specified
The following message occured when the DRLVM started from the directory not equal to &lt;jre&gt;/bin with the -Djava.library.path specified:
C:\.usr\bev\harmony-drlvm-shutdown\trunk\build\win_ia32_msvc_debug\deploy\jre\bin\java.exe -Djava.library.path=any Hello
HMYEXEL062E Internal VM error: Failed to create Java VM
FAILED to invoke JVM.
[drlvm][jit][opt] Inst::getPureDefProperty method works incorrectly with extended instruction form
Inst::getPureDefProperty method works incorrectly with extended instruction form and returns 'true' in following case:
t1 = XOR t1, t2
[drlvm][jit] warning (unused variable at GCMap.cpp:361)
Use of the variable stands under #ifdef but def does not.
[classlib][swing] DefaultListModel method removeRange(int fromIndex, int toIndex) doesn't throw IAE for invalid parameters, when toIndex &lt; fromIndex
DefaultListModel method removeRange(int fromIndex, int toIndex) doesn't throw IAE for invalid parameters, when toIndex &lt; fromIndex.
J2SE 1.5 specification says:
Throws an IllegalArgumentException if fromIndex &gt; toIndex. 
Parameters: fromIndex - the index of the lower end of the range, toIndex - the
index of the upper end of the range.
Test for reproduce:
Test.java---------------------------------------------------
import javax.swing.*;
public class Test{
public static void main(String[] args) {
DefaultListModel d = new DefaultListModel();
try {
d.removeRange(0, -1);
System.out.println(&quot;FAILED&quot;);
} catch (IllegalArgumentException iae) {
System.out.println(&quot;PASSED&quot;);
}
}
}
------------------------------------------------------------
Output
Bea JRockit:
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC:
System optimized over throughput (initial strategy singleparpar))
PASSED
------------------------------------------------------------
Harmony:
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r478058, (Nov 22 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
FAILED
[classlib][swing] javax.swing.JLayeredPane.moveToBack(Component c) doesn't throw NPE if parameter c == null
javax.swing.JLayeredPane.moveToBack(Component c) doesn't throw NPE if parameter c == null
Test for reproduce:
Test.java------------------------------------------------
import javax.swing.*;
public class Test{
public static void main(String[] args) {
JLayeredPane lp = new JLayeredPane();
try{ 
lp.moveToBack(null);
System.out.println(&quot;FAILED&quot;);
}catch(NullPointerException e){
System.out.println(&quot;PASSED&quot;);
}
}
}
---------------------------------------------------------------
Output
Bea JRockit:
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC:
System optimized over throughput (initial strategy singleparpar))
PASSED
----------------------------------------------------------------
Harmony:
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r478058, (Nov 22 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
FAILED
[drlvm] Fix for fake circularity error.
Fix for fake circularity error.
This error can happen during compilation, by interaction of JIT, ClassLoader, GC and reference enqueue system.
Fix contains following changes:
- added preload of InternalError class.
- reference enqueue system switched to finalizer scheme.
- Work balance subsystem turned off for GC in JIT compilation frame (FRAME_COMPILATION).
[classlib][swing] CellRendererPane method paintComponent illegally throw NPE for null parameters
Harmony CellRendererPane.paintComponent(Graphics g, Component c, Container p, int x, int y,
int w, int h, boolean shouldValidate) illegally throws NPE for null parameters, but RI doesn't
Test for reproduce:
Test.java-------------------------------------------------------------------
import javax.swing.*;
public class Test {
public static void main(String[] args) {
CellRendererPane c = new CellRendererPane();
try {
c.paintComponent(null, null, null, 0, 0, 0, 0, false);
System.out.println(&quot;PASSED&quot;);
} catch (Throwable t) {
System.out.println(t + &quot; was thrown&quot;);
}
}
}
-----------------------------------------------------------------------
Output:
Bea JRockit
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC:
System optimized over throughput (initial strategy singleparpar))
PASSED
------------------------------------------------------------------------
Harmony
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r474778, (Nov 14 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
java.lang.NullPointerException was thrown
[classlib][awt] Harmony BuffredImage.getWritableTile(int tileX, int tileY) throws unexpected ArrayIndexOutOfBoundsException, but RI doesn't
Harmony BuffredImage.getWritableTile(int tileX, int tileY) throws unexpected ArrayIndexOutOfBoundsException, but RI doesn't
Test for reproduce:
Test.java-----------------------------------------------------
import java.awt.image.*; 
public class Test {
public static void main(String[] args) {
BufferedImage bi = new BufferedImage(10, 10, BufferedImage.TYPE_4BYTE_ABGR);
try {
WritableRaster tile = bi.getWritableTile(100, 100);
System.out.println(&quot;PASSED&quot;);
} catch (ArrayIndexOutOfBoundsException e) {
System.out.println(e + &quot; - was thrown&quot;);
}
}
}
------------------------------------------------------------------------------------
Output
Bea JRockit
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC:
System optimized over throughput (initial strategy singleparpar))
PASSED
------------------------------------------------------------------------------------
Harmony
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r474778, (Nov 14 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
java.lang.ArrayIndexOutOfBoundsException: Both tileX and tileY are not equal to
0 - was thrown
[classlib][awt] Harmony ComponentSampleModel.setDataElements(int x, int y, Object obj, DataBuffer data) doesn't throw ArrayIndexOutOfBoundsException when x or y have wrong value, but RI implementation does.
Harmony ComponentSampleModel.setDataElements(int x, int y, Object obj, DataBuffer data) doesn't throw ArrayIndexOutOfBoundsException when x or y have wrong value, but RI implementation does.
Test for reproduce:
Test.java-----------------------------------
import java.awt.image.*; 
public class Test {
public static void main(String[] args) {
int[] offsets = new int[4];
ComponentSampleModel csm = new
ComponentSampleModel(DataBuffer.TYPE_USHORT,238,4,7,14,offsets);
ComponentSampleModel obj = new
ComponentSampleModel(DataBuffer.TYPE_USHORT,1,2,3,15, offsets);
DataBufferFloat db = new DataBufferFloat(4);
try{
csm.setDataElements(-1399, 2, obj, db);
System.out.println(&quot;No Exception&quot;);
}catch (ClassCastException e) {
System.out.println(e + &quot; - was thrown&quot;);
}catch (ArrayIndexOutOfBoundsException e) {
System.out.println(e + &quot; - was thrown&quot;);
}
}
}
Output:
Bea JRockit
---------------------------------------------------------------------------------------------------------------------
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC:
System optimized over throughput (initial strategy singleparpar))
java.lang.ArrayIndexOutOfBoundsException: Coordinate out of bounds! - was thrown
---------------------------------------------------------------------------------------------------------------------
Harmony
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r474778, (Nov 14 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
java.lang.ClassCastException - was thrown
[classlib][awt] UnsupportedFlavorException throws unexpected NPE
'========== Spec ============
public UnsupportedFlavorException(DataFlavor flavor)
Constructs an UnsupportedFlavorException. 
Parameters:
flavor - the flavor object which caused the exception. May be null.
========= Test ===============
import java.awt.datatransfer.*;
public class Test {
public static void main(String[] argv) {
UnsupportedFlavorException ufe = new UnsupportedFlavorException(null);
System.out.println(&quot;passed&quot;);
}
}
======== RI ========
passed
====== Harmony =========
Uncaught exception in main:
java.lang.NullPointerException
at Test.main(Test.java:5)
[classlib][swing] JEditorPane setContentType(String), setPage(String) and setPage(URL) throw wrong exceptions if parameter is null
JEditorPane methods setContentType(String), setPage(String) and setPage(URL)
doesn't throw specified exceptions for null parameters. And method
setText(String) illegally throws NPE for null parameter. The behavior of these
methods contrary to J2SE 1.5 specification and RI behavior. 
1. Method setContentType(String) should throw NPE for null parameter according
to specification:
public final void setContentType(String type)
Sets the type of content that this editor handles. This calls
getEditorKitForContentType, and then setEditorKit if an editor kit can be
successfully located. This is mostly convenience method that can be used as an
alternative to calling setEditorKit directly. If there is a charset definition
specified as a parameter of the content type specification, it will be used
when loading input streams using the associated EditorKit. For example if the
type is specified as text/html; charset=EUC-JP the content will be loaded using
the EditorKit registered for text/html and the Reader provided to the EditorKit
to load unicode into the document will use the EUC-JP charset for translating
to unicode. If the type is not recognized, the content will be loaded using the
EditorKit registered for plain text, text/plain. 
Parameters: type - the non-null mime type for the content editing support 
Throws: NullPointerException - if the type parameter is null
This method doesn't throw NPE for setContentType(null). Meanwhile, RI of this
method throws NPE. 
2. According to specification:
public void setPage(URL page) throws IOException
Sets the current URL being displayed. The content type of the pane is set, and
if the editor kit for the pane is non-null, then a new default document is
created and the URL is read into it. If the URL contains and reference
location, the location will be scrolled to by calling the scrollToReference
method. If the desired URL is the one currently being displayed, the document
will not be reloaded. To force a document reload it is necessary to clear the
stream description property of the document. 
Parameters: page - the URL of the page 
Throws: IOException - for a null or invalid page specification, or exception
from the stream being read
method setPage(URL) should throw IOE for null parameter, but this methods
doesn't.
RI of this method throws NPE for null parameter.
3. Method setText(String) throws unspecified NPE for null parameter. The
behavior of this method contrary to specification:
public void setText(String t)
Sets the text of this TextComponent to the specified content, which is expected
to be in the format of the content type of this editor. For example, if the
type is set to text/html the string should be specified in terms of HTML. 
Overrides: setText in class JTextComponent
Parameters: t - the new text to be set; if null the old text will be deleted
and RI behavior.
========= Test ===========
import java.io.IOException;
import java.net.URL;
import javax.swing.JEditorPane;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testSetContentType() {
JEditorPane e = new JEditorPane();
boolean b = false;
try {
e.setContentType((String)null);
} catch (NullPointerException npe) {
npe.printStackTrace();
b = true;
} catch (Throwable t) {
t.printStackTrace();
}
assertTrue(b);
}
public void testSetPage() {
JEditorPane e = new JEditorPane();
boolean b = false;
try {
e.setPage((URL)null);
} catch (IOException ioe) {
ioe.printStackTrace();
b = true;
} catch (Throwable t) {
t.printStackTrace();
}
assertTrue(b);
}
public void testSetText() {
JEditorPane e = new JEditorPane();
boolean b = true;
try {
e.setText((String)null);
} catch (Throwable t) {
t.printStackTrace();
b = false;
}
assertTrue(b);
}
}
=========== RI ============
java.io.IOException: invalid url
at javax.swing.JEditorPane.setPage(JEditorPane.java:393)
at bug7610.testSetPage(bug7610.java:29)
at jrockit.reflect.VirtualNativeMethodInvoker.invoke(Ljava.lang.Object;[Ljava.lang.Object;)Ljava.lang.Object;(Unknown Source)
at java.lang.reflect.Method.invoke(Ljava.lang.Object;[Ljava.lang.Object;I)Ljava.lang.Object;(Unknown Source)
at junit.framework.TestCase.runTest(TestCase.java:164)
at junit.framework.TestCase.runBare(TestCase.java:130)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:120)
at junit.framework.TestSuite.runTest(TestSuite.java:230)
at junit.framework.TestSuite.run(TestSuite.java:225)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:478)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:344)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)
java.lang.NullPointerException
at javax.swing.JEditorPane.setContentType(JEditorPane.java:873)
at bug7610.testSetContentType(bug7610.java:15)
at jrockit.reflect.VirtualNativeMethodInvoker.invoke(Ljava.lang.Object;[Ljava.lang.Object;)Ljava.lang.Object;(Unknown Source)
at java.lang.reflect.Method.invoke(Ljava.lang.Object;[Ljava.lang.Object;I)Ljava.lang.Object;(Unknown Source)
at junit.framework.TestCase.runTest(TestCase.java:164)
at junit.framework.TestCase.runBare(TestCase.java:130)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:120)
at junit.framework.TestSuite.runTest(TestSuite.java:230)
at junit.framework.TestSuite.run(TestSuite.java:225)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:478)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:344)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)
=========== Harmony =======
java.lang.NullPointerException
at java.io.Reader.&lt;init&gt;(Reader.java:54)
at java.io.StringReader.&lt;init&gt;(StringReader.java:42)
at javax.swing.JEditorPane.setText(JEditorPane.java:738)
at bug7610.testSetText(bug7610.java:43)
at java.lang.reflect.VMReflection.invokeMethod()
at java.lang.reflect.Method.invoke()
at junit.framework.TestCase.runTest(TestCase.java:164)
at junit.framework.TestCase.runBare(TestCase.java:130)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:120)
at junit.framework.TestSuite.runTest(TestSuite.java:230)
at junit.framework.TestSuite.run(TestSuite.java:225)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:478)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:344)
[drlvm][build] no docs are generated for DRLVM
Nadezhda Morozova wrote at
http://mail-archives.apache.org/mod_mbox/incubator-harmony-dev/200610.mbox/%3c523F3D8D8C97554AA47E53DF1A05466A587B5B@nnsmsx411.ccr.corp.intel.com%3e
AFAIU, we want to have the following:
1. Ability to generate docs locally from source code [...]
[drlvm] Fix ClassLoading in exception raised state.
The following test crashes VM, if it runs with parameters -Xms16m -Xmx32m:
import java.lang.ref.*;
public class PhantomTest {
static int MAX_MEM = 0;
public static void main(String[] args) {
if(args.length&gt;0) {
try {
MAX_MEM = Integer.parseInt(args[0]);
}
catch(NumberFormatException e) { //ignore 
}
}
if(MAX_MEM &lt;= 0) {
MAX_MEM = 100000;
}
ReferenceQueue q = new ReferenceQueue();
PhantomReference [] ref = new PhantomReference[MAX_MEM];
FinalizedObject obj = null;
for(int i= 0; i &lt; ref.length; ++i) {
if(i &gt; 0) ref[i - 1] = new PhantomReference(obj, q);
obj = null;
obj = new FinalizedObject(1024, i);
Reference r = null;
while( (r=q.poll())!=null) {
r.clear();
System.out.println(&quot;r = &quot; + r);
}
}
System.out.println(&quot;TEST COMPLETED!&quot;);
}
static class FinalizedObject {
byte [] bytes;
int ind = 0;
FinalizedObject(int size, int ind) {
bytes = new byte[size];
this.ind = ind;
}
protected void finalize() {
System.out.println(&quot;Finalize: &quot; + ind);
}
}
}
[classlib][awt] Container.remove(null) expected NPE
Harmony implementation of Container.remove(Component ) doesn't throw NPE while RI does. Spec silent about any exceptions.
========== Test ============
import java.awt.*;
public class Test { 
static public void main(String[] args) {
Container cmp = new Container();
cmp.remove((Button )null);
System.out.println(&quot;PASSED&quot;);
} 
}
======== RI ===========
java.lang.NullPointerException
at java.awt.Container.remove(Container.java:1165)
at Test.main(Test.java:9)
===== Harmony ========
PASSED
[classlib][awt]Junit AWT TestRunner throws NPE in &quot;Errors and Failures&quot; text area
Description: AWT TestRunner throws NPE in &quot;Errors and Failures&quot; text area
Steps to Reproduce:
1. java -cp junit.jar junit.awtui.TestRunner
2. press Tab key three times to get to the &quot;Errors and Failures&quot; text area component
3. press arrow key
Result: 
java.lang.NullPointerException
at org.apache.harmony.awt.text.TextUtils.getRowStart(TextUtils.java:314)
at org.apache.harmony.awt.text.TextUtils.getPositionAbove(TextUtils.java:392)
at org.apache.harmony.awt.text.TextUtils.getNextVisualPositionFrom(TextUtils.java:587)
at javax.swing.text.View.getNextVisualPositionFrom(View.java:188)
at javax.swing.text.RootView.getNextVisualPositionFrom(RootView.java:97)
at org.apache.harmony.awt.text.ActionSet$NextVisualPositionAction.internalPerformAction(ActionSet.java:218)
at org.apache.harmony.awt.text.AWTTextAction.performAction(AWTTextAction.java:27)
at java.awt.TextComponent.performTextAction(TextComponent.java:1106)
at java.awt.TextComponent$KeyHandler.performAction(TextComponent.java:284)
at java.awt.TextComponent$KeyHandler.keyPressed(TextComponent.java:256)
at java.awt.Component.processKeyEventImpl(Component.java:3897)
at java.awt.Component.preprocessKeyEvent(Component.java:3616)
at java.awt.TextComponent.postprocessEvent(TextComponent.java:1095)
at java.awt.Component.dispatchEvent(Component.java:3545)
at java.awt.KeyboardFocusManager.redispatchEvent(KeyboardFocusManager.java:283)
at java.awt.DefaultKeyboardFocusManager.dispatchKeyEvent(DefaultKeyboardFocusManager.java:373)
at java.awt.DefaultKeyboardFocusManager.dispatchEvent(DefaultKeyboardFocusManager.java:94)
at java.awt.Component.dispatchEvent(Component.java:3518)
at java.awt.EventQueueCore.dispatchEventImpl(EventQueueCore.java:139)
at java.awt.EventQueue.dispatchEvent(EventQueue.java:144)
at java.awt.EventDispatchThread.runModalLoop(EventDispatchThread.java:67)
at java.awt.EventDispatchThread.run(EventDispatchThread.java:45)
[drlvm][classlib] loadClass method in ClassLoader is not synchronized
The following code is reproducing the following situation: 2 threads simultaneously run Class.forName() method for the same classname and the same test classloader. It is expected that findClass() method of the test classloader should be called only once otherwise this lead to double call of defineClass() method (which is not allowed, see also HARMONY-1932).
Output on RI:
Test passed.
Output on Harmony:
Test failed: findClass was called 2 times.
-------------Test.java---------------
public class Test {
static TestClassLoader cl = new TestClassLoader();
static Object lock = new Object();
static int readyNum = 0;
static int findClassCalled = 0;
public static void main(String[] args) throws Exception {
TestThread tt1 = new TestThread();
TestThread tt2 = new TestThread();
tt1.start();
tt2.start();
while (readyNum &lt; 2) {
Thread.sleep(100);
}
synchronized (lock) {
lock.notifyAll();
}
tt1.join();
tt2.join();
if (cl.findClassCalled() != 1) {
System.out.println(&quot;Test failed: findClass was called &quot;
+ cl.findClassCalled() + &quot; times.&quot;);
} else {
System.out.println(&quot;Test passed.&quot;);
}
}
static class TestClassLoader extends ClassLoader {
private int findClassCalled;
/*
* Byte array of bytecode equivalent to the following source code:
* public class TestClass {
* }
*/
private byte[] classData = new byte[] {
-54, -2, -70, -66, 0, 0, 0, 49, 0, 13,
10, 0, 3, 0, 10, 7, 0, 11, 7, 0,
12, 1, 0, 6, 60, 105, 110, 105, 116, 62,
1, 0, 3, 40, 41, 86, 1, 0, 4, 67,
111, 100, 101, 1, 0, 15, 76, 105, 110, 101,
78, 117, 109, 98, 101, 114, 84, 97, 98, 108,
101, 1, 0, 10, 83, 111, 117, 114, 99, 101,
70, 105, 108, 101, 1, 0, 14, 84, 101, 115,
116, 67, 108, 97, 115, 115, 46, 106, 97, 118,
97, 12, 0, 4, 0, 5, 1, 0, 9, 84,
101, 115, 116, 67, 108, 97, 115, 115, 1, 0,
16, 106, 97, 118, 97, 47, 108, 97, 110, 103,
47, 79, 98, 106, 101, 99, 116, 0, 33, 0,
2, 0, 3, 0, 0, 0, 0, 0, 1, 0,
1, 0, 4, 0, 5, 0, 1, 0, 6, 0,
0, 0, 29, 0, 1, 0, 1, 0, 0, 0,
5, 42, -73, 0, 1, -79, 0, 0, 0, 1,
0, 7, 0, 0, 0, 6, 0, 1, 0, 0,
0, 1, 0, 1, 0, 8, 0, 0, 0, 2,
0, 9 };
protected Class findClass(String name) throws ClassNotFoundException {
findClassCalled++;
try {
synchronized (lock) {
lock.wait();
}
} catch (InterruptedException ie) {
}
if (name.equals(&quot;TestClass&quot;)) {
return defineClass(null, classData, 0, classData.length);
} else {
throw new ClassNotFoundException(&quot;Class &quot; + name + &quot; not found.&quot;);
}
}
int findClassCalled() {
return findClassCalled;
}
}
static class TestThread extends Thread {
public void run() {
try {
readyNum++;
Class.forName(&quot;TestClass&quot;, false, cl);
} catch (Exception ex) {
ex.printStackTrace();
}
}
}
}
------------------------------------------
[classlib][luni] improper class replacement for the same base class names in ObjectInputStream.resolveClass()
Object serialization specification states that starting from JDK 1.6 method resolveClass in ObjectInputStream class could return a class with the same *base* class name (but, possibly from another package) and SerialVersionUID as the class provided for replacement. In this case the fields of replacement class should be initialized by the ones of original class from the stream. The following test passes on RI but fails on Harmony:
------------------------- Test.java -----------------------------
import java.io.*;
public class Test {
public static void main(String[] args) throws Exception {
a.TestClass to1 = new a.TestClass();
to1.i = 555;
ByteArrayOutputStream baos = new ByteArrayOutputStream();
ObjectOutputStream oos = new ObjectOutputStream(baos);
oos.writeObject(to1);
oos.flush();
byte[] bytes = baos.toByteArray();
ByteArrayInputStream bais = new ByteArrayInputStream(bytes);
ObjectInputStream ois = new TestObjectInputStream(bais);
try {
b.TestClass to2 = (b.TestClass) ois.readObject();
if (to2.i != to1.i) {
System.out.println(&quot;Test failed. Expected: &quot; + to1.i + &quot;, got: &quot; + to2.i);
} else {
System.out.println(&quot;Test passed.&quot;);
}
} catch (InvalidClassException ice) {
System.out.println(&quot;Test failed with exception: &quot; + ice);
}
}
static class TestObjectInputStream extends ObjectInputStream {
public TestObjectInputStream(InputStream in) throws IOException {
super(in);
}
protected Class resolveClass(ObjectStreamClass desc)
throws IOException, ClassNotFoundException {
if (desc.getName().equals(&quot;a.TestClass&quot;)) {
return b.TestClass.class;
}
return super.resolveClass(desc);
}
}
}
-----------------------------------------------------------------
------------------------- a/TestClass.java -----------------------------
package a;
import java.io.Serializable;
public class TestClass implements Serializable {
private static final long serialVersionUID = 11111L;
public int i = 0;
}
-----------------------------------------------------------------
------------------------- b/TestClass.java -----------------------------
package b;
import java.io.Serializable;
public class TestClass implements Serializable {
private static final long serialVersionUID = 11111L;
public int i = 0;
}
-----------------------------------------------------------------
Output on RI:
Test passed.
Output on Harmony:
Test failed. Expected: 555, got: 0
[classlib][swing]javax.swing.tex.ElementIterator((Document)null) does not throw unspesified NPE
Description:
javax.swing.tex.ElementIterator((Document)null) does not throw unspecified NPE while RI does.
Compatibility issue.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.text.*;
public class test extends TestCase { 
public void testElementIterator_DocumentNull(){
try {
ElementIterator obj = new ElementIterator((Document)null); 
fail(&quot;NullPointerException should be thrown&quot;);
} catch (NullPointerException e) {
//expected
}
} 
}
HARMONY output:
=============
There was 1 failure:
1) testElementIterator_DocumentNull(test)junit.framework.AssertionFailedError: NullPointerException should be thrown
at test.testElementIterator_DocumentNull(test.java:8)
at java.lang.reflect.VMReflection.invokeMethod(VMReflection.java)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
SUN output:
==========
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.
Time: 0.01
OK (1 test)
[classlib][swing] javax.swing.text.PlainDocument.removeUpdate(AbstractDocument.DefaultDocumentEvent chng) throws unspecified NullPointerException
Problem: javax.swing.text.PlainDocument.removeUpdate(AbstractDocument.DefaultDocumentEvent chng) throws unspecified NullPointerException if no change where made to document before removeUpdate is invoked.
Test to reproduce:
import junit.framework.TestCase;
import javax.swing.text.PlainDocument;
import javax.swing.text.AbstractDocument;
import javax.swing.text.html.HTMLDocument;
import javax.swing.event.DocumentEvent;
class MyPlainDocument extends PlainDocument {
public void removeUpdate(AbstractDocument.DefaultDocumentEvent chng) {
super.removeUpdate(chng);
}
}
public class Test extends TestCase {
public void testcase() {
MyPlainDocument mpd = new MyPlainDocument();
HTMLDocument localHTMLDocument = new HTMLDocument();
AbstractDocument.DefaultDocumentEvent chng = localHTMLDocument.new DefaultDocumentEvent( 3, 13, DocumentEvent.EventType.INSERT);
mpd.removeUpdate(chng); // no exception should be thrown
}
}
Output on Sun 1.5: 
================== 
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.
Time: 1.25
OK (1 test)
Output on Harmony: 
================== 
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r453981, (Oct 9 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
.E
Time: 0.812
There was 1 error:
1) testcase(Test)java.lang.NullPointerException
at javax.swing.text.PlainDocument.removeUpdate(PlainDocument.java:155)
at MyPlainDocument.removeUpdate(Test.java:10)
at Test.testcase(Test.java:21)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:25)
FAILURES!!!
Tests run: 1, Failures: 0, Errors: 1
[classlib][swing]javax.swing.text.DefaultCaret.setBlinkRate(int rate) does not throw unspecified IAE if rate&lt;0
Description:
javax.swing.text.DefaultCaret.setBlinkRate(int rate) does not throw unspecified IAE if rate&lt;0 while RI does.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.text.*;
public class test extends TestCase { 
public void testSetBlinkRate_I(){ 
DefaultCaret obj=new DefaultCaret(); 
try {
obj.setBlinkRate(-100); 
fail(&quot;IllegalArgumentException should be thrown&quot;); 
} catch (IllegalArgumentException e) {
//expected
}
} 
}
HARMONY output:
==============
Time: 0.047
There was 1 failure:
1) testSetBlinkRate_I(test)junit.framework.AssertionFailedError: IllegalArgumentException should be thrown
at test.testSetBlinkRate_I(test.java:9)
at java.lang.reflect.VMReflection.invokeMethod(VMReflection.java)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
SUN output:
=========
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.
Time: 0.01
OK (1 test
[classlib][swing]javax.swing.tex.htmlFormView.getMaximumSpan(int axis) does not throw IllegalArgumentException for invalid axis
Description:
According to the specification getMaximumSpan(int axis) must throw IllegalArgumentException - for an invalid axis.
axis - may be either View.X_AXIS or View.Y_AXIS (0 or 1).
Harmony does not throw specified exception for invalid axis.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.text.*;
import javax.swing.text.html.*;
public class test extends TestCase { 
public void testgetMaximumSpan_I(){
HTMLDocument doc = new HTMLDocument();
Element par=doc.getDefaultRootElement(); 
FormView obj=new FormView(par); 
try {
obj.getMaximumSpan(11);
fail(&quot;IllegalArgumentException should be thrown&quot;);
} catch (IllegalArgumentException e) {
//expected
} 
} 
}
HARMONY output:
==============
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r453981, (Oct 9 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
There was 1 failure:
1) testElementIterator_DocumentNull(test)junit.framework.AssertionFailedError: NullPointerException should be thrown
at test.testElementIterator_DocumentNull(test.java:8)
at java.lang.reflect.VMReflection.invokeMethod(VMReflection.java)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
SUN output:
=========
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.
Time: 0.01
OK (1 test)
[drlvm][kernel] j.l.System.out and j.l.System.err should be buffered
[classlib][swing]javax.swing.plaf.basic.BasicTableHeaderUI.MouseInputHandler.mouseEntered(null) throws unspecified NPE
Harmony implementation of javax.swing.plaf.basic.BasicTableHeaderUI.MouseInputHandler.mouseEntered(null) throws unspecified NPE while RI works silently.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.plaf.basic.BasicTableHeaderUI;
public class Test extends TestCase { 
public void testMouseInputHandler_mouseEntered_null() {
BasicTableHeaderUI jp = new BasicTableHeaderUI();
BasicTableHeaderUI.MouseInputHandler m = jp.new MouseInputHandler();
try {
m.mouseEntered(null);
} catch ( NullPointerException e) {
fail(&quot;NPE shouldn't be thrown&quot;);
}
}
}
HARMONY output:
=============
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r450941, (Sep 28 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
.F
Time: 0.063
There was 1 failure:
1) testMouseInputHandler_mouseEntered_null(Test)junit.framework.AssertionFailedError: NPE shouldn't be thrown
at Test.testMouseInputHandler_mouseEntered_null(Test.java:85)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
SUN output:
========
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.
Time: 0.015
OK (1 test)
[classlib][swing]javax.swing.plaf.basic.BasicTableUI.paint(null, JComponent) does not throw unspecified NPE
RI of javax.swing.plaf.basic.BasicTableUI.paint(null,JComponent) throws unspecified NPE while Harmony implementation of the method works silently.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.JSpinner;
import javax.swing.JTable;
import javax.swing.plaf.basic.BasicTableUI;
public class Test extends TestCase { 
public void testBasicTableUI_paint_Graphics_JComponent() { 
BasicTableUI b = new BasicTableUI();
b.installUI(new JTable());
try {
b.paint(null, new JSpinner());
fail(&quot;NPE should be thrown&quot;);
} catch ( NullPointerException e) {
//expected 
}
}
}
HARMONY output:
=============
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r450941, (Sep 28 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
.F
Time: 2.141
There was 1 failure:
1) testBasicTableUI_paint_Graphics_JComponent(Test)junit.framework.AssertionFailedError: NPE should be thrown
at Test.testBasicTableUI_paint_Graphics_JComponent(Test.java:13)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
SUN output:
========
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.
Time: 0.656
OK (1 test)
[classlib][swing] javax.swing.text.MaskFormatter.valueToString(Object) throws unspecified NPE
Description:
javax.swing.text.MaskFormatter.valueToString(Object) throws unspecified NPE.
The same issue is for MaskFormatter.install(JFormattedTextField) method.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.*;
import javax.swing.text.*;
import java.text.*;
public class test extends TestCase { 
public void testValueToString_Object() throws ParseException{
MaskFormatter obj = new MaskFormatter();
obj.valueToString(new Object());
} 
public void testInstall_JFormattedTextField() {
MaskFormatter obj = new MaskFormatter();
obj.install(new JFormattedTextField());
} 
}
HARMONY output:
==============
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r450941, (Sep 28 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
.E.E
Time: 1.109
There were 2 errors:
1) testValueToString_Object(test)java.lang.NullPointerException
at javax.swing.text.MaskFormatter.fillAll(MaskFormatter.java:202)
at javax.swing.text.MaskFormatter.valueToString(MaskFormatter.java:193)
at test.testValueToString_Object(test.java:10)
at java.lang.reflect.VMReflection.invokeMethod(VMReflection.java)
2) testInstall_JFormattedTextField(test)java.lang.NullPointerException
at javax.swing.text.MaskFormatter.fillAll(MaskFormatter.java:202)
at javax.swing.text.MaskFormatter.valueToString(MaskFormatter.java:193)
at javax.swing.JFormattedTextField$AbstractFormatter.updateText(JFormattedTextField.java:99)
at javax.swing.JFormattedTextField$AbstractFormatter.install(JFormattedTextField.java:92)
at javax.swing.text.MaskFormatter.install(MaskFormatter.java:119)
at test.testInstall_JFormattedTextField(test.java:14)
at java.lang.reflect.VMReflection.invokeMethod(VMReflection.java)
FAILURES!!!
Tests run: 2, Failures: 0, Errors: 2 
SUN output:
=========
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
..
Time: 0.01
OK (2 test)
[classlib][swing] javax.swing.ScrollPaneLayout.setHorisontalScrollBarPolicy(int) does not throw specified IllegalArgumentException
javax.swing.ScrollPaneLayout.setHorisontalScrollBarPolicy(int) does not throw specified IllegalArgumentException. RI throws it.
According to java 1.5 method setHorisontalScrollBarPolicy (int) throws IllegalArgumentException - if x is not a valid horizontal scrollbar policy.&quot;
Harmony behavior does not correspond to spec.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.ScrollPaneConstants;
import javax.swing.ScrollPaneLayout;
public class test extends TestCase 
{
public void testSetHorizontalScrollBarPolicy() 
{
ScrollPaneLayout localScrollPaneLayout = new ScrollPaneLayout();
try 
{
localScrollPaneLayout.setHorizontalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_NEVER);
fail(&quot;No expected llegalArgumentException&quot;);
}catch (IllegalArgumentException e) {
//expected
}
}
}
OUTPUT:
HARMONY
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r450941, (Sep 28 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
Time: 0.016
There was 1 failure:
1) testSetHorizontalScrollBarPolicy(test)junit.framework.AssertionFailedError: No expected llegalArgumentException
at test.testSetHorizontalScrollBarPolicy(test.java:12)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
------------------------------------------------------------------------
SUN
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
Time: 0.031
OK (1 test)
[classlib][swing] javax.swing.ScrollPaneLayout.preferredLayoutSize(Component c) does not throw NPE
javax.swing.ScrollPaneLayout.preferredLayoutSize(Component comp) does not throw unspecified NPE when comp is null while RI throws it.
Test for reproducing:
import junit.framework.TestCase;
import javax.swing.ScrollPaneLayout;
public class test extends TestCase 
{
public void testPrefferedLayoutSize() 
{
ScrollPaneLayout localScrollPaneLayout = new ScrollPaneLayout();
try {
localScrollPaneLayout.preferredLayoutSize(null);
fail(&quot;No expected NPE!&quot;);
} 
catch (NullPointerException e) {
//expected
}
}
}
OUTPUT:
HARMONY
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r450941, (Sep 28 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
Time: 0.016
There was 1 failure:
1) testPrefferedLayoutSize(test)junit.framework.AssertionFailedError: No expected NPE!
at test.testPrefferedLayoutSize(test.java:12)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
------------------------------------------------------------------------
SUN
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
Time: 0.031
OK (1 test)
[swing] javax.swing.RepaintManager.addInvalidComponent(JComponent jcomp) throws unspecified NPE
javax.swing.RepaintManager.addInvalidComponent(JComponent jcomp) throws unspecified NPE when jcomp is null, while RI does not throw it.
test for reproducing:
import junit.framework.TestCase;
import javax.swing.JComponent;
import javax.swing.RepaintManager;
import javax.swing.JToolTip;
public class test extends TestCase 
{
public void testAddInvalidComponent() 
{
RepaintManager localRepaintManager = new RepaintManager();
JToolTip localJToolTip = new JToolTip();
localRepaintManager.addInvalidComponent(localJToolTip);
JComponent c = null;
try
{
localRepaintManager.addInvalidComponent(c);
}
catch(NullPointerException e){
fail(&quot;unexpected NPE is thrown&quot;);}
}
}
OUTPUT:
HARMONY
Apache Harmony Launcher : (c) Copyright 1991, 2006 The Apache Software Foundatio
n or its licensors, as applicable.
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r450941, (Sep 28 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
.F
Time: 0.344
There was 1 failure:
1) testAddInvalidComponent(test)junit.framework.AssertionFailedError: unexpected
NPE is thrown
at test.testAddInvalidComponent(test.java:19)
at java.lang.reflect.VMReflection.invokeMethod(Native Method)
FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0
------------------------------------------------------------------------
SUN
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
.
Time: 0.781
OK (1 test)
[classlib][archive] URL.openStream() should throw FileNotFoundEx if file not exists in jar file.
URL.openStream() should throw FileNotFoundException if file not exists in jar file.
Code for reproducing:
package test;
import java.io.FileNotFoundException;
import java.net.URL;
import junit.framework.TestCase;
public class Bug extends TestCase {
public void test() throws Exception {
try {
URL url = new URL(&quot;jar:file:/C:/alternate.jar!/foo.jar!/bar&quot;);
url.openStream();
} catch (FileNotFoundException e) {
e.printStackTrace();
System.out.println(&quot;PASSED&quot;);
}
}
}
alternate.jar is in attachment.
Output on RI:
java.io.FileNotFoundException: JAR entry foo.jar!/bar not found in C:\alternate.jar
at
sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:114)
at
sun.net.www.protocol.jar.JarURLConnection.getInputStream(JarURLConnection.java:124)
at java.net.URL.openStream(URL.java:1007)
at test.Bug.test(Bug.java:14)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
PASSED
Output on latest Harmony build r450941:
java.util.zip.ZipException: Unable to open: C:\alternate.jar!\foo.jar
at java.util.zip.ZipFile.openZip(ZipFile.java:117)
at java.util.zip.ZipFile.&lt;init&gt;(ZipFile.java:90)
at java.util.jar.JarFile.&lt;init&gt;(JarFile.java:173)
at
org.apache.harmony.luni.internal.net.www.protocol.jar.JarURLConnection.openJarFile(JarURLConnection.java:237)
at
org.apache.harmony.luni.internal.net.www.protocol.jar.JarURLConnection.findJarFile(JarURLConnection.java:175)
at
org.apache.harmony.luni.internal.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:142)
at
org.apache.harmony.luni.internal.net.www.protocol.jar.JarURLConnection.getInputStream(JarURLConnection.java:297)
at java.net.URL.openStream(URL.java:645)
at test.Bug.test(Bug.java:12)
[classlib][awt] AffineTransform.transform(float[], int, float[], int, int) result deffers from RI if src and dst are the same array
Harmony AffineTransform methods transform(float[], int, float[], int, int) and transform(double[], int, double[], int, int) results differ from RI if src and dst are the same array and coordinate sections are overlapping.
Harmony doesn't follow spec.
============ Spec =================
Transforms an array of floating point coordinates by this transform. The two coordinate array sections can be exactly the same or can be overlapping sections of the same array without affecting the validity of the results. This method ensures that no source coordinates are overwritten by a previous operation before they can be transformed. The coordinates are stored in the arrays starting at the specified offset in the order [x0, y0, x1, y1, ..., xn, yn]. 
Transforms an array of double precision coordinates by this transform. The two coordinate array sections can be exactly the same or can be overlapping sections of the same array without affecting the validity of the results. This method ensures that no source coordinates are overwritten by a previous operation before they can be transformed. The coordinates are stored in the arrays starting at the indicated offset in the order [x0, y0, x1, y1, ..., xn, yn]. 
=============== Test.java =================
import java.awt.geom.AffineTransform;
import java.awt.geom.Point2D;
public class Test {
static public void main(String[] args) { 
AffineTransform t = AffineTransform.getTranslateInstance(2, 3);
float[] points1 = new float[] {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14};
t.transform(points1, 0, points1, 4, 4);
for(int i = 0; i &lt; points1.length; i++) {
System.out.print(points1[i] + &quot;, &quot;);
}
System.out.println();
double[] points2 = new double[] {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14};
t.transform(points2, 0, points2, 4, 4);
for(int i = 0; i &lt; points2.length; i++) {
System.out.print(points2[i] + &quot;, &quot;);
} 
}
}
============= RI =================
1.0, 2.0, 3.0, 4.0, 3.0, 5.0, 5.0, 7.0, 7.0, 9.0, 9.0, 11.0, 13.0, 14.0, 
1.0, 2.0, 3.0, 4.0, 3.0, 5.0, 5.0, 7.0, 7.0, 9.0, 9.0, 11.0, 13.0, 14.0, 
======== Harmony ================
1.0, 2.0, 3.0, 4.0, 3.0, 5.0, 5.0, 7.0, 5.0, 8.0, 7.0, 10.0, 13.0, 14.0, 
1.0, 2.0, 3.0, 4.0, 3.0, 5.0, 5.0, 7.0, 5.0, 8.0, 7.0, 10.0, 13.0, 14.0, 
[drlvm][jit][opt] Several bugs in Jitrino.OPT fixed
The patch fixes the following issues in Jitrino codegenerator:
FCMP&lt;op&gt; instructions work wrong when one of params is NaN (IA-32 platform)
Double compare with NaN behaves incorrectly on Intel64
This JIRA depends on Harmony-1363.
[classlib][swing] javax.swing.JEditorPaneTest failed
This test javax.swing.JEditorPaneTest failed and was excluded from test list.
[classlib][jndi] compatibility: ctor SearchResult(null, ...) throws IllegalArgumentException on Harmony and creates object on RI
The constructor javax.naming.directory.SearchResult.SearchResult(String name, String className, Object obj, Attributes attrs, boolean isRelative) throws IllegalArgumentException on Harmony and creates object on RI if name == null or attrs == null.
The spec says:
&quot;name - The non-null name of the search item
attrs - ... Cannot be null.&quot; so it is 'non-bug diff'
==================== test.java =======================
import javax.naming.directory.SearchResult;
import javax.swing.plaf.basic.BasicTableUI;
public class test {
public static void main(String args[]) {
System.out.println(&quot;res = &quot; + new SearchResult(null, &quot;&quot;, new BasicTableUI(), null, false));
}
}
==================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
res = (not relative)null: :javax.swing.plaf.basic.BasicTableUI@1b35ed:null
C:\tmp\tmp17&gt;C:\harmony\classlib1.5\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: name must not be null
at javax.naming.NameClassPair.&lt;init&gt;(NameClassPair.java:112)
at javax.naming.Binding.&lt;init&gt;(Binding.java:14)
at javax.naming.directory.SearchResult.&lt;init&gt;(SearchResult.java:176)
at test.main(test.java:6)
[classlib][jndi] no InvalidNameException for CompoundName.addAll()
The method CompoundName().addAll() works silently on Harmony and throws InvalidNameException on RI.
==================== test.java ============================
import javax.naming.*;
import java.util.Properties;
public class test {
public static void main(String args[]) throws Exception {
new CompoundName(&quot;aaa&quot;, new Properties()).addAll(new CompoundName(&quot;bbb&quot;, new Properties()));
}
}
=======================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
javax.naming.InvalidNameException: A flat name can only have a single component
at javax.naming.NameImpl.addAll(NameImpl.java:621)
at javax.naming.CompoundName.addAll(CompoundName.java:442)
at test.main(test.java:6)
C:\tmp\tmp17&gt;C:\harmony\classlib1.5\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
C:\tmp\tmp17&gt;C:\harmony\drlvm1.5\build\win_ia32_msvc_debug\deploy\jre\bin\java -Dvm.assert_dialog=false -cp . -showversion test
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r431304, (Aug 14 2006), Windows/ia32/msvc 1310, debug build
http://incubator.apache.org/harmony
[classlib][luni]Compatibility: java.net.URL new URL(&quot;ss&quot;, null, -3, null) throws MalformedURLException while RI throws NPE
Compatibility. Different order of exceptions.
RI throws unspecified NPE in java.net.URL(&quot;ss&quot;, null, -3, null) constructor if host ==null while Harmony at first checks port and throws MalformedURLException.
If host != null both RI and Harmony throw MalformedURLException.
=============test.java=============
import java.net.*;
public class test {
public static void main (String[] args) {
try {
new URL(&quot;ss&quot;, &quot;0&quot;, -3, null);
} catch (Exception e) {
e.printStackTrace();
}
try {
new URL(&quot;ss&quot;, null, -3, null);
} catch (Exception e) {
e.printStackTrace();
}
}
}
=======================================
Output on RI:
java.net.MalformedURLException: Invalid port number :-3
at java.net.URL.&lt;init&gt;(URL.java:373)
at java.net.URL.&lt;init&gt;(URL.java:283)
at test.main(test.java:7)
java.lang.NullPointerException
at java.net.Parts.&lt;init&gt;(URL.java:1259)
at java.net.URL.&lt;init&gt;(URL.java:380)
at java.net.URL.&lt;init&gt;(URL.java:283)
at test.main(test.java:13)
Output on Harmony:
java.net.MalformedURLException: Port out of range: -3
at java.net.URL.&lt;init&gt;(URL.java:393)
at java.net.URL.&lt;init&gt;(URL.java:367)
at test.main(test.java:7)
java.net.MalformedURLException: Port out of range: -3
at java.net.URL.&lt;init&gt;(URL.java:393)
at java.net.URL.&lt;init&gt;(URL.java:367)
[classlib][net] unexpected URISyntaxException for URI.parseServerAuthority()
The Harmony method URI.parseServerAuthority() throws URISyntaxException for uri 'file://C:/1.txt' while RI returns correct value.
==================== test.java =====================
import java.net.*;
public class test { 
public static void main (String[] args) throws Exception {
System.out.println(&quot;res = &quot; + URI.create(&quot;file://C:/1.txt&quot;).parseServerAuthority());
} 
}
================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
res = file://C:/1.txt
C:\tmp\tmp17&gt;C:\harmony\classlib1.5\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Exception in thread &quot;main&quot; java.net.URISyntaxException: Invalid port number at index 2: C:
at java.net.URI$Helper.parseAuthority(URI.java:417)
at java.net.URI$Helper.access$1500(URI.java:22)
at java.net.URI.parseServerAuthority(URI.java:1217)
at test.main(test.java:6)
[classlib][math]exception compatibility: new BigInteger(Integer.MAX_VALUE, (Random)null)
Different exception behaviour when create a huge BigInteger. 
Actually it's impossible to create BigInteger with numBits=Integer.MAX_VALUE, but RI throws an Exception while Harmony throws an Error.
Test --------------------------------------------------------------
mport java.math.BigInteger;
import java.util.Random;
public class bug9282 {
public static void main(String args[] ) {
new BigInteger(Integer.MAX_VALUE, (Random)null);
} 
}
Output -------------------------------------------------------
RI
java.lang.NegativeArraySizeException: Negative size-268435455
at java.math.BigInteger.randomBits(BigInteger.java:471)
at java.math.BigInteger.&lt;init&gt;(BigInteger.java:464)
at bug9282.main(bug9282.java:6)
Harmony
java.lang.OutOfMemoryError
&lt;no stack trace available&gt;
[classlib][drlvm] VM crashed on the java.lang.Thread.countStackFrames() call
The spec says for the method java.lang.Thread.countStackFrames() 
&quot;Returns: the number of stack frames in this thread. Throws: IllegalThreadStateException - if this thread is not suspended.&quot; 
but DRLVM crashed while implementation of this class in the luni-kernel module should return 0 (it is correct for all implementations).
=================== test.java ======================
public class test { 
public static void main (String[] args) { 
System.out.println(&quot;res = &quot; + new Thread(new Thread()).countStackFrames());
} 
} 
================================================
Output:
C:\tmp\tmp17&gt;C:\jdk1.5.0_06\bin\java.exe -cp . -showversion test
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
res = 0
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
res = 0
C:\tmp\tmp17&gt;C:\harmony\drlvm\trunk\build\win_ia32_msvc_debug\deploy\jre\bin\java -Dvm.assert_dialog=false -cp . -showversion test
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r425618, (Jul 26 2006), Windows/ia32/msvc 1310, debug build
http://incubator.apache.org/harmony
ERROR: Destructive unwinding: C++ objects detected on stack!
droping 0x05D4F8F0
setting curr 0x05D4FA84
java.lang.UnsatisfiedLinkError: armo
at java.lang.Thread.countStackFrames()
at test.main(test.java:3)
C:\tmp\tmp17&gt;C:\harmony\drlvm\trunk\build\win_ia32_msvc_release\deploy\jre\bin\java -Dvm.assert_dialog=false -cp . -showversion test
java version &quot;1.5.0&quot;
pre-alpha : not complete or compatible
svn = r425618, (Jul 26 2006), Windows/ia32/msvc 1310, release build
http://incubator.apache.org/harmony
ERROR: Destructive unwinding: C++ objects detected on stack!
droping 0x05C0FBEC
setting curr 0x05C0FF68
java.lang.UnsatisfiedLinkError:
at java.lang.Thread.countStackFrames()
at test.main(test.java:3)
[classlib][drlvm] no IllegalArgumentException for java.lang.Thread.join(long,int) when parameters are incorrect
The Harmony method java.lang.Thread.join(long,int) does not throw IllegalArgumentException for incorrect parameters while spec requires it. The j2se spec says: throws IllegalArgumentException - if the value of millis is negative the value of nanos is not in the range 0-999999. 
==================== test.java =========================
public class test { 
public static void main(String[] args) {
Thread th = new Thread();
long mls = 688204075024689866L;
int nn = -10000;
try {
th.join(mls, nn);
System.out.println(&quot;Test failed&quot;);
} catch (IllegalArgumentException e) {
System.out.println(&quot;1. Test passed: &quot;+ e);
} catch (Throwable e) {
System.out.println(&quot;Test failed: unexpected error&quot;);
e.printStackTrace();
}
mls = -1000000000000L;
nn = 90000;
try {
th.join(mls, nn);
System.out.println(&quot;Test failed&quot;);
} catch (IllegalArgumentException e) {
System.out.println(&quot;2. Test passed: &quot;+ e);
} catch (Throwable e) {
System.out.println(&quot;Test failed: unexpected error&quot;);
e.printStackTrace();
}
mls = 10000000000000L;
nn = 1000001;
try {
th.join(mls, nn);
System.out.println(&quot;Test failed&quot;);
} catch (IllegalArgumentException e) {
System.out.println(&quot;3. Test passed: &quot;+ e);
} catch (Throwable e) {
System.out.println(&quot;Test failed: unexpected error&quot;);
e.printStackTrace();
}
}
}
====================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
1. Test passed: java.lang.IllegalArgumentException: nanosecond timeout value out of range
2. Test passed: java.lang.IllegalArgumentException: timeout value is negative
3. Test passed: java.lang.IllegalArgumentException: nanosecond timeout value out of range
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
1. Test passed: java.lang.IllegalArgumentException
2. Test passed: java.lang.IllegalArgumentException
3. Test passed: java.lang.IllegalArgumentException
C:\tmp\tmp17&gt;C:\harmony\drlvm\trunk\build\win_ia32_msvc_debug\deploy\jre\bin\ij -cp . -showversion test
Apache Harmony DRLVM HEAD-4807 (2006-05-02), Windows/ia32/msvc 1310, debug
Test failed
Test failed
Test failed
[classlib][security] compatibility: different exceptions for java.security.Signature getInstance(null, Provider) and sign([],int,int) methods
The Harmony throws NoSuchProviderException and SignatureException while RI throws NullPointerException and IllegalArgumentException for java.security.Signature getInstance(null, Provider) and sign([],int,int) methods
================= test.java =======================
import java.security.*;
public class test {
public static void main (String[] args) { 
try { 
Signature.getInstance(null, &quot;phj&quot;); 
} catch (Exception e) {
e.printStackTrace(); 
}
try { 
Signature.getInstance(&quot;SHA1withRSA&quot;).sign(new byte[] {2}, 4, 5);
} catch (Exception e) {
e.printStackTrace(); 
} 
}
}
===============================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.lang.NullPointerException
at java.security.Signature.getInstance(Signature.java:320)
at test.main(test.java:6)
java.lang.IllegalArgumentException: Output buffer too small for specified offset and length
at java.security.Signature.sign(Signature.java:567)
at test.main(test.java:11)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.security.NoSuchProviderException: Provider phj is not available
at java.security.Signature.getInstance(Signature.java:121)
at test.main(test.java:6)
java.security.SignatureException: Signature object is not initialized properly.
at java.security.Signature.sign(Signature.java:256)
at test.main(test.java:11)
[classlib][jndi] dead code in javax.naming.spi.DirectoryManager
There are two dead blocks in DirectoryManager:
Context nextContext = null;
try {
nextContext = NamingManager.getContinuationContext(cpe);
} catch (CannotProceedException e) {
// tolerate CannotProceedException here
}
// if it is a DirContext
if (nextContext instanceof DirContext) {
// return as DirContext
return (DirContext) nextContext;
} else if (nextContext instanceof Context) { &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; always true
// in case it's Context but not DirContext, wrap it as DirContext and return
return new Context2DirContextWrapper(nextContext, cpe);
} else { &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; dead block
// return a dummy DirContext, even if no context is obtained
return new Context2DirContextWrapper(null, cpe);
}
and
if (ctx instanceof Context) { &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; always true
return ctx;
}
cpe.fillInStackTrace(); &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; dead block
throw cpe;
I'm not sure how to fix it. Seems like special care for null should be done
Hadoop EC2 scripts are not executable
The build script needs to make the scripts under src/contrib/bin executable when packaging them up in the tar file.
Also worth making the small changes mentioned by Doug in HADOOP-884 (adding a README and a template config file) at the same time.
TestCheckpoint fails on Windows
The new unit test that tests periodic checkpointing fails on Windows. The problem is that the method FSEditLog.purgeEditLog() uses renameTo() to atomically move edits.new to edits
File.renameTo() fails on Windows is not atomic: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4017593
I propose that we change this code to first try the renameTo(). If it fails, then it deletes edits and then renames edits.new to edits. 
reduce hangs after applying HADOOP-248 on 20 node cluster
After HADOOP-248 was committed, my benchmarks started to hang. Running TestDFSIO on 20 nodes, the job's single reduce is hanging. Annodated logs from the task tracker running the reduce are included in the next comment. I have reverted the patch using:
cd $trunk_dir
svn merge -r 500410:500397 .
and reran some benchmarks. They all pass.
data node re-registration
A name node should ask a data node to re-register when
1) the name node restarts; or
2) the name node receives a heartbeat from an unregistered data node; or
3) the name node recieves a heartbeat from a data node whose heart beat is lost.
In response to the re-registration request, the data node sends a register request followed by a block report.
Abacus should not delete the output dir
The current behavior of the Abacus tries to delete the output dir specified in the user's job.
This is not desirable.
Abacus should fail if the output dir already exists.
TaskTracker sends duplicate status when updating task metrics throws exception
When updating the TaskTracker metrics repeatedly throws an exception, the TaskTracker repeatedly sends status events to the JobTracker. This seems to get the JobTracker into a funny state.
See annotated logs below
TaskTracker log:
2007-01-21 23:51:03,555 INFO org.apache.hadoop.mapred.TaskTracker: LaunchTaskAction: task_0001_m_000000_0
2007-01-21 23:51:05,669 INFO org.apache.hadoop.mapred.TaskTracker: task_0001_m_000000_0 0.0% writing -1539638179018996759@438272/1858392
2007-01-21 23:51:06,722 INFO org.apache.hadoop.mapred.TaskTracker: task_0001_m_000000_0 0.0% wrote 7041109562936259497
2007-01-21 23:51:07,784 INFO org.apache.hadoop.mapred.TaskTracker: task_0001_m_000000_0 0.0% wrote -3327068643288265619
2007-01-21 23:51:08,819 INFO org.apache.hadoop.mapred.TaskTracker: task_0001_m_000000_0 0.0% wrote -53923196326936926
2007-01-21 23:51:09,322 INFO org.apache.hadoop.mapred.TaskTracker: task_0001_m_000000_0 1.0% wrote -3407225283463353195
2007-01-21 23:51:09,323 INFO org.apache.hadoop.mapred.TaskTracker: Task task_0001_m_000000_0 is done.
2007-01-21 23:51:09,391 ERROR org.apache.hadoop.mapred.TaskTracker: Caught exception: org.apache.hadoop.metrics.MetricsException:
at foo.Bar.setMetric(Unknown Source)
at org.apache.hadoop.mapred.TaskTracker$TaskTrackerMetrics.completeTask(TaskTracker.java:135)
at org.apache.hadoop.mapred.TaskTracker.transmitHeartBeat(TaskTracker.java:604)
at org.apache.hadoop.mapred.TaskTracker.offerService(TaskTracker.java:495)
at org.apache.hadoop.mapred.TaskTracker.run(TaskTracker.java:852)
at org.apache.hadoop.mapred.TaskTracker.main(TaskTracker.java:1494)
2007-01-21 23:51:14,057 INFO org.apache.hadoop.mapred.TaskTracker: Resending 'status' to 'jobtrackerhost' with reponseId '21
2007-01-21 23:51:14,060 ERROR org.apache.hadoop.mapred.TaskTracker: Caught exception: org.apache.hadoop.metrics.MetricsException:
at foo.Bar.setMetric(Unknown Source)
at org.apache.hadoop.mapred.TaskTracker$TaskTrackerMetrics.completeTask(TaskTracker.java:135)
at org.apache.hadoop.mapred.TaskTracker.transmitHeartBeat(TaskTracker.java:604)
at org.apache.hadoop.mapred.TaskTracker.offerService(TaskTracker.java:495)
at org.apache.hadoop.mapred.TaskTracker.run(TaskTracker.java:852)
at org.apache.hadoop.mapred.TaskTracker.main(TaskTracker.java:1494)
2007-01-21 23:51:14,060 INFO org.apache.hadoop.mapred.TaskTracker: Resending 'status' to 'jobtrackerhost' with reponseId '22
2007-01-21 23:51:14,063 ERROR org.apache.hadoop.mapred.TaskTracker: Caught exception: org.apache.hadoop.metrics.MetricsException:
at foo.Bar.setMetric(Unknown Source)
at org.apache.hadoop.mapred.TaskTracker$TaskTrackerMetrics.completeTask(TaskTracker.java:135)
at org.apache.hadoop.mapred.TaskTracker.transmitHeartBeat(TaskTracker.java:604)
at org.apache.hadoop.mapred.TaskTracker.offerService(TaskTracker.java:495)
at org.apache.hadoop.mapred.TaskTracker.run(TaskTracker.java:852)
at org.apache.hadoop.mapred.TaskTracker.main(TaskTracker.java:1494)
...
[these messages continue forever with each status sent to jobtrackerhost having an increasing responseId]
JobTracker log:
2007-01-21 23:51:03,500 INFO org.apache.hadoop.mapred.JobInProgress: Choosing normal task tip_0001_m_000000
2007-01-21 23:51:03,511 INFO org.apache.hadoop.mapred.JobTracker: Adding task 'task_0001_m_000000_0' to tip tip_0001_m_000000, for tracker 'tracker:50050'
2007-01-21 23:51:03,569 INFO org.apache.hadoop.mapred.JobInProgress: Choosing normal task tip_0001_r_000000
2007-01-21 23:51:03,577 INFO org.apache.hadoop.mapred.JobTracker: Adding task 'task_0001_r_000000_0' to tip tip_0001_r_000000, for tracker 'tracker2:50050'
2007-01-21 23:51:09,386 INFO org.apache.hadoop.mapred.JobInProgress: Task 'task_0001_m_000000_0' has completed tip_0001_m_000000 successfully.
2007-01-21 23:51:09,389 INFO org.apache.hadoop.mapred.TaskInProgress: Task 'task_0001_m_000000_0' has completed.
2007-01-21 23:51:14,059 WARN org.apache.hadoop.mapred.TaskInProgress: Recieved duplicate status update of 'SUCCEEDED' for 'task_0001_m_000000_0' of TIP 'tip_0001_m_000000'
2007-01-21 23:51:14,062 WARN org.apache.hadoop.mapred.TaskInProgress: Recieved duplicate status update of 'SUCCEEDED' for 'task_0001_m_000000_0' of TIP 'tip_0001_m_000000'
2007-01-21 23:51:14,064 WARN org.apache.hadoop.mapred.TaskInProgress: Recieved duplicate status update of 'SUCCEEDED' for 'task_0001_m_000000_0' of TIP 'tip_0001_m_000000'
2007-01-21 23:51:14,066 WARN org.apache.hadoop.mapred.TaskInProgress: Recieved duplicate status update of 'SUCCEEDED' for 'task_0001_m_000000_0' of TIP 'tip_0001_m_000000'
... [there are hundreds of these identical messages]
2007-01-21 23:51:16,441 WARN org.apache.hadoop.mapred.TaskInProgress: Recieved duplicate status update of 'SUCCEEDED' for 'task_0001_m_000000_0' of TIP 'tip_0001_m_000000'
2007-01-21 23:51:16,442 WARN org.apache.hadoop.mapred.TaskInProgress: Recieved duplicate status update of 'SUCCEEDED' for 'task_0001_m_000000_0' of TIP 'tip_0001_m_000000'
2007-01-21 23:51:16,444 INFO org.apache.hadoop.mapred.JobInProgress: Task 'task_0001_r_000000_0' has completed tip_0001_r_000000 successfully.
2007-01-21 23:51:16,446 INFO org.apache.hadoop.mapred.TaskInProgress: Task 'task_0001_r_000000_0' has completed.
2007-01-21 23:51:16,456 INFO org.apache.hadoop.mapred.JobInProgress: Job job_0001 has completed successfully.
2007-01-21 23:51:16,459 INFO org.apache.hadoop.mapred.JobTracker: Removed completed task 'task_0001_r_000000_0' from 'tracker2:50050'
2007-01-21 23:51:16,460 WARN org.apache.hadoop.mapred.TaskInProgress: Recieved duplicate status update of 'SUCCEEDED' for 'task_0001_m_000000_0' of TIP 'tip_0001_m_000000'
2007-01-21 23:51:16,460 INFO org.apache.hadoop.mapred.JobTracker: Removed completed task 'task_0001_m_000000_0' from 'tracker:50050'
2007-01-21 23:51:16,462 INFO org.apache.hadoop.mapred.JobTracker: Serious problem. While updating status, cannot find taskid task_0001_m_000000_0
2007-01-21 23:51:16,463 INFO org.apache.hadoop.mapred.JobTracker: Serious problem. While updating status, cannot find taskid task_0001_m_000000_0
2007-01-21 23:51:16,465 INFO org.apache.hadoop.mapred.JobTracker: Serious problem. While updating status, cannot find taskid task_0001_m_000000_0
...
[these messages continue forever]
PhasedFileSystem should implement get/set configuration
PhasedFileSystem doesnt channel get/set configuration to base file system
Optimize small reads and seeks
A seek on a DFSInputStream causes causes the next read to re-open the socket connection to the datanode and fetch the remainder of the block all over again. This is not optimal.
A small read followed by a small positive seek could re-utilize the data already fetched from the datanode as part of the previous read.
MapFileOutputFormat and SequenceFileOutputFormat use incorrect key/value classes in map/reduce tasks
Let's assume a job uses different key/value class for the output of map tasks and for the final output of reduce tasks.
When executing map tasks classes returned from JobConf.getMapOutputKeyClass() / getMapOutputValueClass() should be used, and when executing reduce tasks classes returned from JobConf.gtOutputKeyClass() / getOutputValueClass() should be used.
Currently both map and reduce tasks will use getMapOutputKeyClass/getMapOutputValueClass when using MapFileOutputFormat, or they will always use getOutputKeyClassgetOutputValueClass when using SequenceFileOutputFormat. This causes exceptions, because Mapper / Reducer implementations will output different key/value classes than expected.
HADOOP-908 patch causes javadoc warnings
[javadoc] /home/ndaley/hadoop/912/src/contrib/abacus/src/java/org/apache/hadoop/abacus/JobBase.java:108: warning - @return tag has no arguments.
[javadoc] /home/ndaley/hadoop/912/src/contrib/abacus/src/java/org/apache/hadoop/abacus/UserDefinedValueAggregatorDescriptor.java:90: warning - @param argument &quot;valiput&quot; is not aparameter name.
[javadoc] /home/ndaley/hadoop/912/src/contrib/abacus/src/java/org/apache/hadoop/abacus/ValueAggregatorBaseDescriptor.java:115: warning - @param argument &quot;valiput&quot; is not a parameter name.
[javadoc] /home/ndaley/hadoop/912/src/contrib/abacus/src/java/org/apache/hadoop/abacus/ValueAggregatorCombiner.java:49: warning - @param argument &quot;key:&quot; is not a parameter name.
[javadoc] /home/ndaley/hadoop/912/src/contrib/abacus/src/java/org/apache/hadoop/abacus/ValueAggregatorDescriptor.java:57: warning - @param argument &quot;valiput&quot; is not a parameter name.
[javadoc] /home/ndaley/hadoop/912/src/contrib/abacus/src/java/org/apache/hadoop/abacus/ValueHistogram.java:48: warning - @param argument &quot;the&quot; is not a parameter name.
TestMiniMRWithDFS fails sporadically
TestMiniMRWithDFS fails sporadically with the following error:
junit.framework.AssertionFailedError: Spurious directory task_0001_m_000008_0 found in C:\hudson\workspace\Hadoop-WindowsSmokeTest\trunk\build\test\mapred\local\50068_0
at org.apache.hadoop.mapred.TestMiniMRWithDFS.checkTaskDirectories(TestMiniMRWithDFS.java:128)
at org.apache.hadoop.mapred.TestMiniMRWithDFS.testWithDFS(TestMiniMRWithDFS.java:163)
This tests checks that all mapred.local.dirs have been cleaned up after running a mapred job on MiniMRCluster. Effectively, this tests waits for TaskTracker.isIdle() to return true before checking the dirs have been cleaned up. I believe that HADOOP-639 reordered the cleanup code so that isIdle() will return true before the directory cleanup is complete.
dfs &quot;du&quot; shows that the size of a subdirectory is 0
dfs &quot;du&quot; is implemented by sending a listPaths request to the namenode to get the size of each file/subdir under the directory. At the namenode side, the size of subdir was calculated by recursively going through the whole subtree with the subdir as the root. But starting from the release 0.10.0, the size of subdir is no longer gets calculated. So dfs &quot;du&quot; shows its size as 0.
The problem is that both &quot;du&quot; and &quot;list&quot; send the same request &quot;listPaths&quot; to the namenode. The previous implmentation made list very expensive, but the current implementation makes du not working.
NPE in DFSOutputStream.closeBackupStream()
After HADOOP-757 is checked in, Devraj noticed following NPE:
java.lang.NullPointerException
at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.closeBackupStream(DFSClient.java:972)
at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.endBlock(DFSClient.java:1219)
at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.flush(DFSClient.java:1181)
at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.write(DFSClient.java:1163)
at org.apache.hadoop.fs.FSDataOutputStream$Summer.write(FSDataOutputStream.java:85)
at org.apache.hadoop.fs.FSDataOutputStream$PositionCache.write(FSDataOutputStream.java:114)
at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
at java.io.DataOutputStream.flush(DataOutputStream.java:106)
at java.io.FilterOutputStream.close(FilterOutputStream.java:140)
at org.apache.hadoop.io.SequenceFile$Writer.close(SequenceFile.java:558)
at org.apache.hadoop.mapred.SequenceFileOutputFormat$1.close(SequenceFileOutputFormat.java:72)
at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:331)
at org.apache.hadoop.mapred.TaskTracker$Child.main(TaskTracker.java:1367)
I will submit a patch after confirming its ok for backupStream to be null at this stage.
Removal of deprecated code (in v0.10.0) from trunk breaks libhdfs
Some of the code removed as part of HADOOP-781 caused libhdfs to break, since the use of deprecated methods was not discontinued there.
namenode generates infinite stream of null pointers
My namenode is generating a constant stream of NullPointerExceptions. The log looks like:
2007-01-17 19:51:27,461 INFO org.apache.hadoop.ipc.Server: IPC Server handler 3
on 50000 call error: java.io.IOException: java.lang.NullPointerException
java.io.IOException: java.lang.NullPointerException
at org.apache.hadoop.dfs.FSNamesystem.addStoredBlock(FSNamesystem.java:1621)
at org.apache.hadoop.dfs.FSNamesystem.processReport(FSNamesystem.java:1563)
at org.apache.hadoop.dfs.NameNode.blockReport(NameNode.java:573)
at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:589)
at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:337)
at org.apache.hadoop.ipc.Server$Handler.run(Server.java:538)
thousands of TimerThreads created by metrics API
When running the smallJobsBenchmark with 180 maps and hadoop metrics logging to a file 
(ie hadoop-metrics.properties file contains 
dfs.class=org.apache.hadoop.metrics.file.FileContext
mapred.class=org.apache.hadoop.metrics.file.FileContext)
then I get this error:
org.apache.hadoop.ipc.RemoteException: java.io.IOException: java.lang.OutOfMemoryError: unable to create new native thread
at java.lang.Thread.start0(Native Method)
at java.lang.Thread.start(Thread.java:574)
at org.apache.hadoop.ipc.Client.getConnection(Client.java:517)
at org.apache.hadoop.ipc.Client.call(Client.java:452)
at org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:164)
at org.apache.hadoop.dfs.$Proxy0.isDir(Unknown Source)
at org.apache.hadoop.dfs.DFSClient.isDirectory(DFSClient.java:325)
at org.apache.hadoop.dfs.DistributedFileSystem.isDirectory(DistributedFileSystem.java:167)
at org.apache.hadoop.fs.FileUtil.copy(FileUtil.java:82)
at org.apache.hadoop.dfs.DistributedFileSystem.copyToLocalFile(DistributedFileSystem.java:222)
at org.apache.hadoop.fs.FileSystem.copyToLocalFile(FileSystem.java:842)
at org.apache.hadoop.mapred.JobInProgress.&lt;init&gt;(JobInProgress.java:86)
at org.apache.hadoop.mapred.JobTracker.submitJob(JobTracker.java:1338)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:337)
at org.apache.hadoop.ipc.Server$Handler.run(Server.java:538)
at org.apache.hadoop.ipc.Client$Connection.run(Client.java:258)
Using jconsole, I see that 2000+ of these threads were created:
Name: Timer-101
State: TIMED_WAITING on java.util.TaskQueue@1501026
Total blocked: 0 Total waited: 5
Stack trace: 
java.lang.Object.wait(Native Method)
java.util.TimerThread.mainLoop(Timer.java:509)
java.util.TimerThread.run(Timer.java:462)
The only use of the java.util.Timer API is in org.apache.hadoop.metrics.spi.AbstractMetricsContext.
job history web/ui does not count task failures correctly
The archived job history displays the count of tips that failed, which is almost always 0, instead of the number of task attempts that failed, which is a lot more interesting.
Recursive delete for an S3 directory does not actually delete files or subdirectories
Here is the bug report from Michael Stack:
Here I'm listing a BUCKET directory that was copied up using 'hadoop
fs', then rmr'ing it and then listing again:
stack@bregeon:~/checkouts/hadoop$ ./bin/hadoop fs -fs
s3://ID:SECRET@BUCKET -ls /fromfile
Found 2 items
/fromfile/diff.txt &lt;r 1&gt; 591
/fromfile/x.js &lt;r 1&gt; 2477
stack@bregeon:~/checkouts/hadoop$ ./bin/hadoop fs -fs
s3://ID:SECRET@BUCKET -rmr /fromfile
Deleted /fromfile
stack@bregeon:~/checkouts/hadoop$ ./bin/hadoop fs -fs
s3://ID:SECRET@BUCKET -ls /fromfile
Found 0 items
The '0 items' is odd because, now, listing my BUCKET using a tool other
than 'hadoop fs' (i.e. hanzo webs python scripts):
stack@bregeon:~/checkouts/hadoop.trunk$ s3ls BUCKET
%2F
%2Ffromfile%2F.diff.txt.crc
%2Ffromfile%2F.x.js.crc
%2Ffromfile%2Fdiff.txt
%2Ffromfile%2Fx.js
block_-5013142890590722396
block_5832002498000415319
block_6889488315428893905
block_9120115089645350905
Its all still there still. I can subsequently do the likes of the
following:
stack@bregeon:~/checkouts/hadoop$ ./bin/hadoop fs -fs
s3://ID:SECRET@BUCKET -rmr /fromfile/diff.txt
... and the delete will succeed and looking at the bucket with alternate
tools shows that it has actually been remove, and so on up the hierarchy.
SequenceFileInputFormat can no longer read from data produced by MapFileOutputFormat
The call to validateInput() happens before listPaths(). listPaths() will allow MapFile inputs, but validateInput() fails on directories.
native libraries aren't loaded unless the user specifies the java.library.path in the child jvm options
The TaskRunner adds the setting of the java.library.path after the class name, which makes it an argument to the main of the TaskTracker.Child. It should be added to the command line before the class name.
java.library.path is wrongly initialized by bin/hadoop when only pre-built libs are present, but custom-built ones aren't
bin/hadoop assumes presence of custom-libs and doesn't check it - resulting in wrong java.library.path.
Straight-forward fix is to check and add the ':' only if custom-libs are present.
Fix the merge method on Maps to limit the number of open files
The mergeParts method should not hardcode the factor for the merge and instead rely on the configured default. Also, there is an unnecessary open call made in the method.
dfs -get should remove existing crc file if -crc is not specified
When we added -crc option to dfs -get (aka dfs -copyToLocal) the absence of this command-line option implies not copying the crc file associated with hdfs file. However, if the checksum file already exists, it will not correspond with the newly copied data file, and opening it would cause checksum failure. The solution is to remove any existing crc file corresponding to the data file if -crc option is not given for -get. Patch forthcoming.
Files written to S3 but never closed can't be deleted
I've been playing with the S3 integration. My first attempts to use it are actually as a drop-in replacement for a backup job, streaming data offsite by piping the backup job output to a &quot;hadoop dfs -put - targetfile&quot;.
If enough errors occur posting to S3 (this happened easily last Thursday, during an S3 growth issue), the write can eventually fail. At that point, there are both blocks and a partial INode written into S3. Doing a &quot;hadoop dfs -ls filename&quot; shows the file, it has a non-zero size, etc. However, trying to &quot;hadoop dfs -rm filename&quot; a failed-written file results in the response &quot;rm: No such file or directory.&quot;
bin/hadoop jar throws file creation exception for temp files
bin/hadoop throw file creation exception if hadoop.tmp.dir doesn't exist. 
$ bin/hadoop jar build/hadoop-streaming.jar 
Exception in thread &quot;main&quot; java.io.IOException: No such file or directory
at java.io.UnixFileSystem.createFileExclusively(Native Method)
at java.io.File.checkAndCreate(File.java:1345)
at java.io.File.createTempFile(File.java:1434)
at org.apache.hadoop.util.RunJar.main(RunJar.java:109)
it should create the hadoop.tmp.dir before trying File.createTempFile
MapTask prints info log message when the progress-reporting thread starts
One LOG.info in MapTask.java (in the run method of the progress-reporting thread) should be changed to LOG.debug for maintaining consistency with what is logged at debug/info levels.
fsck reports a non-existant DFS path as healthy
I would have expected the following to generate an error message:
-bash-3.00$ bin/hadoop fsck non-existant
Status: HEALTHY
Total size: 0 B
Total blocks: 0
Total dirs: 0
Total files: 0
Over-replicated blocks: 0
Under-replicated blocks: 0
Target replication factor: 3
Real replication factor: 0.0
The filesystem under path 'non-existant' is HEALTHY
HDFS should repair corrupted files
While reading if we discover a mismatch between a block and checksum, we want to report this back to the namenode to delete the corrupted block or crc.
To implement this, we need to do the following:
DFSInputStream
1. move DFSInputStream out of DFSClient
2. add member variable to keep track of current datanode (the chosen node)
DistributedFileSystem
1. change reportChecksumFailure parameter crc from int to FSInputStream (needed to be able to delete it). 
2. determine specific block and datanode from DFSInputStream passed to reportChecksumFailure 
3. call namenode to delete block/crc vis DFSClient
ClientProtocol
1. add method to ask namenode to delete certain blocks on specifc datanode.
Namenode
1. add ability to delete certain blocks on specific datanode
randomwriter fails with 'java.lang.OutOfMemoryError: Java heap space' in the 'reduce' task
Reproducible, tried to increase the child jvm's heapsize via 
&lt;property&gt;
&lt;name&gt;mapred.child.java.opts&lt;/name&gt;
&lt;value&gt;-Xmx512m&lt;/value&gt;
&lt;/property&gt;
without any difference, still fails.
Need to investigate further.
Progress report is not sent during the intermediate sorts in the map phase
Have seen tasks getting lost at the TaskTracker's end due to MapTask's progress not getting reported for a long time (the configured timeout). The progress report is currently not sent in the intermediate sort phases in the MapTask. But, if for some reason, the sort takes a long time, the TaskTracker might kill the task.
the task tracker is getting blocked by long deletes of local files
The task tracker is getting blocked in the main heartbeat loop by doing task cleanups in the main thread. We need to queue up the cleanup actions and work on them offline. This should make our task trackers not miss heartbeats and thus get lost.
Investigate and fix the extremely large memory-footprint of JobTracker
The JobTracker's memory footprint seems excessively large, especially when many jobs are submitted.
Here is the 'top' output of a JobTracker which has scheduled ~1k jobs thus far:
PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 
31877 arunc 19 0 2362m 261m 13m S 14.0 12.9 24:48.08 java 
Clearly VIRTual memory of 2364Mb v/s 261Mb of RESident memory is symptomatic of this issue...
job tracker should limit the number of completed/failed jobs in RAM
The job tracker currently runs out of memory when a user runs a lot of small jobs back to back. To bound the amount of RAM that the job tracker consumes recording completed/failed jobs, I think that the JobTracker should limit the number of &quot;remembered&quot; jobs per a user to jobtracker.max.remembered.task.per.user (default 100).
Remove from trunk things deprecated in 0.10 branch.
FileNotFound on DFS block file
While run the sort benchmark a reduce failed with:
java.io.FileNotFoundException: /tmp/hadoop-oom/dfs/tmp/tmp/client-4362164194084664090 (No such file or directory)
at java.io.FileInputStream.open(Native Method)
at java.io.FileInputStream.(FileInputStream.java:106)
at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.endBlock(DFSClient.java:1156)
at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.close(DFSClient.java:1244)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at org.apache.hadoop.fs.FSDataOutputStream$Summer.close(FSDataOutputStream.java:98)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at org.apache.hadoop.io.SequenceFile$Writer.close(SequenceFile.java:515)
at org.apache.hadoop.mapred.SequenceFileOutputFormat$1.close(SequenceFileOutputFormat.java:71)
at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:310)
at org.apache.hadoop.mapred.TaskTracker$Child.main(TaskTracker.java:1271)
&quot;Bad File Descriptor&quot; in closing DFS file
Running the sort benchmark, I had a reduce fail with a DFS error:
java.io.IOException: Bad file descriptor
at java.io.FileOutputStream.writeBytes(Native Method)
at java.io.FileOutputStream.write(FileOutputStream.java:260)
at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.flushData(DFSClient.java:1128)
at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.flush(DFSClient.java:1114)
at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.close(DFSClient.java:1241)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at org.apache.hadoop.fs.FSDataOutputStream$Summer.close(FSDataOutputStream.java:99)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at java.io.FilterOutputStream.close(FilterOutputStream.java:143)
at org.apache.hadoop.io.SequenceFile$Writer.close(SequenceFile.java:515)
at org.apache.hadoop.mapred.SequenceFileOutputFormat$1.close(SequenceFileOutputFormat.java:71)
at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:310)
at org.apache.hadoop.mapred.TaskTracker$Child.main(TaskTracker.java:1271)
NameNode throws FileNotFoundException: Parent path does not exist on startup
(with credit to Christian)
The following exception is reported by the namenode upon startup:
2006-11-22 12:18:17,713 ERROR org.apache.hadoop.dfs.NameNode:
java.io.FileNotFoundException: Parent path does not exist: /foo/bar
at org.apache.hadoop.dfs.FSDirectory$INode.addNode(FSDirectory.java:186)
at org.apache.hadoop.dfs.FSDirectory.unprotectedMkdir(FSDirectory.java:731)
at org.apache.hadoop.dfs.FSEditLog.loadFSEdits(FSEditLog.java:254)
at org.apache.hadoop.dfs.FSImage.loadFSImage(FSImage.java:191)
at org.apache.hadoop.dfs.FSDirectory.loadFSImage(FSDirectory.java:321)
at org.apache.hadoop.dfs.FSNamesystem.&lt;init&gt;(FSNamesystem.java:230)
at org.apache.hadoop.dfs.NameNode.&lt;init&gt;(NameNode.java:145)
at org.apache.hadoop.dfs.NameNode.&lt;init&gt;(NameNode.java:137)
at org.apache.hadoop.dfs.NameNode.main(NameNode.java:585)
Perhaps the 'mkdirs' section
INode inserted = unprotectedMkdir(cur);
if (inserted != null) {
NameNode.stateChangeLog.debug(&quot;DIR* FSDirectory.mkdirs: &quot;
+&quot;created directory &quot;+cur );
fsImage.getEditLog().logMkDir( inserted );
needs to be synchronized or the unprotectedMkdir method needs to be changed
to allow creating missing parent directories.
JobTracker does not clean up task entries at job completion
The JobTracker never calls removeTaskEntry on tasks that don't fail. This causes the JobTracker to use more and more heap space as jobs run. The fix is to:
removeTaskEntry on reduces in completeTask
removeTaskEntry on everything when a job is killed or completes
The underlying data structure, ByteArrayOutputStream, for buffer type of Hadoop record is inappropriate
With ByteArrayOutputStream as the underlying data structure for a buffer, the user is forced to convert it into a byte [] object in order to do any operations other than sequence append on the buffer. The convertion will create a new copy of bytes. That will cause huge performance problem. 
It seems BytesWritable is a better replacement.
Sometimes when a dfs file is accessed and one copy has a checksum error the I/O command fails, even if another copy is alright.
for a particular file [alas, the file no longer exists -- I had to progress] 
$dfs -cp foo bar 
and
$dfs -get foo local
failed on a checksum error. The dfs browser's download function retrieved the file, so either that function doesn't check, or more likely the download function got a different copy.
When a checksum fails on one copy of a file that is redundantly stored, I would prefer that dfs try a different copy, mark the bad one as not existing [which should induce a fresh copy being made from one of the good copies eventually], and make the call continue to work and deliver bytes.
Ideally, if all copies have checksum errors but it's possible to piece together a good copy I would like that to be done.
-dk
bin/hadoop includes in classpath all jar files in HADOOP_HOME
The hadoop script includes all jars from HADOOP_HOME in the classpath. This means that all the daemons get the examples and tests included in their class paths. If a change is made to an example or test, all the daemons have to be restarted to see the affect of the change. This doesn't seem desirable.
hadoop hdfs -cat replaces some characters with question marks.
Should not the effect of
hadoop hdfs -get path local-file
and
hadoop hdfs -cat path &gt;local-file
be the same?
Try to do this with a (hdfs) file that contains non-ascii characters and do a diff.
Race condition in JobTracker updating the task tracker's status while declaring it lost
There was a case where the JobTracker lost track of a set of tasks that were on a task tracker. It appears to be a race condition because the ExpireTrackers thread doesn't lock the JobTracker while updating the state. The fix would be to build a list of dead task trackers and then lock the job tracker while updating their status.
Chain reaction in a big cluster caused by simultaneous failure of only a few data-nodes.
I've observed a cluster crash caused by simultaneous failure of only 3 data-nodes.
The crash is reproducable. In order to reproduce it you need a rather large cluster.
To simplify calculations I'll consider a 600 node cluster as an example.
The cluster should also contain a substantial amount of data.
We will need at least 3 data-nodes containing 10,000+ blocks each.
Now suppose that these 3 data-nodes fail at the same time, and the name-node
started replicating all missing blocks belonging to the nodes.
The name-node can replicate 50 blocks per second on average based on experimental data.
Meaning, it will take more than 10 minutes, which is the heartbeat expiration interval,
to replicates all 30,000+ blocks.
With the 3 second heartbeat interval there are 600 / 3 = 200 heartbeats hitting the name-node every second.
Under heavy replication load the name-node accepts about 50 heartbeats per second.
So at most 3/4 of all heartbeats remain unserved.
Each node SHOULD send 200 heartbeats during the 10 minute interval, and every time the probability
of the heartbeat being unserved is 3/4 or less.
So the probability of failing of all 200 heartbeats is (3/4) ** 200 = 0 from the practical standpoint.
IN FACT since current implementation sets the rpc timeout to 1 minute, a failed heartbeat takes
1 minute and 8 seconds to complete, and under this circumstances each data-node can send only
9 heartbeats during the 10 minute interval. Thus, the probability of failing of all 9 of them is 0.075,
which means that we will loose 45 nodes out of 600 at the end of the 10 minute interval.
From this point the name-node will be constantly replicating blocks and loosing more nodes, and
becomes effectively dysfunctional.
A map-reduce framework running on top of it makes things deteriorate even faster, because failing
tasks and jobs are trying to remove files and re-create them again increasing the overall load on
the name-node.
I see at least 2 problems that contribute to the chain reaction described above.
1. A heartbeat failure takes too long (1'8&quot;).
2. Name-node synchronized operations should be fine-grained.
NullPointerException in TaskReport's serialization code
TaskReport[] rep = jc.getMapTaskReports(jobId);
I get de/serialization problems:
This change suggested by Owen fixes it:
- new ObjectWritable(diagnostics).write(out);
+ WritableUtils.writeStringArray(out, diagnostics);
- ObjectWritable wrapper = new ObjectWritable();
- wrapper.readFields(in);
- diagnostics = (String[])wrapper.get();
+ diagnostics = WritableUtils.readStringArray(in);
java.lang.NullPointerException
at org.apache.hadoop.io.ObjectWritable.readObject(ObjectWritable.java:174)
at org.apache.hadoop.io.ObjectWritable.readFields(ObjectWritable.java:59)
at org.apache.hadoop.mapred.TaskReport.readFields(TaskReport.java:64)
at org.apache.hadoop.io.ObjectWritable.readObject(ObjectWritable.java:225)
at org.apache.hadoop.io.ObjectWritable.readObject(ObjectWritable.java:163)
at org.apache.hadoop.io.ObjectWritable.readObject(ObjectWritable.java:210)
at org.apache.hadoop.io.ObjectWritable.readFields(ObjectWritable.java:59)
at org.apache.hadoop.ipc.Client$Connection.run(Client.java:256)
2006-09-19 08:44:31,059 WARN ipc.Server (Server.java:run(493)) - handler output error
java.nio.channels.ClosedChannelException
Namespace check pointing is not performed until the namenode restarts.
In current implementation when the name node starts, it reads its image file, then
the edits file, and then saves the updated image back into the image file.
The image file is never updated after that.
In order to provide the system reliability reliability the namespace information should
be check pointed periodically, and the edits file should be kept relatively small.
When creating geronimo-web.xml from scratch using Plug-in Form Editor, the &quot;Dependencies&quot; view doesn't show the just added dependency
Follow these steps to re-create the problem:
1) Create a new dynamic web project (don't use import of an existing project, this scenario requires that no &lt;sys:dependencies&gt; element is present in geronimo-web.xml)
2) Open &quot;geronimo-web.xml&quot; in Geronimo Deployment Plan Editor
3) Switch to Deployment tab
4) Under &quot;Dependecies&quot; section click on &quot;Add&quot;
5) Enter values and click &quot;Finish&quot;
6) You will see that &quot;Dependencies&quot; view doesn't show the just added dependency
Only upon Save, Close and Re-open of &quot;geronimo-web.xml&quot; you will be able to see the added dependencies.
The patch included solves this problem by updating the &quot;performFinish()&quot; function of class &quot;org.apache.geronimo.st.v11.ui.wizards.DependencyWizard&quot;. Functionality of &quot;performFinish()&quot; function of class &quot;org.apache.geronimo.st.v11.ui.wizards.SecurityRoleWizard&quot; is used as the hint for coming up with this patch.
import simple hello.war results xml-fragment tag in geronimo-web.xml
Tried to import a simple hello war file however after import the geronimo-web.xml file contains xml-fragment tag which prevents the hello project from being deployed to server. tried to print out the following var plan in ImportDeploymentPlanOperation.java
plan = runtime.fixGeronimoWebSchema(planFile);
System.out.println(&quot;plan 1: &quot; + plan.toString());
Here's the printout:
plan 1: &lt;xml-fragment xmlns:nam=&quot;http://geronimo.apache.org/xml/ns/naming-1.1&quot; xmlns:sec=&quot;http://geronimo.apache.org/xml/ns/security-1.1&quot; xmlns:sys=&quot;http://geronimo.apache.org/xml/ns/deployment-1.1&quot; xmlns:web=&quot;http://geronimo.apache.org/xml/ns/j2ee/web-1.1&quot;&gt;
&lt;sys:environment&gt;
&lt;sys:moduleId&gt;
&lt;sys:groupId&gt;samples&lt;/sys:groupId&gt;
&lt;sys:artifactId&gt;cviewer&lt;/sys:artifactId&gt;
&lt;sys:version&gt;1.1&lt;/sys:version&gt;
&lt;sys:type&gt;war&lt;/sys:type&gt;
&lt;/sys:moduleId&gt;
&lt;sys:dependencies/&gt;
&lt;sys:hidden-classes/&gt;
&lt;sys:non-overridable-classes/&gt;
&lt;/sys:environment&gt;
&lt;web:context-root&gt;/cviewer&lt;/web:context-root&gt;
&lt;/xml-fragment&gt;
Note this is not a valid plan.
I updated the following method in org.apache.geronimo.st.v11.core.GeronimoRuntime and it is working now (for war file).
public XmlObject fixGeronimoWebSchema(IFile plan) throws XmlException {
XmlObject xmlplan = getXmlObject(plan);
if (plan != null) {
SchemaConversionUtils.fixGeronimoSchema(xmlplan, GerWebAppDocument.type.getDocumentElementName(),
GerWebAppType.type);
save(xmlplan, plan);
return xmlplan;
}
return null;
//return SchemaConversionUtils.fixGeronimoSchema(getXmlObject(plan), GerWebAppDocument.type.getDocumentElementName(), GerWebAppType.type);
}
Also added the save method back from 1.0 to org.apache.geronimo.st.v11.core.GeronimoRuntime:
private void save(XmlObject object, IFile file) {
try {
object.save(file.getLocation().toFile());
file.refreshLocal(IFile.DEPTH_ONE, null);
} catch (IOException e) {
e.printStackTrace();
} catch (CoreException e) {
e.printStackTrace();
}
} 
Patch has been tested on importing war projects and worked well.
Sun changed the (final?) javaee 5 schemas and we need to generate new xmlbeans classes for them
Jarek (and possibly others) pointed out that the schemas we were using the generate the xmlbeans classes for javaee 5 did not match what sun is currently (jan 30 1007 ) from its web site. The web site claims they were from may 2 3006. Anyway 6 out of 10 schemas have changed, the most significanly web services client which is almost entirely different.
I'm going to also change to jdk 1.5 and stop using the maven one plugin.
Most changes committed in rev 1831 (tck repo).
I haven't tried compiling the rest of geronimo + openejb, so this may require additional changes
Test
Tomcat fails to accept certificate alias
Here's the contents of the keystore:
------8&lt;--------
[nsadmin@hive ~]$ keytool -list -keystore /webetc/keys/arena-dev-web.jks
Enter keystore password: 
Keystore type: jks
Keystore provider: SUN
Your keystore contains 3 entries
plm.qa.bom.com-arena-server, Jan 24, 2007, keyEntry,
Certificate fingerprint (MD5):
24:4F:8D:F8:E0:B7:EA:C2:CD:FE:0E:77:81:B0:34:DC
plm.ref.bom.com-arena-server, Jan 24, 2007, keyEntry,
Certificate fingerprint (MD5):
41:03:90:6F:15:1B:C3:C7:3F:3D:6C:ED:74:B0:9F:FE
plm.dev.bom.com-arena-server, Nov 26, 2006, keyEntry,
Certificate fingerprint (MD5):
8C:58:3E:C5:F2:3B:01:0C:65:53:5D:23:12:C5:6C:08
[nsadmin@hive ~]$
------8&lt;--------
...and here's the gbean we are using to declare the HTTPS Connector:
------8&lt;--------
&lt;gbean gbeanInfo=&quot;org.apache.geronimo.tomcat.HttpsConnectorGBean&quot;
name=&quot;geronimo/tomcat/1.1.1/car?ServiceModule=geronimo/tomcat/1.1.1/car,
j2eeType=GBean,name=plm.ref.bom.com-arena-server&quot;&gt;
&lt;attribute name=&quot;name&quot;&gt;plm.ref.bom.com-arena-server&lt;/attribute&gt;
&lt;attribute name=&quot;protocol&quot;&gt;HTTPS&lt;/attribute&gt;
&lt;attribute name=&quot;host&quot;&gt;plm.ref.bom.com&lt;/attribute&gt;
&lt;attribute name=&quot;port&quot;&gt;4431&lt;/attribute&gt;
&lt;attribute name=&quot;maxThreads&quot;&gt;50&lt;/attribute&gt;
&lt;attribute name=&quot;acceptQueueSize&quot;&gt;100&lt;/attribute&gt;
&lt;!-- &lt;attribute
name=&quot;initParams&quot;&gt;keyAlias=plm.ref.bom.com-arena-server&lt;/attribute&gt; --&gt;
&lt;attribute name=&quot;keystoreType&quot;&gt;JKS&lt;/attribute&gt;
&lt;attribute
name=&quot;keystoreFileName&quot;&gt;/webetc/keys/arena-dev-web.jks&lt;/attribute&gt;
&lt;attribute
name=&quot;keystorePassword&quot;&gt;{Simple}rO0ABXNyABlqYXZheC5jcnlwdG8uU2VhbGVkT2Jq
ZWN0PjY9psO3VHACAARbAA1lbmNvZGVkUGFyYW1zdAACW0JbABBlbmNyeXB0ZWRDb250ZW50
cQB+AAFMAAlwYXJhbXNBbGd0ABJMamF2YS9sYW5nL1N0cmluZztMAAdzZWFsQWxncQB+AAJ4
cHB1cgACW0Ks8xf4BghU4AIAAHhwAAAAIGSR0Xtc+HC5SaER/SUEd6yUduVcQW9y6ZEbHfsR
W7PUcHQAA0FFUw==&lt;/attribute&gt;
&lt;attribute name=&quot;secureProtocol&quot;&gt;Default&lt;/attribute&gt;
&lt;attribute name=&quot;algorithm&quot;&gt;Default&lt;/attribute&gt;
&lt;attribute name=&quot;clientAuthRequired&quot;&gt;False&lt;/attribute&gt;
&lt;attribute name=&quot;truststoreType&quot;&gt;JKS&lt;/attribute&gt;
&lt;attribute
name=&quot;truststoreFileName&quot;&gt;/webetc/CA/trusted-authorities-certs.jks&lt;/attr
ibute&gt;
&lt;attribute
name=&quot;truststorePassword&quot;&gt;{Simple}rO0ABXNyABlqYXZheC5jcnlwdG8uU2VhbGVkT2
JqZWN0PjY9psO3VHACAARbAA1lbmNvZGVkUGFyYW1zdAACW0JbABBlbmNyeXB0ZWRDb250ZW
50cQB+AAFMAAlwYXJhbXNBbGd0ABJMamF2YS9sYW5nL1N0cmluZztMAAdzZWFsQWxncQB+AA
J4cHB1cgACW0Ks8xf4BghU4AIAAHhwAAAAIGSR0Xtc+HC5SaER/SUEd6yUduVcQW9y6ZEbHf
sRW7PUcHQAA0FFUw==&lt;/attribute&gt;
&lt;reference name=&quot;TomcatContainer&quot;&gt;
&lt;pattern&gt;
&lt;groupId&gt;geronimo&lt;/groupId&gt;
&lt;artifactId&gt;tomcat&lt;/artifactId&gt;
&lt;version&gt;1.1.1&lt;/version&gt;
&lt;type&gt;car&lt;/type&gt;
&lt;name&gt;TomcatWebContainer&lt;/name&gt;
&lt;/pattern&gt;
&lt;/reference&gt;
&lt;reference name=&quot;ServerInfo&quot;&gt;
&lt;pattern&gt;
&lt;groupId&gt;geronimo&lt;/groupId&gt;
&lt;artifactId&gt;j2ee-system&lt;/artifactId&gt;
&lt;version&gt;1.1.1&lt;/version&gt;
&lt;type&gt;car&lt;/type&gt;
&lt;name&gt;ServerInfo&lt;/name&gt;
&lt;/pattern&gt;
&lt;/reference&gt;
&lt;/gbean&gt;
------8&lt;--------
WAS CE starts this Gbean happily, but when the connector receives a
connection from an HTTPS client, it uses the
&quot;plm.qa.bom.com-arena-server&quot; keyEntry (that is, the first keyEntry
listed in the keystore). I would like to be able to specify which
keyEntry is used for each HTTPS connector.
If I uncomment the &quot;initParams&quot; element, then WAS CE fails on startup
with this error:
------8&lt;--------
Module 3/5 geronimo/tomcat/1.1.1/car
13:59:14,512 ERROR [GBeanInstanceState] Error while starting; GBean is
now in the FAILED state:
abstractName=&quot;geronimo/tomcat/1.1.1/car?configurationName=geronimo/tomca
t/1.1.1/car&quot;
org.apache.geronimo.kernel.config.InvalidConfigException: No attribute:
initParams for gbean:
geronimo/tomcat/1.1.1/car?ServiceModule=geronimo/tomcat/1.1.1/car,j2eeTy
pe=GBean,name=plm.ref.bom.com-arena-server
at
org.apache.geronimo.system.configuration.LocalAttributeManager.setAttrib
utes(LocalAttributeManager.java:197)
...
13:59:14,521 ERROR [Daemon] Exception caught while starting
configurations.
Exception=org.apache.geronimo.kernel.config.LifecycleException: load of
geronimo/tomcat/1.1.1/car failed
Server startup failed
------8&lt;--------
Any help would be appreciated.
Server memory usage graph does not work
The server memory usage graph in the admin console does not show up in the jetty version. It produces the following error message:
00:14:34,716 INFO [DWRServlet] retrieved system configuration file: java.util.zip.ZipFile$2@f75487
00:14:35,989 ERROR [GenericForwardServlet] Unable to forward URL /graphs/memoryGraphSVG.jsp; does not match any known ContextForward definitions.
Looks like the same changes made in rev 474975 for the ContextForwardServlet need to be applied to the webconsole-jetty6 config that was migrated from sandbox.
EarConfigBuilder ignores geronimo plan if no application.xml present
If you deploy an ear with no application.xml, any geronimo plan you may provide is ignored.
Clustered HttpSessions are not properly destroyed during eviction
ClusteredSession are not properly removed from ClusteredSessionManager when they are evicted after timing-out.
SessionListener needs to provide a new method to be called when a Session is destroyed such that ClusteredSessionManager can receive a notification when a Session expired and properly remove it.
the &quot;namingProviderUrl&quot; element does *not* appear to control which IP addresses the RMI service binds to
Unfortunately, the &quot;namingProviderUrl&quot; element
does *not* appear to control which IP addresses the RMI service binds to
at the network level. In fact, from a quick look at the Geronimo source
code, it appears that &quot;0.0.0.0&quot; is hard-coded as the IP address to which
the RMI service binds:
In
modules/geronimo-system/src/main/java/org/apache/geronimo/system/rmi/RMI
RegistryService.java:
----8&lt;---
public String getHost() {
return &quot;0.0.0.0&quot;;
}
[BUILD BREAK] Module geronimo-axis2
At revision 497491.
Compiling 71 source files to /home/prasad/geronimo/trunk/modules/geronimo-axis2/target/classes
[INFO] ------------------------------------------------------------------------
[ERROR] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Compilation failure
/home/prasad/geronimo/trunk/modules/geronimo-axis2/src/main/java/org/apache/geronimo/axis2/Axis2WebServiceContainer.java:[70,62] cannot find symbol
symbol : method createDefaultConfigurationContext()
location: class org.apache.axis2.context.ConfigurationContextFactory
[INFO] ------------------------------------------------------------------------
[INFO] For more information, run Maven with the -e switch
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4 minutes 34 seconds
[INFO] Finished at: Thu Jan 18 11:22:07 EST 2007
[INFO] Final Memory: 72M/129M
[INFO] ------------------------------------------------------------------------
DB Manager portlets (DB Viewer and Run SQL) not working
After updating to Derby 10.2.2.0 the database management portlets are not showing existing databases. That is SystemDatabase and any other just created.
NPE at org.apache.geronimo.security.SubjectId.hashCode(SubjectId.java:79)
jlaskowski@dev /cygdrive/c/oss/geronimo/geronimo-tomcat6-jee5-2.0-SNAPSHOT
$ echo $JAVA_HOME
/cygdrive/c/apps/java5
jlaskowski@dev /cygdrive/c/oss/geronimo/geronimo-tomcat6-jee5-2.0-SNAPSHOT
$ uname -a
CYGWIN_NT-5.1 dev 1.5.21(0.156/4/2) 2006-07-30 14:21 i686 Cygwin
jlaskowski@dev /cygdrive/c/oss/geronimo/geronimo-tomcat6-jee5-2.0-SNAPSHOT
$ ./bin/geronimo.sh run -v
Using GERONIMO_BASE: c:\oss\geronimo\geronimo-tomcat6-jee5-2.0-SNAPSHOT
Using GERONIMO_HOME: c:\oss\geronimo\geronimo-tomcat6-jee5-2.0-SNAPSHOT
Using GERONIMO_TMPDIR: c:\oss\geronimo\geronimo-tomcat6-jee5-2.0-SNAPSHOT\var\temp
Using JRE_HOME: c:\apps\java5\jre
Booting Geronimo Kernel (in Java 1.5.0_08)...
08:14:36,187 INFO [root] ----------------------------------------------
08:14:36,203 INFO [root] Started Logging Service
08:14:36,203 INFO [root] Runtime Information:
08:14:36,203 INFO [root] Install Directory = C:\oss\geronimo\geronimo-tomcat6-jee5-2.0-SNAPSHOT
08:14:36,203 INFO [root] JVM in use = Sun Microsystems Inc. Java 1.5.0_08
08:14:36,203 INFO [root] Java Information:
08:14:36,203 INFO [root] System property [java.runtime.name] = Java(TM) 2 Runtime Environment, Standard Edition
08:14:36,203 INFO [root] System property [java.runtime.version] = 1.5.0_08-b03
08:14:36,203 INFO [root] System property [os.name] = Windows XP
08:14:36,203 INFO [root] System property [os.version] = 5.1
08:14:36,203 INFO [root] System property [sun.os.patch.level] = Service Pack 2
08:14:36,203 INFO [root] System property [os.arch] = x86
08:14:36,203 INFO [root] System property [java.class.version] = 49.0
08:14:36,203 INFO [root] System property [locale] = pl_PL
08:14:36,203 INFO [root] System property [unicode.encoding] = UnicodeLittle
08:14:36,203 INFO [root] System property [file.encoding] = Cp1250
08:14:36,203 INFO [root] System property [java.vm.name] = Java HotSpot(TM) Client VM
08:14:36,203 INFO [root] System property [java.vm.vendor] = Sun Microsystems Inc.
08:14:36,203 INFO [root] System property [java.vm.version] = 1.5.0_08-b03
08:14:36,203 INFO [root] System property [java.vm.info] = mixed mode
08:14:36,203 INFO [root] System property [java.home] = c:\apps\java5\jre
08:14:36,203 INFO [root] System property [java.classpath] = null
08:14:36,203 INFO [root] System property [java.library.path] = .....a very long path....
08:14:36,203 INFO [root] System property [java.endorsed.dirs] = c:\apps\java5\jre/lib/endorsed:c:\oss\geronimo\geronimo-tomcat6-jee5-2.0-SNAPSHOT/lib/endorsed
08:14:36,203 INFO [root] System property [java.ext.dirs] = c:\apps\java5\jre/lib/ext:c:\oss\geronimo\geronimo-tomcat6-jee5-2.0-SNAPSHOT/lib/ext
08:14:36,203 INFO [root] System property [sun.boot.class.path] = c:\apps\java5\jre\lib\rt.jar;c:\apps\java5\jre\lib\i18n.jar;c:\apps\java5\jre\lib\sunrsasign.jar;c:\apps\java5\j
re\lib\jsse.jar;c:\apps\java5\jre\lib\jce.jar;c:\apps\java5\jre\lib\charsets.jar;c:\apps\java5\jre\classes
08:14:36,203 INFO [root] ----------------------------------------------
08:15:11,593 ERROR [GBeanInstanceState] Error while starting; GBean is now in the FAILED state: abstractName=&quot;org.apache.geronimo.configs/webconsole-tomcat/2.0-SNAPSHOT/car?J2EEApp
lication=org.apache.geronimo.configs/webconsole-tomcat/2.0-SNAPSHOT/car,j2eeType=JACCManager,name=JACCManager&quot;
java.lang.NullPointerException
at org.apache.geronimo.security.SubjectId.hashCode(SubjectId.java:79)
at java.util.Hashtable.put(Hashtable.java:401)
at org.apache.geronimo.security.ContextManager.registerSubject(ContextManager.java:269)
at org.apache.geronimo.security.jacc.ApplicationPolicyConfigurationManager.&lt;init&gt;(ApplicationPolicyConfigurationManager.java:109)
at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
at java.lang.reflect.Constructor.newInstance(Constructor.java:494)
at org.apache.geronimo.gbean.runtime.GBeanInstance.createInstance(GBeanInstance.java:936)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:267)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstance.start(GBeanInstance.java:529)
at org.apache.geronimo.gbean.runtime.GBeanDependency.attemptFullStart(GBeanDependency.java:111)
at org.apache.geronimo.gbean.runtime.GBeanDependency.addTarget(GBeanDependency.java:146)
at org.apache.geronimo.gbean.runtime.GBeanDependency$1.running(GBeanDependency.java:120)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.fireRunningEvent(BasicLifecycleMonitor.java:173)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.access$300(BasicLifecycleMonitor.java:41)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor$RawLifecycleBroadcaster.fireRunningEvent(BasicLifecycleMonitor.java:251)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:292)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.startRecursive(GBeanInstanceState.java:124)
at org.apache.geronimo.gbean.runtime.GBeanInstance.startRecursive(GBeanInstance.java:543)
at org.apache.geronimo.kernel.basic.BasicKernel.startRecursiveGBean(BasicKernel.java:379)
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:378)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:527)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:508)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:127)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:820)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$e380e87b.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.system.main.Daemon.doStartup(Daemon.java:286)
at org.apache.geronimo.system.main.Daemon.&lt;init&gt;(Daemon.java:74)
at org.apache.geronimo.system.main.Daemon.main(Daemon.java:366)
Geronimo startup failed:
org.apache.geronimo.kernel.config.LifecycleException: start of org.apache.geronimo.configs/webconsole-tomcat/2.0-SNAPSHOT/car failed
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:544)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:508)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:127)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:820)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$e380e87b.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.system.main.Daemon.doStartup(Daemon.java:286)
at org.apache.geronimo.system.main.Daemon.&lt;init&gt;(Daemon.java:74)
at org.apache.geronimo.system.main.Daemon.main(Daemon.java:366)
Caused by: org.apache.geronimo.kernel.config.InvalidConfigException: Unknown start exception
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:444)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:527)
... 13 more
Caused by: org.apache.geronimo.gbean.InvalidConfigurationException: Configuration org.apache.geronimo.configs/webconsole-tomcat/2.0-SNAPSHOT/car failed to start due to the followin
g reasons:
The service J2EEApplication=org.apache.geronimo.configs/webconsole-tomcat/2.0-SNAPSHOT/car,j2eeType=JACCManager,name=JACCManager did not start for an unknown reason
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:407)
... 15 more
Server shutdown begun
Server shutdown completed
Filter out the Tomcat debug log msg - java.lang.ClassNotFoundException: org.apache.tomcat.util.net.puretls.PureTLSImplementation
Need to add another logger filter to remove the below Tomcat debug message, which logs an exception and can be misleading to users -
15:47:42,281 DEBUG [SSLImplementation] Error loading SSL Implementation org.apache.tomcat.util.net.puretls.PureTLSImplementation
java.lang.ClassNotFoundException: org.apache.tomcat.util.net.puretls.PureTLSImplementation
JAXR tests
The existing JAXR support appears to be broken. For example, any EJB or web application failed with (when using JAXR api):
Caused by: javax.xml.registry.JAXRException: Unable to load JAXR ConnectionFacto
ryClass: org.apache.ws.scout.registry.ConnectionFactoryImpl
at javax.xml.registry.ConnectionFactory.newInstance(ConnectionFactory.ja
va:53)
at org.apache.geronimo.test.JAXRTest.&lt;init&gt;(JAXRTest.java:31)
at org.apache.geronimo.test.JAXRServlet.doGet(JAXRServlet.java:41)
... 23 more
Caused by: java.lang.ClassNotFoundException: org.apache.ws.scout.registry.Connec
tionFactoryImpl in classloader JEE5/JAXRServlet/1.1/car
at org.apache.geronimo.kernel.config.MultiParentClassLoader.loadClass(Mu
ltiParentClassLoader.java:303)
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
at javax.xml.registry.ConnectionFactory.newInstance(ConnectionFactory.ja
va:50)
... 25 more
The following patch fixes this problem and contains basic tests to ensure that JAXR API can be used within any EJB or web application (and that the right implementation is used).
J2EE Application Client deployment fails with NPE
The following exception is generated when a standalone J2EE application client is deployed (in trunk):
Caused by: java.lang.NullPointerException
at org.apache.geronimo.client.builder.AppClientModuleBuilder.createModul
e(AppClientModuleBuilder.java:256)
at org.apache.geronimo.client.builder.AppClientModuleBuilder.createModul
e(AppClientModuleBuilder.java:190)
at org.apache.geronimo.client.builder.AppClientModuleBuilder$$FastClassB
yCGLIB$$93137659.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethod
Invoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperatio
n.java:127)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.
This error can be replicated by deploying 'applications/magicGball/magicGball-client' jar file.
The code fails in the following line:
earName = naming.createRootName(earEnvironment.getConfigId(), NameFactory.NULL, NameFactory.J2EE_APPLICATION);
which assumes earEnvironment variable is non-null. However, it is null in such deployment.
Exception while removing directory module from the console
removing *directory* module form the console's *Installed System Modules* portlet throws an exception while removing dependencies. attaching log
enable commons-logging in tomcat module
Tomcat 6 does not support log4j by default. Instead it provides support for log4j via an &quot;extras&quot; module. Geronimo needs to enable this extras module so that tomcat logging can be configured via var/log/server-log4j.properties, and so that INFO level messages are not shown in the server's output window by default.
tomcat https connector needs additional param
In tomcat 6.x the connector needs an additional parameter to enable https - SSLEnabled. Without setting that parameter the connector apparently falls back to http. See discussion at 
http://www.mail-archive.com/dev@tomcat.apache.org/msg12070.html
FileAuditLoginModule fails to write login attempts
After creating an LDAP Realm configured with *Enable Auditing* the FileAuditLoginModule fails to write login attempts to the specified file.
LDAP Realm fails to test and deploy
LDAP Realm dep plan generated with the console fails to deploy with the following error in terminal:
10:59:26,609 ERROR [DeploymentFactoryImpl] org/apache/geronimo/deployment/ModuleConfigurer
java.lang.NoClassDefFoundError: org/apache/geronimo/deployment/ModuleConfigurer
at org.apache.geronimo.deployment.plugin.factories.DeploymentFactoryImpl.getDeploymentManager(DeploymentFactoryImpl.java:130)
at javax.enterprise.deploy.shared.factories.DeploymentFactoryManager.getDeploymentManager(DeploymentFactoryManager.java:111)
at org.apache.geronimo.deployment.cli.ServerConnection.tryToConnect(ServerConnection.java:292)
at org.apache.geronimo.deployment.cli.ServerConnection.&lt;init&gt;(ServerConnection.java:209)
at org.apache.geronimo.deployment.cli.DeployTool.execute(DeployTool.java:157)
at org.apache.geronimo.deployment.cli.DeployTool.main(DeployTool.java:314)
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/apache/geronimo/deployment/ModuleConfigurer
at org.apache.geronimo.deployment.plugin.factories.DeploymentFactoryImpl.getDeploymentManager(DeploymentFactoryImpl.java:130)
at javax.enterprise.deploy.shared.factories.DeploymentFactoryManager.getDeploymentManager(DeploymentFactoryManager.java:111)
at org.apache.geronimo.deployment.cli.ServerConnection.tryToConnect(ServerConnection.java:292)
at org.apache.geronimo.deployment.cli.ServerConnection.&lt;init&gt;(ServerConnection.java:209)
at org.apache.geronimo.deployment.cli.DeployTool.execute(DeployTool.java:157)
at org.apache.geronimo.deployment.cli.DeployTool.main(DeployTool.java:314)
This realm also fails the testing previous to final deployment. Connection values are correct (user, pwd, ...) as these work fine in Geronimo v1.1.1
10:44:50,125 WARN [SecurityRealmPortlet] Testing with options {roleBase=ou=groups,ou=system, roleSearchMatching=(uniqueMember={0})..................
10:45:11,968 WARN [SecurityRealmPortlet] Test login failed
javax.security.auth.login.LoginException: LDAP Error
at org.apache.geronimo.security.realm.providers.LDAPLoginModule.login(LDAPLoginModule.java:162)
at org.apache.geronimo.console.util.KernelManagementHelper.testLoginModule(KernelManagementHelper.java:423)
at org.apache.geronimo.console.util.PortletManager.testLoginModule(PortletManager.java:160)
at org.apache.geronimo.console.securitymanager.realm.SecurityRealmPortlet.actionAttemptLogin(SecurityRealmPortlet.java:334)
at org.apache.geronimo.console.securitymanager.realm.SecurityRealmPortlet.processAction(SecurityRealmPortlet.java:215)
at org.apache.pluto.core.PortletServlet.dispatch(PortletServlet.java:229)
at org.apache.pluto.core.PortletServlet.doGet(PortletServlet.java:158)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:597)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:690)
at org.apache.pluto.core.PortletServlet.service(PortletServlet.java:153)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:672)
at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:574)
at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:499)
at org.apache.pluto.invoker.impl.PortletInvokerImpl.invoke(PortletInvokerImpl.java:120)
at org.apache.pluto.invoker.impl.PortletInvokerImpl.action(PortletInvokerImpl.java:68)
at org.apache.pluto.PortletContainerImpl.processPortletAction(PortletContainerImpl.java:164)
at org.apache.pluto.portalImpl.core.PortletContainerWrapperImpl.processPortletAction(PortletContainerWrapperImpl.java:82)
at org.apache.pluto.portalImpl.Servlet.doGet(Servlet.java:227)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:597)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:690)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
at org.apache.geronimo.tomcat.valve.DefaultSubjectValve.invoke(DefaultSubjectValve.java:56)
at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:524)
at org.apache.geronimo.tomcat.GeronimoStandardContext$SystemMethodValve.invoke(GeronimoStandardContext.java:328)
at org.apache.geronimo.tomcat.valve.GeronimoBeforeAfterValve.invoke(GeronimoBeforeAfterValve.java:47)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:541)
at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:667)
at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)
at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)
at java.lang.Thread.run(Thread.java:595)
Caused by: java.lang.NullPointerException
at java.util.Hashtable.put(Hashtable.java:396)
at org.apache.geronimo.security.realm.providers.LDAPLoginModule.open(LDAPLoginModule.java:422)
at org.apache.geronimo.security.realm.providers.LDAPLoginModule.authenticate(LDAPLoginModule.java:200)
at org.apache.geronimo.security.realm.providers.LDAPLoginModule.login(LDAPLoginModule.java:155)
... 40 more
specs/trunk fails to build
geronimo-ejb_3.0_spec was released, but not removed from specs/trunk/pom.xml
geronimo-commonj_1.1_spec fails to build, because it is trying to use org.apache.geronimo.specs.specs version=1.2-SNAPSHOT instead of 1.2
Database creation pool wizard fails in Jetty
DB Pool creation wizard fails on Jetty distribution. It will now list the available database types (step 1) but once you click next the console is gone. 
The following error is displayed on the terminal. I can't set log to DEBUG, if so I loose control on Jetty (wont even pass login screen - different issue)
2007-01-08 15:32:21.671::WARN: EXCEPTION
java.lang.IllegalArgumentException: Qualifier patterns must be present when first URLPattern is an exact pattern
at javax.security.jacc.URLPatternSpec.&lt;init&gt;(URLPatternSpec.java:98)
at javax.security.jacc.WebUserDataPermission.&lt;init&gt;(WebUserDataPermission.java:86)
at org.apache.geronimo.jetty6.handler.JettySecurityHandler.checkSecurityConstraints(JettySecurityHandler.java:183)
at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:171)
at org.apache.geronimo.jetty6.handler.JettySecurityHandler.handle(JettySecurityHandler.java:133)
at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)
at org.apache.geronimo.jetty6.handler.ThreadClassloaderHandler.handle(ThreadClassloaderHandler.java:46)
at org.apache.geronimo.jetty6.handler.ComponentContextHandler.handle(ComponentContextHandler.java:47)
at org.apache.geronimo.jetty6.handler.InstanceContextHandler.handle(InstanceContextHandler.java:58)
at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:689)
at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:391)
at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:146)
at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)
at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139)
at org.mortbay.jetty.Server.handle(Server.java:285)
at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:457)
at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:751)
at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:500)
at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:203)
at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:357)
at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:217)
at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:475)
Server shutdown begun
Server shutdown completed
Requests using Non-secure HTTP connections cannot access unsecured web resources
Consider the following fragment of my web.xml in my WAR:
----
&lt;security-constraint&gt;
&lt;display-name&gt;Unsecure Constraint&lt;/display-name&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;Unsecure Resource Collection&lt;/web-resource-name&gt;
&lt;url-pattern&gt;/common/error/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;/common/includes/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;/common/Message.jsp&lt;/url-pattern&gt;
&lt;url-pattern&gt;/common/resources/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;/common/security/login.jsp&lt;/url-pattern&gt;
&lt;url-pattern&gt;/common/security/logout.jsp&lt;/url-pattern&gt;
&lt;url-pattern&gt;/servlet/branding/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;/servlet/image/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;/servlet/login/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;/servlet/definecookie&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;http-method&gt;POST&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;user-data-constraint&gt;
&lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
&lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;
&lt;security-constraint&gt;
&lt;display-name&gt;Secure Constraint&lt;/display-name&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;Secure Resource Collection&lt;/web-resource-name&gt;
&lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;http-method&gt;POST&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;MXSYSTEM&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;user-data-constraint&gt;
&lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
&lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;
&lt;login-config&gt;
&lt;auth-method&gt;FORM&lt;/auth-method&gt;
&lt;form-login-config&gt;
&lt;form-login-page&gt;/common/security/PreLogin.jsp&lt;/form-login-page&gt;
&lt;form-error-page&gt;/common/security/error.jsp&lt;/form-error-page&gt;
&lt;/form-login-config&gt;
&lt;/login-config&gt;
&lt;security-role&gt;
&lt;description&gt;Application System Role&lt;/description&gt;
&lt;role-name&gt;MXSYSTEM&lt;/role-name&gt;
&lt;/security-role&gt;
----
There are two sets of web resources defined: a secured web resource collection, and an unsecured web resource collection. The secured web collection is by default everything that matches the &quot;/&quot; pattern. In the unsecured web collection, we use specific URL patterns so that certain resources can be accessed prior to login. Note that there is no security role defined for the unsecured web resource collection, as these resources should be available to every request.
The problem is that access is denied to to the unsecured web resource collection, even though they are defined as unsecured. A blank HTML page is returned instead of the appropriate resource. After some debugging, I discovered what seems to be a bug in the org.apache.geronimo.tomcat.realm.TomcatGeronimoRealm class. Consider the following code fragment in the hasResourceCollection(...) method:
----
// Which user principal have we already authenticated?
Principal principal = request.getUserPrincipal();
//If we have no principal, then we should use the default.
if (principal == null) {
return request.isSecure();
} else {
Subject currentCaller = ((JAASTomcatPrincipal) principal).getSubject();
ContextManager.setCallers(currentCaller, currentCaller);
}
----
When I make an HTTP connection to an unsecure web resource, I am unauthenticated before I can login. Thus, the principal in this case is null. In the case of a null principal, the code seems to base its authorization on whether or not the request is secure! This seems very strange to me, as it should be able to accept normal, unauthenticated, HTTP connections to unsecure web resources.
I tried accessing the unsecured web resources over HTTPS, and sure enough, I was able to access them because of the secure connection. I'm not sure why this works only over HTTPS...it should work in both cases.
database creation pool wizzard fails to deploy
From the console, the database creation pool wizzard does not create a plan and fails to deploy it with no warnings on the Administration Console. 
The terminal shows the following error:
ERROR [DatabasePoolPortlet] Unable to save connection pooljavax.enterprise.deploy.spi.exceptions.InvalidModuleException: Not supported at org.apache.geronimo.deployment.plugin.jmx.JMXDeploymentManager.createConfiguration(JMXDeploymentManager.java:297) at org.apache.geronimo.console.databasemanager.wizard.DatabasePoolPortlet.save(DatabasePoolPortlet.java:880) at org.apache.geronimo.console.databasemanager.wizard.DatabasePoolPortlet.processAction(DatabasePoolPortlet.java:341) at org.apache.pluto.core.PortletServlet.dispatch(PortletServlet.java:229) at org.apache.pluto.core.PortletServlet.doPost(PortletServlet.java:163) at javax.servlet.http.HttpServlet.service(HttpServlet.java:713) at javax.servlet.http.HttpServlet.service(HttpServlet.java:806) at org.apache.pluto.core.PortletServlet.service(PortletServlet.java:153) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:683) at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:585) at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:505) at org.apache.pluto.invoker.impl.PortletInvokerImpl.invoke(PortletInvokerImpl.java:120) at org.apache.pluto.invoker.impl.PortletInvokerImpl.action(PortletInvokerImpl.java:68) at org.apache.pluto.PortletContainerImpl.processPortletAction(PortletContainerImpl.java:164) at org.apache.pluto.portalImpl.core.PortletContainerWrapperImpl.processPortletAction(PortletContainerWrapperImpl.java:82) at org.apache.pluto.portalImpl.Servlet.doGet(Servlet.java:227) at org.apache.pluto.portalImpl.Servlet.doPost(Servlet.java:267) at javax.servlet.http.HttpServlet.service(HttpServlet.java:713) at javax.servlet.http.HttpServlet.service(HttpServlet.java:806) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:228) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175) at org.apache.geronimo.tomcat.valve.DefaultSubjectValve.invoke(DefaultSubjectValve.java:56) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:525) at org.apache.geronimo.tomcat.GeronimoStandardContext$SystemMethodValve.invoke(GeronimoStandardContext.java:325) at org.apache.geronimo.tomcat.valve.GeronimoBeforeAfterValve.invoke(GeronimoBeforeAfterValve.java:47) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:542) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:212) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:818) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:624) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:445) at java.lang.Thread.run(Thread.java:595)
database pool type emty in pool creation wizard - Jetty
Using the database pool wizard from the console to create a new pool will not show any database type. This is an issue in the Jetty distribution.
Upgrade server trunk (2.0) to use the latest released geronimo-spec versions
Several spec modules were released in the past week and 2.0 should be using them instead of the previous SNAPSHOT versions.
geronimo-annotation_1.0_spec-1.0
geronimo-jpa_3.0_spec-1.0
The following specs also are newer versions of ones currently being used in 2.0 -
geronimo-ejb_2.1_spec-1.1
geronimo-j2ee-connector_1.5_spec-1.1
geronimo-j2ee-deployment_1.1_spec-1.1
geronimo-jaxr_1.0_spec-1.1
geronimo-jaxrpc_1.1_spec-1.1
geronimo-jms_1.1_spec-1.1
geronimo-jsp_2.0_spec-1.1
geronimo-jta_1.1_spec-1.0
geronimo-qname_1.1_spec-1.1
geronimo-saaj_1.1_spec-1.1
geronimo-servlet_2.4_spec-1.1
Should the following new specs be included in the top-level pom?
geronimo-interceptor_3.0_spec-1.0
geronimo-el_1.0_spec-1.0-SNAPSHOT
geronimo-jsp_2.1_spec-1.0-SNAPSHOT
ArrayIndexOutOfBoundsException when getting Mails from Pop3-Account with geronimo-javamail_1.4_mail-1.0.jar
There are 2 messages in the pop3-account. Using the following code
Store store = session.getStore(&quot;pop3&quot;);
store.connect(popServer, 110, popUser, popKey);
Folder folder = store.getFolder(&quot;INBOX&quot;);
folder.open(Folder.READ_WRITE);
Message message[] = folder.getMessages();
runs in this exception
java.lang.ArrayIndexOutOfBoundsException: 2 &gt;= 2
at java.util.Vector.setElementAt(Vector.java:483)
at org.apache.geronimo.javamail.store.pop3.POP3Folder.getMessage(POP3Folder.java:257)
at javax.mail.Folder.getMessages(Folder.java:468)
at javax.mail.Folder.getMessages(Folder.java:495)
at keygen.main.MailReceiver.receive(MailReceiver.java:42)
at keygen.main.MailReceiver.main(MailReceiver.java:171)
Sample code works with Suns mail.jar. Tested this code with a web application and a standalone client application.
Fix geronimo assemblies
The following assemblies are using car-maven-plugin without specifying a version.
geronimo-boilerplate-j2ee/pom.xml: &lt;artifactId&gt;car-maven-plugin&lt;/artifactId&gt;
geronimo-framework/pom.xml: &lt;artifactId&gt;car-maven-plugin&lt;/artifactId&gt;
geronimo-jetty6-jee5/pom.xml: &lt;artifactId&gt;car-maven-plugin&lt;/artifactId&gt;
geronimo-jetty6-minimal/pom.xml: &lt;artifactId&gt;car-maven-plugin&lt;/artifactId&gt;
geronimo-tomcat6-jee5/pom.xml: &lt;artifactId&gt;car-maven-plugin&lt;/artifactId&gt;
geronimo-tomcat6-minimal/pom.xml: &lt;artifactId&gt;car-maven-plugin&lt;/artifactId&gt;
The version is not inherited from the top pom either, because the plugin is configured in configs pom.
As a result maven picks an &quot;available&quot; version. As shown in the following output, maven picked 
1.2-SNAPSHOT for trunk. The plugin downloads various 1.2-SNAPSHOT jars, e.g. geronimo-kernel, geronimo-system 
and uses them to install configs. This produces strange build and sometime server startup errors.
[INFO]
----------------------------------------------------------------------------
[INFO] Building Geronimo Assemblies :: Boilerplate J2EE
[INFO] task-segment: [clean, install]
[INFO]
----------------------------------------------------------------------------
[INFO] artifact org.apache.geronimo.plugins:car-maven-plugin: checking
for updates from co
dehaus
[INFO] snapshot
org.apache.geronimo.plugins:car-maven-plugin:1.2-SNAPSHOT: checking for
up
dates from apache-snapshots
[INFO] snapshot
org.apache.geronimo.plugins:car-maven-plugin:1.2-SNAPSHOT: checking for
up
dates from codehaus-snapshots
[INFO] snapshot org.apache.geronimo.plugins:maven-plugins:1.2-SNAPSHOT:
checking for updat
es from apache-snapshots
[INFO] snapshot org.apache.geronimo.plugins:maven-plugins:1.2-SNAPSHOT:
checking for updat
es from codehaus-snapshots
[INFO] snapshot org.apache.geronimo:geronimo:1.2-SNAPSHOT: checking for
updates from apach
e-snapshots
[INFO] snapshot org.apache.geronimo:geronimo:1.2-SNAPSHOT: checking for
updates from codeh
aus-snapshots
[INFO] [clean:clean]
[INFO] Deleting directory
C:\anita\geronimo\g2.0\assemblies\geronimo-boilerplate-j2ee\targ
et
[INFO] Deleting directory
C:\anita\geronimo\g2.0\assemblies\geronimo-boilerplate-j2ee\targ
et\classes
[INFO] Deleting directory
C:\anita\geronimo\g2.0\assemblies\geronimo-boilerplate-j2ee\targ
et\test-classes
[INFO] [tools:require-java-version {execution: validate-java-version}]
[INFO] [tools:copy-legal-files {execution: install-legal-files}]
[INFO] Created dir:
C:\anita\geronimo\g2.0\assemblies\geronimo-boilerplate-j2ee\target\cla
sses\META-INF
[INFO] Copying 2 files to
C:\anita\geronimo\g2.0\assemblies\geronimo-boilerplate-j2ee\targ
et\classes\META-INF
[INFO] [dependency:unpack {execution: unpack-boilerplate}]
[INFO] Configured Artifact:
org.apache.geronimo.assemblies:geronimo-boilerplate-minimal:nu
ll:2.0-SNAPSHOT:jar
[INFO] snapshot
org.apache.geronimo.assemblies:geronimo-boilerplate-minimal:2.0-SNAPSHOT:
checking for updates from apache-snapshots
[INFO] snapshot
org.apache.geronimo.assemblies:geronimo-boilerplate-minimal:2.0-SNAPSHOT:
checking for updates from codehaus-snapshots
[INFO] snapshot
org.apache.geronimo.assemblies:geronimo-boilerplate-minimal:2.0-SNAPSHOT:
checking for updates from apache.snapshots
[INFO] Expanding: C:\Documents and
Settings\Anita\.m2\repository\org\apache\geronimo\assem
blies\geronimo-boilerplate-minimal\2.0-SNAPSHOT\geronimo-boilerplate-minimal-2.0-SNAPSHOT.
jar into
C:\anita\geronimo\g2.0\assemblies\geronimo-boilerplate-j2ee\target\boilerplate
[INFO] [antrun:run {execution: extend-boilerplate}]
JSP 2.1 error in Jetty/Tomcat
Deploying a web application with JSP 2.1 features throws error in Jetty and Tomcat
On Tomcat 6:
-------------------
org.apache.jasper.JasperException: /SampleJSP.jsp(12,35) #{..} is not allowed in template text
org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:40)
org.apache.jasper.compiler.ErrorDispatcher.dispatch (ErrorDispatcher.java:406)
org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:101)
org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:710)
org.apache.jasper.compiler.Node$ELExpression.accept (Node.java:935)
org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2336)
org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2386)
org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2392)
org.apache.jasper.compiler.Node$Root.accept (Node.java:489)
org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2336)
org.apache.jasper.compiler.Validator.validate(Validator.java:1679)
org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:178) 
org.apache.jasper.compiler.Compiler.compile(Compiler.java:306)
org.apache.jasper.compiler.Compiler.compile(Compiler.java:286)
org.apache.jasper.compiler.Compiler.compile(Compiler.java:273)
org.apache.jasper.JspCompilationContext.compile (JspCompilationContext.java:566)
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:314)
org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:320)
org.apache.jasper.servlet.JspServlet.service (JspServlet.java:266)
javax.servlet.http.HttpServlet.service(HttpServlet.java:806)
On Jetty 6.0:
--------------------
org.apache.jasper.JasperException: /SampleJSP.jsp(12,35) #{..} is not allowed in template text
at org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:40)
at org.apache.jasper.compiler.ErrorDispatcher.dispatch (ErrorDispatcher.java:406)
at org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:101)
at org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:710)
at org.apache.jasper.compiler.Node$ELExpression.accept (Node.java:935)
at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2336)
at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2386)
at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2392) 
at org.apache.jasper.compiler.Node$Root.accept(Node.java:489)
at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2336)
at org.apache.jasper.compiler.Validator.validate(Validator.java:1679)
at org.apache.jasper.compiler.Compiler.generateJava (Compiler.java:178)
at org.apache.jasper.compiler.Compiler.compile(Compiler.java:306)
at org.apache.jasper.compiler.Compiler.compile(Compiler.java:286)
at org.apache.jasper.compiler.Compiler.compile(Compiler.java :273)
at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:566)
at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:314)
at org.apache.jasper.servlet.JspServlet.serviceJspFile (JspServlet.java:320)
at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:266)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:806)
at org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java :459)
at org.apache.geronimo.jetty6.InternalJettyServletHolder.handle(InternalJettyServletHolder.java:62)
at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:360)
at org.apache.geronimo.jetty6.JettyServletHandler.doHandle (JettyServletHandler.java:55)
at org.apache.geronimo.jetty6.JettyServletHandler$ActualJettyServletHandler.handle(JettyServletHandler.java:62)
at org.apache.geronimo.jetty6.JettyServletHandler$NoOpChainedHandler.handle (JettyServletHandler.java:70)
at org.apache.geronimo.jetty6.JettyServletHandler.handle(JettyServletHandler.java:47)
at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:231)
at org.apache.geronimo.jetty6.handler.ThreadClassloaderHandler.handle (ThreadClassloaderHandler.java:46)
at org.apache.geronimo.jetty6.handler.ComponentContextHandler.handle(ComponentContextHandler.java:47)
at org.apache.geronimo.jetty6.handler.InstanceContextHandler.handle(InstanceContextHandler.java :58)
at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:629)
at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:389)
at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java :123)
at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:141)
at org.mortbay.jetty.Server.handle(Server.java:303)
at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:452)
at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:721)
at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:509)
at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java :209)
at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:349)
at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:217)
at org.mortbay.thread.BoundedThreadPool$PoolThread.run (BoundedThreadPool.java:475)
Non-Geronimo servlet-api-2.4.jar being included in G1.2 build
Looking at the unstable geronimo-tomcat-j2ee-1.2-r483346 build, the servlet-api-2.4.jar file is being used instead of geronimo-servlet_2.4_spec-1.0.1.jar by the following -
ca-helper-tomcat
remote-deploy-tomcat
The following includes both servlet-api-2.4.jar and geronimo-servlet_2.4_spec-1.0.1.jar -
uddi-tomcat
welcome-tomcat
Would expect the Jetty assembly has the same problem.
welcome app not included in the jetty assembly.
geronimo-welcome-jetty not included in the jetty assembly
Common libs portlet guesses wrong group ID, gives no usage advice
When selecting a file for the repository portlet, it selected the version number as the group ID. It should probably default to a blank group ID and make the user enter it -- the best it can select from the file name is probably the artifact, version, and type.
Also, it should have an option where you pick a JAR and it gives you the dependency syntax you need to add that JAR to the classpath for an application or other Geronimo module.
Web app security on /* causes deployment exception
Deploying a web app with the following security block causes a deployment error:
&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;All Pages&lt;/web-resource-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;http-method&gt;POST&lt;/http-method&gt;
&lt;http-method&gt;PUT&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;User&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
Note this is essentially right out of the spec (see SRV.12.8.2 in the Servlet 2.4 spec).
The error is:
org.apache.geronimo.common.DeploymentException: Unable to initialize webapp GBean
at org.apache.geronimo.jetty.deployment.JettyModuleBuilder.addGBeans(JettyModuleBuilder.java:842)
...
Caused by: java.lang.IllegalArgumentException: Qualifier patterns in the URLPatternSpec cannot match the first URLPattern
at javax.security.jacc.URLPatternSpec.&lt;init&gt;(URLPatternSpec.java:54)
at javax.security.jacc.WebResourcePermission.&lt;init&gt;(WebResourcePermission.java:54)
at org.apache.geronimo.jetty.deployment.JettyModuleBuilder.buildSpecSecurityConfig(JettyModuleBuilder.java:1215)
at org.apache.geronimo.jetty.deployment.JettyModuleBuilder.addGBeans(JettyModuleBuilder.java:821)
... 70 more
Changing the url-pattern to / fixes the problem, but it seems to me that /* ought to work too.
Docs produced by Confluence contain spaces in file names
This was reported to the dev list in:
http://www.mail-archive.com/dev%40geronimo.apache.org/msg14471.html
Deployer.deploy arguments inconsistent
One deploy method starts with the arguments:
File module, File plan
Another overloaded deploy method starts with the arguments:
File plan, File module
These should not be reversed, but we need to carefully hunt down usages since the types alone won't cause the usages to be flagged if one is switched.
Spelling error in eventadmin/pom.xml
In the org.apache.felix.eventadmin pom.xml file, the DynamicImport-Package header is misspelled as Dynamic-ImportPackage. This leads to the problem, that eventadmin cannot log to a LogService -. worse even, trying to log throws a ClassDefNotFoundError, which prevents event admin from working altogether.
Here's the diff from within the eventadmin folder (Copy-Pasting for simplicity reasons) :
Index: pom.xml
===================================================================
--- pom.xml (Revision 498996)
+++ pom.xml (Arbeitskopie)
@@ -37,9 +37,9 @@
&lt;Bundle-Activator&gt;
${pom.artifactId}.impl.Activator
&lt;/Bundle-Activator&gt;
- &lt;Dynamic-ImportPackage&gt;
+ &lt;DynamicImport-Package&gt;
org.osgi.service.log
- &lt;/Dynamic-ImportPackage&gt;
+ &lt;/DynamicImport-Package&gt;
&lt;Import-Package&gt;!org.osgi.service.log,*&lt;/Import-Package&gt;
&lt;Export-Package&gt;org.osgi.service.event&lt;/Export-Package&gt;
&lt;Private-Package&gt;org.apache.felix.eventadmin.impl.*&lt;/Private-Package&gt;
iPOJO Core Bugs Fix
A lot of small bugs was found thanks to the new iPOJO Test Suite : 
InstanceManager :
- Add a &quot;stopped&quot; state
Factory :
- Component Factory classloader should be able to define classes
Dependency Handler
- Fix a behavior problem when service = null
- The nullable class name is not consistent
- The nullable classloader is not used
- Define class problem when a nullable class is defiens two times
- Dependency Metadata are no more used after the creation
- Dependency Callback with argument are not invoked
iPOJO Description
- Lack of some info to displays
Provided Service Handler 
- Provided Service Handler check that the POJO implements at least one interface
Configuration Handler
- avoid double properties
External handler management inside the iPOJO Architecture Handler
When using an external handler, the architecture service does not contains information (name, validity) for this handler.
For example, a component using an external Log Handler is displayed as : 
Instance : ipojo.log.example - INVALID from bundle 8
Handler : org.apache.felix.ipojo.handlers.dependency.DependencyHandler : valid
Dependency on org.apache.felix.ipojo.foo.FooService[] is resolved
Handler : org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler : valid
and should be :
Instance : ipojo.log.example - INVALID from bundle 8
Handler : org.apache.felix.ipojo.handlers.dependency.DependencyHandler : valid
Dependency on org.apache.felix.ipojo.foo.FooService[] is resolved
Handler : org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler : valid
Handler : org.apache.felix.ipojo.log.handler.LogHandler : invalid
ResourceSource.getInfos() leaves URLConnection open, resulting in 'too may open files' condition
org.apache.excalibur.source.impl.ResourceSource#getInfos() opens a URLConnection [line 79] to obtain information about the resource, however, it does not cause this connection to be closed (i.e. call getInputStream() and then close() that), thus the resulting file-descriptor will only be closed when the garbage collector collects the URLConnection object.
Quote from java.net.URLConnection javadoc:
&quot;Calling the close() methods on the InputStream or OutputStream of an URLConnection after a request may free network resources associated with this instance, unless particular protocol specifications specify different behaviours for it.&quot;
On a high-load system, which is accessing resources in jars frequently (even if only as a side-effect of calling getValidity()), this may result in all available file-descriptors being used within a short period, and because GC is not kicked off when a process runs out of file-descriptors, this can result in a DoS.
This problem has occured on a live system running Apache Cocoon 2.1.8.
Bring build into the modern world
I updated the triplesec build to:
- uses groupId org.apache.directory.triplesec
- include all dependency versions in root pom dependencyManagement
- include all plugin versions in root pom pluginManagement
- use latest apacheDS and wicket and a few other projects
- actually build
The attached patch has minimal format changes. It really needs pom cleanup, but I am reluctant to supply a patch that changes almost every line of every file involved.
Start toward using java.security.Permission
Opening this issue for visibility of the work I'm proposing on the dev list for making triplesec useable as a JACC provider.
Entry Editor refresh does not work properly
Entry Editor refresh does not work properly, caching problem.
To reproduce:
1. Create attribute 'description:test' in entry editor
2. Delete attribute using another LDAP client
3. Refresh entry editor, attribute description is still displayed.
Cannot browse DIT after opening a bookmark
Here's how to reproduce the bug:
- With a disconnected connection, double-click on a bookmark.
- The bookmarks show up. Now try to double-click on the DIT node to browse the server...
- Nothing is returned and the node is empty.
The Outline View is not cleared when selecting DIT, Searches or Bookmarks node on the Browser View
The Outline View is not cleared when selecting DIT, Searches or Bookmarks node on the Browser View.
The Outline View still refers to the last viewed entry.
Trying to modify operational attributes does not cause appropriate errors
Trying to modify operational attributes of entries (modifiersName, creatorsName) does not cause approriate errors. FInd attached a JUnit test which performs three modify operations (adding/deleting/reoplacing an operational attribute) with the help of JNDI. All of them do not throw an exception.
I have checked the test with three other LDAP servers. OpenLDAP and Sun Java System Directory Server return an LDAP code 19 (LDAP_CONSTRAINT_VIOLATION), IBM Tivoli Directory Server returns 50 (LDAP_INSUFFICIENT_ACCESS).
venderVersion attribute contains maven placeholder as value
If a client requests the vendorVersion from the RootDSE, s/he gets &quot;${pom.version}&quot; as value:
$ ldapsearch -h localhost -p 10389 -D &quot;uid=admin,ou=system&quot; -w ******-b &quot;&quot; -s base &quot;(ObjectClass=*)&quot; vendorVersion
version: 1
dn:
vendorVersion: ${pom.version}
The issue does not exist in previous versions, and is likely a side effect of the reorganisation activities for the 1.5 version.
Spliiting LDIF lines does not work correctly
When trying to split a LDIF line every N chars, the last char of each line is repeated on the next line :
abcdef to be split wih 3 chars lines will generate :
&quot;abc\n&quot;
&quot; cd\n&quot;
&quot; de\n&quot;
&quot; ef&quot;
instead of
&quot;abc\n&quot;
&quot; de\n&quot;
&quot; f&quot;
User or operational attributes are missing in search results, if both are requested by a client
I assume that fixing DIRSERVER-804 had an undesired side effect. Here are two search ops, that work in the current 1.0.1 (default server.xml settings):
$ ldapsearch -h localhost -p 10389 -D &quot;uid=admin,ou=system&quot; -w ****** -b &quot;ou=system&quot; -s base &quot;(ObjectClass=*)&quot; +
version: 1
dn: ou=system
createTimestamp: 20070113123859Z
creatorsName: uid=admin,ou=system
$ ldapsearch -h localhost -p 10389 -D &quot;uid=admin,ou=system&quot; -w ****** -b &quot;ou=system&quot; -s base &quot;(ObjectClass=*)&quot; *
version: 1
dn: ou=system
ou: system
objectclass: top
objectclass: organizationalUnit
objectclass: extensibleObject
$
But if someone combines + and * in order to get all the attributes, s/he gets this
$ ldapsearch -h localhost -p 10389 -D &quot;uid=admin,ou=system&quot; -w ****** -b &quot;ou=system&quot; -s base &quot;(ObjectClass=*)&quot; * +
version: 1
dn: ou=system
createTimestamp: 20070113123859Z
creatorsName: uid=admin,ou=system
$ ldapsearch -h localhost -p 10389 -D &quot;uid=admin,ou=system&quot; -w ****** -b &quot;ou=system&quot; -s base &quot;(ObjectClass=*)&quot; + *
version: 1
dn: ou=system
ou: system
objectclass: top
objectclass: organizationalUnit
objectclass: extensibleObject
Either the operational or the user attributes are missing.
Nested delete fails when replication enabled
I found that if a directory entry had child entries that had previously been removed and marked as deleted by the replication inteceptor, then it could not be deleted:
From JXplorer: &quot;Javax.naming.ContextNotEmptyException: [LDAP: error code 66 - failed to delete entry]&quot;
This is because the nextInteceptor.list() method does not return an attribute array (I guess for optimisation?) and therfore the DELETED_ENTRIES_FILTER never filtered the 'marked as deleted' entries... hence the ContextNotEmptyException.
Proposed patch attached.
Infinite loop while parsing a bad filter
If we try to parse a bad filter ( for instance, without parenthesis ), the parser is entering an ininite loop.
Here is a test case to show this behavior :
public void testBadEqualsFilter() throws IOException, ParseException
{
try
{
SimpleNode node = ( SimpleNode ) parser.parse( &quot;ou = people&quot; );
// The parsing should fail
fail();
}
catch( ParseException pe )
{
assertTrue( true );
}
}
Simply copy/paste it into org.apache.directory.shared.ldap.filter.FilterParserImplTest in shared-ldap
Alias names, OIDs an subtypes of requested attributes are ignored
Having an entry with 'givenname: test'. When requesting 'givenname' in a search the values are returned. But when requesting alias 'gn' or the OID '2.5.4.42' no values are returned. Also when requesting the supertype 'name' no subtypes like 'givenname' or 'sn' are returned.
Attribute names are being lowercased again instead of being returned AS-IS
Looks like we're returning normalized (lower cased) attribute names again instead of returning them as they were added to an entry. This is OK according to spec but it is pretty lousy behavior that I'd like to get rid of.
Adding another value to an attribute results in the value to be added twice
If I add a new attribute to a class, its value is stored fine.
But, if I thereafter add another value for the same attribute, this value is added twice.
I encountered this with Jetspeed-2 ldap unit tests, but could then easily reproduce this with for instance LDAP Browser\Editor v.2.8.2
schema checking
Hi,
I understand that &quot;LDAP directories use the concept of object classes to
define which attributes are allowed for objects of any given type&quot;
consequently , I would like to know if the following behavior is normal:
in ApacheDS I am able to make use of any attribute without having added
the object classes which provide these attributes.
Illustration
say I have an entry uid=kevin, ou=users,ou=sample
kevin has the following attributes cn=kevin spacey, dc=ke, objectclass=top
Is it normal for apacheDS to allow me add cn and dc attributes even
though I havent added the object classes Person and domain ?
Please start a new thread when you change the topic.
Schema checking should prevent this if it is enabled and by default it
is in ApacheDS. If it's not doing that then we have a bug.
here is the code
public class CreateSubcontext {
/**
* @param args
*/
public static void main(String[] args)
{
try
{
//use properties file to set connection
InputStream inputStream = new FileInputStream( &quot;apacheds.properties&quot;);
Properties properties = new Properties();
properties.load(inputStream);
//create context
DirContext ctx=new InitialDirContext(properties);
//mould entry
Attributes attrs=new BasicAttributes(true);
Attribute obj=new BasicAttribute(&quot;ObjectClass&quot;, &quot;top&quot;);
Attribute ob = new BasicAttribute(&quot;cn&quot;, &quot;kevin Spacey&quot;);
Attribute ob1 = new BasicAttribute(&quot;dc&quot;, &quot;ke&quot;);
attrs.put(obj);
attrs.put(ob);
attrs.put(ob1);
String rdns=&quot;uid=kevin&quot;;
//create subcontext
DirContext result=ctx.createSubcontext(rdns, attrs);
result.close();
}catch(Exception e)
{
System.out.println(e);
}
}
Problem with escaped comma in DN
1. Add the following entry:
ldapadd -h localhost -p 10389 -D uid=admin,ou=system -w secret -x
dn: cn=Dewata\, Endi,ou=Users,ou=system
objectClass: person
cn: Dewata, Endi
sn: Dewata
2. Search the entry:
ldapsearch -h localhost -p 10389 -D uid=admin,ou=system -w secret -x -b &quot;ou=system&quot;
#
dn: cn=Dewata, Endi,ou=Users,ou=system
objectclass: person
objectclass: top
sn: Dewata
cn: Dewata, Endi
The escape character (\) is missing from the DN, causing it to become invalid.
IoSession.readBufferSize becomes different from Socket.receiveBufferSize when receiveBufferSize is configured too small.
Calling SocketSessionConfig.setReceiveBufferSize() with very small value (e.g. 512) will cause the specified buffer size to be adjusted to the minimum value supported by operating system (e.g. 1024). IoSession.readBufferSize doesn't check the actual receiveBufferSize value after setting the buffer size, so there's undesired difference between receiveBufferSize and readBufferSize.
TextLineDecoder throws IllegalArgumentException
A bug report from James Im:
---- MESSAGE BEGINS ----
I need your help to determine if I have found a bug or not.
I use a slightly modified version of TextLineDecoder and I got an error
in decodeNormal() at line 272 (the line number correspond to the version
on the trunk):
in.limit( in.limit() - matchCount + oldMatchCount );
After investigating a bit I found that I was trying to set the limit to
8193 which was greater than the capacity (8192). Thus the error.
I've investigated some more and I saw that it happened when the
matchCount passed to decodeNormal() was 1 instead of 0.
I've investigated some more and I think that oldMatchCount should be
reset to zero when you have found a match.
Thus, after line 261 I have added:
oldMatchCount=0;
After I did this change the problem was solved. The problem did not
occurred 100% of the time on my server and thus I have no specific test
case to reproduce the problem.
As it is hard to analyze buffer, position, limit, remaining and capacity
in loops and I therefore ask you to do a mental effort to verify if I
am right or wrong.
---- MESSAGE ENDS ----
OutOfMemory when using ReadThrottleFilter
Swen Moczarski wrote:
Hi, I have done some performance tests. A client is sending a lot of small messages over a connection to a server. In
spite of the read-throttle-filter (org.apache.mina.filter.ReadThrottleFilterBuilder) the server will be overloaded and I
get out-of-memory exceptions.
Before the message will be forwarded to the ExecutionFilter, the ReadThrottleFilter makes use of ByteBuffer.remaining()
for increasing the calculated size of the connection buffer. But after passing the ExecutionFilter the method
ByteBuffer.capacity() is used to decrease the size. Is that behaviour intended?
When I'm patching the ReadThrottleFilterBuilder to use ByteBuffer.capacity() for both cases the performance test works
absolutely fine, there are no longer out-of-memory exceptions. BTW, in the SVN-history I have seen that the first
version uses ByteBuffer.capacity() for both cases.
I have a second question: Is it correct that for a SocketAcceptor the ReadThrottleFilter have to add in the session
created method like this:
public void sessionCreated(IoSession session) throws Exception {
ReadThrottleFilterBuilder builder = new ReadThrottleFilterBuilder();
builder.attach(session.getFilterChain());
}
This is the first time where the ExecutionFilter is available in the filter chain.
Thanks a lot for any help,
Swen
SwingChatClient example throws NPE
session.write( &quot;LOGIN &quot; + name );
is called before the session is retrieved from the ConnectFuture
I will attach a trivial patch.
(also added an ExecutorFilter to serverContext.xml)
java.lang.NullPointerException
at org.apache.mina.example.chat.client.ChatClientSupport.login(ChatClientSupport.java:93) at org.apache.mina.example.chat.client.SwingChatClient.connected(SwingChatClient.java:283) at org.apache.mina.example.chat.client.SwingChatClientHandler.sessionOpened(SwingChatClientHandler.java:69) at org.apache.mina.common.support.AbstractIoFilterChain$TailFilter.sessionOpened(AbstractIoFilterChain.java:658) at org.apache.mina.common.support.AbstractIoFilterChain.callNextSessionOpened(AbstractIoFilterChain.java:290) at org.apache.mina.common.support.AbstractIoFilterChain.access$700(AbstractIoFilterChain.java:53) at org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.sessionOpened(AbstractIoFilterChain.java:760) at org.apache.mina.filter.LoggingFilter.sessionOpened(LoggingFilter.java:114) at org.apache.mina.common.support.AbstractIoFilterChain.callNextSessionOpened(AbstractIoFilterChain.java:290) at org.apache.mina.common.support.AbstractIoFilterChain.access$700(AbstractIoFilterChain.java:53) at org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.sessionOpened(AbstractIoFilterChain.java:760) at org.apache.mina.common.IoFilterAdapter.sessionOpened(IoFilterAdapter.java:63) at org.apache.mina.common.support.AbstractIoFilterChain.callNextSessionOpened(AbstractIoFilterChain.java:290) at org.apache.mina.common.support.AbstractIoFilterChain.access$700(AbstractIoFilterChain.java:53) at org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.sessionOpened(AbstractIoFilterChain.java:760) at org.apache.mina.common.support.AbstractIoFilterChain$HeadFilter.sessionOpened(AbstractIoFilterChain.java:593) at org.apache.mina.common.support.AbstractIoFilterChain.callNextSessionOpened(AbstractIoFilterChain.java:290) at org.apache.mina.common.support.AbstractIoFilterChain.fireSessionOpened(AbstractIoFilterChain.java:282) at org.apache.mina.common.support.IoServiceListenerSupport.fireSessionCreated(IoServiceListenerSupport.java:197) at org.apache.mina.transport.socket.nio.SocketIoProcessor.doAddNew(SocketIoProcessor.java:172) at org.apache.mina.transport.socket.nio.SocketIoProcessor.access$300(SocketIoProcessor.java:49) at org.apache.mina.transport.socket.nio.SocketIoProcessor$Worker.run(SocketIoProcessor.java:535) at org.apache.mina.util.NamePreservingRunnable.run(NamePreservingRunnable.java:43) at
java.lang.Thread.run(Thread.java:595)
StatCollector is not thread safe and some stats are being mixed up
The instance variable polledSessions is not thread-safe (i.e. uses ArrayList) and its access is not always protected (e.g. StatCollector$Worker#run()). Under heavy load this is producing an error in the Worker.
The bytesReadThroughput statistic is incorrectly being set. It is adding up the throughput of written messages.
Instance variables: msgWrittenThroughput, msgReadThroughput, bytesWrittenThroughputand bytesReadThroughput could be corrupted and return an unexpected value since they are not thread safe and 2 different threads may be changing them.
The access modifier of DemuxingIoHandler.findHandler(Class) should be 'protected'
People might want to override DemuxingIoHandler.findHandler(Class) to provide a default handler, or more dynamic resolution of MessageHandler, as we discussed here:
http://www.nabble.com/Extending-from-DemuxingIoHandler-tf2697240.html
ProtocolCodecFilter can not be dynamicly be replaced by another.
ProtocolCodecFilter can not be dynamicly added and removed because the encoder en decoder attributes are not removed from the IoSession when the ProtocolCodecFilter is removed.
Index: core/src/main/java/org/apache/mina/filter/codec/ProtocolCodecFilter.java
===================================================================
--- core/src/main/java/org/apache/mina/filter/codec/ProtocolCodecFilter.java (revision 487691)
+++ core/src/main/java/org/apache/mina/filter/codec/ProtocolCodecFilter.java (working copy)
@@ -141,6 +141,12 @@
}
}
+ public void onPostRemove(IoFilterChain parent, String name, NextFilter nextFilter) throws Exception {
+ disposeEncoder(parent.getSession());
+ disposeDecoder(parent.getSession());
+ }
+
+
public void messageReceived( NextFilter nextFilter, IoSession session, Object message ) throws Exception
{
if( !( message instanceof ByteBuffer ) )
Invalid sequence of events with VmPipe Transport
Sometimes when using VmPipe transport, event sequences get out of order. Namely, the messageReceived method is invoked before the sessionOpened. To following sequence of events highlights the problem:
- using VmPipeConnector and VmPipeAcceptor
- client connects to server
- server's IoHandler#sessionOpened method is called
- server sends a message from the sessionOpened method
- client receives that message (IoHandler#messageReceived)
- client's IoHandler#sessionOpened method is invoked
IoHandler#sessionOpened should always be invoked before the first invocation of IoHandler#messageReceived.
DatagramConnector.getRecycledSession() is inefficient.
DatagramConnector.getRecycledSession() accepts IoSession as a parameter, and thus it causes unnecessary instantiation of IoSession instance.
JDBC3 driver is loaded instead of JDBC4 when running with jdk1.7
When running tests with jdk1.7 I discovered that the test harness used 1.6 master files and tested JDBC4 functionality, but Derby loaded a JDBC3 driver, causing a lot of failures.
The problem is caused by code in engine/org/apache/derby/iapi/services/info/JVMInfo.java that controls what version of JDBC to use, based on the version of java that the jvm is running. A check at the end seems to be intended to make sure that Derby is compatible with future jdk versions, but it is outdated and makes sure that any &quot;unknown&quot; jvm newer than 1.4 uses JDBC3. The check should be changed to make sure that any jvm newer than 1.6 uses JDBC4:
- if (Float.valueOf(javaVersion).floatValue() &gt; 1.4f)
- id = 5;
+ if (Float.valueOf(javaVersion).floatValue() &gt; 1.6f)
+ id = J2SE_16;
compatibilitytest fails after DERBY-2121 change.
Client-server compatibility testing with JVM 1.3 is not relevant on trunk/10.3 following DERBY-2121
See e.g. 
http://dbtg.thresher.com/derby/test/tinderbox_trunk15/jvm1.5/testing/Limited/testSummary-495558.html
http://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/Limited/testSummary-495683.html
Three tests from i18nTest fails on SLES with jdk1.4.2 when derbyrun.jar comes before derby.jar in the classpath
The problem has been observed in nightly tests run on SLES with JDK1.4.2. The triggering factor seems to be that derbyrun.jar comes before derby.jar in the classpath. The problem seems very similar to JIRA1883, it is the same three tests that are failing, but this time it is derbyrun.jar that comes before derby.jar in the classpath. I have tested a fix in the policy file by giving derbyrun.jar the permissions that were given to derbynet.jar in JIRA1883 (reading properties), and that seems to solve the problem.
Support Derby on J2ME/CDC/Foundation 1.1
Derby works on J2ME/CDC/Foundation 1.0 with JSR 169 and thus should also be able to run on Foundation 1.1since Foundation 1.1 is backwards compatible.
However the additon of BigDecimal breaks an assumption made in the Foundation 1.0 implementation, see DERBY-2224 and DERBY-2210 for details.
I think simple changes that ensure the CDC data factory is booted rather than the J2SE data factory should fix any issues with a Foundation 1.1 platform.
I think currently the J2SE data factory is being booted becase BigDecimal exists, when in reality it requires BigDecimal and JDBC 2 or higher.
This big is not intended to take advantage of new features in Foundation 1.1, that is handled by DERBY-2210.
Nested test configuration decorators based upon ChangeConfigurationSetup do not work as expected.
Usage of ChangeConfigurationSetup creates a TestConfiguration object at object creation time based upon the current configuration, instead it should create the configuration based upon the current configuration at setUp time.
Nesting two decorators A and B in a suite method that change the configuration, e.g.
return new B(new A(suite))
will cause A and B to be a modified version of the current configuration at suite creation time, when B should be a modified version of A
and A should be a modified version of the current configuration when its setUp is run.
Fix Getting Started file to reflect classpath change
The Getting Started topic &quot;Setting the classpath&quot; (tgs26250.dita) needs to be edited to reflect the fix to DERBY-2208.
DROP PROCEDURE depends on SET SCHEMA
This is possibly related to Bug https://issues.apache.org/jira/browse/DERBY-1304.
Use ij to execute the following statements:
CREATE SCHEMA datamgmt;
CREATE PROCEDURE datamgmt.exit ( IN value INTEGER )
MODIFIES SQL DATA
PARAMETER STYLE JAVA
LANGUAGE JAVA
EXTERNAL NAME 'java.lang.System.exit'
;
DROP PROCEDURE datamgmt.exit;
DROP SCHEMA datamgmt RESTRICT;
Then execute exactly the same lines once again. Then statement &quot;DROP PROCEDURE datamgmt.exit&quot; yields:
ERROR 42X94: PROCEDURE 'EXIT' does not exist.
However, if the DROP works if a default schema (SET SCHEMA) is used instead of the prefixed schemaName. That is, the following lines can be executed more than once in a row:
CREATE SCHEMA datamgmt;
CREATE PROCEDURE datamgmt.exit ( IN value INTEGER )
MODIFIES SQL DATA
PARAMETER STYLE JAVA
LANGUAGE JAVA
EXTERNAL NAME 'java.lang.System.exit'
;
SET SCHEMA datamgmt;
DROP PROCEDURE exit;
DROP SCHEMA datamgmt RESTRICT;
Therefore, SET SCHEMA can be used as a workaround, hence minor importance.
Nested triggers not working properly after maximum trigger count exception is thrown
After the maximum allowed nested trigger exception is thrown, subsequent statement that result in nested trigger execution may result in the same error again even though it does not exceed the limit of nested triggers(16).
e.g.:
C:\derby\trunk&gt;java -classpath classes;. org.apache.derby.tools.ij
ij version 10.3
ij&gt; connect 'jdbc:derby:wombat;create=true';
ij&gt; create table t1 (i int);
0 rows inserted/updated/deleted
ij&gt; insert into t1 values 1,2,3;
3 rows inserted/updated/deleted
ij&gt; create trigger tr1 after update on t1 for each row update t1 set i=i+1;
0 rows inserted/updated/deleted
-- force the &quot;maximum depth of nested triggers&quot; error to occur
ij&gt; update t1 set i=i+1;
ERROR 54038: Maximum depth of nested triggers was exceeded.
ij&gt; drop trigger tr1;
0 rows inserted/updated/deleted
ij&gt; create trigger tr1 after update on t1 referencing old as oldt for each row update t1 set i=i+1 where oldt.i=2;
0 rows inserted/updated/deleted
-- this should have executed successfully instead of throwing the same error again!
ij&gt; update t1 set i=i+1;
ERROR 54038: Maximum depth of nested triggers was exceeded.
ij&gt; disconnect;
ij&gt; connect 'jdbc:derby:wombat';
ij&gt; select * from t1;
I
-----------
1
2
3
3 rows selected
-- ok after reconnection, it looks like the trigger execution context(TEC) may not have been cleanup properly in the previous connection
ij&gt; update t1 set i=i+1;
3 rows inserted/updated/deleted
ij&gt; select * from t1;
I
-----------
4
5
6
3 rows selected
ij&gt;
A few more problems with Working with Derby manual
After rerunning the tasks in Working With Derby, I found a few more issues.
1) There's a step-ordering problem: The Introduction tells users to verify that DERBY_HOME is set, but instructions for setting it don't appear till Activity 1. The instructions for setting DERBY_HOME should be moved to the Introduction.
2) In step 2 of Activity 1, add a statement that ij commands can be in either uppercase or lowercase, to prevent confusion when both forms are used.
3) Fix horizontal and vertical spacing in command and code examples.
4) Correct the derby.log output and description.
QuickStart section of java/testing/README.htm should contain Sun JDK6 as supported java version for running tests
The QuickStart section in java/testing/README.htm lists the java versions that are supported for running Derby tests. JDK6 should be added to this list.
Trigger recompilation problem when trigger action has its table not qualified with a schema
Trigger recompilation problem when trigger action has its table not qualified with a schema.
SPSs in SYS.SYSSTATEMENTS get invalidated for recompilation when sqlj.install_jar, sqlj.remove_jar, sqlj.replace_jar are called, or when a database upgrade is performed. The problem arises when the trigger action statement does not qualify the table with an explicit schema name. During recompilation it uses the default schema instead of using the original schema that was persisted in SYS.SYSSTATEMENTS causing an exception to occur. e.g.:
C:\derby\trunk&gt;java -classpath classes;. org.apache.derby.tools.ij
ij version 10.3
ij&gt; connect 'jdbc:derby:wombat;create=true';
ij&gt; create table app.t1 (i int, j int);
0 rows inserted/updated/deleted
ij&gt; insert into app.t1 values (1,10);
1 row inserted/updated/deleted
-- notice trigger action's update statement did not qualify table t1 with a schema name
ij&gt; create trigger app.tr1 after update of i on app.t1 update t1 set j = 1;
0 rows inserted/updated/deleted
ij&gt; update app.t1 set i=i+1;
1 row inserted/updated/deleted
ij&gt; select * from app.t1;
I |J
-----------------------
2 |1
1 row selected
-- this action invalidates the SPS and mark for recompilation
ij&gt; call sqlj.install_jar('c:/derby/procs/Procs.jar', 'APP.Procs', 0);
0 rows inserted/updated/deleted
ij&gt; disconnect;
ij&gt; connect 'jdbc:derby:wombat' user 'user1';
-- recompilation occurs but uses 'USER1' as the schema to compile instead of 'APP', resulting in error
ij&gt; update app.t1 set i=i+1;
ERROR 42Y07: Schema 'USER1' does not exist
ij&gt;
suites.All fails after revision 483606 with ibm15
With ibm 1.5 jvm, SR 3, suites.All fails with 4 failures and 61 errors. I backtracked my environment, clobbering all the way, to 483606. Before that checking, all passes, after, there are failures.
I am attaching a run.out from a junit.textui.TestRunner result, but basically, there are 3 kind of errors:
- Connection failed like this:
------------------------------------------------------
FEEEEEEEEEEEEEEEEEEEEEEEEEEE.E.EE.EEjava.lang.Exception: DRDA_NoIO.S:Could not connect to Derby Network Server on host 127.0.0.1, port 1527.
at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(Unknown Source)
at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(Unknown Source)
at org.apache.derby.impl.drda.NetworkServerControlImpl.setUpSocket(Unknown Source)
at org.apache.derby.impl.drda.NetworkServerControlImpl.ping(Unknown Source)
at org.apache.derby.drda.NetworkServerControl.ping(Unknown Source)
at org.apache.derbyTesting.junit.NetworkServerTestSetup.waitForServerStart(Unknown Source)
at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(Unknown Source)
------------------------------------------------------
2. SQLCAMESSAGE error 42X50 trouble like this one from SURData: 
&quot;.............java.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: 42X50, SQLERRMC: org.apache.derby.catalog.SystemProceduresSQLCAMESSAGEint, short, java.lang.String, java.lang.String, int, int, int, int, int, int, java.lang.String, java.lang.String, java.lang.String, java.lang.String, java.lang.String[], int[]42X50
at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(Unknown Source)
at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source)
at org.apache.derby.client.am.Statement.execute(Unknown Source)
at org.apache.derbyTesting.functionTests.tests.jdbcapi.SURDataModelSetup.createDataModel(Unknown Source)
at org.apache.derbyTesting.functionTests.tests.jdbcapi.SURDataModelSetup.createDataModel(Unknown Source)
at org.apache.derbyTesting.functionTests.tests.jdbcapi.SURDataModelSetup.setUp(Unknown Source)
(..snipped junit stack...)
Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: 42X50, SQLERRMC: org.apache.derby.catalog.SystemProceduresSQLCAMESSAGEint, short, java.lang.String, java.lang.String, int, int, int, int, int, int, java.lang.String, java.lang.String, java.lang.String, java.lang.String, java.lang.String[], int[]42X50
at org.apache.derby.client.am.SqlException.copyAsUnchainedSQLException(Unknown Source)
at org.apache.derby.client.am.Sqlca.chainDeferredExceptionsToAgentOrAsConnectionWarnings(Unknown Source)
at org.apache.derby.client.am.Sqlca.getJDBCMessage(Unknown Source)
at org.apache.derby.client.am.SqlException.getMessage(Unknown Source)
... 29 more
And various LangScripts and other tests also failed with error 42X50
e.g.: 
1) GROUP BY expression testsERROR 42X50: No method was found that matched the method call org.apache.derby.catalog.SystemProcedures.SYSCS_SET_DATABASE_PROPERTY(java.lang.String, java.lang.String), tried all combinations of object and primitive types and any possible type conversion for any parameters the method call may have. The method might exist but it is not public and/or static, or the parameter types are not method invocation convertible.
at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)
at org.apache.derby.impl.sql.compile.MethodCallNode.throwNoMethodFound(Unknown Source)
at org.apache.derby.impl.sql.compile.MethodCallNode.resolveMethodCall(Unknown Source)
at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(Unknown Source)
at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(Unknown Source)
at org.apache.derby.impl.sql.compile.CallStatementNode.bindStatement(Unknown Source)
at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)
at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)
at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source)
at org.apache.derby.impl.jdbc.EmbedCallableStatement.&lt;init&gt;(Unknown Source)
at org.apache.derby.jdbc.Driver30.newEmbedCallableStatement(Unknown Source)
at org.apache.derby.impl.jdbc.EmbedConnection.prepareCall(Unknown Source)
at org.apache.derby.impl.jdbc.EmbedConnection.prepareCall(Unknown Source)
at org.apache.derbyTesting.junit.CleanDatabaseTestSetup.clearProperties(Unknown Source)
at org.apache.derbyTesting.junit.CleanDatabaseTestSetup.cleanDatabase(Unknown Source)
at org.apache.derbyTesting.junit.CleanDatabaseTestSetup.tearDown(Unknown Source)
at junit.extensions.TestSetup$1.protect(TestSetup.java:20)
at junit.extensions.TestSetup.run(TestSetup.java:23)
2) case(org.apache.derbyTesting.functionTests.tests.lang.LangScripts)ERROR 42X50: No method was found that matched the method call org.apache.derby.catalog.SystemProcedures.SYSCS_SET_DATABASE_PROPERTY(java.lang.String, java.lang.String), tried all combinations of object and primitive types and any possible type conversion for any parameters the method call may have. The method might exist but it is not public and/or static, or the parameter types are not method invocation convertible.
at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)
at org.apache.derby.impl.sql.compile.MethodCallNode.throwNoMethodFound(Unknown Source)
at org.apache.derby.impl.sql.compile.MethodCallNode.resolveMethodCall(Unknown Source)
at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(Unknown Source)
at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(Unknown Source)
at org.apache.derby.impl.sql.compile.CallStatementNode.bindStatement(Unknown Source)
at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)
at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)
at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source)
at org.apache.derby.impl.jdbc.EmbedCallableStatement.&lt;init&gt;(Unknown Source)
at org.apache.derby.jdbc.Driver30.newEmbedCallableStatement(Unknown Source)
at org.apache.derby.impl.jdbc.EmbedConnection.prepareCall(Unknown Source)
at org.apache.derby.impl.jdbc.EmbedConnection.prepareCall(Unknown Source)
at org.apache.derbyTesting.junit.CleanDatabaseTestSetup.clearProperties(Unknown Source)
at org.apache.derbyTesting.junit.CleanDatabaseTestSetup.cleanDatabase(Unknown Source)
at org.apache.derbyTesting.junit.CleanDatabaseTestSetup.setUp(Unknown Source)
at junit.extensions.TestSetup$1.protect(TestSetup.java:18)
at junit.extensions.TestSetup.run(TestSetup.java:23)
Plus, XMLType and Operators suite fails because wombat was compromised, and also error 42X50.
3. There were 2 failures:
1) testNegative(org.apache.derbyTesting.functionTests.tests.lang.GroupByExpressionTest)junit.framework.ComparisonFailure: Unexpected SQL state. expected:&lt;42Y30&gt; but was:&lt;XJ001&gt;
at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(Unknown Source)
at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(Unknown Source)
at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(Unknown Source)
at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertCompileError(Unknown Source)
at org.apache.derbyTesting.functionTests.tests.lang.GroupByExpressionTest.testNegative(Unknown Source)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at org.apache.derbyTesting.junit.BaseTestCase.runBare(Unknown Source)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)
at junit.extensions.TestSetup$1.protect(TestSetup.java:19)
at junit.extensions.TestSetup.run(TestSetup.java:23)
2) testInvalidXMLBindings(org.apache.derbyTesting.functionTests.tests.lang.XMLBindingTest)junit.framework.ComparisonFailure: Unexpected SQL state. expected:&lt;...Z7...&gt; but was:&lt;...X5...&gt;
at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(Unknown Source)
at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(Unknown Source)
at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertCompileError(Unknown Source)
at org.apache.derbyTesting.functionTests.tests.lang.XMLBindingTest.testInvalidXMLBindings(Unknown Source)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at org.apache.derbyTesting.junit.BaseTestCase.runBare(Unknown Source)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)
at junit.extensions.TestSetup$1.protect(TestSetup.java:19)
at junit.extensions.TestSetup.run(TestSetup.java:23)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)
at junit.extensions.TestSetup$1.protect(TestSetup.java:19)
at junit.extensions.TestSetup.run(TestSetup.java:23)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)
at junit.extensions.TestSetup$1.protect(TestSetup.java:19)
at junit.extensions.TestSetup.run(TestSetup.java:23)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)
at junit.extensions.TestSetup$1.protect(TestSetup.java:19)
at junit.extensions.TestSetup.run(TestSetup.java:23)
test lang.UpdatableResultSetTest.testUpdateXXXWithAllDatatypes fails with wctme5.7 (j9) foundation
3) testUpdateXXXWithAllDatatypes(org.apache.derbyTesting.functionTests.tests.lang.UpdatableResultSetTest)java.lang.NoSuchMethodError: java/sql/ResultSet.getBigDecimal(I)Ljava/math/BigDecimal;
at org.apache.derbyTesting.functionTests.tests.lang.UpdatableResultSetTest.verifyData(UpdatableResultSetTest.java:4491)
at org.apache.derbyTesting.functionTests.tests.lang.UpdatableResultSetTest.runTestUpdateXXXWithAllDatatypes(UpdatableResultSetTest.java:2742)
at org.apache.derbyTesting.functionTests.tests.lang.UpdatableResultSetTest.testUpdateXXXWithAllDatatypes(UpdatableResultSetTest.java:2513)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:199)
at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:76)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)
at junit.extensions.TestSetup$1.protect(TestSetup.java:19)
at junit.extensions.TestSetup.run(TestSetup.java:23)
SqlExceptionTest.testChainedException and .testNextException fail with wctme5.7 foundation
We get the following failure in suites.All:
1) testChainedException(org.apache.derbyTesting.functionTests.tests.derbynet.SqlExceptionTest)java.lang.NoSuchMethodError: java/sql/SQLException.getCause()Ljava/lang/Throwable;
at org.apache.derbyTesting.functionTests.tests.derbynet.SqlExceptionTest.testChainedException(SqlExceptionTest.java:58)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:199)
at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:76)
2) testNextException(org.apache.derbyTesting.functionTests.tests.derbynet.SqlExceptionTest)java.lang.NoSuchMethodError: java/sql/SQLException.getCause()Ljava/lang/Throwable;
at org.apache.derbyTesting.functionTests.tests.derbynet.SqlExceptionTest.testNextException(SqlExceptionTest.java:74)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:199)
at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:76)
After a Lexical Error due to syntax error , even a simple create table does not work on the same connection.
connect 'jdbc:derby:wombat;create=true';
create table t1(a int ) ;
create table &quot;t2&quot;(a int ) ;
-- this should fail. 
create table foo (a int , \&quot;YEAR\&quot; int ) ;
-- but this should not fail. But failing
create table t4 ( b int ) ;
FYI:
$ java org.apache.derby.tools.ij
ij version 10.3
ij&gt; run 'weird1.sql';
ij&gt; connect 'jdbc:derby:wombat;create=true';
ij&gt; create table t1(a int ) ;
0 rows inserted/updated/deleted
ij&gt; create table &quot;t2&quot;(a int ) ;
0 rows inserted/updated/deleted
ij&gt; -- this should fail.
create table foo (a int , \&quot;YEAR\&quot; int ) ;
ERROR 42X02: Lexical error at line 2, column 28. Encountered: &quot;\\&quot; (92), after
: &quot;&quot;.
ij&gt; -- but this should not fail. But failing
create table t4 ( b int ) ;
ERROR 42X01: Syntax error: Encountered &quot;&quot; at line 2, column 21.
ij&gt;
Error in initSlotTable() can cause NPE or ASSERT rather than reporting page number in corrupt page message.
Error in initSlotTable() can cause NPE or ASSERT rather than reporting page number in corrupt page message. The problem is
that depending on when the error is encountered we are in the middle of setting up a new page, so you can't use normal 
access routines for identifiying the page (like getIdentity() ) as they may not be set up yet. 
The fix is to change the error messages to use a passed in identity rather than counting on correct setup during initialization failure
SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE documentation or implementation error on its arguments.
There seems to be an error on the SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE documentation or the implementation itself when passing the following arguments:
PURGE_ROWS
If PURGE_ROWS is set to a *non-zero* value, then a single pass is made through the table which will purge committed deleted rows from the table.
&lt;snip&gt;
DEFRAGMENT_ROWS
If DEFRAGMENT_ROWS is set to a *non-zero* value, then a single defragment pass is made which will move existing rows from the end of the table towards the front of the table.
&lt;snip&gt;
TRUNCATE_END
If TRUNCATE_END is set to a *non-zero* value, then all contiguous pages at the end of the table will be returned to the operating system.
&lt;snip&gt;
The implementation only checks if the above arguments are 1s.
org.apache.derby.iapi.db.OnlineCompress.compressTable(
schema, 
tablename, 
(purgeRows == 1),
(defragementRows == 1),
(truncateEnd == 1));
...
10.2 'Derby Developer's Guide' error/ambiguity.
In the 'Derby Developer's Guide' under 'After Installing':
-- The text refers to 'install.html' being installed with Derby.
This does not exist in the UNIX binary distribution.
---Also, what does &quot;the Derby development environment&quot;
mean here? To me this suggests some kind of IDE, but 
probably refers to the full installation. Since, there is no
'install.html' file this remains ambiguous.
Unquoted path in .bat files may cause errors (Win)
The &quot;CALL %~dp0derby_common.bat %*&quot; command in the .bat files in the bin/ directory are unquoted. So, if the path the scripts live in contains a space, running them will either result in CALL failing or producing an undesired effect.
Clob.position fails with Embedded driver and large Clobs
The method Clob.position(String searchstr, long start) fails when used on large lobs if the searchstr is bigger than 256 characters. I have seen two different errors, if the search string it bigger than 256 character it is not found and if the search string is bigger than 512 characters an exception is thrown.
/* Repro */
// Connect
Class.forName(&quot;org.apache.derby.jdbc.EmbeddedDriver&quot;);
Connection conn = DriverManager.getConnection(&quot;jdbc:derby:ReproClob;create=true&quot;, &quot;app&quot;, &quot;app&quot;);
// Create table and populate
Statement stmt = conn.createStatement();
try {
stmt.executeUpdate(&quot;DROP TABLE tmpClob&quot;);
} catch (SQLException se) {}
stmt.executeUpdate(&quot;CREATE TABLE tmpClob (a int, b clob(40K))&quot;);
PreparedStatement ps = conn.prepareStatement(&quot;INSERT INTO tmpClob VALUES (?, ?)&quot;);
String tmp = &quot;abcdefghijklmnopqrstuvxyz&quot;;
StringBuilder sb = new StringBuilder();
for (int i=0; i&lt;1500; i++) {
sb.append(tmp);
}
ps.setInt(1, 1);
ps.setString(2, sb.toString());
ps.executeUpdate();
ps.close();
ResultSet rs = stmt.executeQuery(&quot;SELECT * FROM tmpClob&quot;);
if (rs.next()) {
Clob c = rs.getClob(2);
// Bug #1
String subString1 = c.getSubString(100, 513);
try {
long i1 = c.position(subString1, 90);
System.out.println(&quot;Found searched string at: &quot; + i1);
} catch (SQLException se) {
System.out.println(&quot;FAILURE REPRODUCED: Clob.position(string, int) throws an exception when the length of the search string is bigger than 512&quot;);
se.printStackTrace();
while (se != null) {
System.out.println(&quot;FAIL: &quot; + se.getMessage());
se = se.getNextException();
}
}
// Bug #2
String subString2 = c.getSubString(100, 257);
long i2 = c.position(subString2, 90);
if (i2 == -1) {
System.out.println(&quot;FAILURE REPRODUCED: Clob.position(string, int) does not find the search string if its length is bigger than 256&quot;);
} else {
System.out.println(&quot;Found searched string at: &quot; + i2);
}
}
rs.close();
stmt.close();
conn.rollback();
conn.close();
SELECT statement asserts with XJ001 when attempted to select a newly added column in SQL authorization mode
Following script causes the select statement below to assert in sane build. 
ij&gt; connect 'jdbc:derby:wombat;create=true' user 'user1' as user1;
WARNING 01J14: SQL authorization is being used without first enabling authentication.
ij&gt; create table t1 (c1 int, c2 int);
0 rows inserted/updated/deleted
ij&gt; grant select(c1,c2) on t1 to user2;
0 rows inserted/updated/deleted
ij&gt; connect 'jdbc:derby:wombat;create=true' user 'user2' as user2;
WARNING 01J01: Database 'wombat' not created, connection made to existing database instead.
WARNING 01J14: SQL authorization is being used without first enabling authentication.
ij(USER2)&gt; set connection user1;
ij(USER1)&gt; alter table t1 add c3 int;
0 rows inserted/updated/deleted
ij(USER1)&gt; set connection user2;
ij(USER2)&gt; select c3 from user1.t1;
ERROR XJ001: Java exception: 'ASSERT FAILED Attempt to get a bit position (2)that exceeds the max length (2): org.apache.derby.shared.common.sanity.AssertFailure'.
stack trace:
org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED Attempt to get a bit position (1)that exceeds the max length (1)
at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:149)
at org.apache.derby.iapi.services.io.FormatableBitSet.isSet(FormatableBitSet.java:614)
at org.apache.derby.iapi.services.io.FormatableBitSet.get(FormatableBitSet.java:643)
at org.apache.derby.iapi.sql.dictionary.StatementColumnPermission.check(StatementColumnPermission.java:119)
at org.apache.derby.impl.sql.conn.GenericAuthorizer.authorize(GenericAuthorizer.java:158)
at org.apache.derby.exe.ac601a400fx010dxaa5bx09e8x00000013b9400.fillResultSet(Unknown Source)
at org.apache.derby.exe.ac601a400fx010dxaa5bx09e8x00000013b9400.execute(Unknown Source)
at org.apache.derby.impl.sql.GenericActivationHolder.execute(GenericActivationHolder.java:327)
at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:356)
at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1182)
at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:585)
at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:517)
at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:321)
at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:517)
at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:370)
at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:268)
at org.apache.derby.impl.tools.ij.Main.go(Main.java:204)
at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:170)
at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56)
at org.apache.derby.tools.ij.main(ij.java:71)
sysinfo:
------------------ Java Information ------------------
Java Version: 1.4.2_12
Java Vendor: Sun Microsystems Inc.
Java home: C:\Program Files\Java\j2re1.4.2_12
Java classpath: classes;.
OS name: Windows XP
OS architecture: x86
OS version: 5.1
Java user name: Yip
Java user home: C:\Documents and Settings\Yip
Java user dir: C:\work3\derby\trunk
java.specification.name: Java Platform API Specification
java.specification.version: 1.4
--------- Derby Information --------
JRE - JDBC: J2SE 1.4.2 - JDBC 3.0
[C:\work3\derby\trunk\classes] 10.3.0.0 alpha - (443080)
------------------------------------------------------
----------------- Locale Information -----------------
Current Locale : [English/United States [en_US]]
Found support for locale: [de_DE]
version: 10.3.0.0 alpha - (443080)
Found support for locale: [es]
version: 10.3.0.0 alpha - (443080)
Found support for locale: [fr]
version: 10.3.0.0 alpha - (443080)
Found support for locale: [it]
version: 10.3.0.0 alpha - (443080)
Found support for locale: [ja_JP]
version: 10.3.0.0 alpha - (443080)
Found support for locale: [ko_KR]
version: 10.3.0.0 alpha - (443080)
Found support for locale: [pt_BR]
version: 10.3.0.0 alpha - (443080)
Found support for locale: [zh_CN]
version: 10.3.0.0 alpha - (443080)
Found support for locale: [zh_TW]
version: 10.3.0.0 alpha - (443080)
------------------------------------------------------
remote server testing with 10.2 snapshot showed 8 failures
I ran derbynetclientmats between two IPV6 machines with the 10.2 snapshot and finally got to look at the results...There were 8 failures, 4 of those because of other tests leaving stuff behind.
2 tests complained about junit classes not being found (? one of those was checkDataSource!).
2 tests seemed to have trouble connecting - those might be the more interesting ones.
Will do further analysis, &amp; create test cleanup patches.
The failing tests and some comments:
suite derbynetclientmats with ibm142 &amp; IPV6 machines using -DhostName= (i.e. remote server test) and build: 10.2.0.4 alpha - (419130)
derbynetclientmats/derbynetclientmats.fail:jdbcapi/checkDataSource.java
?? fails because of an error accessing junit. Not sure why, junit is in client classpath...and it's not even a junit test. Stack trace not helpful. (points to client.am, which makes little/no sense).
derbynetclientmats/derbynetmats/derbynetmats.fail:derbynet/testconnection.java
?? no connection
derbynetclientmats/derbynetmats/derbynetmats.fail:derbynet/testij.java
?? no connection
derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/metadata.java
extra tables/views: JIRA1454, Y.
derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/odbc_metadata.java
ditto
derbynetclientmats/derbynetmats/derbynetmats.fail:lang/syscat.sql
ditto
derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/ProcedureTest.junit
junit not available??
derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/checkDataSource30.java
Table/View 'Y' already exists. 
Compling with jikes not longer works due to recent changes that added -target -source command line flags to each compile
Probable solution is to remove the instructions about using jikes in the BUILDING.txt unless anyone objects.
derbyrunjartest hangs with wctme5.7 &amp; always uses j9_13; hangs with _foundation
derbyrunjartest hangs with wctme5.7.
I am not sure what the hook up is but if I do this:
j9 -jcl:max -Xbootclasspath/p:c:/wctme5.7/ive/lib/jclMax/classes.zip;c:/wctme5.7/ive/lib/charconv.zip;c:/wctme5.7/ive/lib/database_enabler.jar -jar c:/derbyt/svn2/trunk/jars/sane/derbyrun.jar ij --help
I get successfully:
Usage: java org.apache.derby.tools.ij [-p propertyfile] [-ca connectionAttribute
PropertyFile] [inputfile]
Also, when looking at the code of this test, it forces the jvm class to be used to be j9_13 whenever the jvm as set in RunTest starts with J9. However, wctme5.7 is j9_22 and this also prevents running with foundation (assuming that's supported).
NULLIF and CASE expressions section in reference manual contains two stale paragraphs.
The two paragraphs below from 10.1 ref manual, page 78 in pdf can be removed.
----------------------------------------------------------------------------------------------------
You do not need to use the CASE expression for avoiding NullPointerExceptions when a
nullable column becomes a method receiver.
If the value of the instance specified in an instance method invocation is null, the result of
the invocation is null (SQL NULL). However, you still might need to use the CASE
expression for when a nullable column is a primitive method parameter.
In ij, executing a prepared statement with numeric/decimal parameter fails with NullPointerException in J2ME/CDC/FP
NPE is thrown in ij when executing prepared statement which 
- has numeric/decimal parameters
- does not return any result set
Repro for this problem is the test lang/cast.sql. This test currently fails in CDC/FP.
The following lines in the test throw NPE:
execute q10 using 'values 123456.78';
execute q11 using 'values 123456.78';
where q10 is &quot;prepare q10 as 'insert into t1 (num) values cast(? as numeric(18))';&quot;
and q11 is &quot;prepare q11 as 'insert into t1 (dc) values cast(? as decimal(18))';&quot;
The stack trace for failure is:
java.lang.NullPointerException
at org.apache.derby.impl.tools.ij.util.DisplayMulti(util.java:666)
at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:398)
at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:290)
at org.apache.derby.impl.tools.ij.Main.go(Main.java:203)
at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169)
at org.apache.derby.impl.tools.ij.Main.main(Main.java:75)
at org.apache.derby.tools.ij.main(ij.java:56)
This happens in the following code. Since the above prepared statements do not return result sets, call to getMetaData() will return null. But in the code, no check is done to see if getMetaData() returns null before calling getColumnType.
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// In J2ME there is no object that represents
// a DECIMAL value. By default use String to
// pass values around, but for integral types
// first convert to a integral type from the DECIMAL
// because strings like 3.4 are not convertible to
// an integral type.
switch (ps.getMetaData().getColumnType(c))
{
case Types.BIGINT:
ps.setLong(c, rs.getLong(c));
break;
case Types.INTEGER:
case Types.SMALLINT:
case Types.TINYINT:
ps.setInt(c, rs.getInt(c));
break;
default:
ps.setString(c,rs.getString(c));
break;
} 
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE fails on (very) large tables
SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE fails with one of the following error messages when applied to a very large table (&gt;2GB):
Log operation null encounters error writing itself out to the log stream, this could be caused by an errant log operation or internal log buffer full due to excessively large log operation. SQLSTATE: XJ001: Java exception: ': java.io.IOException'.
or
The exception 'java.lang.ArrayIndexOutOfBoundsException' was thrown while evaluating an expression. SQLSTATE: XJ001: Java exception: ': java.lang.ArrayIndexOutOfBoundsException'.
In either case, no entry is written to the console log or to derby.log.
SELECT DISTINCT returns duplicates when selecting from subselects
When one performs a select distinct on a table generated by a subselect, there sometimes are duplicates in the result. The following example shows the problem:
ij&gt; CREATE TABLE names (id INT PRIMARY KEY, name VARCHAR(10));
0 rows inserted/updated/deleted
ij&gt; INSERT INTO names (id, name) VALUES
(1, 'Anna'), (2, 'Ben'), (3, 'Carl'),
(4, 'Carl'), (5, 'Ben'), (6, 'Anna');
6 rows inserted/updated/deleted
ij&gt; SELECT DISTINCT(name) FROM (SELECT name, id FROM names) AS n;
NAME 
----------
Anna 
Ben 
Carl 
Carl 
Ben 
Anna 
Six names are returned, although only three names should have been returned.
When the result is explicitly sorted (using ORDER BY) or the id column is removed from the subselect, the query returns three names as expected:
ij&gt; SELECT DISTINCT(name) FROM (SELECT name, id FROM names) AS n ORDER BY name;
NAME 
----------
Anna 
Ben 
Carl 
3 rows selected
ij&gt; SELECT DISTINCT(name) FROM (SELECT name FROM names) AS n;
NAME 
----------
Anna 
Ben 
Carl 
3 rows selected
Documentation of DateTime types is incomplete
The documentation for datatypes DATE, TIME, and TIMESTAMP is incomplete. The documentation says that DATE, TIME, and TIMESTAMP accept any values accepted by the java.sql.Date, java.sql.Time, and java.sql.Timestamp classes respectively. Derby accepts a number of string formats:
DATE:
yyyy-mm-dd
mm/dd/yyyy
dd.mm.yyyy
TIME:
hh:mm[:ss]
hh.mm[.ss]
hh[:mm] {AM | PM}
TIMESTAMP:
yyyy-mm-dd-hh[.mm[.ss[.nnnnnn]]]
yyyy-mm-dd hh[:mm[:ss[.nnnnnn]]]
The year must always have 4 digits. Months, days, and hours may have one or two digits. Minutes and seconds, if present, must have two digits. Nanoseconds, if present may have 1 to 6 digits.
Derby also accepts strings in the locale specific datetime format, using the locale of the database server. If there is an ambiguity the built in formats above take precedence.
Trying to change a column makes ddlutils want to drop non-related foreign keys which fails with for example &quot;Can't DROP 'text_docs_FK_meta_id_meta'; check that column/key exists&quot;
I'm trying variations on the following code:
org.apache.ddlutils.model.Database model = platform.readModelFromDatabase(null);
Table table = model.findTable(&quot;text_docs&quot;);
Column templateNameColumn = table.findColumn(&quot;template_id&quot;);
templateNameColumn.setType(&quot;VARCHAR&quot;);
platform.alterTables(model,false);
Trying to change any column makes ddlutil try to drop unrelated foreign keys, which in my case fails with the following stack-trace:
org.apache.ddlutils.DatabaseOperationException: Error while executing SQL ALTER TABLE text_docs
DROP INDEX text_docs_FK_meta_id_meta
at org.apache.ddlutils.platform.PlatformImplBase.evaluateBatch(PlatformImplBase.java:331)
at org.apache.ddlutils.platform.PlatformImplBase.alterTables(PlatformImplBase.java:573)
at org.apache.ddlutils.platform.PlatformImplBase.alterTables(PlatformImplBase.java:507)
... snipped my classes ...
Caused by: java.sql.SQLException: Can't DROP 'text_docs_FK_meta_id_meta'; check that column/key exists
at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:2847)
at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1531)
at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1622)
at com.mysql.jdbc.Connection.execSQL(Connection.java:2370)
at com.mysql.jdbc.Connection.execSQL(Connection.java:2297)
at com.mysql.jdbc.Statement.executeUpdate(Statement.java:1289)
at org.apache.commons.dbcp.DelegatingStatement.executeUpdate(DelegatingStatement.java:225)
at org.apache.commons.dbcp.DelegatingStatement.executeUpdate(DelegatingStatement.java:225)
at org.apache.ddlutils.platform.PlatformImplBase.evaluateBatch(PlatformImplBase.java:309)
... 33 more
The ddl for the table looks like this:
&lt;table name=&quot;text_docs&quot;&gt;
&lt;column name=&quot;meta_id&quot; primaryKey=&quot;true&quot; required=&quot;true&quot; type=&quot;INTEGER&quot; /&gt;
&lt;column name=&quot;template_id&quot; required=&quot;true&quot; type=&quot;INTEGER&quot; /&gt;
&lt;column default=&quot;1&quot; name=&quot;group_id&quot; required=&quot;true&quot; type=&quot;INTEGER&quot; /&gt;
&lt;column default=&quot;-1&quot; name=&quot;default_template_1&quot; required=&quot;true&quot; type=&quot;INTEGER&quot; /&gt;
&lt;column default=&quot;-1&quot; name=&quot;default_template_2&quot; required=&quot;true&quot; type=&quot;INTEGER&quot; /&gt;
&lt;column name=&quot;default_template&quot; type=&quot;INTEGER&quot; required=&quot;false&quot; /&gt;
&lt;foreign-key foreignTable=&quot;meta&quot;&gt;
&lt;reference foreign=&quot;meta_id&quot; local=&quot;meta_id&quot; /&gt;
&lt;/foreign-key&gt;
&lt;foreign-key foreignTable=&quot;templates&quot;&gt;
&lt;reference foreign=&quot;template_id&quot; local=&quot;template_id&quot; /&gt;
&lt;/foreign-key&gt;
&lt;foreign-key foreignTable=&quot;templates&quot;&gt;
&lt;reference foreign=&quot;template_id&quot; local=&quot;default_template&quot; /&gt;
&lt;/foreign-key&gt;
&lt;/table&gt;
I'm not sure if ddlutils should be dropping the foreign keys, but it should at least not fail with an error. Could this be because i'm using InnoDB tables?
I've tried both some MySQL 5.0.20 version, and the latest 5.0.32.
Add serialVersionUID to BasicRowProcessor.CaseInsensitiveHashMap
Please add serialVersioUID to org.apache.commons.dbutils.BasicRowProcessor.CaseInsensitiveHashMap. Without serialVersioUID, when a Map returned by QueryRunneris send across the wire to another jvm (different version), incompatible serial id exception will result. For instance, IBM JVM 1.4.1 has a different way of calculating serialVersionUID for Serializable class that does not have serialVersionUID defined than JVM 5.0.
Daytrader ear includes lots of kitchen sinks
Currently the ear includes about 10-15 dependent jars it shouldn't. The m2 dependency scopes need to be adjusted to fix this.
I'll fix this in trunk (2.0), also an issue in 1.2 branch
HTTP binding expects '/' on each side of the brackets
Stack trace:
[java] INFO: Interceptor has thrown exception, unwinding now
[java] java.lang.IllegalStateException: Unexpected character '/' at index 0
[java] at org.apache.cxf.binding.http.IriDecoderHelper.expect(IriDecoderHelper.java:121)
[java] at org.apache.cxf.binding.http.IriDecoderHelper.decodeIri(IriDecoderHelper.java:72)
[java] at org.apache.cxf.binding.http.interceptor.URIParameterInInterceptor.handleMessage(URIParameterInInterceptor.java:92)
[java] at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:159)
[java] at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:64)
[java] at org.apache.cxf.transport.http.JettyHTTPDestination.serviceRequest(JettyHTTPDestination.java:296)
[java] at org.apache.cxf.transport.http.JettyHTTPDestination.doService(JettyHTTPDestination.java:268)
[java] at org.apache.cxf.transport.http.JettyHTTPDestination$2.handle(JettyHTTPDestination.java:126)
CXFBus does not work. SoapTransportFactory and HttpTransport are not registered in Destination and ConduitInitiator Manager.
If set system property to use the CXFBusFactory , will ran into Condiut and Destinition can not be found exception . This issue is in both server and client side. 
RPC can't handle holder correctly
The rpc can't handle holder.
The parameter sequence for marshal &amp; unmarshal do not consider the Holder cases.
wsdl2java using wrong type (should use wrapper type, but use primitive type) for holder parameter when generating SEI class
wsdl2java using wrong type (should use wrapper type, but use primitive type) for holder parameter when generating SEI class
e.g.
wrong:
public void test(javax.xml.ws.Holder&lt;int&gt; outRefInOutInt);
correct:
public void test(javax.xml.ws.Holder&lt;Integer&gt; outRefInOutInt);
Printing Extension Elements in the wsdl doesn't have the proper indentation level.
The PrettyPrintXMLStreamWriter doesn't output the proper indentation for the wsdl defintion extension elements.
exception with docment literal bare style opeartion with empty input
I'm testing cxf with the attached hello_world.wsdl and am seeing a strange exception (see below). Any ideas on what might be happening?
1. Generated code using: wsdl2java.bat -client -server -impl -all -ant hello_world.wsdl
2. Ran ant to build 
3. Ran ant Greeter.Server
4. Ran ant Greeter.Client
Buildfile: build.xml
compile:
Greeter.Client:
[java] Invoking sayHi...
[java] Exception in thread &quot;main&quot; org.apache.cxf.binding.soap.SoapFault: Error reading XMLStreamReader.
[java] at org.apache.cxf.binding.soap.interceptor.ReadHeadersInterceptor.handleMessage(ReadHeadersInterceptor.java:114)
[java] at org.apache.cxf.binding.soap.interceptor.ReadHeadersInterceptor.handleMessage(ReadHeadersInterceptor.java:45)
[java] at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:147)
[java] at org.apache.cxf.endpoint.ClientImpl.onMessage(ClientImpl.java:253)
[java] at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponse(HTTPConduit.java:489)
[java] at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.doClose(HTTPConduit.java:451)
[java] at org.apache.cxf.io.AbstractCachedOutputStream.close(AbstractCachedOutputStream.java:113)
[java] at org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:259)
[java] at org.apache.cxf.interceptor.MessageSenderInterceptor.handleMessage(MessageSenderInterceptor.java:58)
[java] at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:147)
[java] at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:130)
[java] at org.apache.cxf.jaxws.EndpointInvocationHandler.invokeSync(EndpointInvocationHandler.java:129)
[java] at org.apache.cxf.jaxws.EndpointInvocationHandler.invoke(EndpointInvocationHandler.java:115)
[java] at $Proxy35.sayHi(Unknown Source)
[java] at com.iona.hello_world_soap_http.GreeterClient.main(GreeterClient.java:69)
[java] Caused by: com.ctc.wstx.exc.WstxEOFException: Unexpected EOF in prolog
[java] at [row,col {unknown-source}]: [1,0]
[java] at com.ctc.wstx.sr.StreamScanner.throwUnexpectedEOF(StreamScanner.java:628)
[java] at com.ctc.wstx.sr.BasicStreamReader.handleEOF(BasicStreamReader.java:2021)
[java] at com.ctc.wstx.sr.BasicStreamReader.nextFromProlog(BasicStreamReader.java:1927)
[java] at com.ctc.wstx.sr.BasicStreamReader.next(BasicStreamReader.java:1054)
[java] at com.ctc.wstx.sr.BasicStreamReader.nextTag(BasicStreamReader.java:1080)
[java] at org.apache.cxf.binding.soap.interceptor.ReadHeadersInterceptor.handleMessage(ReadHeadersInterceptor.java:73)
[java] ... 14 more
JAX-WS Handler on client side not working
After the JAX-WS portable artifacts on client side are generated with the WSDLtoJava tool, if JAX-WS handlers are set on the generated service class, the handlers are not invoked by the CXF client runtime. 
The handlers are set using the Service API (service.setHandlerResolver())
The same works fine if i set the handler like: 
((BindingProvider)port).getBinding().getHandlerChain().add(new MySOAPHandler());
whereas the following does not work: 
service.setHandlerResolver(new MyHandlerResolver()); //where MyHandlerResolver would add MySOAPHandler to the chain. 
port=service.getXXXPort();
port.sayXXX();
Also if the handlers are set with the @HandlerChain annotation of the generated service class at client side, they are not picked up. 
Improper synchronization of getDefaultBus(), setDefaultBus()
getDefaultBus() method in org.apache.cxf.bus.spring.SpringBusFactory and org.apache.cxf.bus.cxf.CXFBusFactory is improperly synchronized. The method is instance-level synchronized while it initializes and accesses a class-level variable. Two different instances of BusFactory each calling getDefaultBus() at the same time could return two different Bus instances...
This method should either be changed to 'public static synchronized Bus getDefaultBus()' or modified as for an example:
public Bus getDefaultBus() {
return initDefaultBus();
}
private static synchronized Bus initDefaultBus() {
if (null == defaultBus) {
defaultBus = new CXFBusImpl();
}
return defaultBus;
}
Also, the setDefaultBus() method in both classes needs to be properly synchronized. 
JAX-WS Java first client side failure to get port
I created a client to connect to a service developed without a WSDL file. The SEI is:
package org.eric.demo;
import javax.jws.*;
@WebService(name=&quot;quoteReporter&quot;)
public interface quoteReporter
{
public Quote getQuote(String ticker);
}
The client code is:
package org.eric.demo;
import java.io.File;
import java.net.URL;
import javax.xml.namespace.QName;
import javax.xml.ws.Service;
public class Client
{
public static void main(String args[])
{
QName serviceName = new QName(&quot;http://demo.eric.org&quot;, &quot;stockQuoteReporter&quot;);
Service s = Service.create(serviceName);
System.out.println(&quot;Service &quot;+serviceName+&quot; created...&quot;);
QName portName = new QName(&quot;http://demo.eric.org&quot;, &quot;stockQuoteReporterPort&quot;);
quoteReporter proxy = s.getPort(portName, quoteReporter.class);
System.out.println(&quot;Proxy created...&quot;);
Quote quote = proxy.getQuote(&quot;ALPHA&quot;);
System.out.println(&quot;Stock &quot;+quote.getID()+&quot; is worth &quot;+quote.getVal()+&quot; as of &quot;+quote.getTime());
}
}
The WSDL retrieved from the running service is:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;wsdl:definitions name=&quot;stockQuoteReporter&quot; targetNamespace=&quot;http://demo.eric.org&quot; xmlns:wsdlsoap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot; xmlns:ns1=&quot;http://demo.eric.org&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/&quot; xmlns:wsdl=&quot;http://schemas.xmlsoap.org/wsdl/&quot;&gt;
&lt;wsdl:types&gt;
&lt;xs:schema xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; version=&quot;1.0&quot;&gt;
&lt;xs:complexType name=&quot;quote&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element minOccurs=&quot;0&quot; name=&quot;ID&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element minOccurs=&quot;0&quot; name=&quot;time&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element name=&quot;val&quot; type=&quot;xs:float&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
&lt;xsd:schema xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns=&quot;http://demo.eric.org&quot; attributeFormDefault=&quot;unqualified&quot; elementFormDefault=&quot;qualified&quot; targetNamespace=&quot;http://demo.eric.org&quot;&gt;
&lt;xsd:element name=&quot;getQuote&quot;&gt;
&lt;xsd:complexType&gt;
&lt;xsd:sequence&gt;
&lt;xsd:element name=&quot;arg00&quot; type=&quot;xsd:string&quot;/&gt;
&lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;
&lt;/xsd:element&gt;
&lt;xsd:element name=&quot;getQuoteResponse&quot;&gt;
&lt;xsd:complexType&gt;
&lt;xsd:sequence&gt;
&lt;xsd:element name=&quot;return&quot; type=&quot;quote&quot;/&gt;
&lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;
&lt;/xsd:element&gt;
&lt;/xsd:schema&gt;
&lt;/wsdl:types&gt;
&lt;wsdl:message name=&quot;getQuote&quot;&gt;
&lt;wsdl:part name=&quot;getQuote&quot; element=&quot;ns1:getQuote&quot;&gt;
&lt;/wsdl:part&gt;
&lt;/wsdl:message&gt;
&lt;wsdl:message name=&quot;getQuoteResponse&quot;&gt;
&lt;wsdl:part name=&quot;getQuoteResponse&quot; element=&quot;ns1:getQuoteResponse&quot;&gt;
&lt;/wsdl:part&gt;
&lt;/wsdl:message&gt;
&lt;wsdl:portType name=&quot;stockQuoteReporterPortType&quot;&gt;
&lt;wsdl:operation name=&quot;getQuote&quot;&gt;
&lt;wsdl:input name=&quot;getQuote&quot; message=&quot;ns1:getQuote&quot;&gt;
&lt;/wsdl:input&gt;
&lt;wsdl:output name=&quot;getQuoteResponse&quot; message=&quot;ns1:getQuoteResponse&quot;&gt;
&lt;/wsdl:output&gt;
&lt;/wsdl:operation&gt;
&lt;/wsdl:portType&gt;
&lt;wsdl:binding name=&quot;stockQuoteReporterSoapBinding&quot; type=&quot;ns1:stockQuoteReporterPortType&quot;&gt;
&lt;wsdlsoap:binding style=&quot;document&quot; transport=&quot;http://schemas.xmlsoap.org/soap/http&quot;/&gt;
&lt;wsdl:operation name=&quot;getQuote&quot;&gt;
&lt;wsdlsoap:operation soapAction=&quot;&quot; style=&quot;document&quot;/&gt;
&lt;wsdl:input name=&quot;getQuote&quot;&gt;
&lt;wsdlsoap:body use=&quot;literal&quot;/&gt;
&lt;/wsdl:input&gt;
&lt;wsdl:output name=&quot;getQuoteResponse&quot;&gt;
&lt;wsdlsoap:body use=&quot;literal&quot;/&gt;
&lt;/wsdl:output&gt;
&lt;/wsdl:operation&gt;
&lt;/wsdl:binding&gt;
&lt;wsdl:service name=&quot;stockQuoteReporter&quot;&gt;
&lt;wsdl:port name=&quot;stockQuoteReporterPort&quot; binding=&quot;ns1:stockQuoteReporterSoapBinding&quot;&gt;
&lt;wsdlsoap:address location=&quot;http://localhost:9000/EricStockQuote&quot;/&gt;
&lt;/wsdl:port&gt;
&lt;/wsdl:service&gt;
&lt;/wsdl:definitions&gt;
When I run the client I get the following stack:
[java] Service {http://demo.eric.org}stockQuoteReporter created...
[java] Exception in thread &quot;main&quot; java.lang.NullPointerException: EndpointInfo can not be null!
[java] at org.apache.cxf.endpoint.EndpointImpl.&lt;init&gt;(EndpointImpl.java:66)
[java] at org.apache.cxf.jaxws.support.JaxWsEndpointImpl.&lt;init&gt;(JaxWsEndpointImpl.java:56)
[java] at org.apache.cxf.jaxws.ServiceImpl.createPort(ServiceImpl.java:272)
[java] at org.apache.cxf.jaxws.ServiceImpl.getPort(ServiceImpl.java:200)
[java] at javax.xml.ws.Service.getPort(Service.java:94)
[java] at org.eric.demo.Client.main(Client.java:16)
Full thread dump Java HotSpot(TM) Client VM (1.5.0_06-b05 mixed mode):
&quot;Thread-4&quot; daemon prio=6 tid=0x0b386108 nid=0xd64 runnable [0x0baef000..0x0baefb68]
at java.io.FileInputStream.readBytes(Native Method)
at java.io.FileInputStream.read(FileInputStream.java:194)
at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
at java.io.BufferedInputStream.read1(BufferedInputStream.java:256)
at java.io.BufferedInputStream.read(BufferedInputStream.java:313)
- locked &lt;0x02f218a0&gt; (a java.io.BufferedInputStream)
at java.io.FilterInputStream.read(FilterInputStream.java:111)
at java.io.FilterInputStream.read(FilterInputStream.java:90)
at org.apache.tools.ant.taskdefs.StreamPumper.run(StreamPumper.java:90)
at java.lang.Thread.run(Thread.java:595)
&quot;Thread-3&quot; daemon prio=6 tid=0x0b337d38 nid=0xfa4 runnable [0x0baaf000..0x0baafbe8]
at java.io.FileInputStream.readBytes(Native Method)
at java.io.FileInputStream.read(FileInputStream.java:177)
at org.apache.tools.ant.taskdefs.StreamPumper.run(StreamPumper.java:90)
at java.lang.Thread.run(Thread.java:595)
&quot;Thread-2&quot; daemon prio=6 tid=0x0b2d5990 nid=0x94c runnable [0x0ba6f000..0x0ba6fc68]
at java.io.FileInputStream.readBytes(Native Method)
at java.io.FileInputStream.read(FileInputStream.java:194)
at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
at java.io.BufferedInputStream.read1(BufferedInputStream.java:256)
at java.io.BufferedInputStream.read(BufferedInputStream.java:313)
- locked &lt;0x02a58868&gt; (a java.io.BufferedInputStream)
at java.io.FilterInputStream.read(FilterInputStream.java:90)
at org.apache.tools.ant.taskdefs.StreamPumper.run(StreamPumper.java:90)
at java.lang.Thread.run(Thread.java:595)
&quot;Low Memory Detector&quot; daemon prio=6 tid=0x0097acb0 nid=0x86c runnable [0x00000000..0x00000000]
&quot;CompilerThread0&quot; daemon prio=10 tid=0x00979880 nid=0xf28 waiting on condition [0x00000000..0x0abaf8cc]
&quot;Signal Dispatcher&quot; daemon prio=10 tid=0x00978c00 nid=0x680 waiting on condition [0x00000000..0x00000000]
&quot;Finalizer&quot; daemon prio=8 tid=0x0096fc70 nid=0x630 in Object.wait() [0x0ab2f000..0x0ab2fc68]
at java.lang.Object.wait(Native Method)
- waiting on &lt;0x02f1ef70&gt; (a java.lang.ref.ReferenceQueue$Lock)
at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:116)
- locked &lt;0x02f1ef70&gt; (a java.lang.ref.ReferenceQueue$Lock)
at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:132)
at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)
&quot;Reference Handler&quot; daemon prio=10 tid=0x0096e7d8 nid=0x13c in Object.wait() [0x0aaef000..0x0aaefce8]
at java.lang.Object.wait(Native Method)
- waiting on &lt;0x02f1eff0&gt; (a java.lang.ref.Reference$Lock)
at java.lang.Object.wait(Object.java:474)
at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)
- locked &lt;0x02f1eff0&gt; (a java.lang.ref.Reference$Lock)
&quot;main&quot; prio=6 tid=0x00036d48 nid=0x714 runnable [0x0007f000..0x0007fc40]
at java.lang.ProcessImpl.waitFor(Native Method)
at org.apache.tools.ant.taskdefs.Execute.waitFor(Execute.java:539)
at org.apache.tools.ant.taskdefs.Execute.execute(Execute.java:471)
at org.apache.tools.ant.taskdefs.Java.fork(Java.java:751)
at org.apache.tools.ant.taskdefs.Java.executeJava(Java.java:171)
at org.apache.tools.ant.taskdefs.Java.execute(Java.java:84)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)
at org.apache.tools.ant.Task.perform(Task.java:364)
at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:64)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)
at org.apache.tools.ant.Task.perform(Task.java:364)
at org.apache.tools.ant.taskdefs.MacroInstance.execute(MacroInstance.java:378)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)
at org.apache.tools.ant.Task.perform(Task.java:364)
at org.apache.tools.ant.Target.execute(Target.java:341)
at org.apache.tools.ant.Target.performTasks(Target.java:369)
at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1216)
at org.apache.tools.ant.Project.executeTarget(Project.java:1185)
at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:40)
at org.apache.tools.ant.Project.executeTargets(Project.java:1068)
at org.apache.tools.ant.Main.runBuild(Main.java:668)
at org.apache.tools.ant.Main.startAnt(Main.java:187)
at org.apache.tools.ant.launch.Launcher.run(Launcher.java:246)
at org.apache.tools.ant.launch.Launcher.main(Launcher.java:67)
&quot;VM Thread&quot; prio=10 tid=0x008b4cf8 nid=0xea0 runnable
&quot;VM Periodic Task Thread&quot; prio=10 tid=0x0097be90 nid=0x688 waiting on condition
Defining a XML Binding with a rootNode results in Fault Response at the Client end.
I have defined a XML Binding with the attached wsdl The wsdl is along the lines of soapheader.wsdl in testutils.
While invoking on the inoutHeader Operation. The Client fails with the following exception 
org.apache.cxf.interceptor.Fault: Could not read request. Operation {http://apache.org/headers}inoutHeaderNode is unknown.
at org.apache.cxf.binding.xml.interceptor.XMLMessageInInterceptor.handleMessage(XMLMessageInInterceptor.java:134)
at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:147)
at org.apache.cxf.endpoint.ClientImpl.onMessage(ClientImpl.java:253)
at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponse(HTTPConduit.java:489)
at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.doClose(HTTPConduit.java:451)
at org.apache.cxf.io.AbstractCachedOutputStream.close(AbstractCachedOutputStream.java:113)
at org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:259)
at org.apache.cxf.interceptor.MessageSenderInterceptor.handleMessage(MessageSenderInterceptor.java:58)
at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:147)
at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:130)
at org.apache.cxf.jaxws.EndpointInvocationHandler.invokeSync(EndpointInvocationHandler.java:129)
at org.apache.cxf.jaxws.EndpointInvocationHandler.invoke(EndpointInvocationHandler.java:115)
at $Proxy37.inoutHeader(Unknown Source)
The reason being it does not process the xmlformat:rootNode element defined in the binding.
The XMLMessageInInterceptor needs to be fixed.
The xml message for which the client fails is as follows.
&lt;tns:inoutHeaderNode xmlns:tns=&quot;http://apache.org/headers&quot;&gt;
&lt;ns2:inoutHeaderResponse xmlns=&quot;http://www.w3.org/2005/08/addressing/wsdl&quot; xmlns:ns2=&quot;http://apache.org/headers/types&quot;&gt;
&lt;ns2:responseType xmlns:ns2=&quot;http://apache.org/headers/types&quot;&gt;inout request type out&lt;/ns2:responseType&gt;
&lt;/ns2:inoutHeaderResponse&gt;
&lt;ns2:SOAPHeaderInfo xmlns=&quot;http://www.w3.org/2005/08/addressing/wsdl&quot; xmlns:ns2=&quot;http://apache.org/headers/types&quot;&gt;
&lt;ns2:originator xmlns:ns2=&quot;http://apache.org/headers/types&quot;&gt;inout orginator out&lt;/ns2:originator&gt;
&lt;ns2:message xmlns:ns2=&quot;http://apache.org/headers/types&quot;&gt;inout message out&lt;/ns2:message&gt;
&lt;/ns2:SOAPHeaderInfo&gt;
&lt;/tns:inoutHeaderNode&gt;
CXFServlet does not pass the wsdl packaged in war to the EndpointImpl
we do not set the wsdl url for the ServiceFactoryBean in
CXFServlet . ServiceFactoryBean still get the wsdl location from the
annotaion by invoking JaxWsConfiguration . When we deployed the war to
another machine , the service will fail to start because it can not find
the wsdl .
Acknowledgment Ranges not merged
&lt;wsrm:SequenceAcknowledgement xmlns:wsrm=&quot;http://schemas.xmlsoap.org/ws/2005/02/rm&quot;&gt;&lt;wsrm:Identifier xmlns:wsrm=&quot;http://schemas.xmlsoap.org/ws/2005/02/rm&quot;&gt;urn:uuid:498b6dee-e3f5-
4cae-9336-363b02357888&lt;/wsrm:Identifier&gt;&lt;wsrm:AcknowledgementRange Lower=&quot;1&quot; Upper=&quot;2&quot; xmlns:wsrm=&quot;http://schemas.xmlsoap.org/ws/2005/02/rm&quot; /&gt;&lt;wsrm:AcknowledgementRange Lower=&quot;3&quot; Upper=&quot;4&quot; xmlns:wsrm=&quot;http://schemas.xmlsoap.org/ws/2005/02/rm&quot; /&gt;&lt;/wsrm:SequenceAcknowledgement&gt;
should use &lt;wsrm:AcknowledgementRange Lower=&quot;1&quot; Upper=&quot;4&quot;/&gt;
Sequence creation is not thread safe
Allow only one CreateSequence request per endpoint at a time - otherwise run into problems as can easily be seen when kicking off multiple asynchronous application requests from the same client - all will attempt to create a sequence.
Workaround: Make sure first application request occurs in isolation (later requests may be concurrent ).
Problem with checkstyle organisation of imports
The checkstyle.xml should read:
&lt;module name=&quot;ImportOrder&quot;&gt;
&lt;property name=&quot;groups&quot; value=&quot;java,javax,org.w3c,org.xml,junit,com,org&quot;/&gt;
&lt;property name=&quot;ordered&quot; value=&quot;true&quot;/&gt;
&lt;/module&gt;
in order to match
\etc\eclipse\CXF.importorder
DatatypeProvider not set
When you instantiate a class that is mapped from an element which has a base64Binary attribute with a default value, and subsequently call the getter for this attribute, the invocation will fail with a NPE unless somwhere in the code a DatatypeConverter was set via DatatypeConverter.setDatatypeConverter(javax.xml.bind.DatatypeConverterInterface converter):
e.g. generated code:
public class Foo {
...
public byte[] getBase64BinaryAttr() {
if (base64BinaryAttr == null) {
return DatatypeConverter.parseBase64Binary(&quot;wxyz&quot;);
} else {
return base64BinaryAttr;
}
}
}
application code:
Foo foo = new ObjectFactory().createFoo();
DatatypeConverter.setDatatypeConverter(new DatatypeConverterImpl());
byte[] value = foo.getBase64BinaryAttr()
We should take care that somewhere in the runtime a DatatypeConverter is set, possibly through loading (but not necessarily registering) an extension in the rt-databinding-jaxb module? From the javadoc:
&quot; JAXB Providers are required to call this method at some point before allowing any of the JAXB client marshal or unmarshal operations to occur&quot;.
We cannot take the DatatypeConverterImpl provided by sun (in the com.sun.xml.bind jaxb-impl.jar) as this has a protected constructor, but could use the one from jaxme project http://ws.apache.org/jaxme/
project.xml file references deprecated xml-apis-2.0.2
See 
http://www.ibiblio.org/maven/xml-apis/jars/
In project.xml:
&lt;dependency&gt;
&lt;groupId&gt;xml-apis&lt;/groupId&gt;
&lt;artifactId&gt;xml-apis&lt;/artifactId&gt;
&lt;version&gt;2.0.2&lt;/version&gt;
&lt;url&gt;http://xml.apache.org/commons/&lt;/url&gt;
&lt;properties&gt;
&lt;scope&gt;provided&lt;/scope&gt;
&lt;war.bundle&gt;true&lt;/war.bundle&gt;
&lt;/properties&gt;
&lt;/dependency&gt;
I found this was used in both 1.3 release and svn trunk 
Last Changed Rev: 498155
Last Changed Date: 2007-01-20 21:23:52 +0200 (Sat, 20 Jan 2007)
build.xml file fetches the wrong version of commons-lang
The build.xml fetches commons-lang-2.1.jar instead of commons-lang-2.2.jar. Seems to be related to the change
2006-12-23 17:36 oheger
* [r489906] project.properties, project.xml: Updated dependency to
lang 2.2, minor site improvements
Fix is trivial.
DatabaseConfiguration and JNDIConfiguration are eating exceptions
DatabaseConfiguration and JNDIConfiguration and possibly others, really need to throw some sort of runtime exception to let the caller know the properties couldn't be read.
Always exception thrown in init() method of StoreJanitorImpl
The if statement at line 222 (see the following) in the init() method of StoreJanitorImpl is very weird. 
if (!this.freeingAlgorithm.equals(ALG_ROUND_ROBIN) || !this.freeingAlgorithm.equals(ALG_ALL_STORES)) 
It always return true and hence exception is thrown. The correct statement should be 
if (!this.freeingAlgorithm.equals(ALG_ROUND_ROBIN) &amp;&amp; !this.freeingAlgorithm.equals(ALG_ALL_STORES)) .
Rice
Can't run block cocoon-session-fw-impl
Caused by: java.io.FileNotFoundException: class path resource [org/apache/cocoon/webapps/session/session.roles] cannot be resolved to URL because it does not exist
at org.springframework.core.io.ClassPathResource.getURL(ClassPathResource.java:155)
at org.apache.cocoon.spring.configurator.ResourceUtils.getUri(ResourceUtils.java:55)
at org.apache.cocoon.core.container.spring.avalon.ConfigurationReader.loadURI(ConfigurationReader.java:497)
at org.apache.cocoon.core.container.spring.avalon.ConfigurationReader.handleInclude(ConfigurationReader.java:458)
... 65 more
MIssed renaming of log4j.xconf to log4j.xml
MIssed renaming of log4j.xconf to log4j.xml
MIssing backslash in log4j.xml
Can't parse chunk: {org.apache.cocoon.work.directory}/cocoon-logs/log4j.log&quot; /&gt;
&lt;param name=&quot;Append&quot; value=&quot;false&quot; /&gt;
&lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;
&lt;param name=&quot;ConversionPattern&quot; value=&quot;%t %-5p %c{2} - %m%n&quot;/&gt;
&lt;/layout&gt;
&lt;/appender&gt;
line 1:35: unexpected char: '/'
at org.antlr.stringtemplate.language.ActionLexer.nextToken(ActionLexer.java:217)
at antlr.TokenBuffer.fill(TokenBuffer.java:69)
at antlr.TokenBuffer.LA(TokenBuffer.java:80)
at antlr.LLkParser.LA(LLkParser.java:52)
at org.antlr.stringtemplate.language.ActionParser.templatesExpr(ActionParser.java:182)
at org.antlr.stringtemplate.language.ActionParser.action(ActionParser.java:117)
at org.antlr.stringtemplate.StringTemplate.parseAction(StringTemplate.java:845)
at org.antlr.stringtemplate.language.TemplateParser.action(TemplateParser.java:151)
at org.antlr.stringtemplate.language.TemplateParser.template(TemplateParser.java:119)
at org.antlr.stringtemplate.StringTemplate.breakTemplateIntoChunks(StringTemplate.java:821)
at org.antlr.stringtemplate.StringTemplate.setTemplate(StringTemplate.java:428)
at org.antlr.stringtemplate.StringTemplate.&lt;init&gt;(StringTemplate.java:333)
at org.antlr.stringtemplate.StringTemplate.&lt;init&gt;(StringTemplate.java:318)
at org.apache.cocoon.maven.deployer.monolithic.MonolithicCocoonDeployer.writeStringTemplateToFile(MonolithicCocoonDeployer.java:237)
at org.apache.cocoon.maven.deployer.monolithic.MonolithicCocoonDeployer.deploy(MonolithicCocoonDeployer.java:114)
at org.apache.cocoon.maven.deployer.AbstractDeployMojo.blockDeploymentMonolithicCocoon(AbstractDeployMojo.java:255)
at org.apache.cocoon.maven.deployer.DeployExplodedMojo.execute(DeployExplodedMojo.java:66)
at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPluginManager.java:412)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(DefaultLifecycleExecutor.java:534)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalWithLifecycle(DefaultLifecycleExecutor.java:475)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoal(DefaultLifecycleExecutor.java:454)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalAndHandleFailures(DefaultLifecycleExecutor.java:306)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeTaskSegments(DefaultLifecycleExecutor.java:273)
at org.apache.maven.lifecycle.DefaultLifecycleExecutor.execute(DefaultLifecycleExecutor.java:140)
at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:322)
at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)
at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)
at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)
at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)
at org.codehaus.classworlds.Launcher.main(Launcher.java:375)
[PATCH] Flow 2.1.0 reload-script = true does not reload scripts loaded via cocoon.load
When a script is loaded via cocoon.load the refresh parameter for CompilingInterpreter.ScripSourceEntry.getScript is always set to false. In 2.1.8 this parameter was incorrectly ignored, when checking the compile time against the last modified time in CompilingInterpreter.ScripSourceEntry.getScript. This was corrected in 2.19 or 2.1.10. The side effect however is that scripts loaded via cocoon.load are never checked for modification, as FOM_JavaScriptInterpreter.compileScript(Context, String) always calls the getScript method with refresh = false.
In the supplied patched (patch-1.txt and patch-2.txt) the compileScript method now sets the refresh indicator dependent on the reload-script and check-time parameters.
Unsynchronized access to HashMap in ResourceReader
I've just had a production server lock up, and when I forced a stack trace I saw lots of these:
&quot;TP-Processor30&quot; daemon prio=5 tid=0x00ce2a50 nid=0x52 runnable [bccfd000..bccffc30]
at java.util.HashMap.get(HashMap.java:325)
at org.apache.cocoon.reading.ResourceReader.getLastModified(ResourceReader.java:238)
at org.apache.cocoon.components.pipeline.AbstractProcessingPipeline.process(AbstractProcessingPipeline.java:468)
at org.apache.cocoon.components.treeprocessor.sitemap.ReadNode.invoke(ReadNode.java:84)
etc.
What I've noticed is that the 'documents' HashMap in ResourceReader (a static member) is accessed in an unsynchronized fashion; neither is documents synchronized, or are the puts and gets to it. This is a potential (and actual!!) hazard, and can lead to crashes or hangs.
Suggest that line 94 of ResourceReader.java is changed from:
private static final Map documents = new HashMap();
to
private static final Map documents = Collections.synchronizedMap(new HashMap());
Work-around: 
enable quick-modified-test in configuration which by-passes use of the document URI cache:
&lt;map:reader logger=&quot;sitemap.reader.resource&quot; name=&quot;resource&quot; pool-max=&quot;32&quot; src=&quot;org.apache.cocoon.reading.ResourceReader&quot;&gt;
&lt;quick-modified-test&gt;true&lt;/quick-modified-test&gt;
&lt;/map:reader&gt;
problem with htmlserializer (strange character in output )
Using the latest Cocoon (2.1.7) I have a problem with serialize type=&quot;html&quot;.
&lt;map:read src=&quot;index.html&quot;/&gt;
works fine.
But using the following (index.html is well balanced XML):
&lt;map:generate src=&quot;index.html&quot;/&gt;
&lt;map:serialize type=&quot;html&quot;/&gt;
adds a greater than character '&gt;' in the output:
&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;
&quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:b=&quot;http://www.backbase.com/b&quot;
xmlns:s=&quot;http://www.backbase.com/s&quot;&gt;
It only happens if the original document also has a DOCTYPE definition (will be
removed by Cocoon):
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:b=&quot;http://www.backbase.com/b&quot;
xmlns:s=&quot;http://www.backbase.com/s&quot;&gt;
Note that it only happens with org.apache.cocoon.serialization.HTMLSerializer;
not with org.apache.cocoon.serialization.XMLSerializer.
It doesn't matter if you configure with or without doctype, encoding etc.
&lt;map:serializer logger=&quot;sitemap.serializer.html&quot; mime-type=&quot;text/html&quot;
name=&quot;html&quot; pool-grow=&quot;4&quot; pool-max=&quot;32&quot; pool-min=&quot;4&quot;
src=&quot;org.apache.cocoon.serialization.HTMLSerializer&quot;&gt;
&lt;doctype-public&gt;-//W3C//DTD HTML 4.01 Transitional//EN&lt;/doctype-public&gt;
&lt;doctype-system&gt;http://www.w3.org/TR/html4/loose.dtd&lt;/doctype-system&gt;
&lt;encoding&gt;UTF-8&lt;/encoding&gt;
&lt;/map:serializer&gt;
jsp functionality broken in cocoon 2.1.7-dev, Tomcat 5.5.7, jdk1.5.0_01
Environment
===========
fedora core 3 linux 2.6.10-1.766_FC3
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_01-b08)
Tomcat 5.5.7
&lt;servlet&gt;
&lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
&lt;servlet-class&gt;org.apache.jasper.servlet.JspServlet&lt;/servlet-class&gt;
&lt;init-param&gt;
&lt;param-name&gt;fork&lt;/param-name&gt;
&lt;param-value&gt;false&lt;/param-value&gt;
&lt;compiler&gt;javac&lt;/compiler&gt;
&lt;/init-param&gt;
&lt;init-param&gt;
&lt;param-name&gt;xpoweredBy&lt;/param-name&gt;
&lt;param-value&gt;false&lt;/param-value&gt;
&lt;/init-param&gt;
&lt;load-on-startup&gt;3&lt;/load-on-startup&gt;
&lt;/servlet&gt;
Cocoon
URL: http://svn.apache.org/repos/asf/cocoon/branches/BRANCH_2_1_X
Repository UUID: 13f79535-47bb-0310-9956-ffa450edef68
Revision: 155211
Node Kind: directory
Schedule: normal
Last Changed Author: sylvain
Last Changed Rev: 155210
Last Changed Date: 2005-02-24 09:02:09 -0800 (Thu, 24 Feb 2005)
Properties Last Updated: 2005-01-24 11:30:14 -0800 (Mon, 24 Jan 2005)
Build
=====
Cocoon builds fine under jdk1.5.0_01 with modifications to
tools/targets/init-build.xml to target the 1.5 jdk.
152c152
&lt; target=&quot;1.5&quot;
---
&gt; target=&quot;1.4&quot;
178c178
&lt; target=&quot;1.5&quot;
---
&gt; target=&quot;1.4&quot;
Issue
=====
Accessing http://localhost:8080/cocoon/samples/blocks/jsp/welcome.htm generates
NO output:
&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;
Accessing http://localhost:8080/cocoon/samples/blocks/jsp/welcome.xml generates
the following error:
Premature end of file
column: -1
line: -1
cause: org.xml.sax.SAXParseException: Premature end of file.
location: null
Stack trace information:
org.apache.cocoon.ProcessingException: SAXException while parsing JSPEngine
output: org.xml.sax.SAXParseException: Premature end of file.
at org.apache.cocoon.generation.JSPGenerator.generate(JSPGenerator.java:97)
Caused by: org.xml.sax.SAXParseException: Premature end of file.
at org.apache.excalibur.xml.impl.JaxpParser.fatalError(JaxpParser.java:443)
The JSP and class files for the page are generated in:
$TOMCAT_HOME/work/Catalina/localhost/cocoon/org/apache/jsp/samples/blocks/jsp
a crash in the name() function of the xslt, when using SQL transformer
'- when using sqltransformer, if on the pipeline the next transformer is standard 
xslt, you can not use name() or local-name() functions for guessing the names of 
the attributes of SQL namespaced elements. (rowset, by example). it throws al 
ava.lang.indexOutofBounds exception. It only happens when you use it on 
attributes:
&lt;xsl:for-each select=&quot;@*&quot;&gt;
&lt;xsl:attribute name=&quot;{name()}&quot;&gt;blabla&lt;/xsl:attribute&gt;
&lt;/xsl:for-each&gt;
but &lt;xsl:for-each select=&quot;@sql:*&quot;&gt;
&lt;xsl:attrbute name=&quot;{name()}&quot;&gt;sdfsdf&lt;/xsl:attribute&gt;
&lt;/xsl:for-each&gt;
works fine.
I think it only happes the firts time you &quot;enter&quot; a sql-namespaced element in 
applying the templates.
In cocoon2.0.4 this used to work fine.
the stacktrace:
java.lang.ArrayIndexOutOfBoundsException: 7 &gt;= 1
at java.util.Vector.elementAt(Vector.java:427)
at org.apache.xml.dtm.ref.DTMStringPool.indexToString(DTMStringPool.java:137)
at org.apache.xml.dtm.ref.sax2dtm.SAX2DTM2.getNodeName(SAX2DTM2.java:2770)
at org.apache.xalan.xsltc.dom.SAXImpl.getNodeName(SAXImpl.java:1016)
at org.apache.xalan.xsltc.dom.DOMAdapter.getNodeName(DOMAdapter.java:282)
at cleanc.applyTemplates()
at cleanc.applyTemplates()
at cleanc.applyTemplates()
at cleanc.transform()
at org.apache.xalan.xsltc.runtime.AbstractTranslet.transform(AbstractTranslet.
java:533)
the stylesheet:
&lt;xsl:template match=&quot;/&quot;&gt; 
&lt;xsl:apply-templates select=&quot;block&quot;/&gt;
&lt;/xsl:template&gt;
&lt;xsl:template match=&quot;block&quot;&gt;
&lt;xsl:copy&gt;
&lt;xsl:for-each select=&quot;@*&quot;&gt;
&lt;xsl:attribute name=&quot;{name()}&quot;&gt;
&lt;xsl:value-of select=&quot;.&quot;/&gt;
&lt;/xsl:attribute&gt;
&lt;/xsl:for-each&gt;
&lt;xsl:apply-templates select=&quot;sql:rowset&quot;/&gt;
&lt;/xsl:copy&gt;
&lt;/xsl:template&gt;
&lt;xsl:template match=&quot;sql:rowset&quot;&gt;
&lt;xsl:copy&gt;
&lt;xsl:for-each select=&quot;@*&quot;&gt;
&lt;xsl:value-of select=&quot;local-name()&quot;/&gt;
&lt;/xsl:for-each&gt;
&lt;/xsl:copy&gt;
&lt;/xsl:template&gt;
this stylesheet is applied after a standard SQLTransformation.
and it crashes on &quot;local-name()&quot;.
Select.setInitialValue() is not working when Select have OptionGroup
When Select control have OptionGroup setInitialValue() is not working expected. Problem is in next lines of Select.java:
protected void setInitialValue() {
if ((getValue().length() == 0) &amp;&amp; !getOptionList().isEmpty()) {
Object object = getOptionList().get(0);
if (object instanceof String) {
setValue(object.toString());
} else if (object instanceof Option) {
Option option = (Option) object;
setValue(option.getValue());
}
}
}
Possible solution would be to add something like this
else if (list instanceof OptionGroup) {
OptionGroup optionGroup = (OptionGroup) object;
Option option = (Option) optionGroup.getChildren().get(0);
setValue(option.getValue());
}
DateField uses the unexpected first day of the week
DateField uses the unexpected first day of the week.
Currently DateField expects that Calendar#getFirstDayOfWeek()
returns SUNDAY = 0, MONDAY = 1.
But actually Calendar#getFirstDayOfWeek() returns SUNDAY = 1, MONDAY = 2.
http://java.sun.com/j2se/1.5.0/docs/api/constant-values.html#java.util.Calendar.SUNDAY
Therefore, the first day of the week becomes the one different from
the convention of each country.
Related bug: CLK-36
CheckBox is still active when you set it to readonly.
Since HTML doesn't allow you to set a checkbox to readonly a work around is required.
A quick fix would be to extend the setReadonly method to call the following when readonly is set to true:
setAttribute(&quot;onclick&quot;, &quot;return false;&quot;); which stops the user changing the value.
A bigger fix would be to set the field to disabled and to include a hidden field with the real value.
CSS error in JavaScript Validation
When we use the client side validation,
Firefox JavaScript Console outputs the following message:
-----
Expected ':' but found 'null'.
-----
If the sytle attribute is null, validateForm function should not output &quot;sytle=null&quot;.
Differences of Java/JavaScript error message
The error message of the required validation in Java/JavaScript are different.
This patch fixes error messages in Checkbox, RadioGroup, Select Controls.
Select readonly not working
when I set a form to readonly(true) the QuerySelect doesn't inherit this property.
NPE in EmailField due to missing entry in click-control.properties
When an invalid non-empty email is entered in the EmailField, the following NPE occurs:
java.lang.NullPointerException
at java.text.MessageFormat.applyPattern(MessageFormat.java:414)
at java.text.MessageFormat.&lt;init&gt;(MessageFormat.java:350)
at java.text.MessageFormat.format(MessageFormat.java:803)
at net.sf.click.control.Field.getMessage(Field.java:516)
at net.sf.click.control.Field.getMessage(Field.java:499)
at net.sf.click.extras.control.EmailField.onProcess(EmailField.java:138)
Looks like &quot;email-format-error&quot; key is missing from click-control.properties
Unbalanced tags in JavaDoc for ContextBase class
A closing &lt;/em&gt; tag -- following the term &quot;Attribute-Property Transparency&quot; at line 40 -- is missing in the class summary portion of the javadoc. This is resulting in the remainder of the page to be in italics. (Viewable at http://jakarta.apache.org/commons/chain/apidocs/org/apache/commons/chain/impl/ContextBase.html) There is also a missing opening &lt;p&gt; tag following this term causing the paragraph tags to be unbalanced.
So line 40
...&lt;em&gt;Attribute-Property Transparency&lt;/p&gt;. This is implemented...
Should be
...&lt;em&gt;Attribute-Property Transparency&lt;/em&gt;&lt;/p&gt;. &lt;p&gt;This is implemented...
Indexing entities with inheritance across datamaps
Looking at EntityResolver.constructCache, if entity's superentity exists in a different DataMap, EntityInheritanceTree will not be linked properly. Extracting inheritance processing code outside the mapIterator loop should fix the problem.
Beehive Apt ant task fails with Ant 1.7.x
This issue will cause build failures when building Beehive Controls and Page flows using Ant 1.7.x.
This appears to be due to an issue in the Beehive o.a.b.c.r.g.AptTask class which causes Ant 1.7 to fail when building beehive with a 'circular reference' error. See following stack trace:
build:
[echo] compile module: ejb-control
[echo] module classpath: /home/cschoett/beehive/trunk/controls/build/jars/beehive-controls.jar:/home/cschoett/beehive/trunk/system-controls/external/ejb/geronimo-j2ee_1.4_spec-1.0.jar:/home/cschoett/beehive/trunk/external/velocity/velocity-dep-1.4.jar:/home/cschoett/beehive/trunk/external/commons/commons-logging-1.0.4.jar:/usr/local/jdk1.5.0_04/lib/tools.jar
[mkdir] Created dir: /home/cschoett/beehive/trunk/system-controls/build/classes/ejb-control
[mkdir] Created dir: /home/cschoett/beehive/trunk/system-controls/build/gensrc/ejb-control
BUILD FAILED
/home/cschoett/beehive/trunk/system-controls/src/ejb/build.xml:48: The following error occurred while executing this line:
/home/cschoett/beehive/trunk/ant/beehive-tools.xml:76: This data type contains a circular reference.
at org.apache.tools.ant.ProjectHelper.addLocationToBuildException(ProjectHelper.java:541)
at org.apache.tools.ant.taskdefs.MacroInstance.execute(MacroInstance.java:394)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
at org.apache.tools.ant.Task.perform(Task.java:348)
at org.apache.tools.ant.Target.execute(Target.java:357)
at org.apache.tools.ant.Target.performTasks(Target.java:385)
at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
at org.apache.tools.ant.Main.runBuild(Main.java:698)
at org.apache.tools.ant.Main.startAnt(Main.java:199)
at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)
at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)
Caused by: /home/cschoett/beehive/trunk/ant/beehive-tools.xml:76: This data type contains a circular reference.
at org.apache.tools.ant.types.DataType.circularReference(DataType.java:265)
at org.apache.tools.ant.types.Path.add(Path.java:259)
at org.apache.tools.ant.types.Path.append(Path.java:305)
at org.apache.tools.ant.taskdefs.Javac.setSourcepath(Javac.java:256)
at org.apache.beehive.controls.runtime.generator.AptTask.scanDir(AptTask.java:117)
at org.apache.beehive.controls.runtime.generator.AptTask.execute(AptTask.java:271)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
at org.apache.tools.ant.Task.perform(Task.java:348)
at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:62)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
at org.apache.tools.ant.Task.perform(Task.java:348)
at org.apache.tools.ant.taskdefs.MacroInstance.execute(MacroInstance.java:391)
... 16 more
--- Nested Exception ---
/home/cschoett/beehive/trunk/ant/beehive-tools.xml:76: This data type contains a circular reference.
at org.apache.tools.ant.types.DataType.circularReference(DataType.java:265)
at org.apache.tools.ant.types.Path.add(Path.java:259)
at org.apache.tools.ant.types.Path.append(Path.java:305)
at org.apache.tools.ant.taskdefs.Javac.setSourcepath(Javac.java:256)
at org.apache.beehive.controls.runtime.generator.AptTask.scanDir(AptTask.java:117)
at org.apache.beehive.controls.runtime.generator.AptTask.execute(AptTask.java:271)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
at org.apache.tools.ant.Task.perform(Task.java:348)
at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:62)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
at org.apache.tools.ant.Task.perform(Task.java:348)
at org.apache.tools.ant.taskdefs.MacroInstance.execute(MacroInstance.java:391)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)
at org.apache.tools.ant.Task.perform(Task.java:348)
at org.apache.tools.ant.Target.execute(Target.java:357)
at org.apache.tools.ant.Target.performTasks(Target.java:385)
at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)
at org.apache.tools.ant.Project.executeTarget(Project.java:1298)
at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)
at org.apache.tools.ant.Project.executeTargets(Project.java:1181)
at org.apache.tools.ant.Main.runBuild(Main.java:698)
at org.apache.tools.ant.Main.startAnt(Main.java:199)
at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)
at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)
Total time: 0 seconds
maven 2 support -- beehive-netui-core has struts listed in &quot;test&quot; scope
The beehive-netui-core.pom defines its dependency on Struts in the &quot;test&quot; scope. The scope should be empty.
ClassCastException in the DefaultExceptionsHandler when handling JSP rendering exceptions on a direct call to a JSP
When a request is made directly to a JSP (not via a page flow) and the rendering of the JSP throws an exception, the PageFlowPageFilter will catch the exception and try to use the DefaultExceptionsHandler. However, the DefaultExceptionsHandler expects the request to be a PageFlowRequestWrapper and calls PageFlowRequestWrapper.get(). In this scenario, the request is not a PageFlowRequestWrapper so the get() method throws either an AssertException (when checking for the PageFlowRequestWrapper) or a ClassCastException when running without asserts.
Here's an example stack trace...
java.lang.ClassCastException: org.apache.coyote.tomcat5.CoyoteRequestFacade
at org.apache.beehive.netui.pageflow.internal.PageFlowRequestWrapper.get(PageFlowRequestWrapper.java:60)
at org.apache.beehive.netui.pageflow.internal.DefaultExceptionsHandler.handleException(DefaultExceptionsHandler.java:110)
at org.apache.beehive.netui.pageflow.FlowController.handleException(FlowController.java:272)
at org.apache.beehive.netui.pageflow.PageFlowPageFilter.handleException(PageFlowPageFilter.java:440)
at org.apache.beehive.netui.pageflow.PageFlowPageFilter.runPage(PageFlowPageFilter.java:354)
at org.apache.beehive.netui.pageflow.PageFlowPageFilter.doFilter(PageFlowPageFilter.java:251)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
faultactor is facultative in SoapFaults
In handling SoapFaults, faultactor is retrieved unconditionally (next()) where it should (being facultative) be checked for presence first (peek()).
$ pwd
/cd/d/Quellen/SVN/axis/c/src/soap
Index: SoapDeSerializer.cpp
===================================================================
--- SoapDeSerializer.cpp (Revision 480584)
+++ SoapDeSerializer.cpp (Arbeitskopie)
@@ -401,7 +401,8 @@
char *pcDetail;
char *pcFaultCode;
char *pcFaultstring;
- char *pcFaultactor;
+ char *pcFaultactor = &quot;&quot;;
+ char* pcName;
if (0 == strcmp (&quot;Fault&quot;, pName))
{
if (0 != strcmp (m_pNode-&gt;m_pchNameOrValue, pName))
@@ -431,10 +432,14 @@
if ( pcFaultstring )
delete [] pcFaultstring;
- pcFaultactor = getElementAsString (&quot;faultactor&quot;, 0);
- pFault-&gt;setFaultactor (pcFaultactor == NULL ? &quot;&quot; : pcFaultactor);
- if ( pcFaultactor )
- delete [] pcFaultactor;
+ pName = peekNextElementName();
+ if (strcmp(pName, &quot;faultactor&quot;) == 0)
+ {
+ pcFaultactor = getElementAsString (&quot;faultactor&quot;, 0);
+ pFault-&gt;setFaultactor (pcFaultactor == NULL ? &quot;&quot; : pcFaultactor);
+ if ( pcFaultactor )
+ delete [] pcFaultactor;
+ }
// FJP Changed the namespace from null to a single space (an impossible
// value) to help method know 
Deserializing complex type broken when start-end element tag is encountered
If a complex type defined as:
&lt;s:complexType name=&quot;SortR&quot;&gt;
&lt;s:sequence&gt;
&lt;s:element minOccurs=&quot;0&quot; maxOccurs=&quot;1&quot; name=&quot;ListMsg&quot; type=&quot;tns:ArrayOfMsgS&quot; /&gt;
&lt;s:element minOccurs=&quot;0&quot; maxOccurs=&quot;1&quot; name=&quot;DateMed&quot; type=&quot;s:string&quot; /&gt;
&lt;s:element minOccurs=&quot;1&quot; maxOccurs=&quot;1&quot; name=&quot;NumberMed&quot; type=&quot;s:int&quot; /&gt;
&lt;/s:sequence&gt;
&lt;/s:complexType&gt;
And the response comes back as:
&lt;SortRResult&gt;
&lt;ListMsg/&gt;
&lt;DateMed&gt;2006-11-10&lt;/DateMed&gt;
&lt;NumberMed&gt;123456&lt;/NumberMed&gt;
.
.
The deserialization of ListMsg does not recognize the fact that empty element was passed and thus attempts to parse the subsequent data as if it was part of ListMsg.
WSDL2WS generate wrong code: no check for param-&gt;any1 will cause core dump
[Error Statement]:
I have used AxisCPP1.6Beta version to generate TestDataInfo.cpp and Respond.cpp as the below:
TestDataInfo.cpp:
int Axis_Serialize_JobInfo(JobInfo* param, IWrapperSoapSerializer* pSZ, bool bArray = false)
{
... ...
pSZ-&gt;serializeAnyObject(param-&gt;any1);
... ...
}
and Respond.cpp:
int Axis_Serialize_Respond(Respond* param, IWrapperSoapSerializer* pSZ, bool bArray = false)
{
... ...
pSZ-&gt;serializeAnyObject(param-&gt;any1);
... ...
}
From the generated code, param-&gt;any1 is really an AnyType* pointer.
In some case, param-&gt;any1 will be NULL, but since there has no check for it before use, there will cause my generated server component core dump.
[solution]:
I have investigated the source code of AxisCPP/WSDL2Ws tool, and found that if I modify the following code at about line 682~694 in writeSerializeGlobalMethod method that belongs to BeanParamWriter (wsdl2ws/cpp/iteral) class, the generated code will become correct.
if (attribs[i].isAnyType())
{
anyCounter += 1;
//&lt;mxiong debug 2006/4/25 
writer.write(&quot;\tif (param-&gt;&quot; + attribs[i].getParamName() + Integer.toString(anyCounter) + &quot; != NULL)\n\t{\n&quot;);
//&gt;mxiong debug 2006/4/25
writer.write(&quot;\t\tpSZ-&gt;serializeAnyObject(param-&gt;any&quot; + Integer.toString(anyCounter) +&quot;);\n&quot;);
//&lt;mxiong debug 2006/4/25
writer.write(&quot;\t}\n&quot;);
//&gt;mxiong debug 2006/4/25
}
So I think it maybe a bug, could you like to check it ?
After the previous modifications module didn't work
I have fixed the problems with the axis2_iis_worker
addr_out_handler carries conditions without functions
I could see some condtions without any functions in addr_out_hander.c 
addr_out_hander.c:332
------------------------------
if (svc_group_context_id
&amp;&amp; AXIS2_STRCMP(svc_group_context_id, &quot;&quot;) != 0)
{}
addr_out_handler.c:694
----------------------------
if (AXIS2_STRCMP(AXIS2_WSA_NAMESPACE_SUBMISSION, addr_ns) == 0)
{
/* comment */
}
If there is no special functions here we could remove them.
Samples crash with apache module on windows
When a sample run with apache server several times over and over again, it crashes from the following location. 
Line 217 of axis2c\modules\core\receivers\raw_xml_in_out_msg_recv.c
if (status == AXIS2_SUCCESS)
{
skel_invoked = AXIS2_TRUE;
result_node = AXIS2_SVC_SKELETON_INVOKE(svc_obj, env, om_node, new_msg_ctx); &lt;==
Debugger shows me that svc_obj contains an 'ops' in which the values are 0.
Generated code for complex types give compilation errors (WSDL2C Java Version)
&lt;xs:complexType name=&quot;ErrorParameterType&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Value&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;xs:attribute name=&quot;ParamID&quot; type=&quot;xs:string&quot;/&gt;
&lt;/xs:complexType&gt;
when there is complex type like above inside wsdl, generated .c file containing structure and function for manipulating it gave compilation errors.
This is caused by if statement in the CADBBeanTemplate Source doesn't correctly process the input xml generated for the complex type.
To correct the error we have to introduce a new attribute to the &quot;property &quot; element in the generated xml. And improve the following logic in template.
&lt;xsl:if test=&quot;property and (not(property/@attribute) or property/@attribute='')&quot;&gt; to
&lt;xsl:if test=&quot;property and (not(property/@attribute) or property/@attribute='' or property/@notattribute)&quot;&gt;
Wrong Logic inside generate service skeleton's axis2_svc_skel_&lt;Service Name&gt;_invoke function (WSDL2C Java Version)
In the current implementation of generated code, when we execute the invoke method of the service skeleton it select the correct operation by getting the local name of the root xml element of the payload. But this case is only succeed when we use RPC style binding. Have to correct the operation selection logic by getting the operation name from the message context.
ssl_stream.h and ssl_util.h missing
with axis2c-src-0.96 , --enable-openssl=yes build option failed saying ssl/ssl_stream.h and ssl/ssl_util.h missing.
Codegeneration Tool Generate stub that use incorrect macros for build_om functions of structures
Generated stub code use macro of input message type to build the structure for output message type.
Example:
axis2_divResponse_t* ret_val = NULL;
axiom_node_t *ret_node = NULL;
ret_val = axis2_divResponse_create(env);
AXIS2_DIV_BUILD_OM(ret_val, env, ret_node );
But AXIS2_DIV_BUILD_OM(ret_val, env, ret_node ); must be AXIS2_DIVRESPONSE_BUILD_OM(ret_val, env, ret_node);
Whitespaces after elements are missing in the AXIOM object model
Whitespaces in an xml document such as the following will be eleminated when its AXIOM OM is built.
&lt;a&gt;
&lt;b&gt;
&lt;/b&gt;
&lt;/a&gt;
The resulting representation of the above document becomes 
&lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt;
As a consequence, we can't build the proper canonical representation of an xml document, using AXIOM. This may also lead to interoperability problems with digital signature.
Segmentation fault occurred when executing w2c tool
When execute w2c tool with following options it gives segmentation faults.
Here is the out put when run wdc using gdb
(gdb) r -uri BasicAllTest.wsdl -o src -id -ss -sd -d adb
Starting program: /home/milinda/Projects/axis2_c/c/deploy/bin/tools/w2c -uri BasicAllTest.wsdl -o src -id -ss -sd -d adb
[Thread debugging using libthread_db enabled]
[New Thread -1212728640 (LWP 8876)]
[Wed Nov 22 12:38:06 2006] [debug] class_loader.c(233) Object loaded successfully
[Wed Nov 22 12:38:06 2006] [debug] class_loader.c(233) Object loaded successfully
[Wed Nov 22 12:38:06 2006] [debug] class_loader.c(233) Object loaded successfully
[Wed Nov 22 12:38:06 2006] [debug] class_loader.c(233) Object loaded successfully
[Wed Nov 22 12:38:06 2006] [debug] class_loader.c(233) Object loaded successfully
[Wed Nov 22 12:38:06 2006] [debug] class_loader.c(233) Object loaded successfully
Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread -1212728640 (LWP 8876)]
0x00000000 in ?? ()
(gdb) bt
#0 0x00000000 in ?? ()
#1 0xb7bd5764 in parse_svc (reader=0x80664e8, env=0x804a018, svc_el_node=0x8065288, desc=0x8066670) at wsdl10_reader.c:3129
#2 0xb7bd76da in parse_desc (reader=0x80664e8, env=0x804a018, document_base_uri=0x804bfd8 &quot;file:/&quot;, desc_el_node=0x805b828, wsdl_modules=0x806b7a8)
at wsdl10_reader.c:821
#3 0xb7bbf381 in woden_resolver_read (resolver=0x8065230, env=0x804a018, om_doc=0x805a480, doc_base_uri=0x804bfd8 &quot;file:/&quot;) at resolver.c:244
#4 0xb7b5ce7f in w2c_databinding_adb_ext_invoke (env=0x804a018, conf=0x804bd78) at databinding_adb_ext.c:209
#5 0xb7b5d157 in w2c_databinding_adb_ext_engage (extension=0x804de58, env=0x804a018, conf=0x804bd78) at databinding_adb_ext.c:99
#6 0xb7f45842 in w2c_engine_generate (engine=0x804a648, env=0x804a018) at engine.c:221
#7 0x08048922 in main (argc=0, argv=0x0) at wsdl2code.c:45
Allow registry of ClassFinder implementation with ClassFinderFactory
The ClassFinderFactory should expose a setter to allow the setting of a custom ClassFinder instead of always returning the ClassFinderImpl.
NPE in FaultDescriptionImpl
When the faultBean attribute of the @WebFault annotation is not specified, it is possible that the result of WebFaultAnnot.faultBean() is null. Code that relies on the faultBean must first check for null.
Wrong SOAPBinding API import
Wrong SOAPBinding API import causes the Poxy client side attachment optimization code path to be skipped even when optimization is enabled.
Catch and Throw ConnectionException and UnknownHostException in WSDL4JWrapper
When attempting to retrieve a WSDL document specified by a URL, the WSDL4JWrapper class should catch ConnectionException and UnknownHostException and throw them to the ServiceDescriptionImpl class.
RequestWrapper annotation reading incorrect default
RequestWrapper annotation is reading EndpointImpl as the default class this is incorrect causing an unmarshalling Exception in JAXB. I am submitting the patch that will correct the default to seiMethod converted to java Class clas RequestWrapper default.
JAX-WS Async Response.get() should cache the response object
The JAX-WS engine implements a Response&lt;T&gt; object for asynchronous clients.
A user invokes the get() method on the Response to obtain the returned business object.
If the user invokes get() a second time, the JAX-WS engine tries to reparse the message, which causes a failure because the message has been consumed. 
Instead, the first get() should cache the business object and the second get() should simply return the cached object.
I am working on a small patch to fix this processing. The patch will include an updated ParallelAsync test.
scheu
JAX-WS Assorted Method Marshalling Problems
I am working on a patch to correct the following JAXWS method marshalling/unmarshalling issues:
1) The @WebResult header value is not currently respected. If @WebResult header=true, the value is passed in the body.
2) If you try to pass an @WebResult or @WebParam in a header for a WRAPPED method, you get an internal exception. 
Even though header values violate the WRAPPED rules, the Sun tooling (wsgen) supports this scenario.
3) The ParallelAsync tests are currently disabled due to a bug with @WebResult processing in WRAPPED mode.
I am also adding/improving trace in these areas.
fault description class should support exceptions withOUT @WebFault
Currently, the FaultDescriptionImpl only supports exception classes with @WebFault annotation. JAX-WS spec section 3.7 says @WebFault is optional.
JAXB error when marshalling optimized attachment
The marshalling of optimized attachment by JAXB sometimes results in an erroneous XML envelop.
JAX-WS NPE in Dispatch mode=Payload if there are no contents in the soap body
I noticed that the *Dispatch code will get an NPE if there is nothing in the body.
I have a small patch that corrects this problem and adds additional logging. 
Need to catch FileNotFoundException when client attempts to retrieve WSDL at invalid location
If the client attempts to retrieve a WSDL at an invalid location, the MDQ code should catch the FileNotFoundException that is thrown. Before, a generic exception was thrown and caught when any type of exception occurred during WSDL retrieval.
JAX-WS XMLSpine Improvements
XMLSpine is one of the key objects in the JAX-WS model of the Message.
I have a patch that is a rearchitecture of this class. 
Summary of changes:
1) The primary purposeof the XMLSpine is a repository of Blocks, where a Block is an xml representation backed by a data object (JAXB, String, Source, etc.) . The prior version of XMLSpine stored these Blocks in instance arrays. The new version of the code stores the Blocks directly in the OM tree (using OMSourcedElement). This is a simpler design. In addition, the new design also keeps the OM tree in a consistent state.
2) The XMLSpine used OMChildIterator in several places. This caused problems with unnecessary tree expansion. I made some several changes to the code to avoid moving the parser cursor.
Reference parameters read as OMText only
Reference parameters are treated as text fields and not as xs:anyType as specified in WS-Addressing specs
AddressingFinalInHandler:53
toEPR.addReferenceParameter(soapHeaderBlock.getQName(), soapHeaderBlock.getText());
I would have expected something similar to
toEPR.addReferenceParameter(soapHeaderBlock);
NoClassDefFoundError when creating JAXBContext
Creating of JAXBContext is failing with a NoClassDefFoundError when trying to create context with list of classes. We are tying to absorb the exception when we load a class that will be used to create a JAXBContext, however if the class definition is not found the ClassLoader throws NoClassDefFoundError. We are trying to absorb everything that extends Exception and since NoClassDefFound is not a sub class of Exception the program fails fatally. I am changing the code to catch Throwable at all the places in Jaxws code where we try to load the class using Class.forName() method, this will ensure that we do not fail fatally and absorb all the exceptions when we need to absorb them.
JAX-WS Dispatch&lt;DOMSource&gt; Failure
During JAX-WS Dispatch DOMSource, the DOMSource must be converted into an XMLStreamReader. The current code does this by wrapping the DOMSource's node with a DOMReader. Unfortunately this is causing problems.
I am going to change the code to use a Transformer. This is safer and easier.
JAX-WS SOAPMessageProvider Test Failures
Several of the SOAPMessageProvider tests are failing due to a ClastCastException
fRequest Message Type is:xml and attachment request
***ERROR: In SoapMessageProvider.invoke: Caught exception java.lang.ClassCastException: javax.xml.transform.stream.StreamSource incompatible with java.lang.String
Request Message:
&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;&lt;soap:Body&gt;&lt;ns2:invoke xmlns:ns2=&quot;http://org.test.soapmessage&quot;&gt;&lt;invoke_str&gt;xml and mtom request&lt;/invoke_str&gt;&lt;data&gt;&lt;xop:Include xmlns:xop=&quot;http://www.w3.org/2004/08/xop/include&quot; href=&quot;helloWorld123&quot; /&gt;&lt;/data&gt;&lt;/ns2:invoke&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;&gt;&gt; Invoking SourceMessageProviderDispatch
&gt;&gt; SoapMessageProvider: Request received.
--------------------
These problems appear to be related to recent changes to the SAAJ implementation. I am investigating a fix.
fault addressing versions mismatch
Setting the addressing version using:
messageContext.setProperty(AddressingConstants.WS_ADDRESSING_VERSION, AddressingConstants.Submission.WSA_NAMESPACE);
correctly sets the action in the SOAP message to:
http://schemas.xmlsoap.org/ws/2004/08/addressing/fault
however in the HTTP POST header the action is set to:
SOAPAction: &quot;http://www.w3.org/2005/08/addressing/soap/fault&quot;
This causes problems when communicating with .net services which expect them to be the same
ConfigurationContext fillServiceContextAndServiceGroupContext needs improvements when the scope is &quot;transportsession&quot;
Logic in fillServiceContextAndServiceGroupContext needs to be updated when the service scope is &quot;transportsession&quot;.
JAX-WS JAXB Dispatch Message mode is broken
JAXBDispatch should support Message mode. In this mode, the JAXB object represents the entire message.
This needs to be supported in the sync and async cases, and we need tests.
I am working on a patch right now.
JAX-WS Engine should preserve the content-id of attachments
The JAX-WS engine is inadvertently changing the content-id of the attachments.
I am working on a code fix and possible test.
Thanks to Gordon Kuo of IBM who discovered this problem and suggested changes.
Rich
Jaxws Attachment optimization code is skipped
Due to some code rework in the message and attachments components of JAXWS, the attachment optimization, using XOP processing, code path is always skipped even when attachment optimization is enabled in either the client or the server side of JAXWS.
Improve method vs. operation handling in MDQ &amp; handle partial WSDL
This will improve annotation processing in the JAX-WS metadata layer in the following ways:
- Enforces that the method names in a Web service match the WSDL portType operation names
- Forces generation of WSDL when Web service was deployed with partial WSDL
- Conslidation of error reporting in Validators
myService5.init(sc) and myService5.destroy(sc) not called on a http://alpha1:8080/manager/html/start?path=/axis2 -&gt; start /stop-click in scope=application
Hi Team,
I am running myService5 in application scope! axis2-1.1
when stop is called from http://alpha1:8080/manager/html/start?path=/axis2
myService5.destroy() is called too late and an exception is raised
2007-01-17 08:01:54,518 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying module : addressing-1.1
2007-01-17 08:01:54,518 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying module : logging
2007-01-17 08:01:54,549 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying module : soapmonitor-1.1
2007-01-17 08:01:54,908 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service Library.aar
2007-01-17 08:01:54,940 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyService.aar
2007-01-17 08:01:54,971 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyService1.aar
2007-01-17 08:01:55,705 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyService4.aar
2007-01-17 08:01:56,143 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyService5.aar
2007-01-17 08:01:56,174 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyServiceWithModule.aar
2007-01-17 08:01:56,190 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service version.aar
2007-01-17 08:01:56,205 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service WsaMappingService.aar
2007-01-17 08:01:56,221 INFO userguide.example5.MyService - MyService5.init() called ********************************
So far the stdout_20070117.log of tomcat running on my PC
BUG: calling myService5.destroy(sc) in scope=application is called too late up on receiving the stop signal from the tomcat manager
The exception logged is
2007-01-17 08:07:32,808 INFO org.apache.axis2.engine.DependencyManager - Exception trying to call destroy
java.lang.reflect.InvocationTargetException
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at org.apache.axis2.engine.DependencyManager.destroyServiceObject(DependencyManager.java:127)
at org.apache.axis2.context.ConfigurationContext.cleanupServiceContexts(ConfigurationContext.java:356)
at org.apache.axis2.context.ConfigurationContext.cleanupContexts(ConfigurationContext.java:370)
at org.apache.axis2.engine.ListenerManager.stop(ListenerManager.java:177)
at org.apache.axis2.transport.http.AxisServlet.destroy(AxisServlet.java:114)
at org.apache.catalina.core.StandardWrapper.unload(StandardWrapper.java:1326)
at org.apache.catalina.core.StandardWrapper.stop(StandardWrapper.java:1654)
at org.apache.catalina.core.StandardContext.stop(StandardContext.java:4345)
at org.apache.catalina.manager.ManagerServlet.stop(ManagerServlet.java:1226)
at org.apache.catalina.manager.HTMLManagerServlet.stop(HTMLManagerServlet.java:545)
at org.apache.catalina.manager.HTMLManagerServlet.doGet(HTMLManagerServlet.java:106)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:689)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.netbeans.modules.web.monitor.server.MonitorFilter.doFilter(MonitorFilter.java:174)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:524)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)
at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)
at java.lang.Thread.run(Thread.java:595)
Caused by: java.lang.NullPointerException
at userguide.example5.MyService.destroy(MyService.java:98)
... 35 more
2007-01-17 08:07:32,823 INFO org.apache.axis2.context.ConfigurationContext - null; nested exception is: 
java.lang.reflect.InvocationTargetException
Now clicking start in at http://localhost:8080/manager/html/stop?path=/axis2 the following happens, which seams to
be working correct. on the PC, but start() failed yesterday flat on a OpenVMS platform. (maybe a resource problem) 
2007-01-17 08:17:03,229 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying module : addressing-1.1
2007-01-17 08:17:03,244 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying module : logging
2007-01-17 08:17:03,260 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying module : soapmonitor-1.1
2007-01-17 08:17:03,557 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service Library.aar
2007-01-17 08:17:03,588 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyService.aar
2007-01-17 08:17:03,619 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyService1.aar
2007-01-17 08:17:04,057 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyService4.aar
2007-01-17 08:17:04,494 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyService5.aar
2007-01-17 08:17:04,510 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service MyServiceWithModule.aar
2007-01-17 08:17:04,525 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service version.aar
2007-01-17 08:17:04,541 INFO org.apache.axis2.deployment.DeploymentEngine - Deploying Web service WsaMappingService.aar
2007-01-17 08:17:04,557 INFO userguide.example5.MyService - MyService5.init() called ****************************
Josef.Stadelmann
@winterthur.ch
Josef.Stadelmann
@winterthur.ch
Error during serialization results in corrupted stream
The kernel class org.apache.axis2.addressing.RelatesTo uses java.io.Serializable to handle saving and restoring its state. However, the RelatesTo object has an ArrayList, and if the serialization of the RelatesTo object encounters a NotSerializableError, then the stream could get corrupted since the default Java serialization doesn't handle errors very well.
The fix is to change the RelatesTo class to use java.io.Externalizable so that errors encountered during the saving and restoring of the ArrayList can be handled better.
SOAPFaultException Processing
A SOAPFault that flows to a JAX-WS client should be thrown as a SOAPFaultException if it does not match a known service exception.
This JIRA covers the following work:
1) Client Dispatch should throw a SOAPFaultException containing the SOAPFault.
2) Client Proxy should throw a SOAPFaultException containing the SOAPFault
3) The server should correctly flow a SOAPFault when a SOAPFaultException is thrown.
4) The server should correctly flow a SOAPFault when a non service exception is thrown (i.e. a NullPointerException is thrown).
Removing ObjectFactory and package-info from class list while creating jaxbcontext from array of classes
I am adding the code that will remove ObjectFactory and package-info from class list while creating jaxbcontext from array of classes.
Java2WSDLTask does not restore ClassLoader
The execute() method of Java2WSDLTask sets a new ClassLoader for Java2WSDLCodegenEngine but does not restore it afterwards. This causes hard-to-trace class loading errors in downstream Ant tasks. Suggested fix is to restore the original ClassLoader in a finally block at the end of the method.
JAX-WS Failures related to new SOAPAction processing
The SOAPAction processing flushed out errors in several JAX-WS tests.
SOAPAction based routing does not route correctly based on wsdl:binding/wsdl:operation/soap:operation soapAction
The Axis2 engine is not correctly handling a SOAPAction wsdl extensibility element (details below). The only SOAPAction routing that will work is if the SOAPAction is coincidently the same as the operation name.
DETAILS
=======
The problem in in WSDL11ToAxisServiceBuilder. The basic flow is
populateService
processBinding
processPortType
populateOperations
WSDL11ActionHelper for Input
WSDL11ActionHelper for Output
WSDL11ActionHalper for Fault
return
AxisService addOperation
// NOTE that at this point the SOAPAction has NOT been 
// on the operation! The SOAPAction is specified in the wsdl:binding
// and that has not been processed yet. So, this returns null or an empty string
soapAction = axisOperation.getSoapAction
if (soapAction not empty)
// As noted above, this isn't called because soapAction is empty
mapActionToOperation(soapAction, operation)
return
// NOW we get the wsdl bindings and process them, so this is the point we will encounter the
// SOAP Action in the WSDL binding
for each operation in the binding
copyExtensibleElements(wsdl4jBindingOperation.getExtensibilityElements(), dif, operation, BINDING_OPERATION);
// At this point, for a wsdl4jElement instanceof SOAP12Operation or wsdl4jElement instanceof SOAPOperation
// we will set the SOAP action on the operation
if(isTraceEnabled){
log.trace(&quot;copyExtensibleElements:: setSoapAction &quot;+soapOperation.getSoapActionURI());
}
axisOperation.setSoapAction(soapOperation.getSoapActionURI());
The problem with the above is that SOAP action from the WSDL binding is 
never added to the AxisService.operationsAliasesMap which is done by 
calling mapActionToOperation.
Note that I've only looked at WSDL11ToAxisServiceBuilder, but I suspect 
the same problem existsin WSDL20ToAxisServiceBuilder.
The net effect of all the above is that SOAPActionBasedDispatcher will 
only find an operation if the SOAPAction from the message happens to be 
the same as the AxisOperation name. 
So given the following WSDL snippet:
&lt;wsdl:binding name=&quot;BGCKBinding&quot; type=&quot;tns:BGCKIntf&quot;&gt;
&lt;soap:binding style=&quot;document&quot; transport=&quot;http://schemas.xmlsoap.org/soap/http&quot;/&gt;
&lt;wsdl:operation name=&quot;submitBGCK&quot;&gt;
&lt;soap:operation soapAction=&quot;http://ibm.com/bgck/submitBGCK&quot;/&gt;
The operation &quot;submitBGCK&quot; would not be found given a SOAPAction of 
&quot;http://ibm.com/bgck/submitBGCK&quot;.
Note that even though soap:operation soapAction is never used correctly, an error 
does not always occur. In some cases (wrapped), the correct operation (or 
at least an operation) can be determined by the 
SOAPMessageBodyBasedDispatcher. However, this will only &quot;work&quot; if 
WS-Addressing headers are not present. If they are present, then WS-A 
will throw an exception because the AxisOperation was not found: 
org.apache.axis2.AxisFault: The [action] cannot be processed at the receiver.&amp;#13;
at org.apache.axis2.addressing.AddressingFaultsHelper.triggerAddressingFault(AddressingFaultsHelper.java:156)&amp;#13;
at org.apache.axis2.addressing.AddressingFaultsHelper.triggerActionNotSupportedFault(AddressingFaultsHelper.java:131)&amp;#13;
at org.apache.axis2.handlers.addressing.AddressingWSDLValidationHandler.checkAction(AddressingWSDLValidationHandler.java:113)&amp;#13;
at org.apache.axis2.handlers.addressing.AddressingWSDLValidationHandler.invoke(AddressingWSDLValidationHandler.java:39)&amp;#13;
at org.apache.axis2.engine.Phase.invoke(Phase.java:382)&amp;#13;
at org.apache.axis2.engine.AxisEngine.invoke(AxisEngine.java:247)&amp;#13;
at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:164)&amp;#13;
at org.apache.axis2.transport.http.HTTPTransportUtils.processHTTPPostRequest(HTTPTransportUtils.java:337)&amp;#13;
WS-Addressing message id validation not performed for 2005/08 (final spec) messages.
The 2005/08 (final spec) requires that a message id be included in a request message that is likely to have a response message generated for it. If this is not the case then a fault should be generated.
Mistake in ../axis2/java/xdocs/faq.html#d4 (Axis2 Documentation)
In the 4th queston of faq ( ../axis2/java/xdocs/faq.html#d4) following correction is need to be done.
maven dist-std-bin Will generate the binary version of Axis2 standard distribution
- maven dist-std-bin Will generate the source version of Axis2 standard distribution
maven dist-std-bin Will generate the binary version of Axis2 standard distribution
+ maven dist-std-src Will generate the source version of Axis2 standard distribution
patch is attached
Sameera
JAXWS specification compliance Issue with RPC/LIT Processing.
JAXWS specification states that a WebServiceException should be thrown when invoking a operation with null parameter values with RPC/Lit style message. Currently we are processing the null, I will be changing the marshaller code so we throw appropriate WebServiceException.
JAXWS spec 4.3.4 conformance requires JAXBException
JAXWS spec 4.3.4 conformance requires a WebServiceException with a cause of JAXBException. Currently, the code throws a MessageException.
The attached patch fixes this.
-------------------
This issue will be used to remove MessageException and MessageExceptionFactory.
Wrong exception occurs when trying to invoke a service which is configured with an invalid message receiver
I created the following service class and deployed with the following services.xml.
service implementation class
----------------------------------------
public class myService {
public String echo(String s){
return s;
}
}
Services.xml
------------------
&lt;service name=&quot;myService&quot;&gt;
&lt;description&gt;
This is a sample service created to test Axis2 client API
&lt;/description&gt;
&lt;parameter name=&quot;ServiceClass&quot; 
locked=&quot;false&quot;&gt;myService
&lt;/parameter&gt;
&lt;operation name=&quot;echo&quot;&gt;
&lt;messageReceiver 
class=&quot;org.apache.axis2.receivers.RawXMLINOutMessageReceiver&quot;/&gt;
&lt;/operation&gt;
&lt;/service&gt;
Then I tried to invoke the service using a client which used OMElement payload and ServiceClient. 
I got the following exception when running the client.
org.apache.axis2.AxisFault: ServiceClass does not implement required method of the form OMElement echo(OMElement e)
at org.apache.axis2.description.OutInAxisOperationClient.send(OutInAxisOperation.java:271)
at org.apache.axis2.description.OutInAxisOperationClient.execute(OutInAxisOperation.java:202)
at org.apache.axis2.client.ServiceClient.sendReceive(ServiceClient.java:579)
at org.apache.axis2.client.ServiceClient.sendReceive(ServiceClient.java:508)
at client.main(client.java:42)
However the correct cause of the problem here is not what the exception says. Here I used a wrong message receiver class in the service and the exception does not say anything about the exact issue. 
Please generate the correct exception/error in this scenario. (eg:- An error such as 'The specified message receiver is invalid for the scenario' )
Secutiry module page is missing
Created as per the mail from Prasd in the Axis-user list..
Dear Admin,
On Apache Axis2 modules page ( http://ws.apache.org/axis2/modules/index.html ) Rampart link ( http://ws.apache.org/axis2/modules/rampart/1_1/security-module.html) does not work.
Could you kindly make that available.
Best Regards,
-Prasad
PackageSetBuilder throws NPE when class uses un-named package
The package set builder throw NullPointerException when a class is using default package. I am changing the code to return the package name as &quot;&quot; when the class uses such an unnamed package.
JAX-WS NS-&gt;Package Conversion Error
The JAX-WS code uses the JAXB algorithm (Chapter D.5) to convert namespaces to packages. 
The current code is not correctly applying step 7 &quot;convert words to lowercase&quot;. I will correct this problem and scrub the code again.
Rich
Wrong REST EPR shown in the admin console when enabling REST
When enabling REST for Axis2MainServlet in axis2.xml, wrong epr is shown in the admin console 'Available Services' page.
Steps to reproduce:
===================
1. Enable REST in axis2.xml
i.e:- Change the following parameter
&lt;parameter name=&quot;enableRESTInAxis2MainServlet&quot; locked=&quot;true&quot;&gt;true&lt;/parameter&gt;
2. Restart the server and navigate to 'Available Services' page in the axis2 admin console
3. Service REST epr is displayed as follows.
Service REST epr : http://localhost:8080/axis2/services/Version
: http://localhost:8080/axis2/rest/Version
Please see the attached screen shot.
Corrected an issue in rest-ws.html
The REST url request for invoking Version service specified in the rest-ws.html was incorrect. I changed it in the rest-ws.html and a patch is attached here with.
NTLM Credentials settings
This has been reported by Jonathan McCracken (jon@nexicon.ca)
===========================================
Hello Samindaa,
First off thank you for contributing to Axis2, and I hope you have the
time to respond to my question regarding getting NTLM working for my
Client Stub in 1.1 release.
I've looked through all the articles I can find and have turned up
with the same error. I'm using the following code to modify my stub:
public AdminWebServiceStub() throws org.apache.axis2.AxisFault {
populateAxisService();
populateFaults();
ConfigurationContext configurationContext = null;
_serviceClient = new
org.apache.axis2.client.ServiceClient(configurationContext,_service);
configurationContext =
_serviceClient.getServiceContext().getConfigurationContext();
//setup NTLM auth
HttpTransportProperties.Authenticator
auth = new
HttpTransportProperties.Authenticator();
auth.setDomain(&quot;domain&quot;);
auth.setUsername(&quot;username&quot;);
auth.setPassword(&quot;password&quot;);
//do not set HOST or PORT...although I've tried this and both return
same error //auth.setHost(&quot;url&quot;);
//auth.setPort(83));
//NTLMScheme ntlmAuthScheme = new NTLMScheme();
//ArrayList authSchemes = new ArrayList();
//authSchemes.add(ntlmAuthScheme);
//auth.setAuthSchemes(authSchemes);
//set NTLM auth
_serviceClient.getOptions().setProperty(org.apache.axis2.transport.http.HTTPConstants.AUTHENTICATE,
auth);
//set webservice end-point
_serviceClient.getOptions().setTo(new
org.apache.axis2.addressing.EndpointReference(&quot;url&quot;));
//Set the soap version
_serviceClient.getOptions().setSoapVersionURI(org.apache.axiom.soap.SOAP12Constants.SOAP_ENVELOPE_NAMESPACE_URI );
}
/////////////END CODE
The error I get is as follows:
Jan 2, 2007 3:07:15 PM
org.apache.commons.httpclient.HttpMethodDirector
processWWWAuthChallenge
WARNING: Unable to respond to any of these challenges: {negotiate=Negotiate}
org.apache.axis2.AxisFault: HTTP Transport error : '401' -
'Unauthorized'; nested exception is:
org.apache.axis2.AxisFault: HTTP Transport error : '401' -
'Unauthorized'; nested exception is:
org.apache.axis2.AxisFault: HTTP Transport error : '401' -
'Unauthorized'; nested exception is:
org.apache.axis2.AxisFault: HTTP Transport error : '401' - 'Unauthorized'
at org.apache.axis2.transport.http.CommonsHTTPTransportSender.invoke(CommonsHTTPTransportSender.java:225)
at org.apache.axis2.engine.AxisEngine.send(AxisEngine.java:670)
at org.apache.axis2.description.OutInAxisOperationClient.send (OutInAxisOperation.java:365)
at org.apache.axis2.description.OutInAxisOperationClient.execute(OutInAxisOperation.java:295)
at com.transcanada.safex.externalAccess.tedsProxy.AdminWebServiceStub.GetUser (AdminWebServiceStub.java:622)
at com.transcanada.safex.junit.TestTedsBindingStub.testGetUser(TestTedsBindingStub.java:31)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at com.intellij.rt.execution.junit2.JUnitStarter.main (JUnitStarter.java:31)
Caused by: org.apache.axis2.AxisFault: HTTP Transport error : '401' -
'Unauthorized'; nested exception is:
org.apache.axis2.AxisFault: HTTP Transport error : '401' - 'Unauthorized'
at org.apache.axis2.transport.http.CommonsHTTPTransportSender.writeMessageWithCommons(CommonsHTTPTransportSender.java:340)
at org.apache.axis2.transport.http.CommonsHTTPTransportSender.invoke(CommonsHTTPTransportSender.java :205)
... 23 more
Caused by: org.apache.axis2.AxisFault: HTTP Transport error : '401' -
'Unauthorized'
at org.apache.axis2.transport.http.SOAPOverHTTPSender.send(SOAPOverHTTPSender.java :144)
at org.apache.axis2.transport.http.CommonsHTTPTransportSender.writeMessageWithCommons(CommonsHTTPTransportSender.java:334)
... 24 more
/////////END STACK TRACE
I'm not sure what I'm doing wrong, as far as I can tell my client has
the correct HTTPTransportProperties at runtime (i've debugged this one
a few times). I've also checked the credentials and they work, but the
error seems to be related to not being able to respond to the NTLM
Negotiate challenge?
Any help/ideas would be greatly appreciated.
Thanks,
Jonathan
===========================================
The problem is in AbstractHttpSender
No ability to set mustUnderstand=true on WS-A headers
AFAIK there is no ability to set mustUnderstand=true on WS-A headers. I think that is a gap.
quickstart sample does not work on the trunk branch
1. run ant.generateservice to create StockQuoteService.aar
2. Copy the aar to webapps/axis2/WEB-INF/services
3. type http://localhost:8080/axis2/rest/StockQuoteService/getPrice?symbol=IBM in your web browser
In the tomcat logs I see
Dec 27, 2006 8:54:40 AM org.apache.axis2.transport.http.AxisRESTServlet doGet
SEVERE: org.apache.axis2.AxisFault: I can not find a service for this request to
be serviced. Check the WSDL and the request URI
The browser I get URL not found
Service lifecycle method shutDown() is invoked twice
When the Axis2 web application is shut down, the service lifecycle method shutDown is invoked twice. 
Note: this happens only if the service was deactivated and then reactivated using the administration frontend!
So, to reproduce this do the following:
- deploy service with a service lifecycle class
- startup Axis2 web application
- lifecycle method startUp() is invoked
- use admin frontend to deactived the service
- reactivate the service
- shut down Axis2 web application
- lifecycle method shutDown() is invoked twice!
At another note: it seems to me that SimpleHTTPServer has problems loading service lifecycle classes. My service archive (aar) works fine in Tomcat, but when I try to use it with SimpleHTTPServer I get a ClassNotFoundException because SimpleHTTPServer can't find my service lifecycle class... It's definitely the same aar file...
Thanks.
Issue in the &quot;yahoorestsearch&quot; sample
Below are the steps taken to reproduce the error
1. Type &quot;ant&quot; from Axis2_HOME/samples/yahoorestsearch directory to build and run the yahoorestsearch sample
2. Enter search text for the field &quot;Search for&quot; and click on the button &quot;Search&quot;
3. Then try giving the value &quot;txt&quot; for the field &quot;format&quot; and click on the button &quot;Search&quot;.
4. Click on any of the resulted links
4. Now clear the &quot;format&quot; field or enter &quot;html&quot; and click on the button &quot;Search&quot; once more
5. The results are shown as html tags as given below. For all the search jobs done afterwards the results are given as below
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Search Results&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;a href=http://uk.wrs.yahoo.com/_ylt=A0Je5Vs4eItFxFMAXR7dmMwF;_ylu=X3oDMTB2cXVjNTM5BGNvbG8DdwRsA1dTMQRwb3MDMQRzZWMDc3IEdnRpZAM-/SIG=11fgvdu71/EXP=1166854584/**http%3a//ws.apache.org/axis2/&gt;Axis2/Java - Apache
Changes done to the modules.html document
There were some issues identified in modules.html and the attached patch will resolve them
WSDL2Java adding SOAPAction
If the input WSDL uses &lt;soap:operation soapAction=&quot;&quot;/&gt; in the &lt;wsdl:binding&gt;, WSDL2Java generates specific soapActions and uses these instead (as seen at runtime, but also in the output WSDL and in the services.xml). I don't know the rationale for this, but it seems likely to cause problems with other SOAP engines when they get SOAPAction headers they're not expecting.
Issues in the release-notes.html of axis2-1.1.1-SNAPSHOT
There are some unwanted characters/text in the release-notes.html file and the formatting is completely gone.
Needs to be formatted and the unwanted content should be removed
Exception not thrown in AxisConfigBuilder -&gt; processTransportSenders()
The captured 'NoClassDefFoundError' is not thrown out in the following code.
org/apache/axis2/deployment/AxisConfigBuilder.java
{
private void processTransportSenders(Iterator trs_senders) throws
DeploymentException
{
.................
.................
try
{
..........
}
catch (NoClassDefFoundError e){
log.debug(Messages.getMessage(&quot;errorinloadingts&quot;, clasName), e);
//throw statement is missing here.
}
.............
}
}
When a option is set to _operation client it effects all operations called after that
Hi,
If I set a property to an options object of _operationClient and then call a sequence of methods on the stub, the property that I set applies to all operations called which is oncorrect. The reason is because the same options object is shared among all of them. 
For eg. if I set the option 
_operationClient.getOptions().setProperty(org.apache.axis2.transport.http.HTTPConstants.MC_GZIP_REQUEST,Boolean.TRUE);
Then all request messages sent after this is Gzipped.
Thanks,
-Keith
JAX-WS Need doPriv calls in FactoryFinder
Adding doPriv calls to JAX-WS FactoryFinder
Response.get() does not block
Async polling requests use the javax.xml.ws.Response object to collect responses. The get() and the get(long, TimeUnit) are used by the client to get the response contents. The spec states that the call to get() should block until the response has been returned. 
Javadoc reference: http://java.sun.com/javase/6/docs/api/java/util/concurrent/Future.html#get() 
The current implementation of the method does not block. Also, the get(long, TimeUnit) method is unimplemented. This JIRA will address both of these issues.
NullPointerException when OperationClient executes with an invalid transport
When using an invalid transport protocol like &quot;htp&quot; (instead of &quot;http&quot;), a NullPointerException occurred instead of an AxisFault exception.
java.lang.NullPointerException
at org.apache.axis2.description.ClientUtils.inferInTransport(ClientUtils.java:85)
at org.apache.axis2.description.OutInAxisOperationClient.execute(OutInAxisOperation.java:260)
at org.apache.axis2.engine.UsingTransportTest.testInvalidTransport(UsingTransportTest.java:159)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:615)
at junit.framework.TestCase.runTest(TestCase.java:164)
at junit.framework.TestCase.runBare(TestCase.java:130)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:120)
at junit.framework.TestSuite.runTest(TestSuite.java:230)
at junit.framework.TestSuite.run(TestSuite.java:225)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.extensions.TestSetup.run(TestSetup.java:25)
at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:297)
at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:672)
at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:567)
axis2-jaxbri module does not compile
I built the axis2_branch source with the following command.
maven clean dist-bin -Dmaven.test.skip -o
There I found that the axis2-jaxbri module is not get compiled. As a result of this the axis2-jaxbri.jar file is not added to the release. Even jaxb runtime classes are not added.
The &quot;POJO guide&quot; page has several problems
On the &quot;Pojo guide&quot; (http://ws.apache.org/axis2/1_1/pojoguide.html), in the code listings 4, 5 and 6 there seems to be some text missing. Also it says &quot;The most interesting code to note is in bold font.&quot;, but nothing is in bold in the listings.
POJO client call failed with &quot;Unexpected subelement&quot;
I created stub by WSDL2JAVA tool, and call that service.
Client program failed with &quot;Unexpected subelement&quot;.
I think mismatch of javabeans' namespace is an issue.
Top level element of javabeans should belongs to parent's namespace, should not ?
&lt;I generated stub like this&gt;
C:\work&gt;%AXIS2_HOME%\bin\wsdl2java -uri http://localhost:8080/axis2/services/TestPojoService?wsdl -o test
Using AXIS2_HOME: C:\work\axis2-1.1
Using JAVA_HOME: C:\j2sdk1.4.2_04
C:\work&gt;
&lt;stack trace&gt;
java.lang.RuntimeException: java.lang.RuntimeException: Unexpected subelement ret20
at myservice.service.TestPojoServiceStub.fromOM(TestPojoServiceStub.java:14552)
at myservice.service.TestPojoServiceStub.getBean(TestPojoServiceStub.java:152)
at TestClient.main(TestClient.java:15)
Caused by: java.lang.RuntimeException: Unexpected subelement ret20
at myservice.service.TestPojoServiceStub$DataBean1$Factory.parse(TestPojoServiceStub.java:9455)
at myservice.service.TestPojoServiceStub$GetBeanResponse$Factory.parse(TestPojoServiceStub.java:4570)
at myservice.service.TestPojoServiceStub.fromOM(TestPojoServiceStub.java:14546)
... 2 more
Exception in thread &quot;main&quot; 
POJO service with NULL array causes NPE
I created POJO test service.
Response javabeans contains simple type and its arrays.
Also nested javabeans and its arrays are included
If all elements are filled, this works fine.
You can see this by REST call.
http://localhost:8080/axis2/rest/TestPojoService/getBean?inParam=1
But, elements not set and NULL, this causes NPE.
You can see this by REST call.
http://localhost:8080/axis2/rest/TestPojoService/getBean?inParam=0
&lt;stack trace&gt;
2006/11/18 14:59:38 org.apache.axis2.rpc.receivers.RPCMessageReceiver invokeBusinessLogic
: Exception occurred while trying to invoke service method getBean
java.lang.NullPointerException
at java.lang.reflect.Array.getLength(Native Method)
at org.apache.axis2.databinding.utils.BeanUtil.getPullParser(BeanUtil.java:120)
at org.apache.axis2.rpc.receivers.RPCUtil.processResponse(RPCUtil.java:90)
at org.apache.axis2.rpc.receivers.RPCUtil.processResponse(RPCUtil.java:192)
at org.apache.axis2.rpc.receivers.RPCMessageReceiver.invokeBusinessLogic(RPCMessageReceiver.java:136)
at org.apache.axis2.receivers.AbstractInOutSyncMessageReceiver.receive(AbstractInOutSyncMessageReceiver.java:39)
at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:493)
at org.apache.axis2.transport.http.util.RESTUtil.invokeAxisEngine(RESTUtil.java:153)
at org.apache.axis2.transport.http.util.RESTUtil.processGetRequest(RESTUtil.java:143)
at org.apache.axis2.transport.http.AxisRESTServlet.doGet(AxisRESTServlet.java:45)
...
Answer missing on the FAQ page
On the FAQ page (http://ws.apache.org/axis2/faq.html), the second question (&quot;What is OMElement, What does it represents?&quot;) doesn't have an answer. 
Also it should be &quot;what does it represent&quot;, not &quot;represents&quot;.
Null pointer in RPCMessageReceiver. invokeBusinessLogic when QName is null for outAxisMessage when returning from void web service call.
Issue is logged as Major for now, but soon (1-2 months) we will go into production with this so this may become a Blocker for us. We need the ability to create web service API methods which do not return a value.
Description:
Simple Logout web service API method simply disconnects an application session and then experiences a null pointer exception when returning back through Axis layer. The Logout methout has no return value(void).
Exception occurs on outaxismessage.getElementQName().getNamespaceURI() call because the element QName is null (RPCMessageReceiver. invokeBusinessLogic ).
AxisMessage outaxisMessage = op.getMessage(WSDLConstants.MESSAGE_LABEL_OUT_VALUE);
if (inAxisMessage != null) {
messageNameSpace = outaxisMessage.getElementQName().getNamespaceURI(); //null pointer
}
Earlier in the method, inaxisMessage.getElementQName is checked for a null value, leading me to believe that the listed code is in error.
Using Eclipse in debug mode, I skipped the offending code, and the operation finished with no error, leading me to believe that a simple check for null would work. Also, when I added a String return value to the method everything worked fine.
Web Service method signature is: 
public void logout(String sessionState) throws Exception;
...and no value is returned.
WSDL of the full Web Service follows. Logout is the method which causes the exception. Logout2 is the the exact same method with a String return value, which has no problem.
==============Start WSDL==========================
&lt;wsdl:definitions xmlns:axis2=&quot;http://ws.apache.org/axis2&quot; xmlns:mime=&quot;http://schemas.xmlsoap.org/wsdl/mime/&quot; xmlns:ns0=&quot;http://ws.apache.org/axis2/xsd&quot; xmlns:soap12=&quot;http://schemas.xmlsoap.org/wsdl/soap12/&quot; xmlns:http=&quot;http://schemas.xmlsoap.org/wsdl/http/&quot; xmlns:ns1=&quot;http://org.apache.axis2/xsd&quot; xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot; xmlns:wsdl=&quot;http://schemas.xmlsoap.org/wsdl/&quot; targetNamespace=&quot;http://ws.apache.org/axis2&quot;&gt;&lt;wsdl:documentation&gt;WusfDemo&lt;/wsdl:documentation&gt;&lt;wsdl:types&gt;&lt;xs:schema xmlns:ns=&quot;http://ws.apache.org/axis2/xsd&quot; attributeFormDefault=&quot;qualified&quot; elementFormDefault=&quot;qualified&quot; targetNamespace=&quot;http://ws.apache.org/axis2/xsd&quot;&gt;
&lt;xs:element name=&quot;executeReportAsGraphFault&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;executeReportAsGraphFault&quot; type=&quot;xs:anyType&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;executeReportAsGraph&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;sessionState&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;reportName&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;reportID&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;resultFlags&quot; nillable=&quot;true&quot; type=&quot;xs:int&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;executeReportAsGraphResponse&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;return&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;executeReportAsGridFault&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;executeReportAsGridFault&quot; type=&quot;xs:anyType&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;executeReportAsGrid&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;sessionState&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;reportName&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;reportID&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;resultFlags&quot; nillable=&quot;true&quot; type=&quot;xs:int&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;executeReportAsGridResponse&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;return&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;loginFault&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;loginFault&quot; type=&quot;xs:anyType&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;login&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;serverName&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;projectName&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;userName&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;xs:element name=&quot;password&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;loginResponse&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;return&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;logout2Fault&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;logout2Fault&quot; type=&quot;xs:anyType&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;logout2&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;sessionState&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;logout2Response&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;return&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;logoutFault&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;logoutFault&quot; type=&quot;xs:anyType&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;logout&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;sessionState&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot; /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;/xs:schema&gt;&lt;/wsdl:types&gt;&lt;wsdl:message name=&quot;executeReportAsGridMessage&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:executeReportAsGrid&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;executeReportAsGridResponse&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:executeReportAsGridResponse&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;executeReportAsGridFault&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:executeReportAsGridFault&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;loginMessage&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:login&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;loginResponse&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:loginResponse&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;loginFault&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:loginFault&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;logout2Message&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:logout2&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;logout2Response&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:logout2Response&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;logout2Fault&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:logout2Fault&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;executeReportAsGraphMessage&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:executeReportAsGraph&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;executeReportAsGraphResponse&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:executeReportAsGraphResponse&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;executeReportAsGraphFault&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:executeReportAsGraphFault&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;logoutMessage&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:logout&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:message name=&quot;logoutResponse&quot; /&gt;&lt;wsdl:message name=&quot;logoutFault&quot;&gt;&lt;wsdl:part name=&quot;part1&quot; element=&quot;ns0:logoutFault&quot; /&gt;&lt;/wsdl:message&gt;&lt;wsdl:portType name=&quot;WusfDemoPortType&quot;&gt;&lt;wsdl:operation name=&quot;executeReportAsGrid&quot;&gt;&lt;wsdl:input xmlns:wsaw=&quot;http://www.w3.org/2006/05/addressing/wsdl&quot; message=&quot;axis2:executeReportAsGridMessage&quot; wsaw:Action=&quot;urn:executeReportAsGrid&quot; /&gt;&lt;wsdl:output message=&quot;axis2:executeReportAsGridResponse&quot; /&gt;&lt;wsdl:fault message=&quot;axis2:executeReportAsGridFault&quot; name=&quot;executeReportAsGridFault&quot; /&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;login&quot;&gt;&lt;wsdl:input xmlns:wsaw=&quot;http://www.w3.org/2006/05/addressing/wsdl&quot; message=&quot;axis2:loginMessage&quot; wsaw:Action=&quot;urn:login&quot; /&gt;&lt;wsdl:output message=&quot;axis2:loginResponse&quot; /&gt;&lt;wsdl:fault message=&quot;axis2:loginFault&quot; name=&quot;loginFault&quot; /&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;logout2&quot;&gt;&lt;wsdl:input xmlns:wsaw=&quot;http://www.w3.org/2006/05/addressing/wsdl&quot; message=&quot;axis2:logout2Message&quot; wsaw:Action=&quot;urn:logout2&quot; /&gt;&lt;wsdl:output message=&quot;axis2:logout2Response&quot; /&gt;&lt;wsdl:fault message=&quot;axis2:logout2Fault&quot; name=&quot;logout2Fault&quot; /&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;executeReportAsGraph&quot;&gt;&lt;wsdl:input xmlns:wsaw=&quot;http://www.w3.org/2006/05/addressing/wsdl&quot; message=&quot;axis2:executeReportAsGraphMessage&quot; wsaw:Action=&quot;urn:executeReportAsGraph&quot; /&gt;&lt;wsdl:output message=&quot;axis2:executeReportAsGraphResponse&quot; /&gt;&lt;wsdl:fault message=&quot;axis2:executeReportAsGraphFault&quot; name=&quot;executeReportAsGraphFault&quot; /&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;logout&quot;&gt;&lt;wsdl:input xmlns:wsaw=&quot;http://www.w3.org/2006/05/addressing/wsdl&quot; message=&quot;axis2:logoutMessage&quot; wsaw:Action=&quot;urn:logout&quot; /&gt;&lt;wsdl:output message=&quot;axis2:logoutResponse&quot; /&gt;&lt;wsdl:fault message=&quot;axis2:logoutFault&quot; name=&quot;logoutFault&quot; /&gt;&lt;/wsdl:operation&gt;&lt;/wsdl:portType&gt;&lt;wsdl:binding name=&quot;WusfDemoSOAP11Binding&quot; type=&quot;axis2:WusfDemoPortType&quot;&gt;&lt;soap:binding transport=&quot;http://schemas.xmlsoap.org/soap/http&quot; style=&quot;document&quot; /&gt;&lt;wsdl:operation name=&quot;executeReportAsGrid&quot;&gt;&lt;soap:operation soapAction=&quot;urn:executeReportAsGrid&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;executeReportAsGridFault&quot;&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;login&quot;&gt;&lt;soap:operation soapAction=&quot;urn:login&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;loginFault&quot;&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;logout2&quot;&gt;&lt;soap:operation soapAction=&quot;urn:logout2&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;logout2Fault&quot;&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;executeReportAsGraph&quot;&gt;&lt;soap:operation soapAction=&quot;urn:executeReportAsGraph&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;executeReportAsGraphFault&quot;&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;logout&quot;&gt;&lt;soap:operation soapAction=&quot;urn:logout&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;logoutFault&quot;&gt;&lt;soap:body use=&quot;literal&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;/wsdl:binding&gt;&lt;wsdl:binding name=&quot;WusfDemoSOAP12Binding&quot; type=&quot;axis2:WusfDemoPortType&quot;&gt;&lt;soap12:binding transport=&quot;http://schemas.xmlsoap.org/soap/http&quot; style=&quot;document&quot; /&gt;&lt;wsdl:operation name=&quot;executeReportAsGrid&quot;&gt;&lt;soap12:operation soapAction=&quot;urn:executeReportAsGrid&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;executeReportAsGridFault&quot;&gt;&lt;soap12:fault use=&quot;literal&quot; name=&quot;executeReportAsGridFault&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;login&quot;&gt;&lt;soap12:operation soapAction=&quot;urn:login&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;loginFault&quot;&gt;&lt;soap12:fault use=&quot;literal&quot; name=&quot;loginFault&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;logout2&quot;&gt;&lt;soap12:operation soapAction=&quot;urn:logout2&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;logout2Fault&quot;&gt;&lt;soap12:fault use=&quot;literal&quot; name=&quot;logout2Fault&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;executeReportAsGraph&quot;&gt;&lt;soap12:operation soapAction=&quot;urn:executeReportAsGraph&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;executeReportAsGraphFault&quot;&gt;&lt;soap12:fault use=&quot;literal&quot; name=&quot;executeReportAsGraphFault&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;logout&quot;&gt;&lt;soap12:operation soapAction=&quot;urn:logout&quot; style=&quot;document&quot; /&gt;&lt;wsdl:input&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;soap12:body use=&quot;literal&quot; /&gt;&lt;/wsdl:output&gt;&lt;wsdl:fault name=&quot;logoutFault&quot;&gt;&lt;soap12:fault use=&quot;literal&quot; name=&quot;logoutFault&quot; /&gt;&lt;/wsdl:fault&gt;&lt;/wsdl:operation&gt;&lt;/wsdl:binding&gt;&lt;wsdl:binding name=&quot;WusfDemoHttpBinding&quot; type=&quot;axis2:WusfDemoPortType&quot;&gt;&lt;http:binding verb=&quot;POST&quot; /&gt;&lt;wsdl:operation name=&quot;executeReportAsGrid&quot;&gt;&lt;http:operation location=&quot;executeReportAsGrid&quot; /&gt;&lt;wsdl:input&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:output&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;login&quot;&gt;&lt;http:operation location=&quot;login&quot; /&gt;&lt;wsdl:input&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:output&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;logout2&quot;&gt;&lt;http:operation location=&quot;logout2&quot; /&gt;&lt;wsdl:input&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:output&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;executeReportAsGraph&quot;&gt;&lt;http:operation location=&quot;executeReportAsGraph&quot; /&gt;&lt;wsdl:input&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:output&gt;&lt;/wsdl:operation&gt;&lt;wsdl:operation name=&quot;logout&quot;&gt;&lt;http:operation location=&quot;logout&quot; /&gt;&lt;wsdl:input&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:input&gt;&lt;wsdl:output&gt;&lt;mime:content type=&quot;text/xml&quot; /&gt;&lt;/wsdl:output&gt;&lt;/wsdl:operation&gt;&lt;/wsdl:binding&gt;&lt;wsdl:service name=&quot;WusfDemo&quot;&gt;&lt;wsdl:port name=&quot;WusfDemoSOAP11port_http&quot; binding=&quot;axis2:WusfDemoSOAP11Binding&quot;&gt;&lt;soap:address location=&quot;http://localhost:8080/axis2/services/WusfDemo&quot; /&gt;&lt;/wsdl:port&gt;&lt;wsdl:port name=&quot;WusfDemoSOAP12port_http&quot; binding=&quot;axis2:WusfDemoSOAP12Binding&quot;&gt;&lt;soap12:address location=&quot;http://localhost:8080/axis2/services/WusfDemo&quot; /&gt;&lt;/wsdl:port&gt;&lt;wsdl:port name=&quot;WusfDemoHttpport1&quot; binding=&quot;axis2:WusfDemoHttpBinding&quot;&gt;&lt;http:address location=&quot;http://localhost:8080/axis2/rest/WusfDemo&quot; /&gt;&lt;/wsdl:port&gt;&lt;/wsdl:service&gt;&lt;/wsdl:definitions&gt;
=====================end WSDL==================
SimpleAxis2 server does not call ListerManager.stop();
When I run the axis2Srever.bat or .sh it call LM.start method , but t does not call stop method of that. This cause problems for service life cycle and modules which need to save its states at the system shutdown time.
Problem can be easily solved by adding shutdown hook.
Changes done in the Axis2 reference guide
Added -wv option to the reference guide. A patch is attached here with.
Incoming SOAPFault on client side flows though InFlow *and* InFaultFlow
I created a module with a simple log handler that just logs a message. Using a client repository, I engaged this module globally for my client application. For testing purposes the handler was configured to be included into InFlow (PreDispatch), OutFlow (MessageOut), InFaultFlow (PreDispatch) and OutFaultFlow (MessageOut).
When the client application receives a SOAP fault from a service, two log handlers are invoked: the handler in InFlow and the handler in InFaultFlow, i.e. incoming SOAP faults flow through both flows on the client side. It is my understanding that incoming messages containing faults should flow through InFaultFlow *only*, but not through InFlow.
When engaging a module with a service, the module is engaged with each operation twice
Not sure about the priority of this bug, but I think it might be critical...
I created a module that contains a module class. For testing purposes, method engageNotify log a message every time it is invoked. The logging message provides information about the kind of engagement. When I use the admin frontend to engage the module with a service, the logging messages indicate that the module is engaged twice with every service operation (engageNotify invoked twice per operation):
LogModule was engaged with service: MyService
LogModule was engaged with operation: Op1
LogModule was engaged with operation: Op1
LogModule was engaged with operation: Op2
LogModule was engaged with operation: Op2
LogModule was engaged with operation: Op3
LogModule was engaged with operation: Op3
LogModule was engaged with operation: Op4
LogModule was engaged with operation: Op4
Here's the implementation of engageNotify:
public void engageNotify(AxisDescription axisDescription) throws AxisFault {
StringBuilder msg = new StringBuilder();
msg.append(&quot;LogModule was engaged with&quot;);
if (axisDescription instanceof AxisServiceGroup) {
msg.append(&quot; service group: &quot;);
msg.append(((AxisServiceGroup)axisDescription).getServiceGroupName());
} else if (axisDescription instanceof AxisService) {
msg.append(&quot; service: &quot;);
msg.append(((AxisService)axisDescription).getName());
} else if (axisDescription instanceof AxisOperation) {
msg.append(&quot; operation: &quot;);
msg.append(((AxisOperation)axisDescription).getName());
}
System.out.println(msg);
}
Axis2 WAR distribution needs to start listed transports on initialization (similarly to the standalone dist)
Axis2 WAR distribution needs to start listed transports on initialization (similarly to the standalone dist)
Axis2 has been recently updated to start all listed transports during initialization. This has been done already for the standalone dist, but needs to be fixed for WAR. Else, other transports such as JMS etc cannot be started/used
OutInAxisOperation invokes the InFlow and InFaultFlow when a fault is received in a response
OutInAxisOperation invokes the InFlow for all response messages, even if that response is a fault. See the discussion at http://marc.theaimsgroup.com/?l=axis-dev&amp;m=115835375100509&amp;w=2 for more details.
Use of Application Scope Mandates the specification of &quot;ServiceClass&quot; parameter in services.xml
When we use Application Scope as the scope of a deploying service Axis2 mandates the specifying of &quot;ServiceClass&quot; parameter in services.xml. Axis2 checks for that explicitly and If it's not found throws an exception.
This is gives lot of inconvenience when some body is extending Axis2 using his own message receiver. One example is a service composition scenario like an BPEL engine, which uses it's own message receiver.
Code Generator Wizard: namespace-package mapping is not editable
After selecting &quot;Generate Java from WSDL&quot; and the corresponding WSDL file, the table with the namespace-package mappings is not editable.
Besides, the selection box for databindings contains only ADB and XML Beans. The other supported databinding are missing.
Handler method &quot;cleanup&quot; is never called
1) My IDE couldn't find any references to method &quot;cleanup&quot; in the Axis2 source code. It's never called...
2) What happens if the handler's invoke method thows a fault? Javadoc for &quot;invoke&quot; says that &quot;onFault&quot; would be called. But there is no such method...
3) User guide, page 4 
- mentions a method called &quot;revoke&quot;. There is no such method in interface Handler. 
- refers to green lines in sample configuration...there are no green lines
- sample configuration contains mistakes
A SOAP 1.2 SWARef Message is denied
A SOAP 1.2 Message with a SWARef attachment is denied.
I have a patch to accept the SOAP 1.2 content-type &quot;application/soap+xml&quot;
Axiom NPE
NPE occurs when trying to add a non-qualified attribute's namespace to Map. Similar to another problem I fixed.
Caused by: java.lang.NullPointerException
at org.apache.axiom.om.impl.llom.OMStAXWrapper.addNamespaceToMap(OMStAXWrapper.java:1300);
at org.apache.axiom.om.impl.llom.OMStAXWrapper.getAllNamespaces(OMStAXWrapper.java:1293);
at org.apache.axiom.om.impl.llom.OMStAXWrapper.getNamespaceContext(OMStAXWrapper.java:1023);
Axiom should default to 'true'/'false' for SOAP 1.2 mustUnderstand per the SOAP 1.2 spec
The SOAP 1.2 spec states [1]:
If generating a SOAP mustUnderstand attribute information item, a SOAP sender SHOULD use the canonical representation &quot;true&quot; of the attribute value
The current Axiom implementation defaults instead to using 1 and 0. This occurs in SOAP12HeaderBlockImpl.setMustUnderstand(boolean)
This should be changed to use &quot;true&quot; and &quot;false&quot; and let those who want to use &quot;1&quot; and &quot;0&quot; use setMustUnderstand(String)
[1] http://www.w3.org/TR/soap12-part1/#soapmu
OMSourcedElementImpl serialize() violates OMNode.serialize()
The OMNode serialize method indicates that the OM is cached.
/**
* Serializes the node with caching.
* 
* @param xmlWriter
* @throws XMLStreamException
*/
public void serialize(XMLStreamWriter xmlWriter) throws XMLStreamException;
But OMSourcedElementImpl consumes the message. This results in errors when an OM tree contains a mixture of normal nodes and OMSourcedElements. 
The solution is to change OMSourcedElement to respect the OMNode &quot;serialize&quot; contracts.
I am working on a patch containing the corrected code and validation tests.
CMSException::what returns c_str of temporary std::string
In my debugging to figure out what's going on with AMQCPP-59, I'm sometimes seeing invalid stuff getting printed out when I do printStackTrace on some exceptions. I think this might be because CMSException::what returns getMessage().c_str(), i.e. it seems to be returning the c_str of a std::string that is allocated on the stack, since getMessage returns std::string.
An example of where what() is being called that seems to be causing problems is on line 84 of ActiveMQConsumer.cpp. When I catch this exception later on and print its stack trace or call its getMessage, I get garbage.
Exception is thrown when destroying consumer after connection failure
Brought over from AMQCPP-46.
In a program that reconnects when it detects a connection failure using an exception listener, there seem to be two different places where exceptions can originate.
In most cases when I shut down the broker and the exception listener fires properly and I can clean up everything (without deletes throwing exceptions), the stack trace that gets printed on the console looks like this:
{noformat}
WARNING: activemq::io::SocketInputStream::read - The connection is broken
FILE: ..\src\main\activemq\network\SocketInputStream.cpp, LINE: 137
FILE: ..\src\main\activemq\io\BufferedInputStream.cpp, LINE: 199
FILE: ..\src\main\activemq\io\BufferedInputStream.cpp, LINE: 83
FILE: ..\src\main\activemq\connector\stomp\StompCommandReader.cpp, LINE: 216
FILE: ..\src\main\activemq\connector\stomp\StompCommandReader.cpp, LINE: 120
FILE: ..\src\main\activemq\connector\stomp\StompCommandReader.cpp, LINE: 71
FILE: ..\src\main\activemq\transport\IOTransport.cpp, LINE: 175
{noformat}
The message is printed twice with different tids, from the two threads that are active.
Sometimes when I shut down the broker and the exception handler fires and I clean up everything but then the consumer's destructor throws an exception. In that case, the stack trace that is printed looks like this:
{noformat}
WARNING: activemq::io::SocketInputStream::read - An existing connection was forcibly closed by the remote host.
FILE: ..\src\main\activemq\network\SocketInputStream.cpp, LINE: 145
FILE: ..\src\main\activemq\io\BufferedInputStream.cpp, LINE: 199
FILE: ..\src\main\activemq\io\BufferedInputStream.cpp, LINE: 83
FILE: ..\src\main\activemq\connector\stomp\StompCommandReader.cpp, LINE: 216
FILE: ..\src\main\activemq\connector\stomp\StompCommandReader.cpp, LINE: 120
FILE: ..\src\main\activemq\connector\stomp\StompCommandReader.cpp, LINE: 71
FILE: ..\src\main\activemq\transport\IOTransport.cpp, LINE: 175
{noformat}
Again I see this message from both threads. Note the slightly different line numbers in SocketInputStream.cpp and the slighty different error message (this is on Windows XP SP2). In this case the failure of the socket is probably being detected in a slightly different place.
If the socket failure happens in the second way, it seems that destructors of consumers (and possibly producers and sessions) don't properly catch the exception when being destroying, causing their destructors to throw an exception, which isn't what we want.
GCC warnings and possible SocketFactory bug on 64-bit Linux
When compiling on 64-bit Linux with GCC 4.0.3, I see the following warnings:
{noformat}
activemq/concurrent/PooledThread.cpp:56: warning: 'task$first' may be used uninitialized in this function
activemq/concurrent/PooledThread.cpp:56: warning: 'task$second' may be used uninitialized in this function
activemq/network/SocketFactory.cpp:46: warning: comparison is always false due to limited range of data type
activemq/connector/openwire/marshal/v2/ConnectionControlMarshaller.cpp:82: warning: unused variable 'info'
activemq/connector/openwire/marshal/v2/IntegerResponseMarshaller.cpp:60: warning: unused variable 'info'
activemq/connector/openwire/marshal/v2/ReplayCommandMarshaller.cpp:61: warning: unused variable 'info'
activemq/connector/openwire/marshal/v2/ResponseMarshaller.cpp:60: warning: unused variable 'info'
{noformat}
The first three warnings probably need to be looked at, especially the one in SocketFactory.
In my opinion, AMQCPP is using ints and unsigned ints in places where std::size_t might be more appropriate. MSVC's warning level 3 catches many of these issues, so we might consider upping the warning level and properly dealing with the type conversion issues: mostly use std::size_t and static_cast where we really intend to convert. I can prepare a few patches along these lines if you think this is worthwhile.
Build broken due to autoconf problem?
Running autogen.sh gives:
src/test-integration/Makefile.am:34: `CXXFLAGS' is a user variable, you should not override it;
src/test-integration/Makefile.am:34: use `AM_CXXFLAGS' instead.
src/test/Makefile.am:88: `CXXFLAGS' is a user variable, you should not override it;
src/test/Makefile.am:88: use `AM_CXXFLAGS' instead.
Declaration of extern int errno after including errno.h doesn't compile
A few places in AMQCPP declare extern int errno after includes errno.h. This fails to compile on Fedora Core 4 and Fedora Core 6 with the following error:
{noformat}
activemq/concurrent/Thread.cpp:23: error: declaration of 'int* __errno_location()' throws different exceptions
/usr/include/bits/errno.h:38: error: than previous declaration 'int* __errno_location() throw ()'
{noformat}
As far as I know, including errno.h should be sufficient -- the extra declaration of errno is unnecessary. However, maybe you know of some older platforms where it has to be declared explicitly, even after the header has been included?
The places in the library where this issue crops up are:
* src/main/activemq/concurrent/Thread.cpp
* src/main/activemq/network/SocketError.cpp
Valgrind reports memory leaks when running PrimitiveMapTest
Valgrind reports the following leaks when running PrimitiveMapTest from r499127.
==30238== 16 (12 direct, 4 indirect) bytes in 1 blocks are definitely lost in loss record 6 of 11
==30238== at 0x4005BA5: operator new(unsigned) (vg_replace_malloc.c:163)
==30238== by 0x8173256: activemq::util::PrimitiveMapTest::testValueNode() (PrimitiveMap.h:311)
...
==30238== by 0x818EE36: main (main.cpp:34)
----
==30238== 50 (36 direct, 14 indirect) bytes in 3 blocks are definitely lost in loss record 7 of 11
==30238== at 0x4005BA5: operator new(unsigned) (vg_replace_malloc.c:163)
==30238== by 0x81CD009: activemq::util::PrimitiveMap::setByteArray(std::string const&amp;, std::vector&lt;unsigned char, std::allocator&lt;unsigned char&gt; &gt; const&amp;) (PrimitiveMap.h:311)
==30238== by 0x80FC6CB: activemq::connector::openwire::marshal::PrimitiveMapMarshallerTest::test() (PrimitiveMapMarshallerTest.cpp:65)
==30238== by 0x4B6706: CppUnit::TestCaseMethodFunctor::operator()() const (in /usr/lib/libcppunit-1.12.so.0.0.0)
...
==30238== by 0x818EE36: main (main.cpp:34)
----
==30238== 50 (36 direct, 14 indirect) bytes in 3 blocks are definitely lost in loss record 8 of 11
==30238== at 0x4005BA5: operator new(unsigned) (vg_replace_malloc.c:163)
==30238== by 0x81CD176: activemq::util::PrimitiveMap::setByteArray(std::string const&amp;, std::vector&lt;unsigned char, std::allocator&lt;unsigned char&gt; &gt; const&amp;) (PrimitiveMap.h:110)
==30238== by 0x80FC6CB: activemq::connector::openwire::marshal::PrimitiveMapMarshallerTest::test() (PrimitiveMapMarshallerTest.cpp:65)
==30238== by 0x4B6706: CppUnit::TestCaseMethodFunctor::operator()() const (in /usr/lib/libcppunit-1.12.so.0.0.0)
...
==30238== by 0x818EE36: main (main.cpp:34)
----
==30238== 50 (36 direct, 14 indirect) bytes in 3 blocks are definitely lost in loss record 9 of 11
==30238== at 0x4005BA5: operator new(unsigned) (vg_replace_malloc.c:163)
==30238== by 0x81CEEFF: activemq::util::Map&lt;std::string, activemq::util::PrimitiveMap::ValueNode&gt;::setValue(std::string const&amp;, activemq::util::PrimitiveMap::ValueNode) (PrimitiveMap.h:110)
==30238== by 0x81CD0BE: activemq::util::PrimitiveMap::setByteArray(std::string const&amp;, std::vector&lt;unsigned char, std::allocator&lt;unsigned char&gt; &gt; const&amp;) (PrimitiveMap.cpp:218)
==30238== by 0x80FC6CB: activemq::connector::openwire::marshal::PrimitiveMapMarshallerTest::test() (PrimitiveMapMarshallerTest.cpp:65)
==30238== by 0x4B6706: CppUnit::TestCaseMethodFunctor::operator()() const (in /usr/lib/libcppunit-1.12.so.0.0.0)
...
==30238== by 0x818EE36: main (main.cpp:34)
----
==30238== 50 (36 direct, 14 indirect) bytes in 3 blocks are definitely lost in loss record 10 of 11
==30238== at 0x4005BA5: operator new(unsigned) (vg_replace_malloc.c:163)
==30238== by 0x81CE182: activemq::util::Map&lt;std::string, activemq::util::PrimitiveMap::ValueNode&gt;::getValue(std::string const&amp;) const (PrimitiveMap.h:110)
==30238== by 0x81CBAB2: activemq::util::PrimitiveMap::getValue(std::string const&amp;) const (PrimitiveMap.cpp:242)
==30238== by 0x81C00B4: activemq::connector::openwire::marshal::PrimitiveMapMarshaller::marshal(activemq::util::PrimitiveMap const*, std::vector&lt;unsigned char, std::allocator&lt;unsigned char&gt; &gt;&amp;) (PrimitiveMapMarshaller.cpp:59)
==30238== by 0x80FC717: activemq::connector::openwire::marshal::PrimitiveMapMarshallerTest::test() (PrimitiveMapMarshallerTest.cpp:70)
==30238== by 0x4B6706: CppUnit::TestCaseMethodFunctor::operator()() const (in /usr/lib/libcppunit-1.12.so.0.0.0)
...
==30238== by 0x4C4724: CppUnit::TextTestRunner::run(std::string, bool, bool, bool) (in /usr/lib/libcppunit-1.12.so.0.0.0)
ActiveMQConnection doesn't propagate exception listener to underlying connector
My program is doing the following:
# Create connection using ActiveMQConnectionFactory
# Set a simple exception listener that sets a boolean flag
# Block in receive on consumer
If I then kill the broker, various exceptions happen, but they are never sent to the exception listener, because the exception listener in StompConnector is null. It seems to me that ActiveMQConnection should set and get its exception listener on its underlying connector and probably doesn't have to contain a pointer to the listener itself.
If I change ActiveMQConnection as in the attached patch to also set the exception listener on the underlying connector, my exception listener gets called when the broker dies.
Once I detect the failure, I delete the producer, consumer, session and connection that failed. Looks like an uncaught exception is getting thrown during the destruction of the producer (which is the first thing I delete when cleaning up). The problem here is probably that the connection is trying to close down a socket that is already broken and something goes awry. I'm not quite sure how to fix this problem.
Stack trace (with useless bits stripped out):
{noformat}
kernel32.dll!7c812a5b() 
[Frames below may be incorrect and/or missing, no symbols loaded for kernel32.dll] 
kernel32.dll!7c812a5b() 
&gt; myapp.exe!std::vector&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt;,std::allocator&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; &gt; &gt;::_Ucopy&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; *&gt;(std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; * _First=(&quot;..\src\main\activemq\connector\stomp\StompSessionManager.cpp&quot;,254), std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; * _Last=(&lt;Bad Ptr&gt;,14297048), std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; * _Ptr=(&quot;..\src\main\activemq\connector\stomp\StompSessionManager.cpp&quot;,254)) Line 1105 + 0x18 bytes C++
myapp.exe!std::vector&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt;,std::allocator&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; &gt; &gt;::operator=(const std::vector&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt;,std::allocator&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; &gt; &gt; &amp; _Right={...}) Line 582 + 0x1d bytes C++
0012b920() 
myapp.exe!activemq::core::ActiveMQConsumer::close() Line 84 + 0x34 bytes C++
msvcr80d.dll!102418b7() 
... 
kernel32.dll!7c812a5b() 
myapp.exe!std::vector&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt;,std::allocator&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; &gt; &gt;::_Ucopy&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; *&gt;(std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; * _First=(&lt;Bad Ptr&gt;,-17891602), std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; * _Last=(&lt;Bad Ptr&gt;,-17891602), std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; * _Ptr=(&lt;Bad Ptr&gt;,1886220148)) Line 1105 + 0x18 bytes C++
myapp!std::vector&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt;,std::allocator&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; &gt; &gt;::operator=(const std::vector&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt;,std::allocator&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; &gt; &gt; &amp; _Right={...}) Line 582 + 0x1d bytes C++
0012bf74() 
myapp.exe!activemq::core::ActiveMQSession::onDestroySessionResource(activemq::core::ActiveMQSessionResource * resource=0x00000001) Line 558 + 0x37 bytes C++
msvcr80d.dll!10241a10() 
... 
kernel32.dll!7c812a5b() 
myapp.exe!std::vector&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt;,std::allocator&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; &gt; &gt;::_Ucopy&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; *&gt;(std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; * _First=(&lt;Bad Ptr&gt;,1886220148), std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; * _Last=(&lt;Bad Ptr&gt;,-17891602), std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; * _Ptr=(&quot;&lt;&lt;U&quot;,4832632)) Line 1105 + 0x18 bytes C++
myapp.exe!std::vector&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt;,std::allocator&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; &gt; &gt;::operator=(const std::vector&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt;,std::allocator&lt;std::pair&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;,int&gt; &gt; &gt; &amp; _Right={...}) Line 582 + 0x1d bytes C++
{noformat}
Reason for socket errors not reported correctly on Windows
Socket errors aren't reported correctly on Windows. When the broker is down and the TcpTransport fails to connect, I get an exception saying &quot;Socket::connect - No error&quot;. strerror of errno might not be the right way to get the error description for socket errors on Windows. Maybe one needs to look at what WSAGetLastError returns, but I'm not sure.
Crash when getting string property that doesn't exist
In the case when one calls getStringProperty for a property that doesn't exist, a crash occurs because SimpleProperties returns NULL. I think it should return &quot;&quot;.
Test code on Linux:
{noformat}
#include &lt;string&gt;
int main(int argc, char* argv)
{
std::string str(0);
return 0;
}
{noformat}
This dies with the following when run on FC6:
{noformat}
terminate called after throwing an instance of 'std::logic_error'
what(): basic_string::_S_construct NULL not valid
Aborted
{noformat}
Proposed patch:
{noformat}
===================================================================
--- src/main/activemq/util/SimpleProperties.h (revision 495567)
+++ src/main/activemq/util/SimpleProperties.h (working copy)
@@ -55,7 +55,7 @@
std::map&lt; std::string, std::string &gt;::const_iterator iter =
properties.find( name );
if( iter == properties.end() ){
- return NULL;
+ return &quot;&quot;;
}
return iter-&gt;second.c_str();
{noformat}
Byte swap on float and double truncates values
activemq::util::Endian::byteSwap truncates float and double values due to the C-style cast it uses.
Patch for BytesMessageCommandTest is attached that shows the problem. One might consider expanding this test to check that the minimum, maximum, -1, 0, 1 (and -inf and inf where appropriate) and a few other values can successfully be serialised and deserialised for each of the types.
Also in the patch is our attempt at fixing byteSwap. You'll notice that we do something very strange: we take the argument of byteSwap and make a copy on the heap. The reason for this is that simply doing:
{noformat}
const uintxx_t swapped_val = byteSwap( *(uintxx_t*)(&amp;value) );
{noformat}
i.e. taking the address of value instead of using the copy on the heap, fails with GCC 4.0.2 and GCC 4.0.3. I'm guessing GCC might be trying to inline the call to byteSwap and then something goes very wrong when taking the address of a variable on the stack. Hopefully someone has a better idea for a workaround.
Some AMQCPP includes not installed when doing make install on Linux
On Linux with the autotools build system, it seems that some headers aren't being installed.
Patch for src/main/Makefile.am attached that fixes those that we ran into. There might be more -- maybe you want to make a script that checks that Makefile.am lists all the headers (or maybe use some kind of glob if that's possible).
Async error on broker when running integration tests
Brought over from the comments in AMQCPP-28.
Sometimes when running the integration tests against the AMQ broker from trunk, ones sees the following message from the broker:
ERROR Service - Async error occurred:
java.lang.IllegalStateException: Cannot remove a consumer that had not been registered: ID:xxx-36153-1166305227288-5:16:-1:1
at org.apache.activemq.broker.TransportConnection.processRemoveConsumer(TransportConnection.java:593)
at org.apache.activemq.command.RemoveInfo.visit(RemoveInfo.java:64)
at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:287)
at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:178)
at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:65)
at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:122)
at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:74)
at org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:119)
at org.apache.activemq.transport.stomp.ProtocolConverter.onStompUnsubscribe(ProtocolConverter.java:379)
at org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommad(ProtocolConverter.java:151)
at org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:64)
at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)
at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:137)
at java.lang.Thread.run(Thread.java:595)
Using the default activemq.xml, I can reproduce the IllegalStateException quite reliabily:
1. Start a fresh copy of the broker (4.2 from yesterday's trunk)
2. Run the integration test under Valgrind
3. IllegalStateException happens at the end of integration::durable::DurableTester::test or at the start of integration::expiration::ExpirationTest::testExpired.
Subsequent test runs don't yield the error, until the broker is restarted. I don't know if this issue could be time-dependent - if it is, it could explain why I only see it when running under Valgrind.
On Linux, I also just got the following test failure for the first time (not running under Valgrind):
1) test: integration::durable::DurableTester::test (E)
uncaught exception of unknown type
Stomp content-length header not being set on BytesMessage
Not sure if this is a bug or if I'm just doing something wrong, but here goes.
On a cms::Session I'm calling createBytesMessage and getting back a cms::BytesMessage which is an activemq::connector::stomp::commands::BytesMessageCommand underneath. On this message I set an int property and write a string using writeString. Then I send the message to my producer. At no point does it seem as if the content-length header is set in this case. I verified by checking the properties written out for this message in StompCommandWriter::writeCommand. Due to the absence of this header, when AMQCPP receives this message, it assumes it is a TextMessageCommand instead of a BytesMessageCommand.
The only way the header can get set is by something calling setBytes on the BytesMessageCommand which calls through to setBytes of AbstractCommand which sets the header. I don't think this happens when one only does a writeString.
Purify and Valgrind warnings when running integration tests
Warnings from Purify when running the integration test (latest from trunk) against latest trunk of the broker.
Issues reported by Valgrind when running unit tests
Valgrind 3.2.1 reported a few issues when running the ActiveMQ C++ unit tests.
Some of them were simple cases of mismatched new[] and delete[] (patch attached).
Valgrind also reports a few memory leaks, some probably the same as found by Rational Purify.
Complete Valgrind log attached (after I fixed the deletes). I ran Valgrind as follows:
valgrind \
--tool=memcheck \
--leak-check=yes \
--error-limit=no \
--num-callers=20 \
--freelist-vol=536870912 \
-v \
./activemq-test
Bus error on Solaris OS from DataInput and DataOutput streams
Due to misaligned memory reads, there is a bus error that can occur in using the new DataInputStream and DataOutputStream classes.
Compression not working
When setting compression from the message producer side using the {{ActiveMQConnectionFactory.setUseCompression(true)}} method, a call to the {{ActiveMQConnectionFactory.isUseCompression()}} method then returns true. However, when using [Ethereal|http://www.ethereal.com/] to sniff the packets between brokers, the message bodies are not compressed - they're just plain text. This appears to be a bug. 
I'll try to create a test for this.
stomp connections in the broker don't get cleared up if the socket dies
it looks like there's a bug causing the connection to keep around
MySql should use LONGBLOB rather than BLOB for persisting messages to avoid the 64k limit
Deadlock in MutexTransport on shutdown with high volume of messages
I ran into a deadlock in the MutextTransport.oneway(Command command) function when processing very high message volume (100% cpu utilization) at the time of a shutdown. I'm running 4.0.2 on WinXP and within a demand forwarding environment with failover = true.
I did trap this deadlock in the debugger and it looks like two commands are crossing paths in opposite directions through the MutexTransport. One of the commands is a MessageDispatch and the other is a ShutdownInfo. Now, when the ShutdownInfo gets through the MutexTransport first, it tries to shutdown the background thread of the TcpTransport. However, this thread is currently servicing the MessageDispatch and is blocked on the MutexTransport. Deadlock.
So, my patch was simply to avoid entering the synchronized(writeMutex) block in the oneway(Command command) function of MutexTransport if
command.isShutdownInfo() returns true:
if (command.isShutdownInfo())
next.oneway(command);
else
synchronized(writeMutex) {
next.oneway(command);
}
JMS to JMS Bridge fails with Number format exception on physical name
Maybe this is just some missconfiguration from my site but ...
I'm trying to use activemq to integrate some c++ code with the j2ee world. My task is to forward messages generated on the c++ side to the JMS of Bea Weblogic 8.1. ActiveMQ is running outside the WLS in a separate process. The startup looks fine as the wls context can be used to get references to the ConnectionFactory and the configured test destination WLSTestQ. On sending a message to the local queue of the bridge i get the following stacktrace:
java.lang.NumberFormatException: For input string: &quot;WLSTESTQ&quot;
at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)
at java.lang.Integer.parseInt(Integer.java:447)
at java.lang.Integer.parseInt(Integer.java:497)
at org.apache.activemq.command.ActiveMQTempDestination.setPhysicalName(ActiveMQTempDestination.java:66)
at org.apache.activemq.command.ActiveMQDestination.&lt;init&gt;(ActiveMQDestination.java:142)
at org.apache.activemq.command.ActiveMQTempDestination.&lt;init&gt;(ActiveMQTempDestination.java:38)
at org.apache.activemq.command.ActiveMQTempQueue.&lt;init&gt;(ActiveMQTempQueue.java:36)
at org.apache.activemq.command.ActiveMQDestination.transform(ActiveMQDestination.java:107)
at org.apache.activemq.command.ActiveMQMessage.setJMSDestination(ActiveMQMessage.java:219)
at weblogic.jms.client.JMSProducer.sendInternal(JMSProducer.java:428)
at weblogic.jms.client.JMSProducer.send(JMSProducer.java:152)
at weblogic.jms.client.JMSProducer.send(JMSProducer.java:215)
at org.apache.activemq.network.jms.QueueBridge.sendMessage(QueueBridge.java:87)
at org.apache.activemq.network.jms.DestinationBridge.onMessage(DestinationBridge.java:134)
at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:840)
at org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:96)
at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:165)
at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:88)
at org.apache.activemq.thread.DedicatedTaskRunner.access$000(DedicatedTaskRunner.java:25)
at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:39)
ERROR DestinationBridge - failed to forward message on attempt: 1 
reason: java.lang.NumberFormatException: 
For input string: &quot;WLSTESTQ&quot; message: 
ActiveMQTextMessage {
commandId = 14, 
responseRequired = false, 
messageId = ID:KStanke-1523-1167310376227-0:0:1:1:10, 
originalDestination = null, 
originalTransactionId = null, 
producerId = ID:KStanke-1523-1167310376227-0:0:1:1, 
destination = queue://TEST.FOO, 
transactionId = null, 
expiration = 0, 
timestamp = 1167310385795, 
arrival = 0, 
correlationId = null, 
replyTo = null, 
persistent = false, 
type = null, 
priority = 4, 
groupID = null, 
groupSequence = 0, 
targetConsumerId = null,
compressed = false, 
userID = null, 
content = null, 
marshalledProperties = null,
dataStructure = null, 
redeliveryCounter = 0, 
size = 0, 
properties = null, 
readOnlyProperties = true, 
readOnlyBody = true, 
droppable = false, 
text = Message: 9 sent at: Thu Dec 28 13:53:05 CET 2006
[Skipped some blank lines]
}
I'm using the message producer from the example to test the routing to wls JMS. I also attached my activemq.xml configuration for you reference.
activemq-console only has limited classpath/extensions directory functionality
Reproduction:
1) Untar the binary distribution.
2) Run bin/activemq and note what logging looks like (you should see output to the console)
3) Stop the broker.
4) mv conf/log4j.properties foo/log4j.properties
5) export CLASSPATH=/path/to/foo/
6) export ACTIVEMQ_CLASSPATH=/path/to/foo/
7) Run './activemq --extdir /path/to/foo
Now note there is no log output even though there are 3 different attempts to set the proper directory. This is a regression from 4.0 to 4.1.
There are 2 root problems in Main.java. First, 'classpaths' doesn't actually pull from the classpath. The only thing that ever gets added to classpaths is the hard coded 'conf' directory. Second, directories specified with --extdir have jars and zips added, but not the directories themselves.
The attached patch totally removes the vestigial classpaths, and fixes extdir to pull in directories. This means that step 7 now works, but steps 5 and 6 are still useless. I like having only one way to specify classpath, but I could see others wanting the CLASSPATH and ACTIVEMQ_CLASSPATH settings to work.
Bug in STOMP transport unsubscribe
After several ubscribe/unsubscribe commands to activemq, subscribtions are not removed and there's error log in the broker: 
java.lang.IllegalStateException: Cannot remove a consumer that had not been registered: ID:das-32775-1164773607925-3:1881:-1:2
at org.apache.activemq.broker.AbstractConnection.processRemoveConsumer(AbstractConnection.java:551)
at org.apache.activemq.command.RemoveInfo.visit(RemoveInfo.java:64)
at org.apache.activemq.broker.AbstractConnection.service(AbstractConnection.java:237)
at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:61)
at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:92)
at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:67)
at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:123)
at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:70)
at org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:112)
at org.apache.activemq.transport.stomp.ProtocolConverter.onStompUnsubscribe(ProtocolConverter.java:376)
at org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommad(ProtocolConverter.java:144)
at org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:60)
at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:88)
at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:137)
at java.lang.Thread.run(Thread.java:595)
The problem is that there's internal map of subscriptions in ProtocolConverter class. On unsubscribe command, subscription is not removed from this internal map. Attached patch (against ProtocolConverter.java) fixes this bug
Slow consumer terminally blocks both client and broker
I have a multi-threaded client (client1) which is acting as both a publisher (Topic1) and subscriber (Topic2) using a single session. There is another client process (client2) which publishes on Topic2.
I have witnessed the following repeatable scenario where both clients get stuck, which can only be rectified by restarting the broker! :-
Client1 publishes messages to Topic1 (rate = about 30 msgs/sec).
Client2 publishes bursts of messages to Topic2 (rate = 500 msgs/sec) 
Client1 is a slow subscriber on Topic2
After running in this scenario for a couple of seconds, Client1 and Client2 become stuck. Looking at a stack trace for Client1 I can see that it's read_loop is stuck waiting for input, and it's publisher thread is stuck waiting for an acknowledgement to the synchronous message send (the acknowledgement never arrives because the broker won't sent any more messages).
Client2 is also stuck waiting for an acknowledgement to a synchronous send.
My perception is that it appears the broker is throttling the connection because the consumer is running slowly, but for some reason it gets into a state where all message flow stops (even though the consumer is automatically acknowledging messages, albeit slowly). Furthermore, if I kill Client1 the broker doesn't recover (using a JMX console the connection remains visible).
The broker uses a vanilla configuration (i.e. no policies are set for the topics in quedtion).
												</span>
							</div>
			<div>
							</div>
			<div>
									<p><strong>Find millions of documents on Course Hero - Study Guides, Lecture Notes, Reference Materials, Practice Exams and more. Course Hero has millions of course specific materials providing students with the best way to expand their education.</strong></p>
					<p>Below is a small sample set of documents:</p>
					<div><strong><a href="/file/7204792/2007-04/">2007-04</a></strong></div><div>Iowa State - CPRE - 556</div><div>IDLToWSDL incorrectly maps all typedefs to restrictions.Consider IDL like :typedef string PropertyName;typedef string PropertyValue;struct Property cfw_PropertyName name;PropertyValue value;;typedef sequence &amp;lt;Property&amp;gt; PropertyList;typedef Proper</div><div><strong><a href="/file/7204793/2007-05/">2007-05</a></strong></div><div>Iowa State - CPRE - 556</div><div>NullPointerException in CorbaDestinationI got NullPointerException in line 256 of CorbaDestinationif (location.startsWith(&amp;quot;http:/localhost/&amp;quot;) cfw_ / line 256location = location.substring(&amp;quot;http:/localhost/&amp;quot;.length();should check if location is null fi</div><div><strong><a href="/file/7204794/2007-06/">2007-06</a></strong></div><div>Iowa State - CPRE - 556</div><div>IDLToWSDL does not generate correct WSDL for certain combinations of forward declarationIDL which declares a forward declaration for an interface or struct, then provides the full declaration for the forward declared interface/struct, followed by the use</div><div><strong><a href="/file/7204795/2008-04/">2008-04</a></strong></div><div>Iowa State - CPRE - 556</div><div>Increase the number of open files for unit tests under HudsonLucene.zones.apache.org and I assume hudson.zones limit the number of file handles to 256. TestMiniMRDFSSort runs better with more file handles. (I set it to 10000 in my testing, but a smaller </div><div><strong><a href="/file/7204796/2008-05/">2008-05</a></strong></div><div>Iowa State - CPRE - 556</div><div>Master doesn&#039;t see regionserver edits because of clock skewThe streamy folks had a cluster where regionserver was 2 minutes in advance of the master. On split, regionserver would update .META. with split info but scanners opened on the master wouldn&#039;t se</div><div><strong><a href="/file/7204797/2008-06/">2008-06</a></strong></div><div>Iowa State - CPRE - 556</div><div>HLog#cacheFlushLock not cleared; hangs a regionI have a region that is stuck in a close that was ordained by a split. Here is what I have from the log pertaining to the stuck region:cfw_code4 6416 2008-05-29 22:29:03,433 INFO org.apache.hadoop.hbase.HR</div><div><strong><a href="/file/7204798/2008-07/">2008-07</a></strong></div><div>Iowa State - CPRE - 556</div><div>codegen plugin fails due to missing jarWhen clicking &amp;quot;Finish&amp;quot; in the last step to generate Java code from WSDL, the following exception occurs. I believe this is a bug introduced by the commithttp:/mail-archives.apache.org/mod_mbox/ws-axis-cvs/200802.m</div><div><strong><a href="/file/7204799/2008-08/">2008-08</a></strong></div><div>Iowa State - CPRE - 556</div><div>dfs exception and regionserver stuck during heavy write loadIt&#039;s a 3 node setup, each runs datanode and regionserver. One runs as hbase master and hadoop namenode.After some heavy write load via java client, the client is stuck. Stack trace on the regio</div><div><strong><a href="/file/7204800/2008-09/">2008-09</a></strong></div><div>Iowa State - CPRE - 556</div><div>make feature project build successfully according to recent refactor of SMX3 containermake servicemix-utils build successfullyshould add missing stax impl dependency to fix test failuresTests in error:testStaxSourceOnStream(org.apache.servicemix.jbi.j</div><div><strong><a href="/file/7204801/2008-10/">2008-10</a></strong></div><div>Iowa State - CPRE - 556</div><div>WEB: All handlers assigned to any bean should be cleared after a web request has completedCurrently the handler is thread local and softreferenced. Anyway, this could happen :* A get arrives, trying to modify a bean* The modification fails, but the exc</div><div><strong><a href="/file/7204802/2008-11/">2008-11</a></strong></div><div>Iowa State - CPRE - 556</div><div>BeanEditForm guide example about creating the FieldTranslator is inaccurate and out of dateA quote from http:/tapestry.formos.com/nightly/tapestry5/guide/beaneditform.html on 8-Sep-2008:public FieldTranslator getCurrencyTranslator()cfw_Translator tran</div><div><strong><a href="/file/7204803/2008-12/">2008-12</a></strong></div><div>Iowa State - CPRE - 556</div><div>XMLMenuModel:Illegal attribute in menu.xsd.According to xml schema structures recommendation(http:/www.w3.org/TR/xmlschema-1/),section 3.2.6the name of an attribute should not match &#039;xmlns&#039;.Changes required in Distribution build files1. Change version</div><div><strong><a href="/file/7204804/2009-01/">2009-01</a></strong></div><div>Iowa State - CPRE - 556</div><div>QueryParsing.toString() should check ConstantScoreRangeQuery before RangeQueryThiscfw_code:title=QueryParsing.toString()if (query instanceof TermQuery) cfw_: else if (query instanceof RangeQuery) cfw_: else if (query instanceof ConstantScoreRangeQu</div><div><strong><a href="/file/7204805/2009-02/">2009-02</a></strong></div><div>Iowa State - CPRE - 556</div><div>binary type isn&#039;t documented nor demonstrated in the tutorialThe thrift IDL has a type called &amp;quot;binary&amp;quot; for blobs but it&#039;s not listed in the tutorial nor in the documentation.AutoLinkResolver does not work with &amp;lt;a href=&amp;quot;#internal&amp;quot;&amp;gt;Internal link&amp;lt;/a&amp;gt;I thi</div><div><strong><a href="/file/7204806/2009-03/">2009-03</a></strong></div><div>Iowa State - CPRE - 556</div><div>Memory not released in SoftRefFilesCacheImplementation of method putFile(final FileObject file) does not remove references from refReverseMap when adding a new file.#current implementationcfw_noformatsynchronized (files)cfw_files.put(file.getName(),</div><div><strong><a href="/file/7204807/2009-05/">2009-05</a></strong></div><div>Iowa State - CPRE - 556</div><div>Support &amp;quot;templateExpression&amp;quot; and &amp;quot;templateType&amp;quot; in tiles-templateCurrently, attributes &amp;quot;templateType&amp;quot; and &amp;quot;templateExpression&amp;quot; are not supported in tiles-template and depending modules.These attributes should be supported.Deprecate &amp;quot;initContainer&amp;quot; tag</div><div><strong><a href="/file/7204808/2009-09/">2009-09</a></strong></div><div>Iowa State - CPRE - 556</div><div>feature name for cxf-wsdl-first-osgi-package example should be examples-cxf-wsdl-first-osgi-packagebut not example-cxf-wsdl-first-osgi-package, to keep the same naming rule as other examplesSimpleServer: docs need updating for Tomcat 6The current instr</div><div><strong><a href="/file/7204809/2010-05/">2010-05</a></strong></div><div>Iowa State - CPRE - 556</div><div>fileinstall does not recognize jars if it does not have Bundle-SymbolicName and Bundle-VersionFileInstall does not recognize jar files that have only Bundle-SymbolicName. I see the following code in BundleTransformer.java: if (m.getMainAttributes().getV</div><div><strong><a href="/file/7204810/2010-11/">2010-11</a></strong></div><div>Iowa State - CPRE - 556</div><div>Avoid dropping messages off the client request pathCXF CamelTransport and &amp;quot;Can&#039;t find input stream in message&amp;quot;When using a JaxWS proxy with camel transport, to a route with only one processor, CXF fail with the message &amp;quot;Can&#039;t find input stream in messag</div><div><strong><a href="/file/7204811/PADP6910-Feb-1-Notes-for-Iris/">PADP6910 - Feb 1 Notes (for Iris)</a></strong></div><div>UGA - PADP - 6910</div><div>Tuesday, February 1, 2011:Class Structure today:- Review- Segue- 4 Presentations (of each chapter)- Discussion/Class ExerciseReview: Classical Approach- the documentary: The Storm lets connect to the Classical approach-Breakdown in Bureaucracy We</div><div><strong><a href="/file/7204812/GEOG1111-Lecture-Notes/">GEOG1111 Lecture Notes</a></strong></div><div>UGA - GEOG - 1111</div><div>GEOG 1111 (T/R 11:00-12:15), Matthew Miller Class Notes1Thursday, January 7, 2010:Introduction:- 7th edition of the Christopherson (black, &amp;lt; yr old; 2009): dont have to have the 7thedition; CD NOT Required; if get an older edition, will have the info</div><div><strong><a href="/file/7204813/GEOG1111-Post-Exam-2/">GEOG1111 Post-Exam 2</a></strong></div><div>UGA - GEOG - 1111</div><div>GEOG1111: POST-2nd EXAMMatthew MillerCHAPTER 10: GLOBAL CLIMATE SYSTEMS:Thursday, March 4, 2010:Climate:- Climates are the patterns of weather that a place experiences over time (years)-&amp;gt; Climates deal with long-term trends- Climates are very diver</div><div><strong><a href="/file/7204814/GEOL1111-Lecture-Notes/">GEOL1111 Lecture Notes</a></strong></div><div>UGA - GEOG - 1111</div><div>GEOG 1111 (T/R 11:00-12:15), Matthew Miller Class Notes1Thursday, January 7, 2009:Introduction:- 7th edition of the Christopherson (black, &amp;lt; yr old; 2009): dont have to have the 7thedition; CD NOT Required; if get an older edition, will have the info</div><div><strong><a href="/file/7204815/INTL3200-lecture-notes-post-midterm/">INTL3200 - lecture notes post midterm</a></strong></div><div>UGA - INTL - 3200</div><div>Monday, Oct 12, 2009- TicknerRoadmap:- Feminism as a Discipline- Tickners meta-disciplinary analysis- Petersons functional ApproachFeminism has been around even longer than liberalism -&amp;gt; straw man argumentDifferent types of feminism:In early days,</div><div><strong><a href="/file/7204816/INTL4220-Spring-2011-Tessman/">INTL4220 (Spring 2011 - Tessman)</a></strong></div><div>UGA - INTL - 4220</div><div>Brock TessmanINTL 4220: International Conflict Spring 2011Thursday, January 13, 2011:- Tessman teaches classes in international conflict, grand strategy, security studies- Old school thinker all sorts of international conflict (terrorism, civil war (b</div><div><strong><a href="/file/7204817/INTL4440-Notes-for-Madison-110210/">INTL4440 Notes for Madison (11:02:10)</a></strong></div><div>UGA - INTL - 4440</div><div>Dr. Johnson Strat IntelNotes for MadisonTuesday, November 2, 2010:Study Abroad, Stellenbosch, South Africa:- 4 week trip- Sociology/INTL study abroad program in South Africa (see where NelsonMandela sat in jail, )- Classes: Politics of development </div><div><strong><a href="/file/7204818/INTL4460-NOTES-POST-Midterm/">INTL4460 NOTES - POST-Midterm</a></strong></div><div>UGA - INTL - 4460</div><div>INTL4460 - POST-MIDTERM NOTESNikonovSpring 2010Thursday, Feb 4, 2010:Cooperative Threat Reduction: G8 Global Partnership- the nature of nonproliferation has changed over the course of its history- shift from USSR vs Russia to question of where could</div><div><strong><a href="/file/7204819/INTL4460-NOTES/">INTL4460 NOTES</a></strong></div><div>UGA - INTL - 4460</div><div>INTL4460Arms Control and DisarmamentNikonov (T/R 12:30-1:45)1Thursday, Jan 7, 2010Dmitriy Nokonov,- no doubt will talk about arms control and disarmament -&amp;gt; also added a section onnonproliferation- *This course is about WMD - the danger it causes</div><div><strong><a href="/file/7204820/PADP-711-Book-Notes-for-Final-Exam/">PADP 711- Book Notes for Final Exam</a></strong></div><div>UGA - PADP - 7110</div><div>PADP 7110Final Exam Book NotesCHAPTER 6: SAMPLINGCHAPTER 9: SURVEY RESEARCH-3 general features of survey research:o 1) A large number of respondents are chosen through probability samplingprocedures to represent the population of inters.o 2) Syste</div><div><strong><a href="/file/7204821/PADP7110-Bozeman-Fall-2011/">PADP7110 (Bozeman) - Fall 2011</a></strong></div><div>UGA - PADP - 7110</div><div>1PADP7110: Research MethodsMonday, August 15, 2011:Fall 2011HebdonNOTE: Dr. Bozeman will call on you even when you dont raise your hand. This class is muchmore interactive than most classes (even though is a large class).-Most people in this class</div><div><strong><a href="/file/7204822/PADP-7210-POST-MIDTERM-NOTES-Dr-Prittie-Sp2012/">PADP 7210 - POST-MIDTERM NOTES (Dr. Prittie - Sp2012)</a></strong></div><div>UGA - PADP - 7210</div><div>PADP7210: Post-Midterm NotesSpring 2012Dr. PrittieThursday, September 27, 2012 (right after midterm):- Angel Food Ministries Caseo What was going right? Crazy good at delivering groceries not bad food like what wegenerally think go with a food bank</div><div><strong><a href="/file/7204823/PADP7210-Intro-to-Nonprofits-Fall-2012-Class-Notes/">PADP7210 (Intro to Nonprofits Fall 2012) Class Notes</a></strong></div><div>UGA - PADP - 7210</div><div>PADP7210: Intro to NonprofitsFall 2012Dr. PrittieThursday, August 16, 2012:- Joan Prittie: 2nd year teaching this class, 5th in MPA; law and nonprofit backgroundso On a practical note, the time that she devotes to this class is class time but ifever</div><div><strong><a href="/file/7204824/PADP7210-Class-Notes-09-13-2012/">PADP7210 Class Notes (09-13-2012)</a></strong></div><div>UGA - PADP - 7210</div><div>PADP7210: Intro to NonprofitsFall 2012Dr. PrittieThursday, September 13, 2012:PPT: Non Profit Policies: Important policies to build and maintain public trust starting to look more closely at our boards difference between management andgovernance wh</div><div><strong><a href="/file/7204825/PADP7900-Guo-Sp2012-Class-Notes/">PADP7900 (Guo) - Sp2012 Class Notes</a></strong></div><div>UGA - PADP - 7900</div><div>PADP 7900: Managing VolunteersThursday, January 12, 2012:GuoSpring 2012-self intro o born and raised in Hunan province small town of ~1M small town has a lotof history was the capitol city of the first dynasty in China born in very interesting tim</div><div><strong><a href="/file/7204826/PADP6930-Post-Midterm-Notes/">PADP6930 - Post-Midterm Notes</a></strong></div><div>UGA - PADP - 6930</div><div>PADP6930: Post-Midterm NotesDr. CarrollFall 20121Monday, October 15, 2012 (political discussion on tax revenue right after midterm):1) Who should be responsible for more/less of the tax burden? Why?GOP:- hard to get a figure on who is responsible f</div><div><strong><a href="/file/7204827/PADP6930-Carroll-Fall-2012-Class-Notes/">PADP6930 (Carroll-Fall 2012) Class Notes</a></strong></div><div>UGA - PADP - 6930</div><div>1PADP6930 Public &amp;amp; Financial Admin. Dr. CarrollFall 2012Monday, August 13, 2012:Dr. Carroll had been at UGA since 2006, was part of the faculty at UK-Knoxville for 2 yearsbefore that; from Milwaukee, WI and got her bachelors (poly sci and philosophy)</div><div><strong><a href="/file/7204828/PADP6930-Carroll-Oct-23-Notes/">PADP6930 (Carroll) - Oct 23 Notes</a></strong></div><div>UGA - PADP - 6930</div><div>1PADP6930: Post-Midterm NotesDr. CarrollFall 2012Monday, October 22, 2012:PPT: Tax Systems and Policies (Mikesell, Chapter 7) tonight is just a broad overview of this stuff, to try to cut through the political jargonConstitutional Framework &amp;amp; Nexus</div><div><strong><a href="/file/7204829/PADP6950-Class-Notes-1st-day-of-class/">PADP6950 Class Notes (1st day of class)</a></strong></div><div>UGA - PADP - 6950</div><div>Dr. FertigPADP6950: Foundations of Policy AnalysisSpring 2011Monday, January 24, 2011:- like snacks going to have them every day- please call Angie or Dr. Angie- philosophy: you are responsible for what Angie says in class &amp;amp; what is on thelecture n</div><div><strong><a href="/file/7204830/PHIL2030H-Kant-Reading-Question/">PHIL2030H - Kant Reading Question</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H11 October 2010Reading Question: KantQuestion 1. What is the Good Will? Why does Kant think it is so important? What is therelationship between the Good Will and our moral Duty? What do you think of his</div><div><strong><a href="/file/7204831/PHIL2030H-Reading-Question-1-Plato-and-Hume/">PHIL2030H - Reading Question 1 (Plato and Hume)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H23 August 2010Reading Question: Plato and HumeQuestion: 1. What two roles does Hume claim reason plays in our deliberations? Whycant reason alone guide our actions? Explain whether or not you think Hume </div><div><strong><a href="/file/7204832/PHIL2030H-Reading-Question-2-Ayer-and-Searle/">PHIL2030H - Reading Question 2 (Ayer and Searle)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H31 August 2010Reading Question: Ayer and SearleQuestion: 1. Ayer claims that propositions containing moral, or normative terms, aremeaningless. How does he argue for this claim? Also, if moral judgments </div><div><strong><a href="/file/7204833/PHIL2030H-Reading-Question-3-Searle-Flew-Foot-and-Korsgaard/">PHIL2030H - Reading Question 3 (Searle, Flew, Foot, and Korsgaard)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H7 September 2010Reading Question 3: Searle, Flew, Foot, and KorsgaardQuestion: 2. How does Foot address the problems raised by non-naturalists such asAyer? How does her argument proceed? Do you think her</div><div><strong><a href="/file/7204834/PHIL2030H-Reading-Question-4-Korgaard-and-Rawles/">PHIL2030H - Reading Question 4 (Korgaard and Rawles)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H14 September 2010Reading Question 4: Korsgaard and RawlsQuestion: 4. What would Rawls account of justice require, practically speaking, if wewere to adopt it? In answering, you should briefly explain his</div><div><strong><a href="/file/7204835/PHIL2030H-Reading-Question-7/">PHIL2030H - Reading Question 7</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL 2030H20 October 2010Reading Question 7Question: 1. Feldman argues that we can tweak our maxims so that theyconform to the categorical imperative. Explain the case he appeals to in hisargument. Do you think </div><div><strong><a href="/file/7204836/PHIL2030H-Reading-Question-8-Mill-and-Williams/">PHIL2030H - Reading Question 8 (Mill and Williams)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H2 November 2010Reading Question 8: Utilitarianism3. What is one of Williams concerns with utilitarianism? Explain hisanalysis.In examining utilitarianism, Williams is concerned with the inability of the</div><div><strong><a href="/file/7204837/PHIL2030H-Reading-Questions-9/">PHIL2030H - Reading Questions 9</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonPHIL2030HDr. Matthew Schneider8 November 2010Reading Question 11. What is the difference between act and rule utilitarianism? How mightattention to this distinction help solve some of the puzzle casesdiscussed in the text and in cla</div><div><strong><a href="/file/7204838/PHIL2030H-Reading-Question-5/">PHIL2030H Reading Question 5</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL 2030H Reading Question 520 September 2010Reading Question: Rawls, Narveson, and SterbaQuestion 2. What is Liberty? How do libertarians such as Narveson utilize the concept inan argument for their political v</div><div><strong><a href="/file/7204839/stat1/">stat1</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204840/stat2/">stat2</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204841/stat3/">stat3</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204842/stat4/">stat4</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204843/stat5/">stat5</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204844/stat6/">stat6</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204845/stat7/">stat7</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204846/stat8/">stat8</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204847/stat9/">stat9</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204848/stat10/">stat10</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204849/Outline-for-amfamsocamppol-thoughts/">Outline for amfamsoc&amp;pol thoughts</a></strong></div><div>Old Dominion - SOC - 420</div><div>April Goode10/6/2011OutlineThesis Statement: People of color have experienced a number of hardships from the beginningsof slavery to present day by the white community. Because of the intended mental and physicalbreakdown, or assimilation, they not o</div><div><strong><a href="/file/7204850/AA-socamppol-thought-preference-group-impact-question/">AA soc&amp;pol thought preference group impact question</a></strong></div><div>Old Dominion - SOC - 420</div><div>April Goode6/26/2012Essay QuestionDescribe and explain how race, gender, class, and/or sexual preference groups impacts theiropportunities in America.RaceIn America there is still evidence of racism, meaning race does matter. Racism is thebelief in</div><div><strong><a href="/file/7204851/soc-change-n-soc-movement-exam-3-essay-question/">soc change n soc movement exam 3 essay question</a></strong></div><div>Old Dominion - SOC - 405</div><div>April Goode4/2/2012SOC405The world is becoming a global system, that means everything ultimately effectseverything else. Basically, globalization is growing and everyone is being affected by it.Globalization is the emerging and continuously changing </div><div><strong><a href="/file/7204852/soc-change-n-soc-movment-midterm-take-home-question/">soc change n soc movment midterm take home question</a></strong></div><div>Old Dominion - SOC - 405</div><div>April Goode3/2/2012Essay Question #1The mid-1960s witnessed a surge of protests at the end of World War II. Thesemovements included many status-equality revolts. A few of which, the Civil Rights movement,the New Left and Countercultural Student Movem</div>											</div>
		</div>
		<div id="related_flashcard_sets" class="ajax_load" data-params="filehash=b480030c31abdf0490e58367a7380d1747df1816"></div>
	</div>
</div>
<script src="/javascript/modal.js"></script>
<script src="/javascript/common/select2.js"></script>
<script src="/javascript/expert-ready.js" type="text/javascript" charset="utf-8">
</script>
<script src="/javascript/expert-home.js" type="text/javascript" charset="utf-8">
</script>
<script>
jQuery(document).ready(function(){
	jQuery('#doc-rating').raty({
		readOnly: true,
		score: function() {
			return jQuery(this).attr('data-score');
		}
	});
})
</script>
<!--[if (gte IE 6)&(lte IE 8)]>
<script>
jQuery(document).ready(function(){
	jQuery(".ch-doc-large-thumbnail-container").live( 'mouseover', function() {
		jQuery(this).find(".ch-doc-large-thumbnail-details").show();
	}).live('mouseout', function() {
		jQuery(this).find(".ch-doc-large-thumbnail-details").hide();
	});
})
</script>
<![endif]-->
<!--
<PageMap>
  <DataObject type="docinfo">
		<Attribute name="schoolid">864</Attribute>
	<Attribute name="deptid">2012</Attribute>
	<Attribute name="coursenum">556</Attribute>
					<Attribute name="docd">20121012</Attribute>
				<Attribute name="dt">0</Attribute>
		<Attribute name="y">212</Attribute>
	<Attribute name="uk">2</Attribute>
	<Attribute name="ku">1</Attribute>
	<Attribute name="ukrev">2</Attribute>
	<Attribute name="kurev">1</Attribute>
	<Attribute name="ukone">1</Attribute>
	<Attribute name="ytestnew">2</Attribute>
	<Attribute name="ytestold">1</Attribute>
	<Attribute name="qst">answered</Attribute>
	<Attribute name="isd">1</Attribute>
  </DataObject>
	<DataObject type="document">
		<Attribute name="title">2007-01</Attribute>
		<Attribute name="filehash">b480030c31abdf0490e58367a7380d1747df1816</Attribute>
		<Attribute name="db_filename">7204791</Attribute>
		<Attribute name="page_count">401</Attribute>
		<Attribute name="school_type">HIGHER</Attribute>
		<Attribute name="doc_source">user</Attribute>
		<Attribute name="doc_type">txt</Attribute>
		<Attribute name="school_name">Iowa State</Attribute>
		<Attribute name="school_id">864</Attribute>
		<Attribute name="dept_acro">CPRE</Attribute>
		<Attribute name="dept_id">2012</Attribute>
		<Attribute name="course_name">Scalabla Sofwatre Engineering</Attribute>
		<Attribute name="course_num">556</Attribute>
		<Attribute name="course_id">1526018</Attribute>
		<Attribute name="prof_name">Sibran</Attribute>
		<Attribute name="year">2012</Attribute>
		<Attribute name="term">3</Attribute>
		<Attribute name="date">2012-10-12 10:36:41</Attribute>
		<Attribute name="gs_date">20121012</Attribute>
		<Attribute name="canid"></Attribute>
	</DataObject>
	<DataObject type="stats">
		<Attribute name="created">2012-10-12 10:36:41</Attribute>
		<Attribute name="modified">2012-10-12 10:36:41</Attribute>
		<Attribute name="gs_date">20121012</Attribute>
		<Attribute name="priority">100</Attribute>
		<Attribute name="course_tagged">1</Attribute>
		<Attribute name="course_tagged_big">999999999</Attribute>
	</DataObject>
	<DataObject type="course_tag">
		<Attribute name="school_name">Iowa State</Attribute>
		<Attribute name="school_id">864</Attribute>
		<Attribute name="dept_acro">CPRE</Attribute>
		<Attribute name="dept_id">2012</Attribute>
		<Attribute name="course_name">Scalabla Sofwatre Engineering</Attribute>
		<Attribute name="course_num">556</Attribute>
		<Attribute name="course_id">1526018</Attribute>
	</DataObject>
</PageMap>
-->

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>


<script type="text/javascript">
    var recording_scrolling_text_version = false;
    jQuery(document).ready(function(){
        var pageTracker = _gat._getTracker("UA-1389869-2");
        if (jQuery(".ch-document-excerpt").length > 0) {
            jQuery(".ch-document-excerpt").scroll( function(){
                if (!recording_scrolling_text_version) {
                    pageTracker._trackEvent('Scrolling', 'ScrolledTextVersion', 'UserIsScroller', 1);
                    //_gaq.push(['_trackEvent', 'Scrolling', 'ScrolledTextVersion', 'UserIsScroller', 1]);
                    recording_scrolling_text_version = true;
                }
            });
        }
    });


</script>

<script type="text/javascript">

try {
    if (utmx('combination') != undefined) {
        var l = document.location, s = l.search;
        s = s + (s.length ? '&' : '?') + 'combination=' + utmx('combination');
        var pageTracker = _gat._getTracker("UA-1389869-2");
        
        pageTracker._setCustomVar(1, "usertype", "", 1);
                
        pageTracker._trackPageview(l.pathname + s);
    }
    else {
        var pageTracker = _gat._getTracker("UA-1389869-2");
        pageTracker._initData();
        
        pageTracker._setCustomVar(1, "usertype", "", 1);
                
        pageTracker._trackPageview();
    }
}catch(err){
        var pageTracker = _gat._getTracker("UA-1389869-2");
        pageTracker._initData();
        
        pageTracker._setCustomVar(1, "usertype", "", 1);
                
        pageTracker._trackPageview();
}
 
</script>
<script type="text/javascript">

adroll_adv_id = "RMA4JRK3LBCRFDGPVVO45A";
adroll_pix_id = "4D6DGYEGP5GENH5XDDV55J";
(function () {
var oldonload = window.onload;
window.onload = function(){
  __adroll_loaded=true;
  var scr = document.createElement("script");
  var host = (("https:" == document.location.protocol) ?
"https://s.adroll.com" : "http://a.adroll.com");
  scr.setAttribute('async', 'true');
  scr.type = "text/javascript";
  scr.src = host + "/j/roundtrip.js";
  document.documentElement.firstChild.appendChild(scr);
  if(oldonload){oldonload()}};
}());

</script>






<div id="ch-footer-wrapper" class="ch-wrapper">
	<div class="ch-container">
									<div class="ch-certificates">
					
<a href="https://seal.verisign.com/splash?form_file=fdf/splash.fdf&dn=www.coursehero.com" target="_blank" rel="nofollow" class="security-seals-verisign"></a>
<a class="security-seals-bbb"></a>
<a href="http://privacy-policy.truste.com/click-with-confidence/wps/en/www.coursehero.com" target="_blank"  rel="nofollow" class="security-seals-truste"></a>

				</div>
									<script type="text/javascript">
				var __fList_network = true;
				var __fList_textbook = false;
				var __fList_concepts = true;
				var __fList_homework = true;
				var __fList_skills = true;
			</script>
			
											  					<div class="ajax_load" id="ajax_footer_sitemap"></div>
				  										<div class="ch-footerlinks" id="ft-links-id">
				<ul>
					<li><a href="/sitemap/">Sitemap</a></li>
					<li><a href="/tutors/problems/">Tutors</a></li>
					<li><a href="/keywords/">Educational Concepts</a></li>
					<li><a href="/textbooks/">Textbooks</a></li>
					<li><a href="http://blog.coursehero.com">Blog</a></li>
					<li><a href="/study-skills/">Study Skills</a></li>
                    <li><a href="/subjects/">Subjects</a></li>
				</ul>
			</div>
				</div>
</div>


<script src="/javascript/common/select2.js"></script>
<script src="/min/?f=/javascript/jquery-ui-1.8.19.custom.min.js,/javascript/google_autocomplete.js,/javascript/jquery.raty.min.js,/javascript/jstz-1.0.4.min.js,/javascript/jquery.scrollspy.js,/javascript/jquery.ui.widget.js" type="text/javascript" charset="utf-8"></script>
<script src="/min/?f=/javascript/jquery.iframe-transport.js,/javascript/jquery.fileupload.js,/javascript/footer.js,/javascript/jquery.jcarousel.min.js,/javascript/jquery.boxy.js,/javascript/classes/VTab.js" type="text/javascript" charset="utf-8"></script>
<script src="/min/?f=/javascript/classes/main.js,/javascript/classes/benefits.js" type="text/javascript" charset="utf-8"></script>

</body>
</html>
