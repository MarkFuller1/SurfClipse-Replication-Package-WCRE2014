<!-- print.view -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<style type="text/css">
li.GlobalNavInfo.right { width: 145px; }
</style>



<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--chartbeat-->
<script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>


	<title>Writing Efficient JavaScript: Chapter 7 - Even Faster Websites - O'Reilly Media</title>
	<meta name="keywords" content=",O'Reilly Media" />
	<meta name="description" content="Performance is critical to the success of any web site. In this book, Steve Souders, web performance evangelist at Google and former Chief Performance Yahoo!, provides valuable techniques to help you..." />
	<meta name="date" content="Aug. 14, 2009" />
	<meta name="search_date" content="2009-08-14" />
	<meta name="pagename" content="Writing Efficient JavaScript: Chapter 7 - Even Faster Websites" />
	<meta name="site" content="O'Reilly Network" />
	<meta name="subtitle" content="" />
	<meta name="author" content="Nicholas C. Zakas" />
<meta name="target" content="" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:title" content="Writing Efficient JavaScript: Chapter 7 - Even Faster Websites" />
	<meta name="twitter:description" content="Performance is critical to the success of any web site. In this book, Steve Souders, web performance evangelist at Google and former Chief Performance Yahoo!, provides valuable techniques to help you..." />
	<meta name="twitter:site" content="@OReillyMedia" />








<!-- feed autodiscovery links -->
<link rel="alternate" type="application/atom+xml" title="New Titles Feed" href="http://feeds.feedburner.com/oreilly/newbooks" />
<link rel="alternate" type="application/atom+xml" title="Upcoming Titles Feed" href="http://feeds.feedburner.com/oreilly/upcomingbooks" />
<link rel="alternate" type="application/atom+xml" title="O'Reilly Ebook Deal of the Day Feed" href="http://feeds.feedburner.com/oreilly/ebookdealoftheday" />





<!--Auto Complete CSS (see footer for autocomplete scripts, including call to autocomplete_data.js file) -->
<link rel="stylesheet" type="text/css" href="//content.atomz.com/sp10049ed9/publish/autocomplete_styles.css" />
<!--ML Scripts and CSS-->

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>

<link rel="stylesheet" type="text/css" href="//cdn.oreillystatic.com/oreilly/ml/css/stylesheet.css" />

<!-- Matthew's new nav.css -->
<link rel="stylesheet" type="text/css" media="screen"  href="//cdn.oreillystatic.com/assets/css/nav.css" />



<!--MyBUYS Header -->
<!-- MyBuys libraries and style sheet -->
<link href="http://t.p.mybuys.com/css/mbstyles.css" type="text/css" rel="stylesheet" id="mybuysstyles" />
<script type="text/javascript" src="http://t.p.mybuys.com/js/mybuys3.js"></script>
<script type="text/javascript" src="http://t.p.mybuys.com/clients/OREILLY/js/setup.js"></script>
<!-- End MyBuys libraries and style sheet -->


<!-- common javascript and analytics -->

<script language="JavaScript" type="text/javascript" src="http://cdn.oreillystatic.com/oreilly/scripts/engine.js"></script>
<script language="JavaScript" type="text/javascript" src="http://cdn.oreillystatic.com/oreilly/scripts/common.js"></script>


<!-- path_info: /a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- table: a - ref_id: /server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- table: a - ref_id: /server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- table: a - ref_id: /server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html - cs_rid: 7542 -->
<!-- 0 domain: www.oreilly.com - path_info: a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- 1 domain: www.oreilly.com - path_info: a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- 2 domain: oreilly.com - path_info: a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- 3 domain: oreilly.com - path_info: a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- 4 domain: oreilly.com - path_info: a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- 5 domain: oreilly - path_info: a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- 6 domain: oreilly - path_info: a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html s_channel: oreilly -->
<!-- 7 domain: oreilly - path_info: a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->
<!-- 8 domain: www.oreilly.com - path_info: a//server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html -->

<script language="JavaScript" type="text/javascript"><!--
var s_account="ororeilly,orglobal"
//--></script>
<!-- SiteCatalyst code version: H.20.2. Copyright 1997-2009 Omniture, Inc. More info available at http://www.omniture.com  -->
<script language="JavaScript" type="text/javascript" src="http://cdn.oreillystatic.com/assets/js/s_code.js"></script>
<script language="JavaScript" type="text/javascript"><!--
s.pageName="oreilly:oreilly:writing efficient javascript chapter 7 - even faster websites"
s.channel="oreilly"
s.prop1="oreilly:oreilly"
s.prop2="oreilly:oreilly"
s.prop3="oreilly:oreilly"
s.prop4="excerpt"
s.prop5="writing efficient javascript chapter 7 - even faster websites"
s.prop6="n/a/7542"
s.prop24="08/14/2009"
s.prop21="nicholas c. zakas"
s.hier1="oreilly,oreilly"
/************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
var s_code=s.t();if(s_code)document.write(s_code)//--></script>
<!-- End SiteCatalyst code version: H.20.2. -->
<!-- analytics.pl: 2013/12/13 17:17:18 -->





<link rel="stylesheet" href="//cdn.oreillystatic.com/oreilly/ml/css/all-post-ml.css" type="text/css" />


<!-- ORM correction to ML styles -->
<link rel="stylesheet" href="//cdn.oreillystatic.com/oreilly/ml/css/ml.css" type="text/css" />
<script type="text/javascript" src="//cdn.oreillystatic.com/oreilly/ml/js/ml.js"></script>


<link rel="stylesheet" rev="stylesheet" href="http://www.oreillynet.com/styles/search.css" />
<link href="http://www.oreillynet.com/styles/articles.css" rel="stylesheet" type="text/css" />
<link href="http://www.oreillynet.com/styles/pt-excerpt.css" rel="stylesheet" type="text/css" />
<link href="http://oreilly.com{file}" rel="canonical" />















<!-- Google Analytics -->
<script type="text/javascript">

var _gaq = _gaq || []; 
_gaq.push(['_setAccount', 'UA-4591498-1']);
_gaq.push(['_setDomainName', 'oreilly.com']);
_gaq.push(['_addIgnoredRef', 'oreilly.com']);
_gaq.push(['_setSiteSpeedSampleRate', 50]);
_gaq.push(['_trackPageview']);

(function() { var ga = document.createElement('script'); ga.type =
'text/javascript'; ga.async = true; ga.src = ('https:' ==
document.location.protocol ? 'https://ssl' : 'http://www') +
'.google-analytics.com/ga.js'; var s =
document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(ga, s); })();

</script>


<!--Facebook Insights -->
<meta property="fb:page_id" content="15137500430" />


<!-- Start Visual Website Optimizer Asynchronous Code -->
<script type='text/javascript'>
var _vwo_code=(function(){
var account_id=27087,
settings_tolerance=2000,
library_tolerance=1500,
use_existing_jquery=false,
// DO NOT EDIT BELOW THIS LINE
f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
</script>
<!-- End Visual Website Optimizer Asynchronous Code -->

</head>
<body class="main">

<div id="page">
<!--header-->
	<table width="990" border="0" cellpadding="0" cellspacing="0" class="mainLayoutTable">
		<tr>
			<td class="navheaderbg">
				<div> <!--TopNav Start-->
					<script type="text/javascript">
					function checkIfDefault(keyword) {
					var defaultSearchTerm = "Search";
					if(keyword==defaultSearchTerm) {
					return '';
					}
					else {
					return keyword;
					}
					}
					</script>
					<div id="header" style="width:990px;">
						<div class="logo">
                                               <a href="http://oreilly.com"><img src="http://cdn.oreillystatic.com/images/sitewide-headers/ml-header-home-blinking.gif" border=0 alt="O'Reilly Media, Inc."></a>
                                               
                                               
                                              
                                               
                                               
                                               
                                               
                                               

                                               

                                               
                                               
                                               
                                               
						</div> <!--logo end-->
						<div class="tools">
							<p><a href="https://members.oreilly.com" class="signInLinkmy">Your Account</a></p>
							<div id="globalBasket" class="popDownWrapper globalCartWrapper" style=" margin:2px 0px 0px 0px; width:239px;">
								<div class="popDownNav globalCartNav">
									<div class="globalCartBasketImg" style="">
										<img src="http://cdn.oreillystatic.com/images/sitewide-headers/basketicon.gif" border="0" alt="Shopping Cart">

									</div>
									<div class="globalCartBasketInfo" style="">
										<a href="http://shop.oreilly.com/basket.do"><span class="navHeader">Shopping Cart</span></a>
									</div>
								</div> <!--popDownNav globalCartNav end-->
							</div> <!--globalBasket-->						
						</div> <!--tools end-->
                                               

					<div id="search-box" class="yui-skin-sam">
						<form name="searchform" method="get" id="search-form" action="http://search.oreilly.com/">
							<div class="search">
								<fieldset>
									<span id="search-input">
										<div class="searchInput">
											<span id="search-field"><input type="text" value="Search" name="q" maxlength="64" id="q" onfocus="this.value=checkIfDefault(this.value);"></span>			
										</div>
										<span id="search-button">
											<input type="image" value="SEARCH" src="http://cdn.oreillystatic.com/images/sitewide-headers/search_btn.gif" border="0" style="float:left" alt="Search" align="top">
			
        										
										</span>
									</span>
 <div id="autocomplete"></div>
								</fieldset>
							</div><!--search-->
						</form>
					</div><!--search-box-->

</noscript>
				</div> <!--Header End-->

  
    <!--[if lt IE 9]>
  <script>
    'article aside footer header nav section time'.replace(/\w+/g,function(n){document.createElement(n)})
  </script>
<![endif]-->


<!-- Nav CSS -->
<!-- Not Needed for Actual Site -->
<style type="text/css">

  nav a { text-decoration:none; }
  nav a:hover { text-decoration:underline; }

  nav p { margin:0 0 10px; }
  nav .fsl { font-size:16px; }
  nav .fsxl { font-size:24px; line-height:1.1em; }
  nav .fwb { font-weight:bold; }
  nav .fc-highlight { color:#b9002d; }
  nav .fc-dark { color:#222; }
  nav .fc-light { color:#fff; }
  nav .nm { margin:0; }
  nav .mb { margin-bottom:10px; }
  nav .mr { margin-right:10px; }
  nav .floatl { float:left; }
  nav .clear { clear:both; }

  nav  a.btn-green-arrow { display:block; float:left; padding:5px 10px 5px 22px; line-height:22px; font-size:20px; font-weight:bold; -webkit-border-radius: 4px; -moz-border-radius: 4px; border-radius: 4px; border:1px solid #f2ba12; color:#222; background: rgb(247,209,69); background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0b3AtY29sb3I9IiNmN2QxNDUiIHN0b3Atb3BhY2l0eT0iMSIvPgogICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0b3AtY29sb3I9IiNmNWM1MTciIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+); background: -moz-linear-gradient(top,  rgba(247,209,69,1) 50%, rgba(245,197,23,1) 50%); background: -webkit-gradient(linear, left top, left bottom, color-stop(50%,rgba(247,209,69,1)), color-stop(50%,rgba(245,197,23,1))); background: -webkit-linear-gradient(top, rgba(247,209,69,1) 50%,rgba(245,197,23,1) 50%); background: -o-linear-gradient(top, rgba(247,209,69,1) 50%,rgba(245,197,23,1) 50%); background: -ms-linear-gradient(top, rgba(247,209,69,1) 50%,rgba(245,197,23,1) 50%); background: linear-gradient(to bottom,  rgba(247,209,69,1) 50%,rgba(245,197,23,1) 50%); filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f7d145', endColorstr='#f5c517',GradientType=0 ); }
  nav a.btn-green-arrow:hover { text-decoration:none; }
  nav a.btn-green-arrow .arrow { display:block; min-height:18px; background:transparent url(//cdn.oreillystatic.com/oreilly/images/btn-green-arrow-overlay.png) left center no-repeat; margin:0 0 0 -25px; padding:0 0 0 25px; }
  nav a.btn-green-arrow.small { font-size:13px; line-height:18px;  padding:5px 10px 5px 22px !important; }

  ul#primarynav, #sf-menu-text-nav { display:none; }
</style>

<!-- Styles for page -->
<style type="text/css">
  /* Reset for browsers that don't automatically set semantic tags to block */
  article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section { display:block; }

  nav .self-clear:after { content:""; display:block; clear:both; height:0; }

#globalInclude { text-align:left !important; }
</style>


<!-- Nav Styles -->
<style type="text/css">
  nav { font-size:13px; }
  nav ul { list-style:none; margin:0; padding:0; }
  nav ul:after { content:''; display:block; clear:both; height:0; width:100%; }
  nav li { display:block; float:left; border-right:1px solid #ddd; line-height:1.4em; }
  nav li:last-child { border-right:0; }
  nav li > a { display:block; padding:8px 15px 7px; }
  nav li > a:hover { text-decoration:none; }
  nav li > a.category { font-size:16px; color:#b9002d !important; }

  nav ul#global-nav {
    display:block;
    background:#eee;
    background:-moz-linear-gradient(top, #fbfbfb 0%, #eeeeee 100%);
    background:-webkit-gradient(linear, left top, left bottom, color-stop(0%,#fbfbfb), color-stop(100%,#eeeeee));
    background:-webkit-linear-gradient(top, #fbfbfb 0%,#eeeeee 100%);
    background:-o-linear-gradient(top, #fbfbfb 0%,#eeeeee 100%);
    background:-ms-linear-gradient(top, #fbfbfb 0%,#eeeeee 100%);
    background:linear-gradient(to bottom, #fbfbfb 0%,#eeeeee 100%);
    border-top:1px solid #ddd;
    border-bottom:1px solid #ddd;
    height:auto;
    text-align:left;
  }
  nav #global-nav li > a { color:#333; }
  nav #global-nav li > a.current { color:#b9002d; background:#fff; border-bottom:1px solid #fff; margin-bottom:-1px; }
  /* Social Icons in Primary Nav */
  nav #global-nav .social { float:right; padding:9px 15px 0 0; border-right:0; height:auto; position:static; margin:0; }
  nav #global-nav .social .icon { display:block; float:left; padding:0; }
  nav #global-nav .social .icon:before { content:''; display:block; width:16px; height:16px; background-image:url(//cdn.oreillystatic.com/assets/images/social-icons-16.png); margin:0 0 0 8px; font-size:0; }
  nav #global-nav .social .icon.twitter:before { background-position:0 0; }
  nav #global-nav .social .icon.youtube:before { background-position:0 -20px; }
  nav #global-nav .social .icon.facebook:before { background-position:0 -40px; }
  nav #global-nav .social .icon.googleplus:before { background-position:0 -60px; }
  nav #global-nav .social .icon.rss:before { background-position:0 -80px; }


  nav #contextual-nav { display:block; clear:both; padding:0 7px 0; border-bottom:1px solid #ddd; }
  nav #contextual-nav > li { padding:8px 0 7px; position:relative; border-right:0; }
  nav #contextual-nav > li:after { content:''; display:block; top:8px; right:0; position:absolute; height:1.4em; border-right:1px solid #ddd; }
  nav #contextual-nav > li.no-divider:after { display:none; }
  nav #contextual-nav > li > a { color:#b9002d; padding:0; margin:0 8px; }
  nav #contextual-nav > li > a:hover { color:#333; }
  /* Labels in Secondary Nav */
  nav #contextual-nav > li.label { margin:0 0 0 8px; color:#999; }
  nav #contextual-nav > li.label:after { display:none; }
  /* Contacts in Secondary Nav */
  nav #contextual-nav li.contact { float:right; padding:9px 0 7px 0; font-weight:bold; font-size:12px; color:#333; }
  nav #contextual-nav li.contact:after { display:none; }
  nav #contextual-nav li.contact > a { padding:0; margin:0 8px 0 0; display:inline; color:#333; }


  nav li.sub > ul { /*display:none;*/ left:-9999px; top:-9999px; position:absolute; z-index:100; background:#fff; background:rgb(255,255,255); background:rgba(255,255,255,.98); -webkit-box-shadow:1px 1px 1px 0px rgba(0, 0, 0, .3); -moz-box-shadow:1px 1px 1px 0px rgba(0, 0, 0, .3); box-shadow:1px 1px 1px 0px rgba(0, 0, 0, .3); border-left:1px solid #ddd; margin-left:-1px; border:1px solid #ddd\9; border-top:0 solid #ddd\9; margin:0 -1px\9; }
  nav #global-nav > li.sub:hover > ul, nav #contextual-nav > li.sub:hover > ul { top:auto; left:auto; }
  nav ul.vertical > li.sub.hover > ul { top:auto; left:auto; }

  nav #contextual-nav ul.vertical > li.sub.hover > a { position:relative; }
  nav #contextual-nav ul.horizontal > li:hover > a { color:#b9002d; }

  nav #contextual-nav ul.vertical > li.sub.hover > a:after { right:0; border:solid transparent; content:" "; height:0; width:0; position:absolute; pointer-events:none; top:50%; border-color:#fff; border-left-color:#ccc; border-width:6px; margin-top:-6px; }
  nav #global-nav > li.sub:hover .title { background:rgba(255,255,255,.5); }
  nav #global-nav li.sub > ul.vertical li:hover > a, nav #contextual-nav ul li:hover > a { color:#b9002d; }
  nav li.sub > ul.vertical li { clear:both; width:100%; }
  nav li.sub > ul.vertical li:first-child { border-top:1px solid #ddd; } 
  nav #global-nav li.sub > ul.vertical li { border-top:1px solid #ddd; }
  nav li.sub > ul.vertical li:last-child { border-bottom:0; }

  nav #contextual-nav li.sub > ul.vertical { top:100%; border-top:1px solid #ddd; margin-left:-8px; border-left:1 solid #ddd\9; }
  nav #contextual-nav li.sub > ul.vertical > li { padding: 0; border:0; min-width:210px; max-width:300px; }
  nav #contextual-nav li.sub > ul.vertical > li > a, nav #contextual-nav li.sub > ul.horizontal > li > a { padding: 4px 15px 4px; margin-right:-2px; }
  nav #contextual-nav li.sub > ul:before, nav #contextual-nav li.sub > ul:after { content:''; display:block; clear:both; height:7px; }


  nav #contextual-nav li.sub > ul.horizontal { min-height:100%; margin-left:0px; border-top:1px solid #ddd; border-left:1 solid #ddd\9; border-top:0 solid #ddd\9; }
  nav #contextual-nav .vertical > li.sub.hover > ul.horizontal { left:100%; top:-1px; top:0px\9; }
  nav #contextual-nav li > ul li > a { color:#333; }
  nav #contextual-nav > li:hover > a { color:#222; }

  nav #contextual-nav ul.horizontal li { float:none; padding: 0; border:0; width:210px; position:relative; z-index:10; }
</style>


<!-- Advertisement Styles -->
<style type="text/css">
  nav #contextual-nav ul.horizontal li.ad.data { width:425px; min-height:560px; position:absolute; z-index:-1; top:0; bottom:0; left:0; margin-right:-55px; background:transparent url(//cdn.oreillystatic.com/oreilly/promos/ad-data-bg.png) left bottom no-repeat; }

  nav #contextual-nav ul.horizontal li.ad.photography { width:370px; min-height:560px; position:absolute; z-index:-1; top:0; bottom:0; left:0; background:transparent url(//cdn.oreillystatic.com/oreilly/promos/ad-photography-bg.jpg) left bottom no-repeat; }

  nav #contextual-nav ul.horizontal li.ad.programming { width:425px; min-height:585px; position:absolute; z-index:-1; top:0; bottom:0; left:0; margin-bottom:-25px; background:transparent url(//cdn.oreillystatic.com/oreilly/promos/ad-programming-bg.png) left bottom no-repeat; }
</style>



<nav role="navigation">
  <ul id="global-nav" role="menubar">
    <li role="menuitem"><a href="http://oreilly.com">Home</a></li>
    <li role="menuitem"><a href="http://shop.oreilly.com">Shop Books &amp; Videos</a></li>
    <li class="sub" aria-haspopup="true" role="menuitem" aria-haspopup="true">
      <a href="http://radar.oreilly.com/" class="title">Blogs</a>
      <ul class="vertical" role="menu">
        <li role="menuitem"><a href="http://programming.oreilly.com">Programming</a></li>
        <li role="menuitem"><a href="http://radar.oreilly.com">Radar</a></li>
        <li role="menuitem"><a href="http://strata.oreilly.com">Strata</a></li>
        <li role="menuitem"><a href="http://animals.oreilly.com">Animals</a></li>
      </ul>
    </li>
    <li role="menuitem"><a href="http://safari.oreilly.com/?cid=orm-nav-global">Safari Books Online</a></li>
    <li role="menuitem"><a href="http://conferences.oreilly.com/">Conferences</a></li>
    <li role="menuitem"><a href="http://www.oreillyschool.com/">IT Courses &amp; Certificates</a></li>
    <li class="social"><a href="http://twitter.com/oreillymedia" class="icon twitter" title="O'Reilly on Twitter"></a><a href="http://www.youtube.com/subscription_center?add_user=oreillymedia" class="icon youtube" title="O'Reilly on YouTube"></a><a href="http://www.facebook.com/OReilly" class="icon facebook" title="O'Reilly on Facebook"></a><a href="https://plus.google.com/+oreillymedia/" class="icon googleplus" title="O'Reilly on Google+"></a><a href="http://oreilly.com/feeds/" class="icon rss" title="Subscribe to Feed"></a></li>
  </ul>

  

  

  


  

  


</nav>
  
			</div> <!--CatNav End-->
		</td>
	</tr>

	<tr valign="top">
		<td>


<div id="content-09">




	<div id="content" class="pt-excerpt">












<!-- begin  print-discuss-del.icio.us options -->
<div style="margin: 0px 10px 0px 6px;">
<div style="float: right; width: 170px;">

<a class="print" title="Go to a print-friendly version of this page." href="/lpt/a/7542">Print</a>
<!--csif cond="">
<a class="discuss" title="Join the talkback discussion about this article" href="/pub/a/server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html?page=last#thread">Discuss</a>
</csif-->






















<a class="newsletter" href="http://www.oreillynet.com/cs/nl/home">Subscribe to Newsletters</a>

<div id="share-options" style="text-align:right;">
<script type="text/javascript" src="http://w.sharethis.com/button/sharethis.js#publisher=16098316-763b-41fc-a31d-7bbadcfcf894&amp;type=website&amp;embeds=true&amp;style=rotate&amp;send_services=email%2Caim%2Csms&amp;post_services=twitter%2Cfriendfeed%2Cfacebook%2Cdigg%2Cdelicious%2Creddit%2Cslashdot%2Cgoogle_bmarks%2Cblogger%2Ctypepad%2Cstumbleupon%2Cwordpress%2Cwindows_live%2Cnewsvine%2Clinkedin%2Cmyspace%2Ctechnorati"></script>
</div>

</div>
</div>
<!-- end  print-discuss-del.icio.us options -->





<!-- content here -->




<div id="article-content">





















<div class="breadcrumb">

  <a href="http://oreilly.com/pub/topic/serveradmin">Server Administration</a> &gt;


<a href="http://oreilly.com/server-administration/excerpts/index.csp">Excerpts</a> &gt;


</div>




















	<!-- mega preparse mp:yes -->

<h1>Writing Efficient JavaScript: Chapter 7 - Even Faster Websites</h1>
by <a href="/pub/au/3902">Nicholas C. Zakas</a><br />




<div class="clear"></div>




<div xmlns="http://www.w3.org/1999/xhtml" class="chapter" lang="en" xml:lang="en">
<p>Today&#8217;s web <a id="zakas7.1" class="indexterm"></a>applications are powered by a large amount of JavaScript code.
  Whereas early web sites used JavaScript to perform simple tasks, the
  language is now used to run the entire user interface in many places. The
  result can be thousands of lines of JavaScript code to execute every time a
  user interaction takes place. Performance, therefore, is not just about how
  long it takes for the page to load, but also about how it responds as it&#8217;s
  being used. The best way to ensure a fast, enjoyable user interface is to
  write <a id="I_indexterm7_d1e6738" class="indexterm"></a><a id="I_indexterm7_d1e6743" class="indexterm"></a>JavaScript as efficiently as possible for all
  browsers.<sup>[<a id="CHP-7-FNOTE-1" href="#ftn.CHP-7-FNOTE-1" class="footnote">22</a>]</sup></p>
  
  <div class="bookpromo">
<a href="http://oreilly.com/catalog/9780596522308/">
<img src="http://covers.oreilly.com/images/9780596522308/thumb.gif" alt="Even Faster Web Sites book cover" /></a>


<p>This excerpt is from <strong><a href="http://oreilly.com/catalog/9780596522308/">Even Faster Web Sites </a></strong>. 

<p>Souders and eight expert contributors provide best practices and pragmatic advice for improving your site's performance in three critical categories: JavaScript, in the 
network, and in the browser.</p>

<a href="http://oreilly.com/catalog/9780596522308/"><img src="http://oreillynet.com/images/buyitnow-button.png" alt="buy button" /></a>

</div>
  
  <p>This chapter covers some of the hidden performance issues in
  JavaScript and how to address them. Some changes concern small code
  structure issues while others may require revisiting your algorithm. The
  important thing to remember is that there is no silver bullet when trying to
  improve performance; no one thing will work in 100% of the cases. Only when
  various techniques are combined can you realize the largest <span class="keep-together">performance</span> improvement.</p><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="managing_scope"></a>Managing Scope</h2></div></div></div><p>When JavaScript code <a id="java7.1" class="indexterm"></a><a id="per7.1" class="indexterm"></a><a id="exe7.1" class="indexterm"></a>is being executed, an <span class="emphasis"><em>execution context</em></span>

    is created. The <a id="I_indexterm7_d1e6781" class="indexterm"></a>execution context (also sometimes called the
    <span class="emphasis"><em>scope</em></span>) defines <a id="I_indexterm7_d1e6791" class="indexterm"></a>the environment in which code is to be executed. A global
    execution context is created upon page load, and additional execution
    contexts are created as functions are executed, ultimately creating an
    execution context stack where the topmost context is the active
    one.</p>

<!--ONJava MPU Ad -->



<!-- me -->

<p>Each execution context has a<a id="I_indexterm7_d1e6799" class="indexterm"></a><a id="I_indexterm7_d1e6804" class="indexterm"></a> <span class="emphasis"><em>scope chain</em></span> associated with it, which
    is used for identifier resolution. The scope chain contains one or more
    variable objects that define in-scope identifiers for the execution
    context. The global execution context has only one variable object in its
    scope chain, and this object defines all of the <a id="I_indexterm7_d1e6813" class="indexterm"></a><a id="I_indexterm7_d1e6818" class="indexterm"></a><a id="I_indexterm7_d1e6821" class="indexterm"></a><a id="I_indexterm7_d1e6826" class="indexterm"></a><a id="I_indexterm7_d1e6831" class="indexterm"></a>global variables and functions available in JavaScript. When
    a <a id="I_indexterm7_d1e6838" class="indexterm"></a>function is created (but not executed), its internal
    <code class="literal">[[Scope]]</code> property is assigned to
    contain the scope chain of the execution context in which it was created
    (internal properties cannot be accessed through JavaScript, so you cannot
    access this property directly). Later, when execution flows into a
    function, an activation object is created and initialized with values for
    <code class="literal">this</code>, <code class="literal">arguments</code>, named <span class="keep-together">arguments</span>, and any variables local to the
    function. The activation object appears first in the execution context&#8217;s
    scope chain and is followed by the objects contained in the function&#8217;s
    <code class="literal">[[Scope]]</code> property.</p><p>During code execution, identifiers such as variable and function
    names are resolved by searching the scope chain of the execution context.
    Identifier resolution begins at the front of the scope chain and proceeds
    toward the back. Consider the following code:</p><a id="I_programlisting7_d1e6861"></a><pre class="programlisting">function add(num1, num2){
    return num1 + num2;
}

var result = add(5, 10);</pre><p>When this code is executed, the <code class="literal">add</code> function has a <code class="literal">[[Scope]]</code> property that contains only the global
    variable object. As execution flows into the <code class="literal">add</code> function, a new execution context is
    created, and an activation object containing <code class="literal">this</code>, <code class="literal">arguments</code>, <code class="literal">num1</code>, and <code class="literal">num2</code> is placed into the scope chain. <a class="xref" href="#relationship_of_execution_context_and_sc" title="Figure&#xA0;7.1.&#xA0;Relationship of execution context and scope chain">Figure&#160;7.1, &#8220;Relationship of execution context and scope chain&#8221;</a> illustrates the
    behind-the-scenes object relationships that occur while the <code class="literal">add</code> function is being executed.</p><div class="figure-float"><div class="figure"><a id="relationship_of_execution_context_and_sc"></a><p class="title"><b>Figure&#160;7.1.&#160;Relationship of execution context and scope chain</b></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e6895"></a><img src="http://figures.oreilly.com/tagoreillycom20090601oreillybooks300541I_book_d1e1/figs/I_mediaobject7_d1e6895-web.png" alt="Relationship of execution context and scope chain" /></div></div></div><br class="figure-break" /></div><p>Inside the <code class="literal">add</code> function, the
    identifiers <code class="literal">num1</code> and <code class="literal">num2</code> need to be resolved when the function is
    executing. This resolution is performed by inspecting each object in the
    scope chain until the specific identifier is found. The search begins at
    the first object in the scope chain, which is the activation object
    containing the local variables for the function. If the identifier isn&#8217;t
    found there, the next object in the scope chain is inspected for the
    identifier. When the identifier is found, the search stops. In the case of
    this example, the identifiers <code class="literal">num1</code> and
    <code class="literal">num2</code> exist in the local activation
    object and so the search never goes on to the global object.</p><p>Understanding scopes and scope chain management in JavaScript is
    important because identifier resolution performance is directly related to
    the number of objects to search in the scope chain. The farther up the
    scope chain an identifier exists, the longer the search goes on and the
    longer it takes to access that variable; if scopes aren&#8217;t managed
    properly, they can negatively affect the execution time of your
    script.</p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="use_local_variables"></a>Use Local Variables</h3></div></div></div><p>Local variables are, by far, <a id="I_indexterm7_d1e6925" class="indexterm"></a><a id="I_indexterm7_d1e6928" class="indexterm"></a>the fastest identifiers both to read from and write to in
      JavaScript. Because they exist in the activation object of the executing
      function, identifier resolution involves inspecting a single object in
      the <a id="I_indexterm7_d1e6934" class="indexterm"></a>scope chain. The amount of time necessary to read the
      value of a variable increases with each step along the scope chain, so
      the greater the identifier depth, the slower the access is going to be.
      This effect can be seen in every <a id="I_indexterm7_d1e6940" class="indexterm"></a><a id="I_indexterm7_d1e6945" class="indexterm"></a>browser except Google Chrome using v8 and <a id="I_indexterm7_d1e6951" class="indexterm"></a>Safari 4+ using the<a id="I_indexterm7_d1e6958" class="indexterm"></a> Nitro JavaScript engine, both of which are so fast that
      the identifier depth has little effect on access speed.</p><p>To determine the exact performance impact of identifier depth, I
      ran an experiment involving 200,000 variable operations. I alternated
      between reads and writes, accessing the variables from different
      identifier depths. The page I used for this experiment <span class="keep-together">is located at</span> <a class="ulink" href="http://www.nczonline.net/experiments/javascript/performance/identifier-depth/" target="_top">http://www.nczonline.net/experiments/javascript/performance/identifier-depth/</a>.</p><p><a class="xref" href="#variable_read_time_compared_to_identifie" title="Figure&#xA0;7.2.&#xA0;Variable read time compared to identifier depth">Figure&#160;7.2, &#8220;Variable read time compared to identifier depth&#8221;</a>

      illustrates the amount of time it takes to write to a variable based on
      scope chain depth, and <a class="xref" href="#variable_write_time_compared_to_identifi" title="Figure&#xA0;7.3.&#xA0;Variable write time compared to identifier depth">Figure&#160;7.3, &#8220;Variable write time compared to identifier depth&#8221;</a> illustrates the
      amount of time it takes to read from an identifier based on its scope
      chain depth (a depth of 1 signifies a local identifier).</p><div class="figure-float"><div class="figure"><a id="variable_read_time_compared_to_identifie"></a><p class="title"><b>Figure&#160;7.2.&#160;Variable read time compared to identifier depth</b></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e6977"></a><img src="http://figures.oreilly.com/tagoreillycom20090601oreillybooks300541I_book_d1e1/figs/I_mediaobject7_d1e6977-web.png" alt="Variable read time compared to identifier depth" /></div></div></div><br class="figure-break" /></div><div class="figure-float"><div class="figure"><a id="variable_write_time_compared_to_identifi"></a><p class="title"><b>Figure&#160;7.3.&#160;Variable write time compared to identifier depth</b></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e6985"></a><img src="http://figures.oreilly.com/tagoreillycom20090601oreillybooks300541I_book_d1e1/figs/I_mediaobject7_d1e6985-web.png" alt="Variable write time compared to identifier depth" /></div></div></div><br class="figure-break" /></div><p>As these figures clearly indicate, identifiers are accessed
      significantly faster when they are higher in the scope chain. You can
      take advantage of this knowledge by using local variables whenever
      possible. A good rule of thumb is to store any out-of-scope variables in
      a local variable whenever it&#8217;s used more than once within the function.
      For example:</p><a id="I_programlisting7_d1e6993"></a><pre class="programlisting">function createChildFor(elementId){
    var element = document.getElementById(elementId),
        newElement = document.createElement("div");

    element.appendChild(newElement);
}</pre><p>This function has two references to the global variable<a id="I_indexterm7_d1e6997" class="indexterm"></a> <code class="literal">document</code>. Since
      <code class="literal">document</code> is being used more than
      once, it should be stored in a local variable for faster reference, such
      as here:</p><a id="I_programlisting7_d1e7007"></a><pre class="programlisting">function createChildFor(elementId){
    var doc = document,  //store in a local variable
        element = doc.getElementById(elementId),
        newElement = doc.createElement("div");

    element.appendChild(newElement);
}</pre><p>The rewritten version of the function stores <code class="literal">document</code> in a local variable called <code class="literal">doc</code>. Since <code class="literal">doc</code> exists in the first part of the scope
      chain, it can be resolved faster than <code class="literal">document</code>. Keep in mind that the global
      variable object is always the last object in the scope chain, and so
      global identifier resolution is always the most expensive.</p><div class="note"><h3 class="title"><a id="note-3"></a>Note</h3><p>A very common mistake that leads to performance issues is to
        omit the <code class="literal">var</code> keyword when assigning
        a variable&#8217;s value for the first time. Assignment to an undeclared
        variable automatically results in a global variable being
        created.</p></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="scope_chain_augmentation"></a>Scope Chain Augmentation</h3></div></div></div><p>The scope chain <a id="scope7.1.2" class="indexterm"></a>for a given execution context typically remains unchanged
      during code execution. There are, however, two statements that
      temporarily augment the scope chain of an execution context. The first
      is the <code class="literal">with</code> statement, <a id="I_indexterm7_d1e7045" class="indexterm"></a>which is designed to allow easy access to object
      properties by making them appear as local variables. For example:</p><a id="I_programlisting7_d1e7049"></a><pre class="programlisting">var person = {
    name: "Nicholas",
    age: 30
};

function displayInfo(){
    var count = 5;
    with(person){
        alert(name + " is " + age);
        alert("Count is " + count);
    }
}

displayInfo();</pre><p>In this code, the <code class="literal">person</code> object
      is passed into a <code class="literal">with</code> block. This
      allows you to access the <code class="literal">name</code> and
      <code class="literal">age</code> properties as though they were
      locally defined. What actually happens, though, is that a new variable
      object is pushed to the front of the execution context&#8217;s scope chain.
      This variable object contains all of the properties of the specified
      object (in this case, <code class="literal">person</code>) so that
      they can be accessed without using dot notation. <a class="xref" href="#scope_chain_augmentation_using_the_with_" title="Figure&#xA0;7.4.&#xA0;Scope chain augmentation using the with statement">Figure&#160;7.4, &#8220;Scope chain augmentation using the with statement&#8221;</a> shows how the
      scope chain for <code class="literal">displayInfo</code> is
      augmented while the <code class="literal">with</code> statement is
      being executed.</p><div class="figure-float"><div class="figure"><a id="scope_chain_augmentation_using_the_with_"></a><p class="title"><b>Figure&#160;7.4.&#160;Scope chain augmentation using the with statement</b></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e7080"></a><img src="http://figures.oreilly.com/tagoreillycom20090601oreillybooks300541I_book_d1e1/figs/I_mediaobject7_d1e7080-web.png" alt="Scope chain augmentation using the with statement" /></div></div></div><br class="figure-break" /></div><p>Though it seems very convenient when an object&#8217;s properties are
      being used repeatedly, this extra object in the scope chain hurts local
      identifier resolution. While code within a <code class="literal">with</code> statement is being executed, the local
      function variables now exist in the <span class="keep-together">second</span> object in the scope chain instead
      of the first, automatically slowing down identifier access. In the
      previous example, the <code class="literal">count</code> variable
      now takes longer to access because it&#8217;s not in the first object of the
      scope chain. Once the <code class="literal">with</code> statement
      finishes executing, the scope chain is restored to its previous state.
      Due to this major downside, it&#8217;s <span class="keep-together">recommended</span> to <span class="emphasis"><em>avoid</em></span>

      using the <code class="literal">with</code> statement.</p><p>The second statement that augments the scope chain is
      the<a id="I_indexterm7_d1e7112" class="indexterm"></a> <code class="literal">catch</code> clause of a
      <code class="literal">try</code>-<code class="literal">catch</code> block. The <code class="literal">catch</code> clause behaves in a manner similar to
      the <code class="literal">with</code> statement where it adds a
      variable object to the front of the scope chain while it executes the
      code in the block. That variable object contains an entry for the named
      exception object specified by <code class="literal">catch</code>.
      However, the <code class="literal">catch</code> clause is executed
      only when an error occurs during execution of the <code class="literal">try</code> clause, making it somewhat less
      problematic than the <code class="literal">with</code> statement,
      though you should take care not to execute too much code within the
      <code class="literal">catch</code> clause to minimize the
      performance impact.</p><p>Minding scope chain depth is an easy way to get performance
      improvements with a small amount of work. Avoid unnecessarily augmenting
      the scope chain and inadvertently slowing down <a id="I_indexterm7_d1e7149" class="indexterm"></a><a id="I_indexterm7_d1e7151" class="indexterm"></a><a id="I_indexterm7_d1e7153" class="indexterm"></a><a id="I_indexterm7_d1e7155" class="indexterm"></a>execution.</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="efficient_data_access"></a>Efficient Data Access</h2></div></div></div><p>Where <a id="data7.2" class="indexterm"></a><a id="storing7.2" class="indexterm"></a>data is <a id="java7.2" class="indexterm"></a><a id="per7.2" class="indexterm"></a>stored in a script contributes directly to the amount of
    time it takes to execute. In general, there are four places from which
    data can be accessed in a script:</p><div class="itemizedlist"><ul><li><p>Literal value</p></li><li><p>Variable</p></li><li><p>Array item</p></li><li><p>Object property</p></li></ul></div><p>Reading data <a id="I_indexterm7_d1e7196" class="indexterm"></a>always incurs a <a id="I_indexterm7_d1e7200" class="indexterm"></a>performance cost, and that cost depends on which of these
    four locations the data is stored in.</p><p>In most browsers, the cost of reading a value from a literal versus
    a <a id="I_indexterm7_d1e7208" class="indexterm"></a><a id="I_indexterm7_d1e7211" class="indexterm"></a>local variable is so small as to be negligible; you should
    feel free to mix and match <a id="I_indexterm7_d1e7217" class="indexterm"></a>literals and local variables without worrying about a
    performance penalty. The real difference comes when you move to reading
    data from an array or object. Accessing values from one of these data
    structures requires a lookup of the location in which the data is stored,
    either by index (for array) or by property name (for objects).</p><p>To test the data access times based on data location, I created an
    experiment that reads values from each of these locations 200,000 times.
    You can find the experiment online at <a class="ulink" href="http://www.nczonline.net/experiments/javascript/performance/data-access/" target="_top">http://www.nczonline.net/experiments/javascript/performance/data-access/</a>.
    The result of running this experiment on multiple <a id="I_indexterm7_d1e7225" class="indexterm"></a>browsers is that there is almost an even split across
    browsers as to which is faster: <a id="I_indexterm7_d1e7231" class="indexterm"></a><a id="I_indexterm7_d1e7236" class="indexterm"></a>Internet Explorer, Opera, and <a id="I_indexterm7_d1e7242" class="indexterm"></a>Firefox 3 all access array items faster than object
    properties; <a id="I_indexterm7_d1e7248" class="indexterm"></a>Chrome, <a id="I_indexterm7_d1e7255" class="indexterm"></a>Safari, Firefox 2, and Firefox 3.1+ access object properties
    faster than array items (see <a class="xref" href="#data_access_time_across_browsers" title="Figure&#xA0;7.5.&#xA0;Data access time across browsers">Figure&#160;7.5, &#8220;Data access time across browsers&#8221;</a>).</p><div class="figure-float"><div class="figure"><a id="data_access_time_across_browsers"></a><p class="title"><b>Figure&#160;7.5.&#160;Data access time across browsers</b></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e7266"></a><img src="http://figures.oreilly.com/tagoreillycom20090601oreillybooks300541I_book_d1e1/figs/I_mediaobject7_d1e7266-web.png" alt="Data access time across browsers" /></div></div></div><br class="figure-break" /></div><p>The important lesson to take from this information is to always
    store frequently <span class="keep-together">accessed</span> values in
    a local variable. Consider the following code:</p><a id="I_programlisting7_d1e7276"></a><pre class="programlisting">function process(data){
    if (data.count &gt; 0){
        for (var i=0; i &lt; data.count; i++){
            processData(data.item[i]);
        }
    }
}</pre><p>This snippet accesses the value of <code class="literal">data.count</code> multiple times. At first glance, it
    looks like this value is used twice: once in the <code class="literal">if</code> statement and once in the <code class="literal">for</code> loop. In reality, though, <code class="literal">data.count</code> is accessed <code class="literal">data.count</code> plus 1 times in this function, since
    the control statement (<code class="literal">i &lt;

    data.count</code>) is executed each time through the loop. The function
    will run faster if this value is stored in a local variable and then
    accessed from there:</p><a id="I_programlisting7_d1e7299"></a><pre class="programlisting">function process(data){
<span class="strong"><strong>    var count = data.count;</strong></span>
<span class="strong"><strong>    if (count &gt; 0){</strong></span>
<span class="strong"><strong>        for (var i=0; i &lt; count; i++){</strong></span>

            processData(data.item[i]);
        }
    }
}</pre><p>The rewritten version of this function accesses <code class="literal">data.count</code> only once, at the beginning in order
    to store it in a local variable. The local variable <code class="literal">count</code> is used in its place <span class="keep-together">elsewhere</span> in the function, limiting the
    number of times an object property must be accessed to retrieve this
    value. This function will run faster than the previous function because
    the number of object property lookups has been reduced.</p><p>The effect of data access is exaggerated as the value&#8217;s data
    structure depth increases. For example, <code class="literal">data.count</code> is faster to access than <code class="literal">data.item.count</code>, which is faster to access than
    <code class="literal">data.item.subitem.count</code>. When dealing
    with properties, the number of times a dot is used (for property lookup)
    directly relates to the amount of time it takes to access that value.
    <a class="xref" href="#access_times_for_object_properties_by_de" title="Figure&#xA0;7.6.&#xA0;Access times for object properties by depth">Figure&#160;7.6, &#8220;Access times for object properties by depth&#8221;</a> shows the
    relative data access times by property depth across browsers. The tests
    for this research are part of the data access experiment <span class="keep-together">located</span> at <a class="ulink" href="http://www.nczonline.net/experiments/javascript/performance/data-access/" target="_top">http://www.nczonline.net/experiments/javascript/performance/data-access/</a>.</p><div class="figure-float"><div class="figure"><a id="access_times_for_object_properties_by_de"></a><p class="title"><b>Figure&#160;7.6.&#160;Access times for object properties by depth</b></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e7344"></a><img src="http://figures.oreilly.com/tagoreillycom20090601oreillybooks300541I_book_d1e1/figs/I_mediaobject7_d1e7344-web.png" alt="Access times for object properties by depth" /></div></div></div><br class="figure-break" /></div><p>A good approach to take when dealing with data access is to store in
    a local variable any object property or array item that is used more than
    once in a function.</p><div class="note"><h3 class="title"><a id="note-4"></a>Note</h3><p>For most browsers, there is virtually no difference between using
      dot notation for object property access (<code class="literal">data.count</code>) and bracket notation (<code class="literal">data["count"]</code>). The one exception is Safari,
      where bracket notation is significantly slower than dot notation. This
      holds true even for Safari 4 and later using the Nitro JavaScript
      engine.</p></div><p>Using local variables is especially important when dealing with
    <code class="literal">HTMLCollection</code> objects (those returned
    from <a id="I_indexterm7_d1e7365" class="indexterm"></a>DOM methods such as<a id="I_indexterm7_d1e7371" class="indexterm"></a> <code class="literal">getElementsByTagName</code> and
    properties such as <code class="literal">element.childNodes</code>).
    Each<a id="I_indexterm7_d1e7382" class="indexterm"></a> <code class="literal">HTMLCollection</code> object is
    actually a live query being run against the DOM document every time a
    property is accessed. For example:</p><a id="I_programlisting7_d1e7389"></a><pre class="programlisting">var divs = document.getElementsByTagName("div");
for (var i=0; i &lt; divs.length; i++){  //Avoid!
    var div = divs[i];
    process(div);
}</pre><p>The first line of this code creates a query that returns
    every<a id="I_indexterm7_d1e7393" class="indexterm"></a> <code class="literal">&lt;div&gt;</code> element on
    the page and stores that query in <code class="literal">divs</code>.
    Each time <code class="literal">divs</code> has a property accessed
    either by name or by index, the DOM actually reexecutes that query against
    the entire page; in this code, it occurs each time <code class="literal">divs.length</code> or <code class="literal">divs[i]</code> is accessed. These property lookups take
    longer than the average non-DOM object property or array item lookup. It&#8217;s
    therefore important to store such values in local variables whenever
    possible to avoid the requerying penalty associated with <code class="literal">HTMLCollection</code> objects. For example:</p><a id="I_programlisting7_d1e7416"></a><pre class="programlisting">var divs = document.getElementsByTagName("div");
for (var i=0, len=divs.length; i &lt; len; i++){  //Better
    var div = divs[i];
    process(div);
}</pre><p>This example stores the length of the <code class="literal">divs
    HTMLCollection</code> in a local variable, limiting the number of times
    the object is accessed directly. In the previous version of this code,
    <code class="literal">divs</code> was accessed twice per iteration:
    once to retrieve the object in the given position, and once to check the
    length. This new version eliminates direct length-checking with each
    <a id="I_indexterm7_d1e7426" class="indexterm"></a><a id="I_indexterm7_d1e7428" class="indexterm"></a><a id="I_indexterm7_d1e7430" class="indexterm"></a><a id="I_indexterm7_d1e7432" class="indexterm"></a><a id="I_indexterm7_d1e7434" class="indexterm"></a>iteration.</p><div class="note"><h3 class="title"><a id="note-5"></a>Note</h3><p>Generally speaking, interacting with DOM objects is always more
      expensive than interacting with non-DOM objects. Due to DOM behavior,
      property lookups typically take longer than non-DOM property lookups.
      The <code class="literal">HTMLCollection</code> object is the
      worst-performing object in the DOM. If you need to repeatedly access
      members of an <code class="literal">HTMLCollection</code>, it is more efficient to
      copy them into an array first.</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="flow_control"></a>Flow Control</h2></div></div></div><p>Next to data <a id="java7.3" class="indexterm"></a><a id="per7.3" class="indexterm"></a><a id="flow7.3" class="indexterm"></a>access, flow control is perhaps the most important aspect of
    JavaScript relating to performance. JavaScript, as with most programming
    languages, has a number of flow control statements that determine which
    part of the code should be executed next. There&#8217;s a series of conditional
    and loop statements that enable developers to precisely control how
    execution flows from one part of the code to another. Choosing the right
    option at each point can dramatically affect how fast your script
    runs.</p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="fast_conditionals"></a>Fast Conditionals</h3></div></div></div><p>The classic question of whether to use a <code class="literal">switch</code> statement or a series of <code class="literal">if</code> and <code class="literal">else</code>

      statements is not unique to JavaScript and has spurred discussions in
      nearly every programming language that has these constructs. The real
      issue is not between individual statements, of course, but rather
      relates to the speed with which each is able to handle a range of
      conditional statements. The details of this section are based on tests
      that you can run at <a class="ulink" href="http://www.nczonline.net/experiments/javascript/performance/conditional-branching/" target="_top">http://www.nczonline.net/experiments/javascript/performance/conditional-branching/</a>.</p><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="the_if_statement"></a>The if statement</h4></div></div></div><p>Discussions <a id="con7.3.1.1" class="indexterm"></a><a id="if7.3.1.1" class="indexterm"></a>usually begin surrounding complex <code class="literal">if</code> statements such as this:</p><a id="I_programlisting7_d1e7499"></a><pre class="programlisting">if (value == 0){
    return result0;
} else if (value == 1){
    return result1;
} else if (value == 2){
    return result2;
} else if (value == 3){
    return result3;
} else if (value == 4){
    return result4;
} else if (value == 5){
    return result5;
} else if (value == 6){
    return result6;
} else if (value == 7){
    return result7;
} else if (value == 8){
    return result8;
} else if (value == 9){
    return result9;
} else {
    return result10;
}</pre><p>Typically, this type of construct is frowned upon. The major
        problem is that the deeper into the statement the execution flows, the
        more conditions have to be evaluated. It will take longer to complete
        the execution when <code class="literal">value</code> is 9 than
        if <code class="literal">value</code> is 0 because every other
        condition must be evaluated beforehand. As the overall number of
        conditions increases, so does the performance hit for going deep into
        the conditions. While having a large number of <code class="literal">if</code> conditions isn&#8217;t advisable, there are
        steps you can take to increase the overall performance.</p><p>The first step is to arrange the conditions in decreasing order
        of frequency. Since exiting after the first condition is the fastest
        operation, you want to make sure that happens as often as possible.
        Suppose the most common case in the previous example is that <code class="literal">value</code> will equal 5 and the second most
        common is that <code class="literal">value</code> will equal 9.
        In that case, you know five conditions will be evaluated before
        getting to the most common case and nine before getting to the second
        most common case; this is incredibly inefficient. Even though the
        increasing numeric order of the conditions makes it easier to read, it
        should actually be rewritten as follows:</p><a id="I_programlisting7_d1e7521"></a><pre class="programlisting"><span class="strong"><strong>if (value == 5){</strong></span>

<span class="strong"><strong>    return result5;</strong></span>
<span class="strong"><strong>} else if (value == 9){</strong></span>
<span class="strong"><strong>    return result9;</strong></span>
} else if (value == 0){
    return result0;
} else if (value == 1){
    return result1;
} else if (value == 2){
    return result2;
} else if (value == 3){
    return result3;
} else if (value == 4){
    return result4;
} else if (value == 6){
    return result6;
} else if (value == 7){
    return result7;
} else if (value == 8){
    return result8;
} else {
    return result10;
}</pre><p>Now the two most common conditions appear at the top of the
        <code class="literal">if</code> statement, ensuring optimal
        performance for these cases.</p><p>Another way to optimize <code class="literal">if</code>
        statements is to organize the conditions into a series of branches,
        following a binary search algorithm to find the valid condition. This
        is advisable in the case where a large number of conditions are
        possible and no one or two will occur with a high enough rate to
        simply order according to frequency. The goal is to minimize the
        number of conditions to be evaluated for as many of the conditions as
        possible. If all of the conditions for <code class="literal">value</code> in the example will occur with the
        same relative frequency, the <code class="literal">if</code>

        statements can be rewritten as follows:</p><a id="I_programlisting7_d1e7550"></a><pre class="programlisting">if (value &lt; 6){

    if (value &lt; 3){
        if (value == 0){
            return result0;
        } else if (value == 1){
            return result1;
        } else {
            return result2;
        }
    } else {
        if (value == 3){
            return result3;
        } else if (value == 4){
            return result4;
        } else {
            return result5;
        }
    }

} else {

    if (value &lt; 8){
        if (value == 6){
            return result6;
        } else {
            return result7;
        }
    } else {
        if (value == 8){
            return result8;
        } else if (value == 9){
            return result9;
        } else {
            return result10;
        }

    }
}</pre><p>This code ensures that there will never be any more than four
        conditions evaluated. Instead of evaluating each condition to find the
        right value, the conditions are separated first into a series of
        ranges before identifying the actual value. The overall performance of
        this example is improved because the cases where eight and nine
        conditions need to be evaluated have been removed. The maximum number
        of condition evaluations is now four, creating an average savings of
        about 30% off the execution time of the previous version. Keep in
        mind, also, that an <code class="literal">else</code> statement
        has no condition to evaluate. However, the problem remains that each
        additional condition ends up taking more time to execute, affecting
        not only the performance but also the maintainability of this code.
        This is where the <code class="literal">switch</code> statement
        comes <a id="I_indexterm7_d1e7560" class="indexterm"></a><a id="I_indexterm7_d1e7562" class="indexterm"></a>in.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="the_switch_statement"></a>The switch statement</h4></div></div></div><p>The <code class="literal">switch</code> statement
        <a id="I_indexterm7_d1e7573" class="indexterm"></a><a id="I_indexterm7_d1e7578" class="indexterm"></a>simplifies both the appearance and the performance of
        multiple conditions. You can rewrite the previous example using a
        <code class="literal">switch</code> statement as follows:</p><a id="I_programlisting7_d1e7585"></a><pre class="programlisting">switch(value){
    case 0:
        return result0;
    case 1:
        return result1;
    case 2:
        return result2;
    case 3:
        return result3;
    case 4:
        return result4;
    case 5:
        return result5;
    case 6:
        return result6;
    case 7:
        return result7;
    case 8:
        return result8;
    case 9:
        return result9;
    default:
        return result10;
}</pre><p>This code clearly indicates the conditions as well as the return
        values in an arguably more readable form. The <code class="literal">switch</code> statement has the added benefit of
        allowing fall-through conditions, which allow you to specify the same
        result for a number of different values without creating complex
        nested conditions. The <code class="literal">switch</code>

        statement is often cited in other programming languages as the
        hands-down better option for evaluating multiple conditions. This
        isn&#8217;t because of the nature of the <code class="literal">switch</code> statement, but rather because of how
        compilers are able to optimize <code class="literal">switch</code> statements for faster evaluation.
        Since most JavaScript engines don&#8217;t have such optimizations,
        performance of the <code class="literal">switch</code> statement
        is mixed.</p><p>Firefox <a id="I_indexterm7_d1e7606" class="indexterm"></a><a id="I_indexterm7_d1e7611" class="indexterm"></a>handles <code class="literal">switch</code>

        statements very well, with each condition&#8217;s evaluation executing in
        roughly the same amount of time regardless of the order in which they
        are defined. That means the case of <code class="literal">value</code> equal to 0 will take roughly the same
        amount of time to execute as when <code class="literal">value</code> is 9. Other browsers, however, aren&#8217;t
        nearly as good. <a id="I_indexterm7_d1e7626" class="indexterm"></a><a id="I_indexterm7_d1e7632" class="indexterm"></a><a id="I_indexterm7_d1e7637" class="indexterm"></a><a id="I_indexterm7_d1e7642" class="indexterm"></a>Internet Explorer, Opera, Safari, and Chrome all show
        noticeable increases in the execution time as you get deeper into the
        <code class="literal">switch</code> statement. Those increases,
        however, are smaller than the increases experienced with each
        additional condition of an <code class="literal">if</code>
        statement. You can therefore improve the performance of <code class="literal">switch</code> statements by ordering the conditions
        in decreasing rate of frequency (the same as <code class="literal">if</code> statement optimization).</p><p>In JavaScript, <code class="literal">if</code> statements
        <a id="I_indexterm7_d1e7665" class="indexterm"></a><a id="I_indexterm7_d1e7668" class="indexterm"></a>are generally faster than <code class="literal">switch</code> statements when there are just
        <span class="emphasis"><em>one or two conditions</em></span> to be evaluated. When there
        are more than two conditions, and the conditions are simple (not
        ranges), the <code class="literal">switch</code> statement tends
        to be faster. This is because the amount of time it takes to execute a
        single condition in a <code class="literal">switch</code>

        statement is often less than it takes to execute a single condition in
        an <code class="literal">if</code> statement, making the
        <code class="literal">switch</code> statement optimal only when
        there are a larger number of conditions.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="another_option_array_lookup"></a>Another option: Array lookup</h4></div></div></div><p>There are more than <a id="I_indexterm7_d1e7698" class="indexterm"></a><a id="I_indexterm7_d1e7703" class="indexterm"></a>two solutions for dealing with conditionals in
        JavaScript. Alongside the <code class="literal">if</code>
        statement and the <code class="literal">switch</code> statement
        is a third approach: looking up values in arrays. The example for this
        section maps a given number to a specific result, which is exactly
        what arrays are for. Instead of writing a large <code class="literal">if</code> statement or <code class="literal">switch</code> statement, you can use the following
        code:</p><a id="I_programlisting7_d1e7721"></a><pre class="programlisting">//define the array of results
var results = [result0, result1, result2, result3, result4, result5, result6,
result7,
               result8, result9, result10]

//return the correct result
return results[value];</pre><p>Instead of using conditional statements, all of the results are
        stored in an array whose index maps to the <code class="literal">value</code> variable. Retrieving the appropriate
        result is simply a matter of array value lookup. Although array lookup
        times also increase the deeper into the array you go, the incremental
        increase is so small that it is irrelevant relative to the increases
        in each condition evaluation for <code class="literal">if</code>

        and <code class="literal">switch</code> statements. This makes
        array lookup ideal whenever there are a large number of conditions to
        be met, and the conditions can be represented by discrete values such
        as numbers or strings (for strings, you can use an <code class="literal">Object</code> to store the results rather than an
        <code class="literal">Array</code>).</p><p>It&#8217;s not practical to use array lookup for small numbers of
        results because array lookup is often slower than evaluating a small
        number of conditions. Array lookups can be very helpful when there are
        a large number of ranges because they eliminate the need to test both
        upper and lower bounds; you can simply fill in that range of indexes
        in the array with the appropriate value and do a straight array
        lookup.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="the_fastest_conditionals"></a>The fastest conditionals</h4></div></div></div><p>The three techniques presented here&#8212;the <code class="literal">if</code> statement, the <code class="literal">switch</code> statement, and array lookup&#8212;each have
        their uses in optimizing code execution:</p><div class="itemizedlist"><ul><li><p>Use <a id="I_indexterm7_d1e7757" class="indexterm"></a><a id="I_indexterm7_d1e7760" class="indexterm"></a>the <code class="literal">if</code> statement
            when:</p><div class="itemizedlist"><ul><li><p>There are no more than two discrete values for which to
                test.</p></li><li><p>There are a large number of values that can be easily
                separated into ranges.</p></li></ul></div></li><li><p>Use the <code class="literal">switch</code> statement
            when:</p><div class="itemizedlist"><ul><li><p>There <a id="I_indexterm7_d1e7786" class="indexterm"></a><a id="I_indexterm7_d1e7789" class="indexterm"></a>are more than two but fewer than 10 discrete
                values for which to test.</p></li><li><p>There are no ranges for conditions because the values
                are nonlinear.</p></li></ul></div></li><li><p>Use array lookup when:</p><div class="itemizedlist"><ul><li><p>There <a id="I_indexterm7_d1e7805" class="indexterm"></a><a id="I_indexterm7_d1e7810" class="indexterm"></a>are more than 10 values for which to
                test.</p></li><li><p>The results of the conditions are single values rather
                than a number of actions to be taken.</p></li></ul></div></li></ul></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="fast_loops"></a>Fast Loops</h3></div></div></div><p>As mentioned in <a class="xref" href="#understanding_ajax_performance" title="Chapter&#xA0;1.&#xA0;Understanding Ajax Performance">Chapter&#160;1, <i>Understanding Ajax Performance</i></a>,
      loops are a frequent source of performance issues in JavaScript, and the
      way you write loops drastically changes its execution time. Once again,
      JavaScript developers don&#8217;t get to rely on compiler optimizations that
      make loops faster regardless of the initial code, so it&#8217;s important to
      understand the various ways to write loops and how they affect
      performance.</p><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="simple_loop_performance_boosts"></a>Simple loop performance boosts</h4></div></div></div><p>There are <a id="loops7.3.2" class="indexterm"></a><a id="per7.3.2" class="indexterm"></a>four different types of loops in JavaScript. In this
        section, we will discuss three of them: the<a id="for7.3.2.1" class="indexterm"></a><a id="loops7.3.2.1a" class="indexterm"></a> <code class="literal">for</code> loop,
        the<a id="do7.3.2.1" class="indexterm"></a><a id="loops7.3.2.1b" class="indexterm"></a> <code class="literal">do</code>-<code class="literal">while</code> loop, and the<a id="while7.3.2.1" class="indexterm"></a><a id="loops7.3.2.1c" class="indexterm"></a> <code class="literal">while</code> loop. (The
        fourth type is a<a id="I_indexterm7_d1e7882" class="indexterm"></a><a id="I_indexterm7_d1e7887" class="indexterm"></a> <code class="literal">for</code>-<code class="literal">in</code> loop that is used to iterate over object
        properties, but I won&#8217;t cover it here because its purpose is very
        unique.) The various loop types are coded as follows:</p><a id="I_programlisting7_d1e7898"></a><pre class="programlisting">//unoptimized code
var values = [1,2,3,4,5];

//for loop
for (var i=0; i &lt; values.length; i++){
    process(values[i]);
}

//do-while loop
var j=0;
do {
    process(values[j++]);
} while (j &lt; values.length);

//while loop
var k=0;
while (k &lt; values.length){
    process(values[k++]);
}</pre><p>Each of the loops in this example achieves the same result: all
        items in the <code class="literal">values</code> array are
        passed into the <code class="literal">process</code> function.
        These are the most common constructs used for iterating over a number
        of values in an array. Each of these loops runs in about the same
        amount of time because they&#8217;re doing roughly the same amount of work.
        There are, however, ways to improve the performance.</p><p>Perhaps the most glaring issue in each loop is the constant
        comparison of the iterator variable against the array length. As
        mentioned earlier in this chapter, property lookup is a much more
        expensive operation than local variable access. This code is
        retrieving the value of <code class="literal">values.length</code> every time the loop executes
        to see whether the terminal condition has been reached. This is
        incredibly inefficient given that the length of the array won&#8217;t change
        while the loop is being executed. Using a local variable instead of a
        property lookup can speed up the loops:</p><a id="I_programlisting7_d1e7913"></a><pre class="programlisting">var values = [1,2,3,4,5];

<span class="strong"><strong>var length = values.length;</strong></span>

//for loop
<span class="strong"><strong>for (var i=0; i &lt; length; i++){</strong></span>
    process(values[i]);
}

//do-while loop
var j=0;
do {
    process(values[j++]);
<span class="strong"><strong>} while (j &lt; length);</strong></span>

//while loop
var k=0;
<span class="strong"><strong>while (k &lt; length){</strong></span>

    process(values[k++]);
}</pre><p>Each loop now uses the local variable <code class="literal">length</code> as its comparison point instead of
        <code class="literal">values.length</code>,
        eliminating a property lookup each time through the loop. This
        technique is especially important when dealing with<a id="I_indexterm7_d1e7935" class="indexterm"></a> <code class="literal">HTMLCollection</code>
        objects because, as mentioned previously, every property access on
        such an object is actually a query against the DOM for all nodes
        matching some criteria. That makes a property lookup on an <code class="literal">HTMLCollection</code> very expensive and, when
        included in the terminal condition of a loop, adds significant
        execution time to the overall loop.</p><p>Another simple way to improve the performance of a loop is to
        decrement the iterator toward 0 rather than incrementing toward the
        total length. Making this simple change can result in savings of up to
        50% off the original execution time, depending on the complexity of
        each iteration. For example:</p><a id="I_programlisting7_d1e7947"></a><pre class="programlisting">var values = [1,2,3,4,5];
var length = values.length;

//for loop

<span class="strong"><strong>for (var i=length; i--;){</strong></span>
    process(values[i]);
}

//do-while loop
<strong class="userinput"><code>var j=length</code></strong>;
do {
    process(values[<strong class="userinput"><code>--j</code></strong>]);
} while (<strong class="userinput"><code>j</code></strong>);

//while loop
<span class="strong"><strong>var k=length</strong></span>;
while (<strong class="userinput"><code>k--</code></strong>){
    process(values[<strong class="userinput"><code>k</code></strong>]);
}</pre><p>Each of these loops is now even faster by virtue of changing the
        terminal condition to a comparison against 0 (note that the terminal
        condition evaluates to <code class="literal">true</code> once
        the iterator variable equals 0). The performance of each type of loop
        is comparable, so you needn&#8217;t worry about choosing among the three
        variations for speed <a id="I_indexterm7_d1e7976" class="indexterm"></a><a id="I_indexterm7_d1e7978" class="indexterm"></a><a id="I_indexterm7_d1e7980" class="indexterm"></a><a id="I_indexterm7_d1e7982" class="indexterm"></a><a id="I_indexterm7_d1e7984" class="indexterm"></a><a id="I_indexterm7_d1e7986" class="indexterm"></a><a id="I_indexterm7_d1e7988" class="indexterm"></a>purposes.</p><div class="note"><h3 class="title"><a id="note-6"></a>Note</h3><p>Be careful when using the native <code class="literal">indexOf</code> method for arrays. This method can
          take significantly longer to iterate over each array item than using
          a regular loop. If speed is your primary concern, use one of the
          three loop types mentioned in this section.</p></div></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="avoid_the_for-in_loop"></a>Avoid the for-in loop</h4></div></div></div><p>Another <a id="I_indexterm7_d1e8005" class="indexterm"></a><a id="I_indexterm7_d1e8008" class="indexterm"></a>variation of the <code class="literal">for</code>

        loop is the <code class="literal">for</code>-<code class="literal">in</code> loop, whose purpose is to iterate over
        the enumerable properties of a JavaScript object. Typical usage is as
        follows:</p><a id="I_programlisting7_d1e8023"></a><pre class="programlisting">for (var prop in object){
    if (object.hasOwnProperty(prop)){  //to filter out prototype properties
        process(object[prop]);
    }
}</pre><p>This code iterates over the properties in a given object,
        using<a id="I_indexterm7_d1e8027" class="indexterm"></a> the <code class="literal">hasOwnProperty</code>
        method to ensure that only instance properties are processed.</p><p>Because the <code class="literal">for</code>-<code class="literal">in</code> loop has a specific purpose, there is
        little you can do to change its performance. The terminal condition
        cannot be altered, and the order of the properties to iterate over
        cannot be changed. Further, a <code class="literal">for</code>-<code class="literal">in</code>

        loop is typically much slower than any of the other loops because it
        requires resolving every enumerable property on a particular object.
        That, in turn, means the object&#8217;s prototype and entire prototype chain
        must be examined to extract these properties. Traversing the prototype
        chain, just like traversing the scope chain, takes time and slows down
        the performance of the entire loop.</p><p>If you know the specific properties you&#8217;re interested in, it&#8217;s
        much faster to create a standard loop (<code class="literal">for</code>, <code class="literal">do</code>-<code class="literal">while</code>,
        or <code class="literal">while</code>) and iterate over an array
        of names, such as:</p><a id="I_programlisting7_d1e8062"></a><pre class="programlisting">//known properties to iterate over
var props = ["name", "age", "title"];

//while loop
var i=props.length;
while (i--){
    process(object[props[i]]);
}</pre><p>This loop runs much faster than the <code class="literal">for</code>-<code class="literal">in</code>

        loop, and not simply because of the small number of properties in the
        <code class="literal">props</code> array. Even increasing the
        number of properties over which to iterate would yield significantly
        better performance than the <code class="literal">for</code>-<code class="literal">in</code>
        loop. The loop in this example takes advantage of all the normal loop
        performance enhancements and still allows iteration over a known set
        of object properties.</p><p>Naturally, this approach works only when you know the object
        properties to iterate over; when dealing with unknown properties, as
        with <a id="I_indexterm7_d1e8083" class="indexterm"></a>JSON objects, a <code class="literal">for</code>-<code class="literal">in</code>

        loop may still be necessary.</p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="unrolling_loops"></a>Unrolling loops</h4></div></div></div><p>It is a common practice <a id="loops7.3.2.3" class="indexterm"></a><a id="unrolling7.3.2.3" class="indexterm"></a>in several programming languages to unroll small loops
        to improve performance. The basis of this practice is that limiting
        the number of iterations can mitigate the performance overhead of a
        loop. The implementation of such a <span class="keep-together">solution</span> is typically called
        <span class="emphasis"><em>unrolling the loop</em></span>, which means making each
        iteration do the work of multiple iterations. Consider the following
        loop:</p><a id="I_programlisting7_d1e8115"></a><pre class="programlisting">var i=values.length;
while (i--){
    process(values[i]);
}</pre><p>If there are only five items in the <code class="literal">values</code> array, it is actually faster to
        remove the loop and do the work on each value individually:</p><a id="I_programlisting7_d1e8122"></a><pre class="programlisting">//unrolled loop
process(values[0]);
process(values[1]);
process(values[2]);
process(values[3]);
process(values[4]);</pre><p>Of course, this approach is arguably less maintainable, as it
        takes more code to write and any change to the number of items in the
        <code class="literal">values</code> array requires changes to
        the code. Further, the performance gains for such a small number of
        statements aren&#8217;t worth the maintenance overhead. This technique can
        be quite useful, however, when you&#8217;re dealing with a large number of
        values and a potentially large number of iterations.</p><p>Tom Duff, a computer <a id="I_indexterm7_d1e8131" class="indexterm"></a>programmer working for Lucasfilm at the time, first
        proposed a construct for unrolling loops in the C programming
        language. This pattern became known as<a id="I_indexterm7_d1e8135" class="indexterm"></a> Duff&#8217;s Device and was later converted to JavaScript by
        <a id="I_indexterm7_d1e8139" class="indexterm"></a>Jeff Greenberg, who also published one of the first
        comprehensive studies on JavaScript performance <span class="keep-together">optimization</span> (which is still available
        at <a class="ulink" href="http://home.earthlink.net/~kendrasg/info/js_opt/" target="_top">http://home.earthlink.net/~kendrasg/info/js_opt/</a>).
        <span class="keep-together">Greenberg</span>&#8217;s Duff&#8217;s Device
        implementation is as follows:</p><a id="I_programlisting7_d1e8152"></a><pre class="programlisting">var iterations = Math.ceil(values.length / 8);
var startAt = values.length % 8;
var i = 0;

do {
    switch(startAt){
        case 0: process(values[i++]);
        case 7: process(values[i++]);
        case 6: process(values[i++]);
        case 5: process(values[i++]);
        case 4: process(values[i++]);
        case 3: process(values[i++]);
        case 2: process(values[i++]);
        case 1: process(values[i++]);
    }
    startAt = 0;
} while (--iterations &gt; 0);</pre><p>The idea behind Duff&#8217;s Device is that each trip through the loop
        does the work of between one and eight iterations of a normal loop.
        This is done by first determining the number of iterations by dividing
        the total number of array values by eight. Duff found that eight was
        an optimal number to use for this processing (it&#8217;s not arbitrary).
        Since not all <a id="I_indexterm7_d1e8156" class="indexterm"></a>array lengths will be equally divisible by eight, you
        must also calculate how many items won&#8217;t be processed by using the
        modulus operator. The <code class="literal">startAt</code>

        variable, therefore, contains the number of additional items to be
        processed. This variable is used only the first time through the loop,
        to do the extra work, and then is set back to zero so that each
        subsequent trip through the loop results in a full eight items being
        processed. Duff&#8217;s Device runs faster than a normal loop over a large
        number of iterations, but it can be made even faster.</p><p>The book <span class="emphasis"><em>Speed Up Your Site</em></span> (New Riders)
        introduced a version of Duff&#8217;s Device in JavaScript that moves the
        processing of the extra array items outside the main loop, allowing
        the<a id="I_indexterm7_d1e8170" class="indexterm"></a><a id="I_indexterm7_d1e8175" class="indexterm"></a> <code class="literal">switch</code> statement to
        be removed and resulting in an even faster way of processing a large
        number of items:</p><a id="I_programlisting7_d1e8182"></a><pre class="programlisting">var iterations = Math.floor(values.length / 8);
var leftover = values.length % 8;
var i = 0;

if (leftover &gt; 0){
    do {
        process(values[i++]);
    } while (--leftover &gt; 0);
}

do {
    process(values[i++]);
    process(values[i++]);
    process(values[i++]);
    process(values[i++]);
    process(values[i++]);
    process(values[i++]);
    process(values[i++]);
    process(values[i++]);
} while (--iterations &gt; 0);</pre><p>This code executes faster over a large number of array items
        primarily due to the <span class="keep-together">removal</span> of
        the <code class="literal">switch</code> statement from the main
        loop. As discussed earlier in this chapter, conditionals do have
        performance overhead; removing that overhead from the algorithm speeds
        up the processing. The separation of processing into two discrete
        loops allows this augmentation.</p><p>Duff&#8217;s Device, and the modified version presented here, is
        useful primarily with large arrays. For small arrays, the performance
        gain is minimal compared to standard loops. Therefore, you should
        attempt to use Duff&#8217;s Device only if you notice a <a id="I_indexterm7_d1e8195" class="indexterm"></a>performance bottleneck relating to a loop that must
        process a large number of <a id="I_indexterm7_d1e8201" class="indexterm"></a><a id="I_indexterm7_d1e8203" class="indexterm"></a><a id="I_indexterm7_d1e8205" class="indexterm"></a><a id="I_indexterm7_d1e8207" class="indexterm"></a><a id="I_indexterm7_d1e8209" class="indexterm"></a>items.</p></div></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="string_optimization"></a>String Optimization</h2></div></div></div><p>String manipulation is a very <a id="per7.4" class="indexterm"></a><a id="java7.4" class="indexterm"></a><a id="opt7.4" class="indexterm"></a><a id="string7.4" class="indexterm"></a>common occurrence in JavaScript. There are multiple ways to
    deal with string processing, depending on the particular task, and each
    task brings with it specific performance considerations. There are a
    number of different ways to manipulate strings, whether it be using
    built-in string methods and operators or intermixing the use of regular
    expressions and arrays. The exact technique to use for optimal performance
    is tied directly to the type of manipulation being performed.</p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="string_concatenation"></a>String Concatenation</h3></div></div></div><p>Traditionally, <a id="I_indexterm7_d1e8243" class="indexterm"></a><a id="I_indexterm7_d1e8248" class="indexterm"></a>string concatenation has been one of the
      poorest-performing aspects of JavaScript. Typically, string
      concatenation is done using the <a id="I_indexterm7_d1e8252" class="indexterm"></a><a id="I_indexterm7_d1e8255" class="indexterm"></a>plus operator (<code class="literal">+</code>), such
      as in the following:</p><a id="I_programlisting7_d1e8262"></a><pre class="programlisting">var text = "Hello";
text += " "
text += "World!";</pre><p>Early <a id="I_indexterm7_d1e8266" class="indexterm"></a>browsers had no optimization for such operations. Since
      strings are immutable, that meant creating intermediate strings to
      contain the concatenation result. This <span class="keep-together">constant</span> creation and destruction of
      strings behind the scenes led to very poor string concatenation
      performance.</p><p>Having discovered this, developers turned to the <a id="I_indexterm7_d1e8277" class="indexterm"></a>JavaScript <code class="literal">Array</code> object
      for help. One of the <code class="literal">Array</code> object&#8217;s
      methods is <code class="literal">join</code>, which concatenates
      all items in the array and inserts a given string between the items.
      Instead of using the plus operator, each string is added to an array and
      the<a id="I_indexterm7_d1e8290" class="indexterm"></a> <code class="literal">join</code> method is called
      when all items have been added. For example:</p><a id="I_programlisting7_d1e8300"></a><pre class="programlisting">var buffer = [],
    i = 0;
buffer[i++] = "Hello";
buffer[i++] = " ";
buffer[i++] = "World!";

var text = buffer.join("");</pre><p>In this code, each string is added into the <code class="literal">buffer</code> array. The <code class="literal">join</code> method is called after all strings are in
      the array, returning the concatenated string and storing it in the
      variable <code class="literal">text</code>. Adding the items
      directly into the appropriate index is slightly faster than calling
      <code class="literal">push</code> for each value. This technique
      proved to be much faster in early browsers than using the plus operator
      because no intermediate strings are being created and destroyed.
      However, browser string optimizations have changed the string
      concatenation picture.</p><p>Firefox was the first <a id="I_indexterm7_d1e8318" class="indexterm"></a>browser to optimize string concatenation. Beginning with
      version 1.0, the array technique is actually slower than using the plus
      operator in all cases. Other browsers have also optimized string
      concatenation, so <a id="I_indexterm7_d1e8324" class="indexterm"></a><a id="I_indexterm7_d1e8329" class="indexterm"></a><a id="I_indexterm7_d1e8334" class="indexterm"></a><a id="I_indexterm7_d1e8339" class="indexterm"></a>Safari, Opera, Chrome, and Internet Explorer 8 also show
      better performance using the plus operator. Internet Explorer prior to
      version 8 didn&#8217;t have such an optimization, and so the array technique
      is always faster than the plus operator.</p><p>This doesn&#8217;t necessarily mean browser detection should be used
      whenever string concatenation is necessary. There are two factors to
      consider when determining the most appropriate way to concatenate
      strings: the size of the strings being concatenated and the number of
      concatenations.</p><p>All browsers can comfortably complete the task in less than one
      millisecond using the <a id="I_indexterm7_d1e8349" class="indexterm"></a><a id="I_indexterm7_d1e8352" class="indexterm"></a>plus operator when the size of the strings is relatively
      small (20 characters or less) and the number of concatenations is also
      relatively small (1,000 concatenations or less). There is no reason to
      consider anything other than using the plus operator if this is your
      situation.</p><p>As you increase the number of concatenations for small strings, or
      the size of the strings with a small number of concatenations, the
      performance gets significantly worse in Internet Explorer through
      version 7. Also, as the size of the strings increases, the performance
      difference between using the plus operator and the array technique
      decreases in Firefox. As the number of concatenations increases, the
      difference between the two techniques decreases in Safari as well. The
      only browsers where the plus operator remains consistently and
      significantly faster with varying string size and concatenation numbers
      are Chrome and Opera.</p><p>With all of the performance variance across browsers, the
      technique to use is heavily dependent on the use case as well as on the
      browsers you&#8217;re targeting. If your users largely use Internet Explorer 6
      or 7, it may be worth using the array technique all the time because
      that will affect the largest number of people. The performance decrease
      of the array technique in other browsers is typically much less than the
      performance increase gained in Internet Explorer, so try to balance your
      users&#8217; experience based on their browsers rather than trying to target
      specific situations and browser versions. In most common cases, however,
      using the plus operator is preferred.</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="trimming_strings"></a>Trimming Strings</h3></div></div></div><p>One of the most <a id="I_indexterm7_d1e8366" class="indexterm"></a>glaring omissions of JavaScript strings is the lack of a
      native trim method used to remove leading and trailing whitespace. The
      most common implementation of a<a id="I_indexterm7_d1e8372" class="indexterm"></a> <code class="literal">trim</code> function is as
      follows:</p><a id="I_programlisting7_d1e8379"></a><pre class="programlisting">function trim(text){
    return text.replace(/^\s+|\s+$/g, "");
}</pre><p>This implementation uses a regular expression that matches one or
      more whitespace characters at the beginning or end of the string. The
      string&#8217;s<a id="I_indexterm7_d1e8383" class="indexterm"></a> <code class="literal">replace</code> method is used
      to replace any matches with an empty string. This implementation,
      however, has a performance issue based in the regular expression.</p><p>The performance impact comes from two aspects of the regular
      expression: the pipe operator, indicating that there are two patterns to
      match, and the <code class="literal">g</code> flag, indicating
      that the pattern should be applied globally. Taking this into mind, you
      can rewrite the function to be a bit faster by breaking up the regular
      expression into two and getting rid of the <code class="literal">g</code> flag:</p><a id="I_programlisting7_d1e8400"></a><pre class="programlisting">function trim(text){
    return text<strong class="userinput"><code>.replace(/^\s+/, "").replace(/\s+$/, "");</code></strong>

}</pre><p>Breaking the single <code class="literal">replace</code>
      method into two calls allows each regular expression to become much
      simpler and, therefore, faster. This method is faster than the original,
      but you can optimize it even further.</p><p><a id="I_indexterm7_d1e8411" class="indexterm"></a><a class="ulink" href="http://www.stevenlevithan.com" target="_top">Steven
      Levithan</a>, after performing research on the fastest way to
      execute string trimming in JavaScript, arrived at the following
      function:</p><a id="I_programlisting7_d1e8417"></a><pre class="programlisting">function trim(text){
    text = text.replace(/^\s+/, "");
    for (var i = text.length - 1; i &gt;= 0; i--) {
        if (/\S/.test(text.charAt(i))) {
            text = text.substring(0, i + 1);
            break;
        }
    }
    return text;
}</pre><p>This <code class="literal">trim</code> function consistently
      performs better than other variations. The source of the speed is
      keeping the regular expressions as simple as possible. The first line
      removes leading whitespace and then the <code class="literal">for</code> loop is used to strip trailing whitespace.
      The loop uses a very simple, single-character regular expression that
      matches nonwhitespace characters. This information is used to either
      remove a character from the string or break the loop. The resulting
      function performs faster than the previous versions across all browsers.
      For Levithan&#8217;s complete analysis, see his post at <a class="ulink" href="http://blog.stevenlevithan.com/archives/faster-trim-javascript" target="_top">http://blog.stevenlevithan.com/archives/faster-trim-javascript</a>.</p><p>As with string concatenation, the speed of string trimming matters
      only if it is performed with enough frequency during execution. The
      second <code class="literal">trim</code> function in this section
      performs fine for smaller strings over the course of a few calls; the
      third <code class="literal">trim</code> function is significantly
      faster when used on longer <a id="I_indexterm7_d1e8437" class="indexterm"></a><a id="I_indexterm7_d1e8439" class="indexterm"></a><a id="I_indexterm7_d1e8441" class="indexterm"></a><a id="I_indexterm7_d1e8443" class="indexterm"></a><a id="I_indexterm7_d1e8445" class="indexterm"></a>strings.</p><div class="note"><h3 class="title"><a id="note-7"></a>Note</h3><p>The next version of the ECMAScript specification, code-named
        <span class="keep-together">ECMAScript</span> 3.1, defines a native
        <code class="literal">trim</code> method for strings; it is
        likely that this native version will be faster than any of the
        functions in this section. When available, the native function should
        be used.</p></div></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="avoid_long-running_scripts"></a>Avoid Long-Running Scripts</h2></div></div></div><p>One of the critical <a id="java7.5" class="indexterm"></a><a id="per7.5" class="indexterm"></a>performance issues with JavaScript is that code execution
    freezes a <a id="I_indexterm7_d1e8475" class="indexterm"></a>web page. Because <a id="I_indexterm7_d1e8481" class="indexterm"></a><a id="I_indexterm7_d1e8486" class="indexterm"></a>JavaScript is a single-threaded language, only one script
    can be run at a time per window or tab. This means that all user
    interaction is necessarily halted while JavaScript code is being executed.
    This is an important feature of browsers since JavaScript may change the
    underlying page structure during its execution, with the possibility of
    nullifying or altering the response to user interaction.</p><p>If JavaScript code isn&#8217;t carefully crafted, it&#8217;s possible to freeze
    the web page for an extended period of time and ultimately cause the
    browser to stop responding. Most browsers will detect long-running scripts
    and notify the user of a problem with a dialog box asking whether the
    script should be allowed to proceed.</p><p>Exactly what causes the <a id="I_indexterm7_d1e8496" class="indexterm"></a>browser to display the long-running script dialog varies
    <span class="keep-together">depending</span> on the vendor:</p><div class="itemizedlist"><ul><li><p>Internet Explorer <a id="I_indexterm7_d1e8509" class="indexterm"></a>monitors the number of statements that have been
        executed by a script. When a maximum number of statements have been
        executed, 5 million by default, the long-running script dialog is
        displayed (as shown in <a class="xref" href="#internet_explorer_7_long-running_script_" title="Figure&#xA0;7.7.&#xA0;Internet Explorer 7 long-running script dialog">Figure&#160;7.7, &#8220;Internet Explorer 7 long-running script dialog&#8221;</a>).</p></li><li><p>Firefox <a id="I_indexterm7_d1e8520" class="indexterm"></a>monitors the amount of time a script is taking to
        execute. When a script takes longer than a preset amount of time, 10
        seconds by default, the long-running script dialog is
        displayed.</p></li><li><p>Safari <a id="I_indexterm7_d1e8529" class="indexterm"></a>also uses the execution time to determine whether a
        script is long-running. The default timeout is set to five seconds,
        after which the long-running script dialog is displayed.</p></li><li><p>Chrome <a id="I_indexterm7_d1e8538" class="indexterm"></a>as of version 1.0 has no set limit on how long
        JavaScript is allowed to run. The process will crash when it has run
        out of memory.</p></li><li><p>Opera <a id="I_indexterm7_d1e8547" class="indexterm"></a>is the only browser that doesn&#8217;t protect against
        long-running scripts. Scripts are allowed to continue until execution
        is complete.</p></li></ul></div><div class="figure-float"><div class="figure"><a id="internet_explorer_7_long-running_script_"></a><p class="title"><b>Figure&#160;7.7.&#160;Internet Explorer 7 long-running script dialog</b></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e8556"></a><img src="http://figures.oreilly.com/tagoreillycom20090601oreillybooks300541I_book_d1e1/figs/I_mediaobject7_d1e8556-web.png" alt="Internet Explorer 7 long-running script dialog" /></div></div></div><br class="figure-break" /></div><p>If you ever see the long-running script dialog, it&#8217;s an indication
    that the JavaScript code needs to be refactored. Generally speaking, no
    single continuous script execution should take longer than 100
    milliseconds; anything longer than that and the web page will almost
    certainly appear to be running slowly to the user. <a id="I_indexterm7_d1e8563" class="indexterm"></a>Brendan Eich, the creator of JavaScript, is also quoted as
    saying, &#8220;[JavaScript] that executes in whole seconds is probably doing
    something wrong....&#8221;</p><p>The most common reasons why a script takes too long to execute
    include:</p><div class="variablelist"><dl><dt><span class="term">Too much DOM interaction</span></dt><dd><p>DOM <a id="I_indexterm7_d1e8576" class="indexterm"></a>manipulation is more expensive than any other
          JavaScript process. Minimizing DOM interactions significantly cuts
          the JavaScript runtime. Most browsers update the DOM only after the
          entire script has finished executing, which slows the perceived
          responsiveness of the web page to the user.</p></dd><dt><span class="term">Loops that do too much</span></dt><dd><p>Any loop <a id="I_indexterm7_d1e8588" class="indexterm"></a>that either runs too many times or performs too many
          operations with each iteration can cause long-running script issues.
          It helps separate out functionality whenever possible. The effect is
          worsened when loops are used to perform DOM manipulations, sometimes
          causing the browser to completely freeze without ever showing the
          long-running script dialog.</p></dd><dt><span class="term">Too much recursion</span></dt><dd><p>JavaScript engines <a id="I_indexterm7_d1e8600" class="indexterm"></a>put a limit on the amount of recursion that scripts
          can use. Rewriting the code to avoid recursion helps ameliorate the
          issue.</p></dd></dl></div><p>Sometimes simple code refactoring, keeping these issues in mind, can
    prevent runaway scripts. There may, however, be times when complex
    processes must necessarily be executed for the web application to function
    correctly. In that case, the code must be restructured to yield
    periodically, as explained in the next section.</p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="yielding_using_timers"></a>Yielding Using Timers</h3></div></div></div><p>The single-threaded <a id="timers7.5.1" class="indexterm"></a>nature of JavaScript means that only one script can be
      executed in a window or tab at any given point in time. No user
      interactions can be processed during this time and so it&#8217;s necessary to
      introduce breaks in long-executing JavaScript code. On simple web pages,
      the breaks occur naturally as the user interacts with the page. In
      complex web applications, it&#8217;s often necessary to insert the breaks
      yourself. The easiest way to do this is to use a timer.</p><p>Timers are created using the<a id="I_indexterm7_d1e8619" class="indexterm"></a> <code class="literal">setTimeout</code> function,
      passing in the function to execute as well as a delay (in milliseconds)
      before the function should be executed. When the delay has passed, the
      code to execute is placed into a queue. The JavaScript engine uses this
      queue to determine what to do next. When a script finishes executing,
      the JavaScript engine yields to allow other browser tasks to catch up.
      The web page display is typically updated during this time in relation
      to changes made via the script. Once the display has been updated, the
      JavaScript engine checks for more scripts to run on the queue. If
      another script is waiting, it is executed and the process repeats; if
      there are no more scripts to execute, the JavaScript engine remains idle
      until another script <span class="keep-together">appears</span> in
      the queue.</p><p>When you create a timer, you&#8217;re actually scheduling some code to
      be inserted into the JavaScript engine&#8217;s queue to be executed later.
      That insertion happens after the amount of time specified when calling
      <code class="literal">setTimeout</code>. In essence, timers push
      code execution off into the future, where all long-running script limits
      are reset. Consider the following code:</p><a id="I_programlisting7_d1e8637"></a><pre class="programlisting">window.onload = function(){

    //Page Load

    //create first timer
    setTimeout(function(){

        //Delayed Script 1

        setTimeout(function(){

            //Delayed Script 2

        }, 100);

        //Delayed Script 1, continued

    }, 100);

};</pre><p>In this example, a script is run when the page loads. That script
      calls <code class="literal">setTimeout</code> to create the first
      timer. When that timer executes, it calls <code class="literal">setTimeout</code> again to create a second timer. The
      second delayed script cannot start running, however, until the first has
      finished executing and the browser has updated the display. <a class="xref" href="#javascript_code_execution_with_timers" title="Figure&#xA0;7.8.&#xA0;JavaScript code execution with timers">Figure&#160;7.8, &#8220;JavaScript code execution with timers&#8221;</a> shows the timeline
      for this code execution, indicating that no two scripts are run at the
      same time.</p><p>Timers are the de facto standard for splitting up JavaScript code
      execution in browsers. Whenever a script is taking too long to complete,
      look to delay parts of the execution until later.</p><p>Note that very small timer delays can also cause the browser to
      become unresponsive. It&#8217;s recommended to never use a delay of zero
      milliseconds, as this isn&#8217;t enough time for all browsers to properly
      update their display. In general, delays between 50 and 100 milliseconds
      are appropriate and allow browsers enough idle time to perform necessary
      display updates.</p><div class="figure-float"><div class="figure"><a id="javascript_code_execution_with_timers"></a><p class="title"><b>Figure&#160;7.8.&#160;JavaScript code execution with timers</b></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e8656"></a><img src="http://figures.oreilly.com/tagoreillycom20090601oreillybooks300541I_book_d1e1/figs/I_mediaobject7_d1e8656-web.png" alt="JavaScript code execution with timers" /></div></div></div><br class="figure-break" /></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="timer_patterns_for_yielding"></a>Timer Patterns for Yielding</h3></div></div></div><p>Array processing is one of the most <a id="I_indexterm7_d1e8667" class="indexterm"></a>frequent causes of long-running scripts. Typically, this
      is because processing must be done on each member of the array, and so
      the execution time increases directly in proportion to the number of
      items in the array. If the array processing doesn&#8217;t have to be executed
      synchronously, it is a good candidate for splitting up using
      timers.</p><p>In my book, <em class="citetitle">Professional JavaScript for Web
      Developers</em>, Second Edition (Wrox), I describe a simple
      function that can be used to split up the processing of arrays using
      timers:</p><a id="I_programlisting7_d1e8678"></a><pre class="programlisting">function chunk(array, process, context){
    setTimeout(function(){
        var item = array.shift();
        process.call(context, item);

        if (array.length &gt; 0){
            setTimeout(arguments.callee, 100);
        }
    }, 100);
}</pre><p>The <code class="literal">chunk</code> function accepts
      three arguments: an array of data to process, a function with which to
      process each item, and an optional context argument in which the
      processing function should be executed (by default, all functions passed
      into <code class="literal">setTimeout</code> are run in the global
      context, so <code class="literal">this</code> is equal to <code class="literal">window</code>). Processing of the items is done using
      timers, and so the code execution yields after each item has been
      processed. The next item to process is always at the front of the array
      and is removed before being processed. Afterward, a check is made to
      determine whether there are any further values left to process. If so, a
      new timer is created and the function is called again via <code class="literal">arguments.callee</code>. Note
      that the <code class="literal">chunk</code> function uses the
      passed-in array as a &#8220;to do&#8221; list of items to process and so is altered
      once execution is complete. You can use the function as follows:</p><a id="I_programlisting7_d1e8702"></a><pre class="programlisting">var names = ["Nicholas", "Steve", "Doug", "Bill", "Ben", "Dion"],
    todo = names.concat();  //clone the array

chunk(todo, function(item){
    console.log(item);
});</pre><p>The code in this simple example outputs each name in the <code class="literal">names</code> array to the <code class="literal">console</code> (available in Firefox with Firebug
      installed, Internet Explorer 8+, Safari 2+, and all versions of Chrome).
      The processing function is very short but could easily be replaced with
      something more complex. The <code class="literal">chunk</code>

      function is best used with long arrays where each item requires
      significant processing.</p><p>Another popular pattern is to perform small, sequential parts of a
      larger operation using timers. Julien Lecomte <a id="I_indexterm7_d1e8717" class="indexterm"></a>presented this pattern in his blog post, <a class="ulink" href="http://www.julienlecomte.net/blog/2007/10/28/" target="_top">&#8220;Running CPU
      Intensive JavaScript Computations in a Web Browser&#8221;</a>, in which he
      showed how sorting of a large data set could be achieved using an
      inefficient algorithm (bubble sort) without incurring a long-running
      script issue. The following is an adaptation of Lecomte&#8217;s code:</p><a id="I_programlisting7_d1e8724"></a><pre class="programlisting">function sort(array, onComplete){

    var pos = 0;

    (function(){

        var j, value;

        for (j=array.length; j &gt; pos; j--){
            if (array[j] &lt; array[j-1]){
                value = data[j];
                data[j] = data[j-1];
                data[j-1] = value;
            }
        }

        pos++;

        if (pos &lt; array.length){
            setTimeout(arguments.callee,10);
        } else {
            onComplete();
        }

    })();

}</pre><p>The <code class="literal">sort</code> function <a id="I_indexterm7_d1e8731" class="indexterm"></a>splits up each traversal through the array for sorting,
      allowing the browser to continue functioning while this processing
      occurs. The inner anonymous function is called immediately to do the
      first traversal and then is called subsequently via a timer by passing
      <code class="literal">arguments.callee</code> into <code class="literal">setTimeout</code>. When the array is finally <span class="keep-together">sorted</span>, the <code class="literal">onComplete</code> function <a id="I_indexterm7_d1e8748" class="indexterm"></a>is called to notify the developer that the data is ready
      to be used. The function can be used as follows:</p><a id="I_programlisting7_d1e8753"></a><pre class="programlisting">sort(values, function(){
    alert("Done!");
});</pre><p>When sorting an array with a large number of items, the difference
      in browser responsiveness is immediately <a id="I_indexterm7_d1e8757" class="indexterm"></a><a id="I_indexterm7_d1e8759" class="indexterm"></a><a id="I_indexterm7_d1e8761" class="indexterm"></a>apparent.</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="summary-id002"></a>Summary</h2></div></div></div><p>The speed with which JavaScript executes is very dependent on how it
    is written. In this chapter, you learned several ways to speed up
    <a id="I_indexterm7_d1e8769" class="indexterm"></a><a id="I_indexterm7_d1e8774" class="indexterm"></a>JavaScript code execution:</p><div class="itemizedlist"><ul><li><p>Managing your scope is important, since out-of-scope variables
        take longer to access than local variables. Try to avoid constructs
        that artificially augment the scope chain, such as the <code class="literal">with</code> statement and the <code class="literal">catch</code> clause of a <code class="literal">try</code>-<code class="literal">catch</code>

        statement. If an out-of-scope value is being used more than once,
        store it in a local variable to minimize the performance
        penalty.</p></li><li><p>The way you store and access data can greatly impact the
        performance of your script. Literal values and local variables are
        always the fastest; you incur a performance penalty for accessing
        array items and object properties. If an array item or object property
        is used more than once, store it in a local variable to speed up
        access to the value.</p></li><li><p>Flow control is also an important determinant of script
        execution speed. There are three ways to handle conditionals: the
        <code class="literal">if</code> statement, the <code class="literal">switch</code> statement, and array lookup. The
        <code class="literal">if</code> statement is best used with a
        small number of discrete values or a range of values; the <code class="literal">switch</code> statement is best used when there are
        between 3 and 10 discrete values to test for; array lookup is most
        efficient for a larger number of discrete values.</p></li><li><p>Loops are frequently found to be bottlenecks in JavaScript. To
        make a loop the most efficient, reverse the order in which you process
        the items so that the control condition compares the iterator to zero.
        This is far faster than comparing a value to a nonzero number and
        significantly speeds up array processing. If there are a large number
        of required iterations, you may also want to consider using Duff&#8217;s
        Device to speed up execution.</p></li><li><p>Be careful when using <code class="literal">HTMLCollection</code> objects. Each time a property
        is accessed on one of these objects, it requires a query of the DOM
        for matching nodes. This is an expensive operation that can be avoided
        by accessing <code class="literal">HTMLCollection</code>

        properties only when necessary and storing frequently used values
        (such as the <code class="literal">length</code> property) in
        local variables.</p></li><li><p>Common string operations may have unintended performance
        implications. String concatenation is much slower in Internet Explorer
        than in other browsers, but it&#8217;s not worth worrying about unless
        you&#8217;re dealing with more than 1,000 concatenations. You can optimize
        string concatenation in Internet Explorer by using an array to store
        the individual strings and then calling <code class="literal">join()</code> to merge them together. Trimming
        strings may also be expensive, depending on the size of the string.
        Make sure to use the most optimal algorithm if trimming is a large
        part of your script.</p></li><li><p>Browsers have limits on how long JavaScript can run, capping
        either the number of statements or the amount of time the JavaScript
        engine is allowed to run. You can circumvent these limits, and prevent
        the browser from displaying a warning about the long-running script,
        by using timers to split up the amount of <a id="I_indexterm7_d1e8838" class="indexterm"></a>work.</p></li></ul></div></div><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.CHP-7-FNOTE-1" href="#CHP-7-FNOTE-1" class="para">22</a>] </sup>All of the research in this chapter is based on experiments run on
      Firefox versions 3.0 and 3.1 beta 2, Google Chrome 1.0, Internet
      Explorer versions 7 and 8 beta 2, Safari versions 3.0&#8211;3.2, and Opera
      version 9.62. When the version numbers aren&#8217;t mentioned, all tested
      versions of the browser are relevant.</p></div></div></div>
      
      <p>If you enjoyed this excerpt, buy a copy of <b><a href="http://oreilly.com/catalog/9780596522308/">Even Faster Web Sites </a></b>.</p>


</div>
<!-- end article content -->

<!-- OST promo -->

<!-- end O'Reilly Learning box -->



<!-- main_new.view generic -->
<div id="adspace">
<!-- MyBuys Zone and Parameters -->
<div class="sidebar-item">
<h3>Recommended for You</h3>
<div class="sidebar-item-content" style="text-align: center; padding: 0px;">

<!-- MyBuys Web Recommendation Zone -->
<div mybuyszone="5"></div>
<!-- End MyBuys Web Recommendation Zone -->


<!-- debug: type: content_item, cs cat: pt-serveradministration, deli cat: serveradmin -->
<!-- MyBuys Page Parameters -->
<script type="text/javascript">
mybuys.setPageType("CONTENT_ITEM");
mybuys.set("categoryid","http://purl.oreilly.com/resource-center/serveradmin");
</script>
<!-- End MyBuys Page Parameters -->
		
</div>
</div>
</div>
<!-- main_new.view generic -->



<!-- end content -->


<img src="/images/trans.gif" alt=" " width="400" height="1" /><br />



<br /><br />





<!--footer -->
 
    <!--  -->
		</td>
	</tr>
	<tr>
		<td class="eightPixel">&nbsp;</td>
	</tr>
	<tr valign="bottom">
		<td align="center" class="navfooterbg"><!--BottomNav Start-->
			<table border="0" cellspacing="0" cellpadding="0" class="emailSignUpTable">
				<tr>
					<td style="width:516px;">

						<form method="GET" id="emailSignUp" action="http://post.oreilly.com/client/o/oreilly/forms/quicksignup.cgi"> 
							<table border="0" cellspacing="0" cellpadding="0" width="500"> 
								<tbody> 
									<tr> 
										<td width="275">
											<div style="padding-left: 12px;">Sign up today to receive special discounts,<br /> product alerts, and news from O'Reilly.</div>
										</td>
										<td width="172">
											<input type="hidden" name="client_token" value="oreilly"><input type="hidden" name="subscribe" value="optin">
											<input type="hidden" name="success_url" value="http://oreilly.com/store/newsletter-thankyou.html"> 
											<input type="hidden" name="error_url" value="http://oreilly.com/store/newsletter-signup-error.html"> 
											<input type="hidden" name="news_oreilly" value="1">
											<input type="hidden" name="source" value="news_oreilly_footer">

											<input type="text" name="email_addr" value='Enter Email' maxlength="100" size="12" class="NavSearchBottom">
										</td>
										<td width="53">
											<input border="0" type="image" alt="Submit" src="//cdn.oreillystatic.com/images/sitewide-headers/emailsignup_btn.gif" type="submit" name="submit" value="submit" />
										</td>
									</tr>
								</tbody>
							</table>
						</form> 

					</td>
					<td>
						<a href="http://oreilly.com/oreilly/privacy.html">Privacy Policy &gt;</a><br />
						<a href="http://cdn.oreillystatic.com/oreilly/email/sample-newsletter.html" alt="View Sample Newsletter &gt;">View Sample Newsletter &gt;</a>
					</td>

<td style="text-align:right">
<ul class="utility social">
<li><a class="twitter" href="http://twitter.com/oreillymedia" target="_blank"><span class="hidden">Twitter</span></a></li>
<!--<li><a class="youtube" href="http://youtube.com/oreillymedia" target="_blank"><span class="hidden">YouTube</span></a></li>-->
<li><a class="youtube" href="http://www.youtube.com/subscription_center?add_user=oreillymedia" target="_blank"><span class="hidden">YouTube</span></a></li>
<li><a class="slideshare" href="http://slideshare.net/oreillymedia" target="_blank"><span class="hidden">Slideshare</span></a></li>
<li><a class="facebook" href="http://www.facebook.com/OReilly" target="_blank"><span class="hidden">Facebook</span></a></li>

<li><a class="rss" href="http://feeds.feedburner.com/oreilly/news" target="_blank"><span class="hidden">RSS</span></a></li>
<li><a class="all-rss" href="http://oreilly.com/feeds">View All RSS Feeds &gt;</a></li>
</ul>
</td>
				</tr>
			</table>
			<div id="multiColumnFooter">
				<div id="footer-branding">
					<img src="//cdn.oreillystatic.com/images/sitewide-headers/logo02.gif" alt="O'reilly"/>
					<p class="copyright">&copy; 2013, O&#8217;Reilly Media, Inc.</p>
					<p>
						<span class="phone-number">(707) 827-7019</span>
						<span class="phone-number">(800) 889-8969</span>
					</p>
					<p class="trademarks">All trademarks and registered trademarks appearing on oreilly.com are the property of their respective owners.</p>
				</div>
				<div class="contentSectionBlock">
					<div class="contentSectionContainer" >
						<span id="footerColumn-1" class="contentSection">
							<h3>About O'Reilly</h3>
							<ul>
								<li><a class="footer" href="http://oreilly.com/academic/">Academic Solutions</a></li>
								<li><a class="footer" href="http://oreilly.com/jobs/">Jobs</a></li>
								<li><a class="footer" href="http://www.oreilly.com/about/contact.html">Contacts</a></li>
								<li><a class="footer" href="http://www.oreilly.com/about/index.html">Corporate Information</a></li>
								<li><a class="footer" href="http://press.oreilly.com/index.html">Press Room</a></li>
								<li><a class="footer" href="http://oreilly.com/oreilly/privacy.csp">Privacy Policy</a></li>
								<li><a class="footer" href="http://oreilly.com/terms/">Terms of Service</a></li>
								<li><a class="footer" href="http://oreilly.com/oreilly/author/intro.csp">Writing for O'Reilly</a></li>
							</ul>
						</span>
					</div><!--end contentSectionContainer-->
					<div class="contentSectionContainer" >
						<span id="footerColumn-2" class="contentSection">
							<h3>Community</h3>
							<ul>
								<li><a class="footer" href="http://www.oreilly.com/authors/">Authors</a></li>
                                                                <li><a class="footer" href="http://oreilly.com/webcasts/">Webcasts</a></li>
								<li><a class="footer" href="http://oreilly.com/community/">Community & Featured Users</a></li>
								<li><a class="footer" href="http://forums.oreilly.com/">Forums</a></li>								
								<li><a class="footer" href="http://elists.oreilly.com/">Newsletters</a></li>
								<li><a class="footer" href="http://answers.oreilly.com/">O'Reilly Answers</a></li>
								<li><a class="footer" href="http://oreilly.com/feeds/">RSS Feeds</a></li>
								<li><a class="footer" href="http://ug.oreilly.com/">User Groups</a></li>
                                                               <li><a class="footer" href="http://chimera.labs.oreilly.com/">O'Reilly Atlas (beta)</a></li>
							</ul>
						</span>
					</div><!--end contentSectionContainer-->
					<div class="contentSectionContainer" >
						<span id="footerColumn-3" class="contentSection">
							<h3>Partner Sites</h3>
							<ul>
								<li><a class="footer" href="http://makezine.com/">makezine.com</a></li>
								<li><a class="footer" href="http://makerfaire.com/">makerfaire.com</a></li>
								<li><a class="footer" href="http://craftzine.com/">craftzine.com</a></li>
								<li><a class="footer" href="http://igniteshow.com/">igniteshow.com</a></li>
								<li><a class="footer" href="https://developer.paypal.com/">PayPal Developer Zone</a></li>
								<li><a class="footer" href="http://blogs.forbes.com/oreillymedia/">O'Reilly Insights on Forbes.com</a></li>
							</ul>
						</span>
					</div><!--end contentSectionContainer-->
					<div class="contentSectionContainer" >
						<span id="footerColumn-4" class="contentSection">
							<h3>Shop O'Reilly</h3>
							<ul>
								<li><a class="footer" href="http://shop.oreilly.com/category/customer-service.do">Customer Service</a></li>
								<li><a class="footer" href="http://shop.oreilly.com/category/customer-service.do">Contact Us</a></li>
								<li><a class="footer" href="http://shop.oreilly.com/category/customer-service/shipping-information.do">Shipping Information</a></li>
								<li><a class="footer" href="http://shop.oreilly.com/category/customer-service/ordering-payment.do">Ordering & Payment</a></li>
								<li><a class="footer" href="http://oreilly.com/affiliates/">Affiliate Program</a></li>							
								<li><a class="footer" href="http://shop.oreilly.com/category/customer-service/oreilly-guarantee.do">The O'Reilly Guarantee</a></li>
							</ul>
						</span>
					</div> <!--end contentSectionContainer-->
					<div style="clear:both;"></div>
				</div><!--end contentSectionBlock-->
			</div><!--end multiColumnFooter-->
		</td><!--BottomNav End-->
           </tr>
</table>

</div> <!-- / content-09-->
</div> <!-- / page-->

<script type="text/javascript" src="//cdn.oreillystatic.com/oreilly/ml/js/footerScripts.js"></script>




	
            <!-- MyBuys Page Initialization -->
            <script type="text/javascript">
              mybuys.initPage();
            </script>
            <style type="text/css">
            .mbzone2 {width: 232px !important;}
            .mbzone2 .mbitem { width: 190px; !important;}
            </style>
	


<!-- autocomplete scripts - autocomplete_data.js updated 8/23/12 -cp -->
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/yui/2.8.0r4/build/utilities/utilities.js"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/yui/2.8.0r4/build/datasource/datasource-min.js"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/yui/2.8.0r4/build/autocomplete/autocomplete-min.js"></script>
<script type="text/javascript" src="//content.atomz.com/sp10049ed9/publish/autocomplete_data.js"></script>  

<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>	

<!-- sc/2109 -->
<script type="text/javascript">
var cbjspath = "static.chartbeat.com/js/chartbeat.js?uid=1632&domain=oreilly.com";
var cbjsprotocol = (("https:" == document.location.protocol) ? "https://s3.amazonaws.com/" : "http://");
document.write(unescape("%3Cscript src='"+cbjsprotocol+cbjspath+"' type='text/javascript'%3E%3C/script%3E"))
</script>

<!-- also crazyegg-->
<script type="text/javascript">
setTimeout(function(){var a=document.createElement("script");
var b=document.getElementsByTagName('script')[0];
a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0011/6381.js";
a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
</script>

<!-- #sc/2109 -->




</body>

</html>





