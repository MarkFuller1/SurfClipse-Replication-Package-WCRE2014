<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<style type="text/css">
@import url( /templates/default/mobile/styles/mobile.css?1386831159603 ) ;
</style>

<meta name="viewport" content="width = 320" />

<title>Exception: java.net.ProtocolException: Server redirected too many times?? Please help! (Web Services forum at JavaRanch)</title>
<link rel="canonical" href="http://www.coderanch.com/t/473325/Web-Services/java/Exception-java-net-ProtocolException-Server"/>
<link rel="alternate" media="handheld" href="http://www.coderanch.com/mobile/t/473325/Web-Services/java/Exception-java-net-ProtocolException-Server?foo=a">
</head>
<body class="en_US">

<a name="top"></a>
<table cellspacing="0" cellpadding="0" border="0">
    <tr>
        <td align="center">
                <a href="/forums/list"><img
                src="/templates/default/mobile/images/mobile-moose.gif"
                vspace="1" border="0" alt="[Logo]" width="100" height="100" /></a>
		</td>
        <td class="logo" valign="center">
          A friendly place for programming greenhorns!
        <a href="#bottom"><img src="/templates/default/mobile/images/down_arrow.gif" width="10" height="10" alt="Jump to bottom of page" /></a>
        </td>
    </tr>
</table>

<p>
  <a id="register" class="mainmenu" href="/forums/user/insert">Register</a> /
  <a id="login" class="mainmenu" href="/forums/user/login">Login</a>
</p>
<a class="maintitle" href="http://www.coderanch.com/forums">Java Forums</a>



&raquo; <a class="maintitle" href="/forums/c/1/java">Java</a> &raquo;
<a class="maintitle" href="/forums/f-51/Web-Services">Web Services</a>
<div class="subject">Exception: java.net.ProtocolException: Server redirected too many times?? Please help!</div>


  
  <div class="mobilePostBody">
  

  Post by: Praveen Kumar Jayaram, Ranch Hand<br />
  on <span class="lastPostTime">Dec 01, 2009 23:23:35</span>
  


    
  </div>
  
  
    <div class="mobilePostText">
                        
        <span class="postbody">Hi All,
<br /> 
<br /> Am trying to call a .NET webservice hosted on Sharepoint server using a CXF client (Generated using SOAPUI tool automatically).
<br /> To access this webservice one needs to authenticate using NTLM....
<br /> 
<br /> Am using JCIFS and HTTPClient frameworks for providing NTLM authentication and JRE is 1.5.0_12.
<br /> When the webservice is invoked by this CXF client am getting ProxyException and it is as follows:
<br /> 
<br /> <b>ERROR [DefaultQuartzScheduler_Worker-1] com.honeywell.mdb.MDBClient (writeLinearFiles:80) - Could not send Message.
<br /> ERROR [DefaultQuartzScheduler_Worker-1] com.honeywell.mdb.MDBClient (writeLinearFiles:81) - javax.xml.ws.WebServiceException: Could not send Message.
<br /> 	at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:135)
<br /> 	at $Proxy39.getAnsysExportContents(Unknown Source)
<br /> 	at com.honeywell.mdb.client.MDBAnsysExportServiceSoap_MDBAnsysExportServiceSoap_Client.getData(MDBAnsysExportServiceSoap_MDBAnsysExportServiceSoap_Client.java:85)
<br /> 	at com.honeywell.mdb.MDBClient.getMDBData(MDBClient.java:154)
<br /> 	at com.honeywell.mdb.MDBClient.getLinearData(MDBClient.java:91)
<br /> 	at com.honeywell.mdb.MDBClient.writeLinearFiles(MDBClient.java:52)
<br /> 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
<br /> 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
<br /> 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
<br /> 	at java.lang.reflect.Method.invoke(Method.java:585)
<br /> 	at org.springframework.util.MethodInvoker.invoke(MethodInvoker.java:275)
<br /> 	at org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean$MethodInvokingJob.executeInternal(MethodInvokingJobDetailFactoryBean.java:272)
<br /> 	at org.springframework.scheduling.quartz.QuartzJobBean.execute(QuartzJobBean.java:86)
<br /> 	at org.quartz.core.JobRunShell.run(JobRunShell.java:202)
<br /> 	at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:529)
<br /> Caused by: java.net.ProtocolException: Server redirected too many  times (20)
<br /> 	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
<br /> 	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
<br /> 	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
<br /> 	at java.lang.reflect.Constructor.newInstance(Constructor.java:494)
<br /> 	at sun.net.www.protocol.http.HttpURLConnection$6.run(HttpURLConnection.java:1223)
<br /> 	at java.security.AccessController.doPrivileged(Native Method)
<br /> 	at sun.net.www.protocol.http.HttpURLConnection.getChainedException(HttpURLConnection.java:1217)
<br /> 	at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:906)
<br /> 	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponseInternal(HTTPConduit.java:2166)
<br /> 	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponse(HTTPConduit.java:2057)
<br /> 	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.close(HTTPConduit.java:1982)
<br /> 	at org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:66)
<br /> 	at org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:637)
<br /> 	at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:62)
<br /> 	at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:236)
<br /> 	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:483)
<br /> 	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:309)
<br /> 	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:261)
<br /> 	at org.apache.cxf.frontend.ClientProxy.invokeSync(ClientProxy.java:73)
<br /> 	at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:124)
<br /> 	... 14 more
<br /> Caused by: java.net.ProtocolException: Server redirected too many  times (20)
<br /> 	at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1178)
<br /> 	at java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:367)
<br /> 	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponseInternal(HTTPConduit.java:2081)
<br /> 	... 25 more</b>
<br /> 
<br /> Here is the code:
<br /> <textarea name="code" class="java" cols="60" rows="10">
public String getData() throws Exception{
    	URL wsdlURL = MDBAnsysExportService.WSDL_LOCATION;
    	ResourceBundle resBundle = ResourceBundle.getBundle("resources/settings");
    	//Set the jcifs properties
		jcifs.Config.setProperty("jcifs.smb.client.domain", resBundle.getString("Sharepoint.Domain"));
		//jcifs.Config.setProperty("jcifs.netbios.wins", "xxx.xxx.xxx.xxx");
		jcifs.Config.setProperty("jcifs.smb.client.soTimeout", "300000");
		jcifs.Config.setProperty("jcifs.netbios.cachePolicy", "1200"); //20 minutes
		jcifs.Config.setProperty("jcifs.smb.client.username", resBundle.getString("Sharepoint.User"));
		
		String encryptionKey = "123456789012345678901234567890";
	    String encryptionScheme = StringEncrypter.DES_ENCRYPTION_SCHEME;
        StringEncrypter stringEncrypter = null;
        try{
        	stringEncrypter = new StringEncrypter(encryptionScheme, encryptionKey);
        	jcifs.Config.setProperty("jcifs.smb.client.password", stringEncrypter.decrypt(resBundle.getString("Sharepoint.Password")));
        }catch(Exception e){
        	logger.error("Exception: " + e.getMessage());
        	throw e;
        }
		
        Authenticator.setDefault(new MyAuthenticator()); //overriding the default authenticator
        //Register the jcifs URL handler to enable NTLM
	   jcifs.Config.registerSmbURLHandler();
		
		MDBAnsysExportService ss = new MDBAnsysExportService(wsdlURL, SERVICE_NAME);
        MDBAnsysExportServiceSoap port = ss.getMDBAnsysExportServiceSoap();
        
		// HTTPClient configuration
		// Turn off chunking so that NTLM can occur
		Client client = ClientProxy.getClient(port);
		HTTPConduit http = (HTTPConduit) client.getConduit();
		HTTPClientPolicy httpClientPolicy = new HTTPClientPolicy();
		httpClientPolicy.setConnectionTimeout(36000);
		httpClientPolicy.setAllowChunking(false);
		http.setClient(httpClientPolicy);

        System.out.println("Invoking getAnsysExportContents...");
        java.lang.String _getAnsysExportContents_strDocLibName = "Ansys Export";
        java.lang.String _getAnsysExportContents__return = port.getAnsysExportContents(_getAnsysExportContents_strDocLibName);
        System.out.println("getAnsysExportContents.result=" + _getAnsysExportContents__return);
        return _getAnsysExportContents__return;
    }</textarea>
<br /> 
<br /> Please someone help is fixing this issue.</span>
    </div>
 <br />



  
  <div class="mobilePostBody">
  

  Post by: Praveen Kumar Jayaram, Ranch Hand<br />
  on <span class="lastPostTime">Dec 02, 2009 02:24:52</span>
  


    
  </div>
  
  
    <div class="mobilePostText">
                        
        <span class="postbody">Any clue for this issue?  <img src="http://cache-www.coderanch.com/images/smilies/jr-confused.gif" border="0"> 
<br /> Any issues in JRE 1.5.0_12 version???
<br /> 
<br /> Thanks in advance.</span>
    </div>
 <br />



  
  <div class="mobilePostBody">
  

  Post by: William Brogden, Rancher<br />
  on <span class="lastPostTime">Dec 02, 2009 06:25:46</span>
  


    
  </div>
  
  
    <div class="mobilePostText">
                        
        <span class="postbody">My first guess would be that you have somehow created an endless loop of redirects.
<br /> 
<br /> Bill</span>
    </div>
 <br />



  
  <div class="mobilePostBody">
  

  Post by: Praveen Kumar Jayaram, Ranch Hand<br />
  on <span class="lastPostTime">Dec 02, 2009 07:40:58</span>
  


    
  </div>
  
  
    <div class="mobilePostText">
                        
        <span class="postbody">
<br /> How do you I find where thing are getting looped?
<br /> The program runs fine with JRE 1.6... When it is moved to JRE 1.5.0_12, faced so many jar dependencies.
<br /> After resolving all compile and run time dependencies I get the ProxyException when calling the .Net webservice <img src="http://cache-www.coderanch.com/images/smilies/8eb205fcc69b104dc7dacc0c97694f63.gif" border="0">
<br /> 
<br /> Any clues now?
<br /> 
<br /> Regards,
<br /> Praveen</span>
    </div>
 <br />



  
  <div class="mobilePostBody">
  

  Post by: William Brogden, Rancher<br />
  on <span class="lastPostTime">Dec 02, 2009 11:39:35</span>
  


    
  </div>
  
  
    <div class="mobilePostText">
                        
        <span class="postbody">&nbsp;<blockquote class="uncited">
			<div>  The program runs fine with JRE 1.6  </div>
		</blockquote>
<br /> 
<br /> Just one of those tiny tiny details you neglected to mention in the original post.
<br /> 
<br /> The obvious advice - go back to JRE 1.6.
<br /> 
<br />  <img src="http://cache-www.coderanch.com/images/smilies/2786c5c8e1a8be796fb2f726cca5a0fe.gif" /></span>
    </div>
 <br />



  
  <div class="mobilePostBody">
  

  Post by: Praveen Kumar Jayaram, Ranch Hand<br />
  on <span class="lastPostTime">Dec 03, 2009 06:54:04</span>
  


    
  </div>
  
  
    <div class="mobilePostText">
                        
        <span class="postbody">Thanks for the suggestion.</span>
    </div>
 <br />



<br />


               <input type="button" value="Reply" onclick="location.href='/forums/posts/reply/0/473325'" />
	

    <input type="button" value="New Topic" onclick="location.href='/jforum?module=posts&amp;action=insert&amp;forum_id=51'" />






<br /><br />


<br />

<div class="gensmall center">
All times above are in ranch (not your local) time.<br />
The current ranch time is <br />
<span class="mobileLabel">Dec 13, 2013 17:10:37</span>.
</div>
<br />
<div>
  <a id="search" href="/forums/search/filters/51"><span class="mobileLabel">Search</span></a>
  |
<a href="/forums/recentTopics/list"><span class="mobileLabel">Recent Topics</span></a>
</div>

 <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ?  "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
 <script type="text/javascript">
    if (typeof _gat !== "undefined") {
        var pageTracker = _gat._getTracker("UA-2371260-2");
        pageTracker._trackPageview();

        dt = new Date();
        pageTracker._setVar("hour: " + dt.getHours());
    }
</script>

<br />
<div>Copyright &copy; 1998-2013 <a href="http://www.javaranch.com/paul-wheaton.jsp">Paul Wheaton</a></div>
<br />
<a name="bottom"></a>
<a href="#top"><img src="/templates/default/mobile/images/up_arrow.gif" width="10" height="10" alt="Jump to top of page" /></a>
<br />
<a href="http://www.coderanch.com/t/473325/Web-Services/java/Exception-java-net-ProtocolException-Server?nonMobile=true">Or visit our non-mobile (full) site</a>
</body>
</html>
