<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
<title>m2e-core.git - m2e main repository.</title>
<meta name='generator' content='cgit v0.9.2-21-gd62e'/>
<meta name='robots' content='index, nofollow'/>
<link rel='stylesheet' type='text/css' href=''/>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='http://git.eclipse.org/c/m2e/m2e-core.git/atom/org.eclipse.m2e.core?h=master' type='application/atom+xml'/>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="stylesheet" type="text/css" href="/eclipse.org-common/themes/Nova/css/layout.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/eclipse.org-common/themes/Nova/css/header.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/eclipse.org-common/themes/Nova/css/footer.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/eclipse.org-common/themes/Nova/css/visual.css" media="screen" /> 
<link rel="stylesheet" type="text/css" href="/eclipse.org-common/themes/Nova/css/novaWide.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/cgit.css" media="screen" />

<!--[if IE]>    <link rel="stylesheet" type="text/css" href="/eclipse.org-common/themes/Nova/css/ie_style.css" media="screen"/> <![endif]-->
<!--[if IE 6]>  <link rel="stylesheet" type="text/css" href="/eclipse.org-common/themes/Nova/css/ie6_style.css" media="screen"/> <![endif]-->
</head>
<body>
<div id="novaWrapper"><div id="clearHeader">
<div id="logo"><img src="/eclipse.org-common/themes/Nova/images/eclipse.png" alt="Eclipse.org"/></div>
<div id="otherSites"><div id="sites"><ul id="sitesUL"><li><a href='http://marketplace.eclipse.org/'><img alt="Eclipse Marketplace" src="//dev.eclipse.org/custom_icons/network-wired-bw.png"/>&nbsp;<div>Eclipse Marketplace</div></a></li>
<li><a href='http://live.eclipse.org'><img alt="Eclipse Live" src="//dev.eclipse.org/custom_icons/audio-input-microphone-bw.png"/>&nbsp;<div>Eclipse Live</div></a></li>
<li><a href='https://bugs.eclipse.org/bugs/'><img alt="Bugzilla" src="//dev.eclipse.org/custom_icons/system-search-bw.png"/>&nbsp;<div>Bugzilla</div></a></li>
<li><a href='http://www.planeteclipse.org/'><img alt="Planet Eclipse" src="//dev.eclipse.org/large_icons/devices/audio-card.png"/>&nbsp;<div>Planet Eclipse</div></a></li>
<li><a href='http://wiki.eclipse.org/'><img alt="Eclipse Wiki" src="//dev.eclipse.org/custom_icons/accessories-text-editor-bw.png"/>&nbsp;<div>Eclipse Wiki</div></a></li>
<li><a href='http://portal.eclipse.org'><img alt="MyFoundation Portal" src="//dev.eclipse.org/custom_icons/preferences-system-network-proxy-bw.png"/><div>My Foundation Portal</div></a></li></ul></div></div></div>
<div id="header"><div id="menu"><ul>
<li><a href="http://www.eclipse.org/">Eclipse Home</a></li> 
<li><a href="http://www.eclipse.org/users/">Users</a></li> 
<li><a href="http://www.eclipse.org/membership/">Members</a></li> 
<li><a href="http://www.eclipse.org/committers/">Committers</a></li> 
<li><a href="http://www.eclipse.org/downloads/">Downloads</a></li> 
<li><a href="http://www.eclipse.org/resources/">Resources</a></li> 
<li><a href="http://www.eclipse.org/projects/">Projects</a></li> 
<li><a href="http://www.eclipse.org/org/">About Us</a></li> 
</ul></div>
<div id="search">
<form action="http://www.google.com/cse" id="searchbox_017941334893793413703:sqfrdtd112s">
<input type="hidden" name="cx" value="017941334893793413703:sqfrdtd112s" />
<input id="searchBox" type="text" name="q" size="25" />
<input id="searchButton" type="submit" name="sa" value="Search" />
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=searchbox_017941334893793413703%3Asqfrdtd112s&lang=en"></script>
</div></div><div id="novaContent">
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/c/'><img src='/git.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/c/'>index</a> : <a title='m2e-core.git' href='/c/m2e/m2e-core.git/'>m2e-core.git</a></td><td class='form'><form method='get' action=''>
<input type='hidden' name='id' value='68443fde8e72144d925de3c36200d4e4247ac94c'/><select name='h' onchange='this.form.submit();'>
<option value='396554_orbitVelocityBundle'>396554_orbitVelocityBundle</option>
<option value='416371_m2e-usage-stats'>416371_m2e-usage-stats</option>
<option value='MNGECLIPSE-2690'>MNGECLIPSE-2690</option>
<option value='code-generation-support'>code-generation-support</option>
<option value='effective-pom'>effective-pom</option>
<option value='m2e-1.0.x'>m2e-1.0.x</option>
<option value='m2e-1.3.x'>m2e-1.3.x</option>
<option value='master' selected='selected'>master</option>
<option value='maven-runtime-split'>maven-runtime-split</option>
<option value='runtime'>runtime</option>
</select> <input type='submit' name='' value='switch'/></form></td></tr>
<tr><td class='sub'>m2e main repository.</td><td class='sub right'>Igor Fedorenko</td></tr></table>
<table class='tabs'><tr><td>
<a href='/c/m2e/m2e-core.git/'>summary</a><a href='/c/m2e/m2e-core.git/refs/?id=68443fde8e72144d925de3c36200d4e4247ac94c'>refs</a><a href='/c/m2e/m2e-core.git/log/org.eclipse.m2e.core'>log</a><a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core?id=68443fde8e72144d925de3c36200d4e4247ac94c'>tree</a><a class='active' href='/c/m2e/m2e-core.git/commit/org.eclipse.m2e.core?id=68443fde8e72144d925de3c36200d4e4247ac94c'>commit</a><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core?id=68443fde8e72144d925de3c36200d4e4247ac94c'>diff</a><a href='/c/m2e/m2e-core.git/stats/org.eclipse.m2e.core'>stats</a><a href='/c/m2e/m2e-core.git/about/'>about</a></td><td class='form'><form class='right' method='get' action='/c/m2e/m2e-core.git/log/org.eclipse.m2e.core'>
<input type='hidden' name='id' value='68443fde8e72144d925de3c36200d4e4247ac94c'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='text' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='path'>path: <a href='/c/m2e/m2e-core.git/commit/?id=68443fde8e72144d925de3c36200d4e4247ac94c'>root</a>/<a href='/c/m2e/m2e-core.git/commit/org.eclipse.m2e.core?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core</a></div><div class='content'><div class='cgit-panel'><b>diff options</b><form method='get' action='.'><input type='hidden' name='id' value='68443fde8e72144d925de3c36200d4e4247ac94c'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='ss' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Igor Fedorenko</td><td class='right'>2011-02-02 15:36:24 (EST)</td></tr>
<tr><th>committer</th><td> Igor Fedorenko</td><td class='right'>2011-02-02 15:48:56 (EST)</td></tr>
<tr><th>commit</th><td colspan='2' class='sha1'><a href='/c/m2e/m2e-core.git/commit/org.eclipse.m2e.core?id=68443fde8e72144d925de3c36200d4e4247ac94c'>68443fde8e72144d925de3c36200d4e4247ac94c</a> (<a href='/c/m2e/m2e-core.git/patch/org.eclipse.m2e.core?id=68443fde8e72144d925de3c36200d4e4247ac94c'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='sha1'><a href='/c/m2e/m2e-core.git/tree/?id=68443fde8e72144d925de3c36200d4e4247ac94c'>b56122575624d9499593b1edd88d7327a8325fbf</a> /<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core</a></td></tr>
<tr><th>parent</th><td colspan='2' class='sha1'><a href='/c/m2e/m2e-core.git/commit/org.eclipse.m2e.core?id=ebb733d48dac3806b45ae8e350543c587665096d'>ebb733d48dac3806b45ae8e350543c587665096d</a> (<a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core?id=68443fde8e72144d925de3c36200d4e4247ac94c&amp;id2=ebb733d48dac3806b45ae8e350543c587665096d'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='sha1'><a href='/c/m2e/m2e-core.git/snapshot/m2e-core-68443fde8e72144d925de3c36200d4e4247ac94c.zip'>m2e-core-68443fde8e72144d925de3c36200d4e4247ac94c.zip</a><br/><a href='/c/m2e/m2e-core.git/snapshot/m2e-core-68443fde8e72144d925de3c36200d4e4247ac94c.tar.gz'>m2e-core-68443fde8e72144d925de3c36200d4e4247ac94c.tar.gz</a><br/><a href='/c/m2e/m2e-core.git/snapshot/m2e-core-68443fde8e72144d925de3c36200d4e4247ac94c.tar.bz2'>m2e-core-68443fde8e72144d925de3c36200d4e4247ac94c.tar.bz2</a><br/></td></tr></table>
<div class='commit-subject'>335719: error marker when project configuration update is required<span class='decoration'></span></div><div class='commit-msg'>Separated project effective lifecycle mapping metadata and made it
persistent member of MavenProjectFacade. LifecycleMapping instances
do not have any project specific state as a result of this change.

Added (partially implemented) logic to perform effective lifecycle
mapping metadata comparison during whenever project pom.xml change
is detected. Error marker is added to project if mapping has change
and/or interesting mojo execution configuration has changed.

Signed-off-by: Igor Fedorenko &lt;igor@ifedorenko.com&gt;
</div><div class='diffstat-header'><a href='/c/m2e/m2e-core.git/diff/?id=68443fde8e72144d925de3c36200d4e4247ac94c'>Diffstat</a> (limited to 'org.eclipse.m2e.core')</div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/.settings/org.eclipse.jdt.core.prefs?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/.settings/org.eclipse.jdt.core.prefs</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.5%;'/><td class='rem' style='width: 0.5%;'/><td class='none' style='width: 99.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/META-INF/MANIFEST.MF?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/META-INF/MANIFEST.MF</a></td><td class='right'>10</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 2.6%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 97.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/mdo/lifecycle-mapping-metadata-model.xml?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/mdo/lifecycle-mapping-metadata-model.xml</a></td><td class='right'>12</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 2.6%;'/><td class='rem' style='width: 0.5%;'/><td class='none' style='width: 96.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/plugin.properties?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/plugin.properties</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.3%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 99.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/plugin.xml?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/plugin.xml</a></td><td class='right'>5</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 1.3%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 98.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/MavenPlugin.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/MavenPlugin.java</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.5%;'/><td class='rem' style='width: 0.5%;'/><td class='none' style='width: 99.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/ChangeNatureAction.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/ChangeNatureAction.java</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.3%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 99.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/EnableNatureAction.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/EnableNatureAction.java</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.3%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 99.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/UpdateConfigurationAction.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/UpdateConfigurationAction.java</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 99.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/core/IMavenConstants.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/core/IMavenConstants.java</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.5%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 99.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/Messages.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/Messages.java</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 1.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 99.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/builder/MavenBuilder.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/builder/MavenBuilder.java</a></td><td class='right'>12</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 1.6%;'/><td class='rem' style='width: 1.6%;'/><td class='none' style='width: 96.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='mov'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/ActionMessageProblemInfo.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/ActionMessageProblemInfo.java</a> (renamed from org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ActionMessageProblemInfo.java)</td><td class='right'>9</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 1.6%;'/><td class='rem' style='width: 0.8%;'/><td class='none' style='width: 97.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/DuplicateMappingException.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/DuplicateMappingException.java</a></td><td class='right'>3</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 0.8%;'/><td class='none' style='width: 99.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/InvalidLifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/InvalidLifecycleMapping.java</a></td><td class='right'>31</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 6.3%;'/><td class='rem' style='width: 1.8%;'/><td class='none' style='width: 91.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='mov'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingConfigurationException.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingConfigurationException.java</a> (renamed from org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/LifecycleMappingConfigurationException.java)</td><td class='right'>5</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.8%;'/><td class='rem' style='width: 0.5%;'/><td class='none' style='width: 98.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingFactory.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingFactory.java</a></td><td class='right'>381</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 75.1%;'/><td class='rem' style='width: 24.9%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='add'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingResult.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingResult.java</a></td><td class='right'>80</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 21.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 79.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='mov'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingConfiguratorProblemInfo.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingConfiguratorProblemInfo.java</a> (renamed from org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MissingConfiguratorProblemInfo.java)</td><td class='right'>9</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 1.6%;'/><td class='rem' style='width: 0.8%;'/><td class='none' style='width: 97.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecycleExtensionPoint.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecycleExtensionPoint.java</a></td><td class='right'>6</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.5%;'/><td class='rem' style='width: 1.0%;'/><td class='none' style='width: 98.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecyclePackaging.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecyclePackaging.java</a></td><td class='right'>8</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 1.3%;'/><td class='rem' style='width: 0.8%;'/><td class='none' style='width: 97.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='add'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/NotCoveredMojoExecution.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/NotCoveredMojoExecution.java</a></td><td class='right'>43</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 11.3%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 88.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='mov'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IEditorMarkerService.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IEditorMarkerService.java</a> (renamed from org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IEditorMarkerService.java)</td><td class='right'>3</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.5%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 99.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='mov'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMarkerLocationService.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMarkerLocationService.java</a> (renamed from org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMarkerLocationService.java)</td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.3%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 99.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='mov'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMavenMarkerManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMavenMarkerManager.java</a> (renamed from org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenMarkerManager.java)</td><td class='right'>6</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 1.3%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 98.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='mov'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MarkerUtils.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MarkerUtils.java</a> (renamed from org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MarkerUtils.java)</td><td class='right'>5</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.3%;'/><td class='rem' style='width: 1.0%;'/><td class='none' style='width: 98.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='mov'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenMarkerManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenMarkerManager.java</a> (renamed from org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MavenMarkerManager.java)</td><td class='right'>11</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 2.4%;'/><td class='rem' style='width: 0.5%;'/><td class='none' style='width: 97.1%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='mov'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenProblemInfo.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenProblemInfo.java</a> (renamed from org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/LifecycleMappingProblemInfo.java)</td><td class='right'>17</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 3.1%;'/><td class='rem' style='width: 1.3%;'/><td class='none' style='width: 95.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/messages.properties?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/messages.properties</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.5%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 99.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='del'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/IgnoreMojoProjectConfigurator.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/IgnoreMojoProjectConfigurator.java</a></td><td class='right'>32</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 8.4%;'/><td class='none' style='width: 91.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='del'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionProjectConfigurator.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionProjectConfigurator.java</a></td><td class='right'>130</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 34.1%;'/><td class='none' style='width: 65.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='del'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionUtils.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionUtils.java</a></td><td class='right'>29</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 7.6%;'/><td class='none' style='width: 92.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/ProjectConfigurationManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/ProjectConfigurationManager.java</a></td><td class='right'>106</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 6.8%;'/><td class='rem' style='width: 21.0%;'/><td class='none' style='width: 72.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/DefaultMavenDependencyResolver.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/DefaultMavenDependencyResolver.java</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.3%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 99.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/MavenProjectFacade.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/MavenProjectFacade.java</a></td><td class='right'>110</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 17.1%;'/><td class='rem' style='width: 11.8%;'/><td class='none' style='width: 71.1%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/ProjectRegistryManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/ProjectRegistryManager.java</a></td><td class='right'>121</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 23.1%;'/><td class='rem' style='width: 8.7%;'/><td class='none' style='width: 68.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenProjectFacade.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenProjectFacade.java</a></td><td class='right'>22</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 3.4%;'/><td class='rem' style='width: 2.4%;'/><td class='none' style='width: 94.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IProjectConfigurationManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IProjectConfigurationManager.java</a></td><td class='right'>13</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.5%;'/><td class='rem' style='width: 2.9%;'/><td class='none' style='width: 96.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/MavenProjectManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/MavenProjectManager.java</a></td><td class='right'>12</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 3.1%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 96.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractCustomizableLifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractCustomizableLifecycleMapping.java</a></td><td class='right'>191</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 25.5%;'/><td class='rem' style='width: 24.7%;'/><td class='none' style='width: 49.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractLifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractLifecycleMapping.java</a></td><td class='right'>105</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 2.1%;'/><td class='rem' style='width: 25.5%;'/><td class='none' style='width: 72.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractProjectConfigurator.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractProjectConfigurator.java</a></td><td class='right'>149</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 25.5%;'/><td class='rem' style='width: 13.6%;'/><td class='none' style='width: 60.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ILifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ILifecycleMapping.java</a></td><td class='right'>19</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 2.6%;'/><td class='rem' style='width: 2.4%;'/><td class='none' style='width: 95.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MojoExecutionKey.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MojoExecutionKey.java</a></td><td class='right'>12</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 2.9%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 96.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/NoopLifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/NoopLifecycleMapping.java</a></td><td class='right'>21</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 4.5%;'/><td class='rem' style='width: 1.0%;'/><td class='none' style='width: 94.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/dialogs/EditDependencyDialog.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/dialogs/EditDependencyDialog.java</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.3%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 99.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/LifecycleMappingPropertyPageFactory.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/LifecycleMappingPropertyPageFactory.java</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.3%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 99.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/ProjectConfiguratorsTable.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/ProjectConfiguratorsTable.java</a></td><td class='right'>9</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.8%;'/><td class='rem' style='width: 1.6%;'/><td class='none' style='width: 97.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/c/m2e/m2e-core.git/diff/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/preferences/MavenProjectPreferencePage.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/preferences/MavenProjectPreferencePage.java</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='100%'><tr><td class='add' style='width: 0.3%;'/><td class='rem' style='width: 0.3%;'/><td class='none' style='width: 99.5%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>49 files changed, 984 insertions, 784 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/org.eclipse.m2e.core/.settings/org.eclipse.jdt.core.prefs b/org.eclipse.m2e.core/.settings/org.eclipse.jdt.core.prefs<br/>index 149db3a..3e20f12 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/.settings/org.eclipse.jdt.core.prefs?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/.settings/org.eclipse.jdt.core.prefs</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/.settings/org.eclipse.jdt.core.prefs?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/.settings/org.eclipse.jdt.core.prefs</a></div><div class='hunk'>@@ -1,4 +1,4 @@</div><div class='del'>-#Wed Dec 22 17:22:22 EST 2010</div><div class='add'>+#Thu Jan 27 23:50:41 EST 2011</div><div class='ctx'> eclipse.preferences.version=1</div><div class='ctx'> org.eclipse.jdt.core.builder.cleanOutputFolder=clean</div><div class='ctx'> org.eclipse.jdt.core.builder.duplicateResourceTask=warning</div><div class='hunk'>@@ -95,7 +95,7 @@ org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownException=warning</div><div class='ctx'> org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionExemptExceptionAndThrowable=enabled</div><div class='ctx'> org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionIncludeDocCommentReference=enabled</div><div class='ctx'> org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionWhenOverriding=enabled</div><div class='del'>-org.eclipse.jdt.core.compiler.problem.unusedImport=warning</div><div class='add'>+org.eclipse.jdt.core.compiler.problem.unusedImport=error</div><div class='ctx'> org.eclipse.jdt.core.compiler.problem.unusedLabel=warning</div><div class='ctx'> org.eclipse.jdt.core.compiler.problem.unusedLocal=warning</div><div class='ctx'> org.eclipse.jdt.core.compiler.problem.unusedObjectAllocation=ignore</div><div class='head'>diff --git a/org.eclipse.m2e.core/META-INF/MANIFEST.MF b/org.eclipse.m2e.core/META-INF/MANIFEST.MF<br/>index 8a52a3c..bf1bfdb 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/META-INF/MANIFEST.MF?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/META-INF/MANIFEST.MF</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/META-INF/MANIFEST.MF?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/META-INF/MANIFEST.MF</a></div><div class='hunk'>@@ -35,11 +35,15 @@ Export-Package: org.eclipse.m2e.core,</div><div class='ctx'>  org.eclipse.m2e.core.embedder,</div><div class='ctx'>  org.eclipse.m2e.core.index,</div><div class='ctx'>  org.eclipse.m2e.core.internal;x-friends:="org.eclipse.m2e.core.tests,org.eclipse.m2e.jdt",</div><div class='add'>+ org.eclipse.m2e.core.internal.builder;x-internal:=true,</div><div class='add'>+ org.eclipse.m2e.core.internal.console;x-internal:=true,</div><div class='add'>+ org.eclipse.m2e.core.internal.content;x-internal:=true,</div><div class='ctx'>  org.eclipse.m2e.core.internal.embedder;x-friends:="org.eclipse.m2e.core.tests",</div><div class='ctx'>  org.eclipse.m2e.core.internal.index;x-friends:="org.eclipse.m2e.core.tests",</div><div class='ctx'>  org.eclipse.m2e.core.internal.lifecycle;x-friends:="org.eclipse.m2e.tests,org.eclipse.m2e.editor.xml",</div><div class='ctx'>  org.eclipse.m2e.core.internal.lifecycle.model;x-friends:="org.eclipse.m2e.tests,org.eclipse.m2e.editor.xml",</div><div class='ctx'>  org.eclipse.m2e.core.internal.lifecycle.model.io.xpp3;x-friends:="org.eclipse.m2e.tests",</div><div class='add'>+ org.eclipse.m2e.core.internal.markers;x-internal:=true,</div><div class='ctx'>  org.eclipse.m2e.core.internal.preferences;x-friends:="org.eclipse.m2e.core.tests",</div><div class='ctx'>  org.eclipse.m2e.core.internal.project;x-friends:="org.eclipse.m2e.core.tests",</div><div class='ctx'>  org.eclipse.m2e.core.internal.project.registry;x-friends:="org.eclipse.m2e.core.tests",</div><div class='hunk'>@@ -50,7 +54,13 @@ Export-Package: org.eclipse.m2e.core,</div><div class='ctx'>  org.eclipse.m2e.core.repository,</div><div class='ctx'>  org.eclipse.m2e.core.scm,</div><div class='ctx'>  org.eclipse.m2e.core.ui.dialogs,</div><div class='add'>+ org.eclipse.m2e.core.ui.internal;x-internal:=true,</div><div class='add'>+ org.eclipse.m2e.core.ui.internal.components;x-internal:=true,</div><div class='add'>+ org.eclipse.m2e.core.ui.internal.lifecycle;x-internal:=true,</div><div class='ctx'>  org.eclipse.m2e.core.ui.internal.preferences;x-internal:=true,</div><div class='add'>+ org.eclipse.m2e.core.ui.internal.search;x-internal:=true,</div><div class='add'>+ org.eclipse.m2e.core.ui.internal.views;x-internal:=true,</div><div class='add'>+ org.eclipse.m2e.core.ui.internal.views.nodes;x-internal:=true,</div><div class='ctx'>  org.eclipse.m2e.core.util,</div><div class='ctx'>  org.eclipse.m2e.core.util.search,</div><div class='ctx'>  org.eclipse.m2e.core.wizards</div><div class='head'>diff --git a/org.eclipse.m2e.core/mdo/lifecycle-mapping-metadata-model.xml b/org.eclipse.m2e.core/mdo/lifecycle-mapping-metadata-model.xml<br/>index d701a4a..e28626a 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/mdo/lifecycle-mapping-metadata-model.xml?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/mdo/lifecycle-mapping-metadata-model.xml</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/mdo/lifecycle-mapping-metadata-model.xml?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/mdo/lifecycle-mapping-metadata-model.xml</a></div><div class='hunk'>@@ -116,11 +116,11 @@</div><div class='ctx'>     this(groupId, artifactId, versionRange, new java.util.LinkedHashSet&lt;String&gt;(java.util.Arrays.asList(goals.split(",")))); //$NON-NLS-1$;</div><div class='ctx'>   }</div><div class='ctx'>   </div><div class='del'>-  private org.apache.maven.artifact.versioning.VersionRange parsedVersionRange;</div><div class='add'>+  private transient org.apache.maven.artifact.versioning.VersionRange parsedVersionRange;</div><div class='ctx'> </div><div class='ctx'>   public void setVersionRange(String versionRange) {</div><div class='add'>+    this.versionRange = versionRange;</div><div class='ctx'>     try {</div><div class='del'>-      this.versionRange = versionRange;</div><div class='ctx'>       parsedVersionRange = org.apache.maven.artifact.versioning.VersionRange.createFromVersionSpec(versionRange);</div><div class='ctx'>     } catch(org.apache.maven.artifact.versioning.InvalidVersionSpecificationException e) {</div><div class='ctx'>       throw new IllegalArgumentException("Cannot parse version range: " + versionRange, e);</div><div class='hunk'>@@ -137,6 +137,14 @@</div><div class='ctx'> </div><div class='ctx'>     org.apache.maven.artifact.versioning.DefaultArtifactVersion version = new org.apache.maven.artifact.versioning.DefaultArtifactVersion(mojoExecution.getVersion());</div><div class='ctx'> </div><div class='add'>+    if(parsedVersionRange==null) {</div><div class='add'>+      try {</div><div class='add'>+        parsedVersionRange = org.apache.maven.artifact.versioning.VersionRange.createFromVersionSpec(versionRange);</div><div class='add'>+      } catch(org.apache.maven.artifact.versioning.InvalidVersionSpecificationException e) {</div><div class='add'>+        throw new IllegalArgumentException("Cannot parse version range: " + versionRange, e);</div><div class='add'>+      }</div><div class='add'>+    }</div><div class='add'>+</div><div class='ctx'>     if(!parsedVersionRange.containsVersion(version)) {</div><div class='ctx'>       return false;</div><div class='ctx'>     }</div><div class='head'>diff --git a/org.eclipse.m2e.core/plugin.properties b/org.eclipse.m2e.core/plugin.properties<br/>index 011f4c9..91655c9 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/plugin.properties?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/plugin.properties</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/plugin.properties?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/plugin.properties</a></div><div class='hunk'>@@ -46,6 +46,7 @@ m2.marker.problem.configuration.name=Maven Configuration Problem</div><div class='ctx'> m2.marker.problem.dependency.name=Maven Dependency Problem</div><div class='ctx'> m2.marker.problem.build.name=Maven Build Problem</div><div class='ctx'> m2.marker.problem.build.participant.name=Maven Build Participant Problem</div><div class='add'>+m2.marker.problem.lifecycleMapping.name=Maven Project Build Lifecycle Mapping Problem</div><div class='ctx'> m2.marker.hint.name=Maven Problem</div><div class='ctx'> </div><div class='ctx'> m2.preferences.page.name=Maven</div><div class='head'>diff --git a/org.eclipse.m2e.core/plugin.xml b/org.eclipse.m2e.core/plugin.xml<br/>index 34f1621..ef81dd1 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/plugin.xml?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/plugin.xml</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/plugin.xml?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/plugin.xml</a></div><div class='hunk'>@@ -687,6 +687,11 @@</div><div class='ctx'>       &lt;super type="org.eclipse.m2e.core.maven2Problem.build"/&gt;</div><div class='ctx'>       &lt;persistent value="true"/&gt;</div><div class='ctx'>    &lt;/extension&gt;</div><div class='add'>+   &lt;extension point="org.eclipse.core.resources.markers"</div><div class='add'>+         id="maven2Problem.lifecycleMapping"</div><div class='add'>+         name="%m2.marker.problem.lifecycleMapping.name"&gt;</div><div class='add'>+      &lt;persistent value="true"/&gt;</div><div class='add'>+   &lt;/extension&gt;</div><div class='ctx'> </div><div class='ctx'>    &lt;extension point="org.eclipse.ui.keywords"&gt;</div><div class='ctx'>       &lt;keyword id="org.eclipse.m2e.core.maven" label="%keyword.label"/&gt;</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/MavenPlugin.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/MavenPlugin.java<br/>index 0771716..f74b3c7 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/MavenPlugin.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/MavenPlugin.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/MavenPlugin.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/MavenPlugin.java</a></div><div class='hunk'>@@ -92,14 +92,14 @@ import org.eclipse.m2e.core.internal.embedder.MavenWorkspaceRuntime;</div><div class='ctx'> import org.eclipse.m2e.core.internal.index.IndexesExtensionReader;</div><div class='ctx'> import org.eclipse.m2e.core.internal.index.IndexingTransferListener;</div><div class='ctx'> import org.eclipse.m2e.core.internal.index.NexusIndexManager;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.IMavenMarkerManager;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenMarkerManager;</div><div class='ctx'> import org.eclipse.m2e.core.internal.preferences.MavenPreferenceConstants;</div><div class='del'>-import org.eclipse.m2e.core.internal.project.MavenMarkerManager;</div><div class='ctx'> import org.eclipse.m2e.core.internal.project.ProjectConfigurationManager;</div><div class='ctx'> import org.eclipse.m2e.core.internal.project.WorkspaceStateWriter;</div><div class='ctx'> import org.eclipse.m2e.core.internal.project.registry.ProjectRegistryManager;</div><div class='ctx'> import org.eclipse.m2e.core.internal.project.registry.ProjectRegistryRefreshJob;</div><div class='ctx'> import org.eclipse.m2e.core.internal.repository.RepositoryRegistry;</div><div class='del'>-import org.eclipse.m2e.core.project.IMavenMarkerManager;</div><div class='ctx'> import org.eclipse.m2e.core.project.IProjectConfigurationManager;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenProjectManager;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenUpdateRequest;</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/ChangeNatureAction.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/ChangeNatureAction.java<br/>index f8d91b9..4f2170f 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/ChangeNatureAction.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/ChangeNatureAction.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/ChangeNatureAction.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/ChangeNatureAction.java</a></div><div class='hunk'>@@ -173,7 +173,7 @@ public class ChangeNatureAction implements IObjectActionDelegate, IExecutableExt</div><div class='ctx'>       projectManager.setResolverConfiguration(project, configuration);</div><div class='ctx'> </div><div class='ctx'>       if (updateSourceFolders) {</div><div class='del'>-        importManager.updateProjectConfiguration(project, configuration, monitor);</div><div class='add'>+        importManager.updateProjectConfiguration(project, monitor);</div><div class='ctx'>       }</div><div class='ctx'>     }</div><div class='ctx'>   }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/EnableNatureAction.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/EnableNatureAction.java<br/>index 2dec17c..0d88a28 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/EnableNatureAction.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/EnableNatureAction.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/EnableNatureAction.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/EnableNatureAction.java</a></div><div class='hunk'>@@ -126,7 +126,7 @@ public class EnableNatureAction implements IObjectActionDelegate, IExecutableExt</div><div class='ctx'>             configurationManager.enableMavenNature(project, configuration, new NullProgressMonitor());</div><div class='ctx'>   </div><div class='ctx'>             if(!hasMavenNature) {</div><div class='del'>-              configurationManager.updateProjectConfiguration(project, configuration, monitor);</div><div class='add'>+              configurationManager.updateProjectConfiguration(project, monitor);</div><div class='ctx'>             }</div><div class='ctx'>           } catch(CoreException ex) {</div><div class='ctx'>             MavenLogger.log(ex);</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/UpdateConfigurationAction.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/UpdateConfigurationAction.java<br/>index ffb14c0..fc8277d 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/UpdateConfigurationAction.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/UpdateConfigurationAction.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/UpdateConfigurationAction.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/actions/UpdateConfigurationAction.java</a></div><div class='hunk'>@@ -102,7 +102,6 @@ public class UpdateConfigurationAction implements IObjectActionDelegate {</div><div class='ctx'>           if(projectFacade != null) {</div><div class='ctx'>             try {</div><div class='ctx'>               plugin.getProjectConfigurationManager().updateProjectConfiguration(project, //</div><div class='del'>-                  projectFacade.getResolverConfiguration(), //</div><div class='ctx'>                   new SubProgressMonitor(monitor, 1));</div><div class='ctx'>             } catch(CoreException ex) {</div><div class='ctx'>               if(status == null) {</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/core/IMavenConstants.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/core/IMavenConstants.java<br/>index 39822a6..94580f8 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/core/IMavenConstants.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/core/IMavenConstants.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/core/IMavenConstants.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/core/IMavenConstants.java</a></div><div class='hunk'>@@ -31,6 +31,8 @@ public interface IMavenConstants {</div><div class='ctx'> </div><div class='ctx'>   public static final String MARKER_CONFIGURATION_ID = MARKER_ID + ".configuration"; //$NON-NLS-1$</div><div class='ctx'> </div><div class='add'>+  public static final String MARKER_LIFECYCLEMAPPING_ID = MARKER_ID + ".lifecycleMapping"; //$NON-NLS-1$</div><div class='add'>+</div><div class='ctx'>   public static final String MARKER_DEPENDENCY_ID = MARKER_ID + ".dependency"; //$NON-NLS-1$</div><div class='ctx'> </div><div class='ctx'>   public static final String MARKER_BUILD_ID = MARKER_ID + ".build"; //$NON-NLS-1$</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/Messages.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/Messages.java<br/>index 9d0cc34..b1919a3 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/Messages.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/Messages.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/Messages.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/Messages.java</a></div><div class='hunk'>@@ -231,7 +231,11 @@ public class Messages extends NLS {</div><div class='ctx'> </div><div class='ctx'>   public static String PluginExecutionMappingDuplicate;</div><div class='ctx'> </div><div class='add'>+  public static String PluginExecutionMappingInvalid;</div><div class='add'>+</div><div class='ctx'>   public static String ProjectConfiguratorNotAvailable;</div><div class='add'>+  </div><div class='add'>+  public static String ProjectConfigurationUpdateRequired;</div><div class='ctx'> </div><div class='ctx'>   public static String LocalArchetypeCatalogDialog_btnBrowse;</div><div class='ctx'> </div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/builder/MavenBuilder.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/builder/MavenBuilder.java<br/>index 3d48120..660e9aa 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/builder/MavenBuilder.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/builder/MavenBuilder.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/builder/MavenBuilder.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/builder/MavenBuilder.java</a></div><div class='hunk'>@@ -53,7 +53,7 @@ import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='ctx'> import org.eclipse.m2e.core.core.MavenConsole;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.IMaven;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.IMavenConfiguration;</div><div class='del'>-import org.eclipse.m2e.core.project.IMavenMarkerManager;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.IMavenMarkerManager;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.project.IProjectConfigurationManager;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenProjectManager;</div><div class='hunk'>@@ -137,8 +137,8 @@ public class MavenBuilder extends IncrementalProjectBuilder {</div><div class='ctx'>       return null;</div><div class='ctx'>     }</div><div class='ctx'> </div><div class='del'>-    ILifecycleMapping lifecycleMapping = configurationManager.getLifecycleMapping(projectFacade, monitor);</div><div class='del'>-    if(lifecycleMapping == null || !projectFacade.hasValidConfiguration()) {</div><div class='add'>+    ILifecycleMapping lifecycleMapping = configurationManager.getLifecycleMapping(projectFacade);</div><div class='add'>+    if(lifecycleMapping == null) {</div><div class='ctx'>       return null;</div><div class='ctx'>     }</div><div class='ctx'> </div><div class='hunk'>@@ -165,7 +165,7 @@ public class MavenBuilder extends IncrementalProjectBuilder {</div><div class='ctx'>     ThreadBuildContext.setThreadBuildContext(buildContext);</div><div class='ctx'>     try {</div><div class='ctx'>       Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; buildParticipantsByMojoExecutionKey = lifecycleMapping</div><div class='del'>-          .getBuildParticipants(monitor);</div><div class='add'>+          .getBuildParticipants(projectFacade, monitor);</div><div class='ctx'>       for(Entry&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; entry : buildParticipantsByMojoExecutionKey</div><div class='ctx'>           .entrySet()) {</div><div class='ctx'>         for(InternalBuildParticipant participant : entry.getValue()) {</div><div class='hunk'>@@ -367,7 +367,7 @@ public class MavenBuilder extends IncrementalProjectBuilder {</div><div class='ctx'>       addErrorMarker(ce);</div><div class='ctx'>       return;</div><div class='ctx'>     }</div><div class='del'>-    ILifecycleMapping lifecycleMapping = configurationManager.getLifecycleMapping(projectFacade, monitor);</div><div class='add'>+    ILifecycleMapping lifecycleMapping = configurationManager.getLifecycleMapping(projectFacade);</div><div class='ctx'> </div><div class='ctx'>     if(lifecycleMapping == null) {</div><div class='ctx'>       return;</div><div class='hunk'>@@ -379,7 +379,7 @@ public class MavenBuilder extends IncrementalProjectBuilder {</div><div class='ctx'>     ThreadBuildContext.setThreadBuildContext(buildContext);</div><div class='ctx'>     try {</div><div class='ctx'>       Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; buildParticipantsByMojoExecutionKey = lifecycleMapping</div><div class='del'>-          .getBuildParticipants(monitor);</div><div class='add'>+          .getBuildParticipants(projectFacade, monitor);</div><div class='ctx'>       for(Entry&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; entry : buildParticipantsByMojoExecutionKey</div><div class='ctx'>           .entrySet()) {</div><div class='ctx'>         for(InternalBuildParticipant participant : entry.getValue()) {</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ActionMessageProblemInfo.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/ActionMessageProblemInfo.java<br/>index ac38d0d..028d34d 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ActionMessageProblemInfo.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ActionMessageProblemInfo.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/ActionMessageProblemInfo.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/ActionMessageProblemInfo.java</a></div><div class='hunk'>@@ -8,16 +8,19 @@</div><div class='ctx'>  * Contributors:</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='del'>-package org.eclipse.m2e.core.project.configurator;</div><div class='add'>+package org.eclipse.m2e.core.internal.lifecycle;</div><div class='ctx'> </div><div class='del'>-public class ActionMessageProblemInfo extends LifecycleMappingProblemInfo {</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenProblemInfo;</div><div class='add'>+import org.eclipse.m2e.core.project.configurator.MojoExecutionKey;</div><div class='add'>+</div><div class='add'>+public class ActionMessageProblemInfo extends MavenProblemInfo {</div><div class='ctx'>   private final MojoExecutionKey mojoExecutionKey;</div><div class='ctx'> </div><div class='ctx'>   public MojoExecutionKey getMojoExecutionKey() {</div><div class='ctx'>     return this.mojoExecutionKey;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  protected ActionMessageProblemInfo(MojoExecutionKey mojoExecutionKey, int line, String message, int severity) {</div><div class='add'>+  public ActionMessageProblemInfo(MojoExecutionKey mojoExecutionKey, int line, String message, int severity) {</div><div class='ctx'>     super(line, message, severity);</div><div class='ctx'>     this.mojoExecutionKey = mojoExecutionKey;</div><div class='ctx'>   }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/DuplicateMappingException.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/DuplicateMappingException.java<br/>index 2894ed6..367b132 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/DuplicateMappingException.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/DuplicateMappingException.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/DuplicateMappingException.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/DuplicateMappingException.java</a></div><div class='hunk'>@@ -10,9 +10,6 @@</div><div class='ctx'>  *******************************************************************************/</div><div class='ctx'> package org.eclipse.m2e.core.internal.lifecycle;</div><div class='ctx'> </div><div class='del'>-/**</div><div class='del'>- * @author igor</div><div class='del'>- */</div><div class='ctx'> public class DuplicateMappingException extends RuntimeException {</div><div class='ctx'>   private static final long serialVersionUID = 6916144930019743563L;</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/InvalidLifecycleMapping.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/InvalidLifecycleMapping.java<br/>index be205ba..68cee7e 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/InvalidLifecycleMapping.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/InvalidLifecycleMapping.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/InvalidLifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/InvalidLifecycleMapping.java</a></div><div class='hunk'>@@ -11,15 +11,23 @@</div><div class='ctx'> </div><div class='ctx'> package org.eclipse.m2e.core.internal.lifecycle;</div><div class='ctx'> </div><div class='add'>+import java.util.Arrays;</div><div class='ctx'> import java.util.Collections;</div><div class='ctx'> import java.util.List;</div><div class='ctx'> import java.util.Map;</div><div class='ctx'> </div><div class='add'>+import org.eclipse.core.resources.IMarker;</div><div class='add'>+import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> import org.eclipse.core.runtime.IProgressMonitor;</div><div class='add'>+import org.eclipse.osgi.util.NLS;</div><div class='ctx'> </div><div class='ctx'> import org.apache.maven.plugin.MojoExecution;</div><div class='ctx'> </div><div class='add'>+import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='add'>+import org.eclipse.m2e.core.internal.Messages;</div><div class='ctx'> import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionMetadata;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenProblemInfo;</div><div class='add'>+import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.AbstractBuildParticipant;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.AbstractLifecycleMapping;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.AbstractProjectConfigurator;</div><div class='hunk'>@@ -48,11 +56,11 @@ public class InvalidLifecycleMapping extends AbstractLifecycleMapping {</div><div class='ctx'>   public void unconfigure(ProjectConfigurationRequest request, IProgressMonitor monitor) {</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public List&lt;AbstractProjectConfigurator&gt; getProjectConfigurators(IProgressMonitor monitor) {</div><div class='add'>+  public List&lt;AbstractProjectConfigurator&gt; getProjectConfigurators(IMavenProjectFacade project, IProgressMonitor monitor) {</div><div class='ctx'>     return Collections.emptyList();</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public List&lt;MojoExecutionKey&gt; getNotCoveredMojoExecutions(IProgressMonitor monitor) {</div><div class='add'>+  public List&lt;MojoExecutionKey&gt; getNotCoveredMojoExecutions(IMavenProjectFacade project, IProgressMonitor monitor) {</div><div class='ctx'>     return Collections.emptyList();</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='hunk'>@@ -60,7 +68,8 @@ public class InvalidLifecycleMapping extends AbstractLifecycleMapping {</div><div class='ctx'>     return false;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; getBuildParticipants(IProgressMonitor monitor) {</div><div class='add'>+  public Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; getBuildParticipants(IMavenProjectFacade project,</div><div class='add'>+      IProgressMonitor monitor) {</div><div class='ctx'>     return Collections.emptyMap();</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='hunk'>@@ -68,11 +77,19 @@ public class InvalidLifecycleMapping extends AbstractLifecycleMapping {</div><div class='ctx'>       Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; executionMapping) {</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public void addMissingLifecycleExtensionPoint(int line, String message, String lifecycleId) {</div><div class='del'>-    addProblem(new MissingLifecycleExtensionPoint(line, message, lifecycleId));</div><div class='add'>+  public boolean hasLifecycleMappingChanged(IMavenProjectFacade oldFacade, IMavenProjectFacade newFacade,</div><div class='add'>+      IProgressMonitor monitor) {</div><div class='add'>+    return false;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public void addMissingLifecyclePackaging(int line, String message, String packaging) {</div><div class='del'>-    addProblem(new MissingLifecyclePackaging(line, message, packaging));</div><div class='add'>+  public List&lt;MavenProblemInfo&gt; validateLifecycleMapping(final IMavenProjectFacade mavenProjectFacade) {</div><div class='add'>+    MavenProblemInfo problem = new MavenProblemInfo(1, NLS.bind(Messages.LifecycleMissing,</div><div class='add'>+        mavenProjectFacade.getPackaging()), IMarker.SEVERITY_ERROR) {</div><div class='add'>+      public void processMarker(IMarker marker) throws CoreException {</div><div class='add'>+        marker.setAttribute(IMavenConstants.MARKER_ATTR_PACKAGING, mavenProjectFacade.getPackaging());</div><div class='add'>+        marker.setAttribute(IMavenConstants.MARKER_ATTR_EDITOR_HINT, IMavenConstants.EDITOR_HINT_UNKNOWN_PACKAGING);</div><div class='add'>+      }</div><div class='add'>+    };</div><div class='add'>+    return Arrays.asList(problem);</div><div class='ctx'>   }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/LifecycleMappingConfigurationException.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingConfigurationException.java<br/>index 6a0fb35..43d8ac4 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/LifecycleMappingConfigurationException.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/LifecycleMappingConfigurationException.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingConfigurationException.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingConfigurationException.java</a></div><div class='hunk'>@@ -8,7 +8,8 @@</div><div class='ctx'>  * Contributors:</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='del'>-package org.eclipse.m2e.core.project.configurator;</div><div class='add'>+</div><div class='add'>+package org.eclipse.m2e.core.internal.lifecycle;</div><div class='ctx'> </div><div class='ctx'> public class LifecycleMappingConfigurationException extends RuntimeException {</div><div class='ctx'>   private static final long serialVersionUID = 713512516951833457L;</div><div class='hunk'>@@ -16,7 +17,7 @@ public class LifecycleMappingConfigurationException extends RuntimeException {</div><div class='ctx'>   public LifecycleMappingConfigurationException(String message) {</div><div class='ctx'>     super(message);</div><div class='ctx'>   }</div><div class='del'>-  </div><div class='add'>+</div><div class='ctx'>   public LifecycleMappingConfigurationException(String message, Throwable cause) {</div><div class='ctx'>     super(message + " Cause: " + cause.getMessage(), cause);</div><div class='ctx'>   }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingFactory.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingFactory.java<br/>index 47e6ac2..d060671 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingFactory.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingFactory.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingFactory.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingFactory.java</a></div><div class='hunk'>@@ -18,7 +18,6 @@ import java.io.InputStream;</div><div class='ctx'> import java.io.StringReader;</div><div class='ctx'> import java.net.URL;</div><div class='ctx'> import java.util.ArrayList;</div><div class='del'>-import java.util.Arrays;</div><div class='ctx'> import java.util.HashMap;</div><div class='ctx'> import java.util.HashSet;</div><div class='ctx'> import java.util.LinkedHashMap;</div><div class='hunk'>@@ -32,6 +31,7 @@ import org.osgi.framework.BundleContext;</div><div class='ctx'> import org.slf4j.Logger;</div><div class='ctx'> import org.slf4j.LoggerFactory;</div><div class='ctx'> </div><div class='add'>+import org.eclipse.core.resources.IMarker;</div><div class='ctx'> import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> import org.eclipse.core.runtime.IConfigurationElement;</div><div class='ctx'> import org.eclipse.core.runtime.IExtension;</div><div class='hunk'>@@ -51,8 +51,6 @@ import org.apache.maven.artifact.repository.ArtifactRepository;</div><div class='ctx'> import org.apache.maven.artifact.versioning.ComparableVersion;</div><div class='ctx'> import org.apache.maven.execution.DefaultMavenExecutionRequest;</div><div class='ctx'> import org.apache.maven.execution.MavenExecutionRequest;</div><div class='del'>-import org.apache.maven.execution.MavenSession;</div><div class='del'>-import org.apache.maven.lifecycle.MavenExecutionPlan;</div><div class='ctx'> import org.apache.maven.model.Build;</div><div class='ctx'> import org.apache.maven.model.BuildBase;</div><div class='ctx'> import org.apache.maven.model.Model;</div><div class='hunk'>@@ -73,14 +71,14 @@ import org.eclipse.m2e.core.internal.lifecycle.model.LifecycleMappingMetadataSou</div><div class='ctx'> import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionAction;</div><div class='ctx'> import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionMetadata;</div><div class='ctx'> import org.eclipse.m2e.core.internal.lifecycle.model.io.xpp3.LifecycleMappingMetadataSourceXpp3Reader;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenProblemInfo;</div><div class='add'>+import org.eclipse.m2e.core.internal.project.registry.MavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.AbstractLifecycleMapping;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.AbstractProjectConfigurator;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.ILifecycleMapping;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.LifecycleMappingConfigurationException;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.MojoExecutionBuildParticipant;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.MojoExecutionKey;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.NoopLifecycleMapping;</div><div class='ctx'> </div><div class='ctx'> </div><div class='ctx'> /**</div><div class='hunk'>@@ -139,39 +137,55 @@ public class LifecycleMappingFactory {</div><div class='ctx'> </div><div class='ctx'>   private static final String LIFECYCLE_MAPPING_METADATA_CLASSIFIER = "lifecycle-mapping-metadata";</div><div class='ctx'> </div><div class='del'>-  public static ILifecycleMapping getLifecycleMapping(MavenExecutionRequest templateRequest,</div><div class='del'>-      IMavenProjectFacade projectFacade, IProgressMonitor monitor) {</div><div class='add'>+  public static LifecycleMappingResult calculateLifecycleMapping(MavenExecutionRequest templateRequest,</div><div class='add'>+      MavenProjectFacade projectFacade, IProgressMonitor monitor) {</div><div class='ctx'>     long start = System.currentTimeMillis();</div><div class='ctx'>     log.debug("Loading lifecycle mapping for {}.", projectFacade.toString()); //$NON-NLS-1$</div><div class='ctx'> </div><div class='del'>-    ILifecycleMapping lifecycleMapping = null;</div><div class='add'>+    LifecycleMappingResult result = new LifecycleMappingResult();</div><div class='add'>+</div><div class='ctx'>     try {</div><div class='del'>-      String packagingType = projectFacade.getPackaging();</div><div class='del'>-      if("pom".equals(packagingType)) { //$NON-NLS-1$</div><div class='del'>-        lifecycleMapping = new NoopLifecycleMapping();</div><div class='del'>-      } else {</div><div class='del'>-        lifecycleMapping = getLifecycleMappingImpl(templateRequest, projectFacade, monitor);</div><div class='add'>+      calculateEffectiveLifecycleMappingMetadata(result, templateRequest, projectFacade, monitor);</div><div class='add'>+</div><div class='add'>+      instantiateLifecycleMapping(result, projectFacade, result.getLifecycleMappingId());</div><div class='add'>+</div><div class='add'>+      if(result.getLifecycleMapping() != null) {</div><div class='add'>+        instantiateProjectConfigurators(result, result.getMojoExecutionMapping());</div><div class='ctx'>       }</div><div class='del'>-    } catch(Exception ex) {</div><div class='del'>-      log.error(ex.getMessage(), ex);</div><div class='del'>-      InvalidLifecycleMapping _lifecycleMapping = new InvalidLifecycleMapping();</div><div class='del'>-      lifecycleMapping = _lifecycleMapping;</div><div class='del'>-      _lifecycleMapping.addProblem(0, ex.getMessage()); // XXX that looses most of useful info</div><div class='add'>+    } catch(CoreException ex) {</div><div class='add'>+      MavenLogger.log(ex);</div><div class='add'>+      result.addProblem(new MavenProblemInfo(0, ex.getMessage())); // XXX that looses most of useful info</div><div class='ctx'>     } finally {</div><div class='del'>-      log.info(</div><div class='del'>-          "Using {} lifecycle mapping for {}.", lifecycleMapping == null ? null : lifecycleMapping.getId(), projectFacade.toString()); //$NON-NLS-1$</div><div class='add'>+      log.info("Using {} lifecycle mapping for {}.", result.getLifecycleMappingId(), projectFacade.toString()); //$NON-NLS-1$</div><div class='ctx'>       log.debug(</div><div class='ctx'>           "Loaded lifecycle mapping in {} ms for {}.", System.currentTimeMillis() - start, projectFacade.toString()); //$NON-NLS-1$</div><div class='ctx'>     }</div><div class='del'>-    return lifecycleMapping;</div><div class='add'>+    return result;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  private static ILifecycleMapping getLifecycleMappingImpl(MavenExecutionRequest templateRequest,</div><div class='del'>-      IMavenProjectFacade projectFacade, IProgressMonitor monitor) throws CoreException {</div><div class='add'>+  private static void calculateEffectiveLifecycleMappingMetadata(LifecycleMappingResult result,</div><div class='add'>+      MavenExecutionRequest templateRequest, MavenProjectFacade projectFacade, IProgressMonitor monitor)</div><div class='add'>+      throws CoreException {</div><div class='ctx'> </div><div class='del'>-    MavenProject mavenProject = projectFacade.getMavenProject(monitor);</div><div class='add'>+    String packagingType = projectFacade.getPackaging();</div><div class='add'>+    List&lt;MojoExecution&gt; executionPlan = projectFacade.getExecutionPlan();</div><div class='add'>+    if("pom".equals(packagingType)) { //$NON-NLS-1$</div><div class='add'>+      log.debug("Using NoopLifecycleMapping lifecycle mapping for {}.", projectFacade.toString()); //$NON-NLS-1$</div><div class='add'>+</div><div class='add'>+      Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; executionMapping = new LinkedHashMap&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt;();</div><div class='add'>+      if(executionPlan != null) {</div><div class='add'>+        for(MojoExecution mojoExecution : executionPlan) {</div><div class='add'>+          executionMapping.put(new MojoExecutionKey(mojoExecution), new ArrayList&lt;PluginExecutionMetadata&gt;());</div><div class='add'>+        }</div><div class='add'>+      }</div><div class='ctx'> </div><div class='del'>-    InvalidLifecycleMapping invalidLifecycleMapping = new InvalidLifecycleMapping();</div><div class='add'>+      result.setLifecycleMappingId("NULL"); // TODO proper constant</div><div class='add'>+      result.setMojoExecutionMapping(executionMapping);</div><div class='add'>+</div><div class='add'>+      return;</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    MavenProject mavenProject = projectFacade.getMavenProject(monitor);</div><div class='ctx'> </div><div class='ctx'>     // List order</div><div class='ctx'>     // 1. this pom embedded, this pom referenced, parent embedded, parent referenced, grand parent embedded...</div><div class='hunk'>@@ -182,10 +196,11 @@ public class LifecycleMappingFactory {</div><div class='ctx'>       for(LifecycleMappingMetadataSource source : getPomMappingMetadataSources(mavenProject, templateRequest, monitor)) {</div><div class='ctx'>         metadataSources.add(new SimpleMappingMetadataSource(source));</div><div class='ctx'>       }</div><div class='del'>-    } catch(CoreException e) {</div><div class='del'>-      invalidLifecycleMapping.addProblem(1, e.getMessage()); // XXX that looses most of useful info</div><div class='ctx'>     } catch(LifecycleMappingConfigurationException e) {</div><div class='del'>-      invalidLifecycleMapping.addProblem(1, e.getMessage());</div><div class='add'>+      // could not read/parse/interpret mapping metadata configured in the pom or inherited from parent pom.</div><div class='add'>+      // record the problem and return</div><div class='add'>+      result.addProblem(new MavenProblemInfo(1, e.getMessage()));</div><div class='add'>+      return;</div><div class='ctx'>     }</div><div class='ctx'>     metadataSources.add(new SimpleMappingMetadataSource(getBundleMetadataSources()));</div><div class='ctx'>     LifecycleMappingMetadataSource defaultSource = getDefaultLifecycleMappingMetadataSource();</div><div class='hunk'>@@ -193,11 +208,6 @@ public class LifecycleMappingFactory {</div><div class='ctx'>       metadataSources.add(new SimpleMappingMetadataSource(defaultSource));</div><div class='ctx'>     }</div><div class='ctx'> </div><div class='del'>-    if(invalidLifecycleMapping.hasProblems()) {</div><div class='del'>-      // all bets are off if we can't load metadata sources</div><div class='del'>-      return invalidLifecycleMapping;</div><div class='del'>-    }</div><div class='del'>-</div><div class='ctx'>     //</div><div class='ctx'>     // PHASE 1. Look for lifecycle mapping for packaging type</div><div class='ctx'>     //</div><div class='hunk'>@@ -215,94 +225,188 @@ public class LifecycleMappingFactory {</div><div class='ctx'>           break;</div><div class='ctx'>         }</div><div class='ctx'>       } catch(DuplicateMappingException e) {</div><div class='del'>-        invalidLifecycleMapping.addProblem(1, NLS.bind(Messages.LifecycleDuplicate, mavenProject.getPackaging()));</div><div class='add'>+        log.debug("Duplicate lifecycle mapping metadata for {}.", mavenProject.toString());</div><div class='add'>+        result.addProblem(new MavenProblemInfo(1, NLS.bind(Messages.LifecycleDuplicate, mavenProject.getPackaging())));</div><div class='ctx'>         break;</div><div class='ctx'>       }</div><div class='ctx'>     }</div><div class='ctx'> </div><div class='ctx'>     if(lifecycleMappingMetadata == null) {</div><div class='ctx'>       log.debug("Could not find lifecycle mapping metadata for {}.", mavenProject.toString());</div><div class='del'>-</div><div class='del'>-      invalidLifecycleMapping.addMissingLifecyclePackaging(1,</div><div class='del'>-          NLS.bind(Messages.LifecycleMissing, mavenProject.getPackaging()), mavenProject.getPackaging());</div><div class='del'>-      return invalidLifecycleMapping;</div><div class='add'>+      return;</div><div class='ctx'>     }</div><div class='ctx'> </div><div class='del'>-    AbstractLifecycleMapping lifecycleMapping = getLifecycleMapping(lifecycleMappingMetadata.getLifecycleMappingId());</div><div class='del'>-    if(lifecycleMapping == null) {</div><div class='del'>-      invalidLifecycleMapping.addMissingLifecycleExtensionPoint(1,</div><div class='del'>-          NLS.bind(Messages.LifecycleMappingNotAvailable, lifecycleMappingMetadata.getLifecycleMappingId()),</div><div class='del'>-          lifecycleMappingMetadata.getLifecycleMappingId());</div><div class='del'>-      return invalidLifecycleMapping;</div><div class='del'>-    }</div><div class='add'>+    result.setLifecycleMappingId(lifecycleMappingMetadata.getLifecycleMappingId());</div><div class='ctx'> </div><div class='ctx'>     //</div><div class='ctx'>     // PHASE 2. Bind project configurators to mojo executions.</div><div class='ctx'>     //</div><div class='ctx'> </div><div class='del'>-    IMaven maven = MavenPlugin.getDefault().getMaven();</div><div class='del'>-    MavenSession session = maven.createSession(DefaultMavenExecutionRequest.copy(templateRequest), mavenProject);</div><div class='del'>-    List&lt;String&gt; goals = Arrays.asList("deploy"); //$NON-NLS-1$</div><div class='del'>-    MavenExecutionPlan executionPlan = maven.calculateExecutionPlan(session, mavenProject, goals, false, monitor);</div><div class='ctx'> </div><div class='ctx'>     Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; executionMapping = new LinkedHashMap&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt;();</div><div class='del'>-    List&lt;MojoExecution&gt; mojoExecutions = new ArrayList&lt;MojoExecution&gt;();</div><div class='del'>-</div><div class='del'>-    for(MojoExecution execution : executionPlan.getMojoExecutions()) {</div><div class='del'>-      MojoExecutionKey executionKey = new MojoExecutionKey(execution);</div><div class='ctx'> </div><div class='del'>-      PluginExecutionMetadata primaryMetadata = null;</div><div class='del'>-</div><div class='del'>-      // find primary mapping first</div><div class='del'>-      try {</div><div class='del'>-        for(MappingMetadataSource source : metadataSources) {</div><div class='del'>-          for(PluginExecutionMetadata executionMetadata : source.getPluginExecutionMetadata(execution)) {</div><div class='del'>-            if(LifecycleMappingFactory.isPrimaryMapping(executionMetadata)) {</div><div class='del'>-              if(primaryMetadata != null) {</div><div class='del'>-                primaryMetadata = null;</div><div class='del'>-                throw new DuplicateMappingException();</div><div class='add'>+    if(executionPlan != null) {</div><div class='add'>+      for(MojoExecution execution : executionPlan) {</div><div class='add'>+        MojoExecutionKey executionKey = new MojoExecutionKey(execution);</div><div class='add'>+  </div><div class='add'>+        PluginExecutionMetadata primaryMetadata = null;</div><div class='add'>+  </div><div class='add'>+        // find primary mapping first</div><div class='add'>+        try {</div><div class='add'>+          for(MappingMetadataSource source : metadataSources) {</div><div class='add'>+            for(PluginExecutionMetadata executionMetadata : source.getPluginExecutionMetadata(execution)) {</div><div class='add'>+              if(LifecycleMappingFactory.isPrimaryMapping(executionMetadata)) {</div><div class='add'>+                if(primaryMetadata != null) {</div><div class='add'>+                  primaryMetadata = null;</div><div class='add'>+                  throw new DuplicateMappingException();</div><div class='add'>+                }</div><div class='add'>+                primaryMetadata = executionMetadata;</div><div class='ctx'>               }</div><div class='del'>-              primaryMetadata = executionMetadata;</div><div class='add'>+            }</div><div class='add'>+            if(primaryMetadata != null) {</div><div class='add'>+              break;</div><div class='ctx'>             }</div><div class='ctx'>           }</div><div class='del'>-          if(primaryMetadata != null) {</div><div class='del'>-            break;</div><div class='del'>-          }</div><div class='add'>+        } catch(DuplicateMappingException e) {</div><div class='add'>+          log.debug("Duplicate mojo execution mapping metadata for {}.", executionKey.toString());</div><div class='add'>+          result.addProblem(new MavenProblemInfo(1, NLS.bind(Messages.PluginExecutionMappingDuplicate,</div><div class='add'>+              executionKey.toString())));</div><div class='ctx'>         }</div><div class='del'>-      } catch(DuplicateMappingException e) {</div><div class='del'>-        lifecycleMapping.addProblem(1, NLS.bind(Messages.PluginExecutionMappingDuplicate, executionKey.toString()));</div><div class='del'>-      }</div><div class='del'>-</div><div class='del'>-      List&lt;PluginExecutionMetadata&gt; executionMetadatas = new ArrayList&lt;PluginExecutionMetadata&gt;();</div><div class='del'>-      if(primaryMetadata != null) {</div><div class='del'>-        executionMetadatas.add(primaryMetadata);</div><div class='del'>-</div><div class='del'>-        // attach any secondary mapping</div><div class='del'>-        for(MappingMetadataSource source : metadataSources) {</div><div class='del'>-          List&lt;PluginExecutionMetadata&gt; metadatas = source.getPluginExecutionMetadata(execution);</div><div class='del'>-          if(metadatas != null) {</div><div class='del'>-            for(PluginExecutionMetadata metadata : metadatas) {</div><div class='del'>-              if(LifecycleMappingFactory.isSecondaryMapping(metadata, primaryMetadata)) {</div><div class='del'>-                executionMetadatas.add(metadata);</div><div class='add'>+  </div><div class='add'>+        if(primaryMetadata != null &amp;&amp; !isValidPluginExecutionMetadata(primaryMetadata)) {</div><div class='add'>+          log.debug("Invalid plugin execution mapping metadata for {}.", executionKey.toString());</div><div class='add'>+          result.addProblem(new MavenProblemInfo(1, NLS.bind(Messages.PluginExecutionMappingInvalid,</div><div class='add'>+              executionKey.toString())));</div><div class='add'>+          primaryMetadata = null;</div><div class='add'>+        }</div><div class='add'>+  </div><div class='add'>+        List&lt;PluginExecutionMetadata&gt; executionMetadatas = new ArrayList&lt;PluginExecutionMetadata&gt;();</div><div class='add'>+        if(primaryMetadata != null) {</div><div class='add'>+          executionMetadatas.add(primaryMetadata);</div><div class='add'>+  </div><div class='add'>+          if(primaryMetadata.getAction() == PluginExecutionAction.configurator) {</div><div class='add'>+            // attach any secondary mapping</div><div class='add'>+            for(MappingMetadataSource source : metadataSources) {</div><div class='add'>+              List&lt;PluginExecutionMetadata&gt; metadatas = source.getPluginExecutionMetadata(execution);</div><div class='add'>+              if(metadatas != null) {</div><div class='add'>+                for(PluginExecutionMetadata metadata : metadatas) {</div><div class='add'>+                  if(isValidPluginExecutionMetadata(metadata)) {</div><div class='add'>+                    if(metadata.getAction() == PluginExecutionAction.configurator</div><div class='add'>+                        &amp;&amp; isSecondaryMapping(metadata, primaryMetadata)) {</div><div class='add'>+                      executionMetadatas.add(metadata);</div><div class='add'>+                    }</div><div class='add'>+                  } else {</div><div class='add'>+                    log.debug("Invalid secondary lifecycle mapping metadata for {}.", executionKey.toString());</div><div class='add'>+                  }</div><div class='add'>+                }</div><div class='ctx'>               }</div><div class='ctx'>             }</div><div class='ctx'>           }</div><div class='ctx'>         }</div><div class='del'>-</div><div class='ctx'>         executionMapping.put(executionKey, executionMetadatas);</div><div class='ctx'>       }</div><div class='del'>-      if(!executionMetadatas.isEmpty() &amp;&amp; executionMetadatas.get(0).getAction() != PluginExecutionAction.ignore) {</div><div class='del'>-        mojoExecutions.add(maven.setupMojoExecution(session, mavenProject, execution));</div><div class='del'>-      } else {</div><div class='del'>-        // do not setup non-interesting/ignore mojo executions</div><div class='del'>-        mojoExecutions.add(execution);</div><div class='add'>+    } else {</div><div class='add'>+      log.debug("Execution plan is null, could not calculate mojo execution mapping for {}.",  mavenProject.toString());</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    result.setMojoExecutionMapping(executionMapping);</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  private static boolean isValidPluginExecutionMetadata(PluginExecutionMetadata metadata) {</div><div class='add'>+    switch(metadata.getAction()) {</div><div class='add'>+      case error:</div><div class='add'>+      case execute:</div><div class='add'>+      case ignore:</div><div class='add'>+        return true;</div><div class='add'>+      case configurator:</div><div class='add'>+        try {</div><div class='add'>+          getProjectConfiguratorId(metadata);</div><div class='add'>+          return true;</div><div class='add'>+        } catch(LifecycleMappingConfigurationException e) {</div><div class='add'>+          // fall through</div><div class='add'>+        }</div><div class='add'>+        return false;</div><div class='add'>+    }</div><div class='add'>+    return false;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  private static void instantiateLifecycleMapping(LifecycleMappingResult result, IMavenProjectFacade facade,</div><div class='add'>+      String lifecycleMappingId) {</div><div class='add'>+    // validate lifecycle mapping id and bail if it's invalid</div><div class='add'>+    AbstractLifecycleMapping lifecycleMapping = null;</div><div class='add'>+    if(lifecycleMappingId != null) {</div><div class='add'>+      lifecycleMapping = getLifecycleMapping(lifecycleMappingId);</div><div class='add'>+    }</div><div class='add'>+    if(lifecycleMapping == null) {</div><div class='add'>+      result.addProblem(new MissingLifecyclePackaging(1, NLS.bind(Messages.LifecycleMissing, facade.getPackaging()),</div><div class='add'>+          facade.getPackaging()));</div><div class='add'>+      if(lifecycleMappingId != null) {</div><div class='add'>+        result.addProblem(new MissingLifecycleExtensionPoint(1, NLS.bind(Messages.LifecycleMappingNotAvailable,</div><div class='add'>+            lifecycleMappingId), lifecycleMappingId));</div><div class='ctx'>       }</div><div class='ctx'>     }</div><div class='add'>+    result.setLifecycleMapping(lifecycleMapping);</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  private static void instantiateProjectConfigurators(LifecycleMappingResult result,</div><div class='add'>+      Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; executionMapping) {</div><div class='add'>+    if(executionMapping == null) {</div><div class='add'>+      return;</div><div class='add'>+    }</div><div class='ctx'> </div><div class='del'>-    lifecycleMapping.setMavenProjectFacade(projectFacade);</div><div class='del'>-    lifecycleMapping.initializeMapping(mojoExecutions, executionMapping);</div><div class='add'>+    LinkedHashMap&lt;String, AbstractProjectConfigurator&gt; configurators = new LinkedHashMap&lt;String, AbstractProjectConfigurator&gt;();</div><div class='add'>+    for(Map.Entry&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; entry : executionMapping.entrySet()) {</div><div class='add'>+      MojoExecutionKey executionKey = entry.getKey();</div><div class='add'>+      List&lt;PluginExecutionMetadata&gt; executionMetadatas = entry.getValue();</div><div class='ctx'> </div><div class='del'>-    return lifecycleMapping;</div><div class='add'>+      if(executionMetadatas == null || executionMetadatas.isEmpty()) {</div><div class='add'>+        if(isInterestingPhase(executionKey.getLifecyclePhase())) {</div><div class='add'>+          result.addProblem(new NotCoveredMojoExecution(1, NLS.bind(</div><div class='add'>+              Messages.LifecycleConfigurationPluginExecutionNotCovered, executionKey.toString()), executionKey));</div><div class='add'>+        }</div><div class='add'>+        continue;</div><div class='add'>+      }</div><div class='add'>+</div><div class='add'>+      for(PluginExecutionMetadata metadata : executionMetadatas) {</div><div class='add'>+        String message = LifecycleMappingFactory.getActionMessage(metadata);</div><div class='add'>+        switch(metadata.getAction()) {</div><div class='add'>+          case error:</div><div class='add'>+            if(message == null) {</div><div class='add'>+              message = NLS.bind(Messages.LifecycleConfigurationPluginExecutionErrorMessage, executionKey.toString());</div><div class='add'>+            }</div><div class='add'>+            result.addProblem(new ActionMessageProblemInfo(executionKey, 0, message, IMarker.SEVERITY_ERROR));</div><div class='add'>+            break;</div><div class='add'>+          case execute:</div><div class='add'>+            if(message != null) {</div><div class='add'>+              result.addProblem(new ActionMessageProblemInfo(executionKey, 0, message, IMarker.SEVERITY_WARNING));</div><div class='add'>+            }</div><div class='add'>+            break;</div><div class='add'>+          case configurator:</div><div class='add'>+            String configuratorId = LifecycleMappingFactory.getProjectConfiguratorId(metadata);</div><div class='add'>+            try {</div><div class='add'>+              if(!configurators.containsKey(configuratorId)) {</div><div class='add'>+                configurators.put(configuratorId, LifecycleMappingFactory.createProjectConfigurator(metadata));</div><div class='add'>+              }</div><div class='add'>+            } catch(LifecycleMappingConfigurationException e) {</div><div class='add'>+              log.debug("Could not instantiate project configurator {}.", configuratorId, e);</div><div class='add'>+              result.addProblem(new MissingConfiguratorProblemInfo(1, NLS.bind(</div><div class='add'>+                  Messages.ProjectConfiguratorNotAvailable, configuratorId), configuratorId));</div><div class='add'>+              result.addProblem(new NotCoveredMojoExecution(1, NLS.bind(</div><div class='add'>+                  Messages.LifecycleConfigurationPluginExecutionNotCovered, executionKey.toString()), executionKey));</div><div class='add'>+            }</div><div class='add'>+            break;</div><div class='add'>+          case ignore:</div><div class='add'>+            if(message != null) {</div><div class='add'>+              result.addProblem(new ActionMessageProblemInfo(executionKey, 0, message, IMarker.SEVERITY_WARNING));</div><div class='add'>+            }</div><div class='add'>+            break;</div><div class='add'>+          default:</div><div class='add'>+            // TODO invalid metadata</div><div class='add'>+        }</div><div class='add'>+      }</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    result.setProjectConfigurators(configurators);</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='ctx'>   /**</div><div class='hunk'>@@ -360,7 +464,6 @@ public class LifecycleMappingFactory {</div><div class='ctx'>       String message = NLS.bind(Messages.ProjectConfiguratorNotAvailable, configuratorId);</div><div class='ctx'>       throw new LifecycleMappingConfigurationException(message);</div><div class='ctx'>     }</div><div class='del'>-    projectConfigurator.addPluginExecutionFilter(pluginExecutionMetadata.getFilter());</div><div class='ctx'>     return projectConfigurator;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='hunk'>@@ -404,8 +507,8 @@ public class LifecycleMappingFactory {</div><div class='ctx'>     return null;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public static MojoExecutionBuildParticipant createMojoExecutionBuildParicipant(MojoExecution mojoExecution,</div><div class='del'>-      PluginExecutionMetadata pluginExecutionMetadata) {</div><div class='add'>+  public static MojoExecutionBuildParticipant createMojoExecutionBuildParicipant(IMavenProjectFacade projectFacade,</div><div class='add'>+      MojoExecution mojoExecution, PluginExecutionMetadata pluginExecutionMetadata) {</div><div class='ctx'>     boolean runOnIncremental = true;</div><div class='ctx'>     Xpp3Dom child = pluginExecutionMetadata.getConfiguration().getChild(ELEMENT_RUN_ON_INCREMENTAL);</div><div class='ctx'>     if(child != null) {</div><div class='hunk'>@@ -432,7 +535,7 @@ public class LifecycleMappingFactory {</div><div class='ctx'>     return null;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  private static AbstractProjectConfigurator createProjectConfigurator(String configuratorId) {</div><div class='add'>+  public static AbstractProjectConfigurator createProjectConfigurator(String configuratorId) {</div><div class='ctx'>     IConfigurationElement element = getProjectConfiguratorExtension(configuratorId);</div><div class='ctx'>     if(element != null) {</div><div class='ctx'>       try {</div><div class='hunk'>@@ -773,4 +876,92 @@ public class LifecycleMappingFactory {</div><div class='ctx'>     }</div><div class='ctx'>     return primaryId.equals(extension.getAttribute(ATTR_SECONDARY_TO));</div><div class='ctx'>   }</div><div class='add'>+</div><div class='add'>+  public static ILifecycleMapping getLifecycleMapping(MavenProjectFacade facade) {</div><div class='add'>+    ILifecycleMapping lifecycleMapping = (ILifecycleMapping) facade</div><div class='add'>+        .getSessionProperty(MavenProjectFacade.PROP_LIFECYCLE_MAPPING);</div><div class='add'>+    if(lifecycleMapping == null) {</div><div class='add'>+      String lifecycleMappingId = facade.getLifecycleMappingId();</div><div class='add'>+      if(lifecycleMappingId != null) {</div><div class='add'>+        lifecycleMapping = getLifecycleMapping(lifecycleMappingId);</div><div class='add'>+      }</div><div class='add'>+      if(lifecycleMapping == null) {</div><div class='add'>+        lifecycleMapping = new InvalidLifecycleMapping();</div><div class='add'>+      }</div><div class='add'>+      facade.setSessionProperty(MavenProjectFacade.PROP_LIFECYCLE_MAPPING, lifecycleMapping);</div><div class='add'>+    }</div><div class='add'>+    return lifecycleMapping;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public static Map&lt;String, AbstractProjectConfigurator&gt; getProjectConfigurators(IMavenProjectFacade facade) {</div><div class='add'>+    @SuppressWarnings("unchecked")</div><div class='add'>+    Map&lt;String, AbstractProjectConfigurator&gt; configurators = (Map&lt;String, AbstractProjectConfigurator&gt;) facade</div><div class='add'>+        .getSessionProperty(MavenProjectFacade.PROP_CONFIGURATORS);</div><div class='add'>+    if(configurators == null) {</div><div class='add'>+      LifecycleMappingResult result = new LifecycleMappingResult();</div><div class='add'>+      instantiateProjectConfigurators(result, facade.getMojoExecutionMapping());</div><div class='add'>+      configurators = result.getProjectConfigurators();</div><div class='add'>+      // TODO deal with configurators that have been removed since facade was first created</div><div class='add'>+      facade.setSessionProperty(MavenProjectFacade.PROP_CONFIGURATORS, configurators);</div><div class='add'>+    }</div><div class='add'>+    return configurators;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public static boolean isLifecycleMappingChanged(IMavenProjectFacade oldFacade, IMavenProjectFacade newFacade,</div><div class='add'>+      IProgressMonitor monitor) {</div><div class='add'>+    if(oldFacade == null || newFacade == null) {</div><div class='add'>+      return false; // we have bigger problems to worry</div><div class='add'>+    }</div><div class='add'>+    String lifecycleMappingId = newFacade.getLifecycleMappingId();</div><div class='add'>+    if(lifecycleMappingId == null || newFacade.getMojoExecutionMapping() == null) {</div><div class='add'>+      return false; // we have bigger problems to worry</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    if(!eq(lifecycleMappingId, oldFacade.getLifecycleMappingId())) {</div><div class='add'>+      return true;</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    // at this point we know lifecycleMappingId is not null and has not changed</div><div class='add'>+    AbstractLifecycleMapping lifecycleMapping = getLifecycleMapping(lifecycleMappingId);</div><div class='add'>+    return lifecycleMapping.hasLifecycleMappingChanged(oldFacade, newFacade, monitor);</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  private static &lt;T&gt; boolean eq(T a, T b) {</div><div class='add'>+    return a != null ? a.equals(b) : b == null;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  private static final String[] INTERESTING_PHASES = {"validate", //</div><div class='add'>+      "initialize", //</div><div class='add'>+      "generate-sources", //</div><div class='add'>+      "process-sources", //</div><div class='add'>+      "generate-resources", //</div><div class='add'>+      "process-resources", //</div><div class='add'>+      "compile", //</div><div class='add'>+      "process-classes", //</div><div class='add'>+      "generate-test-sources", //</div><div class='add'>+      "process-test-sources", //</div><div class='add'>+      "generate-test-resources", //</div><div class='add'>+      "process-test-resources", //</div><div class='add'>+      "test-compile", //</div><div class='add'>+      "process-test-classes", //</div><div class='add'>+  // "test", //</div><div class='add'>+  // "prepare-package", //</div><div class='add'>+  // "package", //</div><div class='add'>+  //"pre-integration-test", //</div><div class='add'>+  // "integration-test", //</div><div class='add'>+  // "post-integration-test", //</div><div class='add'>+  // "verify", //</div><div class='add'>+  // "install", //</div><div class='add'>+  // "deploy", //</div><div class='add'>+  };</div><div class='add'>+</div><div class='add'>+  public static boolean isInterestingPhase(String phase) {</div><div class='add'>+    for(String interestingPhase : INTERESTING_PHASES) {</div><div class='add'>+      if(interestingPhase.equals(phase)) {</div><div class='add'>+        return true;</div><div class='add'>+      }</div><div class='add'>+    }</div><div class='add'>+    return false;</div><div class='add'>+  }</div><div class='add'>+</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingResult.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingResult.java<br/>new file mode 100644<br/>index 0000000..18d26e7<br/>--- /dev/null<br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingResult.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/LifecycleMappingResult.java</a></div><div class='hunk'>@@ -0,0 +1,80 @@</div><div class='add'>+/*******************************************************************************</div><div class='add'>+ * Copyright (c) 2010 Sonatype, Inc.</div><div class='add'>+ * All rights reserved. This program and the accompanying materials</div><div class='add'>+ * are made available under the terms of the Eclipse Public License v1.0</div><div class='add'>+ * which accompanies this distribution, and is available at</div><div class='add'>+ * http://www.eclipse.org/legal/epl-v10.html</div><div class='add'>+ *</div><div class='add'>+ * Contributors:</div><div class='add'>+ *      Sonatype, Inc. - initial API and implementation</div><div class='add'>+ *******************************************************************************/</div><div class='add'>+</div><div class='add'>+package org.eclipse.m2e.core.internal.lifecycle;</div><div class='add'>+</div><div class='add'>+import java.util.ArrayList;</div><div class='add'>+import java.util.List;</div><div class='add'>+import java.util.Map;</div><div class='add'>+</div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionMetadata;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenProblemInfo;</div><div class='add'>+import org.eclipse.m2e.core.project.configurator.AbstractLifecycleMapping;</div><div class='add'>+import org.eclipse.m2e.core.project.configurator.AbstractProjectConfigurator;</div><div class='add'>+import org.eclipse.m2e.core.project.configurator.MojoExecutionKey;</div><div class='add'>+</div><div class='add'>+</div><div class='add'>+public class LifecycleMappingResult {</div><div class='add'>+  private String lifecycleMappingId;</div><div class='add'>+</div><div class='add'>+  private Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; mojoExecutionMapping;</div><div class='add'>+</div><div class='add'>+  private List&lt;MavenProblemInfo&gt; problems = new ArrayList&lt;MavenProblemInfo&gt;();</div><div class='add'>+</div><div class='add'>+  private AbstractLifecycleMapping lifecycleMapping;</div><div class='add'>+</div><div class='add'>+  private Map&lt;String, AbstractProjectConfigurator&gt; configurators;</div><div class='add'>+</div><div class='add'>+  public String getLifecycleMappingId() {</div><div class='add'>+    return lifecycleMappingId;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; getMojoExecutionMapping() {</div><div class='add'>+    return mojoExecutionMapping;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public boolean hasProblems() {</div><div class='add'>+    return !problems.isEmpty();</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public List&lt;MavenProblemInfo&gt; getProblems() {</div><div class='add'>+    return problems;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public void setLifecycleMappingId(String lifecycleMappingId) {</div><div class='add'>+    this.lifecycleMappingId = lifecycleMappingId;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public void setMojoExecutionMapping(Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; mojoExecutionMapping) {</div><div class='add'>+    this.mojoExecutionMapping = mojoExecutionMapping;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public void addProblem(MavenProblemInfo problem) {</div><div class='add'>+    problems.add(problem);</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public void setLifecycleMapping(AbstractLifecycleMapping lifecycleMapping) {</div><div class='add'>+    this.lifecycleMapping = lifecycleMapping;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public AbstractLifecycleMapping getLifecycleMapping() {</div><div class='add'>+    return lifecycleMapping;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public Map&lt;String, AbstractProjectConfigurator&gt; getProjectConfigurators() {</div><div class='add'>+    return configurators;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public void setProjectConfigurators(Map&lt;String, AbstractProjectConfigurator&gt; configurators) {</div><div class='add'>+    this.configurators = configurators;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+}</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MissingConfiguratorProblemInfo.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingConfiguratorProblemInfo.java<br/>index ba747a4..b1ad2d0 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MissingConfiguratorProblemInfo.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MissingConfiguratorProblemInfo.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingConfiguratorProblemInfo.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingConfiguratorProblemInfo.java</a></div><div class='hunk'>@@ -8,14 +8,17 @@</div><div class='ctx'>  * Contributors:</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='del'>-package org.eclipse.m2e.core.project.configurator;</div><div class='add'>+</div><div class='add'>+package org.eclipse.m2e.core.internal.lifecycle;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.IMarker;</div><div class='ctx'> import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenProblemInfo;</div><div class='add'>+</div><div class='ctx'> </div><div class='del'>-public class MissingConfiguratorProblemInfo extends LifecycleMappingProblemInfo {</div><div class='add'>+public class MissingConfiguratorProblemInfo extends MavenProblemInfo {</div><div class='ctx'>   private final String configuratorId;</div><div class='ctx'> </div><div class='ctx'>   public MissingConfiguratorProblemInfo(int line, String message, String configuratorId) {</div><div class='hunk'>@@ -32,4 +35,4 @@ public class MissingConfiguratorProblemInfo extends LifecycleMappingProblemInfo</div><div class='ctx'>     marker.setAttribute(IMavenConstants.MARKER_ATTR_CONFIGURATOR_ID, getConfiguratorId());</div><div class='ctx'>     marker.setAttribute(IMavenConstants.MARKER_ATTR_EDITOR_HINT, IMavenConstants.EDITOR_HINT_MISSING_CONFIGURATOR);</div><div class='ctx'>   }</div><div class='del'>-}
\ No newline at end of file</div><div class='add'>+}</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecycleExtensionPoint.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecycleExtensionPoint.java<br/>index ade9204..c3f9712 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecycleExtensionPoint.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecycleExtensionPoint.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecycleExtensionPoint.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecycleExtensionPoint.java</a></div><div class='hunk'>@@ -14,10 +14,9 @@ import org.eclipse.core.resources.IMarker;</div><div class='ctx'> import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='del'>-import org.eclipse.m2e.core.internal.project.MarkerUtils;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.LifecycleMappingProblemInfo;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenProblemInfo;</div><div class='ctx'> </div><div class='del'>-public class MissingLifecycleExtensionPoint extends LifecycleMappingProblemInfo {</div><div class='add'>+public class MissingLifecycleExtensionPoint extends MavenProblemInfo {</div><div class='ctx'>   private final String lifecycleId;</div><div class='ctx'> </div><div class='ctx'>   MissingLifecycleExtensionPoint(int line, String message, String lifecycleId) {</div><div class='hunk'>@@ -31,7 +30,6 @@ public class MissingLifecycleExtensionPoint extends LifecycleMappingProblemInfo</div><div class='ctx'> </div><div class='ctx'>   @Override</div><div class='ctx'>   public void processMarker(IMarker marker) throws CoreException {</div><div class='del'>-    MarkerUtils.decorateMarker(marker);</div><div class='ctx'>     marker.setAttribute(IMavenConstants.MARKER_ATTR_LIFECYCLE_PHASE, getLifecycleId());</div><div class='ctx'>     marker.setAttribute(IMavenConstants.MARKER_ATTR_EDITOR_HINT, IMavenConstants.EDITOR_HINT_UNKNOWN_LIFECYCLE_ID);</div><div class='ctx'>   }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecyclePackaging.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecyclePackaging.java<br/>index 81e7cad..21372c3 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecyclePackaging.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecyclePackaging.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecyclePackaging.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/MissingLifecyclePackaging.java</a></div><div class='hunk'>@@ -8,15 +8,17 @@</div><div class='ctx'>  * Contributors:</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='add'>+</div><div class='ctx'> package org.eclipse.m2e.core.internal.lifecycle;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.IMarker;</div><div class='ctx'> import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.LifecycleMappingProblemInfo;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenProblemInfo;</div><div class='add'>+</div><div class='ctx'> </div><div class='del'>-public class MissingLifecyclePackaging extends LifecycleMappingProblemInfo {</div><div class='add'>+public class MissingLifecyclePackaging extends MavenProblemInfo {</div><div class='ctx'>   private final String packaging;</div><div class='ctx'> </div><div class='ctx'>   MissingLifecyclePackaging(int line, String message, String packaging) {</div><div class='hunk'>@@ -33,4 +35,4 @@ public class MissingLifecyclePackaging extends LifecycleMappingProblemInfo {</div><div class='ctx'>     marker.setAttribute(IMavenConstants.MARKER_ATTR_PACKAGING, getPackaging());</div><div class='ctx'>     marker.setAttribute(IMavenConstants.MARKER_ATTR_EDITOR_HINT, IMavenConstants.EDITOR_HINT_UNKNOWN_PACKAGING);</div><div class='ctx'>   }</div><div class='del'>-}
\ No newline at end of file</div><div class='add'>+}</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/NotCoveredMojoExecution.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/NotCoveredMojoExecution.java<br/>new file mode 100644<br/>index 0000000..fa9a499<br/>--- /dev/null<br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/NotCoveredMojoExecution.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/lifecycle/NotCoveredMojoExecution.java</a></div><div class='hunk'>@@ -0,0 +1,43 @@</div><div class='add'>+/*******************************************************************************</div><div class='add'>+ * Copyright (c) 2010 Sonatype, Inc.</div><div class='add'>+ * All rights reserved. This program and the accompanying materials</div><div class='add'>+ * are made available under the terms of the Eclipse Public License v1.0</div><div class='add'>+ * which accompanies this distribution, and is available at</div><div class='add'>+ * http://www.eclipse.org/legal/epl-v10.html</div><div class='add'>+ *</div><div class='add'>+ * Contributors:</div><div class='add'>+ *      Sonatype, Inc. - initial API and implementation</div><div class='add'>+ *******************************************************************************/</div><div class='add'>+</div><div class='add'>+package org.eclipse.m2e.core.internal.lifecycle;</div><div class='add'>+</div><div class='add'>+import org.eclipse.core.resources.IMarker;</div><div class='add'>+import org.eclipse.core.runtime.CoreException;</div><div class='add'>+</div><div class='add'>+import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenProblemInfo;</div><div class='add'>+import org.eclipse.m2e.core.project.configurator.MojoExecutionKey;</div><div class='add'>+</div><div class='add'>+</div><div class='add'>+public class NotCoveredMojoExecution extends MavenProblemInfo {</div><div class='add'>+  </div><div class='add'>+  private final MojoExecutionKey mojoExecutionKey;</div><div class='add'>+</div><div class='add'>+  public NotCoveredMojoExecution(int line, String message, MojoExecutionKey mojoExecutionKey) {</div><div class='add'>+    super(line, message);</div><div class='add'>+    this.mojoExecutionKey = mojoExecutionKey;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public void processMarker(IMarker marker) throws CoreException {</div><div class='add'>+    marker</div><div class='add'>+        .setAttribute(IMavenConstants.MARKER_ATTR_EDITOR_HINT, IMavenConstants.EDITOR_HINT_NOT_COVERED_MOJO_EXECUTION);</div><div class='add'>+    //TODO what parameters are important here for the hints?</div><div class='add'>+    marker.setAttribute(IMavenConstants.MARKER_ATTR_GROUP_ID, mojoExecutionKey.getGroupId());</div><div class='add'>+    marker.setAttribute(IMavenConstants.MARKER_ATTR_ARTIFACT_ID, mojoExecutionKey.getArtifactId());</div><div class='add'>+    marker.setAttribute(IMavenConstants.MARKER_ATTR_EXECUTION_ID, mojoExecutionKey.getExecutionId());</div><div class='add'>+    marker.setAttribute(IMavenConstants.MARKER_ATTR_GOAL, mojoExecutionKey.getGoal());</div><div class='add'>+    marker.setAttribute(IMavenConstants.MARKER_ATTR_VERSION, mojoExecutionKey.getVersion());</div><div class='add'>+    marker.setAttribute(IMavenConstants.MARKER_ATTR_LIFECYCLE_PHASE, mojoExecutionKey.getLifecyclePhase());</div><div class='add'>+  }</div><div class='add'>+}</div><div class='add'>+</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IEditorMarkerService.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IEditorMarkerService.java<br/>index ccd8db4..bbeadb0 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IEditorMarkerService.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IEditorMarkerService.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IEditorMarkerService.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IEditorMarkerService.java</a></div><div class='hunk'>@@ -8,12 +8,13 @@</div><div class='ctx'>  * Contributors:</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='del'>-package org.eclipse.m2e.core.project;</div><div class='add'>+package org.eclipse.m2e.core.internal.markers;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.IFile;</div><div class='ctx'> </div><div class='ctx'> import org.apache.maven.project.MavenProject;</div><div class='ctx'> </div><div class='add'>+</div><div class='ctx'> /**</div><div class='ctx'>  * IEditorMarkerService</div><div class='ctx'>  *</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMarkerLocationService.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMarkerLocationService.java<br/>index 301cb27..82cd590 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMarkerLocationService.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMarkerLocationService.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMarkerLocationService.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMarkerLocationService.java</a></div><div class='hunk'>@@ -8,7 +8,7 @@</div><div class='ctx'>  * Contributors:</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='del'>-package org.eclipse.m2e.core.project;</div><div class='add'>+package org.eclipse.m2e.core.internal.markers;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.IMarker;</div><div class='ctx'> </div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenMarkerManager.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMavenMarkerManager.java<br/>index 02f0d4e..36133da 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenMarkerManager.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenMarkerManager.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMavenMarkerManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/IMavenMarkerManager.java</a></div><div class='hunk'>@@ -9,7 +9,9 @@</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='ctx'> </div><div class='del'>-package org.eclipse.m2e.core.project;</div><div class='add'>+package org.eclipse.m2e.core.internal.markers;</div><div class='add'>+</div><div class='add'>+import java.util.List;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.IMarker;</div><div class='ctx'> import org.eclipse.core.resources.IResource;</div><div class='hunk'>@@ -66,4 +68,6 @@ public interface IMavenMarkerManager {</div><div class='ctx'>    */</div><div class='ctx'>   public void addErrorMarkers(IResource resource, String type, Exception ex);</div><div class='ctx'> </div><div class='add'>+  void addErrorMarkers(IResource resource, String type, List&lt;MavenProblemInfo&gt; problems) throws CoreException;</div><div class='add'>+</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MarkerUtils.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MarkerUtils.java<br/>index 937a9ce..ba80e28 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MarkerUtils.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MarkerUtils.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MarkerUtils.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MarkerUtils.java</a></div><div class='hunk'>@@ -8,7 +8,7 @@</div><div class='ctx'>  * Contributors:</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='del'>-package org.eclipse.m2e.core.internal.project;</div><div class='add'>+package org.eclipse.m2e.core.internal.markers;</div><div class='ctx'> </div><div class='ctx'> import org.osgi.framework.BundleContext;</div><div class='ctx'> import org.osgi.framework.ServiceReference;</div><div class='hunk'>@@ -21,9 +21,6 @@ import org.eclipse.core.resources.IMarker;</div><div class='ctx'> import org.apache.maven.project.MavenProject;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.m2e.core.MavenPlugin;</div><div class='del'>-import org.eclipse.m2e.core.project.IEditorMarkerService;</div><div class='del'>-import org.eclipse.m2e.core.project.IMarkerLocationService;</div><div class='del'>-import org.eclipse.m2e.core.project.IMavenMarkerManager;</div><div class='ctx'> </div><div class='ctx'> /**</div><div class='ctx'>  * MarkerUtils</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MavenMarkerManager.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenMarkerManager.java<br/>index feab842..8834b71 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MavenMarkerManager.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MavenMarkerManager.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenMarkerManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenMarkerManager.java</a></div><div class='hunk'>@@ -9,7 +9,7 @@</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='ctx'> </div><div class='del'>-package org.eclipse.m2e.core.internal.project;</div><div class='add'>+package org.eclipse.m2e.core.internal.markers;</div><div class='ctx'> </div><div class='ctx'> import java.util.List;</div><div class='ctx'> import java.util.Set;</div><div class='hunk'>@@ -35,7 +35,6 @@ import org.apache.maven.project.ProjectBuildingException;</div><div class='ctx'> import org.eclipse.m2e.core.core.MavenConsole;</div><div class='ctx'> import org.eclipse.m2e.core.core.Messages;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.IMavenConfiguration;</div><div class='del'>-import org.eclipse.m2e.core.project.IMavenMarkerManager;</div><div class='ctx'> </div><div class='ctx'> </div><div class='ctx'> public class MavenMarkerManager implements IMavenMarkerManager {</div><div class='hunk'>@@ -287,4 +286,12 @@ public class MavenMarkerManager implements IMavenMarkerManager {</div><div class='ctx'>       addMarker(resource, type, cause.getMessage(), 1, IMarker.SEVERITY_ERROR, false /*isTransient*/); //$NON-NLS-1$</div><div class='ctx'>     }</div><div class='ctx'>   }</div><div class='add'>+</div><div class='add'>+  public void addErrorMarkers(IResource resource, String type, List&lt;MavenProblemInfo&gt; problems) throws CoreException {</div><div class='add'>+    for(MavenProblemInfo problem : problems) {</div><div class='add'>+      IMarker marker = addMarker(resource, type, problem.getMessage(), problem.getLine(), problem.getSeverity());</div><div class='add'>+      problem.processMarker(marker);</div><div class='add'>+      MarkerUtils.decorateMarker(marker);</div><div class='add'>+    }</div><div class='add'>+  }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/LifecycleMappingProblemInfo.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenProblemInfo.java<br/>index 10dd988..3322e7a 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/LifecycleMappingProblemInfo.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/LifecycleMappingProblemInfo.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenProblemInfo.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/markers/MavenProblemInfo.java</a></div><div class='hunk'>@@ -8,25 +8,27 @@</div><div class='ctx'>  * Contributors:</div><div class='ctx'>  *      Sonatype, Inc. - initial API and implementation</div><div class='ctx'>  *******************************************************************************/</div><div class='del'>-package org.eclipse.m2e.core.project.configurator;</div><div class='add'>+</div><div class='add'>+package org.eclipse.m2e.core.internal.markers;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.IMarker;</div><div class='ctx'> import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> </div><div class='del'>-public class LifecycleMappingProblemInfo {</div><div class='add'>+</div><div class='add'>+public class MavenProblemInfo {</div><div class='ctx'>   private final int line;</div><div class='ctx'> </div><div class='ctx'>   private final String message;</div><div class='ctx'> </div><div class='ctx'>   private final int severity;</div><div class='ctx'> </div><div class='del'>-  protected LifecycleMappingProblemInfo(int line, String message) {</div><div class='add'>+  public MavenProblemInfo(int line, String message) {</div><div class='ctx'>     this.line = line;</div><div class='ctx'>     this.message = message;</div><div class='ctx'>     this.severity = IMarker.SEVERITY_ERROR;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  protected LifecycleMappingProblemInfo(int line, String message, int severity) {</div><div class='add'>+  public MavenProblemInfo(int line, String message, int severity) {</div><div class='ctx'>     this.line = line;</div><div class='ctx'>     this.message = message;</div><div class='ctx'>     this.severity = severity;</div><div class='hunk'>@@ -44,6 +46,11 @@ public class LifecycleMappingProblemInfo {</div><div class='ctx'>     return this.severity;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='add'>+  @SuppressWarnings("unused")</div><div class='ctx'>   public void processMarker(IMarker marker) throws CoreException {</div><div class='ctx'>   }</div><div class='del'>-}
\ No newline at end of file</div><div class='add'>+</div><div class='add'>+  public String toString() {</div><div class='add'>+    return message;</div><div class='add'>+  }</div><div class='add'>+}</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/messages.properties b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/messages.properties<br/>index afd45e1..4d61b83 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/messages.properties?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/messages.properties</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/messages.properties?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/messages.properties</a></div><div class='hunk'>@@ -103,7 +103,9 @@ LifecycleMappingNotAvailable=Lifecycle mapping "{0}" is not available. To enable</div><div class='ctx'> LifecycleMappingPackagingMismatch=Packaging type {0} configured in embedded lifecycle mapping configuration does not match the packaging type {1} of the current project.</div><div class='ctx'> LifecycleMappingPluginVersionIncompatible=Incompatible lifecycle mapping plugin version {0}</div><div class='ctx'> PluginExecutionMappingDuplicate=Conflicting lifecycle mapping (plugin execution "{0}"). To enable full functionality, remove the conflicting mapping and run Maven-&gt;Update Project Configuration.</div><div class='add'>+PluginExecutionMappingInvalid=Invalid plugin execution mapping (plugin execution "{0}"). To enable full functionality, correct the invalid mapping and run Maven-&gt;Update Project Configuration.</div><div class='ctx'> ProjectConfiguratorNotAvailable=Project configurator "{0}" is not available. To enable full functionality, install the project configurator and run Maven-&gt;Update Project Configuration.</div><div class='add'>+ProjectConfigurationUpdateRequired=Project configuration is not up-to-date with pom.xml. Run project configuration update</div><div class='ctx'> LocalArchetypeCatalogDialog_btnBrowse=&amp;Browse...</div><div class='ctx'> LocalArchetypeCatalogDialog_dialog_title=Select Archetype catalog</div><div class='ctx'> LocalArchetypeCatalogDialog_error_empty=Archetype catalog is empty</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/IgnoreMojoProjectConfigurator.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/IgnoreMojoProjectConfigurator.java<br/>deleted file mode 100644<br/>index beb7d0f..0000000<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/IgnoreMojoProjectConfigurator.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/IgnoreMojoProjectConfigurator.java</a><br/>+++ /dev/null</div><div class='hunk'>@@ -1,32 +0,0 @@</div><div class='del'>-/*******************************************************************************</div><div class='del'>- * Copyright (c) 2008 Sonatype, Inc.</div><div class='del'>- * All rights reserved. This program and the accompanying materials</div><div class='del'>- * are made available under the terms of the Eclipse Public License v1.0</div><div class='del'>- * which accompanies this distribution, and is available at</div><div class='del'>- * http://www.eclipse.org/legal/epl-v10.html</div><div class='del'>- *</div><div class='del'>- * Contributors:</div><div class='del'>- *      Sonatype, Inc. - initial API and implementation</div><div class='del'>- *******************************************************************************/</div><div class='del'>-</div><div class='del'>-package org.eclipse.m2e.core.internal.project;</div><div class='del'>-</div><div class='del'>-import org.eclipse.core.runtime.IProgressMonitor;</div><div class='del'>-</div><div class='del'>-import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionFilter;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.AbstractProjectConfigurator;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.ProjectConfigurationRequest;</div><div class='del'>-</div><div class='del'>-</div><div class='del'>-/**</div><div class='del'>- * @author igor</div><div class='del'>- */</div><div class='del'>-public class IgnoreMojoProjectConfigurator extends AbstractProjectConfigurator {</div><div class='del'>-</div><div class='del'>-  public IgnoreMojoProjectConfigurator(PluginExecutionFilter pluginExecutionFilter) {</div><div class='del'>-    addPluginExecutionFilter(pluginExecutionFilter);</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public void configure(ProjectConfigurationRequest request, IProgressMonitor monitor) {</div><div class='del'>-  }</div><div class='del'>-}</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionProjectConfigurator.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionProjectConfigurator.java<br/>deleted file mode 100644<br/>index 4c406ce..0000000<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionProjectConfigurator.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionProjectConfigurator.java</a><br/>+++ /dev/null</div><div class='hunk'>@@ -1,130 +0,0 @@</div><div class='del'>-/*******************************************************************************</div><div class='del'>- * Copyright (c) 2008-2010 Sonatype, Inc.</div><div class='del'>- * All rights reserved. This program and the accompanying materials</div><div class='del'>- * are made available under the terms of the Eclipse Public License v1.0</div><div class='del'>- * which accompanies this distribution, and is available at</div><div class='del'>- * http://www.eclipse.org/legal/epl-v10.html</div><div class='del'>- *</div><div class='del'>- * Contributors:</div><div class='del'>- *      Sonatype, Inc. - initial API and implementation</div><div class='del'>- *******************************************************************************/</div><div class='del'>-</div><div class='del'>-package org.eclipse.m2e.core.internal.project;</div><div class='del'>-</div><div class='del'>-import org.eclipse.core.runtime.IProgressMonitor;</div><div class='del'>-</div><div class='del'>-import org.apache.maven.plugin.MojoExecution;</div><div class='del'>-</div><div class='del'>-import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionFilter;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.AbstractBuildParticipant;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.AbstractProjectConfigurator;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.MojoExecutionBuildParticipant;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.ProjectConfigurationRequest;</div><div class='del'>-</div><div class='del'>-</div><div class='del'>-/**</div><div class='del'>- * MojoExecutionProjectConfigurator</div><div class='del'>- * </div><div class='del'>- * @author igor</div><div class='del'>- */</div><div class='del'>-public class MojoExecutionProjectConfigurator extends AbstractProjectConfigurator {</div><div class='del'>-  private String groupId;</div><div class='del'>-</div><div class='del'>-  private String artifactId;</div><div class='del'>-</div><div class='del'>-  private final boolean runOnIncremental;</div><div class='del'>-</div><div class='del'>-  public MojoExecutionProjectConfigurator(PluginExecutionFilter pluginExecutionFilter, boolean runOnIncremental) {</div><div class='del'>-    this.runOnIncremental = runOnIncremental;</div><div class='del'>-    this.groupId = pluginExecutionFilter.getGroupId();</div><div class='del'>-    this.artifactId = pluginExecutionFilter.getArtifactId();</div><div class='del'>-</div><div class='del'>-    addPluginExecutionFilter(pluginExecutionFilter);</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  protected MojoExecutionProjectConfigurator(String groupId, String artifactId, String versionRange, String goals,</div><div class='del'>-      boolean runOnIncremental) {</div><div class='del'>-    this.runOnIncremental = runOnIncremental;</div><div class='del'>-    this.groupId = groupId;</div><div class='del'>-    this.artifactId = artifactId;</div><div class='del'>-</div><div class='del'>-    addPluginExecutionFilter(groupId, artifactId, versionRange, goals);</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  @Override</div><div class='del'>-  public void configure(ProjectConfigurationRequest request, IProgressMonitor monitor) {</div><div class='del'>-    // do nothing</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  @Override</div><div class='del'>-  public AbstractBuildParticipant getBuildParticipant(MojoExecution execution) {</div><div class='del'>-    return new MojoExecutionBuildParticipant(execution, runOnIncremental);</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public static MojoExecutionProjectConfigurator fromString(String str, boolean runOnIncremental) {</div><div class='del'>-    if(str == null || str.trim().length() &lt;= 0) {</div><div class='del'>-      return null;</div><div class='del'>-    }</div><div class='del'>-</div><div class='del'>-    int p, c;</div><div class='del'>-</div><div class='del'>-    p = 0;</div><div class='del'>-    c = nextColonIndex(str, p);</div><div class='del'>-    String groupId = substring(str, p, c);</div><div class='del'>-</div><div class='del'>-    p = c + 1;</div><div class='del'>-    c = nextColonIndex(str, p);</div><div class='del'>-    String artifactId = substring(str, p, c);</div><div class='del'>-</div><div class='del'>-    p = c + 1;</div><div class='del'>-    c = nextColonIndex(str, p);</div><div class='del'>-    String versionRange = substring(str, p, c);</div><div class='del'>-</div><div class='del'>-    p = c + 1;</div><div class='del'>-    String goals = substring(str, p, str.length());</div><div class='del'>-</div><div class='del'>-    return new MojoExecutionProjectConfigurator(groupId, artifactId, versionRange, goals, runOnIncremental);</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  private static String substring(String str, int start, int end) {</div><div class='del'>-    String substring = str.substring(start, end);</div><div class='del'>-    return "".equals(substring) ? null : substring; //$NON-NLS-1$</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  private static int nextColonIndex(String str, int pos) {</div><div class='del'>-    int idx = str.indexOf(':', pos);</div><div class='del'>-    if(idx &lt; 0) {</div><div class='del'>-      throw new IllegalArgumentException("Invalid mojo execution template: " + str);</div><div class='del'>-    }</div><div class='del'>-    return idx;</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  @Override</div><div class='del'>-  public String getName() {</div><div class='del'>-    return "execute";</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  @Override</div><div class='del'>-  public boolean equals(Object obj) {</div><div class='del'>-    if(!super.equals(obj)) {</div><div class='del'>-      return false;</div><div class='del'>-    }</div><div class='del'>-</div><div class='del'>-    MojoExecutionProjectConfigurator otherConfigurator = (MojoExecutionProjectConfigurator) obj;</div><div class='del'>-    return (groupId.equals(otherConfigurator.groupId) &amp;&amp; artifactId.equals(otherConfigurator.artifactId) &amp;&amp; runOnIncremental == otherConfigurator.runOnIncremental);</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  @Override</div><div class='del'>-  public void addPluginExecutionFilter(PluginExecutionFilter filter) {</div><div class='del'>-    if(!groupId.equals(filter.getGroupId()) || !artifactId.equals(filter.getArtifactId())) {</div><div class='del'>-      throw new RuntimeException("Invalid filter for " + toString() + ": " + filter.toString());</div><div class='del'>-    }</div><div class='del'>-    super.addPluginExecutionFilter(filter);</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  @Override</div><div class='del'>-  public String toString() {</div><div class='del'>-    return "MojoExecutionProjectConfigurator(GroupId=" + groupId + ",ArtifactId=" + artifactId + ",runOnIncremental="</div><div class='del'>-        + runOnIncremental + ")";</div><div class='del'>-  }</div><div class='del'>-}</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionUtils.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionUtils.java<br/>deleted file mode 100644<br/>index d6a5bda..0000000<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionUtils.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/MojoExecutionUtils.java</a><br/>+++ /dev/null</div><div class='hunk'>@@ -1,29 +0,0 @@</div><div class='del'>-/*******************************************************************************</div><div class='del'>- * Copyright (c) 2008-2010 Sonatype, Inc.</div><div class='del'>- * All rights reserved. This program and the accompanying materials</div><div class='del'>- * are made available under the terms of the Eclipse Public License v1.0</div><div class='del'>- * which accompanies this distribution, and is available at</div><div class='del'>- * http://www.eclipse.org/legal/epl-v10.html</div><div class='del'>- *</div><div class='del'>- * Contributors:</div><div class='del'>- *      Sonatype, Inc. - initial API and implementation</div><div class='del'>- *******************************************************************************/</div><div class='del'>-</div><div class='del'>-package org.eclipse.m2e.core.internal.project;</div><div class='del'>-</div><div class='del'>-import org.apache.maven.plugin.MojoExecution;</div><div class='del'>-</div><div class='del'>-/**</div><div class='del'>- * MavenExecutionUtils</div><div class='del'>- *</div><div class='del'>- * @author mpoindexter</div><div class='del'>- */</div><div class='del'>-public class MojoExecutionUtils {</div><div class='del'>-  public static String getExecutionKey(MojoExecution execution) {</div><div class='del'>-    return nvl(execution.getGroupId()) + ":" + nvl(execution.getArtifactId()) + ":" + nvl(execution.getVersion()) + ":" + nvl(execution.getGoal()); //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$</div><div class='del'>-  }</div><div class='del'>-  </div><div class='del'>-  private static String nvl(String s) {</div><div class='del'>-    return s == null ? "" : s; //$NON-NLS-1$</div><div class='del'>-  }</div><div class='del'>-}</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/ProjectConfigurationManager.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/ProjectConfigurationManager.java<br/>index 8b279eb..3cc3035 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/ProjectConfigurationManager.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/ProjectConfigurationManager.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/ProjectConfigurationManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/ProjectConfigurationManager.java</a></div><div class='hunk'>@@ -72,9 +72,8 @@ import org.eclipse.m2e.core.embedder.IMaven;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.IMavenConfiguration;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.MavenModelManager;</div><div class='ctx'> import org.eclipse.m2e.core.internal.Messages;</div><div class='del'>-import org.eclipse.m2e.core.internal.lifecycle.InvalidLifecycleMapping;</div><div class='del'>-import org.eclipse.m2e.core.internal.project.registry.MavenProjectFacade;</div><div class='del'>-import org.eclipse.m2e.core.project.IMavenMarkerManager;</div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.LifecycleMappingFactory;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.IMavenMarkerManager;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectChangedListener;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectImportResult;</div><div class='hunk'>@@ -86,11 +85,8 @@ import org.eclipse.m2e.core.project.MavenProjectManager;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenUpdateRequest;</div><div class='ctx'> import org.eclipse.m2e.core.project.ProjectImportConfiguration;</div><div class='ctx'> import org.eclipse.m2e.core.project.ResolverConfiguration;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.AbstractLifecycleMapping;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.AbstractProjectConfigurator;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.ILifecycleMapping;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.LifecycleMappingProblemInfo;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.MojoExecutionKey;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.ProjectConfigurationRequest;</div><div class='ctx'> import org.eclipse.m2e.core.util.Util;</div><div class='ctx'> </div><div class='hunk'>@@ -295,13 +291,14 @@ public class ProjectConfigurationManager implements IProjectConfigurationManager</div><div class='ctx'>     public IAdaptable[] adaptElements(IAdaptable[] objects);</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public void updateProjectConfiguration(IProject project, ResolverConfiguration configuration, IProgressMonitor monitor) throws CoreException {</div><div class='add'>+  public void updateProjectConfiguration(IProject project, IProgressMonitor monitor) throws CoreException {</div><div class='ctx'>     IFile pom = project.getFile(IMavenConstants.POM_FILE_NAME);</div><div class='ctx'>     if (pom.isAccessible()) {</div><div class='ctx'>       projectManager.refresh(new MavenUpdateRequest(project, mavenConfiguration.isOffline(), false), monitor); </div><div class='ctx'>       IMavenProjectFacade facade = projectManager.create(pom, false, monitor);</div><div class='ctx'>       if (facade != null) { // facade is null if pom.xml cannot be read</div><div class='del'>-        ProjectConfigurationRequest request = new ProjectConfigurationRequest(facade, facade.getMavenProject(monitor), createMavenSession(facade, monitor), true /*updateSources*/);</div><div class='add'>+        ProjectConfigurationRequest request = new ProjectConfigurationRequest(facade, facade.getMavenProject(monitor),</div><div class='add'>+            createMavenSession(facade, monitor), true /*updateSources*/);</div><div class='ctx'>         updateProjectConfiguration(request, monitor);</div><div class='ctx'>       }</div><div class='ctx'>     }</div><div class='hunk'>@@ -316,80 +313,20 @@ public class ProjectConfigurationManager implements IProjectConfigurationManager</div><div class='ctx'> </div><div class='ctx'>     addMavenNature(project, monitor);</div><div class='ctx'> </div><div class='del'>-    validateProjectConfiguration(mavenProjectFacade, monitor);</div><div class='del'>-    </div><div class='del'>-    // TODO Does it make sense to configure the project if the configuration is not valid?</div><div class='del'>-    ILifecycleMapping lifecycleMapping = getLifecycleMapping(mavenProjectFacade, monitor);</div><div class='del'>-    if (lifecycleMapping != null) {</div><div class='add'>+    ILifecycleMapping lifecycleMapping = getLifecycleMapping(mavenProjectFacade);</div><div class='add'>+</div><div class='add'>+    if(lifecycleMapping != null) {</div><div class='add'>+      mavenMarkerManager.deleteMarkers(mavenProjectFacade.getProject(), IMavenConstants.MARKER_CONFIGURATION_ID);</div><div class='add'>+</div><div class='ctx'>       lifecycleMapping.configure(request, monitor);</div><div class='add'>+    } else {</div><div class='add'>+      log.debug("LifecycleMapping is null for project {}", mavenProjectFacade.toString()); //$NON-NLS-1$</div><div class='ctx'>     }</div><div class='ctx'> </div><div class='ctx'>     log.debug(</div><div class='ctx'>         "Updated project configuration in {} ms for {}.", System.currentTimeMillis() - start, mavenProjectFacade.toString()); //$NON-NLS-1$</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public boolean validateProjectConfiguration(IMavenProjectFacade mavenProjectFacade, IProgressMonitor monitor) {</div><div class='del'>-    boolean isValid = true;</div><div class='del'>-    try {</div><div class='del'>-      mavenMarkerManager.deleteMarkers(mavenProjectFacade.getPom(), IMavenConstants.MARKER_CONFIGURATION_ID);</div><div class='del'>-</div><div class='del'>-      ILifecycleMapping lifecycleMapping = getLifecycleMapping(mavenProjectFacade, monitor);</div><div class='del'>-</div><div class='del'>-      if(lifecycleMapping instanceof AbstractLifecycleMapping) {</div><div class='del'>-        for(LifecycleMappingProblemInfo problem : ((AbstractLifecycleMapping) lifecycleMapping).getProblems()) {</div><div class='del'>-          if(problem.getSeverity() == IMarker.SEVERITY_ERROR) {</div><div class='del'>-            isValid = false;</div><div class='del'>-          }</div><div class='del'>-          IMarker marker = mavenMarkerManager.addMarker(mavenProjectFacade.getPom(),</div><div class='del'>-              IMavenConstants.MARKER_CONFIGURATION_ID, problem.getMessage(), problem.getLine(), problem.getSeverity());</div><div class='del'>-          problem.processMarker(marker);</div><div class='del'>-        }</div><div class='del'>-      }</div><div class='del'>-      </div><div class='del'>-      if(lifecycleMapping instanceof InvalidLifecycleMapping) {</div><div class='del'>-        // TODO decide if we want this marker in addition to more specific markers created above</div><div class='del'>-        IMarker marker = mavenMarkerManager.addMarker(mavenProjectFacade.getPom(),</div><div class='del'>-            IMavenConstants.MARKER_CONFIGURATION_ID,</div><div class='del'>-            NLS.bind(Messages.LifecycleMissing, mavenProjectFacade.getPackaging()), 1 /*lineNumber*/,</div><div class='del'>-            IMarker.SEVERITY_ERROR);</div><div class='del'>-        marker.setAttribute(IMavenConstants.MARKER_ATTR_PACKAGING, mavenProjectFacade.getPackaging());</div><div class='del'>-        marker.setAttribute(IMavenConstants.MARKER_ATTR_EDITOR_HINT, IMavenConstants.EDITOR_HINT_UNKNOWN_PACKAGING);</div><div class='del'>-        MarkerUtils.decorateMarker(marker);</div><div class='del'>-</div><div class='del'>-        isValid = false;</div><div class='del'>-        return false;</div><div class='del'>-      }</div><div class='del'>-</div><div class='del'>-      List&lt;MojoExecutionKey&gt; notCoveredMojoExecutions = lifecycleMapping.getNotCoveredMojoExecutions(monitor);</div><div class='del'>-      if(notCoveredMojoExecutions != null &amp;&amp; notCoveredMojoExecutions.size() != 0) {</div><div class='del'>-        for(MojoExecutionKey mojoExecutionKey : notCoveredMojoExecutions) {</div><div class='del'>-          IMarker marker = mavenMarkerManager.addMarker(mavenProjectFacade.getPom(),</div><div class='del'>-              IMavenConstants.MARKER_CONFIGURATION_ID,</div><div class='del'>-              NLS.bind(Messages.LifecycleConfigurationPluginExecutionNotCovered, mojoExecutionKey.toString()),</div><div class='del'>-              1 /*lineNumber*/, IMarker.SEVERITY_ERROR);</div><div class='del'>-</div><div class='del'>-          marker.setAttribute(IMavenConstants.MARKER_ATTR_EDITOR_HINT,</div><div class='del'>-              IMavenConstants.EDITOR_HINT_NOT_COVERED_MOJO_EXECUTION);</div><div class='del'>-          //TODO what parameters are important here for the hints?</div><div class='del'>-          marker.setAttribute(IMavenConstants.MARKER_ATTR_GROUP_ID, mojoExecutionKey.getGroupId());</div><div class='del'>-          marker.setAttribute(IMavenConstants.MARKER_ATTR_ARTIFACT_ID, mojoExecutionKey.getArtifactId());</div><div class='del'>-          marker.setAttribute(IMavenConstants.MARKER_ATTR_EXECUTION_ID, mojoExecutionKey.getExecutionId());</div><div class='del'>-          marker.setAttribute(IMavenConstants.MARKER_ATTR_GOAL, mojoExecutionKey.getGoal());</div><div class='del'>-          marker.setAttribute(IMavenConstants.MARKER_ATTR_VERSION, mojoExecutionKey.getVersion());</div><div class='del'>-          marker.setAttribute(IMavenConstants.MARKER_ATTR_LIFECYCLE_PHASE, mojoExecutionKey.getLifecyclePhase());</div><div class='del'>-          MarkerUtils.decorateMarker(marker);</div><div class='del'>-        }</div><div class='del'>-        isValid = false;</div><div class='del'>-      }</div><div class='del'>-    } catch(CoreException e) {</div><div class='del'>-      mavenMarkerManager.addErrorMarkers(mavenProjectFacade.getPom(), IMavenConstants.MARKER_CONFIGURATION_ID, e);</div><div class='del'>-      isValid = false;</div><div class='del'>-    } finally {</div><div class='del'>-      ((MavenProjectFacade) mavenProjectFacade).setHasValidConfiguration(isValid);</div><div class='del'>-    }</div><div class='del'>-    return isValid;</div><div class='del'>-  }</div><div class='del'>-</div><div class='ctx'>   public void enableMavenNature(IProject project, ResolverConfiguration configuration, IProgressMonitor monitor)</div><div class='ctx'>       throws CoreException {</div><div class='ctx'>     monitor.subTask(Messages.ProjectConfigurationManager_task_enable_nature);</div><div class='hunk'>@@ -425,7 +362,7 @@ public class ProjectConfigurationManager implements IProjectConfigurationManager</div><div class='ctx'> </div><div class='ctx'>     IMavenProjectFacade facade = projectManager.create(project, monitor);</div><div class='ctx'>     if(facade!=null) {</div><div class='del'>-      ILifecycleMapping lifecycleMapping = getLifecycleMapping(facade, monitor);</div><div class='add'>+      ILifecycleMapping lifecycleMapping = getLifecycleMapping(facade);</div><div class='ctx'>       if(lifecycleMapping != null) {</div><div class='ctx'>         ProjectConfigurationRequest request = new ProjectConfigurationRequest(facade, facade.getMavenProject(monitor),</div><div class='ctx'>             createMavenSession(facade, monitor), false /*updateSources*/);</div><div class='hunk'>@@ -725,24 +662,33 @@ public class ProjectConfigurationManager implements IProjectConfigurationManager</div><div class='ctx'>   public void mavenProjectChanged(MavenProjectChangedEvent[] events, IProgressMonitor monitor) {</div><div class='ctx'>     for(MavenProjectChangedEvent event : events) {</div><div class='ctx'>       try {</div><div class='del'>-        ILifecycleMapping lifecycleMapping = getLifecycleMapping(event.getMavenProject(), monitor);</div><div class='add'>+        IMavenProjectFacade facade = event.getMavenProject();</div><div class='add'>+        ILifecycleMapping lifecycleMapping = getLifecycleMapping(facade);</div><div class='ctx'>         if(lifecycleMapping != null) {</div><div class='del'>-          for(AbstractProjectConfigurator configurator : lifecycleMapping.getProjectConfigurators(monitor)) {</div><div class='add'>+          for(AbstractProjectConfigurator configurator : lifecycleMapping.getProjectConfigurators(facade, monitor)) {</div><div class='ctx'>             //MNGECLIPSE-2004 : only send the relevant event to the configurator</div><div class='ctx'>             configurator.mavenProjectChanged(event, monitor);</div><div class='ctx'>           }</div><div class='ctx'>         }</div><div class='add'>+</div><div class='add'>+        IMavenProjectFacade oldFacade = event.getOldMavenProject();</div><div class='add'>+        if(oldFacade != null) {</div><div class='add'>+          if (LifecycleMappingFactory.isLifecycleMappingChanged(oldFacade, facade, monitor)) {</div><div class='add'>+            mavenMarkerManager.addMarker(facade.getProject(), IMavenConstants.MARKER_CONFIGURATION_ID, </div><div class='add'>+                Messages.ProjectConfigurationUpdateRequired, -1, IMarker.SEVERITY_ERROR);</div><div class='add'>+          }</div><div class='add'>+        }</div><div class='ctx'>       } catch (CoreException e) {</div><div class='ctx'>         MavenLogger.log(e);</div><div class='ctx'>       }</div><div class='ctx'>     }</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public ILifecycleMapping getLifecycleMapping(IMavenProjectFacade projectFacade, IProgressMonitor monitor) throws CoreException {</div><div class='add'>+  public ILifecycleMapping getLifecycleMapping(IMavenProjectFacade projectFacade) throws CoreException {</div><div class='ctx'>     if (projectFacade==null) {</div><div class='ctx'>       return null;</div><div class='ctx'>     }</div><div class='ctx'> </div><div class='del'>-    return projectFacade.getLifecycleMapping(monitor);</div><div class='add'>+    return projectManager.getLifecycleMapping(projectFacade);</div><div class='ctx'>   }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/DefaultMavenDependencyResolver.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/DefaultMavenDependencyResolver.java<br/>index c27b325..5f9e50c 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/DefaultMavenDependencyResolver.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/DefaultMavenDependencyResolver.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/DefaultMavenDependencyResolver.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/DefaultMavenDependencyResolver.java</a></div><div class='hunk'>@@ -27,7 +27,7 @@ import org.sonatype.aether.graph.Dependency;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.ArtifactKey;</div><div class='del'>-import org.eclipse.m2e.core.project.IMavenMarkerManager;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.IMavenMarkerManager;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> </div><div class='ctx'> </div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/MavenProjectFacade.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/MavenProjectFacade.java<br/>index 69f1ac3..1db9b7e 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/MavenProjectFacade.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/MavenProjectFacade.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/MavenProjectFacade.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/MavenProjectFacade.java</a></div><div class='hunk'>@@ -31,6 +31,8 @@ import org.eclipse.core.runtime.Status;</div><div class='ctx'> import org.apache.maven.artifact.Artifact;</div><div class='ctx'> import org.apache.maven.artifact.repository.ArtifactRepository;</div><div class='ctx'> import org.apache.maven.execution.MavenExecutionResult;</div><div class='add'>+import org.apache.maven.execution.MavenSession;</div><div class='add'>+import org.apache.maven.plugin.MojoExecution;</div><div class='ctx'> import org.apache.maven.project.MavenProject;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.m2e.core.MavenPlugin;</div><div class='hunk'>@@ -38,18 +40,27 @@ import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.ArtifactKey;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.ArtifactRef;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.ArtifactRepositoryRef;</div><div class='add'>+import org.eclipse.m2e.core.embedder.IMaven;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.IMavenConfiguration;</div><div class='ctx'> import org.eclipse.m2e.core.internal.Messages;</div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionMetadata;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectVisitor;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectVisitor2;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenProjectUtils;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenUpdateRequest;</div><div class='ctx'> import org.eclipse.m2e.core.project.ResolverConfiguration;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.ILifecycleMapping;</div><div class='add'>+import org.eclipse.m2e.core.project.configurator.MojoExecutionKey;</div><div class='ctx'> </div><div class='ctx'> public class MavenProjectFacade implements IMavenProjectFacade, Serializable {</div><div class='del'>-  private static final long serialVersionUID = 707484407691175077L;</div><div class='add'>+</div><div class='add'>+  private static final long serialVersionUID = -3648172776786224087L;</div><div class='add'>+</div><div class='add'>+  public static final String PROP_MOJO_EXECUTIONS = MavenProjectFacade.class.getName() + "/mojoExecutions";</div><div class='add'>+</div><div class='add'>+  public static final String PROP_LIFECYCLE_MAPPING = MavenProjectFacade.class.getName() + "/lifecycleMapping";</div><div class='add'>+</div><div class='add'>+  public static final String PROP_CONFIGURATORS = MavenProjectFacade.class.getName() + "/configurators";</div><div class='ctx'> </div><div class='ctx'>   private final ProjectRegistryManager manager;</div><div class='ctx'> </div><div class='hunk'>@@ -59,9 +70,9 @@ public class MavenProjectFacade implements IMavenProjectFacade, Serializable {</div><div class='ctx'> </div><div class='ctx'>   private transient MavenProject mavenProject;</div><div class='ctx'> </div><div class='del'>-  private transient Map&lt;String, Object&gt; sessionProperties;</div><div class='add'>+  private transient List&lt;MojoExecution&gt; executionPlan;</div><div class='ctx'> </div><div class='del'>-  private boolean hasValidConfiguration = false;</div><div class='add'>+  private transient Map&lt;String, Object&gt; sessionProperties;</div><div class='ctx'> </div><div class='ctx'>   // XXX make final, there should be no need to change it</div><div class='ctx'>   private ResolverConfiguration resolverConfiguration;</div><div class='hunk'>@@ -69,35 +80,34 @@ public class MavenProjectFacade implements IMavenProjectFacade, Serializable {</div><div class='ctx'>   private final long[] timestamp = new long[ProjectRegistryManager.METADATA_PATH.size() + 1];</div><div class='ctx'> </div><div class='ctx'>   // cached values from mavenProject</div><div class='del'>-  private ArtifactKey artifactKey;</div><div class='del'>-  private List&lt;String&gt; modules;</div><div class='del'>-  private String packaging;</div><div class='del'>-  private IPath[] resourceLocations;</div><div class='del'>-  private IPath[] testResourceLocations;</div><div class='del'>-  private IPath[] compileSourceLocations;</div><div class='del'>-  private IPath[] testCompileSourceLocations;</div><div class='del'>-  private IPath outputLocation;</div><div class='del'>-  private IPath testOutputLocation;</div><div class='del'>-  private Set&lt;ArtifactRef&gt; artifacts;</div><div class='del'>-  private Set&lt;ArtifactRepositoryRef&gt; artifactRepositories;</div><div class='del'>-  private Set&lt;ArtifactRepositoryRef&gt; pluginArtifactRepositories;</div><div class='del'>-</div><div class='del'>-  private transient ILifecycleMapping lifecycleMapping;</div><div class='add'>+  private final ArtifactKey artifactKey;</div><div class='add'>+  private final List&lt;String&gt; modules;</div><div class='add'>+  private final String packaging;</div><div class='add'>+  private final IPath[] resourceLocations;</div><div class='add'>+  private final IPath[] testResourceLocations;</div><div class='add'>+  private final IPath[] compileSourceLocations;</div><div class='add'>+  private final IPath[] testCompileSourceLocations;</div><div class='add'>+  private final IPath outputLocation;</div><div class='add'>+  private final IPath testOutputLocation;</div><div class='add'>+  private final Set&lt;ArtifactRepositoryRef&gt; artifactRepositories;</div><div class='add'>+  private final Set&lt;ArtifactRepositoryRef&gt; pluginArtifactRepositories;</div><div class='add'>+  private Set&lt;ArtifactRef&gt; artifacts; // dependencies are resolved after facade instance is created </div><div class='add'>+  </div><div class='add'>+  // lifecycle mapping</div><div class='add'>+  private String lifecycleMappingId;</div><div class='add'>+  private Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; mojoExecutionMapping;</div><div class='ctx'> </div><div class='ctx'>   public MavenProjectFacade(ProjectRegistryManager manager, IFile pom, MavenProject mavenProject,</div><div class='del'>-      ResolverConfiguration resolverConfiguration) {</div><div class='add'>+      List&lt;MojoExecution&gt; executionPlan, ResolverConfiguration resolverConfiguration) {</div><div class='ctx'>     this.manager = manager;</div><div class='ctx'>     this.pom = pom;</div><div class='ctx'>     IPath location = pom.getLocation();</div><div class='ctx'>     this.pomFile = location == null ? null : location.toFile(); // save pom file</div><div class='ctx'>     this.resolverConfiguration = resolverConfiguration;</div><div class='del'>-    setMavenProject(mavenProject);</div><div class='del'>-    updateTimestamp();</div><div class='del'>-  }</div><div class='ctx'> </div><div class='del'>-  private void setMavenProject(MavenProject mavenProject) {</div><div class='ctx'>     this.mavenProject = mavenProject;</div><div class='del'>-    </div><div class='add'>+    this.executionPlan = executionPlan;</div><div class='add'>+</div><div class='ctx'>     this.artifactKey = new ArtifactKey(mavenProject.getArtifact());</div><div class='ctx'>     this.packaging = mavenProject.getPackaging();</div><div class='ctx'>     this.modules = mavenProject.getModules();</div><div class='hunk'>@@ -115,8 +125,6 @@ public class MavenProjectFacade implements IMavenProjectFacade, Serializable {</div><div class='ctx'>     path = getProjectRelativePath(mavenProject.getBuild().getTestOutputDirectory());</div><div class='ctx'>     this.testOutputLocation = path != null ? fullPath.append(path) : null;</div><div class='ctx'> </div><div class='del'>-    setMavenProjectArtifacts();</div><div class='del'>-</div><div class='ctx'>     this.artifactRepositories = new LinkedHashSet&lt;ArtifactRepositoryRef&gt;();</div><div class='ctx'>     for(ArtifactRepository repository : mavenProject.getRemoteArtifactRepositories()) {</div><div class='ctx'>       this.artifactRepositories.add(new ArtifactRepositoryRef(repository));</div><div class='hunk'>@@ -126,6 +134,10 @@ public class MavenProjectFacade implements IMavenProjectFacade, Serializable {</div><div class='ctx'>     for(ArtifactRepository repository : mavenProject.getPluginArtifactRepositories()) {</div><div class='ctx'>       this.pluginArtifactRepositories.add(new ArtifactRepositoryRef(repository));</div><div class='ctx'>     }</div><div class='add'>+</div><div class='add'>+    setMavenProjectArtifacts();</div><div class='add'>+</div><div class='add'>+    updateTimestamp();</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='ctx'>   /**</div><div class='hunk'>@@ -344,33 +356,41 @@ public class MavenProjectFacade implements IMavenProjectFacade, Serializable {</div><div class='ctx'>     return pluginArtifactRepositories;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public ILifecycleMapping getLifecycleMapping(IProgressMonitor monitor) throws CoreException {</div><div class='del'>-    if ( lifecycleMapping == null ) {</div><div class='del'>-      if(getMavenProject(monitor).equals(pom.getParent())) {</div><div class='del'>-        throw new IllegalArgumentException("Nested workspace module " + pom); //$NON-NLS-1$</div><div class='del'>-      }</div><div class='del'>-</div><div class='del'>-      lifecycleMapping = manager.getLifecycleMapping(this, monitor);</div><div class='add'>+  public String toString() {</div><div class='add'>+    if(mavenProject == null) {</div><div class='add'>+      return "Maven Project: null";</div><div class='ctx'>     }</div><div class='del'>-    return lifecycleMapping;</div><div class='add'>+    return mavenProject.toString();</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public boolean hasValidConfiguration() {</div><div class='del'>-    return hasValidConfiguration;</div><div class='add'>+  public String getLifecycleMappingId() {</div><div class='add'>+    return lifecycleMappingId;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public void setHasValidConfiguration(boolean hasValidConfiguration) {</div><div class='del'>-    this.hasValidConfiguration = hasValidConfiguration;</div><div class='add'>+  public Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; getMojoExecutionMapping() {</div><div class='add'>+    return mojoExecutionMapping;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public String toString() {</div><div class='del'>-    if(mavenProject == null) {</div><div class='del'>-      return "Maven Project: null";</div><div class='del'>-    }</div><div class='del'>-    return mavenProject.toString();</div><div class='add'>+  public MojoExecution getMojoExecution(MojoExecutionKey mojoExecutionKey, IProgressMonitor monitor)</div><div class='add'>+      throws CoreException {</div><div class='add'>+    return manager.getMojoExecution(this, mojoExecutionKey, monitor);</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public void setLifecycleMappingId(String lifecycleMappingId) {</div><div class='add'>+    this.lifecycleMappingId = lifecycleMappingId;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public void setLifecycleMapping(ILifecycleMapping lifecycleMapping) {</div><div class='del'>-    this.lifecycleMapping = lifecycleMapping;</div><div class='add'>+  public void setMojoExecutionMapping(Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; mojoExecutionMapping) {</div><div class='add'>+    this.mojoExecutionMapping = mojoExecutionMapping;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  /**</div><div class='add'>+   * Returns cached list of MojoExecutions bound to project's default lifecycle. Returned MojoExecutions are not fully</div><div class='add'>+   * setup and {@link IMaven#setupMojoExecution(MavenSession, MavenProject, MojoExecution)} is required to execute</div><div class='add'>+   * and/or query mojo parameters. Similarly to {@link #getMavenProject()}, return value is null after workspace</div><div class='add'>+   * restart.</div><div class='add'>+   */</div><div class='add'>+  public List&lt;MojoExecution&gt; getExecutionPlan() {</div><div class='add'>+    return executionPlan;</div><div class='ctx'>   }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/ProjectRegistryManager.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/ProjectRegistryManager.java<br/>index c5da8d6..41f2e5c 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/ProjectRegistryManager.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/ProjectRegistryManager.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/ProjectRegistryManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/internal/project/registry/ProjectRegistryManager.java</a></div><div class='hunk'>@@ -25,6 +25,8 @@ import java.util.Properties;</div><div class='ctx'> import java.util.Set;</div><div class='ctx'> </div><div class='ctx'> import org.osgi.service.prefs.BackingStoreException;</div><div class='add'>+import org.slf4j.Logger;</div><div class='add'>+import org.slf4j.LoggerFactory;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.IFile;</div><div class='ctx'> import org.eclipse.core.resources.IProject;</div><div class='hunk'>@@ -36,7 +38,6 @@ import org.eclipse.core.runtime.IProgressMonitor;</div><div class='ctx'> import org.eclipse.core.runtime.NullProgressMonitor;</div><div class='ctx'> import org.eclipse.core.runtime.OperationCanceledException;</div><div class='ctx'> import org.eclipse.core.runtime.Path;</div><div class='del'>-import org.eclipse.core.runtime.Platform;</div><div class='ctx'> import org.eclipse.core.runtime.SubMonitor;</div><div class='ctx'> import org.eclipse.core.runtime.jobs.ISchedulingRule;</div><div class='ctx'> import org.eclipse.core.runtime.jobs.Job;</div><div class='hunk'>@@ -51,8 +52,11 @@ import org.apache.maven.execution.DefaultMavenExecutionRequest;</div><div class='ctx'> import org.apache.maven.execution.DefaultMavenExecutionResult;</div><div class='ctx'> import org.apache.maven.execution.MavenExecutionRequest;</div><div class='ctx'> import org.apache.maven.execution.MavenExecutionResult;</div><div class='add'>+import org.apache.maven.execution.MavenSession;</div><div class='add'>+import org.apache.maven.lifecycle.MavenExecutionPlan;</div><div class='ctx'> import org.apache.maven.model.Model;</div><div class='ctx'> import org.apache.maven.model.Parent;</div><div class='add'>+import org.apache.maven.plugin.MojoExecution;</div><div class='ctx'> import org.apache.maven.project.MavenProject;</div><div class='ctx'> import org.apache.maven.project.artifact.MavenMetadataCache;</div><div class='ctx'> import org.apache.maven.properties.internal.EnvironmentUtils;</div><div class='hunk'>@@ -69,16 +73,18 @@ import org.eclipse.m2e.core.internal.ExtensionReader;</div><div class='ctx'> import org.eclipse.m2e.core.internal.Messages;</div><div class='ctx'> import org.eclipse.m2e.core.internal.embedder.MavenImpl;</div><div class='ctx'> import org.eclipse.m2e.core.internal.lifecycle.LifecycleMappingFactory;</div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.LifecycleMappingResult;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.IMavenMarkerManager;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MarkerUtils;</div><div class='ctx'> import org.eclipse.m2e.core.internal.project.DependencyResolutionContext;</div><div class='ctx'> import org.eclipse.m2e.core.internal.project.IManagedCache;</div><div class='del'>-import org.eclipse.m2e.core.internal.project.MarkerUtils;</div><div class='del'>-import org.eclipse.m2e.core.project.IMavenMarkerManager;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectChangedListener;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenProjectChangedEvent;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenUpdateRequest;</div><div class='ctx'> import org.eclipse.m2e.core.project.ResolverConfiguration;</div><div class='ctx'> import org.eclipse.m2e.core.project.configurator.ILifecycleMapping;</div><div class='add'>+import org.eclipse.m2e.core.project.configurator.MojoExecutionKey;</div><div class='ctx'> </div><div class='ctx'> /**</div><div class='ctx'>  * This class keeps track of all maven projects present in the workspace and</div><div class='hunk'>@@ -86,8 +92,7 @@ import org.eclipse.m2e.core.project.configurator.ILifecycleMapping;</div><div class='ctx'>  */</div><div class='ctx'> public class ProjectRegistryManager {</div><div class='ctx'> </div><div class='del'>-  public static boolean DEBUG = MavenPlugin.getDefault().isDebugging()</div><div class='del'>-      &amp; Boolean.parseBoolean(Platform.getDebugOption(IMavenConstants.PLUGIN_ID + "/debug/projectManager")); //$NON-NLS-1$</div><div class='add'>+  private static Logger log = LoggerFactory.getLogger(ProjectRegistryManager.class);</div><div class='ctx'> </div><div class='ctx'>   static final String ARTIFACT_TYPE_POM = "pom"; //$NON-NLS-1$</div><div class='ctx'>   static final String ARTIFACT_TYPE_JAR = "jar"; //$NON-NLS-1$</div><div class='hunk'>@@ -173,7 +178,7 @@ public class ProjectRegistryManager {</div><div class='ctx'>           monitor);</div><div class='ctx'>       MavenProject mavenProject = executionResult.getProject();</div><div class='ctx'>       if(mavenProject != null) {</div><div class='del'>-        projectFacade = new MavenProjectFacade(this, pom, mavenProject, configuration);</div><div class='add'>+        projectFacade = new MavenProjectFacade(this, pom, mavenProject, null, configuration);</div><div class='ctx'>       } else {</div><div class='ctx'>         List&lt;Throwable&gt; exceptions = executionResult.getExceptions();</div><div class='ctx'>         if (exceptions != null) {</div><div class='hunk'>@@ -382,9 +387,6 @@ public class ProjectRegistryManager {</div><div class='ctx'>         newFacades.put(pom, newFacade); // stash work for the second phase</div><div class='ctx'>       }</div><div class='ctx'> </div><div class='del'>-      // TODO theoretically, there is no need to re-read projects during second resolution phase</div><div class='del'>-      // only re-resolve dependencies.</div><div class='del'>-</div><div class='ctx'>       // phase 2: resolve project dependencies</div><div class='ctx'>       for(Map.Entry&lt;IFile, MavenProjectFacade&gt; entry : newFacades.entrySet()) {</div><div class='ctx'>         if(monitor.isCanceled()) {</div><div class='hunk'>@@ -403,11 +405,7 @@ public class ProjectRegistryManager {</div><div class='ctx'>         if(newFacade != null) {</div><div class='ctx'>           monitor.subTask(NLS.bind(Messages.ProjectRegistryManager_task_project,newFacade.getProject().getName()));</div><div class='ctx'> </div><div class='del'>-          // TODO is this expansive?</div><div class='del'>-          MavenExecutionRequest mavenRequest = getConfiguredExecutionRequest(context, newState, newFacade.getPom(),</div><div class='del'>-              newFacade.getResolverConfiguration());</div><div class='del'>-          mavenRequest.getProjectBuildingRequest().setProject(newFacade.getMavenProject());</div><div class='del'>-          mavenRequest.getProjectBuildingRequest().setResolveDependencies(true);</div><div class='add'>+          setupLifecycleMapping(newState, context, monitor, newFacade);</div><div class='ctx'> </div><div class='ctx'>           capabilities = new LinkedHashSet&lt;Capability&gt;();</div><div class='ctx'>           requirements = new LinkedHashSet&lt;RequiredCapability&gt;();</div><div class='hunk'>@@ -421,6 +419,10 @@ public class ProjectRegistryManager {</div><div class='ctx'>           AbstractMavenDependencyResolver resolver = getMavenDependencyResolver(newFacade, monitor);</div><div class='ctx'>           resolver.setContextProjectRegistry(newState);</div><div class='ctx'>           try {</div><div class='add'>+            MavenExecutionRequest mavenRequest = getConfiguredExecutionRequest(context, newState, newFacade.getPom(),</div><div class='add'>+                newFacade.getResolverConfiguration());</div><div class='add'>+            mavenRequest.getProjectBuildingRequest().setProject(newFacade.getMavenProject());</div><div class='add'>+            mavenRequest.getProjectBuildingRequest().setResolveDependencies(true);</div><div class='ctx'>             resolver.resolveProjectDependencies(newFacade, mavenRequest, capabilities, requirements, monitor);</div><div class='ctx'>           } finally {</div><div class='ctx'>             resolver.setContextProjectRegistry(null);</div><div class='hunk'>@@ -471,6 +473,28 @@ public class ProjectRegistryManager {</div><div class='ctx'>     }</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='add'>+  private void setupLifecycleMapping(MutableProjectRegistry newState, DependencyResolutionContext context,</div><div class='add'>+      IProgressMonitor monitor, MavenProjectFacade newFacade) throws CoreException {</div><div class='add'>+    MavenExecutionRequest mavenRequest = getConfiguredExecutionRequest(context, newState, newFacade.getPom(),</div><div class='add'>+        newFacade.getResolverConfiguration());</div><div class='add'>+</div><div class='add'>+    LifecycleMappingResult mappingResult = LifecycleMappingFactory.calculateLifecycleMapping(mavenRequest, newFacade,</div><div class='add'>+        monitor);</div><div class='add'>+</div><div class='add'>+    newFacade.setLifecycleMappingId(mappingResult.getLifecycleMappingId());</div><div class='add'>+    newFacade.setMojoExecutionMapping(mappingResult.getMojoExecutionMapping());</div><div class='add'>+</div><div class='add'>+    // XXX reconsile with corresponding LifecycleMappingFactory methods</div><div class='add'>+    newFacade.setSessionProperty(MavenProjectFacade.PROP_LIFECYCLE_MAPPING, mappingResult.getLifecycleMapping());</div><div class='add'>+    newFacade.setSessionProperty(MavenProjectFacade.PROP_CONFIGURATORS, mappingResult.getProjectConfigurators());</div><div class='add'>+</div><div class='add'>+    markerManager.deleteMarkers(newFacade.getPom(), IMavenConstants.MARKER_LIFECYCLEMAPPING_ID);</div><div class='add'>+    if(mappingResult.hasProblems()) {</div><div class='add'>+      markerManager.addErrorMarkers(newFacade.getPom(), IMavenConstants.MARKER_LIFECYCLEMAPPING_ID,</div><div class='add'>+          mappingResult.getProblems());</div><div class='add'>+    }</div><div class='add'>+  }</div><div class='add'>+</div><div class='ctx'>   static &lt;T&gt; Set&lt;T&gt; diff(Set&lt;T&gt; a, Set&lt;T&gt; b) {</div><div class='ctx'>     if(a == null || a.isEmpty()) {</div><div class='ctx'>       if(b == null || b.isEmpty()) {</div><div class='hunk'>@@ -517,7 +541,7 @@ public class ProjectRegistryManager {</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='ctx'>   private AbstractMavenDependencyResolver getMavenDependencyResolver(MavenProjectFacade newFacade, IProgressMonitor monitor) throws CoreException {</div><div class='del'>-    ILifecycleMapping lifecycleMapping = newFacade.getLifecycleMapping(monitor);</div><div class='add'>+    ILifecycleMapping lifecycleMapping = LifecycleMappingFactory.getLifecycleMapping(newFacade);</div><div class='ctx'> </div><div class='ctx'>     if (lifecycleMapping instanceof ILifecycleMapping2) {</div><div class='ctx'>       AbstractMavenDependencyResolver resolver = ((ILifecycleMapping2) lifecycleMapping).getDependencyResolver(monitor);</div><div class='hunk'>@@ -529,7 +553,7 @@ public class ProjectRegistryManager {</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='ctx'>   protected MavenExecutionRequest getConfiguredExecutionRequest(DependencyResolutionContext context,</div><div class='del'>-      MutableProjectRegistry state, IFile pom, ResolverConfiguration resolverConfiguration) throws CoreException {</div><div class='add'>+      IProjectRegistry state, IFile pom, ResolverConfiguration resolverConfiguration) throws CoreException {</div><div class='ctx'>     MavenExecutionRequest mavenRequest = DefaultMavenExecutionRequest.copy(context.getExecutionRequest());</div><div class='ctx'>     configureExecutionRequest(mavenRequest, state, pom, resolverConfiguration);</div><div class='ctx'>     getMaven().populateDefaults(mavenRequest);</div><div class='hunk'>@@ -560,24 +584,42 @@ public class ProjectRegistryManager {</div><div class='ctx'>     // don't cache maven session</div><div class='ctx'>     getMaven().detachFromSession(mavenProject);</div><div class='ctx'> </div><div class='add'>+    List&lt;MojoExecution&gt; mojoExecutions = null;</div><div class='add'>+    try {</div><div class='add'>+      MavenExecutionRequest mavenRequest = getConfiguredExecutionRequest(context, state, pom, resolverConfiguration);</div><div class='add'>+      MavenSession session = maven.createSession(mavenRequest, mavenProject);</div><div class='add'>+      MavenExecutionPlan executionPlan = maven.calculateExecutionPlan(session, mavenProject, Arrays.asList("deploy"),</div><div class='add'>+          false, monitor);</div><div class='add'>+      mojoExecutions = executionPlan.getMojoExecutions();</div><div class='add'>+    } catch(CoreException e) {</div><div class='add'>+      markerManager.addErrorMarkers(pom, IMavenConstants.MARKER_POM_LOADING_ID, e);</div><div class='add'>+    }</div><div class='add'>+</div><div class='ctx'>     // create and return new project facade</div><div class='ctx'>     MavenProjectFacade mavenProjectFacade = new MavenProjectFacade(ProjectRegistryManager.this, pom, mavenProject,</div><div class='del'>-        resolverConfiguration);</div><div class='del'>-</div><div class='del'>-    ILifecycleMapping lifecycleMapping = getLifecycleMapping(mavenProjectFacade, state, monitor);</div><div class='del'>-    mavenProjectFacade.setLifecycleMapping(lifecycleMapping);</div><div class='del'>-    </div><div class='del'>-    MavenPlugin.getDefault().getProjectConfigurationManager().validateProjectConfiguration(mavenProjectFacade, monitor);</div><div class='add'>+        mojoExecutions, resolverConfiguration);</div><div class='ctx'> </div><div class='ctx'>     return mavenProjectFacade;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  private ILifecycleMapping getLifecycleMapping(MavenProjectFacade facade, IProjectRegistry state,</div><div class='del'>-      IProgressMonitor monitor) throws CoreException {</div><div class='del'>-    MavenExecutionRequest request = createExecutionRequest(state, facade.getPom(), facade.getResolverConfiguration(),</div><div class='del'>-        monitor);</div><div class='del'>-    ILifecycleMapping lifecycleMapping = LifecycleMappingFactory.getLifecycleMapping(request, facade, monitor);</div><div class='del'>-    return lifecycleMapping;</div><div class='add'>+  private List&lt;MojoExecution&gt; getMojoExecutions(DependencyResolutionContext context, IProjectRegistry state,</div><div class='add'>+      MavenProjectFacade projectFacade, IProgressMonitor monitor) throws CoreException {</div><div class='add'>+    @SuppressWarnings("unchecked")</div><div class='add'>+    List&lt;MojoExecution&gt; mojoExecutions = (List&lt;MojoExecution&gt;) projectFacade</div><div class='add'>+        .getSessionProperty(MavenProjectFacade.PROP_MOJO_EXECUTIONS);</div><div class='add'>+</div><div class='add'>+    if(mojoExecutions == null) {</div><div class='add'>+      MavenExecutionRequest mavenRequest = getConfiguredExecutionRequest(context, state, projectFacade.getPom(),</div><div class='add'>+          projectFacade.getResolverConfiguration());</div><div class='add'>+      MavenSession session = getMaven().createSession(mavenRequest, projectFacade.getMavenProject());</div><div class='add'>+      List&lt;String&gt; goals = Arrays.asList("deploy"); //$NON-NLS-1$</div><div class='add'>+      MavenExecutionPlan executionPlan = maven.calculateExecutionPlan(session, projectFacade.getMavenProject(), goals,</div><div class='add'>+          false, monitor);</div><div class='add'>+      mojoExecutions = executionPlan.getMojoExecutions();</div><div class='add'>+      projectFacade.setSessionProperty(MavenProjectFacade.PROP_MOJO_EXECUTIONS, mojoExecutions);</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    return mojoExecutions;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='ctx'>   public IFile getModulePom(IFile pom, String moduleName) {</div><div class='hunk'>@@ -754,12 +796,25 @@ public class ProjectRegistryManager {</div><div class='ctx'>     return maven;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  ILifecycleMapping getLifecycleMapping(MavenProjectFacade facade, IProgressMonitor monitor) {</div><div class='del'>-    try {</div><div class='del'>-      return getLifecycleMapping(facade, projectRegistry, monitor);</div><div class='del'>-    } catch(CoreException ex) {</div><div class='del'>-      MavenLogger.log(ex);</div><div class='add'>+  public MojoExecution getMojoExecution(MavenProjectFacade projectFacade, MojoExecutionKey mojoExecutionKey,</div><div class='add'>+      IProgressMonitor monitor) throws CoreException {</div><div class='add'>+    IMavenConfiguration mavenConfiguration = MavenPlugin.getDefault().getMavenConfiguration();</div><div class='add'>+    boolean offline = mavenConfiguration.isOffline();</div><div class='add'>+    MavenUpdateRequest updateRequest = new MavenUpdateRequest(offline, false);</div><div class='add'>+    MavenExecutionRequest executionRequest = createExecutionRequest(projectFacade.getPom(),</div><div class='add'>+        projectFacade.getResolverConfiguration(), monitor);</div><div class='add'>+    DependencyResolutionContext context = new DependencyResolutionContext(updateRequest, executionRequest);</div><div class='add'>+    List&lt;MojoExecution&gt; mojoExecutions = getMojoExecutions(context, projectRegistry, projectFacade, monitor);</div><div class='add'>+</div><div class='add'>+    for(MojoExecution mojoExecution : mojoExecutions) {</div><div class='add'>+      if(mojoExecutionKey.match(mojoExecution)) {</div><div class='add'>+        MavenExecutionRequest request = createExecutionRequest(projectFacade.getPom(),</div><div class='add'>+            projectFacade.getResolverConfiguration(), monitor);</div><div class='add'>+        MavenSession session = maven.createSession(request, projectFacade.getMavenProject());</div><div class='add'>+        return maven.setupMojoExecution(session, projectFacade.getMavenProject(), mojoExecution);</div><div class='add'>+      }</div><div class='ctx'>     }</div><div class='add'>+</div><div class='ctx'>     return null;</div><div class='ctx'>   }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenProjectFacade.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenProjectFacade.java<br/>index 67468c7..8390c26 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenProjectFacade.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenProjectFacade.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenProjectFacade.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IMavenProjectFacade.java</a></div><div class='hunk'>@@ -13,6 +13,7 @@ package org.eclipse.m2e.core.project;</div><div class='ctx'> </div><div class='ctx'> import java.io.File;</div><div class='ctx'> import java.util.List;</div><div class='add'>+import java.util.Map;</div><div class='ctx'> import java.util.Set;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.IFile;</div><div class='hunk'>@@ -21,14 +22,14 @@ import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> import org.eclipse.core.runtime.IPath;</div><div class='ctx'> import org.eclipse.core.runtime.IProgressMonitor;</div><div class='ctx'> </div><div class='del'>-import org.apache.maven.lifecycle.MavenExecutionPlan;</div><div class='add'>+import org.apache.maven.plugin.MojoExecution;</div><div class='ctx'> import org.apache.maven.project.MavenProject;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.m2e.core.embedder.ArtifactKey;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.ArtifactRef;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.ArtifactRepositoryRef;</div><div class='del'>-import org.eclipse.m2e.core.internal.project.ProjectConfigurationManager;</div><div class='del'>-import org.eclipse.m2e.core.project.configurator.ILifecycleMapping;</div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionMetadata;</div><div class='add'>+import org.eclipse.m2e.core.project.configurator.MojoExecutionKey;</div><div class='ctx'> </div><div class='ctx'> /**</div><div class='ctx'>  * IMavenProjectFacade</div><div class='hunk'>@@ -145,13 +146,16 @@ public interface IMavenProjectFacade {</div><div class='ctx'> </div><div class='ctx'>   public Set&lt;ArtifactRepositoryRef&gt; getPluginArtifactRepositoryRefs();</div><div class='ctx'> </div><div class='del'>-  public ILifecycleMapping getLifecycleMapping(IProgressMonitor monitor) throws CoreException;</div><div class='del'>-</div><div class='ctx'>   /**</div><div class='del'>-   * Returns true if the project configuration is valid. This flag is set by</div><div class='del'>-   * {@link ProjectConfigurationManager#validateProjectConfiguration(IMavenProjectFacade, IProgressMonitor)}. Returns</div><div class='del'>-   * false if the project configuration has not been validated yet.</div><div class='add'>+   * Returns fully setup MojoExecution instance bound to project build lifecycle that matches provided mojoExecutionKey.</div><div class='add'>+   * Returns null if no such mojo execution.</div><div class='ctx'>    */</div><div class='del'>-  boolean hasValidConfiguration();</div><div class='add'>+  public MojoExecution getMojoExecution(MojoExecutionKey mojoExecutionKey, IProgressMonitor monitor)</div><div class='add'>+      throws CoreException;</div><div class='add'>+</div><div class='add'>+  // lifecycle mapping</div><div class='add'>+</div><div class='add'>+  public String getLifecycleMappingId();</div><div class='ctx'> </div><div class='add'>+  public Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; getMojoExecutionMapping();</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IProjectConfigurationManager.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IProjectConfigurationManager.java<br/>index a36aa96..2f14bf4 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IProjectConfigurationManager.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IProjectConfigurationManager.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IProjectConfigurationManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/IProjectConfigurationManager.java</a></div><div class='hunk'>@@ -49,18 +49,9 @@ public interface IProjectConfigurationManager {</div><div class='ctx'> </div><div class='ctx'>   void disableMavenNature(IProject project, IProgressMonitor monitor) throws CoreException;</div><div class='ctx'> </div><div class='del'>-  void updateProjectConfiguration(IProject project, ResolverConfiguration configuration, IProgressMonitor monitor)</div><div class='add'>+  void updateProjectConfiguration(IProject project, IProgressMonitor monitor)</div><div class='ctx'>       throws CoreException;</div><div class='ctx'> </div><div class='del'>-  ILifecycleMapping getLifecycleMapping(IMavenProjectFacade projectFacade, IProgressMonitor monitor)</div><div class='add'>+  ILifecycleMapping getLifecycleMapping(IMavenProjectFacade projectFacade)</div><div class='ctx'>       throws CoreException;</div><div class='del'>-</div><div class='del'>-  /**</div><div class='del'>-   * Validates that the project configuration is valid. It does not actually (re)configure the project, but it validates</div><div class='del'>-   * that the project configure action will not fail for obvious reasons like missing lifecycle mapping, missing project</div><div class='del'>-   * configuration, etc.</div><div class='del'>-   * </div><div class='del'>-   * @return true if the configuration is valid</div><div class='del'>-   */</div><div class='del'>-  boolean validateProjectConfiguration(IMavenProjectFacade projectFacade, IProgressMonitor monitor);</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/MavenProjectManager.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/MavenProjectManager.java<br/>index 774dd6e..cc469ae 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/MavenProjectManager.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/MavenProjectManager.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/MavenProjectManager.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/MavenProjectManager.java</a></div><div class='hunk'>@@ -22,13 +22,18 @@ import org.eclipse.core.runtime.NullProgressMonitor;</div><div class='ctx'> import org.apache.maven.artifact.repository.MavenArtifactRepository;</div><div class='ctx'> import org.apache.maven.execution.MavenExecutionRequest;</div><div class='ctx'> </div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.LifecycleMappingFactory;</div><div class='add'>+import org.eclipse.m2e.core.internal.project.registry.MavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.internal.project.registry.ProjectRegistryManager;</div><div class='ctx'> import org.eclipse.m2e.core.internal.project.registry.ProjectRegistryRefreshJob;</div><div class='add'>+import org.eclipse.m2e.core.project.configurator.ILifecycleMapping;</div><div class='ctx'> </div><div class='ctx'> </div><div class='ctx'> /**</div><div class='ctx'>  * This class keeps track of all Maven projects present in the workspace and provides mapping between Maven artifacts</div><div class='ctx'>  * and Workspace projects.</div><div class='add'>+ * </div><div class='add'>+ * @deprecated this class will be removed before 1.0</div><div class='ctx'>  */</div><div class='ctx'> public class MavenProjectManager {</div><div class='ctx'> </div><div class='hunk'>@@ -146,4 +151,11 @@ public class MavenProjectManager {</div><div class='ctx'>   public MavenArtifactRepository getWorkspaceLocalRepository() throws CoreException {</div><div class='ctx'>     return manager.getWorkspaceLocalRepository();</div><div class='ctx'>   }</div><div class='add'>+</div><div class='add'>+  /**</div><div class='add'>+   * PROVISIONAL</div><div class='add'>+   */</div><div class='add'>+  public ILifecycleMapping getLifecycleMapping(IMavenProjectFacade projectFacade) {</div><div class='add'>+    return LifecycleMappingFactory.getLifecycleMapping((MavenProjectFacade) projectFacade);</div><div class='add'>+  }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractCustomizableLifecycleMapping.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractCustomizableLifecycleMapping.java<br/>index 04f932b..a508dc1 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractCustomizableLifecycleMapping.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractCustomizableLifecycleMapping.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractCustomizableLifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractCustomizableLifecycleMapping.java</a></div><div class='hunk'>@@ -19,16 +19,15 @@ import java.util.Map;</div><div class='ctx'> import org.slf4j.Logger;</div><div class='ctx'> import org.slf4j.LoggerFactory;</div><div class='ctx'> </div><div class='del'>-import org.eclipse.core.resources.IMarker;</div><div class='add'>+import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> import org.eclipse.core.runtime.IProgressMonitor;</div><div class='del'>-import org.eclipse.osgi.util.NLS;</div><div class='ctx'> </div><div class='ctx'> import org.apache.maven.plugin.MojoExecution;</div><div class='ctx'> </div><div class='del'>-import org.eclipse.m2e.core.internal.Messages;</div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.LifecycleMappingConfigurationException;</div><div class='ctx'> import org.eclipse.m2e.core.internal.lifecycle.LifecycleMappingFactory;</div><div class='del'>-import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionAction;</div><div class='ctx'> import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionMetadata;</div><div class='add'>+import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> </div><div class='ctx'> </div><div class='ctx'> /**</div><div class='hunk'>@@ -39,104 +38,34 @@ import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionMetadata;</div><div class='ctx'> public abstract class AbstractCustomizableLifecycleMapping extends AbstractLifecycleMapping {</div><div class='ctx'>   private static Logger log = LoggerFactory.getLogger(AbstractCustomizableLifecycleMapping.class);</div><div class='ctx'> </div><div class='del'>-  private Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; effectiveMapping;</div><div class='del'>-</div><div class='del'>-  private Map&lt;String, AbstractProjectConfigurator&gt; configurators;</div><div class='del'>-</div><div class='del'>-  private List&lt;MojoExecution&gt; executionPlan;</div><div class='del'>-</div><div class='del'>-  private List&lt;MojoExecutionKey&gt; notCoveredExecutions;</div><div class='del'>-</div><div class='del'>-  @Override</div><div class='del'>-  public void initializeMapping(List&lt;MojoExecution&gt; mojoExecutions,</div><div class='del'>-      Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; executionMapping) {</div><div class='del'>-</div><div class='del'>-    this.effectiveMapping = executionMapping;</div><div class='del'>-</div><div class='del'>-    this.executionPlan = mojoExecutions;</div><div class='del'>-</div><div class='del'>-    // instantiate configurator</div><div class='del'>-    this.configurators = new LinkedHashMap&lt;String, AbstractProjectConfigurator&gt;();</div><div class='del'>-    for(List&lt;PluginExecutionMetadata&gt; executionMetadatas : effectiveMapping.values()) {</div><div class='del'>-      for(PluginExecutionMetadata executionMetadata : executionMetadatas) {</div><div class='del'>-        if(PluginExecutionAction.configurator == executionMetadata.getAction()) {</div><div class='del'>-          String configuratorId = LifecycleMappingFactory.getProjectConfiguratorId(executionMetadata);</div><div class='del'>-          AbstractProjectConfigurator projectConfigurator = configurators.get(configuratorId);</div><div class='del'>-          if(projectConfigurator == null) {</div><div class='del'>-            try {</div><div class='del'>-              configurators.put(configuratorId, LifecycleMappingFactory.createProjectConfigurator(executionMetadata));</div><div class='del'>-            } catch(LifecycleMappingConfigurationException e) {</div><div class='del'>-              addMissingConfiguratorProblem(1, NLS.bind(Messages.ProjectConfiguratorNotAvailable, configuratorId),</div><div class='del'>-                  configuratorId);</div><div class='del'>-            }</div><div class='del'>-          } else {</div><div class='del'>-            projectConfigurator.addPluginExecutionFilter(executionMetadata.getFilter());</div><div class='del'>-          }</div><div class='del'>-        }</div><div class='del'>-      }</div><div class='del'>-    }</div><div class='del'>-</div><div class='del'>-    // find and cache not-covered mojo execution keys</div><div class='del'>-    notCoveredExecutions = new ArrayList&lt;MojoExecutionKey&gt;();</div><div class='del'>-    all_mojo_executions: for(MojoExecution mojoExecution : executionPlan) {</div><div class='del'>-      if(!isInterestingPhase(mojoExecution.getLifecyclePhase())) {</div><div class='del'>-        continue;</div><div class='del'>-      }</div><div class='del'>-      MojoExecutionKey executionKey = new MojoExecutionKey(mojoExecution);</div><div class='del'>-      List&lt;PluginExecutionMetadata&gt; executionMetadatas = effectiveMapping.get(executionKey);</div><div class='del'>-      if(executionMetadatas != null) {</div><div class='del'>-        for(PluginExecutionMetadata executionMetadata : executionMetadatas) {</div><div class='del'>-          switch(executionMetadata.getAction()) {</div><div class='del'>-            case ignore:</div><div class='del'>-            case execute:</div><div class='del'>-              String message = LifecycleMappingFactory.getActionMessage(executionMetadata);</div><div class='del'>-              if(message != null) {</div><div class='del'>-                addProblem(new ActionMessageProblemInfo(executionKey, 1 /*line*/, message, IMarker.SEVERITY_WARNING));</div><div class='del'>-              }</div><div class='del'>-              continue all_mojo_executions;</div><div class='del'>-            case error:</div><div class='del'>-              message = LifecycleMappingFactory.getActionMessage(executionMetadata);</div><div class='del'>-              if(message == null) {</div><div class='del'>-                message = NLS.bind(Messages.LifecycleConfigurationPluginExecutionErrorMessage, executionKey.toString());</div><div class='del'>-              }</div><div class='del'>-              addProblem(new ActionMessageProblemInfo(executionKey, 1 /*line*/, message, IMarker.SEVERITY_ERROR));</div><div class='del'>-              continue all_mojo_executions;</div><div class='del'>-            case configurator:</div><div class='del'>-              if(configurators.containsKey(LifecycleMappingFactory.getProjectConfiguratorId(executionMetadata))) {</div><div class='del'>-                continue all_mojo_executions;</div><div class='del'>-              }</div><div class='del'>-              break;</div><div class='del'>-            default:</div><div class='del'>-              throw new IllegalArgumentException("Missing handling for action=" + executionMetadata.getAction());</div><div class='del'>-          }</div><div class='del'>-        }</div><div class='del'>-      }</div><div class='del'>-      notCoveredExecutions.add(executionKey);</div><div class='del'>-    }</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; getBuildParticipants(IProgressMonitor monitor) {</div><div class='add'>+  public Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; getBuildParticipants(IMavenProjectFacade projectFacade,</div><div class='add'>+      IProgressMonitor monitor) throws CoreException {</div><div class='add'>+    log.debug("Build participants for {}", projectFacade.getMavenProject());</div><div class='ctx'>     Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; result = new LinkedHashMap&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt;();</div><div class='ctx'> </div><div class='del'>-    log.debug("Build participants for {}", getMavenProjectFacade().getMavenProject());</div><div class='del'>-    for(MojoExecution mojoExecution : executionPlan) {</div><div class='del'>-      MojoExecutionKey executionKey = new MojoExecutionKey(mojoExecution);</div><div class='add'>+    Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; mapping = projectFacade.getMojoExecutionMapping();</div><div class='add'>+    Map&lt;String, AbstractProjectConfigurator&gt; configurators = getProjectConfigurators(projectFacade);</div><div class='add'>+</div><div class='add'>+    for(Map.Entry&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; entry : mapping.entrySet()) {</div><div class='add'>+      MojoExecutionKey executionKey = entry.getKey();</div><div class='ctx'>       log.debug("Mojo execution key: {}", executionKey);</div><div class='add'>+      MojoExecution mojoExecution = projectFacade.getMojoExecution(executionKey, monitor);</div><div class='add'>+      List&lt;PluginExecutionMetadata&gt; executionMetadatas = entry.getValue();</div><div class='ctx'>       List&lt;AbstractBuildParticipant&gt; executionMappings = new ArrayList&lt;AbstractBuildParticipant&gt;();</div><div class='del'>-      List&lt;PluginExecutionMetadata&gt; executionMetadatas = effectiveMapping.get(executionKey);</div><div class='ctx'>       if(executionMetadatas != null) {</div><div class='ctx'>         for(PluginExecutionMetadata executionMetadata : executionMetadatas) {</div><div class='ctx'>           log.debug("\tAction: {}", executionMetadata.getAction());</div><div class='ctx'>           switch(executionMetadata.getAction()) {</div><div class='ctx'>             case execute:</div><div class='del'>-              executionMappings.add(LifecycleMappingFactory.createMojoExecutionBuildParicipant(mojoExecution,</div><div class='del'>-                  executionMetadata));</div><div class='add'>+              executionMappings.add(LifecycleMappingFactory.createMojoExecutionBuildParicipant(projectFacade,</div><div class='add'>+                  mojoExecution, executionMetadata));</div><div class='ctx'>               break;</div><div class='ctx'>             case configurator:</div><div class='ctx'>               String configuratorId = LifecycleMappingFactory.getProjectConfiguratorId(executionMetadata);</div><div class='ctx'>               log.debug("\t\tProject configurator id: {}", configuratorId);</div><div class='ctx'>               AbstractProjectConfigurator configurator = configurators.get(configuratorId);</div><div class='del'>-              AbstractBuildParticipant buildParticipant = configurator.getBuildParticipant(mojoExecution);</div><div class='add'>+              AbstractBuildParticipant buildParticipant = configurator.getBuildParticipant(projectFacade,</div><div class='add'>+                  mojoExecution, executionMetadata);</div><div class='ctx'>               if(buildParticipant != null) {</div><div class='ctx'>                 log.debug("\t\tBuild participant: {}", buildParticipant.getClass().getName());</div><div class='ctx'>                 executionMappings.add(buildParticipant);</div><div class='hunk'>@@ -157,15 +86,89 @@ public abstract class AbstractCustomizableLifecycleMapping extends AbstractLifec</div><div class='ctx'>     return result;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public List&lt;AbstractProjectConfigurator&gt; getProjectConfigurators(IProgressMonitor monitor) {</div><div class='del'>-    return new ArrayList&lt;AbstractProjectConfigurator&gt;(configurators.values());</div><div class='add'>+  public List&lt;AbstractProjectConfigurator&gt; getProjectConfigurators(IMavenProjectFacade projectFacade,</div><div class='add'>+      IProgressMonitor monitor) {</div><div class='add'>+    return new ArrayList&lt;AbstractProjectConfigurator&gt;(getProjectConfigurators(projectFacade).values());</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  private Map&lt;String, AbstractProjectConfigurator&gt; getProjectConfigurators(IMavenProjectFacade projectFacade) {</div><div class='add'>+    return LifecycleMappingFactory.getProjectConfigurators(projectFacade);</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public List&lt;MojoExecutionKey&gt; getNotCoveredMojoExecutions(IProgressMonitor monitor) {</div><div class='del'>-    return notCoveredExecutions;</div><div class='add'>+  public boolean hasLifecycleMappingChanged(IMavenProjectFacade oldFacade, IMavenProjectFacade newFacade,</div><div class='add'>+      IProgressMonitor monitor) {</div><div class='add'>+    if(!getId().equals(newFacade.getLifecycleMappingId())) {</div><div class='add'>+      throw new IllegalArgumentException();</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    if(oldFacade == null || !getId().equals(oldFacade.getLifecycleMappingId())) {</div><div class='add'>+      return true;</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; oldMappings = oldFacade.getMojoExecutionMapping();</div><div class='add'>+</div><div class='add'>+    for(Map.Entry&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; entry : newFacade.getMojoExecutionMapping()</div><div class='add'>+        .entrySet()) {</div><div class='add'>+      List&lt;PluginExecutionMetadata&gt; metadatas = entry.getValue();</div><div class='add'>+      List&lt;PluginExecutionMetadata&gt; oldMetadatas = oldMappings.get(entry.getKey());</div><div class='add'>+      if(metadatas == null || metadatas.isEmpty()) {</div><div class='add'>+        if(oldMetadatas != null &amp;&amp; !oldMetadatas.isEmpty()) {</div><div class='add'>+          return true; // different</div><div class='add'>+        }</div><div class='add'>+        continue; // mapping is null/empty and did not change</div><div class='add'>+      }</div><div class='add'>+      if(oldMetadatas == null || oldMetadatas.isEmpty()) {</div><div class='add'>+        return true;</div><div class='add'>+      }</div><div class='add'>+      if(metadatas.size() != oldMetadatas.size()) {</div><div class='add'>+        return true;</div><div class='add'>+      }</div><div class='add'>+      for(int i = 0; i &lt; metadatas.size(); i++ ) {</div><div class='add'>+        PluginExecutionMetadata metadata = metadatas.get(i);</div><div class='add'>+        PluginExecutionMetadata oldMetadata = oldMetadatas.get(i);</div><div class='add'>+        if(metadata == null) {</div><div class='add'>+          if(oldMetadata != null) {</div><div class='add'>+            return true;</div><div class='add'>+          }</div><div class='add'>+          continue;</div><div class='add'>+        }</div><div class='add'>+        if(oldMetadata == null) {</div><div class='add'>+          return true;</div><div class='add'>+        }</div><div class='add'>+        if(metadata.getAction() != oldMetadata.getAction()) {</div><div class='add'>+          return true;</div><div class='add'>+        }</div><div class='add'>+        switch(metadata.getAction()) {</div><div class='add'>+          case ignore:</div><div class='add'>+          case execute:</div><div class='add'>+            continue;</div><div class='add'>+          case error:</div><div class='add'>+            // TODO verify error message did not change...</div><div class='add'>+            continue;</div><div class='add'>+          case configurator:</div><div class='add'>+            String configuratorId = LifecycleMappingFactory.getProjectConfiguratorId(metadata);</div><div class='add'>+            String oldConfiguratorId = LifecycleMappingFactory.getProjectConfiguratorId(oldMetadata);</div><div class='add'>+            if(!eq(configuratorId, oldConfiguratorId)) {</div><div class='add'>+              return true;</div><div class='add'>+            }</div><div class='add'>+            try {</div><div class='add'>+              AbstractProjectConfigurator configurator = LifecycleMappingFactory.createProjectConfigurator(metadata);</div><div class='add'>+              if(configurator.hasConfigurationChanged(oldFacade, newFacade, entry.getKey(), monitor)) {</div><div class='add'>+                return true;</div><div class='add'>+              }</div><div class='add'>+            } catch(LifecycleMappingConfigurationException e) {</div><div class='add'>+              // installation problem/misconfiguration</div><div class='add'>+            }</div><div class='add'>+            continue;</div><div class='add'>+        }</div><div class='add'>+      }</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    return false;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public void addMissingConfiguratorProblem(int line, String message, String configuratorId) {</div><div class='del'>-    addProblem(new MissingConfiguratorProblemInfo(line, message, configuratorId));</div><div class='add'>+  private static &lt;T&gt; boolean eq(T a, T b) {</div><div class='add'>+    return a != null ? a.equals(b) : b == null;</div><div class='ctx'>   }</div><div class='add'>+</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractLifecycleMapping.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractLifecycleMapping.java<br/>index 21ef652..515fbc9 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractLifecycleMapping.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractLifecycleMapping.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractLifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractLifecycleMapping.java</a></div><div class='hunk'>@@ -12,8 +12,6 @@</div><div class='ctx'> package org.eclipse.m2e.core.project.configurator;</div><div class='ctx'> </div><div class='ctx'> import java.util.ArrayList;</div><div class='del'>-import java.util.List;</div><div class='del'>-import java.util.Map;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.ICommand;</div><div class='ctx'> import org.eclipse.core.resources.IProject;</div><div class='hunk'>@@ -22,10 +20,7 @@ import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> import org.eclipse.core.runtime.IProgressMonitor;</div><div class='ctx'> import org.eclipse.core.runtime.OperationCanceledException;</div><div class='ctx'> </div><div class='del'>-import org.apache.maven.plugin.MojoExecution;</div><div class='del'>-</div><div class='ctx'> import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='del'>-import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionMetadata;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> </div><div class='ctx'> </div><div class='hunk'>@@ -38,13 +33,7 @@ public abstract class AbstractLifecycleMapping implements ILifecycleMapping {</div><div class='ctx'> </div><div class='ctx'>   private String name;</div><div class='ctx'> </div><div class='del'>-  private String id;</div><div class='del'>-</div><div class='del'>-  private boolean showConfigurators;</div><div class='del'>-</div><div class='del'>-  private IMavenProjectFacade mavenProjectFacade;</div><div class='del'>-</div><div class='del'>-  private List&lt;LifecycleMappingProblemInfo&gt; problems = new ArrayList&lt;LifecycleMappingProblemInfo&gt;();</div><div class='add'>+  protected String id;</div><div class='ctx'> </div><div class='ctx'>   /**</div><div class='ctx'>    * Calls #configure method of all registered project configurators</div><div class='hunk'>@@ -52,7 +41,9 @@ public abstract class AbstractLifecycleMapping implements ILifecycleMapping {</div><div class='ctx'>   public void configure(ProjectConfigurationRequest request, IProgressMonitor monitor) throws CoreException {</div><div class='ctx'>     addMavenBuilder(request.getProject(), monitor);</div><div class='ctx'> </div><div class='del'>-    for(AbstractProjectConfigurator configurator : getProjectConfigurators(monitor)) {</div><div class='add'>+    IMavenProjectFacade projectFacade = request.getMavenProjectFacade();</div><div class='add'>+</div><div class='add'>+    for(AbstractProjectConfigurator configurator : getProjectConfigurators(projectFacade, monitor)) {</div><div class='ctx'>       if(monitor.isCanceled()) {</div><div class='ctx'>         throw new OperationCanceledException();</div><div class='ctx'>       }</div><div class='hunk'>@@ -61,7 +52,9 @@ public abstract class AbstractLifecycleMapping implements ILifecycleMapping {</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='ctx'>   public void unconfigure(ProjectConfigurationRequest request, IProgressMonitor monitor) throws CoreException {</div><div class='del'>-    for(AbstractProjectConfigurator configurator : getProjectConfigurators(monitor)) {</div><div class='add'>+    IMavenProjectFacade projectFacade = request.getMavenProjectFacade();</div><div class='add'>+</div><div class='add'>+    for(AbstractProjectConfigurator configurator : getProjectConfigurators(projectFacade, monitor)) {</div><div class='ctx'>       if(monitor.isCanceled()) {</div><div class='ctx'>         throw new OperationCanceledException();</div><div class='ctx'>       }</div><div class='hunk'>@@ -120,88 +113,6 @@ public abstract class AbstractLifecycleMapping implements ILifecycleMapping {</div><div class='ctx'>     this.id = id;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  /**</div><div class='del'>-   * @param show Set whether the project configurators should show. Default is true.</div><div class='del'>-   */</div><div class='del'>-  public void setShowConfigurators(boolean show) {</div><div class='del'>-    this.showConfigurators = show;</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  /**</div><div class='del'>-   * Returns whether the project configurators will be shown in the UI. Default is true.</div><div class='del'>-   */</div><div class='del'>-  public boolean showConfigurators() {</div><div class='del'>-    return this.showConfigurators;</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  private static final String[] INTERESTING_PHASES = {"validate", //</div><div class='del'>-      "initialize", //</div><div class='del'>-      "generate-sources", //</div><div class='del'>-      "process-sources", //</div><div class='del'>-      "generate-resources", //</div><div class='del'>-      "process-resources", //</div><div class='del'>-      "compile", //</div><div class='del'>-      "process-classes", //</div><div class='del'>-      "generate-test-sources", //</div><div class='del'>-      "process-test-sources", //</div><div class='del'>-      "generate-test-resources", //</div><div class='del'>-      "process-test-resources", //</div><div class='del'>-      "test-compile", //</div><div class='del'>-      "process-test-classes", //</div><div class='del'>-  // "test", //</div><div class='del'>-  // "prepare-package", //</div><div class='del'>-  // "package", //</div><div class='del'>-  //"pre-integration-test", //</div><div class='del'>-  // "integration-test", //</div><div class='del'>-  // "post-integration-test", //</div><div class='del'>-  // "verify", //</div><div class='del'>-  // "install", //</div><div class='del'>-  // "deploy", //</div><div class='del'>-  };</div><div class='del'>-</div><div class='del'>-  public boolean isInterestingPhase(String phase) {</div><div class='del'>-    for(String interestingPhase : INTERESTING_PHASES) {</div><div class='del'>-      if(interestingPhase.equals(phase)) {</div><div class='del'>-        return true;</div><div class='del'>-      }</div><div class='del'>-    }</div><div class='del'>-    return false;</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public abstract List&lt;AbstractProjectConfigurator&gt; getProjectConfigurators(IProgressMonitor monitor)</div><div class='del'>-      throws CoreException;</div><div class='del'>-</div><div class='del'>-  public IMavenProjectFacade getMavenProjectFacade() {</div><div class='del'>-    return mavenProjectFacade;</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  protected void addProblem(LifecycleMappingProblemInfo problem) {</div><div class='del'>-    problems.add(problem);</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  /**</div><div class='del'>-   * Adds new generic lifecycle mapping problem</div><div class='del'>-   */</div><div class='del'>-  public void addProblem(int line, String message) {</div><div class='del'>-    problems.add(new LifecycleMappingProblemInfo(line, message));</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public List&lt;LifecycleMappingProblemInfo&gt; getProblems() {</div><div class='del'>-    return problems;</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public boolean hasProblems() {</div><div class='del'>-    return !problems.isEmpty();</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public void setMavenProjectFacade(IMavenProjectFacade projectFacade) {</div><div class='del'>-    if(this.mavenProjectFacade != null) {</div><div class='del'>-      throw new IllegalStateException("Cannot change the maven project facade for a lifecycle mapping instance."); //$NON-NLS-1$</div><div class='del'>-    }</div><div class='del'>-    this.mavenProjectFacade = projectFacade;</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public abstract void initializeMapping(List&lt;MojoExecution&gt; mojoExecutions,</div><div class='del'>-      Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; executionMapping);</div><div class='add'>+  public abstract boolean hasLifecycleMappingChanged(IMavenProjectFacade oldFacade, IMavenProjectFacade newFacade, IProgressMonitor monitor);</div><div class='ctx'> </div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractProjectConfigurator.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractProjectConfigurator.java<br/>index 5a83dcf..b67f710 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractProjectConfigurator.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractProjectConfigurator.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractProjectConfigurator.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/AbstractProjectConfigurator.java</a></div><div class='hunk'>@@ -11,7 +11,11 @@</div><div class='ctx'> </div><div class='ctx'> package org.eclipse.m2e.core.project.configurator;</div><div class='ctx'> </div><div class='add'>+import java.util.ArrayList;</div><div class='add'>+import java.util.HashMap;</div><div class='ctx'> import java.util.LinkedHashSet;</div><div class='add'>+import java.util.List;</div><div class='add'>+import java.util.Map;</div><div class='ctx'> import java.util.Set;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.resources.IProject;</div><div class='hunk'>@@ -23,9 +27,15 @@ import org.eclipse.core.runtime.IProgressMonitor;</div><div class='ctx'> import org.eclipse.core.runtime.IStatus;</div><div class='ctx'> import org.eclipse.core.runtime.Status;</div><div class='ctx'> </div><div class='add'>+import org.codehaus.plexus.util.xml.Xpp3Dom;</div><div class='add'>+</div><div class='ctx'> import org.apache.maven.execution.MavenSession;</div><div class='add'>+import org.apache.maven.model.Build;</div><div class='add'>+import org.apache.maven.model.Model;</div><div class='add'>+import org.apache.maven.model.Plugin;</div><div class='ctx'> import org.apache.maven.model.PluginExecution;</div><div class='ctx'> import org.apache.maven.plugin.MojoExecution;</div><div class='add'>+import org.apache.maven.project.MavenProject;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.m2e.core.MavenPlugin;</div><div class='ctx'> import org.eclipse.m2e.core.core.IMavenConstants;</div><div class='hunk'>@@ -34,9 +44,13 @@ import org.eclipse.m2e.core.core.MavenLogger;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.IMaven;</div><div class='ctx'> import org.eclipse.m2e.core.embedder.IMavenConfiguration;</div><div class='ctx'> import org.eclipse.m2e.core.internal.Messages;</div><div class='del'>-import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionFilter;</div><div class='del'>-import org.eclipse.m2e.core.project.IMavenMarkerManager;</div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.LifecycleMappingFactory;</div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionAction;</div><div class='add'>+import org.eclipse.m2e.core.internal.lifecycle.model.PluginExecutionMetadata;</div><div class='add'>+import org.eclipse.m2e.core.internal.markers.IMavenMarkerManager;</div><div class='add'>+import org.eclipse.m2e.core.internal.project.registry.MavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.project.IMavenProjectChangedListener;</div><div class='add'>+import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenProjectChangedEvent;</div><div class='ctx'> import org.eclipse.m2e.core.project.MavenProjectManager;</div><div class='ctx'> </div><div class='hunk'>@@ -50,24 +64,14 @@ public abstract class AbstractProjectConfigurator implements IExecutableExtensio</div><div class='ctx'> </div><div class='ctx'>   public static final String ATTR_ID = "id"; //$NON-NLS-1$</div><div class='ctx'> </div><div class='del'>-  public static final String ATTR_PRIORITY = "priority"; //$NON-NLS-1$</div><div class='del'>-</div><div class='ctx'>   public static final String ATTR_NAME = "name"; //$NON-NLS-1$</div><div class='ctx'> </div><div class='ctx'>   public static final String ATTR_CLASS = "class"; //$NON-NLS-1$</div><div class='ctx'> </div><div class='del'>-  private int priority;</div><div class='del'>-</div><div class='ctx'>   private String id;</div><div class='ctx'> </div><div class='ctx'>   private String name;</div><div class='ctx'> </div><div class='del'>-  /**</div><div class='del'>-   * List of maven plugin goal patterns for which this project configurator is enabled automatically. Can be null, in</div><div class='del'>-   * which case the project configurator can only be enabled explicitly in pom.xml.</div><div class='del'>-   */</div><div class='del'>-  protected Set&lt;PluginExecutionFilter&gt; pluginExecutionFilters;</div><div class='del'>-</div><div class='ctx'>   protected MavenProjectManager projectManager;</div><div class='ctx'> </div><div class='ctx'>   protected IMavenConfiguration mavenConfiguration;</div><div class='hunk'>@@ -139,10 +143,6 @@ public abstract class AbstractProjectConfigurator implements IExecutableExtensio</div><div class='ctx'>     }</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public int getPriority() {</div><div class='del'>-    return priority;</div><div class='del'>-  }</div><div class='del'>-</div><div class='ctx'>   public String getId() {</div><div class='ctx'>     if(id == null) {</div><div class='ctx'>       id = getClass().getName();</div><div class='hunk'>@@ -158,28 +158,6 @@ public abstract class AbstractProjectConfigurator implements IExecutableExtensio</div><div class='ctx'>   public void setInitializationData(IConfigurationElement config, String propertyName, Object data) {</div><div class='ctx'>     this.id = config.getAttribute(ATTR_ID);</div><div class='ctx'>     this.name = config.getAttribute(ATTR_NAME);</div><div class='del'>-    String priorityString = config.getAttribute(ATTR_PRIORITY);</div><div class='del'>-    try {</div><div class='del'>-      priority = Integer.parseInt(priorityString);</div><div class='del'>-    } catch(Exception ex) {</div><div class='del'>-      priority = Integer.MAX_VALUE;</div><div class='del'>-    }</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  protected void addPluginExecutionFilter(String groupId, String artifactId, String versionRange, String goals) {</div><div class='del'>-    addPluginExecutionFilter(new PluginExecutionFilter(groupId, artifactId, versionRange, goals));</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public void addPluginExecutionFilter(PluginExecutionFilter filter) {</div><div class='del'>-    // TODO validate</div><div class='del'>-    if(pluginExecutionFilters == null) {</div><div class='del'>-      pluginExecutionFilters = new LinkedHashSet&lt;PluginExecutionFilter&gt;();</div><div class='del'>-    }</div><div class='del'>-    pluginExecutionFilters.add(filter);</div><div class='del'>-  }</div><div class='del'>-</div><div class='del'>-  public Set&lt;PluginExecutionFilter&gt; getPluginExecutionFilters() {</div><div class='del'>-    return pluginExecutionFilters;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='ctx'>   // TODO move to a helper</div><div class='hunk'>@@ -218,25 +196,14 @@ public abstract class AbstractProjectConfigurator implements IExecutableExtensio</div><div class='ctx'> </div><div class='ctx'>   @Override</div><div class='ctx'>   public String toString() {</div><div class='del'>-    return getId() + ":" + name + "(" + priority + ")"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$</div><div class='add'>+    return getId() + ":" + name; //$NON-NLS-1$</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public AbstractBuildParticipant getBuildParticipant(MojoExecution execution) {</div><div class='add'>+  public AbstractBuildParticipant getBuildParticipant(IMavenProjectFacade projectFacade, MojoExecution execution,</div><div class='add'>+      PluginExecutionMetadata executionMetadata) {</div><div class='ctx'>     return null;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public boolean isSupportedExecution(MojoExecution mojoExecution) {</div><div class='del'>-    if(pluginExecutionFilters == null) {</div><div class='del'>-      return false;</div><div class='del'>-    }</div><div class='del'>-    for(PluginExecutionFilter key : pluginExecutionFilters) {</div><div class='del'>-      if(key.match(mojoExecution)) {</div><div class='del'>-        return true;</div><div class='del'>-      }</div><div class='del'>-    }</div><div class='del'>-    return false;</div><div class='del'>-  }</div><div class='del'>-</div><div class='ctx'>   @Override</div><div class='ctx'>   public int hashCode() {</div><div class='ctx'>     final int prime = 31;</div><div class='hunk'>@@ -266,4 +233,82 @@ public abstract class AbstractProjectConfigurator implements IExecutableExtensio</div><div class='ctx'>     }</div><div class='ctx'>     return true;</div><div class='ctx'>   }</div><div class='add'>+</div><div class='add'>+  /**</div><div class='add'>+   * Returns list of MojoExecutions this configurator is enabled for.</div><div class='add'>+   */</div><div class='add'>+  protected List&lt;MojoExecution&gt; getMojoExecutions(ProjectConfigurationRequest request, IProgressMonitor monitor)</div><div class='add'>+      throws CoreException {</div><div class='add'>+    IMavenProjectFacade projectFacade = request.getMavenProjectFacade();</div><div class='add'>+</div><div class='add'>+    Map&lt;String, Set&lt;MojoExecutionKey&gt;&gt; configuratorExecutions = getConfiguratorExecutions(projectFacade);</div><div class='add'>+</div><div class='add'>+    ArrayList&lt;MojoExecution&gt; executions = new ArrayList&lt;MojoExecution&gt;();</div><div class='add'>+</div><div class='add'>+    Set&lt;MojoExecutionKey&gt; executionKeys = configuratorExecutions.get(id);</div><div class='add'>+    if(executionKeys != null) {</div><div class='add'>+      for(MojoExecutionKey key : executionKeys) {</div><div class='add'>+        executions.add(projectFacade.getMojoExecution(key, monitor));</div><div class='add'>+      }</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+    return executions;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  private Map&lt;String, Set&lt;MojoExecutionKey&gt;&gt; getConfiguratorExecutions(IMavenProjectFacade projectFacade) {</div><div class='add'>+    Map&lt;String, Set&lt;MojoExecutionKey&gt;&gt; configuratorExecutions = new HashMap&lt;String, Set&lt;MojoExecutionKey&gt;&gt;();</div><div class='add'>+    Map&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; executionMapping = projectFacade.getMojoExecutionMapping();</div><div class='add'>+    for(Map.Entry&lt;MojoExecutionKey, List&lt;PluginExecutionMetadata&gt;&gt; entry : executionMapping.entrySet()) {</div><div class='add'>+      List&lt;PluginExecutionMetadata&gt; metadatas = entry.getValue();</div><div class='add'>+      if(metadatas != null) {</div><div class='add'>+        for(PluginExecutionMetadata metadata : metadatas) {</div><div class='add'>+          if(metadata.getAction() == PluginExecutionAction.configurator) {</div><div class='add'>+            String configuratorId = LifecycleMappingFactory.getProjectConfiguratorId(metadata);</div><div class='add'>+            if(configuratorId != null) {</div><div class='add'>+              Set&lt;MojoExecutionKey&gt; executions = configuratorExecutions.get(configuratorId);</div><div class='add'>+              if(executions == null) {</div><div class='add'>+                executions = new LinkedHashSet&lt;MojoExecutionKey&gt;();</div><div class='add'>+                configuratorExecutions.put(configuratorId, executions);</div><div class='add'>+              }</div><div class='add'>+              executions.add(entry.getKey());</div><div class='add'>+            }</div><div class='add'>+          }</div><div class='add'>+        }</div><div class='add'>+      }</div><div class='add'>+    }</div><div class='add'>+    return configuratorExecutions;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  /**</div><div class='add'>+   * Returns true if project configuration has changed and running</div><div class='add'>+   * {@link #configure(ProjectConfigurationRequest, IProgressMonitor)} is required. Default implementation uses</div><div class='add'>+   * {@link Xpp3Dom#equals(Object)} to compare before/after mojo configuration.</div><div class='add'>+   */</div><div class='add'>+  public boolean hasConfigurationChanged(IMavenProjectFacade oldFacade, IMavenProjectFacade newFacade,</div><div class='add'>+      MojoExecutionKey key, IProgressMonitor monitor) {</div><div class='add'>+</div><div class='add'>+    Xpp3Dom oldConfiguration = getMojoExecutionConfiguration((MavenProjectFacade) oldFacade, key, monitor);</div><div class='add'>+    Xpp3Dom configuration = getMojoExecutionConfiguration((MavenProjectFacade) newFacade, key, monitor);</div><div class='add'>+</div><div class='add'>+    return configuration != null ? !configuration.equals(oldConfiguration) : oldConfiguration != null;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  private static Xpp3Dom getMojoExecutionConfiguration(MavenProjectFacade facade, MojoExecutionKey key,</div><div class='add'>+      IProgressMonitor monitor) {</div><div class='add'>+    MavenProject mavenProject = facade.getMavenProject();</div><div class='add'>+    Model model = mavenProject.getModel();</div><div class='add'>+    Build build = model.getBuild();</div><div class='add'>+    if(build == null) {</div><div class='add'>+      return null;</div><div class='add'>+    }</div><div class='add'>+    Plugin plugin = build.getPluginsAsMap().get(Plugin.constructKey(key.getGroupId(), key.getArtifactId()));</div><div class='add'>+    if(plugin == null) {</div><div class='add'>+      return null;</div><div class='add'>+    }</div><div class='add'>+    PluginExecution execution = plugin.getExecutionsAsMap().get(key.getExecutionId());</div><div class='add'>+    if(execution == null || !execution.getGoals().contains(key.getGoal())) {</div><div class='add'>+      return null;</div><div class='add'>+    }</div><div class='add'>+    return (Xpp3Dom) execution.getConfiguration();</div><div class='add'>+  }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ILifecycleMapping.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ILifecycleMapping.java<br/>index b3404e1..cd330a7 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ILifecycleMapping.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ILifecycleMapping.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ILifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/ILifecycleMapping.java</a></div><div class='hunk'>@@ -17,9 +17,12 @@ import java.util.Map;</div><div class='ctx'> import org.eclipse.core.runtime.CoreException;</div><div class='ctx'> import org.eclipse.core.runtime.IProgressMonitor;</div><div class='ctx'> </div><div class='add'>+import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='add'>+</div><div class='add'>+</div><div class='ctx'> /**</div><div class='ctx'>  * LifecycleMapping</div><div class='del'>- *</div><div class='add'>+ * </div><div class='ctx'>  * @author igor</div><div class='ctx'>  * @noimplement subclass AbstractLifecycleMapping instead</div><div class='ctx'>  */</div><div class='hunk'>@@ -27,14 +30,15 @@ public interface ILifecycleMapping {</div><div class='ctx'>   String getId();</div><div class='ctx'> </div><div class='ctx'>   String getName();</div><div class='del'>-  </div><div class='add'>+</div><div class='ctx'>   /**</div><div class='ctx'>    * Configure Eclipse workspace project according to Maven build project configuration.</div><div class='ctx'>    */</div><div class='ctx'>   void configure(ProjectConfigurationRequest request, IProgressMonitor monitor) throws CoreException;</div><div class='ctx'> </div><div class='ctx'>   /**</div><div class='del'>-   * Undo any Eclipse project configuration done during previous call(s) to {@link #configure(ProjectConfigurationRequest, IProgressMonitor)}</div><div class='add'>+   * Undo any Eclipse project configuration done during previous call(s) to</div><div class='add'>+   * {@link #configure(ProjectConfigurationRequest, IProgressMonitor)}</div><div class='ctx'>    */</div><div class='ctx'>   void unconfigure(ProjectConfigurationRequest request, IProgressMonitor monitor) throws CoreException;</div><div class='ctx'> </div><div class='hunk'>@@ -42,14 +46,11 @@ public interface ILifecycleMapping {</div><div class='ctx'>    * Returns map of AbstractBuildParticipants by MojoExecutionKey that need to be executed during Eclipse workspace</div><div class='ctx'>    * build. Map can be empty but cannot be null.</div><div class='ctx'>    */</div><div class='del'>-  Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; getBuildParticipants(IProgressMonitor monitor)</div><div class='del'>-      throws CoreException;</div><div class='add'>+  Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; getBuildParticipants(IMavenProjectFacade project,</div><div class='add'>+      IProgressMonitor monitor) throws CoreException;</div><div class='ctx'> </div><div class='ctx'>   //TODO Return Set instead of List</div><div class='del'>-  List&lt;AbstractProjectConfigurator&gt; getProjectConfigurators(IProgressMonitor monitor) throws CoreException;</div><div class='del'>-</div><div class='del'>-  List&lt;MojoExecutionKey&gt; getNotCoveredMojoExecutions(IProgressMonitor monitor)</div><div class='add'>+  List&lt;AbstractProjectConfigurator&gt; getProjectConfigurators(IMavenProjectFacade project, IProgressMonitor monitor)</div><div class='ctx'>       throws CoreException;</div><div class='ctx'> </div><div class='del'>-  boolean isInterestingPhase(String phase);</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MojoExecutionKey.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MojoExecutionKey.java<br/>index 2f3ff48..df8a540 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MojoExecutionKey.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MojoExecutionKey.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MojoExecutionKey.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/MojoExecutionKey.java</a></div><div class='hunk'>@@ -11,10 +11,14 @@</div><div class='ctx'> </div><div class='ctx'> package org.eclipse.m2e.core.project.configurator;</div><div class='ctx'> </div><div class='add'>+import java.io.Serializable;</div><div class='add'>+</div><div class='ctx'> import org.apache.maven.plugin.MojoExecution;</div><div class='ctx'> </div><div class='ctx'> </div><div class='del'>-public class MojoExecutionKey {</div><div class='add'>+public class MojoExecutionKey implements Serializable {</div><div class='add'>+</div><div class='add'>+  private static final long serialVersionUID = -2074582830199438890L;</div><div class='ctx'> </div><div class='ctx'>   private final String groupId;</div><div class='ctx'> </div><div class='hunk'>@@ -94,4 +98,10 @@ public class MojoExecutionKey {</div><div class='ctx'>     return groupId + ":" + artifactId + ":" + version + ":" + goal + " (execution: " + executionId + ", phase: "</div><div class='ctx'>         + lifecyclePhase + ")";</div><div class='ctx'>   }</div><div class='add'>+</div><div class='add'>+  public boolean match(MojoExecution mojoExecution) {</div><div class='add'>+    return groupId.equals(mojoExecution.getGroupId()) &amp;&amp; artifactId.equals(mojoExecution.getArtifactId())</div><div class='add'>+        &amp;&amp; version.equals(mojoExecution.getVersion()) &amp;&amp; goal.equals(mojoExecution.getGoal())</div><div class='add'>+        &amp;&amp; executionId.equals(mojoExecution.getExecutionId());</div><div class='add'>+  }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/NoopLifecycleMapping.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/NoopLifecycleMapping.java<br/>index d87e059..d2a84e9 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/NoopLifecycleMapping.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/NoopLifecycleMapping.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/NoopLifecycleMapping.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/project/configurator/NoopLifecycleMapping.java</a></div><div class='hunk'>@@ -17,13 +17,16 @@ import java.util.Map;</div><div class='ctx'> </div><div class='ctx'> import org.eclipse.core.runtime.IProgressMonitor;</div><div class='ctx'> </div><div class='add'>+import org.eclipse.m2e.core.internal.markers.MavenProblemInfo;</div><div class='add'>+import org.eclipse.m2e.core.project.IMavenProjectFacade;</div><div class='add'>+</div><div class='ctx'> </div><div class='ctx'> /**</div><div class='ctx'>  * NoopLifecycleMapping</div><div class='ctx'>  * </div><div class='ctx'>  * @author igor</div><div class='ctx'>  */</div><div class='del'>-public class NoopLifecycleMapping implements ILifecycleMapping {</div><div class='add'>+public class NoopLifecycleMapping extends AbstractLifecycleMapping {</div><div class='ctx'> </div><div class='ctx'>   public String getId() {</div><div class='ctx'>     return "noop";</div><div class='hunk'>@@ -39,11 +42,11 @@ public class NoopLifecycleMapping implements ILifecycleMapping {</div><div class='ctx'>   public void unconfigure(ProjectConfigurationRequest request, IProgressMonitor monitor) {</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public List&lt;AbstractProjectConfigurator&gt; getProjectConfigurators(IProgressMonitor monitor) {</div><div class='add'>+  public List&lt;AbstractProjectConfigurator&gt; getProjectConfigurators(IMavenProjectFacade project, IProgressMonitor monitor) {</div><div class='ctx'>     return Collections.emptyList();</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public List&lt;MojoExecutionKey&gt; getNotCoveredMojoExecutions(IProgressMonitor monitor) {</div><div class='add'>+  public List&lt;MojoExecutionKey&gt; getNotCoveredMojoExecutions(IMavenProjectFacade project, IProgressMonitor monitor) {</div><div class='ctx'>     return Collections.emptyList();</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='hunk'>@@ -51,7 +54,17 @@ public class NoopLifecycleMapping implements ILifecycleMapping {</div><div class='ctx'>     return false;</div><div class='ctx'>   }</div><div class='ctx'> </div><div class='del'>-  public Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; getBuildParticipants(IProgressMonitor monitor) {</div><div class='add'>+  public Map&lt;MojoExecutionKey, List&lt;AbstractBuildParticipant&gt;&gt; getBuildParticipants(IMavenProjectFacade project,</div><div class='add'>+      IProgressMonitor monitor) {</div><div class='ctx'>     return Collections.emptyMap();</div><div class='ctx'>   }</div><div class='add'>+</div><div class='add'>+  public boolean hasLifecycleMappingChanged(IMavenProjectFacade oldFacade, IMavenProjectFacade newFacade,</div><div class='add'>+      IProgressMonitor monitor) {</div><div class='add'>+    return false;</div><div class='add'>+  }</div><div class='add'>+</div><div class='add'>+  public List&lt;MavenProblemInfo&gt; validateLifecycleMapping(IMavenProjectFacade mavenProjectFacade) {</div><div class='add'>+    return Collections.emptyList();</div><div class='add'>+  }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/dialogs/EditDependencyDialog.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/dialogs/EditDependencyDialog.java<br/>index 4baaaf4..5838ae9 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/dialogs/EditDependencyDialog.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/dialogs/EditDependencyDialog.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/dialogs/EditDependencyDialog.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/dialogs/EditDependencyDialog.java</a></div><div class='hunk'>@@ -9,6 +9,7 @@</div><div class='ctx'> package org.eclipse.m2e.core.ui.dialogs;</div><div class='ctx'> </div><div class='ctx'> import static org.eclipse.m2e.core.util.Util.nvl;</div><div class='add'>+</div><div class='ctx'> import org.eclipse.core.resources.IProject;</div><div class='ctx'> import org.eclipse.emf.common.command.Command;</div><div class='ctx'> import org.eclipse.emf.common.command.CompoundCommand;</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/LifecycleMappingPropertyPageFactory.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/LifecycleMappingPropertyPageFactory.java<br/>index 2be8b93..09966e9 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/LifecycleMappingPropertyPageFactory.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/LifecycleMappingPropertyPageFactory.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/LifecycleMappingPropertyPageFactory.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/LifecycleMappingPropertyPageFactory.java</a></div><div class='hunk'>@@ -137,7 +137,7 @@ public class LifecycleMappingPropertyPageFactory {</div><div class='ctx'>     IMavenProjectFacade facade = getProjectFacade(project);</div><div class='ctx'>     ILifecycleMapping lifecycleMapping = null;</div><div class='ctx'>     IProjectConfigurationManager configurationManager = MavenPlugin.getDefault().getProjectConfigurationManager();</div><div class='del'>-    lifecycleMapping = configurationManager.getLifecycleMapping(facade, new NullProgressMonitor());</div><div class='add'>+    lifecycleMapping = configurationManager.getLifecycleMapping(facade);</div><div class='ctx'>     return lifecycleMapping;</div><div class='ctx'>   }</div><div class='ctx'> }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/ProjectConfiguratorsTable.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/ProjectConfiguratorsTable.java<br/>index 50d100b..20dfaf2 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/ProjectConfiguratorsTable.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/ProjectConfiguratorsTable.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/ProjectConfiguratorsTable.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/lifecycle/ProjectConfiguratorsTable.java</a></div><div class='hunk'>@@ -11,11 +11,8 @@</div><div class='ctx'> </div><div class='ctx'> package org.eclipse.m2e.core.ui.internal.lifecycle;</div><div class='ctx'> </div><div class='del'>-import java.util.List;</div><div class='del'>-</div><div class='ctx'> import org.eclipse.core.resources.IProject;</div><div class='ctx'> import org.eclipse.core.runtime.CoreException;</div><div class='del'>-import org.eclipse.core.runtime.NullProgressMonitor;</div><div class='ctx'> import org.eclipse.jface.viewers.TableViewer;</div><div class='ctx'> import org.eclipse.jface.viewers.TableViewerColumn;</div><div class='ctx'> import org.eclipse.swt.SWT;</div><div class='hunk'>@@ -55,9 +52,9 @@ public class ProjectConfiguratorsTable {</div><div class='ctx'>       try{</div><div class='ctx'>         ILifecycleMapping lifecycleMapping = LifecycleMappingPropertyPageFactory.getLifecycleMapping(project);</div><div class='ctx'>         if(lifecycleMapping != null) {</div><div class='del'>-          List&lt;AbstractProjectConfigurator&gt; projectConfigurators = lifecycleMapping</div><div class='del'>-              .getProjectConfigurators(new NullProgressMonitor());</div><div class='del'>-          setProjectConfigurators(projectConfigurators.toArray(new AbstractProjectConfigurator[] {}));</div><div class='add'>+//          List&lt;AbstractProjectConfigurator&gt; projectConfigurators = lifecycleMapping</div><div class='add'>+//              .getProjectConfigurators(new NullProgressMonitor());</div><div class='add'>+//          setProjectConfigurators(projectConfigurators.toArray(new AbstractProjectConfigurator[] {}));</div><div class='ctx'>         } else {</div><div class='ctx'>           setProjectConfigurators(new AbstractProjectConfigurator[] {});</div><div class='ctx'>         }</div><div class='head'>diff --git a/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/preferences/MavenProjectPreferencePage.java b/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/preferences/MavenProjectPreferencePage.java<br/>index b6078c3..9c89659 100644<br/>--- a/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/preferences/MavenProjectPreferencePage.java?id=ebb733d48dac3806b45ae8e350543c587665096d'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/preferences/MavenProjectPreferencePage.java</a><br/>+++ b/<a href='/c/m2e/m2e-core.git/tree/org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/preferences/MavenProjectPreferencePage.java?id=68443fde8e72144d925de3c36200d4e4247ac94c'>org.eclipse.m2e.core/src/org/eclipse/m2e/core/ui/internal/preferences/MavenProjectPreferencePage.java</a></div><div class='hunk'>@@ -138,7 +138,7 @@ public class MavenProjectPreferencePage extends PropertyPage {</div><div class='ctx'>           WorkspaceJob job = new WorkspaceJob(NLS.bind(Messages.MavenProjectPreferencePage_job, project.getName() )) {</div><div class='ctx'>             public IStatus runInWorkspace(IProgressMonitor monitor) {</div><div class='ctx'>               try {</div><div class='del'>-                plugin.getProjectConfigurationManager().updateProjectConfiguration(project, configuration, monitor);</div><div class='add'>+                plugin.getProjectConfigurationManager().updateProjectConfiguration(project, monitor);</div><div class='ctx'>               } catch(CoreException ex) {</div><div class='ctx'>                 return ex.getStatus();</div><div class='ctx'>               }</div></td></tr></table></div> <!-- class=content -->
</div><br style="clear:both;height:1em;"/>&nbsp;</div><div id="clearFooter"></div><div id="footer"><ul id="footernav"><li><a href="http://www.eclipse.org/">Eclipse Home</a></li><li><a href="http://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li><li><a href="http://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li><li><a href="http://www.eclipse.org/legal/">Legal</a></li><li><a href="http://www.eclipse.org/org/foundation/contact.php">Contact Us</a></li></ul><span id="copyright">Copyright &copy; 2009-2010 The Eclipse Foundation. All Rights Reserved.</span></div></div>	

</div> <!-- id=cgit -->
</body>
</html>
