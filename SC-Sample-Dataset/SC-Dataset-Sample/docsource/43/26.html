<!DOCTYPE html>
<!--[if lt IE 9 ]>
<html class="ltie9" lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:nitro="http://www.bunchball.com/nitro">
<![endif]-->
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:nitro="http://www.bunchball.com/nitro">
<head>
	<script type="text/javascript" src="/javascript/error_logging.js">

	</script>
				<base href="http://www.coursehero.com/">		
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		
	
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,300,600,700" rel="stylesheet" type="text/css"/>
			<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width"/>
			

		
	
			<script src="/javascript/jquery-1.7.2.min.js"></script>
			
	
		
	
	<script>
		jQuery(document).ready(function(){
			var ua = navigator.userAgent.toLowerCase();
			var isAndroid = ua.indexOf("android") > -1;
			if(isAndroid) {
				jQuery('#ch-primary-navigation-list-container li').doubleTapToGo();
			}
		})
	</script>

	<!--[if IE 8]>
		<script type="text/javascript" src="/javascript/selectivizr-min.js">
		</script>
	<![endif]-->
		
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
	
	
            <title>Iowa State : CPRE 556 : 2006 07</title>
    

<link rel="stylesheet" href="/min/?f=/css/v2/ch-master-style.css,/css/v2/header-v4.css,/css/v2/jquery-styles/jquery.ui.css,/css/v2/study-documents/ch-document-thumbnail.css,/css/v2/study-documents/ch-doc-landing.css,/css/v2/ch-universal-widgets.css" type="text/css" media="screen" charset="utf-8">
<script src="/min/?f=/javascript/tracker_pageview.js,/javascript/error_logging.js,/javascript/header.js,/javascript/ajax_load.js,/javascript/doubletaptogo.min.js" type="text/javascript" charset="utf-8"></script>
</head>


<body class="">
<div>

<script type="text/javascript">
	var __basic = false;
	appId = 126130834105126;
</script>

<script>

  // Load the SDK's source Asynchronously
  // Note that the debug version is being actively developed and might 
  // contain some type checks that are overly strict. 
  // Please report such bugs using the bugs tool.
  (function(d, debug){
	 var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
	 if (d.getElementById(id)) {return;}
	 js = d.createElement('script'); js.id = id; js.async = true;
	 js.src = "//connect.facebook.net/en_US/all" + (debug ? ("/" + "debug") : "") + ".js";
	 ref.parentNode.insertBefore(js, ref);
   }(document, /*debug*/ false));
  
</script>


						<div id="ch-primary-navigation-wrapper" class="ch-wrapper">
	<div class="container">
		<div id="ch-brand-navigation">
			<a href="/?no_redir=1"><img src="/img/CourseHero_Logo_white.png" alt="Course Hero"/></a>
		</div>
		<div id="ch-primary-navigation-container">
			<ul id="ch-primary-navigation-list-container">
				<li><a href="/study-materials/">Schools</a></li>
				<li><a href="/subjects/">Subjects</a></li>
				<li><a href="/standardized-tests/">Standardized Tests</a></li>
				<li><a href="/contact.php">Support</a></li>
									<li class="ch-user-navigation" id="ch-user-signup">
													<a class="ch-nav-sign-up-action" href="/registerForm.php" rel="nofollow">Sign up</a>
											</li>
					<li class="ch-user-navigation">
													<a href="/login.php" rel="nofollow">Log-in</a>
											</li>
							</ul>
		</div>
		<div id="ch-primary-navigation-container-for-mobile">
			<a href=""  onClick="return false;" class="ch-primary-show-mobile-nav"><i class="icon-th-list"></i></a>
			<ul id="ch-primary-navigation-list-container-for-mobile">
																								<li>
							<a href="" class="ch-product-navigation-single-link">Explore</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/study-materials/" class="ch-product-sub-navigation-link">Schools</a></li>
										
																																							<li><a href="/subjects/" class="ch-product-sub-navigation-link">Subjects</a></li>
										
																																							<li><a href="/standardized-tests/" class="ch-product-sub-navigation-link">Standardized Tests</a></li>
										
																											</ul>
													</li>
																				<li>
							<a href="/study-materials/" class="ch-product-navigation-single-link">Study Documents</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/study-materials/" class="ch-product-sub-navigation-link">Find Documents</a></li>
										
																																							<li><a href="/my_documents.php" class="ch-product-sub-navigation-link">My Documents</a></li>
										
																																							<li><a href="/textbooks/" class="ch-product-sub-navigation-link">Textbook Help</a></li>
										
																																							<li><a href="/uploads.php" class="ch-product-sub-navigation-link">Upload Documents</a></li>
										
																											</ul>
													</li>
																				<li>
							<a href="/tutors/" class="ch-product-navigation-single-link">Tutors</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/qa_ask_question.php" class="ch-product-sub-navigation-link">Ask a Question</a></li>
										
																																							<li><a href="/qa_my_questions.php" class="ch-product-sub-navigation-link">My Questions</a></li>
										
																																																																													<li><a href="/qa/about_tutors.php" class="ch-product-sub-navigation-link">About Tutors</a></li>
										
																											</ul>
													</li>
																				<li>
							<a href="/flashcards/dashboard.php" class="ch-product-navigation-single-link">Flashcards</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/flashcards/dashboard.php" class="ch-product-sub-navigation-link">My Flashcards</a></li>
										
																																							<li><a href="/flashcards/browse/" class="ch-product-sub-navigation-link">Find Flashcards</a></li>
										
																																							<li><a href="/flashcards/create.php" class="ch-product-sub-navigation-link">Create Flashcards</a></li>
										
																																							<li><a href="/flashcards/" class="ch-product-sub-navigation-link">About Flashcards</a></li>
										
																											</ul>
													</li>
																				<li>
							<a href="/courses/" class="ch-product-navigation-single-link">eCourses</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/courses/" class="ch-product-sub-navigation-link">Find eCourses</a></li>
										
																																							<li><a href="/courses/my_courses.php" class="ch-product-sub-navigation-link">My eCourses</a></li>
										
																																							<li><a href="/courses/my_editable_courses.php" class="ch-product-sub-navigation-link">Create/Edit an eCourse</a></li>
										
																																							<li><a href="/courses/about.php" class="ch-product-sub-navigation-link">About eCourses</a></li>
										
																											</ul>
													</li>
																				<li>
							<a href="/contact.php" class="ch-product-navigation-single-link">Support</a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/contact.php" class="ch-product-sub-navigation-link">Contact Us</a></li>
										
																																							<li><a href="/faq.php" class="ch-product-sub-navigation-link">FAQ</a></li>
										
																											</ul>
													</li>
																		<li>
													<a class="ch-nav-sign-up-action" href="/registerForm.php" rel="nofollow">Sign up</a>
											</li>
					<li>
													<a href="/login.php" rel="nofollow">Log-in</a>
											</li>
							</ul>
		</div>
		<div id="ch-primary-mobile-search-container">
			<a href="/study-materials/"  class="ch-primary-show-mobile-search"><i class="icon-search"></i></a>
		</div>
	</div>
</div>
	<div id="ch-primary-navigation-search-wrapper" class="ch-wrapper">
	<div class="container">
		<div id="ch-explore-products-navigation">
			<ul>
																								<li class="">
							<a href="/study-materials/" class="ch-product-navigation-single-link">Study Documents <i class="icon-down-open"></i></a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/study-materials/" class="ch-product-sub-navigation-link">Find Documents</a></li>
										
																																																										<li><a href="/textbooks/" class="ch-product-sub-navigation-link">Textbook Help</a></li>
										
																																							<li><a href="/uploads.php" class="ch-product-sub-navigation-link">Upload Documents</a></li>
										
																											</ul>
													</li>
																				<li class="">
							<a href="/tutors/" class="ch-product-navigation-single-link">Tutors <i class="icon-down-open"></i></a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/qa_ask_question.php" class="ch-product-sub-navigation-link">Ask a Question</a></li>
										
																																																																													<li><a href="/qa/expert/landing.php" class="ch-product-sub-navigation-link">Become a Tutor</a></li>
										
																																							<li><a href="/qa/about_tutors.php" class="ch-product-sub-navigation-link">About Tutors</a></li>
										
																											</ul>
													</li>
																				<li class="">
							<a href="/flashcards/" class="ch-product-navigation-single-link">Flashcards <i class="icon-down-open"></i></a>
															
								<ul class="ch-primary-sub-navigation">
																																																<li><a href="/flashcards/browse/" class="ch-product-sub-navigation-link">Find Flashcards</a></li>
										
																																							<li><a href="/flashcards/create.php" class="ch-product-sub-navigation-link">Create Flashcards</a></li>
										
																																							<li><a href="/flashcards/" class="ch-product-sub-navigation-link">About Flashcards</a></li>
										
																											</ul>
													</li>
																				<li class="">
							<a href="/courses/" class="ch-product-navigation-single-link">eCourses <i class="icon-down-open"></i></a>
															
								<ul class="ch-primary-sub-navigation">
																													<li><a href="/courses/" class="ch-product-sub-navigation-link">Find eCourses</a></li>
										
																																																										<li><a href="/courses/my_editable_courses.php" class="ch-product-sub-navigation-link">Create/Edit an eCourse</a></li>
										
																																							<li><a href="/courses/about.php" class="ch-product-sub-navigation-link">About eCourses</a></li>
										
																											</ul>
													</li>
												</ul>
		</div>
                    <div id="ch-primary-navigation-search-container">
                <form id="global-search" action="/search_result.php" method="POST">
                    <fieldset>
                        <input type="hidden" name='header' value="v2"/>
                        <input type="hidden" name='filters_product' value="documents"/>
                        <input type="text" id="stx_global" name="stx" placeholder="Search Course Hero"/>
                        <a href="#" id="ch-primary-navigation-search-btn">Search</a>
                    </fieldset>
                </form>
            </div>
        	</div>
</div>
<script>
	jQuery(document).ready(function(){
		jQuery("#stx_global").keypress(function(event) {
			if ( event.which == 13 ) {
				event.preventDefault();
				jQuery('#global-search').submit();
			}
		});
		jQuery("#ch-primary-navigation-search-btn").click(function(){
			jQuery('#global-search').submit();
			return false;
		})
	});
</script>

				

<div class="ch-wrapper" id="ch-content-wrapper">
	<div id="doc-landing-banner" class="ch-banner light-blue-bg">
		<div class="container">
			<div class="page-heading-wrapper">
				<h1 class="intro-page-heading">
					Register now to access <span class="txt-green">7 million</span> high quality study materials
				</h1>
				<a class="whats-coursehero-tooltip">(What's Course Hero?)
					<span>
					Course Hero is the premier provider of high quality online educational resources. With millions of study documents, online tutors, digital flashcards and free courseware, Course Hero is helping students learn more efficiently and effectively. Whether you're interested in exploring new subjects or mastering key topics for your next exam, Course Hero has the tools you need to achieve your goals.
					</span>
				</a>
			</div>
			<div id="doc-landing-about-document-container" temprop="mainContentOfPage" itemscope itemtype="http://schema.org/CreativeWork">
				<div class="ch-doc-image-thumbnail">
					<div class="ch-doc-image-thumbnail-view">
												<img itemprop="image" id="doc-image" src="/thumb/b8f510dec43f366c196ae2bf0e545925ad9311f9_180.jpg" onerror="image_error_backup(this, '/view_thumbnail.php?filehash=b8f510dec43f366c196ae2bf0e545925ad9311f9&size=180')" alt="2006-07"/>
											</div>
										<div class="ch-doc-pageno">273 Pages</div>
									</div>
				<div class="ch-doc-summary">
					<h4 itemprop="name">							2006-07
											</h4>
																		<p><strong>Course: </strong>CPRE 556, Spring 2012</p>
												<p><strong>School: </strong>Iowa State</p>
																<p><strong>Word Count: </strong> 59202</p>
										<p><strong>Rating: </strong> <span id="doc-rating" data-score="5"></span></p>
				</div>
				<div id="ch-doc-text-preview">
					<h6>Document Preview</h6>
					<div class="ch-doc-preview-contents">
																				<p>entries Duplicate on the corba typeMapping.
There are duplicate entries in the corba type mapping.
Corba Binding too strict with address formats
The binding has too strict an assumption with the way addresses are specified in a WSDL file. The binding assumes that address starting with file will be in the format 'file:/'. This prevents the use of addresses such as 'file:./addressref.ior', which is a valid...</p>
																		</div>
					<div class="coa-wrapper">
						<a href="/registerForm.php?reg_only=1" class="orange-btn l registerForm-link" id="ch-register-link">Register Now</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container" id="doc-landing-container">
<div class="search-bar light-blue-bg studydocs-body-search-widget">
	<form id="search-form" action="/search_result.php" method="GET">
		<fieldset>
			<input type="hidden" id="je" name="je" value="0">
			<input type="hidden" id="autocomp" name="autocomp" value="0">
			<input type="hidden" id="fromqa" name="fromqa" value="1">
			<input type="text" class="search-bar-input" id="stx" name="stx" placeholder="Search by department, course, subject or keyword. Or ask a question" maxlength="500" />
			<a href="#" class="blue-btn search_bar_widget_submit"><i class="icon-search"></i><span>Search</span></a>
		</fieldset>
	</form>
</div>
<script type="text/javascript">
    jQuery(".search_bar_widget_submit").click(function(e){
        jQuery(this).parent().parent().submit();
        e.preventDefault();
        return false;
    });
</script>
        <div id="most_popular_materials_from_subject" class="ajax_load" data-params="school_type=HIGHER&school_name=Iowa State&dept_acro=CPRE&course_num=556&db_filename=7204790"></div>
        <div id="what_course_hero_offers" class="ajax_load"></div>
        <div id="qa_ask_question_widget" class="ajax_load" data-params="heading_inside=<strong>Cannot find the right document?</strong> Our tutors are available 24/7 to answer your questions."></div>
        <div id="horizontal_register_now" class="ajax_load"></div>
		<div class="doc-landing-doc-excerpt light-grey-bg">
			<h5>Unformatted Document Excerpt</h5>
							<a href="/">Coursehero</a> >> <a href="/sitemap/states/Iowa/">Iowa</a> >>
				<a href="/sitemap/schools/864-Iowa-State/">Iowa State</a> >>
				<a href="/sitemap/schools/864-Iowa-State/departments/2012-CPRE/">CPRE 556</a>
						<p>Course Hero has millions of student submitted documents similar to the one<br/>below including study guides, practice problems, reference materials, practice exams, textbook help and tutor support.</p>
			<p>Course Hero has millions of student submitted documents similar to the one below including study guides, practice problems, reference materials, practice exams, textbook help and tutor support.</p>
			<div title="Sign up now to view the formatted text.">
								<span itemprop="text">
											entries Duplicate on the corba typeMapping.
There are duplicate entries in the corba type mapping.
Corba Binding too strict with address formats
The binding has too strict an assumption with the way addresses are specified in a WSDL file. The binding assumes that address starting with file will be in the format 'file:/'. This prevents the use of addresses such as 'file:./addressref.ior', which is a valid address. This also applies to address that start with 'relfile:/'
Yoko core package needs to be Java 1.4.2 compatible.
All of Yoko is being built using Java 5 as the target compile version, which makes it incompatible with applications that support Java 1.4.2 (i.e., Geronimo). At least the core package needs to be built using a 1.4 target version. 
Also, for the convenience of applications that are still using Maven 1 (again, Geronimo is a good example), the build artifacts should be published to the Maven 1 repository also.
RMI module fails to build because of its dependency on the yoko-spec-corba module.
It looks like the module yoko-spec-corba has not be defined in the top-level pom &amp; the rmi module depends on the yoko-spec-corba module...
Also, the repository for pulling in the idlj-maven-plugin is not defined in the pom...
Fix CORBA UserException handling on Yoko Runtime Binding Client Side
When a CORBA UserException is returned in the DII request on the Client side, it needs be handled in such a way so that we can return the appropriate Yoko exception (i.e. defined in WSDL). Right now, the binding simply returns the UnknownUserException that wraps the actual exception. The difficulty in this is that we do not have access to the CORBA helpers that would normally convert the Any representation of the Exception into the correct Object on the client side. We also can't use the Stax readers for unmarshalling the exception since these only work for parameters and return values.
Changes to move parent POM resulting in build failures.
The recent changes to move dependencies into the parent POM is resulting in build failures because of mismatches in version identifiers in the parent and module. The cause is the use of the variable ${yoko.version} before it is defined.
Versions of dependencies should be managed in the parent POM
The versions of dependencies should be managed in the parent pom. This can be done using the &lt;dependencyManagement&gt; section of the POM.
This should make it easier to change the versions of external dependencies, as well as Yoko itself. Furthermore, it ensures that we use the same versions across all sub-projects.
Binding test failure on CorbaStreamable test
The test receives an Assertion failure when trying to read a Character object from a CorbaStreamable.
Incorrect version number in o.a.y.orb.OB.Version
Current output is &quot;Yoko for Java 4.3.1 [GA release]&quot;. 
The output should reflect the version number in the pom. One technique to find the version is described in http://mail-archives.apache.org/mod_mbox/maven-users/200605.mbox/%3cPine.LNX.4.58.0605230810500.23030@fire.homenet.neonics.com%3e
A numerical version number (4030100) is also in the Version class, it is sent as a ServiceContext. Not sure how to generate such numbers from the pom version which might include additional textual info like &quot;SNAPSHOT&quot; or &quot;Incubator&quot;. I can't see any uses for sending the version Context, except logging the version of the communication partner. Maybe this functionality should be removed completely?
&lt;corba:return ...&gt; is generated instead of &lt;corba:param mode=&quot;out&quot; ...&gt;
The out parameter is not properly mapped to a &lt;corba:param mode=&quot;out&quot;&gt; but instead it is mapped to a &lt;corba:return ...&gt;.
This should happen only when the method has a return and not a out parameter.
i.e. The following IDL operation
void getShort (out short outShort);
get bound to the following WSDL:
&lt;corba:binding ...&gt;
&lt;wsdl:operation name=&quot;getShort&quot;&gt;
&lt;corba:operation name=&quot;getShort&quot;&gt;
&lt;corba:return name=&quot;outparameter&quot; idltype=&quot;corba:short&quot; /&gt;
&lt;/corba:operation&gt;
&lt;wsdl:output name=&quot;getShortResponse&quot;&gt;
&lt;/wsdl:output&gt;
&lt;/wsdl:operation&gt;
It should instead be
...
&lt;corba:param name=&quot;outShort&quot; mode=&quot;out&quot; idltype=&quot;corba:short&quot;/&gt;
...
Pretty println functionality needs to be added for extensibility elements in wsdl
Hi,
The functionality to output the extensibility elements in a readable format needs to be added. 
It currently outputs the corba:typemapping and corba:binding on one line each. Wsdl forj makes 
the call to output the extensibility elements at the end of a wsdl document this does not adhere to the standard
and I have extended these classes to make the call to print the them in the correct order. The corba:typeMapping element should be printed at the top before the types section. This is what currently happens but we need to get the elements printed on separate lines and indentation added. I have looked at STAX and other implementations but none of those implementations take into account formatting the output. 
Edell.
RMI/IIOP implementation
The attached tgz includes Triforks rmi/iiop implementation, which may be used as a starting point for the Yoko projects's implementation hereof. The code doesn't compile as it is ripped right out of the Trifork T4 application server. (follow up email coming up)
selectPath() with setXqueryCurrentNodeVar() option does not work for Saxon
When doing a selectPath() or execQuery() on an XmlObject or XmlCursor, &quot;$this&quot; gets bound automagically to the current node. In XmlOptions, there is a method to set a variable of a different name (than &quot;this&quot;) to the current node - setXqueryCurrentNodeVar(String).
However, setting this option doesn't work when doing a selectPath(String, XmlOptions) using Saxon. [I tried this using XMLBeans 2.1.0 + Saxon 8.1.1 as well as XMLBeans latest svn + Saxon 8.6.1.]
The same thing works when using the BEA XQuery engine.
PSVIElementNSImpl.getNil()
The value of the nil property is never copied to the DOM node. Thus, PSVIElementNSImpl.getNil() always return false.
thanks,
Joanne Tong
&quot;xercesc/util/Transcoders/Iconv/IconvTransService.cpp&quot;, line 414: Error: An integer constant expression is required within the array subscript operator
Compiled from
% svn info
Path: .
URL: http://svn.apache.org/repos/asf/xerces/c/trunk
Repository UUID: 13f79535-47bb-0310-9956-ffa450edef68
Revision: 191274
Compiling xercesc/util/Transcoders/Iconv/IconvTransService.cpp
&quot;xercesc/util/Transcoders/Iconv/IconvTransService.cpp&quot;, line 414: Error: An integer constant expression is required within$
1 Error(s) detected.
make[2]: *** [xercesc/util/Transcoders/Iconv/IconvTransService.lo] Error 1
The Sunpro compiler doesn't like MB_CUR_MAX.
while (toTranscode[srcCursor])
{
char mbBuf[MB_CUR_MAX];
int len = wctomb(mbBuf, toTranscode[srcCursor++]), j;
if (len &lt; 0)
MB_CUR_MAX is defined in /usr/include/iso/stdlib_iso.h. I don't know if this should/should not be dragged in automagically based on compiler flags. I'll poke around a bit more.
NPE using XBeanHelper.createBeanDefinitionReader and spring 2.0-rc2
Exception in thread &quot;JMX Connector Thread [service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi]&quot; java.lang.IllegalStateException: Could not find valid implement
ation for: 2.0-rc2
at org.apache.xbean.spring.context.impl.XBeanHelper.createBeanDefinitionReader(XBeanHelper.java:24)
at org.apache.xbean.spring.context.impl.XBeanXmlBeanFactory.&lt;init&gt;(XBeanXmlBeanFactory.java:72)
at org.apache.xbean.spring.context.impl.XBeanXmlBeanFactory.&lt;init&gt;(XBeanXmlBeanFactory.java:37)
at org.apache.xbean.spring.jndi.SpringInitialContextFactory.createContext(SpringInitialContextFactory.java:105)
at org.apache.xbean.spring.jndi.SpringInitialContextFactory.loadContext(SpringInitialContextFactory.java:96)
at org.apache.xbean.spring.jndi.SpringInitialContextFactory.getInitialContext(SpringInitialContextFactory.java:83)
at javax.naming.spi.NamingManager.getInitialContext(NamingManager.java:667)
at javax.naming.InitialContext.getDefaultInitCtx(InitialContext.java:247)
at javax.naming.InitialContext.init(InitialContext.java:223)
at javax.naming.InitialContext.&lt;init&gt;(InitialContext.java:197)
at javax.management.remote.rmi.RMIConnectorServer.bind(RMIConnectorServer.java:629)
at javax.management.remote.rmi.RMIConnectorServer.start(RMIConnectorServer.java:427)
at org.springframework.jmx.support.ConnectorServerFactoryBean$1.run(ConnectorServerFactoryBean.java:153)
Caused by: java.lang.reflect.InvocationTargetException
at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
at java.lang.reflect.Constructor.newInstance(Constructor.java:494)
at org.apache.xbean.spring.context.impl.XBeanHelper.createBeanDefinitionReader(XBeanHelper.java:22)
... 12 more
Caused by: java.lang.NullPointerException
at org.springframework.beans.factory.xml.ResourceEntityResolver.&lt;init&gt;(ResourceEntityResolver.java:64)
at org.apache.xbean.spring.context.v2.XBeanXmlBeanDefinitionReader.&lt;init&gt;(XBeanXmlBeanDefinitionReader.java:60)
... 17 more
xbean-spring does not work with spring 2.0-rc2
The following stack trace is created...
Caused by:
java.lang.IllegalArgumentException: ClassLoader must not be null
at org.springframework.util.Assert.notNull(Assert.java:113)
at
org.springframework.beans.factory.xml.DefaultNamespaceHandlerResolver.&lt;init&gt;(DefaultNamespaceHandlerResolver.java:82)
at
org.springframework.beans.factory.xml.DefaultNamespaceHandlerResolver.&lt;init&gt;(DefaultNamespaceHandlerResolver.java:74)
at
org.apache.xbean.spring.context.v2.XBeanNamespaceHandlerResolver.&lt;init&gt;(XBeanNamespaceHandlerResolver.java:26)
at
org.apache.xbean.spring.context.v2.XBeanXmlBeanDefinitionReader.createDefaultNamespaceHandlerResolver(XBeanXmlBeanDefinitionReader.java:81)
at
org.springframework.beans.factory.xml.XmlBeanDefinitionReader.createReaderContext(XmlBeanDefinitionReader.java:496)
at
org.springframework.beans.factory.xml.XmlBeanDefinitionReader.registerBeanDefinitions(XmlBeanDefinitionReader.java:476)
at
org.apache.xbean.spring.context.v2.XBeanXmlBeanDefinitionReader.registerBeanDefinitions(XBeanXmlBeanDefinitionReader.java:77)
at
org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:386)
at
org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:340)
at
org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:315)
at
org.apache.xbean.spring.context.ResourceXmlApplicationContext.loadBeanDefinitions(ResourceXmlApplicationContext.java:106)
at
org.apache.xbean.spring.context.ResourceXmlApplicationContext.loadBeanDefinitions(ResourceXmlApplicationContext.java:99)
at
org.springframework.context.support.AbstractRefreshableApplicationContext.refreshBeanFactory(AbstractRefreshableApplicationContext.java:89)
org\apache\xbean\spring\context\XmlWebApplicationContext.java does not work
typo in dojo textarea template and dojo widget example in showcase
In textarea.ftl ajax theme template, 
items=&quot;linkGroup;|;textGroup;|;justifyGroup;|;listGroup;indentGroup;|;colorGroup&quot;
should instead be 
items=&quot;linkGroup;|;textGroup;|;justifyGroup;|;listGroup;|;indentGroup;|;colorGroup&quot;
this typo occurs in showcase's /webapp/ajax/widgets/index.jsp as well.
Quickstart does not load classes from WEB-INF/classes first
This is created as a reminder to port this issue from WW to Struts2
http://jira.opensymphony.com/browse/WW-1289?page=all
Tabpanel's panel does display its content during first load if it is remote
Tabpanel's panel does display its content during first load if it is remote, until the respective tab is click, then its remote content is displayed.
the example in WW-1297 illustrates this issue as well.
ww:head tag includes parameters in URLs to stylesheets
Patch from http://jira.opensymphony.com/browse/WW-1322
text tag readonly attribute ignore boolean value
text tag readonly attribute ignore boolean value
see http://forums.opensymphony.com/thread.jspa?messageID=72597#72597 for more info.
theme.properties not read from filesystem
In BaseTemplateEngine.getThemeProps(), theme.properties is only loaded from the classpath. However, the theme spec generally implies that templates will be read from the filesystem first, and the classpath as a fallback. The theme.properties file currently has to exist in the classpath even if other templates are on the filesystem.
getThemeProps should attempt to resolve theme.properties on the file system first, then on the classpath. 
This is created in relation to a bug reported in WW2 at http://jira.opensymphony.com/browse/WW-1292
(WW 2.2.2)Tabbed Panel: All tabs seen when first tab has remote=&quot;true&quot;
While understanding WW Tabbed Panel using examples at -
http://www.opensymphony.com/webwork/wikidocs/tabbedPanel.html
I observed that when the first tab has remote=&quot;true&quot; then all the tabs are seen on initial load.
Example - 
&lt;ww:tabbedPanel id=&quot;test2&quot; theme=&quot;simple&quot; &gt;
&lt;ww:panel remote=&quot;true&quot; cssStyle=&quot;overflow:auto;height:100px&quot; 
href=&quot;/ajaxTabbedOne.action&quot; id=&quot;tab1&quot; theme=&quot;ajax&quot; tabName=&quot;Tab One&quot; /&gt; 
&lt;ww:panel remote=&quot;true&quot; cssStyle=&quot;overflow:auto;height:100px&quot; 
href=&quot;/ajaxTabbedTwo.action&quot; id=&quot;tab2&quot; theme=&quot;ajax&quot; tabName=&quot;Tab Two&quot; /&gt;
&lt;ww:panel remote=&quot;true&quot; cssStyle=&quot;overflow:auto;height:100px&quot; 
href=&quot;/ajaxTabbedThree.action&quot; id=&quot;tab3&quot; theme=&quot;ajax&quot; tabName=&quot;Tab Three&quot; /&gt;
&lt;/ww:tabbedPanel&gt;
But, once I click on other remote tabs and get back to first tab, then the other tabs are hidden as expected.
Ideally, only the first tab (selected by default) should be see on initial load while others are to be hidden. It works as expected when the first tab is not &quot;remote&quot;.
Conflicting validators (XW-375)
See XW-375
We should also change the form-close-validator.ftl according to XW-375.
See Eugenes comments in this forum:
http://forums.opensymphony.com/thread.jspa?threadID=22983&amp;tstart=0
XSLTResult - 3 issues
There are 3 issues here
#1:
XSLTResult does not work with JDK1.5 out of the box.
See XSLResultTest and enable the test, and run it under JDK1.5
Both Rainer and I have this problem. Running on Mac OS and WinXP.
I don't have the exception at hand, but it as a NPE in some SUN code.
#2:
XSLTResult requires the end user to have:
webwork.xslt.nocache = false|true 
defined in webwork.properties
The given exception is:
org.springframework.beans.FatalBeanException: Could not instantiate class [com.opensymphony.webwork.views.xslt.XSLTResult]; constructor threw exception; nested exception is java.lang.IllegalArgumentException: No such setting:webwork.xslt.nocache
org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:187)
I think this should be improved with a better exception message so we can guide the end user
to include this in webwork.properties.
#3:
XSLTResult
It appears that it does not handle iteration. Only the first element is outputted.
See XSLTResultTest.java with an example that ought to output at least 2 books.
JavaScript validation (non-Ajax) doesn't look for an existing message before adding a new validation error
If I have a last name field that's required:
1. When I hit submit, I get an error above the field like expected.
2. If I hit submit again (w/o filling in the last name), I end up with two messages:
Last Name is required.
Last Name is required.
If I look at the rendered code, it looks easy to fix:
&lt;tr errorfor=&quot;saveUser_user_lastName&quot;&gt;
&lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;
&lt;span classname=&quot;errorMessage&quot; class=&quot;errorMessage&quot;&gt; Last Name is required. &lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
Obviously &quot;errorfor&quot; and &quot;classname&quot; are invalid attributes, but you should still be able to look for them before adding a new message.
Submit component sets the field value rather than a boolean on the stack.
In the evaluateParams(...) of the Submit, the field value is set as a value for the component's name. This is incorrect, a boolean value of true should be set when the submit is present. 
As a side note, based on our published docs, the plain Button component hould work the same way. Whoever works on this issue should double check this.
roundtrip test attB002.xsd fails
Roundtripping attB002.xsd fails. This input:
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;xsd:schema xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
...
&lt;xsd:complexType name=&quot;attRef&quot;&gt;
...
&lt;/xsd:complexType&gt;
&lt;xsd:element name=&quot;doc&quot;&gt;
&lt;xsd:complexType&gt;
&lt;xsd:choice&gt;
&lt;xsd:element name=&quot;elem&quot; type=&quot;attRef&quot;/&gt;
&lt;/xsd:choice&gt;
&lt;/xsd:complexType&gt;
&lt;/xsd:element&gt;
&lt;/xsd:schema&gt;
creates this output
&lt;xsd:schema xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; attributeFormDefault=&quot;unqualified&quot; elementFormDefault=&quot;unqualified&quot; xmlns:gen526=&quot;&quot;&gt;
...
&lt;xsd:complexType name=&quot;attRef&quot;&gt;
...
&lt;/xsd:complexType&gt;
&lt;xsd:element name=&quot;doc&quot;&gt;
&lt;xsd:complexType&gt;
&lt;xsd:choice&gt;
&lt;xsd:element name=&quot;elem&quot; type=&quot;gen526:attRef&quot;/&gt;
&lt;/xsd:choice&gt;
&lt;/xsd:complexType&gt;
&lt;/xsd:element&gt;
&lt;/xsd:schema&gt;
the gen526 (run it again and the number will be different) namespace prefix is used rather than referring to the complexType in the schema. Note: there is no targetNamespace defined.
roundtrip test a schema with no targetNamespace inserts targetNamespace=&quot;DEFAULT&quot;
I have a problem round tripping this schema ...
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;xsd:schema xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
&lt;xsd:attribute name=&quot;test&quot; form=&quot;unqualified&quot;/&gt;
&lt;/xsd:schema&gt;
it outputs this:
&lt;xsd:schema xmlns=&quot;DEFAULT&quot;
xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;
attributeFormDefault=&quot;unqualified&quot; elementFormDefault=&quot;unqualified&quot;
targetNamespace=&quot;DEFAULT&quot;&gt;
&lt;xsd:attribute form=&quot;unqualified&quot; name=&quot;test&quot;/&gt;
&lt;/xsd:schema&gt;
when untarring xsts-2002-01-16.tar.gz do it in one step
Today it gunzips the file, then untars that. This leaves a 200Mb tar hanging around.
ant clean depends on 'prepare' which downloads xmlunit-1.0.jar
After downloading xmlunit-1.0.jar it is deleted!
Xml Schema element annotation not built correctly in SchemaBuilder.java
An annotation in the Xml Schema element is not built correctly in SchemaBuilder.java. The
handleAnnotation(XmlSchema, Element, Element) method does not account for the appinfo
element and for the documentation element does not account for the source or xml:lang attributes.
All other schema constructs which can have annotations use the handleAnnotation(Element) method which
does account for the appinfo element and documentation attributes.
DAS - Failures in mysql test suite
There are several failures in the MySQL test suite. 
1) Database tables are not being created correctly -- in a couple of cases it is using a generated key syntax that is not supported by mysql
2) One stored procedure is not being created -- the code to create it is commented out, though I don't think there is any reason for it to be anymore
3) The current mysql jdbc drivers do not support PreparedStatement.getParameterMetaData()
4) For some reason invalid sql like &quot;update customer asdflakjsadf set name = 'bob' where id = 2&quot; succeeds
5) Some case sensitivity issues
URISyntaxException from launcher when jars reside in windows Maven repository
When attempting to run maven from various samples directories:
[INFO] [surefire:test]
[INFO] Surefire report directory: C:\cygwin\home\sykesm\oss-code\tuscany\java\samples\sca\calculator\target\surefire-reports
-------------------------------------------------------
T E S T S
-------------------------------------------------------
Running calculator.CalculatorTestCase
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.38 sec &lt;&lt;&lt; FAILURE!
testCalculator(calculator.CalculatorTestCase) Time elapsed: 0.31 sec &lt;&lt;&lt; ERROR!
java.lang.IllegalArgumentException
at java.net.URI.create(URI.java:854)
at org.apache.tuscany.core.launcher.Launcher.getInstallDirectory(Launcher.java:177)
at org.apache.tuscany.core.launcher.Launcher.bootRuntime(Launcher.java:104)
at org.apache.tuscany.test.SCATestCase.setUp(SCATestCase.java:40)
at calculator.CalculatorTestCase.setUp(CalculatorTestCase.java:32)
at junit.framework.TestCase.runBare(TestCase.java:125)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:615)
at org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.java:210)
at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:135)
at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:122)
at org.apache.maven.surefire.Surefire.run(Surefire.java:129)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:615)
at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:225)
at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:747)
Caused by: java.net.URISyntaxException: Illegal character in path at index 18: file:/C:/Documents and Settings/sykesm/.m2/repository/org/apache/tuscany/core/1.0-SNAPSHOT/core-1.0-SNAPSHOT.jar
at java.net.URI$Parser.fail(URI.java:2821)
at java.net.URI$Parser.checkChars(URI.java:2994)
at java.net.URI$Parser.parseHierarchical(URI.java:3078)
at java.net.URI$Parser.parse(URI.java:3026)
at java.net.URI.&lt;init&gt;(URI.java:590)
at java.net.URI.create(URI.java:852)
This appears to be due to how the Launcher teases out the directory containing the Tuscany code. Since the default location for the maven repository on windows has spaces in the directory names, the &quot;URI&quot; that was used was not valid. In order to get past this I made a very simple change:
$ svn diff
Index: sca/core/src/main/java/org/apache/tuscany/core/launcher/Launcher.java
===================================================================
--- sca/core/src/main/java/org/apache/tuscany/core/launcher/Launcher.java (revision 425392)
+++ sca/core/src/main/java/org/apache/tuscany/core/launcher/Launcher.java (working copy)
@@ -168,13 +168,15 @@
if (!&quot;jar&quot;.equals(url.getProtocol())) {
throw new IllegalStateException(&quot;Must be run from a jar: &quot; + url);
}
+
String jarLocation = url.toString();
jarLocation = jarLocation.substring(4, jarLocation.lastIndexOf(&quot;!/&quot;));
if (!jarLocation.startsWith(&quot;file:&quot;)) {
throw new IllegalStateException(&quot;Must be run from a local filesystem: &quot; + jarLocation);
}
+ jarLocation = jarLocation.substring(5);
- File jarFile = new File(URI.create(jarLocation));
+ File jarFile = new File(jarLocation);
return jarFile.getParentFile().getParentFile();
}
}
This may not be an appropriate change but it did resolve the problem I was seeing.
DAS: managedtx attribute can default to false
If ConnectionInfo is specified, but the managedtx attribute is not, managedtx will default to false instead of true.
CompanyWeb sample problem
The companyWeb sample is not working. It looks like its config file was not updated in response to DAS changes.
Need to add a new config entity to specify passive use of the connection
Need to modify the config model to specify passive use of the connection (no commit/rollback).
ant for building scagen not run on windows
The windows build script does not run the ant task to build scagen - this would do it...
cd ..\..\tools\scagen
ant
cd ..\..\projects\tuscany_sca
cd tuscany_sca_test
nmake -f tuscany_sca_test.mak ALL
cd ..
Various problems building with VC7
Missing directory creations. Wrong runtime library (MDd required), and a routine which doesnt compile on vc7 (!!).
Definition of Parameter in Config model requires addition of &quot;index&quot; and &quot;direction&quot; attributes
Config.Parameter lacks &quot;index&quot; and &quot;direction&quot; attributes
User provided CUD with partial update results in NPE
ApplyChanges with partil userprovided update statement fails with NPE.
Test case DefectTests.readModifyAply and readModifyApply1() demonstrate this bug
DAS needs new parameter marker
The DAS currently uses paramater markers defined with a colon, eg, :param1. This causes a problem with our parsing when a client issues a query with colons in it, such as a query with a hardcoded time value.
Converter getAsString isn't called in af:selectBooleanCheckBox
I use in a page this tag:
&lt;af:selectBooleanCheckbox label=&quot;test boolean&quot;
value=&quot;#{test.boolean}&quot;
converter=&quot;#{test.booleanConverter}&quot;/&gt;
I have a String representation of boolean in my bean (getBoolean return &quot;0&quot; if false end &quot;1&quot; if true)
My converter convert in getAsString &quot;0&quot; into &quot;false&quot; and &quot;1&quot; into &quot;true&quot; and vice versa (getAsObject).
Checkbox is never checked when getBoolean return &quot;1&quot;, so I have debugged my application 
in converter:
* getAsString is never called.
* getAsObject is called normally when my form is submitted String param in getAsObject is &quot;false&quot; if my checkbox isn't checked and &quot;true&quot; if my checkbox is checked.
selectBooleanCheckbox working isn't &quot;symetric&quot; so I think it is a trinidad bug.
I have checked source code in 
SimpleSelectBooleanRenderer.encodeAllAsElement
and SimpleSelectBooleanRenderer.encodeAllAsNonElement
I have replaced code
Object value = getSubmittedValue(bean);
if ( value == null)
value = getValue(bean);
by this one
Object value = getSubmittedValue(bean);
if ( value == null)
{ 
value = getValue(bean);
}
if(!(value instanceof Boolean))
{
value=Boolean.valueOf(getConvertedString(context, component, bean));
}
this &quot;patch&quot; works in af:selectBooleanCheckbox value can be boolean or String &quot;true &quot; or &quot;false&quot; and converter can be used to convert custom boolean representation, but I don't know if it is right place to correct this trinidad bug
TableRenderingContext not always cleaned up properly
If an exception is thrown in the TableRenderingContext constructor, the ThreadLocal will still be set - and with a TableRenderingContext that has not been completely set up. This would be only a minor leak if some non-table code didn't use the presence of a TableRenderingContext to make decisions.
setActionListener tag cannot be used to set a constant value
&lt;af:setActionListener from=&quot;foo&quot; to=&quot;..&quot;/&gt;
does not work.
work around is to use
&lt;af:setActionListener from=&quot;#{'foo'}&quot; to=&quot;..&quot;/&gt;
will upload a patch
Doc bug in BaseMenuModel
The class description for the org.apache.myfaces.adf.model.BaseMenuModel class talks about overriding a &quot;getFocusPath()&quot; method which doesn't exist. Instead, this should say &quot;getFocusRowKey()&quot;.
I will submit a patch shortly.
ADF-Faces Trinidad examples web.xml is invalid against 2.4 xsd
ADF-Faces Trinidad examples web.xml is invalid against 2.4 xsd
in web.xml taglib elements must be surrounded by &lt;jsp-config&gt; for 2.4 specs
like this:
&lt;jsp-config&gt;
&lt;taglib&gt;
&lt;taglib-uri&gt;http://myfaces.apache.org/adf/faces/demo&lt;/taglib-uri&gt;
&lt;taglib-location&gt;/WEB-INF/survey.tld&lt;/taglib-location&gt;
&lt;/taglib&gt;
&lt;taglib&gt;
&lt;taglib-uri&gt;http://myfaces.apache.org/adffacesdemo&lt;/taglib-uri&gt;
&lt;taglib-location&gt;/WEB-INF/uixdemo.tld&lt;/taglib-location&gt;
&lt;/taglib&gt;
&lt;/jsp-config&gt;
Client side validation message does not escape the ' character
Copied from http://forums.oracle.com/forums/thread.jspa?messageID=1223575&amp;#1223575
Here's a small bug with validation message when client-side validation is enabled. If the error message (or field label) contain the character ', ADF Faces won't escape it and will thus break the printing with some nasty characters. A really poor workaround is to set the messages with the ' escaped, but then it will fail when it's the label that contains it or when you disable client-side validation (then the printed message in the page will contains both of the apostrophes).
In TableTree component, column's header facet doesn't run action invocation and update values of it's children.
Steps to reproduce:
Modify components/treeTable.jspx to add &lt;af:commandButton text=&quot;test&quot; action=&quot;#{tablerow.action}&quot;/&gt; into header facet of any column of 
&lt;af:treeTable
binding=&quot;#{editor.component}&quot;
var=&quot;foo&quot; value=&quot;#{tree.model}&quot;
rendered=&quot;true&quot;
rowsByDepth=&quot;3&quot;
summary=&quot;Demo of treeTable&quot;&gt;
pom.xml has dependencies on code not in a Maven repository
Nested &lt;af:showOneTab/&gt; out-of-sync
Copied from http://forums.oracle.com/forums/thread.jspa?messageID=1298055&amp;#1298055
The bug occurs when you nest a showOneTab within another showOneTabs with position attribute sets to both.
The effect of the bug is that the bottom tab of the &quot;master&quot; showOneTabs will use the disclosed index of the child showOneTabs which result in an inconsistency on the UI as an out of sync above and bottom tabs. Here's two screenshots:
* http://agora.ulaval.ca/~siles10/ShowOneTabsBug1.JPG
* http://agora.ulaval.ca/~siles10/ShowOneTabsBug2.JPG
Children out of order in ChildArrayList when re-added to different parent
Here is the code in the add(int index, Object element) method in org.apache.myfaces.adf.component.ChildArrayList class:
if (child.getParent() != null) 
{ 
index = __removeFromParent(child, index); 
} 
child.setParent(_parent); 
super.add(index, child); 
What it is trying to do is to add a new child (the child variable in the code) to this ChildArrayList, and automatically detach the new child from its old parent, if exists, by calling __removeFromParent. 
If you look into the __removeFromParent() method, you can find out that this chunk of code assumes that the old parent is identical to the new parent it is being added under, and __removeFromParent returns an adjusted index value according to this assumption. This assumption is not always right and this is causing problems. 
One way of fixing this is:
Object oldParent = child.getParent();
if (oldParent != null)
{
int adjustedIndex = __removeFromParent(child, index);
//Only adjust the index when the child is re-added to the same parent
if (oldParent == _parent)
{
index = adjustedIndex; 
}
}
child.setParent(_parent);
super.add(index, child);
&lt;af:validateRegExp/&gt; does not allow EL for noMatchMessageDetail
I copied this bug from OTN at http://forums.oracle.com/forums/message.jspa?messageID=1355472#1355472
You cannot specify a noMatchMessageDetail using EL pointing on a resource file when using the &lt;af:validateRegExp/&gt; tag.
The reproduction case is:
[code]
&lt;f:loadBundle basename=&quot;some.resource.file&quot; var=&quot;res&quot;/&gt;
&lt;af:inputText&gt;
&lt;af:validateRegExp pattern=&quot;\w*&quot; noMatchMessageDetail=&quot;#{res['some.key']]}&quot;/&gt;
&lt;/af:inputText&gt;
[/code]
af:returnActionListener ignores literal values
Literal values, as in: 
&lt;af:returnActionListener value=&quot;foo&quot;/&gt;
... are ignored. Workaround:
&lt;af:returnActionListener value=&quot;#{'foo'}&quot;/&gt;
Repository head Maven build fails because Fulcrum jar versions don't exist
I did a full checkout and Maven build this morning and found that the runtime project build failed. The Runtime's project.xml file was referring to fulcrum-testcontainer v1.0.5 and fulcrum-yaafi v1.0.4 that don't exist in the public repositories.
A quick fix was to change the versions back to 1.04 and 1.03 (respectively). Do we need these test only new version? If so, they need to be download-able by maven.
retrieveByPK uses name instead of javaName
If you have a column definition like:
&lt;column name=&quot;class&quot; javaName=&quot;aClass&quot; primaryKey=&quot;true&quot; required=&quot;true&quot; size=&quot;30&quot; type=&quot;VARCHAR&quot;/&gt;
the generator creates retrieveByPK method with a parameter called &quot;class&quot; instead of &quot;aClass&quot;. This is unexpected.
Criteria.andDate missing getTime() method call
Hello all,
there is a bug in Criteria.andDate: the call to the method getTime() is missing while it is present in Criteria.addDate
To exploit it use a code like
calendar.setTime(new Date());
crit.addDate(GpsLocationPeer.LAST_UPDATE, calendar.get(Calendar.YEAR), calendar.get(Calendar.MONTH), calendar.get(Calendar.DAY_OF_MONTH), Criteria.GREATER_EQUAL);
calendar.add(Calendar.DAY_OF_MONTH, 1);
crit.andDate(GpsLocationPeer.LAST_UPDATE, calendar.get(Calendar.YEAR), calendar.get(Calendar.MONTH), calendar.get(Calendar.DAY_OF_MONTH), Criteria.LESS_THAN);
This leads to a SQLException due to incorrect sql query creation.
That is easy to see with Criteria.toString()
Adding the missing method call solves the problem
Please, check the attached patch. Thank you
JDBC Task: Getting Foreign Keys from Views in Sybase throws SybSQLException
Assuming TORQUE-40 is resolved - the JDBC task would throw an exception if it is examining a sybase database with views.
com.sybase.jdbc3.jdbc.SybSQLException: No such object or user exists in the database.
...
at org.apache.torque.task.TorqueJDBCTransformTask.getForeignKeys(TorqueJDBCTransformTask.java:488)
...
This happens because the JDBC driver in Sybase seems to not support foreign keys in views. A workaround for this would be to catch exceptions in org.apache.torque.task.TorqueJDBCTransformTask#getForeignKeys() and return an empty list (or collection). With this fix it would be possible to generate a schema.xml
Wrong Default Setting for torque.enableJava5Features on website
On the site http://db.apache.org/torque/releases/torque-3.2/generator/properties-reference.html is a bug in the documentation for the torque.enableJava5Features property. The default should be &quot;false&quot; and not &quot;Bean&quot;.
Testcase: testLargeSelect fails with MS SQL Database
Running the test project against MS SQL server results in:
[junit] Testcase: testLargeSelect took 1.469 sec
[junit] FAILED
[junit] Total pages expected:&lt;9&gt; but was:&lt;14&gt;
[junit] junit.framework.AssertionFailedError: Total pages expected:&lt;9&gt; but was:&lt;14&gt;
[junit] at org.apache.torque.util.LargeSelectTest.testLargeSelect(LargeSelectTest.java:272)
[junit] at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
[junit] at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
[junit] at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[junit] 
Probably related to the lack of Native LIMIT support in MSSQL.
inputHTML produces IE security warning about midex secure and unsecure items
Hi, when using inputHTML in an SSL-secured application, I get a warning meesage from IE (but not Firefox) that my page uses unsecure content. The only reference I can find in the HTML that does not go back to by application using a relative path is a reference to &quot;about:blank&quot;, so I assume that's where it comes from. Clicking &quot;no, don't show unsecure elements&quot; does not affect the operation. I don't know if this is related to a similar problem reported in the KUPU bug tracking system: http://codespeak.net/issues/kupu/issue94 which was resolved long ago. Cheers, Alex
Can't use automatic sorting on dataTable when some columns doesn't have a header facet
if i have this table on my page:
&lt;t:dataTable
var=&quot;item&quot;
value=&quot;#{bean.results}&quot;
preserveDataModel=&quot;false&quot;
renderedIfEmpty=&quot;false&quot;
sortable=&quot;true&quot; 
sortColumn=&quot;#{bean.sortColumn}&quot;
sortAscending=&quot;#{bean.sortAscending}&quot;
preserveSort=&quot;true&quot; 
rows=&quot;10&quot;
&gt;
&lt;t:column defaultSorted=&quot;true&quot;&gt;
&lt;h:outputText value=&quot;#{ item.id}&quot; /&gt; 
&lt;/t:column&gt;
&lt;/t:dataTable&gt;
i get this error when i try to load the page:
java.lang.NullPointerException : value
at javax.faces.component._ComponentChildrenList.checkValue(_ComponentChildrenList.java:93)
at javax.faces.component._ComponentChildrenList.add(_ComponentChildrenList.java:61)
at org.apache.myfaces.component.html.ext.HtmlDataTable.createSortHeaderComponent (HtmlDataTable.java:538)
at org.apache.myfaces.component.html.ext.HtmlDataTable.encodeBegin(HtmlDataTable.java:490)
at com.sun.facelets.tag.jsf.ComponentSupport.encodeRecursive(ComponentSupport.java:232)
at com.sun.facelets.tag.jsf.ComponentSupport.encodeRecursive(ComponentSupport.java:239)
at com.sun.facelets.tag.jsf.ComponentSupport.encodeRecursive(ComponentSupport.java:239)
at com.sun.facelets.tag.jsf.ComponentSupport.encodeRecursive (ComponentSupport.java:239)
at com.sun.facelets.tag.jsf.ComponentSupport.encodeRecursive(ComponentSupport.java:239)
at com.sun.facelets.FaceletViewHandler.renderView(FaceletViewHandler.java:580)
at org.apache.myfaces.lifecycle.LifecycleImpl.render (LifecycleImpl.java:384)
at javax.faces.webapp.FacesServlet.service(FacesServlet.java:138)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
at org.apache.catalina.core.ApplicationFilterChain.doFilter (ApplicationFilterChain.java:173)
at org.apache.myfaces.webapp.filter.ExtensionsFilter.doFilter(ExtensionsFilter.java:181)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java :202)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
at org.apache.catalina.core.StandardContextValve.invoke (StandardContextValve.java:178)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
at org.apache.catalina.core.StandardEngineValve.invoke (StandardEngineValve.java:107)
at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection (Http11BaseProtocol.java:664)
at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java :80)
at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)
at java.lang.Thread.run(Unknown Source)
RedirectTrackerManager should be Serializable
RedirectTrackerManager is stored as a session attribute. Therefore, when the application is distributable the following exception is thrown:
java.lang.IllegalArgumentException: setAttribute: Non-serializable attribute
at org.apache.catalina.session.StandardSession.setAttribute(StandardSession.java:1233)
at org.apache.catalina.session.StandardSessionFacade.setAttribute(StandardSessionFacade.java:129)
at org.apache.myfaces.context.servlet.SessionMap.setAttribute(SessionMap.java:50)
at org.apache.myfaces.context.servlet.AbstractAttributeMap.put(AbstractAttributeMap.java:104)
at org.apache.myfaces.custom.redirectTracker.RedirectTrackerManager.getInstance(RedirectTrackerManager.java:157)
...
Can't submit an empty date with x:inputDate
Hello,
I see two problems with x:inputDate:
1) if the backing bean is empty the control is initialized with current time: I would like it to be empty to &quot;understand&quot; a date has not been entered
2) it's not possible to submit an &quot;empty&quot; date, i.e.: a valid date date must be entered also if the &quot;required&quot; property is set to false. That means all inputDates are mandatory
Please correct me if I overlook something.
Thanks,
Alex
Tree2 state problem when using dynamic trees
I saw this note: http://mail-archives.apache.org/mod_mbox/myfaces-users/200504.mbox/%3C2387fbc5050415102259484685@mail.gmail.com%3E
I couldn't find a bug for this and I am having the same problem. I've done a little resarch and I think I understand the problem. 
The tree2 js stores the tree state in a cookie named with the component id. I have a page where the tree changes between requests. Because the rest of the page is the same, the component id does not change. The js tries to open up the same nodes as was open in the old tree. The problem occurs when the new tree has a leaf node that was not a leaf in the old tree and was open in the old tree. I get this error &quot;java.lang.IllegalStateException: Encountered a node [0:0:0] + with an illogical state. Node is expanded but it is also considered a leaf&quot;.
For me, I could get around this problem if I could name the component (or the cookie) dynamically using a managed bean value. Since I cannot name the id in this manner, I have a problem.
Maybe a solution would be a new paramerter to specify the cookie name.
Thanks! Here is the full stack trace....
java.lang.IllegalStateException: Encountered a node [0:0:0] + with an illogical state. Node is expanded but it is also considered a leaf (a leaf cannot be considered expanded.
org.apache.myfaces.custom.tree2.HtmlTreeRenderer.encodeNavigation(HtmlTreeRenderer.java:462)
org.apache.myfaces.custom.tree2.HtmlTreeRenderer.encodeCurrentNode(HtmlTreeRenderer.java:345)
org.apache.myfaces.custom.tree2.HtmlTreeRenderer.encodeTree(HtmlTreeRenderer.java:247)
org.apache.myfaces.custom.tree2.HtmlTreeRenderer.encodeTree(HtmlTreeRenderer.java:275)
org.apache.myfaces.custom.tree2.HtmlTreeRenderer.encodeChildren(HtmlTreeRenderer.java:210)
javax.faces.component.UIComponentBase.encodeChildren(UIComponentBase.java:701)
javax.faces.webapp.UIComponentTag.encodeChildren(UIComponentTag.java:607)
javax.faces.webapp.UIComponentTag.doEndTag(UIComponentTag.java:544)
org.apache.jsp.WEB_002dINF.panels.favorites_jsp._jspx_meth_x_tree2_0(favorites_jsp.java:254)
org.apache.jsp.WEB_002dINF.panels.favorites_jsp._jspx_meth_h_form_0(favorites_jsp.java:141)
org.apache.jsp.WEB_002dINF.panels.favorites_jsp._jspx_meth_f_subview_0(favorites_jsp.java:114)
org.apache.jsp.WEB_002dINF.panels.favorites_jsp._jspService(favorites_jsp.java:87)
org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)
javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:324)
org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:292)
org.apache.jasper.servlet.JspServlet.service(JspServlet.java:236)
javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
org.apache.taglibs.standard.tag.common.core.ImportSupport.acquireString(Unknown Source)
org.apache.taglibs.standard.tag.common.core.ImportSupport.doEndTag(Unknown Source)
org.apache.jsp.idp_jsp._jspx_meth_c_import_0(idp_jsp.java:536)
org.apache.jsp.idp_jsp._jspx_meth_c_if_1(idp_jsp.java:509)
org.apache.jsp.idp_jsp._jspx_meth_c_forEach_0(idp_jsp.java:405)
org.apache.jsp.idp_jsp._jspx_meth_t_htmlTag_4(idp_jsp.java:357)
org.apache.jsp.idp_jsp._jspx_meth_t_htmlTag_3(idp_jsp.java:307)
org.apache.jsp.idp_jsp._jspx_meth_t_htmlTag_0(idp_jsp.java:166)
org.apache.jsp.idp_jsp._jspx_meth_f_view_0(idp_jsp.java:129)
org.apache.jsp.idp_jsp._jspService(idp_jsp.java:94)
org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)
javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:324)
org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:292)
org.apache.jasper.servlet.JspServlet.service(JspServlet.java:236)
javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
com.sun.faces.context.ExternalContextImpl.dispatch(ExternalContextImpl.java:322)
com.sun.faces.application.ViewHandlerImpl.renderView(ViewHandlerImpl.java:130)
com.sun.faces.lifecycle.RenderResponsePhase.execute(RenderResponsePhase.java:87)
com.sun.faces.lifecycle.LifecycleImpl.phase(LifecycleImpl.java:200)
com.sun.faces.lifecycle.LifecycleImpl.render(LifecycleImpl.java:117)
javax.faces.webapp.FacesServlet.service(FacesServlet.java:198)
org.apache.myfaces.component.html.util.ExtensionsFilter.doFilter(ExtensionsFilter.java:123)
inputDate does not support forceId
Can support for forceId be added to the inputDate component.
SelectOneCountry needs to support an empty selection
All ISO countries are listed using the SelectOneCountry Tag, but no empty selection is possible.
Input suggest doesn't support umlauts
With Popup window the suggest box renders behind the popup
SelectOneChoice in IE does override z-index of Menu
To reproduce this bug look at Tobago-Demo and select Toolbar - DropDown
ComponentDefinitionsImpl does not resolve attribute dependencies for different locales
When using different locales, ComponentDefinitions does not resolve attribute dependencies, such as having a definition that has been put as an attribute in another definition.
There is a FIXME comment inside the code, so I fixed it :-)
Another problem I found is that when the type is not defined, ComponentDefinitionsImpl does not try to guess what the type is: therefore I decided to correct (if I am right) this behaviour.
JRun 4 server stop trigger NPE
I have integrate standalone tiles in my project (for my company).
When JRun 4 stop (or I trigger the hot-deploy to reload the webapp), it will throw a NullPointerException.
After some study, the NPE should be cause by the absence of super.init(config) call in TilesServlet.java
I'll attach my one-line patch. Hope useful...
(BTW, what's the current status on standalone-tiles?)
cant seem to get a component updated if the event listener is applied to a method that doesnt submit a form
The event doesnt seem to actually trigger invocation of a callback method on the server unless a form is submitted
&lt;pre&gt; 
&lt;span jwcid=&quot;@Shell&quot; title=&quot;Foo 0.1&quot; ajaxEnabled=&quot;true&quot; browserLogLevel=&quot;DEBUG&quot;&gt;
&lt;body jwcid=&quot;@Body&quot;&gt;
&lt;form jwcid=&quot;f@Form&quot; action=&quot;&quot;&gt;
&lt;div id=&quot;mLink&quot; style=&quot;background-color: yellow; width:100px;&quot;&gt;
click me 
&lt;/div&gt;
&lt;div style=&quot;border:1px solid black; height : 40px; width : 400px;&quot; jwcid=&quot;refreshme@Any&quot;&gt;
&lt;span jwcid=&quot;@If&quot; condition=&quot;ognl:good&quot;&gt;
&lt;span jwcid=&quot;@Insert&quot; value=&quot;ognl: message&quot;&gt; the msg goes here &lt;/span&gt;
&lt;/span&gt;
&lt;/div&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/span&gt;
&lt;/pre&gt;
and the class 
&lt;pre&gt;
import org.apache.tapestry.IRequestCycle;
import org.apache.tapestry.annotations.EventListener;
import org.apache.tapestry.annotations.Persist;
import org.apache.tapestry.event.BrowserEvent;
import org.apache.tapestry.html.BasePage;
import java.text.MessageFormat;
abstract public class Playground extends BasePage {
abstract public boolean isGood();
abstract public void setGood(boolean good);
@Persist abstract public String getMessage();
abstract public void setMessage(String message);
@EventListener(events = &quot;onclick&quot;, submitForm = &quot;f&quot;, elements = &quot;mLink&quot;)
public void updateThings(IRequestCycle c) {
BrowserEvent event = new BrowserEvent(c);
setGood(true);
setMessage(&quot;base page &quot; + new java.util.Date());
System.out.println(MessageFormat.format(&quot;x = {0}, y={1}&quot;, event.getPageX(), event.getPageY()));
getRequestCycle().getResponseBuilder().updateComponent(&quot;refreshme&quot;);
}
}
&lt;/pre&gt; 
work. When you click the square a listener on the server (namely, updateThings) is called, the variable message is changed and a call to responseBuilder.updateComponent is honored and the values on the page are changed. 
Remove the form from the html, and remove the submitForm part from the EventListener annotation and a different ituation arrives where, amazingly, tapestry seems to be getting a valid (if empty) ajax response and theres no indication (on the console or the page ) that the listener was invoked
Unit tests using JSONObject.toString are fragile &amp; may break in different environments.
JSONObject.toString writes out its contents by iterating thru the keys of its internal HashMap. However the HashMap class makes no guarantees about the ordering of iterators, so the keys + values may be written out in any order.
The trouble is that the unit tests compare JSONObject.toString to hardcoded strings. If the iteration order happens to match the test string then all is well. If it doesn't match then the tests fail, even tho the functionality being tested is working correctly.
&quot;direct&quot; parameter removed from Form component -- documentation not updated
The &quot;direct&quot; parameter was recently removed from the Form component, but the documentation has not been updated to reflect the change.
AssetService cannot handle relative paths when asset is in jar
Dojo uses relative paths to load modules. e.g. dojo/../tapestry/form.
When these resources are stored within a jar, the Asset service cannot resolve them. I think it would work if they were part of the web resources (since that may use a file resolver) but the classpath resolver does not find them
The AssetService needs to convert the supplied path to a cannonical form (no back references) before it tries to load the resource. 
I made a quick modification to the AssertService.translateCssPath method which accomplishes this. 
String translateCssPath(String path)
{
if (path == null) return null;
// Remove back references in path. 
if( path.indexOf(&quot;/../&quot;) &gt;= 0 ) {
int start = path.indexOf(&quot;/../&quot;);
while( start &gt; 0 ) {
int parentStart = path.lastIndexOf(&quot;/&quot;, start-1);
path = path.substring(0,parentStart+1) + path.substring(start+4);
start = path.indexOf(&quot;/../&quot;);
}
}
// don't parse out actual css files
if (path.endsWith(&quot;.css&quot;)) return path;
int index = path.lastIndexOf(&quot;.css&quot;);
if (index &lt;= -1) return path;
// now need to parse out whatever css file was referenced to get the real path
int pathEnd = path.lastIndexOf(&quot;/&quot;, index);
if (pathEnd &lt;= -1) return path;
return path.substring(0, pathEnd + 1) + path.substring(index + 4, path.length());
}
That passes these tests
public void testRelativePaths() {
AssetService service = new AssetService();
assertEquals(&quot;/src&quot;, service.translateCssPath(&quot;/dojo/../src&quot;));
assertEquals(&quot;src&quot;, service.translateCssPath(&quot;dojo/../src&quot;));
assertEquals(&quot;/src&quot;, service.translateCssPath(&quot;/dojo/blah/../../src&quot;));
assertEquals(&quot;src&quot;, service.translateCssPath(&quot;dojo/blah/../../src&quot;));
assertEquals(&quot;/src&quot;, service.translateCssPath(&quot;/dojo/../blah/../src&quot;));
assertEquals(&quot;src&quot;, service.translateCssPath(&quot;dojo/../blah/../src&quot;));
assertEquals(&quot;/src/&quot;, service.translateCssPath(&quot;/dojo/../src/&quot;));
assertEquals(&quot;src/&quot;, service.translateCssPath(&quot;dojo/../src/&quot;));
assertEquals(&quot;/&quot;, service.translateCssPath(&quot;/dojo/../&quot;));
assertEquals(&quot;&quot;, service.translateCssPath(&quot;dojo/../&quot;));
assertEquals(&quot;../dojo&quot;, service.translateCssPath(&quot;../dojo&quot;));
assertEquals(&quot;/../dojo&quot;, service.translateCssPath(&quot;/../dojo&quot;));
}
ActionLink is not completely removed
ActionLink.java was removed but ActionLink.jwc not, and it is still in Framework.library
ParseException in AssetService
I got this, I don't know any other details (which resource, etc...)
java.text.ParseException: Unparseable date: &quot;Wed, 19 Jul 2006 13:13:03 GMT&quot;
at java.text.DateFormat.parse(Unknown Source)
at org.apache.tapestry.asset.AssetService.cachedResource(AssetService.java:309)
at org.apache.tapestry.asset.AssetService.service(AssetService.java:245)
at $IEngineService_10c86e9f483.service($IEngineService_10c86e9f483.java)
at org.apache.tapestry.services.impl.EngineServiceOuterProxy.service(EngineServiceOuterProxy.java:72)
at org.apache.tapestry.engine.AbstractEngine.service(AbstractEngine.java:241)
at org.apache.tapestry.services.impl.InvokeEngineTerminator.service(InvokeEngineTerminator.java:60)
at $WebRequestServicer_10c86e9f456.service($WebRequestServicer_10c86e9f456.java)
at $WebRequestServicer_10c86e9f454.service($WebRequestServicer_10c86e9f454.java)
at org.apache.tapestry.services.impl.WebRequestServicerPipelineBridge.service(WebRequestServicerPipelineBridge.java:56)
at $ServletRequestServicer_10c86e9f43a.service($ServletRequestServicer_10c86e9f43a.java)
at org.apache.tapestry.request.DecodedRequestInjector.service(DecodedRequestInjector.java:55)
at $ServletRequestServicerFilter_10c86e9f436.service($ServletRequestServicerFilter_10c86e9f436.java)
at $ServletRequestServicer_10c86e9f43c.service($ServletRequestServicer_10c86e9f43c.java)
at org.apache.tapestry.multipart.MultipartDecoderFilter.service(MultipartDecoderFilter.java:52)
at $ServletRequestServicerFilter_10c86e9f434.service($ServletRequestServicerFilter_10c86e9f434.java)
at $ServletRequestServicer_10c86e9f43c.service($ServletRequestServicer_10c86e9f43c.java)
at org.apache.tapestry.services.impl.SetupRequestEncoding.service(SetupRequestEncoding.java:53)
at $ServletRequestServicerFilter_10c86e9f438.service($ServletRequestServicerFilter_10c86e9f438.java)
at $ServletRequestServicer_10c86e9f43c.service($ServletRequestServicer_10c86e9f43c.java)
at $ServletRequestServicer_10c86e9f3c9.service($ServletRequestServicer_10c86e9f3c9.java)
at org.apache.tapestry.ApplicationServlet.doService(ApplicationServlet.java:123)
at org.apache.tapestry.ApplicationServlet.doGet(ApplicationServlet.java:104)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:689)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:237)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:157)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:214)
at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)
at org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:198)
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:152)
at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:137)
at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:118)
at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:102)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)
at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:929)
at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:160)
at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:799)
at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:705)
at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:577)
at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:683)
at java.lang.Thread.run(Unknown Source)
DefaultResponseContributorImpl has wrong doc
I think both javadoc and hivedoc.
tapestry/form.js doesn't have cancel/refresh functions
tapestry.form.submit(&lt;form&gt;, &lt;submit name&gt;) only handles cases where people exlplicitly pass in either no submit name or &quot;refresh/cancel&quot;. 
Add function calls that delegate to this function so that there is a clear alternative to the now extinct form.events.cancel() / form.events.refresh() .
NPE in EventListenerAnnotationWorker
I hope this stack trace is enough. I will try to narrow it down to a reproduction recipe if need be. I am not using the new @EventListener annotation. I just dropped in the 4.1.0-SNAPSHOT as a replacement for 4.0.2 and hit this. 
Error: Error enhancing method public abstract int com.whatever.page.presentation.ListPresentations.getDefaultPageSize(): java.lang.NullPointerException 
* org.apache.tapestry.annotations.EventListenerAnnotationWorker.peformEnhancement(EventListenerAnnotationWorker.java:50)
* $SecondaryAnnotationWorker_10c5fea843f.peformEnhancement($SecondaryAnnotationWorker_10c5fea843f.java)
* $SecondaryAnnotationWorker_10c5fea8441.peformEnhancement($SecondaryAnnotationWorker_10c5fea8441.java)
* $SecondaryAnnotationWorker_10c5fea843b.peformEnhancement($SecondaryAnnotationWorker_10c5fea843b.java)
* org.apache.tapestry.annotations.AnnotationEnhancementWorker.performMethodEnhancement(AnnotationEnhancementWorker.java:119)
* org.apache.tapestry.annotations.AnnotationEnhancementWorker.performEnhancement(AnnotationEnhancementWorker.java:70)
* $EnhancementWorker_10c5fea8439.performEnhancement($EnhancementWorker_10c5fea8439.java)
* $EnhancementWorker_10c5fea8438.performEnhancement($EnhancementWorker_10c5fea8438.java)
* $EnhancementWorker_10c5fea843a.performEnhancement($EnhancementWorker_10c5fea843a.java)
* $EnhancementWorker_10c5fea8411.performEnhancement($EnhancementWorker_10c5fea8411.java)
* $EnhancementWorker_10c5fea8410.performEnhancement($EnhancementWorker_10c5fea8410.java)
* org.apache.tapestry.services.impl.ComponentConstructorFactoryImpl.getComponentConstructor(ComponentConstructorFactoryImpl.java:97)
* $ComponentConstructorFactory_10c5fea83fe.getComponentConstructor($ComponentConstructorFactory_10c5fea83fe.java)
* $ComponentConstructorFactory_10c5fea83fd.getComponentConstructor($ComponentConstructorFactory_10c5fea83fd.java)
* org.apache.tapestry.pageload.PageLoader.instantiatePage(PageLoader.java:567)
* org.apache.tapestry.pageload.PageLoader.loadPage(PageLoader.java:594)
* $IPageLoader_10c5fea83f7.loadPage($IPageLoader_10c5fea83f7.java)
* $IPageLoader_10c5fea83f8.loadPage($IPageLoader_10c5fea83f8.java)
* org.apache.tapestry.pageload.PageSource.getPage(PageSource.java:117)
* $IPageSource_10c5fea8358.getPage($IPageSource_10c5fea8358.java)
* $IPageSource_10c5fea8357.getPage($IPageSource_10c5fea8357.java)
* org.apache.tapestry.engine.RequestCycle.loadPage(RequestCycle.java:249)
* org.apache.tapestry.engine.RequestCycle.getPage(RequestCycle.java:236)
* org.apache.tapestry.engine.RequestCycle.activate(RequestCycle.java:580)
* org.apache.tapestry.engine.PageService.service(PageService.java:66)
* $IEngineService_10c5fea83e1.service($IEngineService_10c5fea83e1.java)
* org.apache.tapestry.services.impl.EngineServiceInnerProxy.service(EngineServiceInnerProxy.java:77)
* org.apache.tapestry.services.impl.EngineServiceOuterProxy.service(EngineServiceOuterProxy.java:72)
* org.apache.tapestry.engine.AbstractEngine.service(AbstractEngine.java:241)
* org.apache.tapestry.services.impl.InvokeEngineTerminator.service(InvokeEngineTerminator.java:60)
* $WebRequestServicer_10c5fea83b6.service($WebRequestServicer_10c5fea83b6.java)
* $WebRequestServicer_10c5fea83b5.service($WebRequestServicer_10c5fea83b5.java)
* $WebRequestServicer_10c5fea83b2.service($WebRequestServicer_10c5fea83b2.java)
* $WebRequestServicer_10c5fea83b1.service($WebRequestServicer_10c5fea83b1.java)
* org.apache.tapestry.services.impl.WebRequestServicerPipelineBridge.service(WebRequestServicerPipelineBridge.java:56)
* $ServletRequestServicer_10c5fea839e.service($ServletRequestServicer_10c5fea839e.java)
* $ServletRequestServicer_10c5fea839d.service($ServletRequestServicer_10c5fea839d.java)
* org.apache.tapestry.request.DecodedRequestInjector.service(DecodedRequestInjector.java:55)
* $ServletRequestServicerFilter_10c5fea839a.service($ServletRequestServicerFilter_10c5fea839a.java)
* $ServletRequestServicerFilter_10c5fea8399.service($ServletRequestServicerFilter_10c5fea8399.java)
* $ServletRequestServicer_10c5fea839f.service($ServletRequestServicer_10c5fea839f.java)
* org.apache.tapestry.multipart.MultipartDecoderFilter.service(MultipartDecoderFilter.java:52)
* $ServletRequestServicerFilter_10c5fea8398.service($ServletRequestServicerFilter_10c5fea8398.java)
* $ServletRequestServicerFilter_10c5fea8397.service($ServletRequestServicerFilter_10c5fea8397.java)
* $ServletRequestServicer_10c5fea839f.service($ServletRequestServicer_10c5fea839f.java)
* org.apache.tapestry.services.impl.SetupRequestEncoding.service(SetupRequestEncoding.java:53)
* $ServletRequestServicerFilter_10c5fea839c.service($ServletRequestServicerFilter_10c5fea839c.java)
* $ServletRequestServicerFilter_10c5fea839b.service($ServletRequestServicerFilter_10c5fea839b.java)
* $ServletRequestServicer_10c5fea839f.service($ServletRequestServicer_10c5fea839f.java)
* $ServletRequestServicer_10c5fea8392.service($ServletRequestServicer_10c5fea8392.java)
* $ServletRequestServicer_10c5fea8391.service($ServletRequestServicer_10c5fea8391.java)
* org.apache.tapestry.ApplicationServlet.doService(ApplicationServlet.java:123)
* org.apache.tapestry.ApplicationServlet.doGet(ApplicationServlet.java:104)
* javax.servlet.http.HttpServlet.service(HttpServlet.java:689)
* javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
* org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:428)
* org.mortbay.jetty.servlet.WebApplicationHandler.dispatch(WebApplicationHandler.java:473)
* org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:568)
* org.mortbay.http.HttpContext.handle(HttpContext.java:1530)
* org.mortbay.jetty.servlet.WebApplicationContext.handle(WebApplicationContext.java:633)
* org.mortbay.http.HttpContext.handle(HttpContext.java:1482)
* org.mortbay.http.HttpServer.service(HttpServer.java:909)
* org.mortbay.http.HttpConnection.service(HttpConnection.java:816)
* org.mortbay.http.HttpConnection.handleNext(HttpConnection.java:982)
* org.mortbay.http.HttpConnection.handle(HttpConnection.java:833)
* org.mortbay.http.SocketListener.handleConnection(SocketListener.java:244)
* org.mortbay.util.ThreadedServer.handle(ThreadedServer.java:357)
* org.mortbay.util.ThreadPool$PoolThread.run(ThreadPool.java:534)
Incorect dojo baseRelativePath
If cookies are disabled or
if the current page is the first page that requires session,
then o.a.t.dojo.AjaxShellDelegate outputs the following baseRelativePath:
http://localhost:9090/workbench/assets/60d36d17b2cad6353d9e7897bc0eaf5a/org/apache/tapestry/html/dojo/;jsessionid=m77nh3f6mcmr
This is problematic because dojo uses this url to dynamically include additional resources, and the existance of
jsessionid breaks this.
The real cause of this is TAPESTRY-802, which modified EngineServiceLink in a way that does not take into
account the stateful parameter, which in turn causes asset links to be encoded (HttpServletResponse.encodeUrl is 
called on them) and thus jsessionid appended.
Missing pom.xml in www.ibiblio.org/maven2/tapestry/tapestry/4.0.2/
Also missing in tapesty-annotations and tapestry-contrib. 
Why is this happening with every release ?
All Tapestry URLs should be encoded using RequestCycle.encodeURL(), except for portlets URLs
All Tapestry URLs referencing the Tapestry servlet or context assets should be encoded using RequestCycle.encodeURL() whether the link is stateless or not.
In portlet mode, the portlet URLs obtained by createActionURL() or createRenderURL() should NOT be encoded.
Failure to do so causes problems when running as a WSRP producer where the URLs will be WSRP defined tokens that get re-written by the WSRP container. Action, render and resource URLs are encoded differently.
DatePicker doesn't work in a portlet. Initialization script is run before window finishes loading.
When using a DatePicker in a Tapestry portlet, IE displays an error message during page loading and aborts:
&quot;Internet Explorer cannot open the site http://localhost. Operation aborted&quot;
It appears that this is caused by the initialization script of the DatePicker component being run before the window finishes loading. The script is run right before the portlet finishes rendering, which, in a portal environment, is not necessarily the end of the page.
ForwardConfig inheritance doesn't work when trying to inherit global forwards
http://www.nabble.com/Re%3A--VOTE--Struts-1.3.5-Quality-p5466871.html
1.) ForwardConfig inheritance doesn't work when trying to inherit
global forwards. There's code to handle it within the config objects,
but they're not being triggered at app startup.
[This feature was not] in the 1.2.x line, so people upgrading from a previous GA release won't be affected.
Arbitrary properties don't get copied when creating ActionRedirect objects based on an existing ForwardConfig
http://www.nabble.com/Re%3A--VOTE--Struts-1.3.5-Quality-p5466871.html
2.) Arbitrary properties don't get copied when creating ActionRedirect
objects based on an existing ForwardConfig. Anyone have any
objections if I reuse BaseConfig.inheritProperties() to fix this?
[This feature was not] in the 1.2.x line, so people upgrading from a previous GA release won't be affected.
Fixed in r425554 - http://svn.apache.org/viewvc?rev=425554&amp;view=rev
LIMITS.cpp WCHAR test causes infinite loop with IPA, nonstandard code
With any compiler that uses interprocedural analysis including leaf node inlining, this WCHAR test in etc/config/src/LIMITS.cpp invokes undefined behavior from signed integer overflow and can result in an infinite loop. Our compiler inlines the greater() function and invokes undefined behavior, so the loop never exits. One workaround is to disable optimization and run the code by hand, but since this code is hidden within the build process, a portable solution is needed. Here's a code snippet:
template &lt;class T&gt;
T greater (T lhs, T rhs)
{
// prevents overzealous gcc optimizer from invoking
// undefined behavior on signed integer over/underflow
return lhs &gt; rhs;
}
template &lt;class T&gt;
T compute_limits (T, const char *pfx, const char *sfx, const char *type)
{
T max = T (1);
T one = T (1);
for (; T (max * 2) &gt; max; max *= 2);
for (T n = max / 4; n; ) {
if (T (max + n) &lt; max) {
if (n &gt; 2)
n /= 2;
else if (greater (T (max + one), max))
n = 1;
else
break;
}
else
max += n;
}
return max;
}
int main(void) {
compute_limits ((wchar_t)0, &quot;WCHAR_T&quot;, suffix, &quot;wchar_t&quot;);
return 0;
}
Locales utility produces bad output
As part of the make runall process for the bin directory, a (generated) script called sanity_test.sh is executed prior to building the locales. This script tests various aspects of the locale and localedef utilities. When running this script manually with the -d (debug) parameter and the buildspace bin directory in the path, I recive the following output. It appears to me that the locale utility may have built incorrectly.
Checking location of locale utilities... correct.
Checking &quot;locale --help&quot; output...Error 399: invalid size at (nil): 4294967295, expected 352
incorrect.
ERROR: &quot;locale --help&quot; gives wrong output (NAME).
incorrect.
ERROR: &quot;locale --help&quot; gives wrong output (SYNOPSIS).
incorrect.
ERROR: &quot;locale --help&quot; gives wrong output (DESCRIPTION).
correct.
Checking &quot;locale -a&quot; output...Error 399: invalid size at (nil): 4294967295, expected 352
check completed.
Checking &quot;locale -m&quot; output...Error 399: invalid size at (nil): 4294967295, expected 352
correct.
Checking &quot;locale -k LC_ALL&quot; output...Error 399: invalid size at (nil): 4294967295, expected 352
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (upper).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (lower).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (space).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (print).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (cntrl).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (alpha).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (digit).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (punct).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (graph).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (xdigit).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (toupper).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (tolower).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (abday).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (day).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (abmon).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (mon).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (am_pm).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (d_t_fmt).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (d_fmt).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (t_fmt).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (t_fmt_ampm).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (int_curr_symbol).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (currency_symbol).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (mon_decimal_point).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (mon_thousands_sep).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (mon_grouping).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (positive_sign).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (negative_sign).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (int_frac_digits).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (frac_digits).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (p_cs_precedes).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (p_sep_by_space).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (n_cs_precedes).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (n_sep_by_space).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (p_sign_posn).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (n_sign_posn).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (decimal_point).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (thousands_sep).
incorrect.
ERROR: &quot;locale -k&quot; gives wrong output (grouping).
(seems) correct.
Checking &quot;localedef --help&quot; output... correct.
Top level 'make util' command fails
From the root of a subversion (head) stdcxx checkout, invoking make with a target of 'util' (incorrectly) results in an output of
gmake: `util' is up to date.
rather than the (correct) invoking make with a parameter of -C$(BUILDDIR)/bin
SIGABRT in std::streambuf::sbumpc() in unbuffered input mode
The program below dumps core:
$ cat t.cpp &amp;&amp; gmake t &amp;&amp; ./t
#include &lt;cassert&gt;
#include &lt;cstdio&gt;
#include &lt;istream&gt;
#include &lt;string&gt;
int main ()
{
struct: std::streambuf {
int_type underflow () {
return 'x';
}
} buf;
buf.sgetc ();
buf.sbumpc ();
}
aCC -c -I/nfs/devco/sebor/dev/stdlib/include/ansi -I/usr/include -D_RWSTDDEBUG -D_RWSTD_USE_CONFIG -I/nfs/devco/sebor/dev/stdlib/include -I/build/sebor/aCC-3.27-11s/include -I/nfs/devco/sebor/dev/stdlib/examples/include -Aa +nostl -g +d +w +W392 +W655 +W684 +W818 +W819 +W849 +W229 +W361 t.cpp
aCC t.o -o t -Aa +nostl -Wl,+s -Wl,+vnocompatwarnings -L/build/sebor/aCC-3.27-11s/lib -L/build/sebor/aCC-3.27-11s/lib -lstd11s -lm
/nfs/devco/sebor/dev/stdlib/include/streambuf:432: int std::basic_streambuf&lt;char,std::char_traits&lt;char&gt; &gt;::uflow(): Assertion '0 != _C_gptr' failed.
( 0) 0x000087d4 __rw_assert_fail__4__rwFPCcT1iT1 + 0x7c [././t]
( 1) 0x000083a8 uflow__Q2_3std15basic_streambufXTcTQ2_3std11char_traitsXTc__Fv + 0xa8 [././t]
( 2) 0x00007778 sbumpc__Q2_3std15basic_streambufXTcTQ2_3std11char_traitsXTc__Fv + 0x7c [././t]
( 3) 0x000075d4 main + 0x2c [././t]
( 4) 0xc013e8fc _start + 0xc8 [/usr/lib/libc.2]
( 5) 0x000064c0 $START$ + 0x178 [././t]
ABORT instruction (core dumped)
std::operator&lt;&lt;(ostream, string) calls width(0) regardless of sentry
The following test fails:
#include &lt;iostream&gt;
#include &lt;sstream&gt;
#include &lt;string&gt;
#include &lt;cassert&gt;
int main(int argc, char* argv[])
{
std::string str (&quot;abcdefghijk&quot;);
std::ostringstream os;
const std::streamsize width = 2;
os.width (width);
os.clear (std::ios_base::failbit);
os &lt;&lt; str;
assert (os.width () == width);
return 0;
}
Searcher's getDocListAndSet methods do not accept flags, can cause NPE when writing output
SolrIndexSearcher's getDocListAndSet methods do not accept flags, which can, in some cases, cause a Null Pointer Exception to be thrown when writing the docListAndSet.docList as output. I came across the issue as I was implementing faceting, see http://www.nabble.com/Faceted-Browsing-Question-Discussion-tf1968854.html for the discussion.
The simplest way to reproduce this is to modify DisMaxRequestHandler, by changing this:
DocList results = s.getDocList(query, restrictions,
SolrPluginUtils.getSort(req),
req.getStart(), req.getLimit(),
flags);
rsp.add(&quot;search-results&quot;,results);
to
DocListAndSet listAndSet= s.getDocListAndSet(query, restrictions,
SolrPluginUtils.getSort(req),
req.getStart(), req.getLimit());
DocList results = listAndSet.docList;
rsp.add(&quot;search-results&quot;,results);
The root cause appears to be that the scores[] is set to null, so then the DocIterator and its score() method is called, return scores[pos-1] will give null. When getDocListAndSet(..) is invoked, it eventually can get down to this private method:
private DocSet getDocListAndSetNC(DocListAndSet out, Query query, DocSet filter, Sort lsort, int offset, int len, int flags) throws IOException
In that method, scores is assigned as follows:
scores = (flags&amp;GET_SCORES)!=0 ? new float[nDocsReturned] : null;
Since getDocListAndSet() does not pass flags (except for the implicit GET_DOCSET), scores is assigned as null, which eventually leads to the NullPointerException if you try to output the docList . The attached patch does not change the underlying mechanism of how scores is assigned, but works around the issue by adding overloaded getDocListAndSet() methods that take an additional flags parameter. After applying this patch, you can change the relevant bit in DisMaxRequestHandler to:
DocListAndSet listAndSet= s.getDocListAndSet(query, restrictions,
SolrPluginUtils.getSort(req),
req.getStart(), req.getLimit(), flags);
DocList results = listAndSet.docList;
rsp.add(&quot;search-results&quot;,results);
and you will no longer see the NullPointerException
WordDelimiterFilter exception
When WordDelimiterFilter is set to generate*Parts=0 and catenate*Parts=0 (for either Number or Word), it throws an exception when encountering such a token in the token stream. This might be uncommon, but it should be possible (for instance, to filter out all numbers).
Result of select request is not well-formed XML when text field contains non-ASCII chars and ampersand
Starting with the supplied start.jar, the ampersand from this field is not correctly escaped in the XML search results provided by the select page:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;add&gt;
&lt;doc&gt;
&lt;field name=&quot;id&quot;&gt;amp-test-one&lt;/field&gt;
&lt;field name=&quot;content&quot;&gt;Les vnements chez Bonnie &amp;amp; Clyde.&lt;/field&gt;
&lt;/doc&gt;
&lt;/add&gt;
&lt;/stuff&gt;
The &quot;content&quot; field is defined as a &quot;text&quot; field in the schema.
Adding this document to the index and querying on &quot;id:amp-test-one&quot; returns
...
&lt;doc&gt;
&lt;str name=&quot;content&quot;&gt;Les vnements chez Bonnie &amp; Clyde.&amp;amp; Clyde.&lt;/str&gt;
&lt;str name=&quot;id&quot;&gt;amp-test-one&lt;/str&gt;
&lt;/doc&gt;
With first &quot;Bonnie &amp; Clyde&quot; unescaped and then the correct escaped &amp;amp;
Browsing the index with Luke shows that the field is correctly stored.
I think this might be a Jetty bug: patching the util/XML class of SOLR to avoid the use of Writer.write(String,start,len) fixes the problem. Maybe the Jetty ServletWriter gets confused by the presence of non-ascii chars?
Here are my changes in util/XML.java. It looks like the class did use String.substring(...) before, Writer.write might be faster but it seems like it's broken in that environment.
Here are my patches to util/XML.java:
Index: src/java/org/apache/solr/util/XML.java
===================================================================
--- src/java/org/apache/solr/util/XML.java (revision 422655)
+++ src/java/org/apache/solr/util/XML.java (working copy)
@@ -159,8 +159,8 @@
}
if (subst != null) {
if (start&lt;i) {
- // out.write(str.substring(start,i));
- out.write(str, start, i-start);
+ out.write(str.substring(start,i));
+ // out.write(str, start, i-start);
// n+=i-start;
}
out.write(subst);
@@ -172,8 +172,8 @@
out.write(str);
// n += str.length();
} else if (start&lt;str.length()) {
- // out.write(str.substring(start));
- out.write(str, start, str.length()-start);
+ out.write(str.substring(start));
+ // out.write(str, start, str.length()-start);
// n += str.length()-start;
}
// return n;
Solr admin stylesheet doesn't work well with Internet Explorer
The admin pages look different on firefox than on IE (6 or 7).
- tables in text analysis page span whole browser, regardless of cell size
- separators visible in firefox aren't visible in IE
When a component sendSync an InOut exchange to itself, the exchange is never delivered
This behaviour can be reproduced using servicemix-http when an http provider endpoint send an http request to a consumer endpoint.
Beanflow: Multiple execution of beanflow steps
Consider the following simple Beanflow example:
public class TestWorkflow extends Workflow&lt;String&gt; {
private static Logger log = Logger.getLogger(TestWorkflow.class.getName());
public static int count = 0;
public TestWorkflow() {
super(&quot;startStep&quot;);
}
public String startStep() {
count += 1;
log.info(&quot;Workflow: Validation&quot;);
// next step
return &quot;persistenceStep&quot;;
}
public String persistenceStep() {
count += 1;
log.info(&quot;Workflow: Persistence&quot;);
// next step
return &quot;transferStep&quot;;
}
public String transferStep() {
count += 1;
log.info(&quot;Workflow: Transfer&quot;);
// next step
return &quot;stop&quot;;
}
}
If I write a JUnit test case with assertEquals(workflow.count, 3); then
this will fail, as count has a value of 5. Looking at the log shows the
following output:
08:19:26,335 DEBUG [org.apache.servicemix.beanflow.Workflow.run()] About
to execute step: startStep
08:19:26,351 INFO [ch.bbp.igt.comm.ServiceMix.TestWorkflow.startStep()]
FileActWorkflow: Validation
08:19:26,351 DEBUG [org.apache.servicemix.beanflow.Workflow.run()] About
to execute step: persistenceStep
08:19:26,351 INFO
[ch.bbp.igt.comm.ServiceMix.TestWorkflow.persistenceStep()]
FileActWorkflow: Persistence
08:19:26,351 DEBUG [org.apache.servicemix.beanflow.Workflow.run()] About
to execute step: persistenceStep
08:19:26,351 INFO
[ch.bbp.igt.comm.ServiceMix.TestWorkflow.persistenceStep()]
FileActWorkflow: Persistence
08:19:26,351 DEBUG [org.apache.servicemix.beanflow.Workflow.run()] About
to execute step: transferStep
08:19:26,351 INFO
[ch.bbp.igt.comm.ServiceMix.TestWorkflow.transferStep()]
FileActWorkflow: Transfer
08:19:26,351 DEBUG [org.apache.servicemix.beanflow.Workflow.run()] About
to execute step: transferStep
08:19:26,351 INFO
[ch.bbp.igt.comm.ServiceMix.TestWorkflow.transferStep()]
FileActWorkflow: Transfer
08:19:26,351 DEBUG [org.apache.servicemix.beanflow.Workflow.run()] About
to execute step: stop
08:19:26,367 DEBUG [org.apache.servicemix.beanflow.Workflow.run()] About
to execute step: stop
This means, all steps but the start step are executed twice! This
corresponds to count being 5 in the end! 
JUnit Testcase :
public class WorkflowTest extends TestCase {
public WorkflowTest(String s) {
super(s);
}
protected void setUp() {
}
protected void tearDown() {
}
public void testTest() throws Exception {
TestWorkflow workflow = new TestWorkflow();
workflow.start();
Thread.sleep(2000);
assertEquals(3, workflow.count);
}
public static Test suite() {
TestSuite suite = new TestSuite();
suite.addTest(new WorkflowTest(&quot;testTest&quot;));
return suite;
}
} 
servicemix-http provider should not add the inMessage content-type header to the response if a new content-type is generated (mime messages)
This is similar to SM-502 - the loop line 111 of ProviderProcessor in servicemix-http adds a Content-Type header from the in message if there was one. The content-type is regenerated by the soapWriter a few lines later and should override the first one. However both end up in the http request.
To see the bug, create 2 http:endpoints, one consumer and one provider, the latter being target of the former. Then submit a Soap With Attachment request into the consumer. The output is invalid because the first Content-Type header does not match the content (boundaries are wrong).
The patch attached removes the first header.
'*ProviderProcessor in servicemix-jms overwrites the MimeMessage content-type with the one from the incoming normalizedmessage
The problem (MultiplexingProviderProcessor in servicemix-jms):
Message msg = session.createTextMessage(baos.toString());
msg.setStringProperty(&quot;Content-Type&quot;, writer.getContentType());
Map headers = (Map) nm.getProperty(JbiConstants.PROTOCOL_HEADERS);
if (headers != null) {
for (Iterator it = headers.keySet().iterator(); it.hasNext();) {
String name = (String) it.next();
String value = (String) headers.get(name);
msg.setStringProperty(name, value);
}
}
This means that any Content-Type header in the PROTOCOL_HEADERS will overwrite the one set line 176.
The problem manifests itself when sending a SAAJ (SOAP with attachments) request into an http:endpoint proxying a jms:endpoint provider endpoint. In the resulting JMS message, the content-type is the original content-type but it should be the new content-type computed by the SoapWriter: this bug renders the JMS message content unusable.
main.wsdl not accessible after deploying WSDL to servicemix-http component
When trying to deploy a Service Assembly with a WSDL to the servicemix-http component (as described on the servicemix-http page) the SA deploys OK, and the services are listed at http://localhost:8080
Error 404 - Not Found.
No service matched or handled this request.
Known services are:
* http://localhost:8080/InOnly
* http://localhost:8080/InOut
But when trying to access the WSDL (ex. http://localhost:8080/InOnly/?wsdl) the following error is returned:
HTTP ERROR: 404
No wsdl is available for this service
RequestURI=/InOnly/main.wsdl
However, the WSDL can be accessed by using the JMX console to execute the getWsdl() method of the EndpointMBean.
An example case is a Service Assembly containing a JBI descriptior and a Service Unit with contents as follows:
./main.wsdl
./META-INF/jbi.xml
The main.wsdl file has content as described on the servicemix-http page:
&lt;definitions name='Consumer'
targetNamespace='http://http.servicemix.org/Test'
xmlns:tns='http://http.servicemix.org/Test'
xmlns:http='http://schemas.xmlsoap.org/wsdl/http/'
xmlns:soap='http://schemas.xmlsoap.org/wsdl/soap/'
xmlns='http://schemas.xmlsoap.org/wsdl/'
xmlns:jbi='http://servicemix.org/wsdl/jbi/'&gt;
&lt;portType name='ConsumerInterface'&gt;
&lt;/portType&gt;
&lt;binding name='ConsumerSoapBinding' type='tns:ConsumerInterface'&gt;
&lt;soap:binding transport=&quot;http&quot;/&gt;
&lt;/binding&gt;
&lt;binding name='ConsumerHttpBinding' type='tns:ConsumerInterface'&gt;
&lt;http:binding verb=&quot;POST&quot;&gt;&lt;/http:binding&gt;
&lt;/binding&gt;
&lt;service name='ConsumerInOnly'&gt;
&lt;port name='TestEndpoint' binding='tns:ConsumerSoapBinding'&gt;
&lt;soap:address location=&quot;http://localhost:8080/InOnly&quot;/&gt;
&lt;jbi:endpoint role=&quot;consumer&quot; defaultMep='in-only'/&gt;
&lt;/port&gt;
&lt;/service&gt;
&lt;service name='ConsumerInOut'&gt;
&lt;port name='TestEndpoint' binding='tns:ConsumerHttpBinding'&gt;
&lt;http:address location=&quot;http://localhost:8080/InOut&quot;/&gt;
&lt;jbi:endpoint role=&quot;consumer&quot; defaultMep='in-out'/&gt;
&lt;/port&gt;
&lt;/service&gt;
&lt;/definitions&gt;
The Endpoint.setDescription() and Endpoint.setDefinition() are being called by the Deployer. Then, when the Endpoint.activate() is called (and in turn the SoapEndpoint.loadWsdl() method), the WSDL is not added to the HttpEndpoint.wsdl HashMap because those two values were set (!= null).
StaxSource: Bug in parse() method for character streams
We are playing around with servicemix and the jsr181 component when we run into a strange problem. We are sending a SOAP request to a defined Service by the jsr181 component with a long parameter value inside. The strange thing is that the parameter value won't be send correctly to the NMR. Instead the value is repeated several times for the first 1024 characters. We took a look in your source files and found the responsible location for that behaviour. It looks like there's a bug in the class org.apache.servicemix.jbi.jaxp.StaxSource, line 66:
protected void parse() throws SAXException {
try {
contentHandler.startDocument();
while (true) {
switch (streamReader.getEventType()) {
case XMLStreamConstants.ATTRIBUTE:
case XMLStreamConstants.CDATA:
break;
case XMLStreamConstants.CHARACTERS:
if (!streamReader.isWhiteSpace()) {
for (int textLength = streamReader.getTextLength(); textLength &gt; 0; textLength -= chars.length) {
int l = Math.min(textLength, chars.length);
==&gt; streamReader.getTextCharacters(0, chars, 0, l);
contentHandler.characters(chars, 0, l);
}
}
break;
The first parameter of the method XMLStreamReader.getTextCharacters() defines the sourceStart (index of the first character in the source array to copy) parameter. In your implementation this value is 0 every time. That's the reason why we run into our problem...
CopyTransformer does not copy SecuritySubject
I noticed that the CopyTransformer class does not attempt to copy the
security subject. Is this done on purpose? As the Drools component does
rely on CopyTransformer, as a result, all security subjects are lost
during Drools routing. I enclose a patch
Inconsistent property names for JbiConstants.PROTOCOL_TYPE and JbiConstants.PROTOCOL_HEADERS
The attached patch fixes the property names of JbiConstants.PROTOCOL_TYPE and JbiConstants.PROTOCOL_HEADERS according to JBI spec 1.0-FR section 5.5.1.1.3
Code snippets missing from soem static HTML pages
I've run across a couple of pages where code snippets are missing from the static HTML pages but are present in the wiki pages. I'm assuming that this is maybe due to some issue with the wiki --&gt; html export plugin, but I'm no expert. Here are a couple pages where code snippets are missing: 
http://www.servicemix.org/site/saaj.html
http://servicemix.org/site/pojo-support.html
servicemix-http does not reply with HTTP 202 when processing &quot;oneway&quot; SOAP messages
Empty service assembly name prevents service units from start
In case the service assembly name was accidently left empty, an incorrect directory path is being created for the SA (like /wdir/defaultJBI/service-assemblies/version_1). This in turn does not allow service units to initialize after the ServiceMix restart. It would be better to raise some error if empty SA name was found in the descriptor.
System integration test TokenTestCase fails against the JSF 1.1 RI
When the system integration tests are run with '-Djsf=ri&quot;, the TokenTestCase test fails with an assertion error on line 157. It works when executed against MyFaces.
Not possible to pass dynamically information from a beans as a shale method parameter.
Some notes. I forget to tell.
It is perfectly working with constans ...
&lt;s:validatorVar name=&quot;operationID&quot; value=&quot;Testing&quot;/&gt;
,not with beans ...
&lt;s:validatorVar name=&quot;operationID&quot;
value=&quot;#{mtJobOperation.operationID}&quot;/&gt;
Second line pass to a custom validator method just a null.
Alex.
-----Original Message-----
From: Iakouchev Alexander-EAL027C
Sent: Thursday, July 13, 2006 10:29 AM
To: user@shale.apache.org
Subject: RE: Is this possible to pass dynamically information from a beans as a shale method parameter?
Hello Craig!
Thank you for feedback.
I want to be more specific. I need validate all rows in &quot;dataTable&quot;
component. JSP page show list of &quot;Foo&quot; objects. For example, the inputText component with id=&quot;---&quot; has shale custom validate. I need analyze dependency component id=&quot;---&quot; row i from component id=&quot;---&quot; row 0...n.
In other words I need pass some current row id to get by id real object.
&lt;s:commonsValidator
type=&quot;validateQuoteHoursValue&quot;
arg=&quot;quoteHours&quot;
server=&quot;true&quot;
client=&quot;false&quot;
&gt;
&lt;s:validatorVar name=&quot;operationID&quot;
value=&quot;#{mtJobOperation.operationID}&quot;/&gt;
&lt;/s:commonsValidator&gt;
This valuator does not works. It receive operationID equal null. But outputText shown some not null information.
&lt;t:outputText value=&quot;#{mtJobOperation.operationID}&quot;/&gt;
The Shale validator example show some solution with dynamic shale method parameter, but it is with standard validator example not a custom validator.
Alex.
-----Original Message-----
From: craigmcc@gmail.com [mailto:craigmcc@gmail.com] On Behalf Of Craig McClanahan
Sent: Wednesday, July 12, 2006 7:45 PM
To: user@shale.apache.org
Subject: Re: Is this possible to pass dynamically information from a beans as a shale method parameter?
On 7/12/06, Iakouchev Alexander-EAL027C &lt;EAL027C@motorola.com&gt; wrote:
&gt;
&gt; Is this possible to pass dynamically information from a beans as a 
&gt; shale method parameter?
&gt; Alex.
&gt;
&gt;
In JSF 1.1, you cannot do this (it's not a Shale issue, it's the basic functionality of JSF method binding expression). In JSF 1.2, you can ...
but only for calls to static methods.
A better general strategy is to invoke a method that takes no parameters, but ensure that the called method can extract whatever it needs. For example, consider the standard JSF call to your action method (which takes no parameters). There are at least two ways for the called method to access request parameters on the incoming request:
* Via JSF programmatic APIs:
// Retrieve the value of the &quot;foo&quot; parameter
FacesContext context = FacesContext.getCurrentInstance();
String foo = (String)
context.getExternalContext().getRequestParameterMap().get(&quot;foo&quot;0;
* By managed beans expression evaluation. This example requires
a bit more setup to configure, but is much easier to use because
the values are injected for you. Consider again that you want to
extract the value of the &quot;foo&quot; parameter and use it in your myAction()
action method. Define your managed bean entry like this:
&lt;managed-bean&gt;
&lt;managed-bean-name&gt;mybean&lt;/managed-bean-name&gt;
&lt;managed-bean-class&gt;com.mypackage.MyBean&lt;/managed-bean-class&gt;
&lt;managed-bean-scope&gt;request&lt;/managed-bean-scope&gt;
&lt;managed-property&gt;
&lt;property-name&gt;foo&lt;/property-name&gt;
&lt;value&gt;#{param.foo}&lt;/value&gt;
&lt;/managed-property&gt;
&lt;/managed-bean&gt;
and set up your bean class like this:
package com.mypackage;
public class MyBean {
...
private String foo = null;
public String getFoo() { return this.foo; }
public void setFoo(String foo) { this.foo = foo; }
...
public String myAction() {
// Get the value of the &quot;foo&quot; request parameter
String foo = getFoo();
...
}
...
}
The formula #{param.foo} is evaluated when the managed bean is created, and extracts the value of the request parameter named &quot;foo&quot; and calls
setFoo() on your bean. By the time the action method is called, the value will be there already.
Craig
Missing tag validator for the clay component.
The clay JSP tag should not allow any nested tags besides the clay:symbol. The following example should fail:
&lt;clay:clay id=&quot;contacts&quot; jsfid=&quot;contactTable&quot;&gt;
&lt;clay:symbol name=&quot;managed-bean-name&quot; value=&quot;rolodex&quot;/&gt;
&lt;h:outputText value=&quot;bogus&quot;/&gt;
&lt;/clay:clay&gt;
The clay markup parser was not handling a CDATA block.
The parser failed on the following markup fragment.
&lt;jsp:text jsp:id=&quot;64&quot;&gt;
&lt;![CDATA[
&lt;/body&gt;
]]&gt;
&lt;/jsp:text&gt;
convertDateTime component throws exception when using the timeZone attribute
There is not a JSF converter registered for the TimeZone class. This causes an exception be thrown when usign the converDateTime component:
&lt;converter jsfid=&quot;conver tDateTime&quot;&gt;
&lt;attributes&gt;
&lt;set name=&quot;pattern&quot; value=&quot;dd/MM/yy, HH:mm&quot; /&gt;
&lt;set name=&quot;timeZone&quot; value=&quot;GMT+01&quot; /&gt;
&lt;/attributes&gt;
&lt;/converter&gt;
&gt; javax.faces.convert.ConverterException: You have requested a conversion for 
&gt; type java.util.TimeZone, but there is no by-type converter registered for 
&gt; this type
Subview Component not compatible with Tiger Extensions handling of view controllers
The subview component class (org.apache.shale.component.SubView) has hard coded casts to check for ViewController that are not triggered when you are using annotated view controllers with the Tiger Extensions library.
SCXML doesn't compile using JDK 1.5
SCXML's BuiltIn class uses org.apache.xpath.XPathAPI (from xalan) - which was shipped with JDK 1.4 (in rt.jar). JDK 1.5 no longer has this class (looks like they have re-packaged their own version com.sun.org.apache.xpath.internal.XPathAPI).
http://www.mail-archive.com/commons-user%40jakarta.apache.org/msg16114.html
[ID] VersionFourGenerator.nextIdentifier fails in secure mode
Generating secure ID only works on initialization, aftyerwards always the same ID is returned.
Fix the wrong if-blocks, then also the third ID will be unique...:
private UUID nextUUID(boolean secure)
{
byte[] raw = new byte[UUID_BYTE_LENGTH];
if (secure) {
//Initialize the secure random if null.
if (secureRandom == null) {
try {
if (usePRNGPackage != null) {
secureRandom = SecureRandom.getInstance(usePRNG, usePRNGPackage);
} else {
secureRandom = SecureRandom.getInstance(usePRNG);
}
} catch (NoSuchAlgorithmException nsae) {
nsae.printStackTrace();
secure = false; //Fail back to default PRNG/Random
} catch (NoSuchProviderException nspe) {
nspe.printStackTrace();
secure = false; //Fail back to default PRNG/Random
}
}
// fix by mattin
if (secureRandom != null) {
secureRandom.nextBytes(raw);
}
}
if (!secure) {
regularRandom.nextBytes(raw);
}
Safe comments: strip HTML from comment name, URL and email addresses
See title.
We allow users to use HTML in comment body, but we strip all but a &quot;safe subset&quot; of HTML when we display the coment. However, we don't do any HTML stripping safe-subsetting on the comment name, HTML or url. That leaves Roller open to XSS attacks by commenters.
Install errors with postgres database
The 2.3 createdb.sql for Postgres creates a database with the incorrect type for the timestamp columns. 
You discover this when you register your first user, a blank screen is presented and the roller.log contains an error concerning a column in a result set (something like crea_7_..., logs are gone now). Other operations give an error with &quot;String index out of range: 23&quot;. 
Pings - When deleting a Global Ping target - Users are unable to log entries or delete the weblog.
After deleting a global ping target, the ping tab is unavailable to users &quot;Unpected exception&quot; occurs. Users are then unable to create new entries nor delete the weblog. 
Create a user weblog
Login as Admin and delete a global ping. 
Login back in as the same user and attempt to access the Ping tab. Unhandled exception.
Attempt to create a new entry. Unexpected exception. 
Attempt to delete the entire Blog - Error&quot; No row with the given identifier exists: [org.apache.roller.pojos.PingTargetData#c885fd950b436ce9010b5c945f8e0515]&quot;
Group blog members (non-admin) are unable to run spellcheck or preview entries. Permission denied screen appears.
Group blog members (non-admin) are unable to run spellcheck or preview entries. Permission denied screen appears. Spellcheck could be available to all users.
Language selection bahavoir in theme selection page
Undocumented behavior that is a feature or bug depending on your point of view.
1. Logged in to a blog (sotto for example)
2. Go the change theme page.
3. Select the currency-i18n
4. In the imbedded display of the blog with 'currency-i18n' theme, 
click the Dutch language link.
5. Now select sotto again.
6. The headings now change to Dutch.
7. Save theme as sotto. 
8. Now the sotto theme is in Dutch. 
The language link changes you blog's locale setting.
BSC - Posting a comment and immediately clicking on the comment link results in an exception and the message is immediately marked as spam.
Posting a comment and immediately clicking on the comments link results in an exception error. 403 - unexpected exception. The message, type and exception are null in the error message. 
The comment is immediately marked as spam.
Note - all following comments for that entry are marked as spam even from 2 different IPs.
Comment moderation is off. 
BSC - When the read more plugin is clicked, the user loses the admin shortcuts ( ie. settings and logout). Note, must be the first instance of a browser.
When the read more plugin is clicked, the user looses the admin shortcuts ( ie. settings and logout). If back is clicked after read more is clicked, the admin settings appear. 
Steps - 
1) have the Read more plugin setting on. 
2) enter a new weblog with enough content.
3) logout and close browser. 
4) open browser, blogs.sfbay, click login and then login.
5) click on the new entry from the main page
6) *note - all admin links are present on the weblog. 
7) click the &quot;read more link&quot;.
8) *note, the settings and logout links are removed and the login link appears. 
A user can click back to get back to the link or one can login again - 
QTP fails when a setting link is expected. If it is not a new instance of either browsers, the admin links remain.
i18N, UTF-8 and URI
I use UTF-8 to Deal with non-ASCII charset, I keep every code unchange, but use Tomcat5.0, and mysql4.0 but enable UTF connection via JDBC, It seems everything fine with display and store chinese, the only 2 problems I found is:
1. the Calendar display is still ????????????
2. the Permalink seems still have some encoding error, such as 
--------------------------------------------------------------------
http://mho.sinica.edu.tw:8080/roller/page/adminUser/20040524#__ title=
--------------------------------------------------------------------
I have looked the #ROL-4 non-us-ascii characters won't work, but if I enforce contentType=&quot;text/html;charset=UTF-8&quot;, it gets even worse, I can not display non-ASCII character normally..
Any idea about this?
Postage compile error under jdk 1.4
Compiling Postage under jdk 1.4 I'm getting a &quot;cannot resolve symbol&quot; compile error:
build:
[echo] Compiling James Postage
[javac] Compiling 29 source files to E:\JamesSVN\postage-trunk\build\classes
[javac] E:\JamesSVN\postage-trunk\build\source\org\apache\james\postage\jmx\JVMResourceSampler.java:68: cannot resolve symbol
[javac] symbol : constructor IllegalStateException (java.lang.String,java.lang.Exception)
[javac] location: class java.lang.IllegalStateException
[javac] throw new IllegalStateException(&quot;could not create JVMResourceSamplerWorker&quot;, e);
[javac] ^
[javac] E:\JamesSVN\postage-trunk\build\source\org\apache\james\postage\jmx\JVMResourceSampler.java:76: cannot resolve symbol
[javac] symbol : constructor IllegalStateException (java.lang.String,java.lang.NoSuchMethodException)
[javac] location: class java.lang.IllegalStateException
[javac] throw new IllegalStateException(&quot;could not access delegation methods&quot;, e);
[javac] ^
[javac] 2 errors
It happens because the
public IllegalStateException(String message, Throwable cause)
is available only in jdk 1.5
PortalURLParser drops '/' characters when building render path
The PortalURLParser doesn't preserve the '/' characters in non-control path elements. For example, the path info of &quot;/context/servlet/some/random/path/__rp...&quot; ends up setting the renderPath in the PortletURL to &quot;somerandompath&quot; instead of &quot;/some/random/path&quot;
Line 129, probably just needs to be changed from
renderPath.append(token);
to
renderPath.append('/').append(token);
&lt;distributable&gt; element in web.xml files produced by the descriptor/depolyer sub-projects is not valid with respect to the Servlet 2.4 xsd
Perhaps against best practices I have a portlet that puts objects into session attributes that don't implement Serializable. Normally I prevent warnings from Tomcat by configuring a session manager (a &lt;Manager&gt; element inside a &lt;Context&gt; container) with an empty path name. See http://tomcat.apache.org/tomcat-5.5-doc/config/manager.html#Standard%20Implementation (look for the pathname attribute).
However Tomcat (at least v 5.5.15 does) seems to ignore my &lt;Manager pathname=&quot;&quot;/&gt; directive when the portlet's web.xml has a &quot;&lt;distributable&gt;&quot; element present. Tomcat then fires off errors about placing non-serializable objects in the portlet session.
I think the Pluto descriptors/deployer needs to put the &lt;distributable&gt; element into a web.xml only when its required.
odmg-api, if two new object (associated via reference) are registered and deleted within the same tx, odmg perform illegal insert of one object
OJB can't read metadata provided by separate jar file (in classpath)
If metadata (repository.xml file and repository.dtd) are provided by a separate jar file in classpath, the repository.dtd will not be found. 
Fix: OJB should use a custom EntityResolver to resolve dtd's from jar files.
Additionally allow user to set custom EntityResolver in class RepositoryPersistor
DataResource setup and Content setup not working with default seed data
I installed the latest version from SVN. I did install seed data using ant run-instlal. When I try to access DateResource setup or Content setup I get following:
:ERROR MESSAGE:
org.ofbiz.base.util.GeneralException: JPublish execution error (The markup in the document following the root element must be well-formed.)
Tax Authority GL Accounts calling wrong services
The Tax Authority GL Accounts screens are calling the wrong services.
on create 'createTaxAuthorityCategory' is being called instead of 'createTaxAuthorityGlAccount'
on delete 'deleteTaxAuthorityCategory' is being called instead of 'deleteTaxAuthorityGlAccount'
Regards
Scott
E-mail is Username causes &quot;Username is Missing&quot; error
A recent change (last couple of weeks) has broken the &quot;Use Primary Email Username&quot; feature in the product store:
https://www._domain_.com/catalog/control/EditProductStore?productStoreId=9000
Now, when signing up for a new account, an error occurs 
&quot;Username is Missing&quot;
Thanks
availableLocales property does not handle country_code during parsing
locale code that contains a language code and a country code are not parsed correctly:
example :
fr_FR,es_PE
The attached patch use UtilMisc.ensureLocale to parse the locale code
commons-cli-2.0-SNAPSHOT.jar provided with nutch is not compatible with jdk 1.4
We need to commit the library from issue http://issues.apache.org/jira/browse/HADOOP-350
to nutch also
bin/nutch setting of log path problems on cygwin
logs are written to wrong directory.
cure: preprocess NUTCH_LOG_DIR the same way as the CLASSPATH
CrawlDatum.set just reference a mapWritable of a other object but not copy it.
Using CrawlDatum.set(aOtherCrawlDatum) copies the data from one CrawlDatum to a other. 
Also a reference of the MapWritable is passed. Means both project share the same mapWritable and its content. 
This causes problems with concurent manipulate mapWritables and its key-value tuples. 
DmozParser does not output urls to stdout
DmozParser does not output list of urls to stdout but to a log file instead. Original functionality needs to be restored.
API 1.1.1 dependency for shared module
&gt;&gt;-----Original Message-----
&gt;&gt;From: Cagatay Civici [mailto:cagatay.civici@gmail.com]
&gt;&gt;Sent: Tuesday, July 11, 2006 06:41 PM
&gt;&gt;To: dev@myfaces.apache.org
&gt;&gt;Subject: current12 shared_core classpath issue
&gt;&gt;
&gt;&gt;Hi,
&gt;&gt;
&gt;&gt;I'm working on some of unassigned 1.2 jira issues.
&gt;&gt;
&gt;&gt;After building the libraries using current12 and doing mvn eclipse:eclipse,
&gt;&gt;the created .classpath of myfaces_shared_core points to the
&gt;&gt;
&gt;&gt;&lt;classpathentry kind=&quot;var&quot; path=&quot;M2_REPO/myfaces/myfaces-api/1.1.1/myfaces-
&gt;&gt;api-1.1.1.jar&quot;/&gt;, thus changes I've made for the 1.2 issues are not taken
&gt;&gt;into account.
&gt;&gt;
&gt;&gt;Any thoughts?
&gt;&gt;
&gt;&gt;Regards,
&gt;&gt;
&gt;&gt;Cagatay Civici
selectonelistbox inside datatable crashes
I have a selectonelistbox inside a datatable. When I submit the form, I get a
17:12:02,640 DEBUG PropertyResolverImpl:177 - Exception while setting property; base with class : TestUnit, property : item1
javax.faces.el.PropertyNotFoundException: Bean: TestUnit, property: item1
at org.apache.myfaces.el.PropertyResolverImpl.setProperty(PropertyResolverImpl.java:391)
at org.apache.myfaces.el.PropertyResolverImpl.setValue(PropertyResolverImpl.java:173)
at org.apache.myfaces.el.ValueBindingImpl.setValue(ValueBindingImpl.java:275)
at javax.faces.component.UIInput.updateModel(UIInput.java:269)
. . .
for the value of the selectonelistbox. Note, the exception only prints out when the
log4j.properties is set to debug, otherwise I don't get any information why it
doesn't work. Also, I have the same problem with &lt;h:inputhidden&gt;.
test.jsp
================
&lt;%@ taglib uri=&quot;http://java.sun.com/jsf/html&quot; prefix=&quot;h&quot;%&gt;
&lt;%@ taglib uri=&quot;http://java.sun.com/jsf/core&quot; prefix=&quot;f&quot;%&gt;
&lt;f:view&gt;
&lt;html&gt;
&lt;body&gt;
&lt;h:form id=&quot;test&quot;&gt;
&lt;h:dataTable var=&quot;unit&quot; value=&quot;#{testBean.units}&quot;&gt;
&lt;h:column&gt;
&lt;h:outputText value=&quot;#{unit.item2}&quot;&gt;&lt;/h:outputText&gt;
&lt;h:selectOneListbox value=&quot;#{unit.item1}&quot; size=&quot;1&quot;&gt;
&lt;f:selectItems value=&quot;#{unit.items1}&quot; /&gt;
&lt;/h:selectOneListbox&gt;
&lt;/h:column&gt;
&lt;/h:dataTable&gt;
&lt;h:commandButton value=&quot;submit&quot; action=&quot;#{testBean.processForm}&quot; /&gt;
&lt;/h:form&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;/f:view&gt;
================
TestBean.java
================
import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;
import javax.faces.model.DataModel;
import javax.faces.model.ListDataModel;
public class TestBean implements Serializable {
private static final long serialVersionUID = 1L;
private DataModel units;
public TestBean() {
List unitList = new ArrayList();
unitList.add(new TestUnit());
units = new ListDataModel();
units.setWrappedData(unitList);
}
public DataModel getUnits() {
return units;
}
public void processForm() {
System.out.println(&quot;processForm&quot;);
}
}
================
TestUnit.java
================
import java.io.Serializable;
import javax.faces.model.SelectItem;
public class TestUnit implements Serializable {
private static final long serialVersionUID = 1L;
public TestUnit() {
super();
}
public String getItem1() {
return &quot;1&quot;;
}
public String getItem2() {
return &quot;2&quot;;
}
public SelectItem[] getItems1() {
SelectItem[] items1 = new SelectItem[5];
int loop = 0;
items1[loop] = new SelectItem(&quot;&quot; + loop, &quot;&quot;);
for (loop = 1; loop &lt; 5; loop++) {
items1[loop] = new SelectItem(&quot;&quot; + loop, &quot;&quot; + loop);
}
return items1;
}
}
================
Lower the dependency on Xalan(XPath)
The dependency on Xalan(XPath) should be restricted to only Query RP operations. This will allow us to keep the dependencies, potential conflicts and deployable app size minimal. as of now I get the following exception:
java.lang.NoClassDefFoundError: org/apache/xpath/XPathAPI
at org.apache.muse.util.xml.XPathUtils.selectNodeList(XPathUtils.java:143)
at org.apache.muse.ws.resource.properties.schema.impl.SimpleResourcePropertiesSchema.getAllPropertyElements(SimpleResourcePropertiesSchema.java:152)
at org.apache.muse.ws.resource.properties.schema.impl.SimpleResourcePropertiesSchema.&lt;init&gt;(SimpleResourcePropertiesSchema.java:113)
at org.apache.muse.ws.resource.impl.SimpleWsResource.createPropertiesSchema(SimpleWsResource.java:116)
at org.apache.muse.ws.resource.impl.SimpleWsResource.initialize(SimpleWsResource.java:180)
at org.apache.muse.core.routing.FilePersistence.createResource(FilePersistence.java:78)
at org.apache.muse.core.routing.FilePersistence.createResources(FilePersistence.java:103)
at org.apache.muse.core.routing.FilePersistence.createResources(FilePersistence.java:121)
at org.apache.muse.core.routing.SimpleResourceRouter.initialize(SimpleResourceRouter.java:224)
at org.apache.muse.core.platform.AbstractIsolationLayer.initialize(AbstractIsolationLayer.java:167)
SimpleSetCapability operations throw SoapFaults instead of BaseFaults.
WSRF based capabilities should throw BaseFaults as their LCD fault.
Axis2 reads WS-A reference parameter headers into wsa:Metadata element of EPR
For some reason, the SOAP requests sent from our current Muse client code cause Axis2 to form an improper EPR on the server side.
When Axis2 is processing the SOAP headers, it seems to ignore the wsa:IsReferenceParameter attribute on the SOAP headers for WS-A reference parameters. This causes it to lump those headres into the EPR's wsa:Metadata section. Since only the reference params are used for resource resolution, this causes WS-A DestinationUnreachable faults - the data is in the EPR, but it's under Metadata, not ReferenceParameters.
Looking at the SOAP request on the server side shows that a) the wsa:IsReferenceParameter attribute is present, and is set to &quot;true&quot;, and b) wsa is mapped to the proper WS-A namespace. Right now there is a commented-out hack in AxisEnvironment that gets around this, but the problem should be fixed so that we don't have to &quot;fix&quot; the EPR for every request.
Rely solely on WS-A Action URI for mapping of requests to capability methods
Presently, Muse uses the SOAP body to determine what Java method should be called for a web service operation, because the OASIS and W3C specs are not consistent in how they format the WS-A Action URIs. The SOAP body requests are the only things that provide an easy-to-translate name (just lowercase the first character of the operation name). This is not &quot;proper&quot; WS-A, though, and some web services specs (see Microsoft/W3C submissions) rely solely on WS-A Action and even have operations with empty SOAP bodies.
The WS-A 1.0 spec shows (in its examples) a convention for specifying the WS-A action of an operation's messages in the WSDL. It is not defined normatively in the spec, but it is in the document, and we should use that as a means of appeasing both web services camps (&quot;empty bodies are bad&quot; vs &quot;empty bodies are okay&quot;). This will require extra processing of the resources' WSDLs at initialization time and a change in the data structure that maps names (now URIs) to methods.
The test case for this bug should be support of WS-Transfer's Get operation, which has a WS-A Action URI and an empty SOAP body.
Memory leak when using handlers in multiple phases at same time.
When using handlers against multiple phases, ie.,
# .htaccess
PythonFixupHandler handlers
AddHandler mod_python .py
PythonHandler handlers
# handlers.py
from mod_python import apache
def handler(req):
req.content_type = 'text/plain'
req.write('handler')
return apache.OK
def fixuphandler(req):
return apache.OK
mod_python will leak memory on each request, which Apache child process sizes blowing out quite quickly.
The problem code is in python_handler() in 'src/mod_python.c'. Specifically the code does:
if (!hle) {
/* create a handler list object from dynamically registered handlers */
request_obj-&gt;hlo = (hlistobject *)MpHList_FromHLEntry(dynhle, 1);
}
else {
/* create a handler list object */
request_obj-&gt;hlo = (hlistobject *)MpHList_FromHLEntry(hle, 1);
/* add dynamically registered handlers, if any */
if (dynhle) {
MpHList_Append(request_obj-&gt;hlo, dynhle);
}
}
Problem is that request_obj-&gt;hlo can already be set by a prior phase's handler and by simply assigning to request_obj-&gt;hlo you get a memory leak as it refers to an existing Python object and it isn't being decref'd.
Thus, before this 'if' statement, it would appear that the following should
be inserted.
if (request_obj-&gt;hlo)
Py_DECREF(request_obj-&gt;hlo);
or:
Py_XDECREF(request_obj-&gt;hlo);
req.readlines(sizehint) does not work correctly
A bug in req_readlines(sizehint) in requestobject.c causes output to be returned prematurely for any value of the optional sizehint argument.
The faulty bit of code is: 
line = req_readline(self, rlargs);
while (line &amp;&amp; (PyString_Size(line)&gt;0)) {
PyList_Append(result, line);
size += PyString_Size(line);
if ((sizehint != -1) &amp;&amp; (size &gt;= size))
break;
line = req_readline(self, args);
}
Since (size &gt;= size) will always be true, reading the input stream will end prematurely for any value of sizehint != -1.
This code will fix the problem.
--- requestobject.c (revision 417294)
+++ requestobject.c (working copy)
@@ -1154,7 +1154,7 @@
while (line &amp;&amp; (PyString_Size(line)&gt;0)) {
PyList_Append(result, line);
size += PyString_Size(line);
- if ((sizehint != -1) &amp;&amp; (size &gt;= size))
+ if ((sizehint != -1) &amp;&amp; (size &gt;= sizehint))
break;
line = req_readline(self, args);
}
Once that is fixed the documentation needs to be revised, as it does not accurately reflect the behaviour of the code. 
Currently the docs are:
&quot;&quot;&quot;Reads all or up to sizehint bytes of lines using readline and returns a list of the lines read.&quot;&quot;&quot;
whereas the code can read beyond sizehint. The total read could actually be sizehint + len(line) where line is the last line read.
PSP error page accessing session object can cause a deadlock.
If a session object is required for a PSP page, the session object will be created automatically with the session being locked at the same time, when PSP.run() is called. If an error page is generated by the session page it in turn will then be run. The problem is that the session lock is still held by the main page and thus if the error page itself tries to also access the session object, when the PSP.run() method of the error page is called, it will create a new instance of the session object which will result in a deadlock.
In MODPYTHON-38, the suggested change was that when PSP.run() creates the session object that it assign it back to req.session. This change was not made, but if it was then when the error page was run, it would simply have inherited the session object which had already been created by the main page and a deadlock would not have ensued.
Thus could should read as:
session = None
if &quot;session&quot; in code.co_names:
if hasattr(req, 'session'):
session = req.session
else:
req.session = session = Session.Session(req)
DbmSession creates world readable db file
DbmSession uses the default mode when creating the db file. As a result the file is world readable, which may be undesirable where sensitive informaiton is stored in the session. Currently the users are required to chmod the file manually. This can be fixed by using the option mode argument when the file is opened.
Quoting from the python anydbm documentation:
open( filename[, flag[, mode]]
The optional mode argument is the Unix mode of the file, used only when the database has to be created. It defaults to octal 0666 (and will be modified by the prevailing umask).
psp_parser fails when CR is used as a line terminator
As reported by Jeff Zelt:
&quot;&quot;&quot;
On Mac OS X, make sure that your HTML files are terminated by :
a line feed (ascii 10) and NOT a carriage return (ascii 13).
PSP does *not* like lines terminated by only a carriage return.
The problem was that I was using Adobe GoLive to edit my web pages and to insert the python code in the page (I am talking about the source view, not the WYSIWYG/Layout view). My version of GoLive is a little old and still prefers to write files with carriage return line endings. This was the default for the Mac OS before Mac OS X. Everything *looks* OK in the GoLive editor and it also looked OK in the other editors I chose to check the code (other editors would have tipped me off, but I did not use one of those).
However, it seems that the PSP engine, or whatever you want to call it, does not treat carriage returns as line endings, and therefore chokes badly when encountering code written this way.
GoLive has a menu item where you can select the desired line terminator. I selected &quot;Unix (LF)&quot;. This made no visible change to the document when viewed in GoLive, but then suddenly the &lt;% ... %&gt; PSP parts of the document worked perfectly. 
&quot;&quot;&quot;
I've confirmed that psp_parser.l expects lines of python code to be terminated with: &quot;\r\n | \n | %&gt;&quot; so the fix should be a one liner.
Index: src/psp_parser.l
===================================================================
--- src/psp_parser.l (revision 398185)
+++ src/psp_parser.l (working copy)
@@ -119,7 +119,7 @@
}
}
-&lt;PYCODE&gt;\r\n|\n {
+&lt;PYCODE&gt;\r\n|\n|\r {
psp_string_appendc(&amp;PSP_PG(pycode), '\n');
PSP_PG(seen_newline) = 1;
No support for Apache 2.2 yet
See http://article.gmane.org/gmane.comp.apache.mod-python.devel/1425 for some remarks by Jorey Bump, raised during the 3.2.1-BETA tests.
Improve modeler site/build
Attaching a patch to improve the modeler maven site/build:
1) Include &quot;build.properties.default&quot; in the source distro
2) Have the source distro unpack to a different directory
3) Include NOTICE.txt in the jar file
4) Add custom &quot;Source Repository&quot; page
5) Add custom &quot;Issue Tracking&quot; page
6) Add &quot;Building&quot; page
7) Navigation improvements
I can commit these if you like.
thread local storage bug in 1.9 RC1 build 4
Several workarounds for java 1broken thread local storage cause exception in .NET 2
Lucene.Net/Index/SegmentReader.cs, line 183 (cause exception)
Lucene.Net/Index/TermInfosReader.cs, line 61 (no exception, but useless?)
DateField bug in 1.9 RC1 build 4
Lucene.Net/Document/DateField.cs, line 52
private static int DATE_LEN = System.Convert.ToString(
1000L * 365 * 24 * 60 * 60 * 1000, 16).Length;
should be:
private static int DATE_LEN = SupportClass.Number.ToString(
1000L * 365 * 24 * 60 * 60 * 1000, 16).Length;
make dist does not work
$ make -k dist
make: *** No rule to make target `apr-1.2.2.patch', needed by `distdir'.
make: *** No rule to make target `apr-util-1.2.2.patch', needed by `distdir'.
make: Target `dist' not remade because of errors.
a pacth for this bug:
$ svn diff
Index: Makefile.am
===================================================================
--- Makefile.am (revision 421167)
+++ Makefile.am (working copy)
@@ -1,2 +1,2 @@
SUBDIRS = docs src include simplesocketserver tests performance examples
-EXTRA_DIST = autogen.sh aclocal.m4 license.apl find_apr.m4 find_apu.m4 build.xml apr-build.xml aprutil-build.xml apr-1.2.2.patch apr-util-1.2.2.patch cppunit-build.xml
+EXTRA_DIST = autogen.sh aclocal.m4 license.apl find_apr.m4 find_apu.m4 build.xml apr-build.xml aprutil-build.xml cppunit-build.xml
LoggerRepositorySkeleton's OnConfigurationChanged method always raises its event with EventArgs.Empty instead of passing through its EventArgs parameter.
This code:
protected virtual void OnConfigurationChanged(EventArgs e)
{
if (e == null)
{
e = EventArgs.Empty;
}
LoggerRepositoryConfigurationChangedEventHandler handler = m_configurationChangedEvent;
if (handler != null)
{
handler(this, EventArgs.Empty);
}
}
should be changed to match the other event handlers in the class:
protected virtual void OnConfigurationChanged(EventArgs e)
{
if (e == null)
{
e = EventArgs.Empty;
}
LoggerRepositoryConfigurationChangedEventHandler handler = m_configurationChangedEvent;
if (handler != null)
{
handler(this, e); // do not always pass in EventArgs.Empty
}
}
SecurityException thrown in LogicalThreadContextProperties GetProperties
SecurityException thrown in LogicalThreadContextProperties GetProperties
The LogicalThreadContext stores its properties in the CallContext. The CallContext methods GetData ans SetData have a LinkDemand for the SecurityPermissionFlag.Infrastructure. If the calling code does not have this permission a SecurityException is generated when the LogicalThreadContextProperties.GetProperties method is JITed. The calling code does not have this psermission if it is in the Medium trust zone.
The exception causes the LoggingEvent to fail to compose its properties, and therefore log4net fails to log any events. The exception is eventualy caught and does not leak into the calling application.
LDAP attribute name comparison should be case-insensitive
When trying to authenticate against an LDAP server (in this case, Apache-DS from a seperate installation), the authentication failed because the userPassword attribute was not found.
The attribute exists within LDAP, but the case is different (userpassword). While the schema suggests the specified ID (userPassword) is correct, I believe LDAP is supposedly case-insensitive, and so ideally the attribute comparison should also be.
The change required is to the getAttribute method within org.apache.jetspeed.security.spi.impl.ldap.LdapUserCredentialDaoImpl, replacing the equals() method with equalsIgnoreCase().
Unable to use Unicode (UTF-8) in user names and passwords
Currently, it's not possible to use utf-8 characters in usernames and passwords.
In my case, some of our users reported problems with their passwords as they used some very common german characters.
I will attach a patch for Jetspeed2 on Tomcat 5.0 and 5.5. However, I could not verify the behaviour with Tomcat 5.0. The patch is working fine with Tomcat 5.5.
The patch solves the problem by:
- setting UTF-8 as character encoding in LoginProxyServlet (let me know if you'd prefer looking up the character encoding in the MediaType of the Agent's CapabilityMap)
- setting UTF-8 as character encoding in tomcat's FormAuthenticator valve (configured in jetspeed's context.xml)
It would be great if this patch could find its way into the next 2.1 release ;)
Regards, Thorsten
OJB + Spring Transactions broken
I tried writing a unit test to test OJB + Spring transactions.
To my suprise, transactions are not starting.
In fact, Im seeing some surprising results in mysql.log
(yes Im using InnoDB), note no transactions, and the forced autocommit
118 Query SET autocommit=1
117 Prepare [1] INSERT INTO FOLDER...
117 Execute [1] INSERT INTO FOLDER... 
117 Query SET autocommit=1
It appears that OJB repeatedly sets autocommit=1
and
it never starts any transactions
Here is my unit test, which tests out a new 'fake' API addPage to the PageManager. This API is temporary to test transactional behavior:
public void testTx() throws Exception
{
Folder root = pageManager.newFolder(&quot;/&quot;);
pageManager.updateFolder(root);
Page[] pages = new Page[3];
pages[0] = pageManager.newPage(&quot;/test1.psml&quot;);
pages[1] = pageManager.newPage(&quot;/test2.psml&quot;);
pages[2] = pageManager.newPage(&quot;/test3.psml&quot;);
try
{
pageManager.addPages(pages);
}
In addPages, I try to force a rollback:
public int addPages(Page[] pages)
throws JetspeedException
{
System.out.println(&quot;Adding first page&quot;);
this.updatePage(pages[0]);
System.out.println(&quot;Adding second page&quot;);
this.updatePage(pages[1]);
System.out.println(&quot;About to throw ex&quot;);
throw new JetspeedException(&quot;Its gonna blow captain!&quot;);
}
Finally, add pages is enabled for a Spring tx:
&lt;prop key=&quot;addPages*&quot;&gt;PROPAGATION_REQUIRED,-org.apache.jetspeed.exception.JetspeedException&lt;/prop&gt;
IsTransactionalFalse - Should work with optimistic transactions?
org.apache.jdo.tck.api.jdohelper.IsTransactionalFalse fails if in line 86 p1 is not persistent clean, but if the transaction is optimistic p1 is expected to be persistent non transactional, doesn't it?
Missing transaction begin in NontransactionalWriteTest
It seems that in org.apache.jdo.tck.lifecycle.NontransactionalWriteTest line 156 (after setOptimistic) a statement is missing:
pmConflict.currentTransaction().begin();
NoExtent - no no-arg constructor
Class org.apache.jdo.tck.pc.query.NoExtent is a persistence capable class that is missing a no-arg constructor.
org.apache.jdo.tck.lifecycle.NontransactionalWriteTest.conflictingUpdate() don't cleanup correctly in case of an Exception
org.apache.jdo.tck.lifecycle.NontransactionalWriteTest.conflictingUpdate() don't cleanup correctly in case of an Exception 
The cleanupPM(pmConflict); should be sourounded by a finaly block
Missing pm.close() in GetPersistenceManagerFactory
I suspect that pm.close() is missing at the end of method testGetPersistenceManagerFactory().
Typo in message logged upon startup when repository is already in use
As per subject
TCK: PredefinedNodeTypeTest does not allow additions to the predefined node types hierarchy
As explained in section 6.7.22.2 (page 147) of the JSR 170 specification, an implementation is allowed to customize a predefined noe type definition with additional supertypes. The tests in PredefinedNodeTypeTest do not account for that and expect an exact match with the predefined node types.
TCK: ExportDocViewTest.exportValues fails on empty multivalued property
In ExportDocViewTest.exportValues, line 988 fails if the property being exported is empty (array of size 0, which is allowed by the spec) since there is no space to remove. This code should be skipped if the number of values is zero.
TCK: Incorrect check of namespace mappings in System View XML export
org.apache.jackrabbit.test.api.SysViewContentHandler. In endDocument(), two issues:
1. line 351: tries to go through a table of prefixes but uses a fixed index inside the loop;
2. The mapping for the 'xml' prefix should be skipped (it must be registered in the Session but must not be registered during export since this is a built-in XML mapping.
the jcr:frozenUuid property is of type REFERENCE instead of STRING
The spec says that jcr:frozenUuid is a STRING but jackrabbit 1.0.1 uses a REFERENCE for it.
Removed version is not invalidated
when a version is removed, it's internal represenation is not evicted from the cache. this can leed to unexpected behaviours. XATest.removeVersion() tests this. this also happens in a non-transactional environment.
TCK does not clean 2nd workspace during AbstractJCRTest.setUp()
the XATest.testXAVersionsThoroughly fails if run 2 times, since the 2nd workspace is not cleaned on startup. will provide provisonairy fix.
Checks for optional features in test cases are wrong
Reported by David Sanders:
The TCK for JSR-170 Final Release
(http://jcp.org/aboutJava/communityprocess/final/jsr170/index.html)
checks for level 2 and optional features by comparing
Repository.getDescriptor to null. According to the
spec and javadoc, getDescriptor must return either
&quot;true&quot; or &quot;false&quot; for the &quot;capability&quot; keys.
Example in AbsractJCRest.java:
// setup custom namespaces
if
(helper.getRepository().getDescriptor(Repository.LEVEL_2_SUPPORTED)
!= null) {
NamespaceRegistry nsReg =
superuser.getWorkspace().getNamespaceRegistry();
I think the above if statement should be:
if
(helper.getRepository().getDescriptor(Repository.LEVEL_2_SUPPORTED)
.equals(&quot;true&quot;))
incorrect definition of built-in node type nt:hierarchyNode
the property jcr:created of nt:hierarchyNode should be non-mandatory according to the specification (jcr 1.0 and jcr 1.0.1).
both the definition of the built-in node type and the related test case should be fixed accordingly.
errors in text filters can cause indexing to fail without warning the client
i've opened this issue to track the discussion at &lt;http://thread.gmane.org/gmane.comp.apache.jackrabbit.devel/5086&gt;. briefly, exceptions thrown by text filters are logged and swallowed by jackrabbit; there's no way for a text filter to signal to the jcr client that indexing failed.
some solutions have been proposed, including throwing an unchecked exception, which doesn't allow jackrabbit to maintain transactional integrity, and giving filters veto power over the observed repository operation. depending on the difficulty of the solution that is eventually determined to be correct, it may be sufficient for 1.0 to document the issue and perhaps improve the warning/error logging.
Removal of versions throws javax.jcr.ReferentialIntegrityException
From the following thread : http://www.mail-archive.com/jackrabbit-dev%40incubator.apache.org/msg03483.html
When trying to remove a version of a Node the VersionHistory.removeVersion() method throws : &quot;javax.jcr.ReferentialIntegrityException: Unable to remove version. At least once referenced.&quot;.
Secton 8.2.2.10 (Removal of Versions) of the specification indicates that the version graph should be automatically repaired upon removal. Then, VersionHistory.removeVersion() should take care of references. (In fact, a user cannot alter the references (jcr:predecessors and jcr:successors), since they are protected properties.)
Here's the example (*updated) :
Node root1 = session.getRootNode() ;
Node test1 = root1.addNode(&quot;test&quot;) ;
test1.addMixin(&quot;mix:versionable&quot;);
test1.setProperty(&quot;test&quot;, &quot;1&quot;);
session.save();
test1.checkin();
test1.checkout();
test1.setProperty(&quot;test&quot;, &quot;2&quot;);
session.save();
test1.checkin();
test1.checkout();
test1.setProperty(&quot;test&quot;, &quot;3&quot;);
session.save();
test1.checkin();
String baseVersion = test1.getBaseVersion().getName();
System.out.println(&quot;Base version name: &quot; + baseVersion);
VersionHistory vh = test1.getVersionHistory();
for (VersionIterator vi = vh.getAllVersions(); vi.hasNext(); ) {
Version currenVersion = vi.nextVersion();
String versionName = currenVersion.getName();
if (!versionName.equals(&quot;jcr:rootVersion&quot;) &amp;&amp; !versionName.equals(baseVersion)) { 
String propertyValue = currenVersion.getNode(&quot;jcr:frozenNode&quot;).getProperty(&quot;test&quot;).getString();
System.out.println(&quot;Removing version : &quot; + versionName + &quot; with value: &quot; + propertyValue);
vh.removeVersion(versionName);
}
}
Regards, 
Nicolas
NPE is issued when receiving a &quot;read receipt&quot; from MS Outlook, and &lt;checkValidSenderDomain&gt; is set to true
A NPE is issued when receiving a &quot;read receipt&quot; from MS Outlook (not Outlook express nor Thunderbird), and &lt;checkValidSenderDomain&gt; is set to true and the sender IP address is not in &lt;authorizedAddresses&gt;:
27/07/06 17:17:00 ERROR smtpserver: Exception opening socket: null
java.lang.NullPointerException
at org.apache.james.smtpserver.MailCmdHandler.doMAIL(MailCmdHandler.java:210)
at org.apache.james.smtpserver.MailCmdHandler.onCommand(MailCmdHandler.java:83)
at org.apache.james.smtpserver.SMTPHandler.handleConnection(SMTPHandler.java:391)
at org.apache.james.util.connection.ServerConnection$ClientConnectionRunner.run(ServerConnection.java:422)
at org.apache.excalibur.thread.impl.ExecutableRunnable.execute(ExecutableRunnable.java:55)
at org.apache.excalibur.thread.impl.WorkerThread.run(WorkerThread.java:116)
Annoying logging of whitelist/blacklist nomatching as &quot;unknown host exception thrown: listname&quot; if INFO is enabled
When a checkDNSRBL is done, in case getLogger().isInfoEnabled() is true, both successfull and unsuccessfull matches are being logged.
While successfull matches are useful to log as INFO, the much more frequent unsuccessfull matches are logged as &quot;unknown host exception thrown: listname&quot;, heavily increasing the size of the log file. Such log message is useful only in DEBUG mode.
James insert a Return-Path: null in outgoing email
At the moment james insert a Return-Path: null to outgoing emails. That is not correct. On outgoing emails no Return-Path should be insert.
From RFC (http://www.faqs.org/rfcs/rfc821.html):
When the receiver-SMTP makes the &quot;final delivery&quot; of a
message it inserts at the beginning of the mail data a
return path line. The return path line preserves the
information in the &lt;reverse-path&gt; from the MAIL command.
Here, final delivery means the message leaves the SMTP
world. Normally, this would mean it has been delivered to
the destination user, but in some cases it may be further
processed and transmitted by another mail system.
We have also to get sure what todo if there is allready one ( should never happen). Should we keep the header or strip it.
Fastfail DNSRBL blacklisted messages are rejected even if the sender user is successfully SMTP AUTHenticated
A fastfail DNSBRL blacklisted message is rejected even if the sender user is successfully SMTP AUTHenticated.
Instead in such case the message should be accepted.
This bug is particularly critical in the scenario in which a blacklist that lists dynamic IP ranges (like &quot;dul.dnsbl.sorbs.net&quot;) is being used, and a legitimate and SMTP AUTHenticated mail client roaming user connects from a dynamic IP and tries to send a mail to the James server. He will be rejected in such case.
BTW, just FYI, statistics on my production server show that using fastfail DNSBRL blacklists and the Bayesian mailet, about 20% of the spam gets rejected by the &quot;dul.dnsbl.sorbs.net&quot; list, 65% by the other James stock configuration lists, and almost all of the remaining 15% is detected (and flagged for inspection) by the Bayesian mailet. Without the &quot;dul.dnsbl.sorbs.net&quot; about 34% is detected and flagged by the Bayesian mailet but has to be manually inspected to avoid false positives, and 1% is undetected. So the dynamic IP criteria is very effective but, to be used, this bug has to be fixed.
User aliasing does not work
If user A is an alias of user B ( or viceversa - remote manager help is misleading) messages sent to A have to go (and were going) to B's inbox. Now it ends in A's inbox, that should not even exist.
The problem has been found by me using both &quot;file&quot; and &quot;db&quot; repositories under 2.3.0b2, but I expect it to occur also under 3.0.
SetMimeHeader not throw an MessagingException if needed config values missed
SetMimeHeader not throw an Exception if needed config values missed
Message body get lost after call saveChanges() and move to other processor
After call saveChanges() in a mailet and move the mail to a other processor with ToProcessor the whole messageBody getting lost.
Set the right svn property for excutable files
Set the right properties for files which should be excutable in linux systems
Rename all pmc@ lists private@
Currently the new account creation scripts assume the name of a pmc lists is pmc@tlp.
This is no longer true; new tlp's are being created with private@tlp instead. Unfortunately
the account creation script assumes the pmc list is named pmc@tlp.
I would like to fix the account creation script by assuming every pmc can be reached via
private@tlp. I don't care if the existing lists are renamed, or additional aliases are created.
The board passed some resolution in this regard, it's probably time we started enforcing it.
Maven repositories not being synchronized?
(Not sure if this is the correct place to ask, please let me know where to go if not.)
Has there been some changes in the way the Maven 1 repository at .../dist/java-repository is synchronized with the repository at Ibiblio? I published the recently released Apache Jackrabbit 1.0.1 artifacts in the Apache Maven 1 repository, but after ten days the files are still not available at Ibiblio.
Compare:
http://www.ibiblio.org/maven/org.apache.jackrabbit/jars/
http://www.apache.org/dist/java-repository/org.apache.jackrabbit/jars/
SPF Records for incubator.apache.org are wrong.
Just noticed this:
May 22 17:07:57 babsi milter-greylist: k4MF7unQ032416: addr 209.237.227.194 from =apache.org@incubator.apache.org&gt; to &lt;hps@intermeta.de&gt; delayed for 00:10:00
May 22 17:07:57 babsi sm-mta[32416]: k4MF7unQ032416: Milter: to=&lt;hps@intermeta.de&gt;, reject=451 4.7.1 Greylisting in action, please come back in 00:10:00
May 22 17:07:57 babsi sm-mta[32416]: k4MF7unQ032416: from=&lt;general-return-8921-apmail-henning=apache.org@incubator.apache.org&gt;, size=0, class=0, nrcpts=0, proto=SMTP, daemon=MTA, relay=minotaur.apache.org [209.237.227.194]
Which is correct:
incubator.apache.org. 1800 IN TXT &quot;v=spf1 mx -all&quot;
incubator.apache.org. 1788 IN MX 20 mail.apache.org.
incubator.apache.org. 1788 IN MX 10 asf.osuosl.org.
But minotaur sends out mail for the incubator.apache.org lists. So it should be reflected in the SPF record.
Most other domains (e.g. maven.apache.org / jakarta.apache.org) seem to work fine, BTW:
May 22 18:38:38 tangens sm-mta[19793]: k4MGcafU019793: from=&lt;users-return-48007-mailgate=hometree.net@maven.apache.org&gt;, size=6443, class=-60, nrcpts=1, msgid=&lt;1a5b6c410605220938n7ae39ea4t251db25494395fd5@mail.gmail.com&gt;, proto=SMTP, daemon=MTA, relay=hermes.apache.org [209.237.227.199]
May 22 18:38:38 tangens sm-mta[19793]: k4MGcafU019793: Milter add: header: X-Greylist: Sender is SPF-compliant, not delayed by milter-greylist-2.0.2 (mail.hometree.net [194.77.152.181]); Mon, 22 May 2006 18:38:38 +0200 (CEST)
Issue with resultMapping &amp; constructor injection
Issue when only using one resultMapping
Detected by Peter Mills
Support discriminators when used via the &quot;resultMapping&quot; attribute
From Peter Mills 
I'm using the latest svn version of iBatis mapper (version 1.5 + a few
fixes), and I'm experiencing two problems with using resultmappings.
Both constructor injection and discriminators do not appear to be
supported in result maps that are linked via the &quot;resultMapping&quot;
attribute. I can write up a basic example of both of these problems, if
it would be helpful.
Issue with a result map constructor in a result property
Issue with a resultMap with a result property using another resultMap and where
- the result property resultMap use a constructor
- all this constructor arguments are null.
Issue with constructor tag where an argument use another constructor tag
Issue when using a constructor with an argument using a resultMapping where
- resulMap argument use another constructor
- all second constructor arguments are null.
Issue with QueryForList with constructor resultMap and select argument
Sample
&lt;resultMap id=&quot;SchemaComptable-Result&quot; class=&quot;SchemaComptable&quot;&gt;
&lt;constructor&gt;
&lt;argument argumentName=&quot;id&quot; column=&quot;SchemaComptableId&quot; /&gt;
&lt;argument argumentName=&quot;code&quot; column=&quot;SchemaComptableCode&quot; /&gt;
&lt;argument argumentName=&quot;libelle&quot; column=&quot;SchemaComptableLibelle&quot; /&gt;
&lt;argument argumentName=&quot;comptesImputation&quot; column=&quot;Id=SchemaComptableId&quot; select=&quot;RechercherComptesImputation&quot; /&gt; 
&lt;/constructor&gt;
&lt;/resultMap&gt;
auto-result-map Bug
Are you aware that field names conflict with property names when automapping columns? So a class written like:
public class Customer
{
private int id;
public int ID
{
get { return id; }
set { id = value; } 
}
}
... will cause iBATIS.NET to fail with:
CustomerRepositoryTest.ShouldGetCustomerByID : IBatisNet.DataMapper.Exceptions.DataMapperException : Error automapping columns. Cause: Item has already been added. Key in dictionary: 'ID' Key being added: 'ID'
----&gt; System.ArgumentException : Item has already been added. Key in dictionary: 'ID' Key being added: 'ID'
SqlMap.xsd Correction
&lt;xs:element name=&quot;resultMap&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element ref=&quot;constructor&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;1&quot;/&gt;
&lt;xs:element ref=&quot;result&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;xs:element ref=&quot;discriminator&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;1&quot;/&gt;
&lt;xs:element ref=&quot;subMap&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;xs:attribute name=&quot;id&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;xs:attribute name=&quot;class&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;xs:attribute name=&quot;extends&quot; type=&quot;xs:string&quot;/&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
Add minOccurs=&quot;0&quot; on &lt;xs:element ref=&quot;result&quot; maxOccurs=&quot;unbounded&quot;/&gt;
The parameter class reflection does not work anymore
Hello.
We have upgraded our project from dnf 1.1 to dnf 2.0 vs2005, so we have upgraded to Data Mapper 1.5 (from 1.3).
It seams that the dynamic class reflection for the query parameters does not work anymore in 1.5, in the 1.3 version it work just fine. It is really a blocking situation for us, because...it simply does not work anymore :(
We are using a solution where the parameter that we are passing is a &quot;generic&quot; one, and has this definition: 
public class Query
{ 
private Object _DataObject;
public Object DataObject{get{return _DataObject; }set { _DataObject = value;}}
private Object _ParametersObject;
public object ParametersObject{get { return _ParametersObject; }set { _ParametersObject = value; }}
}
Then we are passing to iBatis (by internal convention) the &quot;parameters&quot; embeded in the Query class, here is an example:
obj_Query.ParametersObject = Parameters; //here we are setting our Parameters object
obj_Query.DataObject = Labels[0]; //here we are setting our Business Object
objLabel = (Label) Helpers.Label().Read(obj_Query); //here we are calling by passing the query object
Assert.IsNotNull (objLabel, &quot;Label not returned&quot;);
.............................................................................................
public override System.Object Read(System.Object obj)
{
Labels objLabel = (Label) Mapper ().QueryForObject(&quot;SelectLabel&quot;,obj);
return(objLabel);
}
The mapped statemend in the sqlmap file is as follows:
&lt;select id=&quot;SelectLabel&quot; parameterClass=&quot;Query&quot; resultMap=&quot;LabelResult&quot;&gt;
select *
from ll_label_language
&lt;dynamic prepend=&quot;WHERE&quot;&gt;
&lt;isParameterPresent&gt;
&lt;isNotNull property=&quot;DataObject&quot;&gt;
&lt;isGreaterThan property=&quot;DataObject.Id&quot; compareValue=&quot;0&quot; prepend=&quot;AND&quot;&gt;
label_language_id = #DataObject.Id# 
&lt;/isGreaterThan&gt;
&lt;isGreaterThan property=&quot;DataObject.LabelId&quot; compareValue=&quot;0&quot; prepend=&quot;AND&quot;&gt;
label_id = #DataObject.LabelId# 
&lt;/isGreaterThan&gt; 
&lt;/isNotNull&gt;
&lt;isNotNull property=&quot;ParametersObject&quot; prepend=&quot;AND&quot;&gt;
language_id = #ParametersObject.LanguageId#
&lt;/isNotNull&gt;
&lt;/isParameterPresent&gt;
&lt;/dynamic&gt;
&lt;/select&gt;
iBatis 1.5 returns this error (it does not understand that the DataObject is in fact a Label, and not an Object):
failed: IBatisNet.Common.Exceptions.ConfigurationException : 
- The error occurred while loading SqlMap.
- parse dynamic tags on sql statement
- The error occurred in &lt;sqlMap resource=&quot;${root}Resources/LabelHelper.xml&quot; xmlns=&quot;http://ibatis.apache.org/dataMapper&quot; /&gt;. 
- Check the SelectLabel.
----&gt; IBatisNet.Common.Exceptions.ProbeException : There is no Get member named 'Id' in class 'Object'
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.Build(XmlDocument document, DataSource dataSource, Boolean useConfigFileWatcher, Boolean isCallFromDao)
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.ConfigureAndWatch(String resource, ConfigureHandler configureDelegate)
at IBatisNet.DataMapper.Mapper.InitMapper()
at IBatisNet.DataMapper.Mapper.Instance()
C:\Documents and Settings\Administrator\Favorites\LogiqLibrary\Source\LL\LL_BusinessObjects\Helper.cs(18,0): at LL_BusinessObjects.Helper.Mapper()
C:\Documents and Settings\Administrator\Favorites\LogiqLibrary\Source\LL\LL_BusinessObjects\LanguageHelper.cs(17,0): at LL_BusinessObjects.LanguageHelper.ReadList(Object obj)
C:\Documents and Settings\Administrator\Favorites\LogiqLibrary\Source\LL\LL_Tests\DAL_tests.cs(27,0): at LL_Tests.DAL_tests.LanguageSelects()
--ConfigurationException
at IBatisNet.Common.Utilities.Objects.ReflectionInfo.GetGetterType(String memberName)
at IBatisNet.Common.Utilities.Objects.ObjectProbe.GetMemberTypeForGetter(Type type, String memberName)
at IBatisNet.DataMapper.Configuration.ParameterMapping.InlineParameterMapParser.ResolveTypeHandler(TypeHandlerFactory typeHandlerFactory, Type parameterClassType, String propertyName, String propertyType, String dbType)
at IBatisNet.DataMapper.Configuration.ParameterMapping.InlineParameterMapParser.NewParseMapping(String token, Type parameterClassType, IScope scope)
at IBatisNet.DataMapper.Configuration.ParameterMapping.InlineParameterMapParser.ParseInlineParameterMap(IScope scope, IStatement statement, String sqlStatement)
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.ParseDynamicTags(XmlNode commandTextNode, IDynamicParent dynamic, StringBuilder sqlBuffer, Boolean isDynamic, Boolean postParseRequired, IStatement statement)
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.ParseDynamicTags(XmlNode commandTextNode, IDynamicParent dynamic, StringBuilder sqlBuffer, Boolean isDynamic, Boolean postParseRequired, IStatement statement)
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.ParseDynamicTags(XmlNode commandTextNode, IDynamicParent dynamic, StringBuilder sqlBuffer, Boolean isDynamic, Boolean postParseRequired, IStatement statement)
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.ParseDynamicTags(XmlNode commandTextNode, IDynamicParent dynamic, StringBuilder sqlBuffer, Boolean isDynamic, Boolean postParseRequired, IStatement statement)
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.ParseDynamicTags(XmlNode commandTextNode, IDynamicParent dynamic, StringBuilder sqlBuffer, Boolean isDynamic, Boolean postParseRequired, IStatement statement)
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.ProcessSqlStatement(IStatement statement)
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.ConfigureSqlMap()
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.Initialize()
at IBatisNet.DataMapper.Configuration.DomSqlMapBuilder.Build(XmlDocument document, DataSource dataSource, Boolean useConfigFileWatcher, Boolean isCallFromDao)
Thank you for your support.
Cristian Manea
www.atypiqsoftware.ro
JDBC driver properties not added to driver/connection when using DBCP
According to issue ibatis-78, support for driver properties for DBCP was added. However, if I configure my SqlMapConfig.xml (as descriped in the documentation) to add driver properties , the driver properties are not added:
&lt;dataSource type=&quot;DBCP&quot;&gt;
&lt;property name=&quot;JDBC.Driver&quot; value=&quot;${driver}&quot;/&gt;
&lt;property name=&quot;JDBC.ConnectionURL&quot; value=&quot;${url}&quot;/&gt;
&lt;property name=&quot;JDBC.Username&quot; value=&quot;${username}&quot;/&gt;
&lt;property name=&quot;JDBC.Password&quot; value=&quot;${password}&quot;/&gt;
&lt;property value=&quot;someValue&quot; name=&quot;Driver.DriverSpecificProperty&quot;/&gt;
&lt;/dataSource&gt;
I had a look into the source code in the class com.ibatis.common.jdbc.DbcpConfiguration. As far as I understood, any driver properties configured by &quot;Driver.&quot; get only added by the method DbcpConfiguration.newDbcpConfiguration(properties) which never gets inovoked if the &lt;dataSource type=&quot;DBCP&quot;&gt; element contains a &lt;property=&quot;JDBC.Driver&quot; ... /&gt; element.
How else could I add driver/connection specific properties using DBCP as data source?
Regards,
Florian
setUp method in ScannerTest uses 'localhost' as the first parameter of java.net.InetSocketAddress() method
setUp method in ScannerTest uses 'localhost' as the first
parameter of java.net.InetSocketAddress() method, should use '127.0.0.1'
instead to remove platform dependency.
[classlib][text] unexpected StringIndexOutOfBoundsException for java.text.NumberFormat.parseObject(String source, ParsePosition pos &lt; 0)
The spec says for java.text.NumberFormat.parseObject(String source, ParsePosition pos ): &quot; In case of error, returns null.&quot;
The harmony throws StringIndexOutOfBoundsException for negative position while RI returns null.
================ test.java ===================
import java.text.*;
public class test { 
public static void main (String[] args) { 
System.out.println(&quot;res = &quot; + NumberFormat.getInstance().parseObject(&quot;0&quot;, new ParsePosition(-1))); 
}
}
==========================================
Output:
C:\tmp\tmp17&gt;rem C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -Djava.security.auth.login.config=config -showversion test
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
res = null
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Exception in thread &quot;main&quot; java.lang.StringIndexOutOfBoundsException
at java.lang.String.charAt(String.java:560)
at com.ibm.icu.text.UTF16.charAt(UTF16.java:188)
at com.ibm.icu.text.DecimalFormat.compareSimpleAffix(DecimalFormat.java:1908)
at com.ibm.icu.text.DecimalFormat.compareAffix(DecimalFormat.java:1850)
at com.ibm.icu.text.DecimalFormat.subparse(DecimalFormat.java:1572)
at com.ibm.icu.text.DecimalFormat.parse(DecimalFormat.java:1468)
at com.ibm.icu.text.DecimalFormat.parse(DecimalFormat.java:1403)
at java.text.DecimalFormat.parse(DecimalFormat.java:417)
at java.text.NumberFormat.parseObject(NumberFormat.java:458)
at test.main(test.java:5)
[classlib][nio] java.nio.channels.spi.SelectorProvider.provider() does not load class from jar correctly
java.nio.channels.spi.SelectorProvider.provider() does not load class from jar correctly, espeically when a jar file start with comment, i.e. as following format
# this is a sample jar of SelectorProvider
com.andrew.Provider
Harmony doesn't load any provider while RI can correctly load the specified class. 
Following test reproduces the bug. The test should be run in seperate vm. 
public void test_provider () throws Exception {
SelectorProvider provider = SelectorProvider.provider();
System.out.println(provider);
}
Put test_sample.jar in the run classpath. And put com.andrew.Provider in the project. 
RI output:
com.andrew.Provider@7bd9f2
Harmony output:
org.apache.harmony.nio.internal.SelectorProviderImpl@782a782a
I'll upload a patch to fix this problem soon.
Thanks!
Best regards,
Andrew
[classlib][beans] removing ecj warnings from beancontext tests
The attached patch removes 38 (i.e. all) ecj warnings from tests that belong to org.apache.harmony.beans.tests.java.beans.beancontext package. The list of affected classes is below:
org/apache/harmony/beans/tests/java/beans/beancontext/BeanContextChildSupportTest
org/apache/harmony/beans/tests/java/beans/beancontext/BeanContextEventTest
org/apache/harmony/beans/tests/java/beans/beancontext/BeanContextMembershipEventTest
org/apache/harmony/beans/tests/java/beans/beancontext/BeanContextMembershipEventTest
org/apache/harmony/beans/tests/java/beans/beancontext/BeanContextServiceAvailableEventTest
org/apache/harmony/beans/tests/java/beans/beancontext/BeanContextServiceRevokedEventTest
org/apache/harmony/beans/tests/java/beans/beancontext/BeanContextServicesSupportTest
org/apache/harmony/beans/tests/java/beans/beancontext/BeanContextSupportTest
java/beans/beancontext/BeanContextSupportTest
What have been changed:
* serial version UUIDs were added
* templates applied where appropriate
* unused variables removed
* two mock tests were commented out
java.util.Calendar: large hours, minutes and seconds are handled incorrectly
svn = r426060, (Jul 27 2006), Windows/ia32/msvc 1310, debug build
The following code:
import java.util.*;
public class Test {
public static void main (String[] args) { 
Calendar cal = new GregorianCalendar();
cal.set(1900, 0, 0, 0, Integer.MAX_VALUE); 
System.out.println(cal.getTime());
} 
} 
Prints in RI:
Sun Jan 23 02:07:02 MSK 5983
and in Harmony
Sat Dec 30 23:59:13 MSK 1899
That happens because in calculation of long value (millisecond) right side is int * int which can overflow. Casting int values to long solves this problem. Please see the patch attached.
[classlib][nio]java.nio.channels.FileLock.release() fails to throw ClosedChannelException if the related file channel is closed.
Hi,
java.nio.channels.FileLock.release() does not throw ClosedChannelException
if the related file channel has been closed on Harmony while RI does.
test:
public void test_release() throws Exception {
File file = File.createTempFile(&quot;test&quot;, &quot;tmp&quot;);
file.deleteOnExit();
FileOutputStream fout = new FileOutputStream(file);
FileChannel fileChannel = fout.getChannel();
FileLock fileLock = fileChannel.lock();
fileChannel.close();
try {
fileLock.release();
fail(&quot;should throw ClosedChannelException&quot;);
} catch (ClosedChannelException e) {
// expected
}
}
The test passes against RI while fails against Harmony.
[classlib][nio]java.nio.channels.FileChannel.read(ByteBuffer,long) fails to read with a positioned bytebuffer correctly.
Hi,
java.nio.channels.FileChannel.read(ByteBuffer,long) fails to read with a positioned bytebuffer correctly.
testcase:
public void test_readLByteBufferJ() throws Exception {
writeDataToFile(fileOfReadOnlyFileChannel);
ByteBuffer readBuffer = ByteBuffer.allocate(CAPACITY);
final int BUFFER_POSITION = 1;
readBuffer.position(BUFFER_POSITION);
final int POSITION = 2;
int result = readOnlyFileChannel.read(readBuffer, POSITION);
assertEquals(CONTENT_AS_BYTES_LENGTH - POSITION, result);
assertEquals(BUFFER_POSITION + result, readBuffer.position());
readBuffer.flip();
readBuffer.position(BUFFER_POSITION);
for (int i = POSITION; i &lt; CONTENT_AS_BYTES_LENGTH; i++) {
assertEquals(CONTENT_AS_BYTES[i], readBuffer.get());
}
}
It passes against RI while fails against Harmony
java.util.TreeMap throws NotSerializableException
NotSerializableException occurs when trying to serialize a java.util.TreeMap object that has entrySet() method called before.
The cause for this is TreeMap class is serialized by defaultWriteObject(), and it contains a non-transient field, entrySet, that is initialized in entrySet() method by an instance of AbstractSet class that is not Serializable.
Suggested fix: make entrySet field transient.
Here's the code to reproduce the bug:
import java.io.*;
import java.util.*;
public class SerializationTreeMapTest {
public static void main(String[] args) {
try {
TreeMap map = new TreeMap();
map.entrySet();
ByteArrayOutputStream bOut = new ByteArrayOutputStream();
ObjectOutputStream oOut = new ObjectOutputStream(bOut);
oOut.writeObject(map);
System.out.println(&quot;SUCCESS&quot;);
} catch (Exception e) {
e.printStackTrace();
}
}
}
and here's the output:
C:\&gt; java SerializationTreeMapTest
java.io.NotSerializableException: java.util.TreeMap$1
at java.io.ObjectOutputStream.writeNewObject(ObjectOutputStream.java:1624)
at java.io.ObjectOutputStream.writeObjectInternal(ObjectOutputStream.java:1932)
at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:1768)
at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:1732)
at java.io.ObjectOutputStream.writeFieldValues(ObjectOutputStream.java:1241)
at java.io.ObjectOutputStream.defaultWriteObject(ObjectOutputStream.java:327)
at java.util.TreeMap.writeObject(TreeMap.java:1422)
at java.lang.reflect.VMReflection.invokeMethod(VMReflection.java)
at java.lang.reflect.Method.invoke(Method.java:183)
at java.io.ObjectOutputStream.writeHierarchy(ObjectOutputStream.java:1318)
at java.io.ObjectOutputStream.writeNewObject(ObjectOutputStream.java:1658)
at java.io.ObjectOutputStream.writeObjectInternal(ObjectOutputStream.java:1932)
at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:1768)
at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:1732)
at SerializationTreeMapTest.main(SerializationTreeMapTest.java:11)
[text] DecimalFormat ignores settings in DecimalFormatSymbols
DecimalFormat ignores settings in DecimalFormatSymbols. It always uses what is set in OS.
Consider the test case:
import java.text.DecimalFormat;
import java.text.DecimalFormatSymbols;
public class TestDecimalFormat {
public static void main(String[] args) {
final DecimalFormat df = new DecimalFormat();
System.out.println(df.format(1.02));
final DecimalFormatSymbols dfs = df.getDecimalFormatSymbols();
dfs.setDecimalSeparator('.');
df.setDecimalFormatSymbols(dfs);
System.out.println(df.format(1.02));
System.out.println(new DecimalFormat(&quot;#.##&quot;, dfs).format(1.02));
}
}
The ouput on Harmony:
1,02
1,02
1,02
The expected output (when on the RI):
1,02
1.02
1.02
org.apache.harmony.crypto.utils.AlgNameMapper overrides hardcoded mappings and determines OIDs incorrectly.
org.apache.harmony.crypto.utils.AlgNameMapper in some cases overrides default hardcoded mappings which are not to be overridden (according to description in comments) by the ones from providers. 
The method isOID(String) of the class determines if the given algorithm name is an OID or not in an incorrect way. 
import org.apache.harmony.crypto.utils.AlgNameMapper;
public class AlgNameMapperTest {
public static void main(String[] args) {
// check a hardcoded mapping
String standardName = AlgNameMapper.getStandardName(&quot;PBEWITHSHAAND40BITRC2-CBC&quot;);
if (!standardName.equalsIgnoreCase(&quot;pbeWithSHAAnd40BitRC2-CBC&quot;)){
System.out.println(&quot;getStandardName(..) FAILED!&quot;);
}
// check if the algorithm name is an OID
if (AlgNameMapper.isOID(&quot;not.an.oid&quot;)){
System.out.println(&quot;isOID(..) FAILED!&quot;);
}
} 
}
The patch included resolves the problems noted. It also widens the functionality of the mapper to search for signature mappings in providers (currently only Cipher and AlgorithmParameters are searched).
[classlib][nio]FileChannelImpl.write(ByteBuffer[] buffers, int offset, int length) checks wrong range.
Hello,
FileChannelImpl.write(ByteBuffer[] buffers, int offset, int length) contains a bug. It should write all buffers whose offset is larger than(equals to) the given offset and less than length plus offset. Currently, it uses length instead of length plus offset.
It is in line: 628
write(ByteBuffer[] buffers, int offset, int length){
......
for (int i = offset; i &lt; length; i++) // must be &quot; i &lt; length + offset&quot;
......
}
working_vm does not compile on stock ubuntu
running &quot;ant&quot; in &quot;trunk&quot; fails in working_vm. It might be a icc assumption which does not work with my gcc?
Commented proxy properties should be removed
make/depends.properties file includes the following text:
=== cut ===
# Uncomment the following two lines to use a HTTP proxy to download the
# dependencies (and change the values as appropriate).
# http.proxyHost=proxy.server.address
# http.proxyPort=80
=== cut ===
This lines should be removed since we decided not to use these properties and set proxy via ANT_OPTS variable.
[classlib][nio] compatibility: java.nio.channels.FileChannel.truncate, transferTo throw different exeptions from RI.
java.nio.channels.FileChannel.truncate, transferTo throw different exeptions from RI.
Following tests reproduce the problems:
public void test_truncateJ_Exception() throws Exception {
File testFile = File.createTempFile(&quot;test&quot;, &quot;tmp&quot;);
testFile.deleteOnExit();
FileChannel readOnlyFileChannel = new FileInputStream(testFile)
.getChannel();
try {
readOnlyFileChannel.truncate(-1);
fail(&quot;should throw IllegalArgumentException&quot;);
} catch (IllegalArgumentException e) {
// expected
}
}
public void test_transferTo_Exception() throws Exception {
File testFile1 = File.createTempFile(&quot;test&quot;, &quot;tmp&quot;);
File testFile2 = File.createTempFile(&quot;test&quot;, &quot;tmp&quot;);
testFile1.deleteOnExit();
testFile2.deleteOnExit();
FileChannel readOnlyFileChannel = new FileInputStream(testFile1)
.getChannel();
FileChannel readWriteFileChannel = new RandomAccessFile(testFile2, &quot;rw&quot;)
.getChannel();
// first throws NonWritableChannelException even arguments are illegal.
try {
readWriteFileChannel.transferTo(-1, 10, readOnlyFileChannel);
fail(&quot;should throw NonWritableChannelException.&quot;);
} catch (NonWritableChannelException e) {
// expected
}
try {
readWriteFileChannel.transferTo(0, -1, readOnlyFileChannel);
fail(&quot;should throw NonWritableChannelException.&quot;);
} catch (NonWritableChannelException e) {
// expected
}
}
Both tests pass against RI while fail against Harmony.
I'll upload to fix these problems soon.
Best regards,
Andrew
[kernel] fix for launching Eclipse 3.2
The Eclipse 3.2 fails to start on DRLVM: it shows a splash screen and crashes with a bunch of Exceptions:
!ENTRY org.eclipse.osgi 4 0 2006-07-21 12:45:31.656
!MESSAGE An error occurred while automatically activating bundle org.eclipse.core.runtime.compatibility (25).
!STACK 0
org.osgi.framework.BundleException: Exception in org.eclipse.core.internal.plugins.CompatibilityActivator.start() of bundle org.eclipse.core.runtime.compatibility.
at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:1014)
at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:970)
at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:317)
at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(AbstractBundle.java:256)
at org.eclipse.core.runtime.internal.adaptor.EclipseLazyStarter.preFindLocalClass(EclipseLazyStarter.java:86)
at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findLocalClass(ClasspathManager.java:409)
at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.findLocalClass(DefaultClassLoader.java:188)
at org.eclipse.osgi.framework.internal.core.BundleLoader.findLocalClass(BundleLoader.java:339)
at org.eclipse.osgi.framework.internal.core.BundleLoader.findClass(BundleLoader.java:391)
at org.eclipse.osgi.framework.internal.core.BundleLoader.findClass(BundleLoader.java:352)
at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:83)
at java.lang.ClassLoader.loadClass(ClassLoader.java:318)
at org.eclipse.osgi.framework.internal.core.BundleLoader.loadClass(BundleLoader.java:276)
at org.eclipse.osgi.framework.internal.core.BundleHost.loadClass(BundleHost.java:227)
at org.eclipse.osgi.framework.internal.core.AbstractBundle.loadClass(AbstractBundle.java:1245)
at org.eclipse.core.internal.runtime.CompatibilityHelper.getPluginDescriptor(CompatibilityHelper.java:63)
at org.eclipse.core.runtime.Plugin.initializeDescriptor(Plugin.java:706)
at org.eclipse.core.runtime.Plugin.start(Plugin.java:692)
at org.eclipse.core.internal.runtime.PlatformActivator.start(PlatformActivator.java:39)
at org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run(BundleContextImpl.java:995)
at java.security.AccessController.doPrivilegedImpl(AccessController.java:118)
at java.security.AccessController.doPrivileged(AccessController.java:79)
at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:989)
at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:970)
at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:317)
at org.eclipse.osgi.framework.internal.core.AbstractBundle.resume(AbstractBundle.java:329)
at org.eclipse.osgi.framework.internal.core.Framework.resumeBundle(Framework.java:1037)
at org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles(StartLevelManager.java:573)
at org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL(StartLevelManager.java:495)
at org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel(StartLevelManager.java:275)
at org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent(StartLevelManager.java:455)
at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:189)
at org.eclipse.osgi.framework.eventmgr.EventManager$EventThread.run(EventManager.java:291)
Caused by: java.lang.NoClassDefFoundError: org/eclipse/core/runtime/Plugin
at java.lang.reflect.VMReflection.getMethodReturnType(VMReflection.java)
at java.lang.reflect.Method$MethodData.initReturnType(Method.java:343)
at java.lang.reflect.Method.getReturnType(Method.java:149)
at java.lang.Class$ReflectionData.isMethodMatches(Class.java:1101)
at java.lang.Class$ReflectionData.mergeMethods(Class.java:1114)
at java.lang.Class$ReflectionData.initPublicMethods(Class.java:1092)
at java.lang.Class.getMethod(Class.java:462)
at org.eclipse.core.internal.runtime.CompatibilityHelper.setPlugin(CompatibilityHelper.java:48)
at org.eclipse.core.internal.plugins.CompatibilityActivator.start(CompatibilityActivator.java:23)
at org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run(BundleContextImpl.java:995)
at java.security.AccessController.doPrivilegedImpl(AccessController.java:118)
at java.security.AccessController.doPrivileged(AccessController.java:79)
at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:989)
at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:970)
... 31 more
[classlib][nio]java.nio.?hannel.DatagramChannel.read(ByteBuffer[] , int, Integer.MAX_VALUE) throws NotYetConnectedException while RI throws IndexOutOfBoundsException
The Harmony methods java.nio.?hannel.DatagramChannel.read/write(ByteBuffer[] , int, Integer.MAX_VALUE) throws NotYetConnectedException while RI throws IndexOutOfBoundsException.
==================== test.java ======================
import java.nio.channels.*;
import java.nio.*;
public class test { 
public static void main (String[] args) { 
try { 
DatagramChannel.open().read(new ByteBuffer[] {}, 2, Integer.MAX_VALUE); 
} catch (Exception e) {
e.printStackTrace(); 
} 
try { 
DatagramChannel.open().write(new ByteBuffer[] {}, 2, Integer.MAX_VALUE); 
} catch (Exception e) {
e.printStackTrace(); 
} 
}
}
=================================================
Output:
C:\tmp\tmp17&gt;C:\jdk1.5.0_06\bin\java.exe -cp . -showversion test
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
java.lang.IndexOutOfBoundsException
at sun.nio.ch.DatagramChannelImpl.read(DatagramChannelImpl.java:366)
at test.main(test.java:8)
java.lang.IndexOutOfBoundsException
at sun.nio.ch.DatagramChannelImpl.write(DatagramChannelImpl.java:429)
at test.main(test.java:13)
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
OutOfMemoryError
-------end of stacktrace
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.nio.channels.NotYetConnectedException
at org.apache.harmony.nio.internal.DatagramChannelImpl.checkOpenConnected(DatagramChannelImpl.java:567)
at org.apache.harmony.nio.internal.DatagramChannelImpl.read(DatagramChannelImpl.java:387)
at test.main(test.java:8)
java.nio.channels.NotYetConnectedException
at org.apache.harmony.nio.internal.DatagramChannelImpl.checkOpenConnected(DatagramChannelImpl.java:567)
at org.apache.harmony.nio.internal.DatagramChannelImpl.write(DatagramChannelImpl.java:477)
at test.main(test.java:13)
C:\tmp\tmp17&gt;C:\harmony\drlvm\trunk\build\win_ia32_msvc_debug\deploy\jre\bin\ij -Dvm.assert_dialog=false -cp . -showversion test
Apache Harmony DRLVM HEAD-4807 (2006-05-02), Windows/ia32/msvc 1310, debug
java.nio.channels.NotYetConnectedException
at org.apache.harmony.nio.internal.DatagramChannelImpl.checkOpenConnected(DatagramChannelImpl.java:567)
at org.apache.harmony.nio.internal.DatagramChannelImpl.read(DatagramChannelImpl.java:387)
at test.main(test.java:8)
java.nio.channels.NotYetConnectedException
at org.apache.harmony.nio.internal.DatagramChannelImpl.checkOpenConnected(DatagramChannelImpl.java:567)
at org.apache.harmony.nio.internal.DatagramChannelImpl.write(DatagramChannelImpl.java:477)
at test.main(test.java:13)
DRLVM's DestroyVM needs to be more robust
drlvm should handle the fact that an exception already exists on entering DestroyJavaVM, and clear it before trying to resolve the VMStart class.
Here is a small patch that adds a simple check into the shutdown method.
Test failures in TEXT on ru_RU locale
Reported on the dev list by Alexei Zakharov:
DecimalFormatTest:
================
Testcase: test_parseLjava_lang_String_Ljava_text_ParsePosition took 0 sec
FAILED
null
junit.framework.AssertionFailedError
at org.apache.harmony.text.tests.java.text.DecimalFormatTest.test_parseLjava_lang_String_Ljava_text_ParsePosition(DecimalFormatTest.java:66)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)
Testcase: test_setDecimalSeparatorAlwaysShownZ took 0 sec
FAILED
Wrong set result expected:&lt;....&gt; but was:&lt;...,&gt;
junit.framework.ComparisonFailure: Wrong set result expected:&lt;....&gt;
but was:&lt;...,&gt;
at org.apache.harmony.text.tests.java.text.DecimalFormatTest.test_setDecimalSeparatorAlwaysShownZ(DecimalFormatTest.java:1361)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)
Testcase: test_setMaximumFractionDigitsI took 0 sec
FAILED
Wrong maximum expected:&lt;.......&gt; but was:&lt;...,...&gt;
junit.framework.ComparisonFailure: Wrong maximum expected:&lt;.......&gt;
but was:&lt;...,...&gt;
at org.apache.harmony.text.tests.java.text.DecimalFormatTest.test_setMaximumFractionDigitsI(DecimalFormatTest.java:1410)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)
Testcase: test_setMinimumFractionDigitsI took 0,016 sec
FAILED
Wrong minimum expected:&lt;.......&gt; but was:&lt;...,...&gt;
junit.framework.ComparisonFailure: Wrong minimum expected:&lt;.......&gt;
but was:&lt;...,...&gt;
at org.apache.harmony.text.tests.java.text.DecimalFormatTest.test_setMinimumFractionDigitsI(DecimalFormatTest.java:1436)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)
Testcase: test_setMinimumIntegerDigitsI took 0 sec
FAILED
Incorrect integer expected:&lt;.......&gt; but was:&lt;...,...&gt;
junit.framework.ComparisonFailure: Incorrect integer
expected:&lt;.......&gt; but was:&lt;...,...&gt;
at org.apache.harmony.text.tests.java.text.DecimalFormatTest.test_setMinimumIntegerDigitsI(DecimalFormatTest.java:1452)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)
ChoiceFormatTest:
===============
Testcase: test_toPattern took 0,016 sec
Caused an ERROR
null
java.lang.IllegalArgumentException
at java.text.ChoiceFormat.applyPattern(ChoiceFormat.java:126)
at java.text.ChoiceFormat.&lt;init&gt;(ChoiceFormat.java:65)
at org.apache.harmony.text.tests.java.text.ChoiceFormatTest.test_toPattern(ChoiceFormatTest.java:421)
at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)
[classlib][beans] some tests from ExpressionTest class fail
Currently 23 out of 56 tests from org.apache.harmony.beans.tests.java.beans.ExpressionTest class fail due various reasons. Attached patch corrects following invalid tests:
testConstructor_Normal took
testConstructor_NullTarget took
testConstructor_ArrayTarget took
testConstructor_NullMethodName
testConstructor_NewMethodName
testConstructor_EmptyMethodName
testConstructor_NullArguments took
testConstructor_NullArgument took
testConstructor_Value_Normal took
testConstructor_Value_NullTarget took
testConstructor_Value_ArrayTarget took
testConstructor_Value_NullMethodName took 
testConstructor_Value_NewMethodName took
testConstructor_Value_EmptyMethodName took
testConstructor_Value_NullArguments took
testConstructor_Value_NullArgument took
testConstructor_Value_NullValue took
These tests fail on RI also.
Change log:
1. All tests above checked for invalid toString() patterns. Corrected. Now it checks for patterns returned by RI. 
2. Some tests constructed Expression without return value specified and then called toString(). Both our implementation and RI execute the expression in this case to obtain the return value. But it seems these tests didn't expect Statement.execute() method to be called and didn't pass valid parameters to Statement constructs, just stubs. This situation has been correct.
3. For some tests calling toString is an invalid action at all. I have just removed this assertion for these tests.
As a result all tests mentioned above pass on our implementation as well as on RI.
[classlib][nio] o.a.h.nio.DatagramChannelImpl.send(ByteBuffer,SocketAddress) throws wrong exception
Hello, 
DatagramChannelImpl.send(ByteBuffer,SocketAddress) should throw NullPointerException if the given ByteBuffer is null and this channel is closed.
Following test reproduces the bug. The test passes against RI, while fails against Harmony.
public void test_datagram_send() throws IOException{
DatagramChannel channel1=DatagramChannel.open();
channel1.close();
try {
channel1.send(null, null);
fail(&quot;Should throw NullPointerException&quot;);
} catch (NullPointerException e) {
//pass
}
}
[classlib][nio] compatibility: java.nio.channels.FileChannel.write(ByteBuffer, long) throws different exception from RI.
java.nio.channels.FileChannel.write(ByteBuffer, long) throws different exception from RI. 
Following test reproduces the bug:
public void test_writeLByteBufferJ_ReadOnly_Exception() throws Exception {
File testFile = File.createTempFile(&quot;test&quot;, &quot;tmp&quot;);
testFile.deleteOnExit();
FileChannel readOnlyFileChannel = new FileInputStream(testFile)
.getChannel();
ByteBuffer writeBuffer = null;
readOnlyFileChannel.close();
try {
readOnlyFileChannel.write(writeBuffer, -1);
fail(&quot;should throw NullPointerException&quot;);
} catch (NullPointerException e) {
// expected
}
writeBuffer = ByteBuffer.allocate(1);
try {
readOnlyFileChannel.write(writeBuffer, -1);
fail(&quot;should throw IllegalArgumentException&quot;);
} catch (IllegalArgumentException e) {
// expected
}
try {
readOnlyFileChannel.write(writeBuffer, 0);
fail(&quot;should throw NonWritableChannelException&quot;);
} catch (NonWritableChannelException e) {
// expected
}
}
The test passes against RI while fails against Harmony.
I'll upload a patch to fix this problem soon.
Thanks.
Best regards,
Andrew
[classlib][nio] compatibility: java.nio.channels.FileChannel.read(ByteBuffer[], int, int) throws different exception from RI.
java.nio.channels.FileChannel.read(ByteBuffer, int, int) throws different exception from RI. Following test reproduces the bug:
public void test_read_ClosedChannelException() throws IOException {
File testFile = File.createTempFile(&quot;test&quot;, &quot;tmp&quot;);
testFile.deleteOnExit();
FileChannel channel = new RandomAccessFile(testFile,&quot;rw&quot;).getChannel();
ByteBuffer b[] = new ByteBuffer[2];
b[0] = null;
channel.close();
try {
channel.read(b, 0, 1);
fail(&quot;should throw ClosedChannelException&quot;);
} catch (ClosedChannelException e) {
// expected
}
}
The test passes against RI while fails against Harmony.
I'll upload a patch to fix this problem soon. Thanks!
Best regards,
Andrew
java.util.Locale(String language, String country, String variant) constructor doesn't throw NPE when variant is null
VM + classlib revision 422694 msvc debug build
Problem:
java.util.Locale(String, String, String) does not throw NullPointerException when one of arguments is null.
RI throws it.
Java spec 1.5.0 says:
&quot;Throws: 
NullPointerException - thrown if any argument is null.
&quot;.
import java.util.Locale;
public class Test {
public static void main(String args[]) {
try {
new Locale(&quot;aaa&quot;, &quot;ccc&quot;, null);
System.out.println(&quot;No Exception!&quot;);
} catch (NullPointerException e) { 
System.out.println(&quot;Exception thrown &quot;+e);
e.printStackTrace();
} 
}
}
Output in RI:
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
Exception thrown java.lang.NullPointerException
java.lang.NullPointerException
at java.util.Locale.&lt;init&gt;(Locale.java:247)
at Test.main(test.java:6)
Output in Harmony:
No Exception!
---------
The patch with JUnit test and classlib code modification that resolves this problem is attached
JarEntry.getSodeSigners() throws NPE if certificates are null
VM + classlib revision 422694, build: msvc debug
Harmony throws unspecified NullPointerException for java.util.jar.JarEntry. getCodeSigners() while
RI returns &quot;null&quot; value, which is correct.
Java 1.5.0 spec says:
&quot;Returns: 
the CodeSigner objects for this entry, or null if none.
&quot;.
import java.util.jar.JarEntry;
import java.security.CodeSigner;
public class Test {
public static void main(String args[]) {
JarEntry localJarEntry = new JarEntry(&quot;aaa&quot;);
try
{
localJarEntry.getCodeSigners();
System.out.println(&quot;getCodeSigners()=&quot; +localJarEntry.getCodeSigners());
}
catch(Exception e)
{ 
e.printStackTrace();
}
}
}
OUTPUT:
SUN
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
getCodeSigners()=null
Harmony:
java.lang.NullPointerException
at java.util.jar.JarEntry.getCodeSigners(JarEntry.java:139)
at java.util.jar.JarEntry.getCodeSigners(JarEntry.java:123)
at Test.main(Test.java:9)
Please see the patch with JUnit test and fix for this issue attached
[classlib][nio] java.nio.channels.spi.SelectorProvider.provider() should not throw SecurityException from SelectorProvider.provider().
java.nio.channels.spi.SelectorProvider.provider() should not throw SecurityException from SelectorProvider.provider().
Following test reproduces the bug. Please run it in seperated vm once, because provider() return value is always cached, and may be affected by other tests if run in a test suite. 
public void test_provider_security(){ 
SecurityManager securityManager = new SecurityManager();
System.setSecurityManager(securityManager);
SelectorProvider.provider();
}
The test passes against RI, while fails against Harmony. 
[classlib][[net] compatibility: java.net.DatagramSocket((DatagramSocketImpl) null) does not throw NPE
The Harmony method java.net.DatagramSocket((DatagramSocketImpl) null) construct object while RI throws NPE.
===================== test.java ====================
import java.net.*;
public class test { 
public static void main (String[] args) { 
try { 
System.out.println(&quot;res = &quot; + new testDatagramSocket((DatagramSocketImpl) null));
} catch (Exception e) {
System.out.println(&quot;exception: &quot; + e);
} 
} 
}
class testDatagramSocket extends DatagramSocket {
public testDatagramSocket(DatagramSocketImpl impl){
super(impl);
}
}
================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
exception: java.lang.NullPointerException
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
res = testDatagramSocket@7080708
[classlib][nio] SocketChannel.socket().getInputStream/getOutputStream should delegate all of its operations to the associated channel.
SocketChannel.socket().getInputStream/getOutputStream should delegate all of its operations to the associated channel. 
Currently, Harmony's implementation doesn't delegate the operations to channel, but to super.getInputStream/getOutputStream.
Following test reproduces a bug caused by current implementation:
public void test_getOutputStream() throws Exception {
ServerSocket ss = new ServerSocket(0);
SocketChannel sc = SocketChannel.open();
sc.connect(new InetSocketAddress(&quot;127.0.0.1&quot;, ss.getLocalPort()));
OutputStream os = sc.socket().getOutputStream();
os.close();
try {
os.write(1);
fail(&quot;should throw ClosedChannelException&quot;);
} catch (ClosedChannelException e) {
// expected
} 
}
The test passes against RI while fails against Harmony.
I'll upload a patch to fix this problem and supplement more tests. 
Thanks.
Best regards,
Andrew
[classlib][lang] no NPE for new java.lang.Character.Subset(null)
The j2se spec says for the constructor Character.Subset(String): throws NullPointerException - if name is null
But Harmony method returns null.
==================== test.java ====================
public class test {
public static void main (String [] args) {
try {
System.out.println(&quot;Test failed: &quot; + new CS(null));
} catch (NullPointerException e) {
System.out.println(&quot;Test passed: &quot; + e);
} catch (Throwable e) {
System.out.println(&quot;exception: &quot; + e);
e.printStackTrace();
}
}
}
class CS extends java.lang.Character.Subset {
public CS(String s) {
super(s);
}
}
=======================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
Test passed: java.lang.NullPointerException: name
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Test failed: null
C:\tmp\tmp17&gt;C:\harmony\drlvm\trunk\build\win_ia32_msvc_debug\deploy\jre\bin\ij -cp . -showversion test
Apache Harmony DRLVM HEAD-4807 (2006-05-02), Windows/ia32/msvc 1310, debug
Test failed: null
AbstractPreferences.exportSubTree(null) throws different exceptions on RI and Harmony
Harmony Classlib + VM 421248
RI throws java.lang.AssertionError while Harmony throws NPE.
Accodring to specification method must throw:
IOException - if writing to the specified output stream results in an IOException. 
BackingStoreException - if preference data cannot be read from backing store. 
IllegalStateException - if this node (or an ancestor) has been removed with the removeNode() method.
There is no mention about any exception if null argument is passed.
import java.util.prefs.*;
public class Test { 
public static void main (String[] args) { 
try { 
Preferences localPreferences = Preferences.systemRoot();
localPreferences.exportSubtree(null);
} catch (Exception e) {
e.printStackTrace();
} 
}
}
Output on RI:
Exception in thread &quot;main&quot; java.lang.AssertionError: javax.xml.transform.TransformerException: Result object passed to ''{0}'' is invalid.
at java.util.prefs.XmlSupport.writeDoc(XmlSupport.java:251)
at java.util.prefs.XmlSupport.export(XmlSupport.java:106)
at java.util.prefs.AbstractPreferences.exportSubtree(AbstractPreferences.java:1591)
at Test.main(Test.java:9)
Caused by: javax.xml.transform.TransformerException: Result object passed to ''{0}'' is invalid.
at com.sun.org.apache.xalan.internal.xsltc.trax.TransformerImpl.getOutputHandler(TransformerImpl.java:367)
at com.sun.org.apache.xalan.internal.xsltc.trax.TransformerImpl.transform(TransformerImpl.java:264)
at java.util.prefs.XmlSupport.writeDoc(XmlSupport.java:249)
... 3 more
Output on Harmony:
java.lang.NullPointerException
at java.io.Writer.&lt;init&gt;(Writer.java:54)
at java.io.OutputStreamWriter.&lt;init&gt;(OutputStreamWriter.java:84)
at java.util.prefs.XMLParser.exportPrefs(XMLParser.java:162)
at java.util.prefs.AbstractPreferences.exportSubtree(AbstractPreferences.java:378)
at Test.main(Test.java:9)
please see the patch to JUnit test and classlib code to mimic the RI behaviour attached.
[classlib][text]unexpected IllegalArgumentException for new DecimalFormat(&quot;0\t9&quot;)
The Harmont constructor java.text.DecimalFormat(&quot;0\t9&quot;) throws IllegalArgumentException while RI return correct value.
================== test.java ===============
import java.text.*;
public class test { 
public static void main (String[] args) { 
try { 
System.out.println(&quot;res = &quot; + new DecimalFormat(&quot;0\t9&quot;).getMaximumIntegerDigits());
} catch (Exception e) {
e.printStackTrace();
} 
}
}
========================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
res = 2147483647
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.IllegalArgumentException: Unquoted special character '9' in pattern &quot;0 9&quot;
at com.ibm.icu.text.DecimalFormat.patternError(DecimalFormat.java:3807)
at com.ibm.icu.text.DecimalFormat.applyPattern(DecimalFormat.java:3525)
at com.ibm.icu.text.DecimalFormat.&lt;init&gt;(DecimalFormat.java:687)
at java.text.DecimalFormat.&lt;init&gt;(DecimalFormat.java:90)
at java.text.DecimalFormat.&lt;init&gt;(DecimalFormat.java:70)
at test.main(test.java:6)
[classlib][luni] java.net.Socket.getOutputStream should throw SocketException if output has been shutdown by invoking shutdownOutputStream().
java.net.Socket.getOutputStream should throw SocketException if output has been shutdown by invoking shutdownOutputStream(). 
Following test reproduces the bug:
public void test_getOutputStream() throws Exception {
ServerSocket ss = new ServerSocket(2223);
Socket s = new Socket(&quot;127.0.0.1&quot;, 2223);
ss.accept();
s.shutdownOutput();
try {
s.getOutputStream();
fail(&quot;should throw SocketException&quot;);
} catch (SocketException e) {
// expected
}
}
The test passes against RI and fails against Harmony.
I'll upload a patch to fix this problem soon.
Best regards,
Andrew
[classlib][logging] logging tests depends on execution order
Tests in the logging module depend on order of execution. So LogManagerTest can not be run after any from &lt;name&gt;HandlerTest due to LogManager.getLogManager().reset() call in the setUp() method of these tests.
The patch to run the LogManagerTest is attached (should be applied after fix for 867).
[classlib][logging] run of logging test lead to remove the deploy\jdk\jre\lib\logging.properties file
In the process of logging tests run the logging.properties file substituted by other file and both are deleted on the vm-exit.
If the add string System.out.println(&quot;result of rename = &quot; + bak.renameTo(file)); to the DefaultPropertyHelper.reset(File) it prints:
=========
....
[junit] Tests run: 40, Failures: 0, Errors: 0, Time elapsed: 0.13 sec
[junit] Tests run: 6, Failures: 0, Errors: 0, Time elapsed: 0.15 sec
[junit] result of rename = true
[junit] result of rename = false
[junit] result of rename = false
[junit] result of rename = false
[junit] Tests FAILED
....
=========
because each test from FileHandlerTest.java, LogManagerTest.java, MemoryHandlerTest.java and SocketHandlerTest.java set up proper ShutdownHook to delete property file and rename '*.bak' file to 'logging.properties'.
[classlib[util] unit test org.apache.harmony.logging.tests.java.util.logging.FileHandlerTest is incorrect
The harmony unit test org.apache.harmony.logging.tests.java.util.logging.FileHandlerTest checks NPE for handler.publish(null) while spec says: 'A null record is silently ignored and is not published'.
Harmony implementation is correct.
Seems, test may be unexcluded after this fix.
[classlib][nio]refactory nio buffer test step 7 - ShortBuffer tests
Here goes the 7th buffer tests refactory - ShortBuffer tests, and some implementation bugs are fixed. I'll attach patch soon
[classlib][util] invalid data file for unit test org.apache.harmony.prefs.tests.java.util.prefs.PreferencesTest
The util.prefs data based on the package name of class so the userprefs.xml for the test org.apache.harmony.prefs.tests.java.util.prefs.PreferencesTest should be updated with each package name update.
[classlib][util] unit test org.apache.harmony.prefs.tests.java.util.prefs.AbstractPreferencesTest is incorrect
The harmony unit test org.apache.harmony.prefs.tests.java.util.prefs.AbstractPreferencesTest is incorrect:
1) has invalid link to external resource (preferences.dtd)
2) use aproximation for array length as boundary value (0.75 is aproximation only for Base64.encode()).
[classlib][luni] ObjectOutputStream.writeObject() no expected NotSerializableException
The harmony allows to serialize classses that does not implement Serializable interface.
The unit test tests.api.java.io.ObjectOutputStreamTest failed due to this issue.
============== test.java =================
import java.io.*;
class NotSerializable {
private int foo;
public NotSerializable() {}
protected Object writeReplace() throws ObjectStreamException {
return new Integer(42);
}
}
public class test { 
public static void main (String[] args) throws Exception { 
try {
ObjectOutputStream out = new ObjectOutputStream(new ByteArrayOutputStream());
out.writeObject(new NotSerializable());
System.out.println(&quot;Expected NotSerializableException&quot;);
} catch (NotSerializableException e) {
System.out.println(&quot;OK: &quot; + e);
}
}
}
======================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
OK: java.io.NotSerializableException: NotSerializable
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Expected NotSerializableException
[classlib][nio] FileChannel.read(ByteBuffer[] dsts) returns incorrect value and doesn't set the position of ByteBuffer[] in some cases.
FileChannel.read(ByteBuffer[] dsts) returns incorrect value and doesn't set the position of ByteBuffer[] in some cases.
Following test reproduces the bug:
public void test_read$LByteBuffer() throws Exception {
final int CAPACITY = 64;
final String content = &quot;TEST CONTENT&quot;;
final long contentLength = content.length();
File file = File.createTempFile(&quot;File_of_readOnlyFileChannel&quot;, &quot;tmp&quot;);
FileOutputStream fos = new FileOutputStream(file);
try {
fos.write(content.getBytes());
} finally {
fos.close();
}
ByteBuffer[] readBuffers = new ByteBuffer[2];
readBuffers[0] = ByteBuffer.allocate(CAPACITY);
readBuffers[1] = ByteBuffer.allocate(CAPACITY);
FileChannel filechannel = new FileInputStream(file).getChannel();
long readCount = filechannel.read(readBuffers);
// Harmony fails on following two assertions
assertEquals(contentLength, readCount);
assertEquals(contentLength, readBuffers[0].position());
}
The test passes against RI while fails against Harmony.
I'll upload a patch to fix the problem soon. 
Thanks!
Best regards,
Andrew
[classlib][io] compatibility: java.io.ObjectInputStream.skipBytes(len&lt;=0) returns len while RI throws NPE
The harmony method new testObjectInputStream().skipBytes(0) returns 0 while RI throws NPE.
==================== test.java =======================
import java.io.*;
public class test { 
public static void main (String[] args) { 
try {
System.out.println(&quot;res = &quot; + new testObjectInputStream().skipBytes(0));
} catch (Exception e) {
e.printStackTrace();
} 
}
}
class testObjectInputStream extends ObjectInputStream {
public testObjectInputStream() throws IOException{
super();
}
} 
==================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.lang.NullPointerException
at java.io.ObjectInputStream.skipBytes(I)I(Unknown Source)
at test.main(test.java:6)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
res = 0
[classlib][nio]refactory nio buffer test step 6 - LongBuffer tests
Here goes the 6th step of nio buffers test refactory - LongBuffer tests.
[classlib][io] java.io.BufferedReader.read() throws unspesified ArrayIndexOutOfBoundsException
According to specification java.io. BufferedReader.read() returns &quot;the character read, or -1 if the end of the stream has been reached&quot;.
The test listed below shows that RI returns -1 while Harmony throws unexpected ArrayIndexOutOfBoundsException.
=============== test.java =========================
import java.io.*;
public class test { 
public static void main (String[] args) { 
try {
System.out.println(&quot;res = &quot; + new BufferedReader(new CharArrayReader(new char[5], 1, 0), 2).read());
} catch (Exception e) {
e.printStackTrace();
} 
}
}
=============================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -cp . -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
res = -1
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -cp . -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.ArrayIndexOutOfBoundsException
at java.lang.Throwable.&lt;init&gt;(Throwable.java:61)
at java.lang.System.arraycopy(System.java:358)
at java.lang.System.arraycopy(System.java:190)
at java.io.CharArrayReader.read(CharArrayReader.java:187)
at java.io.BufferedReader.fillbuf(BufferedReader.java:108)
at java.io.BufferedReader.read(BufferedReader.java:205)
at test.main(test.java:6)
RuleBasedCollator.compare(null, null) doesn't throw NPE
VM + classlib revision 420760
The following code
import java.text.*;
public class Test {
public static void main (String[] args) throws Exception { 
new RuleBasedCollator(&quot;&lt; a&quot;).compare(null, null);
} 
} 
throws NPE on RI and doesn't throw on Harmony . If one of arguments is not null, both implementations throw NPE so I believe it's better to follow RI and add NPE in case of both nulls. Please see the patch with unit test and code patch attached.
[classlib][io]unexpected IOException for new ByteArrayOutputStream().writeTo()
The Harmony method ByteArrayOutputStream().writeTo() throws IOException while RI does not.
============= test.java =========================
import java.io.*;
public class test { 
public static void main (String[] args) { 
try { 
new ByteArrayOutputStream().writeTo(new FileOutputStream(new FileDescriptor()));
System.out.println(&quot;OK&quot;);
} catch (Exception e) {
System.out.println(&quot;&quot; + e);
} 
}
}
=============================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
OK
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.io.IOException
[classlib][io] compatibility: method BufferedReader().read(new char[] {}, 7, 0) return 0 while RI throws IndexOutOfBoundsException
The Harmony method BufferedReader().read(new char[] {}, 7, 0) return 0 while RI throws IndexOutOfBoundsException. 
================= test.java ====================
import java.io.*;
public class test { 
public static void main (String[] args) throws Exception {
System.out.println(&quot;res = &quot; + new BufferedReader(new PipedReader(), 9).read(new char[] {}, 7, 0));
}
}
============================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.lang.IndexOutOfBoundsException
at java.io.BufferedReader.read(BufferedReader.java:256)
at test.main(test.java:5)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
res = 0
[classlib][prefs] Preferences.nodeExists() throws IllegalArgumentException on a long path
Harmony: VM + classlib revision 420760
According to 1.5 specs method throws IllegalArgumentException - if the path name is invalid (i.e., it contains multiple consecutive slash characters, or ends with a slash character and is more than one character long). 
No limit for string length is specified.
RI returns false in this case.
import java.util.*;
import java.util.prefs.*;
public class test {
public static void main (String[] args) { 
Preferences localPreferences = Preferences.userRoot();
try { 
String s =&quot;ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd&quot;;
System.out.println(&quot;len=&quot;+s.length());
System.out.println(&quot;res=&quot;+localPreferences.nodeExists(s));
} catch (BackingStoreException e) {
e.printStackTrace();
}
} 
} 
Output on RI: 
len=81
res=false
Output on Harmony:
len=81
java.lang.IllegalArgumentException: Name length is too long: ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
at java.util.prefs.AbstractPreferences.getNodeFromBackend(AbstractPreferences.java:613)
at java.util.prefs.AbstractPreferences.nodeImpl(AbstractPreferences.java:599)
at java.util.prefs.AbstractPreferences.nodeExists(AbstractPreferences.java:651)
at test.main(test.java:10)
-----------
The patch is quite simple:
Index: modules/prefs/src/main/java/java/util/prefs/AbstractPreferences.java
===================================================================
--- modules/prefs/src/main/java/java/util/prefs/AbstractPreferences.java
(revision 420760)
+++ modules/prefs/src/main/java/java/util/prefs/AbstractPreferences.java
(working copy)
@@ -648,8 +648,12 @@
startNode = this;
}
}
- Preferences result = startNode.nodeImpl(name, false);
- return null == result ? false : true;
+ try {
+ Preferences result = startNode.nodeImpl(name, false);
+ return null == result ? false : true;
+ } catch(IllegalArgumentException e) {
+ return false;
+ }
}
/*
------------------------
Please note that this patch doesn't break the validation functionality, because try/catch doesn't wrap validateName(...)
[classlib][security] TwoKeyHashMap: restricted key types
Class org.apache.harmony.security.utils.TwoKeyHashMap could be used with any Objects as keys.
But key types were restricted (String only) by recent update (revision 417010). It broke JSSE Provider (Harmony-536).
[classlib][jndi]unit test DNSContextTest is invalid
The Harmony unit test org.apache.harmony.jndi.provider.dns.DNSContextTest is invalid. It depends on the class SList.java that has package access constructor only (commented) and tries to instantiate the DNSContext.class directly instead of use the factory class.
[classlib][archive] incorrect data for the GZIPInputStreamTest
The Harmony unit test org.apache.harmony.archive.tests.java.util.zip.GZIPInputStreamTest operates with the hyts_gInput.txt file that actually is broken gzip archive (I can't decompress it by WinZip utility). When this archive file was updated to valid one the test reports 'passed' status.
Plz, update this file to valid archive of bytes { 3, 5, 2, 'r', 'g', 'e', 'f', 'd', 'e', 'w' } or apply the patch for archive { '3', '5', '2', 'r', 'g', 'e', 'f', 'd', 'e', 'w' }.
[classlib][nio]refactory nio buffer test step 5 - IntBuffer tests
Here goes the fifth step of nio buffer tests refactory - IntBuffer, also fix some bugs of IntBuffer implementation.
[classlib][security] X509 Certificate Factory implementation throws NPE while RI throws another exception.
Current implementations of the following methods of X509 Certificate Factory^
generateCertificate(InputStream)
generateCertificates(InputStream)
generateCertPath(InputStream)
generateCertPath(InputStream, String)
throw NPE if provided InputStream is null while RI throws CertificateException.
Current implementations of methods:
generateCRL(InputStream)
generateCRLs(InputStream)
throw NPE while RI throws CRLException.
transient fields are serialized
Classlib + VM version 419914 
build: win_ia32_msvc_debug
Fields that are marked as 'transient' are serialized though they shouldn't
Code to reproduce:
import java.io.*;
public class Test {
public static void main(String[] args) throws Throwable {
ByteArrayOutputStream baos = new ByteArrayOutputStream();
ObjectOutputStream oos = new ObjectOutputStream(baos);
oos.writeObject(new Transient());
oos.close();
ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(baos.toByteArray()));
Transient t = (Transient) ois.readObject();
ois.close();
System.out.println(t.trs == null ? &quot;PASSED&quot; : &quot;FAILED&quot;);
}
}
class Transient implements Serializable {
transient String trs = &quot;aaa&quot;;
}
[classlib][nio]refactory nio buffer test step 4 - FloatBuffer tests
Here goes the 4th step of nio buffer test refactory, and again I found some implementation bugs during the refactory, I will attach patch soon.
[classlib][nio]mmap native codes are not implemented in Harmony
java.nio.channels.FileChannel.map() is not fully implemented in Harmony. The native codes are good candidates as portlib extention, but I prefer to implement them in platform dependent way at first, and I will propose the portlib extension on the mailing list later.
[classlib][nio] java.nio.ByteBuffer.compareTo( ByteBuffer) returns wrong value
Method must return: &quot;A negative integer, zero, or a positive integer as this buffer is less than, equal to, or greater than the given buffer&quot;.
But in the Harmony implementation the ByteBuffer.allocateDirect() and ByteBuffer.wrap(new byte[]) does not equals due to different initialization symbols (it is easy to catch if add debug message to the ByteBuffer.compareTo() method).
===================== test.java =======================
import java.nio.*;
public class test { 
public static void main (String[] args) { 
try { 
System.out.println(ByteBuffer.wrap(new byte[839]).compareTo(ByteBuffer.allocateDirect(137)));
} catch (Exception e) {
e.printStackTrace();
} 
}
}
===================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
702
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
thisByte = 0, otherByte = 31
-1
[classlib][nio] java.nio.ByteBuffer.put(byte[], int off, Integer.MAX_VALUE) throws java.nio.BufferUnderflowException instead of IndexOutOfBoundsException
The Harmony methods java.nio.Byte/Char/Float/Int/Long/ShortBuffer.put(byte[], int off, int len) throws java.nio.BufferUnderflowException while spec requires IndexOutOfBoundsException.
==================== test.java ======================
import java.nio.*;
public class test { 
public static void main (String[] args) { 
try {
CharBuffer.allocate(10).put(new char[] {0}, 1, Integer.MAX_VALUE);
} catch (Exception e) {
System.out.println(&quot;c: &quot; + e);
}
try {
FloatBuffer.allocate(10).put(new float[] {0}, 1, Integer.MAX_VALUE);
} catch (Exception e) {
System.out.println(&quot;f: &quot; + e);
}
try {
DoubleBuffer.allocate(10).put(new double[] {0}, 1, Integer.MAX_VALUE);
} catch (Exception e) {
System.out.println(&quot;d: &quot; + e);
}
try {
IntBuffer.allocate(10).put(new int[] {0}, 1, Integer.MAX_VALUE);
} catch (Exception e) {
System.out.println(&quot;i: &quot; + e);
}
try {
LongBuffer.allocate(10).put(new long[] {0}, 1, Integer.MAX_VALUE);
} catch (Exception e) {
System.out.println(&quot;l: &quot; + e);
}
try {
ShortBuffer.allocate(10).put(new short[] {0}, 1, Integer.MAX_VALUE);
} catch (Exception e) {
System.out.println(&quot;s: &quot; + e);
}
}
}
==================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
c: java.lang.IndexOutOfBoundsException
f: java.lang.IndexOutOfBoundsException
d: java.lang.IndexOutOfBoundsException
i: java.lang.IndexOutOfBoundsException
l: java.lang.IndexOutOfBoundsException
s: java.lang.IndexOutOfBoundsException
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
c: java.nio.BufferOverflowException
f: java.nio.BufferOverflowException
d: java.lang.IndexOutOfBoundsException
i: java.nio.BufferOverflowException
l: java.nio.BufferOverflowException
s: java.nio.BufferOverflowException
[classlib][nio] java.nio.ByteBuffer.order((ByteOrder) null) throws unspecified NPE
The Harmony method java.nio.ByteBuffer.order(ByteOrder bo) throws unspecified NPE for 'null' while RI does not.
=================== test.java =========================
import java.nio.*;
public class test { 
public static void main (String[] args) { 
try { 
ByteBuffer buf = ByteBuffer.wrap(new byte[10]);
System.out.println(&quot;buf = &quot; + buf + &quot;, order(null) = &quot; + buf.order(null));
} catch (Exception e) {
e.printStackTrace();
}
}
}
===================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
buf = java.nio.HeapByteBuffer[pos=0 lim=10 cap=10], order(null) = java.nio.HeapByteBuffer[pos=0 lim=10 cap=10]
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.NullPointerException
at java.nio.ByteBuffer.orderImpl(ByteBuffer.java:699)
at java.nio.ByteBuffer.order(ByteBuffer.java:694)
at test.main(test.java:7)
[classlib][nio]java.nio.ByteBuffer.wrap(byte[], int off, int len) does not throw IndexOutOfBoundsException if off/len ==Integer.MAX_VALUE
The Harmony method java.nio.ByteBuffer.wrap(byte[], int off, int len) does not throw IndexOutOfBoundsException if off/len ==Integer.MAX_VALUE while RI throws correct exception.
================ test.java ======================
import java.nio.*;
public class test { 
public static void main (String[] args) { 
try { 
ByteBuffer.wrap(new byte[551], Integer.MAX_VALUE, 2); 
} catch (Exception e) {
e.printStackTrace();
}
}
}
=============================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.lang.IndexOutOfBoundsException
at java.nio.ByteBuffer.wrap([BII)Ljava.nio.ByteBuffer;(Unknown Source)
at test.main(test.java:5)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
C:\tmp\tmp17&gt;C:\harmony\drlvm\trunk\build\win_ia32_msvc_release\deploy\jre\bin\ij -showversion test
Apache Harmony DRLVM HEAD-4807 (2006-05-02), Windows/ia32/msvc 1310, release
There is no org/apache/xml/serializer/SerializerTrace in ant classpath
DRLVM build is broken since there is no serializer.jar in ant classpath. Xalan is taken from the official xalan mirrow (http://www.reverse.net/pub/apache/xml/xalan-j/xalan-j_2_7_0-bin.zip) in DRLVM build, and the needed class is in serializer.jar, not xalan.jar. All the jars from the xalan-j_2_7_0-bin.zip distributive were put in ant classpath in build.bat/sh, but two days ago build.* was changed so that selializer.jar is not copied to make/tmp. So now the DRLVM build couldn't find the org/apache/xml/serializer/SerializerTrace class. 
BTW: the Harmoy classlib xalan.far is taken from http://www.ibiblio.org site, and everythig is OK, org/apache/xml/serializer/SerializerTrace class is present here. So the solution is change the DRLVM build to use the classlib xalan.jar instead the old one.
[classlib][nio]Harmony crashes on java.nio.ByteBuffer.getDouble(Integer.MAX_VALUE) instead of throwing IndexOutOfBoundateException
The Harmony crashes on java.nio.ByteBuffer.getDouble(Integer.MAX_VALUE) instead of throwing IndexOutOfBoundateException.
Methods getInt(Integer.MAX_VALUE), putChar(Integer.MAX_VALUE, 'h') crash java machine as well.
=========================== test.java ============================
public class test { 
public static void main (String[] args) { 
try { 
System.out.println(&quot;double = &quot; + ByteBuffer.allocateDirect(16).getDouble(Integer.MAX_VALUE));
// System.out.println(&quot;double = &quot; + ByteBuffer.allocateDirect(16).getInt(Integer.MAX_VALUE));
// System.out.println(&quot;double = &quot; + ByteBuffer.allocateDirect(16).putChar(Integer.MAX_VALUE, 'h'));
} catch (Exception e) {
e.printStackTrace();
} 
}
}
==============================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.lang.IndexOutOfBoundsException
at java.nio.Buffer.checkIndex(II)I(Unknown Source)
at java.nio.DirectByteBuffer.getDouble(I)D(Unknown Source)
at test.main(test.java:6)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Unhandled exception
Type=Segmentation error vmState=0x00040000
Target=2_30_20060220_05389_lHdSMR (Windows XP 5.1 build 2600 Service Pack 2)
CPU=x86 (1 logical CPUs) (0x7feec000 RAM)
J9Generic_Signal_Number=00000004 ExceptionCode=c0000005 ExceptionAddress=003EDDD4 ContextFlags=0001003f
Handler1=7FE5FED0 Handler2=7FD16E50 InaccessibleAddress=8150FFEF
EDI=0013F7F4 ESI=00000020 EAX=003EDDD0 EBX=00000000
ECX=8150FFEF EDX=00000008
EIP=003EDDD4 ESP=0013F7F0 EBP=0013F970
Module=C:\harmony\trunk_0427\deploy\jdk\jre\bin\hyluni.dll
Module_base_address=003E0000 Offset_in_DLL=0000ddd4
JavaVMInitArgs.nOptions=9:
-Dcom.ibm.oti.vm.vmdir=C:\harmony\trunk_0427\deploy\jdk\jre\bin\default\
-Dcom.ibm.oti.vm.exe=C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe
-Dcom.ibm.oti.vm.bootstrap.library.path=C:\harmony\trunk_0427\deploy\jdk\jre\bin;C:\harmony\trunk_0427\deploy\jdk\jre\bin\default
-Xbootclasspath/p:C:\harmony\trunk_0427\deploy\jdk\jre\bin\default\luni-kernel.jar;C:\harmony\trunk_0427\deploy\jdk\jre\bin\default\security-kerne
l.jar
-Djava.home=C:\harmony\trunk_0427\deploy\jdk\jre
-Djava.library.path=C:\harmony\trunk_0427\deploy\jdk\jre\bin\;.;C:\harmony\trunk_0427\deploy\jdk\jre\bin\default;C:\Program Files\Far;C:\PROGRAM F
ILES\THINKPAD\UTILITIES;C:\WINNT\system32;C:\WINNT;C:\WINNT\System32\Wbem;C:\Program Files\PC-Doctor for Windows\services;C:\Program Files\ATI Technol
ogies\ATI Control Panel;C:\Program Files\ATI Technologies\Fire GL 3D Studio Max;C:\PROGRA~1\F-Secure\ssh;C:\Cygwin\bin;C:\Perl\Bin;C:\jrockit-jdk1.5.0
-windows-ia32\bin;C:\work\VTSTeam\dist\apache-ant-1.6.5\bin;C:\Program Files\Intel\CPP\Compiler80\Ia32\Bin;C:\Program Files\Intel\CPP\IDB80\Bin;C:\Pro
gram Files\Microsoft Visual Studio .NET 2003\Vc7\bin;C:\SFU\Perl\bin\;C:\SFU\common\;C:\Program Files\Intel\Compiler\C++\9.0\IA32\Bin;C:\Program Files
\Microsoft Visual Studio .NET 2003\Common7\IDE;C:\Program Files\Microsoft Visual Studio .NET 2003\VC7\BIN;C:\Program Files\Microsoft Visual Studio .NE
T 2003\Common7\Tools;C:\Program Files\Microsoft Visual Studio .NET 2003\Common7\Tools\bin\prerelease;C:\Program Files\Microsoft Visual Studio .NET 200
3\Common7\Tools\bin;C:\Program Files\Microsoft Visual Studio .NET 2003\SDK\v1.1\bin;C:\WINNT\Microsoft.NET\Framework\v1.1.4322;C:\ORP\last\bin;C:\Cygw
in\lib\subversion\bin
-Djava.class.path=.
_org.apache.harmony.vmi.portlib (extra info: 0013FBC4)
-Xjcl:jclclear_23
^CTerminate batch job (Y/N)? ^C
C:\tmp\tmp17&gt;C:\harmony\drlvm\trunk\build\win_ia32_msvc_release\deploy\jre\bin\ij -showversion test
Apache Harmony DRLVM HEAD-4807 (2006-05-02), Windows/ia32/msvc 1310, release
&lt;crash&gt;
[classlib][lang] unexpected NegativeArraySizeException for java.lang.String(int[], 2, Integer.MAX_VALUE)
The harmony method java.lang.String(int[], 2, Integer.MAX_VALUE) throws NegativeArraySizeException while spec requires IndexOutOfBoundsException. 
================== test.java =======================
public class test {
public static void main (String[] args) { 
new String(new int[] {}, 2, Integer.MAX_VALUE); 
} 
}
================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.lang.StringIndexOutOfBoundsException: String index out of range: -2147483647
at java.lang.String.&lt;init&gt;([III)V(Unknown Source)
at test.main(test.java:3)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Exception in thread &quot;main&quot; java.lang.NegativeArraySizeException
at java.lang.String.&lt;init&gt;(String.java:504)
at test.main(test.java:3)
logging.properties is missing in VM build
I've built VM and classlib revision 419539
Trying to run a simple test with logging:
import java.util.logging.Level;
import java.util.logging.Logger;
public class Test {
public static void main(String[] args) {
Logger log = Logger.getAnonymousLogger();
log.setLevel(Level.INFO);
log.info(&quot;hello world&quot;);
}
}
I've got the error:
prompt&gt; &lt;vm distr root&gt;\build\win_ia32_msvc_debug\deploy\jre\bin\ij.exe Test
java.io.FileNotFoundException
at org.apache.harmony.luni.platform.OSFileSystem.open(OSFileSystem.java:
223)
at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:66)
at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:110)
at java.util.logging.LogManager.readConfigurationImpl(LogManager.java:45
0)
at java.util.logging.LogManager.&lt;clinit&gt;(LogManager.java:186)
at java.util.logging.Logger.getLoggerWithRes(Logger.java:362)
at java.util.logging.Logger.getLogger(Logger.java:389)
at java.util.logging.Logger.&lt;clinit&gt;(Logger.java:99)
at Test.main(Test.java:6)
The problem was that logging.properties file was not copied from classlib. The following patch to VM build solves the problem:
Index: build.xml
===================================================================
--- build.xml (revision 419539)
+++ build.xml (working copy)
@@ -445,6 +445,12 @@
&lt;/fileset&gt;
&lt;/copy&gt;
+ &lt;copy todir=&quot;${build.deploy.dir}/lib&quot;&gt;
+ &lt;fileset dir=&quot;${external.dep.CLASSLIB}/deploy/jdk/jre/lib&quot;&gt;
+ &lt;include name=&quot;logging.properties&quot;/&gt;
+ &lt;/fileset&gt;
+ &lt;/copy&gt;
+
&lt;/target&gt;
[classlib][math] compatibility: no NPE for java.math.BigDecimal((BigInteger) null)
The Harmony method java.math.BigDecimal((BigInteger) null) doesn't throw NPE while RI do it.
Note1: NPE is thrown for java.math.BigDecimal((BigInteger) null).toString()
Note2: BEA and SUN have different behavior
=============== test.java ==========================
import java.math.*;
public class test {
public static void main(String args[] ) {
try {
BigDecimal bd = new BigDecimal((BigInteger) null);
if (bd != null)
System.out.println(&quot;Failed1&quot;);
else
System.out.println(&quot;Failed2&quot;);
} catch (NullPointerException e) {
System.out.println(&quot;Passed&quot;);
e.printStackTrace();
}
}
}
================================================
Output:
C:\tmp\tmp17&gt;C:\jdk1.5.0_06\bin\java.exe -showversion test
java version &quot;1.5.0_06&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode)
Passed
java.lang.NullPointerException
at java.math.BigDecimal.&lt;init&gt;(BigDecimal.java:791)
at test.main(test.java:6)
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
Failed1
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Failed1
[classlib][math] unexpected ArrayIndexOutOfBoundsException for java.math.BigDecimal(new char[] {})
The Harmony methods 
java.math.BigDecimal(new char[])
java.math.BigDecimal (char[] in ,int offset ,int len),
java.math.BigDecimal (char[] in, int offset, int len, MathContext mc),
java.math.BigDecimal (char[] in, MathContext mc)
throws unexpected ArrayIndexOutOfBoundsException for 0 length array while spec says:
&quot;Throws: NumberFormatException - if in is not a valid representation of a BigDecimal.&quot;
=================== test.java =============================
import java.math.*;
public class test {
public static void main(String args[] ) {
try {
System.out.println(&quot;&quot; + new BigDecimal(new char[] {}));
} catch (NumberFormatException e) {
System.out.println(&quot;passed: &quot; + e);
} catch (Exception e) {
System.out.println(&quot;failed: &quot; + e);
}
try {
System.out.println(&quot;&quot; + new BigDecimal(new char[] {}, 0, 0));
} catch (NumberFormatException e) {
System.out.println(&quot;passed: &quot; + e);
} catch (Exception e) {
System.out.println(&quot;failed: &quot; + e);
}
try {
System.out.println(&quot;&quot; + new BigDecimal(new char[] {}, 0, 0, MathContext.DECIMAL32));
} catch (NumberFormatException e) {
System.out.println(&quot;passed: &quot; + e);
} catch (Exception e) {
System.out.println(&quot;failed: &quot; + e);
}
try {
System.out.println(&quot;&quot; + new BigDecimal(new char[] {}, MathContext.DECIMAL32));
} catch (NumberFormatException e) {
System.out.println(&quot;passed: &quot; + e);
} catch (Exception e) {
System.out.println(&quot;failed: &quot; + e);
}
}
}
=======================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
passed: java.lang.NumberFormatException
passed: java.lang.NumberFormatException
passed: java.lang.NumberFormatException
passed: java.lang.NumberFormatException
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
failed: java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 0
failed: java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 0
failed: java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 0
failed: java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 0
[classlib][logging] unexpected IAE for java.util.logging.FileHandler.Ctor's if &quot;limit &lt; 1 || count &lt; 0&quot;
The Harmony throws unexpected IAE for methods java.util.logging.FileHandler.FileHandler(String pattern, int limit, int count) and java.util.logging.FileHandler.FileHandler(String pattern, int limit, int count, boolean append) when &quot;limit &lt; 1 || count &lt; 0&quot; while RI throws IAE when 'if limit &lt; 0, or count &lt; 1'
================ test.java =====================
import java.util.logging.FileHandler;
public class test { 
public static void main (String[] args) { 
try { 
try {
new FileHandler(&quot;a&quot;,0,1);
System.out.println(&quot;OK&quot;);
} catch (IllegalArgumentException e) {
e.printStackTrace();
}
try {
new FileHandler(&quot;a&quot;,0,1,false);
System.out.println(&quot;OK&quot;);
} catch (IllegalArgumentException e) {
e.printStackTrace();
} 
} catch (Exception e) {
System.out.println(&quot;unexpected exception&quot;);
} 
}
}
============================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
OK
OK
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.IllegalArgumentException: The limit and count property must larger than 0 and 1, respctively
at java.util.logging.FileHandler.&lt;init&gt;(FileHandler.java:454)
at test.main(test.java:8)
java.lang.IllegalArgumentException: The limit and count property must larger than 0 and 1, respectively
at java.util.logging.FileHandler.&lt;init&gt;(FileHandler.java:498)
at test.main(test.java:14)
regex Patter2Test.testCompile4 is incorrect
The test Patter2Test.testCompile4 for regex package works incorrectly.
Input sequence modification after creation of the matcher is invalid action, subsequent matcher.reset(test)
call should be used to update matcher with new string:
...
Matcher matcher = pattern.matcher(text);
...
if (found) {
VVVVVVVVVVVVVVVVVVVVVVVV
// modify text
text.delete(0, text.length());
text.append(&quot;Text have been changed.&quot;);
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
}
found = matcher.find();
The spec does not specifies this case directly, but there are some considerations:
1) RI does not support this:
I can easily modify this testcase to make RI fail with IndexOutOfBounsException(change &quot;Text have been changed&quot; to &quot;AA&quot;);
2) Correct behaviour is not specified:
What about concurrent modification, what should happen with ranges, should input sequense be copied of length checks should be performed prior to every input string access operation and so on. 
[classlib][auth]no expected IllegalArgumentException for javax.security.auth.kerberos.KerberosPrincipal.KerberosPrincipal(&quot;@/&quot;)
The Harmony method javax.security.auth.kerberos.KerberosPrincipal.KerberosPrincipal(String) create valid object while RI throws IllegalArgumentException.
================== test.java =======================
import javax.security.auth.kerberos.KerberosPrincipal;
public class test { 
public static void main (String[] args) { 
try { 
System.out.println(&quot;&quot; + new KerberosPrincipal(&quot;@/&quot;));
} catch (Exception e) {
e.printStackTrace();
} 
}
}
================================================ 
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.lang.IllegalArgumentException: Illegal character in realm name; one of: '/', ':', ' ' (600)
at javax.security.auth.kerberos.KerberosPrincipal.&lt;init&gt;(KerberosPrincipal.java:112)
at test.main(test.java:6)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
javax.security.auth.kerberos.KerberosPrincipal@7ef
[classlib][auth] compatibility:exception order for javax.security.auth.kerberos.ServicePermission(null, invalid_action)
At first the RI checks the 'action' and throws IllegalArgumentException while Harmony checks service principal and throws NPE.
=================== test.java =======================
import javax.security.auth.kerberos.ServicePermission;
public class test { 
public static void main (String[] args) { 
try { 
new ServicePermission(null, &quot;_accept&quot;);
} catch (Exception e) {
e.printStackTrace();
} 
}
}
=================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.lang.IllegalArgumentException: invalid permission: _accept
at javax.security.auth.kerberos.ServicePermission.getMask(ServicePermission.java:363)
at javax.security.auth.kerberos.ServicePermission.&lt;init&gt;(ServicePermission.java:131)
at test.main(test.java:6)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.NullPointerException: service principal is null
at javax.security.auth.kerberos.ServicePermission.&lt;init&gt;(ServicePermission.java:144)
at test.main(test.java:6)
[classlib][security] compatibility: exception order for javax.crypto.EncryptedPrivateKeyInfo(String algName, byte[] encryptedData )
For the method javax.crypto.EncryptedPrivateKeyInfo(String algName, byte[] encryptedData ) at first RI checks algorithm name and throws NoSuchAlgorithmExceptionn while Harmony checks encryptedData and throws IllegalArgumentException
======================= test.java ====================
import javax.crypto.*;
public class test { 
public static void main (String[] args) { 
try {
new EncryptedPrivateKeyInfo(&quot;0&quot;, new byte[] {});
} catch (Exception e) {
e.printStackTrace();
} 
}
}
==================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.security.NoSuchAlgorithmException: unrecognized algorithm name: 0
at sun.security.x509.AlgorithmId.get(AlgorithmId.java:105)
at javax.crypto.EncryptedPrivateKeyInfo.&lt;init&gt;(Ljava.lang.String;[B)V(DashoA12275:???)
at test.main(test.java:7)
C:\tmp\tmp17&gt;rem C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -Djava.security.auth.login.config=config -showversion test
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.IllegalArgumentException: the encryptedData is empty
at javax.crypto.EncryptedPrivateKeyInfo.&lt;init&gt;(EncryptedPrivateKeyInfo.java:118)
at test.main(test.java:7)
[drlvm] incorrect initialization of default domain in j.l.ClassLoader
Latest DRLVM fails to start in presence of &quot;java.security&quot; config file, due to:
*** Error: exception occured in main Thread constructor.
java/lang/ExceptionInInitializerError : (null)
The reason is inappropriate initialization of default domain in j.l.ClassLoader, in static block. 
Moreover, this initialization deviates from API specification for java.lang.ClassLoader.defineClass():
&quot;This method assigns a default ProtectionDomain to the newly defined class. The
ProtectionDomain is effectively granted the same set of permissions returned
when Policy.getPolicy().getPermissions(new CodeSource(null, null)) is invoked.
The default domain is created on the first invocation of defineClass, and
re-used on subsequent invocations.&quot;
[drlvm] VM does not find installed extension packages
The DRLVM does not provide default support for the Java Extension Mechanism. For example, it fails to find security providers needed for using signed jars in classpath.
Actually, it does not provide appropriate default value for &quot;java.ext.dirs&quot; property - it works OK if this property is specified explicitly via cmdline.
[classlib][security]compatibility: exception order javax.crypto.ExemptionMechanism.getInstance(null,Provider)
The harmony method javax.crypto.ExemptionMechanism.getInstance(null,Provider) throws the NPE while RI throws NoSuchProviderException in case when both parameters are incorrect.
=================== test.java ==========================
import javax.crypto.*;
public class test {
public static void main (String[] args) { 
try { 
ExemptionMechanism.getInstance((String) null, &quot;aaa&quot;); 
} catch (Exception e) {
e.printStackTrace();
} 
}
}
====================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.security.NoSuchProviderException: no such provider: aaa
at sun.security.jca.GetInstance.getService(GetInstance.java:66)
at javax.crypto.SunJCE_b.a(Ljava.lang.String;Ljava.lang.Class;Ljava.lang.String;Ljava.lang.String;)Lsun.security.jca.GetInstance$Instance;(Das
hoA12275:???)
at javax.crypto.ExemptionMechanism.getInstance(Ljava.lang.String;Ljava.lang.String;)Ljavax.crypto.ExemptionMechanism;(DashoA12275:???)
at test.main(test.java:6)
C:\tmp\tmp17&gt;rem C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -Djava.security.auth.login.config=config -showversion test
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.NullPointerException: Algorithm is null
at javax.crypto.ExemptionMechanism.getInstance(ExemptionMechanism.java:111)
at test.main(test.java:6)
[classlib][security]javax.crypto.spec.CipherOutputStream.write(byte[], 0, 0) throws IllegalStateException while RI does not
The Harmony method javax.crypto.spec.CipherOutputStream.write(byte[], 0, 0) throws IllegalStateException while RI does not
Seems, it related to the issue 757 to add boundary checks before main action.
================ test.java =======================
import javax.crypto.*;
import java.io.*;
public class test {
public static void main (String[] args) { 
try { 
Cipher cf = Cipher.getInstance(&quot;DES/CBC/PKCS5Padding&quot;);
NullCipher nc = new NullCipher();
CipherOutputStream stream1 = new CipherOutputStream(new BufferedOutputStream((OutputStream) null), nc);
CipherOutputStream stream2 = new CipherOutputStream(stream1, cf);
CipherOutputStream stream3 = new CipherOutputStream(stream2, nc);
stream3.write(new byte[] {0}, 0, 0);
System.out.println(&quot;OK&quot;);
} catch (Exception e) {
e.printStackTrace();
} 
}
}
==============================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
OK
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.IllegalStateException: Cipher has not yet been initialized properly
at javax.crypto.Cipher.update(Cipher.java:537)
at javax.crypto.CipherOutputStream.write(CipherOutputStream.java:76)
at javax.crypto.CipherOutputStream.write(CipherOutputStream.java:68)
at javax.crypto.CipherOutputStream.write(CipherOutputStream.java:78)
at test.main(test.java:12)
[classlib][security]javax.security.cert.X509Certificate.getInstance((null) throws unspecified NPE
The Harmony throws unspecified NPE for the javax.security.cert.X509Certificate.getInstance( null ) method while RI throws CertificateException (according to the specification).
=================== test.java ========================
import java.io.InputStream;
import javax.security.cert.*;
public class test { 
public static void main (String[] args) { 
try { 
X509Certificate.getInstance((byte[]) null); 
} catch (Exception e) {
e.printStackTrace();
}
try { 
X509Certificate.getInstance((InputStream) null); 
} catch (Exception e) {
e.printStackTrace();
}
}
}
==================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
javax.security.cert.CertificateException: Unsupported argument type
at javax.security.cert.X509Certificate.getInst(X509Certificate.java:208)
at javax.security.cert.X509Certificate.getInstance(X509Certificate.java:185)
at test.main(test.java:7)
javax.security.cert.CertificateException: Unsupported argument type
at javax.security.cert.X509Certificate.getInst(X509Certificate.java:208)
at javax.security.cert.X509Certificate.getInstance(X509Certificate.java:159)
at test.main(test.java:12)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.NullPointerException
at java.io.ByteArrayInputStream.&lt;init&gt;(ByteArrayInputStream.java:56)
at javax.security.cert.X509Certificate.getInstance(X509Certificate.java:202)
at test.main(test.java:7)
java.lang.NullPointerException
at org.apache.harmony.security.provider.cert.X509CertFactoryImpl.engineGenerateCertificate(X509CertFactoryImpl.java:87)
at java.security.cert.CertificateFactory.generateCertificate(CertificateFactory.java:186)
at javax.security.cert.X509Certificate.getInstance(X509Certificate.java:91)
at test.main(test.java:12)
[classlib][nio] java.nio.channels.DatagramChannel.read(ByteBuffer[]) and read(ByteBuffer[],int,int) fail to return even some data are available.
java.nio.channels.DatagramChannel.read(ByteBuffer[]) and read(ByteBuffer[],int,int) fail to return even some data are available.
Following test reproduces the problem:
public void test_read_$LByteBuffer() throws Exception {
int capcity = 64;
DatagramChannel channel1 = DatagramChannel.open();
DatagramChannel channel2 = DatagramChannel.open();
// make connection between channel1 and channel2
channel1.socket().bind(
new InetSocketAddress(InetAddress.getLocalHost(), 0));
channel2.socket().bind(
new InetSocketAddress(InetAddress.getLocalHost(), 0));
channel1.connect(channel2.socket().getLocalSocketAddress());
channel2.connect(channel1.socket().getLocalSocketAddress());
// channel2 writes some data to channel1
channel2.write(ByteBuffer.allocate(capcity));
ByteBuffer[] readBuf = new ByteBuffer[2];
readBuf[0] = ByteBuffer.allocateDirect(capcity);
readBuf[1] = ByteBuffer.allocateDirect(capcity);
channel1.configureBlocking(true);
// channel1 reads some data from channel2
// Harmony hangs at this line.
long ret = channel1.read(readBuf);
assertEquals(capcity, ret);
}
RI passes the test while Harmony fails. 
I'll upload a patch soon.
Thanks!
Best regards,
Andrew
[classlib][security] java.security.SecureRandom.getAlgorithm() returns &quot;null&quot; instead of &quot;unknown&quot;
According to specification method java.security.SecureRandom.getAlgorithm() must return the name of the algorithm or 'unknown' if the algorithm name cannot be determined. If the SecureRandom object was created with provider == null Harmony returns 'null' instead of &quot;unknown&quot;.
================== test.java =======================
import java.security.*;
public class test {
public static void main (String[] args) { 
System.out.println(&quot;getAlgorithm() = &quot; + new testSecureRandom(new TestSecureRandomSpi(), null).getAlgorithm());
}
}
class testSecureRandom extends SecureRandom {
public testSecureRandom(SecureRandomSpi secureRandomSpi, Provider provider) {
super(secureRandomSpi, provider);
}
}
class TestSecureRandomSpi extends SecureRandomSpi {
private static final long serialVersionUID = 1L;
protected void engineSetSeed(byte[] arg) {
}
protected void engineNextBytes(byte[] arg) {
}
protected byte[] engineGenerateSeed(int arg) {
return new byte[1];
}
}
================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
getAlgorithm() = unknown
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
getAlgorithm() = null
[classlib][nio] java.nio.channels.ServerSocketChannel.accept() should throw IllegalBlockingModeException if the channel is in non-blocking mode and there is no pending connetions.
java.nio.channels.ServerSocketChannel.accept() should throw IllegalBlockingModeException if the channel is in non-blocking mode and there is no pending connetions. Following test reproduces the bug:
public void testAccept_NonBlocking_NoConnect() throws IOException {
ServerSocketChannel sc = ServerSocketChannel.open();
sc.configureBlocking(false);
try {
sc.socket().accept();
fail(&quot;Should throw IllegalBlockingModeException&quot;);
} catch (IllegalBlockingModeException e) {
// expected
}
}
RI 5.0 passes the test while Harmony fails. 
I'll upload a patch to fix the problem soon.
Thanks!
[classlib][security] compatibility: unexpected ArrayIndexOutOfBoundsException for MessageDigest.digest(byte[],Integer.MAX_VALUE,int);
The Harmony throws the ArrayIndexOutOfBoundsException for methods MessageDigest.getInstance(&quot;SHA&quot;).digest(new byte[] {},Integer.MAX_VALUE,755) and MessageDigest.getInstance(&quot;SHA&quot;).update(new byte[] {},Integer.MAX_VALUE,Integer.MAX_VALUE) while RI throws IllegalArgumentException.
============================ test.java ===============================
import java.security.*;
public class test {
public static void main (String[] args) { 
try { 
MessageDigest.getInstance(&quot;SHA&quot;).digest(new byte[] {},Integer.MAX_VALUE,755); 
} catch (Exception e) {
e.printStackTrace(); 
}
try { 
MessageDigest.getInstance(&quot;SHA&quot;).update(new byte[] {},Integer.MAX_VALUE,Integer.MAX_VALUE); 
} catch (Exception e) {
e.printStackTrace(); 
}
}
} 
====================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
java.lang.IllegalArgumentException: Output buffer too small for specified offset and length
at java.security.MessageDigest.digest(MessageDigest.java:333)
at test.main(test.java:6)
java.lang.IllegalArgumentException: Input buffer too short
at java.security.MessageDigest.update(MessageDigest.java:267)
at test.main(test.java:11)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.ArrayIndexOutOfBoundsException
at java.lang.Throwable.&lt;init&gt;(Throwable.java:61)
at java.lang.System.arraycopy(System.java:274)
at java.lang.System.arraycopy(System.java:184)
at java.security.MessageDigestSpi.engineDigest(MessageDigestSpi.java:110)
at java.security.MessageDigest.digest(MessageDigest.java:208)
at test.main(test.java:6)
java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 2147483647
at org.bouncycastle.crypto.digests.SHA1Digest.processWord(Unknown Source)
at org.bouncycastle.crypto.digests.GeneralDigest.update(Unknown Source)
at org.bouncycastle.jce.provider.JDKMessageDigest.engineUpdate(Unknown Source)
at java.security.MessageDigest.update(MessageDigest.java:172)
at test.main(test.java:11)
[classlib][nio]refactory nio buffer test step 3 - DoubleBuffer tests
Here goes the third step of buffers' test refactory - DoubleBufferTest, and again, I fixed some exception compatiblity bug found during the refactory. I'll attach patch soon.
[classlib][security] unexpected NPE for java.security.cert.X509CRLSelector.setIssuerNames(user_defined_collection);
The Harmony method java.security.cert.X509CRLSelector.setIssuerNames(Collection) throws unexpected NPE while RI does not.
======================= test.java ==============================
import java.security.cert.X509CRLSelector;
import java.util.*;
public class test {
public static void main (String[] args) { 
try { 
new X509CRLSelector().setIssuerNames(new testSortedSet());
System.out.println(&quot;passed: no ex&quot;);
} catch (Exception e) {
System.out.println(&quot;failed: &quot; + e);
}
} 
}
class testSortedSet implements SortedSet {
public Comparator comparator() {
return null;
}
public Object first() {
return null;
}
public SortedSet headSet(Object p0) {
return null;
}
public Object last() {
return null;
}
public SortedSet subSet(Object p0, Object p1) {
return null;
}
public SortedSet tailSet(Object p0) {
return null;
}
public boolean add(Object p0) {
return false;
}
public boolean addAll(Collection p0) {
return false;
}
public void clear() {
return;
}
public boolean contains(Object p0) {
return false;
}
public boolean containsAll(Collection p0) {
return false;
}
public boolean equals(Object p0) {
return false;
}
public int hashCode() {
return 0;
}
public boolean isEmpty() {
return false;
}
public Iterator iterator() {
return null;
}
public boolean remove(Object p0) {
return false;
}
public boolean removeAll(Collection p0) {
return false;
}
public boolean retainAll(Collection p0) {
return false;
}
public int size() {
return 0;
}
public Object[] toArray() {
return null;
}
public Object[] toArray(Object[] p0) {
return null;
}
}
====================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
passed: no ex
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
failed: java.lang.NullPointerException
[classlib][security]unexpected exceptions for java.security.cert.X509CRLSelector().addIssuerName(String)
The Harmony java.security.cert.X509CRLSelector().addIssuerName(String) throws unexpected IllegalArgumentException and
NullPointerException while RI not.
========================= test.java ============================
import java.security.cert.X509CRLSelector;
import java.io.IOException;
public class test {
public static void main (String[] args) { 
try { 
new X509CRLSelector().addIssuerName(&quot;a&quot;);
System.out.println(&quot;passed: no ex&quot;);
} catch (IOException e) {
System.out.println(&quot;passed&quot;);
} catch (Exception e) {
System.out.println(&quot;failed: &quot; + e);
}
try { 
new X509CRLSelector().addIssuerName((String)null);
System.out.println(&quot;passed: no ex&quot;);
} catch (Exception e) {
System.out.println(&quot;failed: &quot; + e);
}
} 
}
=======================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
passed
passed: no ex
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
failed: java.lang.IllegalArgumentException: Invalid distinguished name string
failed: java.lang.NullPointerException
[classlib][security] unexpected IllegalArgumentException for java.security.UnresolvedPermission(&quot;&quot;, String, String,Certificate[] )
The Harmony throws IllegalArgumentException for java.security.UnresolvedPermission(&quot;&quot;, String, String,Certificate[] ) while RI create object.
============== test.java =================
import java.security.*;
import java.security.cert.Certificate;
public class test { 
public static void main (String[] args) { 
System.out.println(&quot;&quot; + new UnresolvedPermission(&quot;&quot;,&quot;b&quot;,&quot;c&quot;, new Certificate[948]));
} 
}
======================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
(unresolved b c)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: type cannot be empty
at java.security.UnresolvedPermission.checkType(UnresolvedPermission.java:114)
at java.security.UnresolvedPermission.&lt;init&gt;(UnresolvedPermission.java:89)
at test.main(test.java:6)
[classlib][security] unexpected NPE for java.security.spec.EllipticCurve.getSeed() if seed = null
The Harmony throws unexpected NPE for java.security.spec.EllipticCurve.getSeed() if seed = null while RI return null.
================ test.java ==========================
import java.math.BigInteger;
import java.security.spec.*;
public class test {
public static void main (String[] args) { 
System.out.println(&quot;seed = &quot; + new EllipticCurve(new ECFieldFp(new BigInteger(&quot;4&quot;)), BigInteger.ONE, BigInteger.ONE).getSeed());
} 
}
=================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
seed = null
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Exception in thread &quot;main&quot; java.lang.NullPointerException
at java.security.spec.EllipticCurve.getSeed(EllipticCurve.java:125)
at test.main(test.java:6)
[classlib][security]compatibility: unexpected IllegalArgumentException for java.security.spec.EllipticCurve(&lt;2&gt;, 4, 1)
The Harmony throws IllegalArgumentException to create java.security.spec.EllipticCurve(&lt;2&gt;, 4, 1) while RI does not.
===================== test.java =======================
import java.math.BigInteger;
import java.security.spec.*;
public class test {
public static void main (String[] args) { 
EllipticCurve ec = new EllipticCurve(new testECField(), new BigInteger(&quot;4&quot;), BigInteger.ONE);
System.out.println(&quot;a = &quot; + ec.getA() + &quot;; b = &quot; + ec.getB() + &quot;; size = &quot; + ec.getField().getFieldSize());
} 
}
class testECField implements ECField {
public int getFieldSize() {
return 2;
}
}
===================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
a = 4; b = 1; size = 2
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: the a is not in the field
at java.security.spec.EllipticCurve.&lt;init&gt;(EllipticCurve.java:84)
at java.security.spec.EllipticCurve.&lt;init&gt;(EllipticCurve.java:96)
at test.main(test.java:6)
java.util.regex.MatcherResult.group() throws unexpected IllegalStateException
Hello,
java.util.regex.MatchResult.group() throws unexpected IllegalStateException. According to the spec toMatchResult() 'Returns the match state of this matcher as a MatchResult. The result is unaffected by subsequent operations performed upon this matcher.' But, when invoking query methods on harmony MatchResult, IllegalStateException will be thrown out.
The following test case will pass on RI, but fail on Harmony.
public void test_toMatchResult() {
Pattern pattern = Pattern.compile(&quot;\\p{Lower}+&quot;);
Matcher matcher = pattern.matcher(&quot;test&quot;);
assertTrue(matcher.matches());
assertEquals(&quot;test&quot;, matcher.toMatchResult().group());
}
Best regards,
Richard
[classlib][nio] java.nio.channels.SocketChannel.read(ByteBuffer[],int,int) fails to return even there are some data available.
java.nio.channels.SocketChannel.read(ByteBuffer[],int,int) fails to return even there are some data available.
Following test case reproduces the bug:
public void test_read_$ByteBufferII_Blocking() throws IOException {
final int CAPACITY_NORMAL = 200;
SocketChannel sc = SocketChannel.open();
ServerSocket server = new ServerSocket(50000);
byte[] data = new byte[CAPACITY_NORMAL];
for (int i = 0; i &lt; CAPACITY_NORMAL; i++) {
data[i] = (byte) i;
}
ByteBuffer[] bufferArray = new ByteBuffer[2];
bufferArray[0] = ByteBuffer.allocate(CAPACITY_NORMAL);
bufferArray[1] = ByteBuffer.allocate(CAPACITY_NORMAL);
sc.connect(new InetSocketAddress(InetAddress.getLocalHost(),50000));
Socket socket = server.accept();
OutputStream out = socket.getOutputStream();
out.write(data);
// Harmony fails to return here.
sc.read(bufferArray);
}
RI returns while Harmony hangs.
[classlib][security] unexpected exceptions for X509CertSelector. addSubjectAlternativeName(&lt;2,4,6,7,8&gt;, String name)
According to 1.5 spec java.security.X509CertSelector. addSubjectAlternativeName(int type, String name) method must throw IOException - if a parsing error occurs. 
Harmony throws
1) nothing if type =2,6 and name == null; RI throws IOException
2) IAE if type =4,8 ; RI throws IOException
3) NumberFormatException if type = 7 and name == non-null incorrect string; RI throws IOException
===================== test.java =========================
import java.security.cert.X509CertSelector;
import java.io.IOException;
public class test {
public static void main (String[] args) { 
for (int type = 0; type &lt;=8; type++) {
try {
new X509CertSelector().addSubjectAlternativeName(type,&quot;0xDFRF&quot;); 
} catch (IOException e) {
System.out.println(&quot;[&quot; + type + &quot;] -&gt; passed: &quot; + e);
} catch (Exception e) {
System.out.println(&quot;[&quot; + type + &quot;] -&gt; failed: &quot; + e);
}
}
} 
}
=====================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
[0] -&gt; passed: java.io.IOException: unable to parse String names of type 0
[2] -&gt; passed: java.io.IOException: DNSName components must begin with a letter
[3] -&gt; passed: java.io.IOException: unable to parse String names of type 3
[4] -&gt; passed: java.io.IOException: Incorrect AVA format
[5] -&gt; passed: java.io.IOException: unable to parse String names of type 5
[6] -&gt; passed: java.io.IOException: URI name must include scheme
[7] -&gt; passed: java.io.IOException: Invalid IPAddress: 0xDFRF
[8] -&gt; passed: java.io.IOException: Unable to create OIDName: java.lang.NumberFormatException: For input string: &quot;0xDFRF&quot;
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
[0] -&gt; passed: java.io.IOException: Unknown string representation for type [0]
[3] -&gt; passed: java.io.IOException: Unknown string representation for type [3]
[4] -&gt; failed: java.lang.IllegalArgumentException: Invalid distinguished name string
[5] -&gt; passed: java.io.IOException: Unknown string representation for type [5]
[7] -&gt; failed: java.lang.NumberFormatException: 0xDFRF
[8] -&gt; failed: java.lang.IllegalArgumentException: Incorrect syntax
[classlib][security] unexpected exception for java.security.X509CertSelector.addPathToName (&lt;1,2,4,7,8&gt;, (String) null)
According to 1.5 spec java.security.X509CertSelector.addPathToName method must throw IOException - if a parsing error occurs. 
Harmony if second parameter == null throws 
1) NPE if type = 4 or 7
2) IllegalArgumentException if type = 8
3) correct IOException if type =0,3,5,6
4) does not throw any exception if type=1,2
while RI throws IOException.
====================== test.java ==========================
import java.security.cert.X509CertSelector;
import java.io.IOException;
public class test {
public static void main (String[] args) { 
for (int type = 0; type &lt;=8; type++) {
try {
new X509CertSelector().addPathToName(type, (String) null); 
} catch (IOException e) {
System.out.println(&quot;[&quot; + type + &quot;] -&gt; passed: &quot; + e);
} catch (Exception e) {
System.out.println(&quot;[&quot; + type + &quot;] -&gt; failed: &quot; + e);
}
}
} 
}
=======================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
[0] -&gt; passed: java.io.IOException: name not String or byte array
[1] -&gt; passed: java.io.IOException: name not String or byte array
[2] -&gt; passed: java.io.IOException: name not String or byte array
[3] -&gt; passed: java.io.IOException: name not String or byte array
[4] -&gt; passed: java.io.IOException: name not String or byte array
[5] -&gt; passed: java.io.IOException: name not String or byte array
[6] -&gt; passed: java.io.IOException: name not String or byte array
[7] -&gt; passed: java.io.IOException: name not String or byte array
[8] -&gt; passed: java.io.IOException: name not String or byte array
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
[0] -&gt; passed: java.io.IOException: Unknown string representation for type [0]
[3] -&gt; passed: java.io.IOException: Unknown string representation for type [3]
[4] -&gt; failed: java.lang.NullPointerException
[5] -&gt; passed: java.io.IOException: Unknown string representation for type [5]
[7] -&gt; failed: java.lang.NullPointerException
[8] -&gt; failed: java.lang.IllegalArgumentException: ObjectIdentifier string is null
[classlib][beans] some tests from StatementTest fails
Currently 20 of 50 tests from org.apache.harmony.beans.tests.java.beans.StatementTest class fail. I have created a patch to enable another 9 tests. Please see details below. 
-testExceptionThrownOnMethodCall 
The test Bean was implemented incorrectly. This test fails on RI also. The bean was corrected.
-testConstructor_Normal
-testConstructor_NullTarget
-testConstructor_ArrayTarget
-testConstructor_NullMethodName
-testConstructor_NewMethodName
-testConstructor_EmptyMethodName
-testConstructor_NullArguments
-testConstructor_NullArgument
Fail on RI also. Specific implementation of Statement.toString() method was being checked. I replaced it with checking of our implementation. Our toString() was fixed to correspond with RI beforehand. I have started the new mail thread in the list concerning do we need to care about toString compatibility in the future.
-testGetArguments
-testGetMethodName
-testGetTarget
-testToString
I commented 'em out since they are empty.
testExecute_NullMethodName
Invalid test, I commented it out. It fails on RI also. Method name should not be null.
kernel class VM lacks intern() method
The removal of String and StringBuffer classes (HARMONY-666) from DRLVM has missed the necessary update
to org.apache.harmony.kernel.vm.VM.
The following test reproduces the problem:
---8&lt;---
public class StringIntern {
public static void main(String[] args) {
String s = &quot;abcde&quot;;
String s0 = &quot;abcde&quot;.intern();
String s1 = (&quot;abc&quot; + &quot;de&quot;).intern();
String s2 = (&quot;ab&quot; + &quot;cde&quot;).intern();
if (s0 != s1 || s1 != s2) {
System.out.println(&quot;FAIL: incorrect interning&quot;);
} else if (s != s0) {
System.out.println(&quot;FAIL: literal is not interned&quot;);
} else {
System.out.println(&quot;PASS&quot;);
} 
} 
} 
---------
Current output on Linux/ia32 is
$ ./lnx_ia32_gcc_debug/deploy/jre/bin/ij -cp ./lnx_ia32_gcc_release/semis/vm/_smoke.tests/classes util.StringIntern
java.lang.NoSuchMethodError: Can't find method org/apache/harmony/kernel/vm/VM.intern(Ljava/lang/String;)Ljava/lang/String; while resolving constant pool entry at index 59 in class java/lang/String
at util.StringIntern.main()
[classlib][lang]String.contentEquals((CharSequence)&quot;&quot;) always return true
The harmony java.lang.String.contentEquals(&quot;&quot;) method always return true while spec says:
&quot;true if and only if this String represents the same sequence of char ...&quot;
===================== test.java ==========================
public class test {
public static void main (String[] args) { 
System.out.println(&quot;'qwerty'.contentEquals(\&quot;\&quot;) = &quot; + &quot;qwerty&quot;.contentEquals(&quot;&quot;)); 
} 
}
======================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-jdk1.5.0-windows-ia32\bin\java.exe -showversion test
java version &quot;1.5.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0-b64)
BEA WebLogic JRockit(R) (build dra-38972-20041208-2001-win-ia32, R25.0.0-75, GC: System optimized over throughput (initial strategy singleparpar))
'qwerty'.contentEquals(&quot;&quot;) = false
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
'qwerty'.contentEquals(&quot;&quot;) = true
[classlib][nio] java.nio.channels.DatagramChannel.send(ByteBuffer, SocketAddress) sends data incorrectly if the position of ByteBuffer is not zero.
java.nio.channels.DatagramChannel.send(ByteBuffer, SocketAddress) sends data incorrectly if the position of ByteBuffer is not zero.
Following test case reproduces the bug. 
I'll upload a patch soon. Thanks! 
Test case:
public void test_send_LBuffer_LSocketAddress_PositionNotZero() throws Exception {
int CAPACITY_NORMAL = 256;
int postion = 16;
DatagramChannel dc = DatagramChannel.open();
SocketAddress addr = new InetSocketAddress(&quot;127.0.0.1&quot;, 50000);
byte[] sourceArray = new byte[CAPACITY_NORMAL];
// send ByteBuffer whose position is not zero
ByteBuffer sourceBuf = ByteBuffer.wrap(sourceArray);
sourceBuf.position(postion);
assertEquals(CAPACITY_NORMAL - postion, dc.send(sourceBuf, addr));
}
Test result:
RI 5.0 passes the test while Harmony fails. 
Best regards,
Andrew
drlvm: Remove cpptasks patching and move to cpptasks 1.0b4
There will be a patch that removes the cpptasks patching from the drlvm build (it was originally used as workaround for cctask bug
#1402730).
The cpptasks-1.0b4 seem to be working fine for the build (it increases the cmd line limit for dev studio up to 32768), it is now can be used instead of 1.0b3
Harmony regex does not support Character.isXXX character classes
According to JavaDoc specification java.util.regex.Patter should provide character classes corresponding to all Character.isXXX methods except deprecated:
&quot;Categories that behave like the java.lang.Character boolean ismethodname methods (except for the deprecated ones) are available through the same \p{prop} syntax where the specified property has the name javamethodname.&quot;
Harmony implementation supports only for, which named directly in the spec:
java.lang.Character classes (simple java character type) 
\p{javaLowerCase} Equivalent to java.lang.Character.isLowerCase() 
\p{javaUpperCase} Equivalent to java.lang.Character.isUpperCase() 
\p{javaWhitespace} Equivalent to java.lang.Character.isWhitespace() 
\p{javaMirrored} Equivalent to java.lang.Character.isMirrored() 
The others should be also implemented.
Pattern throws ArrayIndexOutOfBoundsException when mathching regexp
Use the following code to reproduce:
import java.util.regex.Pattern;
import junit.framework.TestCase;
public class Test extends TestCase {
public void testPatternMatcher() throws Exception {
Pattern pattern = Pattern.compile(&quot;(?:\\d+)(?:pt)&quot;);
assertTrue(pattern.matcher(&quot;14pt&quot;).matches());
}
}
[classlib][io]java.io.BufferedInputStream.skip(int n) unexpected NPE
The java.io.BufferedInputStream.skip(int n) throws unexpected NPE if object was constructed as BufferedInputStream(null, ...) while RI throws IOException. The same behavior observed for java.io.BufferedInputStream.close() too.
=================== test.java ============================
import java.io.*;
public class test {
public static void main (String[] args) { 
BufferedInputStream buf = new BufferedInputStream(null,5);
try {
buf.skip(1);
} catch (Exception e) {
e.printStackTrace();
} 
try {
buf.close();
} catch (Exception e) {
e.printStackTrace();
} 
} 
}
======================================================
Output:
C:\tmp\tmp17&gt;C:\jrockit-j2sdk1.4.2_04\bin\java.exe -showversion test
java version &quot;1.4.2_04&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_04-b05)
BEA WebLogic JRockit(TM) 1.4.2_04 JVM (build ari-31788-20040616-1132-win-ia32, Native Threads, GC strategy: parallel)
java.io.IOException: Stream closed
at java.io.BufferedInputStream.ensureOpen()V(BufferedInputStream.java:120)
at java.io.BufferedInputStream.skip(J)J(BufferedInputStream.java:296)
at test.main([Ljava.lang.String;)V(test.java:7)
C:\tmp\tmp17&gt;C:\harmony\trunk_0427\deploy\jdk\jre\bin\java.exe -showversion test
java version 1.5 (subset)
(c) Copyright 1991, 2006 The Apache Software Foundation or its licensors, as applicable.
java.lang.NullPointerException
at java.io.BufferedInputStream.skip(BufferedInputStream.java:339)
at test.main(test.java:7)
java.lang.NullPointerException
at java.io.FilterInputStream.close(FilterInputStream.java:68)
at java.io.BufferedInputStream.close(BufferedInputStream.java:112)
at test.main(test.java:12)
C:\tmp\tmp17&gt;
Pack200 file with just resources
This file is a pack200 Jar file that just contains resources, which can be used to substitute the HelloWorld.pack that's used in the SegmentTest test case. I've commented out the one that will fail and the JustResources.pack can be put in the same place as the HelloWorld.pack one
Index: /Users/alex/Documents/HarmonyWorkspace/Pack200/src/test/java/org/apache/harmony/archive/tests/internal/pack200/SegmentTest.java
===================================================================
--- /Users/alex/Documents/HarmonyWorkspace/Pack200/src/test/java/org/apache/harmony/archive/tests/internal/pack200/SegmentTest.java (revision 415823)
+++ /Users/alex/Documents/HarmonyWorkspace/Pack200/src/test/java/org/apache/harmony/archive/tests/internal/pack200/SegmentTest.java (working copy)
@@ -29,9 +29,17 @@
* @param args
* @throws Exception
*/
- public void testHelloWorld() throws Exception {
+// public void testHelloWorld() throws Exception {
+// assertNotNull(Segment.parse(Segment.class
+// .getResourceAsStream(&quot;/org/apache/harmony/archive/tests/internal/pack200/HelloWorld.pack&quot;)));
+// }
+ /**
+ * @param args
+ * @throws Exception
+ */
+ public void testJustResources() throws Exception {
assertNotNull(Segment.parse(Segment.class
- .getResourceAsStream(&quot;/org/apache/harmony/archive/tests/internal/pack200/HelloWorld.pack&quot;)));
+ .getResourceAsStream(&quot;/org/apache/harmony/archive/tests/internal/pack200/JustResources.pack&quot;)));
}
}
tests.api.java.io.FileTest failures on Windows XP
Hello Tim,
If the 8.3 filename support is disabled on WinXP, there will be several failures in tests.api.java.io.FileTest when running on Harmony and RI. I think it may be a bug in the test case. Thanks a lot.
To disable 8.3 filename support:
1. Execute: fsutil behavior set disable8dot3 1
2. restart
Best regards,
Richard
java.security.KeyStoreSpi.engineEntryInstanceOf(..) doesn't distinguish PrivateKeyEntry and SecretKeyEntry
The method can only tell the difference between a certificate entry and a key entry, but doesn't distinguish KeyStore.PrivateKeyEntry and KeyStore.SecretKeyEntry.
Test case that reveals the problem is down here:
import java.security.*;
import javax.crypto.*;
public class KeyStoreSpi_engineEntryInstanceOfTest {
public static void main(String[] args) throws Exception {
// create a KeyStore
KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());
keyStore.load(null, &quot;pwd&quot;.toCharArray());
// genarate a key
KeyGenerator keyGen = KeyGenerator.getInstance(&quot;DES&quot;);
keyGen.init(56);
SecretKey secretKey = keyGen.generateKey();
// put the key into keystore
String alias = &quot;alias&quot;;
keyStore.setKeyEntry(alias, secretKey, &quot;pwd&quot;.toCharArray(), null);
// check if it is a secret key
if (keyStore.entryInstanceOf(alias, KeyStore.SecretKeyEntry.class)) {
System.out.println(&quot;OK&quot;);
}
// check if it is a private key
if (keyStore.entryInstanceOf(alias, KeyStore.PrivateKeyEntry.class)) {
System.out.println(&quot;TEST FAILED&quot;);
}
}
}
The good way to check if the entry is an instance of the given class would be to get the entry from the keystore and call instanceof. But there is not enough data to do the check in this way, because password is required to get the entry, and there is no such parameter. So check if the entry has certificate chain in it or not seems to be the only way to distinguish KeyStore.PrivateKeyEntry and KeyStore.SecretKeyEntry.
HashMap hashcode ignores values in entries
While it is obviously trivial to create different HashMaps with identical hashCodes, I'd still expect the following test code to pass:
HashMap map1 = new HashMap(10);
HashMap map2 = new HashMap(10);
map1.put(&quot;key&quot;, &quot;1&quot;);
map2.put(&quot;key&quot;, &quot;2&quot;);
assertFalse(map1.hashCode() == map2.hashCode());
That is, I'd expect the 'value' associated with &quot;key&quot; to have some impact on the hashCode. It passes on the reference implementations I tested.
RI's java.util.UnknownFormatConversionException has different behavior with Java spec
Spec for UnknownFormatConversionException says:
&quot;Unless otherwise specified, passing a null argument to any method or constructor in this class will cause a NullPointerException to be thrown.&quot;
But RI's implementation of UnknownFormatConversionException constructor accept null String silently. 
Harmony's implementation comply with spec.
The method PropertyEditorSupport.getAsText() throws ClassCastException.
The method PropertyEditorSupport.getAsText() throws ClassCastException if the source object is not of Type String.
Code for reproducing: 
public class Test {
public static void main(String[] args) {
PropertyEditor editor = new TestEditor();
editor.setValue(new Object());
System.out.println(editor.getAsText());
System.out.println(&quot;PASS&quot;);
}
private static class TestEditor extends PropertyEditorSupport {
private TestEditor() {
super();
}
}
}
java.text.BreakIterator.get*Instance((Locale)null) behaviour
The reference implementation throws NullPointerExceptions when the static methods BreakIterator.get*Instance(Locale) are passed null. Harmony doesn't throw any exceptions.
I will attach a patch shortly.
java.nio.CharBuffer.wrap NullPointerException behaviour
java.nio.CharBuffer.wrap((j.l.CharSequence)null,(int)1,(int)0) throws a NullPointerException on the RI but Harmony throws an index out of bounds exception.
I will submit a patch with a fix and test shortly.
HashMap's behavior is non-compliant with RI when key is reused
As discussion in mailing list, when hash key is reused by modify its hashcode, Harmony's HashMap show different behavior with RI. There are some ways to mimic RI's behavior, including rehash the hash of key, and cache the hash when key/value pair is put into. I will attach patches soon.
Test case:
public class HashMapTest { 
public static void main(String[] args) { 
ReusableKey k = new ReusableKey(); 
HashMap map = new HashMap(); 
k.setKey(1); 
map.put(k, &quot;value1&quot;); 
k.setKey(18); 
System.out.println(map.get(k)); 
k.setKey(17); 
System.out.println(map.get(k)); 
} 
} 
class ReusableKey{ 
private int key = 0; 
public void setKey(int key){ 
this.key = key; 
} 
public int hashCode(){ 
return key; 
} 
public boolean equals(Object o){ 
if(o == this){ 
return true; 
} 
if(!(o instanceof ReusableKey)){ 
return false; 
} 
return key == ((ReusableKey)o).key; 
} 
} 
RI 5.0 output:
null 
null 
Harmony output:
null 
value1
java.text.DecimalFormat does not parse infinite values correctly
In Java 1.4.2 Spec of java.text.DecimalFormat.parse(String, ParsePosition), it's said:
Values that cannot fit into a Long are returned as Doubles. This includes values with a fractional part, infinite values, NaN, and the value -0.0.
The test cases will fail if excuting under Harmony and pass on RI:
// Test whether DecimalFormat can parse Positive infinity correctly
public void testParseInfinityBigDecimalFalse() {
DecimalFormat format = (DecimalFormat) DecimalFormat.getInstance();
DecimalFormatSymbols symbols = new DecimalFormatSymbols();
Number number = format.parse(symbols.getInfinity(), new ParsePosition(0));
assertTrue(number instanceof Double);
assertTrue(Double.isInfinite(number.doubleValue()));
}
// Test whether DecimalFormat can parse Negative infinity correctly
public void testParseMinusInfinityBigDecimalFalse() {
DecimalFormat format = (DecimalFormat) DecimalFormat.getInstance();
DecimalFormatSymbols symbols = new DecimalFormatSymbols();
Number number = format.parse(&quot;-&quot; + symbols.getInfinity(),
new ParsePosition(0));
assertTrue(number instanceof Double);
assertTrue(Double.isInfinite(number.doubleValue()));
}
The validateUTF function of class Text throws MalformedInputException for valid UTF8 code containing ascii chars
The validateUTF function does not handle ascii chars right therefore causing MIE exception to be thrown.
MiniMapReduce tests get stuck because of some timing issues with initialization of tasktrackers.
The MiniMapReduce tests sometimes calls shutdown before the tasktrackers have been initialized. This makes the TestMiniMRBringup run for ever.
the hadoop-daemons.sh fails with &quot;no such file or directory&quot; when used from a relative path
The new shell scripts fail with a relative directory:
% current/bin/hadoop-daemons.sh start datanode
node1: current/bin/..: No such file or directory
node2: current/bin/..: No such file or directory
The problem is that HADOOP_HOME is set to a relative directory and hadoop-daemons does a cd, breaking the other scripts.
rcc does not generate correct Java code for the field of a record type
If a field of a Jute record is also a Jute record and the target language is Java, rcc does not generate correct field name, correct code for deserializing the field. The access modifier &quot;private&quot; of the validation method causes problem for validating nested records.
In addition, rcc can not handle the case when a comment started with &quot;//&quot; also contains the string &quot;//&quot;.
improved error messages for file checksum errors
Improves the messages on a couple of the failures we've been seeing to try and get enough information to identifiy the problem.
unit tests fail on windows
When I run the &quot;ant test&quot; target under Windows, I get the following exception in the logs for the streaming unit tests. The unit tests need to run under Windows, if it is going to be a supported platform. So we either need to remove the streaming unit tests or make them work.
Testsuite: org.apache.hadoop.streaming.TestStreaming
Tests run: 1, Failures: 1, Errors: 0, Time elapsed: 0.172 sec
Testcase: testCommandLine took 0.172 sec
FAILED
java.lang.RuntimeException: Operating system Windows XP not supported by this class
at org.apache.hadoop.streaming.Environment.&lt;init&gt;(Environment.java:47)
at org.apache.hadoop.streaming.StreamJob.init(StreamJob.java:68)
at org.apache.hadoop.streaming.StreamJob.go(StreamJob.java:55)
at org.apache.hadoop.streaming.TestStreaming.testCommandLine(Unknown Source)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:2
97)
at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.jav
a:672)
at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:
567)
The reduce tasks poll for mapoutputs in a loop
The Reduce tasks poll for the mapoutputs in a loop. The polling thread should be sleeping for 5 seconds before polling again but there is a bug in updating the timestamps which make the reduce task poll in a loop without sleeping.
Datanode does not scan for an open http port
The DataNode does not scan for an open http port. Only the singleton servers are allowed to have required port assignments.
Introduce a way for datanodes to register their HTTP info ports with the NameNode
If we have multiple datanodes within a single machine the Jetty servers (other than the first one) won't be able to bind to the fixed HTTP port. So, one solution is to have the datanodes pick a free port (starting from a configured port value) and then inform namenode about it so that the namenode can then do redirects, etc.
Johan Oskarson reported this problem. 
If a computer have a second dfs data dir in the config it doesn't start properly because of:
Exception in thread &quot;main&quot; java.io.IOException: Problem starting http server
at org.apache.hadoop.mapred.StatusHttpServer.start(StatusHttpServer.java:182)
at org.apache.hadoop.dfs.DataNode.&lt;init&gt;(DataNode.java:170)
at org.apache.hadoop.dfs.DataNode.makeInstanceForDir(DataNode.java:1045)
at org.apache.hadoop.dfs.DataNode.run(DataNode.java:999)
at org.apache.hadoop.dfs.DataNode.runAndWait(DataNode.java:1015)
at org.apache.hadoop.dfs.DataNode.main(DataNode.java:1066)
Caused by: org.mortbay.util.MultiException[java.net.BindException: Address already in use]
at org.mortbay.http.HttpServer.doStart(HttpServer.java:731)
at org.mortbay.util.Container.start(Container.java:72)
at org.apache.hadoop.mapred.StatusHttpServer.start(StatusHttpServer.java:159)
... 5 more
DistributedFSCheck should cleanup, seek, and report missing files.
datanode crashes on startup with ClassCastException
When I bring up a DataNode it gets a ClassCastException:
Exception in thread &quot;main&quot; java.lang.ClassCastException: java.util.HashMap$Entry
at org.apache.hadoop.dfs.DataNode.runAndWait(DataNode.java:907)
at org.apache.hadoop.dfs.DataNode.main(DataNode.java:954)
This was introduced by the patch for HADOOP-354.
rpc versioning broke out-of-order server launches
The change to check the RPCs broke the ability to bring up the datanodes before the namenode and the tasktracker before the jobtracker.
tasks can get lost when reporting task completion to the JobTracker has an error
Basically, the JobTracker used to lose some updates about successful map tasks and it would assume that the tasks are still running (the old progress report is what it used to display in the web page). Now this would cause the reduces to also wait for the map output and they would never receive the output. This would cause the job to appear as if it was hung.
The following piece of code sends the status of tasks to the JobTracker:
synchronized (this) {
for (Iterator it = runningTasks.values().iterator();
it.hasNext(); ) {
TaskInProgress tip = (TaskInProgress) it.next();
TaskStatus status = tip.createStatus();
taskReports.add(status);
if (status.getRunState() != TaskStatus.RUNNING) {
if (tip.getTask().isMapTask()) {
mapTotal--;
} else {
reduceTotal--;
}
it.remove();
}
}
}
//
// Xmit the heartbeat
//
TaskTrackerStatus status =
new TaskTrackerStatus(taskTrackerName, localHostname,
httpPort, taskReports,
failures);
int resultCode = jobClient.emitHeartbeat(status, justStarted);
Notice that the completed TIPs are removed from runningTasks data structure. Now, if the emitHeartBeat threw an exception (if it could not communicate with the JobTracker till the IPC timeout expires) then this update is lost. And the next time it sends the hearbeat this completed task's status is missing and hence the JobTracker doesn't know about this completed task. So, one solution to this is to remove the completed TIPs from runningTasks after emitHeartbeat returns. Here is how the new code would look like:
synchronized (this) {
for (Iterator it = runningTasks.values().iterator();
it.hasNext(); ) {
TaskInProgress tip = (TaskInProgress) it.next();
TaskStatus status = tip.createStatus();
taskReports.add(status);
}
}
//
// Xmit the heartbeat
//
TaskTrackerStatus status =
new TaskTrackerStatus(taskTrackerName, localHostname,
httpPort, taskReports,
failures);
int resultCode = jobClient.emitHeartbeat(status, justStarted);
synchronized (this) {
for (Iterator it = runningTasks.values().iterator();
it.hasNext(); ) {
TaskInProgress tip = (TaskInProgress) it.next();
if (tip.runstate != TaskStatus.RUNNING) {
if (tip.getTask().isMapTask()) {
mapTotal--;
} else {
reduceTotal--;
}
it.remove();
}
}
}
NPE in Path.equals
An NPE is raised in Path.equals when testing the method with two unequal pathes and with the first one having no drive.
This is due to operator precedence: &amp;&amp; has a higher priority level than ?:
See http://java.sun.com/docs/books/tutorial/java/nutsandbolts/expressions.html
See attached patch (just added some parenthesis and a testcase).
TaskTracker passes incorrect file path to DF under cygwin
The path that is passed is OS dependent. The File abstraction should be used in order to make it universal.
I'm attaching a patch that does that.
We might want to change the path parameter for DF. Making it File rather than String should prevent us from 
bugs like that in the future.
ToolBase calls System.exit
The new ToolBase class calls System.exit when the main routine finishes. That will break if the application uses threads that need to finish before the jvm exits. The normal semantics is that the program doesn't finish execution until all of the non-daemon threads exit (including the main one) and System.exit should never be called except for critical errors.
A stand alone driver for individual tasks
This is a tool to reproduce problems and to run unit tests involving either a map or reduce task.
You just give it a reduce directory on the command line.
Usage: java org.apache.hadoop.mapred.StandaloneReduceTask &lt;taskdir&gt; [&lt;limitmaps&gt;]
taskdir name encodes: task_&lt;jobid&gt;_r_&lt;partition&gt;_&lt;attempt&gt;
taskdir contains job.xml and one or more input files named: map_&lt;dddd&gt;.out
You should run with the same -Xmx option as the TaskTracker child JVM
Missing license headers in graffito-jcr-spring
The following files in o.a.p.g.jcr.spring are missing license headers:
* JcrMappingCallback.java
* JcrMappingOperations.java
* JcrMappingTemplate.java
* MappingDescriptorFactoryBean.java
They were added a month ago in revision 414355 by Christophe Lombart with the message &quot;Review OCM/JCR Spring support&quot;, and seem to be created by Costin Leau. Christophe &amp; Costin, could you please add the standard license headers to these files?
Compile error in o.a.p.g.jcr.nodemanagement.impl.jackrabbit.NodeTypeManagerImpl
The method createNodeTypes() in o.a.p.g.jcr.nodemanagement.impl.jackrabbit.NodeTypeManagerImpl (8 package levels!) refers to the nonexistent method getClassDescriptors() in class o.a.p.g.jcr.mapper.model.MappingDescriptor, causing the compile of jcr/jcr-nodemanagement to fail.
Update build to use Eclipse 3.2 projects, since I-drops have been removed
The following depend is no longer available -
http://download.eclipse.org/tools/emf/downloads/drops/2.2.0/I200606150000/emf-sdo-xsd-SDK-I200606150000.zip
The other Eclipse downloads need to be updated to the final Eclipse 3.2 Callisto released binaries....
No way to get information on a plugin you're about to install through the console
You can't check the license, prerequisites, etc. without manually browsing to the plugin repository site
A locked key in a keystore can never be unlocked.
Once the key of a keystore has been locked it can never be unlocked. This is because the password stored in the gbean attribute is incorrectly being stored as the string representation of the charater array rather than the value of the character array itself. Thanks to Vamsavardhana Reddy for finding the root cause of this problem in FileKeystoreInstance.storePasswords().
Apllications Portlets: &quot;Restart&quot; column does not alternate background color
Newly added Restart link column does not alternate backgound color on the applications portlets.
Duplicate attributes created in config.xml for gbean
Here is the text from a dev list post. For the post responses see: 
http://marc.theaimsgroup.com/?l=geronimo-dev&amp;m=115412195529876&amp;w=2
There is either a problem with the attribute processing on gbeans or the keystore use of this processing, I'm not sure which.
The problem is that there are times when an attribute is being set which result in two entries in the config.xml for the same attribute rather than replacing the current setting. Here is the scenario.
There is an attribute on the keystore instance gbean (the default one we provide) for the keystore lock password and key passwords. The scenario happens with both attributes but I'm most concerned with the keystore lock at the moment so I'll just discuss that one.
With a brand new image, the attribute for the keystore lock is set to the default password (which effectively means it is unlocked). If we lock the keystore the password is then replaced with a null value and this is reflected in the config.xml. So far, so good. However, when we subsequently unlock the keystore, rather than replacing the password attribute with the value again it ends up creating a second entry for the attribute just before the null value entry. Here is what it looks like in the config.xml:
&lt;gbean name=&quot;geronimo/j2ee-security/1.1.1-SNAPSHOT/car?ServiceModule=geronimo/j2ee-security/1.1.1-SNAPSHOT/car,j2eeType=Keystore,name=geronimo-default&quot;&gt;
&lt;attribute name=&quot;keystorePassword&quot;&gt;{Simple}rO0ABXNyABlqYXZheC5jcnlwdG8uU2VhbGVkT2JqZWN0PjY9psO3VHACAARbAA1lbmNvZGVkUGFyYW1zdAACW0JbABBlbmNyeXB0ZWRDb250ZW50cQB+AAFMAAlwYXJhbXNBbGd0ABJMamF2YS9sYW5nL1N0cmluZztMAAdzZWFsQWxncQB+AAJ4cHB1cgACW0Ks8xf4BghU4AIAAHhwAAAAEArVToThqcjvbXFD5C2uUmpwdAADQUVT&lt;/attribute&gt;
&lt;attribute name=&quot;keyPasswords&quot;&gt;{Simple}rO0ABXNyABlqYXZheC5jcnlwdG8uU2VhbGVkT2JqZWN0PjY9psO3VHACAARbAA1lbmNvZGVkUGFyYW1zdAACW0JbABBlbmNyeXB0ZWRDb250ZW50cQB+AAFMAAlwYXJhbXNBbGd0ABJMamF2YS9sYW5nL1N0cmluZztMAAdzZWFsQWxncQB+AAJ4cHB1cgACW0Ks8xf4BghU4AIAAHhwAAAAIJu+zYXdGgTo+dMtBxYduheM0Te6O/om49Ln+vWNipopcHQAA0FFUw==&lt;/attribute&gt;
&lt;attribute name=&quot;keystorePassword&quot; null=&quot;true&quot;/&gt;
&lt;attribute name=&quot;keyPasswords&quot; null=&quot;true&quot;/&gt;
It appears that &quot;null&quot; wins out (probably because it is last) and the net result is that the keystore remains locked. This is not a good thing (see other posts on the keystore processing).
So my question is this: Is this a problem with the way we are setting the attribute or is it a problem with the attribute processing itself (particularly around the setting and removing of a null value)? The code that sets the attribute is in FileKeystoreInstance around line 130.
java.lang.UnsupportedOperationException in org.openejb.deployment.OpenEJBReferenceBuilder
java.lang.UnsupportedOperationException
at java.util.AbstractMap.put(AbstractMap.java:243)
at java.util.AbstractMap.putAll(AbstractMap.java:332)
at org.openejb.deployment.OpenEJBReferenceBuilder.getMatchesFromName(OpenEJBReferenceBuilder.java:283)
at org.openejb.deployment.OpenEJBReferenceBuilder.getImplicitMatch(OpenEJBReferenceBuilder.java:298)
at org.openejb.deployment.OpenEJBReferenceBuilder.createEJBRemoteRef(OpenEJBReferenceBuilder.java:219)
at org.openejb.deployment.OpenEJBReferenceBuilder$$FastClassByCGLIB$$bfd62c9f.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.j2ee.deployment.EJBReferenceBuilder$$EnhancerByCGLIB$$c7839d34.createEJBRemoteRef(&lt;generated&gt;)
at org.apache.geronimo.j2ee.deployment.RefContext.getEJBRemoteRef(RefContext.java:69)
at org.apache.geronimo.naming.deployment.ENCConfigBuilder.addEJBRef(ENCConfigBuilder.java:412)
at org.apache.geronimo.naming.deployment.ENCConfigBuilder.addEJBRefs(ENCConfigBuilder.java:339)
at org.apache.geronimo.naming.deployment.ENCConfigBuilder.buildComponentContext(ENCConfigBuilder.java:731)
at org.apache.geronimo.client.builder.AppClientModuleBuilder.buildComponentContext(AppClientModuleBuilder.java:672)
at org.apache.geronimo.client.builder.AppClientModuleBuilder.addGBeans(AppClientModuleBuilder.java:530)
... 56 more
in OpenEJBReferenceBuilder, getImplicitMatch say:
Collection matches = getMatchesFromName(isSession, Collections.EMPTY_MAP, context, context.getId(), isRemote, home, remote);
However,
getMatchesFromName(boolean isSession, Map nameQuery, Configuration context, Artifact id, boolean isRemote, String home, String remote) {
nameQuery.putAll(ENTITY);
}
Collections.EMPTY_MAP is immutable!
This code was inserted as part of fix 2823 in openejb., a fix for JIRAs 2120 and 2142.
Locking default keystore results in serialization error on tomcat termination
Once having locked the keystore availability a subsequent termination of the server will result in a serialization exception on tomcat. This situation cannot be resolved, even with a server restart. Attempting to unlock the keystore and key again will appear to succeed ont he console but the serialization error continues to appear on server termination and the keystore is never really unlock (after restart you can observe that it is once again locked).
Here's the stack trace:
Server shutdown begun
14:15:18,819 WARN [[/console-standard]] Cannot serialize session attribute javax.portlet.p.Security_keystores_row1_col1_p1?org.apache.geronimo.keystore.geronim
o-default for session 0BCA0CD146C855673E893CA127A31961
java.io.NotSerializableException: org.apache.geronimo.management.geronimo.KeystoreInstance$$EnhancerByCGLIB$$911c98e6
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1054)
at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1332)
at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1304)
at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1247)
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1052)
at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:278)
at org.apache.catalina.session.StandardSession.writeObject(StandardSession.java:1460)
at org.apache.catalina.session.StandardSession.writeObjectData(StandardSession.java:936)
at org.apache.catalina.session.StandardManager.doUnload(StandardManager.java:516)
at org.apache.catalina.session.StandardManager.unload(StandardManager.java:462)
at org.apache.catalina.session.StandardManager.stop(StandardManager.java:666)
at org.apache.catalina.core.StandardContext.stop(StandardContext.java:4316)
at org.apache.geronimo.tomcat.GeronimoStandardContext.stop(GeronimoStandardContext.java:216)
at org.apache.geronimo.tomcat.TomcatContainer.removeContext(TomcatContainer.java:324)
at org.apache.geronimo.tomcat.TomcatContainer$$FastClassByCGLIB$$9370b073.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.tomcat.TomcatContainer$$EnhancerByCGLIB$$12e838fd.removeContext(&lt;generated&gt;)
at org.apache.geronimo.tomcat.TomcatWebAppContext.doStop(TomcatWebAppContext.java:459)
at org.apache.geronimo.gbean.runtime.GBeanInstance.destroyInstance(GBeanInstance.java:1143)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStop(GBeanInstanceState.java:337)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.stop(GBeanInstanceState.java:188)
at org.apache.geronimo.gbean.runtime.GBeanInstance.stop(GBeanInstance.java:548)
at org.apache.geronimo.kernel.basic.BasicKernel.stopGBean(BasicKernel.java:423)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.stop(GBeanInstanceState.java:180)
at org.apache.geronimo.gbean.runtime.GBeanInstance.stop(GBeanInstance.java:548)
at org.apache.geronimo.kernel.basic.BasicKernel.stopGBean(BasicKernel.java:423)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.stop(GBeanInstanceState.java:180)
at org.apache.geronimo.gbean.runtime.GBeanInstance.stop(GBeanInstance.java:548)
at org.apache.geronimo.kernel.basic.BasicKernel.stopGBean(BasicKernel.java:423)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.stop(GBeanInstanceState.java:180)
at org.apache.geronimo.gbean.runtime.GBeanInstance.stop(GBeanInstance.java:548)
at org.apache.geronimo.kernel.basic.BasicKernel.stopGBean(BasicKernel.java:423)
at org.apache.geronimo.kernel.config.KernelConfigurationManager$ShutdownHook.run(KernelConfigurationManager.java:310)
at org.apache.geronimo.kernel.basic.BasicKernel.notifyShutdownHooks(BasicKernel.java:668)
at org.apache.geronimo.kernel.basic.BasicKernel.shutdown(BasicKernel.java:645)
at org.apache.geronimo.system.main.Daemon$1.run(Daemon.java:245)
Server shutdown completed
User can lock the default keystore without warning, making jetty server unusable
WIth one mouse click on the keystore portlet (on the lock under &quot;Available&quot;) the user will put the server in a state where it can never start. No error or warning is issued at the time the keystore is locked. However, on the next server recycle the server will not be able to initialize because of a failed GBean and produce the stack trace below. At the very least we should warn the user before locking the keystore. Given the impact of the problem, I think it would be even better if we could challenge for the password on lock. If lock is accidentally selected you must know the password to unlock it so requiring the password to lock would make it less likely that it would happen by accident and ensure the user has the necessary information/authority to do/undo the action.
There are a few other aspects of this problem that make it even worse:
1) It appears that even if the admin unlocks the keystore again so that it is available there is often some setting someplace that trys to keep it locked and will cause the next server restart to fail.
2) It was suggested that you could set load=&quot;false&quot; on the SSLConnector, restart the server, and then use the console to unlock the keystore. However, because of the the previous item this often doesn't work and the server will again fail to start when load-&quot;false' is removed.
Booting Geronimo Kernel (in Java 1.4.2_08)...
Starting Geronimo Application Server v1.1.1-SNAPSHOT
[*********&gt; ] 43% 9s Loading geronimo/jetty/1.1.1-SNA...13:18:28,765 WARN [SslListener] EXCEPTION
org.apache.geronimo.management.geronimo.KeystoreIsLocked: Keystore 'geronimo-default' is locked; please use the keystore page in the admin console to unlock it
at org.apache.geronimo.security.keystore.FileKeystoreManager.createSSLServerFactory(FileKeystoreManager.java:300)
at org.apache.geronimo.security.keystore.FileKeystoreManager$$FastClassByCGLIB$$4d9d2a71.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.management.geronimo.KeystoreManager$$EnhancerByCGLIB$$c92b6d1.createSSLServerFactory(&lt;generated&gt;)
at org.apache.geronimo.jetty.connector.GeronimoSSLListener.createFactory(GeronimoSSLListener.java:41)
at org.mortbay.http.SslListener.newServerSocket(SslListener.java:283)
at org.mortbay.util.ThreadedServer.open(ThreadedServer.java:477)
at org.apache.geronimo.jetty.connector.JettyConnector.doStart(JettyConnector.java:233)
at org.apache.geronimo.gbean.runtime.GBeanInstance.createInstance(GBeanInstance.java:981)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:267)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstance.start(GBeanInstance.java:526)
at org.apache.geronimo.gbean.runtime.GBeanDependency.attemptFullStart(GBeanDependency.java:111)
at org.apache.geronimo.gbean.runtime.GBeanDependency.addTarget(GBeanDependency.java:146)
at org.apache.geronimo.gbean.runtime.GBeanDependency$1.running(GBeanDependency.java:120)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.fireRunningEvent(BasicLifecycleMonitor.java:173)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.access$300(BasicLifecycleMonitor.java:41)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor$RawLifecycleBroadcaster.fireRunningEvent(BasicLifecycleMonitor.java:251)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:292)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstance.start(GBeanInstance.java:526)
at org.apache.geronimo.gbean.runtime.GBeanDependency.attemptFullStart(GBeanDependency.java:111)
at org.apache.geronimo.gbean.runtime.GBeanDependency.addTarget(GBeanDependency.java:146)
at org.apache.geronimo.gbean.runtime.GBeanDependency$1.running(GBeanDependency.java:120)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.fireRunningEvent(BasicLifecycleMonitor.java:173)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.access$300(BasicLifecycleMonitor.java:41)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor$RawLifecycleBroadcaster.fireRunningEvent(BasicLifecycleMonitor.java:251)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:292)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.startRecursive(GBeanInstanceState.java:124)
at org.apache.geronimo.gbean.runtime.GBeanInstance.startRecursive(GBeanInstance.java:540)
at org.apache.geronimo.kernel.basic.BasicKernel.startRecursiveGBean(BasicKernel.java:379)
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:374)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:512)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:493)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$1b561373.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.system.main.Daemon.doStartup(Daemon.java:297)
at org.apache.geronimo.system.main.Daemon.&lt;init&gt;(Daemon.java:74)
at org.apache.geronimo.system.main.Daemon.main(Daemon.java:377)
[*********&gt; ] 43% 10s Starting geronimo/jetty/1.1.1-SNA...13:18:28,875 ERROR [GBeanInstanceState] Error while starting; GBean is now in the FAILED s
tate: abstractName=&quot;geronimo/jetty/1.1.1-SNAPSHOT/car?ServiceModule=geronimo/jetty/1.1.1-SNAPSHOT/car,j2eeType=GBean,name=JettySSLConnector&quot;
java.io.IOException: Could not create JsseListener: org.apache.geronimo.management.geronimo.KeystoreIsLocked: Keystore 'geronimo-default' is locked; please use
the keystore page in the admin console to unlock it
at org.mortbay.http.SslListener.newServerSocket(SslListener.java:314)
at org.mortbay.util.ThreadedServer.open(ThreadedServer.java:477)
at org.apache.geronimo.jetty.connector.JettyConnector.doStart(JettyConnector.java:233)
at org.apache.geronimo.gbean.runtime.GBeanInstance.createInstance(GBeanInstance.java:981)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:267)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstance.start(GBeanInstance.java:526)
at org.apache.geronimo.gbean.runtime.GBeanDependency.addTarget(GBeanDependency.java:146)
at org.apache.geronimo.gbean.runtime.GBeanDependency.attemptFullStart(GBeanDependency.java:111)
at org.apache.geronimo.gbean.runtime.GBeanDependency$1.running(GBeanDependency.java:120)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.fireRunningEvent(BasicLifecycleMonitor.java:173)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.access$300(BasicLifecycleMonitor.java:41)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor$RawLifecycleBroadcaster.fireRunningEvent(BasicLifecycleMonitor.java:251)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:292)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstance.start(GBeanInstance.java:526)
at org.apache.geronimo.gbean.runtime.GBeanDependency.attemptFullStart(GBeanDependency.java:111)
at org.apache.geronimo.gbean.runtime.GBeanDependency.addTarget(GBeanDependency.java:146)
at org.apache.geronimo.gbean.runtime.GBeanDependency$1.running(GBeanDependency.java:120)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.fireRunningEvent(BasicLifecycleMonitor.java:173)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor.access$300(BasicLifecycleMonitor.java:41)
at org.apache.geronimo.kernel.basic.BasicLifecycleMonitor$RawLifecycleBroadcaster.fireRunningEvent(BasicLifecycleMonitor.java:251)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:292)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.startRecursive(GBeanInstanceState.java:124)
at org.apache.geronimo.gbean.runtime.GBeanInstance.startRecursive(GBeanInstance.java:540)
at org.apache.geronimo.kernel.basic.BasicKernel.startRecursiveGBean(BasicKernel.java:379)
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:374)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:512)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:493)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$1b561373.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.system.main.Daemon.doStartup(Daemon.java:297)
at org.apache.geronimo.system.main.Daemon.&lt;init&gt;(Daemon.java:74)
at org.apache.geronimo.system.main.Daemon.main(Daemon.java:377)
13:18:28,984 WARN [SslListener] EXCEPTION
org.apache.geronimo.management.geronimo.KeystoreIsLocked: Keystore 'geronimo-default' is locked; please use the keystore page in the admin console to unlock it
at org.apache.geronimo.security.keystore.FileKeystoreManager.createSSLServerFactory(FileKeystoreManager.java:300)
at org.apache.geronimo.security.keystore.FileKeystoreManager$$FastClassByCGLIB$$4d9d2a71.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.management.geronimo.KeystoreManager$$EnhancerByCGLIB$$c92b6d1.createSSLServerFactory(&lt;generated&gt;)
at org.apache.geronimo.jetty.connector.GeronimoSSLListener.createFactory(GeronimoSSLListener.java:41)
at org.mortbay.http.SslListener.newServerSocket(SslListener.java:283)
at org.mortbay.util.ThreadedServer.open(ThreadedServer.java:477)
at org.apache.geronimo.jetty.connector.JettyConnector.doStart(JettyConnector.java:233)
at org.apache.geronimo.gbean.runtime.GBeanInstance.createInstance(GBeanInstance.java:981)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:267)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.startRecursive(GBeanInstanceState.java:124)
at org.apache.geronimo.gbean.runtime.GBeanInstance.startRecursive(GBeanInstance.java:540)
at org.apache.geronimo.kernel.basic.BasicKernel.startRecursiveGBean(BasicKernel.java:379)
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:374)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:512)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:493)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$1b561373.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.system.main.Daemon.doStartup(Daemon.java:297)
at org.apache.geronimo.system.main.Daemon.&lt;init&gt;(Daemon.java:74)
at org.apache.geronimo.system.main.Daemon.main(Daemon.java:377)
13:18:29,093 ERROR [GBeanInstanceState] Error while starting; GBean is now in the FAILED state: abstractName=&quot;geronimo/jetty/1.1.1-SNAPSHOT/car?ServiceModule=ge
ronimo/jetty/1.1.1-SNAPSHOT/car,j2eeType=GBean,name=JettySSLConnector&quot;
java.io.IOException: Could not create JsseListener: org.apache.geronimo.management.geronimo.KeystoreIsLocked: Keystore 'geronimo-default' is locked; please use
the keystore page in the admin console to unlock it
at org.mortbay.http.SslListener.newServerSocket(SslListener.java:314)
at org.mortbay.util.ThreadedServer.open(ThreadedServer.java:477)
at org.apache.geronimo.jetty.connector.JettyConnector.doStart(JettyConnector.java:233)
at org.apache.geronimo.gbean.runtime.GBeanInstance.createInstance(GBeanInstance.java:981)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:267)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.startRecursive(GBeanInstanceState.java:124)
at org.apache.geronimo.gbean.runtime.GBeanInstance.startRecursive(GBeanInstance.java:540)
at org.apache.geronimo.kernel.basic.BasicKernel.startRecursiveGBean(BasicKernel.java:379)
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:374)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:512)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:493)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$1b561373.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.system.main.Daemon.doStartup(Daemon.java:297)
at org.apache.geronimo.system.main.Daemon.&lt;init&gt;(Daemon.java:74)
at org.apache.geronimo.system.main.Daemon.main(Daemon.java:377)
[*********&gt; ] 43% 10s Startup failed
org.apache.geronimo.kernel.config.LifecycleException: start of geronimo/jetty/1.1.1-SNAPSHOT/car failed
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:529)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:493)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$1b561373.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.system.main.Daemon.doStartup(Daemon.java:297)
at org.apache.geronimo.system.main.Daemon.&lt;init&gt;(Daemon.java:74)
at org.apache.geronimo.system.main.Daemon.main(Daemon.java:377)
Caused by: org.apache.geronimo.kernel.config.InvalidConfigException: Unknown start exception
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:440)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:512)
... 13 more
Caused by: org.apache.geronimo.gbean.InvalidConfigurationException: Configuration geronimo/jetty/1.1.1-SNAPSHOT/car failed to start due to the following reasons
:
The service ServiceModule=geronimo/jetty/1.1.1-SNAPSHOT/car,j2eeType=GBean,name=JettySSLConnector did not start because the doStart method threw an exception.
java.io.IOException: Could not create JsseListener: org.apache.geronimo.management.geronimo.KeystoreIsLocked: Keystore 'geronimo-default' is locked; please use
the keystore page in the admin console to unlock it
at org.mortbay.http.SslListener.newServerSocket(SslListener.java:314)
at org.mortbay.util.ThreadedServer.open(ThreadedServer.java:477)
at org.apache.geronimo.jetty.connector.JettyConnector.doStart(JettyConnector.java:233)
at org.apache.geronimo.gbean.runtime.GBeanInstance.createInstance(GBeanInstance.java:981)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:267)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:102)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.startRecursive(GBeanInstanceState.java:124)
at org.apache.geronimo.gbean.runtime.GBeanInstance.startRecursive(GBeanInstance.java:540)
at org.apache.geronimo.kernel.basic.BasicKernel.startRecursiveGBean(BasicKernel.java:379)
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:374)
at org.apache.geronimo.kernel.config.KernelConfigurationManager.start(KernelConfigurationManager.java:187)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:512)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager.startConfiguration(SimpleConfigurationManager.java:493)
at org.apache.geronimo.kernel.config.SimpleConfigurationManager$$FastClassByCGLIB$$ce77a924.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.kernel.config.EditableConfigurationManager$$EnhancerByCGLIB$$1b561373.startConfiguration(&lt;generated&gt;)
at org.apache.geronimo.system.main.Daemon.doStartup(Daemon.java:297)
at org.apache.geronimo.system.main.Daemon.&lt;init&gt;(Daemon.java:74)
at org.apache.geronimo.system.main.Daemon.main(Daemon.java:377)
at org.apache.geronimo.kernel.config.ConfigurationUtil.startConfigurationGBeans(ConfigurationUtil.java:403)
... 15 more
Server shutdown begun tartup failed
Server shutdown completed
Application errors in static initialization blocks during serialization of configuration during deployment due to incorrect TCCL
h1. Problem
Exceptions and/or errors may occur in static initialization blocks invoked whilst loading classes when serializing a configuration during deployment. 
These same exceptions/errors don't occur when starting the configuration.
h1. Symptoms
Deployment of an EAR that has dependencies on its own copy of Xerces will cause an exception similar to the following if Xerces is initialised in a static block.
{code}
java.lang.ClassCastException
at org.apache.xerces.parsers.DOMParser.&lt;init&gt;(Unknown Source)
at org.apache.xerces.parsers.DOMParser.&lt;init&gt;(Unknown Source)
at com.foo.server.ejb.MyEJB.&lt;clinit&gt;
at java.io.ObjectStreamClass.hasStaticInitializer(Native Method)
at java.io.ObjectStreamClass.computeDefaultSUID(ObjectStreamClass.java:1557)
at java.io.ObjectStreamClass.access$100(ObjectStreamClass.java:47)
at java.io.ObjectStreamClass$1.run(ObjectStreamClass.java:173)
at java.security.AccessController.doPrivileged(Native Method)
at java.io.ObjectStreamClass.getSerialVersionUID(ObjectStreamClass.java:170)
at java.io.ObjectStreamClass.writeNonProxy(ObjectStreamClass.java:557)
at java.io.ObjectOutputStream.writeClassDescriptor(ObjectOutputStream.java:591)
at java.io.ObjectOutputStream.writeNonProxyDesc(ObjectOutputStream.java:1142)
at java.io.ObjectOutputStream.writeClassDesc(ObjectOutputStream.java:1100)
at java.io.ObjectOutputStream.writeClass(ObjectOutputStream.java:1082)
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:996)
at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1332)
at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1304)
at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1247)
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1052)
at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1332)
at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1304)
at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1247)
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1052)
at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1332)
at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1304)
at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1247)
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1052)
at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1332)
at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1304)
at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1247)
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1052)
at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:278)
at org.apache.geronimo.gbean.GBeanData.writeExternal(GBeanData.java:187)
at org.apache.geronimo.kernel.config.SerializedGBeanState.storeGBeans(SerializedGBeanState.java:139)
at org.apache.geronimo.kernel.config.SerializedGBeanState.writeObject(SerializedGBeanState.java:92)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324)
at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:809)
at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1296)
at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1247)
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1052)
at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1332)
at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1304)
at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1247)
at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1052)
at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:278)
at org.apache.geronimo.kernel.config.SerializedConfigurationMarshaler.writeConfigurationData(SerializedConfigurationMarshale
r.java:66)
at org.apache.geronimo.kernel.config.ConfigurationUtil.writeConfigurationData(ConfigurationUtil.java:163)
at org.apache.geronimo.system.configuration.ExecutableConfigurationUtil.writeConfiguration(ExecutableConfigurationUtil.java:
155)
at org.apache.geronimo.system.configuration.RepositoryConfigurationStore.install(RepositoryConfigurationStore.java:323)
at org.apache.geronimo.deployment.Deployer.deploy(Deployer.java:322)
at org.apache.geronimo.deployment.Deployer.deploy(Deployer.java:124)
{code}
Deployment of an EAR that has dependencies on its own copy of Log4j will cause errors similar to the following if Log4j is initialised in a static block.
{code}
log4j:ERROR A &quot;org.apache.log4j.ConsoleAppender&quot; object is not assignable to a &quot;org.apache.log4j.Appender&quot; variable.
log4j:ERROR The class &quot;org.apache.log4j.Appender&quot; was loaded by
log4j:ERROR [[org.apache.geronimo.kernel.classloader.JarFileClassLoader id=groupId/artifactId/1.0/ear]] whereas object of type
log4j:ERROR &quot;org.apache.log4j.ConsoleAppender&quot; was loaded by [sun.misc.Launcher$AppClassLoader@53ba3d].
log4j:ERROR Could not instantiate appender named &quot;WSSysOut&quot;.
log4j: Parsing appender named &quot;WSFile1&quot;.
log4j:ERROR A &quot;org.apache.log4j.RollingFileAppender&quot; object is not assignable to a &quot;org.apache.log4j.Appender&quot; variable.
log4j:ERROR The class &quot;org.apache.log4j.Appender&quot; was loaded by
log4j:ERROR [[org.apache.geronimo.kernel.classloader.JarFileClassLoader id=groupId/artifactId/1.0/ear]] whereas object of type
log4j:ERROR &quot;org.apache.log4j.RollingFileAppender&quot; was loaded by [sun.misc.Launcher$AppClassLoader@53ba3d].
log4j:ERROR Could not instantiate appender named &quot;WSFile1&quot;.
{code}
h1. Cause
The org.apache.geronimo.deployment.deploy(..) method at approx line 187 serializes the configuration by calling store.install(configurationData) but at the time when the configuration is serialized (and static blocks in EJBs invoked) the thread context classloader is set to [org.apache.geronimo.kernel.classloader.JarFileClassLoader id=geronimo/j2ee-security/1.1.1-SNAPSHOT/car].
Xerces and Log4j are examples of libraries that rely upon the thread context classloader to be set correctly during initialization.
h1. Solution
Set the context classloader before serializing the configuration.
h1. Workaround
If you have access to the application source code, modify the application's static blocks to call setContextClassLoader(..). For example:
{code}
ClassLoader oldClassloader = Thread.currentThread().getContextClassLoader();
Thread.currentThread().setContextClassLoader( this.getClass().getClassLoader());
try {
// application processing
} finally {
Thread.currentThread().setContextClassLoader( oldClassloader );
}
{code}
Alternatively for Log4j problems (Log4j 1.2.6 or later) you could try setting log4j.ignoreTCL=true.
Use m2 filtering to fill in values for geronimo-version.propertes (and friends)
Running into a problem running {{site}} under m2 because of the custom antrun that is generating files into target/classes, and clover needs them to be in target/clover/classes.
To resolve, use the m2 resource filtering mechanism.
Bug in ServerConstants cause NPE when geronimo-version.properties is missing
Looks like there is a minor bug in ServerConstants with this:
{code:java}
static {
Properties versionInfo = new Properties();
try {
versionInfo.load(ServerConstants.class.getClassLoader().getResourceAsStream(&quot;org/apache/geronimo/system/serverinfo/geronimo-version.properties&quot;));
} catch (java.io.IOException e) {
throw new ExceptionInInitializerError(new Exception(&quot;Could not load geronimo-version.properties&quot;, e));
}
{code}
The problem is that if the properties files is not found, then a NPE is thrown which does not get caught by the IOException handler and then resulting ExceptionInInitializerError error does not contain the detail as to why.
I'm seeing this when trying to build the m2 site, looks like clover is not picking up the resources because they are not in the standard location where m2 suggests they be.
While it is a minor problem, we really should modules to use the standard locations soonish.
I'm going to fix this with:
{code:java}
static {
Properties versionInfo = new Properties();
try {
InputStream input = ServerConstants.class.getClassLoader().getResourceAsStream(&quot;org/apache/geronimo/system/serverinfo/geronimo-version.properties&quot;);
if (input == null) {
throw new Error(&quot;Missing geronimo-version.properties&quot;);
}
versionInfo.load(input);
}
catch (java.io.IOException e) {
throw new Error(&quot;Could not load geronimo-version.properties&quot;, e);
}
{code}
bad classpath in geronimo-deploy-jsr88-1.1.jar
When trying to do a remote deploy using geronimo-deploy-jsr88-1.1.jar, got a class not found exception on org.apache.geronimo.util.encoders.Base64. This class is packaged in geronimo-util-1.1.jar. The classpath in geronimo-deploy-jsr88-1.1.jar is suspect. First, it does not include the required geronimo-util-1.1.jar. Second, it includes itself, which I think is unnecessary.
My change is to geronimo\modules\deploy-jsr88\src\conf\manifest.mf.
In the classpath, I changed:
&lt; ../lib/geronimo-deploy-jsr88-${geronimo_version}.jar
---
&gt; ../lib/geronimo-util-${geronimo_version}.jar
With that change, my remote deploy was successful.
Move to new Apache Maven 1 repo (repo/m1-snapshot-repository
The Maven 1 and Maven 2 snapshot repositories are being moved, again. We'll need to update our maven configurations, build scripts, rsync cron jobs etc. to reflect these infrastructure changes.
In addition, we should provide documentation for users on how to build our 1.0 and 1.1 sources.
Here are the new repo's on Apache:
/www/people.apache.org/repo/m1-snapshot-repository
/www/people.apache.org/repo/m2-snapshot-repository
/www/people.apache.org/repo/m1-ibiblio-rsync-repository
/www/people.apache.org/repo/m2-ibiblio-rsync-repository
As I understand it, the old repo locations are symbolically linked to the new repo locations. The symbolic link will be removed in a month or so.
SMTP debug output echos portions of the output twice.
If debug mode is enabled for SMTP, portions of the output stream are getting written to the debug stream twice. For example, a QUIT command shows up as 
QUITQUIT
Key portion of Geronimo-1145 appears have gotten lost.
A key piece of the patch for GERONIMO-1145 was left out when the patch was applied. The following change needs to be added:
- componentContext.put(&quot;ORB&quot;, Util.getORB());
+ componentContext.put(&quot;ORB&quot;, orb);
Without this change, the rest of the patch is meaningless.
CSSBean creates 2 unnecessary threads for every instance.
The CSSBean creates 2 ORB instances, then spins off a thread for each that calls orb.run(). This is completely unnecessary, since orb.run() doesn't actually run anything....it just causes the thread to wait until orb.destroy() is called. These two thread instances are pure overhead, with no functional purpose.
NPE when the &quot;edit&quot; link is selected on the Security Realms console page
h1. Problem
Cannot edit a security realm by clicking on the &quot;edit&quot; link on the Security Realms Server Console page.
h1. Symptom
The &quot;edit&quot; link appears to be non-responsive but an exception (shown below) is thrown and should be visible on stdout or the geronimo log.
{code}
12:19:00,863 ERROR [Servlet] Exception caught:
java.lang.NullPointerException
at java.net.URI$Parser.parse(URI.java:2946)
at java.net.URI.&lt;init&gt;(URI.java:574)
at java.net.URI.create(URI.java:836)
at org.apache.geronimo.console.securitymanager.realm.SecurityRealmPortlet.actionLoadExistingRealm(SecurityRealmPortlet.java:
435)
at org.apache.geronimo.console.securitymanager.realm.SecurityRealmPortlet.processAction(SecurityRealmPortlet.java:207)
at org.apache.pluto.core.PortletServlet.dispatch(PortletServlet.java:229)
at org.apache.pluto.core.PortletServlet.doGet(PortletServlet.java:158)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:595)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:688)
at org.apache.pluto.core.PortletServlet.service(PortletServlet.java:153)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:672)
at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:574)
at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:499)
at org.apache.pluto.invoker.impl.PortletInvokerImpl.invoke(PortletInvokerImpl.java:120)
at org.apache.pluto.invoker.impl.PortletInvokerImpl.action(PortletInvokerImpl.java:68)
at org.apache.pluto.PortletContainerImpl.processPortletAction(PortletContainerImpl.java:164)
at org.apache.pluto.portalImpl.core.PortletContainerWrapperImpl.processPortletAction(PortletContainerWrapperImpl.java:82)
at org.apache.pluto.portalImpl.Servlet.doGet(Servlet.java:227)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:595)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:688)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
at org.apache.geronimo.tomcat.valve.DefaultSubjectValve.invoke(DefaultSubjectValve.java:52)
at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:524)
at org.apache.geronimo.tomcat.GeronimoStandardContext$SystemMethodValve.invoke(GeronimoStandardContext.java:342)
at org.apache.geronimo.tomcat.valve.GeronimoBeforeAfterValve.invoke(GeronimoBeforeAfterValve.java:31)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:541)
at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:667)
at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)
at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)
at java.lang.Thread.run(Thread.java:534)
{code}
h1. Cause
The SecurityRealmPortlet.load(..) method was passing the value &quot;objectName&quot; instead of &quot;abstractName&quot; on the request.getParameter(string) call.
h1. Solution
Corrected the parameter name to be &quot;abstractName&quot;.
h1. Workaround
Add a new security realm with a different name and then delete the old realm by stopping it and undeploying it using the command line deploy tool.
SharedLib GBean fails to start if shared/lib and shared/classes dirs are missing
Downloaded geronimo-tomcat-j2ee-1.1.zip for Windows, ran the startup script and got the following error:
{noformat}
***************&gt; ] 70% 20s Loading geronimo/sharedlib/1.1/car 17:07:15,3
41 ERROR [GBeanInstanceState] Error while starting; GBean is now
in the FAILED state: abstractName=&quot;geronimo/sharedlib/1.1/car?
ServiceModule=geronimo/sharedlib/1.1/
car,j2eeType=GBean,name=SharedLib&quot;
java.lang.IllegalArgumentException: Classes dir does not exist: C:
\AppServers\geronimo-1.1\var\shared\classes
{noformat}
There's no &quot;..\geronimo-1.1\var\shared\classes&quot; directory in the distribution
Got the same error with Little-G
I created empty directories for &quot;var\shared\classes&quot; and &quot;var\shared\lib&quot; and the server started up and I was able to log on and access the console and poke around.
Eclipse project names not generated consistently
h1. Problem
When running maven the maven eclipse plugin to generate eclipse projects for Geronimo, e.g.
{{maven m:eclipse -Dmaven.eclipse.src.download=false}}
A number of configs and modules eclipse project names are not built using the {{geronimo.maven.eclipse.xx}} properties in the {{geronimo/etc/project.properties}} file.
(i) This problem only impacts developers working on Geronimo itself who use eclipse with version 1.11 or later of the maven eclipse plugin.
h1. Symptom
When importing existing projects into eclipse you will see the following projects do not have a prefix that you specified in the {{geronimo/etc/project.properties}} file:
* axis
* axis-deployer
* client-deployer
* ge-activemq-rar
* shared-lib
* unavailable-client-deployer
* unavailable-ejb-deployer
* unavailable-webservices-deployer
h1. Cause
A number of new project.properties files have been added since GERONIMO-1856 was committed before the 1.1 release was shipped. These newly added project.properties files did not set the {{maven.eclipse.project.name}} property like other Geronimo projects.
h1. Solution
The newly added project.property files have been fixed so that they set the {{maven.eclipse.project.name}} property like the other Geronimo modules/configs.
h1. Workaround
None.
Build test failure in MimeUtilityTest on the Mac
A previous Mac codepage related test failure in the 1.3.1 javamail specs has re-emerged in the new 1.4 version.
Editing of Connection Pools other than Derby from console not working
Editing of connection pools other than Derby is currently not working
Add 1.1 schemas to web site
etc/explicit_versions.properties should be automatically generated (or made unecessary)
explicit_versions.properties is an error prone and fragile mechanism used to insure the appropriate artifacts are loaded during a Geronimo build. It should be possible to automatically generate the file (or dynamically calculate as resources are loaded).
Fix branches/1.1 (1.1.1-SNAPSHOT) build
Multiple dependencies need to be fixed for 1.1.1-SNAPSHOT build...
some portions of a build still look at cvs.apache.org/repository
There are some project.properties files that cause maven to attempt to download artifacts from cvs.apache.org. They need to be people.apache.org.
Javamail provider component needs dependency update to released 1.1 spec version for javamail 1.3.1 and activation.
Currently, the javamail provider code has a dependency on the 1.1-SNAPSHOT level of the javamail_1.3.1_spec and activation specs. Now that Geronimo 1.1 has been released and the 1.1 spec jars are published, this needs updating to the release version.
Creating SQL- based security realm fails
It's not possible to create an SQL-based security realm using the console in Geronimo 1.1.
Error shown in console:
Error: Error: Unable to initialize LoginModule: Unable to load, instantiate, register driver null: null
Error written to Geronimo logfile:
09:49:15,142 ERROR [SecurityRealmPortlet] Unable to parse ObjectName
javax.management.MalformedObjectNameException: Missing ':' character in 
ObjectName
at javax.management.ObjectName.parseDomain(ObjectName.java:417)
at javax.management.ObjectName.parse(ObjectName.java:385)
at javax.management.ObjectName.&lt;init&gt;(ObjectName.java:76)
at javax.management.ObjectName.getInstance(ObjectName.java:261)
at 
org.apache.geronimo.console.securitymanager.realm.SecurityRealmPortlet$RealmData.load(SecurityRealmPortlet.java:775)
at 
org.apache.geronimo.console.securitymanager.realm.SecurityRealmPortlet.processAction(SecurityRealmPortlet.java:167)
at 
org.apache.pluto.core.PortletServlet.dispatch(PortletServlet.java:229)
at org.apache.pluto.core.PortletServlet.doGet(PortletServlet.java:158)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:595)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:688)
at org.apache.pluto.core.PortletServlet.service(PortletServlet.java:153)
at 
org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:428)
at 
org.apache.geronimo.jetty.JettyServletHolder.handle(JettyServletHolder.java:97)
at 
org.mortbay.jetty.servlet.WebApplicationHandler$CachedChain.doFilter(WebApplicationHandler.java:830)
at 
org.mortbay.jetty.servlet.JSR154Filter.doFilter(JSR154Filter.java:170)
at 
org.mortbay.jetty.servlet.WebApplicationHandler$CachedChain.doFilter(WebApplicationHandler.java:821)
at 
org.mortbay.jetty.servlet.WebApplicationHandler.dispatch(WebApplicationHandler.java:471)
at 
org.apache.geronimo.jetty.JettyWebApplicationHandler.dispatch(JettyWebApplicationHandler.java:58)
at org.mortbay.jetty.servlet.Dispatcher.dispatch(Dispatcher.java:283)
at org.mortbay.jetty.servlet.Dispatcher.include(Dispatcher.java:163)
at 
org.apache.pluto.invoker.impl.PortletInvokerImpl.invoke(PortletInvokerImpl.java:120)
at 
org.apache.pluto.invoker.impl.PortletInvokerImpl.action(PortletInvokerImpl.java:68)
at 
org.apache.pluto.PortletContainerImpl.processPortletAction(PortletContainerImpl.java:164)
at 
org.apache.pluto.portalImpl.core.PortletContainerWrapperImpl.processPortletAction(PortletContainerWrapperImpl.java:82)
at org.apache.pluto.portalImpl.Servlet.doGet(Servlet.java:227)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:595)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:688)
at 
org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:428)
at 
org.apache.geronimo.jetty.JettyServletHolder.handle(JettyServletHolder.java:97)
at 
org.mortbay.jetty.servlet.WebApplicationHandler$CachedChain.doFilter(WebApplicationHandler.java:830)
at 
org.mortbay.jetty.servlet.JSR154Filter.doFilter(JSR154Filter.java:170)
at 
org.mortbay.jetty.servlet.WebApplicationHandler$CachedChain.doFilter(WebApplicationHandler.java:821)
at 
org.mortbay.jetty.servlet.WebApplicationHandler.dispatch(WebApplicationHandler.java:471)
at 
org.apache.geronimo.jetty.JettyWebApplicationHandler.dispatch(JettyWebApplicationHandler.java:58)
at 
org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:568)
at org.mortbay.http.HttpContext.handle(HttpContext.java:1530)
at 
org.mortbay.jetty.servlet.WebApplicationContext.handle(WebApplicationContext.java:633)
at org.mortbay.http.HttpContext.handle(HttpContext.java:1482)
at org.mortbay.http.HttpServer.service(HttpServer.java:909)
at org.mortbay.http.HttpConnection.service(HttpConnection.java:816)
at org.mortbay.http.HttpConnection.handleNext(HttpConnection.java:982)
at org.mortbay.http.HttpConnection.handle(HttpConnection.java:833)
at 
org.mortbay.http.SocketListener.handleConnection(SocketListener.java:244)
at org.mortbay.util.ThreadedServer.handle(ThreadedServer.java:357)
at org.mortbay.util.ThreadPool$PoolThread.run(ThreadPool.java:534)
09:49:15,142 WARN [SecurityRealmPortlet] Testing with options 
{org.apache.geronimo.security.realm.GenericSecurityRealm.CLASSLOADER=[org.apache.geronimo.kernel.classloader.JarFileClassLoader
id=geronimo/webconsole-jetty_standard.war/1.1/car], groupSelect=select userid, 
groupname from groups where userid=?, userSelect=select userid, password from 
users where userid=?}
09:49:15,142 WARN [SecurityRealmPortlet] Unable to initialize LoginModule
java.lang.IllegalArgumentException: Unable to load, instantiate, register 
driver null: null
at 
org.apache.geronimo.security.realm.providers.SQLLoginModule.initialize(SQLLoginModule.java:145)
at 
org.apache.geronimo.console.util.KernelManagementHelper.testLoginModule(KernelManagementHelper.java:389)
at 
org.apache.geronimo.console.util.PortletManager.testLoginModule(PortletManager.java:154)
at 
org.apache.geronimo.console.securitymanager.realm.SecurityRealmPortlet.actionTestLoginModuleLoad(SecurityRealmPortlet.java:265)
at 
org.apache.geronimo.console.securitymanager.realm.SecurityRealmPortlet.processAction(SecurityRealmPortlet.java:183)
at 
org.apache.pluto.core.PortletServlet.dispatch(PortletServlet.java:229)
at org.apache.pluto.core.PortletServlet.doGet(PortletServlet.java:158)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:595)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:688)
at org.apache.pluto.core.PortletServlet.service(PortletServlet.java:153)
at 
org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:428)
at 
org.apache.geronimo.jetty.JettyServletHolder.handle(JettyServletHolder.java:97)
at 
org.mortbay.jetty.servlet.WebApplicationHandler$CachedChain.doFilter(WebApplicationHandler.java:830)
at 
org.mortbay.jetty.servlet.JSR154Filter.doFilter(JSR154Filter.java:170)
at 
org.mortbay.jetty.servlet.WebApplicationHandler$CachedChain.doFilter(WebApplicationHandler.java:821)
at 
org.mortbay.jetty.servlet.WebApplicationHandler.dispatch(WebApplicationHandler.java:471)
at 
org.apache.geronimo.jetty.JettyWebApplicationHandler.dispatch(JettyWebApplicationHandler.java:58)
at org.mortbay.jetty.servlet.Dispatcher.dispatch(Dispatcher.java:283)
at org.mortbay.jetty.servlet.Dispatcher.include(Dispatcher.java:163)
at 
org.apache.pluto.invoker.impl.PortletInvokerImpl.invoke(PortletInvokerImpl.java:120)
at 
org.apache.pluto.invoker.impl.PortletInvokerImpl.action(PortletInvokerImpl.java:68)
at 
org.apache.pluto.PortletContainerImpl.processPortletAction(PortletContainerImpl.java:164)
at 
org.apache.pluto.portalImpl.core.PortletContainerWrapperImpl.processPortletAction(PortletContainerWrapperImpl.java:82)
at org.apache.pluto.portalImpl.Servlet.doGet(Servlet.java:227)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:595)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:688)
at 
org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:428)
at 
org.apache.geronimo.jetty.JettyServletHolder.handle(JettyServletHolder.java:97)
at 
org.mortbay.jetty.servlet.WebApplicationHandler$CachedChain.doFilter(WebApplicationHandler.java:830)
at 
org.mortbay.jetty.servlet.JSR154Filter.doFilter(JSR154Filter.java:170)
at 
org.mortbay.jetty.servlet.WebApplicationHandler$CachedChain.doFilter(WebApplicationHandler.java:821)
at 
org.mortbay.jetty.servlet.WebApplicationHandler.dispatch(WebApplicationHandler.java:471)
at 
org.apache.geronimo.jetty.JettyWebApplicationHandler.dispatch(JettyWebApplicationHandler.java:58)
at 
org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:568)
at org.mortbay.http.HttpContext.handle(HttpContext.java:1530)
at 
org.mortbay.jetty.servlet.WebApplicationContext.handle(WebApplicationContext.java:633)
at org.mortbay.http.HttpContext.handle(HttpContext.java:1482)
at org.mortbay.http.HttpServer.service(HttpServer.java:909)
at org.mortbay.http.HttpConnection.service(HttpConnection.java:816)
at org.mortbay.http.HttpConnection.handleNext(HttpConnection.java:982)
at org.mortbay.http.HttpConnection.handle(HttpConnection.java:833)
at 
org.mortbay.http.SocketListener.handleConnection(SocketListener.java:244)
at org.mortbay.util.ThreadedServer.handle(ThreadedServer.java:357)
at org.mortbay.util.ThreadPool$PoolThread.run(ThreadPool.java:534)
Steps to reproduce the error on a fresh Geronimo 1.1 installation (tested with Jetty version):
1. Create a new database called testdb, create and fill tables for users and 
groups
SQL statements:
create table users (
userid varchar(15) primary key,
password varchar(15),
username varchar(20)
);
create table groups (
userid varchar(15),
groupname varchar(20),
primary key (userid, groupname)
);
insert into users values ('admin', 'password', 'Administrator');
insert into groups values ('admin', 'AdminGroup');
2. Create Database pool (Database Pools -&gt; Using the Geronimo database pool 
wizard)
Step 1
- Name: testpool
- Database type: Derby embedded
Step 2:
- JDBC Driver (pre defined value): org.apache.derby.jdbc.EmbeddedDriver
- Driver JAR: org.apache.derby/derby/10.1.1.0/jar
- Database: testdb
Step 3:
JDBC connect url (pre defined): jdbc:derby:testdb
3. Create Security Realm (Security Realms -&gt; Add new security realm)
Step 1:
- Name of realm: testrealm
- Realm type: Database (SQL) Realm
- User select SQL: select userid, password from users where userid=?
- Group select: select userid, groupname from groups where userid=?
- Database pool: testpool
--&gt; Clicking &quot;Next&quot; produces the error.
GBeanOverride ignores reference name when saving if artifact is not set
In writeXml the writing of name and module should be outside the if(artifact != null) block
NPE in Maven1Repository
Circa line 66: path.listFiles() returns null if it's not a directory or whatever.
Configuration jsp-examples-tomcat includes Jetty dependencies
Will attach a patch to remove the following build dependencies -
jetty-deployer-1.1.car
geronimo-jetty-1.1.jar
Classpath entries in the web app archive META-INF/MANIFEST.MF are not added to the wep app class path
A working EAR for Geronimo 1.0 with this structure:
app.ear/
app.jar
cpa.jar
found.jar
webclient.war
The util JARs are referenced from the webclient.war/META-INF/MANIFEST.MF
Class-Path: app.jar cpa.jar found.jar
Deployment of this EAR in G 1.1-rc1 result in ClassNotFoundExceptions because
of the missing classes in the JARs which are not found.
Putting the JARs into the webclient.war/WEB-INF/lib worked.
Can't have ejb references outside current config. ClassCastException on org.openejb.proxy.ProxyInfo
See http://mail-archives.apache.org/mod_mbox/geronimo-user/200606.mbox/%3c2E3C762A-A857-497F-9000-A7173EB177CC@yahoo.com%3e.
I deploy (or distribute) a jar with an ejb, then deploy (or distribute) a war that references the ejb, and get:
Error: Operation failed: java.lang.ClassCastException
with this server.log entry:
10:51:39,531 ERROR [Deployer] Deployment failed due to 
java.lang.ClassCastException
at org.openejb.deployment.OpenEJBReferenceBuilder.checkRemoteProxyInfo(OpenEJBReferenceBuilder.java:133)
at org.openejb.deployment.OpenEJBReferenceBuilder.createEJBRemoteRef(OpenEJBReferenceBuilder.java:159)
at org.openejb.deployment.OpenEJBReferenceBuilder$$FastClassByCGLIB$$bfd62c9f.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:122)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:817)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:35)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.j2ee.deployment.EJBReferenceBuilder$$EnhancerByCGLIB$$d6cd2b5d.createEJBRemoteRef(&lt;generated&gt;)
at org.apache.geronimo.j2ee.deployment.RefContext.getEJBRemoteRef(RefContext.java:69)
at org.apache.geronimo.naming.deployment.ENCConfigBuilder.addEJBRef(ENCConfigBuilder.java:412)
at org.apache.geronimo.naming.deployment.ENCConfigBuilder.addEJBRefs(ENCConfigBuilder.java:339)
at org.apache.geronimo.naming.deployment.ENCConfigBuilder.buildComponentContext(ENCConfigBuilder.java:731)
at org.apache.geronimo.tomcat.deployment.TomcatModuleBuilder.buildComponentContext(TomcatModuleBuilder.java:458)
at org.apache.geronimo.tomcat.deployment.TomcatModuleBuilder.addGBeans(TomcatModuleBuilder.java:288)
at org.apache.geronimo.tomcat.deployment.TomcatModuleBuilder$$FastClassByCGLIB$$6f85ec2c.invoke(&lt;generated&gt;)
Remove deployer-log4j.properties files - they are no longer used
Description
The Geronimo 1.1 distribution contains a var\log\deployer-log4j.properties file but the file is not used.
Symptom
Changes to the var\log\deployer-log4j.properties file do not have any effect.
Cause
References to the file were removed as part of changes for GERONIMO-1306, remove modules/assembly GERONIMO-1294 remove offline capability from online deployment tool ( http://svn.apache.org/viewcvs?rev=354830&amp;view=rev ), but the var\log\.deployer-log4j.properties file wasn't deleted as part of those changes.
Solution
The var\log\deployer-log4j.properties file will be removed from future distributions.
Workaround
You can safely delete the var\log\deployer-log4j.properties file.
Client-Deployer config is using wrong/hardcoded commons-primitives version
Client-Deployer config is using a hardcoded commons-primitives version of 1.0 instead of using the project.properties value of 20041207.202534.
Avoid Classloader warnings generated by BasicProxyManager
Several views in the console create proxies for objects that implement interfaces not available in the console's classloader. The warning messages look like:
08:56:26,315 WARN [BasicProxyManager] Could not load interface org.apache.geronimo.tomcat.TomcatWebContainer in provided ClassLoader for geronimo/tomcat/1.1-SNAPSHOT/car?ServiceModule=geronimo/tomcat/1.1-SNAPSHOT/car,j2eeType=GBean,name=TomcatWebContainer
This warning message can be avoided by getting the classloader for the proxied object from the kernel and then using it to create the proxy.
'/remote-deploy url link throws Error 404.
The following page on the console (http://localhost:8080/console/portal/apps/apps_war) lists all the WARs with their URL links. Accessing the /remote-deploy link throws an Error 404. 
Though this app is used by the CLI tool to deploy apps remotely, we should handle this gracefully instead of showing it as an error.
Please review and apply the patch.
Console: plugin % complete shoudl reset to 0 while preparing a download
The console progress bar should go back to 0 if the percent complete is set to -1 (which should handle resetting it to 0 during the &quot;preparing to download&quot; phase, whereas now it stays at whatever value it had for the last status message)
Remove unneeded jars from console WEB-INF/lib directories
Several of the jars in the console's WEB-INF/lib directories are unneeded
- both copies of jasper-compiler-5.5.12.jar (400K each)
- both copies of jasper-runtime-5.5.12.jar (80K each)
- the copy of castor-0.9.5.3.jar in console-standard (1.7M)
Removing these jars will decrease the server footprint and binary image download size.
CORBA for EJB with Local interface only causes NPE
I have an EJB with a local interface and I tried applying CORBA settings. It blows up during deployment. My guess is that it wants a remote interface to be there, but somehow, the checks in StandardServant:126 are not working and the interface just comes up as null.
Caused by: java.lang.NullPointerException
at org.openejb.corba.util.Util.getAllInterfaces(Util.java:593)
at org.openejb.corba.util.Util.getAllMethods(Util.java:815)
at org.openejb.corba.util.Util.iiopMap(Util.java:608)
at org.openejb.corba.util.Util.mapOperationToMethod(Util.java:604)
at org.openejb.corba.StandardServant.&lt;init&gt;(StandardServant.java:135)
at org.openejb.corba.StandardServant.&lt;init&gt;(StandardServant.java:116)
at org.openejb.corba.Adapter.&lt;init&gt;(Adapter.java:100)
... 67 more
Repeated interface in JMS connection factory plan causes deployment failure
If you deploy a connection factory with an implemented-interface that has the same value as the connectionfactory-interface, then there are explosions during deployment. However, the deployment is not actually rejected, it just ends up deploying something that doesn't work. The cause appears to be generating code that implements the same interface twice -- we should either silently ignore one of them (preferable) or reject the deployment alltogether (workable, I guess).
The plan that caused this contained:
...
&lt;outbound-resourceadapter&gt;
&lt;connection-definition&gt;
&lt;connectionfactory-interface&gt;
javax.jms.TopicConnectionFactory
&lt;/connectionfactory-interface&gt;
&lt;connectiondefinition-instance&gt;
&lt;name&gt;jms/MyTopicConnectionFactory&lt;/name&gt;
&lt;implemented-interface&gt;
javax.jms.TopicConnectionFactory
&lt;/implemented-interface&gt;
...
And the error is:
23:39:59,747 ERROR [GBeanInstanceState] Error while starting; GBean is now in the FAILED state: objectName=&quot;geronimo.server:J2EEApplication=null,J2EEServer=geronimo,JCAResource=MyTopicConnectionFactory,j2eeType=JCAManagedConnectionFactory,name=jms/MyTopicConnectionFactory&quot;
net.sf.cglib.core.CodeGenerationException: java.lang.reflect.InvocationTargetException--&gt;null
at net.sf.cglib.core.AbstractClassGenerator.create(AbstractClassGenerator.java:237)
at net.sf.cglib.proxy.Enhancer.createHelper(Enhancer.java:377)
at net.sf.cglib.proxy.Enhancer.create(Enhancer.java:304)
at org.apache.geronimo.connector.outbound.ManagedConnectionFactoryWrapper.doStart(ManagedConnectionFactoryWrapper.java:215)
at org.apache.geronimo.gbean.runtime.GBeanInstance.createInstance(GBeanInstance.java:936)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.attemptFullStart(GBeanInstanceState.java:325)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.start(GBeanInstanceState.java:110)
at org.apache.geronimo.gbean.runtime.GBeanInstanceState.startRecursive(GBeanInstanceState.java:132)
at org.apache.geronimo.gbean.runtime.GBeanInstance.startRecursive(GBeanInstance.java:537)
at org.apache.geronimo.kernel.basic.BasicKernel.startRecursiveGBean(BasicKernel.java:208)
at org.apache.geronimo.kernel.config.Configuration.startRecursiveGBeans(Configuration.java:315)
at org.apache.geronimo.kernel.config.Configuration$$FastClassByCGLIB$$7f4b4a9b.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:118)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:835)
at org.apache.geronimo.kernel.basic.BasicKernel.invoke(BasicKernel.java:178)
at org.apache.geronimo.kernel.basic.BasicKernel.invoke(BasicKernel.java:173)
at org.apache.geronimo.kernel.config.ConfigurationManagerImpl.start(ConfigurationManagerImpl.java:142)
at org.apache.geronimo.kernel.config.ConfigurationManagerImpl$$FastClassByCGLIB$$fbed85d2.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:118)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:835)
at org.apache.geronimo.kernel.basic.BasicKernel.invoke(BasicKernel.java:178)
at org.apache.geronimo.kernel.KernelGBean.invoke(KernelGBean.java:125)
at org.apache.geronimo.kernel.KernelGBean$$FastClassByCGLIB$$1cccefc9.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:118)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:835)
at org.apache.geronimo.kernel.basic.BasicKernel.invoke(BasicKernel.java:178)
at org.apache.geronimo.kernel.jmx.MBeanServerDelegate.invoke(MBeanServerDelegate.java:117)
at mx4j.remote.rmi.RMIConnectionInvoker.invoke(RMIConnectionInvoker.java:219)
at sun.reflect.GeneratedMethodAccessor129.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324)
at mx4j.remote.rmi.RMIConnectionProxy.invoke(RMIConnectionProxy.java:34)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker.chain(RMIConnectionSubjectInvoker.java:99)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker.access$000(RMIConnectionSubjectInvoker.java:31)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker$1.run(RMIConnectionSubjectInvoker.java:90)
at java.security.AccessController.doPrivileged(Native Method)
at javax.security.auth.Subject.doAsPrivileged(Subject.java:500)
at mx4j.remote.MX4JRemoteUtils.subjectInvoke(MX4JRemoteUtils.java:163)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker.subjectInvoke(RMIConnectionSubjectInvoker.java:86)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker.invoke(RMIConnectionSubjectInvoker.java:80)
at $Proxy0.invoke(Unknown Source)
at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:221)
at sun.reflect.GeneratedMethodAccessor129.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324)
at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:261)
at sun.rmi.transport.Transport$1.run(Transport.java:148)
at java.security.AccessController.doPrivileged(Native Method)
at sun.rmi.transport.Transport.serviceCall(Transport.java:144)
at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:460)
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:701)
at java.lang.Thread.run(Thread.java:534)
Caused by: java.lang.reflect.InvocationTargetException
at sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324)
at net.sf.cglib.core.ReflectUtils.defineClass(ReflectUtils.java:384)
at net.sf.cglib.core.AbstractClassGenerator.create(AbstractClassGenerator.java:219)
... 57 more
Caused by: java.lang.ClassFormatError: $javax/jms/TopicConnectionFactory$$EnhancerByCGLIB$$ed4b84c5 (Repetitive interface name)
at java.lang.ClassLoader.defineClass0(Native Method)
at java.lang.ClassLoader.defineClass(ClassLoader.java:539)
... 62 more
NPE for EJB webservices.xml with bad &lt;jaxrpc-mapping-file&gt;
If the &lt;jaxrpc-mapping-file&gt; points to an invalid location, a NullPointerException is produced. It should instead give a DeploymentException with a message like:
webservices.xml for EJB JAR points to jaxrpc-mapping-file 'META-INF/foo.map' for service 'bar' but that file is not found.
11:47:01,051 ERROR [Deployer] Deployment failed due to
java.lang.NullPointerException
at org.apache.geronimo.deployment.util.NestedJarFile.getInputStream(NestedJarFile.java:187)
at org.apache.geronimo.axis.builder.WSDescriptorParser.readJaxrpcMapping(WSDescriptorParser.java:95)
at org.apache.geronimo.axis.builder.WSDescriptorParser.readJaxrpcMapping(WSDescriptorParser.java:88)
at org.apache.geronimo.axis.builder.WSDescriptorParser.parseWebServiceDescriptor(WSDescriptorParser.java:315)
at org.apache.geronimo.axis.builder.WSDescriptorParser.parseWebServiceDescriptor(WSDescriptorParser.java:379)
at org.apache.geronimo.axis.builder.AxisBuilder.parseWebServiceDescriptor(AxisBuilder.java:106)
at org.apache.geronimo.axis.builder.AxisBuilder$$FastClassByCGLIB$$16a52a9a.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:118)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:800)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:36)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.j2ee.deployment.WebServiceBuilder$$EnhancerByCGLIB$$493cf3fa.parseWebServiceDescriptor(&lt;generated&gt;)
at org.openejb.deployment.OpenEJBModuleBuilder.addGBeans(OpenEJBModuleBuilder.java:500)
at org.openejb.deployment.OpenEJBModuleBuilder$$FastClassByCGLIB$$11bd7b20.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:118)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:800)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:36)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.j2ee.deployment.ModuleBuilder$$EnhancerByCGLIB$$4ca9e4d7.addGBeans(&lt;generated&gt;)
at org.apache.geronimo.j2ee.deployment.EARConfigBuilder.buildConfiguration(EARConfigBuilder.java:402)
at org.apache.geronimo.j2ee.deployment.EARConfigBuilder$$FastClassByCGLIB$$38e56ec6.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:118)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:800)
at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)
at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:36)
at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.java:96)
at org.apache.geronimo.deployment.ConfigurationBuilder$$EnhancerByCGLIB$$5896ed49.buildConfiguration(&lt;generated&gt;)
at org.apache.geronimo.deployment.Deployer.deploy(Deployer.java:269)
at org.apache.geronimo.deployment.Deployer.deploy(Deployer.java:102)
at org.apache.geronimo.deployment.Deployer$$FastClassByCGLIB$$734a235d.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:118)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:835)
at org.apache.geronimo.kernel.basic.BasicKernel.invoke(BasicKernel.java:178)
at org.apache.geronimo.kernel.KernelGBean.invoke(KernelGBean.java:125)
at org.apache.geronimo.kernel.KernelGBean$$FastClassByCGLIB$$1cccefc9.invoke(&lt;generated&gt;)
at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)
at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)
at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:118)
at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:835)
at org.apache.geronimo.kernel.basic.BasicKernel.invoke(BasicKernel.java:178)
at org.apache.geronimo.kernel.jmx.MBeanServerDelegate.invoke(MBeanServerDelegate.java:117)
at mx4j.remote.rmi.RMIConnectionInvoker.invoke(RMIConnectionInvoker.java:219)
at sun.reflect.GeneratedMethodAccessor265.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324)
at mx4j.remote.rmi.RMIConnectionProxy.invoke(RMIConnectionProxy.java:34)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker.chain(RMIConnectionSubjectInvoker.java:99)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker.access$000(RMIConnectionSubjectInvoker.java:31)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker$1.run(RMIConnectionSubjectInvoker.java:90)
at java.security.AccessController.doPrivileged(Native Method)
at javax.security.auth.Subject.doAsPrivileged(Subject.java:500)
at mx4j.remote.MX4JRemoteUtils.subjectInvoke(MX4JRemoteUtils.java:163)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker.subjectInvoke(RMIConnectionSubjectInvoker.java:86)
at mx4j.remote.rmi.RMIConnectionSubjectInvoker.invoke(RMIConnectionSubjectInvoker.java:80)
at $Proxy0.invoke(Unknown Source)
at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:221)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324)
at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:261)
at sun.rmi.transport.Transport$1.run(Transport.java:148)
at java.security.AccessController.doPrivileged(Native Method)
at sun.rmi.transport.Transport.serviceCall(Transport.java:144)
at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:460)
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:701)
at java.lang.Thread.run(Thread.java:534)
Connector portlet delete challenge
Minor improvements to Connector portlet.
1. User confirmation on clicking &quot;delete&quot; link to delete a connector.
2. Add &quot;Reset&quot; and &quot;Cancel&quot; buttons to edit pages.
project DOAP file retrieved numerous times during docs generation
The ability to retrieve a project DOAP file to create &quot;projectDetails&quot; information pages is retrieving the example forrest descriptor numerous times. Throughout the build of the projectInfo plugin's docs (130) it conducted requests for the remote doap.xml file a total of 603 times.
org.apache.forrest.plugin.input.projectInfo does not build
[java] X [0] docs/user/useCases/useCases.source.xml BROKEN: /home/thorsten/src/apache/forrest/trunk/plugins/org.apache.forrest.plugin.input.projectInfo/src/documentation/content/xdocs/useCases.useCases (No such file or directory)
...
broken-links.xml attached.
Avoiding several manipulation on the same class
When a component class is manipulated two times, the manipulation failed : it cannot insert two times the same fields, methods ... 
Insertion of the component manager inside component classes
iPOJO manipulation inserts a field inside the component classes. This field is the component manager of the component. It is used to interact with the container. 
This field is a static field. As a consequence, two components created from the same class share the same component manager. This is problematic in the case of component factory where it must be possible to create 2 components from the same class but with different metadata (container configuration).
Modifiers of generated mehod
iPOJO inject methods inside the POJO code, these methods allows the container (component manager) delegation. 
These method are publics and should be privates.
Remove the DummyActivator
iPOJO uses a DummyActivator to avoiad activator detection in the maven bundle plugin. With the new version of this plugin, the detection can be avoided. The DummyActivator is now useless.
System partition cache parameters cannot be tuned
Right now we can tune cache parameters for any non-system partition but we cannot seem to tune these parameters for the system partition hanging off of the ou=system namingContext. We need to add this since users and groups are managed here off of ou=system. This can grow rapidly and tunable parameters are needed.
ExceptionService.modify() is not generating the correct exception
When trying to modify an attribute with an existing value, the following exception should be generated:
LdapAttributeInUseException( &quot;Trying to add existing value 'XYZ' to attribute ABC&quot;);
But instead the code is generating a IndexOutOfBoundsException because there is a bug in the code that is generating the correct exception.
This is the wrong code:
public void modify( NextInterceptor nextInterceptor, Name name, ModificationItem[] items ) throws NamingException
{
// check if entry to modify exists
String msg = &quot;Attempt to modify non-existant entry: &quot;;
assertHasEntry( nextInterceptor, msg, name );
Attributes entry = nexus.lookup( name );
for ( int ii = 0; ii &lt; items.length; ii++ )
{
if ( items[ii].getModificationOp() == DirContext.ADD_ATTRIBUTE )
{
Attribute modAttr = items[ii].getAttribute();
Attribute entryAttr = entry.get( modAttr.getID() );
if ( entryAttr != null )
{
for ( int jj = 0; jj &lt; modAttr.size(); jj++ )
{
if ( entryAttr.contains( modAttr.get( jj ) ) )
{
throw new LdapAttributeInUseException( &quot;Trying to add existing value '&quot;
+ modAttr.get( ii ) + &quot;' to attribute &quot; + modAttr.getID() ); &lt;----- HERE IS THE PROBLEM, should use modAttr.get( jj ) 
}
}
}
}
}
nextInterceptor.modify( name, items );
}
wrong Windows-path
org.apache.directory.shared.ldap.ldif.LdifReaderTest tries to create a file under &quot;/tmp&quot; which i not a valid folder under Windows
ClassCast exception when fetching DNs from root DES
When fetching for DNs in LdapBrowser, you get an exception while encoding the SearchResultEntry :
...
Caused by: java.lang.ClassCastException: org.apache.directory.shared.ldap.name.LdapDN
at org.apache.directory.shared.ldap.codec.search.SearchResultEntry.computeLength(SearchResultEntry.java:240)
at org.apache.directory.shared.ldap.codec.LdapMessage.computeLength(LdapMessage.java:530)
at org.apache.directory.shared.ldap.codec.LdapMessage.encode(LdapMessage.java:602)
at org.apache.directory.shared.ldap.codec.TwixEncoder.encodeBlocking(TwixEncoder.java:121)
at org.apache.directory.shared.ldap.codec.TwixEncoder.encode(TwixEncoder.java:200)
at org.apache.directory.shared.ldap.message.MessageEncoder.encode(MessageEncoder.java:131)
at org.apache.mina.filter.codec.asn1.Asn1CodecEncoder.encode(Asn1CodecEncoder.java:55)
at org.apache.mina.filter.codec.ProtocolCodecFilter.filterWrite(ProtocolCodecFilter.java:226)
... 22 more
The problem is that when encoding a SearchResultEntry, the values are supposed to be Strings or byte arrays, not LdapDNs. When you fetch for DNs in the root DSE, the result is stored in the SearchResultEntry as LdapDN objects, not Strings, and it's allowad, as the method which set the value accept an Object.
We have to fix two problems :
- first, check that the Object is either a String or a byte[], nothing else (defensive programming)
- second, avoid storing LdapDN objects where String or byte[] are expected :)
query incorrectly parsed if first part contains wild-cards (asterisk) - most prominently for gpg/gnupg
As reported by Valdimir (http://mail-archives.apache.org/mod_mbox/directory-dev/200606.mbox/ajax/%3c4492B645.9020205@netcetera.com.mk%3e) this query is not handled correctly.
In short: 
ldapsearch -x -H ldap://localhost:11500 -D &quot;dn=bugs&quot; -w bunny -b &quot;dc=pgpkeys&quot; &quot;(&amp;(pgpuserid=test*)(pgpdisabled=0))&quot;
only brings up a SimpleNode instead of a BranchNode.
Some further insights:
-----------------
1) a unit test on the query with the parser in shared-ldap-0.9.5.jar appears to work:
FilterParserImpl parser = new FilterParserImpl();
ExprNode node = parser
.parse(&quot;(&amp;(pgpuserid=*@test*)(pgpdisabled=0))&quot;);
==&gt; a BranchNode is returned here, but not when using apacheDS
2) when switching the order of the sub-queries, I do see the BranchNode even when using apacheDS with both parts:
ldapsearch -x -H ldap://localhost:2389 -d5 -D &quot;dn=bugs&quot; -w bunny -b &quot;dc=pgpkeys&quot; &quot;(&amp;(pgpdisabled=0)(pgpuserid=@test*))&quot;
3) increasing the debug level to &quot;ldapsearch -d10&quot; hints that the full query is sent to apacheDS and not only the &quot;pgpdisabled=0&quot; part
4) when setting a break-point in org.apache.directory.shared.ldap.filter.FilterParserImpl, it appears that when doing my tests, the parse() is never called??
Searches with quotes in the search base do not work as expected.
Searches with quotes in the search base do not work as expected. I have a created a person entry:
dn: cn=Kylie Minogue,dc=example,dc=com
objectclass: top
objectclass: person
sn: Minogue
cn: Kylie Minogue
and try to find it with the following search parameters:
BASE DN: cn=&quot;Kylie Minogue&quot;,dc=example,dc=com
Filter: (cn=Kylie Minogue)
Scope: BASE
No entry is found in ApacheDS 1.0 RC3. But RFC 2253 (Lightweight Directory Access Protocol (v3): UTF-8 String Representation of Distinguished Names) requires that implementations must allow a value to be surrounded by quote ('&quot;' ASCII 34) characters, which are not part of the value (Chapter 4. Relationship with RFC 1779 and LDAPv2).
I have created a JUnit test which imitates the search with the help of JNDI (attached). It works with Sun Java System Directory Server 5.2 and IBM Tivoli Directory Server 6.0.
Performing two modifications on a single attribute within a single modify operation fails.
Performing two modifications on a single attribute within a single modify operation fails.
After creating an entry like this:
dn: cn=Kate Bush,dc=example,dc=com
objectclass: person
objectclass: top
sn: Bush
cn: Kate Bush
e.g.
$ ldapmodify -h localhost -p 10389 -D &quot;uid=admin,ou=system&quot; -w ****** -a -f KateBush.ldif
adding new entry cn=Bush\, Kate,dc=example,dc=com
I perform a modify operation with two modification items:
dn: cn=Kate Bush,dc=example,dc=com
changetype: modify
add: description
description: Kate Bush is a British singer-songwriter.
description: She has become one of the most influential female artists of the twentieth century.
-
delete: description
description: She has become one of the most influential female artists of the twentieth century.
which results in an error:
$ ldapmodify -h localhost -p 10389 -D &quot;uid=admin,ou=system&quot; -w ****** -f twoModifications.ldif
modifying entry cn=Kate Bush,dc=example,dc=com
ldap_modify: No such attribute
ldap_modify: additional info: failed to modify entry cn=Kate Bush,dc=example,dc=com
The expected result is to perform both modification items within a single transaction, resulting in an entry like this:
dn: cn=Kate Bush,dc=example,dc=com
objectclass: person
objectclass: top
sn: Bush
cn: Kate Bush
description: Kate Bush is a British singer-songwriter.
Find an equivalent JNDI JUnit test case attached.
NormalizationService is not handling correctly a Name with a comma followed by a space in it: for instance &quot;text1, text2&quot;
In my custom partition I have organizations with various special characters in their name, for instance:
&quot;text1=text2&quot;
&quot;text1 text2&quot;
&quot;text1,text2&quot;
The 3 above all work fine.
But the following won't be normilized correctly:
&quot;text1= text2&quot;
&quot;text2, text2&quot;
They are normilized by NormalizationService.search or NormalizationService.hasEntry as this:
&quot;text1= text2&quot; --&gt; &quot;text1=text2&quot;
&quot;text2, text2&quot; --&gt; &quot;text1,text2&quot;
The space after the = or the , are skipped.
I think the code doing this is coming from antrl.
I tried using the latest 2.7.5 but the problem is still there.
I think the actual class with the bug is LLKParser.
I didn't download the code so i am not sure what's wrong.
I believe this is a regression as the same test case used to work with a previous
version of apache DS.
Let me know if you need anything more from me.
IoSessionInputStream.read() does not properly return -1 to indicate end-of-stream.
With the following snippet:
BufferedReader in = new BufferedReader(
new InputStreamReader( this.in ) );
String line;
while ( ( line = in.readLine() ) != null &amp;&amp;
!line.equals( &quot;&quot; ) )
{
System.out.println(&quot;data is:&quot; + line);
}
After the data is printed, there is an exception
java.io.IOException: Stream is closed.
at
org.apache.mina.handler.support.IoSessionInputStream.waitForData(IoSessionInputStream.java:131)
at
org.apache.mina.handler.support.IoSessionInputStream.read(IoSessionInputStream.java:102)
at
sun.nio.cs.StreamDecoder$CharsetSD.readBytes(StreamDecoder.java:411)
at
sun.nio.cs.StreamDecoder$CharsetSD.implRead(StreamDecoder.java:453)
at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:183)
at java.io.InputStreamReader.read(InputStreamReader.java:167)
at java.io.BufferedReader.fill(BufferedReader.java:136)
at java.io.BufferedReader.readLine(BufferedReader.java:299)
at java.io.BufferedReader.readLine(BufferedReader.java:362)
Possible parameter corruption for messageSent event.
Writing various messages from multiple threads can cause the corruption of parameters of messageSent event.
new j9 canons required/canons need to be removed to catch up to changes to 7/27/06.
There are some newer failures with wctme5.7 &amp; wsdd5.6 that are just due to canon maintenance.
- lang/aggregate.sql - needs a new j9_13 and j9_22 canon
- lang/ejbql.sql - j9_13 canon can be removed (there is no j9_22 canon)
- lang/distinct.sql - needs new j9_22 canon
- nist/dml099.sql - j9_13 canon can be removed
- lang/procedureInTrigger.sql - needs a j9_22 canon
note, this last test also suffers from DERBY-1605.
test harness evaluates j9 2.2 jvm (a.k.a wctme5.7) as isJDBC4; does enthousiastic sed-ing
The wctme5.7 run shows failures like so:
*** Start: iepnegativetests jdk1.3.1 subset - 2.2 derbyall:derbytools 2006-07-24 11:41:43 ***
16 del
&lt; ERROR 38000: The exception 'java.sql.SQLException: Table/View 'IEP.NOTABLE' does not exist.' was thrown while evaluating an expression.
16a16
&gt; ERROR 38000: The exception 'SQL Exception: Table/View 'IEP.NOTABLE' does not exist.' was thrown while evaluating an expression.
...
It seems to me this is because it evaluates the major/minor version (2.2) as isJDBC4 in functionTests/harness/RunTest.java :
JavaVersionHolder jvh = getProperties(sp);
boolean isJDBC4 = jvh.atLeast( 1, 6 );
and is gets passed on to Sed.java.
The following tests fail with this jvm because of this:
lang/compressTable.sql
lang/nestedCommit.sql
lang/releaseCompileLocks.sql
tools/iepnegativetests.sql
tools/importExportThruIJ.sql
tools/ieptests.sql
jdbcapi/statementJdbc20.java
i18n/iepnegativetests_ES.sql
store/streamingColumn.java
store/TransactionTable.sql
lang/procedureInTrigger.sql
It seems to me we need an if (!jvmName.startsWith(&quot;j9&quot;)) or some such around the isJDBC4 assignment.
INTEGER function cannot be abbreviated
The reference manual (http://db.apache.org/derby/docs/10.1/ref/rrefbuiltinteger.html) states that the INTEGER function can be abbreviated by INT, but Derby 10.1.3.1 does not accept that.
Example:
VALUES INTEGER(1.5);
-&gt; OK
VALUES INT(1.5);
-&gt; ERROR 42X80: VALUES clause must contain at least one element.
The attributesAsPassword property doesn't work correctly with EmbeddedConnectionPoolDataSource
When attributesAsPassword is true, EmbeddedConnectionPoolDataSource.getPooledConnection() appends the default password to the connection url. This leads to a malformed url error if the password is not on the form &quot;xxx=yyy&quot;. If the password is on the form &quot;xxx=yyy&quot;, it might cause other unexpected consequences (for instance if it is &quot;shutdown=true&quot;). This is not a problem with EmbeddedDataSource or EmbeddedXADataSource. In Derby 10.1.3.1, it works as expected, so this is a regression.
A number of tests fail due to rework on toString() method of SQLException
The following tests are having regressions. The DerbyNet failures make sense, I don't test DerbyNet on my environment. The other failures I should have caught. 
procedureInTrigger 
procedure (DerbyNet and DerbyNetClient) 
importExport (DerbyNet) 
ieptests (DerbyNet) 
Output from tools/derbyrunjartest.java can be mixed
tools/derbyrunjartest.java has occasionally failed in the nightlies, for instance http://www.multinet.no/~solberg/public/Apache/DerbyJvm1.4/testlog/Linux-2.6.14-1.1644_FC4_i686-i686/416774-derbyall_diff.txt and http://www.multinet.no/~solberg/public/Apache/Derby/testlog/SunOS-5.10_i86pc-i386/416051-derbyall_diff.txt.
The symptom is either that the output is mixed or that parts of it is missing. This is most likely caused by the writing of output from the forked java processes happening in separate threads. The runtool() method only waits for the forked processes to finish, not for the output processing. The problem would probably go away if BackgroundStreamSaver.finish() were called from runtool().
NetworkServerControlImpl.consoleExceptionPrintTrace() prints stack trace even when logWriter is null
NetworkServerControlImpl.consoleExceptionPrintTrace() prints the stack
trace to System.err if logWriter is null. This has occasionally caused
errors in the regression tests. See
http://www.multinet.no/~solberg/public/Apache/10.2.0.3_Snapshot/jvm1.5/testlog/sparc_zone3/412239-derbyall_diff.txt
for an example.
The test failure happens when NetworkServerControlImpl.shutdown() has
sent the shutdown command and starts a loop calling ping() until it
gets an error. Since it expects ping() to fail, it sets logWriter to
null to avoid getting error messages printed on the console.
In most cases, the network server is already stopped before the first
call to ping(). Then ping() fails when calling setUpSocket(), and no
message is printed. On the other hand, if the server is stopped while
ping() is being executed, the error might occur other places. For
instance, it might fail with a SocketException in
fillReplyBuffer(). fillReplyBuffer() then calls clientSocketError(),
which in turn calls consolePropertyMessage() and
consoleExceptionPrintTrace(). consolePropertyMessage() correctly
suppresses the error message, but consoleExceptionPrintTrace() prints
the stack trace.
derbynet/ShutDownDBWhenNSShutsDownTest.junit fails on Solaris sparc
'*** Start: ShutDownDBWhenNSShutsDownTest jdk1.5.0_04 DerbyNetClient derbynetmats:derbynetmats 2006-07-20 16:05:42 ***
0 add
&gt; .F
&gt; There was 1 failure:
&gt; 1) testDatabasesShutDownWhenNSShutdown(org.apache.derbyTesting.functionTests.tests.derbynet.ShutDownDBWhenNSShutsDownTest)junit.framework.AssertionFailedError: Database is shut down expected:&lt;true&gt; but was:&lt;false&gt;
&gt; FAILURES!!!
&gt; Tests run: 1, Failures: 1, Errors: 0
Test Failed.
*** End: ShutDownDBWhenNSShutsDownTest jdk1.5.0_04 DerbyNetClient derbynetmats:derbynetmats 2006-07-20 16:06:06 ***
Derby JDBC 4.0 driver returns 3 for JDBC driver major version
For 10.2 the DatabaseMetaData.getJDBCMajorVersion() is returning &quot;3&quot; for 
the Derby JDBC 4.0 driver. It should return 4. This is easily 
reproduced by running a simple test to obtain a connection and 
output the value,
Database product: Apache Derby
Database version: 10.2.0.4 alpha
Driver name: Apache Derby Embedded JDBC Driver
Driver version: 10.2.0.4 alpha
JDBC driver major version: 3
JDBC driver minor version: 0
Test code:
org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource40 ds =
new 
org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource40();
ds.setDatabaseName(&quot;C:\\drivers\\derby\\databases\\JDBC40DB&quot;);
ds.setUser(&quot;dbuser1&quot;);
ds.setPassword(&quot;dbpwd1&quot;);
PooledConnection pooledConn = 
ds.getPooledConnection();
Connection conn = pooledConn.getConnection();
System.out.println(&quot;Database product: &quot; + 
conn.getMetaData().getDatabaseProductName());
System.out.println(&quot;Database version: &quot; + 
conn.getMetaData().getDatabaseProductVersion());
System.out.println(&quot;Driver name: &quot; + 
conn.getMetaData().getDriverName());
System.out.println(&quot;Driver version: &quot; + 
conn.getMetaData().getDriverVersion());
System.out.println(&quot;JDBC driver major version: &quot; + 
conn.getMetaData().getJDBCMajorVersion());
System.out.println(&quot;JDBC driver minor version: &quot; + 
conn.getMetaData().getJDBCMinorVersion());
Relevant Derby Embedded code in EmbedDatabaseMetaData is:
* JDBC 3.0
*
* Retrieves the major JDBC version number for this driver.
*
* @return JDBC version major number
*/
public int getJDBCMajorVersion()
{
return 3;
}
and client code in org.apache.derby.client.am.DatabaseMetaData:
public int getJDBCMajorVersion() throws SQLException {
checkForClosedConnection();
return 3;
}
I am not sure if this should be JVM dependent or if it should always return 4 regardless of the JVM version.
derbynet/testProtocol.java fails with security manager enabled
The tinderbox test started failing after revision 423676 which enabled security manager for derbynet/testProtocol.java. See http://www.multinet.no/~solberg/public/Apache/TinderBox_Derby/testlog/SunOS-5.10_i86pc-i386/423706-derbyall_diff.txt
Exception in thread &quot;main&quot; java.security.AccessControlException: access denied (java.net.SocketPermission 127.0.0.1:1527 connect,resolve)
at java.security.AccessControlContext.checkPermission(AccessControlContext.java:264)
at java.security.AccessController.checkPermission(AccessController.java:427)
at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)
at java.lang.SecurityManager.checkConnect(SecurityManager.java:1034)
at java.net.Socket.connect(Socket.java:501)
at java.net.Socket.connect(Socket.java:457)
at java.net.Socket.&lt;init&gt;(Socket.java:365)
at java.net.Socket.&lt;init&gt;(Socket.java:178)
at org.apache.derby.impl.drda.TestProto.getConnection(Unknown Source)
at org.apache.derby.impl.drda.TestProto.&lt;init&gt;(Unknown Source)
at org.apache.derbyTesting.functionTests.tests.derbynet.testProtocol.executeFile(Unknown Source)
at org.apache.derbyTesting.functionTests.tests.derbynet.testProtocol.main(Unknown Source)
Permissions-related syscat failures under DerbyNetClient on jdk1.3
I'm seeing the following diffs in syscat under DerbyNetClient on 1.3:
MasterFileName = master/DerbyNetClient/syscat.out
83a84
&gt; SYSCOLPERMS_INDEX2 |{ derby.storage.initialPages=1, derby.storage.minimumRecordSize=1, derby.storage.pageReservedSpace
=0, derby.storage.pageSize=4096, derby.storage.reusableRecordId=true }
100a102
&gt; SYSROUTINEPERMS_INDEX2 |{ derby.storage.initialPages=1, derby.storage.minimumRecordSize=1, derby.storage.pageReservedS
pace=0, derby.storage.pageSize=4096, derby.storage.reusableRecordId=true }
106a109
&gt; SYSTABLEPERMS_INDEX2 |{ derby.storage.initialPages=1, derby.storage.minimumRecordSize=1, derby.storage.pageReservedSpa
ce=0, derby.storage.pageSize=4096, derby.storage.reusableRecordId=true }
281a285
&gt; SYSCOLPERMS |1
308a313
&gt; SYSROUTINEPERMS |1
318a324
&gt; SYSTABLEPERMS |1
501a508
&gt; SYSCOLPERMS |1
528a536
&gt; SYSROUTINEPERMS |1
538a547
&gt; SYSTABLEPERMS |1
Test Failed.
*** End: syscat jdk1.3.1_16 DerbyNetClient 2006-07-17 15:42:34 ***
Failures in derbyall in trunk seen after revision 421960
List of failures seen in http://www.multinet.no/~solberg/public/Apache/TinderBox_Derby/testlog/SunOS-5.10_i86pc-i386/421960-derbyall_diff.txt:
derbyall/storeall/storeall.fail:store/testsqldecimal.sql
derbyall/storeall/storeall.fail:store/backupRestore.sql
derbyall/storeall/storeall.fail:store/onlineBackupTest4.sql
/derbyall.fail:nist/dml076.sql
/derbyall.fail:nist/dml034.sql
/derbyall.fail:nist/dml026.sql
/derbyall.fail:nist/dml099.sql
/derbyall.fail:nist/dml148.sql
In the above failures, store/onlineBackupTest4.sql seems to be intermittent and not seen in the next test run.
'SQLBinary.readFromStream' can enter endless loop
Under certain circumstances, the method 'SQLBinary.readFromStream' can enter an endless loop while reading the stream. The following must be true for the bug to occur: 
* There must be more data in the stream than what can fit into the initial buffer (32 K).
* The method 'available' of the stream returns 0.
Since the default return value for 'InputStream.available' is 0, and the method reading the stream can be used for data types CHAR FOR BIT DATA, VARCHAR FOR BIT DATA and LONG VARCHAR FOR BIT DATA, the bug should be fixed. The maximum length is 32700 bytes.
The method will also be used by SQLBlob, but it may be better to introduce a new streaming method for it, since the current implementation has memory-problems for large data (materializes the whole stream). A separate issue should/will be created for this.
The symptom for this bug is a hang when calling one of the execute methods of Prepared- or CallableStatement and maybe also certain set methods in ResultSet.
The visibility of this bug is very low, but the impact is severe/critical. When the JDBC 4 length less streaming overloads are added (DERBY-1417), visibility might increase.
lang/xmlBinding.java fails with Security Expression
I recently tried to run the lang/xmlBinding.java test and I noticed that the test fails with a Security Exception:
&gt; FAIL: Unexpected exception:
&gt; ERROR 2200L: XMLPARSE operand is not an XML document; see next exception for details.
&gt; java.security.AccessControlException: access denied (java.io.FilePermission {user.dir}/personal.dtd read)
&gt; at java.security.AccessControlContext.checkPermission(AccessControlContext.java(Compiled Code))
&gt; at java.security.AccessController.checkPermission(AccessController.java(Compiled Code))
&gt; at java.lang.SecurityManager.checkPermission(SecurityManager.java(Compiled Code))
&gt; at java.lang.SecurityManager.checkRead(SecurityManager.java(Compiled Code))
This failure does not show up in the nightlies because the XML tests are not currently run as part of derbyall (see DERBY-563, DERBY-567).
I looked a this a bit and eventually realized that the test itself has all the permission it needs, but Xerces, which Derby uses to parse XML documents, does not. More specifically, and XML document can include a pointer to a schema document, which Xerces will then try to read. In order for that to work the Xerces classes would have to have read permission on user.dir, but we can't add that permission to the derby_tests.policy file because the Xerces classes could be in a Xerces jar anywhere on the system, or they could be included the JVM's own jar (ex. IBM 1.4). And further, when DERBY-567 is fixed the parser that is used could vary from JVM to JVM, so it might not be Xerces but some other parser that needs read permission. 
One workaround would be to grant read FilePermission on {user.dir} to &quot;all&quot; (when I did that the test ran cleanly), but it seems to me like that would defeat the purpose of much of the security manager testing. So until a better
option arises, I think the only (or at least, the easiest) option is to just run this specific test with no security manager.
Non-deterministic behavior of lang/grantRevokeDDL.sql
Sometimes I see the following failure in lang/grantRevokeDDL.sql. I have seen this on linux under jdk 1.4 and 1.5.
560 del
&lt; ERROR 28508: User 'MAMTA3' does not have select permission on column 'C111' of table 'MAMTA2'.'V22'.
560a560
&gt; ERROR 28508: User 'MAMTA3' does not have select permission on column 'C111' of table 'MAMTA2'.'V21'.
Test Failed.
*** End: grantRevokeDDL jdk1.4.2_08 2006-07-11 13:38:51 ***
It would appear that when two permissions are inadequate, it's not clear which one will fail the statement.
test run exits for _foundation run because unloadEmbeddedDriver uses driverManager, which isn't available.
The wctme5.7_foundation runs have been exiting out for a while. 
We only run this environment weekly and were under the impression there was a time out. But I ran the suite, capturing the output in a file, and the last part of the run shows the problem is with unloadEmbeddedDriver:
Now do RunList
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: java.sql.DriverManager
at org.apache.derbyTesting.functionTests.harness.RunList.unloadEmbeddedDriver(RunList.java:1636)
at org.apache.derbyTesting.functionTests.harness.RunList.runSuites(RunList.java:276)
at org.apache.derbyTesting.functionTests.harness.RunList.&lt;init&gt;(RunList.java:167)
at org.apache.derbyTesting.functionTests.harness.RunSuite.getSuitesList(RunSuite.java:208)
at org.apache.derbyTesting.functionTests.harness.RunSuite.main(RunSuite.java:147)
UnloadEmbeddedDriver was put in to allow running with useprocess=false and autoload of the driver, so it's needed. 
But maybe we can add an appropriate if condition so it doesn't try to do this with foundation.
EmbeddedDriver does not implement PreparedStatement.setNull(int, int, String)
The embedded driver throws Util.notImplemented() when PreparedStatement.setNull(int, int, String) is called. The javadoc says that &quot;[if] the parameter does not have a user-defined or REF type, the given typeName is ignored.&quot; The client driver correctly ignores typeName and forwards the call to setNull(int, int). Embedded should be changed to match the client.
Client driver: ResultSet.beforeFirst() gives protocol error on scrollable, updatable result sets that are downgraded to read-only
When a statement that produces scrollable, updatable result sets executes a query which cannot produce an updatable result set (a join for instance), ResultSet.beforeFirst() fails with the following error:
Exception in thread &quot;main&quot; java.sql.SQLException: A network protocol error was encountered and the connection has been terminated: Network protocol exception: DSS length not 0 at end of same id chain parse. The connection has been terminated.
at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)
at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:344)
at org.apache.derby.client.am.ResultSet.beforeFirst(ResultSet.java:2101)
at Repro.main(Repro.java:16)
Caused by: org.apache.derby.client.am.DisconnectException: A network protocol error was encountered and the connection has been terminated: Network protocol exception: DSS length not 0 at end of same id chain parse. The connection has been terminated.
at org.apache.derby.client.am.ResultSet.flowPositioningFetch(ResultSet.java:3888)
at org.apache.derby.client.am.ResultSet.moveToBeforeFirst(ResultSet.java:4149)
at org.apache.derby.client.am.ResultSet.beforeFirstX(ResultSet.java:2118)
at org.apache.derby.client.am.ResultSet.beforeFirst(ResultSet.java:2096)
... 1 more
Release note for DERBY-541 on 10.1.3.1 release page
The documentation currently does not address the need to upgrade databases in jars when connecting to a newer version of Derby.
For example, attempting to connect to a database in a jar created with Derby 10.0 fails when trying to connect with Derby 10.1. The following error is thrown:
ERROR XJ040: Failed to start database 'jar:(pathtojarfile)pathinjar', see the next exception for details.
ERROR 40XD1: Container was opened in read-only mode.
PreparedStatement.setNull(int,int) should throw SQLFeatureNotSupportedException for unsupported types
The javadoc for PreparedStatement.setNull(int, int) says:
http://download.java.net/jdk6/docs/api/java/sql/PreparedStatement.html#setNull(int,%20int)
Throws:
...
SQLFeatureNotSupportedException - if sqlType is a ARRAY, BLOB, CLOB, DATALINK, JAVA_OBJECT, NCHAR, NCLOB, NVARCHAR, LONGNVARCHAR, REF, ROWID, SQLXML or STRUCT data type and the JDBC driver does not support this data type
Since Derby doesn't support ARRAY, DATALINK, NCHAR, NCLOB, NVARCHAR, LONGNVARCHAR, REF, ROWID, SQLXML or STRUCT the method should throw SQLFeatureNotSupportedException if used with any of these types. Currently, a general type conversion exception is thrown. With the client driver, no exception is thrown when using this method with the unsupported types.
lang/procedure.java intermittently fails on SunOS-5.10_i86
Diff:
*** Start: procedure jdk1.5.0_06 2006-07-04 13:39:05 ***
219 del
&lt; auto commit is true
220 del
&lt; lock count before execution 0
[...]
1017 del
&lt; JIRA-492 successful -- no hang!
1018 del
&lt; testImplicitClose(): PASSED
1018 add
&gt; ERROR X0X03: Invalid transaction state - held cursor requires same isolation level
&gt; ERROR X0X03: Invalid transaction state - held cursor requires same isolation level
Test Failed.
*** End: procedure jdk1.5.0_06 2006-07-04 13:39:11 ***
Server returns data when it receives a QRYROWSET value of zero on an OPNQRY, which doesn't follow DRDA protocol.
When a client sends a QRYROWSET value of zero to the server, DRDA indicates that the server should not return any rows. But the current Derby Server treats a qryrowset value of 0 (zero) the same as it does a value of 1 (one) and thus performs pre-fetching (as of DERBY-822), which it shouldn't do.
As a result, clients that send a QRYROWSET of 0 and do not expect data could see unexpected results--for example, the DB2 ODBC driver will return the first row of data twice for scrollable cursors because of this issue.
Relevant discussion:
http://article.gmane.org/gmane.comp.apache.db.derby.devel/22659
Some quotes from DRDA manuals:
1) DRDA Manual v3 for OPNQRY:
The qryrowset parameter specifies whether a rowset of rows is to be returned with the command. This is only honored for non-dynamic scrollable cursors (QRYATTSNS not equal to QRYSNSDYN) and for non-scrollable cursors conforming to the limited block query protocol. The target server fetches no more than the requested number of rows. It may fetch fewer rows if it is restricted by extra query block limits, or if a fetch operation results in a negative SQLSTATE or an SQLSTATE of 02000.
2) Page 698 of V.3 says:
A QRYROWSET value of zero on the OPNQRY and EXCSQLSTT commands instructs the server to return no rows with the OPNQRYRM for the cursor or result set. A QRYROWSET value of zero on the CNTQRY command is invalid for non-rowset cursors and results in the application server generating a SYNTAXRM with a SYNERRCD value of '15'x (reserved value not allowed).
runtimestatistics can show that an index is being used even when it isn't
The patch for DERBY-578 also fixes an issue that runtimestatistics may print that an index is being used, even when it isn't. Here is the explanation from DERBY-578.
Earlier, we would set the indexName field in DistinctScanResult to the conglomerate name (cd.getName()) used to scan the table. If the conglomerate was the base table itself then this was just plain wrong. The change, for this patch, passes null if no index is being used. 
This bug should be marked fixed when DERBY-578 is checked in.
Test harness incorrectly catches db.lck WARNINGS generated during STORE tests and lists the tests as failed in *_fail.txt.
The following store tests from derbyall do not shutdown cleanly so leave the db.lck file on disk. This is OK! It is done by design to test recovery. THE PROBLEM, when run on Linux using IBM JRE 1.3.1 sp 10 the test harness 'sees' the warnings and lists the tests as having failed. The harness should ignore this warnings as the tests proceed and complete cleanly. 
Tests INCORRECLTY reported as failed: 
derbyall/derbynetclientmats/derbynetmats.fail:stress/stress.multi 
derbyall/derbynetmats/derbynetmats.fail:stress/stress.multi 
derbyall/storeall/storeall.fail:storetests/st_1.sql 
derbyall/storeall/storeall.fail:unit/recoveryTest.unit 
erbyall/storeall/storeall.fail:store/LogChecksumRecovery.java 
derbyall/storeall/storeall.fail:store/LogChecksumRecovery1.java 
erbyall/storeall/storeall.fail:store/MaxLogNumberRecovery.java 
derbyall/storeall/storeall.fail:store/oc_rec1.java 
derbyall/storeall/storeall.fail:store/oc_rec2.java 
derbyall/storeall/storeall.fail:store/oc_rec3.java 
derbyall/storeall/storeall.fail:store/oc_rec4.java 
derbyall/storeall/storeall.fail:store/dropcrash.java 
derbyall/storeall/storeall.fail:store/dropcrash2.java 
Example Error message: 
WARNING: Derby (instance xxxxFILTERED-UUIDxxxx) is attempting to boot the database csf:/local1/131TST/Store1/storeall/storerecovery/storerecovery/wombat even though Derby (instance xxxxFILTERED-UUIDxxxx) may still be active. Only one instance of Derby should boot a database at a time. Severe and non-recoverable corruption can result and may have already occurred.
Early load of Derby driver with JDBC 4.0 autoloading can lead to derby properties not being processed or derby boot time actions consuming resources when a connection is made with another driver
The addition of support for autoloading of Derby drivers, DERBY-930, caused two potentially serious regresions for applications.
1) Early load of driver can mean that derby system properties, such as derby.system.home may not be processed by the driver because they are set after the driver is loaded.
2) Early load of the driver can mean boot time operations, such as starting network server with derby.drda.startNetworkServer can happen even when Derby is never used if a connection is made to another database such as Oracle.
The attached file autoloading_scenarios.html shows scenarios that show these regressions plus another case that will regress if boot time operations are moved to the first Derby embedded connection. I don't know what solution is available that would handle all three cases.
sysinfo does not write Java SE and JDBC version when running under JDK 1.6
When running sysinfo with jdk 1.6 information about which Java SE and JDBC versions that is supported is missing in the output. The following is written:
--------- Derby Information --------
JRE - JDBC: ?-?
The complete output from sysinfo:
------------------ Java Information ------------------
Java Version: 1.6.0-beta2
Java Vendor: Sun Microsystems Inc.
Java home: /usr/local/java/jdk1.6.0_b86/jre
Java classpath: jars/sane/derby.jar
OS name: SunOS
OS architecture: x86
OS version: 5.10
Java user name: os136802
Java user home: /home/os136802
Java user dir: /home/os136802/derby/develop/jdk16/trunk
java.specification.name: Java Platform API Specification
java.specification.version: 1.6
--------- Derby Information --------
JRE - JDBC: ?-?
[/home/os136802/derby/develop/jdk16/trunk/jars/sane/derby.jar] 10.2.0.4 alpha - (415258M)
------------------------------------------------------
----------------- Locale Information -----------------
Current Locale : [English/United States [en_US]]
Found support for locale: [de_DE]
version: 10.2.0.4 alpha - (415258M)
Found support for locale: [es]
version: 10.2.0.4 alpha - (415258M)
Found support for locale: [fr]
version: 10.2.0.4 alpha - (415258M)
Found support for locale: [it]
version: 10.2.0.4 alpha - (415258M)
Found support for locale: [ja_JP]
version: 10.2.0.4 alpha - (415258M)
Found support for locale: [ko_KR]
version: 10.2.0.4 alpha - (415258M)
Found support for locale: [pt_BR]
version: 10.2.0.4 alpha - (415258M)
Found support for locale: [zh_CN]
version: 10.2.0.4 alpha - (415258M)
Found support for locale: [zh_TW]
version: 10.2.0.4 alpha - (415258M)
------------------------------------------------------
derbyall/i18nTest/MessageBundleTest.diff test failed in nightly run, jdk15
here is the diff:
********* Diff file derbyall/i18nTest/MessageBundleTest.diff
*** Start: MessageBundleTest jdk1.5.0_02 derbyall:i18nTest 2006-06-14 22:43:27 ***
1 del
&lt; ERROR: Message id XSDAN.S in SQLState.java was not found in messages_en.properties
2 del
&lt; ERROR: Message id X0RQ3.C in SQLState.java was not found in messages_en.properties
3 del
&lt; ERROR: Message id XSAX1 in SQLState.java was not found in messages_en.properties
4 del
&lt; ERROR: Message id XCL32.S in SQLState.java was not found in messages_en.properties
5 del
&lt; ERROR: Message id J030 in MessageId.java was not found in messages_en.properties
6 del
&lt; ERROR: Message id J029 in MessageId.java was not found in messages_en.properties
6 add
&gt; Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org.apache.derby.shared.common.reference.SQLState
Test Failed.
*** End: MessageBundleTest jdk1.5.0_02 derbyall:i18nTest 2006-06-14 22:43:30 ***
PreparedStatement.setObject(int,Object,int) should throw SQLFeatureNotSupportedException for unsupported types
From the javadoc:
Throws:
...
SQLFeatureNotSupportedException - if targetSqlType is a ARRAY, BLOB, CLOB, DATALINK, JAVA_OBJECT, NCHAR, NCLOB, NVARCHAR, LONGNVARCHAR, REF, ROWID, SQLXML or STRUCT data type and the JDBC driver does not support this data type
Since Derby doesn't support ARRAY, DATALINK, NCHAR, NCLOB, NVARCHAR, LONGNVARCHAR, REF, ROWID, SQLXML or STRUCT the method should throw SQLFeatureNotSupportedException if used with any of these types. Currently a general type conversion exception is thrown:
&gt;&gt;1) testSetObjectNotImplementedARRAY(org.apache.derbyTesting.functionTests.tests.jdbc4.PreparedStatementTest)SQL Exception: An attempt was made to get a data value of type 'CLOB' from a data value of type '2003'.
&gt;&gt;Caused by: SQL Exception: An attempt was made to get a data value of type 'CLOB' from a data value of type '2003'.
Interface changes introduced in Mustang build 86
Build 86 of Mustang introduced changes to the Connection interface that were not compatible with the existing Derby implementions. 
createArray() was renamed createArrayOf() and setClientInfoProperties() now throws SQLClientInfoException (rather than ClientInfoException). The result of this is that it is not possible to build Derby with build 86.
Encrypted databases cannot be booted using the jar subprotocol (and possibly also using http/https/classpath)
An encrypted database cannot be booted when using the jar subprotocol.
The problem lies in the method run from JCECipherFactory. The call to getRandomAccessFile returns null when the verifyKeyFile is an instance of InputStreamFile and the key verification therefore fails.
The implementation of getRandomAccessFile for InputStreamFile states that its code cannot be reached which is untrue.
The provided patch does two things, it provides a new class InputStreamRandomAccessFile in package org.apache.derby.impl.io. This class provides simple implementations of readInt and readFully so the key verification process succeeds. A quick scan of the derby source tree showed no problem or possible impact of this simple implementation.
The second thing the patch does is to modify org/apache/derby/impl/io/InputStreamFile.java so the getRandomAccessFile creates an instance of InputStreamRandomAccessFile instead of returning null.
This patch has been tested against trunk 410361. It solves the problem at least under the jar subprotocol.
The patch has not been tested against http/https/classpath.
Client driver does not roll back the effects of a stored procedure when incorrectly invoked by executeQuery()/executeUpdate()
When executing a stored procedure with executeQuery() and the proc
doesn't return exactly one result set, the query should fail and the
statement should be rolled back. Embedded does this correctly.
The client driver, however, does not roll back the statement, so the
effects of statements executed on nested connections in the stored
procedure are still visible. The reason for this is that the network
server executes the statement with execute() instead of
executeQuery(), so that it succeeds on the server. The client then
counts the number of result sets, and raises an exception if it is not
one, but it does not roll back the effects of the stored procedure.
verified that.)
The same problem exists for executeUpdate(). JCC also has these
problems.
Short-circuit logic in optimizer appears to be incorrect...
When considering different join orders for the FROM tables in a query, the optimizer will decide to give up on a join order midway through if the cost of that (partial) join order is already higher than the cost of some other *complete* join order that the optimizer previously found. This &quot;short-circuiting&quot; of a join order can save compilation time. 
That said, the logic to perform this &quot;short-circuit&quot; of a join order is currently as follows (from OptimizerImpl.java): 
/* 
** Pick the next table in the join order, if there is an unused position 
** in the join order, and the current plan is less expensive than 
** the best plan so far, and the amount of time spent optimizing is 
** still less than the cost of the best plan so far, and a best 
** cost has been found in the current join position. Otherwise, 
** just pick the next table in the current position. 
*/ 
boolean joinPosAdvanced = false; 
if ((joinPosition &lt; (numOptimizables - 1)) &amp;&amp; 
((currentCost.compare(bestCost) &lt; 0) || 
(currentSortAvoidanceCost.compare(bestCost) &lt; 0)) &amp;&amp; 
( ! timeExceeded ) 
) 
{ 
... 
} 
There are two &quot;current costs&quot; in this statement: one for the cost if the optimizer is calculating a &quot;sort avoidance&quot; plan (which it does if there is a required row ordering on the results) and one if it is calculating a plan for which row order is not important. 
I admit that I'm not all that familiar with what goes on with the costing of a sort-avoidance plan, but inspection of the code shows that, when there is no required row ordering--i.e. when we aren't looking for a sort-avoidance plan--the cost field of currentSortAvoidanceCost will always be 0.0d. That in turn means that in the above &quot;if&quot; statement, the check for 
((currentCost.compare(bestCost) &lt; 0) || 
(currentSortAvoidanceCost.compare(bestCost) &lt; 0)) 
will always return true (because bestCost should--in theory--always be greater than 0.0d). Thus, in the case where we don't have a required row ordering, the short-circuit logic will fail even if currentCost is actually greater than bestCost.
upgradeTests/Upgrade_10_1_10_2.java test fails with java.lang.NoClassDefFoundError: org/apache/derby/iapi/services/info/JVMInfo
The test
derbyall/derbyall.fail:upgradeTests/Upgrade_10_1_10_2.java
has been failing in the nighlies on IBM SDK 142 and Sun JDK 15 with the following:
Derby version - 10.2.0.0 alpha - (409280)
&gt; FAIL - Unexpected exception - null
&gt; Possible Reason - Test could not find the location of jar files. Please check if you are running with jar files in the classpath. The test does not run with classes folder in the classpath. Also, check that old jars are checked out from the repository or specified in derbyTesting.jar.path property in ant.properties
&gt; java.lang.reflect.InvocationTargetException
&gt; Caused by: java.lang.NoClassDefFoundError: org/apache/derby/iapi/services/info/JVMInfo
&gt; ... 9 more
&gt; Exception: null
&gt; java.lang.reflect.InvocationTargetException
&gt; Caused by: java.lang.NoClassDefFoundError: org/apache/derby/iapi/services/info/JVMInfo
&gt; ... 9 more
Setting property derby.system.bootAll causes an Exception
After creating 3 databases under c:\databases\sample - I wanted to get a list of available databases, I followed the example in the &quot;DriverPropertyInfo array example&quot; in the developer guide and used the following routine:
...
private static void test2() {
String driverName =&quot;org.apache.derby.jdbc.EmbeddedDriver&quot;;
String url = &quot;jdbc:derby:&quot;;
Properties p = System.getProperties();
p.put(&quot;derby.system.home&quot;, &quot;C:\\databases\\sample&quot;);
p.put(&quot;derby.system.bootAll&quot;, &quot;true&quot;);
try {
Class.forName(driverName);
Driver driver = DriverManager.getDriver(url);
Properties info = new Properties();
DriverPropertyInfo[] attributes = driver.getPropertyInfo(url, info);
for (DriverPropertyInfo attribute : attributes) {
System.out.print(attribute.name);
System.out.print(&quot; : &quot;);
if (attribute.choices != null) {
System.out.print(Arrays.toString(attribute.choices));
}
System.out.print(&quot; : &quot;);
System.out.println(attribute.value);
}
}
catch(Exception exp) {
exp.printStackTrace();
}
try {
DriverManager.getConnection(&quot;jdbc:derby:;shutdown=true&quot;);
}
catch(Exception exp) {
}
}
When run the following exception occured:
Exception in thread &quot;main&quot; java.lang.ExceptionInInitializerError
at java.lang.Class.forName0(Native Method)
at java.lang.Class.forName(Unknown Source)
at Test.test2(Test.java:20)
at Test.main(Test.java:8)
Caused by: java.lang.NullPointerException
at org.apache.derby.impl.services.monitor.BaseMonitor.bootProviderServic
es(Unknown Source)
at org.apache.derby.impl.services.monitor.BaseMonitor.bootPersistentServ
ices(Unknown Source)
at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(Unkno
wn Source)
at org.apache.derby.impl.services.monitor.FileMonitor.&lt;init&gt;(Unknown Sou
rce)
at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Unknown S
ource)
at org.apache.derby.iapi.jdbc.JDBCBoot.boot(Unknown Source)
at org.apache.derby.jdbc.EmbeddedDriver.boot(Unknown Source)
at org.apache.derby.jdbc.EmbeddedDriver.&lt;clinit&gt;(Unknown Source)
... 4 more
If i comment out:
// p.put(&quot;derby.system.bootAll&quot;, &quot;true&quot;);
The program runs, but no databases are listed.
The output from java org.apache.derby.tools.sysinfo:
------------------ Java Information ------------------
Java Version: 1.5.0_05
Java Vendor: Sun Microsystems Inc.
Java home: C:\Program Files\Java\jre1.5.0_05
Java classpath: C:\tools\derby\db-derby-10.1.2.1-bin\lib\derby.jar;C:\tools\der
by\db-derby-10.1.2.1-bin\lib\derbytools.jar;;C:\tools\Java\jdk1.5.0_05\lib\tools
.jar;C:\tools\log4j\logging-log4j-1.2.12\dist\lib\log4j-1.2.12.jar;C:\dev_deploy
\plugins\com.x4m.util_1.0.0.jar;C:\dev_deploy\plugins\com.x4m.uomcrs_1.0.0.jar;C
:\dev_deploy\plugins\com.x4m.database_1.0.0.jar;C:\dev_deploy\plugins\com.x4m.fe
ature_1.0.0.jar;C:\dev_deploy\plugins\org.eclipse.core.runtime_3.1.0.jar;C:\dev_
deploy\plugins\org.eclipse.osgi_3.1.0.jar;C:\dev_deploy\plugins\com.x4m.database
_1.0.0.jar;C:\david\novice\syncservices\build\class
OS name: Windows XP
OS architecture: x86
OS version: 5.1
Java user name: David
Java user home: C:\Documents and Settings\David
Java user dir: C:\david\novice\derby
java.specification.name: Java Platform API Specification
java.specification.version: 1.5
--------- Derby Information --------
JRE - JDBC: J2SE 5.0 - JDBC 3.0
[C:\tools\derby\db-derby-10.1.2.1-bin\lib\derby.jar] 10.1.2.1 - (330608)
[C:\tools\derby\db-derby-10.1.2.1-bin\lib\derbytools.jar] 10.1.2.1 - (330608)
------------------------------------------------------
----------------- Locale Information -----------------
------------------------------------------------------
I have read most of the documentation and can find no other way to get a list of available catalogs - thus I do not know of a workaround for this problem.
David Heath
Transform Software and Services
Network Server does not shutdown the databases it has booted when started and shutdown from the command line
If network server is started and shutdown from the comand line t does not shutdown the database. This can is evidenced by the fact that the db.lck file remains after the following steps.
java org.apache.derby.drda.NetworkServerControl start &amp;
&lt;some database access&gt;
java org.apache.derby.drda.NetworkServerControl shutdown
There is much discussion about the correct behavior of NetworkServer in this regard related to embedded server scenarios in DERBY-51, but it seems clear in this case the databases should be shutdown.
Description of place where DITA-OT1.1.2.1_bin-ASL.zip is placed seems to be worng.
Description of next url says that DITA-OT1.1.2.1_bin-ASL.zip should be placed to &quot;%DOC_ROOT%/lib&quot;
http://db.apache.org/derby/manuals/dita.html#Setting%2Bup%2Byour%2Benvironment
However,I could not run the command &quot;ant html&quot; in this configuration.
Error message tells that expanding DITA-OT1.1.2.1_bin-ASL.zip was failed.
It seems that &quot;%DOC_ROOT%/lib&quot; is not correct and &quot;%DOC_ROOT%/trunk/lib&quot; is correct place.
In that configration, I could run &quot;ant html&quot;.
Network Server should not use the underlying embedded prepared statement when accessing a BrokeredPreparedStatement
Network Server should not use the underlying embedded 
Prepared statement when accessing a BrokeredPreparedStatement.
In DERBY-1025 Dan pointed out this code which while not related to DERBY-1025 does appear to be a problem. Here is his comment regarding this code in DRDAStatement:
/**
* Get prepared statement
*
* @return prepared statement
*/
protected PreparedStatement getPreparedStatement() throws SQLException
{
if (ps instanceof BrokeredPreparedStatement)
return (PreparedStatement)(
((BrokeredPreparedStatement) ps).getStatement());
else
return ps;
}
This code, for some unknown reason due to lack of comments, is getting the underlying embedded statement
from a BrokeredPreparedStatement. This should not be allowed, the BrokeredStatement wrappers are there to
hide the embedded statement object as it can change under the covers of the wrapper.
Test harness does not pass jvm flags properly if there are more than 1 property in jvm flags
To run Derby tests with EMMA for Code coverage, there is a need to set up emma flag -Djvmflags=-Demma.verbosity.level=silent. This is basically to enable EMMA not to print out any messages to avoid having any diffs. This all works fine when running Derby tests with EMMA for jdk142, jdk15, jdk131 etc because there is no other jvm flag that is passed while calling RunSuite Command. 
Now, while running tests with j2me/cdc/foundation, another value needs to be passed as jvmflag which is
-Djvmflags=&quot;Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource&quot;.
I tried to combine values for both jvm flags as following, but it did not work properly:
1. -Djvmflags='-Demma.verbosity.level=silent -Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource'
During this run, the value that was further passed while running one test was Djvmflags=&quot;'-Demma.verbosity.level=silent&quot;.
As you can notice it took jvm flag as '-Demma.verbosity.level=silent 
2. -Djvmflags=&quot;-Demma.verbosity.level=silent -Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource&quot;
During this run, the value that was further passed while running one test was Djvmflags=&quot;&quot;-Demma.verbosity.level=silent&quot;.
As you can notice it took jvm flag as &quot;-Demma.verbosity.level=silent 
From the above it looks like test harness needs to be changed so that it can parse multiple values for jvm flags properly.
Delete cascade causes NULL values inserted into table when after delete Trigger fires
When an after delete trigger which inserts into a table is created on a table that has a foreign key that references a primary key and uses the on delete cascade constraint, nulls are inserted into the table by the trigger.
The SQL below shows that the cascade delete works correctly:
ij&gt; CREATE TABLE TABLE1 ( X INT PRIMARY KEY );
0 rows inserted/updated/deleted
ij&gt; CREATE TABLE TABLE1_DELETIONS ( X INT );
0 rows inserted/updated/deleted
ij&gt; CREATE TABLE TABLE2 (
Y INT,
CONSTRAINT Y_AND_X FOREIGN KEY(Y) REFERENCES TABLE1(X) ON DELETE CASCADE
);
0 rows inserted/updated/deleted
ij&gt; CREATE TABLE TABLE2_DELETIONS ( Y INT );
0 rows inserted/updated/deleted
ij&gt; INSERT INTO TABLE1 VALUES (0);
1 row inserted/updated/deleted
ij&gt; INSERT INTO TABLE2 VALUES (0);
1 row inserted/updated/deleted
ij&gt; INSERT INTO TABLE1 VALUES (1);
1 row inserted/updated/deleted
ij&gt; INSERT INTO TABLE2 VALUES (1);
1 row inserted/updated/deleted
ij&gt; select * from table1;
X
-----------
0
1
2 rows selected
ij&gt; select * from table2;
Y
-----------
0
1
2 rows selected
ij&gt; DELETE FROM TABLE1;
2 rows inserted/updated/deleted
ij&gt; select * from table1;
X
-----------
0 rows selected
ij&gt; select * from table2;
Y
-----------
0 rows selected
Now insert the rows again, create the triggers, delete the rows from the primary key table, verify the cascade delete worked and observe the values in the tables used by the triggers:
ij&gt; INSERT INTO TABLE1 VALUES(0);
1 row inserted/updated/deleted
ij&gt; INSERT INTO TABLE2 VALUES(0);
1 row inserted/updated/deleted
ij&gt; INSERT INTO TABLE1 VALUES(1);
1 row inserted/updated/deleted
ij&gt; INSERT INTO TABLE2 VALUES(1);
1 row inserted/updated/deleted
ij&gt; CREATE TRIGGER TRIGGER1
AFTER DELETE ON TABLE1
REFERENCING OLD AS OLD_ROW
FOR EACH ROW MODE DB2SQL
INSERT INTO TABLE1_DELETIONS VALUES (OLD_ROW.X);
0 rows inserted/updated/deleted
ij&gt; CREATE TRIGGER TRIGGER2
AFTER DELETE ON TABLE2
REFERENCING OLD AS OLD_ROW
FOR EACH ROW MODE DB2SQL
INSERT INTO TABLE2_DELETIONS VALUES (OLD_ROW.Y);
0 rows inserted/updated/deleted
ij&gt; DELETE FROM TABLE1;
2 rows inserted/updated/deleted
ij&gt; select * from TABLE1;
X
-----------
0 rows selected
ij&gt; select * from TABLE2;
Y
-----------
0 rows selected
ij&gt; SELECT * FROM TABLE1_DELETIONS;
X
-----------
0
1
2 rows selected
ij&gt; SELECT * FROM TABLE2_DELETIONS;
Y
-----------
NULL
NULL
The TABLE2_DELETIONS table contains NULLs instead of the correct values which should be 0 and 1.
Invalid column references are not caught in a trigger action statement when the referencing table of the column is the triggered table
Recently there was a question on the derby-user list about a trigger not firing correctly.
http://article.gmane.org/gmane.comp.apache.db.derby.user/3246
The correct approach was suggested since the trigger statement referenced the actual table name in the 'Triggered-SQL-Statement. But I was surprised that no exception was thrown in the first place during trigger creation. I tried a couple of scenarios and it turns out that if the col names of the triggered column and the column being updated in the triggered SQL are the same, Derby does not throw any exception and the trigger gets created just fine, but will not fire.
The solution may be to throw ERROR 42X04 exception in all the cases when actual table names are referred in the triggered SQL, but the current way is misleading hence marking this issue a Medium. To reproduce the issue, simply run the attached sql script.
ij version 10.2
ij&gt; run 'trigger_error.sql';
ij&gt; CONNECT 'jdbc:derby:bdb;create=true';
ij&gt; DROP TABLE A_TABLE;
ERROR 42Y55: 'DROP TABLE' cannot be performed on 'A_TABLE' because it does not exist.
ij&gt; DROP TABLE B_TABLE;
ERROR 42Y55: 'DROP TABLE' cannot be performed on 'B_TABLE' because it does not exist.
ij&gt; CREATE TABLE A_TABLE (ID SMALLINT GENERATED ALWAYS AS IDENTITY, A_COL VARCHAR(15) NOT NULL PRIMARY KEY);
0 rows inserted/updated/deleted
ij&gt; CREATE TABLE B_TABLE (TYPE VARCHAR(15) NOT NULL, B_COL VARCHAR(15) NOT NULL, AMOUNT SMALLINT NOT NULL DEFAULT 0);
0 rows inserted/updated/deleted
--
--CORRECT BEHAVIOUR:
--==================
--This trigger statement throws an exception, since actual
--table reference cannot be made in the 'Triggered-SQL-Statement'
--
--Note:The Col name used in the 'Triggered-SQL-Statement' for B_TABLE is B_COL.
--
CREATE TRIGGER UPDATE_A_TABLE AFTER UPDATE OF A_COL ON A_TABLE REFERENCING OLD
AS PREVIOUSROW FOR EACH ROW MODE DB2SQL UPDATE B_TABLE SET B_TABLE.B_COL
= A_TABLE.A_COL WHERE B_TABLE.B_COL = PREVIOUSROW.A_COL;
ERROR 42X04: Column 'A_COL' is either not in any table in the FROM list or appea
rs within a join specification and is outside the scope of the join specificatio
n or appears in a HAVING clause and is not in the GROUP BY list. If this is a CR
EATE or ALTER TABLE statement then 'A_COL' is not a column in the target table.
--
--Drop and Re-create the B_TABLE, but with A_COL as the column name
--
DROP TABLE B_TABLE;
0 rows inserted/updated/deleted
ij&gt; CREATE TABLE B_TABLE (TYPE VARCHAR(15) NOT NULL, A_COL VARCHAR(15) NOT NULL, AMOUNT SMALLINT NOT NULL DEFAULT 0);
0 rows inserted/updated/deleted
--
--INCORRECT BEHAVIOUR:
--====================
--This trigger statement executes successfully, does NOT throw an exception, even
--when actual table reference is made in the 'Triggered-SQL-Statement'
--
--Note: The Col name used in the 'Triggered-SQL-Statement' for B_TABLE is A_COL
--(same name as the column in A_TABLE)
--
CREATE TRIGGER UPDATE_A_TABLE AFTER UPDATE OF A_COL ON A_TABLE REFERENCING OLD
AS PREVIOUSROW FOR EACH ROW MODE DB2SQL UPDATE B_TABLE SET B_TABLE.A_COL
= A_TABLE.A_COL WHERE B_TABLE.A_COL = PREVIOUSROW.A_COL;
0 rows inserted/updated/deleted
--
-- insert data
--
insert into a_table(a_col) values ('apples');
1 row inserted/updated/deleted
ij&gt; insert into a_table(a_col) values ('watermelons');
1 row inserted/updated/deleted
ij&gt; insert into a_table(a_col) values ('oranges');
1 row inserted/updated/deleted
ij&gt; insert into b_table values('tree fruit','apples',1);
1 row inserted/updated/deleted
ij&gt; insert into b_table values('citrus fruit','oranges',1);
1 row inserted/updated/deleted
ij&gt; insert into b_table values('melon fruit','watermelons',1);
1 row inserted/updated/deleted
--
--get contents of tables;
--
SELECT * FROM A_TABLE;
ID |A_COL
----------------------
1 |apples
2 |watermelons
3 |oranges
3 rows selected
ij&gt; SELECT * FROM B_TABLE;
TYPE |A_COL |AMOUNT
--------------------------------------
tree fruit |apples |1
citrus fruit |oranges |1
melon fruit |watermelons |1
3 rows selected
--
--update a col in a_table, trigger will not fire
--
update a_table set a_col='cherries' where a_col='apples';
1 row inserted/updated/deleted
--
--select from a_table
--
SELECT * FROM A_TABLE;
ID |A_COL
----------------------
1 |cherries
2 |watermelons
3 |oranges
3 rows selected
--
--trigger did not fire and will see the same data. 'apples' still shown in b_table;
--
SELECT * FROM B_TABLE;
TYPE |A_COL |AMOUNT
--------------------------------------
tree fruit |apples |1
citrus fruit |oranges |1
melon fruit |watermelons |1
3 rows selected
In any case, the correct way to create the trigger is to use 'NEW' to refer the new row value rather than using
the actual table name.
--
-- Attempt to create using the correct trigger statement - the RIGHT WAY
--
DROP TRIGGER UPDATE_A_TABLE;
0 rows inserted/updated/deleted
ij&gt; CREATE TRIGGER UPDATE_A_TABLE AFTER UPDATE OF A_COL ON A_TABLE REFERENCING
OLD AS PREVIOUSROW NEW AS NEWROW FOR EACH ROW MODE DB2SQL UPDATE B_TABLE SE
T B_TABLE.A_COL = NEWROW.A_COL WHERE B_TABLE.A_COL = PREVIOUSROW.A_COL;
0 rows inserted/updated/deleted
--
-- update
--
UPDATE A_TABLE SET A_COL='limes' WHERE A_COL='oranges';
1 row inserted/updated/deleted
--
--select from a_table
--
SELECT * FROM A_TABLE;
ID |A_COL
----------------------
1 |cherries
2 |watermelons
3 |limes
3 rows selected
--
--trigger fired and reflects in the b_table data 'oranges' became 'limes'
--
SELECT * FROM B_TABLE;
TYPE |A_COL |AMOUNT
--------------------------------------
tree fruit |apples |1
citrus fruit |limes |1
melon fruit |watermelons |1
3 rows selected
For LDAP authentication: derby.authentication.server should support ldaps:// as part of the server url.
derby.authentication.server does not recognize secure ldap url - ie if the url starts with ldaps:// 
Trying to connect using LDAP authentication with the following properties set
derby.authentication.provider=LDAP
derby.authentication.server=ldaps://xyz.abc.com:636
derby.authentication.ldap.searchBase='ou=xyz,o=abc.com'
derby.authentication.ldap.searchFilter='(emailaddress=%USERNAME%)'
derby.connection.requireAuthentication=true
throws InvalidNameException
ij&gt; connect 'jdbc:derby:testdb;user=a;password=p';
ERROR 08004: Connection refused : javax.naming.InvalidNameException: Invalid name: /xyz.abc.com:636
Code - LDAPAuthenticationSchemeImpl#setJNDIProviderProperties.
Problem is the code expects that if Context.PROVIDER_URL is not and if derby.authentication.server is set, then the ldapServer is either of the format //server:port or it already starts with ldap:// else it just adds ldap:// .
Thus for a ldaps://xyz.com:636 url , it will become ldap://ldaps://xyz.com:636
in the code snippet, dflLDAPURL is ldap://
if (ldapServer.startsWith(dfltLDAPURL))
this.providerURL = ldapServer;
else if (ldapServer.startsWith(&quot;//&quot;))
this.providerURL = &quot;ldap:&quot; + ldapServer;
else
this.providerURL = dfltLDAPURL + ldapServer;
}
initDirContextEnv.put(Context.PROVIDER_URL, providerURL);
We should support specifiying secure ldap , ie ldaps:// in the derby.authentication.server. Add condition to support the ldaps:// 
ie. 
if (ldapServer.startsWith(dfltLDAPURL) || ldapServer.startsWith(&quot;ldaps://&quot;))
this.providerURL = ldapServer;
========
A workaround to the problem is to set the Context.PROVIDER_URL instead.
sysinfo api does not provide genus name for client
The sysinfo api does not provide access to the genus name for client to allow applications to retrieve information from sysinfo about the client information.
http://db.apache.org/derby/javadoc/publishedapi/org/apache/derby/tools/sysinfo.html
Note: Currently ProductGenusNames has a genus name for network server but network server is closely tied to the engine so should always have the same version.
Get derbyall on jdk1.6
This bug is a placeholder for patches which enable derbyall to run on jdk1.6.
ResultSetMetaData.getColumnDisplaySize sometimes returns wrong values for DECIMAL columns
DECIMAL(10,0)
max display width value: -1234567890 length 11
embedded : 11 correct
client: 12 WRONG
DECIMAL(10,10)
max display width value: -0.1234567890 length 13
embedded : 13 correct
client: 12 WRONG
DECIMAL(10,2)
max display width value: -12345678.90 length 12
embedded : 13 WRONG
client: 12 correct
I've added output early on in jdbcapi/metadata_test.java (and hence the tests metadata.jar and odbc_metadata.java) to show this issue:
E.g. for embedded
DECIMAL(10,0) -- precision: 10 scale: 0 display size: 12 type name: DECIMAL
DECIMAL(10,10) -- precision: 10 scale: 10 display size: 12 type name: DECIMAL
DECIMAL(10,2) -- precision: 10 scale: 2 display size: 12 type name: DECIMAL
I will add this test output once DERBY-829 is fixed so as not to cause conflicts.
OutofMemory Error when reading large blob when statement type is ResultSet.TYPE_SCROLL_INSENSITIVE
Grgoire Dubois on the list reported this problem. From his mail: the reproduction is attached below. 
When statement type is set to ResultSet.TYPE_SCROLL_INSENSITIVE, outofmemory exception is thrown when reading large blobs. 
import java.sql.*;
import java.io.*;
/**
*
* @author greg
*/
public class derby_filewrite_fileread {
private static File file = new File(&quot;/mnt/BigDisk/Clips/BabyMamaDrama-JShin.wmv&quot;);
private static File destinationFile = new File(&quot;/home/greg/DerbyDatabase/&quot;+file.getName());
/** Creates a new instance of derby_filewrite_fileread */
public derby_filewrite_fileread() { 
}
public static void main(String args[]) {
try {
Class.forName(&quot;org.apache.derby.jdbc.EmbeddedDriver&quot;).newInstance();
Connection connection = DriverManager.getConnection (&quot;jdbc:derby:/home/greg/DerbyDatabase/BigFileTestDB;create=true&quot;, &quot;APP&quot;, &quot;&quot;);
connection.setAutoCommit(false);
Statement statement = connection.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);
ResultSet result = statement.executeQuery(&quot;SELECT TABLENAME FROM SYS.SYSTABLES&quot;);
// Create table if it doesn't already exists.
boolean exist=false;
while ( result.next() ) {
if (&quot;db_file&quot;.equalsIgnoreCase(result.getString(1)))
exist=true;
}
if ( !exist ) {
System.out.println(&quot;Create table db_file.&quot;);
statement.execute(&quot;CREATE TABLE db_file (&quot;+
&quot; name VARCHAR(40),&quot;+
&quot; file BLOB(2G) NOT NULL)&quot;);
connection.commit();
}
// Read file from disk, write on DB.
System.out.println(&quot;1 - Read file from disk, write on DB.&quot;);
PreparedStatement preparedStatement=connection.prepareStatement(&quot;INSERT INTO db_file(name,file) VALUES (?,?)&quot;);
FileInputStream fileInputStream = new FileInputStream(file);
preparedStatement.setString(1, file.getName());
preparedStatement.setBinaryStream(2, fileInputStream, (int)file.length()); 
preparedStatement.execute();
connection.commit();
System.out.println(&quot;2 - END OF Read file from disk, write on DB.&quot;);
// Read file from DB, and write on disk.
System.out.println(&quot;3 - Read file from DB, and write on disk.&quot;);
result = statement.executeQuery(&quot;SELECT file FROM db_file WHERE name='&quot;+file.getName()+&quot;'&quot;);
byte[] buffer = new byte [1024];
result.next();
BufferedInputStream inputStream=new BufferedInputStream(result.getBinaryStream(1),1024);
FileOutputStream outputStream = new FileOutputStream(destinationFile);
int readBytes = 0;
while (readBytes!=-1) {
readBytes=inputStream.read(buffer,0,buffer.length);
if ( readBytes != -1 )
outputStream.write(buffer, 0, readBytes);
} 
inputStream.close();
outputStream.close();
System.out.println(&quot;4 - END OF Read file from DB, and write on disk.&quot;);
}
catch (Exception e) {
e.printStackTrace(System.err);
}
}
}
It returns
1 - Read file from disk, write on DB.
2 - END OF Read file from disk, write on DB.
3 - Read file from DB, and write on disk.
java.lang.OutOfMemoryError
if the file is ~10MB or more
Returning ByteArrayInputStream from ResultSet is not appropriate
Point where it is not appropriate :
1: Compatibility
The InputStream returned from result set is closed when other getXXXX method was called .
http://java.sun.com/j2se/1.5.0/docs/api/java/sql/ResultSet.html
However closing ByteArrayInputStream have no effect at all .
http://java.sun.com/j2se/1.5.0/docs/api/java/io/ByteArrayInputStream.html#close()
It seems intended that closable InputStream was returned from result set .
If ByteArrayInputStream was returned from result set , the stream cannot be closed, 
and compatibility would be lost .
2: Performance of program 
Information inputted from ByteArrayInputStream needs to be expanded to memory as byte[] object .
If large byte[] object was created for each ByteArrayInputStream object , 
program will run in bad performance .
// I think problem is when information typed as LOB was retrieved from ResultSet .
// Because such informations typed as LOB tend to be large amount .
Grouped select from temporary table raises null pointer exception in byte code generator
The last statement in the following script:
autocommit off;
declare global temporary table session.ztemp
( orderID varchar( 50 ) )
not logged;
select orderID from session.ztemp group by orderID;
raises the following stack trace in the trunk:
java.lang.NullPointerException
at java.util.Hashtable.get(Hashtable.java:333)
at org.apache.derby.iapi.services.classfile.ClassHolder.findMatchingEntry(ClassHolder.java:656)
at org.apache.derby.iapi.services.classfile.ClassHolder.addUtf8Entry(ClassHolder.java:482)
at org.apache.derby.iapi.services.classfile.ClassHolder.addString(ClassHolder.java:506)
at org.apache.derby.iapi.services.classfile.ClassHolder.addConstant(ClassHolder.java:302)
at org.apache.derby.impl.services.bytecode.BCMethod.push(BCMethod.java:452)
at org.apache.derby.impl.sql.compile.FromBaseTable.generateDistinctScan(FromBaseTable.java:3216)
at org.apache.derby.impl.sql.compile.FromBaseTable.generateResultSet(FromBaseTable.java:3032)
at org.apache.derby.impl.sql.compile.FromBaseTable.generate(FromBaseTable.java:2978)
at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1196)
at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1145)
at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1196)
at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1145)
at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1196)
at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1145)
at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1196)
at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1145)
at org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(ScrollInsensitiveResultSetNode.java:109)
at org.apache.derby.impl.sql.compile.ReadCursorNode.generate(ReadCursorNode.java:118)
at org.apache.derby.impl.sql.compile.CursorNode.generate(CursorNode.java:546)
at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:232)
at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:433)
at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:107)
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:704)
at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:533)
at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:480)
at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:299)
at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:433)
at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:310)
at org.apache.derby.impl.tools.ij.Main.go(Main.java:203)
at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169)
at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55)
at org.apache.derby.tools.ij.main(ij.java:60)
Read-only databases fail to boot after soft upgrade. Raises error message: 40XD1: Container was opened in read-only mode.
Attempting to boot a database that is created using Derby 10.0 fail in soft upgrade mode in Derby 10.1 or in trunk. (10.2) Boot fails with Error 40XD1: Container was opened in read-only mode.
After debugging the problem a little, it seems soft upgrade code attempts do change a database property value and since the database is read-only, the error is raised. Here is what I tried:
ij&gt; connect 'jdbc:derby:jar:(t10.jar)t10db';
ERROR XJ040: Failed to start database 'jar:(t10.jar)t10db', see the next exception for details.
ERROR 40XD1: Container was opened in read-only mode.
Here is the stack trace:
ERROR 40XD1: Container was opened in read-only mode.
at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:301)
at org.apache.derby.impl.store.raw.data.BaseContainer.use(BaseContainer.java:539)
at org.apache.derby.impl.store.raw.data.BaseContainerHandle.useContainer
(BaseContainerHandle.java:786)
at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:633)
at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:494)
at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1270)
at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init
(OpenConglomerate.java:865)
at org.apache.derby.impl.store.access.heap.Heap.openScan(Heap.java:675)
at org.apache.derby.impl.store.access.RAMTransaction.openScan(RAMTransaction.java:530)
at org.apache.derby.impl.store.access.RAMTransaction.openScan(RAMTransaction.java:1582)
at org.apache.derby.impl.store.access.PropertyConglomerate.openScan(PropertyConglomerate.java:230)
at org.apache.derby.impl.store.access.PropertyConglomerate.saveProperty(
PropertyConglomerate.java:296)
at org.apache.derby.impl.store.access.PropertyConglomerate.setProperty(PropertyConglomerate.java:535)
at org.apache.derby.impl.store.access.RAMTransaction.setProperty(RAMTransaction.java:1787)
at org.apache.derby.impl.sql.catalog.DD_Version.applySafeChanges(DD_Version.java:281)
at org.apache.derby.impl.sql.catalog.DD_Version.upgradeIfNeeded(DD_Version.java:223)
at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.loadDictionaryTables(DataDictionaryImpl.java:5826)
at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.boot(DataDictionaryImpl.java:629)
at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1996)
at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290)
at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:542)
at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418)
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionFactory.bootDataDictionary(GenericLanguageConnectionFactory.java:355)
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionFactory.boot(
GenericLanguageConnectionFactory.java:328)
at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.j
ava:1996)
at org.apache.derby.impl.services.monitor.TopService.bootModule(TopServi
ce.java:290)
at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMo
nitor.java:542)
at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Moni
tor.java:418)
at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:193)
at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1996)
at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290)
at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1834)
at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1700)
at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService
BaseMonitor.java:1528)
at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:998)
at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:990)
at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService
(Monitor.java:533)
at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1551)
at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:196)
at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:72)
at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73)
at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183)
at java.sql.DriverManager.getConnection(DriverManager.java:512)
at java.sql.DriverManager.getConnection(DriverManager.java:140)
at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:836)
at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:698)
at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:528)
at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:289)
at org.apache.derby.impl.tools.ij.Main.go(Main.java:203)
at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169)
at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55)
at org.apache.derby.tools.ij.main(ij.java:60)
ij&gt;
unit test 'org.apache.derbyTesting.unitTests.services.T_Diagnosticable' was failed
As summary.
I found next exception in derby.log.
[main] FAIL - org.apache.derbyTesting.unitTests.harness.T_Fail: Test failed - DiagnosticUtil.toDiagString() failed, got: (T_DiagTestClass1.toString(): object with diag interface), expected: (D_T_DiagTestClass1: object with diag interface).
org.apache.derbyTesting.unitTests.harness.T_Fail: Test failed - DiagnosticUtil.toDiagString() failed, got: (T_DiagTestClass1.toString(): object with diag interface), expected: (D_T_DiagTestClass1: object with diag interface).
at org.apache.derbyTesting.unitTests.harness.T_Fail.testFailMsg(T_Fail.java:95)
at org.apache.derbyTesting.unitTests.services.T_Diagnosticable.t_001(T_Diagnosticable.java:105)
at org.apache.derbyTesting.unitTests.services.T_Diagnosticable.runTestSet(T_Diagnosticable.java:207)
at org.apache.derbyTesting.unitTests.harness.T_MultiIterations.runTests(T_MultiIterations.java:94)
at org.apache.derbyTesting.unitTests.harness.T_Generic.Execute(T_Generic.java:117)
at org.apache.derbyTesting.unitTests.harness.BasicUnitTestManager.runATest(BasicUnitTestManager.java:183)
at org.apache.derbyTesting.unitTests.harness.BasicUnitTestManager.runTests(BasicUnitTestManager.java:245)
at org.apache.derbyTesting.unitTests.harness.BasicUnitTestManager.boot(BasicUnitTestManager.java:92)
at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1996)
at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290)
at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1834)
at org.apache.derby.impl.services.monitor.BaseMonitor.startServices(BaseMonitor.java:966)
at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(BaseMonitor.java:398)
at org.apache.derby.impl.services.monitor.FileMonitor.&lt;init&gt;(FileMonitor.java:57)
at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Monitor.java:288)
at org.apache.derbyTesting.unitTests.harness.UnitTestMain.main(UnitTestMain.java:50)
Locale problem in test of derby
Many of derbyall fails at Japanese localed Windows when environment corresponding derbyLocale_JP.jar exists in CLASSPATH.
Almost all of derby_all was failed because all result message was generated in 
Japanese , and that was different from master file.
I tried next configuration ...
conf_0:Exclude derbyLocale_jp.jar
conf_1:Add option &quot;-Duser.language=en -Duser.country=US&quot;
conf_2:Add option &quot;-Djvmflags=-Duser.language=en -Duser.country=US&quot;
conf_3:Defiine environment variable _JAVA_OPTIONS=:-Duser.language=en -Duser.locale=us
conf_4:Defiine environment variable LC_CTYPE:en_US
conf_0 works well on derbyall suite but some of derbynetclientmats/derbynetmats in derbyall suite was failed. Network module seems to have localed message in other resource.
conf_1 works on derbynetclientsmats suite, but same configuration for derbyall suite does not work at all.
conf_2 does not work on derbynetclientsmats suite.
conf_3 seems to work for locale problem but &quot;Picked up _JAVA_OPTIONS:&quot; message cause error in test.
conf_4 does not works ...
Now conf_0 seems to be reasonable method now.
I think conf_3 may be reasonable direction to modify test suite.
Client should throw not implemented exception for depricated setUnicodeStream/getUnicodeStream
setUnicodeStream and getUnicodeStream are deprecated API's 
Network client
PreparedStatement.setUnicodeStream() and ResultSet.getUnicodeStream() should throw not implemented exceptions rather than trying to handle these calls.
Note: The current client implementation of setUnicodeStream() and getUnicodeStream() are broken and can cause unexpected errors
Update the alterTable signature
The alterTables method signatures still contain boolean flags like doDrops which are not used anymore
Modifying columns generates wrong SQL statement
When changing a column size the following SQL statement is generated:
ALTER TABLE testtable MODIFY test VARCHAR(100)
But according to the PostgreSQL manual it should look like
ALTER TABLE testtable ALTER COLUMN test TYPE VARCHAR(111)
SqlBuilder.writeCopyDataStatement(Table, Table) fails on MSSQL tables which require IDENTITY_INSERT ON.
When trying to make a column in a table longer, Ddlutils uses a table copy. This only works on tables without identity columns.
decimal scale never gets written to schema-file in WriteSchema* Tasks
when doing writeSchemaToFile (or other writeSchema Task), the scale of a decimal column never gets written to the schema file
When upgrading a database, and the auto-increment for a column is set to 'true' the sequence is not created
When doing a clean create database I get a sequence for my autoincrement column. But when upgrading ddlutils doesn't 'see' that the change from autoincrement=false to autoincrement=true should lead to the creation of a sequence. This makes upgrading an existing database more difficult.
&quot;empty&quot; DEFAULT statements
i tried to extract the db schema out of a mysql database and transformed it to derby. this task fails because a lot of empty DEFAULT statements are genereatet. 
Example:
sql output: ID INTEGER DEFAULT NOT NULL
xml: &lt;column name=&quot;ID&quot; primaryKey=&quot;true&quot; required=&quot;true&quot; type=&quot;INTEGER&quot; size=&quot;11&quot; autoIncrement=&quot;false&quot;/&gt;
Perhaps the problem can be fixed with an additional test in the org.apache.ddlutils.platform.SqlBuilder class, method writeColumn(..).
original:
if ((column.getDefaultValue() != null) ||
(getPlatformInfo().isDefaultValueUsedForIdentitySpec() &amp;&amp; column.isAutoIncrement()))
possible fix:
if (((column.getDefaultValue() != null) &amp;&amp; column.getDefaultValue().trim().length()&gt;0)||
(getPlatformInfo().isDefaultValueUsedForIdentitySpec() &amp;&amp; column.isAutoIncrement()))
writeSchemaSqlToFile task produces empty output file
Running
&lt;writeSchemaSqlToFile outputFile=&quot;schema.sql&quot;/&gt;
results in an empty schema.sql file, but setting the alterDatabase attribute to false results in a properly written schema.sql file like so:
&lt;writeSchemaSqlToFile alterDatabase=&quot;false&quot; outputFile=&quot;schema.sql&quot;/&gt;
I am guessing that the sql should be written to the file, no matter what the value of the alterDatabase attribute.
DROP COLUMN doesn't work with firebird and interbase
For dropping a column, firebird and interbase doesn't accept the COLUMN keywork, you should write
ALTER TABLE tbl DROP col
instead of
ALTER TABLE tbl DROP COLUMN col
SQL syntax bug in PostgreSQL 8.1 for ALTER COLUMN
The following code has to be added to PostgreSQLBuilder class to make it work for altering columns in PostgreSQL
/**
* Generates the alter statement to add or modify a single column on a table.
*
* @param table The table the index is on
* @param column The column to drop
* @param isNewColumn Whether the column should be added
*/
public void writeColumnAlterStmt(Table table, Column column, boolean isNewColumn) throws IOException
{
writeTableAlterStmt(table);
print(isNewColumn ? &quot;ADD &quot; : &quot;ALTER &quot;);
if(isNewColumn) 
writeColumn(table, column); 
else
writeAlterColumn(table, column);
printEndOfStatement();
}
/** 
* Outputs the DDL for the specified column.
* 
* @param table The table containing the column
* @param column The column
*/
protected void writeAlterColumn(Table table, Column column) throws IOException
{
//see comments in columnsDiffer about null/&quot;&quot; defaults
printIdentifier(getColumnName(column));
print(&quot; TYPE &quot;);
print(getSqlType(column));
if ((column.getDefaultValue() != null) ||
(getPlatformInfo().isIdentitySpecUsesDefaultValue() &amp;&amp; column.isAutoIncrement()))
{
if (!getPlatformInfo().isSupportingDefaultValuesForLongTypes() &amp;&amp; 
((column.getTypeCode() == Types.LONGVARBINARY) || (column.getTypeCode() == Types.LONGVARCHAR)))
{
throw new DynaSqlException(&quot;The platform does not support default values for LONGVARCHAR or LONGVARBINARY columns&quot;);
}
print(&quot; DEFAULT &quot;);
writeColumnDefaultValue(table, column);
}
if (column.isRequired())
{
print(&quot; &quot;);
writeColumnNotNullableStmt();
}
else if (getPlatformInfo().isRequiringNullAsDefaultValue() &amp;&amp;
getPlatformInfo().hasNullDefault(column.getTypeCode()))
{
print(&quot; &quot;);
writeColumnNullableStmt();
}
if (column.isAutoIncrement() &amp;&amp; !getPlatformInfo().isIdentitySpecUsesDefaultValue())
{
if (!getPlatformInfo().isSupportingNonPKIdentityColumns() &amp;&amp; !column.isPrimaryKey())
{
throw new DynaSqlException(&quot;Column &quot;+column.getName()+&quot; in table &quot;+table.getName()+&quot; is auto-incrementing but not a primary key column, which is not supported by the platform&quot;);
}
print(&quot; &quot;);
writeColumnAutoIncrementStmt(table, column);
}
}
Firebird drop index statement should not include &quot;ON &lt;tablename&gt;&quot;
Drop index statement generated for derby database server includes &quot;ON &lt;tablename&gt;&quot;. This syntax fails.
Derby drop index statement should not include &quot;ON &lt;tablename&gt;&quot;
Drop index statement generated for derby database server includes &quot;ON &lt;tablename&gt;&quot;. This syntax fails.
too many waiting objects when importing data
i try to migrate hsqldb database to apache derby and i have
synchronization problem with autogenerated keys from the source db
and new values from the target db
Lets say we hawe one row from the parent table
parent table - source db
pk autoincrement - id = 35
parent table- target db
pk autoincrement - id = 2
In this case ddlutils can't insert rows to the tables wich has foreign key (FK) from
parent table because id value was changed from 35 to 2.
JDBC Type BIGINT in Firebird
The jdbc type BIGINT is converted to the database type DECIMAL(38,0). Firebird does support DECIMAL (and NUMERIC) with a maximum precision of 18. NUMERIC(18,0) or DECIMAL(18,0) should work fine as a conversion of BIGINT. The NUMERIC and DECIMAL types did not change since InterBase 6.0, so this should work for InterBase 6.0 too. Since Firebird 1.5 there is also the native BIGINT type.
Incorrect syntax for modifying columns in Derby
The SQL DdlUtils generates for modifying a column in Derby 10.1 seems incorrect. specifically it cxreates statements like
ALTER TABLE &quot;coltype&quot;
MODIFY &quot;COL_FLOAT&quot; DOUBLE PRECISION;
According to the documentation the correct syntax would have to be 
ALTER TABLE &quot;coltype&quot;
ALTER &quot;COL_FLOAT&quot; SET DATA TYPE DOUBLE PRECISION;
MS-SQL errors with &quot;DEFAULT&quot;s in Alter Statements
When the using the ant task writeSchemaToDatabase with SQL Server 2000 to a database already created, the columns with the default attribute report an error:
[ddlToDatabase] SQL Command ALTER TABLE &quot;oci_switch&quot;
[ddlToDatabase] ALTER COLUMN &quot;schd_status&quot; SMALLINT DEFAULT '0' NOT NULL failed with [Microsoft][SQLServer 2000 Driver for JDBC][SQLServer]Incorrect syntax near the keyword 'DEFAULT'.
Schema:
&lt;table name=&quot;oci_switch&quot;&gt;
&lt;column name=&quot;schd_status&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;SMALLINT&quot; size=&quot;6&quot; default=&quot;0&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;/table&gt;
I believe in MS SQL, you cannot include a DEFAULT in an ALTER COLUMN. It is a seperate statement.
BOOLEANINT for MS-SQL desires TINYINT, but uses SMALLINT
Columns for MS-SQL with Type BOOLEANINT get the following error when using the ant task writeSchemaToDatabase:
[ddlToDatabase] INFO: Altering column oci_schedules.schd_state
[ddlToDatabase] INFO: desired = Column [name=schd_state; javaName=null; type=TINYINT; typeCode=-6; size=null; required=false; primaryKey=false; autoIncrement=false; defaultValue=null; precisionRadix=0; scale=0]
[ddlToDatabase] INFO: current = Column [name=schd_state; javaName=null; type=SMALLINT; typeCode=5; size=5; required=false; primaryKey=false; autoIncrement=false; defaultValue=null; precisionRadix=5; scale=0]
The following is a snippet of my configuration file:
&lt;table name=&quot;oci_schedules&quot;&gt;
&lt;column name=&quot;schd_state&quot; primaryKey=&quot;false&quot; required=&quot;false&quot; type=&quot;BOOLEANINT&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;/table&gt;
FK Constraints Failing on Merge in MS-SQL
Re-running the writeSchemaToDatabase task on an existing MS-SQL database causes errors on all the foreign-key nodes, reporting the error &quot;There is already an object named 'name' in the database&quot;.
Snippet of my schema:
&lt;table name=&quot;oci_schedules&quot;&gt;
&lt;column name=&quot;schd_m_id&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;INTEGER&quot; default=&quot;0&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;foreign-key foreignTable=&quot;oci_schedule_modes&quot;&gt;
&lt;reference local=&quot;schd_m_id&quot; foreign=&quot;schd_m_id&quot;/&gt;
&lt;/foreign-key&gt;
&lt;/table&gt;
&lt;table name=&quot;oci_schedule_modes&quot;&gt;
&lt;column name=&quot;schd_m_id&quot; primaryKey=&quot;true&quot; required=&quot;true&quot; type=&quot;INTEGER&quot; autoIncrement=&quot;true&quot; description=&quot;auto_increment&quot;/&gt;
&lt;/table&gt;
Error:
[ddlToDatabase] SQL Command ALTER TABLE &quot;oci_schedules&quot;
[ddlToDatabase] ADD CONSTRAINT &quot;oci_schedules_FK_schd_m_id_oci_schedule_modes&quot; FOREIGN KEY (&quot;schd_m_id&quot;) REFERENCES&quot;oci_schedule_modes&quot; (&quot;schd_m_id&quot;) failed with [Microsoft][SQLServer 2000 Driver for JDBC][SQLServer]There is already an object named 'oci_schedules_FK_schd_m_id_oci_schedule_modes' in the database.
I have tried this using the open source JTDS 1.1, with the same error message. I have also tried specifying the foreign key name in the XML node, with the same result.
The PK constraint should be generated even if a column is an identity column (except for Hsqldb)
I took the liberty to change the description a bit to make the bug clearer
Column remarks are not stored in JdbcModelReader.getColumnsForTable
When reading in a Database from a physical database, the column comment is not stored in the internal object.
The enclosed patch fixes this.
jdbc model reader does not set the database name
On 11/7/05, Thorbjrn Ravn Andersen &lt;thunderaxiom@gmail.com&gt; wrote:
&gt;&gt; I just noticed that the method described to read from a database, put
&gt;&gt; together with the method to write to XML does not produce XML-files that
&gt;&gt; can be read in again with the method to read from xml.
&gt;&gt;
&gt;&gt; I found that a &quot;database.setName(&quot;whatever&quot;)&quot; had to be called before
&gt;&gt; writing to xml to remidy this.
You're right, the jdbc model reader does not set the database name
yet. Could you file an issue with JIRA ?
Tom
Creating Foreign Keys before creating the matching Tables
While testing on an Postgres-Database, we have the Problem DDL-Utils works thrait throu the xml-Inputfile, and alters the Database. But we have an definition of an foreign key insertet in an table above the creation-rule of the table itself. So, DDL-Utils first tries to alter the Database, inserting the Foreign-key, fails, then creates the table. So, we have 2 choices, sorting the xml-inputfile for the foreign keys, or DDL-Utils let to create foreign keys after creating the needed Tables. For my choices i would prefer the second solution. Can i do anything other?
Error while instanciating a JdbcModelReader with MySQL (4.1)
I get the following error :
java.sql.SQLException: Can't read dir of '.\%\' (Errcode: 2)
The following changes in JdbcModelReader bypass the problem :
/** The database catalog to read. */
private String catalog = &quot;&quot;;
/** The database schema to read. */
private String schema = &quot;&quot;;
Oracle FLOAT and DOUBLE type mappings have zero scale
In Oracle8Platform, the types FLOAT and DOUBLE are mapped to NUMBER(38). According to Oracle's docs, this type has zero scale. It looks like floating point numbers should be specified either as just NUMBER or FLOAT(n). See:
http://oraclelon1.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements001.htm#g196646
index tag and unique tag exists in dtd but DatabaseIO().write generate XML without index and unique elements
index tag and unique tag exists in both dtd but I
found no index element nor unique element created when
I have generated XML from our database using
DatabaseIO().write
For example a postgres table created by :
CREATE TABLE MFG_BatchType
(
Id numeric(10,0) unique not null,
AD_Client_ID numeric(10,0) not null,
AD_Org_ID numeric(10,0) not null,
IsActive varchar(1) not null default 'Y',
Created timestamp not null default CURRENT_TIMESTAMP,
CreatedBy numeric(10,0) not null,
Updated timestamp not null default CURRENT_TIMESTAMP,
UpdatedBy numeric(10,0) not null,
Name varchar(200) not null,
No_version varchar(32) not null,
Description varchar(2000) not null,
Cycle_Time numeric(10,0) not null,
Cycle_Qty float8 not null,
primary key(Id)
);
CREATE INDEX MFG_BatchTypeNDX1 ON MFG_BatchType(Id);
-- ----------------------------------------------------------------------
COMMENT ON COLUMN MFG_BatchType.Description is 'Cycle, one shot or when completed';
COMMENT ON COLUMN MFG_BatchType.Cycle_Time is 'if batch type is cycle';
COMMENT ON COLUMN MFG_BatchType.Cycle_Qty is 'Number of work orders to introduce when WIP minimum is reached';
Give this XML :
&lt;table name=&quot;mfg_batchtype&quot;&gt;
&lt;column name=&quot;id&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;NUMERIC&quot; size=&quot;10&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;ad_client_id&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;NUMERIC&quot; size=&quot;10&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;ad_org_id&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;NUMERIC&quot; size=&quot;10&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;isactive&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;VARCHAR&quot; size=&quot;1&quot; default=&quot;&amp;apos;Y&amp;apos;::character varying&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;created&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;TIMESTAMP&quot; size=&quot;8&quot; default=&quot;(&amp;apos;now&amp;apos;::text)::timestamp(6) with time zone&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;createdby&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;NUMERIC&quot; size=&quot;10&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;updated&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;TIMESTAMP&quot; size=&quot;8&quot; default=&quot;(&amp;apos;now&amp;apos;::text)::timestamp(6) with time zone&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;updatedby&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;NUMERIC&quot; size=&quot;10&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;name&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;VARCHAR&quot; size=&quot;200&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;no_version&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;VARCHAR&quot; size=&quot;32&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;description&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;VARCHAR&quot; size=&quot;2000&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;cycle_time&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;NUMERIC&quot; size=&quot;10&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;column name=&quot;cycle_qty&quot; primaryKey=&quot;false&quot; required=&quot;true&quot; type=&quot;DOUBLE&quot; size=&quot;8&quot; autoIncrement=&quot;false&quot;/&gt;
&lt;/table&gt;
As you can see index and comment disapear for comment, it is not an issue but for index yes.
DB2 autoincrement
Reading table schema for an autoincrement column in DB2 v.8 produces:
&lt;column name=&quot;SEQ_NO&quot; primaryKey=&quot;true&quot; required=&quot;true&quot; type=&quot;INTEGER&quot; size=&quot;10&quot; default=&quot;IDENTITY GENERATED BY DEFAULT&quot; autoIncrement=&quot;false&quot;/&gt;
Should be autoIncrement=&quot;true&quot;
Sybase autoincrement column
Reading a Sybase ASA schema with an autoincrement column produces
default=&quot;autoincrement&quot; autoIncrement=&quot;false&quot;
instead of 
autoIncrement=&quot;true&quot;
MsSqlBuilder can't alter a table to make a column autoincremented (identity)
A column in an existing table can't be made autoincremented using ALTER TABLE.
I want to add this capability to MsSqlBuilder, but i'm not sure whether to copy the approach of Microsoft Enterprise Manager, or if there is some better way, and i would like some direction or input.
I've started by extracting methods alterTable() and alterColumns() from alterDatabase() in SqlBuilder, and i'm overriding alterColumns() in MsSqlBuilder with a check for autoincremented columns in the desiredTable but not in the currentTable.
The approach used when scripting this change from Microsoft Enterprise Manager is to:
1. Drop table constraints
2. Create a new replacement table with the name prefixed by 'Tmp_'
3. SET IDENTITY_INSERT Tmp_table ON
4. Copy the data from the table to the Tmp_table
5. Set IDENTITY_INSERT Tmp_table OFF
6. DROP TABLE table
7. EXECUTE sp_rename N'dbo.Tmp_table', N'table', 'OBJECT'
8. Readd table constraints
An example follows:
BEGIN TRANSACTION
SET QUOTED_IDENTIFIER ON
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE
SET ARITHABORT ON
SET NUMERIC_ROUNDABORT OFF
SET CONCAT_NULL_YIELDS_NULL ON
SET ANSI_NULLS ON
SET ANSI_PADDING ON
SET ANSI_WARNINGS ON
COMMIT
BEGIN TRANSACTION
ALTER TABLE dbo.phones
DROP CONSTRAINT FK_phones_users
GO
COMMIT
BEGIN TRANSACTION
ALTER TABLE dbo.phones
DROP CONSTRAINT DF_phones_phonetype_id
GO
CREATE TABLE dbo.Tmp_phones
(
phone_id int NOT NULL IDENTITY (1, 1),
number varchar(25) NOT NULL,
user_id int NOT NULL,
phonetype_id int NOT NULL
) ON [PRIMARY]
GO
ALTER TABLE dbo.Tmp_phones ADD CONSTRAINT
DF_phones_phonetype_id DEFAULT (0) FOR phonetype_id
GO
SET IDENTITY_INSERT dbo.Tmp_phones ON
GO
IF EXISTS(SELECT * FROM dbo.phones)
EXEC('INSERT INTO dbo.Tmp_phones (phone_id, number, user_id, phonetype_id)
SELECT phone_id, number, user_id, phonetype_id FROM dbo.phones TABLOCKX')
GO
SET IDENTITY_INSERT dbo.Tmp_phones OFF
GO
DROP TABLE dbo.phones
GO
EXECUTE sp_rename N'dbo.Tmp_phones', N'phones', 'OBJECT'
GO
ALTER TABLE dbo.phones ADD CONSTRAINT
PK_phones PRIMARY KEY NONCLUSTERED
(
phone_id,
user_id
) ON [PRIMARY]
GO
ALTER TABLE dbo.phones WITH NOCHECK ADD CONSTRAINT
FK_phones_users FOREIGN KEY
(
user_id
) REFERENCES dbo.users
(
user_id
)
GO
COMMIT
Small difference in sync order processing between Direct and EJB mode
I have noticed a slight difference in the behavior of synchronous buy/sell operations between EJB and JDBC mode. For example, in Sync/Direct mode, if you perform a buy operation the resulting output of the NewOrder pages will look something like the following...
271002 open 2006-07-19 17:04:50.921 null 24.95 buy s:0 100.0
If I perform the same operation in Sync/EJB mode, I get the following...
272002 closed 2006-07-19 17:12:25.156 2006-07-19 17:12:25.156 24.95 buy s:1 100.0
Notice the differences between the two...
- the status (closed vs. open)
- the completion date (null vs an actual value)
I have looked into the code for this and it seems that the EJB version actually returns a refreshed version of the bean (as performed by the ejb container). However, in the JDBC/Direct code we perform the necessary updates to the order via the order processing apis, but we never update the actual local copy of the order bean before returning this.
I realize this may be a minor detail, but it does point out a slight difference between the execution of Direct/EJB mode. The simple solution is to re-fetch the order data before the buy/sell operations are completed in the TradeDirect.java code, similar to the following...
orderData = getOrderData(conn, orderData.getOrderID().intValue());
if (txn != null) {
if ( Log.doTrace() )
Log.trace(&quot;TradeDirect:sell committing global transaction&quot;); 
txn.commit();
setInGlobalTxn(false);
}
else 
commit(conn);
Will attach a patch with this code tomorrow morning...
[Daytrader] Precompiled jsp prevents Daytrader EAR from running on other J2EE servers like WebSphere
In Daytrader1.1 ear file, JspC (Jasper) compiler has been used to precompile the JSPs and it adds these compiled JSP to servlet mappings in the web.xml file and places the compiled classes in the ear file. These precompiled JSPs extend and implement JspC specific classes. 
This EAR deploys successfully on WebSphere which doesn't use the JspC compiler for compilation. But when the precompiled JSPs are requested from the browser it causes application server to load the precompiled JSP classes which throw exceptions as it cannot find the Jasper specific classes in the classpath. 
The only way I have been able to fix this problem is to remove the rules in the pom.xml which cause the precompilation of the JSPs and places the precompiled JSP to servlet mapping in the web.xml and then rebuild the EAR file.
[configuration] Preserve file structure (line comments) when re-saving properties file
This bug applies when an application allows both manual editing of its 
configuration files, and manipulation of the configuration via software. When 
saving the configuration file after changing, its file structure - file, 
section and line comments - will all be lost. Next time a human tries to edit 
the configuration file, all property documentation will be lost.
I have created a fix for this problem, applicable to PropertiesConfiguration 
and XMLPropertiesConfiguration. The fix allows these classes to preserve a 
list of comment lines preceding each property line. By default, comments are 
not preserved; in case the comment preservation is required, it should be 
enabled prior to loading the configuration file using:
AbstractFileConfiguration.setDefaultPreserveComments(true);
The fix is implemented and tested, attached as a patch file to this bug.
Flat3Map.Entry.setValue() overwrites other Entry values
Flat3Map's Entry objects will overwrite other Entry's values if Entry.setValue() is called on one. It should only overwrite the Entry at hand.
I've looked at the source, and the case statement incorrectly falls through, rather than returning like it should:
Flat3Map.java, lines 646-660:
public Object setValue(Object value) {
if (canRemove == false) {
throw new IllegalStateException(AbstractHashedMap.SETVALUE_INVALID);
}
Object old = getValue();
switch (nextIndex) {
case 3: 
parent.value3 = value;
case 2:
parent.value2 = value;
case 1:
parent.value1 = value;
}
return old;
}
With this code, if I set the value of the third item in the EntrySet, then all three values are set to the new value.
ExtendedProperties - field include should be non-static and private
The field &quot;include&quot; in ExtendedProperties is currently static and protected, yet has instance get/set accessors.
Given that there are accessors, it seems unnecessary for the field to be protected - it could be private.
The field should also surely be non-static - or the accessors should be made static, if the field really is supposed to be shared among instances.
The EHDefaultStore returns in the size() method the wrong number of keys
The excalibut store interface defines a size() method for a store: 
/**
* Returns count of the objects in the store, or -1 if could not be
* obtained.
*/
int size();
What it not explicitely says, is that it is the number of keys in memoryStore (so not the diskStore) is needed. The StoreJanitor uses this size() to free some memory from cache when the JVM is low on memory. Since the current EHDefaultStore returns with size() ALL cachekeys (memoryStoreSize + diskStoreSize), it is quite likely when having a large cache that the StoreJanitor removes all cachekeys in memoryStore. Simply changing the size() method of EHDefaultStore to return the number of keys in memoryStore is sufficient. The JCSDefaultStore did implement it correctly already (though I do not see it in the cocoon trunk anymore..?)
ZipArchiveSerializer causes &quot;Too many open files&quot; exception
When ZipArchiveSerializer is used to zip a big number of files, the OS-/Java-dependent limit for open file descriptors can be exceeded, resulting in a corrupt zip file and a &quot;Too many open files&quot; exception in the log.
Apparenty the reason for this is that the InputStreams created in the addEntry method aren't cleaned up properly. If I add a call
sourceInput.close();
after the output has been written, the problem doesn't occur any more. (I've had to do this in the 2.1.7 we're working with, hence no patch file.)
[PATCH] Allow LuceneIndexTransformer to index large documents (with more than 10k terms)
The LuceneIndexTransformer did not provide a way to over-ride the default maxFieldLength value of a Lucene IndexWriter. Since the default value is 10k, this means that large documents can not be indexed.
XMLDBTransformer blows up Saxon
The XMLDBTransformer blows up Saxon, which does not like null URIs. The
following fix seems to work, replacing null in the first parameter to
addAttribute with &quot;&quot;.
// Report result
AttributesImpl attrs = new AttributesImpl();
attrs.addAttribute(&quot;&quot;, XMLDB_QUERY_OID_ATTRIBUTE,
XMLDB_QUERY_OID_ATTRIBUTE, &quot;CDATA&quot;, this.key);
attrs.addAttribute(&quot;&quot;, XMLDB_QUERY_TYPE_ATTRIBUTE,
XMLDB_QUERY_TYPE_ATTRIBUTE, &quot;CDATA&quot;, this.operation);
attrs.addAttribute(&quot;&quot;, XMLDB_QUERY_RESULT_ATTRIBUTE,
XMLDB_QUERY_RESULT_ATTRIBUTE, &quot;CDATA&quot;, result);
The API being called is the SAX org.xml.sax.ContentHandler.createElement().
From the Interface definition at http://www.saxproject.org/apidoc/index.html:
&quot;Parameters:
uri - the Namespace URI, or the empty string if the element has no Namespace 
URI or if Namespace processing is not being performed
...&quot;
Note that a null value is not specified as one of the options:
Both the versions that I have, which are saxon8 (jar contents dated
4/7/2005) and saxonB-8.7.3 (the latest), blow out with a
NullPointerException.
I have used Saxon quite a bit, for XSLT 2.0, and the only calls to Saxon
with null URIs have been from the XMLDBTransformer.
Change to CocoonServlet broke deployer
tools/cocoon-block-deployer/cocoon-deployer-plugin/src/main/resources/org/apache/cocoon/maven/deployer/monolithic/WEB-INF/web.xml
Needs to change to reflect the new Servlet committed by Carsten, there may be other web.xml's affected as well. Till then none of the archetypes will work with cocoon:deploy.
[PATCH] Browser selector should have Opera before MSIE
Hi,
In current versions, Opera identifies itself in the UA string as MSIE by default. Nevertheless it can be identified because the string also contains 'Opera'.
This however only works if browser checks check for Opera *before* they check for MSIE. To properly detect Opera the browser selector should thus be modified, from:
&lt;map:selectors default=&quot;browser&quot;&gt;
&lt;map:selector logger=&quot;sitemap.selector.browser&quot; name=&quot;browser&quot; src=&quot;org.apache.cocoon.selection.BrowserSelector&quot;&gt;
&lt;browser name=&quot;explorer&quot; useragent=&quot;MSIE&quot;/&gt;
&lt;browser name=&quot;pocketexplorer&quot; useragent=&quot;MSPIE&quot;/&gt;
&lt;browser name=&quot;handweb&quot; useragent=&quot;HandHTTP&quot;/&gt;
&lt;browser name=&quot;avantgo&quot; useragent=&quot;AvantGo&quot;/&gt;
&lt;browser name=&quot;imode&quot; useragent=&quot;DoCoMo&quot;/&gt;
&lt;browser name=&quot;opera&quot; useragent=&quot;Opera&quot;/&gt;
&lt;browser name=&quot;lynx&quot; useragent=&quot;Lynx&quot;/&gt;
&lt;browser name=&quot;java&quot; useragent=&quot;Java&quot;/&gt;
&lt;browser name=&quot;wap&quot; useragent=&quot;Nokia&quot;/&gt;
&lt;browser name=&quot;wap&quot; useragent=&quot;UP&quot;/&gt;
&lt;browser name=&quot;wap&quot; useragent=&quot;Wapalizer&quot;/&gt;
&lt;browser name=&quot;mozilla5&quot; useragent=&quot;Mozilla/5&quot;/&gt;
&lt;browser name=&quot;mozilla5&quot; useragent=&quot;Netscape6/&quot;/&gt;
&lt;browser name=&quot;netscape&quot; useragent=&quot;Mozilla&quot;/&gt;
&lt;/map:selector&gt;
into:
&lt;map:selectors default=&quot;browser&quot;&gt;
&lt;map:selector logger=&quot;sitemap.selector.browser&quot; name=&quot;browser&quot; src=&quot;org.apache.cocoon.selection.BrowserSelector&quot;&gt;
&lt;browser name=&quot;opera&quot; useragent=&quot;Opera&quot;/&gt;
&lt;browser name=&quot;explorer&quot; useragent=&quot;MSIE&quot;/&gt;
&lt;browser name=&quot;pocketexplorer&quot; useragent=&quot;MSPIE&quot;/&gt;
&lt;browser name=&quot;handweb&quot; useragent=&quot;HandHTTP&quot;/&gt;
&lt;browser name=&quot;avantgo&quot; useragent=&quot;AvantGo&quot;/&gt;
&lt;browser name=&quot;imode&quot; useragent=&quot;DoCoMo&quot;/&gt;
&lt;browser name=&quot;lynx&quot; useragent=&quot;Lynx&quot;/&gt;
&lt;browser name=&quot;java&quot; useragent=&quot;Java&quot;/&gt;
&lt;browser name=&quot;wap&quot; useragent=&quot;Nokia&quot;/&gt;
&lt;browser name=&quot;wap&quot; useragent=&quot;UP&quot;/&gt;
&lt;browser name=&quot;wap&quot; useragent=&quot;Wapalizer&quot;/&gt;
&lt;browser name=&quot;mozilla5&quot; useragent=&quot;Mozilla/5&quot;/&gt;
&lt;browser name=&quot;mozilla5&quot; useragent=&quot;Netscape6/&quot;/&gt;
&lt;browser name=&quot;netscape&quot; useragent=&quot;Mozilla&quot;/&gt;
&lt;/map:selector&gt;
i.e. Opera is moved five notches up to be tested before MSIE is.
DoubleField validation error with 0 value
David Frizelle reports:
DoubleField validation error occurs with 0 value causing a &quot;number-minvalue-error&quot; error.
This is due to DoubleField minvalue being initialized as Double.MIN_VALUE which the smallest possible POSITIVE double value, rather than Double.NEGATIVE_INFINITY
Select field throws IndexOutOfBoundsException when validating
David Frizelle reports:
A required Select field will throw an:
java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
in the validate() method if no options are added the the Select.
Problem resolving relationships in nested DataContext (HEAD)
Duplicate of CAY-601 for tracking the HEAD fix
Cayenne can fail (optimistic locking exception) when deleting a record that was just inserted/commited to the DB
Please see attached test case (java/model/etc). Versions.rtf shows log output with notes. Entities.png shows main classes.
In a nutshell, prior to Cayenne 1.2 M12 (including in 1.1), an insert followed by a delete would succeed. Starting with M12, the code throws an optimistic locking exception. It almost appears as if the snapshot is being messed up, because the bind parameters are incorrect and the values shown do not match the original DB values it just inserted.
Modifying an object that has a to one relationship to an object that uses inheritance, breaks the relationship.
First reported here: http://objectstyle.org/cayenne/lists/cayenne-user/2006/07/0020.html
A unit test to reproduce (part of InheritanceTst class):
public void testCAY592() throws Exception {
createTestData(&quot;testManagerAddress&quot;);
List addresses = context.performQuery(new SelectQuery(Address.class));
assertEquals(1, addresses.size());
Address address = (Address) addresses.get(0);
Employee e = address.getToEmployee();
// CAY-592 - make sure modification of the address in a parallel context 
// doesn't tmess up the Manager
DataContext c2 = context.getParentDataDomain().createDataContext();
e = (Employee) DataObjectUtils.objectForPK(c2, e.getObjectId());
address = (Address) e.getAddresses().get(0);
assertSame(e, address.getToEmployee());
address.setCity(&quot;XYZ&quot;);
assertSame(e, address.getToEmployee());
}
Sybase PK generation problem
This thread has been going on for a while:
http://objectstyle.org/cayenne/lists/cayenne-devel/2006/06/0126.html
What I didn't realize is that the default pk generator included in Sybase adapter stopped working due to the differences in transaction handling with earlier cayenne version (see stack trace below). I just installed Sybase on an old Mac laptop and will be working on fixing this.
org.objectstyle.cayenne.CayenneRuntimeException: [v.@CAYENNE_VERSION@ @CAYENNE_BUILD_DATE@] Commit Exception
at org.objectstyle.cayenne.access.DataContext.flushToParent(DataContext.java:1289)
at org.objectstyle.cayenne.access.DataContext.commitChanges(DataContext.java:1165)
at org.objectstyle.cayenne.CDOMany2OneNoRevTst.testNewAdd(CDOMany2OneNoRevTst.java:87)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at junit.framework.TestSuite.runTest(TestSuite.java:208)
at junit.framework.TestSuite.run(TestSuite.java:203)
at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128)
at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:457)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:670)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)
Caused by: com.sybase.jdbc3.jdbc.SybSQLException: Stored procedure 'auto_pk_for_table' may be run only in unchained transaction mode. The 'SET CHAINED OFF' command will cause the current session to use unchained transaction mode.
at com.sybase.jdbc3.tds.Tds.processEed(Tds.java:2942)
at com.sybase.jdbc3.tds.Tds.nextResult(Tds.java:2246)
at com.sybase.jdbc3.jdbc.ResultGetter.nextResult(ResultGetter.java:69)
at com.sybase.jdbc3.jdbc.SybStatement.nextResult(SybStatement.java:220)
at com.sybase.jdbc3.jdbc.SybStatement.nextResult(SybStatement.java:203)
at com.sybase.jdbc3.jdbc.SybStatement.executeLoop(SybStatement.java:1868)
at com.sybase.jdbc3.jdbc.SybCallableStatement.execute(SybCallableStatement.java:157)
at org.objectstyle.cayenne.dba.sybase.SybasePkGenerator.pkFromDatabase(SybasePkGenerator.java:179)
at org.objectstyle.cayenne.dba.JdbcPkGenerator.generatePkForDbEntity(JdbcPkGenerator.java:326)
at org.objectstyle.cayenne.access.DataDomainInsertBucket.createPermIdsForObjEntity(DataDomainInsertBucket.java:194)
at org.objectstyle.cayenne.access.DataDomainInsertBucket.appendQueriesInternal(DataDomainInsertBucket.java:122)
at org.objectstyle.cayenne.access.DataDomainSyncBucket.appendQueries(DataDomainSyncBucket.java:108)
at org.objectstyle.cayenne.access.DataDomainFlushAction.preprocess(DataDomainFlushAction.java:211)
at org.objectstyle.cayenne.access.DataDomainFlushAction.flush(DataDomainFlushAction.java:167)
at org.objectstyle.cayenne.access.DataDomain.onSyncFlush(DataDomain.java:830)
at org.objectstyle.cayenne.access.DataDomain$2.transform(DataDomain.java:801)
at org.objectstyle.cayenne.access.DataDomain.runInTransaction(DataDomain.java:856)
at org.objectstyle.cayenne.access.DataDomain.onSync(DataDomain.java:798)
at org.objectstyle.cayenne.access.DataContext.flushToParent(DataContext.java:1261)
... 20 more
Plist serialization of empty strings is incorrect
Reported by Mike Schrag:
It appears that if there is a blank value, property list serialization writes out
key = ;
and at least EOModeler expects
key = &quot;&quot;;
or it will explode.
Synchronizing pattern compilation block in PatternMatchNode
Cayenne &quot;like&quot; expression (a subclass of PatternMatchNode) causes an NPE in multi-threaded situtations. The method that causes it is &quot;PatternMatchNode.getPattern(..)&quot;. While we do not make any special guarantees as to the thread-safety of the expressions, this case looks like the one we need to fix. Especially since the fix is trivial.
cactus:test should compile all java, but run against includes
currently, cactus:test only compiles the included java. IF you include other
classes, it attempts to run them as tests, which fails. This prohibits having
any utility classes for Cactus tests.
I believe **/*.java should be compiled, but only the ones sepificed by includes
should be run.
HTTP unit integration needs WebClient
The current integration fails when trying to load a script reference inside an
HTML page, as the HTTPUnit code requires a WebClient to perform this action.
However, Cactus' generated WebResponse has the client set to null (via
WebResponse.newResponse()).
cactus:report should run cactus:test
to be consistent with the junitreport plugin, the cactus plugin should add the
following line to the start of the cactus:report goal:
&lt;attainGoal name=&quot;cactus:test&quot; /&gt;
This allows cactus tests to be included simply by adding the report to the
&lt;reports/&gt; tag in the project.xml (or programmatically by registering the
report), without explicitly having to call the cactus:test goal yourself.
tag docs for anchor and anchorCell tags should be more specific about href URL and use of parameter tag
The documentation for the anchor and anchorCell tags just says to put a URL in it - that is probably technically accurate, but it would be helpful to add a note to end-users that the parameter tag should be used to make sure that proper encoding happens rather than putting parameters into the href directly.
I'll attach a proposed patch for this.
value of 0 not allowed for arrayMaxLength on JDBCControl statement
I believe that the JDBC Control is trying to protect the end-user from causing a run-time crash by setting the default value of the array max to 1024. In the case that end-users are adjusting the value, they currently have to pick a magic number for the max value because '0' is not an option. Not allowing a value of 0 seems like a bug because some users may find 0 as the most appropriate value for the setting; in addition, an enhancement that would be helpful in the documentation would be giving some additional detail about the setting.
For example, consider changing the javadoc around arrayMaxLength in two ways: 1. warn that the value defaults to 1024 in an effort to keep unknowing end-users from getting a runtime error from trying to stuff too much data into the return array and that a value of 0 may cause a runtime failure if the runtime database returns much larger result sets than testing 2. define why arrayMaxLength is different than maxRows and that a JDBCControl method returning an array forces all processing and array contents to go into memory.
Current docs are here:
http://beehive.apache.org/docs/1.0.1/system-controls/jdbc/apidocs/javadoc/org/apache/beehive/controls/system/jdbc/JdbcControl.SQL.html#arrayMaxLength()
Repro (rev 415831)
1. build beehive
2. cd beehive/system-controls
3. ant drt
4. edit test/jdbc/controls/org/apache/beehive/controls/system/jdbc/test/results/ResultsTestCtrl.jcx
- change @SQL(statement=&quot;SELECT * FROM USERS&quot;, arrayMaxLength=2)
to @SQL(statement=&quot;SELECT * FROM USERS&quot;, arrayMaxLength=0)
5. ant drt
Expected:
- no difference
Actual:
[xmlbean] Time to compile code: 2.075 seconds
[echo] ** Phase One **
Trying to override old definition of task apt
[apt] Compiling 1 source file to /home/jerjohns/projects/beehive/system-co
ntrols/build/test-classes/controls
[apt] warning: Annotation types without processors: [org.apache.beehive.co
ntrols.system.jdbc.JdbcControl.ConnectionDriver, org.apache.beehive.controls.sys
tem.jdbc.JdbcControl.SQL]
[apt] /home/jerjohns/projects/beehive/system-controls/build/test-classes/c
ontrols-generated-src/org/apache/beehive/controls/system/jdbc/test/results/Resul
tsTestCtrl.java:187: SQL annotation on method: getCustomerArrayLimitedSize : arr
ayMaxLength set to invalid value (must be greater than 0): 0
[apt] public Customer[] getCustomerArrayLimitedSize() throws SQLExcept
ion;
[apt] ^
[apt] 1 error
[apt] 1 warning
form bean validations are not following the order
I had a form bean with annotation based validations for each getter method in the form bean
When the validations are done, it is not following the order of the attributes
Ex: I had date, serialNumber, sampleValue. When the validations are done, it is always calling the validations on sampleValue followed by date and serial Number
Is there any way to specify the order of how the validations are being called
Here is the sampe form
@Jpf.FormBean(messageBundle=&quot;errors&quot;)
public class SampleForm implements Validatable, Serializable {
String date;
String serialNumber;
String sampleValue;
@Jpf.ValidatableProperty(validateRequired=@Jpf.ValidateRequired(messageKey=&quot;000.error&quot;, messageArgs={@Jpf.MessageArg(arg=&quot;${bundle.dstbundle.date}&quot;, position=0)}), validateDate=@Jpf.ValidateDate(messageKey=&quot;001.error&quot;, messageArgs={@Jpf.MessageArg(arg=&quot;${bundle.dstbundle.date}&quot;, position=0)}, pattern=&quot;mm/dd/yyyy&quot;, strict=false))
public String getDate() {
return date;
}
public void setDate(String date) {
this.date = date;
}
@Jpf.ValidatableProperty(validateRequired=@Jpf.ValidateRequired(messageArgs={@Jpf.MessageArg(arg=&quot;${bundle.dstbundle.serial}&quot;, position=0)}))
public String getSerialNumber() {
return serialNumber;
}
public void setSerialNumber(String serialNumber) {
this.serialNumber = serialNumber;
}
public void validate(ActionMapping mapping, HttpServletRequest request, ActionMessages errors) {
System.out.println(&quot;In the validate method&quot; + errors.size());
}
@Jpf.ValidatableProperty(validateRequired=@Jpf.ValidateRequired(messageKey=&quot;000.error&quot;, messageArgs={@Jpf.MessageArg(arg=&quot;${bundle.dstbundle.sample}&quot;, position=0)}), validateMinLength=@Jpf.ValidateMinLength(messageKey=&quot;003.error&quot;, messageArgs={@Jpf.MessageArg(arg=&quot;${bundle.dstbundle.sample}&quot;, position=0)}, chars=4))
public String getSampleValue() {
return sampleValue;
}
public void setSampleValue(String sampleValue) {
this.sampleValue = sampleValue;
}
}
Inherited NetUI shared flow reference not initialized correctly.
This bug was noted in the user list.
If you have a base page flow Controller class with a declared member variable as a reference to a SharedFlowController (@Jpf.SharedFlowField annotation) and then implement a derived a page flow classs, the inherited shared flow reference field will not get initialized correctly. The base class instance is automatically intialized. However if you try to use the inherited field in the derived class it will be null.
The temporary workaround would be to explicitly declare a shared flow reference variable in the derived
Controller as well.
Control not being initialized when Inheriting from a parent page flow with a package protected control
When a page flow in another package inherits from a parent page flow that contains a package protected @Control member variable, the control is not initialized correctly. When the page flow call a method inherited from the parent and the method uses the package protected control, an NPE will be thrown as the control will not be initialized.
The work around is to make the control field protected rather than package protected.
To reproduce create a page flow with a package protected control. Include a method in the parent page flow that uses the control. Then, create a second page flow controller class in another package that extends the parent and calls the inherited method that hits the control. I will attach a zip file that will contain page flows to repro this issue. It can also be used to test the fix.
The problem seems to occur when JavaControlUtils.initJavaControls() is called and checks for the set of annotated control fields for the inherited page flow controller class. The routine, JavaControlUtils.getAccessibleControlFieldAnnotations() checks the fields of the page flow controller and its ancestors to see if they match any of the fields found in our generated annotation XML file. However, there will not be an &lt;annotated-element&gt; in the processed annotations file of the derived page flow for the package protected control in the parent page flow.
I'm not sure yet whether the NetUI annotation processor should generate this &lt;annotated-element&gt; or if the getAccessibleControlFieldAnnotations() method should be looking at the annotated fields of parent classes. We can look at this for v.next.
Compilation error for generated client initializer due to generated eventAdaptor not implementing methods in super intf of EventSet intf
Have the following control interface and extension definitions:
@ControlInterface interface BaseControl {
@EventSet interface BaseCallback {
void base_callback();
}
}
@ControlExtension interface DerivedControl {
@EventSet interface DerivedCallback extends BaseCallback {
void derived_callback();
}
}
Generated event adapter class in the client initializer using the DerivedControl:
public static class ControlClientDerivedControlEventAdaptor 
implements DerivedControl.DerivedCallback, 
EventAdaptor, java.io.Serializable
{
processes.parent2SBC _client;
public ControlClientDerivedControlEventAdaptor(processes.parent2SBC client) { _client = client; }
public Object getClient() { return _client; }
public void derived_callback() 
{
_client.derived_callback_clientResponse();
}
}
Get a compilation error for the client initalizer as the generated ControlClientDerivedControlEventAdaptor does not implement the callback super interface method base_callback.
Is there a workaround?
Thanks
Pradeep Bollineni
WSM produces improper WSDLs for RPC Style services which have operations that return arrays
WSM is not correctly setting the return type in AXIS OperationalDescs for RPC style services which have operations which return primitive array types.
To reproduce: 
Create a simple RPC web service which has the following operations:
public Integer[] echoInteger(Integer[] inputInteger);
public int[] echoInt(int[] inputInt) 
Request the wsdl from the web service, not the return types are not set correctly.
***************************
I have a patch for this which I will post in the next couple of days.
When a ComplexType is used within another ComplexType in a WSDL, the WSDL2Ws tool does not handle it correctly and does not produce a stub class for the inner type.
There are actually two related problems here, both produce the same sorts of problem. Here is an extract from a WSDL...
&lt;xs:element name=&quot;Arguments&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Argument&quot; maxOccurs=&quot;unbounded&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:attribute name=&quot;Name&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;xs:attribute name=&quot;Value&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
When the stubs are created, the inner class (Arguement) is not created and only Arguments is. This is also true for the following WSDL segment...
&lt;xs:element name=&quot;Request&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;IsValid&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;ItemSearchRequest&quot; type=&quot;tns:ItemSearchRequest&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element ref=&quot;tns:Errors&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;Errors&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Error&quot; maxOccurs=&quot;unbounded&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Code&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element name=&quot;Message&quot; type=&quot;xs:string&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
The only way to correct this problem was to 'unwind' all of the embedded types as follows:-
&lt;xs:complexType name=&quot;Argument&quot;&gt;
&lt;xs:attribute name=&quot;Name&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;xs:attribute name=&quot;Value&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;/xs:complexType&gt;
&lt;xs:complexType name=&quot;Arguments&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Argument&quot; type=&quot;tns:Argument&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
and
&lt;xs:complexType name=&quot;Request&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;IsValid&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;ItemSearchRequest&quot; type=&quot;tns:ItemSearchRequest&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;Errors&quot; type=&quot;tns:Errors&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;xs:complexType name=&quot;Error&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Code&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element name=&quot;Message&quot; type=&quot;xs:string&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;xs:complexType name=&quot;Errors&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Error&quot; type=&quot;tns:Error&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
'&gt;' symbol in front of type and some output parameters is not being removed by WSDL2Ws from type, prototypes/signatures or class defintion and the header filename as an unnecessary '_' prefix character.
The created client stub for the following WSDL is incorrect
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;definitions xmlns=&quot;http://schemas.xmlsoap.org/wsdl/&quot;
xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;
xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
xmlns:tns=&quot;http://webservices.com/CommerceService&quot;
targetNamespace=&quot;http://webservices.com/CommerceService&quot;&gt;
&lt;types&gt;
&lt;xs:schema targetNamespace=&quot;http://webservices.com/CommerceService&quot; 
xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; 
xmlns:tns=&quot;http://webservices.com/CommerceService&quot;
elementFormDefault=&quot;qualified&quot;&gt;
&lt;xs:element name=&quot;ItemSearch&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;SubscriptionId&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;AssociateTag&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;XMLEscaping&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;Validate&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;Shared&quot; type=&quot;tns:ItemSearchRequest&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;Request&quot; type=&quot;tns:ItemSearchRequest&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:complexType name=&quot;ItemSearchRequest&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Keywords&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;SearchIndex&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;xs:element name=&quot;ItemSearchResponse&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element ref=&quot;tns:OperationRequest&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element ref=&quot;tns:Items&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;OperationRequest&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element ref=&quot;tns:HTTPHeaders&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;RequestId&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element ref=&quot;tns:Arguments&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element ref=&quot;tns:Errors&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;RequestProcessingTime&quot; type=&quot;xs:float&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;1&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;Request&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;IsValid&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;ItemSearchRequest&quot; type=&quot;tns:ItemSearchRequest&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element ref=&quot;tns:Errors&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;Arguments&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Argument&quot; maxOccurs=&quot;unbounded&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:attribute name=&quot;Name&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;xs:attribute name=&quot;Value&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;HTTPHeaders&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Header&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:attribute name=&quot;Name&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;xs:attribute name=&quot;Value&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;Items&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element ref=&quot;tns:Request&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element ref=&quot;tns:CorrectedQuery&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;TotalResults&quot; type=&quot;xs:nonNegativeInteger&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;TotalPages&quot; type=&quot;xs:nonNegativeInteger&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element ref=&quot;tns:Item&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;CorrectedQuery&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Keywords&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;Message&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;Item&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;ASIN&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element ref=&quot;tns:Errors&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;DetailPageURL&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element ref=&quot;tns:ItemAttributes&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;ItemAttributes&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;Author&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;xs:element name=&quot;ProductGroup&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xs:element name=&quot;Title&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;/xs:schema&gt;
&lt;/types&gt;
&lt;message name=&quot;ItemSearchRequestMsg&quot;&gt;
&lt;part name=&quot;body&quot; element=&quot;tns:ItemSearch&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;ItemSearchResponseMsg&quot;&gt;
&lt;part name=&quot;body&quot; element=&quot;tns:ItemSearchResponse&quot;/&gt;
&lt;/message&gt;
&lt;portType name=&quot;CommerceServicePortType&quot;&gt;
&lt;operation name=&quot;ItemSearch&quot;&gt;
&lt;input message=&quot;tns:ItemSearchRequestMsg&quot;/&gt;
&lt;output message=&quot;tns:ItemSearchResponseMsg&quot;/&gt;
&lt;/operation&gt;
&lt;/portType&gt;
&lt;binding name=&quot;CommerceServiceBinding&quot; type=&quot;tns:CommerceServicePortType&quot;&gt;
&lt;soap:binding style=&quot;document&quot; transport=&quot;http://schemas.xmlsoap.org/soap/http&quot;/&gt;
&lt;operation name=&quot;ItemSearch&quot;&gt;
&lt;soap:operation soapAction=&quot;http://soap.com&quot;/&gt;
&lt;input&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/input&gt;
&lt;output&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/output&gt;
&lt;/operation&gt;
&lt;/binding&gt;
&lt;service name=&quot;CommerceService&quot;&gt;
&lt;port name=&quot;CommerceServicePort&quot; binding=&quot;tns:CommerceServiceBinding&quot;&gt;
&lt;soap:address location=&quot;http://soap.com/onca/soap?Service=CommerceService&quot;/&gt;
&lt;/port&gt;
&lt;/service&gt;
&lt;/definitions&gt;
Produces the following header files:-
--------------------------------------------------
_Items_Array.hpp
==============
/*
* Copyright 2003-2004 The Apache Software Foundation.
*/
#if !defined(___ITEMS_ARRAY_ARRAY_H__INCLUDED_)
#define ___ITEMS_ARRAY_ARRAY_H__INCLUDED_
class &gt;Items;
typedef struct _Items_ArrayTag
{
&gt;Items* m_Array;
int m_Size;
} _Items_Array;
#endif /* !defined(___ITEMS_ARRAY_ARRAY_H__INCLUDED_)*/
CommerceServicePortType.hpp
=========================
STORAGE_CLASS_INFO void ItemSearch(xsd__string Value0, xsd__string Value1, xsd__string Value2, xsd__string Value3, ItemSearchRequest* Value4, ItemSearchRequest_Array Value5, AXIS_OUT_PARAM &gt;OperationRequest* *OutValue0, AXIS_OUT_PARAM _Items_Array *OutValue1);
CommerceServicePortType.cpp
=========================
void AWSECommerceServicePortType::ItemSearch(xsd__string Value0, xsd__string Value1, xsd__string Value2, xsd__string Value3, ItemSearchRequest* Value4, ItemSearchRequest_Array Value5, AXIS_OUT_PARAM OperationRequest** OutValue0, AXIS_OUT_PARAM _Items_Array* OutValue1)
{
:
*OutValue0 = (&gt;OperationRequest*)m_pCall-&gt;getCmplxObject((void*) Axis_DeSerialize_&gt;OperationRequest, (void*) Axis_Create_&gt;OperationRequest, (void*) Axis_Delete_&gt;OperationRequest,&quot;OperationRequest&quot;, 0);
There are five or more problems with the generated files:-
1. The type 'Items' is prefixed with a '&gt;' character.
2. The class name should not be prefixed with a '&gt;' character (see _Items_Array.hpp).
3. The filename should not be prefixed with a '_' character.
4. Some of the output parameters are prefixed with a '&gt;' character (see CommerceServicePortType.hpp and CommerceServicePortType.cpp).
5. Also, in CommerceServicePortType.cpp, the name of the serialiser/deserialiser also has an embedded '&gt;' character.
When sandesha2 is added as a global module to axis2.xml client seg faults
When sandesha2 is added as a global module to axis2.xml client seg faults.
I found the reason for this is that the anonymous operation does not know
about the phases except default phases created when operation is created.
axis2_env_create_all function segfaults when log creation fails
axis2_env_create_all function is as follows.
AXIS2_EXTERN axis2_env_t * AXIS2_CALL axis2_env_create_all (const axis2_char_t *log_file,
const axis2_log_levels_t log_level)
{
axis2_env_t *env = NULL;
axis2_error_t *error = NULL;
axis2_log_t *log = NULL;
axis2_allocator_t *allocator = NULL;
axis2_thread_pool_t *thread_pool = NULL;
if (!log_file)
log_file = &quot;/dev/stderr&quot;;
allocator = axis2_allocator_init (NULL);
error = axis2_error_create(allocator);
log = axis2_log_create(allocator, NULL, log_file);
thread_pool = axis2_thread_pool_init(allocator);
env = axis2_env_create_with_error_log_thread_pool(allocator, error, log, thread_pool);
env-&gt;log-&gt;level = log_level;
axis2_error_init();
return env;
}
here if axis2_log_create failed, it leads to segmentation fault at 
env-&gt;log-&gt;level = log_level;
Dynamic client sample segfaults
The dynamic client sample segfaults, gdb tells me:
Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread -1208359232 (LWP 28182)]
0x08048b98 in main (argc=2, argv=0xbfdb9844) at calc_client.c:81
81 response = AXIS2_SVC_CLIENT_SEND_RECEIVE_WITH_OP_QNAME(svc_client, env,
(gdb) bt
#0 0x08048b98 in main (argc=2, argv=0xbfdb9844) at calc_client.c:81
Need resume_send function in axis2 engine
To resume the send operation, previousely paused we need resume_send() function in axis2 engine
Exposing the engine functionality to outside
Some modules (eg: Sandesha) need to call functions implemented in Axis2 engine. So we need to expose the functions of engine to the outside. Moving the corresponding header to the global include directory would do that.
Freeing of guththila stacks appears to free the last entry twice
Freeing of stacks is trying to free the last element twice - this fixes that.
GUTHTHILA_DECLARE (void)
guththila_stack_free_rec (guththila_environment_t * environment,
guththila_stack_t * stack,
guththila_element_t * elem)
{
if (elem-&gt;prev == NULL)
{
GUTHTHILA_FREE (environment-&gt;allocator, elem);
}
else
{
/*- elem = elem-&gt;prev;*/
/*- guththila_stack_free_rec (environment, stack, elem); */
/*+*/guththila_stack_free_rec (environment, stack, elem-&gt;prev);
GUTHTHILA_FREE (environment-&gt;allocator, elem);
}
}
GUTHTHILA_DECLARE (void)
guththila_stack_free (guththila_environment_t * environment,
guththila_stack_t * stack)
{
if (stack &amp;&amp; (stack-&gt;pointer &gt; 0))
{
guththila_element_t *ele = stack-&gt;tail;
guththila_stack_free_rec (environment, stack, ele);
/*- GUTHTHILA_FREE (environment-&gt;allocator, ele);*/
GUTHTHILA_FREE (environment-&gt;allocator, stack);
}
}
Buffer growth not working in guththila
I am not sure the current buffer growth in guththila is really growing the buffer. It appears to me
to be growing the structure containing the buffer, but leaving the buffer at its original size.
I also think the call to the growth routine may be reversing the new and old offsets such that the final
offset if negative. Here are patches which I think are necessary.
from guththila_xml_pull_parser.c...
GUTHTHILA_DECLARE (int)
guththila_xml_pull_parser_read (guththila_environment_t * environment,
guththila_xml_pull_parser_t * parser)
{
int c = 0;
if (parser-&gt;_next == parser-&gt;buffer-&gt;size)
{
if (parser-&gt;offset &gt; 0)
{
guththila_xml_pull_parser_relocate_tokens (environment, parser,
parser-&gt;offset);
guththila_xml_pull_parser_shift (environment, parser);
}
else
{
/*- guththila_buffer_t *b = NULL;
b = parser-&gt;buffer; */
/*+*/ int b = parser-&gt;buffer-&gt;size;
parser-&gt;buffer =
guththila_buffer_grow (environment, parser-&gt;buffer);
/*- guththila_xml_pull_parser_relocate_tokens (
environment, parser, (b-&gt;size - parser-&gt;buffer-&gt;size));*/
/*+*/guththila_xml_pull_parser_relocate_tokens (
/*+*/ environment, parser, (parser-&gt;buffer-&gt;size - b));
}
}
c = guththila_reader_read (environment, (parser-&gt;buffer-&gt;buff),
(parser-&gt;_next),
(parser-&gt;buffer-&gt;size) - (parser-&gt;_next),
parser-&gt;reader);
parser-&gt;last += c;
return !c;
}
from guththila_buffer.c...
GUTHTHILA_DECLARE (guththila_buffer_t *)
guththila_buffer_grow (guththila_environment_t * environment,
guththila_buffer_t * name)
{
/*+*/guththila_char_t *x = NULL;
/*- guththila_buffer_t *x = NULL; */
name-&gt;size &lt;&lt;= 1;
/*+*/x = (guththila_char_t *) GUTHTHILA_REALLOC (environment-&gt;allocator,
/*+*/ name-&gt;buff,name-&gt;size);
/*- x = (guththila_buffer_t *) GUTHTHILA_REALLOC (environment-&gt;allocator,
name, name-&gt;size); */
if (x)
/*- name = x;*/
/*+*/name-&gt;buff = x;
else
/*- return NULL;*/
/*+*/name-&gt;size &gt;&gt;= 1;
return name;
}
No method to get the charset encoding in xml document when using thr Guththila parser
There is no method in the Guththila parser wrapper to get the charset encoding.
IntegrationTest in saaj failing
Not sure if this is related to Eran's email:
http://mail-archives.apache.org/mod_mbox/ws-commons-dev/200607.mbox/%3c44C746F8.4020409@opensource.lk%3e
But the org.apache.axis2.saaj.integration.IntegrationTest is failing as it is sending a bad soap request:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
&lt;soapenv:Header&gt;
&lt;swa:TestHeader1 xmlns:swa=&quot;http://fakeNamespace.org&quot;/&gt;
&lt;swa:TestHeader2 xmlns:swa=&quot;http://fakeNamespace.org&quot;/&gt;
&lt;swa:TestHeader3 xmlns:swa=&quot;http://fakeNamespace.org&quot;&gt;
&lt;swa:he3 xmlns=&quot;http://fakeNamespace.org&quot; xmlns:swa=&quot;http://fakeNamespace.org&quot;&gt;Im Header Element of header3&lt;/swa:he3&gt;
&lt;/swa:TestHeader3&gt;
&lt;/soapenv:Header&gt;
&lt;soapenv:Body&gt;
&lt;swa:echo xmlns:swa=&quot;http://fakeNamespace.org&quot; xmlns=&quot;&quot;&gt;
&lt;internal xmlns=&quot;&quot; xmlns=&quot;&quot; xmlns=&quot;&quot; xmlns=&quot;&quot; xmlns=&quot;&quot; xmlns=&quot;&quot;&gt;
&lt;text xmlns=&quot;&quot; xmlns=&quot;&quot; href=&quot;cid:submitSampleText@apache.org&quot;/&gt;
&lt;image xmlns=&quot;&quot; xmlns=&quot;&quot; xmlns=&quot;&quot;&gt;
&lt;inner xmlns=&quot;&quot; xmlns=&quot;&quot; href=&quot;cid:submitSampleImage@apache.org&quot;/&gt;
&lt;/image&gt;
&lt;plaintxt xmlns=&quot;&quot; xmlns=&quot;&quot;&gt;This is simple plain text&lt;/plaintxt&gt;
&lt;nested xmlns=&quot;&quot; xmlns=&quot;&quot; xmlns=&quot;&quot;&gt;Nested1 Plain Text&lt;nested2 xmlns=&quot;&quot; xmlns=&quot;&quot;&gt;Nested2 Plain Text&lt;/nested2&gt;
&lt;/nested&gt;
&lt;/internal&gt;
&lt;/swa:echo&gt;
&lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
JAXWS: NPE in XMLSpineImpl when no header block exists
The init(SOAPEnvelope) method in XMLSpineImpl will throw an NPE if the SOAPEnvelope it is passed does not have a header block. That was not caught earlier because all of the tests have an empty header block like &quot;&lt;/soap:Header&gt;&quot;.
ADBXMLStreamReaderTest Failure....Appears to OM Related
I am getting the following error while using OM with the new WSCOMMONS-64 change applied.
junit.framework.AssertionFailedError: Exception in parsing documents org.xml.sax.SAXParseException: The prefix &amp;quot;axis2&amp;quot; for element &amp;quot;axis2:SecondOMElement&amp;quot; is not bound.
at org.apache.axis2.databinding.utils.reader.ADBXMLStreamReaderTest.testWithOMElements(ADBXMLStreamReaderTest.java:351)
After some investigation, I believe that the problem is in the woodstox XMLStreamWriter not propertly cleaning up the NamespaceContext after a writerEndElement. This is related to the interpretation of the scope of setPrefix calls. I am working on a fix in WSCOMMONS-66, but I wanted to raise this issue for tracking purposes.
Error duing oneWay request using JAXWS Dispatch.
There is a bug in JAXWSMessageReceiver when doing a InvokeOneWay on Dispatch with RM and Addressing enabled. Here's the stack trace for error message:
&lt;Exception&gt;org.apache.axis2.AxisFault: Invalid message addition , operation context completed&amp;#13;
at org.apache.axis2.description.InOnlyAxisOperation.addMessageContext(InOnlyAxisOperation.java:62)&amp;#13;
at org.apache.axis2.context.OperationContext.addMessageContext(OperationContext.java:85)&amp;#13;
at org.apache.axis2.jaxws.server.JAXWSMessageReceiver.receive(JAXWSMessageReceiver.java:64)&amp;#13;
at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:483)&amp;#13;
at org.apache.axis2.transport.http.HTTPTransportUtils.processHTTPPostRequest(HTTPTransportUtils.java:284)&amp;#13;
at com.ibm.ws.websvcs.transport.http.WASAxis2Servlet.doPost(WASAxis2Servlet.java:183)&amp;#13;
at javax.servlet.http.HttpServlet.service(HttpServlet.java:763)&amp;#13;
at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)&amp;#13;
at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:966)&amp;#13;
at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:478)&amp;#13;
at com.ibm.ws.wswebcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:463)&amp;#13;
at com.ibm.ws.webcontainer.servlet.CacheServletWrapper.handleRequest(CacheServletWrapper.java:92)&amp;#13;
at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:744)&amp;#13;
at com.ibm.ws.wswebcontainer.WebContainer.handleRequest(WebContainer.java:1425)&amp;#13;
at com.ibm.ws.webcontainer.channel.WCChannelLink.ready(WCChannelLink.java:92)&amp;#13;
at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:465)&amp;#13;
at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleNewInformation(HttpInboundLink.java:394)&amp;#13;
at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.ready(HttpInboundLink.java:274)&amp;#13;
at com.ibm.ws.tcp.channel.impl.NewConnectionInitialReadCallback.sendToDiscriminators(NewConnectionInitialReadCallback.java:214)&amp;#13;
at com.ibm.ws.tcp.channel.impl.NewConnectionInitialReadCallback.complete(NewConnectionInitialReadCallback.java:113)&amp;#13;
at com.ibm.ws.tcp.channel.impl.AioReadCompletionListener.futureCompleted(AioReadCompletionListener.java:152)&amp;#13;
at com.ibm.io.async.AbstractAsyncFuture.invokeCallback(AbstractAsyncFuture.java:213)&amp;#13;
at com.ibm.io.async.AbstractAsyncFuture.fireCompletionActions(AbstractAsyncFuture.java:195)&amp;#13;
at com.ibm.io.async.AsyncFuture.completed(AsyncFuture.java:136)&amp;#13;
at com.ibm.io.async.ResultHandler.complete(ResultHandler.java:193)&amp;#13;
at com.ibm.io.async.ResultHandler.runEventProcessingLoop(ResultHandler.java:725)&amp;#13;
at com.ibm.io.async.ResultHandler$2.run(ResultHandler.java:847)&amp;#13;
at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1498)&amp;#13;
JAXWS: Error when serializing a Message containing a JAXBBlock
I've created a couple of JAX-B tests for the MessageTests suite. The inflow test (creating a message with a JAXBBlock) works fine, but there's a problem with the outflow. When trying to serialize the message in the outflow case, the following error is thrown:
&lt;error message=&quot;Unbound namespace URI &amp;apos;http://test&amp;apos;&quot; type=&quot;javax.xml.stream.XMLStreamException&quot;&gt;javax.xml.stream.XMLStreamException: Unbound namespace URI &amp;apos;http://test&amp;apos;
at com.ctc.wstx.sw.SimpleNsStreamWriter.writeStartOrEmpty(SimpleNsStreamWriter.java:240)
at com.ctc.wstx.sw.BaseNsStreamWriter.writeStartElement(BaseNsStreamWriter.java:273)
at org.apache.axiom.om.impl.MTOMXMLStreamWriter.writeStartElement(MTOMXMLStreamWriter.java:87)
at org.apache.axiom.om.impl.serialize.StreamingOMSerializer.serializeElement(StreamingOMSerializer.java:123)
at org.apache.axiom.om.impl.serialize.StreamingOMSerializer.serializeNode(StreamingOMSerializer.java:73)
at org.apache.axiom.om.impl.serialize.StreamingOMSerializer.serialize(StreamingOMSerializer.java:56)
at org.apache.axiom.om.impl.util.OMSerializerUtil.serializeByPullStream(OMSerializerUtil.java:325)
at org.apache.axiom.om.impl.llom.OMElementImpl.internalSerialize(OMElementImpl.java:792)
at org.apache.axiom.soap.impl.llom.SOAPEnvelopeImpl.internalSerialize(SOAPEnvelopeImpl.java:177)
at org.apache.axiom.om.impl.llom.OMElementImpl.internalSerializeAndConsume(OMElementImpl.java:811)
at org.apache.axiom.om.impl.llom.OMNodeImpl.serializeAndConsume(OMNodeImpl.java:378)
at org.apache.axis2.jaxws.message.MessageTests.testJAXBOutflow(MessageTests.java:304)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)
at junit.extensions.TestSetup$1.protect(TestSetup.java:19)
at junit.extensions.TestSetup.run(TestSetup.java:23)
&lt;/error&gt;
I'll dig in here and see what else I can find.
JAXWS: Unable to serialize DOMSource blocks
I've added some tests for additional datatypes to the BlockTests. I added one for SAXSource, which works fine, and one for DOMSource which fails. The failure occurs when we try to simulate how the Message object will get at the Block content. The failure looks like this:
&lt;error message=&quot;java.lang.IllegalArgumentException: local part cannot be &amp;quot;null&amp;quot; when creating a QName&quot; type=&quot;org.apache.axiom.om.OMException&quot;&gt;org.apache.axiom.om.OMException: java.lang.IllegalArgumentException: local part cannot be &amp;quot;null&amp;quot; when creating a QName
at org.apache.axiom.om.impl.builder.StAXOMBuilder.next(StAXOMBuilder.java:206)
at org.apache.axiom.om.impl.llom.OMDocumentImpl.buildNext(OMDocumentImpl.java:183)
at org.apache.axiom.om.impl.llom.OMDocumentImpl.getFirstOMChild(OMDocumentImpl.java:255)
at org.apache.axiom.om.impl.llom.OMDocumentImpl.getChildren(OMDocumentImpl.java:231)
at org.apache.axis2.jaxws.message.util.Reader2Writer.outputTo(Reader2Writer.java:58)
at org.apache.axis2.jaxws.message.util.Reader2Writer.getAsString(Reader2Writer.java:74)
at org.apache.axis2.jaxws.message.BlockTests.testDOMSourceOutflow(BlockTests.java:938)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)
at junit.extensions.TestSetup$1.protect(TestSetup.java:19)
at junit.extensions.TestSetup.run(TestSetup.java:23)
Caused by: java.lang.IllegalArgumentException: local part cannot be &amp;quot;null&amp;quot; when creating a QName
at javax.xml.namespace.QName.&amp;lt;init&amp;gt;(Unknown Source)
at com.ctc.wstx.dom.DOMWrappingReader.constructQName(DOMWrappingReader.java:1284)
at com.ctc.wstx.dom.DOMWrappingReader.getName(DOMWrappingReader.java:460)
at org.apache.axiom.om.impl.builder.StAXOMBuilder.next(StAXOMBuilder.java:130)
... 27 more
&lt;/error&gt;
WSDL2Java STILL uses XmlObject for skeleton parameter when data in XML schema in same namespace as WSDL document
The bug reported by AXIS2-844 (which is marked as closed, fixed) still does not appear to be fixed.
With reference to the previous bug report's method for reproducing, my new WSDL is as follows:
&lt;definitions name=&quot;FDefinitions&quot;
targetNamespace=&quot;http://www.c.com/wsdl/2004-10-01/F&quot;
xmlns:tns=&quot;http://www.c.com/wsdl/2004-10-01/F&quot;
xmlns:c=&quot;http://www.c.com/wsdl/2004-10-01/c&quot;
xmlns:F=&quot;http://www.dummy-temp-address&quot;
xmlns:wsdl=&quot;http://schemas.xmlsoap.org/wsdl/&quot;
xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;
xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
xmlns=&quot;http://schemas.xmlsoap.org/wsdl/&quot;&gt;
&lt;types&gt;
&lt;xs:schema&gt;
&lt;xs:import namespace=&quot;http://www.dummy-temp-address&quot; schemaLocation=&quot;F.xsd&quot;/&gt;
&lt;/xs:schema&gt;
&lt;xs:schema targetNamespace=&quot;http://www.c.com/wsdl/2004-10-01/F&quot;&gt;
&lt;xs:element name=&quot;return&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element name=&quot;failure&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element name=&quot;recap&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;full-event-update&quot; type=&quot;F:FullEventUpdate&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;xs:attribute name=&quot;source&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;/xs:schema&gt;
&lt;xs:schema targetNamespace=&quot;http://www.c.com/wsdl/2004-10-01/c&quot;&gt;
&lt;xs:element name=&quot;CPassword&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element name=&quot;CLogin&quot; type=&quot;xs:string&quot;/&gt;
&lt;/xs:schema&gt;
&lt;/types&gt;
&lt;message name=&quot;FEvent&quot;&gt;
&lt;part name=&quot;contents&quot; element=&quot;F:full-event-update&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;FRecap&quot;&gt;
&lt;part name=&quot;contents&quot; element=&quot;tns:recap&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;FResponse&quot;&gt;
&lt;part name=&quot;return&quot; element=&quot;tns:return&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;CPassword&quot;&gt;
&lt;part name=&quot;CPassword&quot; element=&quot;c:CPassword&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;CLogin&quot;&gt;
&lt;part name=&quot;CLogin&quot; element=&quot;c:CLogin&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;Failure&quot;&gt;
&lt;part name=&quot;faultDetail&quot; element=&quot;c:failure&quot;/&gt;
&lt;/message&gt;
&lt;portType name=&quot;FPortType&quot;&gt;
&lt;documentation&gt;F Port Type&lt;/documentation&gt;
&lt;operation name=&quot;acceptFEvent&quot; parameterOrder=&quot;contents&quot;&gt;
&lt;input name=&quot;acceptFEventRequest&quot; message=&quot;tns:FEvent&quot;/&gt;
&lt;output name=&quot;acceptFEventResponse&quot; message=&quot;tns:FResponse&quot;/&gt;
&lt;fault name=&quot;Failure&quot; message=&quot;tns:Failure&quot;/&gt;
&lt;/operation&gt;
&lt;operation name=&quot;acceptFRecap&quot; parameterOrder=&quot;contents&quot;&gt;
&lt;input name=&quot;acceptFRecapRequest&quot; message=&quot;tns:FRecap&quot;/&gt;
&lt;output name=&quot;acceptFRecapResponse&quot; message=&quot;tns:FResponse&quot;/&gt;
&lt;fault name=&quot;Failure&quot; message=&quot;tns:Failure&quot;/&gt;
&lt;/operation&gt;
&lt;/portType&gt;
&lt;binding name=&quot;FSoapBinding&quot; type=&quot;tns:FPortType&quot;&gt;
&lt;documentation&gt;F Soap Binding&lt;/documentation&gt;
&lt;soap:binding style=&quot;document&quot; transport=&quot;http://schemas.xmlsoap.org/soap/http&quot;/&gt;
&lt;operation name=&quot;acceptFEvent&quot;&gt;
&lt;soap:operation soapAction=&quot;acceptFEventAction&quot;/&gt;
&lt;input&gt;
&lt;soap:header message=&quot;tns:CLogin&quot; part=&quot;CLogin&quot; use=&quot;literal&quot;/&gt;
&lt;soap:header message=&quot;tns:CPassword&quot; part=&quot;CPassword&quot; use=&quot;literal&quot;/&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/input&gt;
&lt;output&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/output&gt;
&lt;fault name=&quot;Failure&quot;&gt;
&lt;soap:fault name=&quot;Failure&quot; use=&quot;literal&quot;/&gt;
&lt;/fault&gt;
&lt;/operation&gt;
&lt;operation name=&quot;acceptFRecap&quot;&gt;
&lt;soap:operation soapAction=&quot;acceptFRecapAction&quot;/&gt;
&lt;input&gt;
&lt;soap:header message=&quot;tns:CLogin&quot; part=&quot;CLogin&quot; use=&quot;literal&quot;/&gt;
&lt;soap:header message=&quot;tns:CPassword&quot; part=&quot;CPassword&quot; use=&quot;literal&quot;/&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/input&gt;
&lt;output&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/output&gt;
&lt;fault name=&quot;Failure&quot;&gt;
&lt;soap:fault name=&quot;Failure&quot; use=&quot;literal&quot;/&gt;
&lt;/fault&gt;
&lt;/operation&gt;
&lt;/binding&gt;
&lt;service name=&quot;FService&quot;&gt;
&lt;documentation&gt;F Web Service&lt;/documentation&gt;
&lt;port name=&quot;FPort&quot; binding=&quot;tns:FSoapBinding&quot;&gt;
&lt;soap:address location=&quot;http://localhost:8080/axis/services/FService&quot;/&gt;
&lt;/port&gt;
&lt;/service&gt;
&lt;/definitions&gt;
And the generated skeleton interface is:
/**
* FServiceSkeletonInterface.java
*
* This file was auto-generated from WSDL
* by the Apache Axis2 version: SNAPSHOT Jul 17, 2006 (11:21:27 GMT+00:00)
*/
package crc.fimport.wsdl2java;
/**
* FServiceSkeletonInterface java skeleton interface for the axisService
*/
public interface FServiceSkeletonInterface {
/**
* Auto generated method signature
* @param param0
*/
public org.apache.xmlbeans.XmlObject acceptFRecap
(
org.apache.xmlbeans.XmlObject param0 
)
throws crc.fimport.wsdl2java.FServiceSkeleton.FailureException;
/**
* Auto generated method signature
* @param param4
*/
public org.apache.xmlbeans.XmlObject acceptFEvent
(
crc.fimport.xmlbeans.f.FullEventUpdateDocument param4 
)
throws crc.fimport.wsdl2java.FServiceSkeleton.FailureException;
}
which still has XmlObject parameters in places where it should have real types as declared in the WSDL.
As noted in the prior bug report, this bug is a major showstopper for my company, and any progress towards fixing it would be very much appreciated.
Client must have a method to set custom HTTP Headers using the client API
Axis2 users must have a way to set custom HTTP Headers through the client api. But I believe these should not be intercepted with the headers Axis2 sets to the messages.
JAX-WS Wrapper Tests are not using generated JAX-B artifacts
I will be checking in the xsd files and corrected tests in a few minutes. 
We should not have any checked in JAX-B artifacts in the test source. All JAX-B artifacts should be generated by xjc.
Scheu
Need to update the JAX-WS tests so that generated JAXB classes are not being checked-in but generated at build time instead.
Need to update the JAX-WS tests so that generated JAXB classes are not being checked-in but generated at build time instead.
The value of the SOAPAction HTTP header field must be a quoted string
According to the WS-I Basic Profile version 1.1, the value of the SOAPAction HTTP header field must be a quoted string. Axis2 is not setting this correctly, i.e. we currently get:
SOAPAction: foo
instead of
SOAPAction: &quot;foo&quot;
The only time that quotes do appear in the SOAPAction is when it has the empty value, &quot;&quot;. This appears as,
SOAPAction: &quot;&quot;
JAXWS: Minor tweaks to XMLSpineImpl and BlockFactoryImpl needed
In the process of testing some other functionality, I came across a couple of minor issues that needed to be addressed in the XMLSpineImpl and BlockFactoryImpl.
XMLSpineImpl.getHeaderBlock()
XMLSpineImpl.getBodyBlock()
Minor change to the impl of these methods so that they are honoring the BlockFactory.createFrom() contract and passing in the context instead of another BlockFactory.
BlockFactoryImpl.createFrom(Block other, Object context)
Added more checks for null since there is no guarantee that either the business context that was passed in or the business context that exists on the &quot;other&quot; Block is not null.
Axis Client not threadsafe when signing/timestamp enabled
Starts simulations threads invoking a service that requires signing/timestamp (Client code generate with xmlbeans binding)
Creates ConfigurationContext and stub as static variables in a synchronized block used by both threads
Received the following stacktraces (depending on the order of the threads that starts)
org.w3c.dom.DOMException: WRONG_DOCUMENT_ERR: A node is used in a different document than the one that created it.
at org.apache.axiom.om.impl.dom.ParentNode.insertBefore(ParentNode.java:160)
at org.apache.ws.security.util.WSSecurityUtil.prependChildElement(WSSecurityUtil.java:588)
at org.apache.ws.security.message.WSSecSignature.prependToHeader(WSSecSignature.java:561)
at org.apache.ws.security.message.WSSecSignature.build(WSSecSignature.java:658)
at org.apache.ws.security.action.SignatureAction.execute(SignatureAction.java:54)
at org.apache.ws.security.handler.WSHandler.doSenderAction(WSHandler.java:191)
at org.apache.axis2.security.WSDoAllSender.processMessage(WSDoAllSender.java:181)
at org.apache.axis2.security.handler.WSDoAllHandler.invoke(WSDoAllHandler.java:82)
at org.apache.axis2.engine.Phase.invoke(Phase.java:381)
at org.apache.axis2.engine.AxisEngine.invoke(AxisEngine.java:473)
at org.apache.axis2.engine.AxisEngine.send(AxisEngine.java:572)
at org.apache.axis2.description.OutInAxisOperationClient.send(OutInAxisOperation.java:328)
at org.apache.axis2.description.OutInAxisOperationClient.execute(OutInAxisOperation.java:279)
or 
java.lang.NullPointerException
at org.apache.axis2.security.WSDoAllSender.processMessage(WSDoAllSender.java:197)
at org.apache.axis2.security.handler.WSDoAllHandler.invoke(WSDoAllHandler.java:82)
at org.apache.axis2.engine.Phase.invoke(Phase.java:381)
at org.apache.axis2.engine.AxisEngine.invoke(AxisEngine.java:473)
at org.apache.axis2.engine.AxisEngine.send(AxisEngine.java:572)
at org.apache.axis2.description.OutInAxisOperationClient.send(OutInAxisOperation.java:328)
at org.apache.axis2.description.OutInAxisOperationClient.execute(OutInAxisOperation.java:279)
Changing the requirements for Security, that is, no signing or timestamp at the service and consumer side, makes my client handles threads perfectly.
javax.xml.ws.WebServiceRefs class needed for jaxws
An annotation class named javax.xml.ws.WebServiceRefs is missing in the jaxws source.
Stub has checks for &quot;rpc&quot; and &quot;document&quot;
Here's the snippet from Stub.java:
protected OMElement getElement(SOAPEnvelope env, String type) {
SOAPBody body = env.getBody();
OMElement element = body.getFirstElement();
if (WSDLConstants.STYLE_RPC.equals(type)) {
return element.getFirstElement(); // todo this needs to be fixed
} else if (WSDLConstants.STYLE_DOC.equals(type)) {
return element;
} else {
throw new UnsupportedOperationException(Messages
.getMessage(&quot;unsupportedType&quot;));
}
}
Do we need this? The previous bug AXIS2-843 was caused by this piece of code.
NullPointerException in OutInAxisOperationClient
I'm trying to send a message from a web service A to a web service B, but I get this exception:
ERROR
ncl.qosp.controller.scheduler.weighted.WeightedAvgRespTimeServiceHandler
- java.lang.NullPointerException
at
org.apache.axis2.description.OutInAxisOperationClient.execute(OutInAxisOperation.java:260)
at org.apache.axis2.client.ServiceClient.sendRobust(ServiceClient.java:350)
at org.apache.axis2.client.ServiceClient.sendRobust(ServiceClient.java:330)
at
ncl.qosp.controller.scheduler.weighted.WeightedAvgRespTimeServiceHandler.client(WeightedAvgRespTimeServiceHandler.java:609)
at
ncl.qosp.controller.scheduler.weighted.WeightedAvgRespTimeServiceHandler.send(WeightedAvgRespTimeServiceHandler.java:560)
at
ncl.qosp.controller.scheduler.weighted.WeightedAvgRespTimeServiceHandler.addResource(WeightedAvgRespTimeServiceHandler.java:333)
at
ncl.qosp.controller.scheduler.weighted.WeightedAvgRespTimeScheduler.requireResources(WeightedAvgRespTimeScheduler.java:296)
at
ncl.qosp.controller.scheduler.weighted.WeightedAvgRespTimeServiceHandler.setOptimalValue(WeightedAvgRespTimeServiceHandler.java:284)
at
ncl.qosp.controller.scheduler.weighted.WeightedAvgRespTimeScheduler$ReminderTask.reallocateResources(WeightedAvgRespTimeScheduler.java:549)
at
ncl.qosp.controller.scheduler.weighted.WeightedAvgRespTimeScheduler$ReminderTask.run(WeightedAvgRespTimeScheduler.java:519)
at java.util.TimerThread.mainLoop(Timer.java:512)
at java.util.TimerThread.run(Timer.java:462)
The chunk of code generating the above exception is:
EndpointReference targetEPR = new EndpointReference(target);
Options options = new Options();
options.setTo(targetEPR);
options.setAction(&quot;urn:echo&quot;);
options.setTransportInProtocol(Constants.TRANSPORT_HTTP);
options.setUseSeparateListener(true);
ServiceClient sender = new ServiceClient();
sender.engageModule(new QName(Constants.MODULE_ADDRESSING));
sender.setOptions(options);
try {
sender.sendRobust(r.request);
} catch (Exception e) {
StringWriter sw = new StringWriter();
PrintWriter pw = new PrintWriter(sw);
e.printStackTrace(pw);
log.error(sw.getBuffer().toString());
pw.close();
}
Please note that this code works if a sendReceiveNonBlocking() call is
used instead of sendRobust().
axiom-dom.jar is not included in the war distribution
axiom-dom.jar is not included in the war distribution. It should be in /WEB-INF/lib but it's not there. Making rampart fails with a NoClassDefFoundError.
WSDL2Java fails to detect nonexistent element referenced by wsdl:message
I recently noticed that the Axis2 WSDL2Java program, when generating XmlBeans, seems to accept WSDL which contains references to nonexistent elements. For instance:
&lt;types&gt;
&lt;xs:schema&gt;
&lt;xs:import namespace=&quot;http://www.dummy-im-address&quot;
schemaLocation=&quot;im.xsd&quot;/&gt;
&lt;/xs:schema&gt;
&lt;/types&gt;
&lt;message name=&quot;IEEE1512Event&quot;&gt;
&lt;part name=&quot;iMWrapper&quot; element=&quot;im:thisDoesNotExist&quot;/&gt;
&lt;/message&gt;
The element &quot;thisDoesNotExist&quot; is not defined anywhere in the im.xsd schema file, yet WSDL2Java reports no warnings or errors when asked to generate code for a service using this WSDL file. The server skeleton that is generated takes a parameter of type XmlObject where the thisDoesNotExist element would be passed. Considering that this can easily happen due to a simple typo in an element name, this seems like a very difficult problem to track down.
It seems to me that an error, or at least a warning, should be reported for cases like this.
WSDL2Java uses XmlObject for skeleton parameter when data in XML schema in same namespace as WSDL document
I have discovered that the Axis WSDL2Java code generator produces incorrect results under the following circumstances:
1) The WSDL document declares a target namespace.
2) The 'types' section of the document imports a schema with the same namespace.
3) A 'message' is declared to use an element of a type declared within the schema.
4) An operation is declared to use the message as an input or output parameter.
When the above scenario occurs, the WSDL2Java code generator acts as if the elements declared in the schema do not exist and apparently goes to its fallback method of treating the data as if it were declared 'xs:any'. Note that schemas that do not share the same namespace with the WSDL document seem to work fine.
Using the WSDL and schema below, and the given WSDL2Java command line, I get XMLBeans classes generated. However, the generated skeleton methods take parameters of type OMElement and return a result of type OMElement (with the Axis 1.0 release. With the current nightly build they use type XmlObject instead), instead of using generated XMLBeans wrapper classes that are specific to the WSDL file being parsed.
According to various documentation I have read, there should be no problem with this. The same namespace should be perfectly legal to use both for the WSDL document itself and for XML elements and types declared within it. (Note, however, that the WSDL document messages, bindings, and so forth should occupy a different symbol space from the XML elements and types in the same namespace, so that one could have, for instance, both a message named &quot;foo&quot; as well as an xs:element named &quot;foo&quot; without conflict.)
This is a big problem for me, since sharing the same namespace for both of these elements is done both by several WSDL files within my own company, as well as those that have been given to my company to use from external sources. I MIGHT be able to change the WSDL produced by my company, but can't do much about the ones that we have been given from outside. This essentially makes WSDL2Java unusable for me until this issue is fixed.
A bit more information can be found in the developer list under the thread &quot;[Axis2] Why do I get service skeletons taking OMElement, and uncompilable code?&quot;.
Here is an example of WSDL that reproduces the problem:
The WSDL:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;definitions name=&quot;FDefinitions&quot;
targetNamespace=&quot;http://www.example.com/wsdl/2004-10-01/feu&quot;
xmlns:carshdr=&quot;http://www.example.com/wsdl/2004-10-01/cars&quot;
xmlns:carsfault=&quot;http://www.example.com/wsdl/2006-06-13/carsfault&quot;
xmlns:wsdl=&quot;http://schemas.xmlsoap.org/wsdl/&quot;
xmlns:tns=&quot;http://www.example.com/wsdl/2004-10-01/feu&quot;
xmlns:feu=&quot;http://www.dummy-temp-address&quot;
xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;
xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
xmlns:soapenc=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;
xmlns=&quot;http://schemas.xmlsoap.org/wsdl/&quot;&gt;
&lt;wsdl:types&gt;
&lt;xs:schema&gt;
&lt;xs:import namespace=&quot;http://www.dummy-temp-address&quot;
schemaLocation=&quot;FEU.xsd&quot;/&gt;
&lt;/xs:schema&gt;
&lt;xs:schema targetNamespace=&quot;http://www.example.com/wsdl/2004-10-01/feu&quot;&gt;
&lt;xs:element name=&quot;full-event-updates&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;full-event-update&quot; type=&quot;feu:FullEventUpdate&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
&lt;xs:element name=&quot;full-event-update&quot; type=&quot;feu:FullEventUpdate&quot;/&gt;
&lt;xs:element name=&quot;return&quot; type=&quot;xs:string&quot;/&gt;
&lt;/xs:schema&gt;
&lt;xs:schema targetNamespace=&quot;http://www.example.com/wsdl/2004-10-01/cars&quot;&gt;
&lt;xs:element name=&quot;CPassword&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element name=&quot;CLogin&quot; type=&quot;xs:string&quot;/&gt;
&lt;/xs:schema&gt;
&lt;xs:schema targetNamespace=&quot;http://www.example.com/wsdl/2006-06-13/carsfault&quot;&gt;
&lt;xs:element name=&quot;generalFault&quot; type=&quot;xs:string&quot;/&gt;
&lt;/xs:schema&gt;
&lt;/wsdl:types&gt;
&lt;message name=&quot;FEvent&quot;&gt;
&lt;part name=&quot;contents&quot; element=&quot;tns:full-event-update&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;FRecap&quot;&gt;
&lt;part name=&quot;contents&quot; element=&quot;tns:full-event-updates&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;FResponse&quot;&gt;
&lt;part name=&quot;return&quot; element=&quot;tns:return&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;CPassword&quot;&gt;
&lt;part name=&quot;CPassword&quot; element=&quot;carshdr:CPassword&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;CLogin&quot;&gt;
&lt;part name=&quot;CLogin&quot; element=&quot;carshdr:CLogin&quot;/&gt;
&lt;/message&gt;
&lt;message name=&quot;GeneralFault&quot;&gt;
&lt;part name=&quot;faultDetail&quot; element=&quot;carsfault:generalFault&quot;/&gt;
&lt;/message&gt;
&lt;portType name=&quot;FPortType&quot;&gt;
&lt;documentation&gt;F Port Type&lt;/documentation&gt;
&lt;operation name=&quot;acceptFEvent&quot; parameterOrder=&quot;contents&quot;&gt;
&lt;input name=&quot;acceptFEventRequest&quot; message=&quot;tns:FEvent&quot;/&gt;
&lt;output name=&quot;acceptFEventResponse&quot; message=&quot;tns:FResponse&quot;/&gt;
&lt;fault name=&quot;GeneralFault&quot; message=&quot;tns:GeneralFault&quot;/&gt;
&lt;/operation&gt;
&lt;operation name=&quot;acceptFRecap&quot; parameterOrder=&quot;contents&quot;&gt;
&lt;input name=&quot;acceptFRecapRequest&quot; message=&quot;tns:FRecap&quot;/&gt;
&lt;output name=&quot;acceptFRecapResponse&quot; message=&quot;tns:FResponse&quot;/&gt;
&lt;fault name=&quot;GeneralFault&quot; message=&quot;tns:GeneralFault&quot;/&gt;
&lt;/operation&gt;
&lt;/portType&gt;
&lt;binding name=&quot;FSoapBinding&quot; type=&quot;tns:FPortType&quot;&gt;
&lt;documentation&gt;F Soap Binding&lt;/documentation&gt;
&lt;soap:binding style=&quot;document&quot; transport=&quot;http://schemas.xmlsoap.org/soap/http&quot;/&gt;
&lt;operation name=&quot;acceptFEvent&quot;&gt;
&lt;soap:operation soapAction=&quot;acceptFEventAction&quot;/&gt;
&lt;input&gt;
&lt;soap:header message=&quot;tns:CLogin&quot; part=&quot;CLogin&quot; use=&quot;literal&quot;/&gt;
&lt;soap:header message=&quot;tns:CPassword&quot; part=&quot;CPassword&quot; use=&quot;literal&quot;/&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/input&gt;
&lt;output&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/output&gt;
&lt;fault name=&quot;GeneralFault&quot;&gt;
&lt;soap:fault name=&quot;GeneralFault&quot; use=&quot;literal&quot;/&gt;
&lt;/fault&gt;
&lt;/operation&gt;
&lt;operation name=&quot;acceptFRecap&quot;&gt;
&lt;soap:operation soapAction=&quot;acceptFRecapAction&quot;/&gt;
&lt;input&gt;
&lt;soap:header message=&quot;tns:CLogin&quot; part=&quot;CLogin&quot; use=&quot;literal&quot;/&gt;
&lt;soap:header message=&quot;tns:CPassword&quot; part=&quot;CPassword&quot; use=&quot;literal&quot;/&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/input&gt;
&lt;output&gt;
&lt;soap:body use=&quot;literal&quot;/&gt;
&lt;/output&gt;
&lt;fault name=&quot;GeneralFault&quot;&gt;
&lt;soap:fault name=&quot;GeneralFault&quot; use=&quot;literal&quot;/&gt;
&lt;/fault&gt;
&lt;/operation&gt;
&lt;/binding&gt;
&lt;service name=&quot;FService&quot;&gt;
&lt;documentation&gt;F Web Service&lt;/documentation&gt;
&lt;port name=&quot;FPort&quot; binding=&quot;tns:FSoapBinding&quot;&gt;
&lt;soap:address location=&quot;http://localhost:8080/axis/services/FService&quot;/&gt;
&lt;/port&gt;
&lt;/service&gt;
&lt;/definitions&gt;
The schema:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xs:schema targetNamespace=&quot;http://www.dummy-temp-address&quot;
xmlns=&quot;http://www.dummy-temp-address&quot;
xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
xmlns:cars=&quot;http://www.crc-corp.com/schemas/cars/schema_annotation&quot;
elementFormDefault=&quot;unqualified&quot;
attributeFormDefault=&quot;unqualified&quot;
version=&quot;DRAFT&quot;&gt;
&lt;xs:element name=&quot;full-event-update&quot; type=&quot;FullEventUpdate&quot;/&gt;
&lt;xs:complexType name=&quot;FullEventUpdate&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;message-header&quot; type=&quot;MessageHeader&quot;/&gt;
&lt;xs:element name=&quot;event-reference&quot; type=&quot;EventReference&quot;/&gt;
&lt;xs:any/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;xs:complexType name=&quot;MessageHeader&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:any/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;xs:complexType name=&quot;EventReference&quot;&gt;
&lt;xs:sequence&gt;
&lt;xs:element name=&quot;event-id&quot; type=&quot;xs:string&quot;/&gt;
&lt;xs:element name=&quot;update&quot; type=&quot;xs:unsignedInt&quot;/&gt;
&lt;xs:element name=&quot;response-plan-id&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
The WSDL command line:
WSDL2Java --databinding-method xmlbeans 
--uri FEUImport.wsdl 
--server-side 
--generate-all 
--service-description 
--output generatedSrc 
--package crc.feuimport.wsdl2java 
The skeleton interface that is getting generated:
/**
* FEUServiceSkeletonInterface.java
*
* This file was auto-generated from WSDL
* by the Apache Axis2 version: 1.0 May 05, 2006 (12:31:13 IST)
*/
package crc.feuimport.wsdl2java;
/**
* FServiceSkeletonInterface java skeleton interface for the axisService
*/
public interface FServiceSkeletonInterface {
/**
* Auto generated method signature
* @param param0
*/
public org.apache.axiom.om.OMElement acceptFEURecap
(org.apache.axiom.om.OMElement param0 )
throws crc.feuimport.wsdl2java.FServiceSkeleton.GeneralFaultException;
/**
* Auto generated method signature
* @param param4
*/
public org.apache.axiom.om.OMElement acceptFEUEvent
(org.apache.axiom.om.OMElement param4 )
throws crc.feuimport.wsdl2java.FServiceSkeleton.GeneralFaultException;
}
Java2WSDL should generate a WSDL interface that accepts an empty SOAP Body
Java code:
public class TestAxis {
public String getDate(){
return new java.util.Date().toString();
}
}
Quote from Anne at http://marc.theaimsgroup.com/?l=axis-user&amp;m=115089935000189&amp;w=2:
Java2WSDL should generate a WSDL interface that accepts an empty SOAP Body. e.g.,
&lt;wsdl:message name=&quot;getDateMessage&quot;/&gt;
But based on a bunch of recent messages I've seen, Axis2 barfs on an empty SOAP Body. This is a bug that needs to be fixed. I don't know if anyone has created a JIRA for it.
WSDL service builder fails to see service definition when it comes from an import
When the service element of a WSDL is not in the first level file, there is an exception like this:
[java] Exception in thread &quot;main&quot; org.apache.axis2.wsdl.codegen.CodeGenerationException: Error parsing WSDL
[java] at org.apache.axis2.wsdl.codegen.CodeGenerationEngine.&lt;init&gt;(CodeGenerationEngine.java:94)
[java] at org.apache.axis2.wsdl.WSDL2Code.main(WSDL2Code.java:32)
[java] at org.apache.axis2.wsdl.WSDL2Java.main(WSDL2Java.java:21)
[java] Caused by: org.apache.axis2.AxisFault: No service element found in the WSDL; nested exception is:
[java] org.apache.axis2.AxisFault: No service element found in the WSDL
[java] at org.apache.axis2.description.WSDL2AxisServiceBuilder.populateService(WSDL2AxisServiceBuilder.java:243)
[java] at org.apache.axis2.wsdl.codegen.CodeGenerationEngine.&lt;init&gt;(CodeGenerationEngine.java:87)
I am pretty sure the spec allows services definitions to be imported.
The book from which I am learning web services has a specific example using this way of organizing WSDL (J2EE Web Services by Richard Monson-Haefel, page 136 : 5.2.4).
So, assuming service definitions of imported WSDL should be visible, here is my patch:
The reason for this problem is that the code in WSDL2AxisServiceBuilder method processImports does not recursively include the services in the current level's hash map:
...
//add messages
Map messagesMap = importedDef.getMessages();
wsdl4JDefinition.getMessages().putAll(messagesMap);
//add portypes
Map porttypeMap = importedDef.getPortTypes();
wsdl4JDefinition.getPortTypes().putAll(porttypeMap);
//add bindings
Map bindingMap = importedDef.getBindings();
wsdl4JDefinition.getBindings().putAll(bindingMap);
//------------------------------------------------------------------------------------------------
// Must add services of imported definitions into current wsdl definitions.
//-------------------------------------------------------------------------------------------------
}
...
I simply added:
//add services
Map serviceMap = importedDef.getServices();
wsdl4JDefinition.getServices().putAll(serviceMap);
And it worked.
I tested this using on the refactored version: WSDL11ToAxisServiceBuilder
Here is the patch:
Index: WSDL11ToAxisServiceBuilder.java
===================================================================
--- WSDL11ToAxisServiceBuilder.java (revision 415081)
+++ WSDL11ToAxisServiceBuilder.java (working copy)
@@ -916,6 +916,9 @@
Map bindingMap = importedDef.getBindings();
wsdl4JDefinition.getBindings().putAll(bindingMap);
+ //add services
+ Map serviceMap = importedDef.getServices();
+ wsdl4JDefinition.getServices().putAll(serviceMap);
}
}
ExtensionUtility class is not found
I've trying to run wsdl2java but it fails with a ClassNotFoundException:
[java] Exception in thread &quot;main&quot; org.apache.axis2.wsdl.codegen.CodeGenerationException: java.lang.RuntimeException: java.lang.ClassNotFoundException: org.apache.axis2.schema.ExtensionUtility
[java] at org.apache.axis2.wsdl.codegen.CodeGenerationEngine.generate(CodeGenerationEngine.java:228)
[java] at org.apache.axis2.wsdl.WSDL2Code.main(WSDL2Code.java:32)
[java] at org.apache.axis2.wsdl.WSDL2Java.main(WSDL2Java.java:21)
[java] Caused by: java.lang.RuntimeException: java.lang.ClassNotFoundException: org.apache.axis2.schema.ExtensionUtility
[java] at org.apache.axis2.wsdl.codegen.extension.SimpleDBExtension.engage(SimpleDBExtension.java:52)
[java] at org.apache.axis2.wsdl.codegen.CodeGenerationEngine.generate(CodeGenerationEngine.java:181)
[java] ... 2 more
[java] Caused by: java.lang.ClassNotFoundException: org.apache.axis2.schema.ExtensionUtility
[java] at java.net.URLClassLoader$1.run(Unknown Source)
[java] at java.security.AccessController.doPrivileged(Native Method)
[java] at java.net.URLClassLoader.findClass(Unknown Source)
[java] at java.lang.ClassLoader.loadClass(Unknown Source)
[java] at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)
[java] at java.lang.ClassLoader.loadClass(Unknown Source)
[java] at java.lang.ClassLoader.loadClassInternal(Unknown Source)
[java] at java.lang.Class.forName0(Native Method)
[java] at java.lang.Class.forName(Unknown Source)
[java] at org.apache.axis2.wsdl.codegen.extension.SimpleDBExtension.engage(SimpleDBExtension.java:44)
[java] ... 3 more
The cause is in the SimpleDBExtension class. it is trying to load the following class by name:
private static final String ADB_INVOKE_CLASS_NAME = &quot;org.apache.axis2.schema.ExtensionUtility&quot;;
But this class is not found in the distribution.
aar file is locked if it fails to deploy
Similar to AXIS2-673 (which has been resolved). The difference is that if the aar file fails to deploy, then the aar file is locked and can't be deleted. In my case, my service fails to deploy because it is using a module which has not been deployed yet:
&lt;serviceGroup&gt;
&lt;service name=&quot;FooService&quot;&gt;
&lt;module ref=&quot;someUnknownModule&quot;/&gt;
...
&lt;/service&gt;
&lt;/serviceGroup&gt;
org.apache.axis2.util.StreamWraper may produce START_DOCUMENT events twice
If StreamWrapper is used to wrap a XMLStreamReader positioned at START_ELEMENT, then it will produce START_DOCUMENT events twice.
Assuming StreamWrapper wrapper = new StreamingWrapper(realReader);
1) wrapper.getEventType() returns START_DOCUMENT
2) wrapper.next() still returns START_DOCUMENT by the logic in code below. (in this case, state==STATE_INIT &amp;&amp; realReader.getEventType() == START_ELEMENT)
public int next() throws XMLStreamException {
prevState = state;
int returnEvent = -1;
switch (state) {
case STATE_INIT:
if (realReader.getEventType() == START_DOCUMENT) {
state = STATE_SWITCHED;
returnEvent = realReader.getEventType();
} else {
state = STATE_SWITCH_AT_NEXT;
returnEvent = START_DOCUMENT;
}
break;
...
}
serviceContext.getConfigurationContext().getRealPath(&quot;&quot;) not working as intended...
If Axis2 is deployed at:
C:\Program Files\Apache Software Foundation\Tomcat 5.5\webapps\axis2, I would expect serviceContext.getConfigurationContext().getRealPath(&quot;services&quot;) to return a file that represents:
C:\Program Files\Apache Software Foundation\Tomcat 5.5\webapps\axis2\WEB-INF\services
Likewise, serviceContext.getConfigurationContext().getRealPath(&quot;lib&quot;) should return:
C:\Program Files\Apache Software Foundation\Tomcat 5.5\webapps\axis2\WEB-INF\lib.
ADB does not work with elementFormDefault=&quot;unqualified&quot; schemas
Please see AXIS2-720 for a sample wsdl/xsd that fails.
erviceContext.getMyEPR(); returns null
form Tony Dean
I am now presented with a ServiceContext when service init() is invoked. I would like to obtain my endpoint address from it.
serviceContext.getMyEPR(); returns null however. Can you fix this? I use to use messageContext.getTo(), but it seems more 
appropriate to use the serviceContext since my endpoint address should be static and not changing on a per call basis.
Outbound MAP EPRs overwritten with values from the response message
EndpointReference objects set on an outbound Options object are modified when a response is received to contain the values from the inbound message.
Thus the following code:
EndpointReference to = new EndpointReference(&quot;http://localhost:6080/axis2/services/wsaTestService&quot;);
EndpointReference relpyTo = new EndpointReference(&quot;http://www.w3.org/2005/08/addressing/anonymous&quot;);
EndpointReference faultTo = new EndpointReference(&quot;http://localhost:80/splat/services/fault&quot;);
Options o = stub._getServiceClient().getOptions();
o.setMessageId(&quot;urn:uuid:222&quot;);
o.setTo(to);
o.setAction(&quot;echo&quot;);
o.setReplyTo(relpyTo);
o.setFaultTo(faultTo);
EchoIn ei = new EchoIn();
ei.setEchoIn(&quot;test&quot;);
try{
EchoOut eo = stub.echo(ei);
System.out.println(eo.getEchoOut());
System.out.println(to.getAddress());
System.out.println(relpyTo.getAddress());
System.out.println(faultTo.getAddress());
}catch(Exception e){
e.printStackTrace();
}
Results in the following output:
test
http://localhost:6080/axis2/services/wsaTestService
http://www.w3.org/2005/08/addressing/anonymous
http://localhost:6080/axis2/services/wsaTestService
whereas I'd expect
test
http://localhost:6080/axis2/services/wsaTestService
http://www.w3.org/2005/08/addressing/anonymous
http://localhost:80/splat/services/fault
which are the original values of the EPRs. This demonstrates the issue with the FaultTo EPR and I have seen the issue with the ReplyTo also. 
This is important for a number of reasons which I'm happy to outline if it's not clear to you.
A bit of digging suggests (I'm not 100% sure) to me that this problem is being caused by the line:
// This is a hack - Needs to change
responseMessageContext.setOptions(options);
in OutInAxisOperation.java coupled with the fact the the WS-Addressing handlers write into an EPR if it exists on the MessageContext rather than adding a new one.
Java code generated by WSDL2Java does not compile when WSDL contains a custom element in SOAP header
I have created a WSDL file, and I am trying to generate and compile java code for my web service. I can generate code, but ant build fails with complains about org.apache.axiom.om.OMelement. The errors are about the method newXMLStreamReader() and variable Factory within this interface.
Specifically, I am trying to add a custom soap header in my request and response.
WSDL:
----------
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;wsdl:definitions xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;
xmlns:tns=&quot;http://foo.bar/service&quot;
xmlns:wsdl=&quot;http://schemas.xmlsoap.org/wsdl/&quot;
xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; name=&quot;TtsSgsTitleTransfer&quot;
targetNamespace=&quot;http://foo.bar/service&quot;&gt;
&lt;wsdl:types&gt;
&lt;xsd:schema targetNamespace=&quot;http://foo.bar/service&quot;
xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;
xmlns:tns=&quot;http://foo.bar/service&quot;
xmlns=&quot;http://foo.bar/service&quot; &gt;
&lt;xsd:simpleType name=&quot;AddressLineType&quot;&gt;
&lt;xsd:restriction base=&quot;xsd:string&quot;&gt;
&lt;xsd:maxLength value=&quot;50&quot;/&gt;
&lt;/xsd:restriction&gt;
&lt;/xsd:simpleType&gt;
&lt;xsd:simpleType name=&quot;CityType&quot;&gt;
&lt;xsd:restriction base=&quot;xsd:string&quot;&gt;
&lt;xsd:maxLength value=&quot;25&quot;/&gt;
&lt;/xsd:restriction&gt;
&lt;/xsd:simpleType&gt;
&lt;xsd:simpleType name=&quot;StateType&quot;&gt;
&lt;xsd:restriction base=&quot;xsd:string&quot;&gt;
&lt;xsd:maxLength value=&quot;2&quot;/&gt;
&lt;/xsd:restriction&gt;
&lt;/xsd:simpleType&gt;
&lt;xsd:simpleType name=&quot;ZIPType&quot;&gt;
&lt;xsd:restriction base=&quot;xsd:string&quot;&gt;
&lt;xsd:maxLength value=&quot;12&quot;/&gt;
&lt;/xsd:restriction&gt;
&lt;/xsd:simpleType&gt;
&lt;xsd:simpleType name=&quot;CountryType&quot;&gt;
&lt;xsd:restriction base=&quot;xsd:string&quot;&gt;
&lt;xsd:maxLength value=&quot;3&quot;/&gt;
&lt;/xsd:restriction&gt;
&lt;/xsd:simpleType&gt;
&lt;xsd:complexType name=&quot;AddressType&quot;&gt;
&lt;xsd:sequence&gt;
&lt;xsd:element name=&quot;line1&quot; type=&quot;tns:AddressLineType&quot;/&gt;
&lt;xsd:element name=&quot;line2&quot; type=&quot;tns:AddressLineType&quot; minOccurs=&quot;0&quot;/&gt;
&lt;xsd:element name=&quot;city&quot; type=&quot;tns:CityType&quot;/&gt;
&lt;xsd:element name=&quot;state&quot; type=&quot;tns:StateType&quot;/&gt;
&lt;xsd:element name=&quot;zip&quot; type=&quot;tns:ZIPType&quot;/&gt;
&lt;xsd:element name=&quot;country&quot; type=&quot;tns:CountryType&quot; default=&quot;USA&quot; minOccurs=&quot;0&quot;/&gt;
&lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;
&lt;xsd:complexType name=&quot;ResponseType&quot;&gt;
&lt;xsd:sequence&gt;
&lt;xsd:element name=&quot;transmissionId&quot; type=&quot;xsd:string&quot;/&gt;
&lt;xsd:element name=&quot;success&quot; type=&quot;xsd:string&quot;/&gt;
&lt;xsd:element name=&quot;errorMessage&quot; type=&quot;xsd:string&quot;/&gt;
&lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;
&lt;xsd:complexType name=&quot;HeaderType&quot;&gt;
&lt;xsd:sequence&gt;
&lt;xsd:element name=&quot;clientId&quot; type=&quot;xsd:string&quot;/&gt;
&lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;
&lt;xsd:element name=&quot;updateAddressResponseElement&quot; type=&quot;tns:ResponseType&quot;/&gt;
&lt;xsd:element name=&quot;updateAddressRequestElement&quot; type=&quot;tns:AddressType&quot;/&gt;
&lt;xsd:element name=&quot;updateAddressResponseHeader&quot; type=&quot;tns:HeaderType&quot;/&gt;
&lt;xsd:element name=&quot;updateAddressRequestHeader&quot; type=&quot;tns:HeaderType&quot;/&gt;
&lt;/xsd:schema&gt;
&lt;/wsdl:types&gt;
&lt;wsdl:message name=&quot;updateAddressRequest&quot;&gt;
&lt;wsdl:part element=&quot;tns:updateAddressRequestElement&quot; name=&quot;addressRequest&quot; /&gt;
&lt;wsdl:part name=&quot;updateAddressRequestHeader&quot; element=&quot;tns:updateAddressRequestHeader&quot; /&gt;
&lt;/wsdl:message&gt;
&lt;wsdl:message name=&quot;updateAddressResponse&quot;&gt;
&lt;wsdl:part element=&quot;tns:updateAddressResponseElement&quot; name=&quot;addressResponse&quot; /&gt;
&lt;wsdl:part name=&quot;updateAddressResponseHeader&quot; element=&quot;tns:updateAddressResponseHeader&quot; /&gt;
&lt;/wsdl:message&gt;
&lt;wsdl:portType name=&quot;AddressPort&quot;&gt;
&lt;wsdl:operation name=&quot;updateAddress&quot;&gt;
&lt;wsdl:input name=&quot;updateAddressRequest&quot; message=&quot;tns:updateAddressRequest&quot; /&gt;
&lt;wsdl:output name=&quot;updateAddressResponse&quot; message=&quot;tns:updateAddressResponse&quot; /&gt;
&lt;/wsdl:operation&gt;
&lt;/wsdl:portType&gt;
&lt;wsdl:binding name=&quot;addressBinding&quot; type=&quot;tns:AddressPort&quot;&gt;
&lt;soap:binding style=&quot;document&quot; transport=&quot;http://schemas.xmlsoap.org/soap/http&quot; /&gt;
&lt;wsdl:operation name=&quot;updateAddress&quot;&gt;
&lt;soap:operation soapAction=&quot;&quot; /&gt;
&lt;wsdl:input&gt;
&lt;soap:header message=&quot;tns:updateAddressRequest&quot; part=&quot;updateAddressRequestHeader&quot; use=&quot;literal&quot;/&gt;
&lt;soap:body use=&quot;literal&quot; parts=&quot;addressRequest&quot; /&gt;
&lt;/wsdl:input&gt;
&lt;wsdl:output&gt;
&lt;soap:header message=&quot;tns:updateAddressResponse&quot; part=&quot;updateAddressResponseHeader&quot; use=&quot;literal&quot;/&gt;
&lt;soap:body use=&quot;literal&quot; parts=&quot;addressResponse&quot; /&gt;
&lt;/wsdl:output&gt;
&lt;/wsdl:operation&gt;
&lt;/wsdl:binding&gt;
&lt;wsdl:service name=&quot;AddressService&quot;&gt;
&lt;wsdl:port name=&quot;SOAPPort&quot;
binding=&quot;tns:addressBinding&quot;&gt;
&lt;soap:address location=&quot;http://localhost:8080/AddressService&quot; /&gt;
&lt;/wsdl:port&gt;
&lt;/wsdl:service&gt;
&lt;/wsdl:definitions&gt;
----------------------------------------------------
My stack trace on compile error:
----------------------------------------------------------
C:\devtools\axis2-std-1.0-bin\samples\wsdl&gt;WSDL2Java -uri sample-address.wsdl -sd -s -ss -d xmlbeans -p test.address -o address_src
Using AXIS2_HOME: c:\devtools\axis2-std-1.0-bin
Using JAVA_HOME: C:\devtools\jdk1.5.0_03
log4j:WARN No appenders could be found for logger
(org.apache.axis2.wsdl.codegen.emitter.AxisServiceBasedMultiLanguageEmitter).
log4j:WARN Please initialize the log4j system properly.
C:\devtools\axis2-std-1.0-bin\samples\wsdl&gt;cd address_src
C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src&gt;ant
Buildfile: build.xml
init:
[mkdir] Created dir:
C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\build
[mkdir] Created dir:
C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\build\classes
[mkdir] Created dir:
C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\build\lib
[mkdir] Created dir:
C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\test
jar.xbeans:
[jar] Building jar:
C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\build\lib\XBeans-packaged.jar
pre.compile.test:
[echo] XmlBeans Availability = true
[echo] Stax Availability= true
[echo] Axis2 Availability= true
compile.src:
[javac] Compiling 230 source files to
C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\build\classes
[javac] C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\src\test\address\AddressServiceMessageReceiverInOut.java:77:
cannot find
symbol
[javac] symbol : method newXMLStreamReader()
[javac] location: interface org.apache.axiom.om.OMElement
[javac]
(org.apache.axiom.om.OMAbstractFactory.getOMFactory(),new
org.apache.axis2.util.StreamWrapper(param.newXMLStream
Reader())) ;
[javac]
^
[javac] C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\src\test\address\AddressServiceMessageReceiverInOut.java:160:
cannot find
symbol
[javac] symbol : variable Factory
[javac] location: interface org.apache.axiom.om.OMElement
[javac] return org.apache.axiom.om.OMElement.Factory.parse(
[javac] ^
[javac] C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\src\test\address\AddressServiceMessageReceiverInOut.java:164:
cannot find
symbol
[javac] symbol : variable Factory
[javac] location: interface org.apache.axiom.om.OMElement
[javac] return org.apache.axiom.om.OMElement.Factory.parse(
[javac] ^
[javac] Note: * uses or overrides a deprecated API.
[javac] Note: Recompile with -Xlint:deprecation for details.
[javac] Note:
C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\src\test\address\AddressServiceMessageReceiverInOut.java
uses unche
cked or unsafe operations.
[javac] Note: Recompile with -Xlint:unchecked for details.
[javac] 3 errors
BUILD FAILED
C:\devtools\axis2-std-1.0-bin\samples\wsdl\address_src\build.xml:50:
Compile failed; see the compiler error output for details.
Total time: 17 seconds
ADB ConversionUtil throws exception when called with valid arrayList and BigInteger.class
We used WSDL2Java to create a client and a service using ADB databinding from a WSDL that contains the following return types:
&lt;xs:element name=&quot;predictEpitopesResponse&quot;&gt;
&lt;xs:complexType&gt;
&lt;xs:sequence&gt;
&lt;xs:element minOccurs=&quot;0&quot; type=&quot;xs:integer&quot; name=&quot;StartPositions&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;xs:element minOccurs=&quot;0&quot; type=&quot;xs:double&quot; name=&quot;Scores&quot; maxOccurs=&quot;unbounded&quot;/&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:element&gt;
Curiously, WSDL2Java wants the integer array to be of type BigInteger, which is not what we expected (long maybe? how can we ensure this?)
The code that causes the following exception looks like this:
System.err.println(list1);
object.setStartPositions( (java.math.BigInteger[]) org.apache.axis2.databinding.utils.ConverterUtil.convertToArray( java.math.BigInteger.class, list1));
This is the output of the err.println and the exception:
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
java.lang.RuntimeException: java.lang.ArrayStoreException
at org.apache.axis2.SVMHCServiceStub.fromOM(SVMHCServiceStub.java:952)
at org.apache.axis2.SVMHCServiceStub.predictEpitopes(SVMHCServiceStub.java:149)
at org.apache.axis2.schmain.main(schmain.java:24)
Caused by: java.lang.ArrayStoreException
at java.lang.System.arraycopy(Native Method)
at java.util.ArrayList.toArray(Unknown Source)
at org.apache.axis2.databinding.utils.ConverterUtil.convertToArray(ConverterUtil.java:697)
at org.apache.axis2.SVMHCServiceStub$PredictEpitopesResponse$Factory.parse(SVMHCServiceStub.java:791)
at org.apache.axis2.SVMHCServiceStub.fromOM(SVMHCServiceStub.java:944)
... 2 more
We think it looks like the numbers are integers... so there's no reason why the ConverterUtil should fail like this.
dead code in DatabindingTemplate.xsl preventing MTOM from being used
In DatabindingTemplate.xsl, the code is like:
&lt;xsl:template match=&quot;databinders[@dbtype='xmlbeans']&quot;&gt;
&lt;xsl:variable name=&quot;base64&quot;&gt;&lt;xsl:value-of select=&quot;base64Elements/name&quot;/&gt;&lt;/xsl:variable&gt;
&lt;xsl:if test=&quot;$base64&quot;&gt;
private static javax.xml.namespace.QName[] qNameArray = {...
The problem is, if base64 schema types are found, the source document generated is like (this xml document below is the debug output from Axis2):
&lt;interface
basereceiver=&quot;org.apache.axis2.receivers.AbstractInMessageReceiver&quot;
isAsync=&quot;1&quot; isSync=&quot;1&quot; name=&quot;FileServiceMessageReceiverInOnly&quot;
package=&quot;com.foo.fs&quot; skeletonInterfaceName=&quot;FileServiceSkeleton&quot;
skeletonname=&quot;FileServiceSkeleton&quot;&gt;
&lt;databinders dbtype=&quot;xmlbeans&quot;&gt;
&lt;base64Elements&gt;
&lt;name localName=&quot;file&quot;
ns-url=&quot;http://foo.com/FileService/schema&quot; /&gt;
&lt;/base64Elements&gt;
...
&lt;/databinders&gt;
&lt;fault-list /&gt;
&lt;/interface&gt;
You can see that the &lt;name&gt; element has no text content. As the $base64 variable is set to the text value of the first node of the node set base64Elements/name, it will be an empty string which is treated as false in the subsequent xsl:if condition. The result is that the qNameArray will not be generated and the MTOM will be disabled. It seems that the template should be changed to:
&lt;xsl:variable name=&quot;base64&quot;&gt;&lt;xsl:value-of select=&quot;count(base64Elements/name)&gt;0&quot;/&gt;&lt;/xsl:variable&gt;
NullPointerException in XMLbeans code generation with xmime:contentType
In the org.apache.axis2.xmlbeans.CodeGenerationUtility class, the findBase64Types() method (as shown below) contains a bug: It is calling getDocumentElementName() on the outer type but this method works on the &quot;document type&quot; only, otherwise it will return null:
if (sType.getContentType() == SchemaType.SIMPLE_CONTENT &amp;&amp; sType.getPrimitiveType() != null) {
if (Constants.BASE_64_CONTENT_QNAME.equals(sType.getPrimitiveType().getName())) {
outerType = sType.getOuterType();
//check the outer type further to see whether it has the contenttype attribute from
//XMime namespace
SchemaProperty[] properties = sType.getProperties();
for (int j = 0; j &lt; properties.length; j++) {
if (Constants.XMIME_CONTENT_TYPE_QNAME.equals(properties[j].getName())) {
base64ElementQNamesList.add(outerType.getDocumentElementName());
break;
}
}
}
}
The result is, the base64 qname list will only contain null's as its elements. This will later cause the AxisServiceBasedMultiLanguageEmitter.getBase64Elements() to fail. The stack trace is:
[java] Caused by: java.lang.NullPointerException
[java] at org.apache.axis2.wsdl.codegen.emitter.AxisServiceBasedMultiLanguageEmitter.getBase64Elements(AxisServiceBasedMultiLanguageEmitter.java:972)
[java] at org.apache.axis2.wsdl.codegen.emitter.AxisServiceBasedMultiLanguageEmitter.createDOMElementforDatabinders(AxisServiceBasedMultiLanguageEmitte
r.java:931)
[java] at org.apache.axis2.wsdl.codegen.emitter.AxisServiceBasedMultiLanguageEmitter.createDocumentForMessageReceiver(AxisServiceBasedMultiLanguageEmit
ter.java:849)
[java] at org.apache.axis2.wsdl.codegen.emitter.AxisServiceBasedMultiLanguageEmitter.writeMessageReceiver(AxisServiceBasedMultiLanguageEmitter.java:796
)
[java] at org.apache.axis2.wsdl.codegen.emitter.AxisServiceBasedMultiLanguageEmitter.emitSkeletonService(AxisServiceBasedMultiLanguageEmitter.java:693)
[java] at org.apache.axis2.wsdl.codegen.emitter.AxisServiceBasedMultiLanguageEmitter.emitSkeleton(AxisServiceBasedMultiLanguageEmitter.java:638)
Buggy code sample in MTOM GUIDE
public EchoSwA() {
}
public void setOperationContext(OperationContext oc) throws AxisFault {
msgcts = oc.getMessageContext(WSDLConstants.MESSAGE_LABEL_OUT_VALUE);
}
should be 
public EchoSwA() {
}
public void setOperationContext(OperationContext oc) throws AxisFault {
msgcts = oc.getMessageContext(WSDLConstants.MESSAGE_LABEL_IN_VALUE);
}
I have already done the fix in xdocs/latest.... Some body please update the site.. 
I have seen in the mailing list that some people already went in to trouble due to this buggy code peice,...
Incorrect parameter type in WSDL2Java generated stub method OMElement instead of specific type
The generated stub source doesn't containt the correct parameter type in the service method. Instead of having the specific type as specified in the WSDL for the parameter, it contains the generic &quot;org.apache.axiom.om.OMElement&quot; type. 
The stub was generated using Axis2 1.0 WSDL2Java tool.
D:\dev\wellpoint\SAF\wsdl\ProviderDomain&gt;d:\devtools\axis2-SNAPSHOT\bin\WSDL2Java.bat -uri ProviderService_Binding_JMS_V0100.wsdl -s -o codegen -d xmlbeans -p com.wellpoint.integration.saf.int.provider.axis2
/**
* Auto generated method signature
* @see com.wellpoint.integration.saf.int.provider.axis2.ProviderService#UpdateMemberPCPDetail
* @param param0
* @param param1
* @param param2
*/
public org.apache.axiom.om.OMElement UpdateMemberPCPDetail(
org.apache.axiom.om.OMElement param0,com.wellpoint.esb.context.ContextDocument param1,com.wellpoint.esb.header.ESBHeaderDocument param2)
The first parameter should have been &quot;com.wellpoint.service.provider.ProviderUpdateMemberPCPDetailRequestDocument&quot;.
AXIS2 generates un-compilable source with WSDL2Java - Looks like it refers to old version of method signature in the generated code
I am trying to compile and get the source code for both client and server for last month from the day 1.0 is released.
I am unsuccesful.
I am using the following command in Microsoft DOS
wsdl2java -uri MovieGridApp.wsdl -ss -sd -g -d xmlbeans -p com.ibm.grid.moviegridapp
I get the following code for &quot;MovieGridAppStub.java&quot; and &quot;MovieGridAppMessageReceiverInOut.java&quot; - which IBM Rational Application Developer does not understand.
-- in method 1-&gt;
public org.apache.xmlbeans.XmlObject fromOM(
org.apache.axiom.om.OMElement param,
java.lang.Class type,
java.util.Map extraNamespaces){
try{
if (org.apache.axiom.om.OMElement.class.equals(type)){
if (extraNamespaces!=null){
return org.apache.axiom.om.OMElement.Factory.parse(
param.getXMLStreamReaderWithoutCaching(),
new org.apache.xmlbeans.XmlOptions().setLoadAdditionalNamespaces(extraNamespaces));
}else{
return org.apache.axiom.om.OMElement.Factory.parse(
param.getXMLStreamReaderWithoutCaching());
}
}
}catch(java.lang.Exception e){
throw new RuntimeException(&quot;Data binding error&quot;,e);
}
return null;
}
&amp; 
in method 2--&gt;
private org.apache.axiom.om.OMElement toOM(org.apache.axiom.om.OMElement param, boolean optimizeContent){
org.apache.axiom.om.impl.builder.StAXOMBuilder builder = new org.apache.axiom.om.impl.builder.StAXOMBuilder
(org.apache.axiom.om.OMAbstractFactory.getOMFactory(),new org.apache.axis2.util.StreamWrapper(param.newXMLStreamReader())) ;
org.apache.axiom.om.OMElement documentElement = builder.getDocumentElement();
((org.apache.axiom.om.impl.OMNodeEx)documentElement).setParent(null);
return documentElement;
}
BOTH THE CASE in Method 1, refer to &quot;org.apache.axiom.om.OMElement.Factory.parse&quot;, in OMElement does not have Factory and parse method.
IN THE CASE of method 2, refer to newXMLStreamReader(), which does not exists.
I herewith attaching the WSDL file -moviegridapp.wsdl.
Some has answered for BUG # 649, asking us to download the latest code, however, the latest downloaded on 21 May 2006 @ 4PM does not work as well.
If anyone has cracked the bug, please let me know where I am going wrong or how to correct the mistake.
Regards
Arun
elementFormDefault=&quot;unqualified&quot; is default
This issue is talking about elementFormDefault for schema of WSDL.
elementFormDefault=&quot;qualified&quot; is right.
With 1.0 elementFormDefault=&quot;unqualified&quot; seems default.
It seems elementFormDefault=&quot;qualified&quot; was default generated WSDL settings at 0.95.
You can check this issu by WSDL of &quot;version&quot; service.
http://localhost:8080/axis2/services/version?wsdl
Maybe, this issue affects some parts;
- auto generation WSDL function for deployed service
- Java2WSDL function
- WSDL generating eclipse plug-in
BTW, which is better about attributeFormDefault=&quot;unqualified&quot;
or attributeFormDefault=&quot;qualified&quot; ?
I also hope that I could override 'elementFormDefault' value by services.xml,
as I could override namespace.
pls refer to:
http://marc.theaimsgroup.com/?l=axis-user&amp;m=114804169309670&amp;w=2
AARWSDLLocator incorrect logic - may load incorrect files under certain scenarios
The following code in AARWSDLLocator.java will fail in a certain scenario (described below):
...
while ((entry = zin.getNextEntry()) != null) {
String entryName = entry.getName();
if ((entryName.startsWith(DeploymentConstants.META_INF.toLowerCase())
|| entryName.startsWith(DeploymentConstants.META_INF))
&amp;&amp; entryName.endsWith(importLocation)) {
...
If I have a wsdl file that has an import like:
&lt;s:import namespace=&quot;some_namespace&quot; schemaLocation=&quot;xsd/some_namespace.xsd&quot;/&gt;
And then, in my aar file, I have the files:
META-INF/xsd/some_namespace.xsd
META-INF/some_bad_other_xsd/some_namespace.xsd
The locator seems to try and load both files. At the very least, the if condition is met, and later down the line, an XMLSchemaException is thrown as follows:
Error: org.apache.axis2.deployment.DeploymentException: java.lang.RuntimeException: org.apache.ws.commons.schema.XmlSchemaException: No namespace found in given base simple content type
If you remove the excess xsd file, the problem goes away. So...I think the if statement here needs to be fixed to not include directories that happen to end with the import location.
Marking as minor since I can change my directory strutcure, but would be major for someone who was unable to change the stucture of their files.
[ADB] Feedback from Wendy's POC
See original email here:
http://mail-archives.apache.org/mod_mbox/ws-axis-dev/200605.mbox/%3cOF220CACBE.411DB84B-ON8525716B.0074F142-8525716B.007C5C4F@wendys.com%3e
4. Bug: GetAppReleasesType.java does not compile.
In the GetAppReleasesType#Factory.parse method, a reference is made to the 
nonexistent method &quot;
org.apache.axis2.databinding.utils.ConverterUtil.convertToNonNegativeInteger(content)
&quot;.
The correct method name is &quot;
org.apache.axis2.databinding.utils.ConverterUtil.convertTononNegativeInteger(content)
&quot;. Note: There is a correct reference to the 
org.apache.axis2.databinding.utils.ConverterUtil.convertTononNegativeInteger 
method in the AppRelease#Factory.parse method. This leads me to conclude 
that you are not using common methods to determine which conversions to 
perform on input vs. output content, and so bugs that are caught in one 
class may still be unidentified in another class.
5. Bug: In AppRelease.java, the values for localAvailabilityStopTracker 
and localReleaseDescTracker are not set properly.
In the setters for the attributes that these Trackers track, the following 
code should be used to ensure that the Trackers are set properly:
For localAvailabilityStopTracker - 
public void setAvailabilityStop(java.util.Date param) {
// update the setting tracker
localAvailabilityStopTracker = (param != null);
this.localAvailabilityStop = param;
}
For localReleaseDescTracker - 
public void setReleaseDesc(java.lang.String param) {
// update the setting tracker
localReleaseDescTracker = true;
this.localReleaseDesc = param;
}
As generated by WSDL2Java, the Tracker is set to true even if the variable 
it is tracking is unset back to null.
6. Bug: In the AppReleaseResponse.setReturn method, the value of 
local_returnTracker may be set to true, but it will never be unset.
Similar to Bug #3, the local_returnTracker should be set using the 
following code to ensure that it is unset when the supplied parm is null:
public void set_return(com.wendys.ws.apprelease.AppRelease[] param) {
validate_return(param);
// update the setting tracker
local_returnTracker = (param != null);
local_return = param;
}
7. Annoyance: In the AppReleaseResponse.addReturn method, 
local_returnTracker only needs to be set to true when the local_return 
array is instantiated, not every time an AppRelease is added to the array.
Deactivate does not call application destroy() method
Please comment on this bug before marking fixed!
I have a web service that is configured for scope=application. Upon deactivating the service, my destroy(ServiceContext sessionContext) is never being called. When or are you ever calling destroy() to allow the web service application to cleanup? The init() and setOperationContext() seem to be working correctly.
Thanks.
CallbackReceiver should not be a instance variable of the ServiceClient
This causes the same configurationContext different serviceClient scenarios to fail. The CallbackReceiver object set in the operations of the configurationContext get replaced, everytime a new ServiceClient is used.
Instead of storing the callbackReceiver in the serviceClient, it could be set directly in the respective operations.
&quot;Address already in use: JVM_Bind&quot; exception while creating second SimpleHTTPServer instance
When I run two EchoNonBlockingDualClient sample at the same time, first one successfully starts SimpleHTTPServer on port 6060 and the second one gets an java.net.BindException: Address already in use: JVM_Bind&quot; while trying to start the server.
Doesn't I have an option to listen all the responses for its dedicated port? For example 6060 for the first instance, 6061 for the second one, and so on. Or, should i assume Axis2 to use the same port for the responses of all the long running transactions?
Anyway, in either case, it should not throw such exception.
IOException when when a module with its own jars in the 'lib' dir is deployed
Report from Yanlun:
Original mail: http://marc.theaimsgroup.com/?l=axis-dev&amp;m=114721187825993&amp;w=2
In following code of org.apache.axis2.deployment.util.Utils, the File.createTempFile(&quot;axis2&quot;, entryName.substring(4)); got IO exception and said &quot;Invalid path&quot;. Add the line &quot;new File(System.getProperty(&quot;java.io.tmpdir&quot;)).mkdirs();&quot; can solve this problem.
Please take a look,
See http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4847239 for the proposed walkaround.
Thanks,
Yanlun
if ((entryName != null) &amp;&amp; entryName.toLowerCase().startsWith(&quot;lib/&quot;)
&amp;&amp; entryName.toLowerCase().endsWith(&quot;.jar&quot;)) {
byte data[] = new byte[2048];
int count;
new File(System.getProperty(&quot;java.io.tmpdir&quot;)).mkdirs();
File f = File.createTempFile(&quot;axis2&quot;, entryName.substring(4));
f.deleteOnExit();
FileOutputStream out = new FileOutputStream(f);
while ((count = zin.read(data, 0, 2048)) != -1) {
out.write(data, 0, count);
}
out.close();
array.add(f.toURL());
}
WSDL served up by http://mmcan01-20044:8080/axis2/services/AppRelease?wsdl is not the one in META-INF.
This is related to issues AXIS2-634 and AXIS2-654 (item #3) which were, IMHO, closed prematurely.
I used WSDL2Java to create my environment.
I modified the build.xml to include the original WSDL in the META-INF directory of the .aar.
I used this wsdl and buld.xml successfully to generate the code and deploy it to Tomcat.
The deployed .aar served up my original .wsdl mostly correctly (see AXIS2-618) under Axis2 0.94 and 0.95.
I regenerated the source under 1.0 and reapplied my Skeleton and Test class changes (with appropriate modifications to accomodate the new class names in 1.0).
The wsdl file in META-INF is named AppRelease.wsdl, and my service name is AppRelease (which worked under 0.94 and 0.95).
Problem: The new code only returns a generated WSDL in response to http://localhost:8080/axis2/services/Service?wsdl, not the one in META-INF.
Option in ADB codegen to generate separate _Helper files like Axis 1.X
Can we please add an option where we can creat MyBean and MyBean_Helper with all the ADB/stax stuff inside the _Helper and the bean is a plain ol' bean? see --helperGen option in Axis 1.X for example.
thanks,
dims
XPath lookup fails when applied to a SOAPEnvelope created using the SOAPFactory.getDefaultEnvelope () method
Will add a test case to explain this more.
The error is a NullPointerException. 
But the error does not appear when following line is added to the created envelope.
factory.createOMDocument().addChild(envelope);
unit tests fail with activation and mailapi jars from sun
Hi,
When i was trying the maven2 based build, i used the sun's latest activation and mailapi jars in the dependencies and that causes failures in the test cases. We need to fix this.
thanks,
dims
StreamingOMSerializer is invoking the XMLStreamWriter with a wrong sequence of writes.
I found this problem while debugging AXIS2-913. I attempted to write an Axiom testcase, but could not reproduce the problem with just Axiom code.
Here is the stack dump from AXIS2-913:
&lt;error message=&quot;Unbound namespace URI &amp;apos;http://test&amp;apos;&quot; type=&quot;javax.xml.stream.XMLStreamException&quot;&gt;javax.xml.stream.XMLStreamException: Unbound namespace URI &amp;apos;http://test&amp;apos;
at com.ctc.wstx.sw.SimpleNsStreamWriter.writeStartOrEmpty(SimpleNsStreamWriter.java:240)
at com.ctc.wstx.sw.BaseNsStreamWriter.writeStartElement(BaseNsStreamWriter.java:273)
at org.apache.axiom.om.impl.MTOMXMLStreamWriter.writeStartElement(MTOMXMLStreamWriter.java:87)
at org.apache.axiom.om.impl.serialize.StreamingOMSerializer.serializeElement(StreamingOMSerializer.java:123)
at org.apache.axiom.om.impl.serialize.StreamingOMSerializer.serializeNode(StreamingOMSerializer.java:73)
at org.apache.axiom.om.impl.serialize.StreamingOMSerializer.serialize(StreamingOMSerializer.java:56)
at org.apache.axiom.om.impl.util.OMSerializerUtil.serializeByPullStream(OMSerializerUtil.java:325)
at org.apache.axiom.om.impl.llom.OMElementImpl.internalSerialize(OMElementImpl.java:792)
at org.apache.axiom.soap.impl.llom.SOAPEnvelopeImpl.internalSerialize(SOAPEnvelopeImpl.java:177)
at org.apache.axiom.om.impl.llom.OMElementImpl.internalSerializeAndConsume(OMElementImpl.java:811)
at org.apache.axiom.om.impl.llom.OMNodeImpl.serializeAndConsume(OMNodeImpl.java:378)
at org.apache.axis2.jaxws.message.MessageTests.testJAXBOutflow(MessageTests.java:304)
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)
at junit.extensions.TestSetup$1.protect(TestSetup.java:19)
at junit.extensions.TestSetup.run(TestSetup.java:23) 
The root of the problem is that StreamingOMSerializer is invoking the writer using an incorrect StAX sequence.
This results in the writer reporting an unbound namespace.
Similar (or the same problem) has been report in WSCOMMONS-33 and WSCOMMONS-62
I have a fix for the problem. I will be posting a patch in a few minutes.
Here is the &quot;new&quot; algorithm that I have added to the StreamingOMSerializer.serializeElement:
// The algorithm is:
// ... generate setPrefix/setDefaultNamespace for each namespace declaration if the prefix is unassociated.
// ... generate setPrefix/setDefaultNamespace if the prefix of the element is unassociated
// ... generate setPrefix/setDefaultNamespace for each unassociated prefix of the attributes.
//
// ... generate writeStartElement
//
// ... generate writeNamespace/writerDefaultNamespace for each namespace declaration on the element
// ... generate writeNamespace/writeDefaultNamespace for any new &quot;autogen&quot; namespace/prefixes
// ... generate writeAttribute for each attribute
I have peer reviewed the code with a member of IBM's parser team (Perter McCracken) and several of the IBM JAX-WS contributors.
I would like a peer review from the Axiom community. 
This issue is holding up some critical development in the JAXWS code. So I will be committing the fix later today, unless I get some negative feedback.
Thanks,
scheu
OMSerializerUtil is not calling XMLStreamWriter in the correct order
OMSerializerUtil is not invoking the XMLStreamWriter in the correct order.
This causes problems when a different StAX implementation (non-Woodstox) is used.
The suggestion is to change the algorithm to use the same algorithm as WSCOMMONS-64. (Actually the best approach is to try and fold the code together).
I think this would also fix several of the other AXION serializer issues. 
Here is the WSCOMMONS-64 algorithm (reccently introduced):
// The algorithm is:
// ... generate setPrefix/setDefaultNamespace for each namespace declaration if the prefix is unassociated.
// ... generate setPrefix/setDefaultNamespace if the prefix of the element is unassociated
// ... generate setPrefix/setDefaultNamespace for each unassociated prefix of the attributes.
//
// ... generate writeStartElement
//
// ... generate writeNamespace/writerDefaultNamespace for each namespace declaration on the element
// ... generate writeNamespace/writeDefaultNamespace for any new &quot;autogen&quot; namespace/prefixes
// ... generate writeAttribute for each attribute
Here is the guidance from the JSR173 StAX specification (note that prefixes are first &quot;set&quot;, then then writeStartElement, then the namespace 
declarations are generated). This is not being followed in OMSerializerUtil
----------------
writer.setPrefix(&quot;c&quot;,&quot;http://c&quot;);
writer.setDefaultNamespace(&quot;http://c&quot;);
writer.writeStartElement(&quot;http://c&quot;,&quot;a&quot;);
writer.writeAttribute(&quot;b&quot;,&quot;blah&quot;);
writer.writeNamespace(&quot;c&quot;,&quot;http://c&quot;);
writer.writeDefaultNamespace(&quot;http://c&quot;);
writer.setPrefix(&quot;d&quot;,&quot;http://c&quot;);
writer.writeEmptyElement(&quot;http://c&quot;,&quot;d&quot;);
writer.writeAttribute(&quot;http://c&quot;,&quot;chris&quot;,&quot;fry&quot;);
writer.writeNamespace(&quot;d&quot;,&quot;http://c&quot;);
writer.writeCharacters(&quot;foo bar foo&quot;);
writer.writeEndElement();
writer.flush();
This will result in the following XML (new lines are non-normative)
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;a b=&quot;blah&quot; xmlns:c=&quot;http://c&quot; xmlns=&quot;http://c&quot;&gt;
&lt;d:d d:chris=&quot;fry&quot; xmlns:d=&quot;http://c&quot;/&gt;foo bar foo&lt;/a&gt;
---------------------
Here is the specific exception that I get when I plug in a different StAX implementation:
java.lang.IllegalStateException: writeNamespace() can only be called following writeStartElement() or writeEmptyElement().
at ..... 
at org.apache.axiom.om.impl.MTOMXMLStreamWriter.writeNamespace(MTOMXMLStreamWriter.java:150)
at org.apache.axiom.om.impl.util.OMSerializerUtil.serializeNamespace(OMSerializerUtil.java:116)
at org.apache.axiom.om.impl.util.OMSerializerUtil.serializeNamespaces(OMSerializerUtil.java:264)
at org.apache.axiom.om.impl.util.OMSerializerUtil.serializeStartpart(OMSerializerUtil.java)
at org.apache.axiom.om.impl.llom.OMElementImpl.internalSerialize(OMElementImpl.java:767)
at org.apache.axiom.om.impl.llom.OMElementImpl.internalSerialize(OMElementImpl.java:756)
at org.apache.axiom.om.impl.llom.OMNodeImpl.serialize(OMNodeImpl.java:310)
at org.apache.axiom.om.impl.llom.OMNodeImpl.serialize(OMNodeImpl.java:348)
at org.apache.axiom.om.impl.llom.OMElementImpl.toString(OMElementImpl.java:899)
at org.apache.axiom.om.impl.serializer.PreserveEnvelopeTest.testOMNS(PreserveEnvelopeTest.java:80)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:615)
at junit.framework.TestCase.runTest(TestCase.java:154)
at junit.framework.TestCase.runBare(TestCase.java:127)
at junit.framework.TestResult$1.protect(TestResult.java:106)
at junit.framework.TestResult.runProtected(TestResult.java:124)
at junit.framework.TestResult.run(TestResult.java:109)
at junit.framework.TestCase.run(TestCase.java:118)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:478)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:344)
at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)
--------------------------
I have assigned this issue to myself and will submit a patch for the fix.
As with WSCOMMONS-64, I would like a peer review of the idea and change.
(Note: I worked extensively on the SAX model in Axis and within other webservice projects...so I am familiar with this problem domain).
Thanks for your help.
scheu
Incorect handling of message size in ByteArrayOutputStream::write
when you are sending message via openwire protocol, ByteArrayOutputStream::write is called in certain moment ...
when message size is greater then defaul CHUNK space is reallocated and there is &quot;check for EOF offset&quot;.
if( offset &gt; bodySize )
expandBody() ;
but should be there 
if ( offset &gt;= bodySize ) 
expandBody();
Missing NULL pointer check in MessageConsumer::autoAcknowledge
When you call consumer-&gt;receive() on empty queue receive method returns NULL message but before return MessageConsumer::autoAcknowledge method is invoked. This method doesn't check message against NULL, this cause coredump is message is NULL.
Patch: 
p&lt;IMessage&gt; MessageConsumer::autoAcknowledge(p&lt;IMessage&gt; message)
{
try
{
if ( message != NULL ) { // &lt;------ Check NULL here !!!!!
// Is the message an ActiveMQMessage? (throws bad_cast otherwise)
p&lt;ActiveMQMessage&gt; activeMessage = p_dyncast&lt;ActiveMQMessage&gt; (message) ;
// Register the handler for client acknowledgment
activeMessage-&gt;setAcknowledger( smartify(this) ) ;
if( acknowledgementMode != ClientAckMode )
doAcknowledge(activeMessage) ;
}
}
catch( bad_cast&amp; bc )
{
// ignore
}
return message ;
ActiveMQ Cpp Windows Makefiles fail to link the test, and test-integration targets
The windows makefiles for the MinGW targets fail to link the test and test-integration targets.
When the code was submitted the makefiles were changed to build the library with the libactivemq-cpp.a name, but the windows makefiles still try and link the tests against libactivemq.a
activemq fails to work with spring-2.0-rc1
we get a failure trying to coerce a String into a File for the dataDirectory property on the DefaultPersistenceAdapterFactory
m2 assembly not working
It seems to not include the run.jar and has incorrect versions of things inside (e.g. should be using spring-2.0-rc1).
Can we get the assembly module such that the can go into the bin directory and run 'activemq' or java -jar run.jar and for things to work properly
can get a shutdown hang when using embedded broker with VM transport along with the activemq-web module
See attached thread dump. I think we just need to use a timeout on the close operations (such as to close consumers, sessions, producers)
Full thread dump Java HotSpot(TM) Client VM (1.5.0_04-b05 mixed mode, sharing):
&quot;Shutdown&quot; prio=1 tid=0x08385960 nid=0x5e99 in Object.wait() [0xaed7d000..0xaed7e130]
at java.lang.Object.wait(Native Method)
- waiting on &lt;0x88af01c8&gt; (a edu.emory.mathcs.backport.java.util.concurrent.locks.CondVar)
at java.lang.Object.wait(Object.java:474)
at edu.emory.mathcs.backport.java.util.concurrent.locks.CondVar.await(CondVar.java:75)
- locked &lt;0x88af01c8&gt; (a edu.emory.mathcs.backport.java.util.concurrent.locks.CondVar)
at edu.emory.mathcs.backport.java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:318)
at org.apache.activemq.transport.FutureResponse.getResult(FutureResponse.java:41)
at org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:72)
at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1130)
at org.apache.activemq.ActiveMQSession.syncSendPacket(ActiveMQSession.java:1660)
at org.apache.activemq.ActiveMQMessageConsumer.close(ActiveMQMessageConsumer.java:516)
at org.apache.activemq.web.WebClient.closeConsumers(WebClient.java:135)
- locked &lt;0x893e6558&gt; (a org.apache.activemq.web.WebClient)
at org.apache.activemq.web.WebClient.close(WebClient.java:145)
- locked &lt;0x893e6558&gt; (a org.apache.activemq.web.WebClient)
at org.apache.activemq.web.WebClient.valueUnbound(WebClient.java:318)
at org.mortbay.jetty.servlet.AbstractSessionManager$Session.unbindValue(AbstractSessionManager.java:899)
at org.mortbay.jetty.servlet.AbstractSessionManager$Session.invalidate(AbstractSessionManager.java:755)
- locked &lt;0x893caa88&gt; (a org.mortbay.jetty.servlet.HashSessionManager$Session)
at org.mortbay.jetty.servlet.AbstractSessionManager.doStop(AbstractSessionManager.java:551)
at org.mortbay.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:63)
at org.mortbay.jetty.servlet.SessionHandler.doStop(SessionHandler.java:124)
at org.mortbay.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:63)
at org.mortbay.jetty.handler.HandlerWrapper.doStop(HandlerWrapper.java:131)
at org.mortbay.jetty.handler.ContextHandler.doStop(ContextHandler.java:467)
at org.mortbay.jetty.webapp.WebAppContext.doStop(WebAppContext.java:477)
at org.mortbay.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:63)
at org.mortbay.jetty.handler.HandlerCollection.doStop(HandlerCollection.java:173)
at org.mortbay.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:63)
at org.mortbay.jetty.handler.HandlerCollection.doStop(HandlerCollection.java:173)
at org.mortbay.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:63)
at org.mortbay.jetty.handler.HandlerWrapper.doStop(HandlerWrapper.java:131)
at org.mortbay.jetty.Server.doStop(Server.java:242)
at org.mortbay.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:63)
at org.mortbay.jetty.Server$ShutdownHookThread.run(Server.java:450)
When using Topics with consumers with selectors over a network of brokers, only the first consumer gets messages delivered.
The subscription conduit is blocking out subsequent subscriptions from being propagated over the network bridge
The DestinationMap removeAll is removing too many nodes out of the map.
This was initially noticed because at times avisoryies stopped working for some cases. This is due to the way the Region uses a DestinationMap to find all the destinations that match a subscription.
A unit test that fails looks like:
{code:java}
public void testAddAndRemove() throws Exception {
put(&quot;FOO.A&quot;, v1);
assertMapValue(&quot;FOO.&gt;&quot;, v1);
put(&quot;FOO.B&quot;, v2); 
assertMapValue(&quot;FOO.&gt;&quot;, v1, v2);
Set set = map.removeAll(createDestination(&quot;FOO.A&quot;));
assertMapValue(&quot;FOO.&gt;&quot;, v2); // This Fails. nothing is left in FOO.&gt;
}
{code}
JMS connections using the http:// protocol may not detect connections failures correctly.
If for example the broker is restarted, the broker will not inform a client using the broker again that it's connection state is gone.
Also the client would startup a background poll thread before its' connection was established. This cause it to go into a busy loop hiting the server and the server sending back clientID not specified error messages until the ConnectionInfo was sent to the broker.
Broker Network connections over SSH tunnels do not get established.
Due to the way that ssh tunnels accept a connection but then close a socket if they cannot establish a connection to the remote host, the network connector fails to re-connect to the remote host when it is started.
problem with auto-ack and messages being redelivered in Stomp clients
For discussion see http://www.nabble.com/Stomp-and-ActiveMessaging-does-not-remove-messages-from-Queue-tf1889402.html#a5165844
support for non-XBean based XML configuration files does not seem to work
It seems we don't currently support regular Spring XML configuration files when using the 'activemq' command. 
Steps to reproduce:
[john@prokopiev jms]$ unzip incubator-activemq-4.0.1.zip
Archive: incubator-activemq-4.0.1.zip
creating: incubator-activemq-4.0.1/
creating: incubator-activemq-4.0.1/bin/
creating: incubator-activemq-4.0.1/conf/
creating: incubator-activemq-4.0.1/docs/
creating: incubator-activemq-4.0.1/example/
creating: incubator-activemq-4.0.1/example/activemq-web-console/
...
inflating: incubator-activemq-4.0.1/userGuide.html
inflating: incubator-activemq-4.0.1/var/activemq.log
[john@prokopiev jms]$ echo '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN//EN&quot;
&quot;http://www.springframework.org/dtd/spring-beans.dtd&quot;&gt;
&lt;beans&gt;
&lt;bean id=&quot;broker&quot; class=&quot;org.apache.activemq.broker.BrokerService&quot;
init-method=&quot;start&quot;&gt;
&lt;property name=&quot;transportConnectorURIs&quot;&gt;
&lt;list&gt;
&lt;value&gt;tcp://localhost:61234&lt;/value&gt;
&lt;/list&gt;
&lt;/property&gt;
&lt;/bean&gt;
&lt;/beans&gt; ' &gt; incubator-activemq-4.0.1/conf/activemq.xml
[john@prokopiev jms]$ cd incubator-activemq-4.0.1/bin
[john@prokopiev bin]$ sh activemq
ACTIVEMQ_HOME: /home/john/devel/java/jms/incubator-activemq-4.0.1
Loading message broker from: xbean:activemq.xml
INFO BrokerService - ActiveMQ 4.0.1 JMS Message Broker
(localhost) is starting
INFO BrokerService - For help or more information please
see: http://incubator.apache.org/activemq/
INFO JDBCPersistenceAdapter - Database driver recognized:
[apache_derby_embedded_jdbc_driver]
INFO JournalPersistenceAdapter - Journal Recovery Started from: Active
Journal: using 2 x 20.0 Megs at:
/home/john/devel/java/jms/incubator-activemq-4.0.1/bin/activemq-data/localhost/journal
INFO JournalPersistenceAdapter - Journal Recovered: 0 message(s) in
transactions recovered.
INFO TransportServerThreadSupport - Listening for connections at:
tcp://prokopiev.stc.donpac.ru:61234
INFO TransportConnector - Connector
tcp://prokopiev.stc.donpac.ru:61234 Started
INFO BrokerService - ActiveMQ JMS Message Broker
(localhost, ID:prokopiev.stc.donpac.ru-41458-1151926448246-1:0) started
ERROR: java.lang.RuntimeException: Failed to execute start task. Reason:
java.lang.ClassCastException: org.apache.activemq.broker.BrokerService
ERROR: java.lang.Exception: java.lang.ClassCastException:
org.apache.activemq.broker.BrokerService
INFO BrokerService - ActiveMQ Message Broker (localhost,
ID:prokopiev.stc.donpac.ru-41458-1151926448246-1:0) is shutting down
INFO TransportConnector - Connector
tcp://prokopiev.stc.donpac.ru:61234 Stopped
INFO VMTransportFactory - Shutting down VM connectors for
broker: localhost
INFO BrokerService - ActiveMQ JMS Message Broker
(localhost, ID:prokopiev.stc.donpac.ru-41458-1151926448246-1:0) stopped
The UdpTransport could potentialy fail to bind on linux.. caused the UdpTransportTest to fail sometimes.
[junit] [ERROR] Test org.apache.activemq.transport.udp.UdpTransportTest FAILED
Build ships without incompatitable commons-logging and log4j
commons-logging calls Category.log in lo4j, which is depericated in the version of log4j that ships in 4.0.1.
Please upgrade the commons-log to commons-logging-1.1.jar
Client and Broker hang trying to start a connection
Every now and again a client hangs connecting to the broker. The broker is configured with the default activemq.xml. The stack dumps are as follows:
ACTIVEMQ_HOME: C:\Java\incubator-activemq-4.0\bin\..
Loading message broker from: xbean:activemq.xml
INFO BrokerService - ActiveMQ 4.0 JMS Message Broker (localhos
t) is starting
INFO BrokerService - For help or more information please see:
http://incubator.apache.org/activemq/
INFO ManagementContext - JMX consoles can connect to service:jmx:r
mi:///jndi/rmi://localhost:1099/jmxrmi
INFO JDBCPersistenceAdapter - Database driver recognized: [apache_derby
_embedded_jdbc_driver]
INFO JournalPersistenceAdapter - Journal Recovery Started from: Active Jou
rnal: using 5 x 20.0 Megs at: C:\Java\incubator-activemq-4.0\activemq-data\journ
al
INFO JournalPersistenceAdapter - Journal Recovered: 1 message(s) in transa
ctions recovered.
INFO TransportServerThreadSupport - Listening for connections at: tcp://SIM-J
amesM:61616
WARN MulticastDiscoveryAgent - brokerName not set
INFO TransportConnector - Connector default Started
INFO TransportServerThreadSupport - Listening for connections at: tcp://SIM-J
amesM:61613?wireFormat=stomp
INFO TransportConnector - Connector stomp Started
INFO NetworkConnector - Network Connector default Started
INFO BrokerService - ActiveMQ JMS Message Broker (localhost, I
D:SIM-JamesM-2205-1149180591980-1:0) started
WARN ManagedTransportConnection - Failed to unregister mbean: org.apache.ac
tivemq:BrokerName=localhost,Type=Connection,ConnectorName=default,Connection=9
the stack dump is:
&quot;main&quot; prio=6 tid=0x000379d0 nid=0x93d0 in Object.wait() [0x0007e000..0x0007fc40
]
at java.lang.Object.wait(Native Method)
- waiting on &lt;0x02b66278&gt; (a edu.emory.mathcs.backport.java.util.concurr
ent.CountDownLatch)
at java.lang.Object.wait(Object.java:474)
at edu.emory.mathcs.backport.java.util.concurrent.CountDownLatch.await(C
ountDownLatch.java:179)
- locked &lt;0x02b66278&gt; (a edu.emory.mathcs.backport.java.util.concurrent.
CountDownLatch)
at org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatN
egotiator.java:73)
at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.ja
va:44)
- locked &lt;0x02b64098&gt; (a java.lang.Object)
at org.apache.activemq.transport.ResponseCorrelator.asyncRequest(Respons
eCorrelator.java:68)
at org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorr
elator.java:73)
at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnect
ion.java:1131)
at org.apache.activemq.ActiveMQConnection.ensureConnectionInfoSent(Activ
eMQConnection.java:1219)
- locked &lt;0x02b602c0&gt; (a org.apache.activemq.ActiveMQConnection)
at org.apache.activemq.ActiveMQConnection.start(ActiveMQConnection.java:
435)
Messages Sent by JMS that contain header properties cause error when STOMP client registers a Subscriber
I am using the lastest 4.0 release build of ActiveMQ and I have been trying to produce messages in a JMS client and receive the messages in a STOMP client.
What I have found is that if the JMS Client adds header properties to the message to be delivered to ActiveMQ then when I subscribe with the STOMP client I am receiving the Error listed below. If I remove all header properties then the message is transmitted correctly. I have also found that if I send messages with a STOMP client that has header properties then everything works correctly.
java.lang.NullPointerException
at java.util.Hashtable.put(Unknown Source)
at java.util.Hashtable.putAll(Unknown Source)
at org.apache.activemq.transport.stomp.FrameBuilder.addHeaders(FrameBuilder.java:65)
at org.apache.activemq.transport.stomp.Subscription.receive(Subscription.java:76)
at org.apache.activemq.transport.stomp.StompWireFormat.writeCommand(StompWireFormat.java:154)
at org.apache.activemq.transport.stomp.StompWireFormat.marshal(StompWireFormat.java:305)
at org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:124)
at org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:141)
at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:44)
at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)
at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:211)
at org.apache.activemq.broker.AbstractConnection.processDispatch(AbstractConnection.java:581)
at org.apache.activemq.broker.AbstractConnection.iterate(AbstractConnection.java:597)
at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:87)
at org.apache.activemq.thread.DedicatedTaskRunner.access$000(DedicatedTaskRunner.java:24)
at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:38)
Error while using management interface on messages with binary data.
I'm sending binary data through STOMP (with a content-length header). When I go into jconsole and try to use 'browse' to view the message, I get this exception on the server side:
javax.management.openmbean.OpenDataException: Argument's element itemValues[7]=&quot;[B@40e1f305&quot; is not a valid value for this item (itemName=BodyPreview,itemType=javax.management.openmbean.ArrayType(name=[Ljava.lang.Byte;,dimension=1,elementType=javax.management.openmbean.SimpleType(name=java.lang.Byte))).
at javax.management.openmbean.CompositeDataSupport.&lt;init&gt;(CompositeDataSupport.java:145)
at javax.management.openmbean.CompositeDataSupport.&lt;init&gt;(CompositeDataSupport.java:190)
at org.apache.activemq.broker.jmx.OpenTypeSupport.convert(OpenTypeSupport.java:253)
at org.apache.activemq.broker.jmx.DestinationView.browse(DestinationView.java:91)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at com.sun.jmx.mbeanserver.StandardMetaDataImpl.invoke(StandardMetaDataImpl.java:414)
at com.sun.jmx.mbeanserver.MetaDataImpl.invoke(MetaDataImpl.java:220)
at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:815)
at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:784)
at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1408)
at javax.management.remote.rmi.RMIConnectionImpl.access$100(RMIConnectionImpl.java:81)
at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1245)
at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1341)
at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:782)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:585)
at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:294)
at sun.rmi.transport.Transport$1.run(Transport.java:153)
at java.security.AccessController.doPrivileged(Native Method)
at sun.rmi.transport.Transport.serviceCall(Transport.java:149)
at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:460)
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:701)
at java.lang.Thread.run(Thread.java:595)
Error frames are not pushed out immediately
If you send a malformed SEND frame to the server (like having a newline after your payload and before the NULL when using a content-length header), you don't get the ERROR frame back from the server immediately as you did with 3.2.2. With both 4.0M4 and the SNAPSHOT from March 20, I had to send another message to the server to see the ERROR frame.
This was quite confusing when implementing a new STOMP client.
XBean has a runtime issue with Spring 2.0M2
Apparently there is an issue with XBean now that Spring 2.0 (starting with M2) is compiled against a Java 5 compiler (http://jira.codehaus.org/browse/XB-7). It's probably worth investigating how long before XBean releases a fix and postponing the 4.0 release until they do. If not, at least documenting in a known issues list that ActiveMQ 4.0 can't working with 2.0M2 and later until a later release where they do fix it.
												</span>
							</div>
			<div>
							</div>
			<div>
									<p><strong>Find millions of documents on Course Hero - Study Guides, Lecture Notes, Reference Materials, Practice Exams and more. Course Hero has millions of course specific materials providing students with the best way to expand their education.</strong></p>
					<p>Below is a small sample set of documents:</p>
					<div><strong><a href="/file/7204791/2007-01/">2007-01</a></strong></div><div>Iowa State - CPRE - 556</div><div>RMI support not marshalling IDLEntity CORBA objects correctly.The RMI support is marshalling all IDLEntity interface objects by value. The support needs to check to see if the object instance is a CORBA object and delay the decision to marshal as an CORB</div><div><strong><a href="/file/7204792/2007-04/">2007-04</a></strong></div><div>Iowa State - CPRE - 556</div><div>IDLToWSDL incorrectly maps all typedefs to restrictions.Consider IDL like :typedef string PropertyName;typedef string PropertyValue;struct Property cfw_PropertyName name;PropertyValue value;;typedef sequence &amp;lt;Property&amp;gt; PropertyList;typedef Proper</div><div><strong><a href="/file/7204793/2007-05/">2007-05</a></strong></div><div>Iowa State - CPRE - 556</div><div>NullPointerException in CorbaDestinationI got NullPointerException in line 256 of CorbaDestinationif (location.startsWith(&amp;quot;http:/localhost/&amp;quot;) cfw_ / line 256location = location.substring(&amp;quot;http:/localhost/&amp;quot;.length();should check if location is null fi</div><div><strong><a href="/file/7204794/2007-06/">2007-06</a></strong></div><div>Iowa State - CPRE - 556</div><div>IDLToWSDL does not generate correct WSDL for certain combinations of forward declarationIDL which declares a forward declaration for an interface or struct, then provides the full declaration for the forward declared interface/struct, followed by the use</div><div><strong><a href="/file/7204795/2008-04/">2008-04</a></strong></div><div>Iowa State - CPRE - 556</div><div>Increase the number of open files for unit tests under HudsonLucene.zones.apache.org and I assume hudson.zones limit the number of file handles to 256. TestMiniMRDFSSort runs better with more file handles. (I set it to 10000 in my testing, but a smaller </div><div><strong><a href="/file/7204796/2008-05/">2008-05</a></strong></div><div>Iowa State - CPRE - 556</div><div>Master doesn&#039;t see regionserver edits because of clock skewThe streamy folks had a cluster where regionserver was 2 minutes in advance of the master. On split, regionserver would update .META. with split info but scanners opened on the master wouldn&#039;t se</div><div><strong><a href="/file/7204797/2008-06/">2008-06</a></strong></div><div>Iowa State - CPRE - 556</div><div>HLog#cacheFlushLock not cleared; hangs a regionI have a region that is stuck in a close that was ordained by a split. Here is what I have from the log pertaining to the stuck region:cfw_code4 6416 2008-05-29 22:29:03,433 INFO org.apache.hadoop.hbase.HR</div><div><strong><a href="/file/7204798/2008-07/">2008-07</a></strong></div><div>Iowa State - CPRE - 556</div><div>codegen plugin fails due to missing jarWhen clicking &amp;quot;Finish&amp;quot; in the last step to generate Java code from WSDL, the following exception occurs. I believe this is a bug introduced by the commithttp:/mail-archives.apache.org/mod_mbox/ws-axis-cvs/200802.m</div><div><strong><a href="/file/7204799/2008-08/">2008-08</a></strong></div><div>Iowa State - CPRE - 556</div><div>dfs exception and regionserver stuck during heavy write loadIt&#039;s a 3 node setup, each runs datanode and regionserver. One runs as hbase master and hadoop namenode.After some heavy write load via java client, the client is stuck. Stack trace on the regio</div><div><strong><a href="/file/7204800/2008-09/">2008-09</a></strong></div><div>Iowa State - CPRE - 556</div><div>make feature project build successfully according to recent refactor of SMX3 containermake servicemix-utils build successfullyshould add missing stax impl dependency to fix test failuresTests in error:testStaxSourceOnStream(org.apache.servicemix.jbi.j</div><div><strong><a href="/file/7204801/2008-10/">2008-10</a></strong></div><div>Iowa State - CPRE - 556</div><div>WEB: All handlers assigned to any bean should be cleared after a web request has completedCurrently the handler is thread local and softreferenced. Anyway, this could happen :* A get arrives, trying to modify a bean* The modification fails, but the exc</div><div><strong><a href="/file/7204802/2008-11/">2008-11</a></strong></div><div>Iowa State - CPRE - 556</div><div>BeanEditForm guide example about creating the FieldTranslator is inaccurate and out of dateA quote from http:/tapestry.formos.com/nightly/tapestry5/guide/beaneditform.html on 8-Sep-2008:public FieldTranslator getCurrencyTranslator()cfw_Translator tran</div><div><strong><a href="/file/7204803/2008-12/">2008-12</a></strong></div><div>Iowa State - CPRE - 556</div><div>XMLMenuModel:Illegal attribute in menu.xsd.According to xml schema structures recommendation(http:/www.w3.org/TR/xmlschema-1/),section 3.2.6the name of an attribute should not match &#039;xmlns&#039;.Changes required in Distribution build files1. Change version</div><div><strong><a href="/file/7204804/2009-01/">2009-01</a></strong></div><div>Iowa State - CPRE - 556</div><div>QueryParsing.toString() should check ConstantScoreRangeQuery before RangeQueryThiscfw_code:title=QueryParsing.toString()if (query instanceof TermQuery) cfw_: else if (query instanceof RangeQuery) cfw_: else if (query instanceof ConstantScoreRangeQu</div><div><strong><a href="/file/7204805/2009-02/">2009-02</a></strong></div><div>Iowa State - CPRE - 556</div><div>binary type isn&#039;t documented nor demonstrated in the tutorialThe thrift IDL has a type called &amp;quot;binary&amp;quot; for blobs but it&#039;s not listed in the tutorial nor in the documentation.AutoLinkResolver does not work with &amp;lt;a href=&amp;quot;#internal&amp;quot;&amp;gt;Internal link&amp;lt;/a&amp;gt;I thi</div><div><strong><a href="/file/7204806/2009-03/">2009-03</a></strong></div><div>Iowa State - CPRE - 556</div><div>Memory not released in SoftRefFilesCacheImplementation of method putFile(final FileObject file) does not remove references from refReverseMap when adding a new file.#current implementationcfw_noformatsynchronized (files)cfw_files.put(file.getName(),</div><div><strong><a href="/file/7204807/2009-05/">2009-05</a></strong></div><div>Iowa State - CPRE - 556</div><div>Support &amp;quot;templateExpression&amp;quot; and &amp;quot;templateType&amp;quot; in tiles-templateCurrently, attributes &amp;quot;templateType&amp;quot; and &amp;quot;templateExpression&amp;quot; are not supported in tiles-template and depending modules.These attributes should be supported.Deprecate &amp;quot;initContainer&amp;quot; tag</div><div><strong><a href="/file/7204808/2009-09/">2009-09</a></strong></div><div>Iowa State - CPRE - 556</div><div>feature name for cxf-wsdl-first-osgi-package example should be examples-cxf-wsdl-first-osgi-packagebut not example-cxf-wsdl-first-osgi-package, to keep the same naming rule as other examplesSimpleServer: docs need updating for Tomcat 6The current instr</div><div><strong><a href="/file/7204809/2010-05/">2010-05</a></strong></div><div>Iowa State - CPRE - 556</div><div>fileinstall does not recognize jars if it does not have Bundle-SymbolicName and Bundle-VersionFileInstall does not recognize jar files that have only Bundle-SymbolicName. I see the following code in BundleTransformer.java: if (m.getMainAttributes().getV</div><div><strong><a href="/file/7204810/2010-11/">2010-11</a></strong></div><div>Iowa State - CPRE - 556</div><div>Avoid dropping messages off the client request pathCXF CamelTransport and &amp;quot;Can&#039;t find input stream in message&amp;quot;When using a JaxWS proxy with camel transport, to a route with only one processor, CXF fail with the message &amp;quot;Can&#039;t find input stream in messag</div><div><strong><a href="/file/7204811/PADP6910-Feb-1-Notes-for-Iris/">PADP6910 - Feb 1 Notes (for Iris)</a></strong></div><div>UGA - PADP - 6910</div><div>Tuesday, February 1, 2011:Class Structure today:- Review- Segue- 4 Presentations (of each chapter)- Discussion/Class ExerciseReview: Classical Approach- the documentary: The Storm lets connect to the Classical approach-Breakdown in Bureaucracy We</div><div><strong><a href="/file/7204812/GEOG1111-Lecture-Notes/">GEOG1111 Lecture Notes</a></strong></div><div>UGA - GEOG - 1111</div><div>GEOG 1111 (T/R 11:00-12:15), Matthew Miller Class Notes1Thursday, January 7, 2010:Introduction:- 7th edition of the Christopherson (black, &amp;lt; yr old; 2009): dont have to have the 7thedition; CD NOT Required; if get an older edition, will have the info</div><div><strong><a href="/file/7204813/GEOG1111-Post-Exam-2/">GEOG1111 Post-Exam 2</a></strong></div><div>UGA - GEOG - 1111</div><div>GEOG1111: POST-2nd EXAMMatthew MillerCHAPTER 10: GLOBAL CLIMATE SYSTEMS:Thursday, March 4, 2010:Climate:- Climates are the patterns of weather that a place experiences over time (years)-&amp;gt; Climates deal with long-term trends- Climates are very diver</div><div><strong><a href="/file/7204814/GEOL1111-Lecture-Notes/">GEOL1111 Lecture Notes</a></strong></div><div>UGA - GEOG - 1111</div><div>GEOG 1111 (T/R 11:00-12:15), Matthew Miller Class Notes1Thursday, January 7, 2009:Introduction:- 7th edition of the Christopherson (black, &amp;lt; yr old; 2009): dont have to have the 7thedition; CD NOT Required; if get an older edition, will have the info</div><div><strong><a href="/file/7204815/INTL3200-lecture-notes-post-midterm/">INTL3200 - lecture notes post midterm</a></strong></div><div>UGA - INTL - 3200</div><div>Monday, Oct 12, 2009- TicknerRoadmap:- Feminism as a Discipline- Tickners meta-disciplinary analysis- Petersons functional ApproachFeminism has been around even longer than liberalism -&amp;gt; straw man argumentDifferent types of feminism:In early days,</div><div><strong><a href="/file/7204816/INTL4220-Spring-2011-Tessman/">INTL4220 (Spring 2011 - Tessman)</a></strong></div><div>UGA - INTL - 4220</div><div>Brock TessmanINTL 4220: International Conflict Spring 2011Thursday, January 13, 2011:- Tessman teaches classes in international conflict, grand strategy, security studies- Old school thinker all sorts of international conflict (terrorism, civil war (b</div><div><strong><a href="/file/7204817/INTL4440-Notes-for-Madison-110210/">INTL4440 Notes for Madison (11:02:10)</a></strong></div><div>UGA - INTL - 4440</div><div>Dr. Johnson Strat IntelNotes for MadisonTuesday, November 2, 2010:Study Abroad, Stellenbosch, South Africa:- 4 week trip- Sociology/INTL study abroad program in South Africa (see where NelsonMandela sat in jail, )- Classes: Politics of development </div><div><strong><a href="/file/7204818/INTL4460-NOTES-POST-Midterm/">INTL4460 NOTES - POST-Midterm</a></strong></div><div>UGA - INTL - 4460</div><div>INTL4460 - POST-MIDTERM NOTESNikonovSpring 2010Thursday, Feb 4, 2010:Cooperative Threat Reduction: G8 Global Partnership- the nature of nonproliferation has changed over the course of its history- shift from USSR vs Russia to question of where could</div><div><strong><a href="/file/7204819/INTL4460-NOTES/">INTL4460 NOTES</a></strong></div><div>UGA - INTL - 4460</div><div>INTL4460Arms Control and DisarmamentNikonov (T/R 12:30-1:45)1Thursday, Jan 7, 2010Dmitriy Nokonov,- no doubt will talk about arms control and disarmament -&amp;gt; also added a section onnonproliferation- *This course is about WMD - the danger it causes</div><div><strong><a href="/file/7204820/PADP-711-Book-Notes-for-Final-Exam/">PADP 711- Book Notes for Final Exam</a></strong></div><div>UGA - PADP - 7110</div><div>PADP 7110Final Exam Book NotesCHAPTER 6: SAMPLINGCHAPTER 9: SURVEY RESEARCH-3 general features of survey research:o 1) A large number of respondents are chosen through probability samplingprocedures to represent the population of inters.o 2) Syste</div><div><strong><a href="/file/7204821/PADP7110-Bozeman-Fall-2011/">PADP7110 (Bozeman) - Fall 2011</a></strong></div><div>UGA - PADP - 7110</div><div>1PADP7110: Research MethodsMonday, August 15, 2011:Fall 2011HebdonNOTE: Dr. Bozeman will call on you even when you dont raise your hand. This class is muchmore interactive than most classes (even though is a large class).-Most people in this class</div><div><strong><a href="/file/7204822/PADP-7210-POST-MIDTERM-NOTES-Dr-Prittie-Sp2012/">PADP 7210 - POST-MIDTERM NOTES (Dr. Prittie - Sp2012)</a></strong></div><div>UGA - PADP - 7210</div><div>PADP7210: Post-Midterm NotesSpring 2012Dr. PrittieThursday, September 27, 2012 (right after midterm):- Angel Food Ministries Caseo What was going right? Crazy good at delivering groceries not bad food like what wegenerally think go with a food bank</div><div><strong><a href="/file/7204823/PADP7210-Intro-to-Nonprofits-Fall-2012-Class-Notes/">PADP7210 (Intro to Nonprofits Fall 2012) Class Notes</a></strong></div><div>UGA - PADP - 7210</div><div>PADP7210: Intro to NonprofitsFall 2012Dr. PrittieThursday, August 16, 2012:- Joan Prittie: 2nd year teaching this class, 5th in MPA; law and nonprofit backgroundso On a practical note, the time that she devotes to this class is class time but ifever</div><div><strong><a href="/file/7204824/PADP7210-Class-Notes-09-13-2012/">PADP7210 Class Notes (09-13-2012)</a></strong></div><div>UGA - PADP - 7210</div><div>PADP7210: Intro to NonprofitsFall 2012Dr. PrittieThursday, September 13, 2012:PPT: Non Profit Policies: Important policies to build and maintain public trust starting to look more closely at our boards difference between management andgovernance wh</div><div><strong><a href="/file/7204825/PADP7900-Guo-Sp2012-Class-Notes/">PADP7900 (Guo) - Sp2012 Class Notes</a></strong></div><div>UGA - PADP - 7900</div><div>PADP 7900: Managing VolunteersThursday, January 12, 2012:GuoSpring 2012-self intro o born and raised in Hunan province small town of ~1M small town has a lotof history was the capitol city of the first dynasty in China born in very interesting tim</div><div><strong><a href="/file/7204826/PADP6930-Post-Midterm-Notes/">PADP6930 - Post-Midterm Notes</a></strong></div><div>UGA - PADP - 6930</div><div>PADP6930: Post-Midterm NotesDr. CarrollFall 20121Monday, October 15, 2012 (political discussion on tax revenue right after midterm):1) Who should be responsible for more/less of the tax burden? Why?GOP:- hard to get a figure on who is responsible f</div><div><strong><a href="/file/7204827/PADP6930-Carroll-Fall-2012-Class-Notes/">PADP6930 (Carroll-Fall 2012) Class Notes</a></strong></div><div>UGA - PADP - 6930</div><div>1PADP6930 Public &amp;amp; Financial Admin. Dr. CarrollFall 2012Monday, August 13, 2012:Dr. Carroll had been at UGA since 2006, was part of the faculty at UK-Knoxville for 2 yearsbefore that; from Milwaukee, WI and got her bachelors (poly sci and philosophy)</div><div><strong><a href="/file/7204828/PADP6930-Carroll-Oct-23-Notes/">PADP6930 (Carroll) - Oct 23 Notes</a></strong></div><div>UGA - PADP - 6930</div><div>1PADP6930: Post-Midterm NotesDr. CarrollFall 2012Monday, October 22, 2012:PPT: Tax Systems and Policies (Mikesell, Chapter 7) tonight is just a broad overview of this stuff, to try to cut through the political jargonConstitutional Framework &amp;amp; Nexus</div><div><strong><a href="/file/7204829/PADP6950-Class-Notes-1st-day-of-class/">PADP6950 Class Notes (1st day of class)</a></strong></div><div>UGA - PADP - 6950</div><div>Dr. FertigPADP6950: Foundations of Policy AnalysisSpring 2011Monday, January 24, 2011:- like snacks going to have them every day- please call Angie or Dr. Angie- philosophy: you are responsible for what Angie says in class &amp;amp; what is on thelecture n</div><div><strong><a href="/file/7204830/PHIL2030H-Kant-Reading-Question/">PHIL2030H - Kant Reading Question</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H11 October 2010Reading Question: KantQuestion 1. What is the Good Will? Why does Kant think it is so important? What is therelationship between the Good Will and our moral Duty? What do you think of his</div><div><strong><a href="/file/7204831/PHIL2030H-Reading-Question-1-Plato-and-Hume/">PHIL2030H - Reading Question 1 (Plato and Hume)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H23 August 2010Reading Question: Plato and HumeQuestion: 1. What two roles does Hume claim reason plays in our deliberations? Whycant reason alone guide our actions? Explain whether or not you think Hume </div><div><strong><a href="/file/7204832/PHIL2030H-Reading-Question-2-Ayer-and-Searle/">PHIL2030H - Reading Question 2 (Ayer and Searle)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H31 August 2010Reading Question: Ayer and SearleQuestion: 1. Ayer claims that propositions containing moral, or normative terms, aremeaningless. How does he argue for this claim? Also, if moral judgments </div><div><strong><a href="/file/7204833/PHIL2030H-Reading-Question-3-Searle-Flew-Foot-and-Korsgaard/">PHIL2030H - Reading Question 3 (Searle, Flew, Foot, and Korsgaard)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H7 September 2010Reading Question 3: Searle, Flew, Foot, and KorsgaardQuestion: 2. How does Foot address the problems raised by non-naturalists such asAyer? How does her argument proceed? Do you think her</div><div><strong><a href="/file/7204834/PHIL2030H-Reading-Question-4-Korgaard-and-Rawles/">PHIL2030H - Reading Question 4 (Korgaard and Rawles)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H14 September 2010Reading Question 4: Korsgaard and RawlsQuestion: 4. What would Rawls account of justice require, practically speaking, if wewere to adopt it? In answering, you should briefly explain his</div><div><strong><a href="/file/7204835/PHIL2030H-Reading-Question-7/">PHIL2030H - Reading Question 7</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL 2030H20 October 2010Reading Question 7Question: 1. Feldman argues that we can tweak our maxims so that theyconform to the categorical imperative. Explain the case he appeals to in hisargument. Do you think </div><div><strong><a href="/file/7204836/PHIL2030H-Reading-Question-8-Mill-and-Williams/">PHIL2030H - Reading Question 8 (Mill and Williams)</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL2030H2 November 2010Reading Question 8: Utilitarianism3. What is one of Williams concerns with utilitarianism? Explain hisanalysis.In examining utilitarianism, Williams is concerned with the inability of the</div><div><strong><a href="/file/7204837/PHIL2030H-Reading-Questions-9/">PHIL2030H - Reading Questions 9</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonPHIL2030HDr. Matthew Schneider8 November 2010Reading Question 11. What is the difference between act and rule utilitarianism? How mightattention to this distinction help solve some of the puzzle casesdiscussed in the text and in cla</div><div><strong><a href="/file/7204838/PHIL2030H-Reading-Question-5/">PHIL2030H Reading Question 5</a></strong></div><div>UGA - PHIL - 2030H</div><div>Alexandra HebdonDr. Matthew SchneiderPHIL 2030H Reading Question 520 September 2010Reading Question: Rawls, Narveson, and SterbaQuestion 2. What is Liberty? How do libertarians such as Narveson utilize the concept inan argument for their political v</div><div><strong><a href="/file/7204839/stat1/">stat1</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204840/stat2/">stat2</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204841/stat3/">stat3</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204842/stat4/">stat4</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204843/stat5/">stat5</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204844/stat6/">stat6</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204845/stat7/">stat7</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204846/stat8/">stat8</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204847/stat9/">stat9</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204848/stat10/">stat10</a></strong></div><div>Texas Tech - MATH - 2300</div><div></div><div><strong><a href="/file/7204849/Outline-for-amfamsocamppol-thoughts/">Outline for amfamsoc&amp;pol thoughts</a></strong></div><div>Old Dominion - SOC - 420</div><div>April Goode10/6/2011OutlineThesis Statement: People of color have experienced a number of hardships from the beginningsof slavery to present day by the white community. Because of the intended mental and physicalbreakdown, or assimilation, they not o</div><div><strong><a href="/file/7204850/AA-socamppol-thought-preference-group-impact-question/">AA soc&amp;pol thought preference group impact question</a></strong></div><div>Old Dominion - SOC - 420</div><div>April Goode6/26/2012Essay QuestionDescribe and explain how race, gender, class, and/or sexual preference groups impacts theiropportunities in America.RaceIn America there is still evidence of racism, meaning race does matter. Racism is thebelief in</div><div><strong><a href="/file/7204851/soc-change-n-soc-movement-exam-3-essay-question/">soc change n soc movement exam 3 essay question</a></strong></div><div>Old Dominion - SOC - 405</div><div>April Goode4/2/2012SOC405The world is becoming a global system, that means everything ultimately effectseverything else. Basically, globalization is growing and everyone is being affected by it.Globalization is the emerging and continuously changing </div>											</div>
		</div>
		<div id="related_flashcard_sets" class="ajax_load" data-params="filehash=b8f510dec43f366c196ae2bf0e545925ad9311f9"></div>
	</div>
</div>
<script src="/javascript/modal.js"></script>
<script src="/javascript/common/select2.js"></script>
<script src="/javascript/expert-ready.js" type="text/javascript" charset="utf-8">
</script>
<script src="/javascript/expert-home.js" type="text/javascript" charset="utf-8">
</script>
<script>
jQuery(document).ready(function(){
	jQuery('#doc-rating').raty({
		readOnly: true,
		score: function() {
			return jQuery(this).attr('data-score');
		}
	});
})
</script>
<!--[if (gte IE 6)&(lte IE 8)]>
<script>
jQuery(document).ready(function(){
	jQuery(".ch-doc-large-thumbnail-container").live( 'mouseover', function() {
		jQuery(this).find(".ch-doc-large-thumbnail-details").show();
	}).live('mouseout', function() {
		jQuery(this).find(".ch-doc-large-thumbnail-details").hide();
	});
})
</script>
<![endif]-->
<!--
<PageMap>
  <DataObject type="docinfo">
		<Attribute name="schoolid">864</Attribute>
	<Attribute name="deptid">2012</Attribute>
	<Attribute name="coursenum">556</Attribute>
					<Attribute name="docd">20121012</Attribute>
				<Attribute name="dt">0</Attribute>
		<Attribute name="y">212</Attribute>
	<Attribute name="uk">2</Attribute>
	<Attribute name="ku">1</Attribute>
	<Attribute name="ukrev">2</Attribute>
	<Attribute name="kurev">1</Attribute>
	<Attribute name="ukone">1</Attribute>
	<Attribute name="ytestnew">2</Attribute>
	<Attribute name="ytestold">1</Attribute>
	<Attribute name="qst">answered</Attribute>
	<Attribute name="isd">1</Attribute>
  </DataObject>
	<DataObject type="document">
		<Attribute name="title">2006-07</Attribute>
		<Attribute name="filehash">b8f510dec43f366c196ae2bf0e545925ad9311f9</Attribute>
		<Attribute name="db_filename">7204790</Attribute>
		<Attribute name="page_count">273</Attribute>
		<Attribute name="school_type">HIGHER</Attribute>
		<Attribute name="doc_source">user</Attribute>
		<Attribute name="doc_type">txt</Attribute>
		<Attribute name="school_name">Iowa State</Attribute>
		<Attribute name="school_id">864</Attribute>
		<Attribute name="dept_acro">CPRE</Attribute>
		<Attribute name="dept_id">2012</Attribute>
		<Attribute name="course_name">Scalabla Sofwatre Engineering</Attribute>
		<Attribute name="course_num">556</Attribute>
		<Attribute name="course_id">1526018</Attribute>
		<Attribute name="prof_name">Sibran</Attribute>
		<Attribute name="year">2012</Attribute>
		<Attribute name="term">3</Attribute>
		<Attribute name="date">2012-10-12 10:36:34</Attribute>
		<Attribute name="gs_date">20121012</Attribute>
		<Attribute name="canid"></Attribute>
	</DataObject>
	<DataObject type="stats">
		<Attribute name="created">2012-10-12 10:36:34</Attribute>
		<Attribute name="modified">2012-10-12 10:36:34</Attribute>
		<Attribute name="gs_date">20121012</Attribute>
		<Attribute name="priority">100</Attribute>
		<Attribute name="course_tagged">1</Attribute>
		<Attribute name="course_tagged_big">999999999</Attribute>
	</DataObject>
	<DataObject type="course_tag">
		<Attribute name="school_name">Iowa State</Attribute>
		<Attribute name="school_id">864</Attribute>
		<Attribute name="dept_acro">CPRE</Attribute>
		<Attribute name="dept_id">2012</Attribute>
		<Attribute name="course_name">Scalabla Sofwatre Engineering</Attribute>
		<Attribute name="course_num">556</Attribute>
		<Attribute name="course_id">1526018</Attribute>
	</DataObject>
</PageMap>
-->

<script type="text/javascript">
    var dcJsHost = (('https:' == document.location.protocol) ? 'https://' : 'http://');
    document.write(unescape("%3Cscript src='" + dcJsHost + "stats.g.doubleclick.net/dc.js' type='text/javascript'%3E%3C/script%3E"));
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    /*
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
*/
</script>


<script type="text/javascript">
    var recording_scrolling_text_version = false;
    jQuery(document).ready(function(){
        var pageTracker = _gat._getTracker("UA-1389869-2");
        if (jQuery(".ch-document-excerpt").length > 0) {
            jQuery(".ch-document-excerpt").scroll( function(){
                if (!recording_scrolling_text_version) {
                    pageTracker._trackEvent('Scrolling', 'ScrolledTextVersion', 'UserIsScroller', 1);
                    //_gaq.push(['_trackEvent', 'Scrolling', 'ScrolledTextVersion', 'UserIsScroller', 1]);
                    recording_scrolling_text_version = true;
                }
            });
        }
    });


</script>

<script type="text/javascript">

try {
    if (utmx('combination') != undefined) {
        var l = document.location, s = l.search;
        s = s + (s.length ? '&' : '?') + 'combination=' + utmx('combination');
        var pageTracker = _gat._getTracker("UA-1389869-2");
        
        pageTracker._setCustomVar(1, "usertype", "", 1);
                
        pageTracker._trackPageview(l.pathname + s);
    }
    else {
        var pageTracker = _gat._getTracker("UA-1389869-2");
        pageTracker._initData();
        
        pageTracker._setCustomVar(1, "usertype", "", 1);
                
        pageTracker._trackPageview();
    }
}catch(err){
        var pageTracker = _gat._getTracker("UA-1389869-2");
        pageTracker._initData();
        
        pageTracker._setCustomVar(1, "usertype", "", 1);
                
        pageTracker._trackPageview();
}
 
</script>
<script type="text/javascript">

adroll_adv_id = "RMA4JRK3LBCRFDGPVVO45A";
adroll_pix_id = "4D6DGYEGP5GENH5XDDV55J";
(function () {
var oldonload = window.onload;
window.onload = function(){
  __adroll_loaded=true;
  var scr = document.createElement("script");
  var host = (("https:" == document.location.protocol) ?
"https://s.adroll.com" : "http://a.adroll.com");
  scr.setAttribute('async', 'true');
  scr.type = "text/javascript";
  scr.src = host + "/j/roundtrip.js";
  document.documentElement.firstChild.appendChild(scr);
  if(oldonload){oldonload()}};
}());

</script>






<div id="ch-footer-wrapper" class="ch-wrapper">
	<div class="ch-container">
									<div class="ch-certificates">
					
<a href="https://seal.verisign.com/splash?form_file=fdf/splash.fdf&dn=www.coursehero.com" target="_blank" rel="nofollow" class="security-seals-verisign"></a>
<a class="security-seals-bbb"></a>
<a href="http://privacy-policy.truste.com/click-with-confidence/wps/en/www.coursehero.com" target="_blank"  rel="nofollow" class="security-seals-truste"></a>

				</div>
									<script type="text/javascript">
				var __fList_network = true;
				var __fList_textbook = false;
				var __fList_concepts = true;
				var __fList_homework = true;
				var __fList_skills = true;
			</script>
			
											  					<div class="ajax_load" id="ajax_footer_sitemap"></div>
				  										<div class="ch-footerlinks" id="ft-links-id">
				<ul>
					<li><a href="/sitemap/">Sitemap</a></li>
					<li><a href="/tutors/problems/">Tutors</a></li>
					<li><a href="/keywords/">Educational Concepts</a></li>
					<li><a href="/textbooks/">Textbooks</a></li>
					<li><a href="http://blog.coursehero.com">Blog</a></li>
					<li><a href="/study-skills/">Study Skills</a></li>
                    <li><a href="/subjects/">Subjects</a></li>
                    <li><a href="/standardized-tests/">Standardized Tests</a></li>
				</ul>
			</div>
				</div>
</div>


<script src="/javascript/common/select2.js"></script>
<script src="/min/?f=/javascript/jquery-ui-1.8.19.custom.min.js,/javascript/google_autocomplete.js,/javascript/jquery.raty.min.js,/javascript/jstz-1.0.4.min.js,/javascript/jquery.scrollspy.js,/javascript/jquery.ui.widget.js" type="text/javascript" charset="utf-8"></script>
<script src="/min/?f=/javascript/jquery.iframe-transport.js,/javascript/jquery.fileupload.js,/javascript/footer.js,/javascript/jquery.jcarousel.min.js,/javascript/jquery.boxy.js,/javascript/classes/VTab.js" type="text/javascript" charset="utf-8"></script>
<script src="/min/?f=/javascript/classes/main.js,/javascript/classes/benefits.js" type="text/javascript" charset="utf-8"></script>

</body>
</html>
