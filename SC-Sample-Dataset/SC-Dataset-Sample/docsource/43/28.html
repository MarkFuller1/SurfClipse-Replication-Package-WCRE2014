<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"><![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"><![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"><![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--><html lang="en" class="no-js"><!--<![endif]-->
    <head>
        
        <meta charset="utf-8">
        <!--SourceForge.net: Find and Build Open Source Software-->
        <!--Copyright (c) 1999-2014 SourceForge, Inc. All rights reserved.-->
        <!-- Create Server: sfs-web-7 -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta name="description" content="Ajax+Mobile Java Web framework. With 200+ Ajax components and event-driven, Ajax/RIA apps are as effortless and rich as desktop apps and HTML/XUL pages. Support JSP/JSF/JavaEE/Spring, Ajax Push and Client-fusion; also Java/Groovy/Python/JavaScript." />
        <meta name="keywords" content="ZK - Simply Ajax and Mobile, AJAX, Browsers, User Interfaces, Open Source, Development, Community, Source Code, Downloads, Software" />
                <title>SourceForge.net: ZK - Simply Ajax and Mobile: zk1-subversion-log</title>        <link href='//fonts.googleapis.com/css?family=Ubuntu:regular,bold' rel='stylesheet' type='text/css'>
                <style type="text/css">
            @font-face {
                font-family: "Pictos";
                src: url('http://static.sourceforge.net/include/fonts/sftheme/pictos-web.eot');
                src: local("â˜º"), url('http://static.sourceforge.net/include/fonts/sftheme/pictos-web.woff') format('woff'), url('http://static.sourceforge.net/include/fonts/sftheme/pictos-web.ttf') format('truetype'), url('http://static.sourceforge.net/include/fonts/sftheme/pictos-web.svg') format('svg');
            }
            #site-header .logo span {
              background-image: url("http://static.sourceforge.net/images/neotheme/sftheme/logo.png");
            }
            #site-footer .wrapper {
              background-image: url("http://static.sourceforge.net/images/neotheme/sftheme/sf-footer-logo.png") !important;
            }
        </style>
        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/develop/style.php?secure=0&amp;1387918906" media="all" />
        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/develop/global.php?secure=0&amp;1387918906" media="all" />
        
        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/neotheme/sfx.css?1387918906" media="all" />
                       <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/phoneix/table.php?secure=0&amp;1387918906" media="all" />
                        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/develop/droppy.php?secure=0&amp;1387918906" media="all" />
                                        <!--   -->
        <script type="text/javascript" src="http://static.sourceforge.net/include/js/sftheme/modernizr.custom.90514.js"></script>
        <script type="text/javascript" src="http://static.sourceforge.net/include/jquery/jquery-1.3.2.min.js"></script>
        <script type="text/javascript">
            
                jQuery.noConflict();
            
        </script>

        <script type="text/javascript" src="http://static.sourceforge.net/include/jquery/jquery.cookie.js"></script>
                        <script type='text/javascript'>
          jQuery(function() {
            jQuery('#fad19 p, .project_summary .downloadbar, .vertical_widget, .horizontal_widget').wrap('<div class="sc"><div class="l1"><div class="l2"><div class="l3"><div class="l4"></div></div></div></div></div>');
          });
        </script>
                <script type="text/javascript" src="http://static.sourceforge.net/include/jquery/jquery.droppy.js"></script>
        <script type="text/javascript" src="http://static.sourceforge.net/include/js/sylvester.js"></script>
        <script type="text/javascript" src="http://static.sourceforge.net/include/js/pb.transformie.js"></script>
        <script type='text/javascript'>
            jQuery(function(){
                jQuery('.b-hornav > li:last-child').addClass('last');
                jQuery('.b-hornav > li').each(function() {
                    jQuery('li[class!=disabled]', this).eq(0).addClass('first');
                });
                jQuery('.b-hornav').droppy({speed:0, delay:0});
            });
        </script>
                <script type="text/javascript" src="http://static.sourceforge.net/include/c_jquerytabs.js"></script>

        <script type="text/javascript">
        
            jQuery(function(){
                jQuery('.vertical_widget_content ul.tab, #container2 ul.tab, #container3 ul.tab, #container4 ul.tab').tabs({ selected: 0 });
            });
        
        </script>
        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/include/jquery/jquery.tabs.css?secure=0&amp;1387918906" media="all" />
            
                            <script type="text/javascript" src="http://static.sourceforge.net/include/js/preferences.js"></script>
            <script type="text/javascript">
                        var _visitor = "";
            var jsonly = document.createElement('link');
            jsonly.setAttribute('rel', 'stylesheet');
            jsonly.setAttribute('type', 'text/css');
            jsonly.setAttribute('href', 'http://static.sourceforge.net/css/phoneix/jsonly.css?secure=0&amp;1387918906');
            document.getElementsByTagName('head')[0].appendChild(jsonly);
                    </script>
                                                                    <!-- DoubleClick Random Number -->
    <script type="text/javascript">var dfp_ord=Math.random()*10000000000000000; var dfp_tile = 1; var dfp_ptile = 1;</script>
    <!-- End DoubleClick Random Number -->
    <!-- After META tags -->
                                    
        <script type="text/javascript" src="http://static.sourceforge.net/sfx.js"></script>
        
            <script type="text/javascript">
                        var _gaq = _gaq || [];
                        _gaq.push(['t1._setAccount', 'UA-32013-6']);
                        _gaq.push(['t1._trackPageview']);
                        _gaq.push(['t2._setAccount', 'UA-36130941-1']);
                        _gaq.push(['t2._trackPageview']);
                        (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
            })();
        </script>
        <script type="text/javascript" src="http://static.sourceforge.net/include/jquery/jquery.notify.js"></script>
    <script type="text/javascript" src="http://static.sourceforge.net/include/js/header.js"></script>
    </head>

    <body id="c2" class="short-head">
    
    <!--[if IE 7]><div id="ie7only"><![endif]-->
    <!--[if IE 6]><div id="ie6only"><![endif]-->
    <!--[if IE]><div id="ieonly"><![endif]-->
        
        <div class="mail_archive">
                        <header id="site-header">
                <div class="wrapper">
                    <a href="/" class="logo">
                        <span>SourceForge</span>
                    </a>
                    <form method="get" action="/directory/">
                        <input type="text" id="words" name="q" placeholder="Search">
                    </form>
                    <nav id="nav-site">
                        <a href="/directory/" title="Browse our software.">Browse</a>
                        <a href="/directory/enterprise" title="Browse our Enterprise software.">Enterprise</a>
                        <a href="/blog/" title="Read the latest news from the SF HQ.">Blog</a>
                        <a href="/support" title="Contact us for help and feedback.">Help</a>
                        <a href="/jobs?source=header" title="Search 80k+ tech jobs." class="featured-link">Jobs</a>
                    </nav>
                    <nav id="nav-account">
                                                  <div class="logged_out">
                            <a href="https://sourceforge.net/account/login.php">Log In</a>
                            <span>or</span>
                            <a href="https://sourceforge.net/user/registration">Join</a>
                          </div>
                                            </nav>
                </div>
            </header>
            <header id="site-sec-header">
                <div class="wrapper">
                    <nav id="nav-hubs">
                        <h4>Solution Centers</h4>
                        <a href="http://ibmsmartercommerce.sourceforge.net/">Smarter Commerce</a>
                        <a href="http://goparallel.sourceforge.net/">Go Parallel</a>
                        <a href="http://html5center.sourceforge.net/">HTML5</a>
                        <a href="http://ibmsmarteritservices.sourceforge.net/">Smarter IT</a>
                    </nav>
                    <nav id="nav-collateral">
                      <a href="http://library.slashdotmedia.com/?source=sfnet_header">Resources</a>  
                                              <a href="https://sourceforge.net/user/registration/">Newsletters</a>
                                            </nav>
                </div>
            </header>
                            <!-- DoubleClick Ad Tag -->
<script type="text/javascript">
//<![CDATA[
    document.write('<script src="http://ad.doubleclick.net/adj/ostg.sourceforge/sf_pg_mailarchive_leader;pg=/mailarchive/forum.php;psrch=0;logged_in=0;tile='+dfp_tile+';sz=728x90;ord='+dfp_ord+'?" type="text/javascript"><\/script>');
    dfp_tile++;
//]]>
</script>
<!-- End DoubleClick Ad Tag -->
                                                <div id="page-body">
            <div id="bd" class="inner-bd">
                <div id="doc4" class="yui-t6">
                                                            <div id="breadcrumbs">
                                                    <a href="/">Home</a>
 / <a href="/directory/" >Browse</a>
 / <a href="/projects/zk1/" >ZK - Simply Ajax and Mobile</a>
 / <a href="/mail/?group_id=152762" >Mail</a>
 / <a href="/mailarchive/forum.php?forum_name=zk1-subversion-log&amp;style=nested&amp;viewmonth=201009"  class="selected">Archive</a>
                                            </div>
                    <!-- begin content -->
            <a name="projectnav"></a>
        <div id="project_nav_container">
            <div class="b-proj__side">
                                
                
                
                <span class="award-bar"><img height="16" width="16" title="February 2009: Project of the Month" alt="February 2009: Project of the Month" src="http://a.fsdn.com/sf/images/develop/icons/potm.png"/></span>
            </div>
            <h1>
                <a href="/projects/zk1/">ZK - Simply Ajax and Mobile</a>
                            </h1>
                    <div class="firstwave">
                <ul class="b-hornav">
                    <li id="menu_consume_summary"><a href="/projects/zk1/"><span><span>Summary</span></span></a></li>
<li id="menu_consume_files"><a href="/projects/zk1/files/"><span><span>Files</span></span></a></li>
<li id="menu_consume_reviews"><a href="/projects/zk1/reviews/"><span><span>Reviews</span></span></a></li>
<li id="menu_project_support"><a href="/projects/zk1/support"><span><span>Support</span></span></a></li>
<li id="menu_project_develop"><a href="/projects/zk1/develop"><span><span>Develop</span></span></a>
<ul>
<li id="menu_project_website"><a href="http://www.zkoss.org">Web Site</a></li>
<li id="menu_project_screenshots"><a href="/project/screenshots.php?group_id=152762">Screenshots</a></li>
<li id="menu_project_news"><a href="/news/?group_id=152762">News</a></li>
<li id="menu_stats"><a href="/projects/zk1/stats/traffic">Project Statistics</a></li>
<li id="menu_download_stats_dist"><a href="/downloads/zk1/stats_timeline">Download Stats</a></li>
</ul>
</li>
<li id="menu_hostedapps" class="disabled tier" style="display: none;"><a href="/hostedapp/?group_id=152762"><span><span>Hosted&nbsp;Apps</span></span></a></li>
<li id="menu_tracker"><a href="/tracker/?group_id=152762"><span><span>Tracker</span></span></a>
<ul>
<li id="menu_tracker_785191"><a href="/tracker/?group_id=152762&amp;atid=785191">Bugs</a></li>
<li id="menu_tracker_785194"><a href="/tracker/?group_id=152762&amp;atid=785194">Feature Requests</a></li>
<li id="menu_tracker_stats" class="tools"><a href="/projects/zk1/stats/tracker">Statistics for Trackers</a></li>
<li id="menu_tracker_reports" class="disabled" style="display: none;"><a href="/tracker/reporting/?group_id=152762">Reporting for Trackers</a></li>
<li id="menu_tracker_search"><a href="/search/?group_id=152762&amp;type_of_search=artifact">Search Trackers</a></li>
</ul>
</li>
<li id="menu_mail" class="selected tier"><a href="/mail/?group_id=152762"><span><span>Mailing&nbsp;Lists</span></span></a>
<ul>
<li id="menu_mlist_zk1-subversion-log"><a href="/mailarchive/forum.php?forum_name=zk1-subversion-log">zk1-subversion-log</a></li>
<li id="menu_mail_search" class="tools"><a href="/search/?group_id=152762&amp;type_of_search=mlists">Search Mail Lists</a></li>
</ul>
<div class="diamond"></div></li>
<li id="menu_forums" class="disabled tier" style="display: none;"><a href="/projects/zk1/forums"><span><span>Forums</span></span></a>
<ul>
<li id="menu_forum_515612"><a href="/projects/zk1/forums/forum/515612">Announce</a></li>
<li id="menu_forum_510208"><a href="/projects/zk1/forums/forum/510208">General</a></li>
<li id="menu_forum_510209"><a href="/projects/zk1/forums/forum/510209">Help</a></li>
<li id="menu_forum_514143"><a href="/projects/zk1/forums/forum/514143">Install</a></li>
<li id="menu_forum_867318"><a href="/projects/zk1/forums/forum/867318">ZK Studio</a></li>
<li id="menu_forums_stats" class="tools"><a href="/projects/zk1/stats/forums">Statistics for Forums</a></li>
<li id="menu_forums_search"><a href="/search/?group_id=152762&amp;type_of_search=forums">Search Forums</a></li>
</ul>
</li>
<li id="menu_code"><a href="#"><span><span>Code</span></span></a>
<ul>
<li id="menu_git_about"><a href="/scm/?type=git&amp;group_id=152762">Git</a></li>
<li id="menu_git_browse"><a href="http://zk1.git.sourceforge.net/">Git Browse</a></li>
<li id="menu_git_stats"><a href="/projects/zk1/stats/scm?repo=GitRepository">Git Statistics</a></li>
<li id="menu_hg_about" class="disabled" style="display: none;"><a href="/scm/?type=hg&amp;group_id=152762">Mercurial</a></li>
<li id="menu_hg_browse" class="disabled" style="display: none;"><a href="http://zk1.hg.sourceforge.net/hgweb/zk1/">Mercurial Browse</a></li>
<li id="menu_hg_stats" class="disabled" style="display: none;"><a href="/projects/zk1/stats/scm?repo=HgRepository">Mercurial Statistics</a></li>
<li id="menu_bzr_about" class="disabled" style="display: none;"><a href="/scm/?type=bzr&amp;group_id=152762">Bazaar</a></li>
<li id="menu_bzr_browse" class="disabled" style="display: none;"><a href="http://zk1.bzr.sourceforge.net/bzr/zk1/">Bazaar Browse</a></li>
<li id="menu_bzr_stats" class="disabled" style="display: none;"><a href="/projects/zk1/stats/scm?repo=BazaarBranch">Bazaar Statistics</a></li>
<li id="menu_cvs_about" class="disabled" style="display: none;"><a href="/scm/?type=cvs&amp;group_id=152762">CVS</a></li>
<li id="menu_cvs_browse" class="disabled" style="display: none;"><a href="http://zk1.cvs.sourceforge.net/zk1/">CVS Browse</a></li>
<li id="menu_cvs_stats" class="disabled" style="display: none;"><a href="/projects/zk1/stats/scm?repo=CVSRepository">CVS Statistics</a></li>
<li id="menu_svn_about"><a href="/scm/?type=svn&amp;group_id=152762">SVN</a></li>
<li id="menu_svn_browse"><a href="http://zk1.svn.sourceforge.net/viewvc/zk1/">SVN Browse</a></li>
<li id="menu_svn_stats"><a href="/projects/zk1/stats/scm?repo=SVNRepository">SVN Statistics</a></li>
</ul>
</li>
<li id="menu_newadmin" class="disabled tier" style="display: none;"><a href="/project/admin/?group_id=152762"><span><span>Project&nbsp;Admin</span></span></a>
<ul>
<li id="menu_editgroupinfo" class="disabled" style="display: none;"><a href="/project/admin/public_info.php?group_id=152762">Settings</a></li>
<li id="menu_features" class="disabled" style="display: none;"><a href="/project/admin/features.php?group_id=152762">Features</a></li>
<li id="menu_userperms" class="disabled" style="display: none;"><a href="/project/admin/project_membership.php?group_id=152762">Members</a></li>
<li id="menu_stats_admin" class="disabled" style="display: none;"><a href="/project/admin/stats.php?group_id=152762">Analytics</a></li>
</ul>
</li>

                </ul>
            </div>
                </div>
        <div style="clear: both;"></div>
            




<p>
<h3>Email Archive: <a href="forum.php?forum_name=zk1-subversion-log"><!-- google_ad_section_start -->zk1-subversion-log<!-- google_ad_section_end --></A> (read-only)
</h3>
</p>

<table width="450" border=0>
    <tr>
        <td>
            <table width="100%" border="1" cellpadding="1" cellspacing="0">
	<tr>
		<th>
			<center><b>2006:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200610">(1)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200611">(231)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200612">(179)</a>
								</td>
		<tr>
		<th>
			<center><b>2007:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200701">(122)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200702">(254)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200703">(378)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200704">(156)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200705">(256)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200706">(204)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200707">(219)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200708">(444)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200709">(417)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200710">(614)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200711">(635)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200712">(332)</a>
								</td>
		<tr>
		<th>
			<center><b>2008:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200801">(481)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200802">(348)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200803">(690)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200804">(563)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200805">(345)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200806">(317)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200807">(247)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200808">(247)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200809">(426)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200810">(299)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200811">(262)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200812">(259)</a>
								</td>
		<tr>
		<th>
			<center><b>2009:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200901">(201)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200902">(402)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200903">(203)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200904">(186)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200905">(203)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200906">(214)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200907">(283)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200908">(137)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200909">(293)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200910">(281)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200911">(235)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=200912">(271)</a>
								</td>
		<tr>
		<th>
			<center><b>2010:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201001">(336)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201002">(127)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201003">(222)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201004">(24)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201005">(49)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201006">(35)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201007">(38)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201008">(28)</a>
								</td>
			<td bgcolor="#cccccc">
			<sub>Sep</sub><br />
						<b>
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009">(32)</a>
									</b>
					</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201010">(24)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201011">(26)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201012">(31)</a>
								</td>
		<tr>
		<th>
			<center><b>2011:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201101">(36)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201102">(22)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201103">(25)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201104">(24)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201105">(57)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201106">(61)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201107">(86)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201108">(81)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201109">(131)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201110">(223)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201111">(204)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201112">(279)</a>
								</td>
		<tr>
		<th>
			<center><b>2012:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201201">(177)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201202">(151)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201203">(88)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201204">(94)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201205">(7)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
	</table>
            <table width="100%" border="1" cellpadding="1" cellspacing="0">
	<tr>
		<th colspan="7">
			
		</th>
	</tr>
	<tr>
		<th bgcolor="#cccccc">S</th>
		<th bgcolor="#cccccc">M</th>
		<th bgcolor="#cccccc">T</th>
		<th bgcolor="#cccccc">W</th>
		<th bgcolor="#cccccc">T</th>
		<th bgcolor="#cccccc">F</th>
		<th bgcolor="#cccccc">S</th>
	</tr>
	<tr>
			<th bgcolor="#eeeeee">
			
		</th>
			<th bgcolor="#eeeeee">
			
		</th>
			<th bgcolor="#eeeeee">
			
		</th>
			<th bgcolor="#eeeeee">
			1
		</th>
			<th bgcolor="#eeeeee">
			2
		</th>
			<th bgcolor="#eeeeee">
			3
		</th>
			<th bgcolor="#eeeeee">
			4
		</th>
		</tr>
	<tr>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=1">
					(2)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=2">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=3">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=4">
					(1)
					</a>
				</td>
		</tr>
	<tr>
			<th bgcolor="#eeeeee">
			5
		</th>
			<th bgcolor="#eeeeee">
			6
		</th>
			<th bgcolor="#eeeeee">
			7
		</th>
			<th bgcolor="#eeeeee">
			8
		</th>
			<th bgcolor="#eeeeee">
			9
		</th>
			<th bgcolor="#eeeeee">
			10
		</th>
			<th bgcolor="#eeeeee">
			11
		</th>
		</tr>
	<tr>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=8">
					(4)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=9">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=10">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=11">
					(1)
					</a>
				</td>
		</tr>
	<tr>
			<th bgcolor="#eeeeee">
			12
		</th>
			<th bgcolor="#eeeeee">
			13
		</th>
			<th bgcolor="#eeeeee">
			14
		</th>
			<th bgcolor="#eeeeee">
			15
		</th>
			<th bgcolor="#eeeeee">
			16
		</th>
			<th bgcolor="#eeeeee">
			17
		</th>
			<th bgcolor="#eeeeee">
			18
		</th>
		</tr>
	<tr>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=13">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=14">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=15">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=16">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=17">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=18">
					(1)
					</a>
				</td>
		</tr>
	<tr>
			<th bgcolor="#eeeeee">
			19
		</th>
			<th bgcolor="#eeeeee">
			20
		</th>
			<th bgcolor="#eeeeee">
			21
		</th>
			<th bgcolor="#eeeeee">
			22
		</th>
			<th bgcolor="#eeeeee">
			23
		</th>
			<th bgcolor="#eeeeee">
			24
		</th>
			<th bgcolor="#eeeeee">
			25
		</th>
		</tr>
	<tr>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=20">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=21">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=22">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=23">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=24">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=25">
					(1)
					</a>
				</td>
		</tr>
	<tr>
			<th bgcolor="#eeeeee">
			26
		</th>
			<th bgcolor="#eeeeee">
			27
		</th>
			<th bgcolor="#eeeeee">
			28
		</th>
			<th bgcolor="#eeeeee">
			29
		</th>
			<th bgcolor="#eeeeee">
			30
		</th>
			<th bgcolor="#eeeeee">
			
		</th>
			<th bgcolor="#eeeeee">
			
		</th>
		</tr>
	<tr>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=27">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=28">
					(5)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=29">
					(1)
					</a>
				</td>
					<td align="center">
							<a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009&amp;viewday=30">
					(1)
					</a>
				</td>
					<td align="center">
							&nbsp;
				</td>
					<td align="center">
							&nbsp;
				</td>
		</tr>
</table>
        </td>
    </tr>
</table>

<form action="/mailarchive/forum.php" method="get">
<input type="hidden" name="set" value="custom">
<input type="hidden" name="viewmonth" value="201009">
<input type="hidden" name="viewday" value="">

<table border="0" width="500">
    <tr>
        <td>
            <small>
            
<select name="forum_name">
	<option value="zk1-forum-log">zk1-forum-log</option>
	<option value="zk1-subversion-log" selected="selected">zk1-subversion-log</option>
</select>

            </small>
        </td>
        <td>
            <small>
            
<select name="style">
	<option value="nested" selected="selected">Nested</option>
	<option value="flat">Flat</option>
	<option value="threaded">Threaded</option>
	<option value="ultimate">Ultimate</option>
</select>

            </small>
        </td>
        <td>
            <small>
            
<select name="max_rows">
	<option value="25" selected="selected">Show 25</option>
	<option value="50">Show 50</option>
	<option value="75">Show 75</option>
	<option value="100">Show 100</option>
</select>

            </small>
        </td>
        <td>
            <small>
            <input type="submit" name="submit" value="Change View">
            </small>
        </td>
    </tr>
</table>

    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26171590">[zk1-subversion-log] SF.net SVN: zk1:[14277] branches/5.0</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-16 05:38</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14277
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14277&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14277&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-16 05:38:34 +0000 (Thu, 16 Sep 2010)

Log Message:
-----------
Thu 09/16/2010

Modified Paths:
--------------
    branches/5.0/zk/src/org/zkoss/zk/ui/event/EventQueue.java
    branches/5.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java
    branches/5.0/zk/src/org/zkoss/zk/ui/http/Standalones.java
    branches/5.0/zk/src/org/zkoss/zk/ui/http/Utils.java
    branches/5.0/zk/src/org/zkoss/zk/ui/http/WebManager.java
    branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java
    branches/5.0/zul/src/archive/web/zul/css/norm.css.dsp
    branches/5.0/zul/src/org/zkoss/zul/ListModelList.java
    branches/5.0/zul/src/org/zkoss/zul/ListModelMap.java

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/event/EventQueue.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/event/EventQueue.java	2010-09-15 05:41:58 UTC (rev 14276)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/event/EventQueue.java	2010-09-16 05:38:34 UTC (rev 14277)
@@ -44,7 +44,7 @@
  * @since 5.0.0
  */
 public interface EventQueue {
-	/** Publishes an event the queue.
+	/** Publishes an event to the queue.
 	 *
 	 * &lt;p&gt;If the scope of a event queue is desktop or group,
 	 * this method must be called within an activated exection
@@ -54,12 +54,18 @@
 	 * &lt;p&gt;On the other hand, if the scope is session or application,
 	 * it is OK to be called without the current execution.
 	 *
+	 * @param event the event to publish.&lt;br/&gt;
+	 * Notice that all subscribers will receive the event no matter
+	 * what the event's name and target are.&lt;br/&gt;
+	 * You could publish an anonymous event by
+	 * &lt;code&gt;publish(new Event("", null, data))&lt;/code&gt;.
 	 * @exception IllegalStateException if this method is called
 	 * not within an activated execution (such as a working thread),
 	 * and this is a ({@link EventQueues#DESKTOP}) or {@link EventQueues#GROUP}
 	 * event queue.
 	 */
 	public void publish(Event event);
+
 	/** Subscribes a listener to this queue.
 	 * It is the same as &lt;code&gt;subscribe(listener, false)&lt;/code&gt;
 	 * ({@link #subscribe(EventListener,boolean)}. In other words,

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java	2010-09-15 05:41:58 UTC (rev 14276)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java	2010-09-16 05:38:34 UTC (rev 14277)
@@ -106,30 +106,12 @@
 		if (_webman != null) {
 			log.info("Web Manager was created before ZK loader");
 		} else {
-			String updateURI = fixUpdateURI(
+			String updateURI = Utils.fixUpdateURI(
 				config.getInitParameter("update-uri"), "The update-uri parameter");
 			_webman = new WebManager(_ctx, updateURI);
 			_webmanCreated = true;
 		}
 	}
-	/*package*/ static final String fixUpdateURI(String updateURI, String info)
-	throws ServletException {
-		if (updateURI == null
-		|| (updateURI = updateURI.trim()).length() == 0
-		|| updateURI.charAt(0) != '/')
-			throw new ServletException(info+" must be specified and starts with /");
-		if (updateURI.indexOf(';') &gt;= 0 || updateURI.indexOf('?') &gt;= 0)
-			throw new ServletException(info+" cannot contain ';' or '?'");
-			//Jetty will encode URL by appending ';jsess..' and we have to
-			//remove it under certain situations, so not alow it
-		if (updateURI.charAt(updateURI.length() - 1) == '\\') {
-			if (updateURI.length() == 1)
-				throw new ServletException(info+" cannot contain only '/'");
-			updateURI = updateURI.substring(0, updateURI.length() - 1);
-				//remove the trailing '\\' if any
-		}
-		return updateURI;
-	}
 	public void destroy() {
 		if (_webman != null) {
 			if (_webmanCreated)

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/http/Standalones.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/http/Standalones.java	2010-09-15 05:41:58 UTC (rev 14276)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/http/Standalones.java	2010-09-16 05:38:34 UTC (rev 14277)
@@ -69,13 +69,16 @@
 	 * @param comp the component to output (never null). It might have child components.
 	 * @param path the request path. If null, the servlet path is assumed.
 	 * @param out the output (never null).
+	 * @param richlet the richlet to run. If you have only one component to show and no need
+	 * process it under an execution, you could use
+	 * {@link #output(ServletContext, HttpServletRequest, HttpServletResponse, Component, String, Writer)
+	 * instead.
+	 * @since 5.0.5
 	 */
 	public static final void output(ServletContext ctx,
 	HttpServletRequest request, HttpServletResponse response,
-	Component comp, String path, Writer out)
+	Richlet richlet, String path, Writer out)
 	throws ServletException, IOException {
-		if (comp == null)
-			throw new IllegalArgumentException();
 		if (path == null)
 			path = Https.getThisServletPath(request);
 
@@ -86,7 +89,7 @@
 			if (updateURI == null)
 				updateURI = "/zkau";
 			else
-				updateURI = DHtmlLayoutServlet.fixUpdateURI(updateURI, ATTR);
+				updateURI = Utils.fixUpdateURI(updateURI, ATTR);
 			webman = new WebManager(ctx, updateURI);
 		}
 
@@ -108,8 +111,6 @@
 			((SessionCtrl)sess).notifyClientRequest(true);
 
 			final UiFactory uf = wappc.getUiFactory();
-			final Richlet richlet = new StandaloneRichlet(comp);
-
 			final Page page = WebManager.newPage(uf, ri, richlet, response, path);
 			exec = new ExecutionImpl(ctx, request, response, desktop, page);
 			exec.setAttribute(Attributes.PAGE_REDRAW_CONTROL, "page");
@@ -125,6 +126,19 @@
 			}
 		}
 	}
+	/** Outputs the HTML tags of the given component to the given writer.
+	 * @param comp the component to output (never null). It might have child components.
+	 * @param path the request path. If null, the servlet path is assumed.
+	 * @param out the output (never null).
+	 */
+	public static final void output(ServletContext ctx,
+	HttpServletRequest request, HttpServletResponse response,
+	Component comp, String path, Writer out)
+	throws ServletException, IOException {
+		if (comp == null)
+			throw new IllegalArgumentException();
+		output(ctx, request, response, new StandaloneRichlet(comp), path, out);
+	}
 	//Supporting classes//
 	private static class StandaloneRichlet extends GenericRichlet {
 		private final Component _comp;

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/http/Utils.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/http/Utils.java	2010-09-15 05:41:58 UTC (rev 14276)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/http/Utils.java	2010-09-16 05:38:34 UTC (rev 14277)
@@ -220,4 +220,23 @@
 		}
 		return null;
 	}
+
+	/*package*/ static final String fixUpdateURI(String updateURI, String info)
+	throws ServletException {
+		if (updateURI == null
+		|| (updateURI = updateURI.trim()).length() == 0
+		|| updateURI.charAt(0) != '/')
+			throw new ServletException(info+" must be specified and starts with /");
+		if (updateURI.indexOf(';') &gt;= 0 || updateURI.indexOf('?') &gt;= 0)
+			throw new ServletException(info+" cannot contain ';' or '?'");
+			//Jetty will encode URL by appending ';jsess..' and we have to
+			//remove it under certain situations, so not alow it
+		if (updateURI.charAt(updateURI.length() - 1) == '\\') {
+			if (updateURI.length() == 1)
+				throw new ServletException(info+" cannot contain only '/'");
+			updateURI = updateURI.substring(0, updateURI.length() - 1);
+				//remove the trailing '\\' if any
+		}
+		return updateURI;
+	}
 }

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/http/WebManager.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/http/WebManager.java	2010-09-15 05:41:58 UTC (rev 14276)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/http/WebManager.java	2010-09-16 05:38:34 UTC (rev 14277)
@@ -310,15 +310,17 @@
 	public static final WebManager getWebManager(WebApp wapp) {
 		return getWebManager((ServletContext)wapp.getNativeContext());
 	}
-	/** Returns the Web manager, or null if not found.
+	/** Returns the Web manager of the give context, or null if not found.
+	 * @since 5.0.5
 	 */
-	/*package*/ static final WebManager getWebManagerIfAny(ServletContext ctx) {
+	public static final WebManager getWebManagerIfAny(ServletContext ctx) {
 		return (WebManager)ctx.getAttribute(ATTR_WEB_MANAGER);
 	}
-	/** Returns the Web manager of the specified {@link WebApp}.
-	 * @since 5.0.3
+	/** Returns the Web manager of the specified {@link WebApp},
+	 * or null if not found.
+	 * @since 5.0.5
 	 */
-	/*package*/ static final WebManager getWebManagerIfAny(WebApp wapp) {
+	public static final WebManager getWebManagerIfAny(WebApp wapp) {
 		return getWebManagerIfAny((ServletContext)wapp.getNativeContext());
 	}
 	/** Returns the Web application of the specified context.

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java	2010-09-15 05:41:58 UTC (rev 14276)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java	2010-09-16 05:38:34 UTC (rev 14277)
@@ -451,7 +451,7 @@
 			String wgtnm = el.getElementValue("widget-class", true);
 			WidgetDefinition wgtdef = null;
 			if (wgtnm == null &amp;&amp; extend)
-				wgtnm = compdef.getDefaultWidgetClass();
+				wgtnm = compdef.getDefaultWidgetClass(null);
 			if (wgtnm != null) {
 				if (!withEL(wgtnm))
 					wgtdef = getWidgetDefinition(langdef, compdef, wgtnm);

Modified: branches/5.0/zul/src/archive/web/zul/css/norm.css.dsp
===================================================================
--- branches/5.0/zul/src/archive/web/zul/css/norm.css.dsp	2010-09-15 05:41:58 UTC (rev 14276)
+++ branches/5.0/zul/src/archive/web/zul/css/norm.css.dsp	2010-09-16 05:38:34 UTC (rev 14277)
@@ -356,7 +356,9 @@
 	background-image: url(${c:encodeURL('~./zul/img/misc/prgmeter.png')});
 }
 
-&lt;%-- fileupload dialog --%&gt;
+&lt;%-- fileupload dialog 
+
+// no longer used since 5.0.0
 .z-fileupload-img {
 	width: 16px;
 	padding-top: 4px;
@@ -368,6 +370,7 @@
 	width: 16px;
 	height: 17px;
 }
+--%&gt;
 .z-fileupload-rm {
 	cursor: pointer;
 	background: transparent no-repeat 0 0;

Modified: branches/5.0/zul/src/org/zkoss/zul/ListModelList.java
===================================================================
--- branches/5.0/zul/src/org/zkoss/zul/ListModelList.java	2010-09-15 05:41:58 UTC (rev 14276)
+++ branches/5.0/zul/src/org/zkoss/zul/ListModelList.java	2010-09-16 05:38:34 UTC (rev 14277)
@@ -304,6 +304,7 @@
 		int index = indexOf(o);
 		if (index &gt;= 0) {
 			remove(index);
+			return true;
 		}
 		return false;
 	}

Modified: branches/5.0/zul/src/org/zkoss/zul/ListModelMap.java
===================================================================
--- branches/5.0/zul/src/org/zkoss/zul/ListModelMap.java	2010-09-15 05:41:58 UTC (rev 14276)
+++ branches/5.0/zul/src/org/zkoss/zul/ListModelMap.java	2010-09-16 05:38:34 UTC (rev 14277)
@@ -166,9 +166,9 @@
 	public boolean isEmpty() {
 		return _map.isEmpty();
 	}
-    
+
 	public Set keySet() {
-		return new MyKeySet(_map.keySet());
+		return new MySet(_map.keySet(), true);
 	}
 
 	public Object put(Object key, Object o) {
@@ -288,12 +288,21 @@
 	private void removeSelectionByKey(Object key) {
 		for(final Iterator it = getSelection().iterator(); it.hasNext();) {
 			final Map.Entry entry = (Map.Entry) it.next();
-			if (key.equals(entry.getKey())) {
+			if (Objects.equals(key, entry.getKey())) {
 				removeSelection(entry);
 				break;
 			}
 		}
 	}
+	private void removeSelectionByValue(Object value) {
+		for(final Iterator it = getSelection().iterator(); it.hasNext();) {
+			final Map.Entry entry = (Map.Entry) it.next();
+			if (Objects.equals(value, entry.getValue())) {
+				removeSelection(entry);
+				return;
+			}
+		}
+	}
 
 	public int size() {
 		return _map.size();
@@ -321,7 +330,7 @@
 		fireEvent(ListDataEvent.CONTENTS_CHANGED, -1, -1);
 	}
 
-	private boolean removePartial(Collection master, Collection c, boolean isRemove) {
+	private boolean removePartial(Collection master, Collection c, boolean isRemove, boolean byKey, boolean byValue) {
 		int sz = c.size();
 		int removed = 0;
 		int retained = 0;
@@ -335,7 +344,9 @@
 					begin = index;
 				}
 				++removed;
-				removeSelection(item);
+				if (byKey) removeSelectionByKey(item);
+				else if (byValue) removeSelectionByValue(item);
+				else removeSelection(item);
 				it.remove();
 			} else {
 				++retained;
@@ -388,12 +399,14 @@
 		}
 	}
 
-	/** Represents the key set.
+	/** Represents a set.
 	 */
-	private class MyKeySet implements Set {
+	private class MySet implements Set {
 		private final Set _set;
-		public MyKeySet(Set inner) {
+		private final boolean _keyset;
+		public MySet(Set inner, boolean keyset) {
 			_set = inner;
+			_keyset = keyset;
 		}
 		
 		public void clear() {
@@ -434,7 +447,7 @@
 
 			//bug #1819318 Problem while using SortedSet with Databinding
 			if (_map instanceof LinkedHashMap || _map instanceof SortedMap) {
-				return removePartial(_set, c, true);
+				return removePartial(_set, c, true, _keyset, false);
 			} else { //bug #1839634 Problem while using HashSet with Databinding
 				removeAllSelection(c);
 				final boolean ret = _set.removeAll(c);
@@ -451,7 +464,7 @@
 			}
 			//bug #1819318 Problem while using SortedSet with Databinding
 			if (_map instanceof LinkedHashMap || _map instanceof SortedMap) {
-				return removePartial(_set, c, false);
+				return removePartial(_set, c, false, _keyset, false);
 			} else { //bug #1839634 Problem while using HashSet with Databinding
 				retainAllSelection(c);
 				final boolean ret = _set.retainAll(c);
@@ -486,8 +499,8 @@
 			if (this == o) {
 				return true;
 			}
-			if (o instanceof MyKeySet) {
-				return Objects.equals(((MyKeySet)o)._set, _set);
+			if (o instanceof MySet) {
+				return Objects.equals(((MySet)o)._set, _set);
 			} else {
 				return Objects.equals(_set, o);
 			}
@@ -513,9 +526,9 @@
 			return _set == null ? a : _set.toArray(a);
 		}
 	}
-	private class MyEntrySet extends MyKeySet {
+	private class MyEntrySet extends MySet {
 		private MyEntrySet(Set inner) {
-			super(inner);
+			super(inner, false);
 		}
 		protected int indexOf(Object o) {
 			return indexOf(o);
@@ -579,7 +592,7 @@
 			}
 			//bug #1819318 Problem while using SortedSet with Databinding
 			if (_map instanceof LinkedHashMap || _map instanceof SortedMap) {
-				return removePartial(_inner, c, true);
+				return removePartial(_inner, c, true, false, true);
 			} else { //bug #1839634 Problem while using HashSet with Databinding
 				removeAllSelection(c);
 				final boolean ret = _inner.removeAll(c);
@@ -596,7 +609,7 @@
 			}
 			//bug #1819318 Problem while using SortedSet with Databinding
 			if (_map instanceof LinkedHashMap || _map instanceof SortedMap) {
-				return removePartial(_inner, c, false);
+				return removePartial(_inner, c, false, false, true);
 			} else { //bug #1839634 Problem while using HashSet with Databinding
 				retainAllSelection(c);
 				final boolean ret = _inner.retainAll(c);


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
<ul>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26203972">[zk1-subversion-log] SF.net SVN: zk1:[14282] branches/5.0</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-22 05:39</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14282
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14282&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14282&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-22 05:39:03 +0000 (Wed, 22 Sep 2010)

Log Message:
-----------
Wed 09/22/2010

Modified Paths:
--------------
    branches/5.0/zkdemo/pom.xml
    branches/5.0/zul/src/archive/web/js/zul/db/Datebox.js
    branches/5.0/zul/src/archive/web/js/zul/db/mold/calendar.js
    branches/5.0/zul/src/archive/web/js/zul/menu/Menu.js

Modified: branches/5.0/zkdemo/pom.xml
===================================================================
--- branches/5.0/zkdemo/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
+++ branches/5.0/zkdemo/pom.xml	2010-09-22 05:39:03 UTC (rev 14282)
@@ -42,6 +42,10 @@
 			&lt;id&gt;ZK EE Evaluation&lt;/id&gt;
 			&lt;url&gt;<a href="http://mavensync.zkoss.org/zk/ee-eval&lt;/url" target="_new">http://mavensync.zkoss.org/zk/ee-eval&lt;/url</a>&gt;
 		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;jboss&lt;/id&gt;
+			&lt;url&gt;<a href="http://repository.jboss.com/maven2&lt;/url" target="_new">http://repository.jboss.com/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;		
 	&lt;/repositories&gt;
 	&lt;pluginRepositories&gt;
 		&lt;pluginRepository&gt;

Modified: branches/5.0/zul/src/archive/web/js/zul/db/Datebox.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/db/Datebox.js	2010-09-21 05:43:41 UTC (rev 14281)
+++ branches/5.0/zul/src/archive/web/js/zul/db/Datebox.js	2010-09-22 05:39:03 UTC (rev 14282)
@@ -465,8 +465,8 @@
 			this._auxb = new zul.Auxbutton(this, btn, inp);
 			this.domListen_(btn, 'onClick', '_doBtnClick');
 		}
-		if (this._readonly &amp;&amp; !this.inRoundedMold() &amp;&amp; !this._buttonVisible)
-			jq(inp).addClass(this.getZclass() + '-right-edge');
+		
+		zul.db.ThemeHandler.addRightEdgeClass(this);
 			
 		this.syncWidth();
 		
@@ -728,4 +728,16 @@
 	}
 });
 
+zul.db.ThemeHandler = {
+	 addRightEdgeClass: function (wgt) {
+	  	if (wgt._readonly &amp;&amp; !wgt.inRoundedMold() &amp;&amp; !wgt._buttonVisible)
+			jq(wgt.getInputNode()).addClass(wgt.getZclass() + '-right-edge');
+	 },
+	 addDayOfWeekClass: function (isWeekend, out) {
+	 	if (isWeekend) out.push(' class="z-weekend"');
+	 },
+	 addDayRowClass: function (isWeekend, zcls, out) {
+	 	out.push ('&lt;td&gt;&lt;/td&gt;');
+	 }
+};
 })();

Modified: branches/5.0/zul/src/archive/web/js/zul/db/mold/calendar.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/db/mold/calendar.js	2010-09-21 05:43:41 UTC (rev 14281)
+++ branches/5.0/zul/src/archive/web/js/zul/db/mold/calendar.js	2010-09-22 05:39:03 UTC (rev 14282)
@@ -36,10 +36,10 @@
 				'&lt;tr&gt;&lt;td id="', uuid, '-title"&gt;');
 	switch(view) {
 	case "day" :
-		out.push('&lt;span id="', uuid, '-tm" class="', zcls, '-ctrler"&gt;', zk.SMON[m], '&lt;/span&gt;, &lt;span id="', uuid, '-ty" class="', zcls, '-ctrler"&gt;', y + ydelta, '&lt;/span&gt;');
+		out.push('&lt;span id="', uuid, '-tm" class="', zcls, '-ctrler"&gt;', zk.SMON[m], '&lt;/span&gt; &lt;span id="', uuid, '-ty" class="', zcls, '-ctrler"&gt;', y + ydelta, '&lt;/span&gt;');
 		break;
 	case "month" :
-		out.push('&lt;span id="', uuid, '-tm" class="', zcls, '-ctrler"&gt;', zk.SMON[m], '&lt;/span&gt;, &lt;span id="', uuid, '-ty" class="', zcls, '-ctrler"&gt;', y + ydelta, '&lt;/span&gt;');
+		out.push('&lt;span id="', uuid, '-tm" class="', zcls, '-ctrler"&gt;', zk.SMON[m], '&lt;/span&gt; &lt;span id="', uuid, '-ty" class="', zcls, '-ctrler"&gt;', y + ydelta, '&lt;/span&gt;');
 		break;
 	case "year" :
 		out.push('&lt;span id="', uuid, '-tyd" class="', zcls, '-ctrler"&gt;', yofs + ydelta + 1, '-', yofs + ydelta + 10, '&lt;/span&gt;');
@@ -63,14 +63,14 @@
 			var sun = (7 - zk.DOW_1ST) % 7, sat = (6 + sun) % 7;
 			for (var j = 0 ; j &lt; 7; ++j) {
 				out.push('&lt;td');
-				if (j == sun || j == sat) out.push(' class="z-weekend"');
+				zul.db.ThemeHandler.addDayOfWeekClass((j == sun || j == sat), out);
 				out.push( '&gt;' + zk.S2DOW[j] + '&lt;/td&gt;');
 			}
 			out.push('&lt;/tr&gt;');
 			for (var j = 0; j &lt; 6; ++j) { //at most 7 rows
 				out.push('&lt;tr class="', zcls, '-caldayrow" id="', uuid, '-w', j, '" &gt;');
 				for (var k = 0; k &lt; 7; ++k)
-					out.push ('&lt;td&gt;&lt;/td&gt;');
+					zul.db.ThemeHandler.addDayRowClass((k == sun || k == sat), zcls, out);
 				out.push('&lt;/tr&gt;');
 			}
 		out.push('&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;');

Modified: branches/5.0/zul/src/archive/web/js/zul/menu/Menu.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/menu/Menu.js	2010-09-21 05:43:41 UTC (rev 14281)
+++ branches/5.0/zul/src/archive/web/js/zul/menu/Menu.js	2010-09-22 05:39:03 UTC (rev 14282)
@@ -300,7 +300,6 @@
 
 zul.menu.ContentHandler = zk.$extends(zk.Object, {
 	 $init: function(wgt, content) {
-	 	this.$supers('$init', arguments);
 		this._wgt = wgt;
 		this._content = content;
 	 },


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26222030">[zk1-subversion-log] SF.net SVN: zk1:[14285] branches/5.0</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-25 05:39</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14285
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14285&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14285&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-25 05:39:51 +0000 (Sat, 25 Sep 2010)

Log Message:
-----------
Sat 09/25/2010

Modified Paths:
--------------
    branches/5.0/zk/src/archive/web/js/zk/zk.js
    branches/5.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
    branches/5.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp
    branches/5.0/zul/src/archive/web/js/zul/inp/css/combo.css.dsp
    branches/5.0/zul/src/archive/web/js/zul/inp/css/input.css.dsp
    branches/5.0/zul/src/archive/web/js/zul/wnd/css/panel.css.dsp
    branches/5.0/zul/src/archive/web/js/zul/wnd/css/window.css.dsp

Modified: branches/5.0/zk/src/archive/web/js/zk/zk.js
===================================================================
--- branches/5.0/zk/src/archive/web/js/zk/zk.js	2010-09-24 05:48:07 UTC (rev 14284)
+++ branches/5.0/zk/src/archive/web/js/zk/zk.js	2010-09-25 05:39:51 UTC (rev 14285)
@@ -274,6 +274,11 @@
 	 * @type boolean
 	 */
 	//ie8c: false,
+	/** Whether it is Internet Exploer 9 or later.
+	 * @type boolean
+	 * @since 5.0.5
+	 */
+	//ie9: false,
 	/** Whether it is Gecko-based browsers, such as Firefox.
 	 * @type boolean
 	 */
@@ -1080,42 +1085,50 @@
 
 //zk.agent//
 (function () {
-	zk.agent = navigator.userAgent.toLowerCase();
-	zk.safari = zk.agent.indexOf("safari") &gt;= 0;
-	zk.opera = zk.agent.indexOf("opera") &gt;= 0;
-	zk.gecko = zk.agent.indexOf("gecko/") &gt;= 0 &amp;&amp; !zk.safari &amp;&amp; !zk.opera;
-	zk.ios = zk.agent.indexOf("iphone") &gt;= 0 || zk.agent.indexOf("ipad") &gt;= 0;
-	zk.android = zk.agent.indexOf('android') &gt;= 0;
+	var agent = zk.agent = navigator.userAgent.toLowerCase();
+	zk.safari = agent.indexOf("safari") &gt;= 0;
+	zk.opera = agent.indexOf("opera") &gt;= 0;
+	zk.gecko = agent.indexOf("gecko/") &gt;= 0 &amp;&amp; !zk.safari &amp;&amp; !zk.opera;
+	zk.ios = agent.indexOf("iphone") &gt;= 0 || agent.indexOf("ipad") &gt;= 0;
+	zk.android = agent.indexOf('android') &gt;= 0;
 	zk.mobile = zk.ios || zk.android;
 	var bodycls;
 	if (zk.gecko) {
-		var j = zk.agent.indexOf("firefox/");
-		j = zk.parseInt(zk.agent.substring(j + 8));
-		zk.gecko3 = j &gt;= 3;
+		var j = agent.indexOf("firefox/");
+		j = zk.parseInt(agent.substring(j + 8));
+		zk.css3 = zk.gecko3 = j &gt;= 3;
 		zk.gecko2_ = !zk.gecko3;
-
 		bodycls = 'gecko gecko' + j;
 	} else if (zk.opera) {
 		bodycls = 'opera';
+		var j = agent.indexOf("version/"), v;
+		zk.css3 = j &gt;= 0
+			&amp;&amp; ((v = zk.parseInt(agent.substring(j += 8))) &gt; 10
+				|| (v == 10 &amp;&amp; (j = agent.indexOf('.', j)) &gt;= 0
+					&amp;&amp; zk.parseInt(agent.substring(j + 1)) &gt;= 5)); //10.5 or later
 	} else {
-		var j = zk.agent.indexOf("msie ");
+		var j = agent.indexOf("msie "), dm;
 		zk.ie = j &gt;= 0;
 		if (zk.ie) {
-			j = zk.parseInt(zk.agent.substring(j + 5));
+			j = zk.parseInt(agent.substring(j + 5));
 			zk.ie7 = j &gt;= 7; //ie7 or later
 			zk.ie8c = j &gt;= 8; //ie8 or later (including compatible)
-			zk.ie8 = j &gt;= 8 &amp;&amp; document.documentMode &gt;= 8; //ie8 or later
+			zk.ie8 = j &gt;= 8 &amp;&amp; (dm=document.documentMode) &gt;= 8; //ie8 or later
+			zk.css3 = zk.ie9 = j &gt;= 9 &amp;&amp; dm &gt;= 9; //ie9 or later
 			zk.ie6_ = !zk.ie7;
 			zk.ie7_ = zk.ie7 &amp;&amp; !zk.ie8;
+			zk.ie8_ = zk.ie8 &amp;&amp; !zk.ie9;
 			bodycls = 'ie ie' + j;
-		} else if (zk.safari)
-			bodycls = 'safari';
+		} else {
+			if (zk.safari)
+				bodycls = 'safari';
+			zk.css3 = true;
+		}
 	}
-	if (zk.air = zk.agent.indexOf("adobeair") &gt;= 0)
-		bodycls = 'air';
 
-	zk.css3 = !(zk.ie || zk.gecko2_ || zk.opera);
-	
+	if (zk.air = agent.indexOf("adobeair") &gt;= 0)
+		bodycls = (bodycls || '') + ' air';
+
 	if (bodycls)
 		jq(function () {
 			var n = document.body,

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-24 05:48:07 UTC (rev 14284)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-25 05:39:51 UTC (rev 14285)
@@ -1528,6 +1528,14 @@
 	protected void smartUpdate(String attr, Date value) {
 		smartUpdate(attr, (Object)value);
 	}
+	/** A special smart update to update a value to the given component.
+	 * &lt;p&gt;It is the same as
+	 * &lt;code&gt;smartUpdate(attr, comp != null ? comp.getUuid(): null)&lt;/code&gt;.
+	 * @since 5.0.5
+	 */
+	protected void smartUpdate(String attr, Component comp) {
+		smartUpdate(attr, comp != null ? comp.getUuid(): null);
+	}
 	/** A special smart update to update an event listener for the
 	 * peer widget.
 	 * By default, it assumes the peer widget has a method called

Modified: branches/5.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp	2010-09-24 05:48:07 UTC (rev 14284)
+++ branches/5.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp	2010-09-25 05:39:51 UTC (rev 14285)
@@ -11,6 +11,7 @@
 }
 .z-calendar,
 .z-calendar-title-over {
+	border-radius: 3px;
 	-moz-border-radius: 3px;
 	-webkit-border-radius: 3px;
 }
@@ -127,6 +128,7 @@
 .z-calendar-calmon .z-calendar-over,
 .z-calendar-caldayrow .z-calendar-over {
 	background: #F1F9FC;
+	border-radius: 4px;
 	-moz-border-radius: 4px;
 	-webkit-border-radius: 4px;
 }
@@ -135,6 +137,7 @@
 .z-calendar-calmon td.z-calendar-seld,
 .z-calendar-calday td.z-calendar-seld {
 	background: #CCE0FB; 
+	border-radius: 4px;
 	-moz-border-radius: 4px;
 	-webkit-border-radius: 4px;
 }
@@ -144,6 +147,7 @@
 .z-datebox-calmon td.z-datebox-over-seld,
 .z-datebox-calday td.z-datebox-over-seld {
 	background: #5FA4FF;
+	border-radius: 4px;
 	-moz-border-radius: 4px;
 	-webkit-border-radius: 4px;
 }

Modified: branches/5.0/zul/src/archive/web/js/zul/inp/css/combo.css.dsp
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/inp/css/combo.css.dsp	2010-09-24 05:48:07 UTC (rev 14284)
+++ branches/5.0/zul/src/archive/web/js/zul/inp/css/combo.css.dsp	2010-09-25 05:39:51 UTC (rev 14285)
@@ -29,6 +29,7 @@
 	border: 1px solid #86A4BE;
 	padding-top: 2px;
 	padding-bottom: 2px;
+	border-radius: 2px 0 0 2px;
 	-moz-border-radius: 2px 0 0 2px;
 	-webkit-border-radius: 2px 0 0 2px;
 	&lt;c:if test="${c:isSafari()}"&gt;
@@ -123,6 +124,7 @@
 	border-bottom: 1px solid #86A4BE;
 	overflow: hidden;
 	display:-moz-inline-box; display:inline-block;
+	border-radius: 0 2px 2px 0;
 	-moz-border-radius: 0 2px 2px 0;
 	-webkit-border-radius: 0 2px 2px 0;
 	&lt;c:if test="${c:browser('ie7-') || c:browser('ie6-')}"&gt;
@@ -375,6 +377,8 @@
 &lt;%-- Shadow --%&gt;
 .z-combobox-rounded-shadow, .z-bandbox-rounded-shadow, .z-datebox-rounded-shadow,
 .z-combobox-shadow, .z-bandbox-shadow, .z-datebox-shadow {
+	border-radius: 3px;
+	box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
 	-moz-border-radius: 3px;
 	-moz-box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
 	-webkit-border-radius: 3px;

Modified: branches/5.0/zul/src/archive/web/js/zul/inp/css/input.css.dsp
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/inp/css/input.css.dsp	2010-09-24 05:48:07 UTC (rev 14284)
+++ branches/5.0/zul/src/archive/web/js/zul/inp/css/input.css.dsp	2010-09-25 05:39:51 UTC (rev 14285)
@@ -24,6 +24,7 @@
 	font-weight: normal;
 	padding-top: 2px;
 	padding-bottom: 2px;
+	border-radius: 2px;
 	-moz-border-radius: 2px;
 	-webkit-border-radius: 2px;
 }

Modified: branches/5.0/zul/src/archive/web/js/zul/wnd/css/panel.css.dsp
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/wnd/css/panel.css.dsp	2010-09-24 05:48:07 UTC (rev 14284)
+++ branches/5.0/zul/src/archive/web/js/zul/wnd/css/panel.css.dsp	2010-09-25 05:39:51 UTC (rev 14285)
@@ -1,5 +1,7 @@
 &lt;%@ taglib uri="<a href="http://www.zkoss.org/dsp/web/core" target="_new">http://www.zkoss.org/dsp/web/core</a>" prefix="c" %&gt;
 .z-panel-shadow {
+	border-radius: 4px;
+	box-shadow:0 0 3px rgba(0, 0, 0, 0.5);
 	-moz-border-radius: 4px;
 	-moz-box-shadow:0 0 3px rgba(0, 0, 0, 0.5);
 	-webkit-border-radius: 4px;

Modified: branches/5.0/zul/src/archive/web/js/zul/wnd/css/window.css.dsp
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/wnd/css/window.css.dsp	2010-09-24 05:48:07 UTC (rev 14284)
+++ branches/5.0/zul/src/archive/web/js/zul/wnd/css/window.css.dsp	2010-09-25 05:39:51 UTC (rev 14285)
@@ -5,6 +5,8 @@
 .z-window-popup-shadow,
 .z-window-embedded-shadow,
 .z-window-highlighted-shadow {
+	border-radius: 4px;
+	box-shadow:0 0 3px rgba(0, 0, 0, 0.5);
 	-moz-border-radius: 4px;
 	-moz-box-shadow:0 0 3px rgba(0, 0, 0, 0.5);
 	-webkit-border-radius: 4px;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26228810">[zk1-subversion-log] SF.net SVN: zk1:[14286] branches/5.0</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-27 05:46</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14286
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14286&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14286&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-27 05:46:17 +0000 (Mon, 27 Sep 2010)

Log Message:
-----------
Mon 09/27/2010

Modified Paths:
--------------
    branches/5.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
    branches/5.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java
    branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
    branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
    branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java
    branches/5.0/zk/src/org/zkoss/zk/ui/sys/HtmlPageRenders.java
    branches/5.0/zk/src/org/zkoss/zk/ui/sys/PageConfig.java
    branches/5.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java
    branches/5.0/zweb/src/org/zkoss/web/servlet/Servlets.java

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-25 05:39:51 UTC (rev 14285)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-27 05:46:17 UTC (rev 14286)
@@ -1528,14 +1528,6 @@
 	protected void smartUpdate(String attr, Date value) {
 		smartUpdate(attr, (Object)value);
 	}
-	/** A special smart update to update a value to the given component.
-	 * &lt;p&gt;It is the same as
-	 * &lt;code&gt;smartUpdate(attr, comp != null ? comp.getUuid(): null)&lt;/code&gt;.
-	 * @since 5.0.5
-	 */
-	protected void smartUpdate(String attr, Component comp) {
-		smartUpdate(attr, comp != null ? comp.getUuid(): null);
-	}
 	/** A special smart update to update an event listener for the
 	 * peer widget.
 	 * By default, it assumes the peer widget has a method called

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java	2010-09-25 05:39:51 UTC (rev 14285)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java	2010-09-27 05:46:17 UTC (rev 14286)
@@ -648,9 +648,9 @@
 			if (s != null) setStyle(s);
 		}
 
-		s = config.getHeaders(true);
+		s = config.getBeforeHeadTags();
 		if (s != null) _hdbfr = s;
-		s = config.getHeaders(false);
+		s = config.getAfterHeadTags();
 		if (s != null) _hdaft = s;
 		_hdres = config.getResponseHeaders();
 		if (_hdres.isEmpty()) _hdres = null;
@@ -681,9 +681,30 @@
 		return _ips != null;
 	}
 
+	public String getBeforeHeadTags() {
+		return _hdbfr;
+	}
+	public String getAfterHeadTags() {
+		return _hdaft;
+	}
+	public void addBeforeHeadTags(String tags) {
+		if (tags != null &amp;&amp; tags.length() &gt; 0)
+			_hdbfr += '\n' + tags;
+	}
+	public void addAfterHeadTags(String tags) {
+		if (tags != null &amp;&amp; tags.length() &gt; 0)
+			_hdaft += '\n' + tags;
+	}
+
+	/** @deprecated As of release 5.0.5, replaced with {@link #getBeforeHeadTags}
+	 * and {@link #getAfterHeadTags}.
+	 */
 	public String getHeaders(boolean before) {
 		return before ? _hdbfr: _hdaft;
 	}
+	/** @deprecated As of release 5.0.5, replaced with {@link #getBeforeHeadTags}
+	 * and {@link #getAfterHeadTags}.
+	 */
 	public String getHeaders() {
 		return _hdbfr + _hdaft;
 	}

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-25 05:39:51 UTC (rev 14285)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-27 05:46:17 UTC (rev 14286)
@@ -399,8 +399,12 @@
 					public String getUuid() {return null;}
 					public String getTitle() {return null;}
 					public String getStyle() {return null;}
-					public String getHeaders(boolean before) {return null;}
-					public String getHeaders() {return null;}
+					public String getBeforeHeadTags() {return "";}
+					public String getAfterHeadTags() {return "";}
+					/** @deprecated */
+					public String getHeaders(boolean before) {return "";}
+					/** @deprecated */
+					public String getHeaders() {return "";}
 					public Collection getResponseHeaders() {return Collections.EMPTY_LIST;}
 				});
 				final Composer composer = config.getComposer(page);

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-25 05:39:51 UTC (rev 14285)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-27 05:46:17 UTC (rev 14286)
@@ -341,6 +341,7 @@
 			&amp;&amp; _ldefByName.containsKey(namespace))
 				throw new UiException("Different language, "+name+", with the same namespace, "+namespace);
 
+			_ldefByName.put(namespace, this);
 			final Object old = _ldefByName.put(name, this);
 			if (old != null) {
 				final List ldefs = (List)_ldefsByClient.get(deviceType);

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java	2010-09-25 05:39:51 UTC (rev 14285)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java	2010-09-27 05:46:17 UTC (rev 14286)
@@ -469,20 +469,33 @@
 	public void addHeaderInfo(HeaderInfo header) {
 		addHeaderInfo(header, "meta".equals(header.getName()));
 	}
-	/** Converts the header definitions (added by {@link #addHeaderInfo}) to
-	 * HTML tags.
+	/** Returns the content that shall be generated inside the head element
+	 * and before ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * @param before whether to return the headers that shall be shown
-	 * before ZK's CSS/JS headers.
-	 * If true, only the headers that shall be shown before (such as meta)
-	 * are returned.
-	 * If true, only the headers that shall be shown after (such as link)
-	 * are returned.
-	 * @see #getHeaders(Page)
-	 * @since 3.6.1
+	 * &lt;p&gt;Since it is generated before ZK's default tags (such as CSS and JS),
+	 * it cannot override ZK's default behaviors.
+	 *
+	 * @see #getAfterHeadTags
+	 * @since 5.0.5
 	 */
-	public String getHeaders(Page page, boolean before) {
-		final List defs = before ? _hdBfrDefs: _hdAftDefs;
+	public String getBeforeHeadTags(Page page) {
+		return getHeadTags(page, _hdBfrDefs);
+	}
+	/** Returns the content that shall be generated inside the head element
+	 * and after ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
+	 *
+	 * &lt;p&gt;Since it is generated after ZK's default tags (such as CSS and JS),
+	 * it could override ZK's default behaviors.
+	 *
+	 * @see #getBeforeHeadTags
+	 * @since 5.0.5
+	 */
+	public String getAfterHeadTags(Page page) {
+		return getHeadTags(page, _hdAftDefs);
+	}
+	private String getHeadTags(Page page, List defs) {
 		if (defs == null)
 			return "";
 
@@ -494,14 +507,19 @@
 		}
 		return sb.toString();
 	}
-	/** Converts all header definitions (added by {@link #addHeaderInfo}) to
-	 * HTML tags, no matter that shall be shown before or after ZK's
-	 * CSS/JS headers.
-	 * To have better control, use {@link #getHeaders(Page,boolean)} instead.
+	/** @deprecated As of release 5.0.5, replaced with {@link #getBeforeHeadTags}
+	 * and {@link #getAfterHeadTags}.
 	 */
+	public String getHeaders(Page page, boolean before) {
+		return before ? getBeforeHeadTags(page): getAfterHeadTags(page);
+	}
+	/** @deprecated As of release 5.0.5, replaced with {@link #getBeforeHeadTags}
+	 * and {@link #getAfterHeadTags}.
+	 */
 	public String getHeaders(Page page) {
-		return getHeaders(page, true) + getHeaders(page, false);
+		return getBeforeHeadTags(page) + getAfterHeadTags(page);
 	}
+
 	/** Adds a forward definition ({@link ForwardInfo}).
 	 */
 	public void addForwardInfo(ForwardInfo forward) {
@@ -867,14 +885,22 @@
 				public String getUuid() {return null;}
 				public String getTitle() {return _title;}
 				public String getStyle() {return _style;}
-				public String getHeaders(boolean before) {
+				public String getBeforeHeadTags() {
 					return evalHeaders ?
-						PageDefinition.this.getHeaders(page, before): "";
+						PageDefinition.this.getBeforeHeadTags(page): "";
 				}
-				public String getHeaders() {
+				public String getAfterHeadTags() {
 					return evalHeaders ?
-						PageDefinition.this.getHeaders(page): "";
+						PageDefinition.this.getAfterHeadTags(page): "";
 				}
+				/** @deprecated */
+				public String getHeaders(boolean before) {
+					return before ? getBeforeHeadTags(): getAfterHeadTags();
+				}
+				/** @deprecated */
+				public String getHeaders() {
+					return getBeforeHeadTags() + getAfterHeadTags();
+				}
 				public Collection getResponseHeaders() {
 					return evalHeaders ?
 						PageDefinition.this.getResponseHeaders(page):

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/sys/HtmlPageRenders.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/sys/HtmlPageRenders.java	2010-09-25 05:39:51 UTC (rev 14285)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/sys/HtmlPageRenders.java	2010-09-27 05:46:17 UTC (rev 14286)
@@ -775,7 +775,8 @@
 			return null;
 
 		exec.setAttribute(attr, Boolean.TRUE); //generated only once
-		return ((PageCtrl)page).getHeaders(before);
+		return before ? ((PageCtrl)page).getBeforeHeadTags():
+			((PageCtrl)page).getAfterHeadTags();
 	}
 	/** Generates and returns the ZK specific HTML tags including
 	 * the headers defined in the specified page, or null if it was

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/sys/PageConfig.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/sys/PageConfig.java	2010-09-25 05:39:51 UTC (rev 14285)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/sys/PageConfig.java	2010-09-27 05:46:17 UTC (rev 14286)
@@ -54,32 +54,36 @@
 	 * a non-empty value before, this method is ignored.
 	 */
 	public String getStyle();
-	/** Returns the content of the specified condition
-	 * that shall be generated inside the header element
-	 * (HTML HEAD), or null if no special header is required.
+
+	/** Returns the content that shall be generated inside the head element
+	 * and before ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * &lt;p&gt;For HTML, the header element is the HEAD element.
+	 * &lt;p&gt;Since it is generated before ZK's default tags (such as CSS and JS),
+	 * it cannot override ZK's default behaviors.
 	 *
-	 * @param before whether to return the headers that shall be shown
-	 * before ZK's CSS/JS headers.
-	 * If true, only the headers that shall be shown before (such as meta)
-	 * are returned.
-	 * If true, only the headers that shall be shown after (such as link)
-	 * are returned.
-	 * @see #getHeaders()
-	 * @since 3.6.1
+	 * @see #getAfterHeadTags
+	 * @since 5.0.5
 	 */
-	public String getHeaders(boolean before);
-	/** Returns all content that will be generated inside the header element
-	 * (HTML HEAD), or null if no special header is required.
-	 * &lt;p&gt;For HTML, the header element is the HEAD element.
-	 * &lt;p&gt;It returns all header no matter it shall be shown before or
-	 * after ZK's CSS/JS headers. To have more control, use
-	 * {@link #getHeaders(boolean)} instead.
+	public String getBeforeHeadTags();
+	/** Returns the content that shall be generated inside the head element
+	 * and after ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * @see PageCtrl#getHeaders
-	 * @see #getHeaders(boolean)
+	 * &lt;p&gt;Since it is generated after ZK's default tags (such as CSS and JS),
+	 * it could override ZK's default behaviors.
+	 *
+	 * @see #getBeforeHeadTags
+	 * @since 5.0.5
 	 */
+	public String getAfterHeadTags();
+	/** @deprecated As of release 5.0.5, replaced with {@link #getBeforeHeadTags}
+	 * and {@link #getAfterHeadTags}.
+	 */
+	public String getHeaders(boolean before);
+	/** @deprecated As of release 5.0.5, replaced with {@link #getBeforeHeadTags}
+	 * and {@link #getAfterHeadTags}.
+	 */
 	public String getHeaders();
 
 	/** Returns a readonly collection of response headers (never null).

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java	2010-09-25 05:39:51 UTC (rev 14285)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java	2010-09-27 05:46:17 UTC (rev 14286)
@@ -72,32 +72,56 @@
 	 */
 	public void destroy();
 
-	/** Returns the content of the specified condition
-	 * that shall be generated inside the header element
-	 * (never null).
+	/** Returns the tags that shall be generated inside the head element
+	 * and before ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * &lt;p&gt;For HTML, the header element is the HEAD element.
+	 * &lt;p&gt;Since it is generated before ZK's default tags (such as CSS and JS),
+	 * it cannot override ZK's default behaviors.
 	 *
-	 * @param before whether to return the headers that shall be shown
-	 * before ZK's CSS/JS headers.
-	 * If true, only the headers that shall be shown before (such as meta)
-	 * are returned.
-	 * If true, only the headers that shall be shown after (such as link)
-	 * are returned.
-	 * @see #getHeaders()
-	 * @since 3.6.1
+	 * @see #getAfterHeadTags
+	 * @since 5.0.5
 	 */
-	public String getHeaders(boolean before);
-	/** Returns all content that will be generated inside the header element
-	 * (never null).
-	 * &lt;p&gt;For HTML, the header element is the HEAD element.
-	 * &lt;p&gt;It returns all header no matter it shall be shown before or
-	 * after ZK's CSS/JS headers. To have more control, use
-	 * {@link #getHeaders(boolean)} instead.
+	public String getBeforeHeadTags();
+	/** Returns the tags that shall be generated inside the head element
+	 * and after ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * @see #getHeaders(boolean)
+	 * &lt;p&gt;Since it is generated after ZK's default tags (such as CSS and JS),
+	 * it could override ZK's default behaviors.
+	 *
+	 * @see #getBeforeHeadTags
+	 * @since 5.0.5
 	 */
+	public String getAfterHeadTags();
+	/** Adds the tags that will be generated inside the head element
+	 * and before ZK's default tags. For example,
+	 * &lt;pre&gt;&lt;code&gt;((PageCtrl)page).addBeforeHeadTags("&lt;meta name=\"robots\" content=\"index,follow\"/&gt;");&lt;/code&gt;&lt;/pre&gt;
+	 *
+	 * &lt;p&gt;You could specify the link, meta and script directive to have the similar
+	 * result.
+	 * @since 5.0.5
+	 */
+	public void addBeforeHeadTags(String tags);
+	/** Adds the tags that will be generated inside the head element
+	 * and after ZK's default tags. For example,
+	 * &lt;pre&gt;&lt;code&gt;((PageCtrl)page).addBeforeHeadTags("&lt;meta name=\"robots\" content=\"index,follow\"/&gt;");&lt;/code&gt;&lt;/pre&gt;
+	 *
+	 * &lt;p&gt;You could specify the link, meta and script directive to have the similar
+	 * result.
+	 * @since 5.0.5
+	 */
+	public void addAfterHeadTags(String tags);
+
+	/** @deprecated As of release 5.0.5, replaced with {@link #getBeforeHeadTags}
+	 * and {@link #getAfterHeadTags}.
+	 */
+	public String getHeaders(boolean before);
+	/** @deprecated As of release 5.0.5, replaced with {@link #getBeforeHeadTags}
+	 * and {@link #getAfterHeadTags}.
+	 */
 	public String getHeaders();
+
 	/** Returns a readonly collection of response headers (never null).
 	 * The entry is a three-element object array.
 	 * The first element is the header name.

Modified: branches/5.0/zweb/src/org/zkoss/web/servlet/Servlets.java
===================================================================
--- branches/5.0/zweb/src/org/zkoss/web/servlet/Servlets.java	2010-09-25 05:39:51 UTC (rev 14285)
+++ branches/5.0/zweb/src/org/zkoss/web/servlet/Servlets.java	2010-09-27 05:46:17 UTC (rev 14286)
@@ -283,7 +283,7 @@
 	/** Returns whether the user agent is a browser of the specified type.
 	 *
 	 * @param type the type of the browser.
-	 * Allowed values include "robot", "ie", "ie6", "ie6-", "ie7", "ie8",
+	 * Allowed values include "robot", "ie", "ie6", "ie6-", "ie7", "ie8", "ie9",
 	 * "ie7-", "gecko", "gecko2", "gecko3", "gecko3.5", "gecko2-", "gecko3-",
 	 * "opara", "safari",
 	 * "hil". Otherwise, it matches whether the type exist or not.&lt;br/&gt;
@@ -304,12 +304,16 @@
 		if ("ie7-".equals(type)) return getIEVer(userAgent) == 7;
 		if ("ie8".equals(type)) return getIEVer(userAgent) &gt;= 8;
 		if ("ie8-".equals(type)) return getIEVer(userAgent) == 8;
+		if ("ie9".equals(type)) return getIEVer(userAgent) &gt;= 9;
+		if ("ie9-".equals(type)) return getIEVer(userAgent) == 9;
 
 		if ("gecko".equals(type) || "gecko2".equals(type)) return isGecko(userAgent);
 		if ("gecko2-".equals(type)) return getGeckoVer(userAgent) == 2;
 		if ("gecko3".equals(type)) return isGecko3(userAgent);
 		if ("gecko3.5".equals(type)) return getGeckoVer(userAgent, true) &gt;= 35;
 		if ("gecko3-".equals(type)) return getGeckoVer(userAgent) == 3;
+		if ("gecko4".equals(type)) return getGeckoVer(userAgent) &gt;= 4;
+		if ("gecko4-".equals(type)) return getGeckoVer(userAgent) == 4;
 
 		if ("safari".equals(type)) return isSafari(userAgent);
 		if ("opera".equals(type)) return isOpera(userAgent);


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26352571">[zk1-subversion-log] SF.net SVN: zk1:[14294] branches/5.0</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-10-01 05:38</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14294
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14294&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14294&amp;view=rev</a>
Author:   asuka1978
Date:     2010-10-01 05:38:33 +0000 (Fri, 01 Oct 2010)

Log Message:
-----------
Fri 10/01/2010

Modified Paths:
--------------
    branches/5.0/zkdemo/src/archive/userguide/form/hello.zul
    branches/5.0/zul/src/archive/metainfo/zk/lang.xml
    branches/5.0/zul/src/archive/web/js/zul/box/zk.wpd
    branches/5.0/zul/src/archive/web/js/zul/layout/zk.wpd

Added Paths:
-----------
    branches/5.0/zul/src/archive/web/js/zul/box/Hlayout.js
    branches/5.0/zul/src/archive/web/js/zul/box/Layout.js
    branches/5.0/zul/src/archive/web/js/zul/box/Vlayout.js
    branches/5.0/zul/src/archive/web/js/zul/box/css/layout.css.dsp
    branches/5.0/zul/src/archive/web/js/zul/box/mold/layout.js

Modified: branches/5.0/zkdemo/src/archive/userguide/form/hello.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/userguide/form/hello.zul	2010-09-30 05:38:05 UTC (rev 14293)
+++ branches/5.0/zkdemo/src/archive/userguide/form/hello.zul	2010-10-01 05:38:33 UTC (rev 14294)
@@ -38,12 +38,14 @@
 			&lt;tabpanel&gt;
 				&lt;panel&gt;
 					&lt;panelchildren&gt;
-						&lt;textbox id="codeView" class="code" rows="20" width="95%"&gt;
-			&lt;attribute name="value"&gt;&lt;![CDATA[
+						&lt;textbox id="codeView" tabbable="true" class="code" rows="20" width="95%"&gt;
+
+&lt;attribute name="value"&gt;&lt;![CDATA[
 &lt;window title="My First Window" border="normal" width="200px"&gt;
-  Hello, World!
+Hello, World!
 &lt;/window&gt;
-			]]&gt;&lt;/attribute&gt;
+]]&gt;&lt;/attribute&gt;
+
 						&lt;/textbox&gt;
 					&lt;/panelchildren&gt;
 					&lt;toolbar mold="panel"&gt;

Modified: branches/5.0/zul/src/archive/metainfo/zk/lang.xml
===================================================================
--- branches/5.0/zul/src/archive/metainfo/zk/lang.xml	2010-09-30 05:38:05 UTC (rev 14293)
+++ branches/5.0/zul/src/archive/metainfo/zk/lang.xml	2010-10-01 05:38:33 UTC (rev 14294)
@@ -599,7 +599,7 @@
 	&lt;component&gt;
 		&lt;component-name&gt;hlayout&lt;/component-name&gt;
 		&lt;component-class&gt;org.zkoss.zul.Hlayout&lt;/component-class&gt;
-		&lt;widget-class&gt;zul.layout.Hlayout&lt;/widget-class&gt;
+		&lt;widget-class&gt;zul.box.Hlayout&lt;/widget-class&gt;
 		&lt;mold&gt;
 			&lt;mold-name&gt;default&lt;/mold-name&gt;
 			&lt;mold-uri&gt;mold/layout.js&lt;/mold-uri&gt;
@@ -1239,7 +1239,7 @@
 	&lt;component&gt;
 		&lt;component-name&gt;vlayout&lt;/component-name&gt;
 		&lt;component-class&gt;org.zkoss.zul.Vlayout&lt;/component-class&gt;
-		&lt;widget-class&gt;zul.layout.Vlayout&lt;/widget-class&gt;
+		&lt;widget-class&gt;zul.box.Vlayout&lt;/widget-class&gt;
 		&lt;mold&gt;
 			&lt;mold-name&gt;default&lt;/mold-name&gt;
 			&lt;mold-uri&gt;mold/layout.js&lt;/mold-uri&gt;

Added: branches/5.0/zul/src/archive/web/js/zul/box/Hlayout.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/box/Hlayout.js	                        (rev 0)
+++ branches/5.0/zul/src/archive/web/js/zul/box/Hlayout.js	2010-10-01 05:38:33 UTC (rev 14294)
@@ -0,0 +1,27 @@
+/* Hlayout.js
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Fri Aug  6 11:54:19 TST 2010, Created by jumperchen
+
+Copyright (C) 2010 Potix Corporation. All Rights Reserved.
+
+This program is distributed under GPL Version 3.0 in the hope that
+it will be useful, but WITHOUT ANY WARRANTY.
+*/
+/**
+ * A horizontal layout.
+ * &lt;p&gt;Default {@link #getZclass}: z-hlayout.
+ * @since 5.0.4
+ */
+zul.box.Hlayout = zk.$extends(zul.box.Layout, {
+	isVertical_: function () {
+		return false;
+	},
+	getZclass: function () {
+		return this._zclass == null ? "z-hlayout" : this._zclass;
+	}
+});
\ No newline at end of file

Added: branches/5.0/zul/src/archive/web/js/zul/box/Layout.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/box/Layout.js	                        (rev 0)
+++ branches/5.0/zul/src/archive/web/js/zul/box/Layout.js	2010-10-01 05:38:33 UTC (rev 14294)
@@ -0,0 +1,312 @@
+/* Layout.js
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Fri Aug  6 16:13:00 TST 2010, Created by jumperchen
+
+Copyright (C) 2010 Potix Corporation. All Rights Reserved.
+
+This program is distributed under GPL Version 3.0 in the hope that
+it will be useful, but WITHOUT ANY WARRANTY.
+*/
+/**
+ * A skeleton of Vlayout and Hlayout.
+ * @since 5.0.4
+ */
+zul.box.Layout = zk.$extends(zk.Widget, {
+	_spacing: '0.3em',
+	$define: {
+		/** Sets the spacing between adjacent children.
+	 	 * @param String spacing the spacing (such as "0", "5px", "3pt" or "1em"),
+	 	 * or null to use the default spacing
+	 	 * @see #getSpacing
+	 	 */
+		/** Returns the spacing between adjacent children, or null if the default
+	 	 * spacing is used.
+	 	 *
+	 	 * &lt;p&gt;Default: 0.3em (means to use the default spacing).
+	 	 * @return String
+	 	 */
+		spacing: [function (v) {
+			return v ? v : '0.3em';
+		}, function () {
+			var n = this.$n(),
+				vert = this.isVertical_();
+			if (n) {
+				jq(n).children('div').css('padding-' + (vert ? 'bottom' : 'right'), this._spacing ? this._spacing : '');
+			}
+		}]
+	},
+	_chdextr: function (child) {
+		return child.$n('chdex') || child.$n();
+	},
+	insertChildHTML_: function (child, before, desktop) {
+		if (before) {
+			jq(this._chdextr(before)).before(this.encloseChildHTML_(child));
+		} else {
+			jq(this.$n()).append(this.encloseChildHTML_(child));
+		}
+		child.bind(desktop);
+	},
+	bind_: function () {
+		this.$supers(zul.box.Layout, 'bind_', arguments);
+		zWatch.listen({onResponse: this});
+	},
+	unbind_: function () {
+		zWatch.unlisten({onResponse: this});
+		this.$supers(zul.box.Layout, 'unbind_', arguments);
+	},
+	onResponse: function () {
+		if (this._shallSize) {
+			zWatch.fire('onSize', this);
+			this._shallSize = false;
+		}
+	},
+	_syncSize: function () {
+		this._shallSize = true;
+		if (!this.inServer &amp;&amp; this.desktop)
+			this.onResponse();
+	},
+	onChildAdded_: function () {
+		this.$supers('onChildRemoved_', arguments);
+		this._syncSize();
+	},
+	onChildRemoved_: function () {
+		this.$supers('onChildRemoved_', arguments);
+		this._syncSize();
+	},
+	removeChildHTML_: function (child) {
+		this.$supers('removeChildHTML_', arguments);
+		jq(child.uuid + '-chdex', zk).remove();
+	},
+	/** Enclose child with HTML tag such as DIV, 
+	 * and return a HTML code or add HTML fragments in out array.
+	 * @param zk.Widget child the child which will be enclosed
+	 * @param Array out an array of HTML fragments.
+	 * @return String
+	 */
+	encloseChildHTML_: function (child, out) {
+		var oo = [],
+			vert = this.isVertical_();
+		
+		oo.push('&lt;div id="', child.uuid, '-chdex" class="', this.getZclass(), '-inner"',
+				this._spacing ? ' style="padding-' + (vert ? 'bottom:' : 'right:') + this._spacing + '"&gt;' : '&gt;');
+		child.redraw(oo);
+		oo.push('&lt;/div&gt;');
+		if (!out) return oo.join('');
+
+		for (var j = 0, len = oo.length; j &lt; len; ++j)
+			out.push(oo[j]);
+	},
+	/**
+	 * Returns whether the layout is vertical
+	 * @return boolean
+	 */
+	isVertical_: zk.$void,
+	_resetBoxSize: function () {
+		var vert = this.isVertical_();
+		for (var kid = this.firstChild; kid; kid = kid.nextSibling) {
+			if (vert ? (kid._nvflex &amp;&amp; kid.getVflex() != 'min')
+					 : (kid._nhflex &amp;&amp; kid.getHflex() != 'min')) {
+				
+				kid.setFlexSize_({height:'', width:''});
+				var chdex = kid.$n('chdex');
+				if (chdex) {
+					chdex.style.height = '';
+					chdex.style.width = '';
+				}
+			}
+		}
+		//bug 3010663: boxes do not resize when browser window is resized
+		var p = this.$n(),
+			zkp = zk(p),
+			offhgh = p.offsetHeight,
+			offwdh = p.offsetWidth,
+			curhgh = this._vflexsz !== undefined ? this._vflexsz - zkp.sumStyles("tb", jq.margins) : offhgh,
+			curwdh = this._hflexsz !== undefined ? this._hflexsz - zkp.sumStyles("lr", jq.margins) : offwdh,
+			hgh = zkp.revisedHeight(curhgh &lt; offhgh ? curhgh : offhgh),
+			wdh = zkp.revisedWidth(curwdh &lt; offwdh ? curwdh : offwdh);
+		return zkp ? {height: hgh, width: wdh} : {};
+	},
+	//bug#3042306
+	resetSize_: function (orient) { ////@Overrid zk.Widget#resetSize_, called when beforeSize
+		this.$supers(zul.box.Layout, 'resetSize_', arguments);
+		var vert = this.isVertical_();
+		for (var kid = this.firstChild; kid; kid = kid.nextSibling) {
+			if (vert ? (kid._nvflex &amp;&amp; kid.getVflex() != 'min')
+					 : (kid._nhflex &amp;&amp; kid.getHflex() != 'min')) {
+				
+				var chdex = kid.$n('chdex');
+				if (chdex) {
+					if (orient == 'h')
+						chdex.style.height = '';
+					if (orient == 'w')
+						chdex.style.width = '';
+				}
+			}
+		}
+	},
+	beforeChildrenFlex_: function(child) {
+		if (child._flexFixed || (!child._nvflex &amp;&amp; !child._nhflex)) { //other vflex/hflex sibliing has done it!
+			delete child._flexFixed;
+			return false;
+		}
+		
+		child._flexFixed = true;
+		
+		var	vert = this.isVertical_(),
+			vflexs = [],
+			vflexsz = vert ? 0 : 1,
+			hflexs = [],
+			hflexsz = !vert ? 0 : 1,
+			p = child.$n('chdex').parentNode,
+			psz = this._resetBoxSize(),
+			hgh = psz.height,
+			wdh = psz.width,
+			xc = p.firstChild;
+		
+		for (; xc; xc = xc.nextSibling) {
+			var c = xc.id &amp;&amp; xc.id.endsWith('-chdex') ? xc.firstChild : xc,
+				zkc = zk(c);
+			if (zkc.isVisible()) {
+				var j = c.id ? c.id.indexOf('-') : 1,
+					cwgt = j &lt; 0 ? zk.Widget.$(c.id) : null,
+					offhgh = zkc.offsetHeight(),
+					offwdh = zkc.offsetWidth(),
+					cwdh = offwdh + zkc.sumStyles("lr", jq.margins),
+					chgh = offhgh + zkc.sumStyles("tb", jq.margins);
+				
+				//vertical size
+				if (cwgt &amp;&amp; cwgt._nvflex) {
+					if (cwgt !== child)
+						cwgt._flexFixed = true; //tell other vflex siblings I have done it.
+					if (cwgt._vflex == 'min') {
+						cwgt.fixMinFlex_(c, 'h');
+						xc.style.height = c.style.height;
+						if (vert)
+							hgh -= xc.offsetHeight;
+					} else {
+						vflexs.push(cwgt);
+						if (vert) vflexsz += cwgt._nvflex;
+					}
+				} else if (vert) hgh -= chgh;
+				
+				//horizontal size
+				if (cwgt &amp;&amp; cwgt._nhflex) {
+					if (cwgt !== child)
+						cwgt._flexFixed = true; //tell other hflex siblings I have done it.
+					if (cwgt._hflex == 'min') {
+						cwgt.fixMinFlex_(c, 'w');
+						xc.style.width = c.style.width;
+						if (!vert)
+							wdh -= xc.offsetWidth;
+					} else {
+						hflexs.push(cwgt);
+						if (!vert) hflexsz += cwgt._nhflex;
+					}
+				} else if (!vert) wdh -= cwdh;
+			}
+		}
+
+		//setup the height for the vflex child
+		//avoid floating number calculation error(TODO: shall distribute error evenly)
+		var lastsz = hgh &gt; 0 ? hgh : 0;
+		for (var j = vflexs.length; --j &gt; 0;) {
+			var cwgt = vflexs.shift(), 
+				vsz = (cwgt._nvflex * hgh / vflexsz) | 0, //cast to integer
+				offtop = cwgt.$n().offsetTop,
+				isz = vsz - ((zk.ie &amp;&amp; offtop &gt; 0) ? (offtop * 2) : 0); 
+			cwgt.setFlexSize_({height:isz});
+			cwgt._vflexsz = vsz;
+			
+			var chdex = cwgt.$n('chdex');
+			chdex.style.height = jq.px0(zk(chdex).revisedHeight(vsz, true));
+			if (vert) lastsz -= vsz;
+		}
+		//last one with vflex
+		if (vflexs.length) {
+			var cwgt = vflexs.shift(),
+				offtop = cwgt.$n().offsetTop,
+				isz = lastsz - ((zk.ie &amp;&amp; offtop &gt; 0) ? (offtop * 2) : 0);
+			cwgt.setFlexSize_({height:isz});
+			cwgt._vflexsz = lastsz;
+			var chdex = cwgt.$n('chdex');
+			chdex.style.height = jq.px0(zk(chdex).revisedHeight(lastsz, true));
+		}
+		
+		//setup the width for the hflex child
+		//avoid floating number calculation error(TODO: shall distribute error evenly)
+		lastsz = wdh &gt; 0 ? wdh : 0;
+		for (var j = hflexs.length; --j &gt; 0;) {
+			var cwgt = hflexs.shift(), //{n: node, f: hflex} 
+				hsz = (cwgt._nhflex * wdh / hflexsz) | 0; //cast to integer
+			cwgt.setFlexSize_({width:hsz});
+			cwgt._hflexsz = hsz;
+		
+			var chdex = cwgt.$n('chdex');
+			chdex.style.width = jq.px0(zk(chdex).revisedWidth(hsz, true));
+			
+			if (!vert) lastsz -= hsz;
+		}
+		//last one with hflex
+		if (hflexs.length) {
+			var cwgt = hflexs.shift();
+			cwgt.setFlexSize_({width:lastsz});
+			cwgt._hflexsz = lastsz;
+			
+			var chdex = cwgt.$n('chdex');
+			chdex.style.width = jq.px0(zk(chdex).revisedWidth(lastsz, true));
+		}
+		
+		//notify all of children with xflex is done.
+		child.parent.afterChildrenFlex_(child);
+		child._flexFixed = false;
+		
+		return false; //to skip original _fixFlex
+	},
+	afterChildrenMinFlex_: function (opts) {
+		var n = this.$n();
+		if (opts == 'h') {
+			if (this.isVertical_()) {
+    			var total = 0;
+    			for (var w = n.firstChild; w; w = w.nextSibling) {
+    				if (w.firstChild.style.height) {
+    					w.style.height = jq.px0(zk(w).revisedHeight(w.firstChild.offsetHeight));
+    				}
+    				total += w.offsetHeight;
+    			}
+    			n.style.height = jq.px0(total);
+			} else {
+    			var max = 0;
+    			for (var w = n.firstChild; w; w = w.nextSibling) {
+    				var h = w.firstChild.offsetHeight;
+    				if (h &gt; max)
+    					max = h;
+    			}
+    			n.style.height = jq.px0(max);
+			}
+		} else {
+			if (!this.isVertical_()) {
+    			var total = 0;
+    			for (var w = n.firstChild; w; w = w.nextSibling) {
+    				if (w.firstChild.style.width) {
+    					w.style.width = jq.px0(zk(w).revisedWidth(w.firstChild.offsetWidth));
+    				}
+    				total += w.offsetWidth;
+    			}
+    			n.style.width = jq.px0(total);
+			} else {
+    			var max = 0;
+    			for (var w = n.firstChild; w; w = w.nextSibling) {
+    				var wd = w.firstChild.offsetWidth;
+    				if (wd &gt; max)
+    					max = wd;
+    			}
+    			n.style.height = jq.px0(max);				
+			}
+		}
+	}
+});
\ No newline at end of file

Added: branches/5.0/zul/src/archive/web/js/zul/box/Vlayout.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/box/Vlayout.js	                        (rev 0)
+++ branches/5.0/zul/src/archive/web/js/zul/box/Vlayout.js	2010-10-01 05:38:33 UTC (rev 14294)
@@ -0,0 +1,27 @@
+/* Vlayout.js
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Fri Aug  6 12:37:19 TST 2010, Created by jumperchen
+
+Copyright (C) 2010 Potix Corporation. All Rights Reserved.
+
+This program is distributed under GPL Version 3.0 in the hope that
+it will be useful, but WITHOUT ANY WARRANTY.
+*/
+/**
+ * A vertical layout.
+ * &lt;p&gt;Default {@link #getZclass}: z-vlayout.
+ * @since 5.0.4
+ */
+zul.box.Vlayout = zk.$extends(zul.box.Layout, {
+	getZclass: function () {
+		return this._zclass == null ? "z-vlayout" : this._zclass;
+	},
+	isVertical_: function () {
+		return true;
+	}
+});
\ No newline at end of file

Added: branches/5.0/zul/src/archive/web/js/zul/box/css/layout.css.dsp
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/box/css/layout.css.dsp	                        (rev 0)
+++ branches/5.0/zul/src/archive/web/js/zul/box/css/layout.css.dsp	2010-10-01 05:38:33 UTC (rev 14294)
@@ -0,0 +1,26 @@
+&lt;%@ taglib uri="<a href="http://www.zkoss.org/dsp/web/core" target="_new">http://www.zkoss.org/dsp/web/core</a>" prefix="c" %&gt;
+.z-hlayout, .z-vlayout {
+	overflow: hidden;
+}
+.z-hlayout {
+	white-space: nowrap;
+}
+.z-hlayout-inner {
+	display:-moz-inline-box;
+	display: inline-block;
+	position: relative;
+	vertical-align: top;
+	zoom: 1;
+}
+.z-vlayout-inner {
+	position: relative;
+	zoom: 1;
+}
+&lt;c:if test="${c:isExplorer() and not c:browser('ie8')}"&gt;
+.z-hlayout, .z-vlayout {
+	position: relative;
+}
+.z-hlayout-inner {
+	display: inline;
+}
+&lt;/c:if&gt;
\ No newline at end of file

Added: branches/5.0/zul/src/archive/web/js/zul/box/mold/layout.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/box/mold/layout.js	                        (rev 0)
+++ branches/5.0/zul/src/archive/web/js/zul/box/mold/layout.js	2010-10-01 05:38:33 UTC (rev 14294)
@@ -0,0 +1,20 @@
+/* layout.js
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Fri Aug  6 11:54:41 TST 2010, Created by jumperchen
+
+Copyright (C) 2010 Potix Corporation. All Rights Reserved.
+
+This program is distributed under GPL Version 3.0 in the hope that
+it will be useful, but WITHOUT ANY WARRANTY.
+*/
+function (out) {
+    out.push('&lt;div ', this.domAttrs_(), '&gt;');
+	for (var w = this.firstChild; w; w = w.nextSibling)
+		this.encloseChildHTML_(w, out);
+    out.push('&lt;/div&gt;');
+}
\ No newline at end of file

Modified: branches/5.0/zul/src/archive/web/js/zul/box/zk.wpd
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/box/zk.wpd	2010-09-30 05:38:05 UTC (rev 14293)
+++ branches/5.0/zul/src/archive/web/js/zul/box/zk.wpd	2010-10-01 05:38:33 UTC (rev 14294)
@@ -12,6 +12,10 @@
 --&gt;
 
 &lt;package name="zul.box" language="xul/html" depends="zul,zul.wgt"&gt;
+	&lt;script src="Layout.js" jsdoc="true"/&gt;
+	
 	&lt;widget name="Box"/&gt;
 	&lt;widget name="Splitter"/&gt;
+	&lt;widget name="Hlayout"/&gt;
+	&lt;widget name="Vlayout"/&gt;
 &lt;/package&gt;

Modified: branches/5.0/zul/src/archive/web/js/zul/layout/zk.wpd
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/layout/zk.wpd	2010-09-30 05:38:05 UTC (rev 14293)
+++ branches/5.0/zul/src/archive/web/js/zul/layout/zk.wpd	2010-10-01 05:38:33 UTC (rev 14294)
@@ -12,8 +12,6 @@
 --&gt;
 
 &lt;package name="zul.layout" language="xul/html" depends="zul"&gt;
-	&lt;script src="Layout.js" jsdoc="true"/&gt;
-	
 	&lt;widget name="Borderlayout"/&gt;
 	&lt;widget name="LayoutRegion"/&gt;
 	&lt;widget name="North"/&gt;
@@ -21,6 +19,4 @@
 	&lt;widget name="Center"/&gt;
 	&lt;widget name="East"/&gt;
 	&lt;widget name="West"/&gt;
-	&lt;widget name="Hlayout"/&gt;
-	&lt;widget name="Vlayout"/&gt;
 &lt;/package&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

</ul>

    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26345938">[zk1-subversion-log] SF.net SVN: zk1:[14293]
 branches/5.0/zul/src/archive/web/js/zul/layout/css/ layout.css.dsp</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-30 05:38</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14293
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14293&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14293&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-30 05:38:05 +0000 (Thu, 30 Sep 2010)

Log Message:
-----------
Thu 09/30/2010

Modified Paths:
--------------
    branches/5.0/zul/src/archive/web/js/zul/layout/css/layout.css.dsp

Modified: branches/5.0/zul/src/archive/web/js/zul/layout/css/layout.css.dsp
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/layout/css/layout.css.dsp	2010-09-29 05:37:45 UTC (rev 14292)
+++ branches/5.0/zul/src/archive/web/js/zul/layout/css/layout.css.dsp	2010-09-30 05:38:05 UTC (rev 14293)
@@ -9,7 +9,7 @@
 	display:-moz-inline-box;
 	display: inline-block;
 	position: relative;
-	vertical-align: middle;
+	vertical-align: top;
 	zoom: 1;
 }
 .z-vlayout-inner {


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26119471">[zk1-subversion-log] SF.net SVN: zk1:[14270] branches</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-08 10:31</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14270
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14270&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14270&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-08 10:31:09 +0000 (Wed, 08 Sep 2010)

Log Message:
-----------


Modified Paths:
--------------
    addon/trunk/widgets/ckez/src/archive/web/js/ckez/CKeditor.js
    addon/trunk/widgets/dist/lib/ckez.jar
    addon/trunk/zkjsp/dist/lib/zuljsp.jar
    addon/trunk/zkjsp/zkdoc/zkjsp-release-note
    addon/trunk/zkjsp/zkjsp-demo/version
    addon/trunk/zkjsp/zuljsp/src/archive/META-INF/MANIFEST.MF
    addon/trunk/zkjsp/zuljsp/src/archive/META-INF/zuljsp.tld
    addon/trunk/zkjsp/zuljsp/src2/archive/META-INF/MANIFEST.MF
    addon/trunk/zkjsp/zuljsp/src2/archive/META-INF/zuljsp.tld
    addon/trunk/zkjsp/zuljsp/src2/archive/META-INF/zweb.core.dsp.tld
    addon/trunk/zkjsp/zuljsp/version
    branches/5.0/dist/lib/ckez.jar
    branches/5.0/dist/lib/zuljsp.jar
    branches/5.0/zkdoc/release-note
    branches/5.0/zul/src/archive/web/js/zul/inp/Decimalbox.js
    branches/5.0/zul/src/archive/web/js/zul/inp/Doublebox.js
    branches/5.0/zul/src/archive/web/js/zul/inp/InputWidget.js
    branches/5.0/zul/src/archive/web/js/zul/inp/zk.wpd
    branches/5.0/zul/src/archive/web/js/zul/menu/Menu.js
    branches/5.0/zul/src/archive/web/js/zul/menu/Menubar.js
    branches/5.0/zul/src/archive/web/js/zul/menu/Menuitem.js
    branches/5.0/zul/src/archive/web/js/zul/menu/Menupopup.js
    branches/5.0/zul/src/archive/web/js/zul/sel/ItemWidget.js
    branches/5.0/zul/src/org/zkoss/zul/Div.java
    branches/5.0/zul/src/org/zkoss/zul/Tabpanel.java
    branches/5.0/zul/src/org/zkoss/zul/Tabs.java
    branches/5.0/zul/src/org/zkoss/zul/api/Tabs.java
    branches/5.5/deploy/server.libs
    branches/5.5/dist/lib/ckez.jar
    branches/5.5/dist/lib/zuljsp.jar
    branches/5.5/zk/src/archive/web/js/zk/effect.js
    branches/5.5/zkdemo/src/archive/test2/config.properties
    branches/5.5/zkdoc/release-note
    branches/5.5/zul/src/archive/web/js/zul/inp/Decimalbox.js
    branches/5.5/zul/src/archive/web/js/zul/inp/Doublebox.js
    branches/5.5/zul/src/archive/web/js/zul/inp/InputWidget.js
    branches/5.5/zul/src/archive/web/js/zul/inp/zk.wpd
    branches/5.5/zul/src/archive/web/js/zul/menu/Menu.js
    branches/5.5/zul/src/archive/web/js/zul/menu/Menubar.js
    branches/5.5/zul/src/archive/web/js/zul/menu/Menuitem.js
    branches/5.5/zul/src/archive/web/js/zul/menu/Menupopup.js
    branches/5.5/zul/src/archive/web/js/zul/sel/ItemWidget.js
    branches/5.5/zul/src/org/zkoss/zul/Div.java
    branches/5.5/zul/src/org/zkoss/zul/Fileupload.java
    branches/5.5/zul/src/org/zkoss/zul/Tabpanel.java
    branches/5.5/zul/src/org/zkoss/zul/Tabs.java
    branches/5.5/zul/src/org/zkoss/zul/Treechildren.java
    branches/5.5/zul/src/org/zkoss/zul/api/Tabs.java
    branches/6.0/build
    branches/6.0/build.prop.xml
    branches/6.0/build.setting
    branches/6.0/build.target.xml
    branches/6.0/build.xml
    branches/6.0/deploy/server.libs
    branches/6.0/deploy/version
    branches/6.0/dist/lib/ckez.jar
    branches/6.0/dist/lib/zuljsp.jar
    branches/6.0/jsdoc/version
    branches/6.0/zcommon/src/archive/META-INF/MANIFEST.MF
    branches/6.0/zcommon/src/archive/metainfo/xel/config.xml
    branches/6.0/zcommon/src/org/zkoss/Version.java
    branches/6.0/zcommon/src/org/zkoss/html/HTMLs.java
    branches/6.0/zcommon/src/org/zkoss/html/JavaScript.java
    branches/6.0/zcommon/src/org/zkoss/html/StyleSheet.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/XMLResourcesLocator.java
    branches/6.0/zcommon/srcdpc/org/zkoss/xml/HTMLs.java
    branches/6.0/zcommon/version
    branches/6.0/zhtml/src/archive/META-INF/MANIFEST.MF
    branches/6.0/zhtml/src/archive/metainfo/zk/lang.xml
    branches/6.0/zhtml/src/org/zkoss/zhtml/Version.java
    branches/6.0/zhtml/version
    branches/6.0/zk/src/archive/META-INF/MANIFEST.MF
    branches/6.0/zk/src/archive/metainfo/tld/config.xml
    branches/6.0/zk/src/archive/metainfo/zk/config.xml
    branches/6.0/zk/src/archive/web/js/zk/effect.js
    branches/6.0/zk/src/archive/web/js/zk/widget.js
    branches/6.0/zk/src/org/zkoss/zk/Version.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Component.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/AbstractUiFactory.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/Utils.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/UiFactory.java
    branches/6.0/zk/src/org/zkoss/zk/ui/util/Configuration.java
    branches/6.0/zk/src/org/zkoss/zk/ui/util/ExecutionMonitor.java
    branches/6.0/zk/version
    branches/6.0/zkdemo/src/archive/META-INF/MANIFEST.MF
    branches/6.0/zkdemo/src/archive/test2/config.properties
    branches/6.0/zkdemo/src/org/zkoss/zkdemo/test/ExecutionMonitor.java
    branches/6.0/zkdemo/version
    branches/6.0/zkdemos/src/archive/META-INF/MANIFEST.MF
    branches/6.0/zkdemos/version
    branches/6.0/zkdoc/release-note
    branches/6.0/zkplus/src/archive/META-INF/MANIFEST.MF
    branches/6.0/zkplus/src/archive/metainfo/zk/lang-addon.xml
    branches/6.0/zkplus/src/org/zkoss/zkplus/Version.java
    branches/6.0/zkplus/version
    branches/6.0/zul/src/archive/META-INF/MANIFEST.MF
    branches/6.0/zul/src/archive/metainfo/zk/lang.xml
    branches/6.0/zul/src/archive/web/js/zul/inp/Decimalbox.js
    branches/6.0/zul/src/archive/web/js/zul/inp/Doublebox.js
    branches/6.0/zul/src/archive/web/js/zul/inp/InputWidget.js
    branches/6.0/zul/src/archive/web/js/zul/inp/zk.wpd
    branches/6.0/zul/src/archive/web/js/zul/menu/Menu.js
    branches/6.0/zul/src/archive/web/js/zul/menu/Menubar.js
    branches/6.0/zul/src/archive/web/js/zul/menu/Menuitem.js
    branches/6.0/zul/src/archive/web/js/zul/menu/Menupopup.js
    branches/6.0/zul/src/archive/web/js/zul/sel/ItemWidget.js
    branches/6.0/zul/src/org/zkoss/zul/Div.java
    branches/6.0/zul/src/org/zkoss/zul/Fileupload.java
    branches/6.0/zul/src/org/zkoss/zul/Script.java
    branches/6.0/zul/src/org/zkoss/zul/Tabpanel.java
    branches/6.0/zul/src/org/zkoss/zul/Tabs.java
    branches/6.0/zul/src/org/zkoss/zul/Treechildren.java
    branches/6.0/zul/src/org/zkoss/zul/Version.java
    branches/6.0/zul/src/org/zkoss/zul/api/Tabs.java
    branches/6.0/zul/version
    branches/6.0/zweb/src/archive/META-INF/MANIFEST.MF
    branches/6.0/zweb/src/archive/metainfo/tld/config.xml
    branches/6.0/zweb/src/org/zkoss/web/Version.java
    branches/6.0/zweb/srcdpc/org/zkoss/web/servlet/JavaScript.java
    branches/6.0/zweb/srcdpc/org/zkoss/web/servlet/StyleSheet.java
    branches/6.0/zweb/version

Added Paths:
-----------
    addon/releases/zkjsp/1.4.1/
    addon/releases/zkjsp/1.4.1/bin/
    addon/releases/zkjsp/1.4.1/bin/deploy
    addon/releases/zkjsp/1.4.1/bin/deploy.unzip
    addon/releases/zkjsp/1.4.1/bin/deploy.unzip.war
    addon/releases/zkjsp/1.4.1/bin/genjad
    addon/releases/zkjsp/1.4.1/bin/genprop
    addon/releases/zkjsp/1.4.1/bin/genprop.awk
    addon/releases/zkjsp/1.4.1/bin/overwrite
    addon/releases/zkjsp/1.4.1/bin/preverify
    addon/releases/zkjsp/1.4.1/bin/setdbg
    addon/releases/zkjsp/1.4.1/bin/zipjs
    addon/releases/zkjsp/1.4.1/build
    addon/releases/zkjsp/1.4.1/build.projects
    addon/releases/zkjsp/1.4.1/build.prop.xml
    addon/releases/zkjsp/1.4.1/build.setting
    addon/releases/zkjsp/1.4.1/build.setting.local
    addon/releases/zkjsp/1.4.1/build.target.xml
    addon/releases/zkjsp/1.4.1/build.txt
    addon/releases/zkjsp/1.4.1/build.xml
    addon/releases/zkjsp/1.4.1/dist/
    addon/releases/zkjsp/1.4.1/dist/export/
    addon/releases/zkjsp/1.4.1/dist/lib/
    addon/releases/zkjsp/1.4.1/dist/lib/ckez.jar
    addon/releases/zkjsp/1.4.1/dist/lib/ext/
    addon/releases/zkjsp/1.4.1/dist/lib/ext/bsh.jar
    addon/releases/zkjsp/1.4.1/dist/lib/ext/commons-fileupload.jar
    addon/releases/zkjsp/1.4.1/dist/lib/ext/commons-io.jar
    addon/releases/zkjsp/1.4.1/dist/lib/ext/jsp-api.jar
    addon/releases/zkjsp/1.4.1/dist/lib/ext/servlet-api.jar
    addon/releases/zkjsp/1.4.1/dist/lib/ext2/
    addon/releases/zkjsp/1.4.1/dist/lib/ext2/el-api.jar
    addon/releases/zkjsp/1.4.1/dist/lib/ext2/jsp-api.jar
    addon/releases/zkjsp/1.4.1/dist/lib/ext2/servlet-api.jar
    addon/releases/zkjsp/1.4.1/dist/lib/fckez.jar
    addon/releases/zkjsp/1.4.1/dist/lib/gmapsz.jar
    addon/releases/zkjsp/1.4.1/dist/lib/timelinez.jar
    addon/releases/zkjsp/1.4.1/dist/lib/timeplotz.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zcommon.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zcommons-el.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zhtml.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zk.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zkex.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zkjsp-demo.war
    addon/releases/zkjsp/1.4.1/dist/lib/zkmax.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zkplus.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zml.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zul.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zuljsp.jar
    addon/releases/zkjsp/1.4.1/dist/lib/zweb.jar
    addon/releases/zkjsp/1.4.1/sub-release
    addon/releases/zkjsp/1.4.1/tool/
    addon/releases/zkjsp/1.4.1/tool/src/
    addon/releases/zkjsp/1.4.1/tool/src/tool/
    addon/releases/zkjsp/1.4.1/tool/src/tool/ComponentMap.java
    addon/releases/zkjsp/1.4.1/tool/src/tool/PreProcessor.java
    addon/releases/zkjsp/1.4.1/tool/src/tool/ZulJspGenerator.java
    addon/releases/zkjsp/1.4.1/tool/templete/
    addon/releases/zkjsp/1.4.1/tool/templete/TempleteTag.java
    addon/releases/zkjsp/1.4.1/tool/templete/tagContent.tld
    addon/releases/zkjsp/1.4.1/tool/templete/template.tld
    addon/releases/zkjsp/1.4.1/zkdoc/
    addon/releases/zkjsp/1.4.1/zkdoc/COPYING
    addon/releases/zkjsp/1.4.1/zkdoc/user_guide/
    addon/releases/zkjsp/1.4.1/zkdoc/user_guide/ZK-JspTags-UserGuide.odt
    addon/releases/zkjsp/1.4.1/zkdoc/zkjsp-release-note
    addon/releases/zkjsp/1.4.1/zkjsp-demo/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/.classpath
    addon/releases/zkjsp/1.4.1/zkjsp-demo/.project
    addon/releases/zkjsp/1.4.1/zkjsp-demo/.settings/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/.settings/org.eclipse.core.resources.prefs
    addon/releases/zkjsp/1.4.1/zkjsp-demo/.settings/org.eclipse.jdt.core.prefs
    addon/releases/zkjsp/1.4.1/zkjsp-demo/.settings/org.eclipse.jst.common.project.facet.core.prefs
    addon/releases/zkjsp/1.4.1/zkjsp-demo/.settings/org.eclipse.wst.common.component
    addon/releases/zkjsp/1.4.1/zkjsp-demo/.settings/org.eclipse.wst.common.project.facet.core.xml
    addon/releases/zkjsp/1.4.1/zkjsp-demo/RecursiveKill.bat
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/META-INF/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/META-INF/MANIFEST.MF
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/classes/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/classes/org/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/classes/org/zkoss/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/classes/org/zkoss/jspdemo/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/Filters.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/bsh.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/ckez.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/commons-collections.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/commons-el.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/commons-fileupload.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/commons-io.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/commons-logging.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/fckez.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/gmapsz.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/itext.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/jasperreports.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/jcommon.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/jdom.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/jfreechart.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/js.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/jstl.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/jxl.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/poi.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/rome-0.9.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/standard.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/timelinez.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/timeplotz.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zcommon.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zcommons-el.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zhtml.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zk.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zkex.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zkmax.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zkplus.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zml.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zrss.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zul.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/lib/zweb.jar
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/web.xml
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/WEB-INF/zk.xml
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/auxheader.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/borderlayout.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/capcha.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/colorbox.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/databinding.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/databinding2.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/draganddrop.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/el/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/el/elfunction.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/el/index.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/flashchar.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/foreach.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/frozen.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/gen/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/gen/gen.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/guide/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/guide/el.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/guide/index.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/head.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/head_auxheader.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/head_capcha.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/hlayoutAndVlayout.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/calendar.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/donut.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/dull-blue-circle.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/dull-green-circle.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/gmap_ico.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/gray-circle.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/gray-trapa.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/green-trapa.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/purple-trapa.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/red-circle.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/red-trapa.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/res1.gif
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/res2.jpg
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/res3.jpg
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/res4.jpg
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/sdull-green-circle.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/sun.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/img/yellow-trapa.png
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/index.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/index2.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/2009/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/2009/paging.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/Person.zs
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/attribute_trim.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/bug_1997938.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/compose.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/composer.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/createComponents.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/customattrs.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/customize.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/dynamic_comp.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/forward.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/forward.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/gmap/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/gmap/index.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/grid.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/include.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/include1.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/include1.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/include3.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/index.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/macro.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/macro.zs
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/macro.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/macrotest.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/path.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/pathtest.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/publish.zxml
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/rssreader.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/staticcall.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/staticcall.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/test.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/twinpage.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/urlpath.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/username.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/variableresolver.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/window.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/window.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/zsinit.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/test/zstest.zs
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/timeout.zul
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/useclass.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/WebContent/windowmode.jsp
    addon/releases/zkjsp/1.4.1/zkjsp-demo/classpath
    addon/releases/zkjsp/1.4.1/zkjsp-demo/deploy
    addon/releases/zkjsp/1.4.1/zkjsp-demo/format
    addon/releases/zkjsp/1.4.1/zkjsp-demo/import.libs
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/JspScopeVariableResolver.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/MyComposer.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/MyComposerExt.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/MyInit.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/MyValue.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/MyWest.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/MyWindow.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/MyWindow2.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/bean/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/bean/Benchmark.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/bean/Comment.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/bean/Location.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/bean/OpeningHours.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/bean/Restaurant.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/bean/Time.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/el/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/el/MyELFunctions.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/model/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/model/Dummy.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/model/RestaurantRepository.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/ui/
    addon/releases/zkjsp/1.4.1/zkjsp-demo/src/org/zkoss/jspdemo/ui/GmapImportScript.java
    addon/releases/zkjsp/1.4.1/zkjsp-demo/version
    addon/releases/zkjsp/1.4.1/zkjsp-demo/war.libs
    addon/releases/zkjsp/1.4.1/zuljsp/
    addon/releases/zkjsp/1.4.1/zuljsp/classpath
    addon/releases/zkjsp/1.4.1/zuljsp/classpath2
    addon/releases/zkjsp/1.4.1/zuljsp/deploy
    addon/releases/zkjsp/1.4.1/zuljsp/format
    addon/releases/zkjsp/1.4.1/zuljsp/pom.xml
    addon/releases/zkjsp/1.4.1/zuljsp/src/
    addon/releases/zkjsp/1.4.1/zuljsp/src/archive/
    addon/releases/zkjsp/1.4.1/zuljsp/src/archive/META-INF/
    addon/releases/zkjsp/1.4.1/zuljsp/src/archive/META-INF/MANIFEST.MF
    addon/releases/zkjsp/1.4.1/zuljsp/src/archive/META-INF/zuljsp.tld
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/el/
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/AbstractJspFactory.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/AbstractPageContext.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/JspFactoryContextListener.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/JspVariableResolver.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/PageContextInitiator.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/package.html
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/v20/
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/v20/JspFactoryImpl.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/v20/ZkPageContextImpl.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/spec/v20/package.html
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ATag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/AppletTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/AreaTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/AttributeTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/AttributesInfo.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/AudioTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/AuxheadTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/AuxheaderTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/BandboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/BandinfoTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/BandpopupTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/BorderlayoutTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/BoxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ButtonTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/CKeditorTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/CalendarTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/CaptchaTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/CaptionTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/CellTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/CenterTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ChartTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/CheckboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ColorboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ColumnTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ColumnchildrenTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ColumnlayoutTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ColumnsTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ComboboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ComboitemTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ComponentDefinitionTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/Const.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/CustomAttributesTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/DateboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/DecimalboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/DetailTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/DivTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/DoubleboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/EastTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FCKeditorTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FiledownloadTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FileuploadTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FisheyeTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FisheyebarTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FlashTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FlashchartTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FootTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FooterTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/FrozenTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GimageTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GinfoTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GmapsTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GmarkerTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GpolygonTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GpolylineTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GridTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GroupTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GroupboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GroupfootTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/GscreenTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/HboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/HlayoutTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/HotzoneTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/HtmlTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/IframeTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/IllegalJspTagException.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ImageTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ImagemapTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/IncludeTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/InitTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/IntboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/JasperreportTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/LabelTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ListboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ListcellTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ListfootTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ListfooterTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ListgroupTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ListgroupfootTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ListheadTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ListheaderTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ListitemTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/LongboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/MenuTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/MenubarTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/MenuitemTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/MenupopupTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/MenuseparatorTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/MessageboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/NorthTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/PageTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/PagingTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/PanelTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/PanelchildrenTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/PlotinfoTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/PopupTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/PortalchildrenTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/PortallayoutTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ProgressmeterTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/RadioTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/RadiogroupTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/RowTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/RowsTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ScriptTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/SeparatorTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/SliderTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/SouthTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/SpaceTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/SpanTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/SpinnerTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/SplitterTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/StyleTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TabTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TabboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TablechildrenTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TablelayoutTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TabpanelTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TabpanelsTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TabsTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TextboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TimeboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TimelineTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TimeplotTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TimerTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ToolbarTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ToolbarbuttonTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TreeTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TreecellTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TreechildrenTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TreecolTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TreecolsTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TreefootTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TreefooterTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TreeitemTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/TreerowTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/VariableResolverTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/VariablesTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/VboxTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/VlayoutTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/WestTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/WindowTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ZScriptTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/ZkheadTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/AbstractTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/BranchTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/ComponentJspContextStack.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/ComponentTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/ComposerHandler.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/FunctionMappers.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/Initiators.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/Inline.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/Jsps.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/LeafTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/MultiComposer.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/PageRenderer.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/PageRequestContext.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/RootTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/UiTag.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/Utils.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/VariableResolverInfo.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/VariableResolvers.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/Zk5Inline.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/ZkProxy.java
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/impl/package.html
    addon/releases/zkjsp/1.4.1/zuljsp/src/org/zkoss/jsp/zul/package.html
    addon/releases/zkjsp/1.4.1/zuljsp/src2/
    addon/releases/zkjsp/1.4.1/zuljsp/src2/archive/
    addon/releases/zkjsp/1.4.1/zuljsp/src2/archive/META-INF/
    addon/releases/zkjsp/1.4.1/zuljsp/src2/archive/META-INF/MANIFEST.MF
    addon/releases/zkjsp/1.4.1/zuljsp/src2/archive/META-INF/zuljsp.tld
    addon/releases/zkjsp/1.4.1/zuljsp/src2/archive/META-INF/zweb.core.dsp.tld
    addon/releases/zkjsp/1.4.1/zuljsp/src2/org/
    addon/releases/zkjsp/1.4.1/zuljsp/src2/org/zkoss/
    addon/releases/zkjsp/1.4.1/zuljsp/src2/org/zkoss/jsp/
    addon/releases/zkjsp/1.4.1/zuljsp/src2/org/zkoss/jsp/spec/
    addon/releases/zkjsp/1.4.1/zuljsp/src2/org/zkoss/jsp/spec/v21/
    addon/releases/zkjsp/1.4.1/zuljsp/src2/org/zkoss/jsp/spec/v21/JspFactoryImpl.java
    addon/releases/zkjsp/1.4.1/zuljsp/src2/org/zkoss/jsp/spec/v21/ZkELResolverImpl.java
    addon/releases/zkjsp/1.4.1/zuljsp/src2/org/zkoss/jsp/spec/v21/package.html
    addon/releases/zkjsp/1.4.1/zuljsp/version
    branches/5.5/dist/lib/breeze.jar
    branches/5.5/zkdemo/src/archive/test2/B50-3057902.zul
    branches/6.0/dist/lib/breeze.jar
    branches/6.0/zkdemo/src/archive/test2/B50-3057902.zul

Added: addon/releases/zkjsp/1.4.1/bin/deploy
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/deploy	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/deploy	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,87 @@
+#!/bin/bash
+# deploy
+#
+#{{IS_NOTE
+#	Purpose:
+#		Deploy
+#	Description:
+#		It supports tomcat only.
+#	History:
+#		Thu Jan 26 09:47:39     2006, Created by tomyeh
+#}}IS_NOTE
+#
+#Copyright (C) 2006 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#	This program is distributed under GPL Version 2.0 in the hope that
+#	it will be useful, but WITHOUT ANY WARRANTY.
+#}}IS_RIGHT
+#
+if [ ! -d /usr/tomcat ] ; then
+	echo "/usr/tomcat not found"
+	echo "Currently only tomcat is supported"
+	exit 1
+fi
+if [ $# == 0 ] ; then
+	echo "Usage:"
+	echo "  deploy prj1 prj2..."
+	exit 0
+fi
+
+function cpweb {
+	(
+		cd $1
+		for sub in * ; do
+			if [ -f "$sub" ] ; then
+				#echo cp -u -p "$sub" $2
+				cp -u -p -v "$sub" $2
+			elif [ "$sub" != CVS ] &amp;&amp; [ "$sub" != .svn ] &amp;&amp; [ -d "$sub" ] ; then
+				local dstsub=$2/$sub
+				if [ ! -d "$dstsub" ] ; then
+					mkdir -p "$dstsub"
+				fi
+				#echo cpweb $(pwd)/$sub $dstsub
+				cpweb $sub $dstsub
+			fi
+		done
+	)
+}
+
+jar_found=false
+for f in $*; do
+	f=${f%/}
+	if [ -f dist/lib/$f.war ] || [ "$(head -1 $f/format)" = "war" ] ; then
+		dst=$(grep '^root' $f/deploy)
+		if [ "$dst" = "root" ] ; then
+			dst=ROOT
+		else
+			dst=$f
+		fi
+		echo "cp dist/lib/$f /usr/tomcat/webapps/$dst"
+		cpweb $f/src/archive /usr/tomcat/webapps/$dst
+	fi
+	if [ -f dist/lib/$f.jad ] ; then
+		dstdir=/usr/WTK/apps/$f
+		echo "cp $f.jad $dstdir"
+		cp -u -p -v dist/lib/$f.jad dist/lib/$f.jar $f/src/archive/META-INF/MANIFEST.MF $dstdir/bin
+		cp -urp $f/src/org $dstdir/src
+		cp -urp $f/src/archive/icons $dstdir/res
+		cp -urp $f/debugv/org $dstdir/classes
+	elif [ -f dist/lib/$f.jar ] ; then
+		jar_found=true
+	fi
+done
+
+if [ "$jar_found" = "true" ] ; then
+	net stop "Apache Tomcat"
+
+	for f in $*; do
+		f=${f%/}
+		if [ ! -f dist/lib/$f.jad ] &amp;&amp; [ -f dist/lib/$f.jar ] ; then
+			#echo "cp dist/lib/$f.jar /usr/tomcat/shared/lib"
+			cp -p -u -v -f dist/lib/$f.jar /usr/tomcat/shared/lib
+		fi
+	done
+
+	net start "Apache Tomcat"
+fi

Added: addon/releases/zkjsp/1.4.1/bin/deploy.unzip
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/deploy.unzip	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/deploy.unzip	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,163 @@
+#!/bin/bash
+# deploy.unzip
+#
+#{{IS_NOTE
+#	Purpose:
+#		Unzip and deploy an ear, jar or war
+#	Description:
+#		Unzip and deploy
+#	History:
+#		Wed Jun 11 09:48:46     2003, Created by tomyeh
+#}}IS_NOTE
+#
+#Copyright (C) 2002 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#	This program is distributed under GPL Version 2.0 in the hope that
+#	it will be useful, but WITHOUT ANY WARRANTY.
+#}}IS_RIGHT
+#
+
+function helpit
+{
+	echo "deploy.unzip - Unzip and deploy an ear, jar or war"
+	echo "Copyright (C) 2003 Potix Corporation. All Rights Reserved."
+	echo
+	echo "You could unzip files inside of srcfile by specifying them in "
+	echo "comman-separated list."
+	echo
+	echo "Usage:"
+	echo "  deploy.unzip srcfile dstdir [list]"
+	echo
+	echo "srcfile - the source file"
+	echo "dstdir - the destination directory"
+	echo "list - a list of comma separated file in srcfile that need to unzip further"
+	exit 0
+}
+
+if [ $# -lt 2 ] ; then
+	echo "You have to specify at least the source file and destination directory"
+	exit 1
+fi
+if [ $1 = --help ] ; then
+	helpit
+fi
+srcfl=$1
+dstdir=$2
+inlist=$3
+if [ ! -f "$srcfl" ] ; then
+	echo "$srcfl not found"
+	exit 3
+fi
+if [ ! -d "$dstdir" ] ; then
+	echo "$dstdir doesn't exist. Make sure /usr/jboss is linked to the JBoss directory"
+	exit 3
+fi
+srcnm=${srcfl##*/}
+
+appxml=$dstdir/$srcnm/META-INF/application.xml
+if [ -f "$appxml" ] &amp;&amp; [ "$appxml" -nt "$srcfl" ] ; then
+	exit 0 #dst is newer; nothing to do
+fi
+
+#convert srcfl to absolute
+if [ "$TERM" = "cygwin" ] ; then
+	srcfl=$(cygpath -wa $srcfl)
+else
+	if [ "$srcfl" = "${srcfl#/}" ] ; then #relative
+		srcfl=$(pwd)/$srcfl
+	fi
+fi
+
+#prepare
+cd $dstdir
+if [ $? != 0 ] ; then
+	echo "Failed to change directory to $dstdir"
+	exit 5
+fi
+mkdir -p $srcnm
+if [ $? != 0 ] ; then
+	echo "Failed to make directory $srcnm under $dstdir"
+	exit 5
+fi
+
+cd $srcnm
+
+tmpdir=../../tmp-$srcnm
+mkdir -p $tmpdir/old
+mkdir -p $tmpdir/new
+rm -rf $tmpdir/old/* $tmpdir/new/*
+
+#move existent unzip-ed directory to $tmpdir/old
+if [ "$inlist" != "" ] ; then
+	oldIFS=$IFS
+	IFS=,
+	for f in $inlist; do
+		if [ -d $f ] ; then
+			#echo mv $f $tmpdir/old
+			mv $f $tmpdir/old
+		fi
+	done
+	IFS=$oldIFS
+fi
+
+#unzip $srcfl
+echo jar xf $srcfl
+jar xf $srcfl
+
+#unzip $inlist
+if [ "$inlist" != "" ] ; then
+	oldIFS=$IFS
+	IFS=,
+	for f in $inlist; do
+		if [ -f $f ] ; then
+			#echo mv $f $tmpdir/new
+			mv $f $tmpdir/new
+		fi
+		if [ -d $tmpdir/old/$f ] ; then
+			#echo mv $tmpdir/old/$f .
+			mv $tmpdir/old/$f .
+		elif [ -f $tmpdir/new/$f ] ; then
+			mkdir $f
+			if [ $? != 0 ] ; then
+				echo "Failed to make directory $f"
+				exit 5
+			fi
+		fi
+	done
+	for f in $inlist; do
+		if [ -f $tmpdir/new/$f ] ; then
+			(
+				cd $f
+				echo jar xf $f
+				jar xf ../$tmpdir/new/$f
+			)
+		fi
+	done
+	for f in $inlist; do
+		#nullify jsp
+		if [ -d $f ] &amp;&amp; [ "${f%.war}" != "$f" ] ; then
+			function nullifywar
+			{
+				for j in *; do
+					if [ "${j%.jsp}" != "$j" ] ; then
+						echo &gt; $j
+					elif [ -d $j ] ; then
+						(
+							cd $j
+							nullifywar
+						)
+					fi
+				done
+			}
+			(
+				cd $f
+				echo nullify $f
+				nullifywar
+			)
+		fi
+	done
+	IFS=$oldIFS
+fi
+
+rm -rf $tmpdir

Added: addon/releases/zkjsp/1.4.1/bin/deploy.unzip.war
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/deploy.unzip.war	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/deploy.unzip.war	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,94 @@
+#!/bin/bash
+# deploy.unzip
+#
+#{{IS_NOTE
+#	Purpose:
+#		Unzip and deploy a war into Tomcat or Jetty server
+#		For deploy ear, use deploy.unzip
+#	Description:
+#		Unzip and deploy a war
+#	History:
+#		Wed Jan 3 12:33:46     2006, Created by tomyeh
+#}}IS_NOTE
+#
+#Copyright (C) 2006 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#	This program is distributed under GPL Version 2.0 in the hope that
+#	it will be useful, but WITHOUT ANY WARRANTY.
+#}}IS_RIGHT
+#
+
+function helpit
+{
+	echo "deploy.unzip - Unzip and deploy a war into Tomcat or jetty server"
+	echo "Copyright (C) 2006 Potix Corporation. All Rights Reserved."
+	echo
+	echo "Usage:"
+	echo "  deploy.unzip srcdir dstdir [list] [old_name/new_name]"
+	echo
+	echo "srcdir - the directory containing source files"
+	echo "dstdir - the destination directory"
+	echo "list - a list of comma separated source files"
+	echo "old_name/new_name - rename the war's name from old_name to new_name"
+	exit 0
+}
+
+if [ $# -lt 2 ] ; then
+	echo "You have to specify at least the source file and destination directory"
+	exit 1
+fi
+if [ $1 = --help ] ; then
+	helpit
+fi
+srcdir=$1
+dstdir=$2
+fls=$3
+renwar=$4
+if [ ! -d "$srcdir" ] ; then
+	echo "$srcdir is not a directory"
+	exit 1
+fi
+if [ ! -d "$dstdir" ] ; then
+	echo "$dstdir doesn't exist. Make sure /usr/tomcat is linked to the Tomcat directory"
+	exit 1
+fi
+if [ "$fls" == "" ] ; then
+	exit 0
+fi
+oldnm="${renwar%/*}"
+newnm="${renwar#*/}"
+
+if [ "$srcdir" == "${srcdir#/}" ] ; then #relative
+	srcdir=$(pwd)/$srcdir
+fi
+
+oldIFS=$IFS
+IFS=,
+for f in $fls; do
+	if [ -f "$srcdir/$f" ] ; then
+		dstfn=${f%%.*}
+		if [ "$dstfn" = "$oldnm" ] ; then
+			dstfn="$newnm"
+		fi
+		srcfl=$srcdir/$f
+		if [ ! -f "$dstdir/$dstfn/WEB-INF/web.xml" ] || [ "$srcfl" -nt "$dstdir/$dstfn/WEB-INF/web.xml" ] ; then
+			echo "Unzip $srcfl to $dstfn"
+			(
+				mkdir -p "$dstdir/$dstfn"
+				cd "$dstdir/$dstfn"
+				
+				#convert srcfl to window format
+				if [ "$TERM" = "cygwin" ] ; then
+					srcfl=$(cygpath -wa $srcfl)
+				fi
+				jar xf "$srcfl"
+			)
+		else
+			echo "Skip $srcdir/$f because it is not newer"
+		fi
+	else
+		echo "Ignore: $srcdir/$f not found"
+	fi
+done
+IFS=$oldIFS

Added: addon/releases/zkjsp/1.4.1/bin/genjad
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/genjad	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/genjad	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,32 @@
+#!/bin/bash
+# genjad
+#
+#{{IS_NOTE
+#	Purpose:
+#		Move prj.jad from src to codegen
+#	Description:
+#		
+#	History:
+#		Mon Nov 27 18:53:46     2006, Created by tomyeh
+#}}IS_NOTE
+#
+#Copyright (C) 2006 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#}}IS_RIGHT
+#
+if [ $# != 3 ] ; then
+	echo "Usage:"
+	echo "  genjad jar-file src-jad-file dst-jad-file"
+	echo
+	echo "Generate the destination JAD file based on the source JAD file, if any,"
+	echo "and the JAR file."
+	exit 1
+fi
+
+if [ -f $1 ] &amp;&amp; [ -f $2 ] ; then
+	if [ ! -f $3 ] || [ $1 -nt $3 ] || [ $2 -nt $3 ]; then
+		jarsz=$(ls -og $1 | cut -d' ' -f3)
+		sed -e "s/{jar-size}/$jarsz/" $2 &gt; $3
+	fi
+fi

Added: addon/releases/zkjsp/1.4.1/bin/genprop
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/genprop	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/genprop	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,146 @@
+#!/bin/bash
+#
+#{{IS_NOTE
+#
+# Authors: Tom M. Yeh
+# Contributors:
+# Create Date: 2001/3/30 05:46PM
+# Purpose: Generate Java classes from properties files
+# Description:
+#	Execute 'genprop -h' to know how to use.
+# History:
+#	5/19/2001	Tom M. Yeh, allow to processing non-utf files and specify
+#				different paths
+#
+#}}IS_NOTE
+#
+# Copyright (C) 2001 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#	This program is distributed under GPL Version 2.0 in the hope that
+#	it will be useful, but WITHOUT ANY WARRANTY.
+#}}IS_RIGHT
+#
+
+function showhelp
+{
+	echo "genprop - generate Java classes from properties files"
+	echo "Copyright (C) 2001 Potix Corporation. All Rights Reserved."
+	echo
+	echo "Usage:"
+	echo "  genprop [-f] [-h] [-u] prop_dir dst_dir"
+	echo
+	echo "prop_dir"
+	echo "    The directory holds the properties files, *.properties."
+	echo "    If -u is specified, *.properties.utf are expected."
+	echo "dst_dir"
+	echo "    The destination directory, where the generated java codes"
+	echo "    are stored."
+	echo
+	echo "Example:"
+	echo "    genpro src/conf codegen"
+	echo
+	echo "Options:"
+	echo " -f"
+	echo "    Force the generation without checking whether it is newer."
+	echo " -u"
+	echo "    UTF files (with .utf extension) expected."
+	echo " -x"
+	echo "    Exclude filename that contains '_'."
+	echo " -h or --help"
+	echo "    Show this message."
+	echo
+	echo "Format of the properties.utf file:"
+	echo "#@=TypeName"
+	echo "    and all constants are added with the type name, e.g, MT_SYS."
+	echo "    It must be at the first line."
+	echo
+	echo "#-=M_FILE_NOT_FOUND"
+	echo "1002=File Not Found"
+	echo "    Other part is composed as pair of lines. The first line of"
+	echo "    each pair specifies the constant name (at second column)"
+	echo "    The second line of each pair specifies the value (1002 in"
+	echo "    the above example). Notice: hexadecimal is assumed, only"
+	echo "    lower-case with four digits is allowed, and starts at 1000."
+	echo
+	echo " * 
+	echo " * You have to maintain org.zkoss.mesg.MessageConst.java"
+	echo "   consistently, if you add a new properties file."
+	echo " * Lines starting with # or being empty are ignored."
+}
+
+#-- check options
+if [ "$1" = "--help" ] ; then
+	showhelp
+	exit 0
+fi
+
+awkpath=$0
+force=0
+flext=.properties
+exclude=N.O.E.X.I.S.T
+
+while getopts "fhux" opt; do
+  case $opt in
+  h )	showhelp
+		exit 0;;
+  f )	force=1;;
+  u )	flext=.properties.utf;;
+  x )	exclude=_;;
+  \? )	echo "Try 'genprop --help' for more information"
+		exit 1;;
+  esac
+done
+shift $(($OPTIND - 1))
+
+if [ $# != 2 ] ; then
+	echo "genprop: wrong number of arguments"
+	echo "Try 'genprop --help' for more information"
+	exit 1
+fi
+
+cnfpath=$1
+codegendir=$2
+
+#-- check directory structure
+if [ ! -d $cnfpath ] ; then
+	echo "Error: $cnfpath is not a directory" 1&gt;&amp;2
+	exit 1
+fi
+
+#-- start process
+for fn in $cnfpath/*$flext ; do
+	if [ \( -f "$fn" \) -a \( "${fn#*$exclude}" = "$fn" \) ] ; then
+		msgnm=${fn##$cnfpath/}
+		msgnm=${msgnm%$flext}
+
+		clsnm=$(head -1 $fn)
+		clsnm=${clsnm###class=}
+		pkgnm=${clsnm%.*}
+		clsnm=${clsnm##*.}
+
+		if [ "$clsnm" = "" ] || [ "$pkgnm" == "" ] ; then
+			echo The first line of $fn must be "#class=package.class"
+			exit 1
+		fi
+
+		pkgpath=${codegendir}/${pkgnm//.//}
+		dstfn=${pkgpath}/${clsnm}.java
+
+		#update if newer
+		if [ \( force = 1 \) -o \( ! -f "$dstfn" \) -o \( "$fn" -nt "$dstfn" \) ] ; then
+			echo "Generating $dstfn..."
+
+			if [ "$awkfn" = "" ] ; then
+				if [ "$TERM" = "cygwin" ] ; then
+					awkpath=$(cygpath -u $awkpath)
+				fi
+				awkfn=${awkpath%/*}/genprop.awk
+			fi
+
+			mkdir -p $pkgpath
+			args="-f $awkfn -v pkgnm=$pkgnm -v clsnm=$clsnm -vmsgnm=$msgnm -vusernm=$USER"
+			awk $args -v "when=$(date)" "$fn" &gt; "$dstfn"
+		fi
+	fi
+done

Added: addon/releases/zkjsp/1.4.1/bin/genprop.awk
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/genprop.awk	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/genprop.awk	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,31 @@
+BEGIN {
+	FS = " *= *"
+	printf "// %s.%s.java\n", pkgnm, clsnm
+	printf "//\n"
+	printf "// Generated by genprop\n"
+	printf "// DO NOT MODIFY IT MANUALLY. All modifications will be lost.\n"
+	printf "//\n"
+	printf "// %s, %s\n", usernm, when
+	printf "// Copyright(C) 2001 Potix Corporation. All Rights Reserved.\n\n"
+	printf "package %s;\n", pkgnm
+	printf "\npublic interface %s extends org.zkoss.mesg.MessageConst {\n", clsnm
+	printf "\tstatic final int MESSAGE_ID = Aide.register(%s.class, \"%s\");\n", clsnm, msgnm
+	key = ""
+}
+
+END {
+	printf  "}\n"
+}
+
+$1=="#-" {
+	key = $2
+}
+
+key!="" &amp;&amp; NF&gt;=2 &amp;&amp; /^[1-9a-f]/ {
+	printf "\tstatic final int %s = 0x%s + MESSAGE_ID;\n", key, $1
+	key = ""
+}
+
+/^0/ {
+	printf "error: the hexadecimal (%s) must starts at 1000 and in lower case", $1
+}

Added: addon/releases/zkjsp/1.4.1/bin/overwrite
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/overwrite	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/overwrite	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,53 @@
+#!/bin/sh
+#
+#	overwrite: copy standard output generated from another command
+#	to the specified file after EOF
+#
+#	Refer to "The Unix Programming Environment", pp. 154
+
+case $# in
+0) echo "overwrite -- copy the standard output generated from another command"
+	echo "to the specified file after EOF."
+	echo
+	echo "Usage 1:"
+	echo "  overwrite file command arguments"
+	echo
+	echo "Usage 2:"
+	echo "  command argments | overwrite file"
+	echo
+	echo "command arguments:"
+	echo "  could by anything, e.g., grep abc file"
+	echo "file:"
+	echo "  could be the same as the file processed the command"
+	echo
+	echo "In Usage 1, file won't be changed if command doesn't succeed."
+	exit 0;;
+esac
+
+file=$1; shift
+flbase=${file##*/}
+new=/tmp/$flbase.overwrite1~
+old=/tmp/$flbase.overwrite2~
+
+trap 'rm -f $new $old; exit 1' 1 2 15	#clean up upon signals
+
+if [ $# -ge 1 ] ; then
+	$* &gt; $new
+	if [ $? != 0 ] ; then
+		echo "overwrite: $1 failed, $file unchanged" 1&gt;&amp;2
+		rm -f $new $old
+		trap - 1 2 15
+		exit 1
+	fi
+else
+	cat &gt; $new
+fi
+
+#if [ -f $file ] ; then
+#	cp -f $file $old	#useful if 'cp $new $file' fail
+#fi
+
+trap '' 1 2 15	#ignore signals
+cp -f $new $file	#overwire (not mv) to preserve permissions
+rm -f $new $old
+trap - 1 2 15	#restore

Added: addon/releases/zkjsp/1.4.1/bin/preverify
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/preverify	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/preverify	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,35 @@
+#!/bin/bash
+# preverify
+#
+#{{IS_NOTE
+#	Purpose:
+#		Execute Sun Wireless Toolkit's preverify
+#	Description:
+#		
+#	History:
+#		Tue Nov 28 11:58:49     2006, Created by tomyeh
+#}}IS_NOTE
+#
+#Copyright (C) 2006 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#}}IS_RIGHT
+#
+if [ $# != 2 ] ; then
+	echo "Usage:"
+	echo "  preverify src-dir dst-dir"
+	echo
+	echo "Execute Sun Wireless Toolkit's preverify to verify the class files."
+	exit 1
+fi
+if [ "$MIDP_HOME" = "" ] ; then
+	if [ ! -d /usr/WTK ] ; then
+		echo '$MIDP_HOME must be defined, or WTK must be found at /usr/WTK'
+		exit 1
+	fi
+	MIDP_HOME=/usr/WTK
+fi
+
+cp=$MIDP_HOME/lib/midpapi20.jar\;$MIDP_HOME/lib/cldcapi11.jar
+
+$MIDP_HOME/bin/preverify -target CLDC1.0 -cldc -classpath $cp -d $2 $1

Added: addon/releases/zkjsp/1.4.1/bin/setdbg
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/setdbg	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/setdbg	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,61 @@
+#!/bin/bash
+#
+#{{IS_NOTE
+#
+# Authors: Tom M. Yeh
+# Contributors:
+# Create Date: 2001/5/17 07:57PM
+# Purpose: Modifies org/zkoss/lang/D.java 
+# Description:
+#	Execute 'setdbg -h' to know how to use.
+#
+#}}IS_NOTE
+#
+# Copyright (C) 2001 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#	This program is distributed under GPL Version 2.0 in the hope that
+#	it will be useful, but WITHOUT ANY WARRANTY.
+#}}IS_RIGHT
+#
+if [ \( "$1" = "-h" \) -o \( "$1" = "--help" \) ] ; then
+	echo "setdbg - modifies D.ON in org/zkoss/lang/D.java"
+	echo "Copyright (C) 2001 Potix Corporation. All Rights Reserved."
+	echo
+	echo "Usage:"
+	echo "  setdbg true|false"
+	echo
+	echo "Options:"
+	echo
+	echo "true"
+	echo "  Enable the debugging, i.e., D.ON = true."
+	echo "false"
+	echo "  Disable the debugging, i.e., D.ON = false."
+	exit 0
+fi
+
+if [ \( "$1" != "true" \) -a \( "$1" != "false" \) ] ; then
+	echo "Error: true or false must be specified."
+	echo "Execute 'setdbg --help' for information."
+	exit 1
+fi
+
+flnm=zcommon/src/org/zkoss/lang/D.java
+if [ ! -f $flnm ] ; then
+	echo "Error: $flnm does not exist"
+	exit 1
+fi
+
+if [ $1 = true ] ; then
+	onnew="\/\*-\*\/ON=true\/\*-\*\/"
+	onold="\/\*-\*\/ON=false\/\*-\*\/"
+else
+	onnew="\/\*-\*\/ON=false\/\*-\*\/"
+	onold="\/\*-\*\/ON=true\/\*-\*\/"
+fi
+
+grep -l "$onnew" $flnm &gt; /dev/null
+if [ $? != 0 ] ; then
+	echo Update $flnm
+	../bin/overwrite $flnm sed "s/$onold/$onnew/" $flnm
+fi

Added: addon/releases/zkjsp/1.4.1/bin/zipjs
===================================================================
--- addon/releases/zkjsp/1.4.1/bin/zipjs	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/bin/zipjs	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,105 @@
+#!/bin/bash
+# zipjs
+#
+#{{IS_NOTE
+#	Purpose:
+#		Copy and compress Javascript
+#	Description:
+#		
+#	History:
+#		Thu Jan 26 14:17:26     2006, Created by tomyeh
+#}}IS_NOTE
+#
+#Copyright (C) 2006 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#	This program is distributed under GPL Version 2.0 in the hope that
+#	it will be useful, but WITHOUT ANY WARRANTY.
+#}}IS_RIGHT
+#
+if [ $# != 3 ] ; then
+	echo "Usage:"
+	echo "  zipjs jarfl srcdir dstdir"
+	echo
+	echo "All files are copied from one directory to another."
+	echo "The JavaScript files are compressed during copying."
+	exit 1
+fi
+
+if [ ! -d "$2" ] ; then #nothing to copy
+	exit 0
+fi
+
+jarfl="$1"
+if [ "${jarfl#/}" = "$jarfl" ] ; then
+	jarfl="$(pwd)/$jarfl"
+fi
+dstdir="$3"
+if [ "${dstdir#/}" = "$dstdir" ] ; then
+	dstdir="$(pwd)/$dstdir"
+fi
+
+if [ ! -f "$jarfl" ] ; then
+	echo "$jarfl not found"
+	exit 1
+fi
+
+#convert jarfl to window format
+if [ "$TERM" = "cygwin" ] ; then
+	jarfl=$(cygpath -wa $jarfl)
+fi
+
+failed=false
+
+function zips
+{
+	local dst="$1"
+	local parent=$2
+	for f in *; do
+		if [ "$f" != "CVS" ] ; then
+			dstfl=$dst/$f
+			if [ -d "$f" ] ; then
+				(
+				cd "$f"
+				zips "$dstfl" "$f"
+				)
+			elif [ -f "$f" ] ; then
+				mkdir -p "$dst"
+
+				if [ ! -f "$dstfl" ] || [ "$f" -nt "$dstfl" ] ;  then
+					local cvt=false
+					if [ "${f%.js}" != "$f" ] ; then
+						cvt=true
+					fi
+					if [ $cvt = true ] ; then
+						echo Compress $f
+						if [ "$TERM" = "cygwin" ] ; then
+							dstfl=$(cygpath -wa $dstfl)
+						fi
+						java -jar $jarfl --charset UTF-8 --line-break 0 "$f" -o "$dstfl" 2&gt;&amp;1
+						if [ $? != 0 ] ; then
+							echo "Warning failed to compress, use copy instead: $f"
+							cvt=false
+						fi
+					fi
+					if [ $cvt = false ] ; then
+						echo copy $f
+						cp -p ./$f $dst
+							#$f might starts with -
+						if [ $? != 0 ] ; then
+							echo "Failed:"
+							echo "  cp -p $f $dst"
+							failed=true
+						fi
+					fi
+				fi
+			fi
+		fi
+	done
+	cd ..
+}
+cd $2
+zips "$dstdir"
+if [ $failed = true ] ; then
+	exit 1
+fi

Added: addon/releases/zkjsp/1.4.1/build
===================================================================
--- addon/releases/zkjsp/1.4.1/build	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/build	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,515 @@
+#!/bin/bash
+#
+#{{IS_NOTE
+#	Purpose:
+#		To build java projects
+#	Description:
+#		'build help' for more descriptions
+#	History:
+#		March 29 15:11 2001, Created by tomyeh
+#		August 21 13:59 2002, Rewritten by tomyeh
+#}}IS_NOTE
+#
+#Copyright (C) 2002 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#	This program is distributed under GPL Version 2.0 in the hope that
+#	it will be useful, but WITHOUT ANY WARRANTY.
+#}}IS_RIGHT
+#
+
+#-- precondition check
+setting=build.setting.local
+if [ ! -f $setting ] ; then
+	setting=build.setting
+	if [ ! -f $setting ] ; then
+		echo $setting must be specified. Refer to $setting.sample.
+		exit 1
+	fi
+fi
+
+#-- help, verbose or continue
+if [ "$1" = "help" ] ; then
+	more build.txt
+	exit 0
+fi
+#nojc is obsolete
+#if [ "$1" = "nojc" ] ; then
+#	shift
+#	nojc="-Dnojc=true"
+#else
+#	nojc="-Dnojc=false"
+#fi
+if [ "$1" = "verbose" ] ; then
+	shift
+	verbose="-verbose -Dverbose.required=true"
+fi
+if [ "$1" = "continue" ] ; then
+	shift
+	haltonerror=off
+else
+	haltonerror=on
+fi
+if [ "$1" = "unzip" ] ; then
+	shift
+	unzip=true
+else
+	unzip=$(grep '^unzip=' $setting)
+	unzip=${unzip#unzip=}
+	if [ "$unzip" = "false" ] ; then
+		unzip=
+	fi
+fi
+
+zipjs=$(grep '^zipjs=' $setting)
+zipjs=${zipjs#zipjs=}
+if [ "$zipjs" = "false" ] ; then
+	zipjs=
+fi
+
+jboss_profile=$(grep '^jboss.deploy' $setting)
+jboss_profile=${jboss_profile#jboss.deploy=}
+if [ "$jboss_profile" != "" ] ; then
+	jboss_ear=${jboss_profile#*/}
+	if [ "$jboss_ear" = "" ] ; then
+		echo "Illegal jboss.deploy: $jboss_profile. It must be xxx/yyy."
+	fi
+	jboss_profile=${jboss_profile%/*}
+fi
+jboss_home=/usr/jboss
+tomcat_home="$CATALINA_HOME"
+if [ ! -d "$tomcat_home" ]; then
+  tomcat_home=/usr/tomcat
+fi
+if [ "$TERM" = "cygwin" ] ; then
+	jboss_home=$(cygpath -w $jboss_home)
+	jboss_home=${jboss_home%\\}
+	tomcat_home=$(cygpath -w $tomcat_home)
+	tomcat_home=${tomcat_home%\\}
+fi
+
+start_service=$(grep '^start.service' $setting)
+start_service=${start_service#start.service=}
+
+#-- parsing dbglfag
+dbgflag=$(grep '^D.ON' $setting)
+dbgflag=${dbgflag#D.ON=}
+if [ "$dbgflag" = "true" ] ; then
+	cmd=build.debug
+	jstrim=false
+elif [ "$dbgflag" = "false" ] ; then
+	cmd=build.release
+	jstrim=true
+else
+	echo D.ON in $setting must be either true or false -- not $dbgflag
+	exit 1
+fi
+
+#-- parsing cmd
+cmdList=" bd br cd cr ud ur doc jsrc build.debug build.release clean clean.debug clean.release utest.debug utest.release javadoc help"
+if [ \( $# != 0 \) -a \( "${cmdList#* $1 }" != "$cmdList" \) ] ; then
+	cmd=$1
+	shift
+fi
+
+case $cmd in
+bd)   cmd=build.debug ;;
+br)   cmd=build.release ;;
+cd)   cmd=clean.debug ;;
+cr)   cmd=clean.release ;;
+ud)   cmd=utest.debug ;;
+ur)   cmd=utest.release ;;
+doc)  cmd=javadoc ;;
+esac
+
+outdir=${cmd#*\.}
+cmd=${cmd%\.*}
+if [ "$outdir" = "$cmd" ] ; then
+	if [ "$dbgflag" = "true" ] ; then
+		outdir=debug
+	else
+		outdir=release
+	fi
+fi
+
+#-- adjust javac debug and optimize flags
+dflag=$(grep '^debug=' $setting)
+dflag=${dflag#debug=}
+if [ "$dflag" = "true" ] ; then
+	dflag=on
+elif [ "$dflag" = "false" ] ; then
+	dflag=off
+elif [ "$dflag" != "" ] ; then
+	echo Illegal setting: debug=$dflag
+	exit 1
+fi
+
+oflag=$(grep '^optimize=' $setting)
+oflag=${oflag#optimize=}
+if [ "$oflag" = "true" ] ; then
+	oflag=on
+elif [ "$oflag" = "false" ] ; then
+	oflag=off
+elif [ "$oflag" != "" ] ; then
+	echo Illegal setting: optimize=$oflag
+	exit 1
+fi
+
+if [ "$outdir" = "release" ] ; then
+	if [ "$dflag" = "" ] ; then
+		dflag="off"
+	fi
+	if [ "$oflag" = "" ] ; then
+		oflag="on"
+	fi
+else
+	if [ "$dflag" = "" ] ; then
+		dflag="on"
+	fi
+	if [ "$oflag" = "" ] ; then
+		oflag="off"
+	fi
+fi
+echo "dflag=$dflag, oflag=$oflag"
+
+#-- Prepare define list
+dfnList=
+if [ $# != 0 ] ; then
+	while [ "$1" != "${1#*=}" ] ; do
+		dfnList="$dfnList -D$1"
+		shift
+	done
+fi
+
+#-- Prepare $targetList
+#Add a project to the target list (the redudant ones won't be added)
+if [ $# != 0 ] ; then
+	for target in $* ; do
+		target=${target%/}
+		targetListOld="$targetListOld $target"
+		if [ \( ! -d $target \) -a \( ! -d ${target}Test \) ] ; then
+			echo "Error: $target doesn't exist"
+			exit 1
+		fi
+	done
+else
+	if [ ! -f build.projects ] ; then
+		echo build.projects not found
+		exit 1
+	fi
+	targetListOld="$(cat build.projects | tr '\n' ' ')"
+	targetListOld="${targetListOld% }"
+	doall="-Ddo.all=true"
+		#denote all projects are built; passed to build.xml
+fi
+
+function addToTargetList
+{
+	if [ \( "${targetList#* $1 }" = "${targetList}" \) -a \
+	\( "${targetList% $1}" = "${targetList}" \) -a \
+	\( "${targetList#$1 }" = "${targetList}" \) ] ; then
+		targetList="$targetList $1"
+
+		#check wether the project is defined correctly
+		mustList="format"
+		if [ -d $target ] ; then
+			for v in $mustList ; do
+				if [ ! -f $target/$v ] ; then
+					echo "Error: $target/$v doesn't exist"
+					exit 1
+				fi
+			done
+		fi
+	fi
+}
+
+
+targetList=
+if [ "${cmd#utest}" != "$cmd" ] ; then #utest
+	for target in $targetListOld ; do
+		if [ "${target%Test}" = "$target" ] ; then
+			target=${target}Test
+		fi
+		addToTargetList $target
+	done
+else
+	for target in $targetListOld ; do
+		addToTargetList $target
+	done
+fi
+
+#-- prepare javadocdir ...
+if [ "$cmd" = "javadoc" ] ; then
+	javadocdir=$(grep '^javadoc' $setting)
+	javadocdir=${javadocdir#javadoc=}
+	if [ "$javadocdir" = "" ] ; then
+		echo javadoc must be specified in $setting
+		exit 1
+	fi
+	javadocdir=${javadocdir/\~/$HOME}
+else
+	javadocdir=nonexist
+fi
+
+#-- subroutine safe_cygpath
+#$1: cygpath option
+#$2: path
+#split path to chunks of $size size and do cygpath
+#this is a work around for the cygpath bug which cannot handle too long a path
+function safe_cygpath
+{
+	local path=$2
+	local size=400
+	local newpath=
+	while [ ${#path} -gt $size ] ; do
+		path1=${path:0:$size}
+		path1=${path1%:*}
+		offset=$((${#path1}+1))
+		newpath="$newpath;$(cygpath $1 $path1)"
+		path=${path:$offset}
+	done
+	if [ ${#path} -gt 0 ] ; then
+		newpath="$newpath;$(cygpath $1 $path)"
+	fi
+	newpath=${newpath#;}
+	echo ${newpath%;}
+}
+
+#-- subroutine invoke_ant
+#$1: cmd
+#$2: target
+function invoke_ant
+{
+	echo "$1.$outdir $2..."
+	cd $2
+
+	#handle class.test.local
+	local class_test=
+	if [ "${cmd#utest}" != "$cmd" ] ; then #utest
+		if [ -f class.test.local ] ; then
+			ctOrg=$(cat class.test.local | tr '\n' ' ')
+			class_test=
+			for cls in $ctOrg ; do
+				if [ "${cls#\#}" = "$cls" ] ; then
+					fl=$(echo $cls | tr '.' '/').java
+					if [ "$class_test" = "" ] ; then
+						class_test="-Dclass.test=$fl"
+					else
+						class_test="$class_test,$fl"
+							#Don't use whitespace
+					fi
+				fi
+			done
+		fi
+	fi
+
+	local CP=
+	if [ -f classpath ] ; then
+		#retrieve path
+		CP=$(cat classpath | tr '\n' ':')
+		CP=${CP%:}
+
+		#javadoc.class.path shall not contain '.', because xdoclet will
+		#ignore files that are found in classpath
+		DCP=$(echo $CP | sed -e 's/:\.:/:/g' -e 's/^\.://' -e 's/:\.$//')
+		if [ "$TERM" = "cygwin" ] ; then
+			DCP=$(safe_cygpath "-mp" "$DCP")
+				#Don't convert CP because it is used by bash directly
+		fi
+	fi
+	
+	### add classpath2 because zuljsp needs two cycles build progress for jsp20 &amp; jsp21
+	local CP2=
+	if [ -f classpath2 ] ; then
+		#retrieve path
+		CP2=$(cat classpath2 | tr '\n' ':')
+		CP2=${CP2%:}
+
+		#javadoc.class.path shall not contain '.', because xdoclet will
+		#ignore files that are found in classpath
+		DCP2=$(echo $CP2 | sed -e 's/:\.:/:/g' -e 's/^\.://' -e 's/:\.$//')
+		if [ "$TERM" = "cygwin" ] ; then
+			DCP2=$(safe_cygpath "-mp" "$DCP2")
+				#Don't convert CP because it is used by bash directly
+		fi
+	fi
+	
+	if [ "$verbose" != "" ] ; then
+		echo "CP: $CP"
+		echo "DCP: $DCP"
+	fi
+
+	local war_libs=
+	if [ -f war.libs ] ; then
+		war_libs=$(cat war.libs | tr '\n' ',')
+		war_libs=${war_libs%,}
+	fi
+	if [ "$war_libs" = "" ] ; then
+		war_libs=nonexist
+	fi
+
+	local server_libs=
+	if [ -f server.libs ] ; then
+		server_libs=$(cat server.libs | tr '\n' ',')
+		server_libs=${server_libs%,}
+	fi
+	if [ "$server_libs" = "" ] ; then
+		server_libs="nonexist"
+	fi
+
+	local ear_libs=
+	if [ -f ear.libs ] ; then
+		ear_libs=$(cat ear.libs | tr '\n' ',')
+		ear_libs=${ear_libs%,}
+	fi
+	if [ "$ear_libs" = "" ] ; then
+		ear_libs=nonexist
+	fi
+
+	local import_libs=
+	if [ -f import.libs ] ; then
+		import_libs=$(cat import.libs | tr '\n' ',')
+		import_libs=${import_libs%,}
+	fi
+	if [ "$import_libs" = "" ] ; then
+		import_libs=nonexist
+	fi
+
+	local deploy=
+	local unziplist=
+	if [ -f deploy ] ; then
+		deploy=$(head -1 deploy)
+		if [ "$deploy" = "server" ] || [ "${cmd#utest}" != "$cmd" ] ; then
+			app=$(grep '^app=' deploy)
+			app=${app#app=}
+			if [ "$app" = "" ] ; then
+				echo "You must specify app=xxx in deploy, because deploy target is server or utest is required"
+				exit 1
+			fi
+			echo Application: $app
+		fi
+		if [ "$deploy" = "server" ] ; then
+			rootContext=$(grep '^root-context=' deploy)
+			rootContext=${rootContext#root-context=}
+
+			if [ "$unzip" != "" ]; then
+				unziplist=$(grep '^unzip' deploy|tr -d ' ')
+				unziplist=${unziplist#unzip=}
+				if [ "$unziplist" != "" ] ; then
+					unziplist=-Ddeploy.unzip.list="$unziplist"
+				fi
+			fi
+		fi
+		if [ "$zipjs" != "" ] ; then
+			zipjslist=$(grep '^zipjs=' deploy)
+			zipjslist=${zipjslist#zipjs=}
+		fi
+	else
+		deploy=unknown
+	fi
+	if [ "${zipjslist}" = "" ] ; then
+		zipjslist=_na_dir_
+	fi
+
+	prjver="$(head -1 version)"
+	srcver=$(grep '^source=' version)
+	srcver=${srcver#source=}
+	if [ "$srcver" = "" ] ; then
+		srcver=1.5
+	fi
+	tgtver=$(grep '^target=' version)
+	tgtver=${tgtver#target=}
+	if [ "$tgtver" = "" ] ; then
+		tgtver=1.5
+	fi
+
+	this_dflag=$dflag
+	dflagtmp=$(grep '^debug=' version)
+	dflagtmp=${dflagtmp#debug=}
+	if [ "$dflagtmp" = "true" ] ; then
+		this_dflag=on
+	elif [ "$dflagtmp" = "false" ] ; then
+		this_dflag=off
+	fi
+	this_oflag=$oflag
+	oflagtmp=$(grep '^optimize=' version)
+	oflagtmp=${oflagtmp#optimize=}
+	if [ "$oflagtmp" = "true" ] ; then
+		this_oflag=on
+	elif [ "$oflagtmp" = "false" ] ; then
+		this_oflag=off
+	fi
+
+	format="$(head -1 format)"
+	if [ "$format" = "cpp" ] ; then
+		if [ ! -d $outdir ] ; then
+			mkdir $outdir
+		fi
+		if [ \( "${cmd#build}" != "$cmd" \) -o \( "${cmd#clean}" != "$cmd" \) ] ; then
+		(
+			cd $outdir
+			DEPLOY_DIR=../../dist/lib make -f ../src/Makefile $1
+		)
+		fi
+	else
+		CLASSPATH="$DCP" ANT_OPTS=-Xmx160M ant $verbose $class_test \
+		$doall -Dformat="$format" -Ddeploy="$deploy" \
+		-Dserver.libs="$server_libs" -Dstart.service="$start_service" \
+		-Djboss.profile="$jboss_profile" -Djboss.ear="$jboss_ear" \
+		-Djboss.home="$jboss_home" -Dtomcat.home="$tomcat_home" \
+		-Djs.trim=$jstrim -Dzipjs=$zipjslist\
+		-Dsrc.dir=src\
+		-Dwar.libs="$war_libs" -Dbasedir=. \
+		-Dear.libs="$ear_libs" -Dimport.libs="$import_libs" \
+		-Dproject.name="$2" -Dproject.version="$prjver" \
+		-Dsource.version="$srcver" -Dtarget.version="$tgtver" \
+		-Dhaltonerror=$haltonerror -Dout.dir=$outdir \
+		-Ddebug=$this_dflag -Doptimize=$this_oflag ${nojc} \
+		-Dshare.javadoc.dir="$javadocdir" \
+		-Djavadoc.class.path="$DCP" -Dapp.name=$app $unziplist \
+		-Droot.context=$rootContext \
+		$dfnList -buildfile ../build.xml $1
+		
+		CLASSPATH="$DCP2" ANT_OPTS=-Xmx160M ant $verbose $class_test \
+		$doall -Dformat="$format" -Ddeploy="$deploy" \
+		-Dserver.libs="$server_libs" -Dstart.service="$start_service" \
+		-Djboss.profile="$jboss_profile" -Djboss.ear="$jboss_ear" \
+		-Djboss.home="$jboss_home" -Dtomcat.home="$tomcat_home" \
+		-Djs.trim=$jstrim -Dzipjs=$zipjslist\
+		-Dsrc.dir=src2\
+		-Dwar.libs="$war_libs" -Dbasedir=. \
+		-Dear.libs="$ear_libs" -Dimport.libs="$import_libs" \
+		-Dproject.name="$2" -Dproject.version="$prjver" \
+		-Dsource.version="$srcver" -Dtarget.version="$tgtver" \
+		-Dhaltonerror=$haltonerror -Dout.dir=$outdir \
+		-Ddebug=$this_dflag -Doptimize=$this_oflag ${nojc} \
+		-Dshare.javadoc.dir="$javadocdir" \
+		-Djavadoc.class.path="$DCP2" -Dapp.name=$app $unziplist \
+		-Droot.context=$rootContext \
+		$dfnList -buildfile ../build.xml $1
+		
+	fi
+
+	if [ $? != 0 ] ; then
+		exit $?
+	fi
+
+	rm -rf velocity.log junit*.properties
+	cd ..
+}
+
+start=`date +%s`
+echo "targets: ${targetList}"
+for target in $targetList ; do
+	if [ -d $target ] ; then
+		invoke_ant $cmd $target
+	else
+		echo "Ignore: $target doesn't exist"
+	fi
+done
+end=`date +%s`
+buildTime=$(( $end - $start ))
+buildTimeMM=$(( $buildTime / 60 ))
+buildTimeSS=$(( $buildTime % 60 ))
+echo ""
+echo "Total build process time: ${buildTimeMM} min ${buildTimeSS} sec."

Added: addon/releases/zkjsp/1.4.1/build.projects
===================================================================
--- addon/releases/zkjsp/1.4.1/build.projects	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/build.projects	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1 @@
+zuljsp

Added: addon/releases/zkjsp/1.4.1/build.prop.xml
===================================================================
--- addon/releases/zkjsp/1.4.1/build.prop.xml	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/build.prop.xml	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,85 @@
+&lt;!-- build.prop.xml
+	Purpose:
+		The properties definition for build.xml
+	Description:
+		We put the properties definition in an separate file
+		to reduce the complexity of build.xml.
+	History:
+		Wed Aug 21 17:44:40  2002, Created by tomyeh
+
+Copyright (C) 2002 Potix Corporation. All Rights Reserved.
+--&gt;
+
+&lt;!--
+	Generic project properties
+--&gt;
+&lt;property name="ant.lib.dir" value="${ant.home}/lib"/&gt;
+
+&lt;!--
+	Compiler settings
+--&gt;
+&lt;property name="deprecation" value="on"/&gt;
+&lt;property name="target.version" value="1.5"/&gt;
+&lt;property name="source.version" value="1.5"/&gt;
+
+&lt;!--
+	Build tree settings
+--&gt;
+&lt;property name="bin.dir" value="../bin"/&gt;
+&lt;property name="tmp.dir" value="tmp"/&gt;
+&lt;!-- property name="out.dir" value="debug"/ --&gt; &lt;!-- invoker must provide --&gt;
+
+&lt;!--***** in zuljsp, src could be asigned from otehr place *****--&gt;
+&lt;!--&lt;property name="src.dir" value="src"/&gt;--&gt;
+&lt;property name="src.archive.dir" value="${src.dir}/archive"/&gt;
+&lt;property name="src.export.dir" value="${src.dir}/export"/&gt;
+&lt;property name="src.mesg.dir" value="${src.archive.dir}/metainfo/mesg"/&gt;
+&lt;property name="manifest.mf" value="${src.archive.dir}/META-INF/MANIFEST.MF"/&gt;
+&lt;property name="application.xml" value="${src.archive.dir}/META-INF/application.xml"/&gt;
+
+&lt;property name="codegen.dir" value="codegen"/&gt;
+&lt;property name="codegen.archive.dir" value="${codegen.dir}/archive"/&gt;
+&lt;property name="codegen.archive.web.dir" value="${codegen.archive.dir}/web"/&gt;
+
+&lt;property name="jar.name" value="${project.name}.jar"/&gt;
+&lt;property name="war.name" value="${project.name}.war"/&gt;
+&lt;property name="ear.name" value="${project.name}.ear"/&gt;
+&lt;property name="jad.name" value="${project.name}.jad"/&gt;
+&lt;!--property name="ear.name" value="${project.name}-${project.version}.ear"/--&gt;
+&lt;property name="xar.name" value="${project.name}.*ar"/&gt;
+
+&lt;property name="outv.dir" value="${out.dir}v"/&gt;&lt;!-- used for preverify classes --&gt;
+&lt;property name="out.tmp.dir" value="${out.dir}/tmp"/&gt;
+&lt;property name="out.app.dir" value="${out.tmp.dir}/${project.name}"/&gt;
+&lt;property name="dist.dir" value="../dist"/&gt;
+&lt;property name="working.dir" value="../working"/&gt;
+&lt;property name="dist.lib.dir" value="${dist.dir}/lib"/&gt;
+&lt;property name="dist.lib.ext.dir" value="${dist.lib.dir}/ext"/&gt;
+&lt;property name="dist.conf.dir" value="${dist.dir}/conf"/&gt;
+&lt;property name="dist.install.dir" value="${dist.conf.dir}/install"/&gt;
+&lt;property name="dist.upgrade.dir" value="${dist.conf.dir}/upgrade"/&gt;
+&lt;property name="dist.test.dir" value="${dist.conf.dir}/test"/&gt;
+&lt;property name="dist.export.dir" value="${dist.dir}/export"/&gt;
+&lt;property name="working.javadoc.dir" value="${working.dir}/javadoc/${project.name}"/&gt;
+&lt;property name="dist.javadoc.dir" value="${share.javadoc.dir}/${project.name}"/&gt;
+&lt;property name="out.metainf.dir" value="${out.dir}/META-INF"/&gt;
+
+&lt;!-- tomcat --&gt;
+&lt;property name="tomcat.home" value="/usr/tomcat"/&gt;
+&lt;property name="tomcat.lib.dir" value="${tomcat.home}/shared/lib"/&gt;
+&lt;property name="tomcat.webapps.dir" value="${tomcat.home}/webapps"/&gt;
+&lt;property name="tomcat.conf.dir" value="${tomcat.home}/conf"/&gt;
+
+&lt;!-- jboss --&gt;
+&lt;property name="jboss.home" value="/usr/jboss"/&gt;
+&lt;property name="jboss.lib.dir" value="${jboss.home}/server/${jboss.profile}/lib"/&gt;
+&lt;property name="jboss.deploy.dir" value="${jboss.home}/server/${jboss.profile}/deploy"/&gt;
+&lt;property name="jboss.deploy1.dir" value="${jboss.home}/server/${jboss.profile}/${jboss.ear}"/&gt;
+&lt;property name="jboss.conf.dir" value="${jboss.home}/server/${jboss.profile}/conf"/&gt;
+&lt;property name="jboss.app.dir" value="${jboss.home}/server/${jboss.profile}/${app.name}"/&gt;
+&lt;property name="jboss.app.conf.dir" value="${jboss.app.dir}/conf"/&gt;
+&lt;property name="jboss.app.test.dir" value="${jboss.app.dir}/test"/&gt;
+&lt;property name="jboss.www.dir" value="${jboss.home}/server/${jboss.profile}/www"/&gt;
+
+&lt;property name="exclude.list" value="tmp/**, temp/**, ${xar.name}, conf/*.properties"/&gt;
+

Added: addon/releases/zkjsp/1.4.1/build.setting
===================================================================
--- addon/releases/zkjsp/1.4.1/build.setting	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/build.setting	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,10 @@
+D.ON=true
+javadoc=~/prj/javadoc
+zipjs=true
+unzip=true
+debug=true
+optimize=true
+jboss.deploy=default/deploy
+start.service=Apache Tomcat
+version=3.0.1-FL
+zkmob-version=0.8.7
\ No newline at end of file

Added: addon/releases/zkjsp/1.4.1/build.setting.local
===================================================================
--- addon/releases/zkjsp/1.4.1/build.setting.local	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/build.setting.local	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,10 @@
+D.ON=true
+javadoc=~/prj/javadoc
+zipjs=true
+unzip=true
+debug=true
+optimize=true
+jboss.deploy=default/deploy
+start.service=Apache Tomcat
+version=3.0.1-FL
+zkmob-version=0.8.7
\ No newline at end of file

Added: addon/releases/zkjsp/1.4.1/build.target.xml
===================================================================
--- addon/releases/zkjsp/1.4.1/build.target.xml	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/build.target.xml	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,327 @@
+&lt;!-- build.target.xml
+	Purpose:
+		The target definitions for build.xml
+	Description:
+		The target definitions are put in a separate file for two reasons:
+		1) it is shared by two projects
+		2) reduce the complexity of build.xml
+	History:
+		Wed Aug 21 18:01:44  2002, Created by tomyeh
+
+Copyright (C) 2002-2006 Potix Corporation. All Rights Reserved.
+--&gt;
+
+&lt;!-- ======= --&gt;
+&lt;!-- CODEGEN --&gt;
+&lt;!-- ======= --&gt;
+&lt;target name="codegen.mesg" depends="config.build" if="src.mesg.dir.exist"&gt;
+	&lt;!-- generate MxxConst.java --&gt;
+	&lt;exec executable="bash" dir="." failonerror="true"&gt;
+		&lt;arg value="${bin.dir}/genprop"/&gt;
+		&lt;arg value="-x"/&gt;
+		&lt;arg value="${src.mesg.dir}"/&gt;
+		&lt;arg value="${codegen.dir}"/&gt;
+	&lt;/exec&gt;
+&lt;/target&gt;
+
+&lt;!-- ======= --&gt;
+&lt;!-- COMPILE --&gt;
+&lt;!-- ======= --&gt;
+&lt;target name="compile" depends="codegen.mesg" if="compile.required"&gt;
+	&lt;mkdir dir="${out.dir}"/&gt;
+	&lt;javac srcdir="${src.dir}:${codegen.dir}" destdir="${out.dir}"
+	 debug="${debug}" optimize="${optimize}" encoding="UTF-8"
+	 target="${target.version}" deprecation="${deprecation}" source="${source.version}"&gt;
+		&lt;!--compilerarg value="-Xlint:unchecked"/--&gt;
+	&lt;/javac&gt;
+&lt;/target&gt;
+
+
+&lt;!-- ====== --&gt;
+&lt;!-- DEPLOY --&gt;
+&lt;!-- ====== --&gt;
+
+&lt;target name="deploy.export" depends="config.build" if="src.export.dir.exist"&gt;
+	&lt;copy todir="${dist.export.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${src.export.dir}" excludes="**/CVS/**"/&gt;
+	&lt;/copy&gt;
+&lt;/target&gt;
+
+&lt;target name="deploy.lib" depends="config.build" if="deploy.lib.required"&gt;
+	&lt;copy todir="${dist.lib.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${out.dir}" includes="${xar.name}, ${jad.name}"/&gt;
+	&lt;/copy&gt;
+&lt;/target&gt;
+
+&lt;target name="stop.service" depends="config.build"
+if="start.service.required"&gt;
+	&lt;exec executable="net" dir="." failonerror="false"&gt;
+		&lt;arg value="stop"/&gt;
+		&lt;arg value="${start.service}"/&gt;
+	&lt;/exec&gt;
+&lt;/target&gt;
+&lt;target name="start.service" depends="config.build"
+if="start.service.required"&gt;
+	&lt;exec executable="net" dir="." failonerror="false"&gt;
+		&lt;arg value="start"/&gt;
+		&lt;arg value="${start.service}"/&gt;
+	&lt;/exec&gt;
+&lt;/target&gt;
+&lt;target name="deploy.tomcat.files" depends="config.build"
+if="deploy.tomcat.required"&gt;
+	&lt;exec executable="bash" dir="." failonerror="true"&gt;
+		&lt;arg value="${bin.dir}/deploy.unzip.war"/&gt;
+		&lt;arg value="${dist.lib.dir}"/&gt;
+		&lt;arg value="${tomcat.webapps.dir}"/&gt;
+		&lt;arg value="${ear.libs}"/&gt;
+		&lt;arg value="${root.context}/ROOT"/&gt;
+	&lt;/exec&gt;
+
+	&lt;copy todir="${tomcat.lib.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${dist.lib.dir}" includes="${server.libs}"/&gt;
+		&lt;fileset dir="${dist.lib.ext.dir}" includes="${server.libs}"/&gt;
+	&lt;/copy&gt;
+
+	&lt;copy tofile="${tomcat.conf.dir}/i3-log.conf" file="${dist.conf.dir}/i3-log.conf.local"
+	preservelastmodified="yes" failonerror="false"/&gt;
+&lt;/target&gt;
+&lt;target name="deploy.tomcat"
+depends="config.build, stop.service, deploy.tomcat.files, start.service"
+if="deploy.tomcat.required"&gt;
+&lt;/target&gt;
+
+&lt;target name="deploy.jboss.intact" depends="config.build"
+if="deploy.jboss.intact.required"&gt;
+	&lt;!-- deploy to server intact --&gt;
+	&lt;copy todir="${jboss.deploy1.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${out.dir}" includes="${xar.name}"/&gt;
+	&lt;/copy&gt;
+&lt;/target&gt;
+&lt;target name="deploy.jboss.unzip" depends="config.build"
+if="deploy.jboss.unzip.required"&gt;
+	&lt;!-- deploy to server by unzip --&gt;
+	&lt;exec executable="bash" dir="." failonerror="true"&gt;
+		&lt;arg value="${bin.dir}/deploy.unzip"/&gt;
+		&lt;arg value="${out.dir}/${xar.name}"/&gt;
+		&lt;arg value="${jboss.deploy1.dir}"/&gt;
+		&lt;arg value="${deploy.unzip.list}"/&gt;
+	&lt;/exec&gt;
+&lt;/target&gt;
+
+&lt;target name="deploy.jboss"
+depends="config.build, deploy.jboss.unzip, deploy.jboss.intact"
+if="deploy.jboss.required"&gt;
+	&lt;mkdir dir="${dist.conf.dir}"/&gt;
+
+	&lt;!-- deploy configuration files --&gt;
+	&lt;copy tofile="${jboss.conf.dir}/i3-log.conf" file="${dist.conf.dir}/i3-log.conf.local"
+	preservelastmodified="yes" failonerror="false"/&gt;
+
+	&lt;copy todir="${jboss.conf.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${dist.conf.dir}"
+		includes="*-service.xml,i3-ks,*-policy.xml,*.properties"/&gt;
+	&lt;/copy&gt;
+	&lt;copy todir="${jboss.app.conf.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${dist.conf.dir}"
+		includes="i3-*.xml" excludes="*-service.xml,i3-ks"/&gt;
+	&lt;/copy&gt;
+
+	&lt;!-- deploy external library --&gt;
+	&lt;copy todir="${jboss.lib.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${dist.lib.ext.dir}" includes="${server.libs}"/&gt;
+	&lt;/copy&gt;
+	&lt;copy todir="${jboss.lib.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${dist.lib.dir}" includes="${server.libs}"/&gt;
+	&lt;/copy&gt;
+&lt;/target&gt;
+
+&lt;target name="deploy"
+depends="deploy.export, deploy.lib, deploy.tomcat, deploy.jboss"&gt;
+&lt;/target&gt;
+
+&lt;!-- ===== --&gt;
+&lt;!-- BUILD --&gt;
+&lt;!-- ===== --&gt;
+&lt;target name="build.jar" depends="compile, copy.web.jar" if="build.jar.required"&gt;
+	&lt;mkdir dir="${src.archive.dir}"/&gt;
+	&lt;mkdir dir="${codegen.archive.dir}"/&gt;
+
+	&lt;exec executable="bash" dir="." failonerror="true"&gt;
+		&lt;arg value="${bin.dir}/zipjs"/&gt;
+		&lt;arg value="${dist.lib.ext.dir}/yuicompressor.jar"/&gt;
+		&lt;arg value="${src.archive.dir}/${zipjs}"/&gt;
+		&lt;arg value="${codegen.archive.dir}/${zipjs}"/&gt;
+	&lt;/exec&gt;
+
+	&lt;jar jarfile="${out.dir}/${jar.name}" manifest="${manifest.mf}"&gt;
+		&lt;fileset dir="${out.dir}" excludes="${exclude.list}"/&gt;
+		&lt;fileset dir="${src.archive.dir}" includes="**"
+		 excludes="META-INF/MANIFEST.MF, **/CVS/**, ${zipjs}/**"/&gt;
+		&lt;fileset dir="${codegen.archive.dir}" includes="**"
+		 excludes="META-INF/MANIFEST.MF"/&gt;
+	&lt;/jar&gt;
+&lt;/target&gt;
+&lt;target name="build.jad" depends="compile, copy.web.jar" if="build.jad.required"&gt;
+	&lt;mkdir dir="${src.archive.dir}"/&gt;
+	&lt;mkdir dir="${codegen.archive.dir}"/&gt;
+
+	&lt;exec executable="bash" dir="." failonerror="true"&gt;
+		&lt;arg value="${bin.dir}/preverify"/&gt;
+		&lt;arg value="${out.dir}"/&gt;
+		&lt;arg value="${outv.dir}"/&gt;
+	&lt;/exec&gt;
+	&lt;jar jarfile="${out.dir}/${jar.name}" manifest="${manifest.mf}"&gt;
+		&lt;fileset dir="${outv.dir}" excludes="${exclude.list}, ${jad.name}"/&gt;
+		&lt;fileset dir="${src.archive.dir}" includes="**"
+		 excludes="META-INF/MANIFEST.MF, META-INF/${jad.name}, **/CVS/**, ${zipjs}/**"/&gt;
+		&lt;fileset dir="${codegen.archive.dir}" includes="**"
+		 excludes="META-INF/MANIFEST.MF"/&gt;
+	&lt;/jar&gt;
+
+	&lt;!-- generate ${out.dir}/${project-name}.jad --&gt;
+	&lt;exec executable="bash" dir="." failonerror="true"&gt;
+		&lt;arg value="${bin.dir}/genjad"/&gt;
+		&lt;arg value="${out.dir}/${jar.name}"/&gt;
+		&lt;arg value="${src.archive.dir}/META-INF/${jad.name}"/&gt;
+		&lt;arg value="${out.dir}/${jad.name}"/&gt;
+	&lt;/exec&gt;
+&lt;/target&gt;
+&lt;!-- copy WEB-relevant resource  to jar (into codegen.archive.web.dir) --&gt;
+&lt;target name="copy.web.jar" depends="deploy.export" if="copy.web.jar.required"&gt;
+	&lt;mkdir dir="${codegen.archive.web.dir}"/&gt;
+	&lt;copy todir="${codegen.archive.web.dir}" preservelastmodified="yes"
+	failonerror="false"&gt;
+		&lt;fileset dir="${dist.export.dir}" includes="${import.libs}"/&gt;
+		&lt;fileset dir="${dist.lib.ext.dir}" includes="${import.libs}"/&gt;
+		&lt;fileset dir="${src.export.dir}" includes="${import.libs}"/&gt;
+	&lt;/copy&gt;
+&lt;/target&gt;
+
+
+
+&lt;target name="build.war" depends="compile" if="build.war.required"&gt;
+	&lt;mkdir dir="${out.dir}"/&gt;
+	
+	&lt;property name="src.web.xml" value="${war.dir}/WEB-INF/web.xml"/&gt;
+		&lt;!-- to let other targets have a chance to override it --&gt;
+	&lt;war warfile="${out.dir}/${war.name}" webxml="${src.web.xml}"
+	manifest="${war.dir}/META-INF/MANIFEST.MF"&gt;
+		&lt;fileset dir="${war.dir}" includes="**"
+		 excludes="WEB-INF/web.xml, META-INF/MANIFEST.MF, **/CVS/**, **/_notes/**, **/_raw/**"/&gt;
+		&lt;fileset dir="${dist.export.dir}" includes="${import.libs}"/&gt;
+		&lt;fileset dir="${dist.lib.ext.dir}" includes="${import.libs}"/&gt;
+
+		&lt;lib dir="${dist.lib.ext.dir}" includes="${war.libs}"/&gt;
+		&lt;lib dir="${dist.lib.dir}" includes="${war.libs}"/&gt;
+		&lt;classes dir="${out.dir}" includes="**" excludes="${exclude.list}"/&gt;
+	&lt;/war&gt;
+&lt;/target&gt;
+
+&lt;target name="build.ear" depends="config.build" if="build.ear.required"&gt;
+	&lt;mkdir dir="${out.dir}"/&gt;
+	&lt;!-- build ear --&gt;
+	&lt;ear earfile="${out.dir}/${ear.name}" manifest="${manifest.mf}"
+	 appxml="${application.xml}"&gt;
+		&lt;fileset dir="${dist.lib.dir}" includes="${ear.libs}"/&gt;
+		&lt;fileset dir="${src.archive.dir}"
+		 includes="META-INF/**"
+		 excludes="META-INF/MANIFEST.MF, META-INF/application.xml, **/CVS/**"/&gt;
+	&lt;/ear&gt;
+&lt;/target&gt;
+
+&lt;target name="build"
+ depends="config.build, build.war, build.jad, build.jar, build.ear, deploy"&gt;
+&lt;/target&gt;
+
+&lt;!-- ===== --&gt;
+&lt;!-- CLEAN --&gt;
+&lt;!-- ===== --&gt;
+&lt;target name="clean.all" depends="config" if="clean.all.required"&gt;
+	&lt;delete quiet="true" includeEmptyDirs="true"&gt;
+		&lt;fileset dir="${dist.export.dir}" includes="**"/&gt;
+	&lt;/delete&gt;
+	&lt;!--delete quiet="true"&gt;
+		&lt;fileset dir="${dist.lib.dir}" includes="*.?ar, *.jad"/&gt;
+	&lt;/delete--&gt;
+&lt;/target&gt;
+
+&lt;target name="clean.bin" depends="config" if="clean.bin.required"&gt;
+	&lt;delete quiet="true" dir="${bin.dir}"/&gt;
+&lt;/target&gt;
+
+&lt;target name="clean" depends="clean.all, clean.bin"&gt;
+	&lt;delete quiet="true" dir="${out.dir}"/&gt;
+	&lt;delete quiet="true" dir="${tmp.dir}"/&gt;
+	&lt;delete quiet="true" dir="${outv.dir}"/&gt;
+	&lt;delete quiet="true" dir="${codegen.dir}"/&gt;
+	&lt;delete quiet="true"&gt;
+		&lt;fileset dir="${dist.lib.dir}" includes="${xar.name}, ${jad.name}"/&gt;
+		&lt;!--fileset dir="${jboss.lib.dir}" includes="${xar.name}"/--&gt;
+		&lt;fileset dir="${jboss.deploy1.dir}" includes="${xar.name}"/&gt;
+		&lt;!--fileset dir="${tomcat.lib.dir}" includes="${xar.name}"/--&gt;
+		&lt;fileset dir="${tomcat.webapps.dir}" includes="${xar.name}"/&gt;
+	&lt;/delete&gt;
+&lt;/target&gt;
+
+&lt;!-- ========= --&gt;
+&lt;!-- UNIT TEST --&gt;
+&lt;!-- ========= --&gt;
+&lt;target name="deploy.test" depends="config" if="dist.test.dir.exist"&gt;
+	&lt;copy todir="${jboss.app.test.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${dist.test.dir}" includes="**" excludes="**/CVS/**"/&gt;
+	&lt;/copy&gt;
+&lt;/target&gt;
+&lt;target name="utest" depends="build, deploy.test"&gt;
+	&lt;property name="class.test" value="**/*Test.java"/&gt;&lt;!-- test all if not defined --&gt;
+
+	&lt;echo message="Test ${class.test}..."/&gt;
+	&lt;junit fork="yes" haltonerror="${haltonerror}" dir="${out.dir}"&gt;
+		&lt;jvmarg value="-ea"/&gt;
+		&lt;formatter type="plain" usefile="false"/&gt;
+		&lt;classpath&gt;
+			&lt;pathelement path="${java.class.path}"/&gt;
+			&lt;pathelement location="${out.dir}"/&gt;
+		&lt;/classpath&gt;
+		&lt;batchtest&gt;
+			&lt;fileset dir="${src.dir}" includes="${class.test}"/&gt;
+		&lt;/batchtest&gt;
+	&lt;/junit&gt;
+&lt;/target&gt;
+
+&lt;!-- ============= --&gt;
+&lt;!-- MISCELLANEOUS --&gt;
+&lt;!-- ============= --&gt;
+&lt;target name="javadoc" depends="config.build"&gt;
+	&lt;javadoc packagenames="org.zkoss.*"
+	 destdir="${working.javadoc.dir}"
+	 author="true" protected="true" version="true" use="true"
+	 windowtitle="${project.name} ${project.version} API"
+	 doctitle="${project.name} ${project.version} API"
+	 additionalparam="-breakiterator -source ${source.version}"
+	 bottom="Copyright &amp;amp;copy; 2005-2007 Potix Corporation. All Rights Reserved."&gt;
+		&lt;classpath&gt;
+			&lt;pathelement path="${javadoc.class.path}"/&gt;
+		&lt;/classpath&gt;
+		&lt;packageset dir="${src.dir}"&gt;
+			&lt;include name="org/zkoss/**"/&gt;
+		&lt;/packageset&gt;
+		&lt;fileset dir="${codegen.dir}"&gt;
+			&lt;include name="org/zkoss/**"/&gt;
+			&lt;exclude name="**/*$$*"/&gt;
+		&lt;/fileset&gt;
+	&lt;/javadoc&gt;
+
+	&lt;delete quiet="true" dir="${dist.javadoc.dir}"/&gt;
+	&lt;move todir="${dist.javadoc.dir}"&gt;
+		&lt;fileset dir="${working.javadoc.dir}"/&gt;
+	&lt;/move&gt;
+	&lt;delete quiet="true" dir="${working.javadoc.dir}"/&gt;
+
+	&lt;!-- copy xml and html to the destination since they might be referenced
+		by package.html --&gt;
+	&lt;copy todir="${dist.javadoc.dir}" preservelastmodified="yes"&gt;
+		&lt;fileset dir="${src.dir}"
+		 includes="org/zkoss/**/*.xml, org/zkoss/**/*.html"
+		 excludes="**/package.html" /&gt;
+	&lt;/copy&gt;
+&lt;/target&gt;

Added: addon/releases/zkjsp/1.4.1/build.txt
===================================================================
--- addon/releases/zkjsp/1.4.1/build.txt	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/build.txt	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,125 @@
+build - a tool to build or clean up Java projects
+Copyright (C) 2001-2004 Potix Corporation. All Rights Reserved.
+
+Usage:
+  build [command] [a=b] [project...]
+
+Commands:
+	help           show this message
+	build.debug    build the debug version (default)
+	build.release  build the release version (br: shortcut)
+	clean          clean up both debug and release
+	clean.debug    clean up the debug versin (cd: shortcut)
+	clean.release  clean up the debug versin (cr: shortcut)
+	utest.debug    unit-test the debug version (ud: shortcut)
+	utest.release  unit-test the release version (ur: shortcut)
+	javadoc        generates javadoc (doc: shortcut)
+	verbose        make ant in verbose mode
+	continue       allow unit test to continue even encountering failures
+	unzip          unzip ear/war into the deploy directory (as if unzip=true is specified)
+	a=b            any pair of definitions. It is useful to control unit test.	
+
+Notes:
+	* If no project specified, all projects in targetList are processed.
+	* If no command specified, build.debug is assumed.
+	* All arguments are case-sensitive
+	* Projects cannot be named with any space
+	* noear, verbose and continue, if specified, must be the first
+	  arguments, and the sequence is important.
+
+----------
+Files located under .:
+----------
+build.setting or build.setting.local
+	Controls how to build. build.setting is ignored if build.setting.local
+	exists. build.setting is part of SVN, while buil.setting.local is not.
+	D.ON=true or D.ON=false
+		Controls whether to turn on D.ON
+	javadoc=~/prj/javadoc
+		Specifies where to store Java apidocs.
+	zipjs=true
+		Optional. Default false.
+		Controls whether to compress the JavaScript files.
+		Note: a JavaScript file is compress only if zipjs=true AND
+		it matches zipjs specified in the deploy file
+	unzip=true
+		Optional. Default: false.
+		Controls whether to unzip files when deploying ear/war.
+		The files to unzip are specified in the deploy file (see below)
+		This flag cannot be overriden by specify the unzip command (see above)
+	debug=false
+		Optinal. Default: true if and only if D.ON is true
+		Controls whether to generate debug info.
+	optimize=true
+		Optinal. Default: true if and only if D.ON is false
+		Controls whether to optimize code generation.
+
+MANIFEST.MF (Must)
+	Used if the project doesn't contain MANIFEST.MF
+
+----------
+Files located under the project directory:
+----------
+classpath
+	Secifies the classpath to run ant.
+	NOTE: it must be Unix format, i.e., separated by ':'
+
+version
+	Specifies the version (only first line is used)
+
+format
+	Specifies the resulted archive's format. It must be specified.
+ 	ear
+ 		The result archive is an ear.
+ 	jar
+ 		The result archive is a jar.
+ 		NOTE: Only src/archive/META-INF and src/archive/metainfo is included!
+ 	war
+ 		The result archive is a war.
+ 		NOTE: src/archive/META-INF and src/arhive/metainfo is excluded!
+
+deploy (Optional)
+	Specifies how to deploy the result. If omitted, no deployment occurs.
+ 	lib
+ 		Deploy the result to dist/lib as a shared library.
+ 		They are copied to server's lib if specified in server.libs.
+ 		They are merged to ear if specified in earlib.libs.
+ 	server
+ 		Deploy the result to a server as a bean or web container.
+ 		You must also specify a line:
+ 			app=YourAppName
+
+ 		When deploying to server, you could place an extra line in this file
+ 		if you want	to unzip ear into the deploy directory:
+ 			unzip=true
+ 		or
+ 			unzip=we.jar,we.war
+ 		Notice: this unzip option is enabled only if build.release is targeted
+ 		or unzip=true is found in build.setting.local.
+
+war.libs (Optional)
+	Specifies a list of libraries (one per line) under dist/lib/ext that
+	shall be packed to the result war (format must be war).
+
+server.libs (Optional)
+	Specifies a list of libraries (one per line) under dist/lib and
+	dist/lib/ext that shall be copied to the server's lib directory.
+	Used only deploy: server.
+
+ear.libs (Optional)
+	Specifies A list of libraries (one per line) under dist/lib
+	or dist/lib/ext that shall be packed to the result ear (format must be ear).
+	Used only if format: ear.
+
+import.libs (Optional)
+	Specifies a list of files (one per line) under dist/export that
+	shall be packed to the result war (format must be war).
+	Note: dist/export is generated if a project contains src/export.
+
+cactus.properties (Must if Web-based Unit Test)
+	Specifies the information required by web-based unit test codes.
+
+class.test.local (Optional)
+ 	Specifies a list of classes (one per line) that the unit test must
+ 	test. If no classes specified at all, all classes registered in all
+ 	AllTests.java files are tested.

Added: addon/releases/zkjsp/1.4.1/build.xml
===================================================================
--- addon/releases/zkjsp/1.4.1/build.xml	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/build.xml	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,161 @@
+&lt;?xml version="1.0"?&gt;
+&lt;!DOCTYPE project [
+	&lt;!ENTITY properties SYSTEM "build.prop.xml"&gt;
+	&lt;!ENTITY targets SYSTEM "build.target.xml"&gt;
+]&gt;
+
+&lt;!-- build.xml
+	Purpose:
+		The internal build file for ant.
+	Description:
+		It is invoked by the bash script, build, to do the proper
+		intialization.
+		This build file is used only internally. For SDK to build user's
+		projects, use another file
+	History:
+		March 29 15:11 2001, Created by henrichen
+		August 21 14:27 2002, Created by tomyeh
+
+Copyright (C) 2002 Potix Corporation. All Rights Reserved.
+--&gt;
+
+&lt;project name="potix.inside" default="build" basedir="."&gt;
+	&lt;description&gt;The internal potix build file for ant.&lt;/description&gt;
+&lt;!-- ======= --&gt;
+&lt;!-- INITIAL --&gt;
+&lt;!-- ======= --&gt;
+	&amp;properties;
+
+&lt;!-- ====== --&gt;
+&lt;!-- CONFIG --&gt;
+&lt;!-- ====== --&gt;
+	&lt;target name="verbose" if="verbose.required"&gt;
+	&lt;!-- show the current environment --&gt;
+		&lt;echo message="${project.name}: ${project.version}"/&gt;
+		&lt;echo message=""/&gt;
+
+		&lt;echo message="java.class.path = ${java.class.path}"/&gt;
+		&lt;echo message=""/&gt;
+		&lt;echo message="java.home = ${java.home}"/&gt;
+		&lt;echo message="out.dir = ${out.dir}"/&gt;
+		&lt;echo message="debug = ${debug}"/&gt;
+		&lt;echo message="optimize = ${optimize}"/&gt;
+	&lt;/target&gt;
+
+	&lt;target name="config" depends="verbose"&gt;
+		&lt;!--tstamp/--&gt;
+
+		&lt;available file="${src.mesg.dir}" property="src.mesg.dir.exist"/&gt;
+		&lt;available file="${src.export.dir}" property="src.export.dir.exist"/&gt;
+
+		&lt;available file="${dist.test.dir}" property="dist.test.dir.exist"/&gt;
+
+		&lt;available file="${bin.dir}/CVS" property="bin.CVS.dir.exist"/&gt;
+		&lt;available file="${bin.dir}/.svn" property="bin.svn.dir.exist"/&gt;
+		&lt;available file="${dist.lib.ext.dir}/CVS" property="lib.ext.CVS.dir.exist"/&gt;
+		&lt;available file="${dist.lib.ext.dir}/.svn" property="lib.ext.svn.dir.exist"/&gt;
+
+		&lt;available file="${src.archive.dir}/META-INF/${jad.name}" property="jad.exist"/&gt;
+
+		&lt;condition property="war.dir" value="${src.archive.dir}"&gt;
+			&lt;available file="${src.archive.dir}" type="dir"/&gt;
+		&lt;/condition&gt;
+		&lt;condition property="war.dir" value="WebContent"&gt;
+			&lt;not&gt;
+				&lt;available file="${src.archive.dir}" type="dir"/&gt;
+			&lt;/not&gt;
+		&lt;/condition&gt;
+
+		&lt;condition property="copy.web.jar.required"&gt;
+			&lt;not&gt;
+				&lt;equals arg1="${import.libs}" arg2="nonexist"/&gt;
+			&lt;/not&gt;
+		&lt;/condition&gt;
+
+		&lt;!-- format --&gt;
+		&lt;condition property="build.ear.required"&gt;
+			&lt;equals arg1="${format}" arg2="ear"/&gt;
+		&lt;/condition&gt;
+		&lt;condition property="build.jad.required"&gt;
+			&lt;and&gt;
+				&lt;equals arg1="${format}" arg2="jar"/&gt;
+				&lt;isset property="jad.exist"/&gt;
+			&lt;/and&gt;
+		&lt;/condition&gt;
+		&lt;condition property="build.jar.required"&gt;
+			&lt;and&gt;
+				&lt;equals arg1="${format}" arg2="jar"/&gt;
+				&lt;not&gt;
+					&lt;isset property="jad.exist"/&gt;
+				&lt;/not&gt;
+			&lt;/and&gt;
+		&lt;/condition&gt;
+		&lt;condition property="build.war.required"&gt;
+			&lt;equals arg1="${format}" arg2="war"/&gt;
+		&lt;/condition&gt;
+
+		&lt;condition property="compile.required"&gt;
+			&lt;or&gt;
+				&lt;equals arg1="${format}" arg2="jar"/&gt;
+				&lt;equals arg1="${format}" arg2="war"/&gt;
+			&lt;/or&gt;
+		&lt;/condition&gt;
+
+		&lt;!-- deploy --&gt;
+		&lt;condition property="deploy.lib.required"&gt;
+			&lt;equals arg1="${deploy}" arg2="lib"/&gt;
+		&lt;/condition&gt;
+		&lt;condition property="deploy.server.required"&gt;
+			&lt;equals arg1="${deploy}" arg2="server"/&gt;
+		&lt;/condition&gt;
+
+		&lt;!-- deploy jboss --&gt;
+		&lt;condition property="deploy.jboss.required"&gt;
+			&lt;and&gt;
+				&lt;isset property="deploy.server.required"/&gt;
+				&lt;equals arg1="${format}" arg2="ear"/&gt;
+			&lt;/and&gt;
+		&lt;/condition&gt;
+		&lt;condition property="deploy.jboss.intact.required"&gt;
+			&lt;and&gt;
+				&lt;isset property="deploy.jboss.required"/&gt;
+				&lt;not&gt;
+					&lt;isset property="deploy.unzip.list"/&gt;
+				&lt;/not&gt;
+			&lt;/and&gt;
+		&lt;/condition&gt;
+		&lt;condition property="deploy.jboss.unzip.required"&gt;
+			&lt;and&gt;
+				&lt;isset property="deploy.jboss.required"/&gt;
+				&lt;isset property="deploy.unzip.list"/&gt;
+			&lt;/and&gt;
+		&lt;/condition&gt;
+
+
+		&lt;!-- clean relevant --&gt;
+		&lt;condition property="clean.all.required"&gt;
+			&lt;isset property="do.all"/&gt;
+		&lt;/condition&gt;
+		&lt;condition property="clean.bin.required"&gt;
+			&lt;and&gt;
+				&lt;isset property="do.all"/&gt;
+				&lt;not&gt;
+					&lt;or&gt;
+						&lt;isset property="bin.CVS.dir.exist"/&gt;
+						&lt;isset property="bin.svn.dir.exist"/&gt;
+					&lt;/or&gt;
+				&lt;/not&gt;
+			&lt;/and&gt;
+		&lt;/condition&gt;
+	&lt;/target&gt;
+	&lt;target name="config.build" depends="config"&gt;
+		&lt;mkdir dir="${codegen.dir}"/&gt;
+		&lt;mkdir dir="${dist.export.dir}"/&gt;
+	&lt;/target&gt;
+
+&lt;!-- ======= --&gt;
+&lt;!-- TARGETS --&gt;
+&lt;!-- ======= --&gt;
+	&amp;targets;
+
+&lt;/project&gt;

Added: addon/releases/zkjsp/1.4.1/dist/lib/ckez.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/ckez.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/ext/bsh.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/ext/bsh.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/ext/commons-fileupload.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/ext/commons-fileupload.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/ext/commons-io.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/ext/commons-io.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/ext/jsp-api.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/ext/jsp-api.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/ext/servlet-api.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/ext/servlet-api.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/ext2/el-api.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/ext2/el-api.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/ext2/jsp-api.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/ext2/jsp-api.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/ext2/servlet-api.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/ext2/servlet-api.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/fckez.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/fckez.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/gmapsz.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/gmapsz.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/timelinez.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/timelinez.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/timeplotz.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/timeplotz.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zcommon.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zcommon.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zcommons-el.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zcommons-el.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zhtml.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zhtml.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zk.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zk.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zkex.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zkex.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zkjsp-demo.war
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zkjsp-demo.war
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zkmax.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zkmax.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zkplus.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zkplus.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zml.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zml.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zul.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zul.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zuljsp.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zuljsp.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/dist/lib/zweb.jar
===================================================================
(Binary files differ)


Property changes on: addon/releases/zkjsp/1.4.1/dist/lib/zweb.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: addon/releases/zkjsp/1.4.1/sub-release
===================================================================
--- addon/releases/zkjsp/1.4.1/sub-release	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/sub-release	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,178 @@
+#!/bin/bash
+# sub-release
+#
+#{{IS_NOTE
+#	Purpose:
+#		
+#	Description:
+#		
+#	History:
+#		July 2007, Created by tomyeh
+#}}IS_NOTE
+#
+#Copyright (C) 2007 Potix Corporation. All Rights Reserved.
+#
+#{{IS_RIGHT
+#	This program is distributed under Lesser GPL Version 2.1 in the hope that
+#	it will be useful, but WITHOUT ANY WARRANTY.
+#}}IS_RIGHT
+#
+
+pkgnm=$1
+target=$2
+
+if [ "$pkgnm"  = "JspTags" ] ; then
+	prjnm=zuljsp
+	demoprjnm=zkjsp-demo
+	releasenote=zkjsp-release-note
+elif [ "$pkgnm"  = "Seam" ] ; then
+	prjnm=zkseam
+	demoprjnm=zkseam-demo
+	releasenote=zkseam-release-note
+elif [ "$pkgnm"  = "JSFComps" ] ; then
+	prjnm=zuljsf
+	demoprjnm=zkjsf-demo
+	releasenote=zkjsf-release-note
+elif [ "$pkgnm"  = "Yui-Ext" ] ; then
+	prjnm=yuiextz
+	demoprjnm=yuiextz-demo
+	releasenote=yuiextz-release-note
+else
+	if [ "$pkgnm" != "" ] ; then
+		echo "Unknown package: $pkgnm"
+		echo
+	fi
+	echo "Usage:"
+	echo "  ./sub-release pkgnm [official | daily]"
+	echo
+	echo "pkgnm the package name. It is one of JspTags, JSFComps, Seam, Yui-Ext."
+	exit 1
+fi
+
+if [ -f build.setting.local ] ; then
+	setting=build.setting.local
+else
+	setting=build.setting
+fi
+javadocdir=$(grep '^javadoc' $setting)
+javadocdir=${javadocdir#javadoc=}
+if [ "$javadocdir" = "" ] ; then
+	echo javadoc must be specified in $setting
+	exit 1
+fi
+javadocdir=${javadocdir/\~/$HOME}
+if [ ! -e $javadocdir/$prjnm ] ; then
+	echo "$javadocdir/$prjnm not available"
+	exit 1
+fi
+
+if [ "$target" == "official" ] ; then
+	ver=$(head -1 $prjnm/version)
+	binnm=zk-$pkgnm-bin-$ver
+	srcnm=zk-$pkgnm-src-$ver
+	demonm=zk-$pkgnm-demo-$ver
+elif [ "$target" == "" ] || [ "$target" == "daily" ] ; then
+	target=daily
+
+	ver=$(head -1 $prjnm/version)
+	binnm=zk-$pkgnm-bin-$ver-$(date +%Y-%m-%d)
+	srcnm=zk-$pkgnm-src-$ver-$(date +%Y-%m-%d)
+	demonm=zk-$pkgnm-demo-$ver-$(date +%Y-%m-%d)
+else
+	echo "Usage: release [ official | daily ]"
+	echo Default: daily
+	exit 1
+fi
+
+rm -rf /tmp/zk
+maindir="$(pwd)"
+
+echo "Release $binnm $srcnm $demonm"
+cd $maindir
+mkdir -p /tmp/zk/$binnm/dist/lib
+mkdir -p /tmp/zk/$binnm/dist/src
+mkdir -p /tmp/zk/$binnm/javadoc
+mkdir -p /tmp/zk/$binnm/doc
+
+mkdir -p /tmp/zk/$srcnm/dist/lib
+mkdir -p /tmp/zk/$srcnm/doc
+
+mkdir -p /tmp/zk/$demonm/$demoprjnm/WebContent
+mkdir -p /tmp/zk/$demonm/$demoprjnm/src
+mkdir -p /tmp/zk/$demonm/doc
+
+cp build* /tmp/zk/$srcnm
+cp -rp bin /tmp/zk/$srcnm
+cp -rp $prjnm /tmp/zk/$srcnm
+cp -f dist/lib/$prjnm.jar /tmp/zk/$binnm/dist/lib
+cp zkdoc/COPYING /tmp/zk/$binnm/doc
+cp zkdoc/COPYING /tmp/zk/$srcnm/doc
+cp zkdoc/COPYING /tmp/zk/$demonm/doc
+cp zkdoc/$releasenote /tmp/zk/$binnm/doc/release-note
+cp zkdoc/$releasenote /tmp/zk/$srcnm/doc/release-note
+cp zkdoc/$releasenote /tmp/zk/$demonm/doc/release-note
+
+if [ "$target" = "zuljsp" ] ; then
+	mkdir -p /tmp/zk/$binnm/dist/WEB-INF/tld/jsp/zul
+	cp -rp dist/export/WEB-INF/tld/jsp/zul/* /tmp/zk/$binnm/dist/WEB-INF/tld/jsp/zul
+fi
+
+#prepare source.jar
+cd /tmp/zk/$srcnm
+find -name .svn | xargs rm -rf
+cd $prjnm
+rm -rf codegen debug
+jar cfM $prjnm-sources.jar -C src org
+mv -f $prjnm-sources.jar /tmp/zk/$binnm/dist/src
+
+#prepare javadoc
+cd $javadocdir
+cp -rp $prjnm/* /tmp/zk/$binnm/javadoc
+
+#Copy and pack demo
+cd $HOME/prj/addon/zkjsp/
+
+cp -rp $demoprjnm/WebContent/* /tmp/zk/$demonm/$demoprjnm/WebContent
+cp -rp $demoprjnm/src/* /tmp/zk/$demonm/$demoprjnm/src
+cp -rp $demoprjnm/.project $demoprjnm/.classpath $demoprjnm/.settings /tmp/zk/$demonm/$demoprjnm/
+cp dist/lib/$demoprjnm.war /tmp/zk/$demonm/$demoprjnm
+
+cd /tmp/zk/$demonm/$demoprjnm
+find -name .svn | xargs rm -rf
+cd /tmp/zk
+echo Output ${demonm}.zip
+zip -qr9 ${demonm}.zip $demonm
+rm -rf $demonm
+
+#pack bin
+
+cd /tmp/zk
+echo Output ${binnm}.zip
+zip -qr9 ${binnm}.zip $binnm
+
+if [ "$target" == "official" ] ; then
+	#Prepare maven repository
+	function mvnrepo {
+		echo "Create $1-$ver-bundle.jar"
+		mkdir -p $1
+		mv /tmp/zk/$binnm/dist/src/$1-sources.jar $1/$1-$ver-sources.jar
+		sed -e "s/{version}/$ver/" $maindir/$1/pom.xml &gt; $1/pom.xml
+		cp $maindir/dist/lib/$1.jar $1/$1-$ver.jar
+		jar cfM $1-$ver-bundle.jar -C $1 .
+	}
+	mkdir -p maven
+	mkdir -p /tmp/maven
+	cd maven
+	mvnrepo $prjnm
+	mv *-bundle.jar /tmp/maven
+	cd ..
+	rm -rf maven
+fi
+cd /tmp/zk
+rm -rf $binnm
+
+#pack src
+cd /tmp/zk
+echo "Output ${pwd}${srcnm}.zip"
+zip -qr9 ${srcnm}.zip $srcnm
+rm -rf $srcnm
\ No newline at end of file

Added: addon/releases/zkjsp/1.4.1/tool/src/tool/ComponentMap.java
===================================================================
--- addon/releases/zkjsp/1.4.1/tool/src/tool/ComponentMap.java	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/tool/src/tool/ComponentMap.java	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,107 @@
+/* ComponentMap.java
+
+{{IS_NOTE
+	Purpose:
+		
+	Description:
+		
+	History:
+		Nov 21, 2008 4:21:28 PM 2007, Created by Flyworld
+}}IS_NOTE
+
+Copyright (C) 2008 Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+	This program is distributed under GPL Version 2.0 in the hope that
+	it will be useful, but WITHOUT ANY WARRANTY.
+}}IS_RIGHT
+ */
+package tool;
+
+import java.util.ArrayList;
+import java.util.Collections;
+import java.util.HashMap;
+import java.util.LinkedList;
+import java.util.List;
+import java.util.Map;
+import org.zkoss.zk.ui.metainfo.ComponentDefinition;
+import org.zkoss.zk.ui.metainfo.ComponentDefinitionMap;
+import org.zkoss.zk.ui.metainfo.LanguageDefinition;
+
+public class ComponentMap {
+	Map&lt;String, ArrayList&gt; varMap;
+	int _size = -1;
+
+	public ComponentMap() {
+		varMap = new HashMap&lt;String, ArrayList&gt;();
+	}
+
+	public void setLanguageDefinition(LanguageDefinition ld) {
+		ComponentDefinitionMap map = ld.getComponentDefinitionMap();
+		ArrayList al = new ArrayList&lt;String&gt;();
+		al.addAll(map.getNames());
+		ComponentMap cmpMap = new ComponentMap();
+		_size = al.size();
+		for (int i = 0; i &lt; al.size(); i++) {
+			ComponentDefinition cmpdefi = ld.getComponentDefinition(al.get(i)
+					.toString());
+			Class cls = (Class) cmpdefi.getImplementationClass();
+			this.addValue(cls.getPackage().getName(), al.get(i).toString());
+		}
+	}
+
+	private void addValue(String packageName, String className) {
+		if (varMap.containsKey(packageName)) {
+			ArrayList tempArrayList = varMap.get(packageName);
+			varMap.remove(packageName);
+			tempArrayList.add(className);
+			varMap.put(packageName, tempArrayList);
+		} else {
+			ArrayList tempArrayList = new ArrayList();
+			tempArrayList.add(className);
+			varMap.put(packageName, tempArrayList);
+		}
+	}
+
+	public int getMapSize() {
+		return _size;
+	}
+
+	public Object[] getMapKeysObj() {
+		return getMapKeys();
+	}
+
+	public Object[] getMapValuesObj() {
+		return varMap.values().toArray();
+	}
+
+	/**
+	 * get sorted map keys
+	 * */
+	public String[] getMapKeys() {
+		String[] allKeys = (String[]) varMap.keySet().toArray(new String[] {});
+		ArrayList alst = new ArrayList();
+		for (String key : allKeys) {
+			alst.add(key);
+		}
+		Collections.sort(alst);
+		return (String[]) alst.toArray(new String[] {});
+	}
+
+	/**
+	 * get sorted map values with sorted keys
+	 * */
+	public Object[][] getMapVales() {
+		String[] allKeys = getMapKeys();
+		List&lt;String[]&gt; lst = new LinkedList&lt;String[]&gt;();
+
+		for (String key : allKeys) {
+			ArrayList al = varMap.get(key);
+			Collections.sort(al);
+			String[] temp = (String[]) al.toArray(new String[] {});
+			lst.add(temp);
+		}
+		return lst.toArray(new String[][] {});
+
+	}
+}

Added: addon/releases/zkjsp/1.4.1/tool/src/tool/PreProcessor.java
===================================================================
--- addon/releases/zkjsp/1.4.1/tool/src/tool/PreProcessor.java	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/tool/src/tool/PreProcessor.java	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,103 @@
+/* PreProcessor.java
+
+{{IS_NOTE
+	Purpose:
+		
+	Description:
+		
+	History:
+		Jul 26, 2007 3:45:58 PM 2007, Created by Ian Tsai
+}}IS_NOTE
+
+Copyright (C) 2007 Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+	This program is distributed under GPL Version 2.0 in the hope that
+	it will be useful, but WITHOUT ANY WARRANTY.
+}}IS_RIGHT
+ */
+package tool;
+
+import java.io.PrintStream;
+import java.util.*;
+
+/**
+ * @author ian
+ * 
+ */
+public class PreProcessor {
+
+	private String prefix;
+	private String postfix;
+	private Map&lt;String, String&gt; varMap;
+
+	/**
+	 * 
+	 * @param prefix
+	 * @param postfix
+	 */
+	public PreProcessor(String prefix, String postfix) {
+		super();
+		this.prefix = prefix;
+		this.postfix = postfix;
+		varMap = new HashMap&lt;String, String&gt;(5);
+	}
+
+	/**
+	 * 
+	 * @param key
+	 * @param value
+	 */
+	public void setVariable(String key, String value) {
+		varMap.put(key, value);
+	}
+
+	/**
+	 * 
+	 * @param arg
+	 * @return
+	 */
+	public void preProcess(PrintStream st, String arg) {
+		StringBuffer out = new StringBuffer("");
+		String key, value;
+		for (int i = 0, j = 0, k = 0; i &lt; arg.length();) {
+
+			j = arg.indexOf(prefix, i);
+			if (j &gt;= 0) {
+				out.append(arg.substring(i, j));
+				k = arg.indexOf(postfix, j);
+				if (k &lt; 0)
+					System.out.print("How could this happend? k=" + k + " i="
+							+ i + " j=" + j + " Arg=" + arg);
+				key = arg.substring(j + prefix.length(), k);
+				if (key.startsWith("!"))
+					out.append(varMap.get(key.substring(1)).toLowerCase());
+				else
+					out.append(varMap.get(key));
+
+				i = k + postfix.length();
+			} else {
+				out.append(arg.substring(i));
+				break;
+			}
+		}
+		st.println(out.toString());
+	}
+
+	public String getPostfix() {
+		return postfix;
+	}
+
+	public String getPrefix() {
+		return prefix;
+	}
+
+	public Map&lt;String, String&gt; getVarMap() {
+		return varMap;
+	}
+
+	public void setVarMap(Map&lt;String, String&gt; varMap) {
+		this.varMap = varMap;
+	}
+
+}// end of class

Added: addon/releases/zkjsp/1.4.1/tool/src/tool/ZulJspGenerator.java
===================================================================
--- addon/releases/zkjsp/1.4.1/tool/src/tool/ZulJspGenerator.java	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/tool/src/tool/ZulJspGenerator.java	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,227 @@
+/* ZulJspGenerator.java
+
+{{IS_NOTE
+	Purpose:
+		
+	Description:
+		
+	History:
+		Jul 26, 2007 2:34:20 PM 2007, Created by Ian Tsai 
+		Nov 21, 2008 4:32:21 PM 2008, Modified by Flyworld
+}}IS_NOTE
+
+Copyright (C) 2008 Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+	This program is distributed under GPL Version 2.0 in the hope that
+	it will be useful, but WITHOUT ANY WARRANTY.
+}}IS_RIGHT
+ */
+package tool;
+
+import java.io.BufferedReader;
+import java.io.File;
+import java.io.FileNotFoundException;
+import java.io.FileReader;
+import java.io.IOException;
+import java.io.PrintStream;
+import java.text.SimpleDateFormat;
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.LinkedList;
+import java.util.List;
+
+/**
+ * @author ian
+ * 
+ */
+public class ZulJspGenerator {
+	String _respositoryPath = "";
+	String _author = "Flyworld"; // Default User
+	String _package = "org.zkoss.jsp.zul"; // Default zkjsp package
+	boolean _genTld = true;
+	boolean _genJava = true;
+	boolean _override = false;
+
+	public ZulJspGenerator(String respositoryPath) {
+		_respositoryPath = respositoryPath;
+	}
+
+	public ZulJspGenerator(String respositoryPath, boolean genTld,
+			boolean genJava, boolean override, String author) {
+
+		_respositoryPath = respositoryPath;
+		_genTld = genTld;
+		_genJava = genJava;
+		_override = override;
+		_author = author;
+	}
+
+	public boolean generate(ComponentMap cmpMap) {
+
+		SimpleDateFormat form = new SimpleDateFormat("yyyy/MM/dd  HH:mm:ss ");
+		SimpleDateFormat form2 = new SimpleDateFormat("yyyy");
+
+		String svnPath = _respositoryPath
+				+ "zuljsp\\src\\org\\zkoss\\jsp\\zul\\";
+		String outTld = _respositoryPath
+				+ "zuljsp\\src2\\archive\\META-INF\\zuljsp.tld";
+		String templatePath = _respositoryPath + "tool\\templete\\";
+		String[][] values = (String[][]) cmpMap.getMapVales();
+		String[] keys = (String[]) cmpMap.getMapKeys();
+		List&lt;String[]&gt; lst = new LinkedList&lt;String[]&gt;();
+		for (int i = 0; i &lt; values.length; i++) {
+			ArrayList&lt;String&gt; temp = new ArrayList&lt;String&gt;();
+			temp.add(keys[i]);
+			for (String value : values[i]) {
+				temp.add(value);
+			}
+			lst.add((String[]) temp.toArray(new String[] {}));
+		}
+		String[][] zulClasses = (String[][]) lst.toArray(new String[][] {});
+
+		/**
+		 * These are templete
+		 * */
+		String tempTagJava = templatePath + "TempleteTag.java";
+		String tagContentTld = templatePath + "tagContent.tld";
+		String templateTld = templatePath + "template.tld";
+
+		final PreProcessor pro = new PreProcessor("${", "}");
+		/**
+		 *
+		 */
+		pro.setVariable("datetime", form.format(new Date()));
+		pro.setVariable("year", form2.format(new Date()));
+		pro.setVariable("package", _package);
+		pro.setVariable("author", _author);
+
+		try {
+			List&lt;String&gt; javaTagPattern = loadTxtFile(tempTagJava);
+			List&lt;String&gt; tagTldPattern = loadTxtFile(tagContentTld);
+			List&lt;String&gt; tldPattern = loadTxtFile(templateTld);
+
+			PrintStream tldPrint = null;
+			int index = 0;
+			if (_genTld)// tld Header...
+			{
+				tldPrint = createPrinter(outTld);
+				String temp;
+				for (; index &lt; tldPattern.size(); index++)
+					if ((temp = tldPattern.get(index)).indexOf("#{}") &lt; 0)
+						pro.preProcess(tldPrint, temp);
+					else
+						break;
+				index++;
+			}
+
+			for (String[] loading : zulClasses) {
+				for (int i = 1; i &lt; loading.length; i++) {
+					String clazz = loading[i].substring(0, 1).toUpperCase()
+							+ loading[i].substring(1);
+					// Because the "FCKeditor"
+					clazz = clazz.equals("Fckeditor") ? "FCKeditor" : clazz;
+					System.out.println("Generating Class : " + clazz);
+					pro.setVariable("class", clazz);
+					pro.setVariable("importclass", loading[0] + "." + clazz);
+					pro.setVariable("filename", clazz + "Tag.java");
+					if (_genJava)
+						generateTagJavaFile(pro, clazz, svnPath,
+								javaTagPattern, _override);
+
+					// tld body...
+					if (_genTld)
+						for (String tag : tagTldPattern)
+							pro.preProcess(tldPrint, tag);
+				}
+			}
+			// tld footer...
+			if (_genTld) {
+				for (; index &lt; tldPattern.size(); index++)
+					pro.preProcess(tldPrint, tldPattern.get(index));
+				tldPrint.close();
+			}
+
+		} catch (FileNotFoundException e) {
+			e.printStackTrace();
+			return false;
+		} catch (IOException e) {
+			e.printStackTrace();
+			return false;
+		}
+		return true;
+
+	}
+
+	public void setAutor(String author) {
+		_author = author;
+	}
+
+	public String getAutor() {
+		return _author;
+	}
+
+	/**
+	 * 
+	 * @param path
+	 * @return
+	 * @throws IOException
+	 */
+	private static List&lt;String&gt; loadTxtFile(String path) throws IOException {
+		List&lt;String&gt; ansList = new LinkedList&lt;String&gt;();
+
+		BufferedReader re = new BufferedReader(new FileReader(path));
+		String line = null;
+		while ((line = re.readLine()) != null)
+			ansList.add(line);
+		return ansList;
+	}
+
+	/**
+	 * 
+	 * @param pro
+	 * @param className
+	 * @param outPath
+	 * @param pattern
+	 * @param _override
+	 * @return
+	 * @throws IOException
+	 */
+	private static boolean generateTagJavaFile(PreProcessor pro,
+			String className, String outPath, List&lt;String&gt; pattern,
+			boolean _override) throws IOException {
+		// output works...
+		String oFile = outPath + className + "Tag.java";
+		if (!_override &amp;&amp; (new File(oFile)).exists()) {
+			System.out.println("[Warning] : " + oFile
+					+ " is existed ! nothing generated.");
+			return false;
+		} else if ((new File(oFile)).exists()) {
+			System.out.print("[Override] ");
+		}
+		PrintStream print = createPrinter(oFile);
+		for (String str : pattern)
+			pro.preProcess(print, str);
+		print.close();
+		System.out.println(oFile + " : is created.");
+		return true;
+	}
+
+	/**
+	 * 
+	 * @param filepath
+	 * @return
+	 * @throws IOException
+	 */
+	private static PrintStream createPrinter(String filepath)
+			throws IOException {
+		File file = new File(filepath);
+		if (file.exists())
+			file.delete();
+		if (!file.createNewFile())
+			throw new IOException("file Create Faild:" + filepath);
+		// output works...
+		return new PrintStream(file);
+	}
+
+}// end of class

Added: addon/releases/zkjsp/1.4.1/tool/templete/TempleteTag.java
===================================================================
--- addon/releases/zkjsp/1.4.1/tool/templete/TempleteTag.java	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/tool/templete/TempleteTag.java	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,38 @@
+/* ${filename}
+
+{{IS_NOTE
+	Purpose:
+		
+	Description:
+		
+	History:
+	${datetime}, auto generated by ${author}
+}}IS_NOTE
+
+Copyright (C) ${year} Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+	This program is distributed under GPL Version 2.0 in the hope that
+	it will be useful, but WITHOUT ANY WARRANTY.
+}}IS_RIGHT
+*/
+package ${package};
+
+import ${importclass};
+import ${package}.impl.BranchTag;
+
+/**
+ * The JSP tag to represent "${class}" component in ZK's component definition.
+ * @author ${author}
+ *
+ */
+public class ${class}Tag extends BranchTag {
+	/**
+	 * 
+	 * @return The name of the component from the ZK Component Definition: "${!class}".
+	 */
+	protected String getComponentName(){
+		return "${!class}";
+	}
+
+}

Added: addon/releases/zkjsp/1.4.1/tool/templete/tagContent.tld
===================================================================
--- addon/releases/zkjsp/1.4.1/tool/templete/tagContent.tld	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/tool/templete/tagContent.tld	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,43 @@
+	&lt;!-- ZK XUL ${class} Components --&gt;
+	&lt;tag&gt;
+		&lt;description&gt;
+	Define the ${class} comonent.
+		&lt;/description&gt;
+		&lt;name&gt;${!class}&lt;/name&gt;
+		&lt;tag-class&gt;${package}.${class}Tag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;dynamic-attributes&gt;true&lt;/dynamic-attributes&gt; 
+		&lt;attribute&gt;
+			&lt;description&gt;
+	If false, this tag is ignored. Default: true.
+			&lt;/description&gt;
+			&lt;name&gt;if&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	If true, this tag is ignored. Default: false.
+			&lt;/description&gt;
+			&lt;name&gt;unless&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	Default : Zul Component ${class}.
+			&lt;/description&gt;
+			&lt;name&gt;use&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	Used to forward Event, same as ZUL's forward.
+			&lt;/description&gt;
+			&lt;name&gt;forward&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		
+	&lt;/tag&gt;
\ No newline at end of file

Added: addon/releases/zkjsp/1.4.1/tool/templete/template.tld
===================================================================
--- addon/releases/zkjsp/1.4.1/tool/templete/template.tld	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/tool/templete/template.tld	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,305 @@
+&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
+
+&lt;!--
+Purpose:
+	The JSP Tags for ZK XUL Components
+Description:
+	
+Histroy:
+	Original created by tomyeh modified by Ian Tsai
+	${datetime},  generated by ${author}
+
+Copyright (C) ${year} Potix Corporation. All Rights Reserved.
+--&gt;
+
+&lt;taglib xmlns="<a href="http://java.sun.com/xml/ns/j2ee" target="_new">http://java.sun.com/xml/ns/j2ee</a>"
+    xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+    xmlns:zk="<a href="http://www.zkoss.org/" target="_new">http://www.zkoss.org/</a>"
+    xsi:schemaLocation="<a href="http://java.sun.com/xml/ns/j2ee" target="_new">http://java.sun.com/xml/ns/j2ee</a> web-jsptaglibrary_2_0.xsd"
+    version="2.0"&gt;
+
+	&lt;tlib-version&gt;1.2&lt;/tlib-version&gt;
+	&lt;jsp-version&gt;2.0&lt;/jsp-version&gt;
+	&lt;short-name&gt;zuljsp&lt;/short-name&gt;
+	&lt;uri&gt;<a href="http://www.zkoss.org/jsp/zul&lt;/uri" target="_new">http://www.zkoss.org/jsp/zul&lt;/uri</a>&gt;
+	&lt;description&gt;
+	The JSP Tags for ZK XUL COmponents
+	&lt;/description&gt;
+
+	&lt;!-- General Purpose --&gt;
+	&lt;tag&gt;&lt;!--***** PageTag  *****--&gt;
+		&lt;description&gt;
+	Define a page in a JSP tag.
+	It is responsible for handling the lifecycle for all nested ZK
+	components.
+		&lt;/description&gt;
+		&lt;name&gt;page&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.PageTag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	The id of this page, Autogenerated if is null.
+			&lt;/description&gt;
+			&lt;name&gt;id&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	The CSS style. Default: null (none).
+			&lt;/description&gt;
+			&lt;name&gt;style&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	The default script language. Default: Java.
+			&lt;/description&gt;
+			&lt;name&gt;zscriptLanguage&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	It specifies whether the client can cache the output.
+			&lt;/description&gt;
+			&lt;name&gt;cacheable&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+Specifies the markup language for this page. 
+The markup language determines the default component set. 
+Currently, it supports xul/html and xhtml.
+			&lt;/description&gt;
+			&lt;name&gt;language&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	If false, this tag is ignored. Default: true.
+			&lt;/description&gt;
+			&lt;name&gt;if&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	If true, this tag is ignored. Default: false.
+			&lt;/description&gt;
+			&lt;name&gt;unless&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+	&lt;/tag&gt;
+	&lt;tag&gt;&lt;!--***** ZScriptTag  *****--&gt;
+		&lt;description&gt;
+	Define Zscript Tag, let user can declaire zscript fragment.
+		&lt;/description&gt;
+		&lt;name&gt;zscript&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.ZScriptTag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	Always true in current.
+			&lt;/description&gt;
+			&lt;name&gt;deferred&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		If true, this tag is ignored. Default: false.
+			&lt;/description&gt;
+			&lt;name&gt;language&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		Load ZScript content from target URL.
+			&lt;/description&gt;
+			&lt;name&gt;src&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+	&lt;/tag&gt;
+	&lt;tag&gt;&lt;!--***** AttributeTag  *****--&gt;
+		&lt;description&gt;
+	Define Attribute Tag.
+		&lt;/description&gt;
+		&lt;name&gt;attribute&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.AttributeTag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		Attribute Name.
+			&lt;/description&gt;
+			&lt;name&gt;name&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		Trim the content?
+			&lt;/description&gt;
+			&lt;name&gt;trim&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+	&lt;/tag&gt;
+	&lt;tag&gt;&lt;!--***** Custom-AttributesTag  *****--&gt;
+		&lt;description&gt;
+	Define Custom-AttributesTag.
+		&lt;/description&gt;
+		&lt;name&gt;custom-attributes&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.CustomAttributesTag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;dynamic-attributes&gt;true&lt;/dynamic-attributes&gt; 
+	&lt;/tag&gt;
+	&lt;tag&gt;&lt;!--***** VariablesTag  *****--&gt;
+		&lt;description&gt;
+	Define VariablesTag.
+		&lt;/description&gt;
+		&lt;name&gt;variables&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.VariablesTag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;dynamic-attributes&gt;true&lt;/dynamic-attributes&gt; 
+	&lt;/tag&gt;
+	&lt;tag&gt;&lt;!--***** Component Definition Tag  *****--&gt;
+		&lt;description&gt;
+	Define Macro Definition Tag.
+		&lt;/description&gt;
+		&lt;name&gt;component&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.ComponentDefinitionTag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;dynamic-attributes&gt;true&lt;/dynamic-attributes&gt; 
+		&lt;attribute&gt;
+			&lt;description&gt;
+		component delaration Name.
+			&lt;/description&gt;
+			&lt;name&gt;name&lt;/name&gt;
+			&lt;required&gt;true&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		extends component class.
+			&lt;/description&gt;
+			&lt;name&gt;extends&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		if this component is inline component.
+			&lt;/description&gt;
+			&lt;name&gt;inline&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		the destination of zul file.
+			&lt;/description&gt;
+			&lt;name&gt;macroURI&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		component delaration MoldURI.
+			&lt;/description&gt;
+			&lt;name&gt;moldURI&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		component mold Name.
+			&lt;/description&gt;
+			&lt;name&gt;moldName&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+	&lt;/tag&gt;
+	&lt;tag&gt;&lt;!--***** UI Component Tag  *****--&gt;
+		&lt;description&gt;
+	Define a UI Tag.
+		&lt;/description&gt;
+		&lt;name&gt;ui&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.impl.UiTag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;dynamic-attributes&gt;true&lt;/dynamic-attributes&gt; 
+		&lt;attribute&gt;
+			&lt;description&gt;
+		component delaration Name.
+			&lt;/description&gt;
+			&lt;name&gt;tag&lt;/name&gt;
+			&lt;required&gt;true&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+	Default : Zul Component use property.
+			&lt;/description&gt;
+			&lt;name&gt;use&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+	&lt;/tag&gt;
+	&lt;tag&gt;&lt;!--***** InitTag  *****--&gt;
+		&lt;description&gt;
+	Define Init Tag.
+		&lt;/description&gt;
+		&lt;name&gt;init&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.InitTag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;dynamic-attributes&gt;true&lt;/dynamic-attributes&gt; 
+		&lt;attribute&gt;
+			&lt;description&gt;
+		Attribute Name.
+			&lt;/description&gt;
+			&lt;name&gt;use&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+		&lt;attribute&gt;
+			&lt;description&gt;
+		zscript files.
+			&lt;/description&gt;
+			&lt;name&gt;zscript&lt;/name&gt;
+			&lt;required&gt;false&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+	&lt;/tag&gt;
+	&lt;tag&gt;&lt;!--***** VariableResolverTag  *****--&gt;
+		&lt;description&gt;
+	Define Variable Resolver Tag.
+		&lt;/description&gt;
+		&lt;name&gt;variable-resolver&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.VariableResolverTag&lt;/tag-class&gt;
+		&lt;body-content&gt;scriptless&lt;/body-content&gt;
+		&lt;dynamic-attributes&gt;true&lt;/dynamic-attributes&gt; 
+		&lt;attribute&gt;
+			&lt;description&gt;
+		Attribute Name.
+			&lt;/description&gt;
+			&lt;name&gt;use&lt;/name&gt;
+			&lt;required&gt;true&lt;/required&gt;
+			&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;
+		&lt;/attribute&gt;
+	&lt;/tag&gt;
+	&lt;tag&gt;&lt;!--***** ZkheadTag  *****--&gt;
+		&lt;description&gt;Define zkhead Tag&lt;/description&gt;
+		&lt;name&gt;zkhead&lt;/name&gt;
+		&lt;tag-class&gt;org.zkoss.jsp.zul.ZkheadTag&lt;/tag-class&gt;
+		&lt;body-content&gt;none&lt;/body-content&gt;
+	&lt;/tag&gt;
+	&lt;!-- ZK XUL Components --&gt;
+	#{}
+	&lt;!-- Functions --&gt;
+&lt;/taglib&gt;

Added: addon/releases/zkjsp/1.4.1/zkdoc/COPYING
===================================================================
--- addon/releases/zkjsp/1.4.1/zkdoc/COPYING	                        (rev 0)
+++ addon/releases/zkjsp/1.4.1/zkdoc/COPYING	2010-09-08 10:31:09 UTC (rev 14270)
@@ -0,0 +1,347 @@
+
+ Note that the GPL below is copyrighted by the Free Software Foundation,
+ but the instance of code that it refers to (ZK) is copyrighted
+ by Potix Corporation.
+
+----------------------------------------
+
+		    GNU GENERAL PUBLIC LICENSE
+		       Version 2, June 1991
+
+ Copyright (C) 1989, 1991 Free Software Foundation, Inc.
+                       59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+			    Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+License is intended to guarantee your freedom to share and change free
+software--to make sure the software is free for all its users.  This
+General Public License applies to most of the Free Software
+Foundation's software and to any other program whose authors commit to
+using it.  (Some other Free Software Foundation software is covered by
+the GNU Library General Public License instead.)  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+this service if you wish), that you receive source code or can get it
+if you want it, that you can change the software or use pieces of it
+in new free programs; and that you know you can do these things.
+
+  To protect your rights, we need to make restrictions that forbid
+anyone to deny you these rights or to ask you to surrender the rights.
+These restrictions translate to certain responsibilities for you if you
+distribute copies of the software, or if you modify it.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must give the recipients all the rights that
+you have.  You must make sure that they, too, receive or can get the
+source code.  And you must show them these terms so they know their
+rights.
+
+  We protect your rights with two steps: (1) copyright the software, and
+(2) offer you this license which gives you legal permission to copy,
+distribute and/or modify the software.
+
+  Also, for each author's protection and ours, we want to make certain
+that everyone understands that there is no warranty for this free
+software.  If the software is modified by someone else and passed on, we
+want its recipients to know that what they have is not the original, so
+that any problems introduced by others will not reflect on the original
+authors' reputations.
+
+  Finally, any free program is threatened constantly by software
+patents.  We wish to avoid the danger that redistributors of a free
+program will individually obtain patent licenses, in effect making the
+program proprietary.  To prevent this, we have made it clear that any
+patent must be licensed for everyone's free use or not licensed at all.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+		    GNU GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License applies to any program or other work which contains
+a notice placed by the copyright holder saying it may be distributed
+under the terms of this General Public License.  The "Program", below,
+refers to any such program or work, and a "work based on the Program"
+means either the Program or any derivative work under copyright law:
+that is to say, a work containing the Program or a portion of it,
+either verbatim or with modifications and/or translated into another
+language.  (Hereinafter, translation is included without limitation in
+the term "modification".)  Each licensee is addressed as "you".
+
+Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running the Program is not restricted, and the output from the Program
+is covered only if its contents constitute a work based on the
+Program (independent of having been made by running the Program).
+Whether that is true depends on what the Program does.
+
+  1. You may copy and distribute verbatim copies of the Program's
+source code as you receive it, in any medium, provided that you
+conspicuously and appropriately publish on each copy an appropriate
+copyright notice and disclaimer of warranty; keep intact all the
+notices that refer to this License and to the absence of any warranty;
+and give any other recipients of the Program a copy of this License
+along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and
+you may at your option offer warranty protection in exchange for a fee.
+
+  2. You may modify your copy or copies of the Program or any portion
+of it, thus forming a work based on the Program, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) You must cause the modified files to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    b) You must cause any work that you distribute or publish, that in
+    whole or in part contains or is derived from the Program or any

@@ Diff output truncated at 100000 characters. @@

This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
<ul>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26134616">[zk1-subversion-log] SF.net SVN: zk1:[14272] branches</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-10 05:39</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14272
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14272&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14272&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-10 05:39:26 +0000 (Fri, 10 Sep 2010)

Log Message:
-----------
Fri 09/10/2010

Modified Paths:
--------------
    branches/5.0/zcommon/src/org/zkoss/util/logging/LogService.java
    branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
    branches/5.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp
    branches/6.0/zcommon/src/org/zkoss/html/HTMLs.java
    branches/6.0/zcommon/src/org/zkoss/idom/Attributable.java
    branches/6.0/zcommon/src/org/zkoss/idom/Attribute.java
    branches/6.0/zcommon/src/org/zkoss/idom/Binary.java
    branches/6.0/zcommon/src/org/zkoss/idom/DocType.java
    branches/6.0/zcommon/src/org/zkoss/idom/Document.java
    branches/6.0/zcommon/src/org/zkoss/idom/Element.java
    branches/6.0/zcommon/src/org/zkoss/idom/EntityReference.java
    branches/6.0/zcommon/src/org/zkoss/idom/Group.java
    branches/6.0/zcommon/src/org/zkoss/idom/Item.java
    branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java
    branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractGroup.java
    branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractItem.java
    branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractTextual.java
    branches/6.0/zcommon/src/org/zkoss/idom/input/SAXHandler.java
    branches/6.0/zcommon/src/org/zkoss/idom/util/IDOMs.java
    branches/6.0/zcommon/src/org/zkoss/image/encoder/ImageEncoders.java
    branches/6.0/zcommon/src/org/zkoss/io/Serializables.java
    branches/6.0/zcommon/src/org/zkoss/json/parser/JSONParser.java
    branches/6.0/zcommon/src/org/zkoss/lang/Classes.java
    branches/6.0/zcommon/src/org/zkoss/lang/Comparables.java
    branches/6.0/zcommon/src/org/zkoss/lang/Library.java
    branches/6.0/zcommon/src/org/zkoss/lang/Objects.java
    branches/6.0/zcommon/src/org/zkoss/lang/Primitives.java
    branches/6.0/zcommon/src/org/zkoss/lang/reflect/Fields.java
    branches/6.0/zcommon/src/org/zkoss/lang/reflect/FusionInvoker.java
    branches/6.0/zcommon/src/org/zkoss/lang/reflect/SerializableMethod.java
    branches/6.0/zcommon/src/org/zkoss/mesg/MessageConst.java
    branches/6.0/zcommon/src/org/zkoss/text/DateFormats.java
    branches/6.0/zcommon/src/org/zkoss/text/MessageFormats.java
    branches/6.0/zcommon/src/org/zkoss/util/ArraysX.java
    branches/6.0/zcommon/src/org/zkoss/util/Cache.java
    branches/6.0/zcommon/src/org/zkoss/util/CacheMap.java
    branches/6.0/zcommon/src/org/zkoss/util/Cleanups.java
    branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
    branches/6.0/zcommon/src/org/zkoss/util/DualCollection.java
    branches/6.0/zcommon/src/org/zkoss/util/FastReadArray.java
    branches/6.0/zcommon/src/org/zkoss/util/IdentityComparator.java
    branches/6.0/zcommon/src/org/zkoss/util/IdentityHashSet.java
    branches/6.0/zcommon/src/org/zkoss/util/Locales.java
    branches/6.0/zcommon/src/org/zkoss/util/Maps.java
    branches/6.0/zcommon/src/org/zkoss/util/MultiCache.java
    branches/6.0/zcommon/src/org/zkoss/util/ThreadLocalCache.java
    branches/6.0/zcommon/src/org/zkoss/util/TimeZones.java
    branches/6.0/zcommon/src/org/zkoss/util/Utils.java
    branches/6.0/zcommon/src/org/zkoss/util/logging/LogService.java
    branches/6.0/zcommon/src/org/zkoss/util/media/ContentTypes.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/ClassLocator.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/PropertyBundle.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/ResourceCache.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/impl/LabelLoader.java
    branches/6.0/zcommon/src/org/zkoss/xel/Expressions.java
    branches/6.0/zcommon/src/org/zkoss/xel/FunctionMapper.java
    branches/6.0/zcommon/src/org/zkoss/xel/taglib/Taglibs.java
    branches/6.0/zcommon/src/org/zkoss/xel/util/DualFunctionMapper.java
    branches/6.0/zcommon/src/org/zkoss/xel/util/Evaluators.java
    branches/6.0/zcommon/src/org/zkoss/xel/util/SimpleMapper.java
    branches/6.0/zcommon/src/org/zkoss/xel/util/SimpleXelContext.java
    branches/6.0/zcommon/src/org/zkoss/xel/util/TaglibMapper.java
    branches/6.0/zkdoc/release-note

Added Paths:
-----------
    branches/6.0/zcommon/src/org/zkoss/util/NotableLinkedList.java

Modified: branches/5.0/zcommon/src/org/zkoss/util/logging/LogService.java
===================================================================
--- branches/5.0/zcommon/src/org/zkoss/util/logging/LogService.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/5.0/zcommon/src/org/zkoss/util/logging/LogService.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -71,8 +71,12 @@
 	 * {@link #init} is invoked.
 	 */
 	public static final boolean isInited(String rootnm) {
+		final Logger root = Logger.getLogger(rootnm);
+			//Tomcat has one root per Web app, while Logger.global is shared
+			//Thus we have to use getLogger to verify whether it is installed
+
 		synchronized (_svcs) {
-			return _svcs.containsKey(rootnm);
+			return _svcs.containsKey(root);
 		}
 	}
 

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -628,8 +628,8 @@
 	/** Removes a mergeable JavaScript package required by this language.
 	 * @since 5.0.4
 	 */
-	public void removeMergeJavaScriptPackage(String pkg) {
-		_mergepkgs.remove(pkg);
+	public boolean removeMergeJavaScriptPackage(String pkg) {
+		return _mergepkgs.remove(pkg);
 	}
 	/** Returns a list of mergeable JavaScript package (String)
 	 * required by this language.

Modified: branches/5.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/5.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp	2010-09-10 05:39:26 UTC (rev 14272)
@@ -62,7 +62,12 @@
 	border-right: 6px solid #D9DADA;
 }
 .z-calendar-disd {
+	&lt;c:if test="${not c:isGecko3()}"&gt;
 	opacity: .6;
+	&lt;/c:if&gt;
+	&lt;c:if test="${c:isGecko3()}"&gt; &lt;%-- Firefox 3 bug --%&gt;
+		color: rgba (170, 170, 170, 0.6);
+	&lt;/c:if&gt;
 	filter: alpha(opacity=60);
 }
 .z-calendar-disd,

Modified: branches/6.0/zcommon/src/org/zkoss/html/HTMLs.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/html/HTMLs.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/html/HTMLs.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -176,12 +176,12 @@
 			j = l + 1;
 		}
 	}
-	private final static Set _txtstyles;
+	private final static Set&lt;String&gt; _txtstyles;
 	static {
 		final String[] txts = {
 			"color", "background-color", "background", "white-space"
 		};
-		_txtstyles = new HashSet();
+		_txtstyles = new HashSet&lt;String&gt;();
 		for (int j = txts.length; --j &gt;=0;)
 			_txtstyles.add(txts[j]);
 	}
@@ -198,7 +198,7 @@
 		return _orphans.contains(tagname.toLowerCase());
 	}
 	/** A set of tags that don't have child. */
-	private static final Set _orphans = new HashSet(29);
+	private static final Set&lt;String&gt; _orphans = new HashSet&lt;String&gt;(29);
 	static {
 		final String[] orphans = {
 			"area", "base", "basefont", "bgsound", "br",

Modified: branches/6.0/zcommon/src/org/zkoss/idom/Attributable.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/Attributable.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/Attributable.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -44,7 +44,7 @@
 	 *
 	 * @return an empty list if no attribute at all
 	 */
-	public List getAttributeItems();
+	public List&lt;Attribute&gt; getAttributeItems();
 
 	/**
 	 * Gets the index of the first attribute that matches
@@ -128,7 +128,7 @@
 	 * @param mode the serach mode; zero or any combination of Item.FIND_xxx
 	 * @return null if not found
 	 */
-	public List getAttributes(String namespace, String name, int mode);
+	public List&lt;Attribute&gt; getAttributes(String namespace, String name, int mode);
 
 	/**
 	 * Adds the giving attribute.
@@ -153,12 +153,10 @@
 	 */
 	public Attribute setAttributeValue(String tname, String value);
 
-	/** Returns whether it is aware of the modificatioin of attributes.
-	 * If true, the modified flag is set if any of its attribute is modified.
-	 * &lt;p&gt;Default: false.
+	/** @deprecated As of release 6.0.0, it always returns false.
 	 */
 	public boolean isAttributeModificationAware();
-	/** Sets whether it is aware of the modificatioin of attributes.
+	/** @deprecated As of release 6.0.0, it does nothing.
 	 */
 	public void setAttributeModificationAware(boolean aware);
 }

Modified: branches/6.0/zcommon/src/org/zkoss/idom/Attribute.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/Attribute.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/Attribute.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -104,8 +104,6 @@
 	 * @param value the new value; null is considered as empty
 	 */
 	public final void setValue(String value) {
-		checkWritable();
-
 		if (value == null)
 			value = "";
 //		else
@@ -115,7 +113,6 @@
 		if (!Objects.equals(_value, value)) {
 			Verifier.checkCharacterData(value, getLocator());
 			_value = value;
-			setModified();
 		}
 	}
 
@@ -133,17 +130,9 @@
 	 * automatically, so user never needs to update it.
 	 */
 	public final void setOwner(Item owner) {
-		checkWritable();
 		if (_owner != owner) {
 			_ns = reuseNamespace(owner, _ns); //check and reuse
-
-			//Note: new owner and old owner's setModified must be called
-			if (_owner != null
-			&amp;&amp; ((Attributable)_owner).isAttributeModificationAware())
-				_owner.setModified();
-
 			_owner = owner;
-			setModified(); //then, owner.setModified is called
 		}
 	}
 	/** Search for the namespace to see any possible to reuse.
@@ -178,8 +167,6 @@
 	 * a namespace that has an URI but without a prefix.
 	 */
 	public final void setNamespace(Namespace ns) {
-		checkWritable();
-
 		if (ns != null &amp;&amp; ns.getPrefix().length() == 0
 		&amp;&amp; ns.getURI().length() != 0)
 			throw new DOMException(DOMException.NAMESPACE_ERR,
@@ -190,10 +177,7 @@
 		else
 			ns = reuseNamespace(_owner, ns); //check and reuse
 
-		if (!Objects.equals(_ns, ns)) {
-			_ns = ns;
-			setModified();
-		}
+		_ns = ns;
 	}
 	public final Namespace getNamespace() {
 		return _ns;
@@ -209,15 +193,12 @@
 	 * names which won't be detected by this method.
 	 */
 	public final void setTagName(String tname) {
-		checkWritable();
-
 		if (!Objects.equals(tname, getName())) {
 			int kp = tname.indexOf(':');
 			String prefix = kp &gt;= 0 ? tname.substring(0, kp): "";
 			String lname  = kp &gt;= 0 ? tname.substring(kp + 1): tname;
 			setPrefix(prefix);
 			setLocalName(lname);
-			setModified();
 		}
 	}
 
@@ -231,32 +212,13 @@
 	 * names which won't be detected by this method.
 	 */
 	public final void setLocalName(String lname) {
-		checkWritable();
 		if (!Objects.equals(lname, getLocalName())) {
 			Verifier.checkAttributeName(lname, getLocator());
 			_lname = lname;
-			setModified();
 		}
 	}		
 
 	//-- Item --//
-	/**
-	 * Tests whether this attribute is read-only.
-	 * Note: An attribute is read-only if the read-only flag is set (setReadonly)
-	 * or any of its owner item is read-only (getOwner().isReadonly()).
-	 */
-	public final boolean isReadonly() {
-		return super.isReadonly() || (_owner != null &amp;&amp; _owner.isReadonly());
-	}
-
-	public void setModified() {
-		assert(getParent() == null);
-		_modified = true;
-		if (_owner != null
-		&amp;&amp; ((Attributable)_owner).isAttributeModificationAware())
-			_owner.setModified();
-	}
-
 	public final String getName() {
 		return getTagName();
 	}
@@ -267,7 +229,7 @@
 		return getValue();
 	}
 	public final void setText(String text) {
-		setValue(text); //and checkWritable and setModified
+		setValue(text);
 	}
 
 	/**
@@ -285,11 +247,9 @@
 	 * add it to another item).
 	 */
 	public Item detach() {
-		checkWritable();
 		if (_owner != null) {
 			((Attributable)_owner).getAttributeItems().remove(this);
 			assert(_owner == null);
-			setModified();
 		}
 		return this;
 	}
@@ -342,8 +302,8 @@
 		return "[Attribute: " + getTagName() + "=\"" + _value + "\"]";
 	}
 
-	public Item clone(boolean preserveModified) {
-		Attribute v = (Attribute)super.clone(preserveModified);
+	public Object clone() {
+		Attribute v = (Attribute)super.clone();
 		v._owner = null;
 		return v;
 	}

Modified: branches/6.0/zcommon/src/org/zkoss/idom/Binary.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/Binary.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/Binary.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -59,11 +59,7 @@
 		return _value;
 	}
 	public final void setValue(Object o) {
-		checkWritable();
-		if (!Objects.equals(_value, o)) {
-			_value = o;
-			setModified();
-		}
+		_value = o;
 	}
 
 	//-- Item --//

Modified: branches/6.0/zcommon/src/org/zkoss/idom/DocType.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/DocType.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/DocType.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -84,15 +84,10 @@
 	 * @param publicId the public Id; null or empty if not availabl
 	 */
 	public final void setPublicId(String publicId) {
-		checkWritable();
-
 		if (publicId == null)
 			publicId = "";
 
-		if (!Objects.equals(_pubId, publicId)) {
-			_pubId = publicId;
-			setModified();
-		}
+		_pubId = publicId;
 	}
 	/**
 	 * Gets the system ID of an externally referenced DTD, or an empty
@@ -110,15 +105,10 @@
 	 * @param systemId the system Id; null or empty if not availabl
 	 */
 	public final void setSystemId(String systemId) {
-		checkWritable();
-
 		if (systemId == null)
 			systemId = "";
 
-		if (!Objects.equals(_sysId, systemId)) {
-			_sysId = systemId;
-			setModified();
-		}
+		_sysId = systemId;
 	}
 
 	/**
@@ -131,11 +121,7 @@
 	 * Sets the data for the internal subset.
 	 */
 	public final void setInternalSubset(String newData) {
-		checkWritable();
-		if (!Objects.equals(_intSubset, newData)) {
-			_intSubset = newData;
-			setModified();
-		}
+		_intSubset = newData;
 	}
 
 	//-- Item --//
@@ -146,17 +132,12 @@
 		return _name;
 	}
 	public final void setName(String elementName) {
-		checkWritable();
-
 		if (elementName == null)
 			elementName = "";
 
-		if (!Objects.equals(_name, elementName)) {
-			//TY: we don't verify it here because it might contain colon
-			//Verifier.checkElementName(elementName, getLocator());
-			_name = elementName;
-			setModified();
-		}
+		//TY: we don't verify it here because it might contain colon
+		//Verifier.checkElementName(elementName, getLocator());
+		_name = elementName;
 	}
 
 	//-- Node --//

Modified: branches/6.0/zcommon/src/org/zkoss/idom/Document.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/Document.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/Document.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -25,7 +25,7 @@
 import org.w3c.dom.CDATASection;
 import org.w3c.dom.DOMConfiguration;
 
-import org.zkoss.util.CheckableTreeArray;
+import org.zkoss.util.NotableLinkedList;
 import org.zkoss.xml.FacadeNodeList;
 import org.zkoss.idom.impl.*;
 
@@ -71,10 +71,9 @@
 	 * Sets the root element.
 	 */
 	public final void setRootElement(Element root) {
-		checkWritable();
 		if (root == null) {
 			if (_root != null)
-				_children.remove(_root); //then calls this.setModified
+				_children.remove(_root);
 		} else {
 			if (_root != null)
 				_children.set(_children.indexOf(_root), root);
@@ -92,10 +91,9 @@
 	 * Sets the document type.
 	 */
 	public final void setDocType(DocType docType) {
-		checkWritable();
 		if (docType == null) {
 			if (_docType != null)
-				_children.remove(_docType); //then calls this.setModified
+				_children.remove(_docType);
 		} else {
 			if (_docType != null)
 				_children.set(_children.indexOf(_docType), docType);
@@ -105,7 +103,7 @@
 	}
 
 	//-- AbstractGroup --//
-	protected final List newChildren() {
+	protected final List&lt;Item&gt; newChildren() {
 		return new ChildArray(); //note: it doesn't use that of AbstractGroup
 	}
 
@@ -248,29 +246,26 @@
 	}
 
 	//-- ChildArray --//
-	protected class ChildArray extends CheckableTreeArray {
+	protected class ChildArray extends NotableLinkedList&lt;Item&gt; {
 		protected ChildArray() {
 		}
-		protected void onAdd(Object newElement, Object followingElement) {
+		protected void onAdd(Item newElement, Item followingElement) {
 			checkAdd(newElement, followingElement, false);
 		}
-		protected void onSet(Object newElement, Object replaced) {
+		protected void onSet(Item newElement, Item replaced) {
 			assert(replaced != null);
 			checkAdd(newElement, replaced, true);
 		}
-		private void checkAdd(Object newVal, Object other, boolean replace) {
-			checkWritable();
-
+		private void checkAdd(Item newItem, Item other, boolean replace) {
 			//allowed type?
-			if (!(newVal instanceof Element) &amp;&amp; !(newVal instanceof DocType)
-			&amp;&amp; !(newVal instanceof Comment)
-			&amp;&amp; !(newVal instanceof ProcessingInstruction)
-			&amp;&amp; !(newVal instanceof EntityReference))
+			if (!(newItem instanceof Element) &amp;&amp; !(newItem instanceof DocType)
+			&amp;&amp; !(newItem instanceof Comment)
+			&amp;&amp; !(newItem instanceof ProcessingInstruction)
+			&amp;&amp; !(newItem instanceof EntityReference))
 				throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR,
-					"Invalid type: "+(newVal!=null ? newVal.getClass(): null)+" "+newVal, getLocator());
+					"Invalid type: "+(newItem!=null ? newItem.getClass(): null)+" "+newItem, getLocator());
 
 			//to be safe, no auto-detach
-			Item newItem = (Item)newVal;
 			if (newItem.getParent() != null)
 				throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR,
 					"Item, "+newItem.toString()+", owned by other, "+newItem.getParent(), getLocator());
@@ -287,18 +282,16 @@
 
 			if (replace)
 				onRemove(other);
-			newItem.setParent(Document.this); //then calls this.setModified
+			newItem.setParent(Document.this);
 
 			if (newItem instanceof Element)
 				Document.this._root = (Element)newItem;
 			else if (newItem instanceof DocType)
 				Document.this._docType = (DocType)newItem;
 		}
-		protected void onRemove(Object item) {
-			checkWritable();
+		protected void onRemove(Item item) {
+			item.setParent(null);
 
-			((Item)item).setParent(null); //then calls this.setModified
-
 			if (item instanceof Element)
 				Document.this._root = null;
 			else if (item instanceof DocType)

Modified: branches/6.0/zcommon/src/org/zkoss/idom/Element.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/Element.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/Element.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -38,8 +38,8 @@
 
 import org.zkoss.mesg.Messages;
 import org.zkoss.mesg.MCommon;
+import org.zkoss.util.NotableLinkedList;
 import org.zkoss.util.CollectionsX;
-import org.zkoss.util.CheckableTreeArray;
 import org.zkoss.xml.FacadeNodeList;
 import org.zkoss.idom.impl.*;
 
@@ -56,11 +56,9 @@
 	/** The local name. */
 	protected String _lname;
 	/** The attributes. May be null. */
-	protected List _attrs = null;
+	protected List&lt;Attribute&gt; _attrs = null;
 	/** Additional namespaces. May be null*/
-	protected Map _addNamespaces = null;
-	/** Whether it is aware of the attribute modification. */
-	boolean _attrModAware = false;
+	protected Map&lt;String, Namespace&gt; _addNamespaces = null;
 
 	/**
 	 * Constructor.
@@ -138,7 +136,7 @@
 			return ns;
 
 		if (_addNamespaces != null) {
-			ns = (Namespace)_addNamespaces.get(prefix);
+			ns = _addNamespaces.get(prefix);
 			if (ns != null)
 				return ns;
 		}
@@ -159,7 +157,8 @@
 	 *
 	 * @return the namespace declarations.
 	 */
-	public final Collection getDeclaredNamespaces() {
+	@SuppressWarnings("unchecked")
+	public final Collection&lt;Namespace&gt; getDeclaredNamespaces() {
 		return _addNamespaces == null ?
 			Collections.EMPTY_LIST: _addNamespaces.values();
 	}
@@ -172,9 +171,9 @@
 	 */
 	public final boolean addDeclaredNamespace(Namespace ns) {
 		if (_addNamespaces == null) {
-			_addNamespaces = new LinkedHashMap(5);
+			_addNamespaces = new LinkedHashMap&lt;String, Namespace&gt;(4);
 		} else {
-			final Namespace old = (Namespace)_addNamespaces.get(ns.getPrefix());
+			final Namespace old = _addNamespaces.get(ns.getPrefix());
 			if (old != null) {
 				if (!old.equals(ns))
 					throw new DOMException(DOMException.NAMESPACE_ERR, "Add a conflict namespace: "+ns+", while "+old+" already exists");
@@ -235,21 +234,21 @@
 	 */
 	public final Object setContent(Object obj) {
 		if (obj instanceof Item) {
-			getChildren().add(obj);
+			getChildren().add((Item)obj);
 			return null; //done
 		}
 		if (obj instanceof Collection) {
 			final Collection c = (Collection)obj;
 			final Iterator it = c.iterator();
 			if (it.hasNext() &amp;&amp; (it.next() instanceof Item)) {
-				getChildren().addAll(c);
+				getChildren().addAll(toItemCollection(c));
 				return null; //done
 			}
 		} else if (obj instanceof Object[]) {
 			Object[] ary = (Object[])obj;
 			if (ary.length &gt; 0 &amp;&amp; (ary[0] instanceof Item)) {
 				for (int j = 0; j &lt; ary.length; ++j)
-					getChildren().add(ary[j]);
+					getChildren().add((Item)ary[j]);
 				return null; //done
 			}
 		}
@@ -291,9 +290,13 @@
 		}
 		if (obj != null)
 			_children.add(0,
-				bStr ? (Object)new Text((String)obj): (Object)new Binary(obj));
+				bStr ? (Item)new Text((String)obj): (Item)new Binary(obj));
 		return ret;
 	}
+	@SuppressWarnings("unchecked")
+	private static final Collection&lt;Item&gt; toItemCollection(Collection c) {
+		return c;
+	}
 
 	/**
 	 * Returns the content of the child element with the giving path, or
@@ -476,7 +479,6 @@
 	 * a namespace that has an URI but without a prefix.
 	 */
 	public final void setNamespace(Namespace ns) {
-		checkWritable();
 		if (ns == null) {
 			if (_ns != null &amp;&amp; _ns.getPrefix().length() == 0)
 				return; //nothing to do
@@ -510,7 +512,6 @@
 		return _ns.tagNameOf(_lname);
 	}
 	public final void setTagName(String tname) {
-		checkWritable();
 		int kp = tname.indexOf(':');
 		String prefix = kp &gt;= 0 ? tname.substring(0, kp): "";
 		String lname  = kp &gt;= 0 ? tname.substring(kp + 1): tname;
@@ -522,50 +523,11 @@
 		return _lname;
 	}
 	public final void setLocalName(String lname) {
-		checkWritable();
 		Verifier.checkElementName(lname, getLocator());
 		_lname = lname;
 	}
 
 	//-- Item --//
-	/** Clear the modification flag.
-	 * &lt;p&gt;Note: if both includingDescendant and
-	 * {@link #isAttributeModificationAware} are true, attributes'
-	 * modified flags are cleaned.
-	 */
-	public void clearModified(boolean includingDescendant) {
-		if (includingDescendant &amp;&amp; _attrModAware) {
-			for (final Iterator it = _attrs.iterator(); it.hasNext();)
-				((Item)it.next()).clearModified(true);
-		}
-		super.clearModified(includingDescendant);
-	}
-	public Item clone(boolean preserveModified) {
-		Element elem = (Element)super.clone(preserveModified);
-
-		if (_addNamespaces != null) {
-			elem._addNamespaces = new LinkedHashMap();
-			elem._addNamespaces.putAll(_addNamespaces);
-		}
-		if (_attrs != null) {
-			elem._attrs = elem.newAttrArray();
-				//NOTE: AttrArray is an inner class, so we must use the right
-				//object to create the array. Here is 'elem'.
-
-			for (final Iterator it = _attrs.iterator(); it.hasNext();) {
-				Item v = ((Item)it.next()).clone(preserveModified);
-				boolean bClearModified = !preserveModified || !v.isModified();
-
-				elem._attrs.add(v); //v becomes modified (v.setParent is called)
-
-				if (bClearModified)
-					v.clearModified(false);
-			}
-		}
-		elem._modified = preserveModified &amp;&amp; _modified;
-		return elem;
-	}
-
 	/**
 	 * Gets the tag name of the element -- the name with prefix.
 	 * To get the local name, use getLocalName.
@@ -606,20 +568,23 @@
 	}
 
 	//-- Attributable --//
+	/** @deprecated As of release 6.0.0, it always returns false.
+	 */
 	public final boolean isAttributeModificationAware() {
-		return _attrModAware;
+		return false;
 	}
+	/** @deprecated As of release 6.0.0, it does nothing.
+	 */
 	public final void setAttributeModificationAware(boolean aware) {
-		_attrModAware = aware;
 	}
-	public final List getAttributeItems() {
+	public final List&lt;Attribute&gt; getAttributeItems() {
 		if (_attrs == null)
 			_attrs = newAttrArray();
 		return _attrs;
 	}
 	/** Creates an empty list of attributes.
 	 */
-	protected List newAttrArray() {
+	protected List&lt;Attribute&gt; newAttrArray() {
 		return new AttrArray();
 	}
 
@@ -650,29 +615,29 @@
 		int j= getAttributeIndex(0, tname);
 		return j &gt;= 0 ? (Attribute)_attrs.get(j): null;
 	}
-	public final List getAttributes(String namespace, String name, int mode) {
+	public final List&lt;Attribute&gt; getAttributes(String namespace, String name, int mode) {
 		if (_attrs == null)
-			return Collections.EMPTY_LIST;
+			return getEmptyAttributeList();
 
 		Pattern ptn =
 			(mode &amp; FIND_BY_REGEX) != 0 ? Pattern.compile(name): null;
 
-		final List list = new LinkedList();
-		for (final Iterator it = _attrs.iterator(); it.hasNext();) {
-			Attribute attr = (Attribute)it.next();
+		final List&lt;Attribute&gt; list = new LinkedList&lt;Attribute&gt;();
+		for (Attribute attr: _attrs)
 			if (match(attr, namespace, name, ptn, mode))
 				list.add(attr);
-		}
 		return list;
 	}
-
+	@SuppressWarnings("unchecked")
+	private static List&lt;Attribute&gt; getEmptyAttributeList() {
+		return Collections.EMPTY_LIST;
+	}
 	public final Attribute setAttribute(Attribute attr) {
-		checkWritable();
 		int j = getAttributeIndex(0, attr.getTagName());
 		if (j &gt;= 0) {
-			return (Attribute)getAttributeItems().set(j, attr);
+			return (Attribute)getAttributeItems().set(j, (Attribute)attr);
 		} else {
-			getAttributeItems().add(attr);
+			getAttributeItems().add((Attribute)attr);
 			return null;
 		}
 	}
@@ -687,7 +652,6 @@
 		return attr != null ? attr.getValue(): null;
 	}
 	public final Attribute setAttributeValue(String tname, String value) {
-		checkWritable();
 		Attribute attr = getAttributeItem(tname);
 		if (attr != null)
 			attr.setValue(value);
@@ -696,6 +660,24 @@
 		return attr;
 	}
 
+	//Cloneable//
+	public Object clone() {
+		Element elem = (Element)super.clone();
+
+		if (_addNamespaces != null)
+			elem._addNamespaces = new LinkedHashMap&lt;String, Namespace&gt;(_addNamespaces);
+
+		if (_attrs != null) {
+			elem._attrs = elem.newAttrArray();
+				//NOTE: AttrArray is an inner class, so we must use the right
+				//object to create the array. Here is 'elem'.
+
+			for (Attribute attr:  _attrs)
+				elem._attrs.add((Attribute)attr.clone());
+		}
+		return elem;
+	}
+
 	//-- Node --//
 	public final short getNodeType() {
 		return ELEMENT_NODE;
@@ -751,8 +733,6 @@
 	}
 	public final void setAttributeNS
 	(String nsURI, String tname, String value) {
-		checkWritable();
-
 		int kp = tname.indexOf(':');
 		String prefix = kp &gt;= 0 ? tname.substring(0, kp): "";
 		String lname  = kp &gt;= 0 ? tname.substring(kp + 1): tname;
@@ -773,9 +753,9 @@
 		int j = getAttributeIndex(
 			0, attr.getNamespace().getURI(), attr.getLocalName(), 0);
 		if (j &gt;= 0) {
-			return (Attr)getAttributeItems().set(j, newAttr);
+			return (Attr)getAttributeItems().set(j, (Attribute)newAttr);
 		} else {
-			getAttributeItems().add(newAttr);
+			getAttributeItems().add((Attribute)newAttr);
 			return null;
 		}
 	}
@@ -841,62 +821,44 @@
 	}
 
 	//-- AttrArray --//
-	protected class AttrArray extends CheckableTreeArray {
+	protected class AttrArray extends NotableLinkedList&lt;Attribute&gt; {
 		protected AttrArray() {
 		}
 
-		//-- utilities --//
-		private Attribute checkAdd(Object newItem) {
-			checkWritable();
-
-			if (!(newItem instanceof Attribute))
-				throw new DOMException(
-					DOMException.HIERARCHY_REQUEST_ERR, "Invalid type", getLocator());
-
-			Attribute attr = (Attribute)newItem;
-			if (attr.getOwner() != null)
-				throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR,
-					"Attribute, "+attr.toString()+", owned by other; detach or clone it", getLocator());
-
-			return attr;
-		}
-
 		//-- CheckableTreeArray --//
-		protected void onAdd(Object newElement, Object followingElement) {
+		protected void onAdd(Attribute newElement, Attribute followingElement) {
 			checkAdd(newElement, followingElement, false);
 		}
-		protected void onSet(Object newElement, Object replaced) {
+		protected void onSet(Attribute newElement, Attribute replaced) {
 			assert(replaced != null);
 			checkAdd(newElement, replaced, true);
 		}
-		private void checkAdd(Object newItem, Object other, boolean replace) {
+		private void checkAdd(Attribute newItem, Attribute other, boolean replace) {
 			//first, remove any existent with the same uri and name
-			Object attrRemoved = null;
-			Attribute attr = checkAdd(newItem);
+			if (newItem.getOwner() != null)
+				throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR,
+					"Attribute, "+newItem.toString()+", owned by other; detach or clone it", getLocator());
 
-			int j = getAttributeIndex(0, attr.getTagName());
+			int j = getAttributeIndex(0, newItem.getTagName());
 			if (j &gt;= 0 &amp;&amp; (!replace || get(j) != other))
 				throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR,
-					"Attribute name, " + attr.getTagName() +", is conflicts with existent one (" + j + ')', getLocator());
+					"Attribute name, " + newItem.getTagName() +", is conflicts with existent one (" + j + ')', getLocator());
 
 			try {
 				if (replace)
 					onRemove(other);
-				attr.setOwner(Element.this);
+				newItem.setOwner(Element.this);
 			}catch(RuntimeException ex) {
 				if (replace) {
 					Attribute attrRep = (Attribute)other;
 					if (attrRep.getOwner() == null)
 						attrRep.setOwner(Element.this); //restore it
 				}
-				if (attrRemoved != null)
-					super.add(j, attrRemoved); //restore it
 				throw ex;
 			}
 		}
-		protected void onRemove(Object item) {
-			checkWritable();
-			((Attribute)item).setOwner(null);
+		protected void onRemove(Attribute item) {
+			item.setOwner(null);
 		}
 
 	}

Modified: branches/6.0/zcommon/src/org/zkoss/idom/EntityReference.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/EntityReference.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/EntityReference.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -43,11 +43,9 @@
 		return _name;
 	}
 	public final void setName(String name) {
-		checkWritable();
 		if (!Objects.equals(_name, name)) {
 			Verifier.checkXMLName(name, getLocator());
 			_name = name;
-			setModified();
 		}
 	}
 

Modified: branches/6.0/zcommon/src/org/zkoss/idom/Group.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/Group.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/Group.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -54,7 +54,7 @@
 	 * it returns an empty list. And, if any invocation tries to add
 	 * vertices to the returned list will cause UnsupportOperationException.
 	 */
-	public List getChildren();
+	public List&lt;Item&gt; getChildren();
 
 	/** Detaches all children and returns them in a list.
 	 *
@@ -63,7 +63,7 @@
 	 * them first. Then, you could use this method:&lt;br&gt;
 	 * &lt;code&gt;group.addAll(e.detachChildren());&lt;/code&gt;
 	 */
-	public List detachChildren();
+	public List&lt;Item&gt; detachChildren();
 
 	/**
 	 * Coalesces children if they are siblings with the same type
@@ -179,7 +179,7 @@
 	 * @return a read-only list containing all matched children;
 	 * an empty list if not found or not supported
 	 */
-	public List getElements(String namespace, String name, int mode);
+	public List&lt;Element&gt; getElements(String namespace, String name, int mode);
 	/**
 	 * Gets a readonly list of children with the tag name.
 	 *
@@ -195,7 +195,7 @@
 	 *
 	 * @param tname the tag name (i.e., Namespaceable.getName)
 	 */
-	public List getElements(String tname);
+	public List&lt;Element&gt; getElements(String tname);
 
 	/** Returns a readonly set of names of element children. 
 	 * Then, you could use {@link #getElements} to get elements.
@@ -206,7 +206,7 @@
 	 *
 	 * @see #getElements()
 	 */
-	public Set getElementNames();
+	public Set&lt;String&gt; getElementNames();
 	/** Returns a cloned copy of all element childrens
 	 *
 	 * &lt;p&gt;Unlike {@link #getChildren} and {@link #getElementNames},
@@ -214,5 +214,5 @@
 	 *
 	 * @see #getElementNames()
 	 */
-	public List getElements();
+	public List&lt;Element&gt; getElements();
 }

Modified: branches/6.0/zcommon/src/org/zkoss/idom/Item.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/Item.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/Item.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -43,7 +43,7 @@
  * @see Attributable
  * @see Binable
  */
-public interface Item {
+public interface Item extends Cloneable {
 	/** Indicates the searching is based on regular expression
 	 * (upon the name argument).
 	 * If not specified, exact-match is required.
@@ -68,14 +68,11 @@
 	public static final int FIND_RECURSIVE = 0x0100;
 
 	/**
-	 * Tests whether this item is read-only.
-	 * Note: A item is read-only if the read-only flag is set ({@link #setReadonly})
-	 * or any of its ancestor is read-only (i.e., the read-only flag is set).
+	 * @deprecated As of release 6.0.0, it always returns false.
 	 */
 	public boolean isReadonly();
 	/**
-	 * Sets the read-only flag of this item. It causes this item
-	 * and all its descendants read-only, see {@link #isReadonly}.
+	 * @deprecated As of release 6.0.0, it does nothing.
 	 */
 	public void setReadonly(boolean readonly);
 
@@ -169,45 +166,23 @@
 	public void setLocator(Locator loc);
 
 	/**
-	 * Clones this item. Unlike other objects, it does a deep cloning.
-	 * Also, the returned object is detached by default.
-	 * The readonly flags are cleaned. If preserveModified is false,
-	 * all modification flags of the returned object are cleaned, too.
+	 * @deprecated As of release 6.0.0, replaced with {@link #clone()}.
 	 */
-	public Item clone(boolean preserveModified);
+	public Item clone(boolean reserved);
+	/** Clones this item. Unlike other objects, it does a deep cloning.
+	 */
+	public Object clone();
 
 	/**
-	 * Tests whether this item (or any of its children) is modified,
-	 * i.e., the modification flag is set.
-	 *
-	 * &lt;p&gt;IDOM is smart enough to set the modification flag only if
-	 * it is really modified -- i.e., assigning a different value (not just
-	 * calling any setter).
-	 *
-	 * &lt;p&gt;When an object is serialized, the modification flag is reset.
-	 * Also, an object generated by {@link #clone(boolean)} with
-	 * preservedModified==false has also no modification flag set.
+	 * @deprecated As of release 6.0.0, it always returns false.
 	 */
 	public boolean isModified();
 	/**
-	 * Clears the modification flag of this item and all its children
-	 * if includingDescendant is true.
-	 *
-	 * &lt;p&gt;Unlike other methods, it doesn't affected by the read-only flag.
-	 *
-	 * @param includingDescendant whether to clear the modified flags
-	 * of descendants
+	 * @deprecated As of release 6.0.0, it does nothing.
 	 */
 	public void clearModified(boolean includingDescendant);
 	/**
-	 * Sets the modification flag. Unlike {@link #clearModified}, it won't set
-	 * children's modification flags, rather it sets its parent's modification
-	 * flag.
-	 *
-	 * &lt;p&gt;The modifiaction flag is maintain automatically, so you rarely needs
-	 * to call this method.
-	 *
-	 * &lt;p&gt;Unlike other methods, it doesn't affected by the read-only flag.
+	 * @deprecated As of release 6.0.0, it always returns false.
 	 */
 	public void setModified();
 

Modified: branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -48,7 +48,7 @@
 	}
 	/** Constructor.
 	 */
-	public ProcessingInstruction(String target, Map data) {
+	public ProcessingInstruction(String target, Map&lt;String, String&gt; data) {
 		setTarget(target);
 		setData(data);
 	}
@@ -62,11 +62,9 @@
 		return _target;
 	}
 	public final void setTarget(String target) {
-		checkWritable();
 		if (!Objects.equals(_target, target)) {
 			Verifier.checkPITarget(target, getLocator());
 			_target = target;
-			setModified();
 		}
 	}
 
@@ -74,20 +72,15 @@
 		return _rawData;
 	}
 	public final void setData(String data) {
-		checkWritable();
-
 		if (data == null)
 			data = "";
 
-		if (!Objects.equals(_rawData, data)) {
-			_rawData = data;
-			setModified();
-		}
+		_rawData = data;
 	}
 	/** Returns the parsed data in the form of Map (never null).
 	 */
-	public final Map parseData() {
-		return parseToMap(new LinkedHashMap(), getData());
+	public final Map&lt;String, String&gt; parseData() {
+		return parseToMap(new LinkedHashMap&lt;String, String&gt;(), getData());
 	}
 	/**
 	 * Sets the raw data with a data map.
@@ -96,7 +89,7 @@
 	 * @exception org.zkoss.util.IllegalSyntaxException if name contains
 	 * an invalid character: '=', ' ', '\'', '"'
 	 */
-	public final void setData(Map data) {
+	public final void setData(Map&lt;String, String&gt; data) {
 		final String notAllowed = "= '\"";
 		for (final Iterator it = data.keySet().iterator(); it.hasNext();) {
 			final String key = (String)it.next();
@@ -127,17 +120,16 @@
 	 * @return the map (never null)
 	 * @exception org.zkoss.util.IllegalSyntaxException if syntax erros
 	 */
-	public static final Map parseToMap(Map map, String rawData) {
+	public static final Map&lt;String, String&gt; parseToMap(Map&lt;String, String&gt; map, String rawData) {
 		if (rawData == null || rawData.trim().length() == 0)
-			return map != null ? map: Collections.EMPTY_MAP;
+			return map != null ? map: getEmptyDataMap();
 
 		map = Maps.parse(map, rawData, ' ', (char)1); //both ' and "
 
 		//&amp;quot; and other are not processed by SAXHandler,
 		//so we have to handle them here
-		for (Iterator it = map.entrySet().iterator(); it.hasNext();) {
-			final Map.Entry me = (Map.Entry)it.next();
-			final String val = (String)me.getValue();
+		for (Map.Entry&lt;String, String&gt; me: map.entrySet()) {
+			final String val = me.getValue();
 			StringBuffer sb = null;
 			for (int i = 0, j = 0, len = val.length();;) {
 				int k = val.indexOf('&amp;', j);
@@ -176,6 +168,10 @@
 
 		return map;
 	}
+	@SuppressWarnings("unchecked")
+	private static final Map&lt;String, String&gt; getEmptyDataMap() {
+		return Collections.EMPTY_MAP;
+	}
 
 	//-- Item --//
 	public final String getName() {

Modified: branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractGroup.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractGroup.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractGroup.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -32,7 +32,7 @@
 import org.w3c.dom.Node;
 import org.w3c.dom.NodeList;
 
-import org.zkoss.util.CheckableTreeArray;
+import org.zkoss.util.NotableLinkedList;
 import org.zkoss.xml.FacadeNodeList;
 import org.zkoss.idom.*;
 
@@ -49,7 +49,7 @@
 public abstract class AbstractGroup extends AbstractItem implements Group {
 	/** The list of the children. Never null.
 	 */
-	protected List _children;
+	protected List&lt;Item&gt; _children;
 	
 	/** A helper map to enhance the searching speed with tag name.
 	 * If any deriving class don't contain this helper map, they should
@@ -74,44 +74,16 @@
 	 * &lt;p&gt;For performance issue, we introduced a map to improve the search 
 	 * speed for Element node associated with a tag name.
 	 */
-	protected List newChildren() {
+	protected List&lt;Item&gt; newChildren() {
 		return new ChildArray();
 	}
 
 	//-- Group --//
-	public void clearModified(boolean includingDescendant) {
-		if (includingDescendant) {
-			for (final Iterator it = _children.iterator(); it.hasNext();)
-				((Item)it.next()).clearModified(true);
-		}
-		super.clearModified(includingDescendant);
-	}
-	public Item clone(boolean preserveModified) {
-		AbstractGroup group = (AbstractGroup)super.clone(preserveModified);
-
-		group._children = group.newChildren();
-		for (final Iterator it = _children.iterator(); it.hasNext();) {
-			Item v = ((Item)it.next()).clone(preserveModified);
-			boolean bClearModified = !preserveModified || !v.isModified();
-
-			group._children.add(v); //v becomes modified (v.setParent is called)
-
-			if (bClearModified)
-				v.clearModified(false);
-		}
-
-		if (group._children instanceof ChildArray)
-			((ChildArray)group._children).afterClone();
-
-		group._modified = preserveModified &amp;&amp; _modified;
-		return group;
-	}
-
-	public final List getChildren() {
+	public final List&lt;Item&gt; getChildren() {
 		return _children;
 	}
-	public final List detachChildren() {
-		List list = new ArrayList(_children); //make a copy first
+	public final List&lt;Item&gt; detachChildren() {
+		List&lt;Item&gt; list = new ArrayList&lt;Item&gt;(_children); //make a copy first
 
 		for (Iterator it = _children.iterator(); it.hasNext();) {
 			it.next();
@@ -131,11 +103,11 @@
 		}
 		return false;
 	}
-	public final Set getElementNames() {
+	public final Set&lt;String&gt; getElementNames() {
 		if (_elemMap != null)
 			return _elemMap.names();
 
-		final Set set = new LinkedHashSet();
+		final Set&lt;String&gt; set = new LinkedHashSet&lt;String&gt;();
 		for (final Iterator it = _children.iterator(); it.hasNext();) {
 			final Object o = it.next();
 			if (o instanceof Element)
@@ -143,12 +115,12 @@
 		}
 		return set;
 	}
-	public final List getElements() {
-		final List lst = new LinkedList();
+	public final List&lt;Element&gt; getElements() {
+		final List&lt;Element&gt; lst = new LinkedList&lt;Element&gt;();
 		for (final Iterator it = _children.iterator(); it.hasNext();) {
 			final Object o = it.next();
 			if (o instanceof Element)
-				lst.add(o);
+				lst.add((Element)o);
 		}
 		return lst;
 	}
@@ -202,19 +174,20 @@
 		return j &gt;= 0 ? (Element)_children.get(j): null;
 	}
 
-	public final List getElements(String namespace, String name, int mode) {
+	public final List&lt;Element&gt; getElements(String namespace, String name, int mode) {
 		if (_elemMap != null &amp;&amp; namespace == null &amp;&amp; mode == FIND_BY_TAGNAME)
 			return getElements(name); //use the speed version
 
 		final Pattern ptn =
 			(mode &amp; FIND_BY_REGEX) != 0 ? Pattern.compile(name): null;
 
-		final List list = new LinkedList();
-		for (final Iterator it = _children.iterator(); it.hasNext();) {
-			Object o = it.next();
-			if ((o instanceof Element)
-			&amp;&amp; match((Element)o, namespace, name, ptn, mode))
-				list.add(o);
+		final List&lt;Element&gt; list = new LinkedList&lt;Element&gt;();
+		for (Item item: _children) {
+			if (item instanceof Element) {
+				final Element e = (Element)item;
+				if (match(e, namespace, name, ptn, mode))
+					list.add(e);
+			}
 		}
 
 		if ((mode &amp; FIND_RECURSIVE) != 0) {
@@ -226,7 +199,7 @@
 		}
 		return list;
 	}
-	public final List getElements(String tname) {
+	public final List&lt;Element&gt; getElements(String tname) {
 		if (_elemMap != null)
 			return _elemMap.getAll(tname);
 
@@ -297,7 +270,6 @@
 		return !_children.isEmpty();
 	}
 
-	//No need to call checkWritable here because _children is smart enough
 	public final Node insertBefore(Node newChild, Node refChild) {
 		if (refChild == null)
 			return appendChild(newChild);
@@ -305,14 +277,14 @@
 		int j = _children.indexOf(refChild);
 		if (j &lt; 0)
 			throw new DOMException(DOMException.NOT_FOUND_ERR, getLocator());
-		_children.add(j, newChild);
+		_children.add(j, (Item)newChild);
 		return newChild;
 	}
 	public final Node replaceChild(Node newChild, Node oldChild) {
 		int j = _children.indexOf(oldChild);
 		if (j &lt; 0)
 			throw new DOMException(DOMException.NOT_FOUND_ERR, getLocator());
-		return (Node)_children.set(j, newChild);
+		return (Node)_children.set(j, (Item)newChild);
 	}
 	public final Node removeChild(Node oldChild) {
 		int j = _children.indexOf(oldChild);
@@ -321,10 +293,23 @@
 		return (Node)_children.remove(j);
 	}
 	public final Node appendChild(Node newChild) {
-		_children.add(newChild);
+		_children.add((Item)newChild);
 		return newChild;
 	}
 
+	//Cloneable//
+	public Object clone() {
+		AbstractGroup group = (AbstractGroup)super.clone();
+
+		group._children = group.newChildren();
+		for (Item src: _children)
+			group._children.add((Item)src.clone());
+
+		if (group._children instanceof ChildArray)
+			((ChildArray)group._children).afterClone();
+		return group;
+	}
+
 	//-- Serializable --//
 	//NOTE: they must be declared as private
 	private synchronized void readObject(java.io.ObjectInputStream s)
@@ -340,7 +325,7 @@
 	 */
 	protected static class ElementMap {
 		/** the map of (String elemName, List of Elements). */
-		private final Map _map = new LinkedHashMap();
+		private final Map&lt;String, List&lt;Element&gt;&gt; _map = new LinkedHashMap&lt;String, List&lt;Element&gt;&gt;();
 		
 		protected ElementMap() {
 		}
@@ -352,15 +337,15 @@
 		 */
 		public final void put(Element e, Element following) {
 			final String name = e.getName();
-			List valueList = (List)_map.get(name);
+			List&lt;Element&gt; valueList = _map.get(name);
 			if (valueList == null) {
-				valueList = new LinkedList();
+				valueList = new LinkedList&lt;Element&gt;();
 				_map.put(name, valueList);
 			}
 
 			if (following != null &amp;&amp; name.equals(following.getName())) {
 				//add into list before the following
-				for (ListIterator it = valueList.listIterator(); it.hasNext();) {
+				for (ListIterator&lt;Element&gt; it = valueList.listIterator(); it.hasNext();) {
 					if (it.next() == following) { //no need to use equals
 						it.previous();
 						it.add(e);
@@ -376,14 +361,15 @@
 		 * the same key, it returned the head for you.
 		 */
 		public final Element get(String name) {
-			final List vals = (List)_map.get(name);
+			final List&lt;Element&gt; vals = _map.get(name);
 			return vals != null &amp;&amp; !vals.isEmpty() ? (Element)vals.get(0): null;
 		}
 		/**
 		 * Get a readonly list of all elements with name.
 		 */
-		public final List getAll(String name) {
-			final List vals = (List)_map.get(name);
+		@SuppressWarnings("unchecked")
+		public final List&lt;Element&gt; getAll(String name) {
+			final List&lt;Element&gt; vals = _map.get(name);
 			return vals != null ?
 				Collections.unmodifiableList(vals): Collections.EMPTY_LIST;
 		}
@@ -391,7 +377,7 @@
 		 * Remove e from the map.
 		 */
 		public final void remove(Element e) {
-			final List vals = (List)_map.get(e.getName());
+			final List&lt;Element&gt; vals = _map.get(e.getName());
 			vals.remove(e);
 			if (vals.isEmpty())
 				_map.remove(e.getName());
@@ -403,15 +389,15 @@
 		}
 		/** Returns a readonly set of names of all elements.
 		 */
-		public final Set names() {
+		public final Set&lt;String&gt; names() {
 			return _map.keySet();
 		}
 		/** Returns the number of elements.
 		 */
 		public final int size() {
 			int sz = 0;
-			for (Iterator it = _map.values().iterator(); it.hasNext();) {
-				sz += ((List)it.next()).size();
+			for (List&lt;Element&gt; lst: _map.values()) {
+				sz += lst.size();
 			}
 			return sz;
 		}
@@ -420,7 +406,7 @@
 	//-- ChildArray --//
 	/** The array to hold children.
 	 */
-	protected class ChildArray extends CheckableTreeArray {
+	protected class ChildArray extends NotableLinkedList&lt;Item&gt; {
 		protected ChildArray() {
 			_elemMap = new ElementMap();
 		}
@@ -444,16 +430,14 @@
 		}
 
 		//-- CheckableTreeArray --//
-		protected void onAdd(Object newElement, Object followingElement) {
+		protected void onAdd(Item newElement, Item followingElement) {
 			checkAdd(newElement, followingElement, false);
 		}
-		protected void onSet(Object newElement, Object replaced) {
+		protected void onSet(Item newElement, Item replaced) {
 			assert(replaced != null);
 			checkAdd(newElement, replaced, true);
 		}
-		private void checkAdd(Object newVal, Object other, boolean replace) {
-			checkWritable();
-
+		private void checkAdd(Item newVal, Item other, boolean replace) {
 			//allowed type?
 			if (!(newVal instanceof Element) &amp;&amp; !(newVal instanceof Text)
 			&amp;&amp; !(newVal instanceof CData) &amp;&amp; !(newVal instanceof Comment)
@@ -499,12 +483,11 @@
 			
 			if (replace)
 				onRemove(other);
-			newItem.setParent(AbstractGroup.this); //it will call this.setModified
+			newItem.setParent(AbstractGroup.this);
 		}
-		protected void onRemove(Object item) {
-			checkWritable();
+		protected void onRemove(Item item) {
 			final Item removeItem = (Item)item;
-			removeItem.setParent(null); //it will call this.setModified
+			removeItem.setParent(null);
 
 			if (removeItem instanceof Element) //Element remove from map
 				_elemMap.remove((Element)removeItem);

Modified: branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractItem.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractItem.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractItem.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -71,12 +71,8 @@
 	private Group _parent;
 	/** The locator. */
 	private Locator _loc;
-	/** The read-only flag. */
-	private boolean _readonly;
 	/** The map of user data. */
-	private Map _usrdta;
-	/** The modification flag. */
-	protected transient boolean _modified;
+	private Map&lt;String, Object&gt; _usrdta;
 
 	/** Constructor.
 	 */
@@ -84,15 +80,6 @@
 	}
 
 	//-- utilities --//
-	/** Checks whether this item is writable (ie, isReady).
-	 * @exception DOMException with NO_MODIFICATION_ALLOWED_ERR if not writable
-	 */
-	protected final void checkWritable() {
-		if (isReadonly())
-			throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR, _loc);
-	}
-
-	//-- utilities --//
 	/** Tests whether a namespaceable item matches the criteria.
 	 * If mode don't contain FIND_BY_REGEX, ptn is ignored.
 	 */
@@ -123,29 +110,33 @@
 	}
 
 	//-- Item --//
+	/**
+	 * @deprecated As of release 6.0.0, it always returns false.
+	 */
 	public boolean isReadonly() {
-		return _readonly || (_parent!=null &amp;&amp; _parent.isReadonly());
+		return false;
 	}
 	/**
-	 * Sets the read-only flag of this item. It causes this item
-	 * and all its descendants read-only, see {@link #isReadonly}.
-	 *
-	 * &lt;p&gt;Deriving class might restrict more conditions here.
+	 * @deprecated As of release 6.0.0, it does nothing.
 	 */
 	public void setReadonly(boolean readonly) {
-		_readonly = readonly;
 	}
 
+	/**
+	 * @deprecated As of release 6.0.0, it always returns false.
+	 */
 	public boolean isModified() {
-		return _modified;
+		return false;
 	}
+	/**
+	 * @deprecated As of release 6.0.0, it does nothing.
+	 */
 	public void clearModified(boolean includingDescendant) {
-		_modified = false;
 	}
+	/**
+	 * @deprecated As of release 6.0.0, it does nothing.
+	 */
 	public void setModified() {
-		_modified = true;
-		if (_parent != null)
-			_parent.setModified();
 	}
 
 	public void setName(String name) {
@@ -166,45 +157,29 @@
 	}
 
 	public Item detach() {
-		checkWritable();
 		if (_parent != null) {
 			_parent.getChildren().remove(this);
 			assert(_parent == null);
-			assert(isModified());
 		}
 		return this;
 	}
-	public Item clone(boolean preserveModified) {
-		try {
-			AbstractItem v = (AbstractItem)super.clone();
-			v._readonly = false;
-			v._parent = null;
-			if (!preserveModified)
-				v._modified = false;
-			return v;
-		}catch(CloneNotSupportedException ex) {
-			throw new InternalError();
-		}
+	/**
+	 * @deprecated As of release 6.0.0, replaced with {@link #clone()}.
+	 */
+	public Item clone(boolean reserved) {
+		return (Item)clone();
 	}
 	public final Group getParent() {
 		return _parent;
 	}
 	public void setParent(Group parent) {
-		checkWritable();
-		if (_parent != parent) {
-			//Note: new parent and old parent's setModified must be called
-			if (_parent != null)
-				_parent.setModified();
-			_parent = parent;
-			setModified(); //then, parent.setModified is called
-		}
+		_parent = parent;
 	}
 
 	public final Locator getLocator() {
 		return _loc;
 	}
 	public final void setLocator(Locator loc) {
-		checkWritable();
 		_loc = loc;
 	}
 
@@ -336,7 +311,7 @@
 	public Object setUserData(String key, Object data, UserDataHandler handler) {
 		if (handler != null)
 			throw new UnsupportedOperationException("DOM Level 3");
-		if (_usrdta == null) _usrdta = new LinkedHashMap();
+		if (_usrdta == null) _usrdta = new LinkedHashMap&lt;String, Object&gt;();
 		return _usrdta.put(key, data);
 	}
 	public Object getUserData(String key) {
@@ -363,6 +338,12 @@
 	 * and the parent becomes null (i.e., detached).
 	 */
 	public Object clone() {
-		return clone(false);
+		try {
+			AbstractItem v = (AbstractItem)super.clone();
+			v._parent = null;
+			return v;
+		}catch(CloneNotSupportedException ex) {
+			throw new InternalError();
+		}
 	}
 }

Modified: branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractTextual.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractTextual.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractTextual.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -84,8 +84,8 @@
 		setText(s.substring(0, offset));
 
 		if (getParent() != null) {
-			List list = getParent().getChildren();
-			list.add(list.indexOf(this) + 1, vtx);
+			List&lt;Item&gt; list = getParent().getChildren();
+			list.add(list.indexOf(this) + 1, (Item)vtx);
 		}
 		return vtx;
 	}
@@ -105,15 +105,12 @@
 		return _text;
 	}
 	public void setText(String text) {
-		checkWritable();
-
 		if (text == null)
 			text = "";
 
 		if (!Objects.equals(_text, text)) {
 			checkText(text);
 			_text = text;
-			setModified();
 		}
 	}
 

Modified: branches/6.0/zcommon/src/org/zkoss/idom/input/SAXHandler.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/input/SAXHandler.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/input/SAXHandler.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -86,9 +86,9 @@
 	/** Indicator of whether we are in a CDATA. */
 	protected boolean _inCData = false;
 	/** The Group stack. The top one is the current group being processed. */
-	protected Stack _stack = null;
+	protected Stack&lt;Group&gt; _stack = null;
 	/** The namespaces in between startPrefixMapping and endPrefixMapping. */
-	protected List _declNamespaces = null;
+	protected List&lt;Namespace&gt; _declNamespaces = null;
 	/** Temporary holder for the internal subset. */
 	private StringBuffer _internSubset = null;
 	/** Whether it is in internal subset. */
@@ -264,14 +264,14 @@
 	/** Returns the top group, or null if not available.
 	 */
 	protected final Group getTopGroup() {
-		return _stack.isEmpty() ? null: (Group)_stack.peek();
+		return _stack.isEmpty() ? null: _stack.peek();
 	}
 	/**
 	 * Adds the item to the current group; also attach the locator.
 	 */
 	protected final void addToCurrentGroup(Item vtx) {
 		attachLocator(vtx);
-		((Group)_stack.peek()).getChildren().add(vtx);
+		_stack.peek().getChildren().add(vtx);
 	}
 	/**
 	 * Adds a new group to the current group as a child,
@@ -290,7 +290,7 @@
 	 * new current group.
 	 */
 	protected final void popGroup() {
-		((Group)_stack.pop()).coalesce(false);
+		_stack.pop().coalesce(false);
 	}
 
 	//-- org.xml.sax.ext.DeclHandler --//
@@ -430,8 +430,8 @@
 
 	//-- org.xml.sax.ContentHandler --//
 	public void startDocument() throws SAXException {
-		_declNamespaces = new LinkedList();
-		_stack =  new Stack();
+		_declNamespaces = new LinkedList&lt;Namespace&gt;();
+		_stack = new Stack&lt;Group&gt;();
 
 		_doc = _factory.newDocument(null, null);
 		pushGroup(_doc);
@@ -469,8 +469,8 @@
 		if (D.ON &amp;&amp; log.finerable())
 			log.finer("end prefix: " + prefix + SimpleLocator.toString(_loc));
 
-		for (Iterator itr = _declNamespaces.iterator(); itr.hasNext();) {
-			final Namespace ns = (Namespace) itr.next();
+		for (Iterator&lt;Namespace&gt; itr = _declNamespaces.iterator(); itr.hasNext();) {
+			final Namespace ns = itr.next();
 			if (prefix.equals(ns.getPrefix())) {
 				itr.remove();
 				break;
@@ -540,14 +540,12 @@
 
 		if (ns == null) {
 			if (_declNamespaces.size() &gt; 0) {
-				for (Iterator it = _declNamespaces.iterator(); it.hasNext();) {
-					final Namespace n = (Namespace)it.next();
+				for (Namespace n: _declNamespaces)
 					if (n.getPrefix().equals(prefix) &amp;&amp; n.getURI().equals(nsURI)) {
 						if (D.ON &amp;&amp; log.finerable()) log.finer("Namespace found in _declNamespaces: "+n);
 						ns = n;
 						break; //found
 					}
-				}
 			}
 			if (ns == null &amp;&amp; nsURI.length() &gt; 0) {
 				if (D.ON &amp;&amp; log.finerable()) log.finer("Create namespace: "+prefix+" "+nsURI);
@@ -560,8 +558,8 @@
 
 		//add to element's add. namespaces
 		if (_declNamespaces.size() &gt; 0) {
-			for (Iterator it = _declNamespaces.iterator(); it.hasNext();)
-				element.addDeclaredNamespace((Namespace)it.next());
+			for (Namespace n: _declNamespaces)
+				element.addDeclaredNamespace(n);
 			_declNamespaces.clear();
 		}
 

Modified: branches/6.0/zcommon/src/org/zkoss/idom/util/IDOMs.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/util/IDOMs.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/idom/util/IDOMs.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -125,8 +125,8 @@
 	 * if no parameter is defined. The map is in the same order of the element tree.
 	 */
 	public static final
-	Map parseParams(Element elm, String type, String name, String value) {
-		final Map map = new LinkedHashMap();
+	Map&lt;String, String&gt; parseParams(Element elm, String type, String name, String value) {
+		final Map&lt;String, String&gt; map = new LinkedHashMap&lt;String, String&gt;();
 		for (Iterator it = elm.getElements(type).iterator(); it.hasNext();) {
 			final Element el = (Element)it.next();
 			final String nm = getRequiredElementValue(el, name);
@@ -142,7 +142,7 @@
 	public static void format(Element e) {
 		//add proper spacing between consecutive elements
 		boolean elemFound = true;
-		for (final ListIterator it = e.getChildren().listIterator(); it.hasNext();) {
+		for (final ListIterator&lt;Item&gt; it = e.getChildren().listIterator(); it.hasNext();) {
 			final Object o = it.next();
 			if (o instanceof Element) {
 				if (elemFound) { //insert space
@@ -164,6 +164,7 @@
 	 * an element or an array or a collection of elements.
 	 * One item of an collection might be another collection or array.
 	 */
+	@SuppressWarnings("unchecked")
 	public static final Object toContents(Object obj) {
 		if (obj instanceof Collection) {
 			Collection c = (Collection)obj;
@@ -262,8 +263,6 @@
 	dumpTree(PrintWriter s, Item vtx, String prefix) {
 		s.print(prefix);
 		s.print(vtx);
-		s.print(vtx.isReadonly() ? 'R' : ' ');
-		s.println(vtx.isModified() ? 'M' : ' ');
 		if (vtx instanceof Group) {
 			prefix = prefix + "  ";
 			for (Iterator it = ((Group)vtx).getChildren().iterator();

Modified: branches/6.0/zcommon/src/org/zkoss/image/encoder/ImageEncoders.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/image/encoder/ImageEncoders.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/image/encoder/ImageEncoders.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -33,10 +33,10 @@
  */
 public class ImageEncoders {
 	/** Map(String format, Class encoder). */
-	private final static Map _encoders;
+	private final static Map&lt;String, Class&gt; _encoders;
 
 	static {
-		final Map encoders = new HashMap(4);
+		final Map&lt;String, Class&gt; encoders = new HashMap&lt;String, Class&gt;(4);
 		encoders.put("png", PNGEncoder.class);
 		encoders.put("jpeg", JPEGEncoder.class);
 		_encoders = Collections.synchronizedMap(encoders);
@@ -51,7 +51,7 @@
      * @exception SystemException if failed to instantiate the encoder
      */
     public static ImageEncoder newInstance(String format) {
-    	final Class klass = (Class)_encoders.get(format.toLowerCase());
+    	final Class klass = _encoders.get(format.toLowerCase());
     	if (klass == null)
     		throw new IllegalArgumentException("Unsupported format: "+format);
 
@@ -75,12 +75,12 @@
     public static Class setEncoderClass(String format, Class klass) {
     	if (!ImageEncoder.class.isAssignableFrom(klass))
     		throw new IllegalArgumentException(ImageEncoder.class+" must be implemented by "+klass);
-    	return (Class)_encoders.put(format.toLowerCase(), klass);
+    	return _encoders.put(format.toLowerCase(), klass);
     }
     /** Returns the class of the image encoder for the specified format,
      * or null if not specified yet.
      */
     public static Class getEncoderClass(String format) {
-    	return (Class)_encoders.get(format.toLowerCase());
+    	return _encoders.get(format.toLowerCase());
     }
 }

Modified: branches/6.0/zcommon/src/org/zkoss/io/Serializables.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/io/Serializables.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/io/Serializables.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -38,13 +38,12 @@
 	/** Writes only serializable entries of the specified map.
 	 * Non-serializable attributes are ignored.
 	 */
-	public static void smartWrite(ObjectOutputStream s, Map map)
+	public static &lt;K, V&gt; void smartWrite(ObjectOutputStream s, Map&lt;K, V&gt; map)
 	throws IOException {
 		if (map != null) {
-			for (Iterator it = map.entrySet().iterator(); it.hasNext();) {
-				final Map.Entry me = (Map.Entry)it.next();
-				final Object nm = me.getKey();
-				final Object val = me.getValue();
+			for (Map.Entry&lt;K, V&gt; me: map.entrySet()) {
+				final K nm = me.getKey();
+				final V val = me.getValue();
 				if (((nm instanceof Serializable) || (nm instanceof Externalizable))
 				&amp;&amp; (val == null || (val instanceof Serializable) || (val instanceof Externalizable))) {
 					s.writeObject(nm);
@@ -60,24 +59,24 @@
 	 * is read, a new map (HashMap) is created and returned.
 	 * @return the map being read
 	 */
-	public static Map smartRead(ObjectInputStream s, Map map)
+	@SuppressWarnings("unchecked")
+	public static &lt;K, V&gt; Map&lt;K, V&gt; smartRead(ObjectInputStream s, Map&lt;K, V&gt; map)
 	throws IOException, ClassNotFoundException {
 		for (;;) {
 			final Object nm = s.readObject();
 			if (nm == null) break; //no more
 
-			if (map == null) map = new HashMap();
-			map.put(nm, s.readObject());
+			if (map == null) map = new HashMap&lt;K,V&gt;();
+			map.put((K)nm, (V)s.readObject());
 		}
 		return map;
 	}
 	/** Writes only serializable elements of the specified collection.
 	 */
-	public static void smartWrite(ObjectOutputStream s, Collection col)
+	public static &lt;T&gt; void smartWrite(ObjectOutputStream s, Collection&lt;T&gt; col)
 	throws IOException {
 		if (col != null) {
-			for (Iterator it = col.iterator(); it.hasNext();) {
-				final Object val = it.next();
+			for (T val: col) {
 				if ((val instanceof Serializable)
 				|| (val instanceof Externalizable)) {
 					s.writeObject(val);
@@ -92,14 +91,15 @@
 	 * and data is read, a new collection (LinkedList) is created and returned.
 	 * @return the collection being read
 	 */
-	public static Collection smartRead(ObjectInputStream s, Collection col)
+	@SuppressWarnings("unchecked")
+	public static &lt;T&gt; Collection&lt;T&gt; smartRead(ObjectInputStream s, Collection&lt;T&gt; col)
 	throws IOException, ClassNotFoundException {
 		for (;;) {
 			final Object val = s.readObject();
 			if (val == null) break; //no more
 
-			if (col == null) col = new LinkedList();
-			col.add(val);
+			if (col == null) col = new LinkedList&lt;T&gt;();
+			col.add((T)val);
 		}
 		return col;
 	}
@@ -108,11 +108,11 @@
 	 * &lt;p&gt;To read back, use {@link #smartRead(ObjectInputStream, Collection)}.
 	 * @since 3.0.0
 	 */
-	public static void smartWrite(ObjectOutputStream s, Object[] ary)
+	public static &lt;T&gt; void smartWrite(ObjectOutputStream s, T[] ary)
 	throws IOException {
 		if (ary != null) {
 			for (int j = 0; j &lt; ary.length; ++j) {
-				final Object val = ary[j];
+				final T val = ary[j];
 				if ((val instanceof Serializable)
 				|| (val instanceof Externalizable)) {
 					s.writeObject(val);

Modified: branches/6.0/zcommon/src/org/zkoss/json/parser/JSONParser.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/json/parser/JSONParser.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/json/parser/JSONParser.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -20,6 +20,7 @@
  * 
  * @author FangYidong&lt;fangyidong@...&gt;
  */
+@SuppressWarnings("unchecked")
 public class JSONParser {
 	public static final int S_INIT=0;
 	public static final int S_IN_FINISHED_VALUE=1;//string,number,boolean,null,object,array

Modified: branches/6.0/zcommon/src/org/zkoss/lang/Classes.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/Classes.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/lang/Classes.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -70,7 +70,7 @@
 	 * @see #newInstance(String, Class[], Object[])
 	 */
 	public static final
-	Object newInstance(Class cls, Class[] argTypes, Object[] args)
+	Object newInstance(Class&lt;?&gt; cls, Class&lt;?&gt;[] argTypes, Object[] args)
 	throws NoSuchMethodException, InstantiationException,
 	InvocationTargetException, IllegalAccessException {
  		return cls.getConstructor(argTypes).newInstance(args);
@@ -84,7 +84,7 @@
 	 * @since 3.0.1
 	 */
 	public static final
-	Object newInstance(Class cls, Object[] args)
+	Object newInstance(Class&lt;?&gt; cls, Object[] args)
 	throws NoSuchMethodException, InstantiationException,
 	InvocationTargetException, IllegalAccessException {
 		if (args == null || args.length == 0)
@@ -92,14 +92,14 @@
 
 		final Constructor[] cs = cls.getConstructors();
 		for (int j = 0; j &lt; cs.length; ++j) {
-			final Class[] types = cs[j].getParameterTypes();
+			final Class&lt;?&gt;[] types = cs[j].getParameterTypes();
 			if (types.length == args.length) {
 				for (int k = args.length;;) {
 					if (--k &lt; 0)
 						return cs[j].newInstance(args);
 
 					final Object arg = args[k];
-					final Class type = types[k];
+					final Class&lt;?&gt; type = types[k];
 					if (arg == null)
 						if (type.isPrimitive()) break; //mismatch
 						else continue; //match
@@ -141,7 +141,7 @@
 	 * @see #newInstance(Class, Class[], Object[])
 	 */
 	public static final Object
-	newInstance(String clsName, Class[] argTypes, Object[] args)
+	newInstance(String clsName, Class&lt;?&gt;[] argTypes, Object[] args)
 	throws NoSuchMethodException, InstantiationException,
 	InvocationTargetException, ClassNotFoundException, IllegalAccessException {
 	 	return newInstance(Class.forName(clsName), argTypes, args);
@@ -166,7 +166,7 @@
 	 * @see #newInstance(Class, Class[], Object[])
 	 */
 	public static final Object
-	newInstanceByThread(String clsName, Class[] argTypes, Object[] args)
+	newInstanceByThread(String clsName, Class&lt;?&gt;[] argTypes, Object[] args)
 	throws NoSuchMethodException, InstantiationException,
 	InvocationTargetException, ClassNotFoundException, IllegalAccessException {
 	 	return newInstance(forNameByThread(clsName), argTypes, args);
@@ -192,10 +192,10 @@
 	 * @return the Class object representing the desired class
 	 * @exception ClassNotFoundException if the class cannot be located by the specified class loader
 	 */
-	public static final Class forNameByThread(String clsName)
+	public static final Class&lt;?&gt; forNameByThread(String clsName)
 	throws ClassNotFoundException {
 		clsName = toInternalForm(clsName);
-		final Class cls = Primitives.toClass(clsName);
+		final Class&lt;?&gt; cls = Primitives.toClass(clsName);
 		if (cls != null)
 			return cls;
 
@@ -280,12 +280,12 @@
 	 * @return the topmost interface extending subIF, or null if subIF
 	 * is not implemented by cls
 	 */
-	public static Class getTopmostInterface(Class cls, Class subIF) {
+	public static Class&lt;?&gt; getTopmostInterface(Class&lt;?&gt; cls, Class&lt;?&gt; subIF) {
 		if (cls.isInterface())
 			return subIF.isAssignableFrom(cls) ? cls: null;
 
 		while (cls != null) {
-			final Class[] ifs = cls.getInterfaces();
+			final Class&lt;?&gt;[] ifs = cls.getInterfaces();
 			for (int j = 0; j &lt; ifs.length; ++j)
 				if (subIF.isAssignableFrom(ifs[j]))
 					return ifs[j];
@@ -298,17 +298,17 @@
 	 * &lt;p&gt;Unlike {@link Class#getInterfaces}, it recursively searches
 	 * for all derived classes.
 	 */
-	public static Class[] getAllInterfaces(Class cls) {
-		final List l = new LinkedList();
+	public static Class&lt;?&gt;[] getAllInterfaces(Class&lt;?&gt; cls) {
+		final List&lt;Class&lt;?&gt;&gt; l = new LinkedList&lt;Class&lt;?&gt;&gt;();
 		while (cls != null) {
-			final Class[] ifs = cls.getInterfaces();
+			final Class&lt;?&gt;[] ifs = cls.getInterfaces();
 			for (int j = 0; j &lt; ifs.length; ++j)
 				l.add(ifs[j]);
 
 			cls = cls.getSuperclass();
 		}
 		final int sz = l.size();
-		return (Class[])l.toArray(new Class[sz]);
+		return l.toArray(new Class&lt;?&gt;[sz]);
 	}		
 
 	/**
@@ -321,7 +321,7 @@
 	 * @return true if it contains the method
 	 */
 	public static final boolean containsMethod
-	(Class cls, String name, Class[] paramTypes) {
+	(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] paramTypes) {
 		try {
 			cls.getMethod(name, paramTypes);
 			return true;
@@ -504,8 +504,8 @@
 		}
 		String method = signature.substring(j, k).trim();
 		
-		Collection argTypes = new LinkedList();
-		Collection argNames = new LinkedList();
+		Collection&lt;String&gt; argTypes = new LinkedList&lt;String&gt;();
+		Collection&lt;String&gt; argNames = new LinkedList&lt;String&gt;();
 		do {
 			j = Strings.skipWhitespaces(signature, k + 1);
 			if (signature.charAt(j) == ')') break;
@@ -544,8 +544,8 @@
 		}
 	
 		return new MethodInfo(returnType, method, 
-					(String[])argTypes.toArray(new String[argTypes.size()]), 
-					(String[])argNames.toArray(new String[argNames.size()]), 
+					argTypes.toArray(new String[argTypes.size()]), 
+					argNames.toArray(new String[argNames.size()]), 
 					tEx);
 	}
 	
@@ -572,11 +572,11 @@
 	 * null means no parameter names to return
 	 */
 	public static final Method
-	getMethodBySignature(Class cls, String signature, Collection params)
+	getMethodBySignature(Class&lt;?&gt; cls, String signature, Collection&lt;String&gt; params)
 	throws NoSuchMethodException, ClassNotFoundException {
 		MethodInfo mi = parseMethod(signature);
 
-		LinkedList argTypes = new LinkedList();
+		LinkedList&lt;Class&lt;?&gt;&gt; argTypes = new LinkedList&lt;Class&lt;?&gt;&gt;();
 		for (int i = 0; i &lt; mi.argTypes.length; i++) {
 			argTypes.add(forNameByThread(mi.argTypes[i]));
 			if (params != null)
@@ -584,7 +584,7 @@
 		}
 		
 		return getMethodInPublic(cls, mi.method,
-			(Class[])argTypes.toArray(new Class[argTypes.size()]));
+			argTypes.toArray(new Class&lt;?&gt;[argTypes.size()]));
 	}
 
 	/**
@@ -601,20 +601,20 @@
 	 * class/interface is found to have the method.
 	 */
 	public static final Method
-	getMethodInPublic(Class cls, String name, Class[] argTypes)
+	getMethodInPublic(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] argTypes)
 	throws NoSuchMethodException {
 		final Method m = cls.getMethod(name, argTypes);
 		if (Modifier.isPublic(m.getDeclaringClass().getModifiers()))
 			return m;
 
-		final Class[] clses = cls.getInterfaces();
+		final Class&lt;?&gt;[] clses = cls.getInterfaces();
 		for (int j = 0; j&lt; clses.length; ++j)
 			try {
 				return getMethodInPublic(clses[j], name, argTypes);
 			} catch (NoSuchMethodException ex) { //ignore it
 			}
 
-		final Class basecls = cls.getSuperclass();
+		final Class&lt;?&gt; basecls = cls.getSuperclass();
 		if (basecls != null)
 			try {
 				return getMethodInPublic(basecls, name, argTypes);
@@ -628,12 +628,12 @@
 	 * than the argument types. It actually calls {@link #getCloseMethod}.
 	 */
 	public static final Method
-	getMethodByObject(Class cls, String name, Object[] args)
+	getMethodByObject(Class&lt;?&gt; cls, String name, Object[] args)
 	throws NoSuchMethodException {
 		if (args == null)
 			return getMethodInPublic(cls, name, null);
 
-		final Class[] argTypes = new Class[args.length];
+		final Class&lt;?&gt;[] argTypes = new Class[args.length];
 		for (int j = 0; j &lt; args.length; ++j)
 			argTypes[j] = args[j] != null ? args[j].getClass(): null;
 		return getCloseMethod(cls, name, argTypes);
@@ -667,13 +667,13 @@
 	 * @exception NoSuchMethodException if the method is not found
 	 */
 	public static final Method
-	getCloseMethod(Class cls, String name, Class[] argTypes)
+	getCloseMethod(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] argTypes)
 	throws NoSuchMethodException {
 		if (argTypes == null || argTypes.length == 0)
 			return getMethodInPublic(cls, name, null);
 
 		final AOInfo aoi = new AOInfo(cls, name, argTypes, 0);
-		Method m = (Method)_closms.get(aoi);
+		Method m = _closms.get(aoi);
 		if (m != null)
 			return m;
 
@@ -688,13 +688,13 @@
 	 * the same as or a subclass of the specified one.
 	 */
 	public static final Method
-	getCloseMethodBySubclass(Class cls, String name, Class[] argTypes)
+	getCloseMethodBySubclass(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] argTypes)
 	throws NoSuchMethodException {
 		if (argTypes == null || argTypes.length == 0)
 			return getMethodInPublic(cls, name, null);
 
 		final AOInfo aoi = new AOInfo(cls, name, argTypes, B_BY_SUBCLASS);
-		Method m = (Method)_closms.get(aoi);
+		Method m = _closms.get(aoi);
 		if (m != null)
 			return m;
 
@@ -702,13 +702,13 @@
 		_closms.put(aoi, m);
 		return m;
 	}
-	private static Cache _closms = new MultiCache(
+	private static Cache&lt;AOInfo, Method&gt; _closms = new MultiCache&lt;AOInfo, Method&gt;(
 		Library.getIntProperty("org.zkoss.lang.Classes.methods.cache.number", 97),
 		Library.getIntProperty("org.zkoss.lang.Classes.methods.cache.maxSize", 30),
 		4*60*60*1000);
 	private static final Method
-	myGetCloseMethod(final Class cls, final String name,
-	final Class[] argTypes, final boolean bySubclass)
+	myGetCloseMethod(final Class&lt;?&gt; cls, final String name,
+	final Class&lt;?&gt;[] argTypes, final boolean bySubclass)
 	throws NoSuchMethodException {
 		assert D.OFF || argTypes != null: "Caller shall handle null";
 		for (int j = 0;; ++j) {
@@ -728,7 +728,7 @@
 			if (!ms[j].getName().equals(name))
 				continue;
 
-			final Class[] mTypes = ms[j].getParameterTypes();
+			final Class&lt;?&gt;[] mTypes = ms[j].getParameterTypes();
 			if (mTypes.length != argTypes.length)
 				continue; //not matched
 
@@ -746,13 +746,13 @@
 					break;//not match; look for next
 				}
 
-				final Class argType = argTypes[k], mType = mTypes[k];
+				final Class&lt;?&gt; argType = argTypes[k], mType = mTypes[k];
 				if (argType == null
 				|| (!bySubclass &amp;&amp; mType.isAssignableFrom(argType))
 				|| (bySubclass &amp;&amp; argType.isAssignableFrom(mType)))
 					continue; //match
 
-				final Class c = Primitives.toPrimitive(argType);
+				final Class&lt;?&gt; c = Primitives.toPrimitive(argType);
 				if (c == null || !c.equals(mType))
 					break; //not match
 			}
@@ -766,7 +766,7 @@
 	 * and it won't throw any exception.
 	 */
 	public static final
-	Method[] getCloseMethods(Class cls, String name, Class[] argTypes) {
+	Method[] getCloseMethods(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] argTypes) {
 		if (argTypes == null || argTypes.length == 0) {
 			try {
 				return new Method[] {getMethodInPublic(cls, name, null)};
@@ -783,22 +783,22 @@
 	 * the same as or a subclass of the specified one.
 	 */
 	public static final
-	Method[] getCloseMethodsBySubclass(Class cls, String name, Class[] argTypes) {
+	Method[] getCloseMethodsBySubclass(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] argTypes) {
 		if (argTypes == null || argTypes.length == 0)
 			return getCloseMethods(cls, name, null);
 		return myGetCloseMethods(cls, name, argTypes, true);
 	}
 	private static final Method[]
-	myGetCloseMethods(final Class cls, final String name,
-	final Class[] argTypes, final boolean bySubclass) {
+	myGetCloseMethods(final Class&lt;?&gt; cls, final String name,
+	final Class&lt;?&gt;[] argTypes, final boolean bySubclass) {
 		assert D.OFF || argTypes != null: "Caller shall handle null";
-		final List mtds = new LinkedList();
+		final List&lt;Method&gt; mtds = new LinkedList&lt;Method&gt;();
 		final Method [] ms = cls.getMethods();
 		for (int j = 0; j &lt; ms.length; ++j) {
 			if (!ms[j].getName().equals(name))
 				continue;
 
-			final Class[] mTypes = ms[j].getParameterTypes();
+			final Class&lt;?&gt;[] mTypes = ms[j].getParameterTypes();
 			if (mTypes.length != argTypes.length)
 				continue; //not matched
 
@@ -818,18 +818,18 @@
 					break; //found; next method
 				}
 
-				final Class argType = argTypes[k], mType = mTypes[k];
+				final Class&lt;?&gt; argType = argTypes[k], mType = mTypes[k];
 				if (argType == null
 				|| (!bySubclass &amp;&amp; mType.isAssignableFrom(argType))
 				|| (bySubclass &amp;&amp; argType.isAssignableFrom(mType)))
 					continue; //match one argument
 
-				final Class c = Primitives.toPrimitive(argType);
+				final Class&lt;?&gt; c = Primitives.toPrimitive(argType);
 				if (c == null || !c.equals(mType))
 					break; //not match; next method
 			}
 		}
-		return (Method[])mtds.toArray(new Method[mtds.size()]);
+		return mtds.toArray(new Method[mtds.size()]);
 	}
 
 	/**
@@ -883,10 +883,10 @@
 	 * @exception SecurityException if access to the information is denied
 	 */
 	public static final AccessibleObject
-	getAccessibleObject(Class cls, String name, Class[] argTypes, int flags)
+	getAccessibleObject(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] argTypes, int flags)
 	throws NoSuchMethodException {
 		final AOInfo aoi = new AOInfo(cls, name, argTypes, flags);
-		AccessibleObject ao = (AccessibleObject)_acsos.get(aoi);
+		AccessibleObject ao = _acsos.get(aoi);
 		if (ao != null)
 			return ao;
 
@@ -894,12 +894,12 @@
 		_acsos.put(aoi, ao);
 		return ao;
 	}
-	private static Cache _acsos = new MultiCache(
+	private static Cache&lt;AOInfo, AccessibleObject&gt; _acsos = new MultiCache&lt;AOInfo, AccessibleObject&gt;(
 		Library.getIntProperty("org.zkoss.lang.Classes.methods.cache.number", 97),
 		Library.getIntProperty("org.zkoss.lang.Classes.methods.cache.maxSize", 30),
 		4*60*60*1000);
 	private static final AccessibleObject
-	myGetAcsObj(Class cls, String name, Class[] argTypes, int flags)
+	myGetAcsObj(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] argTypes, int flags)
 	throws NoSuchMethodException {
 		//try public set/get
 		final String decoratedName =
@@ -970,11 +970,11 @@
 	}
 	/** The infomation of the access object. */
 	private static class AOInfo {
-		private Class cls;
+		private Class&lt;?&gt; cls;
 		private String name;
-		private Class[] argTypes;
+		private Class&lt;?&gt;[] argTypes;
 		private int flags;
-		private AOInfo(Class cls, String name, Class[] argTypes, int flags) {
+		private AOInfo(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] argTypes, int flags) {
 			this.cls = cls;
 			this.name = name;
 			this.argTypes = argTypes;
@@ -1028,12 +1028,12 @@
 	 * @see #getAnyField(Class, String)
 	 */
 	public static final Method
-	getAnyMethod(Class cls, String name, Class[] argTypes)
+	getAnyMethod(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] argTypes)
 	throws NoSuchMethodException {
 		try {
 			return cls.getDeclaredMethod(name, argTypes);
 		} catch (NoSuchMethodException ex) {
-			final Class[] clses = cls.getInterfaces();
+			final Class&lt;?&gt;[] clses = cls.getInterfaces();
 			for (int j = 0; j&lt; clses.length; ++j)
 				try {
 					return getAnyMethod(clses[j], name, argTypes);
@@ -1065,7 +1065,7 @@
 	 * @see #getAccessibleObject(Class, String, Class[], int)
 	 * @see #getAnyMethod(Class, String, Class[])
 	 */
-	public static final Field getAnyField(Class cls, String name)
+	public static final Field getAnyField(Class&lt;?&gt; cls, String name)
 	throws NoSuchFieldException {
 		for (;;) {
 			try {
@@ -1088,7 +1088,7 @@
 	 * @return a subset of clsToCheck that are super-class of cls;
 	 * null if no one qualified
 	 */
-	public static final Class[] getSuperClasses(Class cls, Class[] clsToCheck) {
+	public static final Class&lt;?&gt;[] getSuperClasses(Class&lt;?&gt; cls, Class&lt;?&gt;[] clsToCheck) {
 		if (clsToCheck!=null) {
 			int[] hits = new int[clsToCheck.length];
 			int no = 0;
@@ -1099,7 +1099,7 @@
 			if (no != clsToCheck.length) {
 				if (no == 0)
 					return null;
-				Class[] exc = new Class[no];
+				Class&lt;?&gt;[] exc = new Class[no];
 				for (int j=0; j&lt;no; ++j)
 					exc[j] = clsToCheck[hits[j]];
 				return exc;
@@ -1111,7 +1111,7 @@
 	/**
 	 * Check whether the specified class is a primitive or a primitive wrapper.
 	 */
-	public static final boolean isPrimitiveWrapper(Class cls) {
+	public static final boolean isPrimitiveWrapper(Class&lt;?&gt; cls) {
 		return Objects.equals(cls.getPackage(), Boolean.class.getPackage())
 			&amp;&amp; (cls.equals(Boolean.class) || cls.equals(Byte.class)
 				|| cls.equals(Character.class) || cls.equals(Double.class)
@@ -1123,7 +1123,7 @@
 	 * @param extend whether to consider Date, char, boolean, Character
 	 * and Boolean as a numeric object.
 	 */
-	public static final boolean isNumeric(Class cls, boolean extend) {
+	public static final boolean isNumeric(Class&lt;?&gt; cls, boolean extend) {
 		if (cls.isPrimitive())
 			return extend ||
 				(!cls.equals(char.class) &amp;&amp; !cls.equals(boolean.class));
@@ -1145,7 +1145,7 @@
 	 * @exception ClassCastException if failed to convert
 	 * @see #coerce(Class, Object, boolean)
 	 */
-	public static Object coerce(Class cls, Object val)
+	public static Object coerce(Class&lt;?&gt; cls, Object val)
 	throws ClassCastException {
 		if (cls.isInstance(val))
 			return val;
@@ -1322,7 +1322,7 @@
 	 * is equivalent to nullable=true.
 	 * @exception ClassCastException if failed to convert
 	 */
-	public static Object coerce(Class cls, Object val, boolean nullable)
+	public static Object coerce(Class&lt;?&gt; cls, Object val, boolean nullable)
 	throws ClassCastException {
 		if (nullable || val != null)
 			return coerce(cls, val);

Modified: branches/6.0/zcommon/src/org/zkoss/lang/Comparables.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/Comparables.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/lang/Comparables.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -28,6 +28,7 @@
 	 * Note that the two Comparable must be with compatible type, or a
 	 * ClassCastException might be thrown.
 	 */
+	@SuppressWarnings("unchecked")
 	public static final Comparable min(Comparable a, Comparable b) {
 		return  (a.compareTo(b) &lt; 0) ? a : b;
 	}
@@ -37,6 +38,7 @@
 	 * Note that the two Comparable must be with compatible type, or a
 	 * ClassCastException might be thrown.
 	 */
+	@SuppressWarnings("unchecked")
 	public static final Comparable max(Comparable a, Comparable b) {
 		return  (a.compareTo(b) &lt; 0) ? b : a;
 	}

Modified: branches/6.0/zcommon/src/org/zkoss/lang/Library.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/Library.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/lang/Library.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -38,7 +38,7 @@
  */
 public class Library {
 	private static final Log log = Log.lookup(Library.class);
-	private static final Map _props = new HashMap();
+	private static final Map&lt;String, String&gt; _props = new HashMap&lt;String, String&gt;();
 
 	private Library() {}
 
@@ -64,7 +64,7 @@
 	public static String getProperty(String key) {
 		final String v;
 		synchronized (_props) {
-			v = (String)_props.get(key);
+			v = _props.get(key);
 		}
 		try {
 			return v != null ? v: System.getProperty(key);
@@ -87,7 +87,7 @@
 	public static String getProperty(String key, String def) {
 		final String v;
 		synchronized (_props) {
-			v = (String)_props.get(key);
+			v = _props.get(key);
 		}
 		try {
 			return v != null ? v: System.getProperty(key, def);
@@ -107,7 +107,7 @@
 		if (key.length() == 0) throw new IllegalArgumentException();
 
 		synchronized (_props) {
-			return (String)_props.put(key, value);
+			return _props.put(key, value);
 		}
 	}
 

Modified: branches/6.0/zcommon/src/org/zkoss/lang/Objects.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/Objects.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/lang/Objects.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -342,8 +342,8 @@
 			return ((String)o).toCharArray();
 
 		try {
-			Method m = o.getClass().getMethod("toCharArray", null);
-			return (char[])m.invoke(o, null);
+			Method m = o.getClass().getMethod("toCharArray");
+			return (char[])m.invoke(o);
 		} catch (Exception ex) {
 			return (o.toString()).toCharArray();
 		}
@@ -432,13 +432,13 @@
 			return o;
 
 		try {
-			final Class kls = o.getClass();
+			final Class&lt;?&gt; kls = o.getClass();
 			if (kls.isArray())
 				return ArraysX.clone(o);
 
 			if (o instanceof Cloneable) {
 				try {
-					return kls.getMethod("clone", null).invoke(o, null);
+					return kls.getMethod("clone").invoke(o);
 				} catch (NoSuchMethodException ex) {
 					if (D.ON) log.warning("No clone() for "+kls);
 				}
@@ -446,7 +446,7 @@
 
 			//:TODO: MarshalledObject is said with very bad performance, change it
 			//if exists other good deep clone method.
-			return new MarshalledObject(o).get();
+			return new MarshalledObject&lt;Object&gt;(o).get();
 		} catch (Exception ex) {
 			throw SystemException.Aide.wrap(ex);
 		}

Modified: branches/6.0/zcommon/src/org/zkoss/lang/Primitives.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/Primitives.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/lang/Primitives.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -149,44 +149,47 @@
 			this.code = code;
 		}
 	}
-	private static final Map _prims = new HashMap(23);
+	private static final
+		Map&lt;String, PrimInfo&gt; _prims2i = new HashMap&lt;String, PrimInfo&gt;(16);
+	private static final
+		Map&lt;Class, Class&gt; _primc2c = new HashMap&lt;Class, Class&gt;(16);
 	static {
-		_prims.put("int",
+		_prims2i.put("int",
 			new PrimInfo(int.class, new Integer(0), 'I'));
-		_prims.put("boolean",
+		_prims2i.put("boolean",
 			new PrimInfo(boolean.class, Boolean.FALSE, 'Z'));
-		_prims.put("short",
+		_prims2i.put("short",
 			new PrimInfo(short.class, new Short((short)0), 'S'));
-		_prims.put("byte",
+		_prims2i.put("byte",
 			new PrimInfo(byte.class, new Byte((byte)0), 'B'));
-		_prims.put("char",
+		_prims2i.put("char",
 			new PrimInfo(char.class, new Character((char)0), 'C'));
-		_prims.put("long",
+		_prims2i.put("long",
 			new PrimInfo(long.class, new Long(0), 'L'));
-		_prims.put("double",
+		_prims2i.put("double",
 			new PrimInfo(double.class, new Double(0), 'D'));
-		_prims.put("float",
+		_prims2i.put("float",
 			new PrimInfo(float.class, new Float(0), 'F'));
-		_prims.put("void",
+		_prims2i.put("void",
 			new PrimInfo(void.class, null, 'V'));
 
 		//we can use the same map because key is in diff class
-		_prims.put(Integer.class, int.class);
-		_prims.put(Boolean.class, boolean.class);
-		_prims.put(Short.class, short.class);
-		_prims.put(Byte.class, byte.class);
-		_prims.put(Character.class, char.class);
-		_prims.put(Long.class, long.class);
-		_prims.put(Double.class, double.class);
-		_prims.put(Float.class, float.class);
-		_prims.put(Void.class, void.class);
+		_primc2c.put(Integer.class, int.class);
+		_primc2c.put(Boolean.class, boolean.class);
+		_primc2c.put(Short.class, short.class);
+		_primc2c.put(Byte.class, byte.class);
+		_primc2c.put(Character.class, char.class);
+		_primc2c.put(Long.class, long.class);
+		_primc2c.put(Double.class, double.class);
+		_primc2c.put(Float.class, float.class);
+		_primc2c.put(Void.class, void.class);
 	};
 	/** Returns the notation of a primitive class,
 	 * or ((char)0) if it is not a primitive class.
 	 * Example, I for int, Z for boolean...
 	 */
 	public static final char getNotation(String className) {
-		final PrimInfo pi = (PrimInfo)_prims.get(className);
+		final PrimInfo pi = _prims2i.get(className);
 		return pi != null ? pi.code: (char)0;
 	}
 	/** Returns the default value of a primitive class,
@@ -194,7 +197,7 @@
 	 * Example, getDefaultValue(int.class) returns Integer(0).
 	 */
 	public static final Object getDefaultValue(Class cls) {
-		final PrimInfo pi = (PrimInfo)_prims.get(cls.getName());
+		final PrimInfo pi = _prims2i.get(cls.getName());
 		return pi != null ? pi.defVal: null;
 	}
 	/** Converts a primitive from name to the class,
@@ -202,7 +205,7 @@
 	 * &lt;p&gt;Example, toClass("int") returns int.class.
 	 */
 	public static final Class toClass(String clsName) {
-		final PrimInfo pi = (PrimInfo)_prims.get(clsName);
+		final PrimInfo pi = _prims2i.get(clsName);
 		return pi != null ? pi.cls: null;
 	}
 	/** Returns the primitive class of the giving wrapper class,
@@ -210,7 +213,7 @@
 	 * &lt;p&gt;Example, toPrimitive(Integer.class) returns int.class.
 	 */
 	public static final Class toPrimitive(Class wrapper) {
-		return (Class)_prims.get(wrapper);
+		return _primc2c.get(wrapper);
 	}
 	/** Returns the wrapper class of a primitive class,
 	 * or null if it is not a primitive class.
@@ -226,6 +229,6 @@
 	/** Tests whether a class name is a primitive class, e.g., int and void.
 	 */
 	public static final boolean isPrimitive(String clsName) {
-		return _prims.containsKey(clsName);
+		return _prims2i.containsKey(clsName);
 	}
 }

Modified: branches/6.0/zcommon/src/org/zkoss/lang/reflect/Fields.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/reflect/Fields.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/lang/reflect/Fields.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -115,7 +115,7 @@
 				obj.getClass(), name, null,
 				Classes.B_GET|Classes.B_PUBLIC_ONLY);
 			return 	acs instanceof Method ?
-				((Method)acs).invoke(obj, null): ((Field)acs).get(obj);
+				((Method)acs).invoke(obj): ((Field)acs).get(obj);
 		} catch (NoSuchMethodException ex) {
 			throw ex;
 		} catch (Exception ex) {

Modified: branches/6.0/zcommon/src/org/zkoss/lang/reflect/FusionInvoker.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/reflect/FusionInvoker.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/lang/reflect/FusionInvoker.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -88,7 +88,7 @@
 	 *            the objects need to wrapped
 	 */
 	public static Object newInstance(Object[] targets) {
-		Set targetClasses = new HashSet();
+		Set&lt;Class&gt; targetClasses = new HashSet&lt;Class&gt;();
 		for (int i = 0; i &lt; targets.length; i++) {
 			Class[] allClass = targets[i].getClass().getInterfaces();
 			for (int j = 0; j &lt; allClass.length; j++) {

Modified: branches/6.0/zcommon/src/org/zkoss/lang/reflect/SerializableMethod.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/reflect/SerializableMethod.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/lang/reflect/SerializableMethod.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -65,7 +65,7 @@
 	throws IOException, ClassNotFoundException {
 		s.defaultReadObject();
 
-		final Class cls = (Class)s.readObject();
+		final Class&lt;?&gt; cls = (Class&lt;?&gt;)s.readObject();
 		if (cls != null) {
 			final String nm = (String)s.readObject();
 			final int sz = s.readInt();

Modified: branches/6.0/zcommon/src/org/zkoss/mesg/MessageConst.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/mesg/MessageConst.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/mesg/MessageConst.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -54,7 +54,7 @@
 	 * the identifier such that the client will have the same code as the server.
 	 */
 	public static class Aide {
-		private static Map _bis = new HashMap(4);
+		private static Map&lt;Integer, BundleInfo&gt; _bis = new HashMap&lt;Integer, BundleInfo&gt;(4);
 
 		/** Registers a message filename, and returns an identifier to
 		 * represent it.
@@ -75,7 +75,7 @@
 			int id = getId(sID);
 			synchronized (Aide.class) {
 				Integer iID;
-				final Map bis = new HashMap(_bis);
+				final Map&lt;Integer, BundleInfo&gt; bis = new HashMap&lt;Integer, BundleInfo&gt;(_bis);
 				while (bis.containsKey(iID = new Integer(id)))
 					++id; //not determinstic
 				bis.put(iID, bi);
@@ -92,7 +92,7 @@
 		 */
 		/*package*/ static final BundleInfo getBundleInfo(int code) {
 			final int id = code &gt;&gt;&gt; 16;
-			final BundleInfo bi = (BundleInfo)_bis.get(new Integer(id));
+			final BundleInfo bi = _bis.get(new Integer(id));
 			if (bi == null)
 				throw new IllegalArgumentException("Wrong message ID: "+id
 					+" ("+code+")\nRegistered: "+_bis);

Modified: branches/6.0/zcommon/src/org/zkoss/text/DateFormats.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/text/DateFormats.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/text/DateFormats.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -57,14 +57,14 @@
 		}
 	}
 	private static final SimpleDateFormat getDateFormat() {
-		SimpleDateFormat df = (SimpleDateFormat)_df.get();
+		SimpleDateFormat df = _df.get();
 		if (df == null)
 			_df.set(df = new SimpleDateFormat(
 				"EEE MMM dd HH:mm:ss zzz yyyy", Locale.US));
 		df.setTimeZone(TimeZones.getCurrent());
 		return df;
 	}
-	private static final ThreadLocal _df = new ThreadLocal();
+	private static final ThreadLocal&lt;SimpleDateFormat&gt; _df = new ThreadLocal&lt;SimpleDateFormat&gt;();
 
 	/** Formats a Date object based on the current Locale.
 	 *

Modified: branches/6.0/zcommon/src/org/zkoss/text/MessageFormats.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/text/MessageFormats.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/text/MessageFormats.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -98,7 +98,7 @@
 	 * @see #formatByName(String, Map, Locale)
 	 */
 	public static final NameInfo parseByName(String pattern) {
-		final Map names = new LinkedHashMap();
+		final Map&lt;String,Integer&gt; names = new LinkedHashMap&lt;String,Integer&gt;();
 		final int len = pattern.length();
 		final StringBuffer sb = new StringBuffer(len + 32);
 		int j = 0;
@@ -124,7 +124,7 @@
 					break; //done
 
 				final String nm = pattern.substring(k + 1, l);
-				Integer pos = (Integer)names.get(nm);
+				Integer pos = names.get(nm);
 				if (pos == null) {
 					pos = new Integer(names.size());
 					names.put(nm, pos);
@@ -145,9 +145,9 @@
 		public final String pattern;
 		/** The name of relative position. */
 		public final String[] names;
-		NameInfo(String pattern, Collection names) {
+		NameInfo(String pattern, Collection&lt;String&gt; names) {
 			this.pattern = pattern;
-			this.names = (String[])names.toArray(new String[names.size()]);
+			this.names = names.toArray(new String[names.size()]);
 		}
 		NameInfo(String pattern, String[] names) {
 			this.pattern = pattern;

Modified: branches/6.0/zcommon/src/org/zkoss/util/ArraysX.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/ArraysX.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/util/ArraysX.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -229,6 +229,23 @@
 		return dst;
 	}
 	/**
+	 * Duplicates the specified generic array.
+	 *
+	 * &lt;p&gt;The array could be an array of objects or primiitives.
+	 *
+	 * @param ary the array
+	 * @param jb the beginning index (included)
+	 * @param je the ending index (excluded)
+	 * @return an array duplicated from ary
+	 * @exception IllegalArgumentException if ary is not any array
+	 * @exception IndexOutOfBoundsException if out of bounds
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; T[] duplicate(T[] ary, int jb, int je) {
+		return (T[])duplicate((Object)ary, jb, je);
+	}
+	/**
 	 * Duplicates the specified array.
 	 * @param ary the array
 	 * @return an array duplicated from ary
@@ -238,6 +255,17 @@
 	public static final Object duplicate(Object ary) {
 		return duplicate(ary, 0, Array.getLength(ary));
 	}
+	/**
+	 * Duplicates the specified generic array.
+	 * @param ary the array
+	 * @return an array duplicated from ary
+	 * @exception IllegalArgumentException if ary is not any array
+	 * @exception IndexOutOfBoundsException if out of bounds
+	 * @since 6.0.0
+	 */
+	public static final &lt;T&gt; T[] duplicate(T[] ary) {
+		return duplicate(ary, 0, ary.length);
+	}
 
 	/**
 	 * Concat the two specified array.
@@ -260,8 +288,23 @@
 		
 		return dst;
 	}
-	
 	/**
+	 * Concat the two specified generic array.
+	 *
+	 * &lt;p&gt;The array could be an array of objects or primiitives.
+	 *
+	 * @param ary the array
+	 * @param ary1 the array
+	 * @return an array concat the ary and ary1
+	 * @exception IllegalArgumentException if ary and ary1 component types are not compatible
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; T[] concat(T[] ary, T[] ary1) {
+		return (T[])concat((Object)ary, (Object)ary1);
+	}
+
+	/**
 	 * Shrink the specified array. It is similar to duplicate, except
 	 * it returns the previous instance if je==length &amp;&amp; jb==0.
 	 *
@@ -278,6 +321,23 @@
 		return duplicate(ary, jb, je);
 	}
 	/**
+	 * Shrink the specified array. It is similar to duplicate, except
+	 * it returns the previous instance if je==length &amp;&amp; jb==0.
+	 *
+	 * @param ary the array
+	 * @param jb the beginning index (included)
+	 * @param je the ending index (excluded)
+	 * @return ary or an array duplicated from ary
+	 * @exception IllegalArgumentException if ary is not any array
+	 * @exception IndexOutOfBoundsException if out of bounds
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; T[] shrink(T[] ary, int jb, int je) {
+		return (T[])shrink((Object)ary, jb, je);
+	}
+
+	/**
 	 * Resizes the specified array. Similar to {@link #shrink}, but
 	 * it can enlarge and it keeps elements from the first.
 	 */
@@ -290,6 +350,24 @@
 		System.arraycopy(ary, 0, dst, 0, oldsz &gt; size ? size: oldsz);
 		return dst;
 	}
+	/**
+	 * Resizes the specified generic array.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; T[] resize(T[] ary, int size) {
+		return (T[])resize((Object)ary, size);
+	}
+	/**
+	 * Instantiates an array of the given type and size.
+	 * It is the same as &lt;code&gt;new T[size]&lt;/code&gt; (but Java doesn't allow).
+	 * @since (not public yet)
+	 */
+//	@SuppressWarnings("unchecked")
+//	public static final &lt;T&gt; T[] newInstance(Class&lt;T&gt; c, int size) {
+//		return (T[])Array.newInstance(c, size);
+//	}
+
 	/** Clones an array.
 	 */
 	public static final Object clone(Object ary) {

Modified: branches/6.0/zcommon/src/org/zkoss/util/Cache.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/Cache.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/util/Cache.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -23,21 +23,21 @@
  * @author tomyeh
  * @since 3.0.0
  */
-public interface Cache {
+public interface Cache&lt;K,V&gt; {
 	/** Returns whether the specified key is stored.
 	 */
 	public boolean containsKey(Object key);
 	/** Returns the object of the specified key, or null if not found.
 	 */
-	public Object get(Object key);
+	public V get(Object key);
 	/** Stores an object to the cache.
 	 * @return the previous value of the same, or null if no such value
 	 */
-	public Object put(Object key, Object value);
+	public V put(K key, V value);
 	/** Removes an object from the cache.
 	 * @return the object if found.
 	 */
-	public Object remove(Object key);
+	public V remove(Object key);
 	/** Clears all objects being cached.
 	 */
 	public void clear();

Modified: branches/6.0/zcommon/src/org/zkoss/util/CacheMap.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/CacheMap.java	2010-09-09 02:46:23 UTC (rev 14271)
+++ branches/6.0/zcommon/src/org/zkoss/util/CacheMap.java	2010-09-10 05:39:26 UTC (rev 14272)
@@ -41,9 +41,8 @@
  * {@link #shallExpunge}.
  *
  * &lt;p&gt;If the criteria is totally independent of GC, you could override
- * {@link #newQueue} to return null. Then, {@link #shallExpunge}
- * always returns true (rather than when GC is activated) -- of course,
- * you could override {@link #shallExpunge}, too.
+ * {@link #shallExpunge} to always return true
+ * (rather than when GC is activated).
  *
  * &lt;p&gt;It is different from WeakHashMap:
  *
@@ -68,20 +67,20 @@
  *
  * @author tomyeh
  */
-public class CacheMap implements Map, Cache, java.io.Serializable, Cloneable {
+public class CacheMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cache&lt;K,V&gt;, java.io.Serializable, Cloneable {
     private static final long serialVersionUID = 20070907L;
 	//private static final Log log = Log.lookup(CacheMap.class);
 
 	/** The map to store the mappings. */
-	private Map _map; //it is OK to serialized
+	private Map&lt;K, Value&lt;V&gt;&gt; _map; //it is OK to serialized
 	/** The minimal lifetime. */
 	private int _lifetime = DEFAULT_LIFETIME;
 	/** The maximal allowed size. */
 	private int _maxsize = DEFAULT_MAX_SIZE;
 	/** The reference queue. */
-	private transient ReferenceQueue _que;
+	private transient ReferenceQueue&lt;X&gt; _que;
 	/** The reference. */
-	private transient WeakReference _ref;
+	private transient WeakReference&lt;X&gt; _ref;
 	/** A flag used for debug purpose. */
 	private transient boolean _inExpunge;
 
@@ -89,12 +88,12 @@
 	private static class X {
 	}
 	/** The class to hold key/value. */
-	protected static final class Value implements java.io.Serializable, Cloneable {
-		private Object value;
+	protected static final class Value&lt;V&gt; implements java.io.Serializable, Cloneable {
+		private V value;
 		private long access; //when the mapping is accessed
 
 		/** Creates an instance to store in the map. */
-		private Value(Object value) {
+		private Value(V value) {
 			this.value = value;
 			updateAccessTime();
 		}
@@ -105,7 +104,7 @@
 
 		//-- utilities--//
 		/** Returns the value. */
-		public final Object getValue() {
+		public final V getValue() {
 			return this.value;
 		}
 		/** Returns the last access time. */
@@ -155,9 +154,9 @@
 	 * Once shallExpunge returns true, values are examined one-by-one thru
 	 * {@link #canExpunge}, and expunged if EXPUNGE_YES.
 	 *
-	 * &lt;p&gt;This implementation returns true only if {@link #newQueue}
-	 * returns null (in constructor) or GC was activated.
-	 * You might override it to enforce expunge besides GC.
+	 * &lt;p&gt;This implementation returns true only if GC was activated.
+	 * You might override it to return true, such that expunge is enforced
+	 * no matter GC was activated.
 	 *
 	 * @see #canExpunge
 	 */
@@ -221,9 +220,8 @@
 		_inExpunge = true;
 		try {
 			//dennis, bug 1815633, remove some control code here 
-			
-			for (final Iterator it = _map.values().iterator();it.hasNext();) {
-				final Value v = (Value)it.next();
+			for (final Iterator&lt;Value&lt;V&gt;&gt; it = _map.values().iterator();it.hasNext();) {
+				final Value&lt;V&gt; v = it.next();
 				final int result = canExpunge(v);
 				if ((result &amp; EXPUNGE_YES) != 0) {
 					//if (D.ON &amp;&amp; log.debugable())
@@ -241,25 +239,11 @@
 			_inExpunge = false;
 		}
 	}
-	/** Creates the reference queue.
-	 * It is called only once in the constructor (so it is meaningless
-	 * to change the returned value after constructed).
-	 *
-	 * &lt;p&gt;Default: new ReferenceQueue();&lt;br&gt;
-	 * Override this method to return null if you want to expunge items
-	 * every time {@link #get} or {@link #put} is called -- not only GC
-	 * is activated.
-	 * In other words, if {@link #newQueue} returns null, {@link #shallExpunge}
-	 * always returns true (unless you override it too).
-	 */
-	protected ReferenceQueue newQueue() {
-		return new ReferenceQueue();
-	}
 	/** Re-create the reference so we can detect if GC was activated.
 	 */
 	private void newRef() {
 		if (_que != null)
-			_ref = new WeakReference(new X(), _que);
+			_ref = new WeakReference&lt;X&gt;(new X(), _que);
 	}
 
 	//-- constructors --//
@@ -274,24 +258,24 @@
 	/** Constructs a cachemap by using LinkedHashMap internally.
 	 */
 	public CacheMap() {
-		_map = new LinkedHashMap(16, 0.75f, true);
+		_map = new LinkedHashMap&lt;K, Value&lt;V&gt;&gt;(16, 0.75f, true);
 		init();
 	}
 	/** Constructs a cachemap by using LinkedHashMap internally.
 	 */
 	public CacheMap(int cap) {
-		_map = new LinkedHashMap(cap, 0.75f, true);
+		_map = new LinkedHashMap&lt;K, Value&lt;V&gt;&gt;(cap, 0.75f, true);
 		init();
 	}
 	/** Constructs a cachemap by using LinkedHashMap internally.
 	 */
 	public CacheMap(int cap, float load) {
-		_map = new LinkedHashMap(cap, load, true);
+		_map = new LinkedHashMap&lt;K, Value&lt;V&gt;&gt;(cap, load, true);
 		init();
 	}
 	/** Initialization for contructor and de-serialized. */
 	private void init() {
-		_que = newQueue();
+		_que = new ReferenceQueue&lt;X&gt;();
 		newRef();
 	}
 
@@ -331,16 +315,6 @@
 	public void setMaxSize(int maxsize) {
 		_maxsize = maxsize;
 	}
-	/**
-	 * Gets the last accessed time, in system millisecs.
-	 * @return the last accessed time; 0 if not found
-	 */
-	/* To support this method, we cannot use access-ordered for _map
-		Then, get() and put() shall use remove and add
-	public final long getLastAccessTime(Object key) {
-		final Value v = (Value)_map.get(key);
-		return v != null ? v.access: 0;
-	}*/
 
 	//-- Map --//
 	public boolean isEmpty() {
@@ -367,20 +341,20 @@
 		_map.clear();
 	}
 
-	public Object remove(Object key) {
+	public V remove(Object key) {
 		tryExpunge();
-		final Value v = (Value)_map.remove(key);
+		final Value&lt;V&gt; v = _map.remove(key);
 		return v != null ? v.value: null;
 	}
-	public Object get(Object key) {
+	public V get(Object key) {
 		tryExpunge();
 		return getWithoutExpunge(key);
 	}
 	/** Returns the value without trying to expunge first.
 	 * It is useful if you want to preserve all entries.
 	 */
-	public Object getWithoutExpunge(Object key) {
-		final Value v = (Value)_map.get(key); //re-order
+	public V getWithoutExpunge(Object key) {
+		final Value&lt;V&gt; v = _map.get(key); //re-order
 		if (v != null) {
 			v.updateAccessTime();

@@ Diff output truncated at 100000 characters. @@

This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26163718">[zk1-subversion-log] SF.net SVN: zk1:[14276] branches</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-15 05:42</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14276
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14276&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14276&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-15 05:41:58 +0000 (Wed, 15 Sep 2010)

Log Message:
-----------
Wed 09/15/2010

Modified Paths:
--------------
    branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java
    branches/6.0/zcommon/src/org/zkoss/idom/Element.java
    branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java
    branches/6.0/zcommon/src/org/zkoss/json/JSONArray.java
    branches/6.0/zcommon/src/org/zkoss/json/JSONObject.java
    branches/6.0/zcommon/src/org/zkoss/lang/Exceptions.java
    branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
    branches/6.0/zcommon/src/org/zkoss/util/Maps.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/ContentLoader.java
    branches/6.0/zcommon/src/org/zkoss/xel/ExpressionFactory.java
    branches/6.0/zcommon/src/org/zkoss/xel/Expressions.java
    branches/6.0/zcommon/src/org/zkoss/xel/util/Evaluators.java
    branches/6.0/zk/src/org/zkoss/zk/au/AuDecoder.java
    branches/6.0/zk/src/org/zkoss/zk/au/AuRequests.java
    branches/6.0/zk/src/org/zkoss/zk/au/AuResponse.java
    branches/6.0/zk/src/org/zkoss/zk/au/http/AuDynaMediar.java
    branches/6.0/zk/src/org/zkoss/zk/au/http/AuUploader.java
    branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
    branches/6.0/zk/src/org/zkoss/zk/au/http/UploadInfoService.java
    branches/6.0/zk/src/org/zkoss/zk/au/http/ZkFileItemFactory.java
    branches/6.0/zk/src/org/zkoss/zk/au/out/AuEcho.java
    branches/6.0/zk/src/org/zkoss/zk/au/out/AuEchoGlobal.java
    branches/6.0/zk/src/org/zkoss/zk/device/Devices.java
    branches/6.0/zk/src/org/zkoss/zk/scripting/Interpreter.java
    branches/6.0/zk/src/org/zkoss/zk/scripting/Interpreters.java
    branches/6.0/zk/src/org/zkoss/zk/scripting/bsh/BSHInterpreter.java
    branches/6.0/zk/src/org/zkoss/zk/scripting/util/GenericInterpreter.java
    branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
    branches/6.0/zk/src/org/zkoss/zk/ui/AbstractPage.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Components.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Execution.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Executions.java
    branches/6.0/zk/src/org/zkoss/zk/ui/HtmlMacroComponent.java
    branches/6.0/zk/src/org/zkoss/zk/ui/HtmlNativeComponent.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Page.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Sessions.java
    branches/6.0/zk/src/org/zkoss/zk/ui/event/GenericEventListener.java
    branches/6.0/zk/src/org/zkoss/zk/ui/event/SelectEvent.java
    branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/DesktopEventQueue.java
    branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/EventQueueProviderImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/ServerPushEventQueue.java
    branches/6.0/zk/src/org/zkoss/zk/ui/ext/Native.java
    branches/6.0/zk/src/org/zkoss/zk/ui/ext/Scopes.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/AbstractExtendlet.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutPortlet.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/ExecutionImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/FileWcsExtendlet.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/SimpleSession.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/SimpleWebApp.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/Utils.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/WcsExtendlet.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/WebManager.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/WpdExtendlet.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/Wpds.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/ZumlExtendlet.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/AbstractExecution.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/DesktopImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/EventInterceptors.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/EventProcessor.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/Initiators.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/PhantomExecution.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/PollingServerPush.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/RequestQueueImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/SimpleDesktopCache.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/SimpleIdSpace.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiVisualizer.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/AttributesInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/ComponentDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/ComponentInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/FunctionMapperInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/HeaderInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/InitiatorInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/PageEvalRef.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Parser.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Property.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/VariableResolverInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/VariablesInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/WidgetDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/ZScript.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/impl/AnnotationHelper.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/impl/ComponentDefinitionImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/impl/MacroDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/impl/NativeDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/impl/WidgetDefinitionImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/ComponentRedraws.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/ComponentsCtrl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/ConfigParser.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/ExecutionCtrl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/ExecutionsCtrl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/HtmlPageRenders.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/Names.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageConfig.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/RequestQueue.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/UiEngine.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/Visualizer.java
    branches/6.0/zk/src/org/zkoss/zk/ui/util/Composition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/util/Configuration.java
    branches/6.0/zk/src/org/zkoss/zk/ui/util/ForEachImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/util/GenericAutowireComposer.java
    branches/6.0/zk/src/org/zkoss/zk/ui/util/Initiator.java
    branches/6.0/zk/src/org/zkoss/zk/ui/util/ThemeProvider.java
    branches/6.0/zk/src/org/zkoss/zk/xel/Evaluators.java
    branches/6.0/zk/src/org/zkoss/zk/xel/impl/SimpleEvaluator.java
    branches/6.0/zk/src/org/zkoss/zk/xel/impl/Utils.java
    branches/6.0/zkdoc/release-note
    branches/6.0/zweb/src/org/zkoss/web/servlet/xel/AttributesMap.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/xel/ParameterMap.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestScope.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestXelResolver.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/xel/StringKeysMap.java

Added Paths:
-----------
    branches/6.0/zcommon/src/org/zkoss/lang/Generics.java

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -379,6 +379,7 @@
 
 			final String macroURI = el.getElementValue("macro-uri", true);
 			final ComponentDefinitionImpl compdef;
+			boolean extend = false;
 			if (macroURI != null &amp;&amp; macroURI.length() != 0) {
 				if (log.finerable()) log.finer("macro component definition: "+name);
 
@@ -395,6 +396,8 @@
 				compdef.setDeclarationURL(url);
 				langdef.addComponentDefinition(compdef);
 			} else if (el.getElement("extends") != null) { //extends
+				extend = true;
+
 				final String extnm = el.getElementValue("extends", true);
 				if (log.finerable()) log.finer("Extends component definition, "+name+", from "+extnm);
 				final ComponentDefinition ref = langdef.getComponentDefinitionIfAny(extnm);
@@ -447,6 +450,8 @@
 
 			String wgtnm = el.getElementValue("widget-class", true);
 			WidgetDefinition wgtdef = null;
+			if (wgtnm == null &amp;&amp; extend)
+				wgtnm = compdef.getDefaultWidgetClass();
 			if (wgtnm != null) {
 				if (!withEL(wgtnm))
 					wgtdef = getWidgetDefinition(langdef, compdef, wgtnm);

Modified: branches/6.0/zcommon/src/org/zkoss/idom/Element.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/Element.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/idom/Element.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -36,10 +36,10 @@
 import org.w3c.dom.NamedNodeMap;
 import org.w3c.dom.TypeInfo;
 
+import static org.zkoss.lang.Generics.cast;
 import org.zkoss.mesg.Messages;
 import org.zkoss.mesg.MCommon;
 import org.zkoss.util.NotableLinkedList;
-import org.zkoss.util.CollectionsX;
 import org.zkoss.xml.FacadeNodeList;
 import org.zkoss.idom.impl.*;
 
@@ -241,7 +241,7 @@
 			final Collection c = (Collection)obj;
 			final Iterator it = c.iterator();
 			if (it.hasNext() &amp;&amp; (it.next() instanceof Item)) {
-				final Collection&lt;Item&gt; ci = CollectionsX.generic(c);
+				final Collection&lt;Item&gt; ci = cast(c);
 				getChildren().addAll(ci);
 				return null; //done
 			}

Modified: branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -24,6 +24,7 @@
 import org.zkoss.mesg.MCommon;
 import org.zkoss.lang.Objects;
 import org.zkoss.lang.Strings;
+import static org.zkoss.lang.Generics.cast;
 import org.zkoss.lang.SystemException;
 import org.zkoss.util.Maps;
 import org.zkoss.idom.impl.*;
@@ -127,7 +128,7 @@
 			return Collections.emptyMap();
 		}
 
-		map = Maps.parse(map, rawData, ' ', (char)1); //both ' and "
+		map = cast(Maps.parse(map, rawData, ' ', (char)1)); //both ' and "
 
 		//&amp;quot; and other are not processed by SAXHandler,
 		//so we have to handle them here

Modified: branches/6.0/zcommon/src/org/zkoss/json/JSONArray.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/json/JSONArray.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/json/JSONArray.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -14,7 +14,7 @@
  * 
  * @author FangYidong&lt;fangyidong@...&gt;
  */
-public class JSONArray extends LinkedList implements List, JSONAware {
+public class JSONArray extends LinkedList&lt;Object&gt; implements List&lt;Object&gt;, JSONAware {
 	private static final long serialVersionUID = 3957988303675231981L;
 
 	/**

Modified: branches/6.0/zcommon/src/org/zkoss/json/JSONObject.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/json/JSONObject.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/json/JSONObject.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -14,7 +14,7 @@
  * 
  * @author FangYidong&lt;fangyidong@...&gt;
  */
-public class JSONObject extends LinkedHashMap implements Map, JSONAware {
+public class JSONObject extends LinkedHashMap&lt;String, Object&gt; implements Map&lt;String, Object&gt;, JSONAware {
 	private static final long serialVersionUID = -503443796854799292L;
 	
 	/**

Modified: branches/6.0/zcommon/src/org/zkoss/lang/Exceptions.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/Exceptions.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/lang/Exceptions.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -41,7 +41,7 @@
 	 *
 	 * @return the cause if found; null if not found
 	 */
-	public static final Throwable findCause(Throwable ex, Class cause) {
+	public static final Throwable findCause(Throwable ex, Class&lt;?&gt; cause) {
 		while (ex != null) {
 			if (cause.isInstance(ex))
 				return ex;
@@ -153,7 +153,7 @@
 	 * @see SystemException.Aide#wrap
 	 */
 	public static final
-	Throwable wrap(Throwable ex, Class targetExceptCls) {
+	Throwable wrap(Throwable ex, Class&lt;? extends Throwable&gt; targetExceptCls) {
 		ex = myToAnother(ex, targetExceptCls);
 		if (targetExceptCls.isInstance(ex))
 			return ex;
@@ -168,7 +168,7 @@
 		}
 	}
 	private static final Throwable
-	myToAnother(Throwable ex, Class targetExceptCls) {
+	myToAnother(Throwable ex, Class&lt;? extends Throwable&gt; targetExceptCls) {
 		assert D.OFF || ex != null: "null exception";
 
 		if (ex instanceof InvocationTargetException)
@@ -197,7 +197,7 @@
 	 * the constructor: &lt;code&gt;MyException(String msg, Throwable cause);&lt;/code&gt;
 	 */
 	public static final
-	Throwable wrap(Throwable ex, Class targetExceptCls, String msg) {
+	Throwable wrap(Throwable ex, Class&lt;? extends Throwable&gt; targetExceptCls, String msg) {
 		ex = myToAnother(ex, targetExceptCls);
 		if (targetExceptCls.isInstance(ex))
 			return ex;
@@ -220,7 +220,7 @@
 	 * &lt;code&gt;MyException(int code, Object[] fmtArgs, Throwable cause);&lt;/code&gt;
 	 */
 	public static final Throwable
-	wrap(Throwable ex, Class targetExceptCls, int code, Object[] fmtArgs) {
+	wrap(Throwable ex, Class&lt;? extends Throwable&gt; targetExceptCls, int code, Object[] fmtArgs) {
 		ex = myToAnother(ex, targetExceptCls);
 		if (targetExceptCls.isInstance(ex))
 			return ex;
@@ -243,7 +243,7 @@
 	 * &lt;code&gt;MyException(int code, Object fmtArgs, Throwable cause);&lt;/code&gt;
 	 */
 	public static final Throwable
-	wrap(Throwable ex, Class targetExceptCls, int code, Object fmtArg) {
+	wrap(Throwable ex, Class&lt;? extends Throwable&gt; targetExceptCls, int code, Object fmtArg) {
 		ex = myToAnother(ex, targetExceptCls);
 		if (targetExceptCls.isInstance(ex))
 			return ex;
@@ -266,7 +266,7 @@
 	 * &lt;code&gt;MyException(int code, Throwable cause);&lt;/code&gt;
 	 */
 	public static final Throwable
-	wrap(Throwable ex, Class targetExceptCls, int code) {
+	wrap(Throwable ex, Class&lt;? extends Throwable&gt; targetExceptCls, int code) {
 		ex = myToAnother(ex, targetExceptCls);
 		if (targetExceptCls.isInstance(ex))
 			return ex;

Added: branches/6.0/zcommon/src/org/zkoss/lang/Generics.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/Generics.java	                        (rev 0)
+++ branches/6.0/zcommon/src/org/zkoss/lang/Generics.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -0,0 +1,76 @@
+/* Generics.java
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Tue Sep 14 18:03:59 TST 2010, Created by tomyeh
+
+Copyright (C) 2009 Potix Corporation. All Rights Reserved.
+
+*/
+package org.zkoss.lang;
+
+import java.util.*;
+
+/**
+ * Utilities to handle generic types, such as converting a non-type object
+ * to a generic type without warning.
+ *
+ * @author tomyeh
+ * @since 6.0.0
+ */
+public class Generics {
+	/** Returns a type-safe generic class of the given type-less class.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; Class&lt;T&gt; cast(Class cls) {
+		return (Class&lt;T&gt;)cls;
+	}
+
+	/** Returns a type-safe generic iterator of the given un-typed iterator.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; Iterator&lt;T&gt; cast(Iterator it) {
+		return it;
+	}
+	/** Returns a type-safe generic enumeration of the given un-typed enumeration.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; Enumeration&lt;T&gt; cast(Enumeration en) {
+		return en;
+	}
+
+	/** Returns a type-safe generic collection of the given un-typed collection.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; Collection&lt;T&gt; cast(Collection col) {
+		return col;
+	}
+	/** Returns a type-safe generic list of the given un-typed list.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; List&lt;T&gt; cast(List list) {
+		return list;
+	}
+	/** Returns a type-safe generic set of the given un-typed set.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; Set&lt;T&gt; cast(Set set) {
+		return set;
+	}
+	/** Returns a type-safe generic map of the given un-typed map.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;K, V&gt; Map&lt;K, V&gt; cast(Map map) {
+		return map;
+	}
+}

Modified: branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -37,35 +37,6 @@
  * @see java.util.Collections
  */
 public class CollectionsX {
-	/** Returns a type-safe generic collection of the given un-typed collection.
-	 * @since 6.0.0
-	 */
-	@SuppressWarnings("unchecked")
-	public static final &lt;T&gt; Collection&lt;T&gt; generic(Collection col) {
-		return col;
-	}
-	/** Returns a type-safe generic list of the given un-typed list.
-	 * @since 6.0.0
-	 */
-	@SuppressWarnings("unchecked")
-	public static final &lt;T&gt; List&lt;T&gt; generic(List list) {
-		return list;
-	}
-	/** Returns a type-safe generic set of the given un-typed set.
-	 * @since 6.0.0
-	 */
-	@SuppressWarnings("unchecked")
-	public static final &lt;T&gt; Set&lt;T&gt; generic(Set set) {
-		return set;
-	}
-	/** Returns a type-safe generic map of the given un-typed map.
-	 * @since 6.0.0
-	 */
-	@SuppressWarnings("unchecked")
-	public static final &lt;K, V&gt; Map&lt;K, V&gt; generic(Map map) {
-		return map;
-	}
-
 	/** An enumeration on top of a collection or iterator.
 	 */
 	public static final class CollectionEnumeration&lt;E&gt; implements Enumeration&lt;E&gt; {

Modified: branches/6.0/zcommon/src/org/zkoss/util/Maps.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/Maps.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/util/Maps.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -16,6 +16,7 @@
 */
 package org.zkoss.util;
 
+import java.util.Collection;
 import java.util.List;
 import java.util.LinkedList;
 import java.util.Map;
@@ -92,7 +93,7 @@
 	 * @param caseInsensitive whether the key used to access the map
 	 * is case-insensitive. If true, all keys are converted to lower cases.
 	 */
-	public final static void load(Map&lt;String, String&gt; map, InputStream sm, String charset,
+	public final static void load(Map&lt;? super String, ? super String&gt; map, InputStream sm, String charset,
 	boolean caseInsensitive) throws IOException {
 		final PushbackInputStream pis = new PushbackInputStream(sm, 3);
 		if (charset == null || charset.startsWith("UTF")) {
@@ -206,7 +207,7 @@
 	 * Reads a property list (key and element pairs) from the input stream,
 	 * by specifying the charset.
 	 */
-	public final static void load(Map&lt;String, String&gt; map, InputStream sm, String charset)
+	public final static void load(Map&lt;? super String, ? super String&gt; map, InputStream sm, String charset)
 	throws IOException {
 		load(map, sm, charset, false);
 	}
@@ -217,14 +218,14 @@
 	 * @param caseInsensitive whether the key used to access the map
 	 * is case-insensitive. If true, all keys are converted to lower cases.
 	 */
-	public final static void load(Map&lt;String, String&gt; map, InputStream sm,
+	public final static void load(Map&lt;? super String, ? super String&gt; map, InputStream sm,
 	boolean caseInsensitive) throws IOException {
 		load(map, sm, null, caseInsensitive);
 	}
 	/** Reads a property list (key and element pairs) from the input stream,
 	 * by detecting correct charset.
 	 */
-	public final static void load(Map&lt;String, String&gt; map, InputStream sm) throws IOException {
+	public final static void load(Map&lt;? super String, ? super String&gt; map, InputStream sm) throws IOException {
 		load(map, sm, null, false);
 	}
 
@@ -233,29 +234,29 @@
 	 * It is the same as&lt;br/&gt;
 	 * &lt;pre&gt;&lt;code&gt;parse(map, src, separator, quote, false, false, false);&lt;/code&gt;&lt;/pre&gt;
 	 *
-	 * @see #parse(Map, String, char, char, boolean, boolean, boolean)
+	 * @see #parse(Map, String, char, char, boolean, boolean)
+	 * @see #parseMultiple
 	 */
 	@SuppressWarnings("unchecked")
-	public static final Map&lt;String, String&gt; 
-	parse(Map&lt;String, String&gt; map, String src, char separator, char quote)
+	public static final Map&lt;? super String, ? super String&gt; 
+	parse(Map&lt;? super String, ? super String&gt; map, String src, char separator, char quote)
 	throws IllegalSyntaxException {
-		return (Map&lt;String,String&gt;)
-			parse(map, src, separator, quote, false, false, false);
+		return parse0(map, src, separator, quote, false, false, false);
 	}
 	/**
 	 * Parses a string into a map.
 	 * It is the same as&lt;br/&gt;
 	 * &lt;pre&gt;&lt;code&gt;parse(map, src, separator, quote, asValue, false, false);&lt;/code&gt;&lt;/pre&gt;
 	 *
-	 * @see #parse(Map, String, char, char, boolean, boolean, boolean)
+	 * @see #parse(Map, String, char, char, boolean, boolean)
+	 * @see #parseMultiple
 	 * @since 2.4.0
 	 */
 	@SuppressWarnings("unchecked")
-	public static final Map&lt;String, String&gt; 
-	parse(Map&lt;String, String&gt; map, String src, char separator, char quote, boolean asValue)
+	public static final Map&lt;? super String, ? super String&gt; 
+	parse(Map&lt;? super String, ? super String&gt; map, String src, char separator, char quote, boolean asValue)
 	throws IllegalSyntaxException {
-		return (Map&lt;String,String&gt;)
-			parse(map, src, separator, quote, asValue, false, false);
+		return parse0(map, src, separator, quote, asValue, false, false);
 	}
 	/**
 	 * Parse a string into a map.
@@ -295,31 +296,101 @@
 	 * as a value. For example, 'a12' is considered as a value no matter
 	 * asValue is true or not.
 
-	 * @param multiple whehter to use List to store the values if
-	 * there are multiple entries with the same name.
-	 * For example, src is a1=x,a1=y, then, if multiple is true,
+	 * @param parenthesis whether to parse parenthesis in the value, {}, () and [].
+	 * If true, the separator is ignored inside the parenthesis.
+	 * Specify true if the value might contain EL expressions.
+	 * Note: it has no effect to the name.
+
+	 * @return the map being generated.
+	 *
+	 * @exception IllegalSyntaxException if syntax errors
+	 * @see CollectionsX#parse
+	 * @see #toString(Map, char, char)
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final Map&lt;? super String, ? super String&gt;
+	parse(Map&lt;? super String, ? super String&gt; map,
+	String src, char separator, char quote, boolean asValue,
+	boolean parenthesis) throws IllegalSyntaxException {
+		return parse0(map, src, separator, quote, asValue, parenthesis, false);
+	}
+	/**
+	 * Parse a string into a map that allows multiple values.
+	 * &lt;p&gt;Unlike {@link #parse}, it assumes there might be multiple values.
+	 * Thus, the value of the map is a collection of String instances.
+	 * For example, src is a1=x,a1=y, then
 	 * the value for a1 is a list with two values, "x" and "y".
-	 * If multiple is false, the later one overwrites the former one and
-	 * the value for a1 in the above example is "y".
-	 * Note: if no replication, the value is always a String instance
-	 * (or null if not specified).
+	 *
+	 * &lt;p&gt;If = is omitted, whether it is considered as a key with the null
+	 * value or a value with the null key depends on
+	 * the asValue argument. If true, it is considered as a value with
+	 * the null key.
+	 *
+	 * &lt;p&gt;For example, if the following string is parsed with asValue=false:&lt;br/&gt;
+	 * a12=12,b3,c6=abc=125,x=y
+	 *
+	 * &lt;p&gt;Then, a map with the following content is returned:&lt;br/&gt;
+	 * ("a12", "12"), ("b3", null), ("c6", "abc=125"), ("x", "y")
+	 *
+	 * &lt;p&gt;Notice: only the first = after separator is meaningful,
+	 * so you don't have to escape the following =.
+	 * &lt;p&gt;Beside specifying the quote character, you could use backslash
+	 * quote a single character (as Java does).
+	 *
+	 * @param map the map to put parsed results to; null to create a
+	 * new hash map.
+	 * @param src the string to parse
+	 * @param separator the separator, e.g., ' ' or ','.
 
+	 * @param quote the quote character to surround the value.
+	 * Ingored if quote is (char)0.&lt;br/&gt;
+	 * Since 3.6.0: if quote is (char)1, then both ' and " are accepted.&lt;/br&gt;
+	 * For example, a1='b c' will generate a map entry, ("a1", "b c") if
+	 * quote is '\''.&lt;br/&gt;
+	 * Note: the quote is taken off before storing to the map.&lt;br/&gt;
+	 * Note: the quote can &lt;i&gt;not&lt;/i&gt; be used to surround the name
+
+	 * @param asValue whether to consider the substring without = as
+	 * a value (with the null key), or as a key (with the null value)
+	 * For example, a12 is considered as a key if asValue is false.
+	 * However, if you surround it with a quote, it is always considered
+	 * as a value. For example, 'a12' is considered as a value no matter
+	 * asValue is true or not.
+
 	 * @param parenthesis whether to parse parenthesis in the value, {}, () and [].
 	 * If true, the separator is ignored inside the parenthesis.
 	 * Specify true if the value might contain EL expressions.
 	 * Note: it has no effect to the name.
 
-	 * @return the map being generated. If multiple, the value might be
+	 * @return the map being generated. The value of the map is
 	 * a list of String objects (List&amp;lt;String&amp;gt;).
 	 *
 	 * @exception IllegalSyntaxException if syntax errors
 	 * @see CollectionsX#parse
 	 * @see #toString(Map, char, char)
-	 * @since 3.0.6
+	 * @since 6.0.0
 	 */
+	@SuppressWarnings("unchecked")
+	public static final Map&lt;? super String, Collection&lt;String&gt;&gt;
+	parseMultiple(Map&lt;? super String, Collection&lt;String&gt;&gt; map,
+	String src, char separator, char quote, boolean asValue,
+	boolean parenthesis) throws IllegalSyntaxException {
+		return parse0(map, src, separator, quote, asValue, parenthesis, true);
+	}
+	/** @deprecated As of release 6.0.0, replaced with
+	 * {@link #parse(Map, String, char, char, boolean, boolean)} and
+	 * {@link #parseMultiple}
+	 */
 	public static final Map
 	parse(Map map, String src, char separator, char quote, boolean asValue,
-	boolean multiple, boolean parenthesis)
+	boolean multiple, boolean parenthesis) throws IllegalSyntaxException {
+		return parse0(map, src, separator, quote, asValue, parenthesis, multiple);
+	}
+	
+	private static final Map
+	parse0(Map map, String src, char separator, char quote, boolean asValue,
+	boolean parenthesis, boolean multiple)
 	throws IllegalSyntaxException {
 		if (separator == (char)0)
 			throw new IllegalArgumentException("Separator cannot be 0");
@@ -421,17 +492,13 @@
 	}
 	@SuppressWarnings("unchecked")
 	private static void put(Map map, String name, String value, boolean multiple) {
-		Object o = map.put(name, value);
-		if (multiple &amp;&amp; o != null) {
-			if (o instanceof List) {
-				((List&lt;String&gt;)o).add(value);
-				map.put(name, o);
-			} else {
-				final List&lt;String&gt; l = new LinkedList&lt;String&gt;();
-				l.add((String)o);
-				l.add(value);
-				map.put(name, l);
-			}
+		if (multiple) {
+			List l = (List)map.get(name);
+			if (l == null)
+				map.put(name, l = new LinkedList());
+			l.add(value);
+		} else {
+			map.put(name, value);
 		}
 	}
 	private static final IllegalSyntaxException
@@ -528,7 +595,7 @@
 	 * @param separator the separator between two name=value pairs
 	 * @see #parse(Map, String, char, char)
 	 */
-	public static final String toString(Map&lt;String, String&gt; map, char quote, char separator) {
+	public static final String toString(Map&lt;? super String, ? super String&gt; map, char quote, char separator) {
 		return toStringBuffer(new StringBuffer(64), map, quote, separator)
 			.toString();
 	}
@@ -536,7 +603,7 @@
 	 * @see #toString
 	 */
 	public static final StringBuffer
-	toStringBuffer(StringBuffer sb, Map&lt;String, String&gt; map, char quote, char separator) {
+	toStringBuffer(StringBuffer sb, Map&lt;? super String, ? super String&gt; map, char quote, char separator) {
 		if (separator == (char)0)
 			throw new IllegalArgumentException("Separator cannot be 0");
 		if (map.isEmpty())

Modified: branches/6.0/zcommon/src/org/zkoss/util/resource/ContentLoader.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/resource/ContentLoader.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/util/resource/ContentLoader.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -32,9 +32,9 @@
  *
  * @author tomyeh
  */
-public class ContentLoader extends AbstractLoader {
+public class ContentLoader extends AbstractLoader&lt;Object, String&gt; {
 	//-- Loader --//
-	public Object load(Object src) throws Exception {
+	public String load(Object src) throws Exception {
 		final InputStream is;
 		if (src instanceof URL) {
 			is = ((URL)src).openStream();
@@ -48,7 +48,7 @@
 		try {
 			return Files.readAll(new InputStreamReader(is, "UTF-8")).toString();
 		} finally {
-			try {is.close();} catch (Throwable ex) {}
+			Files.close(is);
 		}
 	}
 }

Modified: branches/6.0/zcommon/src/org/zkoss/xel/ExpressionFactory.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/ExpressionFactory.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/xel/ExpressionFactory.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -48,7 +48,7 @@
 	 * @param expectedType the expected type of the result of the evaluation
 	 */
 	public Expression parseExpression(XelContext ctx, String expression,
-	Class expectedType)
+	Class&lt;?&gt; expectedType)
 	throws XelException;
 	/** Evaluates an expression.
 	 *
@@ -61,6 +61,6 @@
 	 * @param expectedType the expected type of the result of the evaluation
 	 */
 	public Object evaluate(XelContext ctx, String expression,
-	Class expectedType)
+	Class&lt;?&gt; expectedType)
 	throws XelException;
 }

Modified: branches/6.0/zcommon/src/org/zkoss/xel/Expressions.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/Expressions.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/xel/Expressions.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -47,7 +47,7 @@
 	public static final Expression DUMMY_EXPRESSION = new DummyExpr();
 
 	/** The implemetation of {@link ExpressionFactory}. */
-	private static Class _expfcls;
+	private static Class&lt;? extends ExpressionFactory&gt; _expfcls;
 
 	/** Instantiates an instance of {@link ExpressionFactory}.
 	 *
@@ -79,12 +79,12 @@
 	 * @exception XelException if the specified class failed to load,
 	 * or instantiate.
 	 */
-	public static final ExpressionFactory newExpressionFactory(Class expfcls) {
+	public static final ExpressionFactory newExpressionFactory(Class&lt;? extends ExpressionFactory&gt; expfcls) {
 		if (expfcls == null)
 			expfcls = _expfcls;
 		if (expfcls != null) {
 			try {
-				return (ExpressionFactory)expfcls.newInstance();
+				return expfcls.newInstance();
 			} catch (Throwable ex) {
 				throw XelException.Aide.wrap(ex, "Unable to instantiate "+expfcls);
 			}
@@ -106,7 +106,7 @@
 	 * @param expectedType the expected type of the result of the evaluation
 	 */
 	public static final Object evaluate(XelContext ctx,
-	String expression, Class expectedType)
+	String expression, Class&lt;?&gt; expectedType)
 	throws XelException {
 		return newExpressionFactory().evaluate(ctx, expression, expectedType);
 	}
@@ -123,7 +123,7 @@
 	 * Note: expfcls must implement {@link ExpressionFactory}.
 	 * If null, the system default is used.
 	 */
-	public static final void setExpressionFactoryClass(Class expfcls) {
+	public static final void setExpressionFactoryClass(Class&lt;? extends ExpressionFactory&gt; expfcls) {
 		if (expfcls != null &amp;&amp; !ExpressionFactory.class.isAssignableFrom(expfcls))
 			throw new IllegalArgumentException(expfcls+" must implement "+ExpressionFactory.class);
 		_expfcls = expfcls;
@@ -133,7 +133,7 @@
 	 *
 	 * @see #setExpressionFactoryClass
 	 */
-	public static final Class getExpressionFactoryClass() {
+	public static final Class&lt;? extends ExpressionFactory&gt; getExpressionFactoryClass() {
 		return _expfcls;
 	}
 }

Modified: branches/6.0/zcommon/src/org/zkoss/xel/util/Evaluators.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/util/Evaluators.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zcommon/src/org/zkoss/xel/util/Evaluators.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -23,6 +23,7 @@
 import java.net.URL;
 
 import org.zkoss.lang.Classes;
+import static org.zkoss.lang.Generics.cast;
 import org.zkoss.lang.SystemException;
 import org.zkoss.util.logging.Log;
 import org.zkoss.util.resource.Locator;
@@ -32,6 +33,7 @@
 import org.zkoss.idom.Element;
 import org.zkoss.idom.util.IDOMs;
 import org.zkoss.xel.XelContext;
+import org.zkoss.xel.ExpressionFactory;
 import org.zkoss.xel.VariableResolver;
 import org.zkoss.xel.VariableResolverX;
 
@@ -55,7 +57,8 @@
 	 * @param name the name of the evaluator, say, MVEL.
 	 * @exception SystemException if not found or the class not found.
 	 */
-	public static final Class getEvaluatorClass(String name) {
+	@SuppressWarnings("unchecked")
+	public static final Class&lt;? extends ExpressionFactory&gt; getEvaluatorClass(String name) {
 		if (name == null || name.length() == 0)
 			throw new IllegalArgumentException("empty or null");
 
@@ -70,10 +73,13 @@
 			throw new SystemException("Evaluator not found: " + name);
 
 		if (clsnm instanceof Class) {
-			return (Class)clsnm;
+			final Class&lt;?&gt; cls = (Class)clsnm;
+			if (!ExpressionFactory.class.isAssignableFrom(cls))
+				throw new SystemException(cls + " must implements " + ExpressionFactory.class);
+			return cast(cls);
 		} else {
 			try {
-				return Classes.forNameByThread((String)clsnm);
+				return cast(Classes.forNameByThread((String)clsnm));
 			} catch (ClassNotFoundException ex) {
 				throw new SystemException("Failed to load class "+clsnm);
 			}
@@ -97,12 +103,12 @@
 	}
 
 	/** Adds an evaluator
-	 * (aka., the expression factory, {@link org.zkoss.xel.ExpressionFactory}).
+	 * (aka., the expression factory, {@link ExpressionFactory}).
 	 *
 	 * @param name the name of the evaluator, say, MVEL.
 	 * It is case insensitive.
 	 * @param evalcls the class name of the evaluator, aka., the expression factory
-	 * ({@link org.zkoss.xel.ExpressionFactory}).
+	 * ({@link ExpressionFactory}).
 	 * @return the previous class name, or null if not defined yet
 	 */
 	public static final String add(String name, String evalcls) {
@@ -118,11 +124,11 @@
 			old = _evals.put(evalnm, evalcls);
 		}
 
-		return old instanceof Class ? ((Class)old).getName(): (String)old;
+		return old instanceof Class&lt;?&gt; ? ((Class&lt;?&gt;)old).getName(): (String)old;
 	}
 	/** Adds an evaluator based on the XML declaration.
 	 * The evaluator is also known as the expression factory,
-	 * {@link org.zkoss.xel.ExpressionFactory}.
+	 * {@link ExpressionFactory}.
 	 *
 	 * &lt;pre&gt;&lt;code&gt;
 &amp;lt;xel-config&amp;gt;

Modified: branches/6.0/zk/src/org/zkoss/zk/au/AuDecoder.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/AuDecoder.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/AuDecoder.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -43,7 +43,7 @@
 	/** Returns a list of {@link AuRequest} by decoding the request.
 	 * @param request the request. For HTTP, it is HttpServletRequest.
 	 */
-	public List decode(Object request, Desktop desktop);
+	public List&lt;AuRequest&gt; decode(Object request, Desktop desktop);
 	/** Returns if the request is ignorable when an error occurs.
 	 * If true is returned, the request is simply ignored.
 	 * Otherwise, an error message, depending on the configuration,

Modified: branches/6.0/zk/src/org/zkoss/zk/au/AuRequests.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/AuRequests.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/AuRequests.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -39,11 +39,10 @@
 	 *
 	 * @return a set of components.
 	 */
-	public static Set convertToItems(Desktop desktop, List uuids) {
-		final Set items = new LinkedHashSet();
+	public static Set&lt;Component&gt; convertToItems(Desktop desktop, List&lt;String&gt; uuids) {
+		final Set&lt;Component&gt; items = new LinkedHashSet&lt;Component&gt;();
 		if (uuids != null)
-			for (Iterator it = uuids.iterator(); it.hasNext();) {
-				final String uuid = (String)it.next();
+			for (String uuid: uuids) {
 				final Component item = desktop.getComponentByUuidIfAny(uuid.trim());
 				if (item != null)
 					items.add(item);

Modified: branches/6.0/zk/src/org/zkoss/zk/au/AuResponse.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/AuResponse.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/AuResponse.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -142,7 +142,7 @@
 	 * @see #getRawData
 	 * @since 5.0.0
 	 */
-	public List getEncodedData() {
+	public List&lt;Object&gt; getEncodedData() {
 		if (_data == null)
 			return null;
 

Modified: branches/6.0/zk/src/org/zkoss/zk/au/http/AuDynaMediar.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/http/AuDynaMediar.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/http/AuDynaMediar.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -127,7 +127,7 @@
 			} catch (Throwable ex) {
 				err = true;
 
-				final List errs = new LinkedList();
+				final List&lt;Throwable&gt; errs = new LinkedList&lt;Throwable&gt;();
 				errs.add(ex);
 				desktopCtrl.invokeExecutionCleanups(exec, oldexec, errs);
 				config.invokeExecutionCleanups(exec, oldexec, errs);

Modified: branches/6.0/zk/src/org/zkoss/zk/au/http/AuUploader.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/http/AuUploader.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/http/AuUploader.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -38,6 +38,7 @@
 
 import org.zkoss.lang.D;
 import org.zkoss.lang.Strings;
+import static org.zkoss.lang.Generics.cast;
 import org.zkoss.lang.Exceptions;
 import org.zkoss.mesg.Messages;
 import org.zkoss.util.logging.Log;
@@ -91,7 +92,7 @@
 			return;
 		}
 
-		final Map attrs = new HashMap();
+		final Map&lt;String, String&gt; attrs = new HashMap&lt;String, String&gt;();
 		String alert = null, uuid = null, nextURI = null, sid = null;
 		Desktop desktop = null;
 		try {
@@ -100,8 +101,8 @@
 					uuid = request.getParameter("wid");
 					sid = request.getParameter("sid");
 					desktop = ((WebAppCtrl)sess.getWebApp()).getDesktopCache(sess).getDesktop(request.getParameter("dtid"));
-					Map precent = (Map) desktop.getAttribute(Attributes.UPLOAD_PERCENT);
-					Map size = (Map)desktop.getAttribute(Attributes.UPLOAD_SIZE);
+					Map&lt;String, Integer&gt; precent = cast((Map) desktop.getAttribute(Attributes.UPLOAD_PERCENT));
+					Map&lt;String, Object&gt; size = cast((Map)desktop.getAttribute(Attributes.UPLOAD_SIZE));
 					final String key = uuid + '_' + sid;
 					Object sinfo = size.get(key);
 					if (sinfo instanceof String) {
@@ -110,7 +111,7 @@
 						precent.remove(key);
 						return;
 					}
-					final Integer p = (Integer)precent.get(key);
+					final Integer p = precent.get(key);
 					final Long cb = (Long)sinfo;
 					response.getWriter().append((p != null ? p.intValue(): -1)+ ","
 								+(cb != null ? cb.longValue(): -1));
@@ -132,7 +133,7 @@
 					} else {
 						desktop = ((WebAppCtrl)sess.getWebApp())
 							.getDesktopCache(sess).getDesktop(dtid);
-						final Map params = parseRequest(request, desktop, uuid + '_' + sid);
+						final Map&lt;String, Object&gt; params = parseRequest(request, desktop, uuid + '_' + sid);
 						nextURI = (String)params.get("nextURI");
 						
 						// Bug 3054784
@@ -159,8 +160,8 @@
 			}
 
 			if (desktop != null) {
-				Map precent = (Map) desktop.getAttribute(Attributes.UPLOAD_PERCENT);
-				Map size = (Map)desktop.getAttribute(Attributes.UPLOAD_SIZE);
+				Map&lt;String, Integer&gt; precent = cast((Map) desktop.getAttribute(Attributes.UPLOAD_PERCENT));
+				Map&lt;String, Object&gt; size = cast((Map) desktop.getAttribute(Attributes.UPLOAD_SIZE));
 				final String key = uuid + '_' + sid;
 				if (precent != null) {
 					precent.remove(key);
@@ -176,8 +177,8 @@
 				response.setIntHeader("ZK-Error", HttpServletResponse.SC_GONE);
 				return;
 			}
-			Map precent = (Map) desktop.getAttribute(Attributes.UPLOAD_PERCENT);
-			Map size = (Map)desktop.getAttribute(Attributes.UPLOAD_SIZE);
+			Map&lt;String, Integer&gt; precent = cast((Map) desktop.getAttribute(Attributes.UPLOAD_PERCENT));
+			Map&lt;String, Object&gt; size = cast((Map)desktop.getAttribute(Attributes.UPLOAD_SIZE));
 			final String key = uuid + '_' + sid;
 			if (precent != null) {
 				precent.remove(key); 
@@ -222,9 +223,9 @@
 	/** Process fileitems named file0, file1 and so on.
 	 */
 	private static final
-	void processItems(Desktop desktop, Map params, Map attrs)
+	void processItems(Desktop desktop, Map&lt;String, Object&gt; params, Map&lt;String, String&gt; attrs)
 	throws IOException {
-		final List meds = new LinkedList();
+		final List&lt;Media&gt; meds = new LinkedList&lt;Media&gt;();
 		final boolean alwaysNative = "true".equals(params.get("native"));
 		final Object fis = params.get("file");
 		if (fis instanceof FileItem) {
@@ -330,10 +331,10 @@
 	/** Parses the multipart request into a map of
 	 * (String nm, FileItem/String/List(FileItem/String)).
 	 */
-	private static Map parseRequest(HttpServletRequest request,
+	private static Map&lt;String, Object&gt; parseRequest(HttpServletRequest request,
 	Desktop desktop, String key)
 	throws FileUploadException {
-		final Map params = new HashMap();
+		final Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
 		final ZkFileItemFactory fty = new ZkFileItemFactory(desktop, request, key);
 		final ServletFileUpload sfu = new ServletFileUpload(fty);
 
@@ -359,11 +360,11 @@
 
 			final Object old = params.put(nm, val);
 			if (old != null) {
-				final List vals;
+				final List&lt;Object&gt; vals;
 				if (old instanceof List) {
-					params.put(nm, vals = (List)old);
+					params.put(nm, vals = cast((List)old));
 				} else {
-					params.put(nm, vals = new LinkedList());
+					params.put(nm, vals = new LinkedList&lt;Object&gt;());
 					vals.add(old);
 				}
 				vals.add(val);

Modified: branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -36,6 +36,7 @@
 
 import org.zkoss.mesg.Messages;
 import org.zkoss.lang.Classes;
+import static org.zkoss.lang.Generics.cast;
 import org.zkoss.lang.Exceptions;
 import org.zkoss.util.logging.Log;
 import org.zkoss.json.JSONValue;
@@ -117,7 +118,7 @@
 	private ServletContext _ctx;
 	private long _lastModified;
 	/** (String name, AuExtension). */
-	private Map _aues = new HashMap(8);
+	private Map&lt;String, AuExtension&gt; _aues = new HashMap&lt;String, AuExtension&gt;(8);
 	private boolean _compress = true;
 
 	/** Returns the update servlet of the specified application, or
@@ -213,8 +214,7 @@
 			addAuExtension("/view", new AuDynaMediar());
 	}
 	public void destroy() {
-		for (Iterator it = _aues.values().iterator(); it.hasNext();) {
-			final AuExtension aue = (AuExtension)it.next();
+		for (AuExtension aue: _aues.values()) {
 			try {
 				aue.destroy();
 			} catch (Throwable ex) {
@@ -268,10 +268,11 @@
 				upsv = DHtmlUpdateServlet.getUpdateServlet(wapp);
 				if (upsv == null) {
 					checkAuExtension(prefix, extension);
-					Map aues = (Map)wapp.getAttribute(ATTR_AU_PROCESSORS);
+					Map&lt;String, AuExtension&gt; aues =
+						cast((Map)wapp.getAttribute(ATTR_AU_PROCESSORS));
 					if (aues == null)
-						wapp.setAttribute(ATTR_AU_PROCESSORS, aues = new HashMap(4));
-					return (AuExtension)aues.put(prefix, extension);
+						wapp.setAttribute(ATTR_AU_PROCESSORS, aues = new HashMap&lt;String, AuExtension&gt;(4));
+					return aues.put(prefix, extension);
 				}
 			}
 		}
@@ -307,8 +308,8 @@
 		//To avoid using sync in doGet(), we make a copy here
 		final AuExtension old;
 		synchronized (this) {
-			final Map ps = new HashMap(_aues);
-			old = (AuExtension)ps.put(prefix, extension);
+			final Map&lt;String, AuExtension&gt; ps = new HashMap&lt;String, AuExtension&gt;(_aues);
+			old = ps.put(prefix, extension);
 			_aues = ps;
 		}
 		if (old != null)
@@ -517,13 +518,13 @@
 
 		//parse commands
 		final Configuration config = wapp.getConfiguration();
-		final List aureqs;
+		final List&lt;AuRequest&gt; aureqs;
 		boolean keepAlive = false;
 		try {
 			final boolean timerKeepAlive = config.isTimerKeepAlive();
 			aureqs = audec.decode(request, desktop);
-			for (Iterator it = aureqs.iterator(); it.hasNext();) {
-				final String cmdId = ((AuRequest)it.next()).getCommand();
+			for (AuRequest aureq: aureqs) {
+				final String cmdId = aureq.getCommand();
 				keepAlive = !(!timerKeepAlive &amp;&amp; Events.ON_TIMER.equals(cmdId))
 					&amp;&amp; !"dummy".equals(cmdId);
 					//dummy is used for PollingServerPush for piggyback
@@ -687,8 +688,8 @@
 		public String getFirstCommand(Object request) {
 			return ((HttpServletRequest)request).getParameter("cmd.0");
 		}
-		public List decode(Object request, Desktop desktop) {
-			final List aureqs = new LinkedList();
+		public List&lt;AuRequest&gt; decode(Object request, Desktop desktop) {
+			final List&lt;AuRequest&gt; aureqs = new LinkedList&lt;AuRequest&gt;();
 			final HttpServletRequest hreq = (HttpServletRequest)request;
 			for (int j = 0;; ++j) {
 				final String cmdId = hreq.getParameter("cmd_"+j);

Modified: branches/6.0/zk/src/org/zkoss/zk/au/http/UploadInfoService.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/http/UploadInfoService.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/http/UploadInfoService.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -18,7 +18,9 @@
 import java.util.List;
 import java.util.Map;
 
+import static org.zkoss.lang.Generics.cast;
 import org.zkoss.util.media.Media;
+
 import org.zkoss.zk.ui.Desktop;
 import org.zkoss.zk.ui.UiException;
 import org.zkoss.zk.ui.event.Events;
@@ -39,11 +41,11 @@
 	private UploadInfoService() {
 	}
 	
-	private static Media[] parseResult(List result) {
+	private static Media[] parseResult(List&lt;Media&gt; result) {
 		if (result != null) {
 			//we have to filter items that user doesn't specify any file
-			for (Iterator it = result.iterator(); it.hasNext();) {
-				final Media media = (Media)it.next();
+			for (Iterator&lt;Media&gt; it = result.iterator(); it.hasNext();) {
+				final Media media = it.next();
 				if (media != null &amp;&amp; media.inMemory() &amp;&amp; media.isBinary()) {
 					final String nm = media.getName();
 					if (nm == null || nm.length() == 0) {
@@ -55,7 +57,7 @@
 			}
 
 			if (!result.isEmpty())
-				return (Media[])result.toArray(new Media[result.size()]);
+				return result.toArray(new Media[result.size()]);
 		}
 		return null;
 	}
@@ -66,9 +68,9 @@
 			Desktop desktop = request.getDesktop();
 			final String uuid = (String) request.getData().get("wid");
 			final String sid = (String) request.getData().get("sid");
+			final List&lt;Media&gt; result = cast((List)AuRequests.getUpdateResult(request));
 			Events.postEvent(new UploadEvent(Events.ON_UPLOAD,
-					desktop.getComponentByUuid(uuid),
-					parseResult((List)AuRequests.getUpdateResult(request))));
+					desktop.getComponentByUuid(uuid), parseResult(result)));
 
 			Map precent = (Map) desktop.getAttribute(Attributes.UPLOAD_PERCENT);
 			Map size = (Map)desktop.getAttribute(Attributes.UPLOAD_SIZE);

Modified: branches/6.0/zk/src/org/zkoss/zk/au/http/ZkFileItemFactory.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/http/ZkFileItemFactory.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/http/ZkFileItemFactory.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -48,6 +48,7 @@
 	/** # of bytes being received. */
 	private long _cbrcv;
 
+	@SuppressWarnings("unchecked")
 	/*package*/ ZkFileItemFactory(Desktop desktop, HttpServletRequest request, String key) {
     	setSizeThreshold(1024*128);	// maximum size that will be stored in memory
 
@@ -72,6 +73,7 @@
 		((Map)_desktop.getAttribute(Attributes.UPLOAD_SIZE)).put(key, new Long(_cbtotal));
 	}
 
+	@SuppressWarnings("unchecked")
 	/*package*/ void onProgress(long cbRead) {
 		int percent = 0;
 		if (_cbtotal &gt; 0) {

Modified: branches/6.0/zk/src/org/zkoss/zk/au/out/AuEcho.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/out/AuEcho.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/out/AuEcho.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -82,6 +82,7 @@
 				(Object[])(new String[] {comp.getUuid(), evtnm}));
 	}
 	/** Note: data must be non-null. */
+	@SuppressWarnings("unchecked")
 	private static Integer getKeyOfData(Component comp, Object data) {
 		Object[] inf = (Object[])comp.getAttribute(Attributes.ECHO_DATA);
 		if (inf == null)

Modified: branches/6.0/zk/src/org/zkoss/zk/au/out/AuEchoGlobal.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/out/AuEchoGlobal.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/au/out/AuEchoGlobal.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -43,15 +43,15 @@
 	 * @param data the data to sent with the event when echoed back
 	 * @param dts a collection of desktops ({@link Desktop}) to receive the event.
 	 */
-	public AuEchoGlobal(String evtnm, String data, Collection dts) {
+	public AuEchoGlobal(String evtnm, String data, Collection&lt;Desktop&gt; dts) {
 		super("echoGx", toArray(evtnm, data, dts));
 	}
-	private static String[] toArray(String evtnm, String data, Collection dts) {
-		final List l = new LinkedList();
+	private static String[] toArray(String evtnm, String data, Collection&lt;Desktop&gt; dts) {
+		final List&lt;String&gt; l = new LinkedList&lt;String&gt;();
 		l.add(evtnm);
 		l.add(data);
-		for (Iterator it = dts.iterator(); it.hasNext();)
-			l.add(((Desktop)it.next()).getId());
-		return (String[])l.toArray(new String[l.size()]);
+		for (Desktop desktop: dts)
+			l.add(desktop.getId());
+		return l.toArray(new String[l.size()]);
 	}
 }

Modified: branches/6.0/zk/src/org/zkoss/zk/device/Devices.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/device/Devices.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/device/Devices.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -41,7 +41,7 @@
 	private Devices() {}
 
 	/** Map(String type, DeviceInfo info or Device device). */
-	private static final Map _devmap = new LinkedHashMap(8);
+	private static final Map&lt;String, Object&gt; _devmap = new LinkedHashMap&lt;String, Object&gt;(4);
 	/** A list of devices registered. It is a duplicated info (of _devmap)
 	 * but used to improve the performance.
 	 */
@@ -66,19 +66,18 @@
 			throw new DeviceNotFoundException(deviceType, MZk.NOT_FOUND, deviceType);
 
 		final Device device = ((DeviceInfo)o).newDevice(deviceType);
-		final List devs = new LinkedList();
+		final List&lt;Device&gt; devs = new LinkedList&lt;Device&gt;();
 		synchronized (_devmap) {
 			final Object old = _devmap.put(deviceType, device);
 			if (old != o)
 				_devmap.put(deviceType, old); //changed by someone else; so restore
 
-			for (Iterator it = _devmap.values().iterator(); it.hasNext();) {
-				final Object d = it.next();
+			for (Object d: _devmap.values()) {
 				if (d instanceof Device)
-					devs.add(d);
+					devs.add((Device)d);
 			}
 		}
-		_devs = (Device[])devs.toArray(new Device[devs.size()]);
+		_devs = devs.toArray(new Device[devs.size()]);
 		return device;
 	}
 	/** Returns the device for the specified client.
@@ -97,8 +96,8 @@
 	throws DeviceNotFoundException {
 		String[] devTypes;
 		synchronized (_devmap) {
-			Collection c = _devmap.keySet();
-			devTypes = (String[])c.toArray(new String[c.size()]);
+			Collection&lt;String&gt; c = _devmap.keySet();
+			devTypes = c.toArray(new String[c.size()]);
 		}
 
 		Device device = null;

Modified: branches/6.0/zk/src/org/zkoss/zk/scripting/Interpreter.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/scripting/Interpreter.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/scripting/Interpreter.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -77,7 +77,7 @@
 
 	/** Returns the class defined in this interpreter, or null if not found.
 	 */
-	public Class getClass(String clsnm);
+	public Class&lt;?&gt; getClass(String clsnm);
 	/** Returns the method of the specified name defined in this interpreter,
 	 * or null if not defined.
 	 *

Modified: branches/6.0/zk/src/org/zkoss/zk/scripting/Interpreters.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/scripting/Interpreters.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/scripting/Interpreters.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -23,6 +23,7 @@
 import java.util.LinkedHashSet;
 
 import org.zkoss.lang.Classes;
+import static org.zkoss.lang.Generics.cast;
 import org.zkoss.util.logging.Log;
 import org.zkoss.idom.Element;
 import org.zkoss.idom.util.IDOMs;
@@ -44,10 +45,10 @@
 	private static final Log log = Log.lookup(Interpreters.class);
 
 	/** Map(zslang, Class/String class); */
-	private static final Map _ips = new HashMap();
+	private static final Map&lt;String, Object&gt; _ips = new HashMap&lt;String, Object&gt;();
 	/** A set of language names. */
-	private static final Set _zslangs =
-		Collections.synchronizedSet(new LinkedHashSet());
+	private static final Set&lt;String&gt; _zslangs =
+		Collections.synchronizedSet(new LinkedHashSet&lt;String&gt;());
 
 	private Interpreters() { //disable it
 	}
@@ -69,17 +70,19 @@
 		if (clsnm == null)
 			throw new InterpreterNotFoundException(zslang, MZk.NOT_FOUND, zslang);
 
-		final Class cls;
+		final Class&lt;? extends Interpreter&gt; cls;
 		if (clsnm instanceof Class) {
-			cls = (Class)clsnm;
+			cls = cast((Class)clsnm);
 		} else {
+			Class&lt;?&gt; c;
 			try {
-				cls = Classes.forNameByThread((String)clsnm);
+				c = Classes.forNameByThread((String)clsnm);
 			} catch (ClassNotFoundException ex) {
 				throw new UiException("Failed to load class "+clsnm);
 			}
-			if (!Interpreter.class.isAssignableFrom(cls))
-				throw new IllegalArgumentException(cls+" must implements "+Interpreter.class);
+			if (!Interpreter.class.isAssignableFrom(c))
+				throw new IllegalArgumentException(c+" must implements "+Interpreter.class);
+			cls = cast(c);
 
 			synchronized (_ips) {
 				final Object old = _ips.put(zsl, cls);
@@ -89,7 +92,7 @@
 		}
 
 		try {
-			final Interpreter ip = (Interpreter)cls.newInstance();
+			final Interpreter ip = cls.newInstance();
 			ip.init(owner, zslang);
 			return ip;
 		} catch (Exception ex) {
@@ -112,7 +115,7 @@
 	/** Returns a set of names of the scripting languages supported by this
 	 * installation.
 	 */
-	public static final Set getZScriptLanguages() {
+	public static final Set&lt;String&gt; getZScriptLanguages() {
 		return _zslangs;
 	}
 

Modified: branches/6.0/zk/src/org/zkoss/zk/scripting/bsh/BSHInterpreter.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/scripting/bsh/BSHInterpreter.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/scripting/bsh/BSHInterpreter.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -264,7 +264,7 @@
 		return _ip;
 	}
 
-	public Class getClass(String clsnm) {
+	public Class&lt;?&gt; getClass(String clsnm) {
 		try {
 			return _bshns.getClass(clsnm);
 		} catch (UtilEvalError ex) {
@@ -781,8 +781,10 @@
 }
 /*package*/ class NSWrapSR extends NSWrap implements Serializable {
 	private static final Log log = BSHInterpreter.log;
-	private Map _vars;
-	private List _mtds, _clses, _pkgs;
+	private Map&lt;String, Object&gt; _vars;
+	private List&lt;BshMethod&gt; _mtds;
+	private List&lt;String&gt; _clses;
+	private List&lt;String&gt; _pkgs;
 
 	/*package*/ NSWrapSR(NameSpace ns) {
 		super(ns);
@@ -794,10 +796,9 @@
 		if (_bshns == null) {
 			_bshns = BSHInterpreter.getInterpreter(scope).newNS(scope);
 			if (_vars != null) {
-				for (Iterator it = _vars.entrySet().iterator(); it.hasNext();) {
-					final Map.Entry me = (Map.Entry)it.next();
+				for (Map.Entry&lt;String, Object&gt; me: _vars.entrySet()) {
 					try {
-						_bshns.setVariable((String)me.getKey(), me.getValue(), false);
+						_bshns.setVariable(me.getKey(), me.getValue(), false);
 					} catch (Throwable ex) {
 						log.warning("Ignored failure of set "+me.getKey(), ex);
 					}
@@ -805,8 +806,7 @@
 				_vars = null;
 			}
 			if (_mtds != null) {
-				for (Iterator it = _mtds.iterator(); it.hasNext();) {
-					final BshMethod mtd = (BshMethod)it.next();
+				for (BshMethod mtd: _mtds) {
 					try {
 						_bshns.setMethod(mtd.getName(), mtd);
 					} catch (Throwable ex) {
@@ -816,8 +816,7 @@
 				_mtds = null;
 			}
 			if (_clses != null) {
-				for (Iterator it = _clses.iterator(); it.hasNext();) {
-					final String name = (String)it.next();
+				for (String name: _clses) {
 					try {
 						_bshns.importClass(name);
 					} catch (Throwable ex) {
@@ -827,8 +826,7 @@
 				_clses = null;
 			}
 			if (_pkgs != null) {
-				for (Iterator it = _pkgs.iterator(); it.hasNext();) {
-					final String name = (String)it.next();
+				for (String name: _pkgs) {
 					try {
 						_bshns.importPackage(name);
 					} catch (Throwable ex) {
@@ -860,19 +858,19 @@
 		if (s.readBoolean()) {
 			BSHInterpreter.read(new NameSpace(null, null, "nst") {
 				public void setVariable(String name, Object value, boolean strictJava) {
-					if (_vars == null) _vars = new HashMap();
+					if (_vars == null) _vars = new HashMap&lt;String, Object&gt;();
 					_vars.put(name, value);
 				}
 				public void setMethod(String name, BshMethod mtd) {
-					if (_mtds == null) _mtds = new LinkedList();
+					if (_mtds == null) _mtds = new LinkedList&lt;BshMethod&gt;();
 					_mtds.add(mtd);
 				}
 				public void importClass(String name) {
-					if (_clses == null) _clses = new LinkedList();
+					if (_clses == null) _clses = new LinkedList&lt;String&gt;();
 					_clses.add(name);
 				}
 				public void importPackage(String name) {
-					if (_pkgs == null) _pkgs = new LinkedList();
+					if (_pkgs == null) _pkgs = new LinkedList&lt;String&gt;();
 					_pkgs.add(name);
 				}
 				public void loadDefaultImports() {

Modified: branches/6.0/zk/src/org/zkoss/zk/scripting/util/GenericInterpreter.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/scripting/util/GenericInterpreter.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/scripting/util/GenericInterpreter.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -71,7 +71,7 @@
 	/** A list of {@link Scope}.
 	 * Top of it is the current one (if null, it means Scopes.getCurrent)
 	 */
-	private final List _scopes = new LinkedList();
+	private final List&lt;Object&gt; _scopes = new LinkedList&lt;Object&gt;();
 	private Page _owner;
 	private String _zslang;
 

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -169,7 +169,7 @@
 	/** Returns the component definition of the specified class, or null
 	 * if not found.
 	 */
-	private static ComponentDefinition getDefinition(Execution exec, Class cls) {
+	private static ComponentDefinition getDefinition(Execution exec, Class&lt;? extends Component&gt; cls) {
 		if (exec != null) {
 			final ExecutionCtrl execCtrl = (ExecutionCtrl)exec;
 			final PageDefinition pgdef = execCtrl.getCurrentPageDefinition();

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/AbstractPage.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/AbstractPage.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/AbstractPage.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -46,9 +46,9 @@
 	/** The number of root components. */
 	private int _nRoot;
 	/** The readonly root collection. */
-	private transient Collection _roots;
+	private transient Collection&lt;Component&gt; _roots;
 	/** A map of fellows. */
-	private transient Map _fellows;
+	private transient Map&lt;String, Component&gt; _fellows;
 
 	protected AbstractPage() {
 		init();
@@ -57,7 +57,7 @@
 	 */
 	private void init() {
 		_roots = new Roots();
-		_fellows = new HashMap();
+		_fellows = new HashMap&lt;String, Component&gt;();
 	}
 
 	//Page//
@@ -73,15 +73,15 @@
 	}
 	public Component getFellow(String compId)
 	throws ComponentNotFoundException {
-		final Component comp = (Component)_fellows.get(compId);
+		final Component comp = _fellows.get(compId);
 		if (comp == null)
 			throw new ComponentNotFoundException("Fellow component not found: "+compId);
 		return comp;
 	}
 	public Component getFellowIfAny(String compId) {
-		return (Component)_fellows.get(compId);
+		return _fellows.get(compId);
 	}
-	public Collection getFellows() {
+	public Collection&lt;Component&gt; getFellows() {
 		return Collections.unmodifiableCollection(_fellows.values());
 	}
 	/** The same as {@link #getFellow(String)}.
@@ -110,10 +110,10 @@
 	//PageCtrl//
 	/*package*/ void addFellow(Component comp) {
 		final String compId = comp.getId();
-		final Object old = _fellows.put(compId, comp);
+		final Component old = _fellows.put(compId, comp);
 		if (old != comp) { //possible due to recursive call
 			if (old != null) {
-				_fellows.put(((Component)old).getId(), old); //recover
+				_fellows.put(old.getId(), old); //recover
 				throw new InternalError("Called shall prevent replicated ID for roots");
 			}
 		}
@@ -207,7 +207,7 @@
 		}
 	}
 
-	public Collection getRoots() {
+	public Collection&lt;Component&gt; getRoots() {
 		return _roots;
 	}
 	public void removeComponents() {
@@ -220,7 +220,7 @@
 
 	public void destroy() {
 		_firstRoot = null; _nRoot = 0;
-		_fellows = new HashMap(1); //not clear() since # of fellows might huge
+		_fellows = new HashMap&lt;String, Component&gt;(2); //not clear() since # of fellows might huge
 	}
 
 	private synchronized void writeObject(java.io.ObjectOutputStream s)
@@ -266,13 +266,13 @@
 	}
 
 	//help classes//
-	private class Roots extends AbstractCollection {
+	private class Roots extends AbstractCollection&lt;Component&gt; {
 		public int size() {return _nRoot;}
-		public Iterator iterator() {
+		public Iterator&lt;Component&gt; iterator() {
 			return new RootIter(_firstRoot);
 		}
 	}
-	private static class RootIter implements Iterator {
+	private static class RootIter implements Iterator&lt;Component&gt; {
 		private AbstractComponent _p;
 		private RootIter(AbstractComponent first) {
 			_p = first;
@@ -280,8 +280,8 @@
 		public boolean hasNext() {
 			return _p != null;
 		}
-		public Object next() {
-			Object c = _p;
+		public Component next() {
+			Component c = _p;
 			_p = _p._next;
 			return c;
 		}

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Components.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Components.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Components.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -46,6 +46,7 @@
 import org.zkoss.util.CollectionsX;
 import org.zkoss.util.logging.Log;
 import org.zkoss.xel.VariableResolver;
+import org.zkoss.xel.ExpressionFactory;
 
 import org.zkoss.zk.au.AuResponse;
 import org.zkoss.zk.ui.event.Events;
@@ -91,7 +92,7 @@
 	 * some replicated item in the list.
 	 * @see #sort(List, int, int, Comparator)
 	 */
-	public static void sort(List list, Comparator cpr) {
+	public static void sort(List&lt;Component&gt; list, Comparator&lt;? super Component&gt; cpr) {
 		sort(list, 0, list.size(), cpr);
 	}
 
@@ -126,8 +127,8 @@
 	 * @since 3.5.2
 	 */
 	public static
-	void replaceChildren(Component parent, Collection newChildren) {
-		final Collection children = parent.getChildren();
+	void replaceChildren(Component parent, Collection&lt;Component&gt; newChildren) {
+		final Collection&lt;Component&gt; children = parent.getChildren();
 		children.clear();
 		children.addAll(newChildren);
 	}
@@ -139,11 +140,11 @@
 	 * @param cpr the comparator to determine the order of the list.
 	 * @since 3.5.0
 	 */
-	public static void sort(List list, int from, int to, Comparator cpr) {
-		final Object ary[] = CollectionsX.toArray(list, from, to);
+	public static void sort(List&lt;Component&gt; list, int from, int to, Comparator&lt;? super Component&gt; cpr) {
+		final Component ary[] = (Component[])CollectionsX.toArray(list, from, to);
 		Arrays.sort(ary, cpr);
 
-		ListIterator it = list.listIterator(from);
+		ListIterator&lt;Component&gt; it = list.listIterator(from);
 		int j = 0, k = to - from;
 		for (; it.hasNext() &amp;&amp; --k &gt;= 0; ++j) {
 			if (it.next() != ary[j]) {
@@ -701,25 +702,21 @@
 		return IMPLICIT_NAMES.contains(id);
 	}
 
-	private static final Set IMPLICIT_NAMES = new HashSet();
-	static {  
-		IMPLICIT_NAMES.add("application");
-		IMPLICIT_NAMES.add("applicationScope");
-		IMPLICIT_NAMES.add("arg");
-		IMPLICIT_NAMES.add("componentScope");
-		IMPLICIT_NAMES.add("desktop");
-		IMPLICIT_NAMES.add("desktopScope");
-		IMPLICIT_NAMES.add("execution");
-		IMPLICIT_NAMES.add("event"); //since 3.6.1, #bug 2681819: normal page throws exception after installed zkspring
-		IMPLICIT_NAMES.add("self");
-		IMPLICIT_NAMES.add("session");
-		IMPLICIT_NAMES.add("sessionScope");
-		IMPLICIT_NAMES.add("spaceOwner");
-		IMPLICIT_NAMES.add("spaceScope");
-		IMPLICIT_NAMES.add("page");
-		IMPLICIT_NAMES.add("pageScope");
-		IMPLICIT_NAMES.add("requestScope");
-		IMPLICIT_NAMES.add("param");
+	private static final Set&lt;String&gt; IMPLICIT_NAMES = new HashSet&lt;String&gt;();
+	static { 
+		final String[] names = {
+			"application", "applicationScope", "arg",
+			"componentScope",
+			"desktop", "desktopScope",
+			"execution",
+			"event", //since 3.6.1, #bug 2681819: normal page throws exception after installed zkspring
+			"self",
+			"session", "sessionScope",
+			"spaceOwner", "spaceScope",
+			"page", "pageScope",
+			"requestScope", "param"};
+		for (int j = 0; j &lt; names.length; ++j)
+			IMPLICIT_NAMES.add(names[j]);
 	}
 
 	/** Retuns the implicit object of the specified name, or null
@@ -833,10 +830,10 @@
 		return exec != null ? ((ExecutionCtrl)exec).getCurrentPage(): null;
 	}
 
-	private static boolean ignoreFromWire(Class cls) {
-		return _igoreWires.contains(cls);
+	private static boolean ignoreFromWire(Class&lt;?&gt; cls) {
+		return _ignoreWires.contains(cls);
 	}
-	private static Set _igoreWires = new HashSet(8);
+	private static final Set&lt;Class&lt;?&gt;&gt; _ignoreWires = new HashSet&lt;Class&lt;?&gt;&gt;(8);
 	static {
 		final Class[] clses = new Class[] {
 			HtmlBasedComponent.class,
@@ -847,7 +844,7 @@
 			Object.class
 		};
 		for (int j = 0; j &lt; clses.length; ++j)
-			_igoreWires.add(clses[j]);
+			_ignoreWires.add(clses[j]);
 	}
 
 	/**
@@ -856,8 +853,8 @@
 	 */
 	private static class Wire {
 		private final Object _controller;
-		private final Set _injected;
-		private final Map _fldMaps;
+		private final Set&lt;String&gt; _injected;
+		private final Map&lt;String, Field&gt; _fldMaps;
 		private final char _separator;
 		private final boolean _ignoreZScript;
 		private final boolean _ignoreXel;
@@ -874,8 +871,8 @@
 			_separator = separator;
 			_ignoreZScript = ignoreZScript;
 			_ignoreXel = ignoreXel;
-			_injected = new HashSet();
-			_fldMaps = new LinkedHashMap(64);
+			_injected = new HashSet&lt;String&gt;();
+			_fldMaps = new LinkedHashMap&lt;String, Field&gt;(64);
 			
 			Class cls = _controller.getClass();
 			while (cls != null &amp;&amp; !ignoreFromWire(cls)) {
@@ -951,6 +948,7 @@
 			wireImplicit(x);
 			wireOthers(x);
 		}
+		@SuppressWarnings("unchecked")
 		private void wireImplicit(Object x) {
 			for (final Iterator it= IMPLICIT_NAMES.iterator(); it.hasNext();) {
 				final String fdname = (String) it.next();
@@ -1001,10 +999,9 @@
 			}
 
 			//check fields
-			for (final Iterator it=_fldMaps.entrySet().iterator();it.hasNext();) {
-				final Entry entry = (Entry) it.next();
-				final String fdname = (String) entry.getKey();
-				final Field fd = (Field) entry.getValue();
+			for (Entry&lt;String, Field&gt; entry: _fldMaps.entrySet()) {
+				final String fdname = entry.getKey();
+				final Field fd = entry.getValue();
 				if ((fd.getModifiers() &amp; Modifier.STATIC) == 0
 				&amp;&amp; !_injected.contains(fdname)) { //if not injected by setXxx yet
 					if (containsVariable(x, fdname)) {
@@ -1119,9 +1116,9 @@
 		/** Returns false if there is such field but the target class doesn't match.
 		 * In other words, false means the caller can try another object (arg).
 		 */
-		private boolean injectByMethod(Method md, Class parmcls, Class argcls, Object arg, String fdname) {
+		private boolean injectByMethod(Method md, Class&lt;?&gt; parmcls, Class&lt;?&gt; argcls, Object arg, String fdname) {
 			if (argcls == null || parmcls.isAssignableFrom(argcls)) {
-				final Field fd = (Field) _fldMaps.get(fdname);
+				final Field fd = _fldMaps.get(fdname);
 				if (fd != null &amp;&amp; fd.getType().equals(parmcls)) {
 					final boolean old = fd.isAccessible();
 					try {
@@ -1156,11 +1153,11 @@
 		/** Returns false if there is such field but the target class doesn't match.
 		 * In other words, false means the caller can try another object (arg).
 		 */
-		private boolean injectField(Object arg, Class argcls, Field fd) {
+		private boolean injectField(Object arg, Class&lt;?&gt; argcls, Field fd) {
 			final boolean old = fd.isAccessible();
 			try {
 				fd.setAccessible(true);
-				final Class fdcls = fd.getType();
+				final Class&lt;?&gt; fdcls = fd.getType();
 				if (argcls != null &amp;&amp; fdcls.isAssignableFrom(argcls)) { //correct type 
 					final Object value = fd.get(_controller);
 					if (value == null) {
@@ -1306,7 +1303,7 @@
 			return exec().removeScopeListener(listener);
 		}
 
-		public Map getAttributes() {
+		public Map&lt;String, Object&gt; getAttributes() {
 			return exec().getAttributes();
 		}
 
@@ -1318,11 +1315,11 @@
 			return exec().getDesktop();
 		}
 
-		public Evaluator getEvaluator(Page page, Class expfcls) {
+		public Evaluator getEvaluator(Page page, Class&lt;? extends ExpressionFactory&gt; expfcls) {
 			return exec().getEvaluator(page, expfcls);
 		}
 
-		public Evaluator getEvaluator(Component comp, Class expfcls) {
+		public Evaluator getEvaluator(Component comp, Class&lt;? extends ExpressionFactory&gt; expfcls) {
 			return exec().getEvaluator(comp, expfcls);
 		}
 
@@ -1369,7 +1366,7 @@
 			return exec().getParameter(name);
 		}
 
-		public Map getParameterMap() {
+		public Map&lt;String, String[]&gt; getParameterMap() {
 			return exec().getParameterMap();
 		}
 
@@ -1537,11 +1534,11 @@
 			return exec().getHeader(name);
 		}
 
-		public Iterator getHeaderNames() {
+		public Iterator&lt;String&gt; getHeaderNames() {
 			return exec().getHeaderNames();
 		}
 
-		public Iterator getHeaders(String name) {
+		public Iterator&lt;String&gt; getHeaders(String name) {
 			return exec().getHeaders(name);
 		}
 
@@ -1574,8 +1571,8 @@
 	}
 	
 	//Proxy to read current requestScope
-	private static class RequestScope implements Map {
-		protected Map req() {
+	private static class RequestScope implements Map&lt;String, Object&gt; {
+		protected Map&lt;String, Object&gt; req() {
 			return Executions.getCurrent().getAttributes();
 		}
 		public void clear() {
@@ -1587,7 +1584,7 @@
 		public boolean containsValue(Object value) {
 			return req().containsValue(value);
 		}
-		public Set entrySet() {
+		public Set&lt;Map.Entry&lt;String, Object&gt;&gt; entrySet() {
 			return req().entrySet();
 		}
 		public Object get(Object key) {
@@ -1596,13 +1593,13 @@
 		public boolean isEmpty() {
 			return req().isEmpty();
 		}
-		public Set keySet() {
+		public Set&lt;String&gt; keySet() {
 			return req().keySet();
 		}
-		public Object put(Object key, Object value) {
+		public Object put(String key, Object value) {
 			return req().put(key, value);
 		}
-		public void putAll(Map arg0) {
+		public void putAll(Map&lt;? extends String, ? extends Object&gt; arg0) {
 			req().putAll(arg0);
 		}
 		public Object remove(Object key) {
@@ -1611,7 +1608,7 @@
 		public int size() {
 			return req().size();
 		}
-		public Collection values() {
+		public Collection&lt;Object&gt; values() {
 			return req().values();
 		}
 

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Execution.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Execution.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Execution.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -25,6 +25,7 @@
 import java.security.Principal;
 
 import org.zkoss.xel.VariableResolver;
+import org.zkoss.xel.ExpressionFactory;
 import org.zkoss.idom.Document;
 
 import org.zkoss.web.servlet.Servlets;
@@ -98,20 +99,20 @@
 	 *
 	 * @param page the page that this evaluator is associated.
 	 * If null, the current page and then the first page is assumed.
-	 * @param expfcls the implementation of {@link org.zkoss.xel.ExpressionFactory},
+	 * @param expfcls the implementation of {@link ExpressionFactory},
 	 * or null to use the default ({@link org.zkoss.zk.ui.util.Configuration#getExpressionFactoryClass}.
 	 * @since 3.0.0
 	 */
-	public Evaluator getEvaluator(Page page, Class expfcls);
+	public Evaluator getEvaluator(Page page, Class&lt;? extends ExpressionFactory&gt; expfcls);
 	/** Returns the evaluator of the current execution.
 	 * It is a shortcut of getEvaluator(comp != null ? comp.getPage(): null)
 	 *
 	 * @param comp the component to retrieve the page for the evaluator
-	 * @param expfcls the implementation of {@link org.zkoss.xel.ExpressionFactory},
+	 * @param expfcls the implementation of {@link ExpressionFactory},
 	 * or null to use the default ({@link org.zkoss.zk.ui.util.Configuration#getExpressionFactoryClass}.
 	 * @since 3.0.0
 	 */
-	public Evaluator getEvaluator(Component comp, Class expfcls);
+	public Evaluator getEvaluator(Component comp, Class&lt;? extends ExpressionFactory&gt; expfcls);
 
 	/** Evluates the specified expression with ${link #getVariableResolver}
 	 * and {@link Page#getFunctionMapper} of the page of the specified
@@ -132,7 +133,7 @@
 	 * @see #getVariableResolver
 	 * @see #getEvaluator
 	 */
-	public Object evaluate(Component comp, String expr, Class expectedType);
+	public Object evaluate(Component comp, String expr, Class&lt;?&gt; expectedType);
 	/** Evluates the specified expression with ${link #getVariableResolver}
 	 * and {@link Page#getFunctionMapper} of the specified
 	 * page.
@@ -152,7 +153,7 @@
 	 * @see #getVariableResolver
 	 * @see #getEvaluator
 	 */
-	public Object evaluate(Page page, String expr, Class expectedType);
+	public Object evaluate(Page page, String expr, Class&lt;?&gt; expectedType);
 
 	/** Returns the variable resolver for this execution, or null if not
 	 * available.
@@ -928,7 +929,7 @@
 	 *
 	 * @since 3.5.0
 	 */
-	public Iterator getHeaders(String name);
+	public Iterator&lt;String&gt; getHeaders(String name);
 	/** Returns all header names this request contains.
 	 * If the request has no headers, this method returns an empty
 	 * {@link Iterator}.
@@ -936,7 +937,7 @@
 	 * it returns null.
 	 * @since 3.5.0
 	 */
-	public Iterator getHeaderNames();
+	public Iterator&lt;String&gt; getHeaderNames();
 
 	/** Sets a response header with the give name and value.
 	 * If the header had already been set, the new value overwrites the previous one.

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Executions.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Executions.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Executions.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -24,6 +24,7 @@
 import java.net.MalformedURLException;
 
 import org.zkoss.idom.Document;
+import org.zkoss.xel.ExpressionFactory;
 
 import org.zkoss.zk.ui.event.Events;
 import org.zkoss.zk.ui.metainfo.PageDefinition;
@@ -42,12 +43,12 @@
  */
 public class Executions {
 	/** Stores the current {@link Execution}. */
-	protected static final ThreadLocal _exec = new ThreadLocal();
+	protected static final ThreadLocal&lt;Execution&gt; _exec = new ThreadLocal&lt;Execution&gt;();
 
 	/** Returns the current execution.
 	 */
 	public static final Execution getCurrent() {
-		return (Execution)_exec.get();
+		return _exec.get();
 	}
 
 	/** Returns the evaluator of the current execution.
@@ -57,22 +58,22 @@
 	 *
 	 * @param page the page that this evaluator is associated.
 	 * If null, the current page and then the first page is assumed.
-	 * @param expfcls the implementation of {@link org.zkoss.xel.ExpressionFactory},
+	 * @param expfcls the implementation of {@link ExpressionFactory},
 	 * or null to use the default ({@link org.zkoss.zk.ui.util.Configuration#getExpressionFactoryClass}.
 	 * @since 3.0.0
 	 */
-	public static final Evaluator getEvaluator(Page page, Class expfcls) {
+	public static final Evaluator getEvaluator(Page page, Class&lt;? extends ExpressionFactory&gt; expfcls) {
 		return getCurrent().getEvaluator(page, expfcls);
 	}
 	/** Returns the evaluator of the current execution.
 	 * It is a shortcut of getEvaluator(comp != null ? comp.getPage(): null)
 	 *
 	 * @param comp the component to retrieve the page for the evaluator
-	 * @param expfcls the implementation of {@link org.zkoss.xel.ExpressionFactory},
+	 * @param expfcls the implementation of {@link ExpressionFactory},
 	 * or null to use the default ({@link org.zkoss.zk.ui.util.Configuration#getExpressionFactoryClass}.
 	 * @since 3.0.0
 	 */
-	public static final Evaluator getEvaluator(Component comp, Class expfcls) {
+	public static final Evaluator getEvaluator(Component comp, Class&lt;? extends ExpressionFactory&gt; expfcls) {
 		return getCurrent().getEvaluator(comp, expfcls);
 	}
 

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/HtmlMacroComponent.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/HtmlMacroComponent.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/HtmlMacroComponent.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -61,7 +61,7 @@
  * @author tomyeh
  */
 public class HtmlMacroComponent extends HtmlBasedComponent implements Macro {
-	private transient Map _props;
+	private transient Map&lt;String, Object&gt; _props;
 	private String _uri;
 	/** An array of components created by this inline macro.
 	 * It is used only if {@link #isInline}
@@ -73,7 +73,7 @@
 		init();
 	}
 	private void init() {
-		_props = new LinkedHashMap();
+		_props = new LinkedHashMap&lt;String, Object&gt;();
 		_props.put("includer", this);
 	}
 

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/HtmlNativeComponent.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/HtmlNativeComponent.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/HtmlNativeComponent.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -73,9 +73,9 @@
 	private String _prolog = "", _epilog = "";
 	/** The text before the tag name. */
 	private String _prefix, _postfix;
-	private Map _props;
+	private Map&lt;String, Object&gt; _props;
 	/** Declared namespaces ({@link Namespace}). */
-	private List _dns;
+	private List&lt;Namespace&gt; _dns;
 
 	/** Contructs a {@link HtmlNativeComponent} component.
 	 * 
@@ -137,15 +137,17 @@
 	}
 
 	//Native//
-	public List getDeclaredNamespaces() {
-		return _dns != null ? _dns: Collections.EMPTY_LIST;
+	public List&lt;Namespace&gt; getDeclaredNamespaces() {
+		if (_dns != null)
+			return _dns;
+		return Collections.emptyList();
 	}
 	public void addDeclaredNamespace(Namespace ns) {
 		if (ns == null)
 			throw new IllegalArgumentException();
 
 		if (_dns == null)
-			_dns = new LinkedList();
+			_dns = new LinkedList&lt;Namespace&gt;();
 		_dns.add(ns);
 	}
 	public String getPrologContent() {
@@ -364,7 +366,7 @@
 			if (_props != null) _props.remove(name);
 		} else {
 			if (_props == null)
-				_props = new LinkedHashMap();
+				_props = new LinkedHashMap&lt;String, Object&gt;();
 			_props.put(name, value);
 		}
 	}
@@ -379,7 +381,7 @@
 			return nc;
 		}
 		public void getFirstHalf(StringBuffer sb, String tag,
-		Map props, Collection namespaces) {
+		Map&lt;String, Object&gt; props, Collection namespaces) {
 			if (tag != null)
 				sb.append('&lt;').append(tag);
 

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Page.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Page.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Page.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -25,6 +25,7 @@
 import org.zkoss.xel.VariableResolver;
 import org.zkoss.xel.XelContext;
 import org.zkoss.xel.Function;
+import org.zkoss.xel.ExpressionFactory;
 
 import org.zkoss.zk.scripting.Interpreter;
 import org.zkoss.zk.scripting.InterpreterNotFoundException;
@@ -317,7 +318,7 @@
 	 * @return the class, or null if not found
 	 * @see #getLoadedInterpreters
 	 */
-	public Class getZScriptClass(String clsnm);
+	public Class&lt;?&gt; getZScriptClass(String clsnm);
 	/** Resolves the class of the specified name.
 	 * It first looks at Classes and then all loaded interpreters
 	 * {@link #getLoadedInterpreters}.
@@ -332,7 +333,7 @@
 	 * @since 3.0.1
 	 * @see #getZScriptClass
 	 */
-	public Class resolveClass(String clsnm) throws ClassNotFoundException;
+	public Class&lt;?&gt; resolveClass(String clsnm) throws ClassNotFoundException;
 
 	/** Returns the function of the specified name by searching
 	 * the loaded interpreters.
@@ -444,7 +445,7 @@
 	public boolean isListenerAvailable(String evtnm);
 	/** Returns an iterator for iterating listener for the specified event.
 	 */
-	public Iterator getListenerIterator(String evtnm);
+	public Iterator&lt;EventListener&gt; getListenerIterator(String evtnm);
 
 	//-- special control --//
 	/** Removes all components in this page.
@@ -508,7 +509,7 @@
 	 * @see #setExpressionFactoryClass
 	 * @since 3.0.4
 	 */
-	public Class getExpressionFactoryClass();
+	public Class&lt;? extends ExpressionFactory&gt; getExpressionFactoryClass();
 	/** Sets the implementation of the expression factory that
 	 * is used by this page.
 	 *
@@ -519,7 +520,7 @@
 	 * @see #getExpressionFactoryClass
 	 * @since 3.0.4
 	 */
-	public void setExpressionFactoryClass(Class expfcls);
+	public void setExpressionFactoryClass(Class&lt;? extends ExpressionFactory&gt; expfcls);
 
 	/** Returns if this page is a complete page.
 	 * By complete we mean the page has everything that the client expects.
@@ -599,5 +600,5 @@
 	 *
 	 * @param recurse whether to look up the component from {@link #getLanguageDefinition}
 	 */
-	public ComponentDefinition getComponentDefinition(Class cls, boolean recurse);
+	public ComponentDefinition getComponentDefinition(Class&lt;? extends Component&gt; cls, boolean recurse);
 }

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Sessions.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Sessions.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Sessions.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -25,7 +25,7 @@
  */
 public class Sessions {
 	/** Used to the store the session for the current thread. */
-	protected static final ThreadLocal _sess = new ThreadLocal();
+	protected static final ThreadLocal&lt;Object&gt; _sess = new ThreadLocal&lt;Object&gt;();
 	protected static int _cnt;
 
 	protected Sessions() {} //prevent from instantiated

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/event/GenericEventListener.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/event/GenericEventListener.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/event/GenericEventListener.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -78,7 +78,7 @@
 		final Method mtd =	ComponentsCtrl.getEventMethod(controller.getClass(), evt.getName());
 		if (mtd != null) {
 			if (mtd.getParameterTypes().length == 0)
-				mtd.invoke(controller, null);
+				mtd.invoke(controller);
 			else if (evt instanceof ForwardEvent) { //ForwardEvent
 				final Class paramcls = (Class) mtd.getParameterTypes()[0];
 				//paramcls is ForwardEvent || Event

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/event/SelectEvent.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/event/SelectEvent.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/event/SelectEvent.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -21,6 +21,8 @@
 import java.util.Map;
 import java.util.List;
 
+import static org.zkoss.lang.Generics.cast;
+
 import org.zkoss.zk.ui.Desktop;
 import org.zkoss.zk.ui.Component;
 import org.zkoss.zk.ui.UiException;
@@ -57,8 +59,9 @@
 	public static final SelectEvent getSelectEvent(AuRequest request) {
 		final Map data = request.getData();
 		final Desktop desktop = request.getDesktop();
+		final List&lt;String&gt; items = cast((List)data.get("items"));
 		return new SelectEvent(request.getCommand(), request.getComponent(),
-			AuRequests.convertToItems(desktop, (List)data.get("items")),
+			AuRequests.convertToItems(desktop, items),
 			desktop.getComponentByUuidIfAny((String)data.get("reference")),
 			AuRequests.parseKeys(data));
 	}

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/DesktopEventQueue.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/DesktopEventQueue.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/DesktopEventQueue.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -44,7 +44,7 @@
 	/*package*/ static final Log log = Log.lookup(DesktopEventQueue.class);
 
 	private final Component _dummy = new AbstractComponent();
-	private final List _listeners = new LinkedList();
+	private final List&lt;ListenerInfo&gt; _listeners = new LinkedList&lt;ListenerInfo&gt;();
 	private int _nAsync;
 	private boolean _serverPushEnabled;
 
@@ -52,14 +52,14 @@
 		_dummy.addEventListener("onQueue", new EventListener() {
 			public void onEvent(Event event) throws Exception {
 				final Event evt = (Event)event.getData();
-				final Set listenerCalled = new HashSet();
+				final Set&lt;ListenerInfo&gt; listenerCalled = new HashSet&lt;ListenerInfo&gt;();
 				for (;;)
-					for (Iterator it = _listeners.iterator();;) {
+					for (Iterator&lt;ListenerInfo&gt; it = _listeners.iterator();;) {
 						final ListenerInfo inf;
 						try {
 							if (!it.hasNext())
 								return; //done
-							inf = (ListenerInfo)it.next();
+							inf = it.next();
 						} catch (java.util.ConcurrentModificationException ex) {
 							break;
 						}
@@ -125,8 +125,8 @@
 	}
 	public boolean unsubscribe(EventListener listener) {
 		if (listener != null)
-			for (Iterator it = _listeners.iterator(); it.hasNext();) {
-				final ListenerInfo inf = (ListenerInfo)it.next();
+			for (Iterator&lt;ListenerInfo&gt; it = _listeners.iterator(); it.hasNext();) {
+				final ListenerInfo inf = it.next();
 				if (listener.equals(inf.listener)) {
 					it.remove();
 					if (inf.async &amp;&amp; --_nAsync == 0 &amp;&amp; _serverPushEnabled)
@@ -138,8 +138,8 @@
 	}
 	public boolean isSubscribed(EventListener listener) {
 		if (listener != null)
-			for (Iterator it = _listeners.iterator(); it.hasNext();)
-				if (listener.equals(((ListenerInfo)it.next()).listener))
+			for (ListenerInfo li: _listeners)
+				if (listener.equals(li.listener))
 					return true;
 		return false;
 	}
@@ -176,7 +176,7 @@
 	private final EventQueue _que;
 	private final ListenerInfo _inf;
 	private final Event _event;
-	private List _pendingEvents;
+	private List&lt;Event&gt; _pendingEvents;
 	/*package*/ AsyncListenerThread(EventQueue que, ListenerInfo inf, Event event) {
 		_desktop = Executions.getCurrent().getDesktop();
 		_que = que;
@@ -186,7 +186,7 @@
 	}
 	/*package*/ void postEvent(Event event) {
 		if (_pendingEvents == null)
-			_pendingEvents = new LinkedList();
+			_pendingEvents = new LinkedList&lt;Event&gt;();
 		_pendingEvents.add(event);
 	}
 	public void run() {
@@ -198,8 +198,8 @@
 					Executions.activate(_desktop);
 					try {
 						if (_pendingEvents != null)
-							for (Iterator it = _pendingEvents.iterator(); it.hasNext();)
-								_que.publish((Event)it.next());
+							for (Event evt: _pendingEvents)
+								_que.publish(evt);
 
 						if (_inf.callback != null)
 							_inf.callback.onEvent(null);

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/EventQueueProviderImpl.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/EventQueueProviderImpl.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/EventQueueProviderImpl.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -15,6 +15,8 @@
 import java.util.Map;
 import java.util.HashMap;
 
+import static org.zkoss.lang.Generics.cast;
+
 import org.zkoss.zk.ui.Execution;
 import org.zkoss.zk.ui.Executions;
 import org.zkoss.zk.ui.Desktop;
@@ -45,11 +47,11 @@
 				(Scope)exec.getDesktop().getWebApp(): exec.getSession(), autoCreate);
 		} else  if (EventQueues.DESKTOP.equals(scope)) {
 			final Desktop desktop = exec.getDesktop();
-			Map eqs = (Map)desktop.getAttribute(ATTR_EVENT_QUEUES);
+			Map&lt;String, EventQueue&gt; eqs = cast((Map)desktop.getAttribute(ATTR_EVENT_QUEUES));
 			if (eqs == null)
-				desktop.setAttribute(ATTR_EVENT_QUEUES, eqs = new HashMap(4));
+				desktop.setAttribute(ATTR_EVENT_QUEUES, eqs = new HashMap&lt;String, EventQueue&gt;(4));
 
-			EventQueue eq = (EventQueue)eqs.get(name);
+			EventQueue eq = eqs.get(name);
 			if (autoCreate &amp;&amp; eq == null)
 				eqs.put(name, eq = new DesktopEventQueue());
 			return eq;
@@ -64,16 +66,16 @@
 	}
 	/** Looks up a session or application scoped event queue. */
 	private EventQueue lookup0(String name, Scope ctxscope, boolean autoCreate) {
-		Map eqs;
+		Map&lt;String, EventQueue&gt; eqs;
 		synchronized (ctxscope) {
-			eqs = (Map)ctxscope.getAttribute(ATTR_EVENT_QUEUES);
+			eqs = cast((Map)ctxscope.getAttribute(ATTR_EVENT_QUEUES));
 			if (eqs == null)
-				ctxscope.setAttribute(ATTR_EVENT_QUEUES, eqs = new HashMap(4));
+				ctxscope.setAttribute(ATTR_EVENT_QUEUES, eqs = new HashMap&lt;String, EventQueue&gt;(4));
 		}
 
 		EventQueue eq;
 		synchronized (eqs) {
-			eq = (EventQueue)eqs.get(name);
+			eq = eqs.get(name);
 			if (autoCreate &amp;&amp; eq == null)
 				eqs.put(name, eq = new ServerPushEventQueue());
 		}
@@ -99,14 +101,14 @@
 		return remove0(name, wapp);
 	}
 	private boolean remove0(String name, Scope ctxscope) {
-		Map eqs;
+		Map&lt;String, EventQueue&gt; eqs;
 		synchronized (ctxscope) {
-			eqs = (Map)ctxscope.getAttribute(ATTR_EVENT_QUEUES);
+			eqs = cast((Map)ctxscope.getAttribute(ATTR_EVENT_QUEUES));
 		}
 		if (eqs != null) {
 			EventQueue eq;
 			synchronized (eqs) {
-				eq = (EventQueue)eqs.remove(name);
+				eq = eqs.remove(name);
 			}
 			if (eq != null) {
 				eq.close();

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/ServerPushEventQueue.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/ServerPushEventQueue.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/event/impl/ServerPushEventQueue.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -43,7 +43,7 @@
 public class ServerPushEventQueue implements EventQueue {
 	private static final Log log = Log.lookup(ServerPushEventQueue.class);
 	/** A map of (Desktop, DesktopThread). */
-	private final Map _dts = new HashMap();
+	private final Map&lt;Desktop, DesktopThread&gt; _dts = new HashMap&lt;Desktop, DesktopThread&gt;();
 
 	/** Publishes an event.
 	 * Unlike {@link DesktopEventQueue}, an event can be published
@@ -54,8 +54,8 @@
 			throw new IllegalArgumentException();
 
 		synchronized (_dts) {
-			for (Iterator it = _dts.values().iterator(); it.hasNext();)
-				((DesktopThread)it.next()).publish(event);
+			for (DesktopThread dtthd: _dts.values())
+				dtthd.publish(event);
 		}
 	}
 	public void subscribe(EventListener listener) {
@@ -77,7 +77,7 @@
 		final Desktop desktop = exec.getDesktop();
 		synchronized (_dts) {
 			boolean startRequired = false;
-			DesktopThread dtthd = (DesktopThread)_dts.get(desktop);
+			DesktopThread dtthd = _dts.get(desktop);
 			if (dtthd == null) {
 				desktop.addListener(new EQCleanup());
 					//OK to call addListener since it is the current desktop
@@ -107,7 +107,7 @@
 
 		final Desktop desktop = exec.getDesktop();
 		synchronized (_dts) {
-			DesktopThread dtthd = (DesktopThread)_dts.get(desktop);
+			DesktopThread dtthd = _dts.get(desktop);
 			return dtthd != null &amp;&amp; dtthd.isSubscribed(listener);
 		}
 	}
@@ -121,7 +121,7 @@
 
 		final Desktop desktop = exec.getDesktop();
 		synchronized (_dts) {
-			final DesktopThread dtthd = (DesktopThread)_dts.get(desktop);
+			final DesktopThread dtthd = _dts.get(desktop);
 			if (dtthd != null &amp;&amp; dtthd.unsubscribe(listener)) {
 				if (dtthd.isIdle()) {
 					dtthd.cease();
@@ -135,8 +135,7 @@
 	}
 	public void close() {
 		synchronized (_dts) {
-			for (Iterator it = _dts.values().iterator(); it.hasNext();) {
-				final DesktopThread dtthd = (DesktopThread)it.next();
+			for (DesktopThread dtthd: _dts.values()) {
 				dtthd.cease();
 				dtthd.disableServerPush();
 			}
@@ -147,7 +146,7 @@
 	private class DesktopThread extends Thread {
 		private final Desktop _desktop;
 		private final DesktopEventQueue _que = new DesktopEventQueue();
-		private final List _evts = new LinkedList();
+		private final List&lt;Event&gt; _evts = new LinkedList&lt;Event&gt;();
 		private final Object _mutex = new Object();
 		private transient boolean _ceased;
 		/** Indicates whether the server push is enabled by the event queue. */
@@ -162,7 +161,7 @@
 				final Execution exec = Executions.getCurrent();
 				if (exec != null &amp;&amp; exec.getDesktop() == _desktop) {
 					//same desktop no need of working thread
-					List evts = new LinkedList();
+					List&lt;Event&gt; evts = new LinkedList&lt;Event&gt;();
 					synchronized (_mutex) {
 						evts.addAll(_evts);
 						_evts.clear(); 
@@ -200,11 +199,10 @@
 			return _que.isIdle();
 		}
 
-		private void process(List evts) {
+		private void process(List&lt;Event&gt; evts) {
 			Throwable ex = null;
 			do {
-				for (Iterator it = evts.iterator(); !_ceased &amp;&amp; it.hasNext();) {
-					final Event evt = (Event)it.next();
+				for (Event evt: evts) {
 					try {
 						_que.publish(evt);
 					} catch (Throwable t) {
@@ -227,7 +225,7 @@
 			l_out:
 			while (!_ceased) {
 				try {
-					List evts = new LinkedList();
+					List&lt;Event&gt; evts = new LinkedList&lt;Event&gt;();
 					synchronized (_mutex) {
 						while (_evts.isEmpty()) {
 							_mutex.wait(30*60*1000); //30 mins
@@ -289,7 +287,7 @@
 		public void cleanup(Desktop desktop) throws Exception {
 			final DesktopThread dtthd;
 			synchronized (_dts) {
-				dtthd = (DesktopThread)_dts.remove(desktop);
+				dtthd = _dts.remove(desktop);
 			}
 
 			if (dtthd != null) {

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/ext/Native.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/ext/Native.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/ext/Native.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -37,7 +37,7 @@
 	/** Returns a readonly list of the declared namespaces
 	 * ({@link Namespace}), or empty if no declared namespace.
 	 */
-	public List getDeclaredNamespaces();
+	public List&lt;Namespace&gt; getDeclaredNamespaces();
 	/** Adds a declared namespace.
 	 * The added declared namespace will be generated to the output.
 	 *
@@ -94,7 +94,7 @@
 		 * Note: EL expressions is not allowed
 		 */
 		public void getFirstHalf(StringBuffer sb, String tag,
-		Map props, Collection namespaces);
+		Map&lt;String, Object&gt; props, Collection namespaces);
 		/** Appends the first half of the device-dependent content
 		 * for the specified tag and properties, and appends it to
 		 * the specified string buffer.

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/ext/Scopes.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/ext/Scopes.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/ext/Scopes.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -40,10 +40,10 @@
 public class Scopes {
 	private static final Log log = Log.lookup(Scopes.class);
 
-	/** A stack of implict objects ({@link Implicts}. */
-	private static final ThreadLocal _implicits = new ThreadLocal();
+	/** A stack of implict objects ({@link Implicit}). */
+	private static final ThreadLocal&lt;List&lt;Implicit&gt;&gt; _implicits = new ThreadLocal&lt;List&lt;Implicit&gt;&gt;();
 	/** A stack of current scope. */
-	private static final ThreadLocal _scopes = new ThreadLocal();
+	private static final ThreadLocal&lt;List&lt;Scope&gt;&gt; _scopes = new ThreadLocal&lt;List&lt;Scope&gt;&gt;();
 
 	/** Prepares implicit variable before calling {@link Page#interpret}.
 	 *
@@ -92,9 +92,9 @@
 		return scope;
 	}
 	private static Implicit beforeInterpret0(Scope scope) {
-		List impls = (List)_implicits.get();
+		List&lt;Implicit&gt; impls = _implicits.get();
 		if (impls == null)
-			_implicits.set(impls = new LinkedList());
+			_implicits.set(impls = new LinkedList&lt;Implicit&gt;());
 		final Implicit impl = new Implicit();
 		impls.add(0, impl);
 
@@ -109,7 +109,7 @@
 	 * variables.
 	 */
 	public static final void afterInterpret() {
-		((List)_implicits.get()).remove(0);
+		_implicits.get().remove(0);
 		pop();
 	}
 
@@ -118,8 +118,7 @@
 	 * {@link #afterInterpret}.
 	 */
 	public static void setImplicit(String name, Object value) {
-		((Implicit)((List)_implicits.get()).get(0))
-			.setImplicit(name, value);
+		_implicits.get().get(0).setImplicit(name, value);
 	}
 	/** Returns the implict object.
 	 *
@@ -132,9 +131,9 @@
 	 * object is not defined.
 	 */
 	public static Object getImplicit(String name, Object defValue) {
-		final List implicits = (List)_implicits.get();
+		final List&lt;Implicit&gt; implicits = _implicits.get();
 		if (implicits != null &amp;&amp; !implicits.isEmpty()) //in case: beforeInterpret not called
-			return ((Implicit)implicits.get(0)).getImplicit(name, defValue);
+			return implicits.get(0).getImplicit(name, defValue);
 
 		Object val = getSysImplicit(name);
 		return val != null ? val: defValue;
@@ -158,9 +157,8 @@
 	 * is assumed.
 	 */
 	public static final Scope getCurrent(Page page) {
-		final List nss = (List)_scopes.get();
-		final Scope scope =
-			nss != null &amp;&amp; !nss.isEmpty() ? (Scope)nss.get(0): null;
+		final List&lt;Scope&gt; nss = _scopes.get();
+		final Scope scope = nss != null &amp;&amp; !nss.isEmpty() ? nss.get(0): null;
 		if (scope != null)
 			return scope;
 
@@ -176,20 +174,20 @@
 	 * @param scope the scope. If null, it means page's scope.
 	 */
 	private static final void push(Scope scope) {
-		List nss = (List)_scopes.get();
+		List&lt;Scope&gt; nss = _scopes.get();
 		if (nss == null)
-			_scopes.set(nss = new LinkedList());
+			_scopes.set(nss = new LinkedList&lt;Scope&gt;());
 		nss.add(0, scope);
 	}
 	/** Pops the current namespce (pushed by {@link #push}).
 	 */
 	private static final void pop() {
-		((List)_scopes.get()).remove(0);
+		_scopes.get().remove(0);
 	}
 
 	private static class Implicit {
 		/** Implicit variables. */
-		private final Map _vars = new HashMap();
+		private final Map&lt;String, Object&gt; _vars = new HashMap&lt;String, Object&gt;();
 
 		private Implicit() {
 		}

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/http/AbstractExtendlet.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/http/AbstractExtendlet.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/http/AbstractExtendlet.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -50,14 +50,14 @@
  * @author tomyeh
  * @since 5.0.0
  */
-/*package*/ abstract class AbstractExtendlet implements Extendlet {
+/*package*/ abstract class AbstractExtendlet&lt;V&gt; implements Extendlet {
 	static final Log log = Log.lookup(WpdExtendlet.class);
 
 	ExtendletContext _webctx;
 	/** DSP interpretation cache. */
-	ResourceCache _cache;
+	ResourceCache&lt;String, V&gt; _cache;
 	/** The provider. */
-	private ThreadLocal _provider = new ThreadLocal();
+	private ThreadLocal&lt;Provider&gt; _provider = new ThreadLocal&lt;Provider&gt;();
 	private Boolean _debugJS;
 
 	//Public Utilities
@@ -79,7 +79,7 @@
 
 	//Package Utilities
 	Provider getProvider() {
-		return (Provider)_provider.get();
+		return _provider.get();
 	}
 	void setProvider(Provider provider) {
 		_provider.set(provider);
@@ -90,9 +90,9 @@
 	ServletContext getServletContext() {
 		return _webctx != null ? _webctx.getServletContext(): null;
 	}
-	void init(ExtendletConfig config, ExtendletLoader loader) {
+	void init(ExtendletConfig config, ExtendletLoader&lt;V&gt; loader) {
 		_webctx = config.getExtendletContext();
-		_cache = new ResourceCache(loader, 16);
+		_cache = new ResourceCache&lt;String, V&gt;(loader, 16);
 		_cache.setMaxSize(1024);
 		_cache.setLifetime(60*60*1000); //1hr
 		final int checkPeriod = loader.getCheckPeriod();
@@ -157,6 +157,32 @@
 		return feature == ALLOW_DIRECT_INCLUDE;
 	}
 
+	/*package*/ //called by Provider
+	InputStream getResourceAsStream(HttpServletRequest request, String path, boolean locate)
+	throws IOException, ServletException {
+		if (locate)
+			path = Servlets.locate(_webctx.getServletContext(),
+				request, path, _webctx.getLocator());
+
+		if (_cache.getCheckPeriod() &gt;= 0) {
+			//Due to Web server might cache the result, we use URL if possible
+			try {
+				URL url = _webctx.getResource(path);
+				if (url != null)
+					return url.openStream();
+			} catch (Throwable ex) {
+				log.warningBriefly("Unable to read from URL: "+path, ex);
+			}
+		}
+
+		//Note: _webctx will handle the renaming for debugJS (.src.js)
+		return _webctx.getResourceAsStream(path);
+	}
+	/*package*/ //called by Provider
+	URL getResource(String path) throws IOException {
+		return _webctx.getResource(path);
+	}
+
 	//utility class
 	/*package*/ static class MethodInfo {
 		final Method method;
@@ -166,64 +192,51 @@
 			this.arguments = arguments;
 		}
 	}
-	/*package*/ class Provider { //don't use private since WpdContent needs it
-		/*package*/ final HttpServletRequest request;
-		/*package*/ final HttpServletResponse response;
+}
 
-		/*package*/ Provider(HttpServletRequest request, HttpServletResponse response) {
-			this.request = request;
-			this.response = response;
-		}
+/*package*/ class Provider { //don't use private since WpdContent needs it
+	private AbstractExtendlet _extlet;
+	/*package*/ final HttpServletRequest request;
+	/*package*/ final HttpServletResponse response;
 
-		/*package*/
-		InputStream getResourceAsStream(String path, boolean locate)
-		throws IOException, ServletException {
-			if (locate)
-				path = Servlets.locate(_webctx.getServletContext(),
-					this.request, path, _webctx.getLocator());
-
-			if (_cache.getCheckPeriod() &gt;= 0) {
-				//Due to Web server might cache the result, we use URL if possible
-				try {
-					URL url = _webctx.getResource(path);
-					if (url != null)
-						return url.openStream();
-				} catch (Throwable ex) {
-					log.warningBriefly("Unable to read from URL: "+path, ex);
-				}
-			}
-
-			//Note: _webctx will handle the renaming for debugJS (.src.js)
-			return _webctx.getResourceAsStream(path);
-		}
-		URL getResource(String path) throws IOException {
-			return _webctx.getResource(path);
-		}
+	/*package*/ Provider(AbstractExtendlet extlet, HttpServletRequest request, HttpServletResponse response) {
+		_extlet = extlet;
+		this.request = request;
+		this.response = response;
 	}
-	/*package*/ class FileProvider extends Provider {
-		private String _parent;
-		/*package*/ FileProvider(File file, boolean debugJS) {
-			super(null, null);
-			_parent = file.getParent();
+	InputStream getResourceAsStream(String path, boolean locate)
+	throws IOException, ServletException {
+		return _extlet.getResourceAsStream(this.request, path, locate);
+	}
+	URL getResource(String path) throws IOException {
+		return _extlet.getResource(path);
+	}
+}
+/*package*/ class FileProvider extends Provider {
+	private String _parent;
+	private boolean _debugJS;
+	/*package*/ FileProvider(File file, boolean debugJS) {
+		super(null, null, null);
+		_debugJS = debugJS;
+		_parent = file.getParent();
+	}
+	InputStream getResourceAsStream(String path, boolean locate)
+	throws IOException {
+		path = getRealPath(path);
+		final File file = new File(_parent, path);
+		return locate ? new FileInputStream(Files.locate(file.getPath())):
+			new FileInputStream(file);
+	}
+	URL getResource(String path) throws IOException {
+		path = getRealPath(path);
+		return new File(_parent, path).toURI().toURL();
+	}
+	protected String getRealPath(String path) {
+		if (_debugJS) {
+			final int j = path.lastIndexOf('.');
+			if (j &gt;= 0)
+				return path.substring(0, j) + ".src" + path.substring(j);
 		}
-		InputStream getResourceAsStream(String path, boolean locate)
-		throws IOException {
-			path = getRealPath(path);
-			final File file = new File(_parent, path);
-			return locate ? new FileInputStream(Files.locate(file.getPath())):
-				new FileInputStream(file);
-		}
-		URL getResource(String path) throws IOException {
-			path = getRealPath(path);
-			return new File(_parent, path).toURI().toURL();
-		}
-		protected String getRealPath(String path) {
-			if (isDebugJS()) {
-				final int j = path.lastIndexOf('.');
-				if (j &gt;= 0)
-					return path.substring(0, j) + ".src" + path.substring(j);
-			}
-			return path;
-		}
+		return path;
 	}
 }

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutPortlet.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutPortlet.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutPortlet.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -330,7 +330,7 @@
 					Messages.get(MZk.PORTLET_PAGE_REQUIRED);
 		}
 
-		final Map attrs = new HashMap();
+		final Map&lt;String, String&gt; attrs = new HashMap&lt;String, String&gt;();
 		attrs.put(Attributes.ALERT_TYPE, "error");
 		attrs.put(Attributes.ALERT, msg);
 		Portlets.include(getPortletContext(), request, response,

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/http/ExecutionImpl.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/http/ExecutionImpl.java	2010-09-14 05:39:14 UTC (rev 14275)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/http/ExecutionImpl.java	2010-09-15 05:41:58 UTC (rev 14276)
@@ -85,7 +85,7 @@
 	private final HttpServletRequest _request;
 	private final HttpServletResponse _response;
 	private final RequestContext _xelctx;
-	private final Map _attrs;
+	private final Map&lt;String, Object&gt; _attrs;
 	private MyEval _eval;
 	private ExecutionResolver _resolver;
 	private final ScopeListeners _scopeListeners = new ScopeListeners(this);
@@ -105,7 +105,8 @@
 		_xelctx = new ReqContext();
 
 		_attrs = new AttributesMap() {
-			protected Enumeration getKeys() {
+			@SuppressWarnings("unchecked")
+			protected Enumeration&lt;String&gt; getKeys() {
 				return _request.getAttributeNames();
 			}
 			protected Object getValue(String key) {
@@ -136,7 +137,8 @@
 	public String getParameter(String name) {
 		return _request.getParameter(name);
 	}
-	public Map getParameterMap() {
+	@SuppressWarnings("unchecked")
+	public Map&lt;String, String[]&gt; getParameterMap() {
 		return _request.getParameterMap();
 	}
 
@@ -156,7 +158,7 @@
 		return Expressions.newExpressionFactory();
 	}
 
-	public Evaluator getEvaluator(Page page, Class expfcls) {
+	public Evaluator getEvaluator(Page page, Class&lt;? extends ExpressionFactory&gt; expfcls) {
 		if (page == null)
 			page = getCurrentPage();
 
@@ -168,19 +170,19 @@
 			_eval = new MyEval(page, expfcls);
 		return _eval;
 	}
-	public Evaluator getEvaluator(Component comp, Class expfcls) {
+	public Evaluator getEvaluator(Component comp, Class&lt;? extends ExpressionFactory&gt; expfcls) {
 		return getEvaluator(comp != null ? comp.getPage(): null, expfcls);
 	}
 
-	public Object evaluate(Component comp, String expr, Class expectedType) {
+	public Object evaluate(Component comp, String expr, Class&lt;?&gt; expectedType) {
 		return evaluate0(comp, expr, expectedType,
 			comp != null ? comp.getPage(): null);
 	}
-	public Object evaluate(Page page, String expr, Class expectedType) {
+	public Object evaluate(Page page, String expr, Class&lt;?&gt; expectedType) {
 		return evaluate0(page, expr, expectedType, page);
 	}
 	private Object evaluate0(Object self, String expr,
-	Class expectedType, Page page) {
+	Class&lt;?&gt; expectedType, Page page) {

@@ Diff output truncated at 100000 characters. @@

This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26178077">[zk1-subversion-log] SF.net SVN: zk1:[14278] branches</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-17 05:40</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14278
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14278&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14278&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-17 05:40:36 +0000 (Fri, 17 Sep 2010)

Log Message:
-----------
Fri 09/17/2010

Modified Paths:
--------------
    branches/5.0/zk/src/archive/web/js/zk/au.js
    branches/5.0/zk/src/org/zkoss/zk/au/AuWriters.java
    branches/5.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
    branches/5.0/zk/src/org/zkoss/zk/au/http/HttpAuWriter.java
    branches/5.0/zk/src/org/zkoss/zk/ui/Richlet.java
    branches/5.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java
    branches/5.0/zk/src/org/zkoss/zk/ui/http/Utils.java
    branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
    branches/5.0/zk/src/org/zkoss/zk/ui/sys/UiEngine.java
    branches/5.0/zkdemo/src/archive/WEB-INF/web.xml
    branches/5.0/zkdemo/src/archive/test/groupInPaging/model.zul
    branches/5.0/zkdemo/src/archive/test2/Z35-grid-0102.zul
    branches/5.0/zkdemo/src/archive/test2/Z35-listbox-0002.zul
    branches/5.0/zkdemo/src/archive/userguide/grid/advGrouping.zul
    branches/5.0/zkdemo/src/archive/userguide/grid/detail.zul
    branches/5.0/zkdemo/src/archive/userguide/grid/grouping.zul
    branches/5.0/zkdoc/release-note
    branches/5.0/zul/src/org/zkoss/zul/ArrayGroupsModel.java
    branches/5.0/zul/src/org/zkoss/zul/SimpleGroupsModel.java
    branches/6.0/zcommon/src/org/zkoss/json/JSONObject.java
    branches/6.0/zcommon/src/org/zkoss/lang/reflect/Fields.java
    branches/6.0/zcommon/src/org/zkoss/util/ArraysX.java
    branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
    branches/6.0/zcommon/src/org/zkoss/xel/Function.java
    branches/6.0/zcommon/src/org/zkoss/xel/util/MethodFunction.java
    branches/6.0/zk/src/archive/web/js/zk/au.js
    branches/6.0/zk/src/org/zkoss/zk/au/AuRequests.java
    branches/6.0/zk/src/org/zkoss/zk/au/AuWriters.java
    branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
    branches/6.0/zk/src/org/zkoss/zk/au/http/HttpAuWriter.java
    branches/6.0/zk/src/org/zkoss/zk/scripting/bsh/BSHInterpreter.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Components.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Richlet.java
    branches/6.0/zk/src/org/zkoss/zk/ui/event/EventQueue.java
    branches/6.0/zk/src/org/zkoss/zk/ui/event/GenericEventListener.java
    branches/6.0/zk/src/org/zkoss/zk/ui/event/SelectEvent.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/Utils.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/WebManager.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiVisualizer.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Property.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/UiEngine.java
    branches/6.0/zkdemo/src/archive/WEB-INF/web.xml
    branches/6.0/zkdemo/src/archive/test/groupInPaging/model.zul
    branches/6.0/zkdemo/src/archive/test2/Z35-grid-0102.zul
    branches/6.0/zkdemo/src/archive/test2/Z35-listbox-0002.zul
    branches/6.0/zkdemo/src/archive/test2/config.properties
    branches/6.0/zkdoc/release-note
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingComboitemRenderer.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingListitemRenderer.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingRowRenderer.java
    branches/6.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp
    branches/6.0/zul/src/archive/web/js/zul/menu/Menupopup.js
    branches/6.0/zul/src/archive/web/js/zul/mesh/HeaderWidget.js
    branches/6.0/zul/src/archive/web/zul/css/norm.css.dsp
    branches/6.0/zul/src/org/zkoss/zul/AbstractChartModel.java
    branches/6.0/zul/src/org/zkoss/zul/AbstractGroupsModel.java
    branches/6.0/zul/src/org/zkoss/zul/AbstractListModel.java
    branches/6.0/zul/src/org/zkoss/zul/AbstractTreeModel.java
    branches/6.0/zul/src/org/zkoss/zul/Applet.java
    branches/6.0/zul/src/org/zkoss/zul/Captcha.java
    branches/6.0/zul/src/org/zkoss/zul/Chart.java
    branches/6.0/zul/src/org/zkoss/zul/Column.java
    branches/6.0/zul/src/org/zkoss/zul/GanttModel.java
    branches/6.0/zul/src/org/zkoss/zul/Grid.java
    branches/6.0/zul/src/org/zkoss/zul/GroupComparator.java
    branches/6.0/zul/src/org/zkoss/zul/GroupsModel.java
    branches/6.0/zul/src/org/zkoss/zul/GroupsModelExt.java
    branches/6.0/zul/src/org/zkoss/zul/Include.java
    branches/6.0/zul/src/org/zkoss/zul/ListModel.java
    branches/6.0/zul/src/org/zkoss/zul/ListModelArray.java
    branches/6.0/zul/src/org/zkoss/zul/ListModelExt.java
    branches/6.0/zul/src/org/zkoss/zul/ListModelList.java
    branches/6.0/zul/src/org/zkoss/zul/ListModelMap.java
    branches/6.0/zul/src/org/zkoss/zul/ListModelSet.java
    branches/6.0/zul/src/org/zkoss/zul/ListModels.java
    branches/6.0/zul/src/org/zkoss/zul/ListSubModel.java
    branches/6.0/zul/src/org/zkoss/zul/Messagebox.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleGroupsModel.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleListModel.java
    branches/6.0/zul/src/org/zkoss/zul/Tree.java
    branches/6.0/zul/src/org/zkoss/zul/TreeModel.java
    branches/6.0/zul/src/org/zkoss/zul/Treechildren.java
    branches/6.0/zul/src/org/zkoss/zul/api/Applet.java
    branches/6.0/zul/src/org/zkoss/zul/api/Captcha.java
    branches/6.0/zul/src/org/zkoss/zul/api/Grid.java
    branches/6.0/zul/src/org/zkoss/zul/event/RenderEvent.java
    branches/6.0/zul/src/org/zkoss/zul/event/TreeDataEvent.java
    branches/6.0/zul/src/org/zkoss/zul/ext/Selectable.java

Added Paths:
-----------
    branches/5.0/zkdemo/src/archive/test/embed.jsp
    branches/5.0/zkdemo/src/org/zkoss/zkdemo/test/Embed.java
    branches/5.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1GroupsModelArray.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/embed/
    branches/5.0/zkplus/src/org/zkoss/zkplus/embed/Bridge.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/embed/Renders.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/embed/packackage.html
    branches/5.0/zul/src/org/zkoss/zul/GroupsModelArray.java
    branches/6.0/zkdemo/src/archive/test/embed.jsp
    branches/6.0/zkdemo/src/archive/test2/B50-3061764.zul
    branches/6.0/zkdemo/src/archive/test2/B50-3061765.zul
    branches/6.0/zkdemo/src/archive/test2/F50-3061671.zul
    branches/6.0/zkdemo/src/org/zkoss/zkdemo/test/Embed.java
    branches/6.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1GroupsModelArray.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/embed/
    branches/6.0/zkplus/src/org/zkoss/zkplus/embed/Bridge.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/embed/Renders.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/embed/packackage.html
    branches/6.0/zul/src/org/zkoss/zul/GroupsModelArray.java
    branches/6.0/zul/srcdp/
    branches/6.0/zul/srcdp/org/
    branches/6.0/zul/srcdp/org/zkoss/
    branches/6.0/zul/srcdp/org/zkoss/zul/
    branches/6.0/zul/srcdp/org/zkoss/zul/ArrayGroupsModel.java

Modified: branches/5.0/zk/src/archive/web/js/zk/au.js
===================================================================
--- branches/5.0/zk/src/archive/web/js/zk/au.js	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zk/src/archive/web/js/zk/au.js	2010-09-17 05:40:36 UTC (rev 14278)
@@ -31,7 +31,7 @@
 			zAu.doneTime = zUtl.now();
 		}
 	}
-	function pushCmds(reqInf, req) {
+	function pushReqCmds(reqInf, req) {
 		var dt = reqInf.dt,
 			rt = req.responseText;
 		if (!rt) {
@@ -54,6 +54,10 @@
 			if (!isNaN(rid)) cmds.rid = rid;
 		}
 
+		pushCmds(cmds, rs);
+		return true;
+	}
+	function pushCmds(cmds, rs) {
 		for (var j = 0, rl = rs ? rs.length: 0; j &lt; rl; ++j) {
 			var r = rs[j],
 				cmd = r[0],
@@ -68,7 +72,6 @@
 		}
 
 		cmdsQue.push(cmds);
-		return true;
 	}
 	function doProcess(cmd, data) { //decoded
 		//1. process zAu.cmd1 (cmd1 has higher priority)
@@ -149,7 +152,7 @@
 						ajaxReqResend(reqInf);
 						return;
 					}
-					if (pushCmds(reqInf, req)) { //valid response
+					if (pushReqCmds(reqInf, req)) { //valid response
 						//advance SID to avoid receive the same response twice
 						if (sid &amp;&amp; ++seqId &gt; 9999) seqId = 1;
 						ajaxReqTries = 0;
@@ -574,6 +577,17 @@
 	shallIgnoreESC: function () {
 		return ajaxReq;
 	},
+	/** Process the specified commands.
+	 * @param String dtid the desktop's ID
+	 * @param Array rs a list of responses
+	 * @since 5.0.5
+	 */
+	doCmds: function (dtid, rs) {
+		var cmds = [];
+		cmds.dt = zk.Desktop.$(dtid);
+		pushCmds(cmds, rs);
+		this._doCmds();
+	},
 	_doCmds: function () { //called by mount.js, too
 		for (var fn; fn = doCmdFns.shift();)
 			fn();

Modified: branches/5.0/zk/src/org/zkoss/zk/au/AuWriters.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/au/AuWriters.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zk/src/org/zkoss/zk/au/AuWriters.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -19,6 +19,7 @@
 import java.io.Writer;
 import java.io.IOException;
 
+import org.zkoss.json.*;
 import org.zkoss.idom.Verifier;
 
 import org.zkoss.zk.ui.UiException;
@@ -66,6 +67,31 @@
 		return new HttpAuWriter();
 	}
 
+	/** Returns a JSON object representing the output that will be sent
+	 * to the client.
+	 * &lt;p&gt;You could add the responses to the given array by invoking
+	 * {@link #toJSON}.
+	 *
+	 * @param rs the array to hold the responses.
+	 * To output a response, invoke {@link #toJSON} as follows:
+	 * &lt;code&gt;rs.add(AuWriters.toJSON(response))&lt;/code&gt;.
+	 * @since 5.0.5
+	 */
+	public static JSONObject getJSONOutput(JSONArray rs) {
+		final JSONObject out = new JSONObject();
+		out.put("rs", rs);
+		return out;
+	}
+	/** Converts a response to a JSON object.
+	 *@since 5.0.5
+	 */
+	public static JSONArray toJSON(AuResponse response) {
+		final JSONArray r = new JSONArray();
+		r.add(response.getCommand());
+		r.add(response.getEncodedData());
+		return r;
+	}
+
 	/** The content type of the output.
 	 * @since 3.5.0
 	 */

Modified: branches/5.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -23,7 +23,6 @@
 import java.util.Map;
 import java.util.HashMap;
 import java.util.Date;
-import java.io.StringWriter;
 import java.io.IOException;
 
 import javax.servlet.ServletConfig;

Modified: branches/5.0/zk/src/org/zkoss/zk/au/http/HttpAuWriter.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/au/http/HttpAuWriter.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zk/src/org/zkoss/zk/au/http/HttpAuWriter.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -72,8 +72,7 @@
 			//Bug 1907640: with Glassfish v1, we cannot change content type
 			//in another thread, so we have to do it here
 
-		_out = new JSONObject();
-		_out.put("rs", _rs = new JSONArray());
+		_out = AuWriters.getJSONOutput(_rs = new JSONArray());
 		return this;
 	}
 	public void close(Object request, Object response) throws IOException {
@@ -148,10 +147,7 @@
 		_out.put("rid", new Integer(resId));
 	}
 	public void write(AuResponse response) throws IOException {
-		final JSONArray r = new JSONArray();
-		r.add(response.getCommand());
-		r.add(response.getEncodedData());
-		_rs.add(r);
+		_rs.add(AuWriters.toJSON(response));
 	}
 	public void write(Collection responses) throws IOException {
 		for (Iterator it = responses.iterator(); it.hasNext();)

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/Richlet.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/Richlet.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/Richlet.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -43,7 +43,7 @@
 	/** Called by the richlet container to create components when
 	 * the specified page is visited and created.
 	 */
-	public void service(Page page);
+	public void service(Page page) throws Exception;
 
 	/** Returns the default language defintion that this richlet belongs to.
 	 * Don't return null.

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -106,7 +106,7 @@
 		if (_webman != null) {
 			log.info("Web Manager was created before ZK loader");
 		} else {
-			String updateURI = Utils.fixUpdateURI(
+			String updateURI = Utils.checkUpdateURI(
 				config.getInitParameter("update-uri"), "The update-uri parameter");
 			_webman = new WebManager(_ctx, updateURI);
 			_webmanCreated = true;

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/http/Utils.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/http/Utils.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/http/Utils.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -221,7 +221,14 @@
 		return null;
 	}
 
-	/*package*/ static final String fixUpdateURI(String updateURI, String info)
+	/** Checks the update URI.
+	 * @param updateURI the update URI to be checked.
+	 * @param info the info to show if updateURI is incorrect.
+	 * @return the update URI (by removing ending / if any)
+	 * @exception ServletException if updateURI is incorrect.
+	 * @since 5.0.5
+	 */
+	public static final String checkUpdateURI(String updateURI, String info)
 	throws ServletException {
 		if (updateURI == null
 		|| (updateURI = updateURI.trim()).length() == 0

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -44,6 +44,7 @@
 import org.zkoss.util.ArraysX;
 import org.zkoss.util.logging.Log;
 import org.zkoss.web.servlet.Servlets;
+import org.zkoss.json.*;
 
 import org.zkoss.zk.mesg.MZk;
 import org.zkoss.zk.ui.*;
@@ -1167,6 +1168,84 @@
 				meterAuServerComplete(pfmeter, doneReqIds, exec);
 		}
 	}
+	public Object startUpdate(Execution exec) throws IOException {
+		final Desktop desktop = exec.getDesktop();
+		UiVisualizer uv = doActivate(exec, true, false, null);
+		desktop.getWebApp().getConfiguration().invokeExecutionInits(exec, null);
+		((DesktopCtrl)desktop).invokeExecutionInits(exec, null);
+		return new UpdateInfo(uv);
+	}
+	public JSONArray finishUpdate(Object ctx) throws IOException {
+		final UpdateInfo ui = (UpdateInfo)ctx;
+		final Execution exec = ui.uv.getExecution();
+		final Desktop desktop = exec.getDesktop();
+		final List errs = new LinkedList();
+
+		//1. process events
+		Event event = nextEvent(ui.uv);
+		do {
+			for (; event != null; event = nextEvent(ui.uv)) {
+				try {
+					process(desktop, event);
+				} catch (Throwable ex) {
+					handleError(ex, ui.uv, errs);
+					break; //skip the rest of events! 
+				}
+			}
+
+			resumeAll(desktop, ui.uv, errs);
+		} while ((event = nextEvent(ui.uv)) != null);
+
+		//2. Handle aborting reason
+		ui.abrn = ui.uv.getAbortingReason();
+		if (ui.abrn != null)
+			ui.abrn.execute(); //always execute even if !isAborting
+
+		//3. Retrieve responses
+		List responses;
+		try {
+			if (!errs.isEmpty())
+				visualizeErrors(exec, ui.uv, errs);
+
+			responses = ui.uv.getResponses();
+		} catch (Throwable ex) {
+			responses = new LinkedList();
+			responses.add(new AuAlert(Exceptions.getMessage(ex)));
+
+			log.error(ex);
+		}
+
+		final JSONArray rs = new JSONArray();
+		for (Iterator it = responses.iterator(); it.hasNext();)
+			rs.add(AuWriters.toJSON((AuResponse)it.next()));
+		return rs;
+	}
+	public void closeUpdate(Object ctx) throws IOException {
+		final UpdateInfo ui = (UpdateInfo)ctx;
+		final Execution exec = ui.uv.getExecution();
+
+		final Desktop desktop = exec.getDesktop();
+		((DesktopCtrl)desktop).invokeExecutionCleanups(exec, null, null);
+		desktop.getWebApp().getConfiguration().invokeExecutionCleanups(exec, null, null);
+
+		if (ui.abrn != null) {
+			try {
+				ui.abrn.finish();
+			} catch (Throwable t) {
+				log.warning(t);
+			}
+		}
+
+		doDeactivate(exec);
+	}
+	private static class UpdateInfo {
+		private final UiVisualizer uv;
+		private AbortingReason abrn;
+		private UpdateInfo(UiVisualizer uv) {
+			this.uv = uv;
+		}
+	}
+
 	/** Handles each error. The erros will be queued to the errs list
 	 * and processed later by {@link #visualizeErrors}.
 	 */

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/sys/UiEngine.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/sys/UiEngine.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/sys/UiEngine.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -22,6 +22,7 @@
 import java.io.IOException;
 import java.io.Writer;
 
+import org.zkoss.json.JSONArray;
 import org.zkoss.zk.ui.WebApp;
 import org.zkoss.zk.ui.Desktop;
 import org.zkoss.zk.ui.Page;
@@ -184,6 +185,35 @@
 	public void execUpdate(Execution exec, List requests, AuWriter out)
 	throws IOException;
 
+	/** Activates an execution that will allow developers to update
+	 * the state of components.
+	 * &lt;p&gt;It is designed to implement {@link org.zkoss.zkplus.embed.Bridge}.
+	 *
+	 * @return a context that shall be passed to {@link #finishUpdate}.
+	 * @since 5.0.5
+	 * @see #finishUpdate
+	 * @see #closeUpdate
+	 */
+	public Object startUpdate(Execution exec) throws IOException;
+	/** Finishes the update and returns the result in an array of JSON object.
+	 * Notice it does not deactivate the execution. Rather, the caller
+	 * has to invoke {@link #closeUpdate}.
+	 * &lt;p&gt;It is designed to implement {@link org.zkoss.zkplus.embed.Bridge}.
+	 *
+	 * @param ctx the context returned by the previous call to {@link #startUpdate}
+	 * @since 5.0.5
+	 * @see #startUpdate
+	 * @see #closeUpdate
+	 */
+	public JSONArray finishUpdate(Object ctx) throws IOException;
+	/** Deactivates the execution and cleans up.
+	 * &lt;p&gt;It is designed to implement {@link org.zkoss.zkplus.embed.Bridge}.
+	 * @since 5.0.5
+	 * @see #startUpdate
+	 * @see #finishUpdate
+	 */
+	public void closeUpdate(Object ctx) throws IOException;
+
 	/** Executes the recovering.
 	 */
 	public void execRecover(Execution exec, FailoverManager failover);

Modified: branches/5.0/zkdemo/src/archive/WEB-INF/web.xml
===================================================================
--- branches/5.0/zkdemo/src/archive/WEB-INF/web.xml	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zkdemo/src/archive/WEB-INF/web.xml	2010-09-17 05:40:36 UTC (rev 14278)
@@ -109,22 +109,28 @@
 		&lt;url-pattern&gt;/zkau/*&lt;/url-pattern&gt;
 	&lt;/servlet-mapping&gt;
 
-	&lt;!-- Used to test the booksuggest example --&gt;
+	&lt;!-- Used to test test/booksuggest.html
 	&lt;servlet&gt;
-		&lt;description&gt;Test of booksuggest&lt;/description&gt;
+		&lt;description&gt;Test of test/booksuggest.html&lt;/description&gt;
 		&lt;servlet-name&gt;booksuggest&lt;/servlet-name&gt;
 		&lt;servlet-class&gt;org.zkoss.zkdemo.test.BookSuggest&lt;/servlet-class&gt;
-		&lt;!-- Any number of parameters
-		&lt;init-param&gt;
-			&lt;param-name&gt;foo&lt;/param-name&gt;
-			&lt;param-value&gt;foo&lt;/param-value&gt;
-		&lt;/init-param&gt;
-		--&gt;
 	&lt;/servlet&gt;
 	&lt;servlet-mapping&gt;
 		&lt;servlet-name&gt;booksuggest&lt;/servlet-name&gt;
 		&lt;url-pattern&gt;/booksuggest/*&lt;/url-pattern&gt;
 	&lt;/servlet-mapping&gt;
+	 --&gt;
+	&lt;!-- Used to test test/test.jsp
+	&lt;servlet&gt;
+		&lt;description&gt;Test of test/embed.jsp&lt;/description&gt;
+		&lt;servlet-name&gt;embed&lt;/servlet-name&gt;
+		&lt;servlet-class&gt;org.zkoss.zkdemo.test.Embed&lt;/servlet-class&gt;
+	&lt;/servlet&gt;
+	&lt;servlet-mapping&gt;
+		&lt;servlet-name&gt;embed&lt;/servlet-name&gt;
+		&lt;url-pattern&gt;/embed/*&lt;/url-pattern&gt;
+	&lt;/servlet-mapping&gt;
+	--&gt;
 
 	&lt;!-- Uncomment if you want to use the ZK filter to post process the HTML output
 	generated by other technology, such as JSP and velocity.

Added: branches/5.0/zkdemo/src/archive/test/embed.jsp
===================================================================
--- branches/5.0/zkdemo/src/archive/test/embed.jsp	                        (rev 0)
+++ branches/5.0/zkdemo/src/archive/test/embed.jsp	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,47 @@
+&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" target="_new">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"&gt;
+&lt;%@page import="org.zkoss.zk.ui.*"%&gt;
+&lt;%@page import="org.zkoss.zul.*"%&gt;
+&lt;%@page import="org.zkoss.zkplus.embed.Renders"%&gt;
+&lt;%@page import="java.util.*"%&gt;
+&lt;html&gt;
+	&lt;head&gt;
+		&lt;title&gt;Test of Embedded Component&lt;/title&gt;
+	&lt;/head&gt;
+	&lt;body style="height:auto"&gt;
+		&lt;p&gt;This is a test of embed component: listbox.&lt;/p&gt;
+		&lt;%
+	final HttpSession sess = session;
+	Renders.render(config.getServletContext(), request, response,
+		new GenericRichlet() {
+	public void service(Page page) {
+		Listbox listbox = new Listbox();
+		listbox.appendChild(new Listitem("Item 1"));
+		listbox.appendChild(new Listitem("Item 2"));
+		listbox.setPage(page);
+	}
+		}, null, out);
+		%&gt;
+		&lt;script&gt;
+		function ajaxClick() {
+		 jq.ajax({
+			   type: 'POST',
+			   url: zk.ajaxURI('/embed'),
+			   dataType: 'text',
+			   data: 'desktop=' + zk.Desktop.$().id,
+			   success: function (jscode) {
+					eval(jscode);
+				}
+			 });
+	}
+		&lt;/script&gt;
+
+		This is a regular button to send Ajax thru jQuery (not AU)
+		&lt;button type="button" onclick="ajaxClick()"&gt;click me&lt;/button&gt;
+
+		&lt;p&gt;This is a test of embed component: datebox.&lt;/p&gt;
+		&lt;%
+	Datebox db = new Datebox();
+	Renders.render(config.getServletContext(), request, response, db, null, out);
+		%&gt;
+	&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Modified: branches/5.0/zkdemo/src/archive/test/groupInPaging/model.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/test/groupInPaging/model.zul	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zkdemo/src/archive/test/groupInPaging/model.zul	2010-09-17 05:40:36 UTC (rev 14278)
@@ -91,8 +91,8 @@
 		Comparator asc2 = new MyComparator(true,true);
 		Comparator dsc2 = new MyComparator(false,true);
 		
-		GroupsModel model1 = new ArrayGroupsModel(datas,asc1);
-		GroupsModel model2 = new org.zkoss.zkdemo.test2.group.Test1ArrayGroupsModel(datas,(Comparator)asc1);
+		GroupsModel model1 = new GroupsModelArray(datas,asc1);
+		GroupsModel model2 = new org.zkoss.zkdemo.test2.group.Test1GroupsModelArray(datas,(Comparator)asc1);
 
 	]]&gt;&lt;/zscript&gt;	
 	&lt;div&gt;

Modified: branches/5.0/zkdemo/src/archive/test2/Z35-grid-0102.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/test2/Z35-grid-0102.zul	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zkdemo/src/archive/test2/Z35-grid-0102.zul	2010-09-17 05:40:36 UTC (rev 14278)
@@ -107,8 +107,8 @@
 		Comparator asc2 = new MyComparator(true,true);
 		Comparator dsc2 = new MyComparator(false,true);
 		
-		GroupsModel model1 = new ArrayGroupsModel(datas,asc1);
-		GroupsModel model2 = new org.zkoss.zkdemo.test2.group.Test1ArrayGroupsModel(datas,(Comparator)asc1);
+		GroupsModel model1 = new GroupsModelArray(datas,asc1);
+		GroupsModel model2 = new org.zkoss.zkdemo.test2.group.Test1GroupsModelArray(datas,(Comparator)asc1);
 
 	]]&gt;&lt;/zscript&gt;	
 	&lt;div&gt;

Modified: branches/5.0/zkdemo/src/archive/test2/Z35-listbox-0002.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/test2/Z35-listbox-0002.zul	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zkdemo/src/archive/test2/Z35-listbox-0002.zul	2010-09-17 05:40:36 UTC (rev 14278)
@@ -130,8 +130,8 @@
 		Comparator asc2 = new MyComparator(true,true);
 		Comparator dsc2 = new MyComparator(false,true);
 		
-		GroupsModel model1 = new ArrayGroupsModel(datas,asc1);
-		GroupsModel model2 = new org.zkoss.zkdemo.test2.group.Test1ArrayGroupsModel(datas,(Comparator)asc1);
+		GroupsModel model1 = new GroupsModelArray(datas,asc1);
+		GroupsModel model2 = new org.zkoss.zkdemo.test2.group.Test1GroupsModelArray(datas,(Comparator)asc1);
 		GroupsModel lm = model2;
 
 	]]&gt;&lt;/zscript&gt;	

Modified: branches/5.0/zkdemo/src/archive/userguide/grid/advGrouping.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/userguide/grid/advGrouping.zul	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zkdemo/src/archive/userguide/grid/advGrouping.zul	2010-09-17 05:40:36 UTC (rev 14278)
@@ -1,80 +1,54 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-
-&lt;!--
-advGrouping.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Tue Nov 18 11:12:22     2008, Created by jumperchen
-}}IS_NOTE
-
-Copyright (C) 2008 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;window id="demo" apply="org.zkoss.zkdemo.userguide.DemoWindowComposer"&gt;
-	&lt;html&gt;&lt;![CDATA[
-     	&lt;h4&gt;Grid Live Grouping&lt;/h4&gt;
-     ]]&gt;&lt;/html&gt;
-	&lt;span sclass="edition-field"&gt;
-		The Grouping function requires
-		&lt;a href="<a href="http://www.zkoss.org/download/zk.dsp" target="_new">http://www.zkoss.org/download/zk.dsp</a>" sclass="edition-field" label=" ZK PE or EE."/&gt;
-	&lt;/span&gt;
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+
+&lt;!--
+advGrouping.zul
+
+{{IS_NOTE
+	Purpose:
+		
+	Description:
+		
+	History:
+		Tue Nov 18 11:12:22     2008, Created by jumperchen
+}}IS_NOTE
+
+Copyright (C) 2008 Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+}}IS_RIGHT
+--&gt;
+&lt;window id="demo" apply="org.zkoss.zkdemo.userguide.DemoWindowComposer"&gt;
+	&lt;html&gt;&lt;![CDATA[
+     	&lt;h4&gt;Grid Live Grouping&lt;/h4&gt;
+     ]]&gt;&lt;/html&gt;
+	&lt;span sclass="edition-field"&gt;
+		The Grouping function requires
+		&lt;a href="<a href="http://www.zkoss.org/download/zk.dsp" target="_new">http://www.zkoss.org/download/zk.dsp</a>" sclass="edition-field" label=" ZK PE or EE."/&gt;
+	&lt;/span&gt;
     &lt;html&gt;&lt;![CDATA[
    		&lt;p&gt;Grid grouping supports "load on demend" feature via a GroupsModel interface. 
    		This feature will not load data into the grid until it is necessary.  &lt;a href="javascript:;" onclick="if (jq('#infos').is(':hidden')) {jq('#infos').slideDown();} else {jq('#infos').slideUp();}"&gt;More..&lt;/a&gt;&lt;/p&gt;
-   		&lt;p style="display:none;" id="infos"&gt;Scroll the following grid downwards and observe the values loaded dynamically.&lt;/p&gt;
-	]]&gt;&lt;/html&gt;
-	&lt;separator/&gt;
-	&lt;tabbox width="100%" tabscroll="false"&gt;
-		&lt;tabs&gt;
-			&lt;tab id="demoView" label="Demo"/&gt;
-			&lt;tab id="srcView" label="View Source"/&gt;
-		&lt;/tabs&gt;
-		&lt;tabpanels&gt;
-			&lt;tabpanel&gt;
-				&lt;window id="view"&gt;
-				&lt;/window&gt;
-			&lt;/tabpanel&gt;
-			
-			&lt;tabpanel&gt;
-				&lt;panel&gt;
-					&lt;panelchildren&gt;
-						&lt;textbox id="codeView" class="code" rows="20" width="95%"&gt;
-			&lt;attribute name="value"&gt;&lt;![CDATA[
+   		&lt;p style="display:none;" id="infos"&gt;Scroll the following grid downwards and observe the values loaded dynamically.&lt;/p&gt;
+	]]&gt;&lt;/html&gt;
+	&lt;separator/&gt;
+	&lt;tabbox width="100%" tabscroll="false"&gt;
+		&lt;tabs&gt;
+			&lt;tab id="demoView" label="Demo"/&gt;
+			&lt;tab id="srcView" label="View Source"/&gt;
+		&lt;/tabs&gt;
+		&lt;tabpanels&gt;
+			&lt;tabpanel&gt;
+				&lt;window id="view"&gt;
+				&lt;/window&gt;
+			&lt;/tabpanel&gt;
+			
+			&lt;tabpanel&gt;
+				&lt;panel&gt;
+					&lt;panelchildren&gt;
+						&lt;textbox id="codeView" class="code" rows="20" width="95%"&gt;
+			&lt;attribute name="value"&gt;&lt;![CDATA[
 &lt;zk&gt;
-	&lt;!-- Due to the security constraint, ZK demo site doesn't allow
-	zscript to declare a class. Instead we use a pre-compiled Java class.
-	You can uncomment the following and try it in your local server.
 	&lt;zscript&gt;
-	class LiveGroupRenderer implements RowRenderer{
-		public void render(Row row, java.lang.Object data) {
-			if(data instanceof String[]) {
-				String[] ary = (String[]) data;
-	            Div div = new Div();
-	            Image icon = new Image();
-	            icon.setStyle("padding: 0px 10px");
-	            icon.setSrc("/img/Centigrade-Widget-Icons/EnvelopeOpen-16x16.png");
-	            div.appendChild(icon);
-	            new Label(ary[0]).setParent(div);
-	            row.appendChild(div);
-	            new Label(ary[1]).setParent(row);
-	            new Label(ary[2]).setParent(row);
-	            new Label(ary[3]).setParent(row);
-			} else {
-				new Label(data.toString()).setParent(row);
-			}
-	        
-		}
-	}
-	LiveGroupRenderer renderer = new LiveGroupRenderer();
-	&lt;/zscript&gt;--&gt;
-	&lt;zscript&gt;
 	import org.zkoss.zkdemo.userguide.*;
 	LiveGroupRenderer renderer = new LiveGroupRenderer();
 	&lt;/zscript&gt;
@@ -146,16 +120,16 @@
 	     &lt;/columns&gt;
 	&lt;/grid&gt;
 &lt;/zk&gt;
-
-			]]&gt;&lt;/attribute&gt;
-						&lt;/textbox&gt;
-					&lt;/panelchildren&gt;
+
+			]]&gt;&lt;/attribute&gt;
+						&lt;/textbox&gt;
+					&lt;/panelchildren&gt;
 					&lt;toolbar mold="panel"&gt;
-						&lt;button id="tryBtn" label="Try me!"/&gt;
-						&lt;button id="reloadBtn" label="Reload"/&gt;
-					&lt;/toolbar&gt;
-				&lt;/panel&gt;
-			&lt;/tabpanel&gt;
-		&lt;/tabpanels&gt;
-	&lt;/tabbox&gt;
-&lt;/window&gt;
+						&lt;button id="tryBtn" label="Try me!"/&gt;
+						&lt;button id="reloadBtn" label="Reload"/&gt;
+					&lt;/toolbar&gt;
+				&lt;/panel&gt;
+			&lt;/tabpanel&gt;
+		&lt;/tabpanels&gt;
+	&lt;/tabbox&gt;
+&lt;/window&gt;

Modified: branches/5.0/zkdemo/src/archive/userguide/grid/detail.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/userguide/grid/detail.zul	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zkdemo/src/archive/userguide/grid/detail.zul	2010-09-17 05:40:36 UTC (rev 14278)
@@ -58,24 +58,7 @@
 	color: #0E3A99;
 }
 &lt;/style&gt;
-&lt;!-- Due to the security constraint, ZK demo site doesn't allow
 &lt;zscript&gt;
-class Comp implements Comparator {
-	private boolean _asc;
-	public Comp(boolean asc) {
-		_asc = asc;
-	}
-	public int compare(Object o1, Object o2) {
-		String s1 = o1.getChildren().get(1).getValue(),
-			s2 = o2.getChildren().get(1).getValue();
-		int v = s1.compareTo(s2);
-		return _asc ? v: -v;
-	}
-}
-Comp asc = new Comp(true), dsc = new Comp(false);
-&lt;/zscript&gt;
---&gt;
-&lt;zscript&gt;
 import org.zkoss.zkdemo.userguide.*;
 Comparator asc = new RowDetailComparator(true),
 	dsc = new RowDetailComparator(false);

Modified: branches/5.0/zkdemo/src/archive/userguide/grid/grouping.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/userguide/grid/grouping.zul	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zkdemo/src/archive/userguide/grid/grouping.zul	2010-09-17 05:40:36 UTC (rev 14278)
@@ -1,32 +1,32 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-
-&lt;!--
-grouping.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Mon Nov 17 16:24:41     2008, Created by jumperchen
-}}IS_NOTE
-
-Copyright (C) 2008 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+
+&lt;!--
+grouping.zul
+
+{{IS_NOTE
+	Purpose:
+		
+	Description:
+		
+	History:
+		Mon Nov 17 16:24:41     2008, Created by jumperchen
+}}IS_NOTE
+
+Copyright (C) 2008 Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+}}IS_RIGHT
+--&gt;
 &lt;window id="demo" apply="org.zkoss.zkdemo.userguide.DemoWindowComposer"&gt;
 	&lt;html&gt;&lt;![CDATA[
-		&lt;h4&gt;Grid with grouping control&lt;/h4&gt;
-	]]&gt;&lt;/html&gt;
-	&lt;span sclass="edition-field"&gt;
-		The Grouping function requires
-		&lt;a href="<a href="http://www.zkoss.org/download/zk.dsp" target="_new">http://www.zkoss.org/download/zk.dsp</a>" sclass="edition-field" label=" ZK PE or EE."/&gt;
-	&lt;/span&gt;
+		&lt;h4&gt;Grid with grouping control&lt;/h4&gt;
+	]]&gt;&lt;/html&gt;
+	&lt;span sclass="edition-field"&gt;
+		The Grouping function requires
+		&lt;a href="<a href="http://www.zkoss.org/download/zk.dsp" target="_new">http://www.zkoss.org/download/zk.dsp</a>" sclass="edition-field" label=" ZK PE or EE."/&gt;
+	&lt;/span&gt;
 	&lt;html&gt;&lt;![CDATA[
-		&lt;p&gt;Grid allows single level grouping. &lt;/p&gt; &lt;a href="javascript:;" onclick="if (jq('#infos').is(':hidden')) {jq('#infos').slideDown();} else {jq('#infos').slideUp();}"&gt;More..&lt;/a&gt;
+		&lt;p&gt;Grid allows single level grouping. &lt;/p&gt; &lt;a href="javascript:;" onclick="if (jq('#infos').is(':hidden')) {jq('#infos').slideDown();} else {jq('#infos').slideUp();}"&gt;More..&lt;/a&gt;
 		&lt;p style="display:none" id="infos"&gt;Each group are declared from its following row till the beginning of next group. Group can be invisible without labels. Each visible group can be collapsed by clicking on the small expansion button next to its label.&lt;/p&gt;
 	]]&gt;&lt;/html&gt;
 	&lt;separator/&gt;
@@ -47,26 +47,7 @@
 						&lt;textbox id="codeView" class="code" rows="20" width="95%"&gt;
 			&lt;attribute name="value"&gt;&lt;![CDATA[
 &lt;zk&gt;
-&lt;!-- Due to the security constraint, ZK demo site doesn't allow
-	zscript to declare a class. Instead we use a pre-compiled Java class.
-	You can uncomment the following and try it in your local server.
 	&lt;zscript&gt;
-	class Comp implements Comparator {
-		private boolean _asc;
-		public Comp(boolean asc) {
-			_asc = asc;
-		}
-		public int compare(Object o1, Object o2) {
-			String s1 = o1.getChildren().get(0).getValue(),
-				s2 = o2.getChildren().get(0).getValue();
-			int v = s1.compareTo(s2);
-			return _asc ? v: -v;
-		}
-	}
-	Comp asc = new Comp(true), dsc = new Comp(false);
-	&lt;/zscript&gt;
---&gt;
-	&lt;zscript&gt;
 	import org.zkoss.zkdemo.userguide.*;
 	Comparator asc = new RowLabelComparator(true),
 		dsc = new RowLabelComparator(false);
@@ -134,5 +115,5 @@
 			&lt;/tabpanel&gt;
 		&lt;/tabpanels&gt;
 	&lt;/tabbox&gt;
-&lt;/window&gt;
+&lt;/window&gt;
 

Added: branches/5.0/zkdemo/src/org/zkoss/zkdemo/test/Embed.java
===================================================================
--- branches/5.0/zkdemo/src/org/zkoss/zkdemo/test/Embed.java	                        (rev 0)
+++ branches/5.0/zkdemo/src/org/zkoss/zkdemo/test/Embed.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,54 @@
+/* Embed.java
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Thu Sep 16 16:33:21 TST 2010, Created by tomyeh
+
+Copyright (C) 2009 Potix Corporation. All Rights Reserved.
+
+*/
+package org.zkoss.zkdemo.test;
+
+import java.util.Map;
+
+import javax.servlet.*;
+import javax.servlet.http.*;
+
+import org.zkoss.json.JSONArray;
+import org.zkoss.zk.ui.Desktop;
+import org.zkoss.zk.ui.Page;
+import org.zkoss.zkplus.embed.Bridge;
+
+import org.zkoss.zul.Listbox;
+import org.zkoss.zul.Listitem;
+
+
+/**
+ * Used with embed.jsp to demostrate how to start an execution in a foreign
+ * Ajax channel.
+ *
+ * @author tomyeh
+ * @since 5.0.5
+ */
+public class Embed extends HttpServlet {
+	private int cnt = 0;
+	public void service(HttpServletRequest request, HttpServletResponse response)
+	throws javax.servlet.ServletException, java.io.IOException {
+		final Desktop desktop = getDesktop(request);
+		Bridge bridge = Bridge.start(getServletContext(), request, response, desktop);
+		try {
+			final Listbox listbox = (Listbox) ((Page)desktop.getPages().iterator().next()).getRoots().iterator().next();
+			listbox.appendChild(new Listitem("Ajax " + ++cnt));
+			response.getWriter().write(bridge.getResult());
+		} finally {
+			bridge.close();
+		}
+	}
+	private Desktop getDesktop(HttpServletRequest request) {
+		return Bridge.getDesktop(getServletContext(), request,
+			request.getParameter("desktop"));
+	}
+}

Added: branches/5.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1GroupsModelArray.java
===================================================================
--- branches/5.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1GroupsModelArray.java	                        (rev 0)
+++ branches/5.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1GroupsModelArray.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,46 @@
+/* Test1GroupsModelArray.java
+
+{{IS_NOTE
+	Purpose:
+		
+	Description:
+		
+	History:
+		Sep 3, 2008 12:10:32 PM     2008, Created by Dennis.Chen
+}}IS_NOTE
+
+Copyright (C) 2007 Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+	This program is distributed under GPL Version 3.0 in the hope that
+	it will be useful, but WITHOUT ANY WARRANTY.
+}}IS_RIGHT
+*/
+package org.zkoss.zkdemo.test2.group;
+
+import java.util.Comparator;
+
+import org.zkoss.zul.GroupsModelArray;
+
+/**
+ * @author Dennis.Chen
+ *
+ */
+public class Test1GroupsModelArray extends GroupsModelArray{
+	public Test1GroupsModelArray(Object[] data,Comparator cmpr){
+		super(data,cmpr,0);
+	}
+	protected Object createGroupHead(Object[] groupdata,int index,int col) {
+		String s1 = ((String)groupdata[0]);
+		return "Group "+s1.charAt(col==0?0:s1.length()-1)+" : "+groupdata.length+" Items";
+	}
+	
+	protected Object createGroupFoot(Object[] groupdata,int index, int col) {
+		int total = 0;
+		for(int i=0;i&lt;groupdata.length;i++){
+			String s1 = ((String)groupdata[i]);
+			total += Integer.parseInt(""+s1.charAt(s1.length()-1));
+		}
+		return "Total:"+total;
+	}
+}

Modified: branches/5.0/zkdoc/release-note
===================================================================
--- branches/5.0/zkdoc/release-note	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zkdoc/release-note	2010-09-17 05:40:36 UTC (rev 14278)
@@ -1,8 +1,9 @@
 	--------
 ZK 5.0.5
 * Features
+  3067232: A way to access components in 3rd framework (e.g. JSF 2)
+  3061671: Databinding foreach keep cloned cmp's id when in spaceowner
   3061676: Autodrop menubar shall be closed automatically when move out
-  3061671: Databinding foreach keep cloned cmp's id when in spaceowner
 
 * Bugs
   3057902: zk bug for window showbusy
@@ -11,6 +12,8 @@
   3064997: Listen onPiggyback event threw NoSuchElementException
 
 * Upgrade Notes
+  + org.zkoss.zul.ArrayGroupsModel is deprecated and renamed to GroupsModelArray
+    (such that the naming is consistent with ListModel's implementations)
 
 	--------
 ZK 5.0.4

Added: branches/5.0/zkplus/src/org/zkoss/zkplus/embed/Bridge.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/embed/Bridge.java	                        (rev 0)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/embed/Bridge.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,119 @@
+/* Bridge.java
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Thu Sep 16 10:49:20 TST 2010, Created by tomyeh
+
+Copyright (C) 2009 Potix Corporation. All Rights Reserved.
+
+*/
+package org.zkoss.zkplus.embed;
+
+import javax.servlet.ServletContext;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+import org.zkoss.json.JSONArray;
+import org.zkoss.zk.ui.Execution;
+import org.zkoss.zk.ui.Desktop;
+import org.zkoss.zk.ui.UiException;
+import org.zkoss.zk.ui.sys.WebAppCtrl;
+import org.zkoss.zk.ui.sys.UiEngine;
+import org.zkoss.zk.ui.http.ExecutionImpl;
+import org.zkoss.zk.ui.http.WebManager;
+
+/**
+ * Utilities to allow developers to start an execution in foreign Ajax channel.
+ *
+ * &lt;pre&gt;&lt;code&gt;Bridge bridge = Bridge.start(svlctx, request, response, desktop);
+ *try {
+ *    //execution is activated and you could access anything belonging to the desktop
+ *    String jscode = bridge.getResult();
+ *    //send jscode back to the client to update DOM, if any
+ *} finally {
+ *    bridge.close(); //stop the execution
+ *}&lt;/code&gt;&lt;/pre&gt;
+ *
+ * &lt;p&gt;See also &lt;a href="<a href="http://books.zkoss.org/wiki/ZK_Developer%27s_Reference/Integration/Start_Execution_in_Foreign_Ajax_Channel"&gt;Start" target="_new">http://books.zkoss.org/wiki/ZK_Developer%27s_Reference/Integration/Start_Execution_in_Foreign_Ajax_Channel"&gt;Start</a> Execution in Foreign Ajax Channel&lt;/a&gt;
+ *
+ * @author tomyeh
+ * @since 5.0.5
+ */
+public class Bridge {
+	private Execution _exec;
+	private Object _updctx;
+
+	/** Starts an execution.
+	 * After returned, the execution is activated and the caller is free to access
+	 * any components belonging the given desktop.
+	 * &lt;p&gt;After processing, the caller shall invoke {@link #close} to stop
+	 * the execution (in the finally clause).
+	 * @param desktop the desktop you want to access.
+	 * You could retrieve by use of {@link #getDesktop}.
+	 */
+	public static Bridge start(ServletContext svlctx, HttpServletRequest request,
+	HttpServletResponse response, Desktop desktop) {
+		try {
+			return new Bridge(svlctx, request, response, desktop);
+		} catch (Exception ex) { //not possible
+			throw UiException.Aide.wrap(ex);
+		}
+	}
+
+	/** Returns the desktop of the given desktop ID, or null if not found.
+	 * @param dtid the desktop's ID.
+	 */
+	public static Desktop
+	getDesktop(ServletContext svlctx, HttpServletRequest request, String dtid) {
+		return ((WebAppCtrl)WebManager.getWebApp(svlctx))
+			.getDesktopCache(WebManager.getSession(svlctx, request))
+			.getDesktop(dtid);
+	}
+
+	/** Constructor.
+	 * Don't invoke this directly. Rather, use {@link #start} instead.
+	 */
+	protected Bridge(ServletContext svlctx, HttpServletRequest request,
+	HttpServletResponse response, Desktop desktop) throws Exception {
+		_exec = new ExecutionImpl(svlctx, request, response, desktop, null);
+		_updctx = ((WebAppCtrl)desktop.getWebApp()).getUiEngine().startUpdate(_exec);
+	}
+	/** Returns the execution.
+	 */
+	public Execution getExecution() {
+		return _exec;
+	}
+	/** Returns the result in the JavaScript.
+	 * The caller shall send it back and evaluate it at the client (&lt;code&gt;eval(jscode);&lt;/code&gt;).
+	 * &lt;p&gt;After calling this method, the caller shall not modify the component's state any more.
+	 */
+	public String getResult() {
+		final Desktop desktop = _exec.getDesktop();
+		try {
+			JSONArray result = ((WebAppCtrl)desktop.getWebApp())
+				.getUiEngine().finishUpdate(_updctx);
+			return new StringBuffer(512)
+				.append("zAu.doCmds('").append(desktop.getId()).append("',")
+				.append(result.toString()).append(");").toString();
+		} catch (Exception ex) { //not possible
+			throw UiException.Aide.wrap(ex);
+		}
+	}
+	/** Closes the execution such that other requests targeting
+	 * the same desktop can be processed.
+	 * It must be called. Otherwise, the whole desktop might not be able
+	 * to be accessed any more.
+	 */
+	public void close() {
+		try {
+			((WebAppCtrl)_exec.getDesktop().getWebApp()).getUiEngine().closeUpdate(_updctx);
+			_updctx = null;
+			_exec = null;
+		} catch (Exception ex) { //not possible
+			throw UiException.Aide.wrap(ex);
+		}
+	}
+}

Added: branches/5.0/zkplus/src/org/zkoss/zkplus/embed/Renders.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/embed/Renders.java	                        (rev 0)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/embed/Renders.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,219 @@
+/* Renders.java
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Tue Aug 10 08:48:59 TST 2010, Created by tomyeh
+
+Copyright (C) 2009 Potix Corporation. All Rights Reserved.
+
+*/
+package org.zkoss.zkplus.embed;
+
+import java.io.Writer;
+import java.io.IOException;
+
+import javax.servlet.ServletContext;
+import javax.servlet.ServletException;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+import org.zkoss.lang.Library;
+import org.zkoss.web.servlet.http.Https;
+
+import org.zkoss.zk.ui.WebApp;
+import org.zkoss.zk.ui.Session;
+import org.zkoss.zk.ui.Execution;
+import org.zkoss.zk.ui.Executions;
+import org.zkoss.zk.ui.Desktop;
+import org.zkoss.zk.ui.Page;
+import org.zkoss.zk.ui.Component;
+import org.zkoss.zk.ui.Richlet;
+import org.zkoss.zk.ui.GenericRichlet;
+import org.zkoss.zk.ui.metainfo.PageDefinitions;
+import org.zkoss.zk.ui.sys.HtmlPageRenders;
+import org.zkoss.zk.ui.sys.WebAppCtrl;
+import org.zkoss.zk.ui.sys.UiFactory;
+import org.zkoss.zk.ui.sys.SessionCtrl;
+import org.zkoss.zk.ui.sys.RequestInfo;
+import org.zkoss.zk.ui.impl.Attributes;
+import org.zkoss.zk.ui.impl.RequestInfoImpl;
+import org.zkoss.zk.ui.http.WebManager;
+import org.zkoss.zk.ui.http.ExecutionImpl;
+import org.zkoss.zk.ui.http.I18Ns;
+import org.zkoss.zk.ui.http.Utils;
+
+/**
+ * Utilities to embed ZK component(s) as a native JSF component, a JSP tag, Zimlet or others.
+ * It allows application developers to use the native element without knowing the existence of ZK.
+ * For example, ZK Spreadsheet for JSF is a native JSF component made in this way.
+ *
+ * &lt;p&gt;To use an embedded component, ZK Update Engine
+ * ({@link org.zkoss.zk.au.http.DHtmlUpdateServlet}) is still required,
+ * while ZK Loader ({@link org.zkoss.zk.ui.http.DHtmlLayoutServlet}) is not needed (though not hurt).
+ * If ZK Loader not installed, it assumes the update URI is "/zkau", which
+ * can be overriden by setting a library property called
+ * "org.zkoss.zkplus.embed.updateURI".
+ *
+ * &lt;p&gt;Example:
+&lt;pre&gt;&lt;code&gt;
+	Calendar cal = new Calendar();
+	Renders.render(config.getServletContext(), request, response, cal, null, out);
+&lt;/code&gt;&lt;/pre&gt;
+ *
+ * &lt;p&gt;See also &lt;a href="<a href="http://books.zkoss.org/wiki/ZK_Developer%27s_Reference/Integration/Embed_ZK_Component_in_Foreign_Framework"&gt;Embed" target="_new">http://books.zkoss.org/wiki/ZK_Developer%27s_Reference/Integration/Embed_ZK_Component_in_Foreign_Framework"&gt;Embed</a> ZK Component in Foreign Framework&lt;/a&gt;.
+ *
+ * @author tomyeh
+ * @since 5.0.5
+ */
+public class Renders {
+	/** Outputs the HTML tags of the given component to the given writer.
+	 * @param comp the component to output (never null). It might have child components.
+	 * @param path the request path. If null, the servlet path is assumed.
+	 * @param out the output (never null).
+	 * @since 5.0.5
+	 */
+	public static final void render(ServletContext ctx,
+	HttpServletRequest request, HttpServletResponse response,
+	Component comp, String path, Writer out)
+	throws ServletException, IOException {
+		if (comp == null)
+			throw new IllegalArgumentException();
+		render(ctx, request, response, new EmbedRichlet(comp), path, out);
+	}
+	/** Outputs the HTML tags of the given component to the given writer.
+	 * @param path the request path. If null, the servlet path is assumed.
+	 * @param out the output (never null).
+	 * @param richlet the richlet to run. If you have only one component to show and no need
+	 * process it under an execution, you could use
+	 * {@link #render(ServletContext, HttpServletRequest, HttpServletResponse, Component, String, Writer)}
+	 * instead.
+	 * @since 5.0.5
+	 */
+	public static final void render(ServletContext ctx,
+	HttpServletRequest request, HttpServletResponse response,
+	Richlet richlet, String path, Writer out)
+	throws ServletException, IOException {
+		if (path == null)
+			path = Https.getThisServletPath(request);
+
+		WebManager webman = WebManager.getWebManagerIfAny(ctx);
+		if (webman == null) {
+			final String ATTR = "org.zkoss.zkplus.embed.updateURI";
+			String updateURI = Library.getProperty(ATTR);
+			if (updateURI == null)
+				updateURI = "/zkau";
+			else
+				updateURI = Utils.checkUpdateURI(updateURI, ATTR);
+			webman = new WebManager(ctx, updateURI);
+		}
+
+		final Session sess = WebManager.getSession(ctx, request);
+		final WebApp wapp = sess.getWebApp();
+		final WebAppCtrl wappc = (WebAppCtrl)wapp;
+		final Object old = I18Ns.setup(sess, request, response,
+			wapp.getConfiguration().getResponseCharset());
+		Execution exec = null;
+		try {
+			final Desktop desktop = webman.getDesktop(sess, request, response, path, true);
+			if (desktop == null) //forward or redirect
+				return;
+
+			final RequestInfo ri = new RequestInfoImpl(
+				wapp, sess, desktop, request,
+				PageDefinitions.getLocator(wapp, path));
+			sess.setAttribute(Attributes.GAE_FIX, new Integer(0));
+			((SessionCtrl)sess).notifyClientRequest(true);
+
+			final UiFactory uf = wappc.getUiFactory();
+			final Page page = WebManager.newPage(uf, ri, richlet, response, path);
+			exec = new ExecutionImpl(ctx, request, response, desktop, page);
+			exec.setAttribute(Attributes.PAGE_REDRAW_CONTROL, "page");
+			exec.setAttribute(Attributes.PAGE_RENDERER, new PageRenderer(exec));
+
+			wappc.getUiEngine().execNewPage(exec, richlet, page, out);
+					//no need to set device type here, since UiEngine will do it later
+		} finally {
+			I18Ns.cleanup(request, old);
+			if (exec != null) {
+				exec.removeAttribute(Attributes.PAGE_REDRAW_CONTROL);
+				exec.removeAttribute(Attributes.PAGE_RENDERER);
+			}
+		}
+	}
+	//Supporting classes//
+	private static class EmbedRichlet extends GenericRichlet {
+		private final Component _comp;
+		private EmbedRichlet(Component comp) {
+			_comp = comp;
+		}
+		//@Override
+		public void service(Page page) {
+			_comp.setPage(page);
+		}
+	}
+
+	/**
+	 * A special page renderer that renders a page without generating
+	 * the HTML tag of the page.
+	 * In other words, it generates all components directly.
+	 * @author tomyeh
+	 * @since 5.0.4
+	 */
+	public static class PageRenderer implements org.zkoss.zk.ui.sys.PageRenderer {
+		private final Execution _exec;
+		/** Default constructor.
+		 * It is the same as &lt;code&gt;PageRenderer(Executions.getCurrent())&lt;/code&gt;.
+		 */
+		public PageRenderer() {
+			this(Executions.getCurrent());
+		}
+		public PageRenderer(Execution exec) {
+			_exec = exec;
+		}
+
+		//@Override
+		public void render(Page page, Writer out) throws IOException {
+			final Desktop desktop = _exec.getDesktop();
+
+			out.write(HtmlPageRenders.outLangStyleSheets(_exec, null, null));
+			out.write(HtmlPageRenders.outLangJavaScripts(_exec, null, null));
+
+			out.write("&lt;script type=\"text/javascript\"&gt;zkpb('");
+			out.write(page.getUuid());
+			out.write("','");
+			out.write(desktop.getId());
+			out.write("','");
+			out.write(getContextURI());
+			out.write("','");
+			out.write(desktop.getUpdateURI(null));
+			out.write("','");
+			out.write(desktop.getRequestPath());
+			out.write('\'');
+
+			String style = page.getStyle();
+			if (style != null &amp;&amp; style.length() &gt; 0) {
+				out.write(",{style:'");
+				out.write(style);
+				out.write("'}");
+			}
+
+			out.write(");zkpe();&lt;/script&gt;\n");
+
+			for (Component root = page.getFirstRoot(); root != null;
+			root = root.getNextSibling()) {
+				HtmlPageRenders.outStandalone(_exec, root, out);
+			}
+		}
+		private String getContextURI() {
+			if (_exec != null) {
+				String s = _exec.encodeURL("/");
+				int j = s.lastIndexOf('/'); //might have jsessionid=...
+				return j &gt;= 0 ? s.substring(0, j) + s.substring(j + 1): s;
+			}
+			return "";
+		}
+	}
+}

Added: branches/5.0/zkplus/src/org/zkoss/zkplus/embed/packackage.html
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/embed/packackage.html	                        (rev 0)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/embed/packackage.html	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,15 @@
+&lt;html&gt;
+&lt;head&gt;
+&lt;title&gt;Utilities to embed ZK components into the 3rd-parth frameworks&lt;/title&gt;
+&lt;/head&gt;
+&lt;body&gt;
+	&lt;p&gt;Utilities to embed ZK components into the 3rd-parth framework.
+		There are two major functionalities.
+	&lt;ul&gt;
+		&lt;li&gt;Embed ZK components as a tag (such JSP, JSF...).&lt;br/&gt;
+			See also &lt;a href="<a href="http://books.zkoss.org/wiki/ZK_Developer%27s_Reference/Integration/Embed_ZK_Component_in_Foreign_Framework"&gt;Embed" target="_new">http://books.zkoss.org/wiki/ZK_Developer%27s_Reference/Integration/Embed_ZK_Component_in_Foreign_Framework"&gt;Embed</a> ZK Component in Foreign Framework&lt;/a&gt;&lt;/li&gt;
+		&lt;li&gt;Start ZK execution and access components in a foreign Ajax channel.&lt;br/&gt;
+		See also &lt;a href="<a href="http://books.zkoss.org/wiki/ZK_Developer%27s_Reference/Integration/Start_Execution_in_Foreign_Ajax_Channel"&gt;Start" target="_new">http://books.zkoss.org/wiki/ZK_Developer%27s_Reference/Integration/Start_Execution_in_Foreign_Ajax_Channel"&gt;Start</a> Execution in Foreign Ajax Channel&lt;/a&gt;&lt;/li&gt;
+	&lt;/ul&gt;
+&lt;/body&gt;
+&lt;/html&gt;

Modified: branches/5.0/zul/src/org/zkoss/zul/ArrayGroupsModel.java
===================================================================
--- branches/5.0/zul/src/org/zkoss/zul/ArrayGroupsModel.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zul/src/org/zkoss/zul/ArrayGroupsModel.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -26,46 +26,16 @@
 
 /**
  * An array implementation of {@link GroupsModel}.
- * This implementation supports regroup array to groups depends on {@link Comparator} and {@link GroupComparator}.
+ * @deprecated As of release 5.0.5, replaced with {@link GroupsModelArray},
+ * which is the same but make the naming more consistent with others.
  * 
  * @author Dennis.Chen
  * @since 3.5.0
  * @see GroupsModel
  * @see SimpleGroupsModel
  */
-public class ArrayGroupsModel extends AbstractGroupsModel implements GroupsModelExt{
-	
+public class ArrayGroupsModel extends GroupsModelArray {
 	/**
-	 * member field to store native array data
-	 */
-	protected Object[] _nativedata;
-	
-	/**
-	 * member field to store Comparator for initial grouping.
-	 */
-	protected Comparator _comparator;
-	
-	/**
-	 * member field to store group data
-	 */
-	protected Object[][] _data;
-	
-	/**
-	 * member field to store group head data
-	 */
-	protected Object[] _heads;
-	
-	/**
-	 * member field to store group foot data
-	 */
-	protected Object[] _foots;
-	
-	/**
-	 * member field to store group close status
-	 */
-	protected boolean[] _closes;
-	
-	/**
 	 * Constructor
 	 * @param data an array data to be grouping.
 	 * @param cmpr a comparator implementation help group the data. you could implements {@link GroupComparator} to do more grouping control.&lt;br/&gt;
@@ -75,7 +45,7 @@
 	 * At 3rd phase, it calls {@link Comparator#compare(Object, Object)} to sort data in each group.&lt;br/&gt;
 	 */
 	public ArrayGroupsModel(Object[] data,Comparator cmpr){
-		this(data,cmpr,0);
+		super(data, cmpr);
 	}
 	/**
 	 * 
@@ -88,208 +58,6 @@
 	 * @param col column index associate with cmpr.
 	 */
 	public ArrayGroupsModel(Object[] data,Comparator cmpr, int col){
-		if (data == null || cmpr == null)
-			throw new IllegalArgumentException("null parameter");
-		_nativedata = (Object[])ArraysX.duplicate(data);
-		_comparator = cmpr;
-		group(_comparator,true,col);
+		super(data, cmpr, col);
 	}
-
-	public Object getChild(int groupIndex, int index) {
-		return _data[groupIndex][index];
-	}
-
-
-	public int getChildCount(int groupIndex) {
-		return _data[groupIndex].length;
-	}
-
-
-	public Object getGroup(int groupIndex) {
-		return  _heads==null?_data[groupIndex]:_heads[groupIndex];
-	}
-
-
-	public int getGroupCount() {
-		return _data.length;
-	}
-
-	public Object getGroupfoot(int groupIndex) {
-		return _foots == null ? null:_foots[groupIndex];
-	}
-
-	public boolean hasGroupfoot(int groupIndex) {
-		return _foots == null ? false:_foots[groupIndex]!=null;
-	}
-
-	public void sort(Comparator cmpr, boolean ascending, int col) {
-		sortAllGroupData(cmpr,ascending,col);
-
-		fireEvent(GroupsDataEvent.GROUPS_CHANGED,-1,-1,-1);
-	}
-
-	public void group(final Comparator cmpr, boolean ascending, int col) {
-		Comparator cmprx;
-		if(cmpr instanceof GroupComparator){
-			cmprx = new Comparator(){
-				public int compare(Object o1, Object o2) {
-					return ((GroupComparator)cmpr).compareGroup(o1, o2);
-				}
-			};
-		}else{
-			cmprx = cmpr;
-		}
-		
-		sortDataInGroupOrder(cmprx, ascending,col);//use comparator from constructor to sort native data
-		organizeGroup(cmprx, col);
-		if (cmprx != cmpr)
-			sortAllGroupData(cmpr, ascending,col);//sort by original comparator
-
-		fireEvent(GroupsDataEvent.GROUPS_RESET,-1,-1,-1);
-	}
-	
-	public boolean isClose(int groupIndex) {
-		return _closes == null ? false : _closes[groupIndex];
-	}
-
-	public void setClose(int groupIndex, boolean close) {
-		if (_closes == null) {
-			_closes = new boolean[getGroupCount()];
-		}
-		if (_closes[groupIndex] != close) {
-			_closes[groupIndex] = close;
-			fireEvent(GroupsDataEvent.GROUPS_CHANGED,groupIndex,-1,-1);
-		}
-	}
-	
-	/**
-	 * Sorts data in each group, the group order will not change. invoke this method doesn't fire event.
-	 */
-	private void sortAllGroupData(Comparator cmpr,boolean ascending, int col) {
-		for(int i=0;i&lt;_data.length;i++){
-			sortGroupData(_heads[i],_data[i],cmpr,ascending,col);
-		}
-	}
-	
-	/**
-	 * Sorts data within a group. Notice that this method doesn't fire event.
-	 * &lt;p&gt;There are three steps to re-group data:
-	 * {@link #sortDataInGroupOrder}, {@link #organizeGroup} and then
-	 * {@link #sortGroupData}.
-	 *
-	 * &lt;p&gt;It is the last step of grouping. It sorts data in the specified
-	 * group.
-	 */
-	protected void sortGroupData(Object group,Object[] groupdata,Comparator cmpr,boolean ascending, int col){
-		Arrays.sort(groupdata,cmpr);
-	}
-
-	/**
-	 * Organizes groups based sorted data.
-	 *
-	 * &lt;p&gt;There are three steps to re-group data:
-	 * {@link #sortDataInGroupOrder}, {@link #organizeGroup} and then
-	 * {@link #sortGroupData}.
-	 *
-	 * &lt;p&gt;It is the second step of grouping. It creates group data
-	 * based on the data sorted in the group order by
-	 * {@link #sortDataInGroupOrder}.
-	 *
-	 * @param cmpr the comparator used to compare data in the group order.
-	 * Notice that the comparator is never an instance of {@link GroupComparator}.
-	 * The implementation just uses {@link Comparator#compare} to sort
-	 * the data.
-	 * @param col column index
-	 */
-	protected void organizeGroup(Comparator cmpr, int col) {
-		List group = new ArrayList();
-		List gdata = null;
-		Object last = null;
-		Object curr = null;
-		
-		//regroup native
-		for(int i=0;i&lt;_nativedata.length;i++){
-			curr = _nativedata[i];
-			boolean hitn = false;
-			boolean hita = false;
-			if(last==null || cmpr.compare(last,curr)!=0){
-				hitn = true;
-				gdata = new ArrayList();
-				group.add(gdata);
-			}
-			gdata.add(curr);
-			last = _nativedata[i];
-		}
-		
-		//prepare data,head &amp; foot
-		List[] gd = new List[group.size()];
-		group.toArray(gd);
-		
-		_data = new Object[gd.length][];
-		_foots = new Object[_data.length];
-		_heads = new Object[_data.length];
-		_closes = new boolean[_data.length];
-		
-		for(int i=0;i&lt;gd.length;i++){
-			gdata = (List)gd[i];
-			_data[i] = new Object[gdata.size()];
-			gdata.toArray(_data[i]);
-			_heads[i] = createGroupHead(_data[i],i,col);
-			_foots[i] = createGroupFoot(_data[i],i,col);
-			_closes[i] = createGroupClose(_data[i],i,col);
-		}
-	}
-
-
-	/**
-	 * create group head Object, default implementation return first element of groupdata.
-	 * you can override this method to return your Object.
-	 * @param groupdata data the already in a group.
-	 * @param index group index
-	 * @param col column to group
-	 */
-	protected Object createGroupHead(Object[] groupdata,int index,int col) {
-		return groupdata[0];
-	}
-
-	/**
-	 * create group foot Object, default implementation return null, which means no foot .
-	 * you can override this method to return your Object.
-	 * @param groupdata data the already in a group.
-	 * @param index group index
-	 * @param col column to group
-	 */
-	protected Object createGroupFoot(Object[] groupdata,int index,int col) {
-		return null;
-	}
-
-	/**
-	 * Sorts the native data in the group order.
-	 * After sorted, all data in the first group shall be placed in front
-	 * of the second group, and so on.
-	 *
-	 * &lt;p&gt;There are three steps to re-group data:
-	 * {@link #sortDataInGroupOrder}, {@link #organizeGroup} and then
-	 * {@link #sortGroupData}.
-	 *
-	 * @param cmpr the comparator used to compare data in the group order.
-	 * Notice that the comparator is never an instance of {@link GroupComparator}.
-	 * The implementation just uses {@link Comparator#compare} to sort
-	 * the data.
-	 */
-	protected void sortDataInGroupOrder(Comparator cmpr, boolean ascending, int colIndex) {
-		Arrays.sort(_nativedata,cmpr);
-	}
-
-	/**
-	 * create group close status, default implementation return false, which means open the group.
-	 * you can override this method to return your group close status.
-	 * @param groupdata data the already in a group.
-	 * @param index group index
-	 * @param col column to group
-	 * @since 5.0.0
-	 */
-	protected boolean createGroupClose(Object[] groupdata,int index,int col) {
-		return false;
-	}
 }

Added: branches/5.0/zul/src/org/zkoss/zul/GroupsModelArray.java
===================================================================
--- branches/5.0/zul/src/org/zkoss/zul/GroupsModelArray.java	                        (rev 0)
+++ branches/5.0/zul/src/org/zkoss/zul/GroupsModelArray.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,296 @@
+/*GroupsModelArray.java
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Sep 3, 2008 9:50:12 AM     2008, Created by Dennis.Chen
+
+Copyright (C) 2007 Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+	This program is distributed under LGPL Version 3.0 in the hope that
+	it will be useful, but WITHOUT ANY WARRANTY.
+}}IS_RIGHT
+*/
+package org.zkoss.zul;
+
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Comparator;
+import java.util.List;
+
+import org.zkoss.util.ArraysX;
+import org.zkoss.zul.event.GroupsDataEvent;
+
+/**
+ * An array implementation of {@link GroupsModel}.
+ * This implementation supports regroup array to groups depends on {@link Comparator} and {@link GroupComparator}.
+ * For immutable content (no re-grouping allowed), please use {@link #SimpleGroupsModel} instead.
+ * 
+ * @author Dennis.Chen
+ * @since 5.0.5
+ * @see GroupsModel
+ * @see SimpleGroupsModel
+ */
+public class GroupsModelArray extends AbstractGroupsModel implements GroupsModelExt{
+	
+	/**
+	 * member field to store native array data
+	 */
+	protected Object[] _nativedata;
+	
+	/**
+	 * member field to store Comparator for initial grouping.
+	 */
+	protected Comparator _comparator;
+	
+	/**
+	 * member field to store group data
+	 */
+	protected Object[][] _data;
+	
+	/**
+	 * member field to store group head data
+	 */
+	protected Object[] _heads;
+	
+	/**
+	 * member field to store group foot data
+	 */
+	protected Object[] _foots;
+	
+	/**
+	 * member field to store group close status
+	 */
+	protected boolean[] _closes;
+	
+	/**
+	 * Constructor
+	 * @param data an array data to be grouping.
+	 * @param cmpr a comparator implementation help group the data. you could implements {@link GroupComparator} to do more grouping control.&lt;br/&gt;
+	 * At 1st phase, it calls {@link Comparator#compare(Object, Object)} or {@link GroupComparator#compareGroup(Object, Object)} to sort the data.&lt;br/&gt;
+	 * At 2nd phase, it calls {@link Comparator#compare(Object, Object)} or {@link GroupComparator#compareGroup(Object, Object)} to decide which data belong to which group. 
+	 * In this phase it also invoke {@link #createGroupHead(Object[], int, int)} and {@link #createGroupFoot(Object[], int, int)} to create head of foot Object of each group.&lt;br/&gt;
+	 * At 3rd phase, it calls {@link Comparator#compare(Object, Object)} to sort data in each group.&lt;br/&gt;
+	 */
+	public GroupsModelArray(Object[] data,Comparator cmpr){
+		this(data,cmpr,0);
+	}
+	/**
+	 * 
+	 * @param data an array data to be grouping.
+	 * @param cmpr a comparator implementation help group the data. you could implements {@link GroupComparator} to do more grouping control.&lt;br/&gt;
+	 * At 1st phase, it calls {@link Comparator#compare(Object, Object)} or {@link GroupComparator#compareGroup(Object, Object)} to sort the data.&lt;br/&gt;
+	 * At 2nd phase, it calls {@link Comparator#compare(Object, Object)} or {@link GroupComparator#compareGroup(Object, Object)} to decide which data belong to which group. 
+	 * In this phase it also invoke {@link #createGroupHead(Object[], int, int)} and {@link #createGroupFoot(Object[], int, int)} to create head of foot Object of each group.&lt;br/&gt;
+	 * At 3rd phase, it calls {@link Comparator#compare(Object, Object)} to sort data in each group.&lt;br/&gt;
+	 * @param col column index associate with cmpr.
+	 */
+	public GroupsModelArray(Object[] data,Comparator cmpr, int col){
+		if (data == null || cmpr == null)
+			throw new IllegalArgumentException("null parameter");
+		_nativedata = (Object[])ArraysX.duplicate(data);
+		_comparator = cmpr;
+		group(_comparator,true,col);
+	}
+
+	public Object getChild(int groupIndex, int index) {
+		return _data[groupIndex][index];
+	}
+
+
+	public int getChildCount(int groupIndex) {
+		return _data[groupIndex].length;
+	}
+
+
+	public Object getGroup(int groupIndex) {
+		return  _heads==null?_data[groupIndex]:_heads[groupIndex];
+	}
+
+
+	public int getGroupCount() {
+		return _data.length;
+	}
+
+	public Object getGroupfoot(int groupIndex) {
+		return _foots == null ? null:_foots[groupIndex];
+	}
+
+	public boolean hasGroupfoot(int groupIndex) {
+		return _foots == null ? false:_foots[groupIndex]!=null;
+	}
+
+	public void sort(Comparator cmpr, boolean ascending, int col) {
+		sortAllGroupData(cmpr,ascending,col);
+
+		fireEvent(GroupsDataEvent.GROUPS_CHANGED,-1,-1,-1);
+	}
+
+	public void group(final Comparator cmpr, boolean ascending, int col) {
+		Comparator cmprx;
+		if(cmpr instanceof GroupComparator){
+			cmprx = new Comparator(){
+				public int compare(Object o1, Object o2) {
+					return ((GroupComparator)cmpr).compareGroup(o1, o2);
+				}
+			};
+		}else{
+			cmprx = cmpr;
+		}
+		
+		sortDataInGroupOrder(cmprx, ascending,col);//use comparator from constructor to sort native data
+		organizeGroup(cmprx, col);
+		if (cmprx != cmpr)
+			sortAllGroupData(cmpr, ascending,col);//sort by original comparator
+
+		fireEvent(GroupsDataEvent.GROUPS_RESET,-1,-1,-1);
+	}
+	
+	public boolean isClose(int groupIndex) {
+		return _closes == null ? false : _closes[groupIndex];
+	}
+
+	public void setClose(int groupIndex, boolean close) {
+		if (_closes == null) {
+			_closes = new boolean[getGroupCount()];
+		}
+		if (_closes[groupIndex] != close) {
+			_closes[groupIndex] = close;
+			fireEvent(GroupsDataEvent.GROUPS_CHANGED,groupIndex,-1,-1);
+		}
+	}
+	
+	/**
+	 * Sorts data in each group, the group order will not change. invoke this method doesn't fire event.
+	 */
+	private void sortAllGroupData(Comparator cmpr,boolean ascending, int col) {
+		for(int i=0;i&lt;_data.length;i++){
+			sortGroupData(_heads[i],_data[i],cmpr,ascending,col);
+		}
+	}
+	
+	/**
+	 * Sorts data within a group. Notice that this method doesn't fire event.
+	 * &lt;p&gt;There are three steps to re-group data:
+	 * {@link #sortDataInGroupOrder}, {@link #organizeGroup} and then
+	 * {@link #sortGroupData}.
+	 *
+	 * &lt;p&gt;It is the last step of grouping. It sorts data in the specified
+	 * group.
+	 */
+	protected void sortGroupData(Object group,Object[] groupdata,Comparator cmpr,boolean ascending, int col){
+		Arrays.sort(groupdata,cmpr);
+	}
+
+	/**
+	 * Organizes groups based sorted data.
+	 *
+	 * &lt;p&gt;There are three steps to re-group data:
+	 * {@link #sortDataInGroupOrder}, {@link #organizeGroup} and then
+	 * {@link #sortGroupData}.
+	 *
+	 * &lt;p&gt;It is the second step of grouping. It creates group data
+	 * based on the data sorted in the group order by
+	 * {@link #sortDataInGroupOrder}.
+	 *
+	 * @param cmpr the comparator used to compare data in the group order.
+	 * Notice that the comparator is never an instance of {@link GroupComparator}.
+	 * The implementation just uses {@link Comparator#compare} to sort
+	 * the data.
+	 * @param col column index
+	 */
+	protected void organizeGroup(Comparator cmpr, int col) {
+		List group = new ArrayList();
+		List gdata = null;
+		Object last = null;
+		Object curr = null;
+		
+		//regroup native
+		for(int i=0;i&lt;_nativedata.length;i++){
+			curr = _nativedata[i];
+			boolean hitn = false;
+			boolean hita = false;
+			if(last==null || cmpr.compare(last,curr)!=0){
+				hitn = true;
+				gdata = new ArrayList();
+				group.add(gdata);
+			}
+			gdata.add(curr);
+			last = _nativedata[i];
+		}
+		
+		//prepare data,head &amp; foot
+		List[] gd = new List[group.size()];
+		group.toArray(gd);
+		
+		_data = new Object[gd.length][];
+		_foots = new Object[_data.length];
+		_heads = new Object[_data.length];
+		_closes = new boolean[_data.length];
+		
+		for(int i=0;i&lt;gd.length;i++){
+			gdata = (List)gd[i];
+			_data[i] = new Object[gdata.size()];
+			gdata.toArray(_data[i]);
+			_heads[i] = createGroupHead(_data[i],i,col);
+			_foots[i] = createGroupFoot(_data[i],i,col);
+			_closes[i] = createGroupClose(_data[i],i,col);
+		}
+	}
+
+
+	/**
+	 * create group head Object, default implementation return first element of groupdata.
+	 * you can override this method to return your Object.
+	 * @param groupdata data the already in a group.
+	 * @param index group index
+	 * @param col column to group
+	 */
+	protected Object createGroupHead(Object[] groupdata,int index,int col) {
+		return groupdata[0];
+	}
+
+	/**
+	 * create group foot Object, default implementation return null, which means no foot .
+	 * you can override this method to return your Object.
+	 * @param groupdata data the already in a group.
+	 * @param index group index
+	 * @param col column to group
+	 */
+	protected Object createGroupFoot(Object[] groupdata,int index,int col) {
+		return null;
+	}
+
+	/**
+	 * Sorts the native data in the group order.
+	 * After sorted, all data in the first group shall be placed in front
+	 * of the second group, and so on.
+	 *
+	 * &lt;p&gt;There are three steps to re-group data:
+	 * {@link #sortDataInGroupOrder}, {@link #organizeGroup} and then
+	 * {@link #sortGroupData}.
+	 *
+	 * @param cmpr the comparator used to compare data in the group order.
+	 * Notice that the comparator is never an instance of {@link GroupComparator}.
+	 * The implementation just uses {@link Comparator#compare} to sort
+	 * the data.
+	 */
+	protected void sortDataInGroupOrder(Comparator cmpr, boolean ascending, int colIndex) {
+		Arrays.sort(_nativedata,cmpr);
+	}
+
+	/**
+	 * create group close status, default implementation return false, which means open the group.
+	 * you can override this method to return your group close status.
+	 * @param groupdata data the already in a group.
+	 * @param index group index
+	 * @param col column to group
+	 * @since 5.0.0
+	 */
+	protected boolean createGroupClose(Object[] groupdata,int index,int col) {
+		return false;
+	}
+}

Modified: branches/5.0/zul/src/org/zkoss/zul/SimpleGroupsModel.java
===================================================================
--- branches/5.0/zul/src/org/zkoss/zul/SimpleGroupsModel.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/5.0/zul/src/org/zkoss/zul/SimpleGroupsModel.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -23,10 +23,13 @@
 
 /**
  * A simple implementation of {@link GroupsModel}.
- * Note: It assumes the content is immutable.
+ * This implementation assumes the content is immutable.
+ * If you allow the user to re-group the content, use {@link #GroupsModelArray}
+ * instead.
  * @author Dennis.Chen
  * @since 3.5.0
  * @see GroupsModel
+ * @see GroupsModelArray
  */
 public class SimpleGroupsModel extends AbstractGroupsModel implements GroupsModelExt{
 	

Modified: branches/6.0/zcommon/src/org/zkoss/json/JSONObject.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/json/JSONObject.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zcommon/src/org/zkoss/json/JSONObject.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -14,7 +14,7 @@
  * 
  * @author FangYidong&lt;fangyidong@...&gt;
  */
-public class JSONObject extends LinkedHashMap&lt;String, Object&gt; implements Map&lt;String, Object&gt;, JSONAware {
+public class JSONObject extends LinkedHashMap&lt;Object, Object&gt; implements Map&lt;Object, Object&gt;, JSONAware {
 	private static final long serialVersionUID = -503443796854799292L;
 	
 	/**

Modified: branches/6.0/zcommon/src/org/zkoss/lang/reflect/Fields.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/reflect/Fields.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zcommon/src/org/zkoss/lang/reflect/Fields.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -148,9 +148,8 @@
 			}
 			if (acs instanceof Method) {
 				final Method mtd = (Method)acs;
-				mtd.invoke(obj, new Object[] {
-					autoCoerce ?
-						Classes.coerce(mtd.getParameterTypes()[0], val): val});
+				mtd.invoke(obj,
+					autoCoerce ? Classes.coerce(mtd.getParameterTypes()[0], val): val);
 			} else {
 				final Field fld = (Field)acs;
 				fld.set(obj,

Modified: branches/6.0/zcommon/src/org/zkoss/util/ArraysX.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/ArraysX.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zcommon/src/org/zkoss/util/ArraysX.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -358,15 +358,6 @@
 	public static final &lt;T&gt; T[] resize(T[] ary, int size) {
 		return (T[])resize((Object)ary, size);
 	}
-	/**
-	 * Instantiates an array of the given type and size.
-	 * It is the same as &lt;code&gt;new T[size]&lt;/code&gt; (but Java doesn't allow).
-	 * @since (not public yet)
-	 */
-//	@SuppressWarnings("unchecked")
-//	public static final &lt;T&gt; T[] newInstance(Class&lt;T&gt; c, int size) {
-//		return (T[])Array.newInstance(c, size);
-//	}
 
 	/** Clones an array.
 	 */
@@ -376,4 +367,19 @@
 		System.arraycopy(ary, 0, dst, 0, size);
 		return dst;
 	}
+	/** Clones an array.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; T[] clone(T[] ary) {
+		return (T[])clone((Object)ary);
+	}
+
+//meaningless to provide this method since the caller's casting to Class&lt;T&gt; causes
+//an warning. But, if we use Class&lt;?&gt;, a compiler error is generated (T cannot be
+//determined...)
+//	@SuppressWarnings("unchecked")
+//	public static final &lt;T&gt; T[] newInstance(Class&lt;T&gt; cls, int size) {
+//		return (T[])Array.newInstance(cls, size);
+//	}
 }

Modified: branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -15,6 +15,7 @@
 */
 package org.zkoss.util;
 
+import java.lang.reflect.Array;
 import java.util.AbstractCollection;
 import java.util.Collection;
 import java.util.Collections;
@@ -282,36 +283,60 @@
 
 	/**
 	 * Returns the specified range of the specified collection into a new array.
-     * The initial index of the range (&lt;tt&gt;from&lt;/tt&gt;) must lie between zero
-     * and &lt;tt&gt;col.size&lt;/tt&gt;, inclusive. 
-     * The final index of the range (&lt;tt&gt;to&lt;/tt&gt;), which must be greater than or
-     * equal to &lt;tt&gt;from&lt;/tt&gt;.
-     * &lt;p&gt;The returned array will be "safe" in that no references to it are
-     * maintained by this list.  (In other words, this method must allocate
-     * a new array).  The caller is thus free to modify the returned array.
-     *
-     * &lt;p&gt;This method acts as bridge between array-based and collection-based
-     * APIs.
+	 * The initial index of the range (&lt;tt&gt;from&lt;/tt&gt;) must lie between zero
+	 * and &lt;tt&gt;col.size&lt;/tt&gt;, inclusive. 
+	 * The final index of the range (&lt;tt&gt;to&lt;/tt&gt;), which must be greater than or
+	 * equal to &lt;tt&gt;from&lt;/tt&gt;.
+	 * &lt;p&gt;The returned array will be "safe" in that no references to it are
+	 * maintained by this list.  (In other words, this method must allocate
+	 * a new array).  The caller is thus free to modify the returned array.
+	 *
+	 * &lt;p&gt;This method acts as bridge between array-based and collection-based
+	 * APIs.
 	 * @param col the collection to be copied.
 	 * @param from the initial index of the range to be copied, inclusive.
-     * @param to the final index of the range to be copied, exclusive.
-     * @since 3.0.6
+	 * @param to the final index of the range to be copied, exclusive.
+	 * @since 3.0.6
 	 */
+	@SuppressWarnings("unchecked")
 	public static final Object[] toArray(Collection col, int from, int to) {
+		return toArray(col, new Object[0], from, to);
+	}
+	/**
+	 * Returns the specified range of the given collection;
+	 * the runtime type of the returned array is that of the specified array.
+	 * @param col the collection to be copied.
+	 * @param dst the array into which the elements of this list are to be stored,
+	 * if it is big enough (less than &lt;code&gt;to - from&lt;/code&gt;; otherwise, a new array of the same runtime type is allocated for this purpose. 
+	 * Note: dst[0] will be col[from].
+	 * @param from the initial index of the range to be copied, inclusive.
+	 * @param to the final index of the range to be copied, exclusive.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; T[] toArray(Collection&lt;T&gt; col, T[] dst, int from, int to) {
+		int sz = col.size();
+		if (to &gt; sz) to = sz;
+		if (from &lt; 0) from = 0;
+
 		int newLength = to - from;
 		if (newLength &lt; 0)
-            throw new IllegalArgumentException(from + " &gt; " + to);
-		Object[] result = new Object[newLength];
-        int i = 0, j = 0;
-        for (Iterator it = col.iterator(); it.hasNext() &amp;&amp; i &lt; result.length;) {
-        	if (j++ &lt; from) {
-        		it.next();
-        		continue;
-        	}
-            result[i++] = it.next();
-        }
-		return result;
-    }
+			throw new IllegalArgumentException(from + " &gt; " + to);
+
+		if (dst.length &lt; newLength)
+			dst = (T[])Array.newInstance(dst.getClass().getComponentType(), newLength);
+
+		int i = 0, j = 0;
+		for (Iterator&lt;T&gt; it = col.iterator(); it.hasNext() &amp;&amp; i &lt; dst.length;) {
+			if (j++ &lt; from) {
+				it.next();
+				continue;
+			}
+			dst[i++] = it.next();
+		}
+		return dst;
+	}
+
 	/** Adds all elements returned by the iterator to a collection.
 	 * @param iter the iterator; null is OK
 	 * @return the number element being added

Modified: branches/6.0/zcommon/src/org/zkoss/xel/Function.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/Function.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zcommon/src/org/zkoss/xel/Function.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -47,7 +47,7 @@
 	 * @param args the arguments used for the method call.
 	 * If null, an Object array with zero length is assumed.
 	 */
-	public Object invoke(Object obj, Object[] args) throws Exception;
+	public Object invoke(Object obj, Object... args) throws Exception;
 
 	/** Converts this function to a method, or null if unable to convert.
 	 */

Modified: branches/6.0/zcommon/src/org/zkoss/xel/util/MethodFunction.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/util/MethodFunction.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zcommon/src/org/zkoss/xel/util/MethodFunction.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -40,7 +40,7 @@
 	public Class&lt;?&gt; getReturnType() {
 		return getMethod().getReturnType();
 	}
-	public Object invoke(Object obj, Object[] args) throws Exception {
+	public Object invoke(Object obj, Object... args) throws Exception {
 		return getMethod().invoke(obj, args);
 	}
 	public Method toMethod() {

Modified: branches/6.0/zk/src/archive/web/js/zk/au.js
===================================================================
--- branches/6.0/zk/src/archive/web/js/zk/au.js	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/archive/web/js/zk/au.js	2010-09-17 05:40:36 UTC (rev 14278)
@@ -31,7 +31,7 @@
 			zAu.doneTime = zUtl.now();
 		}
 	}
-	function pushCmds(reqInf, req) {
+	function pushReqCmds(reqInf, req) {
 		var dt = reqInf.dt,
 			rt = req.responseText;
 		if (!rt) {
@@ -54,6 +54,10 @@
 			if (!isNaN(rid)) cmds.rid = rid;
 		}
 
+		pushCmds(cmds, rs);
+		return true;
+	}
+	function pushCmds(cmds, rs) {
 		for (var j = 0, rl = rs ? rs.length: 0; j &lt; rl; ++j) {
 			var r = rs[j],
 				cmd = r[0],
@@ -68,7 +72,6 @@
 		}
 
 		cmdsQue.push(cmds);
-		return true;
 	}
 	function doProcess(cmd, data) { //decoded
 		//1. process zAu.cmd1 (cmd1 has higher priority)
@@ -149,7 +152,7 @@
 						ajaxReqResend(reqInf);
 						return;
 					}
-					if (pushCmds(reqInf, req)) { //valid response
+					if (pushReqCmds(reqInf, req)) { //valid response
 						//advance SID to avoid receive the same response twice
 						if (sid &amp;&amp; ++seqId &gt; 9999) seqId = 1;
 						ajaxReqTries = 0;
@@ -582,6 +585,17 @@
 	shallIgnoreESC: function () {
 		return ajaxReq;
 	},
+	/** Process the specified commands.
+	 * @param String dtid the desktop's ID
+	 * @param Array rs a list of responses
+	 * @since 5.0.5
+	 */
+	doCmds: function (dtid, rs) {
+		var cmds = [];
+		cmds.dt = zk.Desktop.$(dtid);
+		pushCmds(cmds, rs);
+		this._doCmds();
+	},
 	_doCmds: function () { //called by mount.js, too
 		for (var fn; fn = doCmdFns.shift();)
 			fn();

Modified: branches/6.0/zk/src/org/zkoss/zk/au/AuRequests.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/AuRequests.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/au/AuRequests.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -39,13 +39,14 @@
 	 *
 	 * @return a set of components.
 	 */
-	public static Set&lt;Component&gt; convertToItems(Desktop desktop, List&lt;String&gt; uuids) {
-		final Set&lt;Component&gt; items = new LinkedHashSet&lt;Component&gt;();
+	@SuppressWarnings("unchecked")
+	public static &lt;T extends Component&gt; Set&lt;T&gt; convertToItems(Desktop desktop, List&lt;String&gt; uuids) {
+		final Set&lt;T&gt; items = new LinkedHashSet&lt;T&gt;();
 		if (uuids != null)
 			for (String uuid: uuids) {
 				final Component item = desktop.getComponentByUuidIfAny(uuid.trim());
 				if (item != null)
-					items.add(item);
+					items.add((T)item);
 				//notice that it might be null (since the items might be
 				//removed by the last request)
 			}

Modified: branches/6.0/zk/src/org/zkoss/zk/au/AuWriters.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/AuWriters.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/au/AuWriters.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -19,6 +19,7 @@
 import java.io.Writer;
 import java.io.IOException;
 
+import org.zkoss.json.*;
 import org.zkoss.idom.Verifier;
 
 import org.zkoss.zk.ui.UiException;
@@ -66,6 +67,31 @@
 		return new HttpAuWriter();
 	}
 
+	/** Returns a JSON object representing the output that will be sent
+	 * to the client.
+	 * &lt;p&gt;You could add the responses to the given array by invoking
+	 * {@link #toJSON}.
+	 *
+	 * @param rs the array to hold the responses.
+	 * To output a response, invoke {@link #toJSON} as follows:
+	 * &lt;code&gt;rs.add(AuWriters.toJSON(response))&lt;/code&gt;.
+	 * @since 5.0.5
+	 */
+	public static JSONObject getJSONOutput(JSONArray rs) {
+		final JSONObject out = new JSONObject();
+		out.put("rs", rs);
+		return out;
+	}
+	/** Converts a response to a JSON object.
+	 *@since 5.0.5
+	 */
+	public static JSONArray toJSON(AuResponse response) {
+		final JSONArray r = new JSONArray();
+		r.add(response.getCommand());
+		r.add(response.getEncodedData());
+		return r;
+	}
+
 	/** The content type of the output.
 	 * @since 3.5.0
 	 */

Modified: branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -23,7 +23,6 @@
 import java.util.Map;
 import java.util.HashMap;
 import java.util.Date;
-import java.io.StringWriter;
 import java.io.IOException;
 
 import javax.servlet.ServletConfig;

Modified: branches/6.0/zk/src/org/zkoss/zk/au/http/HttpAuWriter.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/http/HttpAuWriter.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/au/http/HttpAuWriter.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -72,8 +72,7 @@
 			//Bug 1907640: with Glassfish v1, we cannot change content type
 			//in another thread, so we have to do it here
 
-		_out = new JSONObject();
-		_out.put("rs", _rs = new JSONArray());
+		_out = AuWriters.getJSONOutput(_rs = new JSONArray());
 		return this;
 	}
 	public void close(Object request, Object response) throws IOException {
@@ -148,10 +147,7 @@
 		_out.put("rid", new Integer(resId));
 	}
 	public void write(AuResponse response) throws IOException {
-		final JSONArray r = new JSONArray();
-		r.add(response.getCommand());
-		r.add(response.getEncodedData());
-		_rs.add(r);
+		_rs.add(AuWriters.toJSON(response));
 	}
 	public void write(Collection responses) throws IOException {
 		for (Iterator it = responses.iterator(); it.hasNext();)

Modified: branches/6.0/zk/src/org/zkoss/zk/scripting/bsh/BSHInterpreter.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/scripting/bsh/BSHInterpreter.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/scripting/bsh/BSHInterpreter.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -417,7 +417,7 @@
 								NameSpace.class.getDeclaredMethod("getVariableImpl",
 									new Class[] {String.class, Boolean.TYPE});
 							m.setAccessible(true);
-							var = (Variable)m.invoke(parent, new Object[] {name, Boolean.TRUE});
+							var = (Variable)m.invoke(parent, name, Boolean.TRUE);
 						} catch (Exception ex) {
 							throw UiException.Aide.wrap(ex);
 						}
@@ -752,7 +752,7 @@
 		public Class getReturnType() {
 			return _method.getReturnType();
 		}
-		public Object invoke(Object obj, Object[] args) throws Exception {
+		public Object invoke(Object obj, Object... args) throws Exception {
 			return _method.invoke(args != null ? args: new Object[0], _ip);
 		}
 		public java.lang.reflect.Method toMethod() {

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Components.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Components.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Components.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -141,7 +141,7 @@
 	 * @since 3.5.0
 	 */
 	public static void sort(List&lt;Component&gt; list, int from, int to, Comparator&lt;? super Component&gt; cpr) {
-		final Component ary[] = (Component[])CollectionsX.toArray(list, from, to);
+		final Component ary[] = CollectionsX.toArray(list, new Component[0], from, to);
 		Arrays.sort(ary, cpr);
 
 		ListIterator&lt;Component&gt; it = list.listIterator(from);
@@ -1126,7 +1126,7 @@
 						fd.setAccessible(true);
 						final Object value = fd.get(_controller);
 						if (value == null) {
-							md.invoke(_controller, new Object[] {arg});
+							md.invoke(_controller, arg);
 							if (fd.get(_controller) == arg) { //field is set
 								_injected.add(fdname); //mark as injected
 							}
@@ -1139,7 +1139,7 @@
 					}
 				} else {
 					try {
-						md.invoke(_controller, new Object[] {arg});
+						md.invoke(_controller, arg);
 						_injected.add(fdname); //no field, just mark as injected
 						return true;
 					} catch (Exception ex) {

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Richlet.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Richlet.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Richlet.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -43,7 +43,7 @@
 	/** Called by the richlet container to create components when
 	 * the specified page is visited and created.
 	 */
-	public void service(Page page);
+	public void service(Page page) throws Exception;
 
 	/** Returns the default language defintion that this richlet belongs to.
 	 * Don't return null.

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/event/EventQueue.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/event/EventQueue.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/event/EventQueue.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -44,7 +44,7 @@
  * @since 5.0.0
  */
 public interface EventQueue {
-	/** Publishes an event the queue.
+	/** Publishes an event to the queue.
 	 *
 	 * &lt;p&gt;If the scope of a event queue is desktop or group,
 	 * this method must be called within an activated exection
@@ -54,12 +54,18 @@
 	 * &lt;p&gt;On the other hand, if the scope is session or application,
 	 * it is OK to be called without the current execution.
 	 *
+	 * @param event the event to publish.&lt;br/&gt;
+	 * Notice that all subscribers will receive the event no matter
+	 * what the event's name and target are.&lt;br/&gt;
+	 * You could publish an anonymous event by
+	 * &lt;code&gt;publish(new Event("", null, data))&lt;/code&gt;.
 	 * @exception IllegalStateException if this method is called
 	 * not within an activated execution (such as a working thread),
 	 * and this is a ({@link EventQueues#DESKTOP}) or {@link EventQueues#GROUP}
 	 * event queue.
 	 */
 	public void publish(Event event);
+
 	/** Subscribes a listener to this queue.
 	 * It is the same as &lt;code&gt;subscribe(listener, false)&lt;/code&gt;
 	 * ({@link #subscribe(EventListener,boolean)}. In other words,

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/event/GenericEventListener.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/event/GenericEventListener.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/event/GenericEventListener.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -84,15 +84,15 @@
 				//paramcls is ForwardEvent || Event
 				if (ForwardEvent.class.isAssignableFrom(paramcls)
 				|| Event.class.equals(paramcls)) { 
-					mtd.invoke(controller, new Object[] {evt});
+					mtd.invoke(controller, evt);
 				} else {
 					do {
 						evt = ((ForwardEvent)evt).getOrigin();
 					} while(evt instanceof ForwardEvent);
-					mtd.invoke(controller, new Object[] {evt});
+					mtd.invoke(controller, evt);
 				}
 			} else
-				mtd.invoke(controller, new Object[] {evt});
+				mtd.invoke(controller, evt);
 		}
 	}
 	

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/event/SelectEvent.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/event/SelectEvent.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/event/SelectEvent.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -35,8 +35,8 @@
  * 
  * @author tomyeh
  */
-public class SelectEvent extends Event {
-	private final Set _selectedItems;
+public class SelectEvent&lt;T extends Component&gt; extends Event {
+	private final Set&lt;T&gt; _selectedItems;
 	private final Component _ref;
 	private final int _keys;
 
@@ -56,27 +56,27 @@
 	/** Converts an AU request to a select event.
 	 * @since 5.0.0
 	 */
-	public static final SelectEvent getSelectEvent(AuRequest request) {
+	public static final &lt;C extends Component&gt; SelectEvent&lt;C&gt; getSelectEvent(AuRequest request) {
 		final Map data = request.getData();
 		final Desktop desktop = request.getDesktop();
-		final List&lt;String&gt; items = cast((List)data.get("items"));
-		return new SelectEvent(request.getCommand(), request.getComponent(),
-			AuRequests.convertToItems(desktop, items),
-			desktop.getComponentByUuidIfAny((String)data.get("reference")),
+		final List&lt;String&gt; sitems = cast((List)data.get("items"));
+		final Set&lt;C&gt; items = AuRequests.convertToItems(desktop, sitems);
+		return new SelectEvent&lt;C&gt;(request.getCommand(), request.getComponent(),
+			items, desktop.getComponentByUuidIfAny((String)data.get("reference")),
 			AuRequests.parseKeys(data));
 	}
 
 	/** Constructs a selection event.
 	 * @param selectedItems a set of items that shall be selected.
 	 */
-	public SelectEvent(String name, Component target, Set selectedItems) {
+	public SelectEvent(String name, Component target, Set&lt;T&gt; selectedItems) {
 		this(name, target, selectedItems, null, 0);
 	}
 
 	/** Constructs a selection event.
 	 * @param selectedItems a set of items that shall be selected.
 	 */
-	public SelectEvent(String name, Component target, Set selectedItems,
+	public SelectEvent(String name, Component target, Set&lt;T&gt; selectedItems,
 	Component ref) {
 		this(name, target, selectedItems, ref, 0);
 	}
@@ -86,17 +86,20 @@
 	 * and {@link #ALT_KEY}.
 	 * @since 3.6.0
 	 */
-	public SelectEvent(String name, Component target, Set selectedItems,
+	public SelectEvent(String name, Component target, Set&lt;T&gt; selectedItems,
 	Component ref, int keys) {
 		super(name, target);
-		_selectedItems = selectedItems != null ?
-			selectedItems: Collections.EMPTY_SET;
+
+		if (selectedItems != null)
+			_selectedItems = selectedItems;
+		else
+			_selectedItems = Collections.emptySet();
 		_ref = ref;
 		_keys = keys;
 	}
 	/** Returns the selected items (never null).
 	 */
-	public final Set getSelectedItems() {
+	public final Set&lt;T&gt; getSelectedItems() {
 		return _selectedItems;
 	}
 

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/http/DHtmlLayoutServlet.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -106,30 +106,12 @@
 		if (_webman != null) {
 			log.info("Web Manager was created before ZK loader");
 		} else {
-			String updateURI = fixUpdateURI(
+			String updateURI = Utils.checkUpdateURI(
 				config.getInitParameter("update-uri"), "The update-uri parameter");
 			_webman = new WebManager(_ctx, updateURI);
 			_webmanCreated = true;
 		}
 	}
-	/*package*/ static final String fixUpdateURI(String updateURI, String info)
-	throws ServletException {
-		if (updateURI == null
-		|| (updateURI = updateURI.trim()).length() == 0
-		|| updateURI.charAt(0) != '/')
-			throw new ServletException(info+" must be specified and starts with /");
-		if (updateURI.indexOf(';') &gt;= 0 || updateURI.indexOf('?') &gt;= 0)
-			throw new ServletException(info+" cannot contain ';' or '?'");
-			//Jetty will encode URL by appending ';jsess..' and we have to
-			//remove it under certain situations, so not alow it
-		if (updateURI.charAt(updateURI.length() - 1) == '\\') {
-			if (updateURI.length() == 1)
-				throw new ServletException(info+" cannot contain only '/'");
-			updateURI = updateURI.substring(0, updateURI.length() - 1);
-				//remove the trailing '\\' if any
-		}
-		return updateURI;
-	}
 	public void destroy() {
 		if (_webman != null) {
 			if (_webmanCreated)

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/http/Utils.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/http/Utils.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/http/Utils.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -220,4 +220,30 @@
 		}
 		return null;
 	}
+
+	/** Checks the update URI.
+	 * @param updateURI the update URI to be checked.
+	 * @param info the info to show if updateURI is incorrect.
+	 * @return the update URI (by removing ending / if any)
+	 * @exception ServletException if updateURI is incorrect.
+	 * @since 5.0.5
+	 */
+	public static final String checkUpdateURI(String updateURI, String info)
+	throws ServletException {
+		if (updateURI == null
+		|| (updateURI = updateURI.trim()).length() == 0
+		|| updateURI.charAt(0) != '/')
+			throw new ServletException(info+" must be specified and starts with /");
+		if (updateURI.indexOf(';') &gt;= 0 || updateURI.indexOf('?') &gt;= 0)
+			throw new ServletException(info+" cannot contain ';' or '?'");
+			//Jetty will encode URL by appending ';jsess..' and we have to
+			//remove it under certain situations, so not alow it
+		if (updateURI.charAt(updateURI.length() - 1) == '\\') {
+			if (updateURI.length() == 1)
+				throw new ServletException(info+" cannot contain only '/'");
+			updateURI = updateURI.substring(0, updateURI.length() - 1);
+				//remove the trailing '\\' if any
+		}
+		return updateURI;
+	}
 }

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/http/WebManager.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/http/WebManager.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/http/WebManager.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -312,15 +312,17 @@
 	public static final WebManager getWebManager(WebApp wapp) {
 		return getWebManager((ServletContext)wapp.getNativeContext());
 	}
-	/** Returns the Web manager, or null if not found.
+	/** Returns the Web manager of the give context, or null if not found.
+	 * @since 5.0.5
 	 */
-	/*package*/ static final WebManager getWebManagerIfAny(ServletContext ctx) {
+	public static final WebManager getWebManagerIfAny(ServletContext ctx) {
 		return (WebManager)ctx.getAttribute(ATTR_WEB_MANAGER);
 	}
-	/** Returns the Web manager of the specified {@link WebApp}.
-	 * @since 5.0.3
+	/** Returns the Web manager of the specified {@link WebApp},
+	 * or null if not found.
+	 * @since 5.0.5
 	 */
-	/*package*/ static final WebManager getWebManagerIfAny(WebApp wapp) {
+	public static final WebManager getWebManagerIfAny(WebApp wapp) {
 		return getWebManagerIfAny((ServletContext)wapp.getNativeContext());
 	}
 	/** Returns the Web application of the specified context.

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -44,6 +44,7 @@
 import org.zkoss.util.ArraysX;
 import org.zkoss.util.logging.Log;
 import org.zkoss.web.servlet.Servlets;
+import org.zkoss.json.*;
 
 import org.zkoss.zk.mesg.MZk;
 import org.zkoss.zk.ui.*;
@@ -1160,6 +1161,84 @@
 				meterAuServerComplete(pfmeter, doneReqIds, exec);
 		}
 	}
+	public Object startUpdate(Execution exec) throws IOException {
+		final Desktop desktop = exec.getDesktop();
+		UiVisualizer uv = doActivate(exec, true, false, null);
+		desktop.getWebApp().getConfiguration().invokeExecutionInits(exec, null);
+		((DesktopCtrl)desktop).invokeExecutionInits(exec, null);
+		return new UpdateInfo(uv);
+	}
+	public JSONArray finishUpdate(Object ctx) throws IOException {
+		final UpdateInfo ui = (UpdateInfo)ctx;
+		final Execution exec = ui.uv.getExecution();
+		final Desktop desktop = exec.getDesktop();
+		final List&lt;Throwable&gt; errs = new LinkedList&lt;Throwable&gt;();
+
+		//1. process events
+		Event event = nextEvent(ui.uv);
+		do {
+			for (; event != null; event = nextEvent(ui.uv)) {
+				try {
+					process(desktop, event);
+				} catch (Throwable ex) {
+					handleError(ex, ui.uv, errs);
+					break; //skip the rest of events! 
+				}
+			}
+
+			resumeAll(desktop, ui.uv, errs);
+		} while ((event = nextEvent(ui.uv)) != null);
+
+		//2. Handle aborting reason
+		ui.abrn = ui.uv.getAbortingReason();
+		if (ui.abrn != null)
+			ui.abrn.execute(); //always execute even if !isAborting
+
+		//3. Retrieve responses
+		List&lt;AuResponse&gt; responses;
+		try {
+			if (!errs.isEmpty())
+				visualizeErrors(exec, ui.uv, errs);
+
+			responses = ui.uv.getResponses();
+		} catch (Throwable ex) {
+			responses = new LinkedList&lt;AuResponse&gt;();
+			responses.add(new AuAlert(Exceptions.getMessage(ex)));
+
+			log.error(ex);
+		}
+
+		final JSONArray rs = new JSONArray();
+		for (Iterator it = responses.iterator(); it.hasNext();)
+			rs.add(AuWriters.toJSON((AuResponse)it.next()));
+		return rs;
+	}
+	public void closeUpdate(Object ctx) throws IOException {
+		final UpdateInfo ui = (UpdateInfo)ctx;
+		final Execution exec = ui.uv.getExecution();
+
+		final Desktop desktop = exec.getDesktop();
+		((DesktopCtrl)desktop).invokeExecutionCleanups(exec, null, null);
+		desktop.getWebApp().getConfiguration().invokeExecutionCleanups(exec, null, null);
+
+		if (ui.abrn != null) {
+			try {
+				ui.abrn.finish();
+			} catch (Throwable t) {
+				log.warning(t);
+			}
+		}
+
+		doDeactivate(exec);
+	}
+	private static class UpdateInfo {
+		private final UiVisualizer uv;
+		private AbortingReason abrn;
+		private UpdateInfo(UiVisualizer uv) {
+			this.uv = uv;
+		}
+	}
+
 	/** Handles each error. The erros will be queued to the errs list
 	 * and processed later by {@link #visualizeErrors}.
 	 */

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiVisualizer.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiVisualizer.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiVisualizer.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -641,7 +641,7 @@
 		if (_responses != null) {
 			for (ResponseInfo ri: _responses.values()) {
 				tvals.addAll(ri.keyless);
-				ri.keyless.clear();
+				tvals.addAll(ri.values.values());
 			}
 		}
 		if (!tvals.isEmpty()) {

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -382,6 +382,7 @@
 
 			final String macroURI = el.getElementValue("macro-uri", true);
 			final ComponentDefinitionImpl compdef;
+			boolean extend = false;
 			if (macroURI != null &amp;&amp; macroURI.length() != 0) {
 				if (log.finerable()) log.finer("macro component definition: "+name);
 
@@ -398,6 +399,8 @@
 				compdef.setDeclarationURL(url);
 				langdef.addComponentDefinition(compdef);
 			} else if (el.getElement("extends") != null) { //extends
+				extend = true;
+
 				final String extnm = el.getElementValue("extends", true);
 				if (log.finerable()) log.finer("Extends component definition, "+name+", from "+extnm);
 				final ComponentDefinition ref = langdef.getComponentDefinitionIfAny(extnm);
@@ -450,6 +453,8 @@
 
 			String wgtnm = el.getElementValue("widget-class", true);
 			WidgetDefinition wgtdef = null;
+			if (wgtnm == null &amp;&amp; extend)
+				wgtnm = compdef.getDefaultWidgetClass(null);
 			if (wgtnm != null) {
 				if (!withEL(wgtnm))
 					wgtdef = getWidgetDefinition(langdef, compdef, wgtnm);

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Property.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Property.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Property.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -285,7 +285,7 @@
 				}
 			}
 		}
-		m.invoke(comp, new Object[] {val});
+		m.invoke(comp, val);
 	}
 	private static Method findExact(final Method[] mtds, final Object val) {
 		if (val != null) {
@@ -392,7 +392,7 @@
 		if (mtd != null) {
 			try {
 				Object val = Classes.coerce(mtd.getParameterTypes()[0], value);
-				mtd.invoke(comp, new Object[] {val});
+				mtd.invoke(comp, val);
 			} catch (Exception ex) {
 				log.error("Failed to assign "+value+" to "+comp+"\n"+Exceptions.getMessage(ex));
 				throw UiException.Aide.wrap(ex);

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/sys/UiEngine.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/sys/UiEngine.java	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/sys/UiEngine.java	2010-09-17 05:40:36 UTC (rev 14278)
@@ -22,6 +22,7 @@
 import java.io.IOException;
 import java.io.Writer;
 
+import org.zkoss.json.JSONArray;
 import org.zkoss.zk.ui.WebApp;
 import org.zkoss.zk.ui.Desktop;
 import org.zkoss.zk.ui.Page;
@@ -182,6 +183,35 @@
 	public void execUpdate(Execution exec, List&lt;AuRequest&gt; requests, AuWriter out)
 	throws IOException;
 
+	/** Activates an execution that will allow developers to update
+	 * the state of components.
+	 * &lt;p&gt;It is designed to implement {@link org.zkoss.zkplus.embed.Bridge}.
+	 *
+	 * @return a context that shall be passed to {@link #finishUpdate}.
+	 * @since 5.0.5
+	 * @see #finishUpdate
+	 * @see #closeUpdate
+	 */
+	public Object startUpdate(Execution exec) throws IOException;
+	/** Finishes the update and returns the result in an array of JSON object.
+	 * Notice it does not deactivate the execution. Rather, the caller
+	 * has to invoke {@link #closeUpdate}.
+	 * &lt;p&gt;It is designed to implement {@link org.zkoss.zkplus.embed.Bridge}.
+	 *
+	 * @param ctx the context returned by the previous call to {@link #startUpdate}
+	 * @since 5.0.5
+	 * @see #startUpdate
+	 * @see #closeUpdate
+	 */
+	public JSONArray finishUpdate(Object ctx) throws IOException;
+	/** Deactivates the execution and cleans up.
+	 * &lt;p&gt;It is designed to implement {@link org.zkoss.zkplus.embed.Bridge}.
+	 * @since 5.0.5
+	 * @see #startUpdate
+	 * @see #finishUpdate
+	 */
+	public void closeUpdate(Object ctx) throws IOException;
+
 	/** Executes the recovering.
 	 */
 	public void execRecover(Execution exec, FailoverManager failover);

Modified: branches/6.0/zkdemo/src/archive/WEB-INF/web.xml
===================================================================
--- branches/6.0/zkdemo/src/archive/WEB-INF/web.xml	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zkdemo/src/archive/WEB-INF/web.xml	2010-09-17 05:40:36 UTC (rev 14278)
@@ -109,22 +109,28 @@
 		&lt;url-pattern&gt;/zkau/*&lt;/url-pattern&gt;
 	&lt;/servlet-mapping&gt;
 
-	&lt;!-- Used to test the booksuggest example --&gt;
+	&lt;!-- Used to test test/booksuggest.html
 	&lt;servlet&gt;
-		&lt;description&gt;Test of booksuggest&lt;/description&gt;
+		&lt;description&gt;Test of test/booksuggest.html&lt;/description&gt;
 		&lt;servlet-name&gt;booksuggest&lt;/servlet-name&gt;
 		&lt;servlet-class&gt;org.zkoss.zkdemo.test.BookSuggest&lt;/servlet-class&gt;
-		&lt;!-- Any number of parameters
-		&lt;init-param&gt;
-			&lt;param-name&gt;foo&lt;/param-name&gt;
-			&lt;param-value&gt;foo&lt;/param-value&gt;
-		&lt;/init-param&gt;
-		--&gt;
 	&lt;/servlet&gt;
 	&lt;servlet-mapping&gt;
 		&lt;servlet-name&gt;booksuggest&lt;/servlet-name&gt;
 		&lt;url-pattern&gt;/booksuggest/*&lt;/url-pattern&gt;
 	&lt;/servlet-mapping&gt;
+	 --&gt;
+	&lt;!-- Used to test test/test.jsp
+	&lt;servlet&gt;
+		&lt;description&gt;Test of test/embed.jsp&lt;/description&gt;
+		&lt;servlet-name&gt;embed&lt;/servlet-name&gt;
+		&lt;servlet-class&gt;org.zkoss.zkdemo.test.Embed&lt;/servlet-class&gt;
+	&lt;/servlet&gt;
+	&lt;servlet-mapping&gt;
+		&lt;servlet-name&gt;embed&lt;/servlet-name&gt;
+		&lt;url-pattern&gt;/embed/*&lt;/url-pattern&gt;
+	&lt;/servlet-mapping&gt;
+	--&gt;
 
 	&lt;!-- Uncomment if you want to use the ZK filter to post process the HTML output
 	generated by other technology, such as JSP and velocity.

Added: branches/6.0/zkdemo/src/archive/test/embed.jsp
===================================================================
--- branches/6.0/zkdemo/src/archive/test/embed.jsp	                        (rev 0)
+++ branches/6.0/zkdemo/src/archive/test/embed.jsp	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,47 @@
+&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" target="_new">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"&gt;
+&lt;%@page import="org.zkoss.zk.ui.*"%&gt;
+&lt;%@page import="org.zkoss.zul.*"%&gt;
+&lt;%@page import="org.zkoss.zkplus.embed.Renders"%&gt;
+&lt;%@page import="java.util.*"%&gt;
+&lt;html&gt;
+	&lt;head&gt;
+		&lt;title&gt;Test of Embedded Component&lt;/title&gt;
+	&lt;/head&gt;
+	&lt;body style="height:auto"&gt;
+		&lt;p&gt;This is a test of embed component: listbox.&lt;/p&gt;
+		&lt;%
+	final HttpSession sess = session;
+	Renders.render(config.getServletContext(), request, response,
+		new GenericRichlet() {
+	public void service(Page page) {
+		Listbox listbox = new Listbox();
+		listbox.appendChild(new Listitem("Item 1"));
+		listbox.appendChild(new Listitem("Item 2"));
+		listbox.setPage(page);
+	}
+		}, null, out);
+		%&gt;
+		&lt;script&gt;
+		function ajaxClick() {
+		 jq.ajax({
+			   type: 'POST',
+			   url: zk.ajaxURI('/embed'),
+			   dataType: 'text',
+			   data: 'desktop=' + zk.Desktop.$().id,
+			   success: function (jscode) {
+					eval(jscode);
+				}
+			 });
+	}
+		&lt;/script&gt;
+
+		This is a regular button to send Ajax thru jQuery (not AU)
+		&lt;button type="button" onclick="ajaxClick()"&gt;click me&lt;/button&gt;
+
+		&lt;p&gt;This is a test of embed component: datebox.&lt;/p&gt;
+		&lt;%
+	Datebox db = new Datebox();
+	Renders.render(config.getServletContext(), request, response, db, null, out);
+		%&gt;
+	&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Modified: branches/6.0/zkdemo/src/archive/test/groupInPaging/model.zul
===================================================================
--- branches/6.0/zkdemo/src/archive/test/groupInPaging/model.zul	2010-09-16 05:38:34 UTC (rev 14277)
+++ branches/6.0/zkdemo/src/archive/test/groupInPaging/model.zul	2010-09-17 05:40:36 UTC (rev 14278)
@@ -91,8 +91,8 @@
 		Comparator asc2 = new MyComparator(true,true);
 		Comparator dsc2 = new MyComparator(false,true);
 		
-		GroupsModel model1 = new ArrayGroupsModel(datas,asc1);
-		GroupsModel model2 = new org.zkoss.zkdemo.test2.group.Test1ArrayGroupsModel(datas,(Comparator)asc1);
+		GroupsModel model1 = new GroupsModelArray(datas,asc1);
+		GroupsModel model2 = new org.zkoss.zkdemo.test2.group.Test1GroupsModelArray(datas,(Comparator)asc1);
 
 	]]&gt;&lt;/zscript&gt;	
 	&lt;div&gt;

Added: branches/6.0/zkdemo/src/archive/test2/B50-3061764.zul
===================================================================
--- branches/6.0/zkdemo/src/archive/test2/B50-3061764.zul	                        (rev 0)
+++ branches/6.0/zkdemo/src/archive/test2/B50-3061764.zul	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,22 @@
+&lt;zk&gt;
+&lt;html&gt;
+&lt;![CDATA[
+&lt;ol&gt;
+&lt;li&gt;Opera only.&lt;/li&gt;
+&lt;li&gt;Sizing the list header to right and make it wider&lt;/li&gt;
+&lt;li&gt;The list header shall be resized to the position you make. If not, it is a bug.&lt;/li&gt;
+&lt;li&gt;Done.&lt;/li&gt;
+]]&gt;
+&lt;/html&gt;
+&lt;listbox&gt;
+	&lt;listhead sizable="true"&gt;
+		&lt;listheader label="column1" width="40px"/&gt;
+	&lt;/listhead&gt;
+	&lt;listitem&gt;
+		&lt;listcell label="row1" /&gt;
+	&lt;/listitem&gt;
+	&lt;listitem&gt;
+		&lt;listcell label="row2" /&gt;
+	&lt;/listitem&gt;
+&lt;/listbox&gt;
+&lt;/zk&gt;
\ No newline at end of file

Added: branches/6.0/zkdemo/src/archive/test2/B50-3061765.zul
===================================================================
--- branches/6.0/zkdemo/src/archive/test2/B50-3061765.zul	                        (rev 0)
+++ branches/6.0/zkdemo/src/archive/test2/B50-3061765.zul	2010-09-17 05:40:36 UTC (rev 14278)
@@ -0,0 +1,23 @@
+&lt;zk&gt;
+&lt;html&gt;
+&lt;![CDATA[
+&lt;ol&gt;
+&lt;li&gt;Sizing the column header to right and make it wider but not go over the listbox width.&lt;/li&gt;
+&lt;li&gt;If you see a horizontal scrollbar, it is a bug; otherwise, it is OK.&lt;/li&gt;
+&lt;li&gt;Now drag the column header to right and over the listbox right edge(wider than the listbox width)&lt;/li&gt;
+&lt;li&gt;If you did not see a horizontal scrollbar, it is a bug; otherwise, it is OK.&lt;/li&gt;
+&lt;li&gt;Done.&lt;/li&gt;
+]]&gt;
+&lt;/html&gt;
+&lt;listbox&gt;
+	&lt;listhead sizable="true"&gt;

@@ Diff output truncated at 100000 characters. @@

This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26197490">[zk1-subversion-log] SF.net SVN: zk1:[14281] branches</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-21 05:43</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14281
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14281&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14281&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-21 05:43:41 +0000 (Tue, 21 Sep 2010)

Log Message:
-----------
Tue 09/21/2010

Modified Paths:
--------------
    branches/5.0/zcommon/.classpath
    branches/5.0/zcommon/.project
    branches/5.0/zcommon/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zcommon/pom.xml
    branches/5.0/zhtml/.classpath
    branches/5.0/zhtml/.project
    branches/5.0/zhtml/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zhtml/pom.xml
    branches/5.0/zk/.classpath
    branches/5.0/zk/.project
    branches/5.0/zk/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zk/pom.xml
    branches/5.0/zkplus/.classpath
    branches/5.0/zkplus/.project
    branches/5.0/zkplus/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zkplus/pom.xml
    branches/5.0/zul/.classpath
    branches/5.0/zul/.project
    branches/5.0/zul/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zul/pom.xml
    branches/5.0/zweb/.classpath
    branches/5.0/zweb/.project
    branches/5.0/zweb/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zweb/pom.xml
    branches/6.0/build.target.xml
    branches/6.0/zcommon/pom.xml
    branches/6.0/zcommon/src/org/zkoss/lang/Generics.java
    branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
    branches/6.0/zhtml/pom.xml
    branches/6.0/zhtml/src/org/zkoss/zhtml/impl/AbstractTag.java
    branches/6.0/zhtml/src/org/zkoss/zhtml/impl/TagRenderContext.java
    branches/6.0/zk/pom.xml
    branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Components.java
    branches/6.0/zk/src/org/zkoss/zk/ui/ext/render/Cropper.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiVisualizer.java
    branches/6.0/zkdemo/src/archive/userguide/grid/advGrouping.zul
    branches/6.0/zkdemo/src/archive/userguide/grid/detail.zul
    branches/6.0/zkdemo/src/archive/userguide/grid/grouping.zul
    branches/6.0/zkplus/pom.xml
    branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/AnnotateDataBinder.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/Binding.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingComboitemRenderer.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingListModelArray.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingListModelList.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingListModelMap.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingListModelSet.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingListitemRenderer.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingNode.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/BindingRowRenderer.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/DataBinder.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/SelectedComboitemConverter.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/databind/SelectedItemConverter.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionContextListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/jndi/JndiVariableResolver.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/jpa/JpaUtil.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/spring/DelegatingVariableResolver.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/spring/SpringTransactionSynchronizationListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/util/ThreadLocalListener.java
    branches/6.0/zul/pom.xml
    branches/6.0/zul/src/org/zkoss/zul/AbstractChartModel.java
    branches/6.0/zul/src/org/zkoss/zul/CategoryModel.java
    branches/6.0/zul/src/org/zkoss/zul/Column.java
    branches/6.0/zul/src/org/zkoss/zul/Combobox.java
    branches/6.0/zul/src/org/zkoss/zul/Datebox.java
    branches/6.0/zul/src/org/zkoss/zul/DialModel.java
    branches/6.0/zul/src/org/zkoss/zul/DialModelScale.java
    branches/6.0/zul/src/org/zkoss/zul/FieldComparator.java
    branches/6.0/zul/src/org/zkoss/zul/Fileupload.java
    branches/6.0/zul/src/org/zkoss/zul/Flashchart.java
    branches/6.0/zul/src/org/zkoss/zul/Footer.java
    branches/6.0/zul/src/org/zkoss/zul/GanttModel.java
    branches/6.0/zul/src/org/zkoss/zul/Grid.java
    branches/6.0/zul/src/org/zkoss/zul/Group.java
    branches/6.0/zul/src/org/zkoss/zul/HiLoModel.java
    branches/6.0/zul/src/org/zkoss/zul/ListModels.java
    branches/6.0/zul/src/org/zkoss/zul/ListSubModel.java
    branches/6.0/zul/src/org/zkoss/zul/Listbox.java
    branches/6.0/zul/src/org/zkoss/zul/Listfooter.java
    branches/6.0/zul/src/org/zkoss/zul/Listgroup.java
    branches/6.0/zul/src/org/zkoss/zul/Listheader.java
    branches/6.0/zul/src/org/zkoss/zul/ListitemComparator.java
    branches/6.0/zul/src/org/zkoss/zul/PieModel.java
    branches/6.0/zul/src/org/zkoss/zul/Radiogroup.java
    branches/6.0/zul/src/org/zkoss/zul/RowComparator.java
    branches/6.0/zul/src/org/zkoss/zul/Rows.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleCategoryModel.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleConstraint.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleDateConstraint.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleHiLoModel.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleListModel.java
    branches/6.0/zul/src/org/zkoss/zul/SimplePieModel.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleTreeModel.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleTreeNode.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleXYModel.java
    branches/6.0/zul/src/org/zkoss/zul/SimpleXYZModel.java
    branches/6.0/zul/src/org/zkoss/zul/Tree.java
    branches/6.0/zul/src/org/zkoss/zul/Treecell.java
    branches/6.0/zul/src/org/zkoss/zul/Treechildren.java
    branches/6.0/zul/src/org/zkoss/zul/WaferMapModel.java
    branches/6.0/zul/src/org/zkoss/zul/XYModel.java
    branches/6.0/zul/src/org/zkoss/zul/XYZModel.java
    branches/6.0/zul/src/org/zkoss/zul/api/Column.java
    branches/6.0/zul/src/org/zkoss/zul/api/Combobox.java
    branches/6.0/zul/src/org/zkoss/zul/api/Grid.java
    branches/6.0/zul/src/org/zkoss/zul/api/Group.java
    branches/6.0/zul/src/org/zkoss/zul/api/Listbox.java
    branches/6.0/zul/src/org/zkoss/zul/api/Listgroup.java
    branches/6.0/zul/src/org/zkoss/zul/api/Radiogroup.java
    branches/6.0/zul/src/org/zkoss/zul/api/Rows.java
    branches/6.0/zul/src/org/zkoss/zul/api/Tree.java
    branches/6.0/zul/src/org/zkoss/zul/impl/FileuploadDlg.java
    branches/6.0/zul/src/org/zkoss/zul/impl/GridDataLoader.java
    branches/6.0/zul/src/org/zkoss/zul/impl/GroupsListModel.java
    branches/6.0/zul/src/org/zkoss/zul/impl/ListboxDataLoader.java
    branches/6.0/zul/src/org/zkoss/zul/impl/Utils.java
    branches/6.0/zweb/pom.xml

Added Paths:
-----------
    branches/5.0/zcommon/.settings/org.eclipse.wst.common.component
    branches/5.0/zcommon/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/5.0/zhtml/.settings/org.eclipse.wst.common.component
    branches/5.0/zhtml/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/5.0/zk/.settings/org.eclipse.wst.common.component
    branches/5.0/zk/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/5.0/zkdemo/.classpath
    branches/5.0/zkdemo/.project
    branches/5.0/zkdemo/.settings/
    branches/5.0/zkdemo/.settings/.jsdtscope
    branches/5.0/zkdemo/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zkdemo/.settings/org.eclipse.wst.common.component
    branches/5.0/zkdemo/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/5.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.container
    branches/5.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.name
    branches/5.0/zkdemo/.settings/org.maven.ide.eclipse.prefs
    branches/5.0/zkdemo/pom.xml
    branches/5.0/zkplus/.settings/org.eclipse.wst.common.component
    branches/5.0/zkplus/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/5.0/zul/.settings/org.eclipse.wst.common.component
    branches/5.0/zul/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/5.0/zweb/.settings/org.eclipse.wst.common.component
    branches/5.0/zweb/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/6.0/zcommon/.classpath
    branches/6.0/zcommon/.project
    branches/6.0/zcommon/.settings/
    branches/6.0/zcommon/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zcommon/.settings/org.maven.ide.eclipse.prefs
    branches/6.0/zcommon/src/org/zkoss/mesg/MCommon.java
    branches/6.0/zhtml/.classpath
    branches/6.0/zhtml/.project
    branches/6.0/zhtml/.settings/
    branches/6.0/zhtml/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zhtml/.settings/org.maven.ide.eclipse.prefs
    branches/6.0/zk/.classpath
    branches/6.0/zk/.project
    branches/6.0/zk/.settings/
    branches/6.0/zk/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zk/.settings/org.maven.ide.eclipse.prefs
    branches/6.0/zk/src/org/zkoss/zk/mesg/MZk.java
    branches/6.0/zkplus/.classpath
    branches/6.0/zkplus/.project
    branches/6.0/zkplus/.settings/
    branches/6.0/zkplus/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zkplus/.settings/org.maven.ide.eclipse.prefs
    branches/6.0/zul/.classpath
    branches/6.0/zul/.project
    branches/6.0/zul/.settings/
    branches/6.0/zul/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zul/src/org/zkoss/zul/mesg/MZul.java
    branches/6.0/zweb/.classpath
    branches/6.0/zweb/.project
    branches/6.0/zweb/.settings/
    branches/6.0/zweb/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zweb/.settings/org.maven.ide.eclipse.prefs
    branches/6.0/zweb/src/org/zkoss/web/mesg/MWeb.java

Modified: branches/5.0/zcommon/.classpath
===================================================================
--- branches/5.0/zcommon/.classpath	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zcommon/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,7 +1,13 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
 	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/5.0/zcommon/.project
===================================================================
--- branches/5.0/zcommon/.project	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zcommon/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/5.0/zcommon/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zcommon/.settings/org.eclipse.jdt.core.prefs	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zcommon/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:55:11 CST 2010
+#Tue Sep 21 10:44:37 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/5.0/zcommon/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/5.0/zcommon/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/5.0/zcommon/.settings/org.eclipse.wst.common.component	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,4 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zcommon"/&gt;
+&lt;/project-modules&gt;

Added: branches/5.0/zcommon/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/5.0/zcommon/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/5.0/zcommon/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/5.0/zcommon/pom.xml
===================================================================
--- branches/5.0/zcommon/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zcommon/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;name&gt;The ZKoss Common Library&lt;/name&gt;

Modified: branches/5.0/zhtml/.classpath
===================================================================
--- branches/5.0/zhtml/.classpath	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zhtml/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,7 +1,13 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
 	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/5.0/zhtml/.project
===================================================================
--- branches/5.0/zhtml/.project	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zhtml/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/5.0/zhtml/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zhtml/.settings/org.eclipse.jdt.core.prefs	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zhtml/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:53:37 CST 2010
+#Tue Sep 21 10:44:56 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/5.0/zhtml/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/5.0/zhtml/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/5.0/zhtml/.settings/org.eclipse.wst.common.component	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zhtml"&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/archive"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/5.0/zhtml/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/5.0/zhtml/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/5.0/zhtml/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/5.0/zhtml/pom.xml
===================================================================
--- branches/5.0/zhtml/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zhtml/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zhtml&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;name&gt;ZK XHTML Components&lt;/name&gt;

Modified: branches/5.0/zk/.classpath
===================================================================
--- branches/5.0/zk/.classpath	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zk/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,7 +1,17 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
-	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="owner.project.facets" value="java"/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/5.0/zk/.project
===================================================================
--- branches/5.0/zk/.project	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zk/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/5.0/zk/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zk/.settings/org.eclipse.jdt.core.prefs	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zk/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:45:08 CST 2010
+#Tue Sep 21 10:45:15 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/5.0/zk/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/5.0/zk/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/5.0/zk/.settings/org.eclipse.wst.common.component	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zk"&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/archive"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/5.0/zk/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/5.0/zk/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/5.0/zk/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/5.0/zk/pom.xml
===================================================================
--- branches/5.0/zk/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zk/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -6,7 +6,7 @@
 	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
 	&lt;artifactId&gt;zk&lt;/artifactId&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;

Added: branches/5.0/zkdemo/.classpath
===================================================================
--- branches/5.0/zkdemo/.classpath	                        (rev 0)
+++ branches/5.0/zkdemo/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,12 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.dependency" value="/WEB-INF/lib"/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.web.container"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/5.0/zkdemo/.project
===================================================================
--- branches/5.0/zkdemo/.project	                        (rev 0)
+++ branches/5.0/zkdemo/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,37 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zkdemo&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.jsdt.core.javascriptValidator&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.jsdt.core.jsNature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/5.0/zkdemo/.settings/.jsdtscope
===================================================================
--- branches/5.0/zkdemo/.settings/.jsdtscope	                        (rev 0)
+++ branches/5.0/zkdemo/.settings/.jsdtscope	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,12 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry kind="src" path="src/main/webapp"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.wst.jsdt.launching.JRE_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.wst.jsdt.launching.WebProject"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="hide" value="true"/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.wst.jsdt.launching.baseBrowserLibrary"/&gt;
+	&lt;classpathentry kind="output" path=""/&gt;
+&lt;/classpath&gt;

Added: branches/5.0/zkdemo/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zkdemo/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/5.0/zkdemo/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,13 @@
+#Tue Sep 21 10:29:35 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/5.0/zkdemo/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/5.0/zkdemo/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/5.0/zkdemo/.settings/org.eclipse.wst.common.component	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,34 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zkdemo"&gt;
+        &lt;wb-resource deploy-path="/WEB-INF/classes" source-path="/src/main/resources"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/main/webapp"/&gt;
+        &lt;wb-resource deploy-path="/WEB-INF/classes" source-path="/src"/&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zk/zk"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zcommon/zcommon"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zweb/zweb"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zkplus/zkplus"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zul/zul"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zhtml/zhtml"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zkex/zkex"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zkmax/zkmax"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;property name="context-root" value="zkdemo"/&gt;
+        &lt;property name="java-output-path" value="/zkdemo/target/classes"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/5.0/zkdemo/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/5.0/zkdemo/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/5.0/zkdemo/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;fixed facet="wst.jsdt.web"/&gt;
+  &lt;installed facet="java" version="1.4"/&gt;
+  &lt;installed facet="jst.web" version="2.4"/&gt;
+  &lt;installed facet="wst.jsdt.web" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Added: branches/5.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.container
===================================================================
--- branches/5.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.container	                        (rev 0)
+++ branches/5.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.container	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1 @@
+org.eclipse.wst.jsdt.launching.baseBrowserLibrary
\ No newline at end of file

Added: branches/5.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.name
===================================================================
--- branches/5.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.name	                        (rev 0)
+++ branches/5.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.name	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1 @@
+Window
\ No newline at end of file

Added: branches/5.0/zkdemo/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/5.0/zkdemo/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/5.0/zkdemo/.settings/org.maven.ide.eclipse.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,9 @@
+#Thu Sep 16 15:49:38 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Added: branches/5.0/zkdemo/pom.xml
===================================================================
--- branches/5.0/zkdemo/pom.xml	                        (rev 0)
+++ branches/5.0/zkdemo/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,218 @@
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+	&lt;artifactId&gt;zkdemo&lt;/artifactId&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
+		&lt;zkel.version&gt;1.1.0&lt;/zkel.version&gt;
+		&lt;commons-lang.version&gt;2.4&lt;/commons-lang.version&gt;
+		&lt;bsh.version&gt;2.0b4&lt;/bsh.version&gt;
+		&lt;commons-fileupload.version&gt;1.2.1&lt;/commons-fileupload.version&gt;
+		&lt;commons-io.version&gt;1.3.1&lt;/commons-io.version&gt;
+		&lt;commons-logging.version&gt;1.1.1&lt;/commons-logging.version&gt;
+		&lt;servlet.version&gt;2.4&lt;/servlet.version&gt;
+		&lt;jetty.version&gt;6.1.16&lt;/jetty.version&gt;
+		&lt;jgroovy.version&gt;1.5.6&lt;/jgroovy.version&gt;
+		&lt;jruby.version&gt;1.1.2&lt;/jruby.version&gt;
+		&lt;jython.version&gt;2.2.1&lt;/jython.version&gt;
+		&lt;js.version&gt;1.7R1&lt;/js.version&gt;
+		&lt;jasperreports.version&gt;3.7.0&lt;/jasperreports.version&gt;
+		&lt;jfreechart.version&gt;1.0.13&lt;/jfreechart.version&gt;
+		&lt;filters.version&gt;2.0.235&lt;/filters.version&gt;
+		&lt;ckez.version&gt;3.3.2_50&lt;/ckez.version&gt;
+		&lt;timelinez.version&gt;2.3.1_50&lt;/timelinez.version&gt;
+		&lt;timeplotz.version&gt;1.1_50&lt;/timeplotz.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;packaging&gt;war&lt;/packaging&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zkdemo&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zkdemo&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;ZK PE Evaluation&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/zk/pe-eval&lt;/url" target="_new">http://mavensync.zkoss.org/zk/pe-eval&lt;/url</a>&gt;
+		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;ZK EE Evaluation&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/zk/ee-eval&lt;/url" target="_new">http://mavensync.zkoss.org/zk/ee-eval&lt;/url</a>&gt;
+		&lt;/repository&gt;
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
+			&lt;version&gt;${servlet.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-logging&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
+			&lt;version&gt;${commons-logging.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
+			&lt;version&gt;${commons-fileupload.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-io&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-io&lt;/artifactId&gt;
+			&lt;version&gt;${commons-io.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zk&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zkplus&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zul&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zhtml&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zkex&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zkmax&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge.el&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommons-el&lt;/artifactId&gt;
+			&lt;version&gt;${zkel.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-lang&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-lang&lt;/artifactId&gt;
+			&lt;version&gt;${commons-lang.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.beanshell&lt;/groupId&gt;
+			&lt;artifactId&gt;bsh&lt;/artifactId&gt;
+			&lt;version&gt;${bsh.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
+			&lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
+			&lt;version&gt;${jgroovy.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.jruby&lt;/groupId&gt;
+			&lt;artifactId&gt;jruby&lt;/artifactId&gt;
+			&lt;version&gt;${jruby.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.python&lt;/groupId&gt;
+			&lt;artifactId&gt;jython&lt;/artifactId&gt;
+			&lt;version&gt;${jython.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;rhino&lt;/groupId&gt;
+			&lt;artifactId&gt;js&lt;/artifactId&gt;
+			&lt;version&gt;${js.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;net.sf.jasperreports&lt;/groupId&gt;
+			&lt;artifactId&gt;jasperreports&lt;/artifactId&gt;
+			&lt;version&gt;${jasperreports.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;jfree&lt;/groupId&gt;
+			&lt;artifactId&gt;jfreechart&lt;/artifactId&gt;
+			&lt;version&gt;${jfreechart.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;com.jhlabs&lt;/groupId&gt;
+			&lt;artifactId&gt;filters&lt;/artifactId&gt;
+			&lt;version&gt;${filters.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge&lt;/groupId&gt;
+			&lt;artifactId&gt;ckez&lt;/artifactId&gt;
+			&lt;version&gt;${ckez.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge&lt;/groupId&gt;
+			&lt;artifactId&gt;timelinez&lt;/artifactId&gt;
+			&lt;version&gt;${timelinez.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge&lt;/groupId&gt;
+			&lt;artifactId&gt;timeplotz&lt;/artifactId&gt;
+			&lt;version&gt;${timeplotz.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+			&lt;plugin&gt;
+				&lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.1&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;warSourceExcludes&gt;${project.basedir}/src/archive&lt;/warSourceExcludes&gt;
+					&lt;webappDirectory&gt;${project.basedir}/src/archive&lt;/webappDirectory&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
+&lt;/project&gt;
\ No newline at end of file

Modified: branches/5.0/zkplus/.classpath
===================================================================
--- branches/5.0/zkplus/.classpath	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zkplus/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,7 +1,17 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
-	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="owner.project.facets" value="java"/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/5.0/zkplus/.project
===================================================================
--- branches/5.0/zkplus/.project	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zkplus/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -20,8 +20,15 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;

Modified: branches/5.0/zkplus/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zkplus/.settings/org.eclipse.jdt.core.prefs	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zkplus/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,9 +1,13 @@
-#Fri Sep 17 17:59:52 CST 2010
+#Tue Sep 21 10:48:22 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
-org.eclipse.jdt.core.compiler.compliance=1.4
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.4
+org.eclipse.jdt.core.compiler.source=1.6

Added: branches/5.0/zkplus/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/5.0/zkplus/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/5.0/zkplus/.settings/org.eclipse.wst.common.component	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zkplus"&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/archive"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/5.0/zkplus/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/5.0/zkplus/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/5.0/zkplus/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/5.0/zkplus/pom.xml
===================================================================
--- branches/5.0/zkplus/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zkplus/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zkplus&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 		&lt;org.springframework.version&gt;2.0.6&lt;/org.springframework.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;

Modified: branches/5.0/zul/.classpath
===================================================================
--- branches/5.0/zul/.classpath	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zul/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,7 +1,13 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
 	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/5.0/zul/.project
===================================================================
--- branches/5.0/zul/.project	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zul/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/5.0/zul/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zul/.settings/org.eclipse.jdt.core.prefs	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zul/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:44:20 CST 2010
+#Tue Sep 21 10:46:52 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/5.0/zul/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/5.0/zul/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/5.0/zul/.settings/org.eclipse.wst.common.component	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,4 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zul"/&gt;
+&lt;/project-modules&gt;

Added: branches/5.0/zul/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/5.0/zul/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/5.0/zul/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/5.0/zul/pom.xml
===================================================================
--- branches/5.0/zul/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zul/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zul&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;name&gt;ZK XUL Components&lt;/name&gt;

Modified: branches/5.0/zweb/.classpath
===================================================================
--- branches/5.0/zweb/.classpath	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zweb/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,7 +1,13 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
 	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/5.0/zweb/.project
===================================================================
--- branches/5.0/zweb/.project	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zweb/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/5.0/zweb/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zweb/.settings/org.eclipse.jdt.core.prefs	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zweb/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:48:26 CST 2010
+#Tue Sep 21 10:47:03 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/5.0/zweb/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/5.0/zweb/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/5.0/zweb/.settings/org.eclipse.wst.common.component	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zweb"&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/archive"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/5.0/zweb/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/5.0/zweb/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/5.0/zweb/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/5.0/zweb/pom.xml
===================================================================
--- branches/5.0/zweb/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/5.0/zweb/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zweb&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;name&gt;The ZKoss Web Library&lt;/name&gt;

Modified: branches/6.0/build.target.xml
===================================================================
--- branches/6.0/build.target.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/build.target.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -20,7 +20,7 @@
 		&lt;arg value="${bin.dir}/genprop"/&gt;
 		&lt;arg value="-x"/&gt;
 		&lt;arg value="${src.mesg.dir}"/&gt;
-		&lt;arg value="${codegen.dir}"/&gt;
+		&lt;arg value="${src.dir}"/&gt;
 	&lt;/exec&gt;
 &lt;/target&gt;
 

Added: branches/6.0/zcommon/.classpath
===================================================================
--- branches/6.0/zcommon/.classpath	                        (rev 0)
+++ branches/6.0/zcommon/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/6.0/zcommon/.project
===================================================================
--- branches/6.0/zcommon/.project	                        (rev 0)
+++ branches/6.0/zcommon/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,23 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zcommon&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/6.0/zcommon/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zcommon/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/6.0/zcommon/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:55:11 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.6

Added: branches/6.0/zcommon/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/6.0/zcommon/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/6.0/zcommon/.settings/org.maven.ide.eclipse.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:39:30 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Modified: branches/6.0/zcommon/pom.xml
===================================================================
--- branches/6.0/zcommon/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zcommon/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,34 +1,71 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-  &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;The ZKoss Common Library&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/common&lt;/url" target="_new">http://www.zkoss.org/common&lt;/url</a>&gt;
-  &lt;description&gt;The ZKoss common library&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zcommon&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zcommon&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
-      &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
-      &lt;version&gt;1.2.1&lt;/version&gt;
-    &lt;/dependency&gt;
-	&lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.zkforge.el&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommons-el&lt;/artifactId&gt;
-      &lt;version&gt;1.1.0&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+	&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;name&gt;The ZKoss Common Library&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/common&lt;/url" target="_new">http://www.zkoss.org/common&lt;/url</a>&gt;
+	&lt;description&gt;The ZKoss common library&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zcommon&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zcommon&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
+			&lt;version&gt;1.2.1&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge.el&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommons-el&lt;/artifactId&gt;
+			&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.beanshell&lt;/groupId&gt;
+			&lt;artifactId&gt;bsh&lt;/artifactId&gt;
+			&lt;version&gt;2.0b4&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
+			&lt;version&gt;2.4&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Modified: branches/6.0/zcommon/src/org/zkoss/lang/Generics.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/lang/Generics.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zcommon/src/org/zkoss/lang/Generics.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -37,6 +37,13 @@
 	public static final &lt;T&gt; Iterator&lt;T&gt; cast(Iterator it) {
 		return it;
 	}
+	/** Returns a type-safe generic list iterator of the given un-typed list iterator.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; ListIterator&lt;T&gt; cast(ListIterator it) {
+		return it;
+	}
 	/** Returns a type-safe generic enumeration of the given un-typed enumeration.
 	 * @since 6.0.0
 	 */
@@ -73,4 +80,11 @@
 	public static final &lt;K, V&gt; Map&lt;K, V&gt; cast(Map map) {
 		return map;
 	}
+	/** Returns a type-safe generic thread-local of the given un-typed thread-local.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; ThreadLocal&lt;T&gt; cast(ThreadLocal tl) {
+		return tl;
+	}
 }

Added: branches/6.0/zcommon/src/org/zkoss/mesg/MCommon.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/mesg/MCommon.java	                        (rev 0)
+++ branches/6.0/zcommon/src/org/zkoss/mesg/MCommon.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,38 @@
+// org.zkoss.mesg.MCommon.java
+//
+// Generated by genprop
+// DO NOT MODIFY IT MANUALLY. All modifications will be lost.
+//
+// jumperchen, Fri Sep 17 16:11:32 TST 2010
+// Copyright(C) 2001-2008 Potix Corporation. All Rights Reserved.
+
+package org.zkoss.mesg;
+
+public interface MCommon extends org.zkoss.mesg.MessageConst {
+	static final int MESSAGE_ID = Aide.register(MCommon.class, "msgcommon");
+	static final int EMPTY_NOT_ALLOWED = 0x1000 + MESSAGE_ID;
+	static final int REQUIRED = 0x1001 + MESSAGE_ID;
+	static final int ILLEGAL_CHAR = 0x1002 + MESSAGE_ID;
+	static final int MESSAGE_CODE_NOT_FOUND = 0x1003 + MESSAGE_ID;
+	static final int UNKNOWN_EXCEPTION = 0x1006 + MESSAGE_ID;
+	static final int NOT_FOUND = 0x100a + MESSAGE_ID;
+	static final int FILE_NOT_FOUND = 0x1200 + MESSAGE_ID;
+	static final int FILE_READ_FAILED = 0x1201 + MESSAGE_ID;
+	static final int FILE_WRITE_FAILED = 0x1202 + MESSAGE_ID;
+	static final int FILE_REMOVE_FAILED = 0x1203 + MESSAGE_ID;
+	static final int FILE_OPENING = 0x1204 + MESSAGE_ID;
+	static final int FILE_LOADED = 0x1205 + MESSAGE_ID;
+	static final int FILE_NOT_FOUND_IGNORED = 0x1206 + MESSAGE_ID;
+	static final int FILE_DUPLICATE = 0x1207 + MESSAGE_ID;
+	static final int NOT_A_FILE = 0x1208 + MESSAGE_ID;
+	static final int FAILED_TO_LOAD = 0x1300 + MESSAGE_ID;
+	static final int SERVICE_INIT_OK = 0x1600 + MESSAGE_ID;
+	static final int SERVICE_STOP_OK = 0x1601 + MESSAGE_ID;
+	static final int SERVICE_INIT_TWICE_NOT_ALLOWED = 0x1603 + MESSAGE_ID;
+	static final int CLASS_NOT_COMPATIABLE = 0x1800 + MESSAGE_ID;
+	static final int XML_ELEMENT_REQUIRED = 0x2400 + MESSAGE_ID;
+	static final int XML_ATTRIBUTE_REQUIRED = 0x2404 + MESSAGE_ID;
+	static final int QUOTE_UNMATCHED = 0x2800 + MESSAGE_ID;
+	static final int UNEXPECTED_CHARACTER = 0x2801 + MESSAGE_ID;
+	static final int EXPECTING_CHARACTER = 0x2802 + MESSAGE_ID;
+}

Modified: branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -314,7 +314,7 @@
 	 * @since 6.0.0
 	 */
 	@SuppressWarnings("unchecked")
-	public static final &lt;T&gt; T[] toArray(Collection&lt;T&gt; col, T[] dst, int from, int to) {
+	public static final &lt;T&gt; T[] toArray(Collection&lt;? extends T&gt; col, T[] dst, int from, int to) {
 		int sz = col.size();
 		if (to &gt; sz) to = sz;
 		if (from &lt; 0) from = 0;
@@ -327,7 +327,7 @@
 			dst = (T[])Array.newInstance(dst.getClass().getComponentType(), newLength);
 
 		int i = 0, j = 0;
-		for (Iterator&lt;T&gt; it = col.iterator(); it.hasNext() &amp;&amp; i &lt; dst.length;) {
+		for (Iterator&lt;? extends T&gt; it = col.iterator(); it.hasNext() &amp;&amp; i &lt; dst.length;) {
 			if (j++ &lt; from) {
 				it.next();
 				continue;

Added: branches/6.0/zhtml/.classpath
===================================================================
--- branches/6.0/zhtml/.classpath	                        (rev 0)
+++ branches/6.0/zhtml/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/6.0/zhtml/.project
===================================================================
--- branches/6.0/zhtml/.project	                        (rev 0)
+++ branches/6.0/zhtml/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,23 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zhtml&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/6.0/zhtml/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zhtml/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/6.0/zhtml/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:53:37 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.6

Added: branches/6.0/zhtml/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/6.0/zhtml/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/6.0/zhtml/.settings/org.maven.ide.eclipse.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:39:30 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Modified: branches/6.0/zhtml/pom.xml
===================================================================
--- branches/6.0/zhtml/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zhtml/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,39 +1,100 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-  &lt;artifactId&gt;zhtml&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;ZK XHTML Components&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/zhtml&lt;/url" target="_new">http://www.zkoss.org/zhtml&lt;/url</a>&gt;
-  &lt;description&gt;ZK XHTML components&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zhtml&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zhtml&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zweb&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-      &lt;artifactId&gt;zk&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+	&lt;artifactId&gt;zhtml&lt;/artifactId&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;name&gt;ZK XHTML Components&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/zhtml&lt;/url" target="_new">http://www.zkoss.org/zhtml&lt;/url</a>&gt;
+	&lt;description&gt;ZK XHTML components&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zhtml&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zhtml&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zk&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zul&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
+			&lt;version&gt;1.2.1&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Modified: branches/6.0/zhtml/src/org/zkoss/zhtml/impl/AbstractTag.java
===================================================================
--- branches/6.0/zhtml/src/org/zkoss/zhtml/impl/AbstractTag.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zhtml/src/org/zkoss/zhtml/impl/AbstractTag.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -62,7 +62,7 @@
 
 	/** The tag name. */
 	protected String _tagnm;
-	private Map _props;
+	private Map&lt;String, Object&gt; _props;
 
 	protected AbstractTag(String tagname) {
 		if (tagname == null || tagname.length() == 0)
@@ -167,7 +167,7 @@
 			if (_props != null) _props.remove(name);
 		} else {
 			if (_props == null)
-				_props = new LinkedHashMap();
+				_props = new LinkedHashMap&lt;String, Object&gt;();
 			_props.put(name, value);
 		}
 	}
@@ -319,7 +319,7 @@
 	public Object clone() {
 		final AbstractTag clone = (AbstractTag)super.clone();
 		if (clone._props != null)
-			clone._props = new LinkedHashMap(clone._props);
+			clone._props = new LinkedHashMap&lt;String, Object&gt;(clone._props);
 		return clone;
 	}
 

Modified: branches/6.0/zhtml/src/org/zkoss/zhtml/impl/TagRenderContext.java
===================================================================
--- branches/6.0/zhtml/src/org/zkoss/zhtml/impl/TagRenderContext.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zhtml/src/org/zkoss/zhtml/impl/TagRenderContext.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -41,7 +41,7 @@
 	/** Used to decide if the component, which {@link #renderBegin} is called against,
 	 * is not a first child.
 	 */
-	private final List _2ndChild = new LinkedList();
+	private final List&lt;Boolean&gt; _2ndChild = new LinkedList&lt;Boolean&gt;();
 
 	public TagRenderContext() {
 		HtmlPageRenders.setDirectContent(Executions.getCurrent(), true); //default: true

Added: branches/6.0/zk/.classpath
===================================================================
--- branches/6.0/zk/.classpath	                        (rev 0)
+++ branches/6.0/zk/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/6.0/zk/.project
===================================================================
--- branches/6.0/zk/.project	                        (rev 0)
+++ branches/6.0/zk/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,23 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zk&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/6.0/zk/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zk/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/6.0/zk/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:45:08 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.6

Added: branches/6.0/zk/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/6.0/zk/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/6.0/zk/.settings/org.maven.ide.eclipse.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:39:30 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Modified: branches/6.0/zk/pom.xml
===================================================================
--- branches/6.0/zk/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zk/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,34 +1,110 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-  &lt;artifactId&gt;zk&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;ZK Kernel&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/zk&lt;/url" target="_new">http://www.zkoss.org/zk&lt;/url</a>&gt;
-  &lt;description&gt;ZK Kernel&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zk&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zk&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zweb&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+	&lt;artifactId&gt;zk&lt;/artifactId&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;name&gt;ZK Kernel&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/zk&lt;/url" target="_new">http://www.zkoss.org/zk&lt;/url</a>&gt;
+	&lt;description&gt;ZK Kernel&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zk&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zk&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.portlet&lt;/groupId&gt;
+			&lt;artifactId&gt;portlet-api&lt;/artifactId&gt;
+			&lt;version&gt;2.0&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
+			&lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
+			&lt;version&gt;1.5.6&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.jruby&lt;/groupId&gt;
+			&lt;artifactId&gt;jruby&lt;/artifactId&gt;
+			&lt;version&gt;1.1.2&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.python&lt;/groupId&gt;
+			&lt;artifactId&gt;jython&lt;/artifactId&gt;
+			&lt;version&gt;2.2.1&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;rhino&lt;/groupId&gt;
+			&lt;artifactId&gt;js&lt;/artifactId&gt;
+			&lt;version&gt;1.7R1&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Added: branches/6.0/zk/src/org/zkoss/zk/mesg/MZk.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/mesg/MZk.java	                        (rev 0)
+++ branches/6.0/zk/src/org/zkoss/zk/mesg/MZk.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,23 @@
+// org.zkoss.zk.mesg.MZk.java
+//
+// Generated by genprop
+// DO NOT MODIFY IT MANUALLY. All modifications will be lost.
+//
+// jumperchen, Fri Sep 17 16:11:52 TST 2010
+// Copyright(C) 2001-2008 Potix Corporation. All Rights Reserved.
+
+package org.zkoss.zk.mesg;
+
+public interface MZk extends org.zkoss.mesg.MessageConst {
+	static final int MESSAGE_ID = Aide.register(MZk.class, "msgzk");
+	static final int PAGE_NOT_FOUND = 0x1000 + MESSAGE_ID;
+	static final int PORTLET_PAGE_REQUIRED = 0x1001 + MESSAGE_ID;
+	static final int PAGE_FAILED = 0x1002 + MESSAGE_ID;
+	static final int UPDATE_OBSOLETE_PAGE = 0x1010 + MESSAGE_ID;
+	static final int RESUME_FAILED = 0x1020 + MESSAGE_ID;
+	static final int ILLEGAL_REQUEST_COMPONENT_REQUIRED = 0x2000 + MESSAGE_ID;
+	static final int ILLEGAL_REQUEST_WRONG_DATA = 0x2001 + MESSAGE_ID;
+	static final int NOT_FOUND = 0x3000 + MESSAGE_ID;
+	static final int TOO_MANY_SUSPENDED = 0x3100 + MESSAGE_ID;
+	static final int TOO_MANY_REQUESTS = 0x3101 + MESSAGE_ID;
+}

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1755,7 +1755,7 @@
 	protected void redrawChildren(Writer out) throws IOException {
 		final Object xc = getExtraCtrl();
 		if (xc instanceof Cropper) {
-			final Set&lt;Component&gt; crop = ((Cropper)xc).getAvailableAtClient();
+			final Set&lt;? extends Component&gt; crop = ((Cropper)xc).getAvailableAtClient();
 			if (crop != null) {
 				for (Component c: crop)
 					if (c.getParent() == this)

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Components.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Components.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Components.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -92,7 +92,7 @@
 	 * some replicated item in the list.
 	 * @see #sort(List, int, int, Comparator)
 	 */
-	public static void sort(List&lt;Component&gt; list, Comparator&lt;? super Component&gt; cpr) {
+	public static void sort(List&lt;? extends Component&gt; list, Comparator&lt;? super Component&gt; cpr) {
 		sort(list, 0, list.size(), cpr);
 	}
 
@@ -140,11 +140,11 @@
 	 * @param cpr the comparator to determine the order of the list.
 	 * @since 3.5.0
 	 */
-	public static void sort(List&lt;Component&gt; list, int from, int to, Comparator&lt;? super Component&gt; cpr) {
+	public static void sort(List&lt;? extends Component&gt; list, int from, int to, Comparator&lt;? super Component&gt; cpr) {
 		final Component ary[] = CollectionsX.toArray(list, new Component[0], from, to);
 		Arrays.sort(ary, cpr);
 
-		ListIterator&lt;Component&gt; it = list.listIterator(from);
+		ListIterator&lt;? extends Component&gt; it = list.listIterator(from);
 		int j = 0, k = to - from;
 		for (; it.hasNext() &amp;&amp; --k &gt;= 0; ++j) {
 			if (it.next() != ary[j]) {
@@ -163,8 +163,12 @@
 			it.remove();
 		}
 		for (; j &lt; ary.length; ++j)
-			list.add(from + j, ary[j]);
+			add(list, from + j, ary[j]);
 	}
+	@SuppressWarnings("unchecked")
+	private static void add(List list, int index, Object o) {
+		list.add(index, o);
+	}
 
 	/** Returns the root component of the specified one.
 	 * Notice that it could return &lt;code&gt;comp&lt;/code&gt;, if it is already

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/ext/render/Cropper.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/ext/render/Cropper.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/ext/render/Cropper.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -57,7 +57,7 @@
 	 * parents. It is useful if you want to implement multi-level cropping,
 	 * such as tree. Refer to {@link #getCropOwner}.
 	 */
-	public Set&lt;Component&gt; getAvailableAtClient();
+	public Set&lt;? extends Component&gt; getAvailableAtClient();
 	/** Returns the owner of the cropping scope.
 	 * In most cases, {@link #getAvailableAtClient} returns only the
 	 * available direct children of this compnent,

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -339,7 +339,7 @@
 		final Configuration config = desktop.getWebApp().getConfiguration();
 		_evtThdInits = config.newEventThreadInits(comp, event);
 		try {
-			int evtTimeWarn = config.getEventTimeWarning();
+			long evtTimeWarn = config.getEventTimeWarning();
 			long begt = 0;
 			if (evtTimeWarn &gt; 0) {
 				begt = System.currentTimeMillis();

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiVisualizer.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiVisualizer.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiVisualizer.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -384,8 +384,8 @@
 
 	/** Process {@link Cropper} by removing cropped invalidates and so on.
 	 */
-	private Map&lt;Component, Set&lt;Component&gt;&gt; doCrop() {
-		final Map&lt;Component, Set&lt;Component&gt;&gt; croppingInfos = new HashMap&lt;Component, Set&lt;Component&gt;&gt;();
+	private Map&lt;Component, Set&lt;? extends Component&gt;&gt; doCrop() {
+		final Map&lt;Component, Set&lt;? extends Component&gt;&gt; croppingInfos = new HashMap&lt;Component, Set&lt;? extends Component&gt;&gt;();
 		crop(_attached, croppingInfos, false);
 		crop(_smartUpdated.keySet(), croppingInfos, false);
 		if (_responses != null)
@@ -395,7 +395,7 @@
 	}
 	/** Crop attached and moved.
 	 */
-	private void crop(Set coll, Map&lt;Component, Set&lt;Component&gt;&gt; croppingInfos, boolean bResponse) {
+	private void crop(Set coll, Map&lt;Component, Set&lt;? extends Component&gt;&gt; croppingInfos, boolean bResponse) {
 		for (Iterator it = coll.iterator(); it.hasNext();) {
 			final Object o = it.next();
 			if (!(o instanceof Component))
@@ -409,7 +409,7 @@
 			}
 
 			for (Component p, c = comp; (p = c.getParent()) != null; c = p) {
-				final Set&lt;Component&gt; avail = getAvailableAtClient(p, croppingInfos);
+				final Set&lt;? extends Component&gt; avail = getAvailableAtClient(p, croppingInfos);
 				if (avail != null) {
 					if (!avail.contains(c)) {
 						it.remove();
@@ -423,13 +423,13 @@
 	}
 	/** Returns the available children, or null if no cropping.
 	 */
-	private static Set&lt;Component&gt; getAvailableAtClient(Component comp, Map&lt;Component, Set&lt;Component&gt;&gt; croppingInfos) {
+	private static Set&lt;? extends Component&gt; getAvailableAtClient(Component comp, Map&lt;Component, Set&lt;? extends Component&gt;&gt; croppingInfos) {
 		final Object xc = ((ComponentCtrl)comp).getExtraCtrl();
 		if (xc instanceof Cropper) {
 			//we don't need to check isCropper first since its component's job
 			//to ensure the consistency
 
-			Set&lt;Component&gt; crop = croppingInfos.get(comp);
+			Set&lt;? extends Component&gt; crop = croppingInfos.get(comp);
 			if (crop == EMPTY_CROP)
 				return null;
 			if (crop != null)
@@ -537,7 +537,7 @@
 		}
 
 		//1. process dead comonents, cropping and the removed page
-		final Map&lt;Component, Set&lt;Component&gt;&gt; croppingInfos;
+		final Map&lt;Component, Set&lt;? extends Component&gt;&gt; croppingInfos;
 		{
 			//1a. handle _detached to remove unncessary detach
 			doDetached();
@@ -740,7 +740,7 @@
 	 */
 	private static
 	void addResponsesForCreatedPerSiblings(List&lt;AuResponse&gt; responses, Set&lt;Component&gt; newsibs,
-	Map&lt;Component, Set&lt;Component&gt;&gt; croppingInfos) throws IOException {
+	Map&lt;Component, Set&lt;? extends Component&gt;&gt; croppingInfos) throws IOException {
 		final Component parent;
 		final Page page;
 		{
@@ -748,7 +748,7 @@
 			parent = comp.getParent();
 			page = comp.getPage();
 		}
-		Collection&lt;Component&gt; sibs;
+		Collection&lt;? extends Component&gt; sibs;
 		if (parent != null) {
 			sibs = getAvailableAtClient(parent, croppingInfos);
 			if (sibs == null) //no cropping

Modified: branches/6.0/zkdemo/src/archive/userguide/grid/advGrouping.zul
===================================================================
--- branches/6.0/zkdemo/src/archive/userguide/grid/advGrouping.zul	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zkdemo/src/archive/userguide/grid/advGrouping.zul	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,80 +1,54 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-
-&lt;!--
-advGrouping.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Tue Nov 18 11:12:22     2008, Created by jumperchen
-}}IS_NOTE
-
-Copyright (C) 2008 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;window id="demo" apply="org.zkoss.zkdemo.userguide.DemoWindowComposer"&gt;
-	&lt;html&gt;&lt;![CDATA[
-     	&lt;h4&gt;Grid Live Grouping&lt;/h4&gt;
-     ]]&gt;&lt;/html&gt;
-	&lt;span sclass="edition-field"&gt;
-		The Grouping function requires
-		&lt;a href="<a href="http://www.zkoss.org/download/zk.dsp" target="_new">http://www.zkoss.org/download/zk.dsp</a>" sclass="edition-field" label=" ZK PE or EE."/&gt;
-	&lt;/span&gt;
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+
+&lt;!--
+advGrouping.zul
+
+{{IS_NOTE
+	Purpose:
+		
+	Description:
+		
+	History:
+		Tue Nov 18 11:12:22     2008, Created by jumperchen
+}}IS_NOTE
+
+Copyright (C) 2008 Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+}}IS_RIGHT
+--&gt;
+&lt;window id="demo" apply="org.zkoss.zkdemo.userguide.DemoWindowComposer"&gt;
+	&lt;html&gt;&lt;![CDATA[
+     	&lt;h4&gt;Grid Live Grouping&lt;/h4&gt;
+     ]]&gt;&lt;/html&gt;
+	&lt;span sclass="edition-field"&gt;
+		The Grouping function requires
+		&lt;a href="<a href="http://www.zkoss.org/download/zk.dsp" target="_new">http://www.zkoss.org/download/zk.dsp</a>" sclass="edition-field" label=" ZK PE or EE."/&gt;
+	&lt;/span&gt;
     &lt;html&gt;&lt;![CDATA[
    		&lt;p&gt;Grid grouping supports "load on demend" feature via a GroupsModel interface. 
    		This feature will not load data into the grid until it is necessary.  &lt;a href="javascript:;" onclick="if (jq('#infos').is(':hidden')) {jq('#infos').slideDown();} else {jq('#infos').slideUp();}"&gt;More..&lt;/a&gt;&lt;/p&gt;
-   		&lt;p style="display:none;" id="infos"&gt;Scroll the following grid downwards and observe the values loaded dynamically.&lt;/p&gt;
-	]]&gt;&lt;/html&gt;
-	&lt;separator/&gt;
-	&lt;tabbox width="100%" tabscroll="false"&gt;
-		&lt;tabs&gt;
-			&lt;tab id="demoView" label="Demo"/&gt;
-			&lt;tab id="srcView" label="View Source"/&gt;
-		&lt;/tabs&gt;
-		&lt;tabpanels&gt;
-			&lt;tabpanel&gt;
-				&lt;window id="view"&gt;
-				&lt;/window&gt;
-			&lt;/tabpanel&gt;
-			
-			&lt;tabpanel&gt;
-				&lt;panel&gt;
-					&lt;panelchildren&gt;
-						&lt;textbox id="codeView" class="code" rows="20" width="95%"&gt;
-			&lt;attribute name="value"&gt;&lt;![CDATA[
+   		&lt;p style="display:none;" id="infos"&gt;Scroll the following grid downwards and observe the values loaded dynamically.&lt;/p&gt;
+	]]&gt;&lt;/html&gt;
+	&lt;separator/&gt;
+	&lt;tabbox width="100%" tabscroll="false"&gt;
+		&lt;tabs&gt;
+			&lt;tab id="demoView" label="Demo"/&gt;
+			&lt;tab id="srcView" label="View Source"/&gt;
+		&lt;/tabs&gt;
+		&lt;tabpanels&gt;
+			&lt;tabpanel&gt;
+				&lt;window id="view"&gt;
+				&lt;/window&gt;
+			&lt;/tabpanel&gt;
+			
+			&lt;tabpanel&gt;
+				&lt;panel&gt;
+					&lt;panelchildren&gt;
+						&lt;textbox id="codeView" class="code" rows="20" width="95%"&gt;
+			&lt;attribute name="value"&gt;&lt;![CDATA[
 &lt;zk&gt;
-	&lt;!-- Due to the security constraint, ZK demo site doesn't allow
-	zscript to declare a class. Instead we use a pre-compiled Java class.
-	You can uncomment the following and try it in your local server.
 	&lt;zscript&gt;
-	class LiveGroupRenderer implements RowRenderer{
-		public void render(Row row, java.lang.Object data) {
-			if(data instanceof String[]) {
-				String[] ary = (String[]) data;
-	            Div div = new Div();
-	            Image icon = new Image();
-	            icon.setStyle("padding: 0px 10px");
-	            icon.setSrc("/img/Centigrade-Widget-Icons/EnvelopeOpen-16x16.png");
-	            div.appendChild(icon);
-	            new Label(ary[0]).setParent(div);
-	            row.appendChild(div);
-	            new Label(ary[1]).setParent(row);
-	            new Label(ary[2]).setParent(row);
-	            new Label(ary[3]).setParent(row);
-			} else {
-				new Label(data.toString()).setParent(row);
-			}
-	        
-		}
-	}
-	LiveGroupRenderer renderer = new LiveGroupRenderer();
-	&lt;/zscript&gt;--&gt;
-	&lt;zscript&gt;
 	import org.zkoss.zkdemo.userguide.*;
 	LiveGroupRenderer renderer = new LiveGroupRenderer();
 	&lt;/zscript&gt;
@@ -146,16 +120,16 @@
 	     &lt;/columns&gt;
 	&lt;/grid&gt;
 &lt;/zk&gt;
-
-			]]&gt;&lt;/attribute&gt;
-						&lt;/textbox&gt;
-					&lt;/panelchildren&gt;
+
+			]]&gt;&lt;/attribute&gt;
+						&lt;/textbox&gt;
+					&lt;/panelchildren&gt;
 					&lt;toolbar mold="panel"&gt;
-						&lt;button id="tryBtn" label="Try me!"/&gt;
-						&lt;button id="reloadBtn" label="Reload"/&gt;
-					&lt;/toolbar&gt;
-				&lt;/panel&gt;
-			&lt;/tabpanel&gt;
-		&lt;/tabpanels&gt;
-	&lt;/tabbox&gt;
-&lt;/window&gt;
+						&lt;button id="tryBtn" label="Try me!"/&gt;
+						&lt;button id="reloadBtn" label="Reload"/&gt;
+					&lt;/toolbar&gt;
+				&lt;/panel&gt;
+			&lt;/tabpanel&gt;
+		&lt;/tabpanels&gt;
+	&lt;/tabbox&gt;
+&lt;/window&gt;

Modified: branches/6.0/zkdemo/src/archive/userguide/grid/detail.zul
===================================================================
--- branches/6.0/zkdemo/src/archive/userguide/grid/detail.zul	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zkdemo/src/archive/userguide/grid/detail.zul	2010-09-21 05:43:41 UTC (rev 14281)
@@ -58,24 +58,7 @@
 	color: #0E3A99;
 }
 &lt;/style&gt;
-&lt;!-- Due to the security constraint, ZK demo site doesn't allow
 &lt;zscript&gt;
-class Comp implements Comparator {
-	private boolean _asc;
-	public Comp(boolean asc) {
-		_asc = asc;
-	}
-	public int compare(Object o1, Object o2) {
-		String s1 = o1.getChildren().get(1).getValue(),
-			s2 = o2.getChildren().get(1).getValue();
-		int v = s1.compareTo(s2);
-		return _asc ? v: -v;
-	}
-}
-Comp asc = new Comp(true), dsc = new Comp(false);
-&lt;/zscript&gt;
---&gt;
-&lt;zscript&gt;
 import org.zkoss.zkdemo.userguide.*;
 Comparator asc = new RowDetailComparator(true),
 	dsc = new RowDetailComparator(false);

Modified: branches/6.0/zkdemo/src/archive/userguide/grid/grouping.zul
===================================================================
--- branches/6.0/zkdemo/src/archive/userguide/grid/grouping.zul	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zkdemo/src/archive/userguide/grid/grouping.zul	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,32 +1,32 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-
-&lt;!--
-grouping.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Mon Nov 17 16:24:41     2008, Created by jumperchen
-}}IS_NOTE
-
-Copyright (C) 2008 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+
+&lt;!--
+grouping.zul
+
+{{IS_NOTE
+	Purpose:
+		
+	Description:
+		
+	History:
+		Mon Nov 17 16:24:41     2008, Created by jumperchen
+}}IS_NOTE
+
+Copyright (C) 2008 Potix Corporation. All Rights Reserved.
+
+{{IS_RIGHT
+}}IS_RIGHT
+--&gt;
 &lt;window id="demo" apply="org.zkoss.zkdemo.userguide.DemoWindowComposer"&gt;
 	&lt;html&gt;&lt;![CDATA[
-		&lt;h4&gt;Grid with grouping control&lt;/h4&gt;
-	]]&gt;&lt;/html&gt;
-	&lt;span sclass="edition-field"&gt;
-		The Grouping function requires
-		&lt;a href="<a href="http://www.zkoss.org/download/zk.dsp" target="_new">http://www.zkoss.org/download/zk.dsp</a>" sclass="edition-field" label=" ZK PE or EE."/&gt;
-	&lt;/span&gt;
+		&lt;h4&gt;Grid with grouping control&lt;/h4&gt;
+	]]&gt;&lt;/html&gt;
+	&lt;span sclass="edition-field"&gt;
+		The Grouping function requires
+		&lt;a href="<a href="http://www.zkoss.org/download/zk.dsp" target="_new">http://www.zkoss.org/download/zk.dsp</a>" sclass="edition-field" label=" ZK PE or EE."/&gt;
+	&lt;/span&gt;
 	&lt;html&gt;&lt;![CDATA[
-		&lt;p&gt;Grid allows single level grouping. &lt;/p&gt; &lt;a href="javascript:;" onclick="if (jq('#infos').is(':hidden')) {jq('#infos').slideDown();} else {jq('#infos').slideUp();}"&gt;More..&lt;/a&gt;
+		&lt;p&gt;Grid allows single level grouping. &lt;/p&gt; &lt;a href="javascript:;" onclick="if (jq('#infos').is(':hidden')) {jq('#infos').slideDown();} else {jq('#infos').slideUp();}"&gt;More..&lt;/a&gt;
 		&lt;p style="display:none" id="infos"&gt;Each group are declared from its following row till the beginning of next group. Group can be invisible without labels. Each visible group can be collapsed by clicking on the small expansion button next to its label.&lt;/p&gt;
 	]]&gt;&lt;/html&gt;
 	&lt;separator/&gt;
@@ -47,26 +47,7 @@
 						&lt;textbox id="codeView" class="code" rows="20" width="95%"&gt;
 			&lt;attribute name="value"&gt;&lt;![CDATA[
 &lt;zk&gt;
-&lt;!-- Due to the security constraint, ZK demo site doesn't allow
-	zscript to declare a class. Instead we use a pre-compiled Java class.
-	You can uncomment the following and try it in your local server.
 	&lt;zscript&gt;
-	class Comp implements Comparator {
-		private boolean _asc;
-		public Comp(boolean asc) {
-			_asc = asc;
-		}
-		public int compare(Object o1, Object o2) {
-			String s1 = o1.getChildren().get(0).getValue(),
-				s2 = o2.getChildren().get(0).getValue();
-			int v = s1.compareTo(s2);
-			return _asc ? v: -v;
-		}
-	}
-	Comp asc = new Comp(true), dsc = new Comp(false);
-	&lt;/zscript&gt;
---&gt;
-	&lt;zscript&gt;
 	import org.zkoss.zkdemo.userguide.*;
 	Comparator asc = new RowLabelComparator(true),
 		dsc = new RowLabelComparator(false);
@@ -134,5 +115,5 @@
 			&lt;/tabpanel&gt;
 		&lt;/tabpanels&gt;
 	&lt;/tabbox&gt;
-&lt;/window&gt;
+&lt;/window&gt;
 

Added: branches/6.0/zkplus/.classpath
===================================================================
--- branches/6.0/zkplus/.classpath	                        (rev 0)
+++ branches/6.0/zkplus/.classpath	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/6.0/zkplus/.project
===================================================================
--- branches/6.0/zkplus/.project	                        (rev 0)
+++ branches/6.0/zkplus/.project	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,29 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zkplus&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/6.0/zkplus/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zkplus/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/6.0/zkplus/.settings/org.eclipse.jdt.core.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,9 @@
+#Fri Sep 17 17:59:52 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.compliance=1.4
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/6.0/zkplus/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/6.0/zkplus/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/6.0/zkplus/.settings/org.maven.ide.eclipse.prefs	2010-09-21 05:43:41 UTC (rev 14281)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:39:31 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Modified: branches/6.0/zkplus/pom.xml
===================================================================
--- branches/6.0/zkplus/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zkplus/pom.xml	2010-09-21 05:43:41 UTC (rev 14281)
@@ -1,39 +1,211 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-  &lt;artifactId&gt;zkplus&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;The ZK Plus Utilities&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/zkplus&lt;/url" target="_new">http://www.zkoss.org/zkplus&lt;/url</a>&gt;
-  &lt;description&gt;The ZK plus utilities&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zkplus&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zkplus&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zweb&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-      &lt;artifactId&gt;zk&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+	&lt;artifactId&gt;zkplus&lt;/artifactId&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;org.springframework.version&gt;2.0.6&lt;/org.springframework.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;name&gt;The ZK Plus Utilities&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/zkplus&lt;/url" target="_new">http://www.zkoss.org/zkplus&lt;/url</a>&gt;
+	&lt;description&gt;The ZK plus utilities&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zkplus&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zkplus&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;maven seasar org&lt;/id&gt;
+			&lt;url&gt;<a href="http://maven.seasar.org/maven2&lt;/url" target="_new">http://maven.seasar.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;jboss-repo&lt;/id&gt;
+			&lt;url&gt;<a href="http://repository.jboss.com/maven2&lt;/url" target="_new">http://repository.jboss.com/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zk&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zul&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;dom4j&lt;/groupId&gt;
+			&lt;artifactId&gt;dom4j&lt;/artifactId&gt;
+			&lt;version&gt;1.6&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;com.google.collections&lt;/groupId&gt;
+			&lt;artifactId&gt;google-collections&lt;/artifactId&gt;
+			&lt;version&gt;1.0-rc3&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javassist&lt;/groupId&gt;
+			&lt;artifactId&gt;javassist&lt;/artifactId&gt;
+			&lt;version&gt;3.8.0.GA&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.inject&lt;/groupId&gt;
+			&lt;artifactId&gt;javax.inject&lt;/artifactId&gt;
+			&lt;version&gt;1&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.jboss.weld.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;weld-servlet&lt;/artifactId&gt;
+			&lt;version&gt;1.0.1-Final&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.enterprise&lt;/groupId&gt;
+			&lt;artifactId&gt;cdi-api&lt;/artifactId&gt;
+			&lt;version&gt;1.0-CR1&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-core&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-aop&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-context&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-web&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.seasar.container&lt;/groupId&gt;
+			&lt;artifactId&gt;s2-framework&lt;/artifactId&gt;
+			&lt;version&gt;2.4.43&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.acegisecurity&lt;/groupId&gt;
+			&lt;artifactId&gt;acegi-security&lt;/artifactId&gt;
+			&lt;version&gt;1.0.3&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
+			&lt;version&gt;2.5&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.el&lt;/groupId&gt;
+			&lt;artifactId&gt;el-api&lt;/artifactId&gt;
+			&lt;version&gt;2.2&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.persistence&lt;/groupId&gt;
+			&lt;artifactId&gt;persistence-api&lt;/artifactId&gt;
+			&lt;version&gt;1.0&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.hibernate&lt;/groupId&gt;
+			&lt;artifactId&gt;hibernate&lt;/artifactId&gt;
+			&lt;version&gt;3.2.0.ga&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.hibernate&lt;/groupId&gt;
+			&lt;artifactId&gt;hibernate-annotations&lt;/artifactId&gt;
+			&lt;version&gt;3.2.0.ga&lt;/version&gt;
+			&lt;exclusions&gt;
+				&lt;exclusion&gt;
+					&lt;groupId&gt;javax.persistence&lt;/groupId&gt;
+					&lt;artifactId&gt;ejb&lt;/artifactId&gt;
+				&lt;/exclusion&gt;
+			&lt;/exclusions&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.transaction&lt;/groupId&gt;
+			&lt;artifactId&gt;jta&lt;/artifactId&gt;
+			&lt;version&gt;1.1&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java	2010-09-20 05:38:20 UTC (rev 14280)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java	2010-09-21 05:43:41 UTC (rev 14281)
@@ -44,6 +44,7 @@
 import java.util.Map;
 import java.util.HashMap;
 import java.util.List;
+import java.util.LinkedList;
 import java.util.ArrayList;
 import java.util.Iterator;
 
@@ -109,10 +110,12 @@
 		}
 		
 		url = url.substring(j+1);
-		List list = (List) CollectionsX.parse(new ArrayList(), url, '&amp;');
-		Map args = new HashMap();
-		for(final Iterator it = list.iterator(); it.hasNext();) {
-			List pair = (List) CollectionsX.parse(new ArrayList(2), (String) it.next(), '=');
+		List&lt;String&gt; list = new LinkedList&lt;String&gt;();
+		CollectionsX.parse(list, url, '&amp;');
+		Map&lt;String, String&gt; args = new HashMap&lt;String, String&gt;();
+		for(String s: list) {
+			List&lt;String&gt; pair = new ArrayList&lt;String&gt;(2);
+			CollectionsX.parse(pair, s, '=');

@@ Diff output truncated at 100000 characters. @@

This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26332512">[zk1-subversion-log] SF.net SVN: zk1:[14287] branches</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-28 06:09</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14287
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14287&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14287&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-28 06:08:56 +0000 (Tue, 28 Sep 2010)

Log Message:
-----------
Tue 09/28/2010

Modified Paths:
--------------
    branches/5.0/zk/src/archive/web/js/zk/fmt/zk.wpd
    branches/5.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
    branches/5.0/zkdoc/release-note
    branches/5.0/zul/src/archive/web/js/zul/inp/Slider.js
    branches/6.0/dist/lib/ckez.jar
    branches/6.0/zcommon/.classpath
    branches/6.0/zcommon/.project
    branches/6.0/zcommon/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zcommon/pom.xml
    branches/6.0/zhtml/.classpath
    branches/6.0/zhtml/.project
    branches/6.0/zhtml/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zhtml/pom.xml
    branches/6.0/zk/.classpath
    branches/6.0/zk/.project
    branches/6.0/zk/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zk/pom.xml
    branches/6.0/zk/src/archive/web/js/zk/zk.js
    branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/ComponentsCtrl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/HtmlPageRenders.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageConfig.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java
    branches/6.0/zkplus/.classpath
    branches/6.0/zkplus/.project
    branches/6.0/zkplus/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zkplus/pom.xml
    branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/AcegiSecurityContextListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAccessDeniedHandler.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationEntryPoint.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationProcessingFilter.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkEventExceptionFilter.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkTokenBasedRememberMeServices.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/CDIELContext.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/CDIUtil.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/DelegatingVariableResolver.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionContextListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionFactoryListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateUtil.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/OpenSessionInViewListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/jpa/JpaUtil.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/jpa/OpenEntityManagerInViewListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/liferay/JQueryRenderCachedPatch.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/seasar/DelegatingVariableResolver.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/spring/DelegatingVariableResolver.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/spring/SpringTransactionSynchronizationListener.java
    branches/6.0/zkplus/src/org/zkoss/zkplus/spring/SpringUtil.java
    branches/6.0/zul/.classpath
    branches/6.0/zul/.project
    branches/6.0/zul/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zul/pom.xml
    branches/6.0/zul/src/archive/web/js/zul/db/Datebox.js
    branches/6.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp
    branches/6.0/zul/src/archive/web/js/zul/db/mold/calendar.js
    branches/6.0/zul/src/archive/web/js/zul/inp/css/combo.css.dsp
    branches/6.0/zul/src/archive/web/js/zul/inp/css/input.css.dsp
    branches/6.0/zul/src/archive/web/js/zul/menu/Menu.js
    branches/6.0/zul/src/archive/web/js/zul/tab/mold/tab.js
    branches/6.0/zul/src/archive/web/js/zul/wnd/css/panel.css.dsp
    branches/6.0/zul/src/archive/web/js/zul/wnd/css/window.css.dsp
    branches/6.0/zul/src/org/zkoss/zul/Listbox.java
    branches/6.0/zul/src/org/zkoss/zul/RowComparator.java
    branches/6.0/zweb/.classpath
    branches/6.0/zweb/.project
    branches/6.0/zweb/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zweb/pom.xml
    branches/6.0/zweb/src/org/zkoss/web/servlet/Servlets.java

Added Paths:
-----------
    branches/6.0/zcommon/.settings/org.eclipse.wst.common.component
    branches/6.0/zcommon/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/6.0/zhtml/.settings/org.eclipse.wst.common.component
    branches/6.0/zhtml/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/6.0/zk/.settings/org.eclipse.wst.common.component
    branches/6.0/zk/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/6.0/zkdemo/.classpath
    branches/6.0/zkdemo/.project
    branches/6.0/zkdemo/.settings/
    branches/6.0/zkdemo/.settings/.jsdtscope
    branches/6.0/zkdemo/.settings/org.eclipse.jdt.core.prefs
    branches/6.0/zkdemo/.settings/org.eclipse.wst.common.component
    branches/6.0/zkdemo/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/6.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.container
    branches/6.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.name
    branches/6.0/zkdemo/.settings/org.maven.ide.eclipse.prefs
    branches/6.0/zkdemo/pom.xml
    branches/6.0/zkplus/.settings/org.eclipse.wst.common.component
    branches/6.0/zkplus/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/6.0/zul/.settings/org.eclipse.wst.common.component
    branches/6.0/zul/.settings/org.eclipse.wst.common.project.facet.core.xml
    branches/6.0/zweb/.settings/org.eclipse.wst.common.component
    branches/6.0/zweb/.settings/org.eclipse.wst.common.project.facet.core.xml

Modified: branches/5.0/zk/src/archive/web/js/zk/fmt/zk.wpd
===================================================================
--- branches/5.0/zk/src/archive/web/js/zk/fmt/zk.wpd	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/5.0/zk/src/archive/web/js/zk/fmt/zk.wpd	2010-09-28 06:08:56 UTC (rev 14287)
@@ -11,7 +11,7 @@
 Copyright (C) 2009 Potix Corporation. All Rights Reserved.
 --&gt;
 
-&lt;package name="zk.fmt" language="xul/html"&gt;
+&lt;package name="zk.fmt" language="xul/html" depends="zul.lang"&gt;
 	&lt;script src="numfmt.js"/&gt;
 	&lt;script src="msgfmt.js"/&gt;
 &lt;/package&gt;

Modified: branches/5.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/5.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -156,10 +156,10 @@
 		}
 
 		//ZK 5: extension defined in init-param has the higher priority
-		for (int j = 0;;) {
-			param = config.getInitParameter("extension" + j++);
+		for (int j = 0;;++j) {
+			param = config.getInitParameter("extension" + j);
 			if (param == null) {
-				param = config.getInitParameter("processor" + j++); //backward compatible
+				param = config.getInitParameter("processor" + j); //backward compatible
 				if (param == null) break;
 			}
 			final int k = param.indexOf('=');

Modified: branches/5.0/zkdoc/release-note
===================================================================
--- branches/5.0/zkdoc/release-note	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/5.0/zkdoc/release-note	2010-09-28 06:08:56 UTC (rev 14287)
@@ -4,12 +4,15 @@
   3067232: A way to access components in 3rd framework (e.g. JSF 2)
   3061671: Databinding foreach keep cloned cmp's id when in spaceowner
   3061676: Autodrop menubar shall be closed automatically when move out
+  3076418: XmlMacroComponent supports autowire
 
 * Bugs
   3057902: zk bug for window showbusy
   3061764: Opera only. Cannot sizing a column with width
   3061765: Unexpected horizontal scrollbar when sizing listheader
   3064997: Listen onPiggyback event threw NoSuchElementException
+  3074492: Slider default  curpos not work
+  3076840: DHtmlUpdateServlet's init mishandles processor params
 
 * Upgrade Notes
   + org.zkoss.zul.ArrayGroupsModel is deprecated and renamed to GroupsModelArray

Modified: branches/5.0/zul/src/archive/web/js/zul/inp/Slider.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/inp/Slider.js	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/5.0/zul/src/archive/web/js/zul/inp/Slider.js	2010-09-28 06:08:56 UTC (rev 14287)
@@ -347,6 +347,7 @@
 		
 		zWatch.listen({onSize: this, onShow: this});
 		this.updateFormData(this._curpos);
+		this._fixPos();
 	},
 	unbind_: function() {
 		this.efield = null;

Modified: branches/6.0/dist/lib/ckez.jar
===================================================================
(Binary files differ)

Modified: branches/6.0/zcommon/.classpath
===================================================================
--- branches/6.0/zcommon/.classpath	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zcommon/.classpath	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,7 +1,13 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
 	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/6.0/zcommon/.project
===================================================================
--- branches/6.0/zcommon/.project	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zcommon/.project	2010-09-28 06:08:56 UTC (rev 14287)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/6.0/zcommon/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zcommon/.settings/org.eclipse.jdt.core.prefs	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zcommon/.settings/org.eclipse.jdt.core.prefs	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:55:11 CST 2010
+#Tue Sep 21 10:44:37 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/6.0/zcommon/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/6.0/zcommon/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/6.0/zcommon/.settings/org.eclipse.wst.common.component	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,4 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zcommon"/&gt;
+&lt;/project-modules&gt;

Added: branches/6.0/zcommon/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/6.0/zcommon/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/6.0/zcommon/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/6.0/zcommon/pom.xml
===================================================================
--- branches/6.0/zcommon/pom.xml	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zcommon/pom.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;name&gt;The ZKoss Common Library&lt;/name&gt;

Modified: branches/6.0/zhtml/.classpath
===================================================================
--- branches/6.0/zhtml/.classpath	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zhtml/.classpath	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,7 +1,13 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
 	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/6.0/zhtml/.project
===================================================================
--- branches/6.0/zhtml/.project	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zhtml/.project	2010-09-28 06:08:56 UTC (rev 14287)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/6.0/zhtml/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zhtml/.settings/org.eclipse.jdt.core.prefs	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zhtml/.settings/org.eclipse.jdt.core.prefs	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:53:37 CST 2010
+#Tue Sep 21 10:44:56 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/6.0/zhtml/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/6.0/zhtml/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/6.0/zhtml/.settings/org.eclipse.wst.common.component	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zhtml"&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/archive"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/6.0/zhtml/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/6.0/zhtml/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/6.0/zhtml/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/6.0/zhtml/pom.xml
===================================================================
--- branches/6.0/zhtml/pom.xml	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zhtml/pom.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zhtml&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;name&gt;ZK XHTML Components&lt;/name&gt;

Modified: branches/6.0/zk/.classpath
===================================================================
--- branches/6.0/zk/.classpath	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/.classpath	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,7 +1,17 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
-	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="owner.project.facets" value="java"/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/6.0/zk/.project
===================================================================
--- branches/6.0/zk/.project	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/.project	2010-09-28 06:08:56 UTC (rev 14287)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/6.0/zk/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zk/.settings/org.eclipse.jdt.core.prefs	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/.settings/org.eclipse.jdt.core.prefs	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:45:08 CST 2010
+#Tue Sep 21 10:45:15 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/6.0/zk/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/6.0/zk/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/6.0/zk/.settings/org.eclipse.wst.common.component	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zk"&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/archive"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/6.0/zk/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/6.0/zk/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/6.0/zk/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/6.0/zk/pom.xml
===================================================================
--- branches/6.0/zk/pom.xml	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/pom.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -6,7 +6,7 @@
 	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
 	&lt;artifactId&gt;zk&lt;/artifactId&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;

Modified: branches/6.0/zk/src/archive/web/js/zk/zk.js
===================================================================
--- branches/6.0/zk/src/archive/web/js/zk/zk.js	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/archive/web/js/zk/zk.js	2010-09-28 06:08:56 UTC (rev 14287)
@@ -274,6 +274,11 @@
 	 * @type boolean
 	 */
 	//ie8c: false,
+	/** Whether it is Internet Exploer 9 or later.
+	 * @type boolean
+	 * @since 5.0.5
+	 */
+	//ie9: false,
 	/** Whether it is Gecko-based browsers, such as Firefox.
 	 * @type boolean
 	 */
@@ -1081,42 +1086,50 @@
 
 //zk.agent//
 (function () {
-	zk.agent = navigator.userAgent.toLowerCase();
-	zk.safari = zk.agent.indexOf("safari") &gt;= 0;
-	zk.opera = zk.agent.indexOf("opera") &gt;= 0;
-	zk.gecko = zk.agent.indexOf("gecko/") &gt;= 0 &amp;&amp; !zk.safari &amp;&amp; !zk.opera;
-	zk.ios = zk.agent.indexOf("iphone") &gt;= 0 || zk.agent.indexOf("ipad") &gt;= 0;
-	zk.android = zk.agent.indexOf('android') &gt;= 0;
+	var agent = zk.agent = navigator.userAgent.toLowerCase();
+	zk.safari = agent.indexOf("safari") &gt;= 0;
+	zk.opera = agent.indexOf("opera") &gt;= 0;
+	zk.gecko = agent.indexOf("gecko/") &gt;= 0 &amp;&amp; !zk.safari &amp;&amp; !zk.opera;
+	zk.ios = agent.indexOf("iphone") &gt;= 0 || agent.indexOf("ipad") &gt;= 0;
+	zk.android = agent.indexOf('android') &gt;= 0;
 	zk.mobile = zk.ios || zk.android;
 	var bodycls;
 	if (zk.gecko) {
-		var j = zk.agent.indexOf("firefox/");
-		j = zk.parseInt(zk.agent.substring(j + 8));
-		zk.gecko3 = j &gt;= 3;
+		var j = agent.indexOf("firefox/");
+		j = zk.parseInt(agent.substring(j + 8));
+		zk.css3 = zk.gecko3 = j &gt;= 3;
 		zk.gecko2_ = !zk.gecko3;
-
 		bodycls = 'gecko gecko' + j;
 	} else if (zk.opera) {
 		bodycls = 'opera';
+		var j = agent.indexOf("version/"), v;
+		zk.css3 = j &gt;= 0
+			&amp;&amp; ((v = zk.parseInt(agent.substring(j += 8))) &gt; 10
+				|| (v == 10 &amp;&amp; (j = agent.indexOf('.', j)) &gt;= 0
+					&amp;&amp; zk.parseInt(agent.substring(j + 1)) &gt;= 5)); //10.5 or later
 	} else {
-		var j = zk.agent.indexOf("msie ");
+		var j = agent.indexOf("msie "), dm;
 		zk.ie = j &gt;= 0;
 		if (zk.ie) {
-			j = zk.parseInt(zk.agent.substring(j + 5));
+			j = zk.parseInt(agent.substring(j + 5));
 			zk.ie7 = j &gt;= 7; //ie7 or later
 			zk.ie8c = j &gt;= 8; //ie8 or later (including compatible)
-			zk.ie8 = j &gt;= 8 &amp;&amp; document.documentMode &gt;= 8; //ie8 or later
+			zk.ie8 = j &gt;= 8 &amp;&amp; (dm=document.documentMode) &gt;= 8; //ie8 or later
+			zk.css3 = zk.ie9 = j &gt;= 9 &amp;&amp; dm &gt;= 9; //ie9 or later
 			zk.ie6_ = !zk.ie7;
 			zk.ie7_ = zk.ie7 &amp;&amp; !zk.ie8;
+			zk.ie8_ = zk.ie8 &amp;&amp; !zk.ie9;
 			bodycls = 'ie ie' + j;
-		} else if (zk.safari)
-			bodycls = 'safari';
+		} else {
+			if (zk.safari)
+				bodycls = 'safari';
+			zk.css3 = true;
+		}
 	}
-	if (zk.air = zk.agent.indexOf("adobeair") &gt;= 0)
-		bodycls = 'air';
 
-	zk.css3 = !(zk.ie || zk.gecko2_ || zk.opera);
-	
+	if (zk.air = agent.indexOf("adobeair") &gt;= 0)
+		bodycls = (bodycls || '') + ' air';
+
 	if (bodycls)
 		jq(function () {
 			var n = document.body,

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1524,6 +1524,15 @@
 	protected void smartUpdate(String attr, Date value) {
 		smartUpdate(attr, (Object)value);
 	}
+	/** A special smart update to update a value to the given component.
+	 * &lt;p&gt;It is the same as
+	 * &lt;code&gt;smartUpdate(attr, comp != null ? comp.getUuid(): null)&lt;/code&gt;.
+	 * @since 6.0.0
+	 */
+	protected void smartUpdate(String attr, Component comp) {
+		smartUpdate(attr, comp != null ? comp.getUuid(): null);
+	}
+
 	/** A special smart update to update an event listener for the
 	 * peer widget.
 	 * By default, it assumes the peer widget has a method called

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -607,9 +607,9 @@
 			if (s != null) setStyle(s);
 		}
 
-		s = config.getHeaders(true);
+		s = config.getBeforeHeadTags();
 		if (s != null) _hdbfr = s;
-		s = config.getHeaders(false);
+		s = config.getAfterHeadTags();
 		if (s != null) _hdaft = s;
 		_hdres = config.getResponseHeaders();
 		if (_hdres.isEmpty()) _hdres = null;
@@ -638,12 +638,21 @@
 		return _ips != null;
 	}
 
-	public String getHeaders(boolean before) {
-		return before ? _hdbfr: _hdaft;
+	public String getBeforeHeadTags() {
+		return _hdbfr;
 	}
-	public String getHeaders() {
-		return _hdbfr + _hdaft;
+	public String getAfterHeadTags() {
+		return _hdaft;
 	}
+	public void addBeforeHeadTags(String tags) {
+		if (tags != null &amp;&amp; tags.length() &gt; 0)
+			_hdbfr += '\n' + tags;
+	}
+	public void addAfterHeadTags(String tags) {
+		if (tags != null &amp;&amp; tags.length() &gt; 0)
+			_hdaft += '\n' + tags;
+	}
+
 	public Collection&lt;Object[]&gt; getResponseHeaders() {
 		if (_hdres != null)
 			return _hdres;

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -392,8 +392,8 @@
 					public String getUuid() {return null;}
 					public String getTitle() {return null;}
 					public String getStyle() {return null;}
-					public String getHeaders(boolean before) {return null;}
-					public String getHeaders() {return null;}
+					public String getBeforeHeadTags() {return "";}
+					public String getAfterHeadTags() {return "";}
 					public Collection&lt;Object[]&gt; getResponseHeaders() {return Collections.emptyList();}
 				});
 				final Composer composer = config.getComposer(page);

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -342,6 +342,7 @@
 			&amp;&amp; _ldefByName.containsKey(namespace))
 				throw new UiException("Different language, "+name+", with the same namespace, "+namespace);
 
+			_ldefByName.put(namespace, this);
 			final LanguageDefinition old = _ldefByName.put(name, this);
 			if (old != null) {
 				final List&lt;LanguageDefinition&gt; ldefs = _ldefsByClient.get(deviceType);

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -460,20 +460,33 @@
 	public void addHeaderInfo(HeaderInfo header) {
 		addHeaderInfo(header, "meta".equals(header.getName()));
 	}
-	/** Converts the header definitions (added by {@link #addHeaderInfo}) to
-	 * HTML tags.
+	/** Returns the content that shall be generated inside the head element
+	 * and before ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * @param before whether to return the headers that shall be shown
-	 * before ZK's CSS/JS headers.
-	 * If true, only the headers that shall be shown before (such as meta)
-	 * are returned.
-	 * If true, only the headers that shall be shown after (such as link)
-	 * are returned.
-	 * @see #getHeaders(Page)
-	 * @since 3.6.1
+	 * &lt;p&gt;Since it is generated before ZK's default tags (such as CSS and JS),
+	 * it cannot override ZK's default behaviors.
+	 *
+	 * @see #getAfterHeadTags
+	 * @since 5.0.5
 	 */
-	public String getHeaders(Page page, boolean before) {
-		final List&lt;HeaderInfo&gt; defs = before ? _hdBfrDefs: _hdAftDefs;
+	public String getBeforeHeadTags(Page page) {
+		return getHeadTags(page, _hdBfrDefs);
+	}
+	/** Returns the content that shall be generated inside the head element
+	 * and after ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
+	 *
+	 * &lt;p&gt;Since it is generated after ZK's default tags (such as CSS and JS),
+	 * it could override ZK's default behaviors.
+	 *
+	 * @see #getBeforeHeadTags
+	 * @since 5.0.5
+	 */
+	public String getAfterHeadTags(Page page) {
+		return getHeadTags(page, _hdAftDefs);
+	}
+	private String getHeadTags(Page page, List&lt;HeaderInfo&gt; defs) {
 		if (defs == null)
 			return "";
 
@@ -484,14 +497,7 @@
 		}
 		return sb.toString();
 	}
-	/** Converts all header definitions (added by {@link #addHeaderInfo}) to
-	 * HTML tags, no matter that shall be shown before or after ZK's
-	 * CSS/JS headers.
-	 * To have better control, use {@link #getHeaders(Page,boolean)} instead.
-	 */
-	public String getHeaders(Page page) {
-		return getHeaders(page, true) + getHeaders(page, false);
-	}
+
 	/** Adds a forward definition ({@link ForwardInfo}).
 	 */
 	public void addForwardInfo(ForwardInfo forward) {
@@ -855,13 +861,13 @@
 				public String getUuid() {return null;}
 				public String getTitle() {return _title;}
 				public String getStyle() {return _style;}
-				public String getHeaders(boolean before) {
+				public String getBeforeHeadTags() {
 					return evalHeaders ?
-						PageDefinition.this.getHeaders(page, before): "";
+						PageDefinition.this.getBeforeHeadTags(page): "";
 				}
-				public String getHeaders() {
+				public String getAfterHeadTags() {
 					return evalHeaders ?
-						PageDefinition.this.getHeaders(page): "";
+						PageDefinition.this.getAfterHeadTags(page): "";
 				}
 				public Collection&lt;Object[]&gt; getResponseHeaders() {
 					if (evalHeaders)

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/sys/ComponentsCtrl.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/sys/ComponentsCtrl.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/sys/ComponentsCtrl.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -347,7 +347,7 @@
 	 *
 	 * @since 5.0.0
 	 */
-	public static final Collection&lt;JavaScriptValue&gt; redraw(Collection&lt;Component&gt; comps) {
+	public static final Collection&lt;JavaScriptValue&gt; redraw(Collection&lt;? extends Component&gt; comps) {
 		try {
 			final StringWriter out = new StringWriter(1024*8);
 			final List&lt;JavaScriptValue&gt; js = new LinkedList&lt;JavaScriptValue&gt;();

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/sys/HtmlPageRenders.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/sys/HtmlPageRenders.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/sys/HtmlPageRenders.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -770,7 +770,8 @@
 			return null;
 
 		exec.setAttribute(attr, Boolean.TRUE); //generated only once
-		return ((PageCtrl)page).getHeaders(before);
+		return before ? ((PageCtrl)page).getBeforeHeadTags():
+			((PageCtrl)page).getAfterHeadTags();
 	}
 	/** Generates and returns the ZK specific HTML tags including
 	 * the headers defined in the specified page, or null if it was

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageConfig.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageConfig.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageConfig.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -54,33 +54,29 @@
 	 * a non-empty value before, this method is ignored.
 	 */
 	public String getStyle();
-	/** Returns the content of the specified condition
-	 * that shall be generated inside the header element
-	 * (HTML HEAD), or null if no special header is required.
+
+	/** Returns the content that shall be generated inside the head element
+	 * and before ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * &lt;p&gt;For HTML, the header element is the HEAD element.
+	 * &lt;p&gt;Since it is generated before ZK's default tags (such as CSS and JS),
+	 * it cannot override ZK's default behaviors.
 	 *
-	 * @param before whether to return the headers that shall be shown
-	 * before ZK's CSS/JS headers.
-	 * If true, only the headers that shall be shown before (such as meta)
-	 * are returned.
-	 * If true, only the headers that shall be shown after (such as link)
-	 * are returned.
-	 * @see #getHeaders()
-	 * @since 3.6.1
+	 * @see #getAfterHeadTags
+	 * @since 5.0.5
 	 */
-	public String getHeaders(boolean before);
-	/** Returns all content that will be generated inside the header element
-	 * (HTML HEAD), or null if no special header is required.
-	 * &lt;p&gt;For HTML, the header element is the HEAD element.
-	 * &lt;p&gt;It returns all header no matter it shall be shown before or
-	 * after ZK's CSS/JS headers. To have more control, use
-	 * {@link #getHeaders(boolean)} instead.
+	public String getBeforeHeadTags();
+	/** Returns the content that shall be generated inside the head element
+	 * and after ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * @see PageCtrl#getHeaders
-	 * @see #getHeaders(boolean)
+	 * &lt;p&gt;Since it is generated after ZK's default tags (such as CSS and JS),
+	 * it could override ZK's default behaviors.
+	 *
+	 * @see #getBeforeHeadTags
+	 * @since 5.0.5
 	 */
-	public String getHeaders();
+	public String getAfterHeadTags();
 
 	/** Returns a readonly collection of response headers (never null).
 	 * Each item is a three-element object array.

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -68,32 +68,47 @@
 	 */
 	public void destroy();
 
-	/** Returns the content of the specified condition
-	 * that shall be generated inside the header element
-	 * (never null).
+	/** Returns the tags that shall be generated inside the head element
+	 * and before ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * &lt;p&gt;For HTML, the header element is the HEAD element.
+	 * &lt;p&gt;Since it is generated before ZK's default tags (such as CSS and JS),
+	 * it cannot override ZK's default behaviors.
 	 *
-	 * @param before whether to return the headers that shall be shown
-	 * before ZK's CSS/JS headers.
-	 * If true, only the headers that shall be shown before (such as meta)
-	 * are returned.
-	 * If true, only the headers that shall be shown after (such as link)
-	 * are returned.
-	 * @see #getHeaders()
-	 * @since 3.6.1
+	 * @see #getAfterHeadTags
+	 * @since 5.0.5
 	 */
-	public String getHeaders(boolean before);
-	/** Returns all content that will be generated inside the header element
-	 * (never null).
-	 * &lt;p&gt;For HTML, the header element is the HEAD element.
-	 * &lt;p&gt;It returns all header no matter it shall be shown before or
-	 * after ZK's CSS/JS headers. To have more control, use
-	 * {@link #getHeaders(boolean)} instead.
+	public String getBeforeHeadTags();
+	/** Returns the tags that shall be generated inside the head element
+	 * and after ZK's default tags (never null).
+	 * For example, it might consist of &amp;ltmeta&amp;gt; and &amp;lt;link&amp;gt;.
 	 *
-	 * @see #getHeaders(boolean)
+	 * &lt;p&gt;Since it is generated after ZK's default tags (such as CSS and JS),
+	 * it could override ZK's default behaviors.
+	 *
+	 * @see #getBeforeHeadTags
+	 * @since 5.0.5
 	 */
-	public String getHeaders();
+	public String getAfterHeadTags();
+	/** Adds the tags that will be generated inside the head element
+	 * and before ZK's default tags. For example,
+	 * &lt;pre&gt;&lt;code&gt;((PageCtrl)page).addBeforeHeadTags("&lt;meta name=\"robots\" content=\"index,follow\"/&gt;");&lt;/code&gt;&lt;/pre&gt;
+	 *
+	 * &lt;p&gt;You could specify the link, meta and script directive to have the similar
+	 * result.
+	 * @since 5.0.5
+	 */
+	public void addBeforeHeadTags(String tags);
+	/** Adds the tags that will be generated inside the head element
+	 * and after ZK's default tags. For example,
+	 * &lt;pre&gt;&lt;code&gt;((PageCtrl)page).addBeforeHeadTags("&lt;meta name=\"robots\" content=\"index,follow\"/&gt;");&lt;/code&gt;&lt;/pre&gt;
+	 *
+	 * &lt;p&gt;You could specify the link, meta and script directive to have the similar
+	 * result.
+	 * @since 5.0.5
+	 */
+	public void addAfterHeadTags(String tags);
+
 	/** Returns a readonly collection of response headers (never null).
 	 * The entry is a three-element object array.
 	 * The first element is the header name.

Added: branches/6.0/zkdemo/.classpath
===================================================================
--- branches/6.0/zkdemo/.classpath	                        (rev 0)
+++ branches/6.0/zkdemo/.classpath	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,12 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.dependency" value="/WEB-INF/lib"/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.web.container"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/6.0/zkdemo/.project
===================================================================
--- branches/6.0/zkdemo/.project	                        (rev 0)
+++ branches/6.0/zkdemo/.project	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,37 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zkdemo&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.jsdt.core.javascriptValidator&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.jsdt.core.jsNature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/6.0/zkdemo/.settings/.jsdtscope
===================================================================
--- branches/6.0/zkdemo/.settings/.jsdtscope	                        (rev 0)
+++ branches/6.0/zkdemo/.settings/.jsdtscope	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,12 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry kind="src" path="src/main/webapp"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.wst.jsdt.launching.JRE_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.wst.jsdt.launching.WebProject"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="hide" value="true"/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.wst.jsdt.launching.baseBrowserLibrary"/&gt;
+	&lt;classpathentry kind="output" path=""/&gt;
+&lt;/classpath&gt;

Added: branches/6.0/zkdemo/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zkdemo/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/6.0/zkdemo/.settings/org.eclipse.jdt.core.prefs	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,13 @@
+#Tue Sep 21 10:29:35 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/6.0/zkdemo/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/6.0/zkdemo/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/6.0/zkdemo/.settings/org.eclipse.wst.common.component	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,34 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zkdemo"&gt;
+        &lt;wb-resource deploy-path="/WEB-INF/classes" source-path="/src/main/resources"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/main/webapp"/&gt;
+        &lt;wb-resource deploy-path="/WEB-INF/classes" source-path="/src"/&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zk/zk"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zcommon/zcommon"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zweb/zweb"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zkplus/zkplus"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zul/zul"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zhtml/zhtml"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zkex/zkex"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;dependent-module deploy-path="/WEB-INF/lib" handle="module:/resource/zkmax/zkmax"&gt;
+            &lt;dependency-type&gt;uses&lt;/dependency-type&gt;
+        &lt;/dependent-module&gt;
+        &lt;property name="context-root" value="zkdemo"/&gt;
+        &lt;property name="java-output-path" value="/zkdemo/target/classes"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/6.0/zkdemo/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/6.0/zkdemo/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/6.0/zkdemo/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;fixed facet="wst.jsdt.web"/&gt;
+  &lt;installed facet="java" version="1.4"/&gt;
+  &lt;installed facet="jst.web" version="2.4"/&gt;
+  &lt;installed facet="wst.jsdt.web" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Added: branches/6.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.container
===================================================================
--- branches/6.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.container	                        (rev 0)
+++ branches/6.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.container	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1 @@
+org.eclipse.wst.jsdt.launching.baseBrowserLibrary
\ No newline at end of file

Added: branches/6.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.name
===================================================================
--- branches/6.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.name	                        (rev 0)
+++ branches/6.0/zkdemo/.settings/org.eclipse.wst.jsdt.ui.superType.name	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1 @@
+Window
\ No newline at end of file

Added: branches/6.0/zkdemo/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/6.0/zkdemo/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/6.0/zkdemo/.settings/org.maven.ide.eclipse.prefs	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,9 @@
+#Thu Sep 16 15:49:38 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Added: branches/6.0/zkdemo/pom.xml
===================================================================
--- branches/6.0/zkdemo/pom.xml	                        (rev 0)
+++ branches/6.0/zkdemo/pom.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,222 @@
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+	&lt;artifactId&gt;zkdemo&lt;/artifactId&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
+		&lt;zkel.version&gt;1.1.0&lt;/zkel.version&gt;
+		&lt;commons-lang.version&gt;2.4&lt;/commons-lang.version&gt;
+		&lt;bsh.version&gt;2.0b4&lt;/bsh.version&gt;
+		&lt;commons-fileupload.version&gt;1.2.1&lt;/commons-fileupload.version&gt;
+		&lt;commons-io.version&gt;1.3.1&lt;/commons-io.version&gt;
+		&lt;commons-logging.version&gt;1.1.1&lt;/commons-logging.version&gt;
+		&lt;servlet.version&gt;2.4&lt;/servlet.version&gt;
+		&lt;jetty.version&gt;6.1.16&lt;/jetty.version&gt;
+		&lt;jgroovy.version&gt;1.5.6&lt;/jgroovy.version&gt;
+		&lt;jruby.version&gt;1.1.2&lt;/jruby.version&gt;
+		&lt;jython.version&gt;2.2.1&lt;/jython.version&gt;
+		&lt;js.version&gt;1.7R1&lt;/js.version&gt;
+		&lt;jasperreports.version&gt;3.7.0&lt;/jasperreports.version&gt;
+		&lt;jfreechart.version&gt;1.0.13&lt;/jfreechart.version&gt;
+		&lt;filters.version&gt;2.0.235&lt;/filters.version&gt;
+		&lt;ckez.version&gt;3.3.2_50&lt;/ckez.version&gt;
+		&lt;timelinez.version&gt;2.3.1_50&lt;/timelinez.version&gt;
+		&lt;timeplotz.version&gt;1.1_50&lt;/timeplotz.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;packaging&gt;war&lt;/packaging&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zkdemo&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zkdemo&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;ZK PE Evaluation&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/zk/pe-eval&lt;/url" target="_new">http://mavensync.zkoss.org/zk/pe-eval&lt;/url</a>&gt;
+		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;ZK EE Evaluation&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/zk/ee-eval&lt;/url" target="_new">http://mavensync.zkoss.org/zk/ee-eval&lt;/url</a>&gt;
+		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;jboss&lt;/id&gt;
+			&lt;url&gt;<a href="http://repository.jboss.com/maven2&lt;/url" target="_new">http://repository.jboss.com/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;		
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
+			&lt;version&gt;${servlet.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-logging&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
+			&lt;version&gt;${commons-logging.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
+			&lt;version&gt;${commons-fileupload.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-io&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-io&lt;/artifactId&gt;
+			&lt;version&gt;${commons-io.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zk&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zkplus&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zul&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zhtml&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zkex&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zkmax&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge.el&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommons-el&lt;/artifactId&gt;
+			&lt;version&gt;${zkel.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-lang&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-lang&lt;/artifactId&gt;
+			&lt;version&gt;${commons-lang.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.beanshell&lt;/groupId&gt;
+			&lt;artifactId&gt;bsh&lt;/artifactId&gt;
+			&lt;version&gt;${bsh.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
+			&lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
+			&lt;version&gt;${jgroovy.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.jruby&lt;/groupId&gt;
+			&lt;artifactId&gt;jruby&lt;/artifactId&gt;
+			&lt;version&gt;${jruby.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.python&lt;/groupId&gt;
+			&lt;artifactId&gt;jython&lt;/artifactId&gt;
+			&lt;version&gt;${jython.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;rhino&lt;/groupId&gt;
+			&lt;artifactId&gt;js&lt;/artifactId&gt;
+			&lt;version&gt;${js.version}&lt;/version&gt;
+			&lt;scope&gt;runtime&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;net.sf.jasperreports&lt;/groupId&gt;
+			&lt;artifactId&gt;jasperreports&lt;/artifactId&gt;
+			&lt;version&gt;${jasperreports.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;jfree&lt;/groupId&gt;
+			&lt;artifactId&gt;jfreechart&lt;/artifactId&gt;
+			&lt;version&gt;${jfreechart.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;com.jhlabs&lt;/groupId&gt;
+			&lt;artifactId&gt;filters&lt;/artifactId&gt;
+			&lt;version&gt;${filters.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge&lt;/groupId&gt;
+			&lt;artifactId&gt;ckez&lt;/artifactId&gt;
+			&lt;version&gt;${ckez.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge&lt;/groupId&gt;
+			&lt;artifactId&gt;timelinez&lt;/artifactId&gt;
+			&lt;version&gt;${timelinez.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge&lt;/groupId&gt;
+			&lt;artifactId&gt;timeplotz&lt;/artifactId&gt;
+			&lt;version&gt;${timeplotz.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+			&lt;plugin&gt;
+				&lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.1&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;warSourceExcludes&gt;${project.basedir}/src/archive&lt;/warSourceExcludes&gt;
+					&lt;webappDirectory&gt;${project.basedir}/src/archive&lt;/webappDirectory&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
+&lt;/project&gt;
\ No newline at end of file

Modified: branches/6.0/zkplus/.classpath
===================================================================
--- branches/6.0/zkplus/.classpath	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/.classpath	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,7 +1,17 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
-	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="owner.project.facets" value="java"/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/6.0/zkplus/.project
===================================================================
--- branches/6.0/zkplus/.project	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/.project	2010-09-28 06:08:56 UTC (rev 14287)
@@ -20,8 +20,15 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;

Modified: branches/6.0/zkplus/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zkplus/.settings/org.eclipse.jdt.core.prefs	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/.settings/org.eclipse.jdt.core.prefs	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,9 +1,13 @@
-#Fri Sep 17 17:59:52 CST 2010
+#Tue Sep 21 10:48:22 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
-org.eclipse.jdt.core.compiler.compliance=1.4
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.4
+org.eclipse.jdt.core.compiler.source=1.6

Added: branches/6.0/zkplus/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/6.0/zkplus/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/6.0/zkplus/.settings/org.eclipse.wst.common.component	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zkplus"&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/archive"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/6.0/zkplus/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/6.0/zkplus/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/6.0/zkplus/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/6.0/zkplus/pom.xml
===================================================================
--- branches/6.0/zkplus/pom.xml	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/pom.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zkplus&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 		&lt;org.springframework.version&gt;2.0.6&lt;/org.springframework.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
@@ -58,22 +58,7 @@
 	&lt;/pluginRepositories&gt;
 	&lt;dependencies&gt;
 		&lt;dependency&gt;
-			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-			&lt;version&gt;${zk.version}&lt;/version&gt;
-		&lt;/dependency&gt;
-		&lt;dependency&gt;
-			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
-			&lt;version&gt;${zk.version}&lt;/version&gt;
-		&lt;/dependency&gt;
-		&lt;dependency&gt;
 			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-			&lt;artifactId&gt;zk&lt;/artifactId&gt;
-			&lt;version&gt;${zk.version}&lt;/version&gt;
-		&lt;/dependency&gt;
-		&lt;dependency&gt;
-			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
 			&lt;artifactId&gt;zul&lt;/artifactId&gt;
 			&lt;version&gt;${zk.version}&lt;/version&gt;
 		&lt;/dependency&gt;

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/AcegiSecurityContextListener.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/AcegiSecurityContextListener.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/AcegiSecurityContextListener.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -57,6 +57,7 @@
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  *
  * @author henrichen
  */

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -56,7 +56,7 @@
  * &lt;li&gt;The url page must enclosed with a window component so it can be doModal().&lt;/li&gt;
  * &lt;/ul&gt;
  * &lt;p&gt;This implementation would automatically remove the added eventlistener from the target component.&lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @author Henri
  */
 public class ShowWindowEventListener implements EventListener {

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAccessDeniedHandler.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAccessDeniedHandler.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAccessDeniedHandler.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -37,7 +37,7 @@
  * Used by ExceptionTranslationFilter to handle an
  * &lt;code&gt;AccessDeniedException&lt;/code&gt;. This handler will popup the specified error page so it
  * must be a Window that can be doModel.
- * 
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @author Henri
  */
 public class ZkAccessDeniedHandler implements AccessDeniedHandler {

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationEntryPoint.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationEntryPoint.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationEntryPoint.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -55,7 +55,7 @@
 
 /**
  * &lt;p&gt;This implementation would forward to onAcegiLogin event and popup a login page.&lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @see ZkAuthenticationProcessingFilter
  * @see ShowWindowEventListener
  * @author Henri

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationProcessingFilter.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationProcessingFilter.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationProcessingFilter.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -37,7 +37,7 @@
  * "onLoginOK" event would be fired to the component that fired the event and caused the login 
  * processing. Since it will be tedious to register "onLoginOK" handler on every possible component, it is
  * better to register an onLoginOK event handler on the concerned page.&lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @see ZkAuthenticationEntryPoint
  * @see ShowWindowEventListener
  * @author Henri

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkEventExceptionFilter.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkEventExceptionFilter.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkEventExceptionFilter.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -107,7 +107,7 @@
  *
  * ...
  * &lt;/code&gt;&lt;/pre&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @author henrichen
  */
 public class ZkEventExceptionFilter implements Filter, InitializingBean {

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkTokenBasedRememberMeServices.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkTokenBasedRememberMeServices.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/acegi/ZkTokenBasedRememberMeServices.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -22,7 +22,7 @@
 
 /**
  * &lt;p&gt;get rememberme from request's attribute rather than request's parameter.&lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @author Henri
  */
 public class ZkTokenBasedRememberMeServices extends TokenBasedRememberMeServices {

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/CDIELContext.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/CDIELContext.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/CDIELContext.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -29,7 +29,7 @@
 
 /**
  * An EL context that is based on XEL context for use with CDI.
- *
+ * &lt;p&gt;Applicable to CDI version 1.0 or later&lt;/p&gt;
  * @author henrichen
  */
 /*package*/ class CDIELContext extends ELContext {

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/CDIUtil.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/CDIUtil.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/CDIUtil.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -24,6 +24,7 @@
 import org.zkoss.xel.XelException;
 /**
  * Some generic utility for use with CDI.
+ * &lt;p&gt;Applicable to CDI version 1.0 or later&lt;/p&gt;
  * @author henrichen
  *
  */

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/DelegatingVariableResolver.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/DelegatingVariableResolver.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/cdi/DelegatingVariableResolver.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -27,7 +27,8 @@
 import org.zkoss.xel.XelException;
 
 /**
- * Generic CDI EL named managed bean resolver. 
+ * Generic CDI EL named managed bean resolver.
+ * &lt;p&gt;Applicable to CDI version 1.0 or later&lt;/p&gt;
  * @author henrichen
  *
  */

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionContextListener.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionContextListener.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionContextListener.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -55,7 +55,7 @@
  *		&amp;lt;listener-class&gt;org.zkoss.zkplus.hibernate.HibernateSessionContextListener&amp;lt;/listener-class&gt;
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
- *
+ * &lt;p&gt;Applicable to Hibernate version 3.2.ga or later&lt;/p&gt;
  * @author henrichen
  */
 public class HibernateSessionContextListener implements ExecutionInit, ExecutionCleanup, EventThreadInit, EventThreadResume {

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionFactoryListener.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionFactoryListener.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionFactoryListener.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -62,7 +62,7 @@
  *		&amp;lt;listener-class&gt;org.zkoss.zkplus.hibernate.HibernateSessionFactoryListener&amp;lt;/listener-class&gt;
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
- *
+ * &lt;p&gt;Applicable to Hibernate version 3.2.ga or later&lt;/p&gt;
  * @author henrichen
  */
 public class HibernateSessionFactoryListener 

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateUtil.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateUtil.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateUtil.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -51,9 +51,9 @@
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
  
- * &lt;p&gt; Also notice that the zkplus.jar must be put under application's WEB-INF/lib because
+ * &lt;p&gt;Also notice that the zkplus.jar must be put under application's WEB-INF/lib because
  * the SessionFactory is stored as a class static member.
- *
+ * &lt;p&gt;Applicable to Hibernate version 3.2.ga or later&lt;/p&gt;
  * @author henrichen
  */
 public class HibernateUtil {

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/OpenSessionInViewListener.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/OpenSessionInViewListener.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/hibernate/OpenSessionInViewListener.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -39,7 +39,7 @@
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Hibernate version 3.2.ga or later&lt;/p&gt;
  * @author henrichen
  */
 public class OpenSessionInViewListener implements ExecutionInit, ExecutionCleanup {

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/jpa/JpaUtil.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/jpa/JpaUtil.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/jpa/JpaUtil.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -18,14 +18,12 @@
 package org.zkoss.zkplus.jpa;
 
 import java.util.HashMap;
-import java.util.Iterator;
 import java.util.Map;
 
 import javax.persistence.EntityManager;
 import javax.persistence.EntityManagerFactory;
 import javax.persistence.Persistence;
 
-import org.hibernate.HibernateException;
 import org.zkoss.util.logging.Log;
 import org.zkoss.zk.ui.Desktop;
 import org.zkoss.zk.ui.Execution;
@@ -36,7 +34,7 @@
 /**
  * This class is used to create and hold open EntityManagerFactory objects
  * within a Java EE environment.
- * 
+ * &lt;p&gt;Applicable to EJB version 3.2.ga or later&lt;/p&gt;
  * @author Jeff
  * @since 3.0.2
  */

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/jpa/OpenEntityManagerInViewListener.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/jpa/OpenEntityManagerInViewListener.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/jpa/OpenEntityManagerInViewListener.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -34,7 +34,7 @@
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
- * 
+ * &lt;p&gt;Applicable to EJB version 3.2.ga or later&lt;/p&gt;
  * @author Jeff
  * @since 3.0.2
  */

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/liferay/JQueryRenderCachedPatch.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/liferay/JQueryRenderCachedPatch.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/liferay/JQueryRenderCachedPatch.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -12,21 +12,11 @@
 */
 package org.zkoss.zkplus.liferay;
 
-import java.io.Writer;
-import java.io.StringWriter;
-import java.io.IOException;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
-import javax.servlet.ServletRequest;
 
-import org.zkoss.lang.Library;
-import org.zkoss.lang.Strings;
 import org.zkoss.util.logging.Log;
 
-import org.zkoss.zk.ui.Page;
-import org.zkoss.zk.ui.sys.RequestInfo;
-import org.zkoss.zk.ui.sys.PageRenderPatch;
-
 /**
  * Used to patch the rendering result of a ZK portlet for Liferay.
  * When using ZK portlets with Liferay under Internet Explorer, we have

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/seasar/DelegatingVariableResolver.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/seasar/DelegatingVariableResolver.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/seasar/DelegatingVariableResolver.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -33,7 +33,7 @@
  * 
  * in your zul file:&lt;br/&gt;
  * &lt;code&gt;&amp;lt;?variable-resolver class="org.zkoss.zkplus.seasar.DelegatingVariableResolver"?&amp;gt;&lt;/code&gt;
- *
+ * &lt;p&gt;Applicable to Sesar Framework version 2.4 or later&lt;/p&gt;
  * @author Dennis.Chen
  * @since 3.0.0
  */

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/spring/DelegatingVariableResolver.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/spring/DelegatingVariableResolver.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/spring/DelegatingVariableResolver.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -46,7 +46,7 @@
  * &lt;p&gt;Developers can specify a list of class names separated with comma in
  * a library property called &lt;code&gt;org.zkoss.spring.VariableResolver.class&lt;/code&gt;,
  * such they are used as the default variable resolvers.
- *
+ * &lt;p&gt;Applicable to Spring Framework version 2.x or later&lt;/p&gt;
  * @author henrichen
  * @author ashish
  */

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/spring/SpringTransactionSynchronizationListener.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/spring/SpringTransactionSynchronizationListener.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/spring/SpringTransactionSynchronizationListener.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -53,7 +53,7 @@
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Spring Framework version 2.x or later&lt;/p&gt;
  * @author henrichen
  */
 public class SpringTransactionSynchronizationListener implements EventThreadInit, EventThreadCleanup, EventThreadResume {

Modified: branches/6.0/zkplus/src/org/zkoss/zkplus/spring/SpringUtil.java
===================================================================
--- branches/6.0/zkplus/src/org/zkoss/zkplus/spring/SpringUtil.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zkplus/src/org/zkoss/zkplus/spring/SpringUtil.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -28,7 +28,7 @@
 
 /**
  * SpringUtil, a Spring utility.
- *
+ * &lt;p&gt;Applicable to Spring Framework version 2.x or later&lt;/p&gt;
  * @author henrichen
  */
 public class SpringUtil {

Modified: branches/6.0/zul/.classpath
===================================================================
--- branches/6.0/zul/.classpath	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/.classpath	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,7 +1,13 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
 	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/6.0/zul/.project
===================================================================
--- branches/6.0/zul/.project	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/.project	2010-09-28 06:08:56 UTC (rev 14287)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/6.0/zul/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zul/.settings/org.eclipse.jdt.core.prefs	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/.settings/org.eclipse.jdt.core.prefs	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:44:20 CST 2010
+#Tue Sep 21 10:46:52 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/6.0/zul/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/6.0/zul/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/6.0/zul/.settings/org.eclipse.wst.common.component	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,4 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zul"/&gt;
+&lt;/project-modules&gt;

Added: branches/6.0/zul/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/6.0/zul/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/6.0/zul/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/6.0/zul/pom.xml
===================================================================
--- branches/6.0/zul/pom.xml	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/pom.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zul&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;name&gt;ZK XUL Components&lt;/name&gt;

Modified: branches/6.0/zul/src/archive/web/js/zul/db/Datebox.js
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/db/Datebox.js	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/archive/web/js/zul/db/Datebox.js	2010-09-28 06:08:56 UTC (rev 14287)
@@ -465,8 +465,8 @@
 			this._auxb = new zul.Auxbutton(this, btn, inp);
 			this.domListen_(btn, 'onClick', '_doBtnClick');
 		}
-		if (this._readonly &amp;&amp; !this.inRoundedMold() &amp;&amp; !this._buttonVisible)
-			jq(inp).addClass(this.getZclass() + '-right-edge');
+		
+		zul.db.ThemeHandler.addRightEdgeClass(this);
 			
 		this.syncWidth();
 		
@@ -728,4 +728,16 @@
 	}
 });
 
+zul.db.ThemeHandler = {
+	 addRightEdgeClass: function (wgt) {
+	  	if (wgt._readonly &amp;&amp; !wgt.inRoundedMold() &amp;&amp; !wgt._buttonVisible)
+			jq(wgt.getInputNode()).addClass(wgt.getZclass() + '-right-edge');
+	 },
+	 addDayOfWeekClass: function (isWeekend, out) {
+	 	if (isWeekend) out.push(' class="z-weekend"');
+	 },
+	 addDayRowClass: function (isWeekend, zcls, out) {
+	 	out.push ('&lt;td&gt;&lt;/td&gt;');
+	 }
+};
 })();

Modified: branches/6.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/archive/web/js/zul/db/css/calendar.css.dsp	2010-09-28 06:08:56 UTC (rev 14287)
@@ -11,6 +11,7 @@
 }
 .z-calendar,
 .z-calendar-title-over {
+	border-radius: 3px;
 	-moz-border-radius: 3px;
 	-webkit-border-radius: 3px;
 }
@@ -127,6 +128,7 @@
 .z-calendar-calmon .z-calendar-over,
 .z-calendar-caldayrow .z-calendar-over {
 	background: #F1F9FC;
+	border-radius: 4px;
 	-moz-border-radius: 4px;
 	-webkit-border-radius: 4px;
 }
@@ -135,6 +137,7 @@
 .z-calendar-calmon td.z-calendar-seld,
 .z-calendar-calday td.z-calendar-seld {
 	background: #CCE0FB; 
+	border-radius: 4px;
 	-moz-border-radius: 4px;
 	-webkit-border-radius: 4px;
 }
@@ -144,6 +147,7 @@
 .z-datebox-calmon td.z-datebox-over-seld,
 .z-datebox-calday td.z-datebox-over-seld {
 	background: #5FA4FF;
+	border-radius: 4px;
 	-moz-border-radius: 4px;
 	-webkit-border-radius: 4px;
 }

Modified: branches/6.0/zul/src/archive/web/js/zul/db/mold/calendar.js
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/db/mold/calendar.js	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/archive/web/js/zul/db/mold/calendar.js	2010-09-28 06:08:56 UTC (rev 14287)
@@ -36,10 +36,10 @@
 				'&lt;tr&gt;&lt;td id="', uuid, '-title"&gt;');
 	switch(view) {
 	case "day" :
-		out.push('&lt;span id="', uuid, '-tm" class="', zcls, '-ctrler"&gt;', zk.SMON[m], '&lt;/span&gt;, &lt;span id="', uuid, '-ty" class="', zcls, '-ctrler"&gt;', y + ydelta, '&lt;/span&gt;');
+		out.push('&lt;span id="', uuid, '-tm" class="', zcls, '-ctrler"&gt;', zk.SMON[m], '&lt;/span&gt; &lt;span id="', uuid, '-ty" class="', zcls, '-ctrler"&gt;', y + ydelta, '&lt;/span&gt;');
 		break;
 	case "month" :
-		out.push('&lt;span id="', uuid, '-tm" class="', zcls, '-ctrler"&gt;', zk.SMON[m], '&lt;/span&gt;, &lt;span id="', uuid, '-ty" class="', zcls, '-ctrler"&gt;', y + ydelta, '&lt;/span&gt;');
+		out.push('&lt;span id="', uuid, '-tm" class="', zcls, '-ctrler"&gt;', zk.SMON[m], '&lt;/span&gt; &lt;span id="', uuid, '-ty" class="', zcls, '-ctrler"&gt;', y + ydelta, '&lt;/span&gt;');
 		break;
 	case "year" :
 		out.push('&lt;span id="', uuid, '-tyd" class="', zcls, '-ctrler"&gt;', yofs + ydelta + 1, '-', yofs + ydelta + 10, '&lt;/span&gt;');
@@ -63,14 +63,14 @@
 			var sun = (7 - zk.DOW_1ST) % 7, sat = (6 + sun) % 7;
 			for (var j = 0 ; j &lt; 7; ++j) {
 				out.push('&lt;td');
-				if (j == sun || j == sat) out.push(' class="z-weekend"');
+				zul.db.ThemeHandler.addDayOfWeekClass((j == sun || j == sat), out);
 				out.push( '&gt;' + zk.S2DOW[j] + '&lt;/td&gt;');
 			}
 			out.push('&lt;/tr&gt;');
 			for (var j = 0; j &lt; 6; ++j) { //at most 7 rows
 				out.push('&lt;tr class="', zcls, '-caldayrow" id="', uuid, '-w', j, '" &gt;');
 				for (var k = 0; k &lt; 7; ++k)
-					out.push ('&lt;td&gt;&lt;/td&gt;');
+					zul.db.ThemeHandler.addDayRowClass((k == sun || k == sat), zcls, out);
 				out.push('&lt;/tr&gt;');
 			}
 		out.push('&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;');

Modified: branches/6.0/zul/src/archive/web/js/zul/inp/css/combo.css.dsp
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/inp/css/combo.css.dsp	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/archive/web/js/zul/inp/css/combo.css.dsp	2010-09-28 06:08:56 UTC (rev 14287)
@@ -29,6 +29,7 @@
 	border: 1px solid #86A4BE;
 	padding-top: 2px;
 	padding-bottom: 2px;
+	border-radius: 2px 0 0 2px;
 	-moz-border-radius: 2px 0 0 2px;
 	-webkit-border-radius: 2px 0 0 2px;
 	&lt;c:if test="${c:isSafari()}"&gt;
@@ -123,6 +124,7 @@
 	border-bottom: 1px solid #86A4BE;
 	overflow: hidden;
 	display:-moz-inline-box; display:inline-block;
+	border-radius: 0 2px 2px 0;
 	-moz-border-radius: 0 2px 2px 0;
 	-webkit-border-radius: 0 2px 2px 0;
 	&lt;c:if test="${c:browser('ie7-') || c:browser('ie6-')}"&gt;
@@ -375,6 +377,8 @@
 &lt;%-- Shadow --%&gt;
 .z-combobox-rounded-shadow, .z-bandbox-rounded-shadow, .z-datebox-rounded-shadow,
 .z-combobox-shadow, .z-bandbox-shadow, .z-datebox-shadow {
+	border-radius: 3px;
+	box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
 	-moz-border-radius: 3px;
 	-moz-box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
 	-webkit-border-radius: 3px;

Modified: branches/6.0/zul/src/archive/web/js/zul/inp/css/input.css.dsp
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/inp/css/input.css.dsp	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/archive/web/js/zul/inp/css/input.css.dsp	2010-09-28 06:08:56 UTC (rev 14287)
@@ -24,6 +24,7 @@
 	font-weight: normal;
 	padding-top: 2px;
 	padding-bottom: 2px;
+	border-radius: 2px;
 	-moz-border-radius: 2px;
 	-webkit-border-radius: 2px;
 }

Modified: branches/6.0/zul/src/archive/web/js/zul/menu/Menu.js
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/menu/Menu.js	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/archive/web/js/zul/menu/Menu.js	2010-09-28 06:08:56 UTC (rev 14287)
@@ -300,7 +300,6 @@
 
 zul.menu.ContentHandler = zk.$extends(zk.Object, {
 	 $init: function(wgt, content) {
-	 	this.$supers('$init', arguments);
 		this._wgt = wgt;
 		this._content = content;
 	 },

Modified: branches/6.0/zul/src/archive/web/js/zul/tab/mold/tab.js
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/tab/mold/tab.js	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/archive/web/js/zul/tab/mold/tab.js	2010-09-28 06:08:56 UTC (rev 14287)
@@ -32,7 +32,7 @@
 					'&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;');
 		} else {
 			if (tbx.getPanelSpacing() &amp;&amp; this.getIndex())
-				out.push('&lt;div style="margin:0;display:list-item;width:100%;height:', tbx.getpanelSpacing(), ';"&gt;&lt;/div&gt;');
+				out.push('&lt;div style="margin:0;display:list-item;width:100%;height:', tbx.getPanelSpacing(), ';"&gt;&lt;/div&gt;');
 
 			out.push('&lt;div id="', this.uuid, '"', this.domAttrs_(), '&gt;',
 					'&lt;div align="left" class="', zcls, '-header" &gt;',

Modified: branches/6.0/zul/src/archive/web/js/zul/wnd/css/panel.css.dsp
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/wnd/css/panel.css.dsp	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/archive/web/js/zul/wnd/css/panel.css.dsp	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,5 +1,7 @@
 &lt;%@ taglib uri="<a href="http://www.zkoss.org/dsp/web/core" target="_new">http://www.zkoss.org/dsp/web/core</a>" prefix="c" %&gt;
 .z-panel-shadow {
+	border-radius: 4px;
+	box-shadow:0 0 3px rgba(0, 0, 0, 0.5);
 	-moz-border-radius: 4px;
 	-moz-box-shadow:0 0 3px rgba(0, 0, 0, 0.5);
 	-webkit-border-radius: 4px;

Modified: branches/6.0/zul/src/archive/web/js/zul/wnd/css/window.css.dsp
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/wnd/css/window.css.dsp	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/archive/web/js/zul/wnd/css/window.css.dsp	2010-09-28 06:08:56 UTC (rev 14287)
@@ -5,6 +5,8 @@
 .z-window-popup-shadow,
 .z-window-embedded-shadow,
 .z-window-highlighted-shadow {
+	border-radius: 4px;
+	box-shadow:0 0 3px rgba(0, 0, 0, 0.5);
 	-moz-border-radius: 4px;
 	-moz-box-shadow:0 0 3px rgba(0, 0, 0, 0.5);
 	-webkit-border-radius: 4px;

Modified: branches/6.0/zul/src/org/zkoss/zul/Listbox.java
===================================================================
--- branches/6.0/zul/src/org/zkoss/zul/Listbox.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/org/zkoss/zul/Listbox.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1088,7 +1088,7 @@
 			if (inSelectMold())
 				smartUpdate("selectedIndex", -1);
 			else
-				smartUpdate("selectedItem", null);
+				smartUpdate("selectedItem", (Object)null);
 			// Bug 1734950: don't count on index (since it may change)
 		}
 		if (_model instanceof Selectable &amp;&amp; !isLoadingModel()) {

Modified: branches/6.0/zul/src/org/zkoss/zul/RowComparator.java
===================================================================
--- branches/6.0/zul/src/org/zkoss/zul/RowComparator.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zul/src/org/zkoss/zul/RowComparator.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -25,7 +25,7 @@
  * @author jumperchen
  * @since 3.6.0
  */
-public class RowComparator implements Comparator {
+public class RowComparator implements Comparator&lt;Object&gt; {
 
 	/** The column (optinal). */
 	private final Column _column;

Modified: branches/6.0/zweb/.classpath
===================================================================
--- branches/6.0/zweb/.classpath	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zweb/.classpath	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,7 +1,13 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;classpath&gt;
 	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="src" path="src/archive"/&gt;
 	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
-	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"&gt;
+		&lt;attributes&gt;
+			&lt;attribute name="org.eclipse.jst.component.nondependency" value=""/&gt;
+		&lt;/attributes&gt;
+	&lt;/classpathentry&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/&gt;
 	&lt;classpathentry kind="output" path="debug/classes"/&gt;
 &lt;/classpath&gt;

Modified: branches/6.0/zweb/.project
===================================================================
--- branches/6.0/zweb/.project	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zweb/.project	2010-09-28 06:08:56 UTC (rev 14287)
@@ -6,6 +6,11 @@
 	&lt;/projects&gt;
 	&lt;buildSpec&gt;
 		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
 			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
@@ -15,9 +20,17 @@
 			&lt;arguments&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.validation.validationbuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
 	&lt;/buildSpec&gt;
 	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jem.workbench.JavaEMFNature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.modulecore.ModuleCoreNature&lt;/nature&gt;
 		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
 		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
 	&lt;/natures&gt;
 &lt;/projectDescription&gt;

Modified: branches/6.0/zweb/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/6.0/zweb/.settings/org.eclipse.jdt.core.prefs	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zweb/.settings/org.eclipse.jdt.core.prefs	2010-09-28 06:08:56 UTC (rev 14287)
@@ -1,9 +1,13 @@
-#Fri Sep 17 16:48:26 CST 2010
+#Tue Sep 21 10:47:03 CST 2010
 eclipse.preferences.version=1
 org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
 org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
 org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/6.0/zweb/.settings/org.eclipse.wst.common.component
===================================================================
--- branches/6.0/zweb/.settings/org.eclipse.wst.common.component	                        (rev 0)
+++ branches/6.0/zweb/.settings/org.eclipse.wst.common.component	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
+    &lt;wb-module deploy-name="zweb"&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src"/&gt;
+        &lt;wb-resource deploy-path="/" source-path="/src/archive"/&gt;
+    &lt;/wb-module&gt;
+&lt;/project-modules&gt;

Added: branches/6.0/zweb/.settings/org.eclipse.wst.common.project.facet.core.xml
===================================================================
--- branches/6.0/zweb/.settings/org.eclipse.wst.common.project.facet.core.xml	                        (rev 0)
+++ branches/6.0/zweb/.settings/org.eclipse.wst.common.project.facet.core.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;faceted-project&gt;
+  &lt;installed facet="java" version="1.6"/&gt;
+  &lt;installed facet="jst.utility" version="1.0"/&gt;
+&lt;/faceted-project&gt;

Modified: branches/6.0/zweb/pom.xml
===================================================================
--- branches/6.0/zweb/pom.xml	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zweb/pom.xml	2010-09-28 06:08:56 UTC (rev 14287)
@@ -7,7 +7,7 @@
 	&lt;artifactId&gt;zweb&lt;/artifactId&gt;
 	&lt;packaging&gt;jar&lt;/packaging&gt;
 	&lt;properties&gt;
-		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;zk.version&gt;5.0.5.FL.20100920&lt;/zk.version&gt;
 	&lt;/properties&gt;
 	&lt;version&gt;${zk.version}&lt;/version&gt;
 	&lt;name&gt;The ZKoss Web Library&lt;/name&gt;

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/Servlets.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/Servlets.java	2010-09-27 05:46:17 UTC (rev 14286)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/Servlets.java	2010-09-28 06:08:56 UTC (rev 14287)
@@ -284,7 +284,7 @@
 	/** Returns whether the user agent is a browser of the specified type.
 	 *
 	 * @param type the type of the browser.
-	 * Allowed values include "robot", "ie", "ie6", "ie6-", "ie7", "ie8",
+	 * Allowed values include "robot", "ie", "ie6", "ie6-", "ie7", "ie8", "ie9",
 	 * "ie7-", "gecko", "gecko2", "gecko3", "gecko3.5", "gecko2-", "gecko3-",
 	 * "opara", "safari",
 	 * "hil". Otherwise, it matches whether the type exist or not.&lt;br/&gt;
@@ -305,12 +305,16 @@
 		if ("ie7-".equals(type)) return getIEVer(userAgent) == 7;
 		if ("ie8".equals(type)) return getIEVer(userAgent) &gt;= 8;
 		if ("ie8-".equals(type)) return getIEVer(userAgent) == 8;
+		if ("ie9".equals(type)) return getIEVer(userAgent) &gt;= 9;
+		if ("ie9-".equals(type)) return getIEVer(userAgent) == 9;
 
 		if ("gecko".equals(type) || "gecko2".equals(type)) return isGecko(userAgent);
 		if ("gecko2-".equals(type)) return getGeckoVer(userAgent) == 2;
 		if ("gecko3".equals(type)) return isGecko3(userAgent);
 		if ("gecko3.5".equals(type)) return getGeckoVer(userAgent, true) &gt;= 35;
 		if ("gecko3-".equals(type)) return getGeckoVer(userAgent) == 3;
+		if ("gecko4".equals(type)) return getGeckoVer(userAgent) &gt;= 4;
+		if ("gecko4-".equals(type)) return getGeckoVer(userAgent) == 4;
 
 		if ("safari".equals(type)) return isSafari(userAgent);
 		if ("opera".equals(type)) return isOpera(userAgent);


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26333114">[zk1-subversion-log] SF.net SVN: zk1:[14290] branches</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-28 08:34</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14290
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14290&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14290&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-28 08:34:28 +0000 (Tue, 28 Sep 2010)

Log Message:
-----------


Removed Paths:
-------------
    branches/5.0/dist/lib/ext/readme.txt
    branches/5.0/zkdemo/src/archive/test/standalone.jsp
    branches/5.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1ArrayGroupsModel.java
    branches/6.0/dist/lib/ext/readme.txt
    branches/6.0/zcommon/src/org/zkoss/util/CheckableTreeArray.java
    branches/6.0/zcommon/src/org/zkoss/util/ListX.java
    branches/6.0/zcommon/src/org/zkoss/util/TreeArray.java
    branches/6.0/zk/src/org/zkoss/zk/ui/http/Standalones.java
    branches/6.0/zkdemo/src/archive/test/standalone.jsp
    branches/6.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1ArrayGroupsModel.java
    branches/6.0/zul/src/org/zkoss/zul/ArrayGroupsModel.java

Deleted: branches/5.0/dist/lib/ext/readme.txt
===================================================================
--- branches/5.0/dist/lib/ext/readme.txt	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/5.0/dist/lib/ext/readme.txt	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,5 +0,0 @@
-Readme dist/lib/ext
-
-------
-seasar
-s2-framework-2.4.16.jar
\ No newline at end of file

Deleted: branches/5.0/zkdemo/src/archive/test/standalone.jsp
===================================================================
--- branches/5.0/zkdemo/src/archive/test/standalone.jsp	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/5.0/zkdemo/src/archive/test/standalone.jsp	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,24 +0,0 @@
-&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" target="_new">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"&gt;
-&lt;%@page import="org.zkoss.zk.ui.http.Standalones"%&gt;
-&lt;%@page import="org.zkoss.zul.Calendar"%&gt;
-&lt;%@page import="org.zkoss.zul.Listbox"%&gt;
-&lt;%@page import="org.zkoss.zul.Listitem"%&gt;
-&lt;html&gt;
-	&lt;head&gt;
-		&lt;title&gt;Test of Standalone Component&lt;/title&gt;
-	&lt;/head&gt;
-	&lt;body style="height:auto"&gt;
-		&lt;p&gt;This is a test of standalone component: calendar.&lt;/p&gt;
-		&lt;%
-	Calendar cal = new Calendar();
-	Standalones.output(config.getServletContext(), request, response, cal, null, out);
-		%&gt;
-		&lt;p&gt;This is another component: listbox&lt;/p&gt;
-		&lt;%
-	Listbox listbox = new Listbox();
-	listbox.appendChild(new Listitem("Item 1"));
-	listbox.appendChild(new Listitem("Item 2"));
-	Standalones.output(config.getServletContext(), request, response, listbox, null, out);
-		%&gt;
-	&lt;/body&gt;
-&lt;/html&gt;
\ No newline at end of file

Deleted: branches/5.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1ArrayGroupsModel.java
===================================================================
--- branches/5.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1ArrayGroupsModel.java	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/5.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1ArrayGroupsModel.java	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,46 +0,0 @@
-/* Test1ArrayGroupsModel.java
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Sep 3, 2008 12:10:32 PM     2008, Created by Dennis.Chen
-}}IS_NOTE
-
-Copyright (C) 2007 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-	This program is distributed under GPL Version 3.0 in the hope that
-	it will be useful, but WITHOUT ANY WARRANTY.
-}}IS_RIGHT
-*/
-package org.zkoss.zkdemo.test2.group;
-
-import java.util.Comparator;
-
-import org.zkoss.zul.ArrayGroupsModel;
-
-/**
- * @author Dennis.Chen
- *
- */
-public class Test1ArrayGroupsModel extends ArrayGroupsModel{
-	public Test1ArrayGroupsModel(Object[] data,Comparator cmpr){
-		super(data,cmpr,0);
-	}
-	protected Object createGroupHead(Object[] groupdata,int index,int col) {
-		String s1 = ((String)groupdata[0]);
-		return "Group "+s1.charAt(col==0?0:s1.length()-1)+" : "+groupdata.length+" Items";
-	}
-	
-	protected Object createGroupFoot(Object[] groupdata,int index, int col) {
-		int total = 0;
-		for(int i=0;i&lt;groupdata.length;i++){
-			String s1 = ((String)groupdata[i]);
-			total += Integer.parseInt(""+s1.charAt(s1.length()-1));
-		}
-		return "Total:"+total;
-	}
-}

Deleted: branches/6.0/dist/lib/ext/readme.txt
===================================================================
--- branches/6.0/dist/lib/ext/readme.txt	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/6.0/dist/lib/ext/readme.txt	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,5 +0,0 @@
-Readme dist/lib/ext
-
-------
-seasar
-s2-framework-2.4.16.jar
\ No newline at end of file

Deleted: branches/6.0/zcommon/src/org/zkoss/util/CheckableTreeArray.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/CheckableTreeArray.java	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/6.0/zcommon/src/org/zkoss/util/CheckableTreeArray.java	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,92 +0,0 @@
-/* CheckableTreeArray.java
-
-
-	Purpose: 
-	Description: 
-	History:
-	2001/10/05 14:43:05, Create, Tom M. Yeh.
-
-Copyright (C) 2001 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-	This program is distributed under LGPL Version 3.0 in the hope that
-	it will be useful, but WITHOUT ANY WARRANTY.
-}}IS_RIGHT
-*/
-package org.zkoss.util;
-
-import java.util.Collection;
-import java.util.Iterator;
-
-/**
- * The checkable TreeArray. It extends TreeArray such that deriving
- * classes could add validation when an element is added, removed or set.
- * It is also useful to maintain the modification flag.
- *
- * @author tomyeh
- */
-public abstract class CheckableTreeArray extends TreeArray {
-	protected CheckableTreeArray() {
-	}
-	protected CheckableTreeArray(Collection c) {
-		super(c);
-	}
-
-	//-- deriving to override --//
-	/** Called each time an new element is about being added into the array.
-	 *
-	 * &lt;p&gt;Deriving classes usually put checking codes here.
-	 * And, throws exception if failure and nothing will be affected.
-	 *
-	 * @param newElement the element to be added
-	 * @param followingElement the elment that will 'follow' the new element.
-	 * In other words, newElement will be inserted &lt;b&gt;before&lt;/b&gt;
-	 * followingElement. If null, it means newElement is appended at the end
-	 */
-	protected void onAdd(Object newElement, Object followingElement) {
-	}
-	/** Called each time an element is about being assigned into the array
-	 * and replace an existence one (by ListIterator.set).
-	 *
-	 * &lt;p&gt;Deriving classes usually put checking codes here.
-	 * And, throws exception if failure and nothing will be affected.
-	 *
-	 * @param newElement the element to be added
-	 * @param replaced the element to be replaced
-	 */
-	protected void onSet(Object newElement, Object replaced) {
-	}
-	/** Called each time an element is about being removed from the array.
-	 * Deriving classes usually put checking codes here.
-	 * And, throws exception if failure.
-	 */
-	protected void onRemove(Object element) {
-	}
-
-	//-- TreeArray --//
-	protected RbEntry newEntry(Object element) {
-		return new CkEntry(element);
-	}
-	protected class CkEntry extends RbEntry {
-		protected CkEntry(Object element) {
-			super(element);
-		}
-		public void setElement(Object element) {
-			onSet(element, this.element);
-			super.setElement(element);
-		}
-	}
-	protected RbEntry insert(RbEntry insertBefore, final RbEntry p) {
-		onAdd(p.element, insertBefore != null ? insertBefore.element: null);
-		return super.insert(insertBefore, p);
-	}
-	protected void delete(RbEntry p) {
-		onRemove(p.element);
-		super.delete(p);
-	}
-	public void clear() {
-		for (final Iterator iter = iterator(); iter.hasNext();)
-			onRemove(iter.next());
-		super.clear();
-	}
-}

Deleted: branches/6.0/zcommon/src/org/zkoss/util/ListX.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/ListX.java	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/6.0/zcommon/src/org/zkoss/util/ListX.java	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,138 +0,0 @@
-/* ListX.java
-
-
-	Purpose: The extended list interface.
-	Description: 
-	History:
-	 2001/5/9, Tom M. Yeh: Created.
-
-
-Copyright (C) 2001 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-	This program is distributed under LGPL Version 3.0 in the hope that
-	it will be useful, but WITHOUT ANY WARRANTY.
-}}IS_RIGHT
-*/
-package org.zkoss.util;
-
-/**
- * The extended list interface. It provides methods
- * to access the entry of each node in the list.
- *
- * &lt;p&gt;Any class implementing
- * this interface guarantees the binding between the entry and the
- * element never changes even after removed.
- *
- * @author tomyeh
- * @see TreeArray
- */
-public interface ListX {
-	/**
-	 * Represents the entry of each node in the list.
-	 */
-	public interface Entry {
-		/**
-		 * Gets the element stored in the entry.
-		 */
-		public Object getElement();
-		/**
-		 * Sets the entry to store the specified element.
-		 */
-		public void setElement(Object element);
-		/*
-		 * Gets the entry next to this one.
-		 *
-		 * @return the next entry; null if no more
-		 */
-		public Entry next();
-		/*
-		 * Gets the entry previous to this one.
-		 *
-		 * @return the previous entry; null if no more
-		 */
-		public Entry previous();
-		/**
-		 * Tests whether an entry is an orphan -- being removed from a list.
-		 */
-		public boolean isOrphan();
-	}
-
-	/**
-	 * Gets the entry of the specified index, rather than the element
-	 * added by List.add. An entry is an internal representation of an
-	 * object that holding the element stored by List.add.
-	 *
-	 * &lt;p&gt;The caller should consider the returned entry as opaque.
-	 * The caller could store it for later use. It is useful when you
-	 * want to extend the list's features, such as providing two or
-	 * more indexing methods.
-	 *
-	 * &lt;p&gt;In other words, even if the underlying structure of a list is
-	 * changed (e.g., a new element is inserted), the caller holding entries
-	 * won't be affected.
-	 *
-	 * @param index the index from which the entry is retrieved
-	 * @return the entry
-	 */
-	public Entry getEntry(int index);
-
-	/**
-	 * Gets the index of the specified entry.
-	 *
-	 * @param entry the entry to locate
-	 * @return the index; -1 if entry is orphan
-	 */
-	public int indexOfEntry(Entry entry);
-
-	/**
-	 * Inserts the sepcified element in front of the specified entry.
-	 *
-	 * &lt;p&gt;Shifts the element currently at that position (if any)
-	 * and any subsequent elements to the right (adds one to their indices).
-	 *
-	 * @param insertBefore the entry before which an new entry will be
-	 * inserted; append is assumed if null
-	 * @param element the element to insert
-	 * @return the new entry containing the inserted element.
-	 */
-	public Entry addEntry(Entry insertBefore, Object element);
-
-	/**
-	 * Inserts the specified element at the specified position in this list.
-	 * It is an enhanced version of List.add -- it returns the entry
-	 * containing the element.
-	 *
-	 * @param index index at which the specified element is to be inserted.
-	 * @param element element to be inserted.
-	 * @return the new entry that conatining the inserted element.
-	 */
-	public Entry addEntry(int index, Object element);
-
-	/**
-	 * Appends the specified element to the end of this list.
-	 * It is an enhanced version of List.add -- it returns the entry
-	 * containing the element.
-	 *
-	 * @param element the element to be inserted.
-	 * @return the new entry that conatining the inserted element.
-	 */
-	public Entry addEntry(Object element);
-
-	/**
-	 * Remove the entry from the list. The entry object does not
-	 * be deleted, and it is just no longer referenced by the list.
-	 *
-	 * @param entry the entry returned by getEntry.
-	 */
-	public void removeEntry(Entry entry);
-
-	/**
-	 * Remove the entry at the specified location from the list.
-	 * Unlike List.remove(int), it returns the entry being removed.
-	 *
-	 * @param index the location of the entry to remove
-	 * @return the entry being removed
-	 */
-	public Entry removeEntry(int index);
-}

Deleted: branches/6.0/zcommon/src/org/zkoss/util/TreeArray.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/TreeArray.java	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/6.0/zcommon/src/org/zkoss/util/TreeArray.java	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,974 +0,0 @@
-/* TreeArray.java
-
-
-	Purpose: Red-black tree based array implementation of List interface.
-	Description:
-	History:
-	 2001/5/9, Tom M. Yeh: Created.
-
-
-Copyright (C) 2001 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-	This program is distributed under LGPL Version 3.0 in the hope that
-	it will be useful, but WITHOUT ANY WARRANTY.
-}}IS_RIGHT
-*/
-package org.zkoss.util;
-
-import java.util.*;
-
-/**
- * Red-black tree based array implementation of List interface.
- * Unlike LinkedList, the random access by index is as fast as log(n).
- * Unlike ArrayList, the insertion is as fast as log(n). It is
- * a great compromise between randown and sequential access.
- *
- * &lt;p&gt;In additions, it extends the features by also implementing
- * ListX.
- *
- * &lt;p&gt;The deriving class might override newEntry if it also
- * extends RbEntry; override insert(RbEntry, RbEntry) for adding element;
- * override delete(RbEntry) for removing element; clear() for
- * clearing the whole list.
- *
- * &lt;p&gt;Also, RbEntry.setElement might be overrided if the deriving class
- * wants to do something when the set method is called.
- *
- * &lt;p&gt;The iterator method is designed such that next() will proceed correctly
- * even if getElement() throws an exception.
- *
- * &lt;p&gt;The original algorithm is invented by Henri Chen.
- *
- * @author tomyeh
- * @see ListX
- */
-public class TreeArray extends AbstractList
-implements ListX, Cloneable, java.io.Serializable {
-    private static final long serialVersionUID = 20060622L;
-
-    protected static final boolean RED   = false;
-    protected static final boolean BLACK = true;
-
-	/**
-	 * Caller shall use AbstractList.Entry instead of RbEntry for
-	 * better portability.
-	 */
-	protected static class RbEntry implements Entry {
-		protected Object	element; //use setElement and getElement
-		protected int   	leftNum; //# of elements on its left sub-tree
-		protected RbEntry	left;
-		protected RbEntry	right;
-		protected RbEntry	parent;
-		protected boolean	color; //a black node
-		protected boolean	orphan = false; //not belonging to any list
-
-		protected RbEntry(Object element) {
-			this.element = element;
-		}
-
-		/**
-		 * Override it if you want to something when an element is retrieved.
-		 * All other parts that get element must invoke this method
-		 */
-		public Object getElement() {
-			return this.element;
-		}
-
-		/**
-		 * Override it if you want to do something when an element
-		 * is set. All other parts that set element will invoke this method.
-		 */
-		public void setElement(Object element) {
-			this.element = element;
-		}
-
-		public final boolean isOrphan() {
-			return orphan;
-		}
-
-		protected final RbEntry nextEntry() {
-			if (right != null)
-				return right.leftMost();
-			return firstRightAncestor();
-		}
-		public final Entry next() {
-			return nextEntry();
-		}
-		protected final RbEntry previousEntry() {
-			if (left!=null)
-				return left.rightMost();
-			return firtLeftAncestor();
-		}
-		public final Entry previous() {
-			return previousEntry();
-		}
-
-		//-- utilities --/
-		/**
-		 * Gets the leftmost leaf of the specified subtree.
-		 * It is the entry with lowest index in the subtree.
-		 */
-		protected final RbEntry leftMost() {
-			for (RbEntry p=this;; p=p.left)
-				if (p.left==null)
-					return p;
-		}
-		/**
-		 * Gets the rihtmost leaf of the specified subtree.
-		 * It is the entry with highest index in the subtree.
-		 */
-		protected final RbEntry rightMost() {
-			for (RbEntry p=this;; p=p.right)
-				if (p.right==null)
-					return p;
-		}
-		/**
-		 * Gets the first ancestor at the left of the specified entry.
-		 * "At the left" we mean the returned ancesor's right is the entry
-		 * or its ancestor. It is also the first parent with lower index.
-		 */
-		protected final RbEntry firtLeftAncestor() {
-			for (RbEntry p=this; p.parent!=null; p=p.parent)
-				if (p.parent.right == p)
-					return p.parent;
-			return null;
-		}
-		/**
-		 * Gets the first parent at the right of the specified entry.
-		 * "At the right" we mean the returned ancesor's right is the entry
-		 * or its ancestor. It is also the first parent with higer index.
-		 */
-		protected final RbEntry firstRightAncestor() {
-			for (RbEntry p=this; p.parent != null; p = p.parent)
-				if (p.parent.left == p)
-					return p.parent;
-			return null;
-		}
-
-		//It doesn't maintain the tree but reset itself as an orphan.
-		private final void setOrphan() {
-			orphan = true;
-			left = right = parent = null;
-		}
-
-		/**
-		 * Called by TreeArray.clear to do clear recursively.
-		 * Since it always be invoked to clear the whole tree,
-		 * it doesn't have to maintain leftNum or other tree info.
-		 * &lt;p&gt;However, this.element is kept.
-		 */
-		protected void clear() {
-			if (left != null) left.clear();
-			if (right != null) right.clear();
-			setOrphan();
-		}
-	}//class RbEntry
-
-	protected transient RbEntry _root = null;
-	protected transient int _size = 0;
-	protected transient int _hashCode = 0;
-
-	public TreeArray() {
-	}
-
-	/** Constructor with a collection.
-	 * @param c the collection to add; null to ignore
-	 */
-	public TreeArray(Collection c) {
-		this();
-		if (c != null)
-			addAll(c);
-	}
-
-	//-- its own extension --//
-	/**
-	 * Adds an element by its natural ordering.
-	 * This array must be sorted into ascending order according to
-	 * the natural ordering. To sort, either sort
-	 * or add all elements by order.
-	 * &lt;p&gt;All elements are assumed to implement Comparable.
-	 */
-	public final void addByOrder(Object element) {
-		int j = search(element);
-		if (j &lt; 0)
-			j = -j-1;
-		add(j, element);
-	}
-	/**
-	 * Adds an element by the specified comparator.
-	 * This array must be sorted into ascending order according to
-	 * the specified comparator. To sort, either sort
-	 * or add all elements by order.
-	 */
-	public final void addByOrder(Object element, Comparator c) {
-		int j = search(element, c);
-		if (j &lt; 0)
-			j = -j-1;
-		add(j, element);
-	}
-
-	/**
-	 * Removes an element by its natural ordering.
-	 * This array must be sorted into ascending order according to
-	 * the natural ordering. To sort, either sort
-	 * or add all elements by order.
-	 * &lt;p&gt;All elements are assumed to implement Comparable.
-	 */
-	public final boolean removeByOrder(Object element) {
-		int j = search(element);
-		if (j &gt;= 0) {
-			remove(j);
-			return true;
-		}
-		return false;
-	}
-	/**
-	 * Removes an element by the specified comparator.
-	 * This array must be sorted into ascending order according to
-	 * the specified comparator. To sort, either sort
-	 * or add all elements by order.
-	 */
-	public final boolean removeByOrder(Object element, Comparator c) {
-		int j = search(element, c);
-		if (j &gt;= 0) {
-			remove(j);
-			return true;
-		}
-		return false;
-	}
-
-	/**
-	 * Adds all elements by their natural ordering.
-	 * This array must be sorted into ascending order according to
-	 * the natural ordering. To sort, either sort
-	 * or add all elements by order.
-	 * &lt;p&gt;All elements are assumed to implement Comparable.
-	 */
-	public final void addAllByOrder(Collection cn) {
-		for (Iterator it = cn.iterator(); it.hasNext();)
-			addByOrder(it.next());
-	}
-	/**
-	 * Adds all elements by the specified comparator.
-	 * This array must be sorted into ascending order according to
-	 * the specified comparator. To sort, either sort
-	 * or add all elements by order.
-	 */
-	public final void addAllByOrder(Collection cn, Comparator c) {
-		for (Iterator it = cn.iterator(); it.hasNext();)
-			addByOrder(it.next(), c);
-	}
-
-	/**
-	 * Searches an element by its natural ordering.
-	 * This array must be sorted into ascending order according to
-	 * the natural ordering. To sort, either sort
-	 * or add all elements by order, {@link #addByOrder(Object)}.
-	 *
-	 * &lt;p&gt;All elements are assumed to implement Comparable.
-	 * Note: the element argument of this method is passed as the argument 
-	 * of the compareTo method. Thus, it is OK to pass any kind of object,
-	 * as long as the elements stored in this array is able to detect it.
-	 *
-	 * &lt;p&gt;For example, you might use a String to search the element,
-	 * and your element's compareTo shall be implemented as follows.
-	 *
-	 * &lt;pre&gt;&lt;code&gt;public int compareTo(Object o) {
-	 *  return o instanceof String ?
-	 *		_name.compareTo((String)o):
-	 *		_name.compareTo(((YourClass)o).getName());
-	 *}
-	 */
-	public final int search(Object element) {
-		return Collections.binarySearch(this, element);
-	}
-	/**
-	 * Searches an element by the specified comparator.
-	 * This array must be sorted into ascending order according to
-	 * the specified comparator. To sort, either sort
-	 * or add all elements by order, {@link #addByOrder(Object, Comparator)}.
-	 *
-	 * &lt;p&gt;All elements are assumed to implement Comparable.
-	 * Note: the element argument of this method is passed as the argument 
-	 * of the compareTo method. Thus, it is OK to pass any kind of object,
-	 * as long as the elements stored in this array is able to detect it.
-	 */
-	public final int search(Object element, Comparator c) {
-		return Collections.binarySearch(this, element, c);
-	}
-	/**
-	 * Gets an element by its natural ordering.
-	 * It is a shortcut of get(search(element)).
-	 *
-	 * @see #search(Object)
-	 * @return null if not found
-	 */
-	public final Object getByOrder(Object element) {
-		int j = search(element);
-		return j &gt;= 0 ? get(j): null;
-	}
-	/**
-	 * Gets an element by its natural ordering.
-	 * It is a shortcut of get(search(element, c)).
-	 *
-	 * @see #search(Object, Comparator)
-	 * @return null if not found
-	 */
-	public final Object getByOrder(Object element, Comparator c) {
-		int j = search(element, c);
-		return j &gt;= 0 ? get(j): null;
-	}
-	/**
-	 * Sorts all elements ascendingly by the natural ordering.
-	 * &lt;p&gt;All elements are assumed to implement Comparable.
-	 */
-	public final void sort() {
-		Collections.sort(this);
-	}
-	/**
-	 * Sorts all elements ascendingly by the specified comparator.
-	 */
-	public final void sort(Comparator c) {
-		Collections.sort(this, c);
-	}
-
-	//-- overriding AbstractList --//
-	public final int size() {
-		return _size;
-	}
-
-    public final Object get(int index) {
-    	return getRbEntry(index).getElement();
-    }
-
-	public Object set(int index, Object element) {
-		RbEntry p = getRbEntry(index);
-		Object old = p.getElement();
-		p.setElement(element);
-		return old;
-	}
-
-	public void add(int index, Object element) {
-		addEntry(index, element);
-	}
-
-	public Object remove(int index) {
-		RbEntry p = getRbEntry(index);
-		delete(p);
-		return p.getElement();
-	}
-
-	public final Iterator iterator() {
-		return listIterator();
-	}
-
-	public final ListIterator listIterator(int index) {
-		return new Iter(index);
-	}
-
-	/**
-	 * Clears the whole list. Overrides it if the derived class has
-	 * other data to clear. Note it doesn't call removeEx.
-	 *
-	 * &lt;p&gt;Note clear actually invokes RbEntry.clear to do the real
-	 * cleanup. Deriving classes might override RbEntry.clear.
-	 */
-	public void clear() {
-		if (_root != null) {
-			_root.clear();
-			modCount++;
-			_size = 0;
-			_root = null;
-		}
-	}
-
-	//-- overriding ListX --//
-	protected final RbEntry getRbEntry(int index) {
-		checkRange(index);
-
-		int baseIndex = 0;
-		RbEntry p = _root;
-		do {
-			int thisIndex = baseIndex + p.leftNum;
-			if (index == thisIndex) {
-				return p;
-			} else if (index &lt; thisIndex) {
-				p = p.left;
-			} else {
-				baseIndex = thisIndex + 1;
-				p = p.right;
-			}
-		} while (p != null); //it might be modified by someone else
-		throw new ConcurrentModificationException();
-	}
-
-	public final Entry getEntry(int index) {
-		return getRbEntry(index);
-	}
-
-	protected final int indexOfEntry(RbEntry p) {
-		if (p.orphan)
-			return -1;
-
-		int v = p.leftNum;
-		RbEntry lowParent = p.firtLeftAncestor();
-		if (lowParent != null)
-			 v += indexOfEntry(lowParent) + 1;
-		return v;
-	}	
-
-	public final int indexOfEntry(Entry p) {
-		return indexOfEntry((RbEntry)p);
-	}
-
-	public int hashCode() {
-		if (_hashCode == 0)
-			_hashCode = super.hashCode();
-		return _hashCode;
-	}
-
-	//-- Extra features --//
-	public final ListIterator entryIterator(int index) {
-		return new EntryIter(index);
-	}
-	public final ListIterator entryIterator() {
-		return new EntryIter(0);
-	}
-
-	/**
-	 * Creates an instance of RbEntry. Override it if necessary
-	 */
-	protected RbEntry newEntry(Object element) {
-		return new RbEntry(element);
-	}
-
-	public final Entry addEntry(Entry insertBefore, Object element) {
-		return insert(checkNotOrphan(insertBefore), newEntry(element));
-	}
-
-	public final Entry addEntry(int index, Object element) {
-		return insert(index, newEntry(element));
-	}
-
-	public final Entry addEntry(Object element) {
-		return addEntry(_size, element);
-	}
-
-	public final void removeEntry(Entry p) {
-		delete(checkNotOrphan(p));
-	}
-
-	public final Entry removeEntry(int index) {
-		return delete(index);
-	}
-
-	//-- utilities --/
-	/** Returns the first node. */
-	protected final RbEntry first() {
-		return _root==null ? null: _root.leftMost();
-	}
-
-	private static final boolean colorOf(RbEntry p) {
-		return (p == null ? BLACK : p.color);
-	}
-
-	private static final RbEntry  parentOf(RbEntry p) {
-		return (p == null ? null: p.parent);
-	}
-
-	private static final void setColor(RbEntry p, boolean c) {
-		if (p != null)  p.color = c;
-	}
-
-	private static final RbEntry leftOf(RbEntry p) {
-		return (p == null)? null: p.left;
-	}
-
-	private static final RbEntry rightOf(RbEntry p) {
-		return (p == null)? null: p.right;
-	}
-
-	protected final RbEntry insert(int index, RbEntry p) {
-		checkRangePlus(index); //index==_size is ok
-		return insert(index&lt;_size ? getRbEntry(index): null, p);
-	}
-
-	private static final void changeAncestorLeftNum(RbEntry p, int diff) {
-		for (; p.parent!=null; p=p.parent)
-			if (p.parent.left == p)
-				p.parent.leftNum += diff;
-	}
-
-	/**
-	 * All add methods are done thru this method. Override it if necessary.
-	 *
-	 * &lt;p&gt;Note: p is inserted &lt;b&gt;before&lt;/b&gt; insertBefore.
-	 */
-	protected RbEntry insert(RbEntry insertBefore, final RbEntry p) {
-		assert !p.orphan;
-		if (_root == null) {
-			_root = p;
-		} else {
-			if (insertBefore != null &amp;&amp; insertBefore.left == null) {
-				insertBefore.left = p;
-			} else {
-				insertBefore = insertBefore==null ? _root: insertBefore.left;
-				insertBefore = insertBefore.rightMost();
-				insertBefore.right = p;
-			}
-			p.parent = insertBefore;
-
-			changeAncestorLeftNum(p, 1);
-		}
-
-		fixAfterInsert(p); //fix up for red-black rule
-		incSize();
-		return p;
-	}
-
-	private final void rotateLeft(RbEntry x) {
-		RbEntry y = x.right;
-		x.right = y.left;
-		if (y.left != null)
-			y.left.parent = x;
-		y.parent = x.parent;
-		if (x.parent == null)
-			_root = y;
-		else if (x.parent.left == x)
-			x.parent.left = y;
-		else
-			x.parent.right = y;
-		y.left = x;
-		x.parent = y;
-
-		y.leftNum += x.leftNum+1;
-	}
-
-	private final void rotateRight(RbEntry y) {
-		RbEntry x = y.left;
-		y.left = x.right;
-		if (x.right != null)
-			x.right.parent = y;
-		x.parent = y.parent;
-		if (y.parent == null)
-			_root = x;
-		else if (y.parent.right == y)
-			y.parent.right = x;
-		else
-			y.parent.left = x;
-		x.right = y;
-		y.parent = x;
-
-		y.leftNum -= x.leftNum+1;
-	}
-
-	private final void fixAfterInsert(RbEntry x) {
-		x.color = RED;
-		while (x!=null &amp;&amp; x!=_root &amp;&amp; x.parent.color==RED) {
-			if (parentOf(x) == leftOf(parentOf(parentOf(x)))) {
-				RbEntry y = rightOf(parentOf(parentOf(x)));
-				if (colorOf(y) == RED) {
-					setColor(parentOf(x), BLACK);
-					setColor(y, BLACK);
-					setColor(parentOf(parentOf(x)), RED);
-					x = parentOf(parentOf(x));
-				} else {
-					if (x == rightOf(parentOf(x))) {
-						x = parentOf(x);
-						rotateLeft(x);
-					}
-					setColor(parentOf(x), BLACK);
-					setColor(parentOf(parentOf(x)), RED);
-					if (parentOf(parentOf(x)) != null)
-						rotateRight(parentOf(parentOf(x)));
-				}
-			} else {
-				RbEntry y = leftOf(parentOf(parentOf(x)));
-				if (colorOf(y) == RED) {
-					setColor(parentOf(x), BLACK);
-					setColor(y, BLACK);
-					setColor(parentOf(parentOf(x)), RED);
-					x = parentOf(parentOf(x));
-				} else {
-					if (x == leftOf(parentOf(x))) {
-						x = parentOf(x);
-						rotateRight(x);
-					}
-					setColor(parentOf(x),  BLACK);
-					setColor(parentOf(parentOf(x)), RED);
-					if (parentOf(parentOf(x)) != null)
-						rotateLeft(parentOf(parentOf(x)));
-				}
-			}
-		}//while
-		_root.color = BLACK;
-	}
-
-	protected RbEntry delete(int index) {
-		RbEntry p = getRbEntry(index);
-		delete(p);
-		return p;
-	}
-
-	/**
-	 * All remove methods are done thru this method. Override it if necessary.
-	 */
-	protected void delete(RbEntry p) {
-		assert !p.orphan;
-		if (p.left!=null &amp;&amp; p.right!=null)
-			swapPosition(p.nextEntry(), p);
-				//Make sure at least one of left or right is null by
-				//swapping with next, whose left is null (right.leftMost)
-
-		changeAncestorLeftNum(p, -1);
-		decSize();
-
-		RbEntry replacement = (p.left != null ? p.left : p.right);
-		if (replacement != null) {
-			replacement.parent = p.parent;
-			if (p.parent == null) 
-				_root = replacement;
-			else if (p == p.parent.left)
-				p.parent.left  = replacement;
-			else
-				p.parent.right = replacement;
-
-			if (p.color == BLACK)
-				fixAfterDelete(replacement);
-		} else { // No children
-			if (p.parent == null) // size==1
-				_root = null;
-			else if (p == p.parent.left)
-					p.parent.left = null;
-			else if (p == p.parent.right)
-					p.parent.right = null;
-		}
-		p.setOrphan();
-	}
-
-	/**
-	 * Swap the linkages of two nodes in a tree. We cannot only swap the
-	 * element field because the binding of entry and element have to remain.
-	 */
-	private final void swapPosition(RbEntry x, RbEntry y) {
-		// Save initial values.
-		RbEntry px = x.parent, lx = x.left, rx = x.right;
-		RbEntry py = y.parent, ly = y.left, ry = y.right;
-		boolean xWasLeftChild = px != null &amp;&amp; x == px.left;
-		boolean yWasLeftChild = py != null &amp;&amp; y == py.left;
-
-		// Swap, handling special cases of one being the other's parent.
-		if (x == py) {  // x was y's parent
-			x.parent = y;
-			if (yWasLeftChild) {
-				y.left = x;
-				y.right = rx;
-			} else {
-				y.right = x;
-				y.left = lx;
-			}
-		} else {
-			x.parent = py;
-			if (py != null) {
-				if (yWasLeftChild)
-					py.left = x;
-				else
-					py.right = x;
-			}
-			y.left = lx;
-			y.right = rx;
-		}
-
-		if (y == px) { // y was x's parent
-			y.parent = x;
-			if (xWasLeftChild) {
-				x.left = y;
-				x.right = ry;
-			} else {
-				x.right = y;
-				x.left = ly;
-			}
-		} else {
-			y.parent = px;
-			if (px != null) {
-				if (xWasLeftChild)
-					px.left = y;
-				else
-					px.right = y;
-			}
-			x.left = ly;
-			x.right = ry;
-		}
-
-		// Fix children's parent pointers
-		if (x.left != null)
-			x.left.parent = x;
-		if (x.right != null)
-			x.right.parent = x;
-		if (y.left != null)
-			y.left.parent = y;
-		if (y.right != null)
-			y.right.parent = y;
-
-		// Swap colors
-		boolean c = x.color;
-		x.color = y.color;
-		y.color = c;
-
-		// Swap leftNum
-		int v = x.leftNum;
-		x.leftNum = y.leftNum;
-		y.leftNum = v;
-
-		// Check if root changed
-		if (_root == x)
-			_root = y;
-		else if (_root == y)
-			_root = x;
-	}
-
-	private void fixAfterDelete(RbEntry x) {
-		while (x != _root &amp;&amp; colorOf(x) == BLACK) {
-			if (x == leftOf(parentOf(x))) {
-				RbEntry sib = rightOf(parentOf(x));
-
-				if (colorOf(sib) == RED) {
-					setColor(sib, BLACK);
-					setColor(parentOf(x), RED);
-					rotateLeft(parentOf(x));
-					sib = rightOf(parentOf(x));
-				}
-
-				if (colorOf(leftOf(sib))  == BLACK &amp;&amp;
-					colorOf(rightOf(sib)) == BLACK) {
-					setColor(sib,  RED);
-					x = parentOf(x);
-				} else {
-					if (colorOf(rightOf(sib)) == BLACK) {
-						setColor(leftOf(sib), BLACK);
-						setColor(sib, RED);
-						rotateRight(sib);
-						sib = rightOf(parentOf(x));
-					}
-					setColor(sib, colorOf(parentOf(x)));
-					setColor(parentOf(x), BLACK);
-					setColor(rightOf(sib), BLACK);
-					rotateLeft(parentOf(x));
-					x = _root;
-				}
-			} else { // symmetric
-				RbEntry sib = leftOf(parentOf(x));
-
-				if (colorOf(sib) == RED) {
-					setColor(sib, BLACK);
-					setColor(parentOf(x), RED);
-					rotateRight(parentOf(x));
-					sib = leftOf(parentOf(x));
-				}
-
-				if (colorOf(rightOf(sib)) == BLACK &amp;&amp;
-					colorOf(leftOf(sib)) == BLACK) {
-					setColor(sib,  RED);
-					x = parentOf(x);
-				} else {
-					if (colorOf(leftOf(sib)) == BLACK) {
-						setColor(rightOf(sib), BLACK);
-						setColor(sib, RED);
-						rotateLeft(sib);
-						sib = leftOf(parentOf(x));
-					}
-					setColor(sib, colorOf(parentOf(x)));
-					setColor(parentOf(x), BLACK);
-					setColor(leftOf(sib), BLACK);
-					rotateRight(parentOf(x));
-					x = _root;
-				}
-			}
-		}
-
-		setColor(x, BLACK);
-	}
-
-	protected final void incSize() {modCount++; _size++; }
-	protected final void decSize() {modCount++; _size--; }
-
-	protected final void checkRange(int index) {
-		if (index &gt;= _size || index &lt; 0)
-			indexOutOfBounds(index);
-	}
-
-	protected final void checkRangePlus(int index) {
-		if (index &gt; _size || index &lt; 0)
-			indexOutOfBounds(index);
-	}
-
-	protected final void indexOutOfBounds(int index) {
-		throw new IndexOutOfBoundsException(
-				"Index: " + index + ", Size: " + _size);
-	}
-
-	/**
-	 * Converts and checks whether it is not orphan
-	 */
-	protected final RbEntry checkNotOrphan(Entry entry) {
-		RbEntry p = (RbEntry)entry;
-		if (p.orphan)
-			throw new IllegalStateException();
-		return p;
-	}
-
-	private class EntryIter implements ListIterator {
-		private RbEntry _cursor;
-		private RbEntry _lastRet = null;
-		private int _expectedModCount;
-
-		private EntryIter(int index) {
-			checkRangePlus(index); //index==_size is ok
-
-			_cursor = index&lt;_size ? getRbEntry(index): null;
-			_expectedModCount = modCount;
-		}
-		
-		public final boolean hasNext() {
-			checkComodification();
-			return _cursor != null;
-		}
-		public Object next() {
-			checkComodification();
-
-			if (_cursor == null)
-				throw new NoSuchElementException();
-
-			_lastRet = _cursor;
-			Object obj = _cursor;
-			_cursor = _cursor.nextEntry();
-			return obj;
-		}
-
-		public final boolean hasPrevious() {
-			checkComodification();
-			if (_cursor == null)
-				return _size &gt; 0;
-			else
-				return _cursor.previousEntry() != null;
-		}
-		public Object previous() {
-			checkComodification();
-
-			if (_cursor == null) {
-				if (_size == 0)
-					throw new NoSuchElementException();
-				_cursor = getRbEntry(_size-1);
-			} else {
-				RbEntry prev = _cursor.previousEntry();
-				if (prev == null)
-					throw new NoSuchElementException();
-				_cursor = prev;
-			}
-			_lastRet = _cursor;
-			return _cursor;
-		}
-
-		public final int nextIndex() {
-			return _cursor==null ? _size: indexOfEntry(_cursor);
-		}
-		public final int previousIndex() {
-			return _cursor==null ? _size-1: indexOfEntry(_cursor)-1;
-		}
-
-		public final void remove() {
-			if (_lastRet == null)
-				throw new IllegalStateException();
-
-			checkComodification();
-
-			if (_lastRet == _cursor)
-				_cursor = _cursor.nextEntry();
-
-			delete(_lastRet);
-			_expectedModCount = modCount;
-			_lastRet = null;
-		}
-
-		public final void set(Object obj) {
-			if (_lastRet == null)
-				throw new IllegalStateException();
-
-			checkComodification();
-
-			_lastRet.setElement(obj);
-			//no need to update _expectdModCount here
-		}
-		public final Object get() {
-			return _lastRet.getElement();
-		}
-
-		public final void add(Object obj) {
-			checkComodification();
-
-			insert(_cursor, newEntry(obj));
-			_expectedModCount = modCount;
-		}
-
-		private final void checkComodification() {
-			if (modCount != _expectedModCount)
-				throw new ConcurrentModificationException();
-		}
-	}//EntryIter
-
-	private class Iter extends EntryIter {
-		private Iter(int index) {
-			super(index);
-		}
-		public final Object next() {
-			return ((RbEntry)super.next()).getElement();
-		}
-		public final Object previous() {
-			return ((RbEntry)super.previous()).getElement();
-		}
-	}//Iter
-
-	//-- cloneable --//
-	public Object clone() {
-		TreeArray clone;
-		try {
-			clone = (TreeArray)super.clone();
-		}catch(CloneNotSupportedException e) {
-			throw new InternalError();
-		}
-
-		//Put clone into "virgin" state
-		clone._size = 0;
-		clone._root = null;
-		clone.modCount = 0;
-
-		// Initialize clone with our elements
-		for (RbEntry p = first(); p != null; p = p.nextEntry())
-		    clone.add(p.getElement());
-
-		return clone;
-	}
-
-	//-- Serializable --//
-	//NOTE: they must be declared as private
-	private synchronized void writeObject(java.io.ObjectOutputStream s)
-	throws java.io.IOException {
-		s.defaultWriteObject();
-
-        s.writeInt(_size);
-
-		for (RbEntry p = first(); p != null; p = p.nextEntry())
-			s.writeObject(p.getElement());
-	}
-
-	private synchronized void readObject(java.io.ObjectInputStream s)
-	throws java.io.IOException, ClassNotFoundException {
-		s.defaultReadObject();
-
-		int size = s.readInt();
-
-		for (int i=0; i&lt;size; i++)
-			add(s.readObject());
-	}
-}

Deleted: branches/6.0/zk/src/org/zkoss/zk/ui/http/Standalones.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/http/Standalones.java	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/http/Standalones.java	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,201 +0,0 @@
-/* Standalones.java
-
-	Purpose:
-		
-	Description:
-		
-	History:
-		Tue Aug 10 08:48:59 TST 2010, Created by tomyeh
-
-Copyright (C) 2009 Potix Corporation. All Rights Reserved.
-
-*/
-package org.zkoss.zk.ui.http;
-
-import java.io.Writer;
-import java.io.IOException;
-
-import javax.servlet.ServletContext;
-import javax.servlet.ServletException;
-import javax.servlet.http.HttpServletRequest;
-import javax.servlet.http.HttpServletResponse;
-
-import org.zkoss.lang.Library;
-import org.zkoss.web.servlet.http.Https;
-
-import org.zkoss.zk.ui.WebApp;
-import org.zkoss.zk.ui.Session;
-import org.zkoss.zk.ui.Execution;
-import org.zkoss.zk.ui.Executions;
-import org.zkoss.zk.ui.Desktop;
-import org.zkoss.zk.ui.Page;
-import org.zkoss.zk.ui.Component;
-import org.zkoss.zk.ui.Richlet;
-import org.zkoss.zk.ui.GenericRichlet;
-import org.zkoss.zk.ui.metainfo.PageDefinitions;
-import org.zkoss.zk.ui.sys.HtmlPageRenders;
-import org.zkoss.zk.ui.sys.WebAppCtrl;
-import org.zkoss.zk.ui.sys.UiFactory;
-import org.zkoss.zk.ui.sys.SessionCtrl;
-import org.zkoss.zk.ui.sys.RequestInfo;
-import org.zkoss.zk.ui.impl.Attributes;
-import org.zkoss.zk.ui.impl.RequestInfoImpl;
-
-/**
- * Utilities to make a component as a JSF, JSP, Zimlet or other compliant
- * standalone component.
- * Being a standalone component allows application developers to use a component
- * without knowing the existence of ZK. For example, ZK Spreadsheet for JSF
- * is a JSF component running in a JSF page.
- *
- * &lt;p&gt;To use a standalone component, ZK Update Engine
- * ({@link org.zkoss.zk.au.http.DHtmlUpdateServlet}) is still required,
- * while ZK Loader ({@link DHtmlLayoutServlet}) is not needed (though not hurt).
- * If ZK Loader not installed, it assumes the update URI is "/zkau", which
- * can be overriden by setting a library property called
- * "org.zkoss.zk.ui.standalone.updateURI".
- *
- * &lt;p&gt;Example:
-&lt;pre&gt;&lt;code&gt;
-	Calendar cal = new Calendar();
-	Standalones.output(config.getServletContext(), request, response, cal, null, out);
-&lt;/code&gt;&lt;/pre&gt;
- *
- * @author tomyeh
- * @since 5.0.4
- */
-public class Standalones {
-	/** Outputs the HTML tags of the given component to the given writer.
-	 * @param comp the component to output (never null). It might have child components.
-	 * @param path the request path. If null, the servlet path is assumed.
-	 * @param out the output (never null).
-	 */
-	public static final void output(ServletContext ctx,
-	HttpServletRequest request, HttpServletResponse response,
-	Component comp, String path, Writer out)
-	throws ServletException, IOException {
-		if (comp == null)
-			throw new IllegalArgumentException();
-		if (path == null)
-			path = Https.getThisServletPath(request);
-
-		WebManager webman = WebManager.getWebManagerIfAny(ctx);
-		if (webman == null) {
-			final String ATTR = "org.zkoss.zk.ui.standalone.updateURI";
-			String updateURI = Library.getProperty(ATTR);
-			if (updateURI == null)
-				updateURI = "/zkau";
-			else
-				updateURI = DHtmlLayoutServlet.fixUpdateURI(updateURI, ATTR);
-			webman = new WebManager(ctx, updateURI);
-		}
-
-		final Session sess = WebManager.getSession(ctx, request);
-		final WebApp wapp = sess.getWebApp();
-		final WebAppCtrl wappc = (WebAppCtrl)wapp;
-		final Object old = I18Ns.setup(sess, request, response,
-			wapp.getConfiguration().getResponseCharset());
-		Execution exec = null;
-		try {
-			final Desktop desktop = webman.getDesktop(sess, request, response, path, true);
-			if (desktop == null) //forward or redirect
-				return;
-
-			final RequestInfo ri = new RequestInfoImpl(
-				wapp, sess, desktop, request,
-				PageDefinitions.getLocator(wapp, path));
-			sess.setAttribute(Attributes.GAE_FIX, new Integer(0));
-			((SessionCtrl)sess).notifyClientRequest(true);
-
-			final UiFactory uf = wappc.getUiFactory();
-			final Richlet richlet = new StandaloneRichlet(comp);
-
-			final Page page = WebManager.newPage(uf, ri, richlet, response, path);
-			exec = new ExecutionImpl(ctx, request, response, desktop, page);
-			exec.setAttribute(Attributes.PAGE_REDRAW_CONTROL, "page");
-			exec.setAttribute(Attributes.PAGE_RENDERER, new PageRenderer(exec));
-
-			wappc.getUiEngine().execNewPage(exec, richlet, page, out);
-					//no need to set device type here, since UiEngine will do it later
-		} finally {
-			I18Ns.cleanup(request, old);
-			if (exec != null) {
-				exec.removeAttribute(Attributes.PAGE_REDRAW_CONTROL);
-				exec.removeAttribute(Attributes.PAGE_RENDERER);
-			}
-		}
-	}
-	//Supporting classes//
-	private static class StandaloneRichlet extends GenericRichlet {
-		private final Component _comp;
-		private StandaloneRichlet(Component comp) {
-			_comp = comp;
-		}
-		//@Override
-		public void service(Page page) {
-			_comp.setPage(page);
-		}
-	}
-
-	/**
-	 * A special page renderer that renders a page without generating
-	 * the HTML tag of the page.
-	 * In other words, it generates all components directly.
-	 * @author tomyeh
-	 * @since 5.0.4
-	 */
-	public static class PageRenderer implements org.zkoss.zk.ui.sys.PageRenderer {
-		private final Execution _exec;
-		/** Default constructor.
-		 * It is the same as &lt;code&gt;PageRenderer(Executions.getCurrent())&lt;/code&gt;.
-		 */
-		public PageRenderer() {
-			this(Executions.getCurrent());
-		}
-		public PageRenderer(Execution exec) {
-			_exec = exec;
-		}
-
-		//@Override
-		public void render(Page page, Writer out) throws IOException {
-			final Desktop desktop = _exec.getDesktop();
-
-			out.write(HtmlPageRenders.outLangStyleSheets(_exec, null, null));
-			out.write(HtmlPageRenders.outLangJavaScripts(_exec, null, null));
-
-			out.write("&lt;script type=\"text/javascript\"&gt;zkpb('");
-			out.write(page.getUuid());
-			out.write("','");
-			out.write(desktop.getId());
-			out.write("','");
-			out.write(getContextURI());
-			out.write("','");
-			out.write(desktop.getUpdateURI(null));
-			out.write("','");
-			out.write(desktop.getRequestPath());
-			out.write('\'');
-
-			String style = page.getStyle();
-			if (style != null &amp;&amp; style.length() &gt; 0) {
-				out.write(",{style:'");
-				out.write(style);
-				out.write("'}");
-			}
-
-			out.write(");zkpe();&lt;/script&gt;\n");
-
-			for (Component root = page.getFirstRoot(); root != null;
-			root = root.getNextSibling()) {
-				HtmlPageRenders.outStandalone(_exec, root, out);
-			}
-		}
-		private String getContextURI() {
-			if (_exec != null) {
-				String s = _exec.encodeURL("/");
-				int j = s.lastIndexOf('/'); //might have jsessionid=...
-				return j &gt;= 0 ? s.substring(0, j) + s.substring(j + 1): s;
-			}
-			return "";
-		}
-	}
-}

Deleted: branches/6.0/zkdemo/src/archive/test/standalone.jsp
===================================================================
--- branches/6.0/zkdemo/src/archive/test/standalone.jsp	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/6.0/zkdemo/src/archive/test/standalone.jsp	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,24 +0,0 @@
-&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" target="_new">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"&gt;
-&lt;%@page import="org.zkoss.zk.ui.http.Standalones"%&gt;
-&lt;%@page import="org.zkoss.zul.Calendar"%&gt;
-&lt;%@page import="org.zkoss.zul.Listbox"%&gt;
-&lt;%@page import="org.zkoss.zul.Listitem"%&gt;
-&lt;html&gt;
-	&lt;head&gt;
-		&lt;title&gt;Test of Standalone Component&lt;/title&gt;
-	&lt;/head&gt;
-	&lt;body style="height:auto"&gt;
-		&lt;p&gt;This is a test of standalone component: calendar.&lt;/p&gt;
-		&lt;%
-	Calendar cal = new Calendar();
-	Standalones.output(config.getServletContext(), request, response, cal, null, out);
-		%&gt;
-		&lt;p&gt;This is another component: listbox&lt;/p&gt;
-		&lt;%
-	Listbox listbox = new Listbox();
-	listbox.appendChild(new Listitem("Item 1"));
-	listbox.appendChild(new Listitem("Item 2"));
-	Standalones.output(config.getServletContext(), request, response, listbox, null, out);
-		%&gt;
-	&lt;/body&gt;
-&lt;/html&gt;
\ No newline at end of file

Deleted: branches/6.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1ArrayGroupsModel.java
===================================================================
--- branches/6.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1ArrayGroupsModel.java	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/6.0/zkdemo/src/org/zkoss/zkdemo/test2/group/Test1ArrayGroupsModel.java	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,46 +0,0 @@
-/* Test1ArrayGroupsModel.java
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Sep 3, 2008 12:10:32 PM     2008, Created by Dennis.Chen
-}}IS_NOTE
-
-Copyright (C) 2007 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-	This program is distributed under GPL Version 3.0 in the hope that
-	it will be useful, but WITHOUT ANY WARRANTY.
-}}IS_RIGHT
-*/
-package org.zkoss.zkdemo.test2.group;
-
-import java.util.Comparator;
-
-import org.zkoss.zul.ArrayGroupsModel;
-
-/**
- * @author Dennis.Chen
- *
- */
-public class Test1ArrayGroupsModel extends ArrayGroupsModel{
-	public Test1ArrayGroupsModel(Object[] data,Comparator cmpr){
-		super(data,cmpr,0);
-	}
-	protected Object createGroupHead(Object[] groupdata,int index,int col) {
-		String s1 = ((String)groupdata[0]);
-		return "Group "+s1.charAt(col==0?0:s1.length()-1)+" : "+groupdata.length+" Items";
-	}
-	
-	protected Object createGroupFoot(Object[] groupdata,int index, int col) {
-		int total = 0;
-		for(int i=0;i&lt;groupdata.length;i++){
-			String s1 = ((String)groupdata[i]);
-			total += Integer.parseInt(""+s1.charAt(s1.length()-1));
-		}
-		return "Total:"+total;
-	}
-}

Deleted: branches/6.0/zul/src/org/zkoss/zul/ArrayGroupsModel.java
===================================================================
--- branches/6.0/zul/src/org/zkoss/zul/ArrayGroupsModel.java	2010-09-28 08:23:55 UTC (rev 14289)
+++ branches/6.0/zul/src/org/zkoss/zul/ArrayGroupsModel.java	2010-09-28 08:34:28 UTC (rev 14290)
@@ -1,295 +0,0 @@
-/*ArrayGroupsModel.java
-
-	Purpose:
-		
-	Description:
-		
-	History:
-		Sep 3, 2008 9:50:12 AM     2008, Created by Dennis.Chen
-
-Copyright (C) 2007 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-	This program is distributed under LGPL Version 3.0 in the hope that
-	it will be useful, but WITHOUT ANY WARRANTY.
-}}IS_RIGHT
-*/
-package org.zkoss.zul;
-
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.Comparator;
-import java.util.List;
-
-import org.zkoss.util.ArraysX;
-import org.zkoss.zul.event.GroupsDataEvent;
-
-/**
- * An array implementation of {@link GroupsModel}.
- * This implementation supports regroup array to groups depends on {@link Comparator} and {@link GroupComparator}.
- * 
- * @author Dennis.Chen
- * @since 3.5.0
- * @see GroupsModel
- * @see SimpleGroupsModel
- */
-public class ArrayGroupsModel extends AbstractGroupsModel implements GroupsModelExt{
-	
-	/**
-	 * member field to store native array data
-	 */
-	protected Object[] _nativedata;
-	
-	/**
-	 * member field to store Comparator for initial grouping.
-	 */
-	protected Comparator _comparator;
-	
-	/**
-	 * member field to store group data
-	 */
-	protected Object[][] _data;
-	
-	/**
-	 * member field to store group head data
-	 */
-	protected Object[] _heads;
-	
-	/**
-	 * member field to store group foot data
-	 */
-	protected Object[] _foots;
-	
-	/**
-	 * member field to store group close status
-	 */
-	protected boolean[] _closes;
-	
-	/**
-	 * Constructor
-	 * @param data an array data to be grouping.
-	 * @param cmpr a comparator implementation help group the data. you could implements {@link GroupComparator} to do more grouping control.&lt;br/&gt;
-	 * At 1st phase, it calls {@link Comparator#compare(Object, Object)} or {@link GroupComparator#compareGroup(Object, Object)} to sort the data.&lt;br/&gt;
-	 * At 2nd phase, it calls {@link Comparator#compare(Object, Object)} or {@link GroupComparator#compareGroup(Object, Object)} to decide which data belong to which group. 
-	 * In this phase it also invoke {@link #createGroupHead(Object[], int, int)} and {@link #createGroupFoot(Object[], int, int)} to create head of foot Object of each group.&lt;br/&gt;
-	 * At 3rd phase, it calls {@link Comparator#compare(Object, Object)} to sort data in each group.&lt;br/&gt;
-	 */
-	public ArrayGroupsModel(Object[] data,Comparator cmpr){
-		this(data,cmpr,0);
-	}
-	/**
-	 * 
-	 * @param data an array data to be grouping.
-	 * @param cmpr a comparator implementation help group the data. you could implements {@link GroupComparator} to do more grouping control.&lt;br/&gt;
-	 * At 1st phase, it calls {@link Comparator#compare(Object, Object)} or {@link GroupComparator#compareGroup(Object, Object)} to sort the data.&lt;br/&gt;
-	 * At 2nd phase, it calls {@link Comparator#compare(Object, Object)} or {@link GroupComparator#compareGroup(Object, Object)} to decide which data belong to which group. 
-	 * In this phase it also invoke {@link #createGroupHead(Object[], int, int)} and {@link #createGroupFoot(Object[], int, int)} to create head of foot Object of each group.&lt;br/&gt;
-	 * At 3rd phase, it calls {@link Comparator#compare(Object, Object)} to sort data in each group.&lt;br/&gt;
-	 * @param col column index associate with cmpr.
-	 */
-	public ArrayGroupsModel(Object[] data,Comparator cmpr, int col){
-		if (data == null || cmpr == null)
-			throw new IllegalArgumentException("null parameter");
-		_nativedata = (Object[])ArraysX.duplicate(data);
-		_comparator = cmpr;
-		group(_comparator,true,col);
-	}
-
-	public Object getChild(int groupIndex, int index) {
-		return _data[groupIndex][index];
-	}
-
-
-	public int getChildCount(int groupIndex) {
-		return _data[groupIndex].length;
-	}
-
-
-	public Object getGroup(int groupIndex) {
-		return  _heads==null?_data[groupIndex]:_heads[groupIndex];
-	}
-
-
-	public int getGroupCount() {
-		return _data.length;
-	}
-
-	public Object getGroupfoot(int groupIndex) {
-		return _foots == null ? null:_foots[groupIndex];
-	}
-
-	public boolean hasGroupfoot(int groupIndex) {
-		return _foots == null ? false:_foots[groupIndex]!=null;
-	}
-
-	public void sort(Comparator cmpr, boolean ascending, int col) {
-		sortAllGroupData(cmpr,ascending,col);
-
-		fireEvent(GroupsDataEvent.GROUPS_CHANGED,-1,-1,-1);
-	}
-
-	public void group(final Comparator cmpr, boolean ascending, int col) {
-		Comparator cmprx;
-		if(cmpr instanceof GroupComparator){
-			cmprx = new Comparator(){
-				public int compare(Object o1, Object o2) {
-					return ((GroupComparator)cmpr).compareGroup(o1, o2);
-				}
-			};
-		}else{
-			cmprx = cmpr;
-		}
-		
-		sortDataInGroupOrder(cmprx, ascending,col);//use comparator from constructor to sort native data
-		organizeGroup(cmprx, col);
-		if (cmprx != cmpr)
-			sortAllGroupData(cmpr, ascending,col);//sort by original comparator
-
-		fireEvent(GroupsDataEvent.GROUPS_RESET,-1,-1,-1);
-	}
-	
-	public boolean isClose(int groupIndex) {
-		return _closes == null ? false : _closes[groupIndex];
-	}
-
-	public void setClose(int groupIndex, boolean close) {
-		if (_closes == null) {
-			_closes = new boolean[getGroupCount()];
-		}
-		if (_closes[groupIndex] != close) {
-			_closes[groupIndex] = close;
-			fireEvent(GroupsDataEvent.GROUPS_CHANGED,groupIndex,-1,-1);
-		}
-	}
-	
-	/**
-	 * Sorts data in each group, the group order will not change. invoke this method doesn't fire event.
-	 */
-	private void sortAllGroupData(Comparator cmpr,boolean ascending, int col) {
-		for(int i=0;i&lt;_data.length;i++){
-			sortGroupData(_heads[i],_data[i],cmpr,ascending,col);
-		}
-	}
-	
-	/**
-	 * Sorts data within a group. Notice that this method doesn't fire event.
-	 * &lt;p&gt;There are three steps to re-group data:
-	 * {@link #sortDataInGroupOrder}, {@link #organizeGroup} and then
-	 * {@link #sortGroupData}.
-	 *
-	 * &lt;p&gt;It is the last step of grouping. It sorts data in the specified
-	 * group.
-	 */
-	protected void sortGroupData(Object group,Object[] groupdata,Comparator cmpr,boolean ascending, int col){
-		Arrays.sort(groupdata,cmpr);
-	}
-
-	/**
-	 * Organizes groups based sorted data.
-	 *
-	 * &lt;p&gt;There are three steps to re-group data:
-	 * {@link #sortDataInGroupOrder}, {@link #organizeGroup} and then
-	 * {@link #sortGroupData}.
-	 *
-	 * &lt;p&gt;It is the second step of grouping. It creates group data
-	 * based on the data sorted in the group order by
-	 * {@link #sortDataInGroupOrder}.
-	 *
-	 * @param cmpr the comparator used to compare data in the group order.
-	 * Notice that the comparator is never an instance of {@link GroupComparator}.
-	 * The implementation just uses {@link Comparator#compare} to sort
-	 * the data.
-	 * @param col column index
-	 */
-	protected void organizeGroup(Comparator cmpr, int col) {
-		List group = new ArrayList();
-		List gdata = null;
-		Object last = null;
-		Object curr = null;
-		
-		//regroup native
-		for(int i=0;i&lt;_nativedata.length;i++){
-			curr = _nativedata[i];
-			boolean hitn = false;
-			boolean hita = false;
-			if(last==null || cmpr.compare(last,curr)!=0){
-				hitn = true;
-				gdata = new ArrayList();
-				group.add(gdata);
-			}
-			gdata.add(curr);
-			last = _nativedata[i];
-		}
-		
-		//prepare data,head &amp; foot
-		List[] gd = new List[group.size()];
-		group.toArray(gd);
-		
-		_data = new Object[gd.length][];
-		_foots = new Object[_data.length];
-		_heads = new Object[_data.length];
-		_closes = new boolean[_data.length];
-		
-		for(int i=0;i&lt;gd.length;i++){
-			gdata = (List)gd[i];
-			_data[i] = new Object[gdata.size()];
-			gdata.toArray(_data[i]);
-			_heads[i] = createGroupHead(_data[i],i,col);
-			_foots[i] = createGroupFoot(_data[i],i,col);
-			_closes[i] = createGroupClose(_data[i],i,col);
-		}
-	}
-
-
-	/**
-	 * create group head Object, default implementation return first element of groupdata.
-	 * you can override this method to return your Object.
-	 * @param groupdata data the already in a group.
-	 * @param index group index
-	 * @param col column to group
-	 */
-	protected Object createGroupHead(Object[] groupdata,int index,int col) {
-		return groupdata[0];
-	}
-
-	/**
-	 * create group foot Object, default implementation return null, which means no foot .
-	 * you can override this method to return your Object.
-	 * @param groupdata data the already in a group.
-	 * @param index group index
-	 * @param col column to group
-	 */
-	protected Object createGroupFoot(Object[] groupdata,int index,int col) {
-		return null;
-	}
-
-	/**
-	 * Sorts the native data in the group order.
-	 * After sorted, all data in the first group shall be placed in front
-	 * of the second group, and so on.
-	 *
-	 * &lt;p&gt;There are three steps to re-group data:
-	 * {@link #sortDataInGroupOrder}, {@link #organizeGroup} and then
-	 * {@link #sortGroupData}.
-	 *
-	 * @param cmpr the comparator used to compare data in the group order.
-	 * Notice that the comparator is never an instance of {@link GroupComparator}.
-	 * The implementation just uses {@link Comparator#compare} to sort
-	 * the data.
-	 */
-	protected void sortDataInGroupOrder(Comparator cmpr, boolean ascending, int colIndex) {
-		Arrays.sort(_nativedata,cmpr);
-	}
-
-	/**
-	 * create group close status, default implementation return false, which means open the group.
-	 * you can override this method to return your group close status.
-	 * @param groupdata data the already in a group.
-	 * @param index group index
-	 * @param col column to group
-	 * @since 5.0.0
-	 */
-	protected boolean createGroupClose(Object[] groupdata,int index,int col) {
-		return false;
-	}
-}


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26339069">[zk1-subversion-log] SF.net SVN: zk1:[14292] branches</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-29 05:37</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14292
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14292&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14292&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-29 05:37:45 +0000 (Wed, 29 Sep 2010)

Log Message:
-----------
Wed 09/29/2010

Modified Paths:
--------------
    addon/trunk/zkjsp/zuljsp/src/archive/META-INF/zuljsp.tld
    branches/5.0/zk/src/archive/web/js/zk/dom.js
    branches/5.0/zk/src/archive/web/js/zk/zk.wpd
    branches/5.0/zk/src/archive/web/js/zk/zklt.wpd
    branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
    branches/5.0/zkdoc/release-note
    branches/5.0/zul/src/archive/web/js/zul/grid/Column.js
    branches/5.0/zul/src/archive/web/js/zul/wnd/Window.js
    branches/6.0/zk/src/archive/web/js/zk/fmt/zk.wpd
    branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
    branches/6.0/zkdoc/release-note
    branches/6.0/zul/src/archive/web/js/zul/inp/Slider.js

Added Paths:
-----------
    branches/5.0/zk/src/archive/web/js/zk/domgecko.js

Modified: addon/trunk/zkjsp/zuljsp/src/archive/META-INF/zuljsp.tld
===================================================================
--- addon/trunk/zkjsp/zuljsp/src/archive/META-INF/zuljsp.tld	2010-09-28 08:50:17 UTC (rev 14291)
+++ addon/trunk/zkjsp/zuljsp/src/archive/META-INF/zuljsp.tld	2010-09-29 05:37:45 UTC (rev 14292)
@@ -22,7 +22,7 @@
 	&lt;short-name&gt;zuljsp&lt;/short-name&gt;
 	&lt;uri&gt;<a href="http://www.zkoss.org/jsp/zul&lt;/uri" target="_new">http://www.zkoss.org/jsp/zul&lt;/uri</a>&gt;
 	&lt;description&gt;
-	The JSP Tags for ZK XUL COmponents
+	JSP Tags for ZK XUL Components
 	&lt;/description&gt;
 
 	&lt;!-- General Purpose --&gt;

Modified: branches/5.0/zk/src/archive/web/js/zk/dom.js
===================================================================
--- branches/5.0/zk/src/archive/web/js/zk/dom.js	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/5.0/zk/src/archive/web/js/zk/dom.js	2010-09-29 05:37:45 UTC (rev 14292)
@@ -1300,6 +1300,12 @@
 		return this;
 	},
 
+	/** Fixes DOM elements when a widget's unbind_ is called
+	 * and it will hide the DOM element (display="none" or visibility="hidden").
+	 * &lt;p&gt;For firefox, it has to reset the src attribute of iframe (Bug 3076384)
+	 */
+	beforeHideOnUnbind: zk.$void,
+
 	//focus/select//
 	/** Sets the focus to the first matched element. It is the same as DOMElement.focus, except it doesn't throw any exception (rather, returns false), and it can set the focus later (by use of timeout). 
 	 * @param int timeout the number of milliseconds to delay before setting the focus. If omitted or negative, the focus is set immediately. 

Added: branches/5.0/zk/src/archive/web/js/zk/domgecko.js
===================================================================
--- branches/5.0/zk/src/archive/web/js/zk/domgecko.js	                        (rev 0)
+++ branches/5.0/zk/src/archive/web/js/zk/domgecko.js	2010-09-29 05:37:45 UTC (rev 14292)
@@ -0,0 +1,20 @@
+/* domgecko.js
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Tue Sep 28 19:09:15 TST 2010, Created by tomyeh
+
+Copyright (C) 2009 Potix Corporation. All Rights Reserved.
+
+*/
+zk.copy(zjq.prototype, {
+	beforeHideOnUnbind: function () {
+		return this.jq.each(function () {
+			for (var ns = this.getElementsByTagName("iframe"), j = ns.length; j--;)
+				ns[j].src = zjq._src0;
+		});
+	}
+});

Modified: branches/5.0/zk/src/archive/web/js/zk/zk.wpd
===================================================================
--- branches/5.0/zk/src/archive/web/js/zk/zk.wpd	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/5.0/zk/src/archive/web/js/zk/zk.wpd	2010-09-29 05:37:45 UTC (rev 14292)
@@ -28,8 +28,9 @@
 	&lt;script src="dom.js" jsdoc="true"/&gt;
 	&lt;script src="domie.js" browser="ie"/&gt;
 	&lt;script src="domie6.js" browser="ie6-"/&gt;
+	&lt;script src="domgecko.js" browser="gecko"/&gt;
+	&lt;script src="domsafari.js" browser="safari"/&gt;
 	&lt;script src="domopera.js" browser="opera"/&gt;
-	&lt;script src="domsafari.js" browser="safari"/&gt;
 
 	&lt;script src="evt.js" jsdoc="true"/&gt;
 	&lt;script src="anima.js" jsdoc="true"/&gt;

Modified: branches/5.0/zk/src/archive/web/js/zk/zklt.wpd
===================================================================
--- branches/5.0/zk/src/archive/web/js/zk/zklt.wpd	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/5.0/zk/src/archive/web/js/zk/zklt.wpd	2010-09-29 05:37:45 UTC (rev 14292)
@@ -22,10 +22,12 @@
 		&lt;script src="domie.js"/&gt;
 		&lt;script&gt;if(zk.ie6_){&lt;/script&gt;
 			&lt;script src="domie6.js"/&gt;
-	&lt;script&gt;}}else if(zk.opera){&lt;/script&gt;
-		&lt;script src="domopera.js"/&gt;
+	&lt;script&gt;}}else if(zk.gecko){&lt;/script&gt;
+		&lt;script src="domgecko.js"/&gt;
 	&lt;script&gt;}else if(zk.safari){&lt;/script&gt;
 		&lt;script src="domsafari.js"/&gt;
+	&lt;script&gt;}else if(zk.opera){&lt;/script&gt;
+		&lt;script src="domopera.js"/&gt;
 	&lt;script&gt;}&lt;/script&gt;
 
 	&lt;script src="anima.js"/&gt;

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-29 05:37:45 UTC (rev 14292)
@@ -193,6 +193,14 @@
 		final LanguageDefinition langdef;
 		synchronized (_ldefByName) {
 			langdef = (LanguageDefinition)_ldefByName.get(name);
+			if (langdef == null) {
+				final String nm = "/" + name;
+				for (Iterator it = _ldefByName.entrySet().iterator(); it.hasNext();) {
+					Map.Entry me = (Map.Entry)it.next();
+					if (((String)me.getKey()).endsWith(nm))
+						return (LanguageDefinition)me.getValue();
+				}
+			}
 		}
 		if (langdef == null)
 			if (ZK_NAMESPACE.equals(name))

Modified: branches/5.0/zkdoc/release-note
===================================================================
--- branches/5.0/zkdoc/release-note	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/5.0/zkdoc/release-note	2010-09-29 05:37:45 UTC (rev 14292)
@@ -5,6 +5,7 @@
   3061671: Databinding foreach keep cloned cmp's id when in spaceowner
   3061676: Autodrop menubar shall be closed automatically when move out
   3076418: XmlMacroComponent supports autowire
+  3077084: Able to specify the last word identify a component namespace
 
 * Bugs
   3057902: zk bug for window showbusy
@@ -13,6 +14,7 @@
   3064997: Listen onPiggyback event threw NoSuchElementException
   3074492: Slider default  curpos not work
   3076840: DHtmlUpdateServlet's init mishandles processor params
+  3076384: ComponentNotFoundException by closing AMedia
 
 * Upgrade Notes
   + org.zkoss.zul.ArrayGroupsModel is deprecated and renamed to GroupsModelArray

Modified: branches/5.0/zul/src/archive/web/js/zul/grid/Column.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/grid/Column.js	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/5.0/zul/src/archive/web/js/zul/grid/Column.js	2010-09-29 05:37:45 UTC (rev 14292)
@@ -186,7 +186,7 @@
 		this.$supers(zul.grid.Column, 'unbind_', arguments);
 	},
 	_doMouseOver: function(evt) {
-		if (this.parent._menupopup || this.parent._menupopup != 'none') {
+		if (this.parent._menupopup &amp;&amp; this.parent._menupopup != 'none') {
 			var btn = this.$n('btn'),
 				n = this.$n();
 			jq(n).addClass(this.getZclass() + "-over");
@@ -194,7 +194,7 @@
 		}
 	},
 	_doMouseOut: function (evt) {
-		if (this.parent._menupopup || this.parent._menupopup != 'none') {
+		if (this.parent._menupopup &amp;&amp; this.parent._menupopup != 'none') {
 			var btn = this.$n('btn'),
 				n = this.$n(), $n = jq(n),
 				zcls = this.getZclass();
@@ -204,7 +204,7 @@
 		}
 	},
 	_doClick: function (evt) {
-		if (this.parent._menupopup || this.parent._menupopup != 'none') {
+		if (this.parent._menupopup &amp;&amp; this.parent._menupopup != 'none') {
 			var pp = this.parent._menupopup,
 				n = this.$n(),
 				btn = this.$n('btn'),

Modified: branches/5.0/zul/src/archive/web/js/zul/wnd/Window.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/wnd/Window.js	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/5.0/zul/src/archive/web/js/zul/wnd/Window.js	2010-09-29 05:37:45 UTC (rev 14292)
@@ -1014,6 +1014,7 @@
 	},
 	unbind_: function () {
 		var node = this.$n();
+		zk(node).beforeHideOnUnbind();
 		node.style.visibility = 'hidden'; //avoid unpleasant effect
 
 		if (!zk.css3) jq.unzsync(this);

Modified: branches/6.0/zk/src/archive/web/js/zk/fmt/zk.wpd
===================================================================
--- branches/6.0/zk/src/archive/web/js/zk/fmt/zk.wpd	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/6.0/zk/src/archive/web/js/zk/fmt/zk.wpd	2010-09-29 05:37:45 UTC (rev 14292)
@@ -11,7 +11,7 @@
 Copyright (C) 2009 Potix Corporation. All Rights Reserved.
 --&gt;
 
-&lt;package name="zk.fmt" language="xul/html"&gt;
+&lt;package name="zk.fmt" language="xul/html" depends="zul.lang"&gt;
 	&lt;script src="numfmt.js"/&gt;
 	&lt;script src="msgfmt.js"/&gt;
 &lt;/package&gt;

Modified: branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/6.0/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java	2010-09-29 05:37:45 UTC (rev 14292)
@@ -158,10 +158,10 @@
 		}
 
 		//ZK 5: extension defined in init-param has the higher priority
-		for (int j = 0;;) {
-			param = config.getInitParameter("extension" + j++);
+		for (int j = 0;;++j) {
+			param = config.getInitParameter("extension" + j);
 			if (param == null) {
-				param = config.getInitParameter("processor" + j++); //backward compatible
+				param = config.getInitParameter("processor" + j); //backward compatible
 				if (param == null) break;
 			}
 			final int k = param.indexOf('=');

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-29 05:37:45 UTC (rev 14292)
@@ -193,6 +193,13 @@
 		final LanguageDefinition langdef;
 		synchronized (_ldefByName) {
 			langdef = _ldefByName.get(name);
+			if (langdef == null) {
+				final String nm = "/" + name;
+				for (Map.Entry&lt;String, LanguageDefinition&gt; me: _ldefByName.entrySet()) {
+					if (me.getKey().endsWith(nm))
+						return me.getValue();
+				}
+			}
 		}
 		if (langdef == null)
 			if (ZK_NAMESPACE.equals(name))

Modified: branches/6.0/zkdoc/release-note
===================================================================
--- branches/6.0/zkdoc/release-note	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/6.0/zkdoc/release-note	2010-09-29 05:37:45 UTC (rev 14292)
@@ -35,12 +35,16 @@
   3067232: A way to access components in 3rd framework (e.g. JSF 2)
   3061671: Databinding foreach keep cloned cmp's id when in spaceowner
   3061676: Autodrop menubar shall be closed automatically when move out
+  3076418: XmlMacroComponent supports autowire
+  3077084: Able to specify the last word identify a component namespace
 
 * Bugs
   3057902: zk bug for window showbusy
   3061764: Opera only. Cannot sizing a column with width
   3061765: Unexpected horizontal scrollbar when sizing listheader
   3064997: Listen onPiggyback event threw NoSuchElementException
+  3074492: Slider default  curpos not work
+  3076840: DHtmlUpdateServlet's init mishandles processor params
 
 * Upgrade Notes
   + org.zkoss.zul.ArrayGroupsModel is deprecated and renamed to GroupsModelArray

Modified: branches/6.0/zul/src/archive/web/js/zul/inp/Slider.js
===================================================================
--- branches/6.0/zul/src/archive/web/js/zul/inp/Slider.js	2010-09-28 08:50:17 UTC (rev 14291)
+++ branches/6.0/zul/src/archive/web/js/zul/inp/Slider.js	2010-09-29 05:37:45 UTC (rev 14292)
@@ -347,6 +347,7 @@
 		
 		zWatch.listen({onSize: this, onShow: this});
 		this.updateFormData(this._curpos);
+		this._fixPos();
 	},
 	unbind_: function() {
 		this.efield = null;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

</ul>

    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26333193">[zk1-subversion-log] SF.net SVN: zk1:[14291] branches/5.5/</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-28 08:50</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14291
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14291&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14291&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-28 08:50:17 +0000 (Tue, 28 Sep 2010)

Log Message:
-----------


Removed Paths:
-------------
    branches/5.5/


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26333059">[zk1-subversion-log] SF.net SVN: zk1:[14289] branches/5.5/bin/</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-28 08:24</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14289
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14289&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14289&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-28 08:23:55 +0000 (Tue, 28 Sep 2010)

Log Message:
-----------


Removed Paths:
-------------
    branches/5.5/bin/


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26332831">[zk1-subversion-log] SF.net SVN: zk1:[14288]
 branches/5.0/zk/src/org/zkoss/zk/ui/http/ Standalones.java</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-28 07:53</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14288
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14288&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14288&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-28 07:53:42 +0000 (Tue, 28 Sep 2010)

Log Message:
-----------


Removed Paths:
-------------
    branches/5.0/zk/src/org/zkoss/zk/ui/http/Standalones.java

Deleted: branches/5.0/zk/src/org/zkoss/zk/ui/http/Standalones.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/http/Standalones.java	2010-09-28 06:08:56 UTC (rev 14287)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/http/Standalones.java	2010-09-28 07:53:42 UTC (rev 14288)
@@ -1,215 +0,0 @@
-/* Standalones.java
-
-	Purpose:
-		
-	Description:
-		
-	History:
-		Tue Aug 10 08:48:59 TST 2010, Created by tomyeh
-
-Copyright (C) 2009 Potix Corporation. All Rights Reserved.
-
-*/
-package org.zkoss.zk.ui.http;
-
-import java.io.Writer;
-import java.io.IOException;
-
-import javax.servlet.ServletContext;
-import javax.servlet.ServletException;
-import javax.servlet.http.HttpServletRequest;
-import javax.servlet.http.HttpServletResponse;
-
-import org.zkoss.lang.Library;
-import org.zkoss.web.servlet.http.Https;
-
-import org.zkoss.zk.ui.WebApp;
-import org.zkoss.zk.ui.Session;
-import org.zkoss.zk.ui.Execution;
-import org.zkoss.zk.ui.Executions;
-import org.zkoss.zk.ui.Desktop;
-import org.zkoss.zk.ui.Page;
-import org.zkoss.zk.ui.Component;
-import org.zkoss.zk.ui.Richlet;
-import org.zkoss.zk.ui.GenericRichlet;
-import org.zkoss.zk.ui.metainfo.PageDefinitions;
-import org.zkoss.zk.ui.sys.HtmlPageRenders;
-import org.zkoss.zk.ui.sys.WebAppCtrl;
-import org.zkoss.zk.ui.sys.UiFactory;
-import org.zkoss.zk.ui.sys.SessionCtrl;
-import org.zkoss.zk.ui.sys.RequestInfo;
-import org.zkoss.zk.ui.impl.Attributes;
-import org.zkoss.zk.ui.impl.RequestInfoImpl;
-
-/**
- * Utilities to make a component as a JSF, JSP, Zimlet or other compliant
- * standalone component.
- * Being a standalone component allows application developers to use a component
- * without knowing the existence of ZK. For example, ZK Spreadsheet for JSF
- * is a JSF component running in a JSF page.
- *
- * &lt;p&gt;To use a standalone component, ZK Update Engine
- * ({@link org.zkoss.zk.au.http.DHtmlUpdateServlet}) is still required,
- * while ZK Loader ({@link DHtmlLayoutServlet}) is not needed (though not hurt).
- * If ZK Loader not installed, it assumes the update URI is "/zkau", which
- * can be overriden by setting a library property called
- * "org.zkoss.zk.ui.standalone.updateURI".
- *
- * &lt;p&gt;Example:
-&lt;pre&gt;&lt;code&gt;
-	Calendar cal = new Calendar();
-	Standalones.output(config.getServletContext(), request, response, cal, null, out);
-&lt;/code&gt;&lt;/pre&gt;
- *
- * @author tomyeh
- * @since 5.0.4
- */
-public class Standalones {
-	/** Outputs the HTML tags of the given component to the given writer.
-	 * @param comp the component to output (never null). It might have child components.
-	 * @param path the request path. If null, the servlet path is assumed.
-	 * @param out the output (never null).
-	 * @param richlet the richlet to run. If you have only one component to show and no need
-	 * process it under an execution, you could use
-	 * {@link #output(ServletContext, HttpServletRequest, HttpServletResponse, Component, String, Writer)
-	 * instead.
-	 * @since 5.0.5
-	 */
-	public static final void output(ServletContext ctx,
-	HttpServletRequest request, HttpServletResponse response,
-	Richlet richlet, String path, Writer out)
-	throws ServletException, IOException {
-		if (path == null)
-			path = Https.getThisServletPath(request);
-
-		WebManager webman = WebManager.getWebManagerIfAny(ctx);
-		if (webman == null) {
-			final String ATTR = "org.zkoss.zk.ui.standalone.updateURI";
-			String updateURI = Library.getProperty(ATTR);
-			if (updateURI == null)
-				updateURI = "/zkau";
-			else
-				updateURI = Utils.fixUpdateURI(updateURI, ATTR);
-			webman = new WebManager(ctx, updateURI);
-		}
-
-		final Session sess = WebManager.getSession(ctx, request);
-		final WebApp wapp = sess.getWebApp();
-		final WebAppCtrl wappc = (WebAppCtrl)wapp;
-		final Object old = I18Ns.setup(sess, request, response,
-			wapp.getConfiguration().getResponseCharset());
-		Execution exec = null;
-		try {
-			final Desktop desktop = webman.getDesktop(sess, request, response, path, true);
-			if (desktop == null) //forward or redirect
-				return;
-
-			final RequestInfo ri = new RequestInfoImpl(
-				wapp, sess, desktop, request,
-				PageDefinitions.getLocator(wapp, path));
-			sess.setAttribute(Attributes.GAE_FIX, new Integer(0));
-			((SessionCtrl)sess).notifyClientRequest(true);
-
-			final UiFactory uf = wappc.getUiFactory();
-			final Page page = WebManager.newPage(uf, ri, richlet, response, path);
-			exec = new ExecutionImpl(ctx, request, response, desktop, page);
-			exec.setAttribute(Attributes.PAGE_REDRAW_CONTROL, "page");
-			exec.setAttribute(Attributes.PAGE_RENDERER, new PageRenderer(exec));
-
-			wappc.getUiEngine().execNewPage(exec, richlet, page, out);
-					//no need to set device type here, since UiEngine will do it later
-		} finally {
-			I18Ns.cleanup(request, old);
-			if (exec != null) {
-				exec.removeAttribute(Attributes.PAGE_REDRAW_CONTROL);
-				exec.removeAttribute(Attributes.PAGE_RENDERER);
-			}
-		}
-	}
-	/** Outputs the HTML tags of the given component to the given writer.
-	 * @param comp the component to output (never null). It might have child components.
-	 * @param path the request path. If null, the servlet path is assumed.
-	 * @param out the output (never null).
-	 */
-	public static final void output(ServletContext ctx,
-	HttpServletRequest request, HttpServletResponse response,
-	Component comp, String path, Writer out)
-	throws ServletException, IOException {
-		if (comp == null)
-			throw new IllegalArgumentException();
-		output(ctx, request, response, new StandaloneRichlet(comp), path, out);
-	}
-	//Supporting classes//
-	private static class StandaloneRichlet extends GenericRichlet {
-		private final Component _comp;
-		private StandaloneRichlet(Component comp) {
-			_comp = comp;
-		}
-		//@Override
-		public void service(Page page) {
-			_comp.setPage(page);
-		}
-	}
-
-	/**
-	 * A special page renderer that renders a page without generating
-	 * the HTML tag of the page.
-	 * In other words, it generates all components directly.
-	 * @author tomyeh
-	 * @since 5.0.4
-	 */
-	public static class PageRenderer implements org.zkoss.zk.ui.sys.PageRenderer {
-		private final Execution _exec;
-		/** Default constructor.
-		 * It is the same as &lt;code&gt;PageRenderer(Executions.getCurrent())&lt;/code&gt;.
-		 */
-		public PageRenderer() {
-			this(Executions.getCurrent());
-		}
-		public PageRenderer(Execution exec) {
-			_exec = exec;
-		}
-
-		//@Override
-		public void render(Page page, Writer out) throws IOException {
-			final Desktop desktop = _exec.getDesktop();
-
-			out.write(HtmlPageRenders.outLangStyleSheets(_exec, null, null));
-			out.write(HtmlPageRenders.outLangJavaScripts(_exec, null, null));
-
-			out.write("&lt;script type=\"text/javascript\"&gt;zkpb('");
-			out.write(page.getUuid());
-			out.write("','");
-			out.write(desktop.getId());
-			out.write("','");
-			out.write(getContextURI());
-			out.write("','");
-			out.write(desktop.getUpdateURI(null));
-			out.write("','");
-			out.write(desktop.getRequestPath());
-			out.write('\'');
-
-			String style = page.getStyle();
-			if (style != null &amp;&amp; style.length() &gt; 0) {
-				out.write(",{style:'");
-				out.write(style);
-				out.write("'}");
-			}
-
-			out.write(");zkpe();&lt;/script&gt;\n");
-
-			for (Component root = page.getFirstRoot(); root != null;
-			root = root.getNextSibling()) {
-				HtmlPageRenders.outStandalone(_exec, root, out);
-			}
-		}
-		private String getContextURI() {
-			if (_exec != null) {
-				String s = _exec.encodeURL("/");
-				int j = s.lastIndexOf('/'); //might have jsessionid=...
-				return j &gt;= 0 ? s.substring(0, j) + s.substring(j + 1): s;
-			}
-			return "";
-		}
-	}
-}


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26216530">[zk1-subversion-log] SF.net SVN: zk1:[14284]
	branches/5.0/zkplus/src/org/zkoss/zkplus</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-24 05:48</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14284
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14284&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14284&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-24 05:48:07 +0000 (Fri, 24 Sep 2010)

Log Message:
-----------
Fri 09/24/2010

Modified Paths:
--------------
    branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/AcegiSecurityContextListener.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAccessDeniedHandler.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationEntryPoint.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationProcessingFilter.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkEventExceptionFilter.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkTokenBasedRememberMeServices.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/CDIELContext.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/CDIUtil.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/DelegatingVariableResolver.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionContextListener.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionFactoryListener.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateUtil.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/OpenSessionInViewListener.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/jpa/JpaUtil.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/jpa/OpenEntityManagerInViewListener.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/liferay/JQueryRenderCachedPatch.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/seasar/DelegatingVariableResolver.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/spring/DelegatingVariableResolver.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/spring/SpringTransactionSynchronizationListener.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/spring/SpringUtil.java

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/AcegiSecurityContextListener.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/AcegiSecurityContextListener.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/AcegiSecurityContextListener.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -57,6 +57,7 @@
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  *
  * @author henrichen
  */

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ShowWindowEventListener.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -55,7 +55,7 @@
  * &lt;li&gt;The url page must enclosed with a window component so it can be doModal().&lt;/li&gt;
  * &lt;/ul&gt;
  * &lt;p&gt;This implementation would automatically remove the added eventlistener from the target component.&lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @author Henri
  */
 public class ShowWindowEventListener implements EventListener {

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAccessDeniedHandler.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAccessDeniedHandler.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAccessDeniedHandler.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -37,7 +37,7 @@
  * Used by ExceptionTranslationFilter to handle an
  * &lt;code&gt;AccessDeniedException&lt;/code&gt;. This handler will popup the specified error page so it
  * must be a Window that can be doModel.
- * 
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @author Henri
  */
 public class ZkAccessDeniedHandler implements AccessDeniedHandler {

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationEntryPoint.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationEntryPoint.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationEntryPoint.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -55,7 +55,7 @@
 
 /**
  * &lt;p&gt;This implementation would forward to onAcegiLogin event and popup a login page.&lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @see ZkAuthenticationProcessingFilter
  * @see ShowWindowEventListener
  * @author Henri

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationProcessingFilter.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationProcessingFilter.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkAuthenticationProcessingFilter.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -37,7 +37,7 @@
  * "onLoginOK" event would be fired to the component that fired the event and caused the login 
  * processing. Since it will be tedious to register "onLoginOK" handler on every possible component, it is
  * better to register an onLoginOK event handler on the concerned page.&lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @see ZkAuthenticationEntryPoint
  * @see ShowWindowEventListener
  * @author Henri

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkEventExceptionFilter.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkEventExceptionFilter.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkEventExceptionFilter.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -107,7 +107,7 @@
  *
  * ...
  * &lt;/code&gt;&lt;/pre&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @author henrichen
  */
 public class ZkEventExceptionFilter implements Filter, InitializingBean {

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkTokenBasedRememberMeServices.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkTokenBasedRememberMeServices.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/acegi/ZkTokenBasedRememberMeServices.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -22,7 +22,7 @@
 
 /**
  * &lt;p&gt;get rememberme from request's attribute rather than request's parameter.&lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Acegi Security version 1.0.3&lt;/p&gt;
  * @author Henri
  */
 public class ZkTokenBasedRememberMeServices extends TokenBasedRememberMeServices {

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/CDIELContext.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/CDIELContext.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/CDIELContext.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -29,7 +29,7 @@
 
 /**
  * An EL context that is based on XEL context for use with CDI.
- *
+ * &lt;p&gt;Applicable to CDI version 1.0 or later&lt;/p&gt;
  * @author henrichen
  */
 /*package*/ class CDIELContext extends ELContext {

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/CDIUtil.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/CDIUtil.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/CDIUtil.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -24,6 +24,7 @@
 import org.zkoss.xel.XelException;
 /**
  * Some generic utility for use with CDI.
+ * &lt;p&gt;Applicable to CDI version 1.0 or later&lt;/p&gt;
  * @author henrichen
  *
  */

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/DelegatingVariableResolver.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/DelegatingVariableResolver.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/cdi/DelegatingVariableResolver.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -27,7 +27,8 @@
 import org.zkoss.xel.XelException;
 
 /**
- * Generic CDI EL named managed bean resolver. 
+ * Generic CDI EL named managed bean resolver.
+ * &lt;p&gt;Applicable to CDI version 1.0 or later&lt;/p&gt;
  * @author henrichen
  *
  */

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionContextListener.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionContextListener.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionContextListener.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -54,7 +54,7 @@
  *		&amp;lt;listener-class&gt;org.zkoss.zkplus.hibernate.HibernateSessionContextListener&amp;lt;/listener-class&gt;
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
- *
+ * &lt;p&gt;Applicable to Hibernate version 3.2.ga or later&lt;/p&gt;
  * @author henrichen
  */
 public class HibernateSessionContextListener implements ExecutionInit, ExecutionCleanup, EventThreadInit, EventThreadResume {

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionFactoryListener.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionFactoryListener.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateSessionFactoryListener.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -62,7 +62,7 @@
  *		&amp;lt;listener-class&gt;org.zkoss.zkplus.hibernate.HibernateSessionFactoryListener&amp;lt;/listener-class&gt;
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
- *
+ * &lt;p&gt;Applicable to Hibernate version 3.2.ga or later&lt;/p&gt;
  * @author henrichen
  */
 public class HibernateSessionFactoryListener 

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateUtil.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateUtil.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/HibernateUtil.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -51,9 +51,9 @@
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
  
- * &lt;p&gt; Also notice that the zkplus.jar must be put under application's WEB-INF/lib because
+ * &lt;p&gt;Also notice that the zkplus.jar must be put under application's WEB-INF/lib because
  * the SessionFactory is stored as a class static member.
- *
+ * &lt;p&gt;Applicable to Hibernate version 3.2.ga or later&lt;/p&gt;
  * @author henrichen
  */
 public class HibernateUtil {

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/OpenSessionInViewListener.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/OpenSessionInViewListener.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/hibernate/OpenSessionInViewListener.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -39,7 +39,7 @@
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Hibernate version 3.2.ga or later&lt;/p&gt;
  * @author henrichen
  */
 public class OpenSessionInViewListener implements ExecutionInit, ExecutionCleanup {

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/jpa/JpaUtil.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/jpa/JpaUtil.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/jpa/JpaUtil.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -18,14 +18,12 @@
 package org.zkoss.zkplus.jpa;
 
 import java.util.HashMap;
-import java.util.Iterator;
 import java.util.Map;
 
 import javax.persistence.EntityManager;
 import javax.persistence.EntityManagerFactory;
 import javax.persistence.Persistence;
 
-import org.hibernate.HibernateException;
 import org.zkoss.util.logging.Log;
 import org.zkoss.zk.ui.Desktop;
 import org.zkoss.zk.ui.Execution;
@@ -36,7 +34,7 @@
 /**
  * This class is used to create and hold open EntityManagerFactory objects
  * within a Java EE environment.
- * 
+ * &lt;p&gt;Applicable to EJB version 3.2.ga or later&lt;/p&gt;
  * @author Jeff
  * @since 3.0.2
  */

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/jpa/OpenEntityManagerInViewListener.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/jpa/OpenEntityManagerInViewListener.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/jpa/OpenEntityManagerInViewListener.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -34,7 +34,7 @@
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
- * 
+ * &lt;p&gt;Applicable to EJB version 3.2.ga or later&lt;/p&gt;
  * @author Jeff
  * @since 3.0.2
  */

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/liferay/JQueryRenderCachedPatch.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/liferay/JQueryRenderCachedPatch.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/liferay/JQueryRenderCachedPatch.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -12,21 +12,11 @@
 */
 package org.zkoss.zkplus.liferay;
 
-import java.io.Writer;
-import java.io.StringWriter;
-import java.io.IOException;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
-import javax.servlet.ServletRequest;
 
-import org.zkoss.lang.Library;
-import org.zkoss.lang.Strings;
 import org.zkoss.util.logging.Log;
 
-import org.zkoss.zk.ui.Page;
-import org.zkoss.zk.ui.sys.RequestInfo;
-import org.zkoss.zk.ui.sys.PageRenderPatch;
-
 /**
  * Used to patch the rendering result of a ZK portlet for Liferay.
  * When using ZK portlets with Liferay under Internet Explorer, we have

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/seasar/DelegatingVariableResolver.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/seasar/DelegatingVariableResolver.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/seasar/DelegatingVariableResolver.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -33,7 +33,7 @@
  * 
  * in your zul file:&lt;br/&gt;
  * &lt;code&gt;&amp;lt;?variable-resolver class="org.zkoss.zkplus.seasar.DelegatingVariableResolver"?&amp;gt;&lt;/code&gt;
- *
+ * &lt;p&gt;Applicable to Sesar Framework version 2.4 or later&lt;/p&gt;
  * @author Dennis.Chen
  * @since 3.0.0
  */

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/spring/DelegatingVariableResolver.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/spring/DelegatingVariableResolver.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/spring/DelegatingVariableResolver.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -45,7 +45,7 @@
  * &lt;p&gt;Developers can specify a list of class names separated with comma in
  * a library property called &lt;code&gt;org.zkoss.spring.VariableResolver.class&lt;/code&gt;,
  * such they are used as the default variable resolvers.
- *
+ * &lt;p&gt;Applicable to Spring Framework version 2.x or later&lt;/p&gt;
  * @author henrichen
  * @author ashish
  */

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/spring/SpringTransactionSynchronizationListener.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/spring/SpringTransactionSynchronizationListener.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/spring/SpringTransactionSynchronizationListener.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -53,7 +53,7 @@
  *	&amp;lt;/listener&gt;
  * &lt;/code&gt;&lt;/pre&gt;
  * &lt;/p&gt;
- *
+ * &lt;p&gt;Applicable to Spring Framework version 2.x or later&lt;/p&gt;
  * @author henrichen
  */
 public class SpringTransactionSynchronizationListener implements EventThreadInit, EventThreadCleanup, EventThreadResume {

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/spring/SpringUtil.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/spring/SpringUtil.java	2010-09-23 05:36:50 UTC (rev 14283)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/spring/SpringUtil.java	2010-09-24 05:48:07 UTC (rev 14284)
@@ -28,7 +28,7 @@
 
 /**
  * SpringUtil, a Spring utility.
- *
+ * &lt;p&gt;Applicable to Spring Framework version 2.x or later&lt;/p&gt;
  * @author henrichen
  */
 public class SpringUtil {


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26210409">[zk1-subversion-log] SF.net SVN: zk1:[14283]
 branches/5.0/zul/src/archive/web/js/zul/tab/mold/ tab.js</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-23 05:36</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14283
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14283&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14283&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-23 05:36:50 +0000 (Thu, 23 Sep 2010)

Log Message:
-----------
Thu 09/23/2010

Modified Paths:
--------------
    branches/5.0/zul/src/archive/web/js/zul/tab/mold/tab.js

Modified: branches/5.0/zul/src/archive/web/js/zul/tab/mold/tab.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/tab/mold/tab.js	2010-09-22 05:39:03 UTC (rev 14282)
+++ branches/5.0/zul/src/archive/web/js/zul/tab/mold/tab.js	2010-09-23 05:36:50 UTC (rev 14283)
@@ -32,7 +32,7 @@
 					'&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;');
 		} else {
 			if (tbx.getPanelSpacing() &amp;&amp; this.getIndex())
-				out.push('&lt;div style="margin:0;display:list-item;width:100%;height:', tbx.getpanelSpacing(), ';"&gt;&lt;/div&gt;');
+				out.push('&lt;div style="margin:0;display:list-item;width:100%;height:', tbx.getPanelSpacing(), ';"&gt;&lt;/div&gt;');
 
 			out.push('&lt;div id="', this.uuid, '"', this.domAttrs_(), '&gt;',
 					'&lt;div align="left" class="', zcls, '-header" &gt;',


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26191400">[zk1-subversion-log] SF.net SVN: zk1:[14280]
	branches/5.0/zkplus/pom.xml</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-20 05:38</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14280
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14280&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14280&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-20 05:38:20 +0000 (Mon, 20 Sep 2010)

Log Message:
-----------
Mon 09/20/2010

Modified Paths:
--------------
    branches/5.0/zkplus/pom.xml

Modified: branches/5.0/zkplus/pom.xml
===================================================================
--- branches/5.0/zkplus/pom.xml	2010-09-18 05:37:48 UTC (rev 14279)
+++ branches/5.0/zkplus/pom.xml	2010-09-20 05:38:20 UTC (rev 14280)
@@ -58,22 +58,7 @@
 	&lt;/pluginRepositories&gt;
 	&lt;dependencies&gt;
 		&lt;dependency&gt;
-			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-			&lt;version&gt;${zk.version}&lt;/version&gt;
-		&lt;/dependency&gt;
-		&lt;dependency&gt;
-			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
-			&lt;version&gt;${zk.version}&lt;/version&gt;
-		&lt;/dependency&gt;
-		&lt;dependency&gt;
 			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-			&lt;artifactId&gt;zk&lt;/artifactId&gt;
-			&lt;version&gt;${zk.version}&lt;/version&gt;
-		&lt;/dependency&gt;
-		&lt;dependency&gt;
-			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
 			&lt;artifactId&gt;zul&lt;/artifactId&gt;
 			&lt;version&gt;${zk.version}&lt;/version&gt;
 		&lt;/dependency&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26149697">[zk1-subversion-log] SF.net SVN: zk1:[14274]</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-13 05:41</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14274
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14274&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14274&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-13 05:41:23 +0000 (Mon, 13 Sep 2010)

Log Message:
-----------
Mon 09/13/2010

Modified Paths:
--------------
    addon/trunk/widgets/dist/lib/ckez.jar
    branches/5.0/dist/lib/ckez.jar
    branches/5.0/zk/src/org/zkoss/zk/ui/impl/DesktopImpl.java
    branches/5.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java
    branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
    branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
    branches/5.0/zkdoc/release-note
    branches/6.0/zcommon/src/org/zkoss/idom/Element.java
    branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java
    branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractGroup.java
    branches/6.0/zcommon/src/org/zkoss/io/Serializables.java
    branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
    branches/6.0/zcommon/src/org/zkoss/util/DualCollection.java
    branches/6.0/zcommon/src/org/zkoss/util/FastReadArray.java
    branches/6.0/zcommon/src/org/zkoss/util/ThreadLocalCache.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/AbstractLoader.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/ClassLocator.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/Loader.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/ResourceCache.java
    branches/6.0/zcommon/src/org/zkoss/xel/Expressions.java
    branches/6.0/zcommon/src/org/zkoss/xel/Function.java
    branches/6.0/zcommon/src/org/zkoss/xel/taglib/Taglibs.java
    branches/6.0/zcommon/src/org/zkoss/xel/util/MethodFunction.java
    branches/6.0/zcommon/src/org/zkoss/xel/util/TaglibMapper.java
    branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Component.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Desktop.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Execution.java
    branches/6.0/zk/src/org/zkoss/zk/ui/IdSpace.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Page.java
    branches/6.0/zk/src/org/zkoss/zk/ui/Session.java
    branches/6.0/zk/src/org/zkoss/zk/ui/WebApp.java
    branches/6.0/zk/src/org/zkoss/zk/ui/ext/Scope.java
    branches/6.0/zk/src/org/zkoss/zk/ui/ext/render/Cropper.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/DesktopImpl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/ListenerIterator.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/ScopeListeners.java
    branches/6.0/zk/src/org/zkoss/zk/ui/impl/SimpleScope.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/AbstractEvalRef.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Annotation.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/AnnotationMap.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/ArgumentInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/ComponentDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/ComponentDefinitionMap.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/ComponentInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/EventHandlerMap.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/NativeInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/NodeInfo.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinition.java
    branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/PageDefinitions.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/ComponentCtrl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/ComponentsCtrl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/ContentRenderer.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/DesktopCtrl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/sys/PageCtrl.java
    branches/6.0/zk/src/org/zkoss/zk/ui/util/Configuration.java
    branches/6.0/zk/src/org/zkoss/zk/xel/Evaluator.java
    branches/6.0/zkdoc/release-note
    branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/InterpreterServlet.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/Node.java
    branches/6.0/zweb/src/org/zkoss/web/util/resource/DspExtendlet.java
    branches/6.0/zweb/src/org/zkoss/web/util/resource/ExtendletLoader.java
    branches/6.0/zweb/src/org/zkoss/web/util/resource/ResourceCaches.java
    branches/6.0/zweb/src/org/zkoss/web/util/resource/ResourceLoader.java
    trunk/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java

Added Paths:
-----------
    addon/releases/widgets/ckez/3.3.2_50/src/archive/web/js/ckez/ext/CKeditor/_source/adapters/
    addon/releases/widgets/ckez/3.3.2_50/src/archive/web/js/ckez/ext/CKeditor/_source/adapters/jquery.js
    branches/6.0/zcommon/src/org/zkoss/xel/taglib/FunctionDefinition.java
    branches/6.0/zcommon/src/org/zkoss/xel/taglib/TaglibDefinition.java
    branches/6.0/zweb/src/org/zkoss/web/util/resource/ResourceCache.java

Added: addon/releases/widgets/ckez/3.3.2_50/src/archive/web/js/ckez/ext/CKeditor/_source/adapters/jquery.js
===================================================================
--- addon/releases/widgets/ckez/3.3.2_50/src/archive/web/js/ckez/ext/CKeditor/_source/adapters/jquery.js	                        (rev 0)
+++ addon/releases/widgets/ckez/3.3.2_50/src/archive/web/js/ckez/ext/CKeditor/_source/adapters/jquery.js	2010-09-13 05:41:23 UTC (rev 14274)
@@ -0,0 +1,297 @@
+ï»¿/*
+Copyright (c) 2003-2010, CKSource - Frederico Knabben. All rights reserved.
+For licensing, see LICENSE.html or <a href="http://ckeditor.com/license" target="_new">http://ckeditor.com/license</a>
+*/
+
+/**
+ * @fileOverview jQuery adapter provides easy use of basic CKEditor functions
+ *   and access to internal API. It also integrates some aspects of CKEditor with
+ *   jQuery framework.
+ *
+ * Every TEXTAREA, DIV and P elements can be converted to working editor.
+ *
+ * Plugin exposes some of editor's event to jQuery event system. All of those are namespaces inside
+ * ".ckeditor" namespace and can be binded/listened on supported textarea, div and p nodes.
+ *
+ * Available jQuery events:
+ * - instanceReady.ckeditor( editor, rootNode )
+ *   Triggered when new instance is ready.
+ * - destroy.ckeditor( editor )
+ *   Triggered when instance is destroyed.
+ * - getData.ckeditor( editor, eventData )
+ *   Triggered when getData event is fired inside editor. It can change returned data using eventData reference.
+ * - setData.ckeditor( editor )
+ *   Triggered when getData event is fired inside editor.
+ *
+ * @example
+ * &lt;script src="jquery.js"&gt;&lt;/script&gt;
+ * &lt;script src="ckeditor.js"&gt;&lt;/script&gt;
+ * &lt;script src="adapters/jquery/adapter.js"&gt;&lt;/script&gt;
+ */
+
+(function()
+{
+	/**
+	 * Allow CKEditor to override jQuery.fn.val(). This results in ability to use val()
+	 * function on textareas as usual and having those calls synchronized with CKEditor
+	 * Rich Text Editor component.
+	 *
+	 * This config option is global and executed during plugin load.
+	 * Can't be customized across editor instances.
+	 *
+	 * @type Boolean
+	 * @example
+	 * $( 'textarea' ).ckeditor();
+	 * // ...
+	 * $( 'textarea' ).val( 'New content' );
+	 */
+	CKEDITOR.config.jqueryOverrideVal = typeof CKEDITOR.config.jqueryOverrideVal == 'undefined'
+		? true : CKEDITOR.config.jqueryOverrideVal;
+
+	var jQuery = window.jQuery;
+
+	if ( typeof jQuery == 'undefined' )
+		return;
+
+	// jQuery object methods.
+	jQuery.extend( jQuery.fn,
+	/** @lends jQuery.fn */
+	{
+		/**
+		 * Return existing CKEditor instance for first matched element.
+		 * Allows to easily use internal API. Doesn't return jQuery object.
+		 *
+		 * Raised exception if editor doesn't exist or isn't ready yet.
+		 *
+		 * @name jQuery.ckeditorGet
+		 * @return CKEDITOR.editor
+		 * @see CKEDITOR.editor
+		 */
+		ckeditorGet: function()
+		{
+			var instance = this.eq( 0 ).data( 'ckeditorInstance' );
+			if ( !instance )
+				throw "CKEditor not yet initialized, use ckeditor() with callback.";
+			return instance;
+		},
+		/**
+		 * Triggers creation of CKEditor in all matched elements (reduced to DIV, P and TEXTAREAs).
+		 * Binds callback to instanceReady event of all instances. If editor is already created, than
+		 * callback is fired right away.
+		 *
+		 * Mixed parameter order allowed.
+		 *
+		 * @param callback Function to be run on editor instance. Passed parameters: [ textarea ].
+		 * Callback is fiered in "this" scope being ckeditor instance and having source textarea as first param.
+		 *
+		 * @param config Configuration options for new instance(s) if not already created.
+		 * See URL
+		 *
+		 * @example
+		 * $( 'textarea' ).ckeditor( function( textarea ) {
+		 *   $( textarea ).val( this.getData() )
+		 * } );
+		 *
+		 * @name jQuery.fn.ckeditor
+		 * @return jQuery.fn
+		 */
+		ckeditor: function( callback, config )
+		{
+			if ( !jQuery.isFunction( callback ))
+			{
+				var tmp = config;
+				config = callback;
+				callback = tmp;
+			}
+			config = config || {};
+
+			this.filter( 'textarea, div, p' ).each( function()
+			{
+				var $element = jQuery( this ),
+					editor = $element.data( 'ckeditorInstance' ),
+					instanceLock = $element.data( '_ckeditorInstanceLock' ),
+					element = this;
+
+				if ( editor &amp;&amp; !instanceLock )
+				{
+					if ( callback )
+						callback.apply( editor, [ this ] );
+				}
+				else if ( !instanceLock )
+				{
+					// CREATE NEW INSTANCE
+
+					// Handle config.autoUpdateElement inside this plugin if desired.
+					if ( config.autoUpdateElement
+						|| ( typeof config.autoUpdateElement == 'undefined' &amp;&amp; CKEDITOR.config.autoUpdateElement ) )
+					{
+						config.autoUpdateElementJquery = true;
+					}
+
+					// Always disable config.autoUpdateElement.
+					config.autoUpdateElement = false;
+					$element.data( '_ckeditorInstanceLock', true );
+
+					// Set instance reference in element's data.
+					editor = CKEDITOR.replace( element, config );
+					$element.data( 'ckeditorInstance', editor );
+
+					// Register callback.
+					editor.on( 'instanceReady', function( event )
+					{
+						var editor = event.editor;
+						setTimeout( function()
+						{
+							// Delay bit more if editor is still not ready.
+							if ( !editor.element )
+							{
+								setTimeout( arguments.callee, 100 );
+								return;
+							}
+
+							// Remove this listener.
+							event.removeListener( 'instanceReady', this.callee );
+
+							// Forward setData on dataReady.
+							editor.on( 'dataReady', function()
+							{
+								$element.trigger( 'setData' + '.ckeditor', [ editor ] );
+							});
+
+							// Forward getData.
+							editor.on( 'getData', function( event ) {
+								$element.trigger( 'getData' + '.ckeditor', [ editor, event.data ] );
+							}, 999 );
+
+							// Forward destroy event.
+							editor.on( 'destroy', function()
+							{
+								$element.trigger( 'destroy.ckeditor', [ editor ] );
+							});
+
+							// Integrate with form submit.
+							if ( editor.config.autoUpdateElementJquery &amp;&amp; $element.is( 'textarea' ) &amp;&amp; $element.parents( 'form' ).length )
+							{
+								var onSubmit = function()
+								{
+									$element.ckeditor( function()
+									{
+										editor.updateElement();
+									});
+								};
+
+								// Bind to submit event.
+								$element.parents( 'form' ).submit( onSubmit );
+
+								// Bind to form-pre-serialize from jQuery Forms plugin.
+								$element.parents( 'form' ).bind( 'form-pre-serialize', onSubmit );
+
+								// Unbind when editor destroyed.
+								$element.bind( 'destroy.ckeditor', function()
+								{
+									$element.parents( 'form' ).unbind( 'submit', onSubmit );
+									$element.parents( 'form' ).unbind( 'form-pre-serialize', onSubmit );
+								});
+							}
+
+							// Garbage collect on destroy.
+							editor.on( 'destroy', function()
+							{
+								$element.data( 'ckeditorInstance', null );
+							});
+
+							// Remove lock.
+							$element.data( '_ckeditorInstanceLock', null );
+
+							// Fire instanceReady event.
+							$element.trigger( 'instanceReady.ckeditor', [ editor ] );
+
+							// Run given (first) code.
+							if ( callback )
+								callback.apply( editor, [ element ] );
+						}, 0 );
+					}, null, null, 9999);
+				}
+				else
+				{
+					// Editor is already during creation process, bind our code to the event.
+					CKEDITOR.on( 'instanceReady', function( event )
+					{
+						var editor = event.editor;
+						setTimeout( function()
+						{
+							// Delay bit more if editor is still not ready.
+							if ( !editor.element )
+							{
+								setTimeout( arguments.callee, 100 );
+								return;
+							}
+
+							if ( editor.element.$ == element )
+							{
+								// Run given code.
+								if ( callback )
+									callback.apply( editor, [ element ] );
+							}
+						}, 0 );
+					}, null, null, 9999);
+				}
+			});
+			return this;
+		}
+	});
+
+	// New val() method for objects.
+	if ( CKEDITOR.config.jqueryOverrideVal )
+	{
+		jQuery.fn.val = CKEDITOR.tools.override( jQuery.fn.val, function( oldValMethod )
+		{
+			/**
+			 * CKEditor-aware val() method.
+			 *
+			 * Acts same as original jQuery val(), but for textareas which have CKEditor instances binded to them, method
+			 * returns editor's content. It also works for settings values.
+			 *
+			 * @param oldValMethod
+			 * @name jQuery.fn.val
+			 */
+			return function( newValue, forceNative )
+			{
+				var isSetter = typeof newValue != 'undefined',
+					result;
+
+				this.each( function()
+				{
+					var $this = jQuery( this ),
+						editor = $this.data( 'ckeditorInstance' );
+
+					if ( !forceNative &amp;&amp; $this.is( 'textarea' ) &amp;&amp; editor )
+					{
+						if ( isSetter )
+							editor.setData( newValue );
+						else
+						{
+							result = editor.getData();
+							// break;
+							return null;
+						}
+					}
+					else
+					{
+						if ( isSetter )
+							oldValMethod.call( $this, newValue );
+						else
+						{
+							result = oldValMethod.call( $this );
+							// break;
+							return null;
+						}
+					}
+
+					return true;
+				});
+				return isSetter ? this : result;
+			};
+		});
+	}
+})();

Modified: addon/trunk/widgets/dist/lib/ckez.jar
===================================================================
(Binary files differ)

Modified: branches/5.0/dist/lib/ckez.jar
===================================================================
(Binary files differ)

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/impl/DesktopImpl.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/impl/DesktopImpl.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/impl/DesktopImpl.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -1341,9 +1341,9 @@
 	public void onPiggyback() {
 		if (_piggybackListened) {
 			for (Iterator it = _pages.iterator(); it.hasNext();) {
-				final Page p = (Page)it.next();
-				if (Executions.getCurrent().isAsyncUpdate(p)) { //ignore new created pages
-					for (Component root = ((Page)it.next()).getFirstRoot();
+				final Page page = (Page)it.next();
+				if (Executions.getCurrent().isAsyncUpdate(page)) { //ignore new created pages
+					for (Component root = page.getFirstRoot();
 					root != null; root = root.getNextSibling()) {
 						if (Events.isListened(root, Events.ON_PIGGYBACK, false)) //asap+deferrable
 							Events.postEvent(new Event(Events.ON_PIGGYBACK, root));

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/impl/PageImpl.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -681,33 +681,6 @@
 		return _ips != null;
 	}
 
-	private static final Map REQUEST_ATTRS = new AbstractMap() {
-		public Set entrySet() {
-			final Execution exec = Executions.getCurrent();
-			if (exec == null) return Collections.EMPTY_SET;
-			return exec.getAttributes().entrySet();
-		}
-		public Object put(Object name, Object value) {
-			final Execution exec = Executions.getCurrent();
-			if (exec == null) throw new IllegalStateException("No execution at all");
-			return exec.getAttributes().put(name, value);
-		}
-		public boolean containsKey(Object name) {
-			final Execution exec = Executions.getCurrent();
-			return exec != null &amp;&amp; exec.getAttributes().containsKey(name);
-		}
-		public Object get(Object name) {
-			final Execution exec = Executions.getCurrent();
-			if (exec == null) return null;
-			return exec.getAttributes().get(name);
-		}
-		public Object remove(Object name) {
-			final Execution exec = Executions.getCurrent();
-			if (exec == null) return null;
-			return exec.getAttributes().remove(name);
-		}
-	};
-
 	public String getHeaders(boolean before) {
 		return before ? _hdbfr: _hdaft;
 	}

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/impl/UiEngineImpl.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -142,8 +142,17 @@
 		synchronized (_suspended) {
 			map = (Map)_suspended.get(desktop);
 		}
-		return map == null || map.isEmpty() ? Collections.EMPTY_LIST:
-			Collections.synchronizedMap(map).values();
+
+		if (map == null || map.isEmpty())
+			return Collections.EMPTY_LIST;
+
+		final List threads = new LinkedList();
+		synchronized (map) {
+			for (Iterator it = map.values().iterator(); it.hasNext();) {
+				threads.addAll((List)it.next());
+			}
+		}
+		return threads;
 	}
 	public boolean ceaseSuspendedThread(Desktop desktop,
 	EventProcessingThread evtthd, String cause) {

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/LanguageDefinition.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -341,7 +341,6 @@
 			&amp;&amp; _ldefByName.containsKey(namespace))
 				throw new UiException("Different language, "+name+", with the same namespace, "+namespace);
 
-			_ldefByName.put(namespace, this);
 			final Object old = _ldefByName.put(name, this);
 			if (old != null) {
 				final List ldefs = (List)_ldefsByClient.get(deviceType);

Modified: branches/5.0/zkdoc/release-note
===================================================================
--- branches/5.0/zkdoc/release-note	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/5.0/zkdoc/release-note	2010-09-13 05:41:23 UTC (rev 14274)
@@ -8,6 +8,7 @@
   3057902: zk bug for window showbusy
   3061764: Opera only. Cannot sizing a column with width
   3061765: Unexpected horizontal scrollbar when sizing listheader
+  3064997: Listen onPiggyback event threw NoSuchElementException
 
 * Upgrade Notes
 

Modified: branches/6.0/zcommon/src/org/zkoss/idom/Element.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/Element.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/idom/Element.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -157,10 +157,10 @@
 	 *
 	 * @return the namespace declarations.
 	 */
-	@SuppressWarnings("unchecked")
 	public final Collection&lt;Namespace&gt; getDeclaredNamespaces() {
-		return _addNamespaces == null ?
-			Collections.EMPTY_LIST: _addNamespaces.values();
+		if (_addNamespaces != null)
+			return _addNamespaces.values();
+		return Collections.emptyList();
 	}
 	/**
 	 * Adds a namespace to the namespace declaration.
@@ -241,7 +241,8 @@
 			final Collection c = (Collection)obj;
 			final Iterator it = c.iterator();
 			if (it.hasNext() &amp;&amp; (it.next() instanceof Item)) {
-				getChildren().addAll(toItemCollection(c));
+				final Collection&lt;Item&gt; ci = CollectionsX.generic(c);
+				getChildren().addAll(ci);
 				return null; //done
 			}
 		} else if (obj instanceof Object[]) {
@@ -293,10 +294,6 @@
 				bStr ? (Item)new Text((String)obj): (Item)new Binary(obj));
 		return ret;
 	}
-	@SuppressWarnings("unchecked")
-	private static final Collection&lt;Item&gt; toItemCollection(Collection c) {
-		return c;
-	}
 
 	/**
 	 * Returns the content of the child element with the giving path, or
@@ -617,7 +614,7 @@
 	}
 	public final List&lt;Attribute&gt; getAttributes(String namespace, String name, int mode) {
 		if (_attrs == null)
-			return getEmptyAttributeList();
+			return Collections.emptyList();
 
 		Pattern ptn =
 			(mode &amp; FIND_BY_REGEX) != 0 ? Pattern.compile(name): null;
@@ -628,10 +625,6 @@
 				list.add(attr);
 		return list;
 	}
-	@SuppressWarnings("unchecked")
-	private static List&lt;Attribute&gt; getEmptyAttributeList() {
-		return Collections.EMPTY_LIST;
-	}
 	public final Attribute setAttribute(Attribute attr) {
 		int j = getAttributeIndex(0, attr.getTagName());
 		if (j &gt;= 0) {

Modified: branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/idom/ProcessingInstruction.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -121,8 +121,11 @@
 	 * @exception org.zkoss.util.IllegalSyntaxException if syntax erros
 	 */
 	public static final Map&lt;String, String&gt; parseToMap(Map&lt;String, String&gt; map, String rawData) {
-		if (rawData == null || rawData.trim().length() == 0)
-			return map != null ? map: getEmptyDataMap();
+		if (rawData == null || rawData.trim().length() == 0) {
+			if (map != null)
+				return map;
+			return Collections.emptyMap();
+		}
 
 		map = Maps.parse(map, rawData, ' ', (char)1); //both ' and "
 
@@ -168,10 +171,6 @@
 
 		return map;
 	}
-	@SuppressWarnings("unchecked")
-	private static final Map&lt;String, String&gt; getEmptyDataMap() {
-		return Collections.EMPTY_MAP;
-	}
 
 	//-- Item --//
 	public final String getName() {

Modified: branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractGroup.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractGroup.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/idom/impl/AbstractGroup.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -367,11 +367,11 @@
 		/**
 		 * Get a readonly list of all elements with name.
 		 */
-		@SuppressWarnings("unchecked")
 		public final List&lt;Element&gt; getAll(String name) {
 			final List&lt;Element&gt; vals = _map.get(name);
-			return vals != null ?
-				Collections.unmodifiableList(vals): Collections.EMPTY_LIST;
+			if (vals != null)
+				return Collections.unmodifiableList(vals);
+			return Collections.emptyList();
 		}
 		/**
 		 * Remove e from the map.

Modified: branches/6.0/zcommon/src/org/zkoss/io/Serializables.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/io/Serializables.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/io/Serializables.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -19,6 +19,7 @@
 import java.util.Map;
 import java.util.HashMap;
 import java.util.Collection;
+import java.util.List;
 import java.util.LinkedList;
 import java.util.Iterator;
 import java.io.Serializable;
@@ -103,7 +104,26 @@
 		}
 		return col;
 	}
+	/** Reads serializable elements back (serialized by {@link #smartWrite(ObjectOutputStream,Collection)})
+	 *
+	 * @param col the collection to hold the data beinig read. If null and
+	 * and data is read, a new collection (LinkedList) is created and returned.
+	 * @return the collection being read
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static &lt;T&gt; List&lt;T&gt; smartRead(ObjectInputStream s, List&lt;T&gt; col)
+	throws IOException, ClassNotFoundException {
+		for (;;) {
+			final Object val = s.readObject();
+			if (val == null) break; //no more
 
+			if (col == null) col = new LinkedList&lt;T&gt;();
+			col.add((T)val);
+		}
+		return col;
+	}
+
 	/** Writes only serializable elements of the specified array.
 	 * &lt;p&gt;To read back, use {@link #smartRead(ObjectInputStream, Collection)}.
 	 * @since 3.0.0

Modified: branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -37,6 +37,35 @@
  * @see java.util.Collections
  */
 public class CollectionsX {
+	/** Returns a type-safe generic collection of the given un-typed collection.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; Collection&lt;T&gt; generic(Collection col) {
+		return col;
+	}
+	/** Returns a type-safe generic list of the given un-typed list.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; List&lt;T&gt; generic(List list) {
+		return list;
+	}
+	/** Returns a type-safe generic set of the given un-typed set.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; Set&lt;T&gt; generic(Set set) {
+		return set;
+	}
+	/** Returns a type-safe generic map of the given un-typed map.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;K, V&gt; Map&lt;K, V&gt; generic(Map map) {
+		return map;
+	}
+
 	/** An enumeration on top of a collection or iterator.
 	 */
 	public static final class CollectionEnumeration&lt;E&gt; implements Enumeration&lt;E&gt; {
@@ -265,6 +294,21 @@
 			}
 		};
 
+	/** Returns a generic empty iterator.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; Iterator&lt;T&gt; emptyIterator() {
+		return EMPTY_ITERATOR;
+	}
+	/** Returns a generic empty enumeration.
+	 * @since 6.0.0
+	 */
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; Enumeration&lt;T&gt; emptyEnumeration() {
+		return EMPTY_ENUMERATION;
+	}
+
 	/**
 	 * Returns the specified range of the specified collection into a new array.
      * The initial index of the range (&lt;tt&gt;from&lt;/tt&gt;) must lie between zero

Modified: branches/6.0/zcommon/src/org/zkoss/util/DualCollection.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/DualCollection.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/util/DualCollection.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -53,10 +53,15 @@
 	 * It is better to use {@link #combine} instead of this method
 	 * since it checks whether any of them is null or equals.
 	 */
-	@SuppressWarnings("unchecked")
 	public DualCollection(Collection&lt;T&gt; first, Collection&lt;T&gt; second) {
-		_first = first != null ? first: Collections.EMPTY_LIST;
-		_second = second != null ? second: Collections.EMPTY_LIST;
+		if (first != null)
+			_first = first;
+		else
+			_first = Collections.emptyList();
+		if (second != null)
+			_second = second;
+		else
+			_second = Collections.emptyList();
 	}
 
 	//Collection//

Modified: branches/6.0/zcommon/src/org/zkoss/util/FastReadArray.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/FastReadArray.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/util/FastReadArray.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -41,7 +41,7 @@
 
 	/** Constructs an array of the specified class.
 	 */
-	public FastReadArray(Class&lt;? extends T&gt; klass) {
+	public FastReadArray(Class&lt;?&gt; klass) {
 		_ary = (Object[])Array.newInstance(klass, 0);
 	}
 	/** Returns the array (never null).

Modified: branches/6.0/zcommon/src/org/zkoss/util/ThreadLocalCache.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/ThreadLocalCache.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/util/ThreadLocalCache.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -53,11 +53,10 @@
 	public boolean isEmpty() {
 		return getCache().isEmpty();
 	}
-	/** Puts all object cached in the current thread to the specifed map.
+	/**
 	 * @deprecated As of release 6.0.0, use {@link Map#putAll} instead.
 	 */
-	@SuppressWarnings("unchecked")
-	public void copyTo(Map map) {
+	public void copyTo(Map&lt;K, V&gt; map) {
 		map.putAll(getCache());
 	}
 

Modified: branches/6.0/zcommon/src/org/zkoss/util/resource/AbstractLoader.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/resource/AbstractLoader.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/util/resource/AbstractLoader.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -25,13 +25,13 @@
  *
  * @author tomyeh
  */
-abstract public class AbstractLoader implements Loader {
+abstract public class AbstractLoader&lt;K, V&gt; implements Loader&lt;K, V&gt; {
 	//-- Loader --//
-	public boolean shallCheck(Object src, long expiredMillis) {
+	public boolean shallCheck(K src, long expiredMillis) {
 		return expiredMillis &gt; 0;
 		//FUTURE: prolong if src.url's protocol is http, https or ftp
 	}
-	public long getLastModified(Object src) {
+	public long getLastModified(K src) {
 		if (src instanceof URL) {
 		//Due to round-trip, we don't retrieve last-modified
 			final URL url = (URL)src;

Modified: branches/6.0/zcommon/src/org/zkoss/util/resource/ClassLocator.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/resource/ClassLocator.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/util/resource/ClassLocator.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -122,7 +122,6 @@
 		private final Document document;
 		private final List&lt;String&gt; depends;
 
-		@SuppressWarnings("unchecked")
 		private XMLResource(URL url, String elName, String elDepends)
 		throws IOException{
 			if (D.ON &amp;&amp; log.debugable()) log.debug("Loading "+url);
@@ -141,7 +140,7 @@
 			this.name = IDOMs.getRequiredElementValue(root, elName);
 			final String deps = root.getElementValue(elDepends, true);
 			if (deps == null || deps.length() == 0) {
-				this.depends = Collections.EMPTY_LIST;
+				this.depends = Collections.emptyList();
 			} else {
 				this.depends = new LinkedList&lt;String&gt;();
 				CollectionsX.parse(this.depends, deps, ',');

Modified: branches/6.0/zcommon/src/org/zkoss/util/resource/Loader.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/resource/Loader.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/util/resource/Loader.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -22,17 +22,17 @@
  *
  * @author tomyeh
  */
-public interface Loader {
+public interface Loader&lt;K, V&gt; {
 	/** Returns whether to call {@link #getLastModified}.
 	 * If false, it assumes the current cached content is up-to-date.
 	 *
 	 * @param expiredMillis how many milli-seconds are expired after the last
 	 * check. In most cases, just return true if expiredMillis &gt; 0
 	 */
-	public boolean shallCheck(Object src, long expiredMillis);
+	public boolean shallCheck(K src, long expiredMillis);
 	/** Returns the last modified time, or -1 if reload is required or not exists.
 	 */
-	public long getLastModified(Object src);
+	public long getLastModified(K src);
 	/** Loads the resource.
 	 *
 	 * &lt;p&gt;The returned resource could be anything. It will be returned
@@ -46,22 +46,22 @@
 	 * @exception Exception you might throw any exception which will be
 	 * passed back to the caller of {@link ResourceCache#get}
 	 */
-	public Object load(Object src) throws Exception;
+	public V load(K src) throws Exception;
 
 	/** Represents the more information about an object loaded by
 	 * {@link Loader#load}.
 	 *
 	 * @since 5.0.0
 	 */
-	public class Resource {
+	public class Resource&lt;V&gt; {
 		/** The real resource that shall be returned by {@link ResourceCache#get}.
 		 */
-		public final Object resource;
+		public final V resource;
 		/** Whether the resource shall be cached in {@link ResourceCache}.
 		 */
 		public final boolean cacheable;
 
-		public Resource(Object resource, boolean cacheable) {
+		public Resource(V resource, boolean cacheable) {
 			this.cacheable = cacheable;
 			this.resource = resource;
 		}

Modified: branches/6.0/zcommon/src/org/zkoss/util/resource/ResourceCache.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/resource/ResourceCache.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/util/resource/ResourceCache.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -37,18 +37,18 @@
  *
  * @author tomyeh
  */
-public class ResourceCache extends CacheMap {
+public class ResourceCache&lt;K, V&gt; extends CacheMap&lt;Object, Object&gt; {
 	private static final Log log = Log.lookup(ResourceCache.class);
 
 	/** The loader. */
-	protected final Loader _loader;
+	protected final Loader&lt;K, V&gt; _loader;
 	/** unit=milliseconds. */
 	private int _checkPeriod;
 
 	/** Constructor.
 	 * @param loader the loader to load resource
 	 */
-	public ResourceCache(Loader loader) {
+	public ResourceCache(Loader&lt;K, V&gt; loader) {
 		if (loader == null)
 			throw new NullPointerException();
 		_loader = loader;
@@ -58,7 +58,7 @@
 	 * @param loader the loader to load resource
 	 * @param initsz the initial size of the map
 	 */
-	public ResourceCache(Loader loader, int initsz) {
+	public ResourceCache(Loader&lt;K, V&gt; loader, int initsz) {
 		super(initsz);
 		if (loader == null)
 			throw new NullPointerException();
@@ -72,7 +72,7 @@
 
 	/** Returns the loader.
 	 */
-	public Loader getLoader() {
+	public Loader&lt;K, V&gt; getLoader() {
 		return _loader;
 	}
 	/** Returns how often to check (unit=milliseconds).
@@ -93,16 +93,16 @@
 	/** Returns the resource, or null if not found.
 	 */
 	@SuppressWarnings("unchecked")
-	public Object get(Object src) {
+	public V get(Object src) {
 		WaitLock lock = null;
 		for (;;) {
 			Info ri = null;
 			synchronized (this) {
 				Object o = super.get(src);
-				if (o instanceof Info) { //was loaded
+				if (o instanceof WaitLock) {
+					lock = (WaitLock)o;
+				} else if (o != null) { //was loaded
 					ri = (Info)o;
-				} else if (o instanceof WaitLock) {
-					lock = (WaitLock)o;
 				} else {
 					super.put(src, lock = new WaitLock());
 					break; //then, load it
@@ -131,12 +131,12 @@
 		//load it
 		try {
 			boolean cache;
-			final Info ri = new Info(src);
-			Object resource = ri.getResource();
+			final Info ri = new Info((K)src);
+			V resource = ri.getResource();
 
 			if (resource instanceof Loader.Resource) {
 				final Loader.Resource lr = (Loader.Resource)resource;
-				resource = lr.resource;
+				resource = (V)lr.resource;
 				cache = lr.cacheable;
 			} else
 				cache = resource != null;
@@ -186,9 +186,9 @@
 	/** Providing info about a resource. */
 	private class Info {
 		/** The source. */
-		private final Object _src;
+		private final K _src;
 		/** The result resource. */
-		private Object _resource;
+		private V _resource;
 		private long _lastModified;
 		/* When to check lastModified again. */
 		private long _nextCheck;
@@ -196,14 +196,14 @@
 		/**
 		 * @param src the source
 		 */
-		public Info(Object src) throws Exception {
+		public Info(K src) throws Exception {
 			//if (D.ON &amp;&amp; log.debugable()) log.debug("Loading from "+src);
 			_src = src;
 			load();
 		}
 		/** Returns the result resource.
 		 */
-		public final Object getResource() {
+		public final V getResource() {
 			return _resource;
 		}
 		/** Quick check whether the page is still valid. */

Modified: branches/6.0/zcommon/src/org/zkoss/xel/Expressions.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/Expressions.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/xel/Expressions.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -143,9 +143,8 @@
 	public Function resolveFunction(String prefix, String name) {
 		return null;
 	}
-	@SuppressWarnings("unchecked")
 	public Collection&lt;String&gt; getClassNames() {
-		return Collections.EMPTY_LIST;
+		return Collections.emptyList();
 	}
 	public Class&lt;?&gt; resolveClass(String name) {
 		return null;

Modified: branches/6.0/zcommon/src/org/zkoss/xel/Function.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/Function.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/xel/Function.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -32,12 +32,12 @@
 	 * &lt;p&gt;Returns an array of length 0 if the underlying method
 	 * takes no parameters.
 	 */
-	public Class[] getParameterTypes();
+	public Class&lt;?&gt;[] getParameterTypes();
 	/** Returns a Class object that represents the formal return type
 	 * of the method
 	 * represented by this Method object.
 	 */
-	public Class getReturnType();
+	public Class&lt;?&gt; getReturnType();
 	/** Invokes this method with the specified arguments.
 	 *
 	 * @param obj the object the underlying method is invoked from.

Added: branches/6.0/zcommon/src/org/zkoss/xel/taglib/FunctionDefinition.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/taglib/FunctionDefinition.java	                        (rev 0)
+++ branches/6.0/zcommon/src/org/zkoss/xel/taglib/FunctionDefinition.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -0,0 +1,36 @@
+/* FunctionDefinition.java
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Sun Sep 12 00:30:46 TST 2010, Created by tomyeh
+
+Copyright (C) 2010 Potix Corporation. All Rights Reserved.
+
+*/
+package org.zkoss.xel.taglib;
+
+import org.zkoss.xel.Function;
+
+/**
+ * Represents a function defined in a taglib.
+ * It consists of prefix, name and function.
+ * @author tomyeh
+ * @since 6.0.0
+ */
+public class FunctionDefinition {
+	/** Method's prefix. */
+	public final String prefix;
+	/** Method's name. */
+	public final String name;
+	/** Method's function. */
+	public final Function function;
+
+	public FunctionDefinition(String prefix, String name, Function function) {
+		this.prefix = prefix;
+		this.name = name;
+		this.function = function;
+	}
+}

Added: branches/6.0/zcommon/src/org/zkoss/xel/taglib/TaglibDefinition.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/taglib/TaglibDefinition.java	                        (rev 0)
+++ branches/6.0/zcommon/src/org/zkoss/xel/taglib/TaglibDefinition.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -0,0 +1,35 @@
+/* TaglibDefinition.java
+
+	Purpose:
+		
+	Description:
+		
+	History:
+		Sun Sep 12 10:54:44 TST 2010, Created by tomyeh
+
+Copyright (C) 2009 Potix Corporation. All Rights Reserved.
+
+*/
+package org.zkoss.xel.taglib;
+
+import java.util.Map;
+import java.util.HashMap;
+
+import org.zkoss.xel.Function;
+
+/**
+ * Represents the content of a taglib.
+ *
+ * @author tomyeh
+ * @since 6.0.0
+ */
+public class TaglibDefinition {
+	/** A map of functions.
+	 * The key is the name associated with the function.
+	 */
+	public final Map&lt;String, Function&gt; functions = new HashMap&lt;String, Function&gt;();
+	/** A map of classes.
+	 * The key is the name associated with the impled class.
+	 */
+	public final Map&lt;String, Class&lt;?&gt;&gt; classes = new HashMap&lt;String, Class&lt;?&gt;&gt;();
+}

Modified: branches/6.0/zcommon/src/org/zkoss/xel/taglib/Taglibs.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/taglib/Taglibs.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/xel/taglib/Taglibs.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -55,7 +55,7 @@
 	private static final Log log = Log.lookup(Taglibs.class);
 
 	//Loading of TLD files//
-	private static final ResourceCache _reces;
+	private static final ResourceCache&lt;URL, TaglibDefinition&gt; _reces;
 
 	/** Retursn the function mapper representing a list of {@link Taglib}
 	 * and imports, or null if nothing is loaded.
@@ -70,8 +70,8 @@
 	 * @since 3.0.0
 	 */
 	public static final
-	FunctionMapper getFunctionMapper(List taglibs, Map imports, Locator loc) {
-		return getFunctionMapper((Collection)taglibs, imports, null, loc);
+	FunctionMapper getFunctionMapper(List&lt;Taglib&gt; taglibs, Map&lt;String, Class&lt;?&gt;&gt; imports, Locator loc) {
+		return getFunctionMapper((Collection&lt;Taglib&gt;)taglibs, imports, null, loc);
 	}
 	/** Retursn the function mapper representing a collection of {@link Taglib}
 	 * and imports, or null if nothing is loaded.
@@ -86,7 +86,7 @@
 	 * @since 5.0.0
 	 */
 	public static final
-	FunctionMapper getFunctionMapper(Collection taglibs, Map imports, Locator loc) {
+	FunctionMapper getFunctionMapper(Collection&lt;Taglib&gt; taglibs, Map&lt;String, Class&lt;?&gt;&gt; imports, Locator loc) {
 		return getFunctionMapper(taglibs, imports, null, loc);
 	}
 	/** Retursn the function mapper representing a list of {@link Taglib},
@@ -105,9 +105,9 @@
 	 * @param loc the locator used to load taglib
 	 * @since 3.0.0
 	 */
-	public static final FunctionMapper getFunctionMapper(List taglibs,
-	Map imports, List funcs, Locator loc) {
-		return getFunctionMapper((Collection)taglibs, imports, funcs, loc);
+	public static final FunctionMapper getFunctionMapper(List&lt;Taglib&gt; taglibs,
+	Map&lt;String, Class&lt;?&gt;&gt; imports, List&lt;FunctionDefinition&gt; funcs, Locator loc) {
+		return getFunctionMapper((Collection&lt;Taglib&gt;)taglibs, imports, funcs, loc);
 	}
 	/** Retursn the function mapper representing a collection of {@link Taglib},
 	 * imports and functions, or null if nothing is loaded.
@@ -125,13 +125,13 @@
 	 * @param loc the locator used to load taglib
 	 * @since 5.0.0
 	 */
-	public static final FunctionMapper getFunctionMapper(Collection taglibs,
-	Map imports, Collection funcs, Locator loc) {
+	public static final FunctionMapper getFunctionMapper(Collection&lt;Taglib&gt; taglibs,
+	Map&lt;String, Class&lt;?&gt;&gt; imports, Collection&lt;FunctionDefinition&gt; funcs, Locator loc) {
 		TaglibMapper mapper = null;
 		if (taglibs != null &amp;&amp; !taglibs.isEmpty()) {
 			mapper = new TaglibMapper();
-			for (Iterator it = taglibs.iterator(); it.hasNext();)
-				mapper.load((Taglib)it.next(), loc);
+			for (Taglib taglib: taglibs)
+				mapper.load(taglib, loc);
 		}
 
 		if (imports != null &amp;&amp; !imports.isEmpty()) {
@@ -148,11 +148,8 @@
 			if (mapper == null)
 				mapper = new TaglibMapper();
 
-			for (Iterator it = funcs.iterator(); it.hasNext();) {
-				final Object[] o = (Object[])it.next();
-				mapper.addFunction(
-					(String)o[0], (String)o[1], (Function)o[2]);
-			}
+			for (FunctionDefinition fi: funcs)
+				mapper.addFunction(fi.prefix, fi.name, fi.function);
 		}
 		return mapper;
 	}
@@ -165,8 +162,8 @@
 	 * @param loc the locator used to load taglib
 	 */
 	public static final
-	FunctionMapper getFunctionMapper(List taglibs, Locator loc) {
-		return getFunctionMapper((Collection)taglibs, null, loc);
+	FunctionMapper getFunctionMapper(List&lt;Taglib&gt; taglibs, Locator loc) {
+		return getFunctionMapper((Collection&lt;Taglib&gt;)taglibs, null, loc);
 	}
 	/** Retursn the function mapper representing a collection of {@link Taglib},
 	 * or null if nothin is loaded.
@@ -178,7 +175,7 @@
 	 * @since 5.0.0
 	 */
 	public static final
-	FunctionMapper getFunctionMapper(Collection taglibs, Locator loc) {
+	FunctionMapper getFunctionMapper(Collection&lt;Taglib&gt; taglibs, Locator loc) {
 		return getFunctionMapper(taglibs, null, loc);
 	}
 
@@ -189,8 +186,8 @@
 	 *
 	 * @return a map of functions: (String name, Function mtd).
 	 */
-	public static final Map loadFunctions(URL xmlURL) throws Exception {
-		return load(xmlURL)[0];
+	public static final Map&lt;String, Function&gt; loadFunctions(URL xmlURL) throws Exception {
+		return load(xmlURL).functions;
 	}
 	/** Loads functions defined in the specified DOM.
 	 *
@@ -199,22 +196,19 @@
 	 *
 	 * @return a map of function: (String name, Function mtd).
 	 */
-	public static final Map loadFunctions(Element root) throws Exception {
-		return load(root)[0];
+	public static final Map&lt;String, Function&gt; loadFunctions(Element root) throws Exception {
+		return load(root).functions;
 	}
 	/** Loads functions and imports defined in the specified URL.
 	 *
 	 * &lt;p&gt;Note: this method will cache the result, so next invocation
 	 * with the same xmlURL will read directly from the cache.
 	 *
-	 * @return a two-element array
-	 * [Map&amp;lt;String nm, Function mtd&amp;gt;, Map&amp;lt;String nm, Class cls&amp;gt;].
-	 * The first element is the map of the functions.
-	 * The second element is the map of classes to import.
-	 * @since 3.0.0
+	 * @return the content of the taglib.
+	 * @since 6.0.0
 	 */
-	public static final Map[] load(URL xmlURL) throws Exception {
-		return (Map[])_reces.get(xmlURL);
+	public static final TaglibDefinition load(URL xmlURL) throws Exception {
+		return _reces.get(xmlURL);
 	}
 	/** Loads functions and imports defined in the specified DOM.
 	 *
@@ -227,15 +221,10 @@
 	 * The second element is the map of classes to import.
 	 * @since 3.0.0
 	 */
-	public static final Map[] load(Element root) throws Exception {
-		final Map&lt;String, MethodFunction&gt; mtds = new HashMap&lt;String, MethodFunction&gt;();
-		final Map&lt;String, Class&gt; clses = new HashMap&lt;String, Class&gt;();
-
+	public static final TaglibDefinition load(Element root) throws Exception {
+		final TaglibDefinition tagdef = new TaglibDefinition();
 		Exception excp = null;
-		for (Iterator it = root.getElements("function").iterator();
-		it.hasNext();) {
-			final Element e = (Element)it.next();
-
+		for (Element e: root.getElements("function")) {
 			final String name = IDOMs.getRequiredElementValue(e, "name");
 			final String clsnm = IDOMs.getRequiredElementValue(e, "function-class");
 			final String sig = IDOMs.getRequiredElementValue(e, "function-signature");
@@ -251,7 +240,7 @@
 			try {
 				final Method mtd = Classes.getMethodBySignature(cls, sig, null);
 				if ((mtd.getModifiers() &amp; Modifier.STATIC) != 0)
-					mtds.put(name, new MethodFunction(mtd));
+					tagdef.functions.put(name, new MethodFunction(mtd));
 				else
 					log.error("Not a static method: "+mtd);
 			} catch (ClassNotFoundException ex) {
@@ -269,13 +258,11 @@
 			}
 		}
 
-		for (Iterator it = root.getElements("import").iterator();
-		it.hasNext();) {
-			final Element e = (Element)it.next();
+		for (Element e: root.getElements("import")) {
 			final String name = IDOMs.getRequiredElementValue(e, "import-name");
 			final String clsnm = IDOMs.getRequiredElementValue(e, "import-class");
 			try {
-				clses.put(name, Classes.forNameByThread(clsnm));
+				tagdef.classes.put(name, Classes.forNameByThread(clsnm));
 			} catch (ClassNotFoundException ex) {
 				log.error("Class not found: "+clsnm+", "+e.getLocator(), ex);
 				excp = ex;
@@ -284,23 +271,23 @@
 
 		if (excp != null)
 			throw excp;
-		return new Map[] {mtds, clses};
+		return tagdef;
 	}
 
 	static {
 		try {
- 			_reces = new ResourceCache(new TaglibLoader());
+ 			_reces = new ResourceCache&lt;URL, TaglibDefinition&gt;(new TaglibLoader());
  			_reces.setCheckPeriod(30*60*1000);
  		} catch (Exception ex) {
 			throw XelException.Aide.wrap(ex);
 		}
 	}
 
-	private static class TaglibLoader extends AbstractLoader {
+	private static class TaglibLoader extends AbstractLoader&lt;URL, TaglibDefinition&gt; {
 		//-- Loader --//
-		public Object load(Object src) throws Exception {
+		public TaglibDefinition load(URL src) throws Exception {
 			final Element root =
-				new SAXBuilder(true, false, true).build((URL)src).getRootElement();
+				new SAXBuilder(true, false, true).build(src).getRootElement();
 			return Taglibs.load(root);
 		}
 	}
@@ -349,13 +336,11 @@
 			} catch (Exception ex) {
 				log.error(ex); //keep running
 			}
-			return _defURLs = urls.isEmpty() ? getEmptyTLDs(): urls;
+			if (urls.isEmpty())
+				return _defURLs = Collections.emptyMap();
+			return _defURLs = urls;
 		}
 	}
-	@SuppressWarnings("unchecked")
-	private static final Map&lt;String, URL&gt; getEmptyTLDs() {
-		return Collections.EMPTY_MAP;
-	}
 
 	/** Parse config.xml. */
 	private static void parseConfig(Map&lt;String, URL&gt; urls, Element root, Locator loc) {

Modified: branches/6.0/zcommon/src/org/zkoss/xel/util/MethodFunction.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/util/MethodFunction.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/xel/util/MethodFunction.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -34,10 +34,10 @@
 		super(method);
 	}
 
-	public Class[] getParameterTypes() {
+	public Class&lt;?&gt;[] getParameterTypes() {
 		return getMethod().getParameterTypes();
 	}
-	public Class getReturnType() {
+	public Class&lt;?&gt; getReturnType() {
 		return getMethod().getReturnType();
 	}
 	public Object invoke(Object obj, Object[] args) throws Exception {

Modified: branches/6.0/zcommon/src/org/zkoss/xel/util/TaglibMapper.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/xel/util/TaglibMapper.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zcommon/src/org/zkoss/xel/util/TaglibMapper.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -31,6 +31,7 @@
 import org.zkoss.xel.XelException;
 import org.zkoss.xel.taglib.Taglibs;
 import org.zkoss.xel.taglib.Taglib;
+import org.zkoss.xel.taglib.TaglibDefinition;
 
 /**
  * A function mapper that is capable to load function and class definitions
@@ -123,21 +124,18 @@
 			throw XelException.Aide.wrap(ex);
 		}
 	}
-	@SuppressWarnings("unchecked")
-	private void load0(String prefix, Map[] loaded) {
-		if (!loaded[0].isEmpty()) {
+	private void load0(String prefix, TaglibDefinition loaded) {
+		if (!loaded.functions.isEmpty()) {
 			if (_mtds == null)
 				_mtds = new HashMap&lt;String, Function&gt;(8);
-			for (Iterator e = loaded[0].entrySet().iterator(); e.hasNext();) {
-				final Map.Entry me = (Map.Entry)e.next();
-				addFunction(prefix, (String)me.getKey(), (Function)me.getValue());
-			}
+			for (Map.Entry&lt;String, Function&gt; me: loaded.functions.entrySet())
+				addFunction(prefix, me.getKey(), me.getValue());
 		}
 
-		if (!loaded[1].isEmpty()) {
+		if (!loaded.classes.isEmpty()) {
 			if (_clses == null)
 				_clses = new HashMap&lt;String, Class&gt;(4);
-			_clses.putAll(loaded[1]);
+			_clses.putAll(loaded.classes);
 		}
 	}
 
@@ -145,9 +143,10 @@
 	public Function resolveFunction(String prefix, String name) {
 		return _mtds != null ? _mtds.get(prefix+":"+name): null;
 	}
-	@SuppressWarnings("unchecked")
 	public Collection&lt;String&gt; getClassNames() {
-		return _clses != null ? _clses.keySet(): (Collection&lt;String&gt;)Collections.EMPTY_LIST;
+		if (_clses != null)
+			return _clses.keySet();
+		return Collections.emptyList();
 	}
 	public Class resolveClass(String name) {
 		return _clses != null ? (Class)_clses.get(name): null;

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/AbstractComponent.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -108,7 +108,7 @@
 	private static final long serialVersionUID = 20100719L;
 
 	/** Map(Class, Map(String name, Integer flags)). */
-	private static final Map _clientEvents = new HashMap(128);
+	private static final Map&lt;Class&lt;? extends Component&gt;, Map&lt;String, Integer&gt;&gt; _clientEvents = new HashMap&lt;Class&lt;? extends Component&gt;, Map&lt;String, Integer&gt;&gt;(128);
 	private static final String DEFAULT = "default";
 
 	/*package*/ transient Page _page;
@@ -216,11 +216,11 @@
 	 * {@link #getChildren} to instantiate your own instance.
 	 * @since 3.5.1
 	 */
-	protected class Children extends AbstractSequentialList {
+	protected class Children extends AbstractSequentialList&lt;Component&gt; {
 		public int size() {
 			return nChild();
 		}
-		public ListIterator listIterator(int index) {
+		public ListIterator&lt;Component&gt; listIterator(int index) {
 			return new ChildIter(index);
 		}
 	}
@@ -625,12 +625,14 @@
 		final IdSpace idspace = getSpaceOwner();
 		return idspace == null ? null: idspace.getFellowIfAny(compId);
 	}
-	public Collection getFellows() {
+	public Collection&lt;Component&gt; getFellows() {
 		if (this instanceof IdSpace)
 			return Collections.unmodifiableCollection(_auxinf.spaceInfo.fellows.values());
 
 		final IdSpace idspace = getSpaceOwner();
-		return idspace == null ? Collections.EMPTY_LIST: idspace.getFellows();
+		if (idspace != null)
+			return idspace.getFellows();
+		return Collections.emptyList();
 	}
 	public Component getFellow(String compId, boolean recurse)
 	throws ComponentNotFoundException {
@@ -680,8 +682,8 @@
 
 		final String old;
 		if (script != null) {
-			if (initAuxInfo().wgtlsns == null) _auxinf.wgtlsns = new LinkedHashMap();
-			old = (String)_auxinf.wgtlsns.put(evtnm, script);
+			if (initAuxInfo().wgtlsns == null) _auxinf.wgtlsns = new LinkedHashMap&lt;String, String&gt;();
+			old = _auxinf.wgtlsns.put(evtnm, script);
 		} else
 			old = _auxinf != null &amp;&amp; _auxinf.wgtlsns != null ?
 				(String)_auxinf.wgtlsns.remove(evtnm): null;
@@ -693,9 +695,10 @@
 		return _auxinf != null &amp;&amp; _auxinf.wgtlsns != null ?
 			(String)_auxinf.wgtlsns.get(evtnm): null;
 	}
-	public Set getWidgetListenerNames() {
-		return _auxinf != null &amp;&amp; _auxinf.wgtlsns != null ?
-			_auxinf.wgtlsns.keySet(): Collections.EMPTY_SET;
+	public Set&lt;String&gt; getWidgetListenerNames() {
+		if (_auxinf != null &amp;&amp; _auxinf.wgtlsns != null)
+			return _auxinf.wgtlsns.keySet();
+		return Collections.emptySet();
 	}
 
 	public String setWidgetOverride(String name, String script) {
@@ -704,22 +707,23 @@
 
 		final String old;
 		if (script != null) {
-			if (initAuxInfo().wgtovds == null) _auxinf.wgtovds = new LinkedHashMap();
-			old = (String)_auxinf.wgtovds.put(name, script);
+			if (initAuxInfo().wgtovds == null) _auxinf.wgtovds = new LinkedHashMap&lt;String, String&gt;();
+			old = _auxinf.wgtovds.put(name, script);
 		} else
 			old = _auxinf != null &amp;&amp; _auxinf.wgtovds != null ?
-				(String)_auxinf.wgtovds.remove(name): null;
+				_auxinf.wgtovds.remove(name): null;
 		if (!Objects.equals(script, old))
 			smartUpdateWidgetOverride(name, script);
 		return old;
 	}
 	public String getWidgetOverride(String name) {
 		return _auxinf != null &amp;&amp; _auxinf.wgtovds != null ?
-			(String)_auxinf.wgtovds.get(name): null;
+			_auxinf.wgtovds.get(name): null;
 	}
-	public Set getWidgetOverrideNames() {
-		return _auxinf != null &amp;&amp; _auxinf.wgtovds != null ?
-			_auxinf.wgtovds.keySet(): Collections.EMPTY_SET;
+	public Set&lt;String&gt; getWidgetOverrideNames() {
+		if (_auxinf != null &amp;&amp; _auxinf.wgtovds != null)
+			return _auxinf.wgtovds.keySet();
+		return Collections.emptySet();
 	}
 
 	public String setWidgetAttribute(String name, String value) {
@@ -728,48 +732,58 @@
 
 		final String old;
 		if (value != null) {
-			if (initAuxInfo().wgtattrs == null) _auxinf.wgtattrs = new LinkedHashMap();
-			old = (String)_auxinf.wgtattrs.put(name, value);
+			if (initAuxInfo().wgtattrs == null)
+				_auxinf.wgtattrs = new LinkedHashMap&lt;String, String&gt;();
+			old = _auxinf.wgtattrs.put(name, value);
 		} else
 			old = _auxinf != null &amp;&amp; _auxinf.wgtattrs != null ?
-				(String)_auxinf.wgtattrs.remove(name): null;
+				_auxinf.wgtattrs.remove(name): null;
 		return old;
 	}
 	public String getWidgetAttribute(String name) {
 		return _auxinf != null &amp;&amp; _auxinf.wgtattrs != null ?
-			(String)_auxinf.wgtattrs.get(name): null;
+			_auxinf.wgtattrs.get(name): null;
 	}
-	public Set getWidgetAttributeNames() {
-		return _auxinf.wgtattrs != null ? _auxinf.wgtattrs.keySet(): Collections.EMPTY_SET;
+	public Set&lt;String&gt; getWidgetAttributeNames() {
+		if (_auxinf.wgtattrs != null)
+			return _auxinf.wgtattrs.keySet();
+		return Collections.emptySet();
 	}
 
-	public Map getAttributes(int scope) {
+	public Map&lt;String, Object&gt; getAttributes(int scope) {
 		switch (scope) {
 		case SPACE_SCOPE:
 			if (this instanceof IdSpace)
 				return getAttributes();
 			final IdSpace idspace = getSpaceOwner();
-			return idspace != null ? idspace.getAttributes(): Collections.EMPTY_MAP;
+			if (idspace != null)
+				return idspace.getAttributes();
+			return Collections.emptyMap();
 		case PAGE_SCOPE:
-			return _page != null ?
-				_page.getAttributes(): Collections.EMPTY_MAP;
+			if (_page != null)
+				return _page.getAttributes();
+			return Collections.emptyMap();
 		case DESKTOP_SCOPE:
-			return _page != null ?
-				_page.getDesktop().getAttributes(): Collections.EMPTY_MAP;
+			if (_page != null)
+				return _page.getDesktop().getAttributes();
+			return Collections.emptyMap();
 		case SESSION_SCOPE:
-			return _page != null ?
-				_page.getDesktop().getSession().getAttributes(): Collections.EMPTY_MAP;
+			if (_page != null)
+				return _page.getDesktop().getSession().getAttributes();
+			return Collections.emptyMap();
 		case APPLICATION_SCOPE:
-			return _page != null ?
-				_page.getDesktop().getWebApp().getAttributes(): Collections.EMPTY_MAP;
+			if (_page != null)
+				return _page.getDesktop().getWebApp().getAttributes();
+			return Collections.emptyMap();
 		case COMPONENT_SCOPE:
 			return getAttributes();
 		case REQUEST_SCOPE:
 			final Execution exec = getExecution();
-			if (exec != null) return exec.getAttributes();
+			if (exec != null)
+				return exec.getAttributes();
 			//fall thru
 		default:
-			return Collections.EMPTY_MAP;
+			return Collections.emptyMap();
 		}
 	}
 	private SimpleScope attrs() {
@@ -789,7 +803,7 @@
 	}
 	public Object setAttribute(String name, Object value, int scope) {
 		if (value != null) {
-			final Map attrs = getAttributes(scope);
+			final Map&lt;String, Object&gt; attrs = getAttributes(scope);
 			if (attrs == Collections.EMPTY_MAP)
 				throw new IllegalStateException("This component, "+this
 					+", doesn't belong to the "+Components.scopeToString(scope)+" scope");
@@ -800,12 +814,12 @@
 	}
 	public Object removeAttribute(String name, int scope) {
 			final Map attrs = getAttributes(scope);
-			if (attrs == Collections.EMPTY_MAP)
+			if (attrs == Collections.emptyMap())
 				throw new IllegalStateException("This component doesn't belong to any ID space: "+this);
 		return attrs.remove(name);
 	}
 
-	public Map getAttributes() {
+	public Map&lt;String, Object&gt; getAttributes() {
 		return attrs().getAttributes();
 	}
 	public Object getAttribute(String name) {
@@ -1254,7 +1268,7 @@
 	 * By live we mean the developer could add or remove a child by manipulating the returned list directly.
 	 * &lt;p&gt;Default: instantiates and returns an instance of {@link Children}.
 	 */
-	public List getChildren() {
+	public List&lt;Component&gt; getChildren() {
 		return new Children();
 	}
 	/** Returns the root of the specified component.
@@ -1741,15 +1755,13 @@
 	protected void redrawChildren(Writer out) throws IOException {
 		final Object xc = getExtraCtrl();
 		if (xc instanceof Cropper) {
-			final Set crop = ((Cropper)xc).getAvailableAtClient();
+			final Set&lt;Component&gt; crop = ((Cropper)xc).getAvailableAtClient();
 			if (crop != null) {
-				for (Iterator it = crop.iterator(); it.hasNext();) {
-					final Component c = (Component)it.next();
+				for (Component c: crop)
 					if (c.getParent() == this)
 						((ComponentCtrl)c).redraw(out);
 					//Note: getAvialableAtClient might return all level
 					//of children in the same crop scope
-				}
 				return;
 			}
 		}
@@ -1809,10 +1821,11 @@
 	/** Adds this widget class to indicate that its important events
 	 * are generated
 	 */
+	@SuppressWarnings("unchecked")
 	private boolean markImportantEvent(Execution exec) {
-		Set wgtcls = (Set)exec.getAttribute(IMPORTANT_EVENTS);
+		Set&lt;String&gt; wgtcls = (Set&lt;String&gt;)exec.getAttribute(IMPORTANT_EVENTS);
 		if (wgtcls == null)
-			exec.setAttribute(IMPORTANT_EVENTS, wgtcls = new HashSet(8));
+			exec.setAttribute(IMPORTANT_EVENTS, wgtcls = new HashSet&lt;String&gt;(8));
 		return wgtcls.add(getWidgetClass());
 	}
 	private static final String IMPORTANT_EVENTS = "org.zkoss.zk.ui.importantEvents";
@@ -1872,15 +1885,15 @@
 	 *
 	 * @since 5.0.0
 	 */
-	public Map getClientEvents() {
+	public Map&lt;String, Integer&gt; getClientEvents() {
 		for (Class cls = getClass(); cls != null; cls = cls.getSuperclass()) {
-			Map events;
+			Map&lt;String, Integer&gt; events;
 			synchronized (_clientEvents) {
-				events = (Map)_clientEvents.get(cls);
+				events = _clientEvents.get(cls);
 			}
 			if (events != null) return events;
 		}
-		return Collections.EMPTY_MAP;
+		return Collections.emptyMap();
 	}
 	/** Adds an event that the client might send to the server.
 	 * {@link #addClientEvent} is usally called in the &lt;code&gt;static&lt;/code&gt; clause
@@ -1909,25 +1922,25 @@
 	 * and {@link #CE_REPEAT_IGNORE}.
 	 * @since 5.0.0
 	 */
-	protected static void addClientEvent(Class cls, String evtnm, int flags) {
-		Map events;
+	protected static void addClientEvent(Class&lt;? extends Component&gt; cls, String evtnm, int flags) {
+		Map&lt;String, Integer&gt; events;
 		synchronized (_clientEvents) {
-			events = (Map)_clientEvents.get(cls);
+			events = _clientEvents.get(cls);
 		}
 
 		if (events == null) {
 			synchronized (cls) {
 				synchronized (_clientEvents) {
-					events = (Map)_clientEvents.get(cls);
+					events = _clientEvents.get(cls);
 				}
 				if (events == null) {
 					//for better performance, we pack all event names of super
 					//classes, though it costs more memory
-					events = new HashMap(8);
+					events = new HashMap&lt;String, Integer&gt;(8);
 					for (Class c = cls ; c != null; c = c.getSuperclass()) {
-						final Map evts;
+						final Map&lt;String, Integer&gt; evts;
 						synchronized (_clientEvents) {
-							evts = (Map)_clientEvents.get(c);
+							evts = _clientEvents.get(c);
 						}
 						if (evts != null) {
 							events.putAll(evts);
@@ -1956,19 +1969,17 @@
 		final boolean oldasap = Events.isListened(this, evtnm, true);
 
 		if (initAuxInfo().listeners == null)
-			_auxinf.listeners = new HashMap(8);
+			_auxinf.listeners = new HashMap&lt;String, List&lt;EventListener&gt;&gt;(8);
 
-		List l = (List)_auxinf.listeners.get(evtnm);
-		if (l != null) {
-			for (Iterator it = l.iterator(); it.hasNext();) {
-				final EventListener li = (EventListener)it.next();
+		List&lt;EventListener&gt; ls = _auxinf.listeners.get(evtnm);
+		if (ls != null) {
+			for (EventListener li: ls)
 				if (listener.equals(li))
 					return false;
-			}
 		} else {
-			_auxinf.listeners.put(evtnm, l = new LinkedList());
+			_auxinf.listeners.put(evtnm, ls = new LinkedList&lt;EventListener&gt;());
 		}
-		l.add(listener);
+		ls.add(listener);
 
 		final Desktop desktop = getDesktop();
 		if (desktop != null) {
@@ -1978,7 +1989,7 @@
 				((DesktopCtrl)desktop).onPiggybackListened(this, true);
 			} else if (getClientEvents().containsKey(evtnm)) {
 				final boolean asap = Events.isListened(this, evtnm, true);
-				if (l.size() == 1 || oldasap != asap)
+				if (ls.size() == 1 || oldasap != asap)
 					smartUpdate("$" + evtnm, asap);
 			}
 		}
@@ -1990,13 +2001,13 @@
 
 		if (_auxinf != null &amp;&amp; _auxinf.listeners != null) {
 			final boolean oldasap = Events.isListened(this, evtnm, true);
-			final List l = (List)_auxinf.listeners.get(evtnm);
-			if (l != null) {
-				for (Iterator it = l.iterator(); it.hasNext();) {
-					final EventListener li = (EventListener)it.next();
+			final List&lt;EventListener&gt; ls = _auxinf.listeners.get(evtnm);
+			if (ls != null) {
+				for (Iterator&lt;EventListener&gt; it = ls.iterator(); it.hasNext();) {
+					final EventListener li = it.next();
 					if (listener.equals(li)) {
 						it.remove();
-						if (l.isEmpty())
+						if (ls.isEmpty())
 							_auxinf.listeners.remove(evtnm);
 
 						final Desktop desktop = getDesktop();
@@ -2004,7 +2015,7 @@
 							onListenerChange(desktop, false);
 
 							if (getClientEvents().containsKey(evtnm)) {
-								if (l.isEmpty() &amp;&amp; !Events.isListened(this, evtnm, false))
+								if (ls.isEmpty() &amp;&amp; !Events.isListened(this, evtnm, false))
 									smartUpdate("$" + evtnm, (Object)null); //no listener at all
 								else if (oldasap != Events.isListened(this, evtnm, true))
 									smartUpdate("$" + evtnm, !oldasap);
@@ -2049,14 +2060,13 @@
 			throw new IllegalArgumentException("Illegal event name: "+targetEvent);
 
 		if (initAuxInfo().forwards == null)
-			_auxinf.forwards = new HashMap(4);
+			_auxinf.forwards = new HashMap&lt;String, ForwardInfo&gt;(4);
 
-		Object[] info = (Object[])_auxinf.forwards.get(orgEvent);
-		final List fwds;
+		ForwardInfo info = _auxinf.forwards.get(orgEvent);
+		final List&lt;Object[]&gt; fwds;
 		if (info != null) {
-			fwds = (List)info[1];
-			for (Iterator it = fwds.iterator(); it.hasNext();) {
-				final Object[] fwd = (Object[])it.next();
+			fwds = info.targets;
+			for (Object[] fwd: fwds) {
 				if (Objects.equals(fwd[0], target)
 				&amp;&amp; Objects.equals(fwd[1], targetEvent)) { //found
 					if (Objects.equals(fwd[2], eventData)) {
@@ -2070,7 +2080,7 @@
 		} else {
 			final ForwardListener listener = new ForwardListener(orgEvent);
 			addEventListener(orgEvent, listener);
-			info = new Object[] {listener, fwds = new LinkedList()};
+			info = new ForwardInfo(listener, fwds = new LinkedList&lt;Object[]&gt;());
 			_auxinf.forwards.put(orgEvent, info);
 		}
 
@@ -2088,9 +2098,9 @@
 	private boolean removeForward0(
 	String orgEvent, Object target, String targetEvent) {
 		if (_auxinf != null &amp;&amp; _auxinf.forwards != null) {
-			final Object[] info = (Object[])_auxinf.forwards.get(orgEvent);
+			final ForwardInfo info = _auxinf.forwards.get(orgEvent);
 			if (info != null) {
-				final List fwds = (List)info[1];
+				final List&lt;Object[]&gt; fwds = info.targets;
 				for (Iterator it = fwds.iterator(); it.hasNext();) {
 					final Object[] fwd = (Object[])it.next();
 					if (Objects.equals(fwd[1], targetEvent)
@@ -2099,8 +2109,7 @@
 
 						if (fwds.isEmpty()) { //no more event
 							_auxinf.forwards.remove(orgEvent);
-							removeEventListener(
-								orgEvent, (EventListener)info[0]);
+							removeEventListener(orgEvent, info.listener);
 						}
 						return true;
 					}
@@ -2112,28 +2121,26 @@
 
 	public boolean isListenerAvailable(String evtnm, boolean asap) {
 		if (_auxinf != null &amp;&amp; _auxinf.listeners != null) {
-			final List l = (List)_auxinf.listeners.get(evtnm);
-			if (l != null) {
+			final List&lt;EventListener&gt; ls = _auxinf.listeners.get(evtnm);
+			if (ls != null) {
 				if (!asap)
-					return !l.isEmpty();
+					return !ls.isEmpty();
 
-				for (Iterator it = l.iterator(); it.hasNext();) {
-					final EventListener li = (EventListener)it.next();
+				for (EventListener li: ls)
 					if (!(li instanceof Deferrable)
 					|| !(((Deferrable)li).isDeferrable()))
 						return true;
-				}
 			}
 		}
 		return false;
 	}
-	public Iterator getListenerIterator(String evtnm) {
+	public Iterator&lt;EventListener&gt; getListenerIterator(String evtnm) {
 		if (_auxinf != null &amp;&amp; _auxinf.listeners != null) {
-			final List l = (List)_auxinf.listeners.get(evtnm);
-			if (l != null)
-				return new ListenerIterator(l);
+			final List&lt;EventListener&gt; ls = _auxinf.listeners.get(evtnm);
+			if (ls != null)
+				return new ListenerIterator(ls);
 		}
-		return CollectionsX.EMPTY_ITERATOR;
+		return CollectionsX.emptyIterator();
 	}
 
 	public void applyProperties() {
@@ -2201,9 +2208,10 @@
 				onListenerChange(desktop, true);
 		}
 	}
-	public Set getEventHandlerNames() {
-		return _auxinf != null &amp;&amp; _auxinf.evthds != null ?
-			_auxinf.evthds.getEventNames(): Collections.EMPTY_SET;
+	public Set&lt;String&gt; getEventHandlerNames() {
+		if (_auxinf != null &amp;&amp; _auxinf.evthds != null)
+			return _auxinf.evthds.getEventNames();
+		return Collections.emptySet();
 	}
 	private void onListenerChange(Desktop desktop, boolean listen) {
 		if (listen) {
@@ -2245,21 +2253,25 @@
 		return _auxinf != null &amp;&amp; _auxinf.annots != null ?
 			_auxinf.annots.getAnnotation(propName, annotName): null;
 	}
-	public Collection getAnnotations() {
-		return _auxinf != null &amp;&amp; _auxinf.annots != null ?
-			_auxinf.annots.getAnnotations(): Collections.EMPTY_LIST;
+	public Collection&lt;Annotation&gt; getAnnotations() {
+		if (_auxinf != null &amp;&amp; _auxinf.annots != null)
+			return _auxinf.annots.getAnnotations();
+		return Collections.emptyList();
 	}
-	public Collection getAnnotations(String propName) {
-		return _auxinf != null &amp;&amp; _auxinf.annots != null ?
-			_auxinf.annots.getAnnotations(propName): Collections.EMPTY_LIST;
+	public Collection&lt;Annotation&gt; getAnnotations(String propName) {
+		if (_auxinf != null &amp;&amp; _auxinf.annots != null)
+			return _auxinf.annots.getAnnotations(propName);
+		return Collections.emptyList();
 	}
-	public List getAnnotatedPropertiesBy(String annotName) {
-		return _auxinf != null &amp;&amp; _auxinf.annots != null ?
-			_auxinf.annots.getAnnotatedPropertiesBy(annotName): Collections.EMPTY_LIST;
+	public List&lt;String&gt; getAnnotatedPropertiesBy(String annotName) {
+		if (_auxinf != null &amp;&amp; _auxinf.annots != null)
+			return _auxinf.annots.getAnnotatedPropertiesBy(annotName);
+		return Collections.emptyList();
 	}
-	public List getAnnotatedProperties() {
-		return _auxinf != null &amp;&amp; _auxinf.annots != null ?
-			_auxinf.annots.getAnnotatedProperties(): Collections.EMPTY_LIST;
+	public List&lt;String&gt; getAnnotatedProperties() {
+		if (_auxinf != null &amp;&amp; _auxinf.annots != null)
+			return _auxinf.annots.getAnnotatedProperties();
+		return Collections.emptyList();
 	}
 	public void addSharedAnnotationMap(AnnotationMap annots) {
 		if (annots != null &amp;&amp; !annots.isEmpty()) {
@@ -2272,11 +2284,11 @@
 			}
 		}
 	}
-	public void addAnnotation(String annotName, Map annotAttrs) {
+	public void addAnnotation(String annotName, Map&lt;String,String&gt; annotAttrs) {
 		unshareAnnotationMap(true);
 		_auxinf.annots.addAnnotation(annotName, annotAttrs);
 	}
-	public void addAnnotation(String propName, String annotName, Map annotAttrs) {
+	public void addAnnotation(String propName, String annotName, Map&lt;String,String&gt; annotAttrs) {
 		unshareAnnotationMap(true);
 		_auxinf.annots.addAnnotation(propName, annotName, annotAttrs);
 	}
@@ -2330,7 +2342,7 @@
 	 * @param c a collection of objects. Ignored if null.
 	 * @since 3.6.4
 	 */
-	protected void willPassivate(Collection c) {
+	protected void willPassivate(Collection&lt;?&gt; c) {
 		if (c != null)
 			for (Iterator it = c.iterator(); it.hasNext();)
 				willPassivate(it.next());
@@ -2350,7 +2362,7 @@
 	 * @param c a collection of objects. Ignored if null.
 	 * @since 3.6.4
 	 */
-	protected void didActivate(Collection c) {
+	protected void didActivate(Collection&lt;?&gt; c) {
 		if (c != null)
 			for (Iterator it = c.iterator(); it.hasNext();)
 				didActivate(it.next());
@@ -2489,9 +2501,9 @@
 	/** Holds info shared of the same ID space. */
 	private class SpaceInfo {
 		/** A map of ((String id, Component fellow). */
-		private Map fellows = new HashMap(32);
+		private Map&lt;String, Component&gt; fellows = new HashMap&lt;String, Component&gt;(32);
 	}
-	private class ChildIter implements ListIterator  {
+	private class ChildIter implements ListIterator&lt;Component&gt;  {
 		private AbstractComponent _p, _lastRet;
 		private int _j;
 		private int _modCntSnap;
@@ -2517,7 +2529,7 @@
 			checkComodification();
 			return _j &lt; nChild();
 		}
-		public Object next() {
+		public Component next() {
 			if (_j &gt;= nChild())
 				throw new java.util.NoSuchElementException();
 			checkComodification();
@@ -2531,7 +2543,7 @@
 			checkComodification();
 			return _j &gt; 0;
 		}
-		public Object previous() {
+		public Component previous() {
 			if (_j &lt;= 0)
 				throw new java.util.NoSuchElementException();
 			checkComodification();
@@ -2550,10 +2562,9 @@
 		public int previousIndex() {
 			return _j - 1;
 		}
-		public void add(Object o) {
-			final Component newChild = (Component)o;
+		public void add(Component newChild) {
 			if (newChild.getParent() == AbstractComponent.this)
-				throw new UnsupportedOperationException("Unable to add component with the same parent: "+o);
+				throw new UnsupportedOperationException("Unable to add component with the same parent: "+newChild);
 				//1. it is confusing to allow adding (with replace)
 				//2. the code is sophisticated
 			checkComodification();
@@ -2579,7 +2590,7 @@
 			_lastRet = null;
 			++_modCntSnap;
 		}
-		public void set(Object o) {
+		public void set(Component o) {
 			throw new UnsupportedOperationException();
 				//Possible to implement this but confusing to developers
 				//if o has the same parent (since we have to move)
@@ -2661,24 +2672,23 @@
 
 		//write attrs
 		if (_auxinf.attrs != null) {
-			final Map attrmap = _auxinf.attrs.getAttributes();
+			final Map&lt;String, Object&gt; attrmap = _auxinf.attrs.getAttributes();
 			willSerialize(attrmap.values());
-			final List attrlns = _auxinf.attrs.getListeners();
+			final List&lt;ScopeListener&gt; attrlns = _auxinf.attrs.getListeners();
 			willSerialize(attrlns);
 
 			Serializables.smartWrite(s, attrmap);
 			Serializables.smartWrite(s, attrlns);
 		} else {
-			Serializables.smartWrite(s, (Map)null);
-			Serializables.smartWrite(s, (List)null);
+			Serializables.smartWrite(s, (Map&lt;String,Object&gt;)null);
+			Serializables.smartWrite(s, (List&lt;ScopeListener&gt;)null);
 		}
 
 		if (_auxinf.listeners != null)
-			for (Iterator it = _auxinf.listeners.entrySet().iterator(); it.hasNext();) {
-				final Map.Entry me = (Map.Entry)it.next();
+			for (Map.Entry&lt;String, List&lt;EventListener&gt;&gt; me: _auxinf.listeners.entrySet()) {
 				s.writeObject(me.getKey());
 
-				final Collection ls = (Collection)me.getValue();
+				final List&lt;EventListener&gt; ls = me.getValue();
 				willSerialize(ls);
 				Serializables.smartWrite(s, ls);
 			}
@@ -2758,9 +2768,9 @@
 
 		//read attrs
 		attrs();
-		final Map attrmap = _auxinf.attrs.getAttributes();
+		final Map&lt;String, Object&gt; attrmap = _auxinf.attrs.getAttributes();
 		Serializables.smartRead(s, attrmap);
-		final List attrlns = _auxinf.attrs.getListeners();
+		final List&lt;ScopeListener&gt; attrlns = _auxinf.attrs.getListeners();
 		Serializables.smartRead(s, attrlns);
 		if (attrmap.isEmpty() &amp;&amp; attrlns.isEmpty())
 			_auxinf.attrs = null;
@@ -2771,8 +2781,8 @@
 			final String evtnm = (String)s.readObject();
 			if (evtnm == null) break; //no more
 
-			if (_auxinf.listeners == null) _auxinf.listeners = new HashMap(4);
-			final Collection ls = Serializables.smartRead(s, (Collection)null);
+			if (_auxinf.listeners == null) _auxinf.listeners = new HashMap&lt;String,List&lt;EventListener&gt;&gt;(4);
+			final List&lt;EventListener&gt; ls = Serializables.smartRead(s, (List&lt;EventListener&gt;)null);
 			_auxinf.listeners.put(evtnm, ls);
 		}
 
@@ -2830,11 +2840,9 @@
 		}
 
 		public void onEvent(Event event) {
-			final Object[] info = (Object[])_auxinf.forwards.get(_orgEvent);
+			final ForwardInfo info = _auxinf.forwards.get(_orgEvent);
 			if (info != null)
-				for (Iterator it = new ArrayList((List)info[1]).iterator();
-				it.hasNext();) {
-					final Object[] fwd = (Object[])it.next();
+				for (Object[] fwd: new ArrayList&lt;Object[]&gt;(info.targets)) {
 					Component target = resolveForwardTarget(fwd[0]);
 					if (target == null) {
 						final IdSpace owner = getSpaceOwner();
@@ -2880,10 +2888,10 @@
 	 *}&lt;/code&gt;&lt;/pre&gt;
 	 * @since 5.0.3
 	 */
-	protected String getDefaultMold(Class klass) {
+	protected String getDefaultMold(Class&lt;? extends Component&gt; klass) {
 		return (String)getDefaultInfo(klass);
 	}
-	private static Object getDefaultInfo(Class klass) { //use Object for future extension
+	private static Object getDefaultInfo(Class&lt;? extends Component&gt; klass) { //use Object for future extension
 		Object inf = _infs.get(klass);
 		if (inf == null) {
 			synchronized (_sinfs) {
@@ -2895,7 +2903,8 @@
 				}
 				if (++_infcnt &gt; 100 || _sinfs.size() &gt; 20) {
 					_infcnt = 0;
-					Map infs = new HashMap(_infs);
+					Map&lt;Class&lt;? extends Component&gt;, Object&gt; infs =
+						new HashMap&lt;Class&lt;? extends Component&gt;, Object&gt;(_infs);
 					infs.putAll(_sinfs);
 					_infs = infs;
 					_sinfs.clear();
@@ -2904,8 +2913,8 @@
 		}
 		return inf;
 	}
-	private static transient Map _infs = new HashMap(), //readonly
-		_sinfs = new HashMap(); //synchronized
+	private static transient Map&lt;Class&lt;? extends Component&gt;, Object&gt; _infs = new HashMap&lt;Class&lt;? extends Component&gt;, Object&gt;(), //readonly
+		_sinfs = new HashMap&lt;Class&lt;? extends Component&gt;, Object&gt;(); //synchronized
 	private static int _infcnt;
 
 	private final AuxInfo initAuxInfo() {
@@ -2926,7 +2935,7 @@
 		/** Component attributes. */
 		private transient SimpleScope attrs;
 		/** A map of event listener: Map(evtnm, List(EventListener)). */
-		private transient Map listeners;
+		private transient Map&lt;String, List&lt;EventListener&gt;&gt; listeners;
 
 		/** A map of annotations. Serializable since a component might have
 		 * its own annotations.
@@ -2935,9 +2944,9 @@
 		/** A map of event handler to handle events. */
 		private EventHandlerMap evthds;
 		/** A map of forward conditions:
-		 * Map(String orgEvt, [listener, List([target or targetPath,targetEvent])]).
+		 * Map(String orgEvt, ForwardInfo fi&gt;).
 		 */
-		private Map forwards;
+		private Map&lt;String, ForwardInfo&gt; forwards;
 
 		/** the Au service. */
 		private transient AuService ausvc;
@@ -2945,11 +2954,11 @@
 		/** The widget class. */
 		private String wgtcls;
 		/** A map of client event hanlders, Map(String evtnm, String script). */
-		private Map wgtlsns;
+		private Map&lt;String, String&gt; wgtlsns;
 		/** A map of client properties to override, Map(String name, String script). */
-		private Map wgtovds;
+		private Map&lt;String, String&gt; wgtovds;
 		/** A map of client DOM attributes to set, Map(String name, String value). */
-		private Map wgtattrs;
+		private Map&lt;String, String&gt; wgtattrs;
 		/** The AU tag. */
 		private String autag;
 
@@ -2971,11 +2980,11 @@
 				throw new InternalError();
 			}
 			if (wgtlsns != null)
-				clone.wgtlsns = new LinkedHashMap(wgtlsns);
+				clone.wgtlsns = new LinkedHashMap&lt;String, String&gt;(wgtlsns);
 			if (wgtovds != null)
-				clone.wgtovds = new LinkedHashMap(wgtovds);
+				clone.wgtovds = new LinkedHashMap&lt;String, String&gt;(wgtovds);
 			if (wgtattrs != null)
-				clone.wgtattrs = new LinkedHashMap(wgtattrs);
+				clone.wgtattrs = new LinkedHashMap&lt;String, String&gt;(wgtattrs);
 
 			//clone annotation and event handlers
 			if (!annotsShared &amp;&amp; annots != null)
@@ -3013,16 +3022,12 @@
 			//clone forwards (after children is cloned)
 			if (forwards != null) {
 				clone.forwards = null;
-				for (Iterator it = forwards.entrySet().iterator(); it.hasNext();) {
-					final Map.Entry me = (Map.Entry)it.next();
-					final String orgEvent = (String)me.getKey();
-
-					final Object[] info = (Object[])me.getValue();
-					final List fwds = (List)info[1];
-					for (Iterator e = fwds.iterator(); e.hasNext();) {
-						final Object[] fwd = (Object[])e.next();
+				for (Map.Entry&lt;String, ForwardInfo&gt; me: forwards.entrySet()) {
+					final String orgEvent = me.getKey();
+					final ForwardInfo info = me.getValue();
+					final List&lt;Object[]&gt; fwds = info.targets;
+					for (Object[] fwd: fwds)
 						owner.addForward0(orgEvent, fwd[0], (String)fwd[1], fwd[2]);
-					}
 				}
 			}
 
@@ -3032,16 +3037,12 @@
 		}
 		private void cloneListeners(AbstractComponent owner, AuxInfo clone) {
 			if (listeners != null) {
-				clone.listeners = new HashMap(4);
-				for (Iterator it = listeners.entrySet().iterator();
-				it.hasNext();) {
-					final Map.Entry me = (Map.Entry)it.next();
-					final List list = new LinkedList();
-					for (Iterator it2 = ((List)me.getValue()).iterator();
-					it2.hasNext();) {
-						Object val = it2.next();
+				clone.listeners = new HashMap&lt;String, List&lt;EventListener&gt;&gt;(4);
+				for (Map.Entry&lt;String, List&lt;EventListener&gt;&gt; me: listeners.entrySet()) {
+					final List&lt;EventListener&gt; list = new LinkedList&lt;EventListener&gt;();
+					for (EventListener val: list) {
 						if (val instanceof ComponentCloneListener) {
-							val = ((ComponentCloneListener)val).willClone(owner);
+							val = (EventListener)((ComponentCloneListener)val).willClone(owner);
 							if (val == null) continue; //don't use it in clone
 						}
 						list.add(val);
@@ -3076,7 +3077,7 @@
 		 * It is used to prevent dead-loop between {@link #removeChild}
 		 * and {@link #setParent}.
 		 */
-		private transient Set[] _aring; //use an array to save memory
+		private transient Set&lt;Component&gt;[] _aring; //use an array to save memory
 		/** The modification count used to avoid co-modification of _next, _prev..
 		 */
 		private transient int modCntChd;
@@ -3127,10 +3128,11 @@
 		private void markAdding(Component child, boolean set) {
 			markARing(child, set, 0);
 		}
+		@SuppressWarnings("unchecked")
 		private void markARing(Component child, boolean set, int which) {
 			if (set) {
 				if (_aring == null) _aring = new Set[2];
-				if (_aring[which] == null) _aring[which] = new HashSet(2);
+				if (_aring[which] == null) _aring[which] = new HashSet&lt;Component&gt;(2);
 				_aring[which].add(child);
 			} else if (_aring != null &amp;&amp; _aring[which] != null
 			&amp;&amp; _aring[which].remove(child) &amp;&amp; _aring[which].isEmpty())
@@ -3140,4 +3142,13 @@
 					_aring[which] = null;
 		}
 	}
+	private static class ForwardInfo {
+		private final EventListener listener;
+		//List([target or targetPath, targetEvent, eventData])]
+		private final List&lt;Object[]&gt; targets;
+		private ForwardInfo(EventListener listener, List&lt;Object[]&gt; targets) {
+			this.listener = listener;
+			this.targets = targets;
+		}
+	}
 }

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Component.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Component.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Component.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -255,7 +255,7 @@
 	 * The returned collection is read-only.
 	 * @since 3.0.6
 	 */
-	public Collection getFellows();
+	public Collection&lt;Component&gt; getFellows();
 	/** Returns whether a fellow exists in the same ID space of this component.
 	 * @since 5.0.0
 	 */
@@ -372,7 +372,7 @@
 	 * {@link #PAGE_SCOPE}, {@link #DESKTOP_SCOPE}, {@link #SESSION_SCOPE},
 	 * {@link #REQUEST_SCOPE} or {@link #APPLICATION_SCOPE}, 
 	 */
-	public Map getAttributes(int scope);
+	public Map&lt;String, Object&gt; getAttributes(int scope);
 	/** Returns the value of the specified custom attribute in the specified scope,
 	 * or null if not defined.
 	 *
@@ -448,7 +448,7 @@
 	/** Returns all custom attributes associated with this component, i.e.,
 	 * {@link #COMPONENT_SCOPE}.
 	 */
-	public Map getAttributes();
+	public Map&lt;String, Object&gt; getAttributes();
 	/** Returns the custom attribute associated with this component, i.e.,
 	 * {@link #COMPONENT_SCOPE}.
 	 */
@@ -551,7 +551,7 @@
 	/** Returns a live list of children.
 	 * By live we mean the developer could add or remove a child by manipulating the returned list directly.
 	 */
-	public List getChildren();
+	public List&lt;Component&gt; getChildren();
 	/** Returns the root of this component.
 	 */
 	public Component getRoot();
@@ -682,7 +682,7 @@
 	 * &lt;p&gt;Since 3.6.3, the listener can be removed directly by invoking
 	 * Iterator.remove().
 	 */
-	public Iterator getListenerIterator(String evtnm);
+	public Iterator&lt;EventListener&gt; getListenerIterator(String evtnm);
 
 	/** Adds a forward condition to forward the event received
 	 * by this component to another component.
@@ -860,7 +860,7 @@
 	 * an empty collection if none is registered.
 	 * @since 5.0.0
 	 */
-	public Set getWidgetListenerNames();
+	public Set&lt;String&gt; getWidgetListenerNames();
 
 	/*** Sets or removes a method or a property of the peer widget (at the client).
 	 * If there is a method or a property associated with the same name,
@@ -912,7 +912,7 @@
 	 * shall be overridden, or an empty collection if none is registered.
 	 * @since 5.0.0
 	 */
-	public Set getWidgetOverrideNames();
+	public Set&lt;String&gt; getWidgetOverrideNames();
 
 	/*** Sets or removes a DOM attribute of the peer widget (at the client).
 	 * ZK pass the attributes directly to the DOM attribute generated
@@ -945,7 +945,7 @@
 	 * generated. That is, they are the attributes added by {@link #setWidgetAttribute}.
 	 * @since 5.0.3
 	 */
-	public Set getWidgetAttributeNames();
+	public Set&lt;String&gt; getWidgetAttributeNames();
 
 	/** Sets an AU service to process the AU request before the component's
 	 * default handling.

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Desktop.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Desktop.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Desktop.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -116,7 +116,7 @@
 	public Page getPageIfAny(String pageId);
 	/** Returns a readonly collection of all {@link Page} in this desktop.
 	 */
-	public Collection getPages();
+	public Collection&lt;Page&gt; getPages();
 	/** Returns the first page, or null if no page at all (happens when the desktop
 	 * has been destroyed)
 	 * @since 5.0.3
@@ -128,7 +128,7 @@
 
 	/** Returns all custom attributes associated with this desktop.
 	 */
-	public Map getAttributes();
+	public Map&lt;String, Object&gt; getAttributes();
 	/** Returns the value of the specified custom attribute associated with the desktop.
 	 */
 	public Object getAttribute(String name);
@@ -141,7 +141,7 @@
 
 	/** Returns all components contained in this desktop.
 	 */
-	public Collection getComponents();
+	public Collection&lt;Component&gt; getComponents();
 	/** Returns the component of the specified UUID ({@link Component#getUuid}).
 	 * @exception ComponentNotFoundException if component not found
 	 */

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Execution.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Execution.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Execution.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -89,7 +89,7 @@
 	/** Returns a Map of the parameters of this request.
 	 * Request parameters are extra information sent with the request.
 	 */
-	public Map getParameterMap();
+	public Map&lt;String, String[]&gt; getParameterMap();
 
 	/** Returns the evaluator (never null).
 	 * It is usually used to parse the expression into {@link org.zkoss.xel.Expression}
@@ -500,7 +500,7 @@
 	 * @see #createComponents(String, Component, Map)
 	 */
 	public Component createComponents(PageDefinition pagedef,
-	Component parent, Map arg);
+	Component parent, Map&lt;?, ?&gt; arg);
 	/** Creates components from a page file specified by an URI.
 	 * The created components become the child of the specified parent,
 	 * or become the root components of the current page if parent is specified
@@ -525,7 +525,7 @@
 	 * @see #createComponentsDirectly(Reader, String, Component, Map)
 	 */
 	public Component createComponents(String uri, Component parent,
-	Map arg);
+	Map&lt;?, ?&gt; arg);
 	/** Creates components from the raw content specified by a string.
 	 * The created components become the child of the specified parent,
 	 * or become the root components of the current page if parent is specified
@@ -557,7 +557,7 @@
 	 * @see #createComponentsDirectly(Reader, String, Component, Map)
 	 */
 	public Component createComponentsDirectly(String content, String extension,
-	Component parent, Map arg);
+	Component parent, Map&lt;?, ?&gt; arg);
 	/** Creates components from the raw content specified by a DOM tree.
 	 * The created components become the child of the specified parent,
 	 * or become the root components of the current page if parent is specified
@@ -589,7 +589,7 @@
 	 * @see #createComponentsDirectly(Reader, String, Component, Map)
 	 */
 	public Component createComponentsDirectly(Document content, String extension,
-	Component parent, Map arg);
+	Component parent, Map&lt;?, ?&gt; arg);
 	/** Creates components from the raw content read from the specified reader.
 	 * The created components become the child of the specified parent,
 	 * or become the root components of the current page if parent is specified
@@ -621,7 +621,7 @@
 	 * @see #createComponentsDirectly(String, String, Component, Map)
 	 */
 	public Component createComponentsDirectly(Reader reader, String extension,
-	Component parent, Map arg) throws IOException;
+	Component parent, Map&lt;?, ?&gt; arg) throws IOException;
 
 	/** Creates components that don't belong to any page
 	 * from the specified page definition.
@@ -634,7 +634,7 @@
 	 * @see #createComponents(String, Map)
 	 * @since 2.4.0
 	 */
-	public Component[] createComponents(PageDefinition pagedef, Map arg);
+	public Component[] createComponents(PageDefinition pagedef, Map&lt;?, ?&gt; arg);
 	/** Creates components that don't belong to any page
 	 * from a page file specified by an URI.
 	 *
@@ -652,7 +652,7 @@
 	 * @see #createComponentsDirectly(Reader, String, Map)
 	 * @since 2.4.0
 	 */
-	public Component[] createComponents(String uri, Map arg);
+	public Component[] createComponents(String uri, Map&lt;?, ?&gt; arg);
 	/** Creates components that don't belong to any page
 	 * from the raw content specified by a string.
 	 *
@@ -678,7 +678,7 @@
 	 * @since 2.4.0
 	 */
 	public Component[] createComponentsDirectly(String content, String extension,
-	Map arg);
+	Map&lt;?, ?&gt; arg);
 	/** Creates components that don't belong to any page
 	 * from the raw content specified by a DOM tree.
 	 *
@@ -704,7 +704,7 @@
 	 * @since 2.4.0
 	 */
 	public Component[] createComponentsDirectly(Document content, String extension,
-	Map arg);
+	Map&lt;?, ?&gt; arg);
 	/** Creates components that don't belong to any page
 	 * from the raw content read from the specified reader.
 	 *
@@ -730,7 +730,7 @@
 	 * @since 2.4.0
 	 */
 	public Component[] createComponentsDirectly(Reader reader, String extension,
-	Map arg) throws IOException;
+	Map&lt;?, ?&gt; arg) throws IOException;
 
 	/** Sends a temporary redirect response to the client using the specified
 	 * redirect location URL.
@@ -779,12 +779,12 @@
 	 * However, {@link org.zkoss.zk.ui.event.CreateEvent#getArg} preserves
 	 * the map for its event listeners.
 	 */
-	public Map getArg();
+	public Map&lt;?, ?&gt; getArg();
 	/** Pushes the parameters (aka., arg) that EL could refer it by the arg variable.
 	 * Remember to call {@link #popArg} in the finally clause.
 	 * @see #getArg
 	 */
-	public void pushArg(Map arg);
+	public void pushArg(Map&lt;?, ?&gt; arg);
 	/** Pops the parameters (aka., arg) that is pushed by {@link #pushArg}.
 	 * &lt;p&gt;It never throws an exception.
 	 * @see #getArg
@@ -911,7 +911,7 @@
 	public Object removeAttribute(String name);
 	/** Returns a map of request attributes associated with this session.
 	 */
-	public Map getAttributes();
+	public Map&lt;String, Object&gt; getAttributes();
 
 	/** Returns the value of the specified header as a {@link String},
 	 * or null if not found.

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/IdSpace.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/IdSpace.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/IdSpace.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -78,7 +78,7 @@
 	 * The returned collection is readonly.
 	 * @since 3.0.6
 	 */
-	public Collection getFellows();
+	public Collection&lt;Component&gt; getFellows();
 	/** Returns whether there is a fellow named with the specified component ID.
 	 * @since 3.5.2
 	 */

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Page.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Page.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Page.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -168,7 +168,7 @@
 
 	/** Returns a readonly list of the root components.
 	 */
-	public Collection getRoots();
+	public Collection&lt;Component&gt; getRoots();
 	/** Returns the first root component.
 	 * @since 3.5.2
 	 */
@@ -221,7 +221,7 @@
 	 * @param scope {@link #APPLICATION_SCOPE}, {@link #SESSION_SCOPE},
 	 * {@link #PAGE_SCOPE}, {@link #REQUEST_SCOPE} or {@link #DESKTOP_SCOPE}.
 	 */
-	public Map getAttributes(int scope);
+	public Map&lt;String, Object&gt; getAttributes(int scope);
 	/** Returns the value of the specified custom attribute in the specified scope.
 	 *
 	 * &lt;p&gt;If scope is {@link #PAGE_SCOPE}, it means custom attributes shared
@@ -261,7 +261,7 @@
 
 	/** Returns all custom attributes associated with this page.
 	 */
-	public Map getAttributes();
+	public Map&lt;String, Object&gt; getAttributes();
 	/** Returns the value of the specified attribute associated with this page.
 	 */
 	public Object getAttribute(String name);
@@ -482,7 +482,7 @@
 	public Interpreter getInterpreter(String zslang);
 	/** Returns all loaded interpreters.
 	 */
-	public Collection getLoadedInterpreters();
+	public Collection&lt;Interpreter&gt; getLoadedInterpreters();
 
 	/** Returns the default scripting language which is assumed when
 	 * a zscript element doesn't specify any language.

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/Session.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/Session.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/Session.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -66,7 +66,7 @@
 
 	/** Returns a map of custom attributes associated with this session.
 	 */
-	public Map getAttributes();
+	public Map&lt;String, Object&gt; getAttributes();
 
 	/** Returns the Web application that this session belongs to.
 	 */

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/WebApp.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/WebApp.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/WebApp.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -90,7 +90,7 @@
 
 	/** Returns a map of custom attributes associated with this object.
 	 */
-	public Map getAttributes();
+	public Map&lt;String, Object&gt; getAttributes();
 
 	/** Returns the WebApp that corresponds to a specified URL on the server,
 	 * or null if either none exists or the container wishes to restrict
@@ -156,7 +156,7 @@
 &lt;/code&gt;
 &lt;/pre&gt;
 	 */
-	public Set getResourcePaths(String path);
+	public Set&lt;String&gt; getResourcePaths(String path);
 
 	/** Returns the value of the named context-wide initialization parameter,
 	 * or null if the parameter does not exist.
@@ -166,7 +166,7 @@
 	 * an Iterator of String objects, or an empty Iterator if the context
 	 * has no initialization parameters.
 	 */
-	public Iterator getInitParameterNames();
+	public Iterator&lt;String&gt; getInitParameterNames();
 
 	/** Returns the URI for asynchronous update.
 	 * &lt;p&gt;Both {@link #getUpdateURI} and {@link Desktop#getUpdateURI}

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/ext/Scope.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/ext/Scope.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/ext/Scope.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -26,7 +26,7 @@
 public interface Scope {
 	/** Returns all custom attributes associated with this object (scope).
 	 */
-	public Map getAttributes();
+	public Map&lt;String, Object&gt; getAttributes();
 	/** Returns the custom attribute associated with this object (scope).
 	 */
 	public Object getAttribute(String name);

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/ext/render/Cropper.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/ext/render/Cropper.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/ext/render/Cropper.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -57,7 +57,7 @@
 	 * parents. It is useful if you want to implement multi-level cropping,
 	 * such as tree. Refer to {@link #getCropOwner}.
 	 */
-	public Set getAvailableAtClient();
+	public Set&lt;Component&gt; getAvailableAtClient();
 	/** Returns the owner of the cropping scope.
 	 * In most cases, {@link #getAvailableAtClient} returns only the
 	 * available direct children of this compnent,

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/DesktopImpl.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/DesktopImpl.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/DesktopImpl.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -168,7 +168,7 @@
 	private transient List _uuidRecycle;
 
 	private transient ReqResult _lastRes;
-	private transient List _piggyRes;
+	private transient List&lt;AuResponse&gt; _piggyRes;
 
 	private static final int MAX_RESPONSE_ID = 999;
 	/** The response sequence ID. */
@@ -1368,15 +1368,14 @@
 			throw new IllegalArgumentException("Invalid response ID: "+resId);
 		_resId = resId &lt; 0 ? 0: resId;
 	}
-	public List piggyResponse(List response, boolean reset) {
+	public List&lt;AuResponse&gt; piggyResponse(Collection&lt;AuResponse&gt; response, boolean reset) {
 		if (response != null) {
 			if (_piggyRes == null)
-				_piggyRes = response;
-			else
-				_piggyRes.addAll(response);
+				_piggyRes = new LinkedList&lt;AuResponse&gt;();
+			_piggyRes.addAll(response);
 		}
 
-		List l = _piggyRes;
+		List&lt;AuResponse&gt; l = _piggyRes;
 		if (reset) _piggyRes = null;
 		return l;
 	}

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/ListenerIterator.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/ListenerIterator.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/ListenerIterator.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -19,6 +19,8 @@
 import java.util.List;
 import java.util.Iterator;
 
+import org.zkoss.zk.ui.event.EventListener;
+
 /**
  * Used to iterate the event listener.
  *
@@ -31,12 +33,12 @@
  *
  * @author tomyeh
  */
-public class ListenerIterator implements Iterator {
-	private final List _org;
+public class ListenerIterator implements Iterator&lt;EventListener&gt; {
+	private final List&lt;EventListener&gt; _org;
 	private int _orgsz;
-	private final Iterator _it;
+	private final Iterator&lt;EventListener&gt; _it;
 
-	public ListenerIterator(List list) {
+	public ListenerIterator(List&lt;EventListener&gt; list) {
 		_org = list;
 		_orgsz = list.size();
 		_it = list.iterator();
@@ -46,7 +48,7 @@
 			throw new java.util.ConcurrentModificationException();
 		return _it.hasNext();
 	}
-	public Object next() {
+	public EventListener next() {
 		return _it.next();
 	}
 	/** Removes the listener been interated (available since 3.6.3)

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/ScopeListeners.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/ScopeListeners.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/ScopeListeners.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -33,7 +33,7 @@
  */
 public class ScopeListeners {
 	private final Scope _owner;
-	private List _listeners;
+	private List&lt;ScopeListener&gt; _listeners;
 
 	/** Constructor.
 	 * @param owner the scope that is the owner (i.e., visible to the users).
@@ -49,7 +49,7 @@
 			throw new IllegalArgumentException("null");
 
 		if (_listeners == null)
-			_listeners = new LinkedList();
+			_listeners = new LinkedList&lt;ScopeListener&gt;();
 		else if (_listeners.contains(listener))
 			return false;
 
@@ -63,8 +63,8 @@
 	}
 	/** Returns a ist of all scope listners (never null).
 	 */
-	public List getListeners() {
-		if (_listeners == null) _listeners = new LinkedList();
+	public List&lt;ScopeListener&gt; getListeners() {
+		if (_listeners == null) _listeners = new LinkedList&lt;ScopeListener&gt;();
 		return _listeners;
 	}
 
@@ -75,8 +75,8 @@
 	 */
 	public void notifyAdded(String name, Object value) {
 		if (_listeners != null)
-			for (Iterator it = _listeners.iterator(); it.hasNext();)
-				((ScopeListener)it.next()).attributeAdded(_owner, name, value);
+			for (ScopeListener l: _listeners)
+				l.attributeAdded(_owner, name, value);
 	}
 	/** Invokes {@link ScopeListener#attributeReplaced} for registered
 	 * listeners.
@@ -85,8 +85,8 @@
 	 */
 	public void notifyReplaced(String name, Object value) {
 		if (_listeners != null)
-			for (Iterator it = _listeners.iterator(); it.hasNext();)
-				((ScopeListener)it.next()).attributeReplaced(_owner, name, value);
+			for (ScopeListener l: _listeners)
+				l.attributeReplaced(_owner, name, value);
 	}
 	/** Invokes {@link ScopeListener#attributeRemoved} for registered
 	 * listeners.
@@ -95,8 +95,8 @@
 	 */
 	public void notifyRemoved(String name) {
 		if (_listeners != null)
-			for (Iterator it = _listeners.iterator(); it.hasNext();)
-				((ScopeListener)it.next()).attributeRemoved(_owner, name);
+			for (ScopeListener l: _listeners)
+				l.attributeRemoved(_owner, name);
 	}
 	/** Invokes {@link ScopeListener#parentChanged} for registered
 	 * listeners.
@@ -105,8 +105,8 @@
 	 */
 	public void notifyParentChanged(Scope newparent) {
 		if (_listeners != null)
-			for (Iterator it = _listeners.iterator(); it.hasNext();)
-				((ScopeListener)it.next()).parentChanged(_owner, newparent);
+			for (ScopeListener l: _listeners)
+				l.parentChanged(_owner, newparent);
 	}
 
 	/** Invokes {@link ScopeListener#idSpaceChanged} for registered
@@ -117,7 +117,7 @@
 	 */
 	public void notifyIdSpaceChanged(IdSpace newIdSpace) {
 		if (_listeners != null)
-			for (Iterator it = _listeners.iterator(); it.hasNext();)
-				((ScopeListener)it.next()).idSpaceChanged(_owner, newIdSpace);
+			for (ScopeListener l: _listeners)
+				l.idSpaceChanged(_owner, newIdSpace);
 	}
 }

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/impl/SimpleScope.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/impl/SimpleScope.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/impl/SimpleScope.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -44,7 +44,7 @@
  */
 public class SimpleScope implements Scope {
 	private final Scope _owner;
-	private Map _attrs;
+	private Map&lt;String, Object&gt; _attrs;
 	private final ScopeListeners _listeners;
 
 	/** Constructor.
@@ -57,7 +57,7 @@
 	}
 
 	//Scope//
-	public Map getAttributes() {
+	public Map&lt;String, Object&gt; getAttributes() {
 		if (_attrs == null) _attrs = new Attrs();
 		return _attrs;
 	}
@@ -118,7 +118,7 @@
 	}
 	/** Returns a ist of all scope listners (never null).
 	 */
-	public List getListeners() {
+	public List&lt;ScopeListener&gt; getListeners() {
 		return _listeners.getListeners();
 	}
 
@@ -129,9 +129,8 @@
 	public SimpleScope clone(Scope owner) {
 		final SimpleScope clone = new SimpleScope(owner);
 		if (_attrs != null) {
-			clone._attrs = new HashMap();
-			for (Iterator it = _attrs.entrySet().iterator(); it.hasNext();) {
-				final Map.Entry me = (Map.Entry)it.next();
+			clone._attrs = new HashMap&lt;String, Object&gt;();
+			for (Map.Entry&lt;String, Object&gt; me: _attrs.entrySet()) {
 				Object val = me.getValue();
 				if (val instanceof ComponentCloneListener
 				&amp;&amp; owner instanceof Component) {
@@ -142,14 +141,13 @@
 			}
 		}
 
-		for (Iterator it = _listeners.getListeners().iterator(); it.hasNext();) {
-			Object val = it.next();
+		for (ScopeListener val: _listeners.getListeners()) {
 			if (val instanceof ComponentCloneListener
 			&amp;&amp; owner instanceof Component) {
-				val = ((ComponentCloneListener)val).willClone((Component)owner);
+				val = (ScopeListener)((ComponentCloneListener)val).willClone((Component)owner);
 				if (val == null) continue; //don't use it in clone
 			}
-			clone._listeners.addScopeListener((ScopeListener)val);
+			clone._listeners.addScopeListener(val);
 		}
 		return clone;
 	}
@@ -160,22 +158,24 @@
 	}
 
 	//Helper Class//
-	private class Attrs extends HashMap {
+	private class Attrs extends HashMap&lt;String, Object&gt; {
 		public Object remove(Object key) {
 			final Object o = super.remove(key);
 			if (o != null) _listeners.notifyRemoved((String)key);
 			return o;
 		}
-		public Object put(Object key, Object val) {
+		public Object put(String key, Object val) {
 			final Object o = super.put(key, val);
-			if (o != null) _listeners.notifyReplaced((String)key, val);
-			else _listeners.notifyAdded((String)key, val);
+			if (o != null) _listeners.notifyReplaced(key, val);
+			else _listeners.notifyAdded(key, val);
 			return o;
 		}
-		public Set entrySet() {
+		@SuppressWarnings("unchecked")
+		public Set&lt;Map.Entry&lt;String, Object&gt;&gt; entrySet() {
 			return new AttrSet(super.entrySet(), true);
 		}
-		public Set keySet() {
+		@SuppressWarnings("unchecked")
+		public Set&lt;String&gt; keySet() {
 			return new AttrSet(super.keySet(), false);
 		}
 		private class AttrSet extends AbstractSet {
@@ -191,6 +191,7 @@
 			public int size() {
 				return _set.size();
 			}
+			@SuppressWarnings("unchecked")
 			public boolean add(Object o) {
 				if (_set.add(o)) {
 					if (_entry) {

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/AbstractEvalRef.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/AbstractEvalRef.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/AbstractEvalRef.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -36,7 +36,7 @@
 	}
 
 	//Evaluator//
-	public Expression parseExpression(String expression, Class expectedType)
+	public Expression parseExpression(String expression, Class&lt;?&gt; expectedType)
 	throws XelException {
 		return getEvaluator().parseExpression(expression, expectedType);
 	}

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Annotation.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Annotation.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/Annotation.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -44,7 +44,7 @@
 	/** Returns the map of attributes (String name, String value) (never null).
 	 * The returned map is read-only.
 	 */
-	public Map getAttributes();
+	public Map&lt;String, String&gt; getAttributes();
 	/** Returns the attribute of the given name, or null if not found.
 	 */
 	public String getAttribute(String name);

Modified: branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/AnnotationMap.java
===================================================================
--- branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/AnnotationMap.java	2010-09-11 05:40:45 UTC (rev 14273)
+++ branches/6.0/zk/src/org/zkoss/zk/ui/metainfo/AnnotationMap.java	2010-09-13 05:41:23 UTC (rev 14274)
@@ -37,7 +37,7 @@
 	/** The annotations of properties,
 	 * (String propName, Map(String annotName, AnnotImpl)).
 	 */
-	private Map _annots;
+	private Map&lt;String, Map&lt;String, AnnotImpl&gt;&gt; _annots;
 
 	/** Returns whether no annotation at all.
 	 */
@@ -67,7 +67,7 @@
 	/** Returns a read-only collection of all annotations associated with the
 	 * component definition (never null).
 	 */
-	public Collection getAnnotations() {
+	public Collection&lt;Annotation&gt; getAnnotations() {
 		return getAnnotations0(null);
 	}
 	/** Returns a read-only collection of all annotations associated with the
@@ -76,7 +76,7 @@
 	 * @param propName the property name, e.g., "value".
 	 * @exception IllegalArgumentException if propName is null or empty
 	 */

@@ Diff output truncated at 100000 characters. @@

This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
<ul>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26183481">[zk1-subversion-log] SF.net SVN: zk1:[14279]</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-18 05:37</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14279
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14279&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14279&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-18 05:37:48 +0000 (Sat, 18 Sep 2010)

Log Message:
-----------
Sat 09/18/2010

Modified Paths:
--------------
    branches/5.0/build.target.xml
    branches/5.0/zcommon/pom.xml
    branches/5.0/zhtml/pom.xml
    branches/5.0/zk/pom.xml
    branches/5.0/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java
    branches/5.0/zkplus/pom.xml
    branches/5.0/zul/pom.xml
    branches/5.0/zul/src/org/zkoss/zul/Listbox.java
    branches/5.0/zul/src/org/zkoss/zul/Rows.java
    branches/5.0/zul/src/org/zkoss/zul/Treechildren.java
    branches/5.0/zweb/pom.xml
    trunk/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java

Added Paths:
-----------
    branches/5.0/zcommon/.classpath
    branches/5.0/zcommon/.project
    branches/5.0/zcommon/.settings/
    branches/5.0/zcommon/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zcommon/.settings/org.maven.ide.eclipse.prefs
    branches/5.0/zcommon/src/org/zkoss/mesg/MCommon.java
    branches/5.0/zhtml/.classpath
    branches/5.0/zhtml/.project
    branches/5.0/zhtml/.settings/
    branches/5.0/zhtml/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zhtml/.settings/org.maven.ide.eclipse.prefs
    branches/5.0/zk/.classpath
    branches/5.0/zk/.project
    branches/5.0/zk/.settings/
    branches/5.0/zk/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zk/.settings/org.maven.ide.eclipse.prefs
    branches/5.0/zk/src/org/zkoss/zk/mesg/MZk.java
    branches/5.0/zkplus/.classpath
    branches/5.0/zkplus/.project
    branches/5.0/zkplus/.settings/
    branches/5.0/zkplus/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zkplus/.settings/org.maven.ide.eclipse.prefs
    branches/5.0/zul/.classpath
    branches/5.0/zul/.project
    branches/5.0/zul/.settings/
    branches/5.0/zul/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zul/src/org/zkoss/zul/mesg/MZul.java
    branches/5.0/zweb/.classpath
    branches/5.0/zweb/.project
    branches/5.0/zweb/.settings/
    branches/5.0/zweb/.settings/org.eclipse.jdt.core.prefs
    branches/5.0/zweb/.settings/org.maven.ide.eclipse.prefs
    branches/5.0/zweb/src/org/zkoss/web/mesg/MWeb.java

Modified: branches/5.0/build.target.xml
===================================================================
--- branches/5.0/build.target.xml	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/build.target.xml	2010-09-18 05:37:48 UTC (rev 14279)
@@ -20,7 +20,7 @@
 		&lt;arg value="${bin.dir}/genprop"/&gt;
 		&lt;arg value="-x"/&gt;
 		&lt;arg value="${src.mesg.dir}"/&gt;
-		&lt;arg value="${codegen.dir}"/&gt;
+		&lt;arg value="${src.dir}"/&gt;
 	&lt;/exec&gt;
 &lt;/target&gt;
 

Added: branches/5.0/zcommon/.classpath
===================================================================
--- branches/5.0/zcommon/.classpath	                        (rev 0)
+++ branches/5.0/zcommon/.classpath	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/5.0/zcommon/.project
===================================================================
--- branches/5.0/zcommon/.project	                        (rev 0)
+++ branches/5.0/zcommon/.project	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,23 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zcommon&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/5.0/zcommon/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zcommon/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/5.0/zcommon/.settings/org.eclipse.jdt.core.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:55:11 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.6

Added: branches/5.0/zcommon/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/5.0/zcommon/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/5.0/zcommon/.settings/org.maven.ide.eclipse.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:39:30 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Modified: branches/5.0/zcommon/pom.xml
===================================================================
--- branches/5.0/zcommon/pom.xml	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zcommon/pom.xml	2010-09-18 05:37:48 UTC (rev 14279)
@@ -1,34 +1,71 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-  &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;The ZKoss Common Library&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/common&lt;/url" target="_new">http://www.zkoss.org/common&lt;/url</a>&gt;
-  &lt;description&gt;The ZKoss common library&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zcommon&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zcommon&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
-      &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
-      &lt;version&gt;1.2.1&lt;/version&gt;
-    &lt;/dependency&gt;
-	&lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.zkforge.el&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommons-el&lt;/artifactId&gt;
-      &lt;version&gt;1.1.0&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+	&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;name&gt;The ZKoss Common Library&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/common&lt;/url" target="_new">http://www.zkoss.org/common&lt;/url</a>&gt;
+	&lt;description&gt;The ZKoss common library&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zcommon&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zcommon&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
+			&lt;version&gt;1.2.1&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zkforge.el&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommons-el&lt;/artifactId&gt;
+			&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.beanshell&lt;/groupId&gt;
+			&lt;artifactId&gt;bsh&lt;/artifactId&gt;
+			&lt;version&gt;2.0b4&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
+			&lt;version&gt;2.4&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Added: branches/5.0/zcommon/src/org/zkoss/mesg/MCommon.java
===================================================================
--- branches/5.0/zcommon/src/org/zkoss/mesg/MCommon.java	                        (rev 0)
+++ branches/5.0/zcommon/src/org/zkoss/mesg/MCommon.java	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,38 @@
+// org.zkoss.mesg.MCommon.java
+//
+// Generated by genprop
+// DO NOT MODIFY IT MANUALLY. All modifications will be lost.
+//
+// jumperchen, Fri Sep 17 16:11:32 TST 2010
+// Copyright(C) 2001-2008 Potix Corporation. All Rights Reserved.
+
+package org.zkoss.mesg;
+
+public interface MCommon extends org.zkoss.mesg.MessageConst {
+	static final int MESSAGE_ID = Aide.register(MCommon.class, "msgcommon");
+	static final int EMPTY_NOT_ALLOWED = 0x1000 + MESSAGE_ID;
+	static final int REQUIRED = 0x1001 + MESSAGE_ID;
+	static final int ILLEGAL_CHAR = 0x1002 + MESSAGE_ID;
+	static final int MESSAGE_CODE_NOT_FOUND = 0x1003 + MESSAGE_ID;
+	static final int UNKNOWN_EXCEPTION = 0x1006 + MESSAGE_ID;
+	static final int NOT_FOUND = 0x100a + MESSAGE_ID;
+	static final int FILE_NOT_FOUND = 0x1200 + MESSAGE_ID;
+	static final int FILE_READ_FAILED = 0x1201 + MESSAGE_ID;
+	static final int FILE_WRITE_FAILED = 0x1202 + MESSAGE_ID;
+	static final int FILE_REMOVE_FAILED = 0x1203 + MESSAGE_ID;
+	static final int FILE_OPENING = 0x1204 + MESSAGE_ID;
+	static final int FILE_LOADED = 0x1205 + MESSAGE_ID;
+	static final int FILE_NOT_FOUND_IGNORED = 0x1206 + MESSAGE_ID;
+	static final int FILE_DUPLICATE = 0x1207 + MESSAGE_ID;
+	static final int NOT_A_FILE = 0x1208 + MESSAGE_ID;
+	static final int FAILED_TO_LOAD = 0x1300 + MESSAGE_ID;
+	static final int SERVICE_INIT_OK = 0x1600 + MESSAGE_ID;
+	static final int SERVICE_STOP_OK = 0x1601 + MESSAGE_ID;
+	static final int SERVICE_INIT_TWICE_NOT_ALLOWED = 0x1603 + MESSAGE_ID;
+	static final int CLASS_NOT_COMPATIABLE = 0x1800 + MESSAGE_ID;
+	static final int XML_ELEMENT_REQUIRED = 0x2400 + MESSAGE_ID;
+	static final int XML_ATTRIBUTE_REQUIRED = 0x2404 + MESSAGE_ID;
+	static final int QUOTE_UNMATCHED = 0x2800 + MESSAGE_ID;
+	static final int UNEXPECTED_CHARACTER = 0x2801 + MESSAGE_ID;
+	static final int EXPECTING_CHARACTER = 0x2802 + MESSAGE_ID;
+}

Added: branches/5.0/zhtml/.classpath
===================================================================
--- branches/5.0/zhtml/.classpath	                        (rev 0)
+++ branches/5.0/zhtml/.classpath	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/5.0/zhtml/.project
===================================================================
--- branches/5.0/zhtml/.project	                        (rev 0)
+++ branches/5.0/zhtml/.project	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,23 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zhtml&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/5.0/zhtml/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zhtml/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/5.0/zhtml/.settings/org.eclipse.jdt.core.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:53:37 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.6

Added: branches/5.0/zhtml/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/5.0/zhtml/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/5.0/zhtml/.settings/org.maven.ide.eclipse.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:39:30 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Modified: branches/5.0/zhtml/pom.xml
===================================================================
--- branches/5.0/zhtml/pom.xml	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zhtml/pom.xml	2010-09-18 05:37:48 UTC (rev 14279)
@@ -1,39 +1,100 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-  &lt;artifactId&gt;zhtml&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;ZK XHTML Components&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/zhtml&lt;/url" target="_new">http://www.zkoss.org/zhtml&lt;/url</a>&gt;
-  &lt;description&gt;ZK XHTML components&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zhtml&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zhtml&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zweb&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-      &lt;artifactId&gt;zk&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+	&lt;artifactId&gt;zhtml&lt;/artifactId&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;name&gt;ZK XHTML Components&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/zhtml&lt;/url" target="_new">http://www.zkoss.org/zhtml&lt;/url</a>&gt;
+	&lt;description&gt;ZK XHTML components&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zhtml&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zhtml&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zk&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zul&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
+			&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
+			&lt;version&gt;1.2.1&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Added: branches/5.0/zk/.classpath
===================================================================
--- branches/5.0/zk/.classpath	                        (rev 0)
+++ branches/5.0/zk/.classpath	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/5.0/zk/.project
===================================================================
--- branches/5.0/zk/.project	                        (rev 0)
+++ branches/5.0/zk/.project	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,23 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zk&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/5.0/zk/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zk/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/5.0/zk/.settings/org.eclipse.jdt.core.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:45:08 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.6

Added: branches/5.0/zk/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/5.0/zk/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/5.0/zk/.settings/org.maven.ide.eclipse.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:39:30 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Modified: branches/5.0/zk/pom.xml
===================================================================
--- branches/5.0/zk/pom.xml	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zk/pom.xml	2010-09-18 05:37:48 UTC (rev 14279)
@@ -1,34 +1,110 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-  &lt;artifactId&gt;zk&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;ZK Kernel&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/zk&lt;/url" target="_new">http://www.zkoss.org/zk&lt;/url</a>&gt;
-  &lt;description&gt;ZK Kernel&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zk&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zk&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zweb&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+	&lt;artifactId&gt;zk&lt;/artifactId&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;name&gt;ZK Kernel&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/zk&lt;/url" target="_new">http://www.zkoss.org/zk&lt;/url</a>&gt;
+	&lt;description&gt;ZK Kernel&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zk&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zk&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.portlet&lt;/groupId&gt;
+			&lt;artifactId&gt;portlet-api&lt;/artifactId&gt;
+			&lt;version&gt;2.0&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
+			&lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
+			&lt;version&gt;1.5.6&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.jruby&lt;/groupId&gt;
+			&lt;artifactId&gt;jruby&lt;/artifactId&gt;
+			&lt;version&gt;1.1.2&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.python&lt;/groupId&gt;
+			&lt;artifactId&gt;jython&lt;/artifactId&gt;
+			&lt;version&gt;2.2.1&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;rhino&lt;/groupId&gt;
+			&lt;artifactId&gt;js&lt;/artifactId&gt;
+			&lt;version&gt;1.7R1&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Added: branches/5.0/zk/src/org/zkoss/zk/mesg/MZk.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/mesg/MZk.java	                        (rev 0)
+++ branches/5.0/zk/src/org/zkoss/zk/mesg/MZk.java	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,23 @@
+// org.zkoss.zk.mesg.MZk.java
+//
+// Generated by genprop
+// DO NOT MODIFY IT MANUALLY. All modifications will be lost.
+//
+// jumperchen, Fri Sep 17 16:11:52 TST 2010
+// Copyright(C) 2001-2008 Potix Corporation. All Rights Reserved.
+
+package org.zkoss.zk.mesg;
+
+public interface MZk extends org.zkoss.mesg.MessageConst {
+	static final int MESSAGE_ID = Aide.register(MZk.class, "msgzk");
+	static final int PAGE_NOT_FOUND = 0x1000 + MESSAGE_ID;
+	static final int PORTLET_PAGE_REQUIRED = 0x1001 + MESSAGE_ID;
+	static final int PAGE_FAILED = 0x1002 + MESSAGE_ID;
+	static final int UPDATE_OBSOLETE_PAGE = 0x1010 + MESSAGE_ID;
+	static final int RESUME_FAILED = 0x1020 + MESSAGE_ID;
+	static final int ILLEGAL_REQUEST_COMPONENT_REQUIRED = 0x2000 + MESSAGE_ID;
+	static final int ILLEGAL_REQUEST_WRONG_DATA = 0x2001 + MESSAGE_ID;
+	static final int NOT_FOUND = 0x3000 + MESSAGE_ID;
+	static final int TOO_MANY_SUSPENDED = 0x3100 + MESSAGE_ID;
+	static final int TOO_MANY_REQUESTS = 0x3101 + MESSAGE_ID;
+}

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java	2010-09-18 05:37:48 UTC (rev 14279)
@@ -322,7 +322,7 @@
 		final Configuration config = desktop.getWebApp().getConfiguration();
 		_evtThdInits = config.newEventThreadInits(comp, event);
 		try {
-			int evtTimeWarn = config.getEventTimeWarning();
+			long evtTimeWarn = config.getEventTimeWarning();
 			long begt = 0;
 			if (evtTimeWarn &gt; 0) {
 				begt = System.currentTimeMillis();

Added: branches/5.0/zkplus/.classpath
===================================================================
--- branches/5.0/zkplus/.classpath	                        (rev 0)
+++ branches/5.0/zkplus/.classpath	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/5.0/zkplus/.project
===================================================================
--- branches/5.0/zkplus/.project	                        (rev 0)
+++ branches/5.0/zkplus/.project	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,29 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zkplus&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+		&lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/5.0/zkplus/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zkplus/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/5.0/zkplus/.settings/org.eclipse.jdt.core.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 17:59:52 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.4
+org.eclipse.jdt.core.compiler.compliance=1.4
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.4

Added: branches/5.0/zkplus/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/5.0/zkplus/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/5.0/zkplus/.settings/org.maven.ide.eclipse.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:39:31 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Modified: branches/5.0/zkplus/pom.xml
===================================================================
--- branches/5.0/zkplus/pom.xml	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zkplus/pom.xml	2010-09-18 05:37:48 UTC (rev 14279)
@@ -1,39 +1,211 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-  &lt;artifactId&gt;zkplus&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;The ZK Plus Utilities&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/zkplus&lt;/url" target="_new">http://www.zkoss.org/zkplus&lt;/url</a>&gt;
-  &lt;description&gt;The ZK plus utilities&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zkplus&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zkplus&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zweb&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-      &lt;artifactId&gt;zk&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+	&lt;artifactId&gt;zkplus&lt;/artifactId&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+		&lt;org.springframework.version&gt;2.0.6&lt;/org.springframework.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;name&gt;The ZK Plus Utilities&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/zkplus&lt;/url" target="_new">http://www.zkoss.org/zkplus&lt;/url</a>&gt;
+	&lt;description&gt;The ZK plus utilities&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zkplus&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zkplus&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;maven seasar org&lt;/id&gt;
+			&lt;url&gt;<a href="http://maven.seasar.org/maven2&lt;/url" target="_new">http://maven.seasar.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+		&lt;repository&gt;
+			&lt;id&gt;jboss-repo&lt;/id&gt;
+			&lt;url&gt;<a href="http://repository.jboss.com/maven2&lt;/url" target="_new">http://repository.jboss.com/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zk&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zul&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;dom4j&lt;/groupId&gt;
+			&lt;artifactId&gt;dom4j&lt;/artifactId&gt;
+			&lt;version&gt;1.6&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;com.google.collections&lt;/groupId&gt;
+			&lt;artifactId&gt;google-collections&lt;/artifactId&gt;
+			&lt;version&gt;1.0-rc3&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javassist&lt;/groupId&gt;
+			&lt;artifactId&gt;javassist&lt;/artifactId&gt;
+			&lt;version&gt;3.8.0.GA&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.inject&lt;/groupId&gt;
+			&lt;artifactId&gt;javax.inject&lt;/artifactId&gt;
+			&lt;version&gt;1&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.jboss.weld.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;weld-servlet&lt;/artifactId&gt;
+			&lt;version&gt;1.0.1-Final&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.enterprise&lt;/groupId&gt;
+			&lt;artifactId&gt;cdi-api&lt;/artifactId&gt;
+			&lt;version&gt;1.0-CR1&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-core&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-aop&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-context&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-web&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
+			&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
+			&lt;version&gt;${org.springframework.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.seasar.container&lt;/groupId&gt;
+			&lt;artifactId&gt;s2-framework&lt;/artifactId&gt;
+			&lt;version&gt;2.4.43&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.acegisecurity&lt;/groupId&gt;
+			&lt;artifactId&gt;acegi-security&lt;/artifactId&gt;
+			&lt;version&gt;1.0.3&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
+			&lt;version&gt;2.5&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.el&lt;/groupId&gt;
+			&lt;artifactId&gt;el-api&lt;/artifactId&gt;
+			&lt;version&gt;2.2&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.persistence&lt;/groupId&gt;
+			&lt;artifactId&gt;persistence-api&lt;/artifactId&gt;
+			&lt;version&gt;1.0&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.hibernate&lt;/groupId&gt;
+			&lt;artifactId&gt;hibernate&lt;/artifactId&gt;
+			&lt;version&gt;3.2.0.ga&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.hibernate&lt;/groupId&gt;
+			&lt;artifactId&gt;hibernate-annotations&lt;/artifactId&gt;
+			&lt;version&gt;3.2.0.ga&lt;/version&gt;
+			&lt;exclusions&gt;
+				&lt;exclusion&gt;
+					&lt;groupId&gt;javax.persistence&lt;/groupId&gt;
+					&lt;artifactId&gt;ejb&lt;/artifactId&gt;
+				&lt;/exclusion&gt;
+			&lt;/exclusions&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.transaction&lt;/groupId&gt;
+			&lt;artifactId&gt;jta&lt;/artifactId&gt;
+			&lt;version&gt;1.1&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Added: branches/5.0/zul/.classpath
===================================================================
--- branches/5.0/zul/.classpath	                        (rev 0)
+++ branches/5.0/zul/.classpath	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/5.0/zul/.project
===================================================================
--- branches/5.0/zul/.project	                        (rev 0)
+++ branches/5.0/zul/.project	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,23 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zul&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/5.0/zul/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zul/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/5.0/zul/.settings/org.eclipse.jdt.core.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:44:20 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.6

Modified: branches/5.0/zul/pom.xml
===================================================================
--- branches/5.0/zul/pom.xml	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zul/pom.xml	2010-09-18 05:37:48 UTC (rev 14279)
@@ -1,39 +1,90 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-  &lt;artifactId&gt;zul&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;ZK XUL Components&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/zul&lt;/url" target="_new">http://www.zkoss.org/zul&lt;/url</a>&gt;
-  &lt;description&gt;ZK XUL components (XML user interface markup language)&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zul&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zul&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zweb&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
-      &lt;artifactId&gt;zk&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+	&lt;artifactId&gt;zul&lt;/artifactId&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;name&gt;ZK XUL Components&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/zul&lt;/url" target="_new">http://www.zkoss.org/zul&lt;/url</a>&gt;
+	&lt;description&gt;ZK XUL components (XML user interface markup language)&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zul&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zul&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.zk&lt;/groupId&gt;
+			&lt;artifactId&gt;zk&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Modified: branches/5.0/zul/src/org/zkoss/zul/Listbox.java
===================================================================
--- branches/5.0/zul/src/org/zkoss/zul/Listbox.java	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zul/src/org/zkoss/zul/Listbox.java	2010-09-18 05:37:48 UTC (rev 14279)
@@ -2295,17 +2295,6 @@
 	}
 
 	/**
-	 * Returns an iterator to iterate thru all visible children. Unlike
-	 * {@link #getVisibleItemCount}, it handles only the direct children.
-	 * Component developer only.
-	 * 
-	 * @since 3.5.1
-	 */
-	public Iterator getVisibleChildrenIterator() {
-		return new VisibleChildrenIterator();
-	}
-
-	/**
 	 * An iterator used by visible children.
 	 */
 	private class VisibleChildrenIterator implements Iterator {

Modified: branches/5.0/zul/src/org/zkoss/zul/Rows.java
===================================================================
--- branches/5.0/zul/src/org/zkoss/zul/Rows.java	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zul/src/org/zkoss/zul/Rows.java	2010-09-18 05:37:48 UTC (rev 14279)
@@ -500,21 +500,16 @@
 		}
 	}
 
-	/** Returns an iterator to iterate thru all visible children.
-	 * Unlike {@link #getVisibleItemCount}, it handles only the direct children.
-	 * Component developer only.
-	 * @since 3.5.1
-	 */
-	public Iterator getVisibleChildrenIterator() {
-		return new VisibleChildrenIterator();
-	}
 	/**
 	 * An iterator used by visible children.
 	 */
+/** Not used
 	private class VisibleChildrenIterator implements Iterator {
 		private final ListIterator _it = getChildren().listIterator();
 		private Grid _grid = getGrid();
 		private int _count = 0;
+		private VisibleChildrenIterator() {
+		}
 		public boolean hasNext() {
 			if (_grid == null || !_grid.inPagingMold()) return _it.hasNext();
 			
@@ -555,6 +550,8 @@
 			throw new UnsupportedOperationException();
 		}
 	}
+*/
+
 	public String getZclass() {
 		return _zclass == null ? "z-rows" : _zclass;
 	}

Modified: branches/5.0/zul/src/org/zkoss/zul/Treechildren.java
===================================================================
--- branches/5.0/zul/src/org/zkoss/zul/Treechildren.java	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zul/src/org/zkoss/zul/Treechildren.java	2010-09-18 05:37:48 UTC (rev 14279)
@@ -229,14 +229,7 @@
 		} else
 			((Tree)comp).smartUpdate(name, value);
 	}
-	/** Returns an iterator to iterate thru all visible children.
-	 * Unlike {@link #getVisibleItemCount}, it handles only the direct children.
-	 * Component developer only.
-	 * @since 3.0.7
-	 */
-	public Iterator getVisibleChildrenIterator() {
-		return new VisibleChildrenIterator();
-	}
+
 	/**
 	 * An iterator used by visible children.
 	 */
@@ -244,6 +237,9 @@
 		private final Iterator _it = getChildren().iterator();
 		private Tree _tree = getTree();
 
+		private VisibleChildrenIterator() {
+		}
+
 		public boolean hasNext() {
 			if (_tree == null || !_tree.inPagingMold()) return _it.hasNext();
 
@@ -262,7 +258,7 @@
 	
 	protected void redrawChildren(Writer out) throws IOException {
 		if (getAttribute(Attributes.SHALL_RENDER_ITEM) == null) {
-			for (Iterator it = getVisibleChildrenIterator(); it.hasNext();)
+			for (Iterator it = new VisibleChildrenIterator(); it.hasNext();)
 				((ComponentCtrl)it.next()).redraw(out);
 		}
 	}

Added: branches/5.0/zul/src/org/zkoss/zul/mesg/MZul.java
===================================================================
--- branches/5.0/zul/src/org/zkoss/zul/mesg/MZul.java	                        (rev 0)
+++ branches/5.0/zul/src/org/zkoss/zul/mesg/MZul.java	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,58 @@
+// org.zkoss.zul.mesg.MZul.java
+//
+// Generated by genprop
+// DO NOT MODIFY IT MANUALLY. All modifications will be lost.
+//
+// jumperchen, Fri Sep 17 16:14:02 TST 2010
+// Copyright(C) 2001-2008 Potix Corporation. All Rights Reserved.
+
+package org.zkoss.zul.mesg;
+
+public interface MZul extends org.zkoss.mesg.MessageConst {
+	static final int MESSAGE_ID = Aide.register(MZul.class, "msgzul");
+	static final int EMPTY_NOT_ALLOWED = 0x2000 + MESSAGE_ID;
+	static final int NO_POSITIVE_NEGATIVE_ZERO = 0x2001 + MESSAGE_ID;
+	static final int NO_POSITIVE_NEGATIVE = 0x2002 + MESSAGE_ID;
+	static final int NO_POSITIVE_ZERO = 0x2003 + MESSAGE_ID;
+	static final int NO_POSITIVE = 0x2004 + MESSAGE_ID;
+	static final int NO_NEGATIVE_ZERO = 0x2005 + MESSAGE_ID;
+	static final int NO_NEGATIVE = 0x2006 + MESSAGE_ID;
+	static final int NO_ZERO = 0x2007 + MESSAGE_ID;
+	static final int NO_FUTURE_PAST_TODAY = 0x2011 + MESSAGE_ID;
+	static final int NO_FUTURE_PAST = 0x2012 + MESSAGE_ID;
+	static final int NO_FUTURE_TODAY = 0x2013 + MESSAGE_ID;
+	static final int NO_FUTURE = 0x2014 + MESSAGE_ID;
+	static final int NO_PAST_TODAY = 0x2015 + MESSAGE_ID;
+	static final int NO_PAST = 0x2016 + MESSAGE_ID;
+	static final int NO_TODAY = 0x2017 + MESSAGE_ID;
+	static final int VALUE_NOT_MATCHED = 0x2018 + MESSAGE_ID;
+	static final int INTEGER_REQUIRED = 0x2040 + MESSAGE_ID;
+	static final int NUMBER_REQUIRED = 0x2041 + MESSAGE_ID;
+	static final int DATE_REQUIRED = 0x2042 + MESSAGE_ID;
+	static final int OUT_OF_RANGE = 0x2043 + MESSAGE_ID;
+	static final int STRING_TOO_LONG = 0x2044 + MESSAGE_ID;
+	static final int ILLEGAL_VALUE = 0x2050 + MESSAGE_ID;
+	static final int UPLOAD_TITLE = 0x2100 + MESSAGE_ID;
+	static final int UPLOAD_MESSAGE = 0x2101 + MESSAGE_ID;
+	static final int UPLOAD_CANCEL = 0x2102 + MESSAGE_ID;
+	static final int UPLOAD_SUBMIT = 0x2103 + MESSAGE_ID;
+	static final int UPLOAD_BROWSE = 0x2104 + MESSAGE_ID;
+	static final int OK = 0x2200 + MESSAGE_ID;
+	static final int CANCEL = 0x2201 + MESSAGE_ID;
+	static final int YES = 0x2220 + MESSAGE_ID;
+	static final int NO = 0x2221 + MESSAGE_ID;
+	static final int RETRY = 0x2230 + MESSAGE_ID;
+	static final int ABORT = 0x2231 + MESSAGE_ID;
+	static final int IGNORE = 0x2232 + MESSAGE_ID;
+	static final int RELOAD = 0x2233 + MESSAGE_ID;
+	static final int FIRST = 0x2300 + MESSAGE_ID;
+	static final int LAST = 0x2301 + MESSAGE_ID;
+	static final int PREV = 0x2302 + MESSAGE_ID;
+	static final int NEXT = 0x2303 + MESSAGE_ID;
+	static final int PLEASE_WAIT = 0x2400 + MESSAGE_ID;
+	static final int GRID_GROUP = 0x2500 + MESSAGE_ID;
+	static final int GRID_OTHER = 0x2501 + MESSAGE_ID;
+	static final int GRID_ASC = 0x2502 + MESSAGE_ID;
+	static final int GRID_DESC = 0x2503 + MESSAGE_ID;
+	static final int GRID_COLUMNS = 0x2504 + MESSAGE_ID;
+}

Added: branches/5.0/zweb/.classpath
===================================================================
--- branches/5.0/zweb/.classpath	                        (rev 0)
+++ branches/5.0/zweb/.classpath	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,7 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry excluding="archive/" kind="src" path="src"/&gt;
+	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/&gt;
+	&lt;classpathentry kind="con" path="org.maven.ide.eclipse.MAVEN2_CLASSPATH_CONTAINER"/&gt;
+	&lt;classpathentry kind="output" path="debug/classes"/&gt;
+&lt;/classpath&gt;

Added: branches/5.0/zweb/.project
===================================================================
--- branches/5.0/zweb/.project	                        (rev 0)
+++ branches/5.0/zweb/.project	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,23 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;zweb&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.maven.ide.eclipse.maven2Builder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+		&lt;nature&gt;org.maven.ide.eclipse.maven2Nature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: branches/5.0/zweb/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- branches/5.0/zweb/.settings/org.eclipse.jdt.core.prefs	                        (rev 0)
+++ branches/5.0/zweb/.settings/org.eclipse.jdt.core.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:48:26 CST 2010
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
+org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
+org.eclipse.jdt.core.compiler.problem.forbiddenReference=warning
+org.eclipse.jdt.core.compiler.source=1.6

Added: branches/5.0/zweb/.settings/org.maven.ide.eclipse.prefs
===================================================================
--- branches/5.0/zweb/.settings/org.maven.ide.eclipse.prefs	                        (rev 0)
+++ branches/5.0/zweb/.settings/org.maven.ide.eclipse.prefs	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,9 @@
+#Fri Sep 17 16:39:31 CST 2010
+activeProfiles=
+eclipse.preferences.version=1
+fullBuildGoals=process-test-resources
+includeModules=false
+resolveWorkspaceProjects=true
+resourceFilterGoals=process-resources resources\:testResources
+skipCompilerPlugin=true
+version=1

Modified: branches/5.0/zweb/pom.xml
===================================================================
--- branches/5.0/zweb/pom.xml	2010-09-17 05:40:36 UTC (rev 14278)
+++ branches/5.0/zweb/pom.xml	2010-09-18 05:37:48 UTC (rev 14279)
@@ -1,47 +1,98 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;project&gt;
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-  &lt;artifactId&gt;zweb&lt;/artifactId&gt;
-  &lt;version&gt;{version}&lt;/version&gt;
-  &lt;packaging&gt;jar&lt;/packaging&gt;
-  &lt;name&gt;The ZKoss Web Library&lt;/name&gt;
-  &lt;url&gt;<a href="http://www.zkoss.org/web&lt;/url" target="_new">http://www.zkoss.org/web&lt;/url</a>&gt;
-  &lt;description&gt;The ZKoss Web library&lt;/description&gt;
-  &lt;licenses&gt;
-    &lt;license&gt;
-      &lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
-      &lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
-      &lt;distribution&gt;repo&lt;/distribution&gt;
-    &lt;/license&gt;
-  &lt;/licenses&gt;
-  &lt;scm&gt;
-    &lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zweb&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/{version}/zweb&lt;/url</a>&gt;
-  &lt;/scm&gt;
-  &lt;dependencies&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
-      &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
-      &lt;version&gt;2.4&lt;/version&gt;
-      &lt;scope&gt;provided&lt;/scope&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
-      &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
-      &lt;version&gt;2.0&lt;/version&gt;
-      &lt;scope&gt;provided&lt;/scope&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;javax.portlet&lt;/groupId&gt;
-      &lt;artifactId&gt;portlet-api&lt;/artifactId&gt;
-      &lt;version&gt;1.0&lt;/version&gt;
-      &lt;scope&gt;provided&lt;/scope&gt;
-    &lt;/dependency&gt;
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
-      &lt;artifactId&gt;zcommon&lt;/artifactId&gt;
-      &lt;version&gt;{version}&lt;/version&gt;
-    &lt;/dependency&gt;
-  &lt;/dependencies&gt;
+&lt;project xmlns="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>"
+	xsi:schemaLocation="<a href="http://maven.apache.org/POM/4.0.0" target="_new">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_new">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
+	&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+	&lt;artifactId&gt;zweb&lt;/artifactId&gt;
+	&lt;packaging&gt;jar&lt;/packaging&gt;
+	&lt;properties&gt;
+		&lt;zk.version&gt;5.0.5-FL&lt;/zk.version&gt;
+	&lt;/properties&gt;
+	&lt;version&gt;${zk.version}&lt;/version&gt;
+	&lt;name&gt;The ZKoss Web Library&lt;/name&gt;
+	&lt;url&gt;<a href="http://www.zkoss.org/web&lt;/url" target="_new">http://www.zkoss.org/web&lt;/url</a>&gt;
+	&lt;description&gt;The ZKoss Web library&lt;/description&gt;
+	&lt;licenses&gt;
+		&lt;license&gt;
+			&lt;name&gt;GNU General Public License, Version 2.0&lt;/name&gt;
+			&lt;url&gt;<a href="http://www.gnu.org/licenses/gpl.html&lt;/url" target="_new">http://www.gnu.org/licenses/gpl.html&lt;/url</a>&gt;
+			&lt;distribution&gt;repo&lt;/distribution&gt;
+		&lt;/license&gt;
+	&lt;/licenses&gt;
+	&lt;scm&gt;
+		&lt;url&gt;<a href="http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zweb&lt;/url" target="_new">http://svn.sourceforge.net/viewvc/zk1/releases/${zk.version}/zweb&lt;/url</a>&gt;
+	&lt;/scm&gt;
+	&lt;repositories&gt;
+		&lt;repository&gt;
+			&lt;id&gt;zk repository&lt;/id&gt;
+			&lt;url&gt;<a href="http://mavensync.zkoss.org/maven2&lt;/url" target="_new">http://mavensync.zkoss.org/maven2&lt;/url</a>&gt;
+		&lt;/repository&gt;
+	&lt;/repositories&gt;
+	&lt;pluginRepositories&gt;
+		&lt;pluginRepository&gt;
+			&lt;releases&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/releases&gt;
+			&lt;id&gt;snapshots&lt;/id&gt;
+			&lt;name&gt;Maven Central Plugins Development Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://snapshots.maven.codehaus.org/maven2&lt;/url" target="_new">http://snapshots.maven.codehaus.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+		&lt;pluginRepository&gt;
+			&lt;snapshots&gt;
+				&lt;enabled&gt;false&lt;/enabled&gt;
+			&lt;/snapshots&gt;
+			&lt;id&gt;central&lt;/id&gt;
+			&lt;name&gt;Maven Plugin Repository&lt;/name&gt;
+			&lt;url&gt;<a href="http://repo1.maven.org/maven2&lt;/url" target="_new">http://repo1.maven.org/maven2&lt;/url</a>&gt;
+		&lt;/pluginRepository&gt;
+	&lt;/pluginRepositories&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
+			&lt;version&gt;2.4&lt;/version&gt;
+			&lt;scope&gt;provided&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
+			&lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
+			&lt;version&gt;2.0&lt;/version&gt;
+			&lt;scope&gt;provided&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;javax.portlet&lt;/groupId&gt;
+			&lt;artifactId&gt;portlet-api&lt;/artifactId&gt;
+			&lt;version&gt;1.0&lt;/version&gt;
+			&lt;scope&gt;provided&lt;/scope&gt;
+		&lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.zkoss.common&lt;/groupId&gt;
+			&lt;artifactId&gt;zcommon&lt;/artifactId&gt;
+			&lt;version&gt;${zk.version}&lt;/version&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;directory&gt;${project.basedir}/debug&lt;/directory&gt;
+		&lt;outputDirectory&gt;${project.basedir}/debug/classes&lt;/outputDirectory&gt;
+		&lt;finalName&gt;${project.artifactId}-${zk.version}&lt;/finalName&gt;
+		&lt;testOutputDirectory&gt;${project.build.directory}/test-classes&lt;/testOutputDirectory&gt;
+		&lt;sourceDirectory&gt;${project.basedir}/src/&lt;/sourceDirectory&gt;
+		&lt;resources&gt;
+			&lt;resource&gt;
+				&lt;directory&gt;${project.basedir}/src/archive&lt;/directory&gt;
+			&lt;/resource&gt;
+		&lt;/resources&gt;
+		&lt;plugins&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+				&lt;version&gt;2.3.2&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;source&gt;1.4&lt;/source&gt;
+					&lt;target&gt;1.4&lt;/target&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 &lt;/project&gt; 

Added: branches/5.0/zweb/src/org/zkoss/web/mesg/MWeb.java
===================================================================
--- branches/5.0/zweb/src/org/zkoss/web/mesg/MWeb.java	                        (rev 0)
+++ branches/5.0/zweb/src/org/zkoss/web/mesg/MWeb.java	2010-09-18 05:37:48 UTC (rev 14279)
@@ -0,0 +1,28 @@
+// org.zkoss.web.mesg.MWeb.java
+//
+// Generated by genprop
+// DO NOT MODIFY IT MANUALLY. All modifications will be lost.
+//
+// jumperchen, Fri Sep 17 16:11:45 TST 2010
+// Copyright(C) 2001-2008 Potix Corporation. All Rights Reserved.
+
+package org.zkoss.web.mesg;
+
+public interface MWeb extends org.zkoss.mesg.MessageConst {
+	static final int MESSAGE_ID = Aide.register(MWeb.class, "msgweb");
+	static final int DSP_ACTION_NOT_TERMINATED = 0x5000 + MESSAGE_ID;
+	static final int DSP_ACTION_REQUIRED = 0x5001 + MESSAGE_ID;
+	static final int DSP_UNKNOWN_ACTION = 0x5002 + MESSAGE_ID;
+	static final int DSP_COMMENT_NOT_TERMINATED = 0x5003 + MESSAGE_ID;
+	static final int DSP_ATTRIBUTE_VALUE_REQUIRED = 0x5004 + MESSAGE_ID;
+	static final int DSP_ATTRIBUTE_VALUE_QUOTE_REQUIRED = 0x5005 + MESSAGE_ID;
+	static final int DSP_ATTRIBUTE_INVALID_VALUE = 0x5006 + MESSAGE_ID;
+	static final int DSP_ATTRIBUTE_NOT_FOUND = 0x5007 + MESSAGE_ID;
+	static final int DSP_TAGLIB_ATTRIBUTE_REQUIRED = 0x5008 + MESSAGE_ID;
+	static final int DSP_UNEXPECT_CHARACTER = 0x500a + MESSAGE_ID;
+	static final int DSP_EXPECT_CHARACTER = 0x500b + MESSAGE_ID;
+	static final int DSP_NESTED_ACTION_NOT_ALLOWED = 0x5010 + MESSAGE_ID;
+	static final int DSP_ATTRIBUTE_REQUIRED = 0x5011 + MESSAGE_ID;
+	static final int DSP_UNKNOWN_ATTRIBUTE_VALUE = 0x5012 + MESSAGE_ID;
+	static final int EL_NOT_TERMINATED = 0x5010 + MESSAGE_ID;
+}

Modified: trunk/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java
===================================================================
--- trunk/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java	2010-09-17 05:40:36 UTC (rev 14278)
+++ trunk/zk/src/org/zkoss/zk/ui/impl/EventProcessingThreadImpl.java	2010-09-18 05:37:48 UTC (rev 14279)
@@ -324,7 +324,7 @@
 		final Configuration config = desktop.getWebApp().getConfiguration();
 		_evtThdInits = config.newEventThreadInits(comp, event);
 		try {
-			int evtTimeWarn = config.getEventTimeWarning();
+			long evtTimeWarn = config.getEventTimeWarning();
 			long begt = 0;
 			if (evtTimeWarn &gt; 0) {
 				begt = System.currentTimeMillis();


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

</ul>

    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26156371">[zk1-subversion-log] SF.net SVN: zk1:[14275]
 branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/ DefinitionLoaders.java</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-14 05:39</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14275
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14275&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14275&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-14 05:39:14 +0000 (Tue, 14 Sep 2010)

Log Message:
-----------
Tue 09/14/2010

Modified Paths:
--------------
    branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java

Modified: branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java
===================================================================
--- branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java	2010-09-13 05:41:23 UTC (rev 14274)
+++ branches/5.0/zk/src/org/zkoss/zk/ui/metainfo/DefinitionLoaders.java	2010-09-14 05:39:14 UTC (rev 14275)
@@ -659,27 +659,4 @@
 		}
 		return null;
 	}
-
-	private static class Addon {
-		private final Document document;
-		private final int priority;
-		private Addon(Document document) {
-			this.document = document;
-
-			final String p = document.getRootElement().getElementValue("priority", true);
-			this.priority = p != null &amp;&amp; p.length() &gt; 0 ? Integer.parseInt(p): 0;
-		}
-		private static void add(List addons, Document document) {
-			final Addon addon = new Addon(document);
-			for (ListIterator it = addons.listIterator(); it.hasNext();) {
-				final Addon a = (Addon)it.next();
-				if (a.priority &lt; addon.priority) {
-					it.previous();
-					it.add(addon);
-					return; //done
-				}
-			}
-			addons.add(addon);
-		}
-	}
 }


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26140993">[zk1-subversion-log] SF.net SVN: zk1:[14273] branches/6.0</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-11 05:40</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14273
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14273&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14273&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-11 05:40:45 +0000 (Sat, 11 Sep 2010)

Log Message:
-----------
Sat 09/11/2010

Modified Paths:
--------------
    branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
    branches/6.0/zcommon/src/org/zkoss/util/resource/XMLResourcesLocator.java
    branches/6.0/zweb/src/org/zkoss/web/portlet/PortletModes.java
    branches/6.0/zweb/src/org/zkoss/web/portlet/RenderHttpServletRequest.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/Servlets.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/AbstractAction.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/ActionContext.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/html/Box.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/ActionNode.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/InterpretResolver.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/Node.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/Parser.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/http/Https.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestContexts.java
    branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestXelResolver.java
    branches/6.0/zweb/src/org/zkoss/web/util/resource/ClassWebResource.java

Modified: branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zcommon/src/org/zkoss/util/CollectionsX.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -39,18 +39,18 @@
 public class CollectionsX {
 	/** An enumeration on top of a collection or iterator.
 	 */
-	public static final class CollectionEnumeration implements Enumeration {
-		private final Iterator _iter;
-		public CollectionEnumeration(Collection c) {
+	public static final class CollectionEnumeration&lt;E&gt; implements Enumeration&lt;E&gt; {
+		private final Iterator&lt;? extends E&gt; _iter;
+		public CollectionEnumeration(Collection&lt;? extends E&gt; c) {
 			this(c != null ? c.iterator(): null);
 		}
-		public CollectionEnumeration(Iterator iter) {
+		public CollectionEnumeration(Iterator&lt;? extends E&gt; iter) {
 			_iter = iter;
 		}
 		public final boolean hasMoreElements() {
 			return _iter != null &amp;&amp; _iter.hasNext();
 		}
-		public final Object nextElement() {
+		public final E nextElement() {
 			if (_iter != null)
 				return _iter.next();
 			throw new NoSuchElementException();
@@ -58,7 +58,7 @@
 	}
 	/** An enumeration on top of an array.
 	 */
-	public static final class ArrayEnumeration implements Enumeration {
+	public static final class ArrayEnumeration&lt;E&gt; implements Enumeration&lt;E&gt; {
 		private final Object[] _ary;
 		private int _cursor = 0;
 		public ArrayEnumeration(Object[] ary) {
@@ -67,24 +67,25 @@
 		public final boolean hasMoreElements() {
 			return _ary != null &amp;&amp; _cursor &lt; _ary.length;
 		}
-		public final Object nextElement() {
+		@SuppressWarnings("unchecked")
+		public final E nextElement() {
 			if (hasMoreElements())
-				return _ary[_cursor++];
+				return (E)_ary[_cursor++];
 			throw new NoSuchElementException();
 		}
 	}
 	/** An enumeration that enumerates one element.
 	 */
-	public static final class OneEnumeration implements Enumeration {
+	public static final class OneEnumeration&lt;E&gt; implements Enumeration&lt;E&gt; {
 		private boolean _nomore;
-		private final Object _one;
-		public OneEnumeration(Object one) {
+		private final E _one;
+		public OneEnumeration(E one) {
 			_one = one;
 		}
 		public final boolean hasMoreElements() {
 			return !_nomore;
 		}
-		public final Object nextElement() {
+		public final E nextElement() {
 			if (_nomore)
 				throw new NoSuchElementException();
 			_nomore = true;
@@ -93,7 +94,7 @@
 	}
 	/** An readonly collection on top of an array.
 	 */
-	public static final class ArrayCollection extends AbstractCollection {
+	public static final class ArrayCollection&lt;E&gt; extends AbstractCollection&lt;E&gt; {
 		private final Object[] _ary;
 		public ArrayCollection(Object[] ary) {
 			_ary = ary;
@@ -101,13 +102,13 @@
 		public final int size() {
 			return _ary != null ? _ary.length: 0;
 		}
-		public Iterator iterator() {
-			return new ArrayIterator(_ary);
+		public Iterator&lt;E&gt; iterator() {
+			return new ArrayIterator&lt;E&gt;(_ary);
 		}
 	}
 	/** An readonly list on top of an array.
 	 */
-	public static final class ArrayList extends AbstractList {
+	public static final class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; {
 		private final Object[] _ary;
 		public ArrayList(Object[] ary) {
 			_ary = ary;
@@ -115,13 +116,14 @@
 		public final int size() {
 			return _ary != null ? _ary.length: 0;
 		}
-		public final Object get(int index) {
-			return _ary[index];
+		@SuppressWarnings("unchecked")
+		public final E get(int index) {
+			return (E)_ary[index];
 		}
 	}
 	/** An iterator on top of an array.
 	 */
-	public static class ArrayIterator implements Iterator {
+	public static class ArrayIterator&lt;E&gt; implements Iterator&lt;E&gt; {
 		/*package*/ final Object[] _ary;
 		/*package*/ int _cursor = 0, _last = -1;
 		/** @param ary an array or null. */
@@ -131,23 +133,24 @@
 		public final boolean hasNext() {
 			return _ary != null &amp;&amp; _cursor &lt; _ary.length;
 		}
-		public final Object next() {
+		@SuppressWarnings("unchecked")
+		public final E next() {
 			if (hasNext())
-				return _ary[_last = _cursor++];
+				return (E)_ary[_last = _cursor++];
 			throw new NoSuchElementException("cursor="+_cursor);
 		}
 		public final void remove() {
 			throw new UnsupportedOperationException();
 		}
 	}
-	public static class ArrayListIterator extends ArrayIterator
-	implements ListIterator {
+	public static class ArrayListIterator&lt;E&gt; extends ArrayIterator&lt;E&gt;
+	implements ListIterator&lt;E&gt; {
 		/** @param ary an array or null. */
 		public ArrayListIterator(Object[] ary) {
 			super(ary);
 		}
 		/** @param ary an array or null. */
-		public ArrayListIterator(Object[] ary, int index) {
+		public ArrayListIterator(E[] ary, int index) {
 			super(ary);
 			_cursor = index;
 			final int len = _ary != null ? _ary.length: 0;
@@ -157,9 +160,10 @@
 		public final boolean hasPrevious() {
 			return _ary != null &amp;&amp; _cursor &gt; 0;
 		}
-		public final Object previous() {
+		@SuppressWarnings("unchecked")
+		public final E previous() {
 			if (hasPrevious())
-				return _ary[_last = --_cursor];
+				return (E)_ary[_last = --_cursor];
 			throw new NoSuchElementException("cursor="+_cursor);
 		}
 		public final int nextIndex() {
@@ -168,41 +172,41 @@
 		public final int previousIndex() {
 			return _cursor - 1;
 		}
-		public final void set(Object o) {
+		public final void set(E o) {
 			if (_last &lt; 0)
 				throw new IllegalStateException("neither next nor previous have been called");
 			_ary[_last] = o;
 		}
-		public final void add(Object o) {
+		public final void add(E o) {
 			throw new UnsupportedOperationException();
 		}
 	}
 	/** A collection that contains only one element.
 	 */
-	public static final class OneCollection extends AbstractCollection {
-		private final Object _one;
-		public OneCollection(Object one) {
+	public static final class OneCollection&lt;E&gt; extends AbstractCollection&lt;E&gt; {
+		private final E _one;
+		public OneCollection(E one) {
 			_one = one;
 		}
 		public final int size() {
 			return 1;
 		}
-		public Iterator iterator() {
-			return new OneIterator(_one);
+		public Iterator&lt;E&gt; iterator() {
+			return new OneIterator&lt;E&gt;(_one);
 		}
 	}
 	/** An iterator that iterates one element.
 	 */
-	public static final class OneIterator implements Iterator {
+	public static final class OneIterator&lt;E&gt; implements Iterator&lt;E&gt; {
 		private boolean _nomore;
-		private final Object _one;
-		public OneIterator(Object one) {
+		private final E _one;
+		public OneIterator(E one) {
 			_one = one;
 		}
 		public final boolean hasNext() {
 			return !_nomore;
 		}
-		public final Object next() {
+		public final E next() {
 			if (_nomore)
 				throw new NoSuchElementException();
 			_nomore = true;
@@ -214,18 +218,18 @@
 	}
 	/** An iterator that iterates thru an Enumeration.
 	 */
-	public static final class EnumerationIterator implements Iterator {
-		private final Enumeration _enm;
+	public static final class EnumerationIterator&lt;E&gt; implements Iterator&lt;E&gt; {
+		private final Enumeration&lt;? extends E&gt; _enm;
 		/**
 		 * @param enm the enumeration. If null, it means empty.
 		 */
-		public EnumerationIterator(Enumeration enm) {
+		public EnumerationIterator(Enumeration&lt;? extends E&gt; enm) {
 			_enm = enm;
 		}
 		public final boolean hasNext() {
 			return _enm != null &amp;&amp; _enm.hasMoreElements();
 		}
-		public final Object next() {
+		public final E next() {
 			if (_enm == null)
 				throw new NoSuchElementException();
 			return _enm.nextElement();
@@ -297,7 +301,7 @@
 	 * @param iter the iterator; null is OK
 	 * @return the number element being added
 	 */
-	public static final &lt;T&gt; int addAll(Collection&lt;T&gt; col, Iterator&lt;T&gt; iter) {
+	public static final &lt;T&gt; int addAll(Collection&lt;T&gt; col, Iterator&lt;? extends T&gt; iter) {
 		int cnt = 0;
 		if (iter != null)
 			for (; iter.hasNext(); ++cnt)
@@ -308,7 +312,7 @@
 	 * @param enm the enumeration; null is OK
 	 * @return the number element being added
 	 */
-	public static final &lt;T&gt; int addAll(Collection&lt;T&gt; col, Enumeration&lt;T&gt; enm) {
+	public static final &lt;T&gt; int addAll(Collection&lt;T&gt; col, Enumeration&lt;? extends T&gt; enm) {
 		int cnt = 0;
 		if (enm != null)
 			for (; enm.hasMoreElements(); ++cnt)
@@ -319,17 +323,18 @@
 	 * @param ary the array; null is OK
 	 * @return the number element being added
 	 */
-	public static final &lt;T&gt; int addAll(Collection&lt;T&gt; col, T[] ary) {
+	@SuppressWarnings("unchecked")
+	public static final &lt;T&gt; int addAll(Collection&lt;T&gt; col, Object[] ary) {
 		int cnt = 0;
 		if (ary != null)
 			for (; cnt &lt; ary.length; ++cnt)
-				col.add(ary[cnt]);
+				col.add((T)ary[cnt]);
 		return cnt;
 	}
 
 	/** Tests whether two sets has any intersection.
 	 */
-	public static final boolean isIntersected(Set a, Set b) {
+	public static final boolean isIntersected(Set&lt;?&gt; a, Set&lt;?&gt; b) {
 		final int sza = a != null ? a.size(): 0;
 		final int szb = b != null ? b.size(): 0;
 		if (sza == 0 || szb == 0)
@@ -433,6 +438,7 @@
 	 * Collection type of object can be Collection, Map (return the entry), or
 	 * Array.
 	 */
+	@SuppressWarnings("unchecked")
 	public static final Iterator iterator(Object obj) {
 		if (obj instanceof Object[]) {
 			return new ArrayIterator((Object[])obj);

Modified: branches/6.0/zcommon/src/org/zkoss/util/resource/XMLResourcesLocator.java
===================================================================
--- branches/6.0/zcommon/src/org/zkoss/util/resource/XMLResourcesLocator.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zcommon/src/org/zkoss/util/resource/XMLResourcesLocator.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -32,7 +32,7 @@
 	 *
 	 * @param name the resouce name, such as "metainfo/config.xml".
 	 */
-	public Enumeration getResources(String name) throws IOException;
+	public Enumeration&lt;URL&gt; getResources(String name) throws IOException;
 	/** Returns a list of resources ({@link Resource}) after resolving
 	 * the dependence.
 	 * The resource is returned in the format of {@link Resource}
@@ -49,7 +49,7 @@
 	 * @param elDepends the element used to specify the dependence.
 	 * @return a list of {@link Resource} of the specified name.
 	 */
-	public List getDependentXMLResources(String name, String elName,
+	public List&lt;Resource&gt; getDependentXMLResources(String name, String elName,
 	String elDepends) throws IOException;
 
 	/** An item of the list returned by {@link XMLResourcesLocator#getDependentXMLResources}.

Modified: branches/6.0/zweb/src/org/zkoss/web/portlet/PortletModes.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/portlet/PortletModes.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/portlet/PortletModes.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -29,14 +29,22 @@
 public class PortletModes {
 	/** Returns the portlet mode of the specified name.
 	 */
-	synchronized
+	
 	public static final PortletMode toPortletMode(String modeName) {
-		PortletMode mode = (PortletMode)_modes.get(modeName);
-		if (mode == null)
-			_modes.put(modeName, mode = new PortletMode(modeName));
+		PortletMode mode = _modes.get(modeName);
+		if (mode == null) {
+			synchronized (_modes) {
+				mode = _modes.get(modeName);
+				if (mode == null) {
+					Map&lt;String, PortletMode&gt; modes = new HashMap&lt;String, PortletMode&gt;(_modes);
+					modes.put(modeName, mode = new PortletMode(modeName));
+					_modes = modes;
+				}
+			}
+		}
 		return mode;
 	}
-	private static final Map _modes = new HashMap(5);
+	private static Map&lt;String, PortletMode&gt; _modes = new HashMap&lt;String, PortletMode&gt;(4);
 	static {
 		_modes.put("EDIT", PortletMode.EDIT);
 		_modes.put("HELP", PortletMode.HELP);

Modified: branches/6.0/zweb/src/org/zkoss/web/portlet/RenderHttpServletRequest.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/portlet/RenderHttpServletRequest.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/portlet/RenderHttpServletRequest.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -37,7 +37,7 @@
 public class RenderHttpServletRequest implements HttpServletRequest {
 	private final RenderRequest _req;
 	private String _enc = "UTF-8";
-	private final Map _attrs = new HashMap(9);
+	private final Map&lt;String, String&gt; _attrs = new HashMap&lt;String, String&gt;(8);
 
 	public static HttpServletRequest getInstance(RenderRequest req) {
 		if (req instanceof HttpServletRequest)
@@ -60,7 +60,7 @@
 
 	//-- ServletRequest --//
 	public Object getAttribute(String name) {
-		final String val = (String)_attrs.get(name);
+		final String val = _attrs.get(name);
 		return val != null ? val: _req.getAttribute(name);
 	}
 	public Enumeration getAttributeNames() {
@@ -192,7 +192,7 @@
 		return _req.getAuthType();
 	}
 	public String getContextPath() {
-		return (String)_attrs.get(Attributes.INCLUDE_CONTEXT_PATH);
+		return _attrs.get(Attributes.INCLUDE_CONTEXT_PATH);
 	}
 	public javax.servlet.http.Cookie[] getCookies() {
 		return new javax.servlet.http.Cookie[0];
@@ -216,13 +216,13 @@
 		return "GET";
 	}
 	public String getPathInfo() {
-		return (String)_attrs.get(Attributes.INCLUDE_PATH_INFO);
+		return _attrs.get(Attributes.INCLUDE_PATH_INFO);
 	}
 	public String getPathTranslated() {
 		return null;
 	}
 	public String getQueryString() {
-		return (String)_attrs.get(Attributes.INCLUDE_QUERY_STRING);
+		return _attrs.get(Attributes.INCLUDE_QUERY_STRING);
 	}
 	public String getRemoteUser() {
 		return _req.getRemoteUser();
@@ -231,13 +231,13 @@
 		return _req.getRequestedSessionId();
 	}
 	public String getRequestURI() {
-		return (String)_attrs.get(Attributes.INCLUDE_REQUEST_URI);
+		return _attrs.get(Attributes.INCLUDE_REQUEST_URI);
 	}
 	public StringBuffer getRequestURL() {
 		return new StringBuffer();
 	}
 	public String getServletPath() {
-		return (String)_attrs.get(Attributes.INCLUDE_SERVLET_PATH);
+		return _attrs.get(Attributes.INCLUDE_SERVLET_PATH);
 	}
 	public HttpSession getSession() {
 		return PortletHttpSession.getInstance(_req.getPortletSession());

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/Servlets.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/Servlets.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/Servlets.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -150,6 +150,7 @@
 	 * never null
 	 * @see Locales#getCurrent
 	 */
+	@SuppressWarnings("unchecked")
 	public static final String locate(ServletContext ctx,
 	ServletRequest request, String pgpath, Locator locator)
 	throws ServletException {
@@ -204,17 +205,17 @@
 
 
 		final String PGPATH_CACHE = "org.zkoss.web.pgpath.cache";
-		Map map = (Map)ctx.getAttribute(PGPATH_CACHE);
+		Map&lt;URIIndex, String&gt; map = (Map&lt;URIIndex, String&gt;)ctx.getAttribute(PGPATH_CACHE);
 		if (map == null) {
 			map = Collections.synchronizedMap( //10 min
-				new CacheMap(500, 10*60*1000));
+				new CacheMap&lt;URIIndex, String&gt;(500, 10*60*1000));
 			ctx.setAttribute(PGPATH_CACHE, map);
 		}
 
 		final Locale locale = Locales.getCurrent();
 		final URIIndex index = new URIIndex(pgpath, locale);
 
-		String uri = (String)map.get(index);
+		String uri = map.get(index);
 		if (uri == null) {
 			final Locators.URLLocation loc =
 				Locators.locate(pgpath, locale,
@@ -622,7 +623,7 @@
 	 */
 	public static final
 	void forward(ServletContext ctx, ServletRequest request,
-	ServletResponse response, String uri, Map params, int mode)
+	ServletResponse response, String uri, Map&lt;?,?&gt; params, int mode)
 	throws IOException, ServletException {
 //		if (D.ON &amp;&amp; log.debugable()) log.debug("Forwarding "+uri);
 
@@ -694,7 +695,7 @@
 	 */
 	public static final
 	void include(ServletContext ctx, ServletRequest request,
-	ServletResponse response, String uri, Map params, int mode)
+	ServletResponse response, String uri, Map&lt;?,?&gt; params, int mode)
 	throws IOException, ServletException {
 //		if (D.ON &amp;&amp; log.debugable()) log.debug("Including "+uri+" at "+ctx);
 
@@ -736,15 +737,15 @@
 	/** Sets the arg attribute to pass parameters thru request's attribute.
 	 */
 	private static final
-	Map setPassThruAttr(ServletRequest request, Map params) {
-		final Map old = (Map)request.getAttribute(Attributes.ARG);
+	Map&lt;?,?&gt; setPassThruAttr(ServletRequest request, Map&lt;?,?&gt; params) {
+		final Map&lt;?,?&gt; old = (Map&lt;?,?&gt;)request.getAttribute(Attributes.ARG);
 		request.setAttribute(Attributes.ARG, params);
 		return old;
 	}
 	/** Restores what has been done by {@link #setPassThruAttr}.
 	 */
 	private static final
-	void restorePassThruAttr(ServletRequest request, Map old) {
+	void restorePassThruAttr(ServletRequest request, Map&lt;?,?&gt; old) {
 		if (old != null)
 			request.setAttribute(Attributes.ARG, old);
 		else
@@ -767,7 +768,7 @@
 	 */
 	public static final RequestDispatcher
 	getRequestDispatcher(ServletContext ctx, ServletRequest request,
-	String uri, Map params, int mode)
+	String uri, Map&lt;?,?&gt; params, int mode)
 	throws ServletException {
 		final char cc = uri.length() &gt; 0 ? uri.charAt(0): (char)0;
 		if (ctx == null || (cc != '/' &amp;&amp; cc != '~')) {//... or relevant
@@ -830,7 +831,7 @@
 				_uri = uri;
 			}
 		}
-		private RequestDispatcher getRequestDispatcher(Map params, int mode) {
+		private RequestDispatcher getRequestDispatcher(Map&lt;?,?&gt; params, int mode) {
 			if (_extctx == null &amp;&amp; _svlctx == null) //not found
 				return null;
 
@@ -879,7 +880,7 @@
 	 * not empty.
 	 * @see Encodes#encodeURL(ServletContext, ServletRequest, ServletResponse, String)
 	 */
-	public static final String generateURI(String uri, Map params, int mode) {
+	public static final String generateURI(String uri, Map&lt;?,?&gt; params, int mode) {
 		if (uri.startsWith("~"))
 			throw new IllegalArgumentException("~ctx not supported here: "+uri);
 
@@ -932,27 +933,29 @@
 	}
 
 	/** A list of context root paths (e.g., "/abc"). */
-	private static List _ctxroots;
+	private static List&lt;String&gt; _ctxroots;
 	/** Returns a list of context paths (e.g., "/abc") that this application
 	 * has. This implementation parse application.xml. For war that doesn't
 	 * contain application.xml might have to override this method and
 	 * parse another file to know what context being loaded.
 	 */
-	public static final List getContextPaths() {
+	public static final List&lt;String&gt; getContextPaths() {
 		if (_ctxroots != null)
 			return _ctxroots;
 
 		try {
 			synchronized (Servlets.class) {
-				return _ctxroots = myGetContextPaths();
+				if (_ctxroots == null)
+					_ctxroots = myGetContextPaths();
 			}
+			return _ctxroots;
 		} catch (Exception ex) {
 			throw SystemException.Aide.wrap(ex);
 		}
 	}
-	private static final List myGetContextPaths() throws Exception {
+	private static final List&lt;String&gt; myGetContextPaths() throws Exception {
 		final String APP_XML = "/META-INF/application.xml";
-		final List ctxroots = new LinkedList();
+		final List&lt;String&gt; ctxroots = new LinkedList&lt;String&gt;();
 		final URL xmlURL = Locators.getDefault().getResource(APP_XML);
 		if (xmlURL == null)
 			throw new SystemException("File not found: "+APP_XML);
@@ -961,9 +964,7 @@
 		final Element root =
 			new SAXBuilder(false,false,true).build(xmlURL).getRootElement();
 
-		for (Iterator it = root.getElements("module").iterator();
-		it.hasNext();) {
-			final Element e = (Element)it.next();
+		for (Element e: root.getElements("module")) {
 			final String ctxroot = (String)e.getContent("web/context-root");
 			if (ctxroot == null) {
 //				if (D.ON &amp;&amp; log.finerable()) log.finer("Skip non-web: "+e.getContent("java"));
@@ -974,7 +975,7 @@
 		}
 
 //		log.info("Context found: "+ctxroots);
-		return new ArrayList(ctxroots);
+		return new ArrayList&lt;String&gt;(ctxroots);
 	}
 
 	/** Returns a token to represent a limit-time offer.
@@ -1015,28 +1016,29 @@
 	String name, ExtendletContext extctx) {
 		if (name == null || extctx == null)
 			throw new IllegalArgumentException("null");
-		return (ExtendletContext)getExtWebCtxs(ctx).put(name, extctx);
+		return getExtWebCtxs(ctx).put(name, extctx);
 	}
 	/** Removes an extended context of the specified name.
 	 */
 	public static final
 	ExtendletContext removeExtendletContext(ServletContext ctx, String name) {
-		return (ExtendletContext)getExtWebCtxs(ctx).remove(name);
+		return getExtWebCtxs(ctx).remove(name);
 	}
 	/** Returns the extended context of the specified name.
 	 */
 	public static final
 	ExtendletContext getExtendletContext(ServletContext ctx, String name) {
-		return (ExtendletContext)getExtWebCtxs(ctx).get(name);
+		return getExtWebCtxs(ctx).get(name);
 	}
-	private static final Map getExtWebCtxs(ServletContext ctx) {
+	@SuppressWarnings("unchecked")
+	private static final Map&lt;String, ExtendletContext&gt; getExtWebCtxs(ServletContext ctx) {
 		final String attr = "javax.zkoss.web.servlets.ExtendletContexts";
 			//such that it could be shared among portlets
 		synchronized (Servlets.class) { //don't use ctx because it might be a proxy (in portlet)
-			Map ctxs = (Map)ctx.getAttribute(attr);
+			Map&lt;String, ExtendletContext&gt; ctxs = (Map&lt;String, ExtendletContext&gt;)ctx.getAttribute(attr);
 			if (ctxs == null)
 				ctx.setAttribute(attr,
-					ctxs = Collections.synchronizedMap(new HashMap(5)));
+					ctxs = Collections.synchronizedMap(new HashMap&lt;String, ExtendletContext&gt;(4)));
 			return ctxs;
 		}
 	}

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/AbstractAction.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/AbstractAction.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/AbstractAction.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -31,11 +31,6 @@
  * @author tomyeh
  */
 abstract public class AbstractAction implements Action {
-	/** A special integer to denote no attribute is assigned. */
-	protected static final int NULL_INT = Integer.MIN_VALUE + 0x68;
-	/** A special short to denote no attribute is assigned. */
-	protected static final short NULL_SHORT = Short.MIN_VALUE + 0x68;
-
 	private boolean _if = true;
 	private boolean _unless = false;
 
@@ -93,36 +88,6 @@
 			"application".equals(scope) ? ActionContext.APPLICATION_SCOPE:
 				ActionContext.PAGE_SCOPE;
 	}
-	/** Puts an attribute to the map,
-	 * if &lt;code&gt;attrValue&lt;/code&gt; is not null.
-	 */
-	protected static final
-	void put(Map params, String attrName, String attrValue) {
-		if (attrValue != null)
-			params.put(attrName, attrValue);
-	}
-	/** Puts an attribute to the map.
-	 * Unlike othere put(...), it always puts the specified attribute.
-	 */
-	protected static final
-	void put(Map params, String attrName, boolean avail) {
-		params.put(attrName, Boolean.valueOf(avail));
-	}
-	/** Puts an attribute to the map,
-	 * if &lt;code&gt;val&lt;/code&gt; is not NULL_INT.
-	 */
-	protected static final
-	void put(Map params, String attrName, int val) {
-		if (val != NULL_INT)
-			params.put(attrName, new Integer(val));
-	}
-	/** Puts an object if it is not null.
-	 */
-	protected static final
-	void put(Map params, String attrName, Object attrValue) {
-		if (attrValue != null)
-			params.put(attrName, attrValue);
-	}
 
 	/** Appends an attribute to the string buffer,
 	 * if &lt;code&gt;attrValue&lt;/code&gt; is not null.
@@ -142,14 +107,12 @@
 		if (avail)
 			sb.append(' ').append(attrName);
 	}
-	/** Appends an attribute to the string buffer,
-	 * if &lt;code&gt;val&lt;/code&gt; is not NULL_INT.
+	/** Appends an attribute to the string buffer.
 	 */
 	protected static final
 	void append(StringBuffer sb, String attrName, int val) {
-		if (val != NULL_INT)
-			sb.append(' ').append(attrName).append("=\"")
-				.append(Integer.toString(val)).append('"');
+		sb.append(' ').append(attrName).append("=\"")
+			.append(Integer.toString(val)).append('"');
 	}
 
 	//package-level utilities//

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/ActionContext.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/ActionContext.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/ActionContext.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -84,7 +84,7 @@
 	 * @param params a map of parameters, or null to ignore.
 	 * The map is passed thru the request attribute called arg.
 	 */
-	public void include(String uri, Map params)
+	public void include(String uri, Map&lt;?,?&gt; params)
 	throws DspException, IOException;
 
 	/** Returns whether this page is included.

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/html/Box.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/html/Box.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/action/html/Box.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -117,14 +117,20 @@
 		if (!isEffective())
 			return;
 
-		final Map attrs = new HashMap();
-		put(attrs, "align", _align);
-		put(attrs, "color", _color);
-		put(attrs, "shadow", _shadow);
-		put(attrs, "spacing", _spacing);
-		put(attrs, "caption", _caption);
-		put(attrs, "width", _width);
-		put(attrs, "actionContext", ac);
+		final Map&lt;String, Object&gt; attrs = new HashMap&lt;String, Object&gt;();
+		attrs.put("shadow", _shadow);
+		if (_align != null)
+			attrs.put("align", _align);
+		if (_color != null)
+			attrs.put("color", _color);
+		if (_spacing != null)
+			attrs.put("spacing", _spacing);
+		if (_caption != null)
+			attrs.put("caption", _caption);
+		if (_width != null)
+			attrs.put("width", _width);
+		if (ac != null)
+			attrs.put("actionContext", ac);
 
 		ac.include("~./dsp/action/html/box.dsp", attrs);
 	}

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/ActionNode.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/ActionNode.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/ActionNode.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -41,14 +41,14 @@
 class ActionNode extends Node {
 	private static final Log log = Log.lookup(ActionNode.class);
 
-	private final Class _cls;
-	private List _attrs;
+	private final Class&lt;?&gt; _cls;
+	private List&lt;Attr&gt; _attrs;
 	private final int _nLines;
 
 	/**
 	 * @param nLines which line this action is located.
 	 */
-	ActionNode(Class cls, int nLines) {
+	ActionNode(Class&lt;?&gt; cls, int nLines) {
 		_cls = cls;
 		_nLines = nLines;
 	}
@@ -59,10 +59,9 @@
 		try {
 			ic.action = newAction();
 			//1. apply attributes
-			if (_attrs != null) {
-				for (Iterator it = _attrs.iterator(); it.hasNext();)
-					((Attr)it.next()).apply(ic, ic.action);
-			}
+			if (_attrs != null)
+				for (Attr attr: _attrs)
+					attr.apply(ic, ic.action);
 
 			//2. render
 			ic.action.render(
@@ -102,7 +101,7 @@
 		if (nm == null || val == null)
 			throw new IllegalArgumentException("null");
 		if (_attrs == null)
-			_attrs = new LinkedList();
+			_attrs = new LinkedList&lt;Attr&gt;();
 
 		final Method mtd = (Method)Classes.getAccessibleObject(
 			_cls, nm, new Class[] {null},

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/InterpretResolver.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/InterpretResolver.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/InterpretResolver.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -34,15 +34,17 @@
  */
 class InterpretResolver implements VariableResolver {
 	private final VariableResolver _parent;
-	private final Map _attrs = new HashMap();
+	private final Map&lt;String, Object&gt; _attrs = new HashMap&lt;String, Object&gt;();
 
 	InterpretResolver(VariableResolver parent) {
 		assert D.OFF || !(parent instanceof InterpretResolver);
 		_parent = parent;
 	}
 
-	/** Returns the attributes of the given scope. */
-	Map getAttributes(int scope) throws XelException {
+	/** Returns the attributes of the given scope.
+	 */
+	@SuppressWarnings("unchecked")
+	Map&lt;String, Object&gt; getAttributes(int scope) throws XelException {
 		if (scope == ActionContext.PAGE_SCOPE)
 			return _attrs;
 

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/Node.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/Node.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/Node.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -30,7 +30,7 @@
  * @author tomyeh
  */
 abstract class Node {
-	protected List _children;
+	protected List&lt;Node&gt; _children;
 
 	/** Interprets the node to generate the result to the output
 	 * specified in the interpret context.
@@ -43,7 +43,7 @@
 		if (node == null)
 			throw new IllegalArgumentException("null");
 		if (_children == null)
-			_children = new LinkedList();
+			_children = new LinkedList&lt;Node&gt;();
 		_children.add(node);
 	}
 	/** Adds a child to the specified position. */
@@ -51,14 +51,15 @@
 		if (node == null)
 			throw new IllegalArgumentException("null");
 		if (_children == null)
-			_children = new LinkedList();
+			_children = new LinkedList&lt;Node&gt;();
 		_children.add(pos, node);
 	}
 
 	/** Returns the list of child nodes ({@link Node}).
 	 * @since 3.0.0
 	 */
-	public List getChildren() {
+	@SuppressWarnings("unchecked")
+	public List&lt;Node&gt; getChildren() {
 		return _children != null ? _children: Collections.EMPTY_LIST;
 	}
 }

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/Parser.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/Parser.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/dsp/impl/Parser.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -73,7 +73,7 @@
 			//We always create a page definition
 			final ActionNode action = new ActionNode(Page.class, 0);
 			root.addChild(0, action);
-			final Map attrs = new HashMap(2);
+			final Map&lt;String, String&gt; attrs = new HashMap&lt;String, String&gt;(2);
 
 			if (ctype == null) ctype = "text/html";
 			else if (ctype.startsWith(";")) ctype = "text/html" + ctype;
@@ -194,7 +194,7 @@
 		}
 
 		//2: parse attributes
-		final Map attrs = new HashMap();
+		final Map&lt;String, String&gt; attrs = new HashMap&lt;String, String&gt;();
 		k = parseAttrs(ctx, attrs, ctlnm, k, to);
 		cc = ctx.content.charAt(k);
 		if (cc != '%')
@@ -254,7 +254,7 @@
 		parent.addChild(action);
 
 		//2: action's attributes
-		final Map attrs = new HashMap();
+		final Map&lt;String, String&gt; attrs = new HashMap&lt;String, String&gt;();
 		j = parseAttrs(ctx, attrs, actnm, k, to);
 		char cc = ctx.content.charAt(j);
 		boolean ended = cc == '/';
@@ -352,7 +352,7 @@
 	}
 	/** Parses the attributes.
 	 */
-	private static int parseAttrs(Context ctx, Map attrs, String actnm,
+	private static int parseAttrs(Context ctx, Map&lt;String, String&gt; attrs, String actnm,
 	int from, int to)
 	throws DspException {
 		for (int j, k = from;;) {
@@ -401,13 +401,12 @@
 	/** Applies attributes.
 	 */
 	private static final
-	void applyAttrs(String actnm, ActionNode action, Map attrs,
+	void applyAttrs(String actnm, ActionNode action, Map&lt;String, String&gt; attrs,
 	ParseContext ctx)
 	throws DspException, XelException {
-		for (Iterator it = attrs.entrySet().iterator(); it.hasNext();) {
-			final Map.Entry me = (Map.Entry)it.next();
-			final String attrnm = (String)me.getKey();
-			final String attrval = (String)me.getValue();
+		for (Map.Entry&lt;String, String&gt; me: attrs.entrySet()) {
+			final String attrnm = me.getKey();
+			final String attrval = me.getValue();
 			try {
 				action.addAttribute(attrnm, attrval, ctx);
 			} catch (NoSuchMethodException ex) {
@@ -467,12 +466,12 @@
 	private static class Context implements ParseContext {
 		private final String content;
 		/** (String prefix, Map(String name, Class class)). */
-		private final Map _actions = new HashMap();
+		private final Map&lt;String, Map&lt;String, Class&lt;?&gt;&gt;&gt; _actions = new HashMap&lt;String, Map&lt;String, Class&lt;?&gt;&gt;&gt;();
 		private final Locator _locator;
 		private final ExpressionFactory _xelf;
 		private final SimpleMapper _mapper;
 		private final VariableResolver _resolver;
-		private Map _attrs;
+		private Map&lt;String, Object&gt; _attrs;
 		private int nLines;
 		/** Whether the page action is defined. */
 		private boolean pageDefined;
@@ -500,9 +499,9 @@
 		private boolean hasPrefix(String prefix) {
 			return _actions.containsKey(prefix);
 		}
-		private Class getActionClass(String prefix, String actnm) {
-			final Map acts = (Map)_actions.get(prefix);
-			return acts != null ? (Class)acts.get(actnm): null;
+		private Class&lt;?&gt; getActionClass(String prefix, String actnm) {
+			final Map&lt;String, Class&lt;?&gt;&gt; acts = _actions.get(prefix);
+			return acts != null ? acts.get(actnm): null;
 		}
 		private void loadTaglib(String prefix, String uri)
 		throws DspException, IOException {
@@ -530,13 +529,13 @@
 				.build(url).getRootElement();
 			_mapper.load(prefix, root);
 
-			final Map acts = new HashMap();
+			final Map&lt;String, Class&lt;?&gt;&gt; acts = new HashMap&lt;String, Class&lt;?&gt;&gt;();
 			for (Iterator it = root.getElements("tag").iterator();
 			it.hasNext();) {
 				final Element e = (Element)it.next();
 				final String name = IDOMs.getRequiredElementValue(e, "name");
 				final String clsName = IDOMs.getRequiredElementValue(e, "tag-class");
-				final Class cls = Classes.forNameByThread(clsName);
+				final Class&lt;?&gt; cls = Classes.forNameByThread(clsName);
 				if (!Action.class.isAssignableFrom(cls))
 					throw new DspException(cls+" doesn't implement "+Action.class);
 				acts.put(name, cls);
@@ -545,8 +544,8 @@
 				_actions.put(prefix, acts);
 		}
 
-		private Map attrs() {
-			return _attrs != null ? _attrs: (_attrs = new HashMap());
+		private Map&lt;String, Object&gt; attrs() {
+			return _attrs != null ? _attrs: (_attrs = new HashMap&lt;String, Object&gt;());
 		}
 		public Object getAttribute(String name) {
 			return _attrs != null ? _attrs.get(name):  null;
@@ -560,7 +559,7 @@
 		public Object removeAttribute(String name) {
 			return _attrs != null ? _attrs.remove(name): null;
 		}
-		public Map getAttributes() {
+		public Map&lt;String, Object&gt; getAttributes() {
 			return attrs();
 		}
 	}

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/http/Https.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/http/Https.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/http/Https.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -390,7 +390,7 @@
 		return getDateFormats()[0].format(date);
 	}
 	private static final SimpleDateFormat[] getDateFormats() {
-		SimpleDateFormat[] dfs = (SimpleDateFormat[])_dfs.get();
+		SimpleDateFormat[] dfs = _dfs.get();
 		if (dfs == null)
 			_dfs.set(dfs = new SimpleDateFormat[] {
 				new SimpleDateFormat("EEE, dd MMM yyyy HH:mm:ss zzz", Locale.US),
@@ -399,7 +399,7 @@
 			});
 		return dfs;
 	}
-	private static final ThreadLocal _dfs = new ThreadLocal();
+	private static final ThreadLocal&lt;SimpleDateFormat[]&gt; _dfs = new ThreadLocal&lt;SimpleDateFormat[]&gt;();
 
 	/** Write the specified media to HTTP response.
 	 *

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestContexts.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestContexts.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestContexts.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -41,14 +41,14 @@
 	protected RequestContexts() {} //prevent from instantiated
 
 	/** A list of RequestContext. */
-	private static final ThreadLocal _elCtxs = new ThreadLocal();
+	private static final ThreadLocal&lt;List&lt;RequestContext&gt;&gt; _elCtxs = new ThreadLocal&lt;List&lt;RequestContext&gt;&gt;();
 
 	/** Returns the current page context if this thread is evaluating a page,
 	 * or null if not.
 	 */
 	public static final RequestContext getCurrent() {
-		final List jcs = (List)_elCtxs.get();
-		return jcs != null &amp;&amp; !jcs.isEmpty() ? (RequestContext)jcs.get(0): null;
+		final List&lt;RequestContext&gt; jcs = _elCtxs.get();
+		return jcs != null &amp;&amp; !jcs.isEmpty() ? jcs.get(0): null;
 	}
 
 	/** Pushes the context as the current context, such that it will
@@ -74,9 +74,9 @@
 		if (jc == null)
 			throw new IllegalArgumentException("null");
 
-		List jcs = (List)_elCtxs.get();
+		List&lt;RequestContext&gt; jcs = _elCtxs.get();
 		if (jcs == null)
-			_elCtxs.set(jcs = new LinkedList());
+			_elCtxs.set(jcs = new LinkedList&lt;RequestContext&gt;());
 		jcs.add(0, jc);
 	}
 	/** Pops the context out and use the previous one as the current context.
@@ -87,7 +87,7 @@
 	 * @see #push
 	 */
 	public static final void pop() {
-		final List l = (List)_elCtxs.get();
+		final List&lt;RequestContext&gt; l = _elCtxs.get();
 		if (l.size() == 1) _elCtxs.set(null);
 		else l.remove(0);
 	}

Modified: branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestXelResolver.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestXelResolver.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/servlet/xel/RequestXelResolver.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -103,6 +103,7 @@
 	}
 
 	//-- VariableResovler --//
+	@SuppressWarnings("unchecked")
 	public Object resolveVariable (String name) throws XelException {
 		if ("pageContext".equals(name)) {
 			return getPageContext();

Modified: branches/6.0/zweb/src/org/zkoss/web/util/resource/ClassWebResource.java
===================================================================
--- branches/6.0/zweb/src/org/zkoss/web/util/resource/ClassWebResource.java	2010-09-10 05:39:26 UTC (rev 14272)
+++ branches/6.0/zweb/src/org/zkoss/web/util/resource/ClassWebResource.java	2010-09-11 05:40:45 UTC (rev 14273)
@@ -83,13 +83,13 @@
 	private final String _mappingURI;
 	private final CWC _cwc;
 	/** An array of extensions that have to be compressed (with gzip). */
-	private Set _compressExts;
+	private Set&lt;String&gt; _compressExts;
 	/** Map(String ext, Extendlet). */
-	private final Map _extlets = new HashMap();
+	private final Map&lt;String, Extendlet&gt; _extlets = new HashMap&lt;String, Extendlet&gt;();
 	/** Filers for requests. Map(String ext, FastReadArray(Filter)). */
-	private final Map _reqfilters = new HashMap(2);
+	private final Map&lt;String, FastReadArray&lt;Filter&gt;&gt; _reqfilters = new HashMap&lt;String, FastReadArray&lt;Filter&gt;&gt;(2);
 	/** Filers for includes. Map(String ext, FastReadArray(Filter)). */
-	private final Map _incfilters = new HashMap(2);
+	private final Map&lt;String, FastReadArray&lt;Filter&gt;&gt; _incfilters = new HashMap&lt;String, FastReadArray&lt;Filter&gt;&gt;(2);
 	/** Additional locator. */
 	private Locator _extraloc;
 	/** The prefix used to encode URL. */
@@ -285,7 +285,7 @@
 		ext = ext.toLowerCase();
 		for (;;) {
 			synchronized (_extlets) {
-				Extendlet exlet = (Extendlet)_extlets.get(ext);
+				Extendlet exlet = _extlets.get(ext);
 				if (exlet != null) return exlet;
 			}
 
@@ -313,7 +313,7 @@
 			public void addCompressExtension(String ext) {
 				synchronized (ClassWebResource.this) {
 					if (_compressExts == null)
-						_compressExts = new LinkedHashSet();
+						_compressExts = new LinkedHashSet&lt;String&gt;();
 					_compressExts.add(ext);
 				}
 			}
@@ -321,7 +321,7 @@
 
 		ext = ext.toLowerCase();
 		synchronized (_extlets) {
-			return (Extendlet)_extlets.put(ext, extlet);
+			return _extlets.put(ext, extlet);
 		}
 	}
 	/** Removes the {@link Extendlet} (aka., resource processor)
@@ -338,7 +338,7 @@
 
 		ext = ext.toLowerCase();
 		synchronized (_extlets) {
-			return (Extendlet)_extlets.remove(ext);
+			return _extlets.remove(ext);
 		}
 	}
 
@@ -361,7 +361,7 @@
 			return null;
 
 		ext = ext.toLowerCase();
-		final Map filters =
+		final Map&lt;String, FastReadArray&lt;Filter&gt;&gt; filters =
 			flag == 0 || (flag &amp; FILTER_REQUEST) != 0 ? _reqfilters: _incfilters;
 		if (filters.isEmpty()) //no need to sync
 			return null; //optimize
@@ -409,12 +409,12 @@
 		if ((flags &amp; FILTER_INCLUDE) != 0)
 			addFilter(_incfilters, ext, filter);
 	}
-	private static void addFilter(Map filters, String ext, Filter filter) {
-		FastReadArray ary;
+	private static void addFilter(Map&lt;String, FastReadArray&lt;Filter&gt;&gt; filters, String ext, Filter filter) {
+		FastReadArray&lt;Filter&gt; ary;
 		synchronized (filters) {
-			ary = (FastReadArray)filters.get(ext);
+			ary = filters.get(ext);
 			if (ary == null)
-				filters.put(ext, ary = new FastReadArray(Filter.class));
+				filters.put(ext, ary = new FastReadArray&lt;Filter&gt;(Filter.class));
 		}
 		ary.add(filter);
 	}
@@ -437,15 +437,15 @@
 			removed = rmFilter(_incfilters, ext, filter) || removed;
 		return removed;
 	}
-	private static boolean rmFilter(Map filters, String ext, Filter filter) {
-		FastReadArray ary;
+	private static boolean rmFilter(Map&lt;String, FastReadArray&lt;Filter&gt;&gt; filters, String ext, Filter filter) {
+		FastReadArray&lt;Filter&gt; ary;
 		synchronized (filters) {
-			ary = (FastReadArray)filters.get(ext);
+			ary = filters.get(ext);
 		}
 		if (ary != null &amp;&amp; ary.remove(filter)) {
 			if (ary.isEmpty())
 				synchronized (filters) {
-					ary = (FastReadArray)filters.remove(ext);
+					ary = filters.remove(ext);
 					if (ary != null &amp;&amp; !ary.isEmpty())
 						filters.put(ext, ary); //modify by other, so restore
 				}
@@ -465,7 +465,7 @@
 	 */
 	public void setCompress(String[] exts) {
 		if (exts != null &amp;&amp; exts.length &gt; 0) {
-			final Set set = new LinkedHashSet();
+			final Set&lt;String&gt; set = new LinkedHashSet&lt;String&gt;();
 			for (int j = exts.length; --j &gt;= 0;)
 				set.add(exts[j]);
 			_compressExts = set;
@@ -481,7 +481,7 @@
 	 */
 	public String[] getCompress() {
 		return _compressExts != null ?
-			(String[])_compressExts.toArray(new String[_compressExts.size()]):
+			_compressExts.toArray(new String[_compressExts.size()]):
 			null;
 	}
 


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=26125731">[zk1-subversion-log] SF.net SVN: zk1:[14271]
	releases/5.0.4/zkdemo/src/archive/test</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;asuka1978@us...&gt; -	2010-09-09 02:46</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 14271
          <a href="http://zk1.svn.sourceforge.net/zk1/?rev=14271&amp;view=rev" target="_new">http://zk1.svn.sourceforge.net/zk1/?rev=14271&amp;view=rev</a>
Author:   asuka1978
Date:     2010-09-09 02:46:23 +0000 (Thu, 09 Sep 2010)

Log Message:
-----------


Modified Paths:
--------------
    branches/5.0/zkdemo/src/archive/test2/config.properties
    branches/5.0/zkdoc/release-note
    branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingComboitemRenderer.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingListitemRenderer.java
    branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingRowRenderer.java
    branches/5.0/zul/src/archive/web/js/zul/menu/Menupopup.js
    branches/5.0/zul/src/archive/web/js/zul/mesh/HeaderWidget.js

Added Paths:
-----------
    addon/trunk/widgets/ckez/src/archive/web/ckez/
    addon/trunk/widgets/ckez/src/archive/web/ckez/html/
    addon/trunk/widgets/ckez/src/archive/web/ckez/html/browse.zul
    addon/trunk/widgets/ckez/src/archive/web/ckez/img/
    addon/trunk/widgets/ckez/src/archive/web/ckez/img/flashIcon.jpg
    branches/5.0/zkdemo/src/archive/test2/B50-3061764.zul
    branches/5.0/zkdemo/src/archive/test2/B50-3061765.zul
    branches/5.0/zkdemo/src/archive/test2/F50-3061671.zul

Removed Paths:
-------------
    addon/trunk/widgets/timeplotz/build.xml
    addon/trunk/widgets/timeplotz/tools/
    branches/5.0/zkdemo/src/archive/index.zul
    branches/5.0/zkdemo/src/archive/test/stats.zul
    branches/5.0/zkdemo/src/archive/test2/F50-3029931.zul
    branches/5.0/zkdoc/CDG5/
    branches/5.0/zkdoc/quickstart/
    branches/5.0/zkdoc/xslt/
    branches/5.5/zkdemo/src/archive/index.zul
    branches/5.5/zkdemo/src/archive/test/stats.zul
    branches/5.5/zkdemo/src/archive/test2/F50-3029931.zul
    branches/5.5/zkdoc/CDG5/
    branches/5.5/zkdoc/quickstart/
    branches/5.5/zkdoc/xslt/
    branches/6.0/zkdemo/src/archive/index.zul
    branches/6.0/zkdemo/src/archive/test/stats.zul
    branches/6.0/zkdemo/src/archive/test2/F50-3029931.zul
    branches/6.0/zkdoc/CDG5/
    branches/6.0/zkdoc/quickstart/
    branches/6.0/zkdoc/xslt/
    releases/5.0.4/zkdemo/src/archive/index.zul
    releases/5.0.4/zkdemo/src/archive/test/stats.zul
    releases/5.0.4/zkdemo/src/archive/test2/F50-3029931.zul

Added: addon/trunk/widgets/ckez/src/archive/web/ckez/html/browse.zul
===================================================================
--- addon/trunk/widgets/ckez/src/archive/web/ckez/html/browse.zul	                        (rev 0)
+++ addon/trunk/widgets/ckez/src/archive/web/ckez/html/browse.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -0,0 +1,192 @@
+&lt;?taglib uri="<a href="http://www.zkoss.org/dsp/web/core" target="_new">http://www.zkoss.org/dsp/web/core</a>" prefix="c" ?&gt;
+&lt;zk&gt;
+	&lt;style&gt;
+		.ckTree span.z-filetree-tee, span.z-filetree-last {
+			background-image: url(${c:encodeURL('~./zul/img/tree/folder-toggle.gif')});
+			background-position:0 -18px;
+		}
+		.ckImg .z-toolbarbutton-cnt img {
+			display:block;
+			max-height:100px;
+			max-width:100px;
+			margin:0 auto;
+		}
+		.ckImg .z-toolbarbutton-cnt {
+			text-align:center;
+		}
+		.ckImg .z-toolbarbutton-over {
+			background-color:#DFF1FF;
+			border-color:#99CCFF;
+		}
+		.ckImg .sel {
+			background-color:#B4D9FF;
+			padding:0;
+			border-bottom: 1px solid #6565FE;
+			border-top: 1px solid #6565FE;
+		}
+		.ckImg .sel .z-toolbarbutton-body{
+			padding:0;
+			border-left: 1px solid #6565FE;
+			border-right: 1px solid #6565FE;
+		}
+	&lt;/style&gt;
+	&lt;zscript&gt;&lt;![CDATA[
+		import java.io.*;
+		import java.util.*;
+		import org.zkoss.zk.ui.Component;
+		import org.zkoss.zk.ui.Executions;
+		import org.zkoss.zk.ui.util.GenericForwardComposer;
+		import org.zkoss.zul.*;
+		import org.zkoss.zk.ui.event.EventListener;
+		
+		public class Composer extends GenericForwardComposer {
+			
+			private String pagePath = "";
+			private String[] excludeFolders = {"WEB-INF","META-INF"};
+			private String[] excludeFiles = {};
+			private String[] includeImageFileExtensions = {"gif","jpeg","bmp","png","tif"};
+			private Map escapeMap = new HashMap();
+			private Map rootFolderMap = new TreeMap();
+			private int CKEditorFuncNum = 1;
+			private String apName = "";
+			private boolean isShowAllFiles = false;
+			
+			
+			private Tree tree;
+			private Div cntDiv;
+			private Toolbarbutton selBtn;
+			
+			public void doAfterCompose(Component comp) throws Exception {
+				super.doAfterCompose(comp);
+				tree = (Tree)comp.getFellow("tree");
+				cntDiv = (Div)comp.getFellow("cntDiv");
+				
+				
+				String type = ((String[])param.get("Type"))[0];
+				
+				for (int i = 0, j = excludeFolders.length; i &lt; j; i++)
+					escapeMap.put(excludeFolders[i], "");
+				for (int i = 0, j = excludeFiles.length; i &lt; j; i++)
+					escapeMap.put(excludeFiles[i], "");
+				
+				if (type.equals("Flash"))
+					escapeMap.put("swf", "");
+				else if (type.equals("Images"))
+					for (int i = 0, j = includeImageFileExtensions.length; i &lt; j; i++)
+						escapeMap.put(includeImageFileExtensions[i], "");
+				else isShowAllFiles = true;	
+				
+				
+				
+				String path = ((String[])param.get("filebrowserBrowseUrl"))[0];
+				CKEditorFuncNum = Integer.valueOf(((String[])param.get("CKEditorFuncNum"))[0]);
+				int index = path.indexOf("/", 1);
+				apName = path.substring(0, index);
+				pagePath = path.substring(index);
+				
+				Map map = new TreeMap();
+				rootFolderMap.put(pagePath.substring(pagePath.lastIndexOf("/")),map);
+				
+				if (application.getResourcePaths(pagePath) == null)
+					throw new UiException("Folder not found: "+pagePath);
+				
+				processFolder(pagePath, map);
+				tree.setTreeitemRenderer(new TreeitemRenderer() {
+					public void render(Treeitem item, Object data) throws Exception {
+						Map.Entry entry = (Map.Entry)((SimpleTreeNode)data).getData();
+						item.setLabel(String.valueOf(entry.getKey()));
+						Object value = entry.getValue();
+						item.setValue(value);
+						item.setOpen(true);
+						if (item.getParentItem() == null)
+							item.setSelected(true);
+					}
+				});
+				
+				tree.setModel(new SimpleTreeModel(new SimpleTreeNode("ROOT",initTreeModel(rootFolderMap, new ArrayList()))));
+				
+				showImages(map);
+			}
+		
+			
+			private List initTreeModel(Map parentFolderMap, List list) {
+				for (Iterator it = parentFolderMap.entrySet().iterator(); it.hasNext();) {
+					Map.Entry entry = (Map.Entry)it.next();
+					Object key = entry.getKey();
+					Object value = entry.getValue();
+					
+					if (value instanceof Map) {
+						Map map = (Map) value;
+						if (map.size() == 0) continue;
+						ArrayList al = new ArrayList();
+						list.add(new SimpleTreeNode(entry, al));
+						initTreeModel(map, al);
+					}
+				}
+				return list;
+			}
+			private Map processFolder(String path,Map parentFolderMap) {
+				for (Object obj : application.getResourcePaths(path)) {
+					String pagePath = String.valueOf(obj);
+					
+					if (pagePath.endsWith("/")) {
+						String folderName = pagePath.substring(0, pagePath.length() - 1);
+						folderName = folderName.substring(folderName.lastIndexOf("/") + 1);
+						if (escapeMap.get(folderName) != null)
+							continue;
+						parentFolderMap.put(folderName, processFolder(pagePath, new TreeMap()));
+					} else {
+						String fileName = pagePath.substring(pagePath.lastIndexOf("/") + 1);
+						String extension = fileName.substring(fileName.lastIndexOf(".") + 1);
+						if (escapeMap.get(fileName) != null || 
+								(!isShowAllFiles &amp;&amp; escapeMap.get(extension) == null))
+							continue;
+						parentFolderMap.put(fileName, pagePath);
+					}
+				}
+				return parentFolderMap;
+			}
+			public void onSelect$tree(){
+				cntDiv.getChildren().clear();
+				Treeitem item = tree.getSelectedItem();
+				Map map = (Map)item.getValue();
+				
+				showImages(map);
+			}
+			private void showImages(Map map){
+				for (Iterator it = map.entrySet().iterator(); it.hasNext();) {
+					Map.Entry me = (Map.Entry) it.next();
+					Object value = me.getValue();
+					if (value instanceof Map) continue;
+					String path = String.valueOf(value);
+					String swfPath = "";
+					if (path.endsWith("swf"))
+						swfPath = "~./ckez/img/flashIcon.jpg";
+					Toolbarbutton tb = new Toolbarbutton(String.valueOf(me.getKey()), "".equals(swfPath)? path: swfPath);
+					tb.addEventListener("onClick", new EventListener() {
+						public void onEvent(Event event) throws Exception {
+							if (selBtn !=null)
+								selBtn.setSclass(null);
+							selBtn = (Toolbarbutton) event.getTarget();
+							selBtn.setSclass("sel");
+						}
+					});
+					
+					String script = "window.opener.CKEDITOR.tools.callFunction("+CKEditorFuncNum+", '" + apName + path + "'); window.close(); ";
+					tb.setWidgetListener("onDoubleClick",script);
+					
+					cntDiv.appendChild(tb);
+				}
+				
+			}
+		}
+	]]&gt;&lt;/zscript&gt;
+	&lt;borderlayout apply="Composer"&gt;
+		&lt;west size="20%" splittable="true"&gt;
+			&lt;tree id="tree" zclass="z-filetree" sclass="ckTree"/&gt;
+		&lt;/west&gt;
+		&lt;center autoscroll="true"&gt;
+			&lt;div id="cntDiv" sclass="ckImg"/&gt;
+		&lt;/center&gt;
+	&lt;/borderlayout&gt;
+&lt;/zk&gt;

Added: addon/trunk/widgets/ckez/src/archive/web/ckez/img/flashIcon.jpg
===================================================================
(Binary files differ)


Property changes on: addon/trunk/widgets/ckez/src/archive/web/ckez/img/flashIcon.jpg
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Deleted: addon/trunk/widgets/timeplotz/build.xml
===================================================================
--- addon/trunk/widgets/timeplotz/build.xml	2010-09-08 10:31:09 UTC (rev 14270)
+++ addon/trunk/widgets/timeplotz/build.xml	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,50 +0,0 @@
-&lt;!--+
-    |
-    |           +===========================+
-    |           |   Timeplot Build System   |
-    |           +===========================+
-    |
-    | This is just for bundling and minifying javascript and CSS files.
-    |
-    +--&gt;
-
-&lt;project default="bundle" basedir="." name="Timeplot"&gt;
-
-  &lt;target name="tasks"&gt;
-    &lt;taskdef name="jsmin"
-        classname="edu.mit.simile.jsminTask.JSMinTask"
-        classpath="tools/jsmin-task/jsminTask.jar"/&gt;
-  &lt;/target&gt;
-  	
-  &lt;target name="bundle" depends="tasks"&gt;
-    &lt;jsmin output="src/archive/web/js/ext/timeplot/api/timeplot-bundle.js"&gt;
-        &lt;fileset dir="src/archive/web/js/ext/timeplot/api/scripts"&gt;
-        	&lt;include name="timeplot.js" /&gt;
-        &lt;/fileset&gt;
-        &lt;fileset dir="src/archive/web/js/ext/timeplot/api/scripts"&gt;
-            &lt;include name="plot.js" /&gt;
-        &lt;/fileset&gt;
-        &lt;fileset dir="src/archive/web/js/ext/timeplot/api/scripts"&gt;
-            &lt;include name="sources.js" /&gt;
-        &lt;/fileset&gt;
-        &lt;fileset dir="src/archive/web/js/ext/timeplot/api/scripts"&gt;
-            &lt;include name="geometry.js" /&gt;
-        &lt;/fileset&gt;
-        &lt;fileset dir="src/archive/web/js/ext/timeplot/api/scripts"&gt;
-            &lt;include name="color.js" /&gt;
-        &lt;/fileset&gt;
-        &lt;fileset dir="src/archive/web/js/ext/timeplot/api/scripts"&gt;
-            &lt;include name="math.js" /&gt;
-        &lt;/fileset&gt;
-        &lt;fileset dir="src/archive/web/js/ext/timeplot/api/scripts"&gt;
-            &lt;include name="processor.js" /&gt;
-        &lt;/fileset&gt;
-  	&lt;/jsmin&gt;
-	
-	&lt;concat destfile="src/archive/web/js/ext/timeplot/api/timeplot-bundle.css"&gt;
-        &lt;fileset dir="src/archive/web/js/ext/timeplot/api/styles"&gt;
-        	&lt;include name="**/*.css" /&gt;
-        &lt;/fileset&gt;
-    &lt;/concat&gt;
-  &lt;/target&gt;
-&lt;/project&gt;

Deleted: branches/5.0/zkdemo/src/archive/index.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/index.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zkdemo/src/archive/index.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,25 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-&lt;?page title="Welcome to ZK Demo"?&gt;
-&lt;!--
-index.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Thu May 11 17:24:33     2006, Created by tomyeh
-}}IS_NOTE
-
-Copyright (C) 2006 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;window&gt;
-	&lt;vbox&gt;
-	&lt;div&gt;Welcome to &lt;a href="userguide/" label="ZK Demo"/&gt;.&lt;/div&gt;
-	&lt;div&gt;&lt;a href="<a href="http://www.zkoss.org" target="_new">http://www.zkoss.org</a>" label="ZK"/&gt; is up and running.&lt;/div&gt;
-	&lt;/vbox&gt;
-&lt;/window&gt;

Deleted: branches/5.0/zkdemo/src/archive/test/stats.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/test/stats.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zkdemo/src/archive/test/stats.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,91 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-&lt;?page title="ZK Statistics"?&gt;
-&lt;!--
-stats.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Wed Mar 15 14:15:26     2006, Created by tomyeh
-}}IS_NOTE
-
-Copyright (C) 2006 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;zk xmlns:h="<a href="http://www.w3.org/1999/xhtml" target="_new">http://www.w3.org/1999/xhtml</a>"&gt;
-	&lt;zscript&gt;
-	monitor = desktop.webApp.configuration.monitor;
-	&lt;/zscript&gt;
-
-&lt;h:h1&gt;Server Statistics&lt;/h:h1&gt;
-
-&lt;label style="font-weight:bold;color:#404010" value="No monitor installed."
-	if="${empty monitor}"/&gt;
-
-&lt;vbox unless="${empty monitor}"&gt;
-&lt;label&gt;Version: ${desktop.webApp.version}&lt;/label&gt;
-&lt;label&gt;Build: ${desktop.webApp.build}&lt;/label&gt;
-&lt;grid width="500px"&gt;
-	&lt;columns&gt;
-		&lt;column width="180px" label="What"/&gt;
-		&lt;column width="100px" align="right" label="Total"/&gt;
-		&lt;column width="120px" align="right" label="Hourly Average"/&gt;
-		&lt;column align="right" label="Active"/&gt;
-	&lt;/columns&gt;
-	&lt;rows&gt;
-		&lt;row&gt;
-			Number of Sessions
-			&lt;label id="totalSession"/&gt;
-			&lt;label id="averageSession"/&gt;
-			&lt;label id="activeSession"/&gt;
-		&lt;/row&gt;
-		&lt;row&gt;
-			Number of Desktops
-			&lt;label id="totalDesktop"/&gt;
-			&lt;label id="averageDesktop"/&gt;
-			&lt;label id="activeDesktop"/&gt;
-		&lt;/row&gt;
-		&lt;row&gt;
-			Number of Updates
-			&lt;label id="totalUpdate"/&gt;
-			&lt;label id="averageUpdate"/&gt;
-			&lt;label id="activeUpdate"/&gt;
-		&lt;/row&gt;
-	&lt;/rows&gt;
-&lt;/grid&gt;
-	&lt;hbox&gt;Serving since &lt;label id="startTime"/&gt;&lt;/hbox&gt;
-	&lt;hbox&gt;Now is &lt;label id="now"/&gt;&lt;/hbox&gt;
-	&lt;hbox&gt;Time escaped &lt;label id="totalTime"/&gt;&lt;/hbox&gt;
-	&lt;button label="Reload" onClick="monitor()"/&gt;
-	&lt;zscript&gt;
-	ifmt = new java.text.DecimalFormat("#,##0");
-	dfmt = new java.text.DecimalFormat("#,##0.00");
-	void monitor() {
-		totalSession.setValue(ifmt.format(monitor.totalSessionCount));
-		averageSession.setValue(dfmt.format(monitor.averageSessionCount));
-		activeSession.setValue(ifmt.format(monitor.activeSessionCount));
-
-		totalDesktop.setValue(ifmt.format(monitor.totalDesktopCount));
-		averageDesktop.setValue(dfmt.format(monitor.averageDesktopCount));
-		activeDesktop.setValue(ifmt.format(monitor.activeDesktopCount));
-
-		totalUpdate.setValue(ifmt.format(monitor.totalUpdateCount));
-		averageUpdate.setValue(dfmt.format(monitor.averageUpdateCount));
-		activeUpdate.setValue(ifmt.format(monitor.activeUpdateCount));
-
-		int v = (System.currentTimeMillis() - monitor.startTime) / 60000;
-		totalTime.value = "" + (v / 60) + " hours " + (v % 60) + " mins";
-
-		now.value = new Date().toString();
-	}
-	monitor();
-
-	startTime.value = new Date(monitor.startTime).toString();
-	&lt;/zscript&gt;
-&lt;/vbox&gt;
-&lt;/zk&gt;

Added: branches/5.0/zkdemo/src/archive/test2/B50-3061764.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/test2/B50-3061764.zul	                        (rev 0)
+++ branches/5.0/zkdemo/src/archive/test2/B50-3061764.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -0,0 +1,22 @@
+&lt;zk&gt;
+&lt;html&gt;
+&lt;![CDATA[
+&lt;ol&gt;
+&lt;li&gt;Opera only.&lt;/li&gt;
+&lt;li&gt;Sizing the list header to right and make it wider&lt;/li&gt;
+&lt;li&gt;The list header shall be resized to the position you make. If not, it is a bug.&lt;/li&gt;
+&lt;li&gt;Done.&lt;/li&gt;
+]]&gt;
+&lt;/html&gt;
+&lt;listbox&gt;
+	&lt;listhead sizable="true"&gt;
+		&lt;listheader label="column1" width="40px"/&gt;
+	&lt;/listhead&gt;
+	&lt;listitem&gt;
+		&lt;listcell label="row1" /&gt;
+	&lt;/listitem&gt;
+	&lt;listitem&gt;
+		&lt;listcell label="row2" /&gt;
+	&lt;/listitem&gt;
+&lt;/listbox&gt;
+&lt;/zk&gt;
\ No newline at end of file

Added: branches/5.0/zkdemo/src/archive/test2/B50-3061765.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/test2/B50-3061765.zul	                        (rev 0)
+++ branches/5.0/zkdemo/src/archive/test2/B50-3061765.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -0,0 +1,23 @@
+&lt;zk&gt;
+&lt;html&gt;
+&lt;![CDATA[
+&lt;ol&gt;
+&lt;li&gt;Sizing the column header to right and make it wider but not go over the listbox width.&lt;/li&gt;
+&lt;li&gt;If you see a horizontal scrollbar, it is a bug; otherwise, it is OK.&lt;/li&gt;
+&lt;li&gt;Now drag the column header to right and over the listbox right edge(wider than the listbox width)&lt;/li&gt;
+&lt;li&gt;If you did not see a horizontal scrollbar, it is a bug; otherwise, it is OK.&lt;/li&gt;
+&lt;li&gt;Done.&lt;/li&gt;
+]]&gt;
+&lt;/html&gt;
+&lt;listbox&gt;
+	&lt;listhead sizable="true"&gt;
+		&lt;listheader label="column1" width="40px"/&gt;
+	&lt;/listhead&gt;
+	&lt;listitem&gt;
+		&lt;listcell label="row1" /&gt;
+	&lt;/listitem&gt;
+	&lt;listitem&gt;
+		&lt;listcell label="row2" /&gt;
+	&lt;/listitem&gt;
+&lt;/listbox&gt;
+&lt;/zk&gt;
\ No newline at end of file

Deleted: branches/5.0/zkdemo/src/archive/test2/F50-3029931.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/test2/F50-3029931.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zkdemo/src/archive/test2/F50-3029931.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,70 +0,0 @@
-&lt;?init class="org.zkoss.zkplus.databind.AnnotateDataBinderInit" ?&gt;
-&lt;zk&gt;
-	&lt;zscript&gt;&lt;![CDATA[
-		ListModelList lm = new ListModelList(Arrays.asList(new String[]{"David", "Thomas","Steven"}));
-		SimpleTreeModel stm = new SimpleTreeModel(new SimpleTreeNode("ROOT",
-				Arrays.asList(new SimpleTreeNode[]{
-						new SimpleTreeNode("David",new ArrayList()), 
-						new SimpleTreeNode("Thomas",new ArrayList()),
-						new SimpleTreeNode("Steven",new ArrayList())})));
-		
-		
-		ArrayList list = new ArrayList();
-		ArrayList list2 = new ArrayList();
-		int len = 50;
-		for(int i = 0; i &lt; len; i++) {
-			list.add("item " + i);
-			list2.add(new SimpleTreeNode("item " + i,new ArrayList()));
-		}
-		ListModelList lm2 = new ListModelList(list);
-		
-		SimpleTreeModel stm2 = new SimpleTreeModel(
-				new SimpleTreeNode("ROOT", 
-						Arrays.asList(new SimpleTreeNode[]{new SimpleTreeNode("root",list2)})));
-		
-	]]&gt;&lt;/zscript&gt;
-	&lt;hbox&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="EL"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="${lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="${lm}" mold="select" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="${lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm}" onAfterRender='gridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="gridCount"/&gt;
-			&lt;tree model="${stm}" onAfterRender="self.setSelectedItem(self.getTreechildren().getLastChild())"/&gt;
-		&lt;/div&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="data binding"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="@{lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="@{lm}" mold="select" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="@{lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="@{lm}" onAfterRender='binfingGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="binfingGridCount"/&gt;
-		&lt;/div&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="rod"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="${lm2}" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;listbox model="${lm2}" mold="select" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;listbox model="${lm2}" height="100px" onAfterRender='self.setSelectedIndex(49);'&gt;&lt;custom-attributes org.zkoss.zul.listbox.rod="false"/&gt;&lt;/listbox&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm2}" height="100px" onAfterRender='rodGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="rodGridCount"/&gt;
-			&lt;tree id="lb" model="${stm2}" height="100px" onAfterRender="self.setSelectedItem(self.getTreechildren().getFirstChild().getTreechildren().getLastChild())"/&gt;
-			&lt;button label="sel" onClick="lb.setSelectedItem(lb.getTreechildren().getFirstChild().getTreechildren().getLastChild())"&gt;&lt;/button&gt;
-		&lt;/div&gt;
-		&lt;div width="250px"&gt;
-			&lt;label value="paging"/&gt;
-			&lt;separator/&gt;
-			&lt;listbox model="${lm2}" mold="paging" pageSize="5" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm2}" mold="paging" pageSize="5" onAfterRender='pagingGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="pagingGridCount"/&gt;
-			&lt;tree model="${stm2}" mold="paging" pageSize="5" onAfterRender="self.setSelectedItem(self.getTreechildren().getFirstChild().getTreechildren().getLastChild())"/&gt;
-		&lt;/div&gt;
-	&lt;/hbox&gt;
-&lt;/zk&gt;
\ No newline at end of file

Added: branches/5.0/zkdemo/src/archive/test2/F50-3061671.zul
===================================================================
--- branches/5.0/zkdemo/src/archive/test2/F50-3061671.zul	                        (rev 0)
+++ branches/5.0/zkdemo/src/archive/test2/F50-3061671.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -0,0 +1,30 @@
+&lt;?init class="org.zkoss.zkplus.databind.AnnotateDataBinderInit" ?&gt;
+&lt;zk&gt;
+&lt;html&gt;
+&lt;![CDATA[
+&lt;ol&gt;
+&lt;li&gt;Click the button on each row. &lt;/li&gt;
+&lt;li&gt;You shall see messgebox showing label 'btn' on each click.&lt;/li&gt;
+&lt;li&gt;If not, it is a bug.&lt;/li&gt;
+&lt;li&gt;Done&lt;/li&gt;
+&lt;/ol&gt;
+]]&gt;
+&lt;/html&gt;
+	&lt;zscript&gt;&lt;![CDATA[
+		List books = Arrays.asList(new String[]{"a", "b", "c"})
+	]]&gt;&lt;/zscript&gt;
+	&lt;listbox id="lb" model="@{books}"&gt;
+		&lt;listhead&gt;
+			&lt;listheader label="Code" /&gt;
+			&lt;listheader label="Description"/&gt;
+		&lt;/listhead&gt;
+		&lt;listitem self="@{each=code}" value="@{book}"&gt;
+			&lt;listcell label="@{code}" /&gt;
+			&lt;listcell&gt;
+				&lt;window&gt;
+					&lt;button label="click" id="btn" onClick="alert(self.id)"/&gt;
+				&lt;/window&gt;
+			&lt;/listcell&gt;
+		&lt;/listitem&gt;
+	&lt;/listbox&gt;
+&lt;/zk&gt;

Modified: branches/5.0/zkdemo/src/archive/test2/config.properties
===================================================================
--- branches/5.0/zkdemo/src/archive/test2/config.properties	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zkdemo/src/archive/test2/config.properties	2010-09-09 02:46:23 UTC (rev 14271)
@@ -799,6 +799,8 @@
 B50-3056987.zul=A,E,Breeze,Combobox,Bandbox
 B50-3057311.zul=A,E,Select,Listbox,Window
 B50-3057902.zul=B,E,Window,ShowBusy
+B50-3061764.zul=A,E,Listbox,Listheader,Opera
+B50-3061765.zul=A,E,Listbox,Listheader
 
 ##
 # Features - 3.0.x version
@@ -956,6 +958,7 @@
 F50-3052761.zul=A,E,Calendar,Datebox
 F50-3052857.zul=A,E,Combobox,ListModel,ListModels
 F50-3057903.zul=A,E,Slider
+F50-3061671.zul=A,E,Listbox,databind
 
 ##
 # Complex Test Case

Modified: branches/5.0/zkdoc/release-note
===================================================================
--- branches/5.0/zkdoc/release-note	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zkdoc/release-note	2010-09-09 02:46:23 UTC (rev 14271)
@@ -2,8 +2,12 @@
 ZK 5.0.5
 * Features
   3061676: Autodrop menubar shall be closed automatically when move out
+  3061671: Databinding foreach keep cloned cmp's id when in spaceowner
+
 * Bugs
   3057902: zk bug for window showbusy
+  3061764: Opera only. Cannot sizing a column with width
+  3061765: Unexpected horizontal scrollbar when sizing listheader
 
 * Upgrade Notes
 

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingComboitemRenderer.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingComboitemRenderer.java	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingComboitemRenderer.java	2010-09-09 02:46:23 UTC (rev 14271)
@@ -24,6 +24,7 @@
 import java.util.Map;
 
 import org.zkoss.zk.ui.Component;
+import org.zkoss.zk.ui.IdSpace;
 import org.zkoss.zul.Combobox;
 import org.zkoss.zul.Comboitem;
 /**
@@ -82,8 +83,11 @@
 			return;
 		}
 		
-		for(final Iterator it = clone.getChildren().iterator(); it.hasNext(); ) {
-			setupCloneIds((Component) it.next()); //recursive
+		//Feature #3061671: Databinding foreach keep cloned cmp's id when in spaceowner
+		if (!(clone instanceof IdSpace)) { //parent is an IdSpace, so keep the id as is, no need to traverse down
+			for(final Iterator it = clone.getChildren().iterator(); it.hasNext(); ) {
+				setupCloneIds((Component) it.next()); //recursive
+			}
 		}
 	}
 

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingListitemRenderer.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingListitemRenderer.java	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingListitemRenderer.java	2010-09-09 02:46:23 UTC (rev 14271)
@@ -24,6 +24,7 @@
 import java.util.Map;
 
 import org.zkoss.zk.ui.Component;
+import org.zkoss.zk.ui.IdSpace;
 import org.zkoss.zul.Listbox;
 import org.zkoss.zul.Listcell;
 import org.zkoss.zul.Listitem;
@@ -141,8 +142,11 @@
 			return;
 		}
 		
-		for(final Iterator it = clone.getChildren().iterator(); it.hasNext(); ) {
-			setupCloneIds((Component) it.next()); //recursive
+		//Feature #3061671: Databinding foreach keep cloned cmp's id when in spaceowner
+		if (!(clone instanceof IdSpace)) { //parent is an IdSpace, so keep the id as is, no need to traverse down
+			for(final Iterator it = clone.getChildren().iterator(); it.hasNext(); ) {
+				setupCloneIds((Component) it.next()); //recursive
+			}
 		}
 	}
 }

Modified: branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingRowRenderer.java
===================================================================
--- branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingRowRenderer.java	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zkplus/src/org/zkoss/zkplus/databind/BindingRowRenderer.java	2010-09-09 02:46:23 UTC (rev 14271)
@@ -24,6 +24,7 @@
 import java.util.Map;
 
 import org.zkoss.zk.ui.Component;
+import org.zkoss.zk.ui.IdSpace;
 import org.zkoss.zul.Grid;
 import org.zkoss.zul.Row;
 
@@ -139,9 +140,11 @@
 		if (template != null &amp;&amp; DataBinder.isCollectionOwner(template)) {
 			return;
 		}
-		
-		for(final Iterator it = clone.getChildren().iterator(); it.hasNext(); ) {
-			setupCloneIds((Component) it.next()); //recursive
+		//Feature #3061671: Databinding foreach keep cloned cmp's id when in spaceowner
+		if (!(clone instanceof IdSpace)) { //parent is an IdSpace, so keep the id as is, no need to traverse down
+			for(final Iterator it = clone.getChildren().iterator(); it.hasNext(); ) {
+				setupCloneIds((Component) it.next()); //recursive
+			}
 		}
 	}
 }

Modified: branches/5.0/zul/src/archive/web/js/zul/menu/Menupopup.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/menu/Menupopup.js	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zul/src/archive/web/js/zul/menu/Menupopup.js	2010-09-09 02:46:23 UTC (rev 14271)
@@ -12,6 +12,11 @@
 This program is distributed under LGPL Version 3.0 in the hope that
 it will be useful, but WITHOUT ANY WARRANTY.
 */
+(function () {
+	function _getMenu(wgt) {
+		var p = wgt.parent;
+		return p.$instanceof(zul.menu.Menu) ? p: null;
+	}
 /**
  * A container used to display menus. It should be placed inside a
  * {@link Menu}.
@@ -81,7 +86,7 @@
 		jq(this.$n()).hide(); // force to hide the element
 		this._hideShadow();
 		var menu;
-		if ((menu = this.getMenu()) &amp;&amp; menu.isTopmost())
+		if ((menu = _getMenu(this)) &amp;&amp; menu.isTopmost())
 			jq(menu.$n('a')).removeClass(menu.getZclass() + "-body-seld");
 
 		var item = this._currentChild();
@@ -93,7 +98,7 @@
 		if (!this.isOpen())
 			zul.menu._nOpen++;
 		var menu;
-		if (menu = this.getMenu()) {
+		if (menu = _getMenu(this)) {
 			if (!offset) {
 				ref = menu.$n('a');
 				if (!position)
@@ -227,7 +232,7 @@
 		case 37: //LEFT
 			this.close();
 
-			if (((menu = this.getMenu())) &amp;&amp; !menu.isTopmost()) {
+			if (((menu = _getMenu(this))) &amp;&amp; !menu.isTopmost()) {
 				var pp = menu.parent;
 				if (pp) {
 					var anc = pp.$n('a');
@@ -256,15 +261,6 @@
 	 * @since 5.0.5
 	 */
 	getMenubar: zul.menu.Menu.prototype.getMenubar,
-	/** Returns the {@link Menu} that open this menupopup, or null if not available.
-	 * @return zul.menu.Menu
-	 */
-	getMenu: function () {
-		var p = this.parent;
-		if (p.$instanceof(zul.menu.Menu))
-			return p;
-		return null;
-	},
 	doMouseOver_: function (evt) {
 		var menubar = this.getMenubar();
 		if (menubar) menubar._bOver = true;
@@ -283,4 +279,5 @@
 		}
 	}
 });
-zul.menu._nOpen = 0;
\ No newline at end of file
+zul.menu._nOpen = 0;
+})();
\ No newline at end of file

Modified: branches/5.0/zul/src/archive/web/js/zul/mesh/HeaderWidget.js
===================================================================
--- branches/5.0/zul/src/archive/web/js/zul/mesh/HeaderWidget.js	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.0/zul/src/archive/web/js/zul/mesh/HeaderWidget.js	2010-09-09 02:46:23 UTC (rev 14271)
@@ -311,31 +311,25 @@
 	_aftersizing: function (dg, evt) {
 		var wgt = dg.control,
 			n = wgt.$n(), $n = zk(n),
-			owner = wgt.getMeshWidget(),
+			mesh = wgt.getMeshWidget(),
 			wd = dg._zszofs,
-			table = owner.eheadtbl,
+			table = mesh.eheadtbl,
 			head = table.tBodies[0].rows[0], 
 			rwd = $n.revisedWidth(wd),
-			cells = head.cells,
-			cidx = $n.cellIndex(),
-			total = 0;
+			cidx = $n.cellIndex();
 			
-		for (var k = cells.length; k--;) {
-			if (k !== cidx &amp;&amp; zk(cells[k]).isVisible()) total += cells[k].offsetWidth;
-		}
-
 		// For Opera, the code of adjusting width must be in front of the adjusting table.
 		// Otherwise, the whole layout in Opera always shows wrong.
-		if (owner.efoottbl) {
-			owner.eftfaker.cells[cidx].style.width = wd + "px";
+		if (mesh.efoottbl) {
+			mesh.eftfaker.cells[cidx].style.width = wd + "px";
 		}
 		var fixed;
-		if (owner.ebodytbl) {
-			if (zk.opera &amp;&amp; !owner.ebodytbl.style.tableLayout) {
+		if (mesh.ebodytbl) {
+			if (zk.opera &amp;&amp; !mesh.ebodytbl.style.tableLayout) {
 				fixed = "auto";
-				owner.ebodytbl.style.tableLayout = "fixed";
+				mesh.ebodytbl.style.tableLayout = "fixed";
 			}
-			owner.ebdfaker.cells[cidx].style.width = wd + "px";
+			mesh.ebdfaker.cells[cidx].style.width = wd + "px";
 		}
 		
 		head.cells[cidx].style.width = wd + "px";
@@ -343,14 +337,26 @@
 		var cell = n.firstChild;
 		cell.style.width = zk(cell).revisedWidth(rwd) + "px";
 		
-		table.style.width = total + wd + "px";
-		if (owner.efoottbl)
-			owner.efoottbl.style.width = table.style.width;
+		//bug 3061765: unexpected horizontal scrollbar when sizing
+/*		table.style.width = total + wd + "px";
 		
-		if (owner.ebodytbl)
-			owner.ebodytbl.style.width = table.style.width;
+		if (mesh.efoottbl)
+			mesh.efoottbl.style.width = table.style.width;
+		
+		if (mesh.ebodytbl)
+			mesh.ebodytbl.style.width = table.style.width;
+*/			
+		var meshn = mesh.$n();
+		if (zk.opera) {
+			if(fixed) 
+				mesh.ebodytbl.style.tableLayout = fixed;
 			
-		if (zk.opera &amp;&amp; fixed) owner.ebodytbl.style.tableLayout = fixed;
+			//bug 3061764: Opera only. Cannot sizing a column with width
+			var olddisp = meshn.style.display; //force redraw
+			meshn.style.display='none';
+			var redrawFix = meshn.offsetHeight;
+			meshn.style.display=olddisp;
+		}
 		
 		wgt.parent.fire('onColSize', zk.copy({
 			index: cidx,
@@ -358,10 +364,8 @@
 			width: wd + "px"
 		}, evt.data), null, 0);
 		
-		var mesh = wgt.getMeshWidget();
-		
 		// bug #2799258 in IE, we have to force to recalculate the size.
-		mesh.$n()._lastsz = null;
+		meshn._lastsz = null;
 		
 		// bug #2799258
 		zWatch.fireDown('onSize', mesh);

Deleted: branches/5.5/zkdemo/src/archive/index.zul
===================================================================
--- branches/5.5/zkdemo/src/archive/index.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.5/zkdemo/src/archive/index.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,25 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-&lt;?page title="Welcome to ZK Demo"?&gt;
-&lt;!--
-index.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Thu May 11 17:24:33     2006, Created by tomyeh
-}}IS_NOTE
-
-Copyright (C) 2006 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;window&gt;
-	&lt;vbox&gt;
-	&lt;div&gt;Welcome to &lt;a href="userguide/" label="ZK Demo"/&gt;.&lt;/div&gt;
-	&lt;div&gt;&lt;a href="<a href="http://www.zkoss.org" target="_new">http://www.zkoss.org</a>" label="ZK"/&gt; is up and running.&lt;/div&gt;
-	&lt;/vbox&gt;
-&lt;/window&gt;

Deleted: branches/5.5/zkdemo/src/archive/test/stats.zul
===================================================================
--- branches/5.5/zkdemo/src/archive/test/stats.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.5/zkdemo/src/archive/test/stats.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,91 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-&lt;?page title="ZK Statistics"?&gt;
-&lt;!--
-stats.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Wed Mar 15 14:15:26     2006, Created by tomyeh
-}}IS_NOTE
-
-Copyright (C) 2006 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;zk xmlns:h="<a href="http://www.w3.org/1999/xhtml" target="_new">http://www.w3.org/1999/xhtml</a>"&gt;
-	&lt;zscript&gt;
-	monitor = desktop.webApp.configuration.monitor;
-	&lt;/zscript&gt;
-
-&lt;h:h1&gt;Server Statistics&lt;/h:h1&gt;
-
-&lt;label style="font-weight:bold;color:#404010" value="No monitor installed."
-	if="${empty monitor}"/&gt;
-
-&lt;vbox unless="${empty monitor}"&gt;
-&lt;label&gt;Version: ${desktop.webApp.version}&lt;/label&gt;
-&lt;label&gt;Build: ${desktop.webApp.build}&lt;/label&gt;
-&lt;grid width="500px"&gt;
-	&lt;columns&gt;
-		&lt;column width="180px" label="What"/&gt;
-		&lt;column width="100px" align="right" label="Total"/&gt;
-		&lt;column width="120px" align="right" label="Hourly Average"/&gt;
-		&lt;column align="right" label="Active"/&gt;
-	&lt;/columns&gt;
-	&lt;rows&gt;
-		&lt;row&gt;
-			Number of Sessions
-			&lt;label id="totalSession"/&gt;
-			&lt;label id="averageSession"/&gt;
-			&lt;label id="activeSession"/&gt;
-		&lt;/row&gt;
-		&lt;row&gt;
-			Number of Desktops
-			&lt;label id="totalDesktop"/&gt;
-			&lt;label id="averageDesktop"/&gt;
-			&lt;label id="activeDesktop"/&gt;
-		&lt;/row&gt;
-		&lt;row&gt;
-			Number of Updates
-			&lt;label id="totalUpdate"/&gt;
-			&lt;label id="averageUpdate"/&gt;
-			&lt;label id="activeUpdate"/&gt;
-		&lt;/row&gt;
-	&lt;/rows&gt;
-&lt;/grid&gt;
-	&lt;hbox&gt;Serving since &lt;label id="startTime"/&gt;&lt;/hbox&gt;
-	&lt;hbox&gt;Now is &lt;label id="now"/&gt;&lt;/hbox&gt;
-	&lt;hbox&gt;Time escaped &lt;label id="totalTime"/&gt;&lt;/hbox&gt;
-	&lt;button label="Reload" onClick="monitor()"/&gt;
-	&lt;zscript&gt;
-	ifmt = new java.text.DecimalFormat("#,##0");
-	dfmt = new java.text.DecimalFormat("#,##0.00");
-	void monitor() {
-		totalSession.setValue(ifmt.format(monitor.totalSessionCount));
-		averageSession.setValue(dfmt.format(monitor.averageSessionCount));
-		activeSession.setValue(ifmt.format(monitor.activeSessionCount));
-
-		totalDesktop.setValue(ifmt.format(monitor.totalDesktopCount));
-		averageDesktop.setValue(dfmt.format(monitor.averageDesktopCount));
-		activeDesktop.setValue(ifmt.format(monitor.activeDesktopCount));
-
-		totalUpdate.setValue(ifmt.format(monitor.totalUpdateCount));
-		averageUpdate.setValue(dfmt.format(monitor.averageUpdateCount));
-		activeUpdate.setValue(ifmt.format(monitor.activeUpdateCount));
-
-		int v = (System.currentTimeMillis() - monitor.startTime) / 60000;
-		totalTime.value = "" + (v / 60) + " hours " + (v % 60) + " mins";
-
-		now.value = new Date().toString();
-	}
-	monitor();
-
-	startTime.value = new Date(monitor.startTime).toString();
-	&lt;/zscript&gt;
-&lt;/vbox&gt;
-&lt;/zk&gt;

Deleted: branches/5.5/zkdemo/src/archive/test2/F50-3029931.zul
===================================================================
--- branches/5.5/zkdemo/src/archive/test2/F50-3029931.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/5.5/zkdemo/src/archive/test2/F50-3029931.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,70 +0,0 @@
-&lt;?init class="org.zkoss.zkplus.databind.AnnotateDataBinderInit" ?&gt;
-&lt;zk&gt;
-	&lt;zscript&gt;&lt;![CDATA[
-		ListModelList lm = new ListModelList(Arrays.asList(new String[]{"David", "Thomas","Steven"}));
-		SimpleTreeModel stm = new SimpleTreeModel(new SimpleTreeNode("ROOT",
-				Arrays.asList(new SimpleTreeNode[]{
-						new SimpleTreeNode("David",new ArrayList()), 
-						new SimpleTreeNode("Thomas",new ArrayList()),
-						new SimpleTreeNode("Steven",new ArrayList())})));
-		
-		
-		ArrayList list = new ArrayList();
-		ArrayList list2 = new ArrayList();
-		int len = 50;
-		for(int i = 0; i &lt; len; i++) {
-			list.add("item " + i);
-			list2.add(new SimpleTreeNode("item " + i,new ArrayList()));
-		}
-		ListModelList lm2 = new ListModelList(list);
-		
-		SimpleTreeModel stm2 = new SimpleTreeModel(
-				new SimpleTreeNode("ROOT", 
-						Arrays.asList(new SimpleTreeNode[]{new SimpleTreeNode("root",list2)})));
-		
-	]]&gt;&lt;/zscript&gt;
-	&lt;hbox&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="EL"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="${lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="${lm}" mold="select" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="${lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm}" onAfterRender='gridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="gridCount"/&gt;
-			&lt;tree model="${stm}" onAfterRender="self.setSelectedItem(self.getTreechildren().getLastChild())"/&gt;
-		&lt;/div&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="data binding"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="@{lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="@{lm}" mold="select" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="@{lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="@{lm}" onAfterRender='binfingGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="binfingGridCount"/&gt;
-		&lt;/div&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="rod"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="${lm2}" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;listbox model="${lm2}" mold="select" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;listbox model="${lm2}" height="100px" onAfterRender='self.setSelectedIndex(49);'&gt;&lt;custom-attributes org.zkoss.zul.listbox.rod="false"/&gt;&lt;/listbox&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm2}" height="100px" onAfterRender='rodGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="rodGridCount"/&gt;
-			&lt;tree id="lb" model="${stm2}" height="100px" onAfterRender="self.setSelectedItem(self.getTreechildren().getFirstChild().getTreechildren().getLastChild())"/&gt;
-			&lt;button label="sel" onClick="lb.setSelectedItem(lb.getTreechildren().getFirstChild().getTreechildren().getLastChild())"&gt;&lt;/button&gt;
-		&lt;/div&gt;
-		&lt;div width="250px"&gt;
-			&lt;label value="paging"/&gt;
-			&lt;separator/&gt;
-			&lt;listbox model="${lm2}" mold="paging" pageSize="5" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm2}" mold="paging" pageSize="5" onAfterRender='pagingGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="pagingGridCount"/&gt;
-			&lt;tree model="${stm2}" mold="paging" pageSize="5" onAfterRender="self.setSelectedItem(self.getTreechildren().getFirstChild().getTreechildren().getLastChild())"/&gt;
-		&lt;/div&gt;
-	&lt;/hbox&gt;
-&lt;/zk&gt;
\ No newline at end of file

Deleted: branches/6.0/zkdemo/src/archive/index.zul
===================================================================
--- branches/6.0/zkdemo/src/archive/index.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/6.0/zkdemo/src/archive/index.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,25 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-&lt;?page title="Welcome to ZK Demo"?&gt;
-&lt;!--
-index.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Thu May 11 17:24:33     2006, Created by tomyeh
-}}IS_NOTE
-
-Copyright (C) 2006 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;window&gt;
-	&lt;vbox&gt;
-	&lt;div&gt;Welcome to &lt;a href="userguide/" label="ZK Demo"/&gt;.&lt;/div&gt;
-	&lt;div&gt;&lt;a href="<a href="http://www.zkoss.org" target="_new">http://www.zkoss.org</a>" label="ZK"/&gt; is up and running.&lt;/div&gt;
-	&lt;/vbox&gt;
-&lt;/window&gt;

Deleted: branches/6.0/zkdemo/src/archive/test/stats.zul
===================================================================
--- branches/6.0/zkdemo/src/archive/test/stats.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/6.0/zkdemo/src/archive/test/stats.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,91 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-&lt;?page title="ZK Statistics"?&gt;
-&lt;!--
-stats.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Wed Mar 15 14:15:26     2006, Created by tomyeh
-}}IS_NOTE
-
-Copyright (C) 2006 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;zk xmlns:h="<a href="http://www.w3.org/1999/xhtml" target="_new">http://www.w3.org/1999/xhtml</a>"&gt;
-	&lt;zscript&gt;
-	monitor = desktop.webApp.configuration.monitor;
-	&lt;/zscript&gt;
-
-&lt;h:h1&gt;Server Statistics&lt;/h:h1&gt;
-
-&lt;label style="font-weight:bold;color:#404010" value="No monitor installed."
-	if="${empty monitor}"/&gt;
-
-&lt;vbox unless="${empty monitor}"&gt;
-&lt;label&gt;Version: ${desktop.webApp.version}&lt;/label&gt;
-&lt;label&gt;Build: ${desktop.webApp.build}&lt;/label&gt;
-&lt;grid width="500px"&gt;
-	&lt;columns&gt;
-		&lt;column width="180px" label="What"/&gt;
-		&lt;column width="100px" align="right" label="Total"/&gt;
-		&lt;column width="120px" align="right" label="Hourly Average"/&gt;
-		&lt;column align="right" label="Active"/&gt;
-	&lt;/columns&gt;
-	&lt;rows&gt;
-		&lt;row&gt;
-			Number of Sessions
-			&lt;label id="totalSession"/&gt;
-			&lt;label id="averageSession"/&gt;
-			&lt;label id="activeSession"/&gt;
-		&lt;/row&gt;
-		&lt;row&gt;
-			Number of Desktops
-			&lt;label id="totalDesktop"/&gt;
-			&lt;label id="averageDesktop"/&gt;
-			&lt;label id="activeDesktop"/&gt;
-		&lt;/row&gt;
-		&lt;row&gt;
-			Number of Updates
-			&lt;label id="totalUpdate"/&gt;
-			&lt;label id="averageUpdate"/&gt;
-			&lt;label id="activeUpdate"/&gt;
-		&lt;/row&gt;
-	&lt;/rows&gt;
-&lt;/grid&gt;
-	&lt;hbox&gt;Serving since &lt;label id="startTime"/&gt;&lt;/hbox&gt;
-	&lt;hbox&gt;Now is &lt;label id="now"/&gt;&lt;/hbox&gt;
-	&lt;hbox&gt;Time escaped &lt;label id="totalTime"/&gt;&lt;/hbox&gt;
-	&lt;button label="Reload" onClick="monitor()"/&gt;
-	&lt;zscript&gt;
-	ifmt = new java.text.DecimalFormat("#,##0");
-	dfmt = new java.text.DecimalFormat("#,##0.00");
-	void monitor() {
-		totalSession.setValue(ifmt.format(monitor.totalSessionCount));
-		averageSession.setValue(dfmt.format(monitor.averageSessionCount));
-		activeSession.setValue(ifmt.format(monitor.activeSessionCount));
-
-		totalDesktop.setValue(ifmt.format(monitor.totalDesktopCount));
-		averageDesktop.setValue(dfmt.format(monitor.averageDesktopCount));
-		activeDesktop.setValue(ifmt.format(monitor.activeDesktopCount));
-
-		totalUpdate.setValue(ifmt.format(monitor.totalUpdateCount));
-		averageUpdate.setValue(dfmt.format(monitor.averageUpdateCount));
-		activeUpdate.setValue(ifmt.format(monitor.activeUpdateCount));
-
-		int v = (System.currentTimeMillis() - monitor.startTime) / 60000;
-		totalTime.value = "" + (v / 60) + " hours " + (v % 60) + " mins";
-
-		now.value = new Date().toString();
-	}
-	monitor();
-
-	startTime.value = new Date(monitor.startTime).toString();
-	&lt;/zscript&gt;
-&lt;/vbox&gt;
-&lt;/zk&gt;

Deleted: branches/6.0/zkdemo/src/archive/test2/F50-3029931.zul
===================================================================
--- branches/6.0/zkdemo/src/archive/test2/F50-3029931.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ branches/6.0/zkdemo/src/archive/test2/F50-3029931.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,70 +0,0 @@
-&lt;?init class="org.zkoss.zkplus.databind.AnnotateDataBinderInit" ?&gt;
-&lt;zk&gt;
-	&lt;zscript&gt;&lt;![CDATA[
-		ListModelList lm = new ListModelList(Arrays.asList(new String[]{"David", "Thomas","Steven"}));
-		SimpleTreeModel stm = new SimpleTreeModel(new SimpleTreeNode("ROOT",
-				Arrays.asList(new SimpleTreeNode[]{
-						new SimpleTreeNode("David",new ArrayList()), 
-						new SimpleTreeNode("Thomas",new ArrayList()),
-						new SimpleTreeNode("Steven",new ArrayList())})));
-		
-		
-		ArrayList list = new ArrayList();
-		ArrayList list2 = new ArrayList();
-		int len = 50;
-		for(int i = 0; i &lt; len; i++) {
-			list.add("item " + i);
-			list2.add(new SimpleTreeNode("item " + i,new ArrayList()));
-		}
-		ListModelList lm2 = new ListModelList(list);
-		
-		SimpleTreeModel stm2 = new SimpleTreeModel(
-				new SimpleTreeNode("ROOT", 
-						Arrays.asList(new SimpleTreeNode[]{new SimpleTreeNode("root",list2)})));
-		
-	]]&gt;&lt;/zscript&gt;
-	&lt;hbox&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="EL"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="${lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="${lm}" mold="select" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="${lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm}" onAfterRender='gridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="gridCount"/&gt;
-			&lt;tree model="${stm}" onAfterRender="self.setSelectedItem(self.getTreechildren().getLastChild())"/&gt;
-		&lt;/div&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="data binding"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="@{lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="@{lm}" mold="select" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="@{lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="@{lm}" onAfterRender='binfingGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="binfingGridCount"/&gt;
-		&lt;/div&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="rod"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="${lm2}" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;listbox model="${lm2}" mold="select" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;listbox model="${lm2}" height="100px" onAfterRender='self.setSelectedIndex(49);'&gt;&lt;custom-attributes org.zkoss.zul.listbox.rod="false"/&gt;&lt;/listbox&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm2}" height="100px" onAfterRender='rodGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="rodGridCount"/&gt;
-			&lt;tree id="lb" model="${stm2}" height="100px" onAfterRender="self.setSelectedItem(self.getTreechildren().getFirstChild().getTreechildren().getLastChild())"/&gt;
-			&lt;button label="sel" onClick="lb.setSelectedItem(lb.getTreechildren().getFirstChild().getTreechildren().getLastChild())"&gt;&lt;/button&gt;
-		&lt;/div&gt;
-		&lt;div width="250px"&gt;
-			&lt;label value="paging"/&gt;
-			&lt;separator/&gt;
-			&lt;listbox model="${lm2}" mold="paging" pageSize="5" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm2}" mold="paging" pageSize="5" onAfterRender='pagingGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="pagingGridCount"/&gt;
-			&lt;tree model="${stm2}" mold="paging" pageSize="5" onAfterRender="self.setSelectedItem(self.getTreechildren().getFirstChild().getTreechildren().getLastChild())"/&gt;
-		&lt;/div&gt;
-	&lt;/hbox&gt;
-&lt;/zk&gt;
\ No newline at end of file

Deleted: releases/5.0.4/zkdemo/src/archive/index.zul
===================================================================
--- releases/5.0.4/zkdemo/src/archive/index.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ releases/5.0.4/zkdemo/src/archive/index.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,25 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-&lt;?page title="Welcome to ZK Demo"?&gt;
-&lt;!--
-index.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Thu May 11 17:24:33     2006, Created by tomyeh
-}}IS_NOTE
-
-Copyright (C) 2006 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;window&gt;
-	&lt;vbox&gt;
-	&lt;div&gt;Welcome to &lt;a href="userguide/" label="ZK Demo"/&gt;.&lt;/div&gt;
-	&lt;div&gt;&lt;a href="<a href="http://www.zkoss.org" target="_new">http://www.zkoss.org</a>" label="ZK"/&gt; is up and running.&lt;/div&gt;
-	&lt;/vbox&gt;
-&lt;/window&gt;

Deleted: releases/5.0.4/zkdemo/src/archive/test/stats.zul
===================================================================
--- releases/5.0.4/zkdemo/src/archive/test/stats.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ releases/5.0.4/zkdemo/src/archive/test/stats.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,91 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-&lt;?page title="ZK Statistics"?&gt;
-&lt;!--
-stats.zul
-
-{{IS_NOTE
-	Purpose:
-		
-	Description:
-		
-	History:
-		Wed Mar 15 14:15:26     2006, Created by tomyeh
-}}IS_NOTE
-
-Copyright (C) 2006 Potix Corporation. All Rights Reserved.
-
-{{IS_RIGHT
-}}IS_RIGHT
---&gt;
-&lt;zk xmlns:h="<a href="http://www.w3.org/1999/xhtml" target="_new">http://www.w3.org/1999/xhtml</a>"&gt;
-	&lt;zscript&gt;
-	monitor = desktop.webApp.configuration.monitor;
-	&lt;/zscript&gt;
-
-&lt;h:h1&gt;Server Statistics&lt;/h:h1&gt;
-
-&lt;label style="font-weight:bold;color:#404010" value="No monitor installed."
-	if="${empty monitor}"/&gt;
-
-&lt;vbox unless="${empty monitor}"&gt;
-&lt;label&gt;Version: ${desktop.webApp.version}&lt;/label&gt;
-&lt;label&gt;Build: ${desktop.webApp.build}&lt;/label&gt;
-&lt;grid width="500px"&gt;
-	&lt;columns&gt;
-		&lt;column width="180px" label="What"/&gt;
-		&lt;column width="100px" align="right" label="Total"/&gt;
-		&lt;column width="120px" align="right" label="Hourly Average"/&gt;
-		&lt;column align="right" label="Active"/&gt;
-	&lt;/columns&gt;
-	&lt;rows&gt;
-		&lt;row&gt;
-			Number of Sessions
-			&lt;label id="totalSession"/&gt;
-			&lt;label id="averageSession"/&gt;
-			&lt;label id="activeSession"/&gt;
-		&lt;/row&gt;
-		&lt;row&gt;
-			Number of Desktops
-			&lt;label id="totalDesktop"/&gt;
-			&lt;label id="averageDesktop"/&gt;
-			&lt;label id="activeDesktop"/&gt;
-		&lt;/row&gt;
-		&lt;row&gt;
-			Number of Updates
-			&lt;label id="totalUpdate"/&gt;
-			&lt;label id="averageUpdate"/&gt;
-			&lt;label id="activeUpdate"/&gt;
-		&lt;/row&gt;
-	&lt;/rows&gt;
-&lt;/grid&gt;
-	&lt;hbox&gt;Serving since &lt;label id="startTime"/&gt;&lt;/hbox&gt;
-	&lt;hbox&gt;Now is &lt;label id="now"/&gt;&lt;/hbox&gt;
-	&lt;hbox&gt;Time escaped &lt;label id="totalTime"/&gt;&lt;/hbox&gt;
-	&lt;button label="Reload" onClick="monitor()"/&gt;
-	&lt;zscript&gt;
-	ifmt = new java.text.DecimalFormat("#,##0");
-	dfmt = new java.text.DecimalFormat("#,##0.00");
-	void monitor() {
-		totalSession.setValue(ifmt.format(monitor.totalSessionCount));
-		averageSession.setValue(dfmt.format(monitor.averageSessionCount));
-		activeSession.setValue(ifmt.format(monitor.activeSessionCount));
-
-		totalDesktop.setValue(ifmt.format(monitor.totalDesktopCount));
-		averageDesktop.setValue(dfmt.format(monitor.averageDesktopCount));
-		activeDesktop.setValue(ifmt.format(monitor.activeDesktopCount));
-
-		totalUpdate.setValue(ifmt.format(monitor.totalUpdateCount));
-		averageUpdate.setValue(dfmt.format(monitor.averageUpdateCount));
-		activeUpdate.setValue(ifmt.format(monitor.activeUpdateCount));
-
-		int v = (System.currentTimeMillis() - monitor.startTime) / 60000;
-		totalTime.value = "" + (v / 60) + " hours " + (v % 60) + " mins";
-
-		now.value = new Date().toString();
-	}
-	monitor();
-
-	startTime.value = new Date(monitor.startTime).toString();
-	&lt;/zscript&gt;
-&lt;/vbox&gt;
-&lt;/zk&gt;

Deleted: releases/5.0.4/zkdemo/src/archive/test2/F50-3029931.zul
===================================================================
--- releases/5.0.4/zkdemo/src/archive/test2/F50-3029931.zul	2010-09-08 10:31:09 UTC (rev 14270)
+++ releases/5.0.4/zkdemo/src/archive/test2/F50-3029931.zul	2010-09-09 02:46:23 UTC (rev 14271)
@@ -1,70 +0,0 @@
-&lt;?init class="org.zkoss.zkplus.databind.AnnotateDataBinderInit" ?&gt;
-&lt;zk&gt;
-	&lt;zscript&gt;&lt;![CDATA[
-		ListModelList lm = new ListModelList(Arrays.asList(new String[]{"David", "Thomas","Steven"}));
-		SimpleTreeModel stm = new SimpleTreeModel(new SimpleTreeNode("ROOT",
-				Arrays.asList(new SimpleTreeNode[]{
-						new SimpleTreeNode("David",new ArrayList()), 
-						new SimpleTreeNode("Thomas",new ArrayList()),
-						new SimpleTreeNode("Steven",new ArrayList())})));
-		
-		
-		ArrayList list = new ArrayList();
-		ArrayList list2 = new ArrayList();
-		int len = 50;
-		for(int i = 0; i &lt; len; i++) {
-			list.add("item " + i);
-			list2.add(new SimpleTreeNode("item " + i,new ArrayList()));
-		}
-		ListModelList lm2 = new ListModelList(list);
-		
-		SimpleTreeModel stm2 = new SimpleTreeModel(
-				new SimpleTreeNode("ROOT", 
-						Arrays.asList(new SimpleTreeNode[]{new SimpleTreeNode("root",list2)})));
-		
-	]]&gt;&lt;/zscript&gt;
-	&lt;hbox&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="EL"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="${lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="${lm}" mold="select" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="${lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm}" onAfterRender='gridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="gridCount"/&gt;
-			&lt;tree model="${stm}" onAfterRender="self.setSelectedItem(self.getTreechildren().getLastChild())"/&gt;
-		&lt;/div&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="data binding"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="@{lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="@{lm}" mold="select" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;listbox model="@{lm}" onAfterRender="self.setSelectedIndex(2)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="@{lm}" onAfterRender='binfingGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="binfingGridCount"/&gt;
-		&lt;/div&gt;
-		&lt;div width="200px"&gt;
-			&lt;label value="rod"/&gt;
-			&lt;separator/&gt;
-			&lt;combobox model="${lm2}" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;listbox model="${lm2}" mold="select" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;listbox model="${lm2}" height="100px" onAfterRender='self.setSelectedIndex(49);'&gt;&lt;custom-attributes org.zkoss.zul.listbox.rod="false"/&gt;&lt;/listbox&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm2}" height="100px" onAfterRender='rodGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="rodGridCount"/&gt;
-			&lt;tree id="lb" model="${stm2}" height="100px" onAfterRender="self.setSelectedItem(self.getTreechildren().getFirstChild().getTreechildren().getLastChild())"/&gt;
-			&lt;button label="sel" onClick="lb.setSelectedItem(lb.getTreechildren().getFirstChild().getTreechildren().getLastChild())"&gt;&lt;/button&gt;
-		&lt;/div&gt;
-		&lt;div width="250px"&gt;
-			&lt;label value="paging"/&gt;
-			&lt;separator/&gt;
-			&lt;listbox model="${lm2}" mold="paging" pageSize="5" onAfterRender="self.setSelectedIndex(49)"/&gt;
-			&lt;separator/&gt;
-			&lt;grid model="${lm2}" mold="paging" pageSize="5" onAfterRender='pagingGridCount.setValue("row count: "+self.getRows().getChildren().size()+"");'/&gt;
-			&lt;label id="pagingGridCount"/&gt;
-			&lt;tree model="${stm2}" mold="paging" pageSize="5" onAfterRender="self.setSelectedItem(self.getTreechildren().getFirstChild().getTreechildren().getLastChild())"/&gt;
-		&lt;/div&gt;
-	&lt;/hbox&gt;
-&lt;/zk&gt;
\ No newline at end of file


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    





<table width="100%" border="0">
    <tr bgcolor="#eeeeee">
        <td width="50%">
                    &nbsp;
                </td>
        <td>&nbsp;</td>
        <td align="right" width="50%">
                                <a href="forum.php?forum_name=zk1-subversion-log&amp;max_rows=25&amp;offset=13&amp;style=nested&amp;viewmonth=201009">
                        <strong>Next Messages</strong></a><a href="forum.php?max_rows=25&style=nested&offset=13&forum_name=zk1-subversion-log"><img src="http://a.fsdn.com/sf/images/images/t.gif" alt="" width="15" height="15" /></a>
                </td>
    </tr>
</table>

</form>

            </div>
        </div>
      </div>
    
    <footer id="site-footer">
        <div class="wrapper">
            <nav>
                <h5>SourceForge</h5>
                <a href="/about">About</a>
                <a href="/blog/category/sitestatus/">Site Status</a>
                <a href="http://twitter.com/sfnet_ops">@sfnet_ops</a>
            </nav>
            <nav>
                <h5>Find and Develop Software</h5>
                <a href="/create/">Create a Project</a>
                <a href="/directory/">Software Directory</a>
                <a href="/top">Top Downloaded Projects</a>
            </nav>
            <nav>
                <h5>Community</h5>
                <a href="/blog/">Blog</a>
                <a href="http://twitter.com/sourceforge">@sourceforge</a>
                <a href="/jobs?source=footer">Job Board</a>
                <a href="http://library.slashdotmedia.com/?source=sfnet_footer">Resources</a>
            </nav>
            <nav>
                <h5>Help</h5>
                <a href="http://p.sf.net/sourceforge/docs">Site Documentation</a>
                <a href="/support">Support Request</a>
                <a href="http://p.sf.net/sourceforge/irc">Real-Time Support</a>
            </nav>
        </div>
    </footer>
    <footer id="site-copyright-footer">
        <div class="wrapper">
            <div id="copyright">
                Copyright &copy; 2014 SourceForge. All Rights Reserved.<br />
                SourceForge is a <a href="http://www.diceholdingsinc.com/phoenix.zhtml?c=211152&amp;p=irol-landing">Dice Holdings, Inc.</a> company.
            </div>
            <nav>
                <a href="http://slashdotmedia.com/terms-of-use">Terms</a>
                <a href="http://slashdotmedia.com/privacy-statement/">Privacy</a>
                <span id="teconsent"></span>
                <a href="http://slashdotmedia.com/opt-out-choices">Opt Out Choices</a>
                <a href="http://slashdotmedia.com">Advertise</a>
                <a href="http://sourceforge.jp/">SourceForge.JP</a>
            </nav>
        </div>
    </footer>
        <!--[if lt IE 7 ]>
    <script type="text/javascript" src="http://static.sourceforge.net/include/js/sftheme/dd_belatedpng.js"></script>
    <script> DD_belatedPNG.fix('img, .png_bg'); //fix any <img> or .png_bg background-images </script>
    <![endif]-->
<!--[if IE]></div><![endif]-->
<!--[if IE 6]></div><![endif]-->
<!--[if IE 7]></div><![endif]-->

    
    <!-- Begin comScore Tag -->
    <script>
        document.write(unescape("%3Cscript src='" + (document.location.protocol == "https:" ? "https://sb" : "http://b") + ".scorecardresearch.com/beacon.js' %3E%3C/script%3E"));
    </script>
    <script>
        COMSCORE.beacon({
            c1:2,
            c2:6035546,
            c3:"",
            c4:"",
            c5:"",
            c6:"",
            c15:""
        });
    </script>
    <noscript>
        <img src="http://b.scorecardresearch.com/p?c1=2&amp;c2=6035546&amp;c3=&amp;c4=&amp;c5=&amp;c6=&amp;c15=&amp;cj=1" />
    </noscript>
    <!-- End comScore Tag -->
    




        </div>
        <script type="text/javascript" src='//consent-st.truste.com/get?name=notice.js&domain=slashdot.org&c=teconsent&text=true'></script>
    </body>
</html>
