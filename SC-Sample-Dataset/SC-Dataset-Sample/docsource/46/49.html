<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>netty3.2.3æº?ç ?åˆ†æž?--ServerBootstrapå?¯åŠ¨åˆ†æž?</title>
		<meta name="keywords" content="Java" />
        <meta name="description" content="null" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" type="text/css" href="/css/base.css">
        <link rel="stylesheet" type="text/css" href="/css/common.css">
        <script src="/js/jquery.min.js" type="text/javascript"></script>
        <script src="/js/common.js" type="text/javascript"></script>
        <!--[if IE 6]>
        <script src="/js/DD_belatedPNG_0.0.8a-min.js" type="text/javascript"></script>
        <![endif]--><link rel="stylesheet" type="text/css" href="/css/content.css">
		<link rel="stylesheet" type="text/css" href="/admin/js/kindeditor/plugins/code/prettify.css">
		<script src="/js/message.js" type="text/javascript"></script>
		<script src="/js/lazyload.js" type="text/javascript"></script>
		<script src="/admin/js/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
		<script>$(function(){prettyPrint();$("pre").css("white-space","pre-wrap");});</script>
		<style type="text/css">
			.top-div,.nav-div,.main-div{
			  width:1001px;
			}
			.main-div{
			  font-size:14px;
			}
			.main-div .left-div{
			 width:686px;
			 overflow:hidden;
			}
			.main-div .right-div{
			 width:302px;
			 overflow:hidden;
			}
			.tag-div .tag2 .content2 ul li {
			 width:280px;
			 background: url("../images/dot1.gif") no-repeat 0px 11px;
			 height: 26px;
			 line-height:26px;
			}
			.tag-div .tag2 .content2 ul li a{
			  color:#4CB7EA;
			  font-family: "å¾®è½¯é›…é»‘";
			  font-weight: bolder;
			}
			.tag-div .tag2 .content2 ul li a:hover{
			  color: #646464;
			}
			.tag-div .tag2 .content3 .list .right {
			width: 221px;
			}
		</style>
	</head>
	<body>
	<!--é¡¶éƒ¨-->
		<div class="w100p">
			<div class="top-div center">
				<div class="logo-div">
					<a href="/"><img src="/images/logo.gif" alt="Logo" width="244" height="74"/></a>
				</div>
				<div class="search-div">
					<div class="left">
						<input id="searchInput" class="input" type="text" value="è¯·è¾“å…¥æ?œç´¢æ?¡ä»¶â€¦" />
					</div>
					<div class="right">
						<a id="searchButton" href="#" target="_blank">æ?œ&nbsp;ç´¢</a>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<a id="advancedSearchButton" href="#" target="_blank">é«˜çº§æ?œç´¢</a>
					</div>
					<div class="cl">
					</div>
				</div>
				<div class="hot-search-div">
				  çƒ­é—¨æ?œç´¢ï¼š <a href="/search/?kw=JQuery%20%E6%8F%92%E4%BB%B6">JQuery æ?’ä»¶</a>&nbsp;
				           <a href="/search/?kw=Struts">Struts</a>&nbsp;
				           <a href="/search/?kw=Spring">Spring</a>&nbsp;
				           <a href="/search/?kw=Hibernate">Hibernate</a>&nbsp;
				           <a href="/search/?kw=%E6%95%B0%E6%8D%AE%E5%BA%93">æ•°æ?®åº“</a>&nbsp;
				           <a href="/search/?kw=Linux">Linux</a>&nbsp;
				           <a href="/search/?kw=Android">Android</a>&nbsp;
				           <a href="/search/?kw=Iphone">Iphone</a>&nbsp;
				           <a href="/search/?kw=%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">è®¾è®¡æ¨¡å¼?</a>&nbsp;
				</div>
				<div class="reg-login">
					<a target="_blank" href="http://www.niwozhi.net">ä½ æˆ‘çŸ¥</a>&nbsp;
					<a target="_blank" href="/library.html">ä¹¦ç±?ä¸‹è½½</a>&nbsp;
					<a target="_blank" href="/search/?kw=%E9%9D%A2%E8%AF%95%E9%A2%98">é?¢è¯•é¢˜åº“</a>&nbsp;
					<a target="_blank" href="/map.html">ç½‘ç«™åœ°å›¾</a>
				</div>
			</div>
		</div>
		<!--é¡¶éƒ¨ç»“æ?Ÿ-->
		<!--å¯¼èˆª-->
		<div class="w100p">
			<div class="nav-div" style="padding-bottom:5px;">
				<ul id="navUl">
				    <li><a href="/">é¦–é¡µ</a></li>
					<li><a href="/one_c52.html">ç¼–ç¨‹è¯­è¨€</a></li>
					<li><a href="/one_c53.html">Webå¼€å?‘</a></li>
					<li><a href="/one_c54.html">å‰?ç«¯æŠ€æœ¯</a></li>
					<li><a href="/one_c55.html">ç§»åŠ¨å¼€å?‘</a></li>
					<li><a href="/one_c56.html">æ•°æ?®åº“</a></li>
					<li><a href="/one_c57.html">æ“?ä½œç³»ç»Ÿ</a></li>
					<li><a href="/one_c58.html">åµŒå…¥å¼€å?‘</a></li>
					<li class="active"><a href="/one_c59.html">ç½‘ç»œå®‰å…¨</a></li>
					<li><a href="/one_c60.html">åŠžå…¬è½¯ä»¶</a></li>
					</ul>
				<div class="cl"></div>
				<div class="nav-more-div">
					<a href="/map.html">å…¨éƒ¨åˆ—è¡¨&gt;&gt;</a>
				</div>
			</div>
		</div>
		<!--å¯¼èˆªç»“æ?Ÿ-->
<!--ä¸»æž¶æž„-->
		<div class="w100p">
			 <div class="content-title rel" style="width:1001px;margin:0 auto;">
				<h1>netty3.2.3æº?ç ?åˆ†æž?--ServerBootstrapå?¯åŠ¨åˆ†æž?</h1>
			 </div>
		</div>
		<div class="w100p">
			<div class="main-div">
				<!--å·¦æž¶æž„-->
				<div class="left-div">
					<script src="/js/ads/demo/demo_top_double.js" type="text/javascript"></script>
					<div class="content-info rel">
						<span class="kind">åˆ†ç±»ï¼š</span>
						<a href="/one_c59.html">ç½‘ç»œå®‰å…¨</a><span class="kind">/</span>
						<a href="/two_c447.html">æ¼?æ´žåˆ†æž?</a><span class="kind">/</span>
						<a href="/two_c447.html">æ–‡ç« </a>
						</div>
					<div class="content-content" id="verydemo_content_div">
					<link href="/js/syntaxhighlighter/SyntaxHighlighter.css" rel="stylesheet" type="text/css" />
<div id="article_content" class="article_content">

<p><span >è½¬è½½åœ°å?€:http://www.blogjava.net/alex-zheng/articles/339552.html<br>
</span></p>
<p><span >è¿™é‡Œé¦–å…ˆ<strong><strong>åˆ†æž?</strong></strong>ä¸‹ServerBootstrapçš„<strong>å?¯åŠ¨</strong>è¿‡ç¨‹ï¼Œåœ¨nettyä¸­ï¼Œchannelå?¯ä»¥çœ‹æˆ?æ˜¯socketchannelçš„æŠ½è±¡</span></p>
<span >channelpipelineé‡Œå­˜æ”¾ç?€channelhandlerï¼Œchannelpipelineæ ¹æ?®ä¸?å?Œçš„channeleventè§¦å?‘å¯¹åº”çš„æ“?ä½œ<br>
å¦‚channelçš„openï¼Œbindï¼Œconnectç­‰<br>
</span>
<p><span >ä¸‹é?¢ä»¥TelnetServerä¸ºä¾‹æ?¥ä¸€æ­¥æ­¥çœ‹server<strong>å?¯åŠ¨</strong></span></p>
<p></p>
<div ><span ><span >public</span><span >&nbsp;</span><span >static</span><span >&nbsp;</span><span >void</span><span >&nbsp;main(String[]&nbsp;args)&nbsp;</span><span >throws</span><span >&nbsp;Exception&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Configure&nbsp;the&nbsp;server.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;new&nbsp;NioServerSocketChannelFactoryä¸­åˆ?å§‹åŒ–ä¸€ä¸ªNioServerSocketPipelineSinkï¼Œç”¨æ?¥å¤„ç?†downstreamhandler</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerBootstrap&nbsp;bootstrap&nbsp;</span><span >=</span><span >&nbsp;</span><span >new</span><span >&nbsp;ServerBootstrap(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span ><span >&nbsp;</span>NioServerSocketChannelFactory(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Executors.newCachedThreadPool(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Executors.newCachedThreadPool()));<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Set&nbsp;up&nbsp;the&nbsp;event&nbsp;pipeline&nbsp;factory.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bootstrap.setPipelineFactory(</span><span >new</span><span >&nbsp;TelnetServerPipelineFactory());<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Bind&nbsp;and&nbsp;start&nbsp;to&nbsp;accept&nbsp;incoming&nbsp;connections.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bootstrap.bind(</span><span >new</span><span >&nbsp;InetSocketAddress(</span><span >8080</span><span >));<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><br>
<span ></span></div>
<p></p>
<p><span >ç›´æŽ¥çœ‹serverbootstrapçš„bindæ–¹æ³•</span></p>
<p></p>
<div ><span><span >public</span><span >&nbsp;Channel&nbsp;bind(</span><span >final</span><span >&nbsp;SocketAddress&nbsp;localAddress)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(localAddress&nbsp;</span><span >==</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >throw</span><span >&nbsp;</span><span >new</span><span >&nbsp;NullPointerException(</span><span >&quot;</span><span >localAddress</span><span >&quot;</span><span >);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >è¯¥é˜Ÿåˆ—ä¸­å?ªæ”¾äº†ä¸€ä¸ªBinder</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >final</span><span >&nbsp;BlockingQueue</span><span >&lt;</span><span >ChannelFuture</span><span >&gt;</span><span >&nbsp;futureQueue&nbsp;</span><span >=</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;LinkedBlockingQueue</span><span >&lt;</span><span >ChannelFuture</span><span >&gt;</span><span >();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >Binder&nbsp;extends&nbsp;SimpleChannelUpstreamHandlerï¼Œå¤„ç?†channelOpen</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelHandler&nbsp;binder&nbsp;</span><span >=</span><span >&nbsp;</span><span >new</span><span >&nbsp;Binder(localAddress,&nbsp;futureQueue);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&nbsp;</span></span><span >//</span><span >è¿™é‡Œparenthandlerä¸ºnull</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelHandler&nbsp;parentHandler&nbsp;</span><span >=</span><span >&nbsp;getParentHandler();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åˆ?å§‹åŒ–DefaultChannelPipeline<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åœ¨ç»‘å®šç«¯å?£å‰?çš„pipelineé‡Œå?ªæœ‰ä¸€ä¸ªbinderçš„upstreamhandler</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelPipeline&nbsp;bossPipeline&nbsp;</span><span >=</span><span >&nbsp;pipeline();&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >è¿™é‡Œè°ƒç”¨DefaultChannelPipelineçš„addlastæ–¹æ³•ï¼Œåˆ?å§‹åŒ–ä¸€ä¸ªDefaultChannelHandlerContextï¼Œ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >handlercontexté‡Œé?¢æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æž„<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&nbsp;</span></span><span >//</span><span >è¯¥contextä¸­å?ªæœ‰ä¸€ä¸ªbinder&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bossPipeline.addLast(</span><span >&quot;</span><span >binder</span><span >&quot;</span><span >,&nbsp;binder);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(parentHandler&nbsp;</span><span >!=</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bossPipeline.addLast(</span><span >&quot;</span><span >userHandler</span><span >&quot;</span><span >,&nbsp;parentHandler);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >ä¸€åˆ‡ä»Žè¿™é‡Œå¼€å§‹,getFactory()==NioServerSocketChannelFactory</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Channel&nbsp;channel&nbsp;</span><span >=</span><span >&nbsp;getFactory().newChannel(bossPipeline);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" ><br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><br>
<span ></span></div>
<p><span >NioServerSocketChannelFactory.newChannel(ChannelPipeline pipeline)å¦‚ä¸‹</span></p>
<div >
<p><span ><span >&nbsp;</span><span >public</span> ServerSocketChannel newChannel(ChannelPipeline pipeline) {<span >//</span><span >åˆ?å§‹åŒ–ä¸€ä¸ªNioServerSocketChannel,pipelineä¸­æ”¾çš„æ˜¯binderï¼Œsinkæ˜¯NioServerSocketPipelineSink</span><span ><br>
</span></span></p>
<span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >return</span><span >&nbsp;</span><span >new</span><span >&nbsp;NioServerSocketChannel(</span><span >this</span><span >,&nbsp;pipeline,&nbsp;sink);<br>
&nbsp;}</span><br>
</div>
<p><span >æ?¥çœ‹NioServerSocketChannelçš„æž„é€ å‡½æ•°ä¸­æˆ‘ä»¬çœ‹åˆ°è¿™ä¹ˆä¸€å?¥fireChannelOpen(this);å¼•ç”¨è‡ªChannles</span></p>
<p></p>
<div ><span ><span >public</span><span >&nbsp;</span><span >static</span><span >&nbsp;</span><span >void</span><span >//</span><span >&nbsp;Notify&nbsp;the&nbsp;parent&nbsp;handler.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(channel.getParent()&nbsp;</span><span >!=</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fireChildChannelStateChanged(channel.getParent(),&nbsp;channel);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >è¿™é‡Œè°ƒç”¨DefaultChannelPipelineçš„sendUpstreamæ–¹æ³•</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.getPipeline().sendUpstream(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;UpstreamChannelStateEvent(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel,&nbsp;ChannelState.OPEN,&nbsp;Boolean.TRUE));<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><br>
</div>
<p></p>
<p><span >DefaultChannelPipeline.sendUpstream(ChannelEvent e)</span><span ><span ><br>
</span></span></p>
<div ><span ><span >public</span><span >&nbsp;</span><span >void</span><span >&nbsp;sendUpstream(ChannelEvent&nbsp;e)&nbsp;{<br>
</span></span><span ><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
<span ><span ><span >//</span><span >this.head==binder</span></span></span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultChannelHandlerContext&nbsp;head&nbsp;</span><span >=</span><span >&nbsp;getActualUpstreamContext(</span><span >this</span><span >.head);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(head&nbsp;</span><span >==</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.warn(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >&quot;</span><span >The&nbsp;pipeline&nbsp;contains&nbsp;no&nbsp;upstream&nbsp;handlers;&nbsp;discarding:&nbsp;</span><span >&quot;</span><span >&nbsp;</span><span >&#43;</span><span >&nbsp;e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >return</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendUpstream(head,&nbsp;e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></div>
<p><span >æ‰§è¡Œ</span></p>
<p><span ></span></p>
<div ><span >void</span><span >&nbsp;sendUpstream(DefaultChannelHandlerContext&nbsp;ctx,&nbsp;ChannelEvent&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >ctx.getHandler()==binder--&gt;SimpleChannelUpstreamHandler</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((ChannelUpstreamHandler)&nbsp;ctx.getHandler()).handleUpstream(ctx,&nbsp;e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >catch</span><span >&nbsp;(Throwable&nbsp;t)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notifyHandlerException(e,&nbsp;t);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
è¿™é‡Œä¼šåœ¨SimpleChannelUpstreamHandler.handleUpstream(ctx, e);ä¸­è°ƒç”¨binderçš„channelOpen<br>
<div ><span >public</span><span >&nbsp;</span><span >void</span><span >&nbsp;channelOpen(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelHandlerContext&nbsp;ctx,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelStateEvent&nbsp;evt)&nbsp;{<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >è®¾ç½®NioServerSocketChannelçš„DefaultServerSocketChannelConfigçš„pipelinetfactory<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åœ¨ä¹‹å?Žçš„çº¿ç¨‹åˆ†å?‘ä¸­ä¼šåŽ»å?–è¯¥factoryçš„pipelineï¼Œå?³TelnetServerPipelineFactoryä¸­çš„pipeline</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;evt.getChannel().getConfig().setPipelineFactory(getPipelineFactory());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >finally</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.sendUpstream(evt);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >æ‰§è¡ŒNioServerSocketChannel.bindï¼Œæœ€ç»ˆä¼šè°ƒç”¨Channels.bind(Channel&nbsp;channel,&nbsp;SocketAddress&nbsp;localAddress)</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >boolean</span><span >&nbsp;finished&nbsp;</span><span >=</span><span >&nbsp;futureQueue.offer(evt.getChannel().bind(localAddress));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >assert</span><span >&nbsp;finished;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
Channels.bindæ–¹æ³•å¦‚ä¸‹ï¼š<br>
&nbsp;<span>&nbsp;</span><br>
<div ><span >public</span><span >&nbsp;</span><span >static</span><span >&nbsp;ChannelFuture&nbsp;bind(Channel&nbsp;channel,&nbsp;SocketAddress&nbsp;localAddress)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(localAddress&nbsp;</span><span >==</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >throw</span><span >&nbsp;</span><span >new</span><span >&nbsp;NullPointerException(</span><span >&quot;</span><span >localAddress</span><span >&quot;</span><span >);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelFuture&nbsp;future&nbsp;</span><span >=</span><span >&nbsp;future(channel);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >å?ˆè°ƒç”¨äº†DefaultChannelPipelineçš„senddownstreamï¼Œå¯¹åº”äº‹ä»¶æ˜¯bound</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.getPipeline().sendDownstream(</span><span >new</span><span >&nbsp;DownstreamChannelStateEvent(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel,&nbsp;future,&nbsp;ChannelState.BOUND,&nbsp;localAddress));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >return</span><span >&nbsp;future;<br>
}</span></div>
DefaultChannelPipelineçš„senddownstream<br>
&nbsp;<br>
<div ><span >public</span><span >&nbsp;</span><span >void</span><span >&nbsp;sendDownstream(ChannelEvent&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultChannelHandlerContext&nbsp;tail&nbsp;</span><span >=</span><span >&nbsp;getActualDownstreamContext(</span><span >this</span><span >.tail);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(tail&nbsp;</span><span >==</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getSink().eventSunk(</span><span >this</span><span >,&nbsp;e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >return</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >catch</span><span >&nbsp;(Throwable&nbsp;t)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notifyHandlerException(e,&nbsp;t);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >return</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendDownstream(tail,&nbsp;e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
ä»ŽgetActualDownstreamContextè¿”å›žçš„æ˜¯nullï¼Œæ‰€ä»¥ä¸Šé?¢ä¼šæ‰§è¡Œ getSink().eventSunk(this, e);<br>
<div ><span >DefaultChannelHandlerContext&nbsp;getActualDownstreamContext(DefaultChannelHandlerContext&nbsp;ctx)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(ctx&nbsp;</span><span >==</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >return</span><span >&nbsp;</span><span >null</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultChannelHandlerContext&nbsp;realCtx&nbsp;</span><span >=</span><span >&nbsp;ctx;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >Binderæ˜¯upstreamï¼Œè¿™é‡Œè¿”å›žnull</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >while</span><span >&nbsp;(</span><span >!</span><span >realCtx.canHandleDownstream())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;realCtx&nbsp;</span><span >=</span><span >&nbsp;realCtx.prev;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(realCtx&nbsp;</span><span >==</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >return</span><span >&nbsp;</span><span >null</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >return</span><span >&nbsp;realCtx;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
sendDownstreamå°†æ‰§è¡Œ getSink().eventSunk(this, e);<br>
getSink()èŽ·å¾—çš„æ˜¯NioServerSocketPipelineSinkï¼Œ<br>
<div ><span >public</span><span >&nbsp;</span><span >void</span><span >&nbsp;eventSunk(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelPipeline&nbsp;pipeline,&nbsp;ChannelEvent&nbsp;e)&nbsp;</span><span >throws</span><span >&nbsp;Exception&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Channel&nbsp;channel&nbsp;</span><span >=</span><span >&nbsp;e.getChannel();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(channel&nbsp;</span><span >instanceof</span><span >&nbsp;NioServerSocketChannel)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handleServerSocket(e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >else</span><span >&nbsp;</span><span >if</span><span >&nbsp;(channel&nbsp;</span><span >instanceof</span><span >&nbsp;NioSocketChannel)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handleAcceptedSocket(e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;</span><span >private</span><span >&nbsp;</span><span >void</span><span >&nbsp;handleServerSocket(ChannelEvent&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(</span><span >!</span><span >(e&nbsp;</span><span >instanceof</span><span >&nbsp;ChannelStateEvent))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >return</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelStateEvent&nbsp;event&nbsp;</span><span >=</span><span >&nbsp;(ChannelStateEvent)&nbsp;e;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NioServerSocketChannel&nbsp;channel&nbsp;</span><span >=</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(NioServerSocketChannel)&nbsp;event.getChannel();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelFuture&nbsp;future&nbsp;</span><span >=</span><span >&nbsp;event.getFuture();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelState&nbsp;state&nbsp;</span><span >=</span><span >&nbsp;event.getState();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;value&nbsp;</span><span >=</span><span >&nbsp;event.getValue();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >æ ¹æ?®new&nbsp;DownstreamChannelStateEvent(channel,&nbsp;future,&nbsp;ChannelState.BOUND,&nbsp;localAddress)</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >switch</span><span >&nbsp;(state)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >case</span><span >&nbsp;OPEN:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(Boolean.FALSE.equals(value))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(channel,&nbsp;future);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >break</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >case</span><span >&nbsp;BOUND:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(value&nbsp;</span><span >!=</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åœ¨è¿™é‡Œå®Œæˆ?socketAddressç»‘å®š</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bind(channel,&nbsp;future,&nbsp;(SocketAddress)&nbsp;value);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >else</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(channel,&nbsp;future);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >break</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
<br>
å¯¹åº”çš„NioServerSocketPipelineSink.bindæ–¹æ³•<br>
<div ><span >private</span><span >&nbsp;</span><span >void</span><span >&nbsp;bind(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NioServerSocketChannel&nbsp;channel,&nbsp;ChannelFuture&nbsp;future,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SocketAddress&nbsp;localAddress)&nbsp;{<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >boolean</span><span >&nbsp;bound&nbsp;</span><span >=</span><span >&nbsp;</span><span >false</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >boolean</span><span >&nbsp;bossStarted&nbsp;</span><span >=</span><span >&nbsp;</span><span >false</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.socket.socket().bind(localAddress,&nbsp;channel.getConfig().getBacklog());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bound&nbsp;</span><span >=</span><span >&nbsp;</span><span >true</span><span >;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future.setSuccess();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >è§¦å?‘channelbound</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fireChannelBound(channel,&nbsp;channel.getLocalAddress());<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Executor&nbsp;bossExecutor&nbsp;</span><span >=</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((NioServerSocketChannelFactory)&nbsp;channel.getFactory()).bossExecutor;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bossExecutor.execute(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;IoWorkerRunnable(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;ThreadRenamingRunnable(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;Boss(channel),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >&quot;</span><span >New&nbsp;I/O&nbsp;server&nbsp;boss&nbsp;#</span><span >&quot;</span><span >&nbsp;</span><span >&#43;</span><span >&nbsp;id&nbsp;</span><span >&#43;</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >&quot;</span><span >&nbsp;(</span><span >&quot;</span><span >&nbsp;</span><span >&#43;</span><span >&nbsp;channel&nbsp;</span><span >&#43;</span><span >&nbsp;</span><span >'</span><span >)</span><span >'</span><span >)));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bossStarted&nbsp;</span><span >=</span><span >&nbsp;</span><span >true</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >catch</span><span >&nbsp;(Throwable&nbsp;t)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future.setFailure(t);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fireExceptionCaught(channel,&nbsp;t);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >finally</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(</span><span >!</span><span >bossStarted&nbsp;</span><span >&amp;&amp;</span><span >&nbsp;bound)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(channel,&nbsp;future);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
å…ˆæ?¥çœ‹Channels.fireChannelBoundæ–¹æ³•å?šäº†ä»€ä¹ˆ<br>
&nbsp;<span>&nbsp;</span><br>
<div ><span >public</span><span >&nbsp;</span><span >static</span><span >&nbsp;</span><span >void</span><span >&nbsp;fireChannelBound(Channel&nbsp;channel,&nbsp;SocketAddress&nbsp;localAddress)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >channel.getPipeline()çš„DefaultChannelPipelineä¸­å?ªæœ‰ä¸€ä¸ªbinder<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >è¿™é‡Œè°ƒç”¨SimpleChannelUpstreamHandlerçš„handleUpstreamä¸­çš„hannelBound(ctx,&nbsp;evt);</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.getPipeline().sendUpstream(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;UpstreamChannelStateEvent(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel,&nbsp;ChannelState.BOUND,&nbsp;localAddress));<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
<br>
æŽ¥ç?€çœ‹bindæ–¹æ³•<br>
<div ><span >Executor&nbsp;bossExecutor&nbsp;</span><span >=</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((NioServerSocketChannelFactory)&nbsp;channel.getFactory()).bossExecutor;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åœ¨bossexcutorä¸­åˆ›å»ºä¸€ä¸ªbossçº¿ç¨‹<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åœ¨è¯¥bossçº¿ç¨‹ä¸­åˆ†æ´¾æ–°çš„å®¢æˆ·ç«¯è¿žæŽ¥ç»™workerExecutor,workerExecutorçš„æ•°é‡?ä¸ºcpu*2</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bossExecutor.execute(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;IoWorkerRunnable(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;ThreadRenamingRunnable(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;Boss(channel),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >&quot;</span><span >New&nbsp;I/O&nbsp;server&nbsp;boss&nbsp;#</span><span >&quot;</span><span >&nbsp;</span><span >&#43;</span><span >&nbsp;id&nbsp;</span><span >&#43;</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >&quot;</span><span >&nbsp;(</span><span >&quot;</span><span >&nbsp;</span><span >&#43;</span><span >&nbsp;channel&nbsp;</span><span >&#43;</span><span >&nbsp;</span><span >'</span><span >)</span><span >'</span><span >)));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&nbsp;</span><br>
</span></div>
åœ¨new Bossçš„æ—¶å€™ï¼Œæ³¨å†Œchannelçš„acceptäº‹ä»¶<br>
<div ><span >Boss(NioServerSocketChannel&nbsp;channel)&nbsp;</span><span >throws</span><span >&nbsp;IOException&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >this</span><span >.channel&nbsp;</span><span >=</span><span >&nbsp;channel;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;</span><span >=</span><span >&nbsp;Selector.open();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >boolean</span><span >&nbsp;registered&nbsp;</span><span >=</span><span >&nbsp;</span><span >false</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.socket.register(selector,&nbsp;SelectionKey.OP_ACCEPT);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registered&nbsp;</span><span >=</span><span >&nbsp;</span><span >true</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >finally</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(</span><span >!</span><span >registered)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closeSelector();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.selector&nbsp;</span><span >=</span><span >&nbsp;selector;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
<br>
æœ€ç»ˆè°ƒç”¨Boss.run()<br>
<br>
<div ><span >public</span><span >&nbsp;</span><span >void</span><span >&nbsp;run()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >èŽ·å¾—å½“å‰?bossçº¿ç¨‹ï¼Œmainreactor</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >final</span><span >&nbsp;Thread&nbsp;currentThread&nbsp;</span><span >=</span><span >&nbsp;Thread.currentThread();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.shutdownLock.lock();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >for</span><span >&nbsp;(;;)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(selector.select(</span><span >1000</span><span >)&nbsp;</span><span >&gt;</span><span >&nbsp;</span><span >0</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector.selectedKeys().clear();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >æŽ¥æ”¶æ–°çš„å®¢æˆ·ç«¯è¿žæŽ¥</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SocketChannel&nbsp;acceptedSocket&nbsp;</span><span >=</span><span >&nbsp;channel.socket.accept();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(acceptedSocket&nbsp;</span><span >!=</span><span >&nbsp;</span><span >null</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åˆ†æ´¾å½“å‰?è¿žæŽ¥ç»™workerexcutorï¼Œå?³subreactor</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registerAcceptedChannel(acceptedSocket,&nbsp;currentThread);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >finally</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.shutdownLock.unlock();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closeSelector();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
<br>
<div ><span >private</span><span >&nbsp;</span><span >void</span><span >&nbsp;registerAcceptedChannel(SocketChannel&nbsp;acceptedSocket,&nbsp;Thread&nbsp;currentThread)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >è¿™é‡ŒèŽ·å¾—ç”¨æˆ·çš„piplelineï¼Œé‚£ä¹ˆè¿™ä¸ªæ˜¯åœ¨å“ªé‡Œè®¾ç½®çš„å‘¢ï¼Œåœ¨Binderçš„channelopenæ–¹æ³•çš„ç¬¬ä¸€å?¥<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;evt.getChannel().getConfig().setPipelineFactory(getPipelineFactory());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åœ¨è¿™ä¹‹å‰?çš„pipelineéƒ½æ˜¯defalutchannelpipelineï¼Œé‡Œé?¢å?ªæœ‰ä¸€ä¸ªBinder<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åœ¨è¿™ä¹‹å?Žï¼Œæ¯?ä¸€ä¸ªNioAcceptedSocketChannelçš„pipelineèŽ·å¾—çš„æ˜¯TelnetServerPipelineFactoryä¸­çš„pipeline</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelPipeline&nbsp;pipeline&nbsp;</span><span >=</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.getConfig().getPipelineFactory().getPipeline();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >nioworkerå……å½“subreactor</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NioWorker&nbsp;worker&nbsp;</span><span >=</span><span >&nbsp;nextWorker();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;worker.register(</span><span >new</span><span >&nbsp;NioAcceptedSocketChannel(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.getFactory(),&nbsp;pipeline,&nbsp;channel,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NioServerSocketPipelineSink.</span><span >this</span><span >,&nbsp;acceptedSocket,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;worker,&nbsp;currentThread),&nbsp;</span><span >null</span><span >);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
<br>
è¿™é‡Œè°ƒç”¨NioWorker.register<br>
<div ><span >void</span><span >&nbsp;register(NioSocketChannel&nbsp;channel,&nbsp;ChannelFuture&nbsp;future)&nbsp;{<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >boolean</span><span >&nbsp;server&nbsp;</span><span >=</span><span >&nbsp;</span><span >!</span><span >(channel&nbsp;</span><span >instanceof</span><span >&nbsp;NioClientSocketChannel);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åˆ?å§‹åŒ–æ–°çš„taskï¼Œå°†å½“å‰?acceptçš„socketchannelç»‘å®šåˆ°nioworkerçš„selecortkeyçš„attch</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Runnable&nbsp;registerTask&nbsp;</span><span >=</span><span >&nbsp;</span><span >new</span><span >&nbsp;RegisterTask(channel,&nbsp;future,&nbsp;server);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Selector&nbsp;selector;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >synchronized</span><span >&nbsp;(startStopLock)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(</span><span >!</span><span >started)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Open&nbsp;a&nbsp;selector&nbsp;if&nbsp;this&nbsp;worker&nbsp;didn't&nbsp;start&nbsp;yet.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >this</span><span >.selector&nbsp;</span><span >=</span><span >&nbsp;selector&nbsp;</span><span >=</span><span >&nbsp;Selector.open();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >catch</span><span >&nbsp;(Throwable&nbsp;t)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >throw</span><span >&nbsp;</span><span >new</span><span >&nbsp;ChannelException(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >&quot;</span><span >Failed&nbsp;to&nbsp;create&nbsp;a&nbsp;selector.</span><span >&quot;</span><span >,&nbsp;t);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Start&nbsp;the&nbsp;worker&nbsp;thread&nbsp;with&nbsp;the&nbsp;new&nbsp;Selector.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;threadName&nbsp;</span><span >=</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(server&nbsp;</span><span >?</span><span >&nbsp;</span><span >&quot;</span><span >New&nbsp;I/O&nbsp;server&nbsp;worker&nbsp;#</span><span >&quot;</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;</span><span >&quot;</span><span >New&nbsp;I/O&nbsp;client&nbsp;worker&nbsp;#</span><span >&quot;</span><span >)&nbsp;</span><span >&#43;</span><span >&nbsp;bossId&nbsp;</span><span >&#43;</span><span >&nbsp;</span><span >'</span><span >-</span><span >'</span><span >&nbsp;</span><span >&#43;</span><span >&nbsp;id;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >boolean</span><span >&nbsp;success&nbsp;</span><span >=</span><span >&nbsp;</span><span >false</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span ><strong>å?¯åŠ¨</strong>ä¸€ä¸ªçº¿ç¨‹æ?¥å¤„ç?†è¯¥è¿žæŽ¥</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executor.execute(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;IoWorkerRunnable(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >new</span><span >&nbsp;ThreadRenamingRunnable(</span><span >this</span><span >,&nbsp;threadName)));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success&nbsp;</span><span >=</span><span >&nbsp;</span><span >true</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >finally</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(</span><span >!</span><span >success)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Release&nbsp;the&nbsp;Selector&nbsp;if&nbsp;the&nbsp;execution&nbsp;fails.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector.close();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >catch</span><span >&nbsp;(Throwable&nbsp;t)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.warn(</span><span >&quot;</span><span >Failed&nbsp;to&nbsp;close&nbsp;a&nbsp;selector.</span><span >&quot;</span><span >,&nbsp;t);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >this</span><span >.selector&nbsp;</span><span >=</span><span >&nbsp;selector&nbsp;</span><span >=</span><span >&nbsp;</span><span >null</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;The&nbsp;method&nbsp;will&nbsp;return&nbsp;to&nbsp;the&nbsp;caller&nbsp;at&nbsp;this&nbsp;point.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >else</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Use&nbsp;the&nbsp;existing&nbsp;selector&nbsp;if&nbsp;this&nbsp;worker&nbsp;has&nbsp;been&nbsp;started.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;</span><span >=</span><span >&nbsp;</span><span >this</span><span >.selector;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >assert</span><span >&nbsp;selector&nbsp;</span><span >!=</span><span >&nbsp;</span><span >null</span><span >&nbsp;</span><span >&amp;&amp;</span><span >&nbsp;selector.isOpen();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;started&nbsp;</span><span >=</span><span >&nbsp;</span><span >true</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >åŠ å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >boolean</span><span >&nbsp;offered&nbsp;</span><span >=</span><span >&nbsp;registerTaskQueue.offer(registerTask);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >assert</span><span >&nbsp;offered;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(wakenUp.compareAndSet(</span><span >false</span><span >,&nbsp;</span><span >true</span><span >))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector.wakeup();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
æ?¥çœ‹registertaskçš„runæ–¹æ³•<br>
<div >public void run() {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SocketAddress localAddress = channel.getLocalAddress();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SocketAddress remoteAddress = channel.getRemoteAddress();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (localAddress == null || remoteAddress == null) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (future != null) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; future.setFailure(new ClosedChannelException());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; close(channel, succeededFuture(channel));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (server) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; channel.socket.configureBlocking(false);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; synchronized (channel.interestOpsLock) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //è¿™é‡Œæ³¨å†Œå½“å‰?acceptedçš„socketchannelçš„readäº‹ä»¶<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; channel.socket.register(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; selector, channel.getRawInterestOps(), channel);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (future != null) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; channel.setConnected();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; future.setSuccess();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (future != null) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; future.setFailure(e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; close(channel, succeededFuture(channel));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!(e instanceof ClosedChannelException)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new ChannelException(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;Failed to register a socket to the selector.&quot;, e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!server) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!((NioClientSocketChannel) channel).boundManually) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fireChannelBound(channel, localAddress);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fireChannelConnected(channel, remoteAddress);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</div>
<br>
å…¶ä¸­executor.execute(new IoWorkerRunnable(new ThreadRenamingRunnable(this, threadName)));<br>
è¿™é‡Œçš„thisæŒ‡å?‘å½“å‰?çš„nioworker,è°ƒç”¨nioworker.run<br>
<div ><span >public</span><span >&nbsp;</span><span >void</span><span >&nbsp;run()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >å½“å‰?nioworker</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;</span><span >=</span><span >&nbsp;Thread.currentThread();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >boolean</span><span >&nbsp;shutdown&nbsp;</span><span >=</span><span >&nbsp;</span><span >false</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Selector&nbsp;selector&nbsp;</span><span >=</span><span >&nbsp;</span><span >this</span><span >.selector;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >for</span><span >&nbsp;(;;)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wakenUp.set(</span><span >false</span><span >);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(CONSTRAINT_LEVEL&nbsp;</span><span >!=</span><span >&nbsp;</span><span >0</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selectorGuard.writeLock().lock();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;This&nbsp;empty&nbsp;synchronization&nbsp;block&nbsp;prevents&nbsp;the&nbsp;selector<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;from&nbsp;acquiring&nbsp;its&nbsp;lock.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selectorGuard.writeLock().unlock();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SelectorUtil.select(selector);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;'wakenUp.compareAndSet(false,&nbsp;true)'&nbsp;is&nbsp;always&nbsp;evaluated<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;before&nbsp;calling&nbsp;'selector.wakeup()'&nbsp;to&nbsp;reduce&nbsp;the&nbsp;wake-up<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;overhead.&nbsp;(Selector.wakeup()&nbsp;is&nbsp;an&nbsp;expensive&nbsp;operation.)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;However,&nbsp;there&nbsp;is&nbsp;a&nbsp;race&nbsp;condition&nbsp;in&nbsp;this&nbsp;approach.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;The&nbsp;race&nbsp;condition&nbsp;is&nbsp;triggered&nbsp;when&nbsp;'wakenUp'&nbsp;is&nbsp;set&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;true&nbsp;too&nbsp;early.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;'wakenUp'&nbsp;is&nbsp;set&nbsp;to&nbsp;true&nbsp;too&nbsp;early&nbsp;if:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;1)&nbsp;Selector&nbsp;is&nbsp;waken&nbsp;up&nbsp;between&nbsp;'wakenUp.set(false)'&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;&nbsp;&nbsp;&nbsp;'selector.select(<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" >)'.&nbsp;(BAD)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;2)&nbsp;Selector&nbsp;is&nbsp;waken&nbsp;up&nbsp;between&nbsp;'selector.select(<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" >)'&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;&nbsp;&nbsp;&nbsp;'if&nbsp;(wakenUp.get())&nbsp;{&nbsp;<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" >&nbsp;}'.&nbsp;(OK)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;'wakenUp'&nbsp;is&nbsp;set&nbsp;to&nbsp;true&nbsp;and&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;following&nbsp;'selector.select(<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" >)'&nbsp;will&nbsp;wake&nbsp;up&nbsp;immediately.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Until&nbsp;'wakenUp'&nbsp;is&nbsp;set&nbsp;to&nbsp;false&nbsp;again&nbsp;in&nbsp;the&nbsp;next&nbsp;round,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;'wakenUp.compareAndSet(false,&nbsp;true)'&nbsp;will&nbsp;fail,&nbsp;and&nbsp;therefore<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;any&nbsp;attempt&nbsp;to&nbsp;wake&nbsp;up&nbsp;the&nbsp;Selector&nbsp;will&nbsp;fail,&nbsp;too,&nbsp;causing<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;the&nbsp;following&nbsp;'selector.select(<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" >)'&nbsp;call&nbsp;to&nbsp;block<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;unnecessarily.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;To&nbsp;fix&nbsp;this&nbsp;problem,&nbsp;we&nbsp;wake&nbsp;up&nbsp;the&nbsp;selector&nbsp;again&nbsp;if&nbsp;wakenUp<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;is&nbsp;true&nbsp;immediately&nbsp;after&nbsp;selector.select(<img src ="/images/loading.gif" original="http://cdn.verydemo.com/inc/test.jsp?url=http%3A%2F%2Fwww.blogjava.net%2FImages%2Fdot.gif" alt="" >).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;It&nbsp;is&nbsp;inefficient&nbsp;in&nbsp;that&nbsp;it&nbsp;wakes&nbsp;up&nbsp;the&nbsp;selector&nbsp;for&nbsp;both<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;the&nbsp;first&nbsp;case&nbsp;(BAD&nbsp;-&nbsp;wake-up&nbsp;required)&nbsp;and&nbsp;the&nbsp;second&nbsp;case<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;(OK&nbsp;-&nbsp;no&nbsp;wake-up&nbsp;required).</span><span ><br>
</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(wakenUp.get())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector.wakeup();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancelledKeys&nbsp;</span><span >=</span><span >&nbsp;</span><span >0</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processRegisterTaskQueue();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processWriteTaskQueue();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processSelectedKeys(selector.selectedKeys());<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Exit&nbsp;the&nbsp;loop&nbsp;when&nbsp;there's&nbsp;nothing&nbsp;to&nbsp;handle.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;The&nbsp;shutdown&nbsp;flag&nbsp;is&nbsp;used&nbsp;to&nbsp;delay&nbsp;the&nbsp;shutdown&nbsp;of&nbsp;this<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;loop&nbsp;to&nbsp;avoid&nbsp;excessive&nbsp;Selector&nbsp;creation&nbsp;when<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;connections&nbsp;are&nbsp;registered&nbsp;in&nbsp;a&nbsp;one-by-one&nbsp;manner&nbsp;instead&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;concurrent&nbsp;manner.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(selector.keys().isEmpty())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(shutdown&nbsp;</span><span >||</span><span ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executor&nbsp;</span><span >instanceof</span><span >&nbsp;ExecutorService&nbsp;</span><span >&amp;&amp;</span><span >&nbsp;((ExecutorService)&nbsp;executor).isShutdown())&nbsp;{<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >synchronized</span><span >&nbsp;(startStopLock)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(registerTaskQueue.isEmpty()&nbsp;</span><span >&amp;&amp;</span><span >&nbsp;selector.keys().isEmpty())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;started&nbsp;</span><span >=</span><span >&nbsp;</span><span >false</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector.close();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >catch</span><span >&nbsp;(IOException&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.warn(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >&quot;</span><span >Failed&nbsp;to&nbsp;close&nbsp;a&nbsp;selector.</span><span >&quot;</span><span >,&nbsp;e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >finally</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >this</span><span >.selector&nbsp;</span><span >=</span><span >&nbsp;</span><span >null</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >break</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >else</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutdown&nbsp;</span><span >=</span><span >&nbsp;</span><span >false</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >else</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Give&nbsp;one&nbsp;more&nbsp;second.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutdown&nbsp;</span><span >=</span><span >&nbsp;</span><span >true</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >else</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutdown&nbsp;</span><span >=</span><span >&nbsp;</span><span >false</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >catch</span><span >&nbsp;(Throwable&nbsp;t)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.warn(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >&quot;</span><span >Unexpected&nbsp;exception&nbsp;in&nbsp;the&nbsp;selector&nbsp;loop.</span><span >&quot;</span><span >,&nbsp;t);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Prevent&nbsp;possible&nbsp;consecutive&nbsp;immediate&nbsp;failures&nbsp;that&nbsp;lead&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;excessive&nbsp;CPU&nbsp;consumption.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.sleep(</span><span >1000</span><span >);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >catch</span><span >&nbsp;(InterruptedException&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Ignore.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></div>
<br>
<br>
æ?¥çœ‹processSelectedKeys(selector.selectedKeys());<br>
<div ><span >&nbsp;</span><span >private</span><span >&nbsp;</span><span >void</span><span >&nbsp;processSelectedKeys(Set</span><span >&lt;</span><span >SelectionKey</span><span >&gt;</span><span >&nbsp;selectedKeys)&nbsp;</span><span >throws</span><span >&nbsp;IOException&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >for</span><span >&nbsp;(Iterator</span><span >&lt;</span><span >SelectionKey</span><span >&gt;</span><span >&nbsp;i&nbsp;</span><span >=</span><span >&nbsp;selectedKeys.iterator();&nbsp;i.hasNext();)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SelectionKey&nbsp;k&nbsp;</span><span >=</span><span >&nbsp;i.next();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.remove();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >try</span><span >&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >int</span><span >&nbsp;readyOps&nbsp;</span><span >=</span><span >&nbsp;k.readyOps();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >å?¯è¯»ï¼Œå¤„ç?†downstream</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;((readyOps&nbsp;</span><span >&amp;</span><span >&nbsp;SelectionKey.OP_READ)&nbsp;</span><span >!=</span><span >&nbsp;</span><span >0</span><span >&nbsp;</span><span >||</span><span >&nbsp;readyOps&nbsp;</span><span >==</span><span >&nbsp;</span><span >0</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(</span><span >!</span><span >read(k))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >&nbsp;Connection&nbsp;already&nbsp;closed&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;handle&nbsp;write.</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >continue</span><span >;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >//</span><span >å?¯å†™ï¼Œå¤„ç?†upstream</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;((readyOps&nbsp;</span><span >&amp;</span><span >&nbsp;SelectionKey.OP_WRITE)&nbsp;</span><span >!=</span><span >&nbsp;</span><span >0</span><span >)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writeFromSelectorLoop(k);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span >catch</span><span >&nbsp;(CancelledKeyException&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(k);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >if</span><span >&nbsp;(cleanUpCancelledKeys())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span >break</span><span >;&nbsp;</span><span >//</span><span >&nbsp;break&nbsp;the&nbsp;loop&nbsp;to&nbsp;avoid&nbsp;ConcurrentModificationException</span><span ><br>
</span><span >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
</span></div>
ä»Žè¿™ä¸ªè¿‡ç¨‹æ?¥çœ‹ï¼Œåœ¨nettyä¸­ï¼Œbossçº¿ç¨‹ç”¨æ?¥ä¾¦å?¬socketçš„è¿žæŽ¥ï¼Œç„¶å?Žåˆ†æ´¾è¯¥è¿žæŽ¥ç»™nioworkerï¼Œåœ¨nioworkerä¸­æœ‰è¯»å’Œå†™çš„ä»»åŠ¡æ³¨å†Œçº¿ç¨‹æ± ï¼Œnioworkerçº¿ç¨‹è´Ÿè´£ä»Žè¿™äº›çº¿ç¨‹ä¸­èŽ·å?–ä»»åŠ¡è¿›è¡Œè¯»å†™æ“?ä½œ<br>
<p></p>

</div><script src="/js/syntaxhighlighter/shCore.js" type="text/javascript"></script>

</div>
					<div style="line-height:26px;">
				     <table width="100%" cellpadding="0" cellspacing="0" border="0">
				     <tr>
				     <td>
				      <b>ä¸Šä¸€ç¯‡&nbsp;</b><a href="/demo_c447_i21840.html">é€‰æ‹©å®‰å…¨æ¼?æ´žæ‰«æ??å·¥å…·</a>
				     </td>
				     <td>
				      <b>ä¸‹ä¸€ç¯‡&nbsp;</b><a href="/demo_c447_i21842.html">å‡½æ•°å?‚æ•°å’Œè¿”å›žå€¼åˆ†æž?</a>
				     </td>
				     </tr>
				     </table>
				    </div>
					<script src="/js/ads/demo/demo_bottom_double.js" type="text/javascript"></script>
					<div>
						<!-- UJian Button BEGIN -->
						<div class="ujian-hook"></div>
						<script type="text/javascript">var ujian_config = {num:10,showType:4,lkrc:0};</script>
						<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?uid=1821176"></script>
						<a href="http://www.ujian.cc" style="border:0;"><img src="http://img.ujian.cc/pixel.png" alt="å?‹è??äº‘æŽ¨è??" style="border:0;padding:0;margin:0;" /></a>
						<!-- UJian Button END -->
					</div>
					<div class="content-message" style="border-top:none;width:686px;">
						<div class="pl" style="line-height:32px;">
							<img class="vm" src="/images/comments.gif"/>
							<b style="font-size:16px;">æ–‡ç« è¯„è®º</b> ä»¥ä¸‹ç½‘å?‹ç•™è¨€å?ªä»£è¡¨å…¶ä¸ªäººè§‚ç‚¹ï¼Œä¸?ä»£è¡¨æœ¬ç½‘ç«™çš„è§‚ç‚¹å’Œç«‹åœºã€‚
						</div>
						<div>
						<!-- UY BEGIN -->
						<div id="uyan_frame"></div>
						<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1821176"></script>
						<!-- UY END -->
						</div>
					</div>
				</div>
				<!--å·¦æž¶æž„ç»“æ?Ÿ-->
				<!--å?³æž¶æž„-->
				<div class="right-div" id="right_tj">
					<div class="tag-container" style="padding-top:0px;">
						<div class="tag-div">
							<div class="tag2">
								<div class="title">
									<div>
									 <table width="100%" cellpadding="0" cellspacing="0" border="0">
									 <tr>
									  <td><a href="/library.html" style="color:red;">çƒ­é—¨ä¹¦ç±?(PDFç‰ˆã€?å…?è´¹ä¸‹è½½)</a></td>
									  <td align="right"><a href="/library.html" style="color:red;">æ›´å¤šä¹¦ç±?ä¸‹è½½&nbsp;&nbsp;</a></td>
									 </tr>
									</table>
									</div>
								</div>
								<div class="content3">
								    <div class="list">
					                 <div class="left">
					                   <a href="" title="ã€ŠRubyç¼–ç¨‹è¯­è¨€ã€‹ä¸­æ–‡é«˜æ¸…PDFç‰ˆ"><img width="50" alt="ã€ŠRubyç¼–ç¨‹è¯­è¨€ã€‹ä¸­æ–‡é«˜æ¸…PDFç‰ˆ" alt="ã€ŠRubyç¼–ç¨‹è¯­è¨€ã€‹ä¸­æ–‡é«˜æ¸…PDFç‰ˆ" src="/upload/cms/120/2012-04-02/thumb (9).gif"/></a>
					                 </div>
					                 <div class="right">
					                  <div><a href="/demo_c120_i1.html" title="ã€ŠRubyç¼–ç¨‹è¯­è¨€ã€‹ä¸­æ–‡é«˜æ¸…PDFç‰ˆ">ã€ŠRubyç¼–ç¨‹è¯­è¨€ã€‹ä¸­æ–‡é«˜æ¸…PDFç‰ˆ</a></div>
					                  <div class="tr"><a href="/demo_c120_i1.html" title="ã€ŠRubyç¼–ç¨‹è¯­è¨€ã€‹ä¸­æ–‡é«˜æ¸…PDFç‰ˆä¸‹è½½">ä¸‹è½½æ¬¡æ•°ï¼š285</a></div>
					                 </div>
					                 <div class="cl"></div>
					               </div>
					               <div class="list">
					                 <div class="left">
					                   <a href="" title="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬å››ç‰ˆ"><img width="50" alt="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬å››ç‰ˆ" alt="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬å››ç‰ˆ" src="/upload/cms/120/2012-04-02/thumb (13).gif"/></a>
					                 </div>
					                 <div class="right">
					                  <div><a href="/demo_c120_i6.html" title="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬å››ç‰ˆ">ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬å››ç‰ˆ</a></div>
					                  <div class="tr"><a href="/demo_c120_i6.html" title="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬å››ç‰ˆä¸‹è½½">ä¸‹è½½æ¬¡æ•°ï¼š254</a></div>
					                 </div>
					                 <div class="cl"></div>
					               </div>
					               <div class="list">
					                 <div class="left">
					                   <a href="" title="ã€Šæ·±å…¥æµ…å‡º Ruby on Railsã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?"><img width="50" alt="ã€Šæ·±å…¥æµ…å‡º Ruby on Railsã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?" alt="ã€Šæ·±å…¥æµ…å‡º Ruby on Railsã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?" src="/upload/cms/120/2012-04-02/thumb (12).gif"/></a>
					                 </div>
					                 <div class="right">
					                  <div><a href="/demo_c120_i4.html" title="ã€Šæ·±å…¥æµ…å‡º Ruby on Railsã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?">ã€Šæ·±å…¥æµ…å‡º Ruby on Railsã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?</a></div>
					                  <div class="tr"><a href="/demo_c120_i4.html" title="ã€Šæ·±å…¥æµ…å‡º Ruby on Railsã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?ä¸‹è½½">ä¸‹è½½æ¬¡æ•°ï¼š192</a></div>
					                 </div>
					                 <div class="cl"></div>
					               </div>
					               <div class="list">
					                 <div class="left">
					                   <a href="" title="ã€ŠRuby Programmingã€‹â€”â€”å?‘Rubyä¹‹çˆ¶å­¦ç¨‹åº?è®¾è®¡ï¼?æ‰«æ??ç‰ˆ"><img width="50" alt="ã€ŠRuby Programmingã€‹â€”â€”å?‘Rubyä¹‹çˆ¶å­¦ç¨‹åº?è®¾è®¡ï¼?æ‰«æ??ç‰ˆ" alt="ã€ŠRuby Programmingã€‹â€”â€”å?‘Rubyä¹‹çˆ¶å­¦ç¨‹åº?è®¾è®¡ï¼?æ‰«æ??ç‰ˆ" src="/upload/cms/120/2012-04-02/thumb (15).gif"/></a>
					                 </div>
					                 <div class="right">
					                  <div><a href="/demo_c120_i8.html" title="ã€ŠRuby Programmingã€‹â€”â€”å?‘Rubyä¹‹çˆ¶å­¦ç¨‹åº?è®¾è®¡ï¼?æ‰«æ??ç‰ˆ">ã€ŠRuby Programmingã€‹â€”â€”å?‘Rubyä¹‹çˆ¶å­¦ç¨‹åº?è®¾è®¡ï¼?æ‰«æ??ç‰ˆ</a></div>
					                  <div class="tr"><a href="/demo_c120_i8.html" title="ã€ŠRuby Programmingã€‹â€”â€”å?‘Rubyä¹‹çˆ¶å­¦ç¨‹åº?è®¾è®¡ï¼?æ‰«æ??ç‰ˆä¸‹è½½">ä¸‹è½½æ¬¡æ•°ï¼š168</a></div>
					                 </div>
					                 <div class="cl"></div>
					               </div>
					               <div class="list">
					                 <div class="left">
					                   <a href="" title="ã€ŠæŒ?ç»­æµ‹è¯•ï¼šä½¿ç”¨Ruby, Rails, and JavaScriptã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?"><img width="50" alt="ã€ŠæŒ?ç»­æµ‹è¯•ï¼šä½¿ç”¨Ruby, Rails, and JavaScriptã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?" alt="ã€ŠæŒ?ç»­æµ‹è¯•ï¼šä½¿ç”¨Ruby, Rails, and JavaScriptã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?" src="/upload/cms/120/2012-04-02/thumb (14).gif"/></a>
					                 </div>
					                 <div class="right">
					                  <div><a href="/demo_c120_i7.html" title="ã€ŠæŒ?ç»­æµ‹è¯•ï¼šä½¿ç”¨Ruby, Rails, and JavaScriptã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?">ã€ŠæŒ?ç»­æµ‹è¯•ï¼šä½¿ç”¨Ruby, Rails, and JavaScriptã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?</a></div>
					                  <div class="tr"><a href="/demo_c120_i7.html" title="ã€ŠæŒ?ç»­æµ‹è¯•ï¼šä½¿ç”¨Ruby, Rails, and JavaScriptã€‹é«˜æ¸…æ‰«æ??PDFæ ¼å¼?ä¸‹è½½">ä¸‹è½½æ¬¡æ•°ï¼š146</a></div>
					                 </div>
					                 <div class="cl"></div>
					               </div>
					               <div class="list">
					                 <div class="left">
					                   <a href="" title="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬ä¸‰ç‰ˆ"><img width="50" alt="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬ä¸‰ç‰ˆ" alt="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬ä¸‰ç‰ˆ" src="/upload/cms/120/2012-04-02/thumb (13).gif"/></a>
					                 </div>
					                 <div class="right">
					                  <div><a href="/demo_c120_i5.html" title="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬ä¸‰ç‰ˆ">ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬ä¸‰ç‰ˆ</a></div>
					                  <div class="tr"><a href="/demo_c120_i5.html" title="ã€ŠWebå¼€å?‘æ•?æ?·ä¹‹é?“ï¼šåº”ç”¨Railsè¿›è¡Œæ•?æ?·Webå¼€å?‘ã€‹ç¬¬ä¸‰ç‰ˆä¸‹è½½">ä¸‹è½½æ¬¡æ•°ï¼š136</a></div>
					                 </div>
					                 <div class="cl"></div>
					               </div>
					               </div>
							</div>
						</div>
					</div>
					<script src="/js/ads/demo/demo_right_300x250_1.js" type="text/javascript"></script>
					<div class="tag-container">
						<div class="tag-div">
							<div class="tag2">
								<div class="title">
									<div style="font-size:16px;line-height:34px;">&nbsp;ç›¸å…³æ–‡ç« æŽ¨è??ï¼?</div>
								</div>
								<div class="content2" style="border-top:1px dotted #ccc;margin-top:4px;">
								 <ul>
								 <li><a href="/demo_c161_i102181.html" title="Quake2æº?ç ?åˆ†æž?ï¼ˆ3ï¼‰">Quake2æº?ç ?åˆ†æž?ï¼ˆ3ï¼‰</a></li>
								 <li><a href="/demo_c447_i5549.html" title="LDD3æº?ç ?åˆ†æž?ä¹‹llseekåˆ†æž?(2)">LDD3æº?ç ?åˆ†æž?ä¹‹llseekåˆ†æž?(2)</a></li>
								 <li><a href="/demo_c202_i1429.html" title="Jboss Nettyæº?ç ?åˆ†æž?1">Jboss Nettyæº?ç ?åˆ†æž?1</a></li>
								 <li><a href="/demo_c202_i1736.html" title="netty æº?ç ?åˆ†æž?ä¹‹èµ·åŠ¨åˆ?å§‹åŒ–">netty æº?ç ?åˆ†æž?ä¹‹èµ·åŠ¨åˆ?å§‹åŒ–</a></li>
								 <li><a href="/demo_c447_i5597.html" title="netty æº?ç ?åˆ†æž?ä¹‹ï¼ˆ8ï¼‰Channel">netty æº?ç ?åˆ†æž?ä¹‹ï¼ˆ8ï¼‰Channel</a></li>
								 <li><a href="/demo_c447_i5633.html" title="netty æº?ç ?åˆ†æž?ä¹‹ï¼ˆ7ï¼‰ChannelBuffer">netty æº?ç ?åˆ†æž?ä¹‹ï¼ˆ7ï¼‰ChannelBuffer</a></li>
								 <li><a href="/demo_c447_i19802.html" title="nettyæº?ç ?åˆ†æž?ä¹‹FrameDecoder(DelimiterBasedFrameDecoder)">nettyæº?ç ?åˆ†æž?ä¹‹FrameDecoder(DelimiterBasedFrameDecoder)</a></li>
								 <li><a href="/demo_c447_i19805.html" title="Nettyæº?ç ?åˆ†æž?ä¹‹handler decoder">Nettyæº?ç ?åˆ†æž?ä¹‹handler decoder</a></li>
								 <li><a href="/demo_c447_i19809.html" title="nettyæº?ç ?åˆ†æž?ä¹‹FrameDecoder">nettyæº?ç ?åˆ†æž?ä¹‹FrameDecoder</a></li>
								 <li><a href="/demo_c447_i19816.html" title="nettyæº?ç ?åˆ†æž?ä¹‹FrameDecoder(LengthFieldBasedFrameDecoder)">nettyæº?ç ?åˆ†æž?ä¹‹FrameDecoder(LengthFieldBasedFrameDecoder)</a></li>
								 <li><a href="/demo_c447_i19901.html" title="nettyæº?ç ?åˆ†æž?ä¹‹ChannelPipeline">nettyæº?ç ?åˆ†æž?ä¹‹ChannelPipeline</a></li>
								 <li><a href="/demo_c199_i2538.html" title="tomcatæº?ç ?åˆ†æž?3">tomcatæº?ç ?åˆ†æž?3</a></li>
								 <li><a href="/demo_c447_i989.html" title="nebula3 æº?ç ?åˆ†æž?">nebula3 æº?ç ?åˆ†æž?</a></li>
								 <li><a href="/demo_c447_i2644.html" title="Leveldbæº?ç ?åˆ†æž?--3">Leveldbæº?ç ?åˆ†æž?--3</a></li>
								 <li><a href="/demo_c447_i3666.html" title="sitemesh3 æº?ç ?åˆ†æž?">sitemesh3 æº?ç ?åˆ†æž?</a></li>
								 <li><a href="/demo_c447_i3765.html" title="Jeecmsæº?ç ?åˆ†æž?ï¼ˆ3ï¼‰">Jeecmsæº?ç ?åˆ†æž?ï¼ˆ3ï¼‰</a></li>
								 <li><a href="/demo_c447_i5099.html" title="SWTæº?ç ?åˆ†æž?(3)">SWTæº?ç ?åˆ†æž?(3)</a></li>
								 <li><a href="/demo_c447_i11965.html" title="ubootæº?ç ?åˆ†æž?ï¼ˆ3ï¼‰">ubootæº?ç ?åˆ†æž?ï¼ˆ3ï¼‰</a></li>
								 <li><a href="/demo_c110_i26923.html" title="Jqueryæº?ç ?åˆ†æž?---Eventåˆ†æž?(3)">Jqueryæº?ç ?åˆ†æž?---Eventåˆ†æž?(3)</a></li>
								 <li><a href="/demo_c110_i26927.html" title="Jqueryæº?ç ?åˆ†æž?---Ajaxåˆ†æž?(3)">Jqueryæº?ç ?åˆ†æž?---Ajaxåˆ†æž?(3)</a></li>
								 </ul>
                                </div>
							</div>
						</div>
					</div>
					<script src="/js/ads/demo/demo_right_300x250_4.js" type="text/javascript"></script>
				</div>
				<!--å?³æž¶æž„ç»“æ?Ÿ-->
				<div class="cl">
				</div>
			</div>
		</div>
		<!--ä¸»æž¶æž„ç»“æ?Ÿ-->
	    <!--åº•éƒ¨-->

<div class="100p">
	<div class="footer-div">
		ç‰ˆæ?ƒå£°æ˜Ž:æœ¬ç«™å¤§éƒ¨åˆ†å†…å®¹å?‡ä¸ºåŽŸåˆ›å†…å®¹,éƒ¨åˆ†æ–‡ç« æ‘˜è‡ªäº’è?”ç½‘,å¦‚æžœä¾µçŠ¯äº†æ‚¨çš„ç‰ˆæ?ƒ,è¯·è?”ç³»ç®¡ç?†å‘˜åˆ é™¤(è?”ç³»é‚®ç®±:421584397#qq.com)
		<br />
		Copyright Â© 2012, WWW.VERYDEMO.COM, All Rights Reserved
	</div>
</div>
<!-- Baidu Button BEGIN -->
<script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=5&amp;pos=left&amp;uid=0" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
var bds_config={"bdTop":170};
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
</script>
<!-- Baidu Button END --><script src="/js/ads/demo/demo_dui_lian_and_pop.js" type="text/javascript"></script>
    </body>
</html>
<!--150-->
