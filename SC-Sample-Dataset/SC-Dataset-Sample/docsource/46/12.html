<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="zh-CN" prefix="og: http://ogp.me/ns#">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="zh-CN" prefix="og: http://ogp.me/ns#">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="zh-CN" prefix="og: http://ogp.me/ns#">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />

<link rel="prerender" href="http://www.w3c.com.cn/" />
<link rel="prerender" href="http://www.w3c.com.cn/category/%e7%a8%8b%e5%ba%8f%e5%91%98" />
<!--[if lt IE 9]>
<script src="http://www.w3c.com.cn/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->

<!-- This site is optimized with the Yoast WordPress SEO plugin v1.4.7 - http://yoast.com/wordpress/seo/ -->
<title>Nettyæº?ç ?åˆ†æž?ä¹‹NioServerSocketChannelFactory - ç¨‹åº?å‘˜ - å¼€å?‘è€…ç¬¬2225922ä¸ªé—®ç­”</title>
<meta name="description" content="NioServerSocketChannelFactory æ˜¯ChannelFactoryçš„å®žçŽ°æŽ¥å?£ä¹‹ä¸€ï¼Œè´Ÿè´£åˆ›å»ºå¹¶ç®¡ç?†æœ?åŠ¡ç«¯Channelã€‚ å…ˆæ?¥çœ‹ä¸‹å®ƒçš„å‘¨è¾¹ç±»å›¾æ˜¯æ€Žæ · Â  Â  Â  ä¸‹é?¢é’ˆå¯¹æ ¸å¿ƒçš„ç±»å?šä¸‹è®²è§£ï¼Œç„¶å?Žå°±å¼€å§‹è·Ÿè¸ªæº?ç ?ä¸€æ­¥ä¸€æ­¥åˆ†æž? NioServerSocketPipelineSink - å¼€å?‘è€…ç¬¬2225922ä¸ªé—®ç­”"/>
<link rel="canonical" href="http://www.w3c.com.cn/netty%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8bnioserversocketchannelfactory" />
<meta property='og:locale' content='zh_CN'/>
<meta property='og:type' content='article'/>
<meta property='og:title' content='Nettyæº?ç ?åˆ†æž?ä¹‹NioServerSocketChannelFactory - å¼€å?‘è€…é—®ç­”'/>
<meta property='og:url' content='http://www.w3c.com.cn/netty%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8bnioserversocketchannelfactory'/>
<meta property='og:site_name' content='å¼€å?‘è€…é—®ç­”'/>
<meta property='og:image' content='http://dl2.iteye.com/upload/attachment/0087/6303/95cf595f-0a08-323a-b427-2fa03ad48ecd.png'/>
<!-- / Yoast WordPress SEO plugin. -->

<link rel='stylesheet' id='twentytwelve-fonts-css'  href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='http://www.w3c.com.cn/wp-content/themes/twentytwelve/style.css?ver=3.5.1' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://www.w3c.com.cn/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='post-ratings-css'  href='http://www.w3c.com.cn/wp-content/plugins/post-ratings/post-ratings.css?ver=3.5.1' type='text/css' media='all' />
<script type='text/javascript' src='http://www.w3c.com.cn/wp-includes/js/jquery/jquery.js?ver=1.8.3'></script>
<link rel="stylesheet" type="text/css" href="http://www.w3c.com.cn/wp-content/plugins/wp-code-highlight/css/desert.css" media="screen" />
<link rel='shortlink' href='http://www.w3c.com.cn/?p=2225922'/>

</head>

<body class="single single-post postid-2225922 single-format-standard custom-background custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<a href="http://www.w3c.com.cn/" title="å¼€å?‘è€…é—®ç­”" rel="home"><img src="http://www.w3c.com.cn/wp-content/themes/twentytwelve/logo.png" alt="logo" title="å¼€å?‘è€…é—®ç­”"></a>
		</hgroup>
	</header><!-- #masthead -->

	<div id="main" class="wrapper">	<div id="primary" class="site-content W3C-site-content">
		<nav id="W3C-nav">
			<a href="http://www.w3c.com.cn/" title="å¼€å?‘è€…é—®ç­”">é¦–é¡µ</a><a href="http://www.w3c.com.cn/category/%e7%a8%8b%e5%ba%8f%e5%91%98" title="å‰?å¾€ç¨‹åº?å‘˜åˆ†ç±»">ç¨‹åº?å‘˜</a><a href="http://www.w3c.com.cn/?p=2225922" rel="nofollow" title="æœ¬æ–‡çŸ­é“¾æŽ¥">U+</a>
		</nav>
		<div id="content" role="main">
			
				

	
	<article id="post-2225922" class="post-2225922 post type-post status-publish format-standard hentry category-64">
				<header class="entry-header">
						<h1 class="entry-title">Nettyæº?ç ?åˆ†æž?ä¹‹NioServerSocketChannelFactory</h1>
							<div class="comments-link">
					<a href="#uyan_frame"><span class="leave-reply">å?‘è¡¨å›žå¤?</span></a>
				</div><!-- .comments-link -->
					</header><!-- .entry-header -->

				<div class="entry-content">
        		<div class="W3C-ads-h">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3200764857528189"
     data-ad-slot="3491015359"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
		<table style="width:100%;table-layout:fixed;">
		<tr>
		<td class="W3C-entry-content">
			
<div class="ratings hreview-aggregate" data-post="2225922">

    <span class="item"><span class="fn">Nettyæº?ç ?åˆ†æž?ä¹‹NioServerSocketChannelFactory</span></span>
  
  <ul   style="width:80px" title="0.00 / 5">
    <li class="rating" style="width:0px">
      <span class="average">
        0.00 / 5      </span>
      <span class="best">
        5      </span>
    </li>

    
      
        
        <li class="s1">
          <a title="Give 1 out of 5 stars">1 / 5</a>
        </li>

      
        
        <li class="s2">
          <a title="Give 2 out of 5 stars">2 / 5</a>
        </li>

      
        
        <li class="s3">
          <a title="Give 3 out of 5 stars">3 / 5</a>
        </li>

      
        
        <li class="s4">
          <a title="Give 4 out of 5 stars">4 / 5</a>
        </li>

      
        
        <li class="s5">
          <a title="Give 5 out of 5 stars">5 / 5</a>
        </li>

      
      </ul>

  <div class="meta">
     <strong class="votes">0</strong> votes, <strong>0.00</strong> avg. rating (<strong>0</strong>% score)  </div>

</div>

      <p style="font-size: 14px;">NioServerSocketChannelFactory æ˜¯ChannelFactoryçš„å®žçŽ°æŽ¥å?£ä¹‹ä¸€ï¼Œè´Ÿè´£åˆ›å»ºå¹¶ç®¡ç?†æœ?åŠ¡ç«¯Channelã€‚</p>
<p style="font-size: 14px;">å…ˆæ?¥çœ‹ä¸‹å®ƒçš„å‘¨è¾¹ç±»å›¾æ˜¯æ€Žæ ·</p>
<p style="font-size: 14px;"><img rel="nofollow" alt="" src="http://dl2.iteye.com/upload/attachment/0087/6303/95cf595f-0a08-323a-b427-2fa03ad48ecd.png"/></p>
<p style="font-size: 14px;">Â </p>
<p style="font-size: 14px;" class="MsoNormal">Â </p>
<p style="font-size: 14px;">Â </p>
<p style="font-size: 14px;" class="MsoNormal">ä¸‹é?¢é’ˆå¯¹æ ¸å¿ƒçš„ç±»å?šä¸‹è®²è§£ï¼Œç„¶å?Žå°±å¼€å§‹è·Ÿè¸ªæº?ç ?ä¸€æ­¥ä¸€æ­¥åˆ†æž?</p>
<p style="font-size: 14px;" class="MsoNormal">NioServerSocketPipelineSink</p>
<p style="text-indent: 21pt;" class="MsoNormal"><span style="line-height: 1.5;">æŽ¥å?—å’Œå¤„ç?†ç»ˆç«¯çš„ä¸‹æ¸¸ChannelEventäº‹ä»¶.</span></p>
<p style="text-indent: 21pt;" class="MsoNormal">Â </p>
<p style="font-size: 14px;" class="MsoNormal">AbstractNioBossPoolÂ </p>
<p style="font-size: 14px;" class="MsoNormal">Â Â Â  å¤„ç?†socket acceptã€?connectçš„å·¥ä½œçº¿ç¨‹æ± æŠ½è±¡ç±»ï¼Œæ??ä¾›äº†åˆ›å»ºå·¥ä½œçº¿ç¨‹çš„æ¨¡æ?¿æ–¹æ³•newBossÂ </p>
<p style="font-size: 14px;" class="MsoNormal">Â </p>
<p style="font-size: 14px;" class="MsoNormal">NioServerBossPoolÂ </p>
<p style="font-size: 14px;" class="MsoNormal">Â Â Â  ç»§ç»­è‡ªAbstractNioBossPoolé‡?å†™äº†newBossæ–¹æ³•åˆ›å»ºBosså·¥ä½œçº¿ç¨‹</p>
<p style="font-size: 14px;">Â </p>
<p style="font-size: 14px;" class="MsoNormal">AbstractNioSelectorÂ </p>
<p style="font-size: 14px;" class="MsoNormal">Â Â Â  å®ƒé—´æŽ¥çš„å®žçŽ°äº†RunnableæŽ¥å?£ï¼Œè´Ÿè´£æ‰§è¡Œå†…éƒ¨çš„å·¥ä½œé˜Ÿåˆ—ã€?å¤„ç?†Selectoräº‹ä»¶(æŠ½è±¡æ–¹æ³•process)ã€?å…³é—­ç›¸å…³çš„Channel(æŠ½è±¡æ–¹æ³•close)ã€?å…³é—­å†…éƒ¨äº†Selectorï¼›å€¼å¾—æ³¨æ„?çš„æ˜¯è¿™ä¸ªç±»çš„registeræŠ½è±¡æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªæ–°çš„Channelæ³¨å†Œåˆ°è‡ªèº«è¿™ä¸ªå·¥ä½œçº¿ç¨‹ä¸­å®Œæˆ?Channelçš„ç»‘å®šæˆ–è¿žæŽ¥å·¥ä½œï¼Œè¿™ä¸ªæ–¹æ³•ç”±sinkè°ƒç”¨ã€‚</p>
<p style="font-size: 14px;">Â </p>
<p style="font-size: 14px;" class="MsoNormal"><strong>NioServerBossÂ </strong></p>
<p style="font-size: 14px;" class="MsoNormal">Â Â Â  ç»§æ‰¿è‡ªAbstractNioSelectorï¼Œå®Œæˆ?å¦‚ä¸‹å·¥ä½œ</p>
<p class="MsoListParagraph"><span style="line-height: 1.5;">1ã€?æŠŠServerSocketChannelç»‘å®šåˆ°SocketAddresså¹¶å°†Selectorå®žä¾‹æ³¨å†Œåˆ°ServerSocketChannelç›‘å?¬å…¶SelectionKey.OP_ACCEPTäº‹ä»¶(å…¶å†…éƒ¨ç±»å¹²çš„äº‹RegisterTask)</span></p>
<p class="MsoListParagraph"><span style="line-height: 1.5;">2ã€?å¤„ç?†OP_ACCEPTäº‹ä»¶,å°†æ–°Accpetçš„Channelæ³¨å†Œåˆ°ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ä¸­åŽ»(workPool.nextWorker().register());(ç½‘ç»œæ¨¡åž‹å›¾ä¸­acceptoråˆ°subRecatorçš„è¿‡ç¨‹)</span></p>
<p class="MsoListParagraph">Â </p>
<p style="font-size: 14px;" class="MsoNormal"><strong>NioWorker</strong></p>
<p style="font-size: 14px;" class="MsoNormal">ä¸ŽNioServerBossç±»ä¼¼ï¼Œç»§æ‰¿è‡ªAbstractNioSelectorï¼Œå®Œæˆ?å¦‚ä¸‹å·¥ä½œ</p>
<p style="font-size: 14px;" class="MsoNormal"><span style="line-height: 1.5;">1ã€?å¤„ç?†OP_READã€?OP_WRITEäº‹ä»¶</span></p>
<p style="font-size: 14px;" class="MsoNormal"><span style="line-height: 1.5;">2ã€?å°†Selectorå®žä¾‹æ³¨å†Œåˆ°SocketChannelï¼Œå¹¶ç›‘å?¬OP_READã€?OP_WRITEäº‹ä»¶(å…¶å†…éƒ¨ç±»å¹²çš„äº‹RegisterTask)Â </span></p>
<p style="font-size: 14px;" class="MsoNormal">Â </p>
<p style="font-size: 14px;" class="MsoListParagraph">ä¸‹é?¢æ˜¯ä¸€æ®µæ˜¯ç®€å?•çš„æœ?åŠ¡ç«¯ä»£ç ?ï¼Œæˆ‘ä»¬é¡ºç?€ä»£ç ?ä¸­çš„å…³é”®ç±»åˆ†æž?Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">public class ServerTest {
	private final ChannelFactory channelFactory = new NioServerSocketChannelFactory(
			Executors.newCachedThreadPool(),
			Executors.newCachedThreadPool());

	private final ServerBootstrap bootstrap;

	public ServerTest() {
		this.bootstrap = new ServerBootstrap(channelFactory);
		this.bootstrap.setOption("child.tcpNoDelay", true);
		this.bootstrap.setOption("child.keepAlive", true);
		
		this.bootstrap.setPipelineFactory(new ChannelPipelineFactory() {
			@Override
			public ChannelPipeline getPipeline() throws Exception {
				ChannelPipeline pipeline=Channels.pipeline();
//				pipeline.addFirst("encoder", new Encoder());
//				pipeline.addFirst("decoder", new encoder());
//				...
				return pipeline;
			}
		});
	}
	public void service(){
		this.bootstrap.bind(new InetSocketAddress(9008));
	}
	
	public static void main(String[] args){
		new ServerTest().service();
	}
}
</pre>
<p>Â <strong>NioServerSocketChannelFactory</strong></p>
<p>Â Â è¿™ä¸ªç±»çš„ä»£ç ?é?žå¸¸ç®€æ´?å°±4ä¸ªå®žä¾‹å?˜é‡?å’Œå‡ ä¸ªæ–¹æ³•Â Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">private final WorkerPool&lt;NioWorker&gt; workerPool;
private final NioServerSocketPipelineSink sink;
private final BossPool&lt;NioServerBoss&gt; bossPool;
private boolean releasePools;//æ ‡è®°å½“å‰?ChannelFactoryæ˜¯å?¦å·²è¿˜æ²¡æœ‰å…³é—­æˆ–è€…è¯´å·¥ä½œçº¿ç¨‹è¿˜æ²¡æœ‰è¢«shutdown
</pre>
<p>Â Â <span style="line-height: 1.5;">è¿™ä¸ªç±»æœ‰ä¸ªBUG,åœ¨é»˜è®¤çš„æž„é€ æ–¹æ³•ä¸­å°†releasePoolsç½®ä¸ºtrueäº†ï¼Œä½†æ˜¯åœ¨å…¶å®ƒæž„é€ æ–¹æ³•ä¸­å?´æ²¡æœ‰ï¼Œè¿™æ„?å‘³ç?€åœ¨å®ƒè¢«å…³é—­çš„æ—¶å€™å?¯èƒ½æ— æ³•é‡Šæ”¾æŸ?äº›æ‰©å±•èµ„æº?</span></p>
<p>Â Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">public NioServerSocketChannelFactory() {
        this(Executors.newCachedThreadPool(), Executors.newCachedThreadPool());
        releasePools = true;
}

public NioServerSocketChannelFactory(
            Executor bossExecutor, Executor workerExecutor) {
        this(bossExecutor, workerExecutor, getMaxThreads(workerExecutor));//è°ƒç”¨æ­¤æž„é€ æ–¹æ³•æ—¶ï¼ŒgetMaxThreadsæŽ§åˆ¶ç?€å·¥ä½œçº¿ç¨‹æ•°å°?äºŽç­‰äºŽCPUæ•°*2
}

public NioServerSocketChannelFactory(
            Executor bossExecutor, Executor workerExecutor,
            int workerCount) {
        this(bossExecutor, 1, workerExecutor, workerCount);//é»˜è®¤æƒ…å†µä¸‹bossçº¿ç¨‹çš„æ•°é‡?ä¸º1
    }
public NioServerSocketChannelFactory(
            Executor bossExecutor, int bossCount, Executor workerExecutor,
            int workerCount) {
        this(bossExecutor, bossCount, new NioWorkerPool(workerExecutor, workerCount));
}

public NioServerSocketChannelFactory(
            Executor bossExecutor, WorkerPool&lt;NioWorker&gt; workerPool) {
        this(bossExecutor, 1 , workerPool);
}

public NioServerSocketChannelFactory(
            Executor bossExecutor, int bossCount, WorkerPool&lt;NioWorker&gt; workerPool) {
        this(new NioServerBossPool(bossExecutor, bossCount, null), workerPool);
}

public NioServerSocketChannelFactory(BossPool&lt;NioServerBoss&gt; bossPool, WorkerPool&lt;NioWorker&gt; workerPool) {
        if (bossPool == null) {
            throw new NullPointerException("bossExecutor");
        }
        if (workerPool == null) {
            throw new NullPointerException("workerPool");
        }
        this.bossPool = bossPool;
        this.workerPool = workerPool;
        sink = new NioServerSocketPipelineSink();
 }
public ServerSocketChannel newChannel(ChannelPipeline pipeline) {
        return new NioServerSocketChannel(this, pipeline, sink, bossPool.nextBoss(), workerPool);//æ³¨æ„?nextBossæ–¹æ³•ï¼Œå®ƒé€‰æ‹©ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ?¥å¤„ç?†ServerSocketChannelçš„è¯»å†™äº‹ä»¶
}
</pre>
<p>Â è¿™ä¸ªç±»ä¸»è¦?ä¾?èµ–äºŽè¿™4ä¸ªç±»çš„å®žä¾‹NioWorkerPoolã€?NioServerBossPoolã€?NioServerSocketPipelineSinkã€?NioServerSocketChannelï¼Œå…³äºŽå®ƒä»¬çš„ä½œç”¨å‰?é?¢å·²ç»?æœ‰è¯´æ˜Žäº†ï¼Œåœ¨æ­¤ä¸?è®²äº†ã€‚å…ˆæ?¥çœ‹ä¸‹NioWorkerPoolå?§ã€‚</p>
<p>Â </p>
<p class="MsoNormal">NioWorkerPoolè¿™ä¸ªç±»ä¹Ÿå¾ˆç®€å?•ï¼Œå…¶å†…éƒ¨ä¸»è¦?ç»´æŠ¤äº†ä¸€ä¸ªçº¿ç¨‹æ•°ç»„ï¼Œå®ƒç»§æ‰¿è‡ªAbstractNioWorkerPoolå¹¶é‡?å†™äº†createWorkeræ–¹æ³•Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">protected NioWorker createWorker(Executor executor) {
return new NioWorker(executor, determiner);
}
</pre>
<p>Â å†?æ?¥çœ‹ä¸‹å®ƒçš„çˆ¶ç±»AbstractNioWorkerPool</p>
<p>Â è¿™ä¸ªç±»ä¹Ÿé?žå¸¸ç®€å?•ï¼Œå®ƒå?ªå?š2ä»¶äº‹â€”â€”è´Ÿè½½å?‡è¡¡å’Œå·¥ä½œçº¿ç¨‹çš„åˆ›å»º</p>
<pre class="wp-code-highlight prettyprint linenums:1">public abstract class AbstractNioWorkerPool&lt;E extends AbstractNioWorker&gt;
        implements WorkerPool&lt;E&gt;, ExternalResourceReleasable {

    private final AbstractNioWorker[] workers;
    private final AtomicInteger workerIndex = new AtomicInteger();
    private final Executor workerExecutor;
private volatile boolean initDone;
//æ­¤å¤„çœ?ç•¥äº†éƒ¨åˆ†ä»£ç ?
	AbstractNioWorkerPool(Executor workerExecutor, int workerCount, boolean autoInit) {
        if (workerExecutor == null) {
            throw new NullPointerException("workerExecutor");
        }
        if (workerCount &lt;= 0) {
            throw new IllegalArgumentException(
                    "workerCount (" + workerCount + ") " + "must be a positive integer.");
        }
        workers = new AbstractNioWorker[workerCount];
        this.workerExecutor = workerExecutor;
        if (autoInit) {
            init();
        }
}
protected void init() {
        if (initDone) {
            throw new IllegalStateException("Init was done before");
        }
        initDone = true;

        for (int i = 0; i &lt; workers.length; i++) {
            workers[i] = newWorker(workerExecutor);
    }
protected E newWorker(Executor executor) {
        return createWorker(executor);//è°ƒç”¨æŠ½è±¡æ–¹æ³•ï¼ŒæŠŠå…·ä½“çš„å·¥ä½œçº¿ç¨‹äº¤ç”±å­?ç±»å®Œæˆ?
    }
public E nextWorker() {
        return (E) workers[Math.abs(workerIndex.getAndIncrement() % workers.length)];//è´Ÿè½½å?‡è¡¡
    }
</pre>
<p>Â ä¸‹é?¢æ?¥å…·ä½“çš„å·¥ä½œçº¿ç¨‹NioWorker</p>
<p>Â </p>
<p class="MsoNormal">NioWorkerç»§æ‰¿è‡ªAbstractNioWorkerï¼ŒAbstractNioWorkerç»§æ‰¿è‡ªAbstractNioSelectorï¼Œè¿˜æ˜¯å…ˆä»Žæœ€é¡¶å±‚çˆ¶ç±»AbstractNioSelectorçœ‹èµ·å?§</p>
<p class="MsoNormal">AbstractNioSelectorå®žçŽ°äº†NioSelectoræŽ¥å?£ï¼Œè€ŒNioSelectoræŽ¥å?£ç»§æ‰¿è‡ªRunnableæŽ¥å?£AbstractNioSelectorå®žçŽ°runæ–¹æ³•ï¼ŒNettyæŠŠè¿™ä¸ªçº¿ç¨‹å?«å?šIOçº¿ç¨‹</p>
<p class="MsoNormal">AbstractNioSelectorç±»çš„æž„é€ æ–¹æ³•ä¼šè°ƒç”¨openSelectoræ–¹æ³•æ?¥åˆ›å»ºä¸€ä¸ªSelectorï¼Œå¹¶æ‰§è¡Œå½“å‰?çº¿ç¨‹ï¼ˆè¿™æ®µä»£ç ?å¾ˆç®€å?•ï¼Œæˆ‘ä»¬å°±è·³è¿‡ç›´æŽ¥çœ‹runæ–¹æ³•äº†ï¼‰</p>
<p class="MsoNormal">Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">public void run() {
        thread = Thread.currentThread();//å°†å½“å‰?çº¿ç¨‹ä¿?å­˜èµ·æ?¥ï¼Œç”¨æ?¥åŒºåˆ†è°ƒç”¨è¯¥ç±»å…¶å®ƒæŸ?äº›æ–¹æ³•çš„çº¿ç¨‹æ˜¯å?¦ä¸ºIOçº¿ç¨‹ï¼Œè¯·å?‚çœ‹å®ƒçš„isIoThreadæ–¹æ³•ã€‚å…¶å®ƒçº¿ç¨‹ä¼šè°ƒç”¨æ­¤æ–¹æ³•æ?¥åŒºåˆ†è‡ªå·±æ˜¯ä¸?æ˜¯IOçº¿ç¨‹ï¼Œå¦‚æžœæ˜¯ï¼Œåˆ™ç›´æŽ¥è°ƒç”¨æ­¤ç±»çš„æ–¹æ³•å®Œæˆ?ï¼Œå?¦åˆ™æŠŠç›¸å…³çš„æ“?ä½œæ·»åŠ åˆ°IOçº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚è¿™æ ·å?šçš„å¥½å¤„æ˜¯ï¼Œé?¿å…?IOçº¿ç¨‹ä¸Žå…¶å®ƒçº¿ç¨‹çš„å?Œæ­¥æ“?ä½œï¼Œå¸¦æ?¥äº†æ•ˆçŽ‡çš„æ??å?‡ã€‚

        int selectReturnsImmediately = 0;
        Selector selector = this.selector; 
        if (selector == null) {
            return;
        }
        // use 80% of the timeout for measure
        final long minSelectTimeout = SelectorUtil.SELECT_TIMEOUT_NANOS * 80 / 100;
        boolean wakenupFromLoop = false;
        for (;;) {
            wakenUp.set(false);

            try {
                long beforeSelect = System.nanoTime();
                int selected = select(selector);
                if (SelectorUtil.EPOLL_BUG_WORKAROUND &amp;&amp; selected == 0 &amp;&amp; !wakenupFromLoop &amp;&amp; !wakenUp.get()) {//çœ‹ä»£ç ?ä¸­çš„è§£é‡Šè¯´jdkçš„epollå?¯èƒ½å­˜åœ¨BUGï¼Œè¿™ä¸ªifç”¨æ?¥å¤„ç?†è¿™ç±»é”™è¯¯çš„.çœ‹ä¸‹é?¢çš„ä»£ç ?å†’ä¼¼æ˜¯è¯´Channelè¢«å…³é—­å?Žæ²¡æœ‰ä»ŽSelectorä¸­ç§»é™¤ç›¸å…³çš„é”®è€Œå¯¼è‡´è¿‡å¤šçš„åžƒåœ¾é”®ï¼Œå½“è¿™ç±»é”®è¶…è¿‡1024ä¸ªæ—¶ï¼ŒSelectorå°†è¢«é‡?é”®.
                    long timeBlocked = System.nanoTime() - beforeSelect;

                    if (timeBlocked &lt; minSelectTimeout) {
                        boolean notConnected = false;
                        for (SelectionKey key: selector.keys()) {
                            SelectableChannel ch = key.channel();
                            try {
                                if (ch instanceof DatagramChannel &amp;&amp; !((DatagramChannel) ch).isConnected() ||
                                        ch instanceof SocketChannel &amp;&amp; !((SocketChannel) ch).isConnected()) {
                                    notConnected = true;
                                    key.cancel();
                                }
                            } catch (CancelledKeyException e) {
                            }
                        }
                        if (notConnected) {
                            selectReturnsImmediately = 0;
                        } else {
                            selectReturnsImmediately ++;
                        }
                    } else {
                        selectReturnsImmediately = 0;
                    }

                    if (selectReturnsImmediately == 1024) {
                        rebuildSelector();
                        selector = this.selector;
                        selectReturnsImmediately = 0;
                        wakenupFromLoop = false;
                        continue;
                    }
                } else {
                    selectReturnsImmediately = 0;
                }
		//ä»£ç ?ä¸­è¿™é‡Œçš„è§£é‡Šå¾ˆæ¸…æ¥šï¼Œè¯·çœ‹ä»£ç ?
                if (wakenUp.get()) {
                    wakenupFromLoop = true;
                    selector.wakeup();
                } else {
                    wakenupFromLoop = false;
                }

                cancelledKeys = 0;
                processTaskQueue();//æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡
                selector = this.selector; //å› ä¸ºrebuildSelector()æ–¹æ³•æ˜¯ä¸€ä¸ªå…¬å…±çš„æ–¹æ³•ï¼Œä¹Ÿè®¸åœ¨ä¸Šä¸€æ­¥çš„processTaskQueueæ–¹æ³•ä¸­è¿™ä¸ªæ–¹æ³•è¢«è°ƒäº†

                if (shutdown) {//å¦‚æžœå½“å‰?IOçº¿ç¨‹æ ‡è®°ä¸ºå…³é—­ï¼Œåˆ™æ‰§è¡Œå…³é—­é€»è¾‘
                    this.selector = null;
                    processTaskQueue();//å¤„ç?†ä»»åŠ¡é˜Ÿåˆ—

                    for (SelectionKey k: selector.keys()) {
                        close(k);//å…³é—­ç›¸å…³çš„Channelï¼Œè¿™é‡Œä¼šæ‰§è¡ŒPipelineçš„Upstreamç›´åˆ°sinkä¸­æ‰?å…³é—­Channel
                    }
                    try {
                        selector.close();
                    } catch (IOException e) {
                        logger.warn(
                                "Failed to close a selector.", e);
                    }
                    shutdownLatch.countDown();//shutdownæ–¹æ³•å¿…éœ€ç­‰å¾…ç›¸å…³çš„é‡Šæ”¾æ“?ä½œå®Œæˆ?æ‰?èƒ½è¿”å›žï¼Œæ­¤å¤„å”¤é†’è°ƒç”¨shutdownæ–¹æ³•çš„çº¿ç¨‹
                    break;//å·¥ä½œçº¿ç¨‹é€€å‡º
                } else {
                    process(selector);//æ‰§è¡ŒprocessæŠ½è±¡æ–¹æ³•ï¼ŒSelectionKeyçš„å¤„ç?†è¡Œä¸ºäº¤ç»™å­?ç±»åŽ»å®Œæˆ?
                }
            } catch (Throwable t) {
                logger.warn(
                        "Unexpected exception in the selector loop.", t);
                // Prevent possible consecutive immediate failures that lead to
                // excessive CPU consumption.
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                }
            }
        }
}
</pre>
<p>Â è¿™ä¸ªç±»è¿˜æœ‰ä¸¤ä¸ªæ–¹æ³•å€¼å¾—è§£é‡Šä¸€ä¸‹ï¼Œçœ‹å®Œè¿™ä¸¤ä¸ªæ–¹æ³•å†?çœ‹processæ–¹æ³•Â </p>
<p class="MsoNormal">Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">//è¿™ä¸ªæ–¹æ³•åœ¨Bossçº¿ç¨‹ä¸­è¢«è°ƒç”¨åœ¨Channelè¢«bindåˆ°æœ¬åœ°ç«¯å?£(Server)æˆ–æˆ?åŠŸè¿žæŽ¥åˆ°æœ?åŠ¡å™¨(Clientç«¯)çš„æ—¶å€™è¢«è°ƒç”¨
public void register(Channel channel, ChannelFuture future) {
        Runnable task = createRegisterTask(channel, future);//å…·ä½“çš„æ³¨å†Œæ“?ä½œäº¤ç”±å­?ç±»åŽ»å®Œæˆ?,é€?éœ²ä¸€ä¸‹ è¿™ä¸ªtaské?¢ä¼šæœ‰socketChannel.registeræ–¹æ³•çš„è°ƒç”¨
        registerTask(task);
    }

    protected final void registerTask(Runnable task) {
        taskQueue.add(task);

        Selector selector = this.selector;

        if (selector != null) {
            if (wakenUp.compareAndSet(false, true)) {//å”¤é†’IOçº¿ç¨‹,è¿™ä¸ªCASæ“?ä½œæ˜¯é˜²æ­¢Selectorè¢«è¿‡æ—©çš„å”¤é†’çš„æƒ…å†µä¸‹å¯¼è‡´ä¿¡å?·ä¸¢å¤±.è¯·å?‚çœ‹AbstractNioSelectorç±»æº?ç ?282è¡Œä¸Šé?¢çš„è§£é‡Š
                selector.wakeup();
            }
        } else {
            if (taskQueue.remove(task)) {
                // the selector was null this means the Worker has already been shutdown.
                throw new RejectedExecutionException("Worker has already been shutdown");
            }
        }
    }
</pre>
<p>Â å­?ç±»AbstractNioWorkeré‡?å†™äº†processæ–¹æ³•æ?¥å¤„ç?†SelectionKeyÂ </p>
<p class="MsoNormal">Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">protected void process(Selector selector) throws IOException {
        Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();
        if (selectedKeys.isEmpty()) {
            return;
        }
        for (Iterator&lt;SelectionKey&gt; i = selectedKeys.iterator(); i.hasNext();) {
            SelectionKey k = i.next();
            i.remove();
            try {
                int readyOps = k.readyOps();
                if ((readyOps &amp; SelectionKey.OP_READ) != 0 || readyOps == 0) {
                    if (!read(k)) {//è°ƒç”¨æŠ½è±¡æ–¹æ³•è¯»å?–æ•°æ?®ï¼Œå¦‚æžœæ­¤æ–¹æ³•è¿”å›žfalseåˆ™è¡¨ç¤ºè¿žæŽ¥å·²ç»?è¢«å…³é—­ï¼Œæ— éœ€å†?å?šå¤„ç?†
                        continue;
                    }
                }
                if ((readyOps &amp; SelectionKey.OP_WRITE) != 0) {
                    writeFromSelectorLoop(k);//å¦‚æžœè¯¥Selectorä¸­è§¦å?‘äº†å†™äº‹ä»¶åˆ™å†™å‡ºæ•°æ?®ã€‚ç”¨æˆ·ä»£ç ?è°ƒç”¨channel.write(obj)æ–¹æ³•å?Žæ•°æ?®å¹¶ä¸?æ˜¯é©¬ä¸Šè¢«å†™å‡ºï¼Œè€Œæ˜¯è¢«æ??äº¤Channelçš„writeBufferQueueé˜Ÿåˆ—ä¸­(sinkæ”¾çš„)ç­‰å¾…IOçº¿ç¨‹åŽ»å®Œæˆ?å†™å‡ºï¼Œå†™æ“?ä½œå®žé™…ä¸Šæ˜¯ç”±write0è¿™ä¸ªæ–¹æ³•å®Œæˆ?çš„.
                }
            } catch (CancelledKeyException e) {
                close(k);//å‡ºå½¢å¼‚å¸¸å…³é—­Channelå¹¶é‡Šæ”¾ç›¸å…³èµ„æº?
            }

            if (cleanUpCancelledKeys()) {
                break; // break the loop to avoid ConcurrentModificationException
            }
        }
    }
</pre>
<p>Â å…ˆçœ‹è¯¥ç±»çš„å…¶å®ƒå‡ ä¸ªé‡?è¦?çš„æ–¹æ³•å†?çœ‹NioWorkerç±»çš„æ–¹æ³•Â </p>
<p class="MsoNormal">Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">/**
 * è¿™ä¸ªæ–¹æ³•æ˜¯ç”±sinkè°ƒç”¨çš„,sinkå°†è¦?å†™å‡ºçš„æ•°æ?®offeråˆ°writeBufferQueueä¸­ç„¶å?Žè°ƒç”¨è¯¥æ–¹æ³•(ä¸Šé?¢è§£é‡Šprocessæ–¹æ³•ä¸­æœ‰æ??åˆ°)
*/
void writeFromUserCode(final AbstractNioChannel&lt;?&gt; channel) {
        if (!channel.isConnected()) {
	//å¦‚æžœChannelå·²ç»?å…³é—­åˆ™æ²¡å¿…è¦?ç»§ç»­å†™äº†
            cleanUpWriteBuffer(channel);
            return;
        }

        if (scheduleWriteIfNecessary(channel)) {
	//è¿™æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®žçŽ°åœ¨NioWorkerç±»ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­åˆ¤æ–­å½“å‰?çº¿ç¨‹æ˜¯å?¦ä¸ºIOçº¿ç¨‹ï¼Œå¦‚æžœæ˜¯åˆ™è¿”å›žfalse,å?¦åˆ™å?‘IOçº¿ç¨‹çš„ ä»»åŠ¡é˜Ÿåˆ—æ·»åŠ ä¸€ä¸ªå†™å‡ºä»»åŠ¡å¹¶è¿”å›žtrue
            return;
        }

	//åˆ°è¿™é‡Œï¼Œå°±èƒ½ç¡®å®šå½“å‰?çº¿ç¨‹æ˜¯å?¦æ˜¯IOçº¿ç¨‹
        if (channel.writeSuspended) {//å¦‚æžœå†™å‡ºé€šé?“è¢«æŒ‚èµ·ï¼Œåˆ™è¿”å›ž
            return;
        }

        if (channel.inWriteNowLoop) {//å½“å‰?æ­£åœ¨å†™æ•°æ?®ï¼Œåˆ™è¿”å›ž
            return;
        }

        write0(channel);//å†™å‡ºæ•°æ?®
    }
protected void write0(AbstractNioChannel&lt;?&gt; channel) {
        boolean open = true;//æ ‡è®°channelæ˜¯å?¦å¤„ç?†æ‰“å¼€çŠ¶æ€?
        boolean addOpWrite = false;//æ˜¯å?¦å?‘æ­¤Channelå…³è?”çš„SelectionKeyçš„interestOpsæ·»åŠ SelectionKey.OP_WRITE,è¿™ä¼šå¯¼è‡´å‰?é?¢çš„processæ–¹æ³•ä¸­è¿™å?¥ä»£ç ?â€œif ((readyOps &amp; SelectionKey.OP_WRITE) != 0) â€?è¿”å›žtrueï¼Œç„¶å?Žå†?æ¬¡è§¦å?‘å†™æ“?ä½œ
        boolean removeOpWrite = false;//ä¸Žä¸Šé?¢å¯¹åº”
        boolean iothread = isIoThread(channel);//å½“å‰?çº¿ç¨‹æ˜¯å?¦æ˜¯è¯¥Channelçš„å·¥ä½œçº¿ç¨‹

        long writtenBytes = 0;

        final SocketSendBufferPool sendBufferPool = this.sendBufferPool;
        final WritableByteChannel ch = channel.channel;
        final Queue&lt;MessageEvent&gt; writeBuffer = channel.writeBufferQueue;
        final int writeSpinCount = channel.getConfig().getWriteSpinCount();//æœ€å¤šå°?è¯•å†™çš„æ¬¡æ•°
        List&lt;Throwable&gt; causes = null;

        synchronized (channel.writeLock) {
            channel.inWriteNowLoop = true;//ä¸Šé?¢æ??åˆ°è¿‡è¿™ä¸ªwriteFromUserCodeæ–¹æ³•
            for (;;) {

                MessageEvent evt = channel.currentWriteEvent;
                SendBuffer buf = null;
                ChannelFuture future = null;
                try {
                    if (evt == null) {
                        if ((channel.currentWriteEvent = evt = writeBuffer.poll()) == null) {
//å¦‚æžœæ²¡æœ‰è¦?å†™çš„ä¸œè¥¿ï¼Œåˆ™æ‰“ä¸ªæ ‡è®°ï¼Œåœ¨å?Žé?¢å?‘æ­¤Channelå…³è?”çš„SelectionKeyçš„interestOpsç§»é™¤SelectionKey.OP_WRITE
                            removeOpWrite = true;
                            channel.writeSuspended = false;
                            break;
                        }
                        future = evt.getFuture();

                        channel.currentWriteBuffer = buf = sendBufferPool.acquire(evt.getMessage());
                    } else {
                        future = evt.getFuture();
                        buf = channel.currentWriteBuffer;
                    }

                    long localWrittenBytes = 0;
			//ä¸‹é?¢çš„ä»£ç ?å°?è¯•å?‘é€?æ•°æ?®ï¼Œç›´åˆ°æœ‰æ•°æ?®è¢«å†™å‡ºï¼Œå?¦åˆ™å°½å?¯èƒ½çš„å°?è¯•
                    for (int i = writeSpinCount; i &gt; 0; i --) {
                        localWrittenBytes = buf.transferTo(ch);
                        if (localWrittenBytes != 0) {
                            writtenBytes += localWrittenBytes;
                            break;
                        }
                        if (buf.finished()) {
                            break;
                        }
                    }

                    if (buf.finished()) {
                        //å¦‚æžœå½“å‰?æ¶ˆæ?¯å·²ç»?å†™å®Œäº†é‡Šæ”¾èµ„æº?ï¼Œå¹¶å‡†å¤‡ä¸‹ä¸€æ?¡æ¶ˆæ?¯çš„å†™å‡º
                        buf.release();
                        channel.currentWriteEvent = null;
                        channel.currentWriteBuffer = null;
                        // Mark the event object for garbage collection.
                        //noinspection UnusedAssignment
                        evt = null;
                        buf = null;
                        future.setSuccess();
                    } else {
                        //æ²¡æœ‰å…¨éƒ¨å†™å®Œï¼Œåˆ™æ‰“ä¸ŠaddOpWriteæ ‡è®°ï¼Œå¹¶è®¾ç½®å†™å‡ºè¿›åº¦
                        addOpWrite = true;
                        channel.writeSuspended = true;

                        if (localWrittenBytes &gt; 0) {
                            // Notify progress listeners if necessary.
                            future.setProgress(
                                    localWrittenBytes,
                                    buf.writtenBytes(), buf.totalBytes());
                        }
                        break;
                    }
                } catch (AsynchronousCloseException e) {
                    // Doesn't need a user attention - ignore.
                } catch (Throwable t) {
                    if (buf != null) {
                        buf.release();
                    }
                    channel.currentWriteEvent = null;
                    channel.currentWriteBuffer = null;
                    // Mark the event object for garbage collection.
                    //noinspection UnusedAssignment
                    buf = null;
                    //noinspection UnusedAssignment
                    evt = null;
                    if (future != null) {
                        future.setFailure(t);//é€šçŸ¥æ¶ˆæ?¯å†™å‡ºå¤±è´¥
                    }
                    if (iothread) {
                        // An exception was thrown from within a write in the iothread. We store a reference to it
                        // in a list for now and notify the handlers in the chain after the writeLock was released
                        // to prevent possible deadlock.
                        // See #1310
			//å¦‚æžœå¼‚å¸¸åœ¨IOçº¿ç¨‹ä¸­è¢«æŠ›å‡ºï¼Œåˆ™å­˜å‚¨å®ƒçš„ä¸€ä¸ªå¼•ç”¨ï¼Œå¾…é”?é‡Šæ”¾å?Žè§¦å?‘pipelineçš„UpStreamä»¥é˜²æ­¢æ­»é”?
                        if (causes == null) {
                            causes = new ArrayList&lt;Throwable&gt;(1);
                        }
                        causes.add(t);
                    } else {
                        fireExceptionCaughtLater(channel, t);
                    }
                    if (t instanceof IOException) {
                        // close must be handled from outside the write lock to fix a possible deadlock
                        // which can happen when MemoryAwareThreadPoolExecutor is used and the limit is exceed
                        // and a close is triggered while the lock is hold. This is because the close(..)
                        // may try to submit a task to handle it via the ExecutorHandler which then deadlocks.
                        // See #1310
                        open = false;
                    }
                }
            }
            channel.inWriteNowLoop = false;
			// Initially, the following block was executed after releasing
            // the writeLock, but there was a race condition, and it has to be
            // executed before releasing the writeLock:
            //
            //     https://issues.jboss.org/browse/NETTY-410
            //
            //è¿™ä¸ªissuesæ˜¯è¯´ ä¹‹å‰?ä¸‹é?¢è¿™æ®µä»£ç ?æ˜¯è¢«æ”¾åˆ°å?Œæ­¥æ®µä¹‹å¤–çš„ï¼Œå¯¼è‡´æœªå®Œå…¨å†™å®Œçš„æ•°æ?®ä¸¢å¤±çš„é—®é¢˜ï¼Œæ‰€ä»¥ç§»åˆ°å?Œæ­¥å?—é‡Œé?¢æ?¥äº†ã€‚
            if (open) {
                if (addOpWrite) {
                    setOpWrite(channel);
                } else if (removeOpWrite) {
                    clearOpWrite(channel);
                }
            }
        }
        if (causes != null) {
            for (Throwable cause: causes) {
                // notify about cause now as it was triggered in the write loop
                fireExceptionCaught(channel, cause);
            }
        }
        if (!open) {
            // close the channel now
            close(channel, succeededFuture(channel));
        }
        if (iothread) {
            fireWriteComplete(channel, writtenBytes);
        } else {
            fireWriteCompleteLater(channel, writtenBytes);
        }
    }
</pre>
<p>Â AbstractNioSelectorç±»æŠŠIOçº¿ç¨‹çš„æž„æž¶æ?­èµ·æ?¥, AbstractNioWorkerç±»å®žçŽ°äº†æ•°æ?®çš„å†™å‡ºé€»è¾‘ï¼Œå?ªç•™ä¸‹å?˜åŒ–çš„éƒ¨åˆ†äº¤ç»™å­?ç±»åŽ»å®Œæˆ?ã€‚çŽ°åœ¨æ?¥çœ‹æ?¥NioWorkerç±»çš„å‡ ä¸ªæ¯”è¾ƒé‡?è¦?çš„æ–¹æ³•</p>
<p>Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">protected boolean read(SelectionKey k) {
        final SocketChannel ch = (SocketChannel) k.channel();
        final NioSocketChannel channel = (NioSocketChannel) k.attachment();

//èŽ·å?–ç¼“å­˜å¤§å°?åˆ†é…?ç­–ç•¥,Nettyä¸­ç¼“å­˜åˆ†é…?ç­–ç•¥æœ‰2ç§?ï¼Œä¸€ç§?æ˜¯è‡ªåŠ¨æ‰©å±•çš„ç¼“å­˜åˆ†é…?ç­–ç•¥ï¼Œå?¦ä¸€ç§?æ˜¯å›ºå®šå¤§å°?çš„ç¼“å­˜åˆ†é…?ç­–ç•¥ã€‚è‡ªåŠ¨æ‰©å±•çš„ç¼“å­˜åˆ†é…?ç­–ç•¥å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªç¼“å­˜å¤§å°?çš„intæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å€¼åˆ†æ®µæŒ‰ä¸€å®šæ•°é‡?é€’å¢ž
        final ReceiveBufferSizePredictor predictor =
            channel.getConfig().getReceiveBufferSizePredictor();
        final int predictedRecvBufSize = predictor.nextReceiveBufferSize();//èŽ·å?–ä¸‹ä¸€ä¸ªæŽ¥æ”¶ç¼“å†²åŒºå¤§å°?
        final ChannelBufferFactory bufferFactory = channel.getConfig().getBufferFactory();

        int ret = 0;
        int readBytes = 0;
        boolean failure = true;

        ByteBuffer bb = recvBufferPool.get(predictedRecvBufSize).order(bufferFactory.getDefaultOrder());//recvBufferPoolç›®çš„æ˜¯ä¸ºäº†ç¼“å­˜é‡?ç”¨
        try {
			//è¯»å?–Channelä¸­çš„æ•°æ?®ï¼Œç›´åˆ°ç¼“å†²åŒºæ»¡æˆ–æ²¡æœ‰å?¯è¯»çš„å­—èŠ‚
            while ((ret = ch.read(bb)) &gt; 0) {
                readBytes += ret;
                if (!bb.hasRemaining()) {
                    break;
                }
            }
            failure = false;
        } catch (ClosedChannelException e) {
            // Can happen, and does not need a user attention.
        } catch (Throwable t) {
            fireExceptionCaught(channel, t);
        }

        if (readBytes &gt; 0) {
            bb.flip();

            final ChannelBuffer buffer = bufferFactory.getBuffer(readBytes);
            buffer.setBytes(0, bb);
            buffer.writerIndex(readBytes);

            //å?‘ç¼“å­˜åˆ†é…?ç­–ç•¥æŠ¥å‘Šå½“å‰?è¯»åˆ°çš„ç¼“å­˜å¤§å°?ï¼Œä»¥é¢„è®¡ç®—ä¸‹ä¸€æ¬¡çš„ç¼“å­˜å¤§å°?
            predictor.previousReceiveBufferSize(readBytes);

            // è§¦å?‘MessageReceive UpStream
            fireMessageReceived(channel, buffer);
        }

        if (ret &lt; 0 || failure) {//å¦‚æžœä»£ç ?æ‰§è¡Œåˆ°è¿™ï¼Œåˆ™è¡¨ç¤ºæ­¤Channelä¸?å?¯ç”¨
            k.cancel(); // Some JDK implementations run into an infinite loop without this.
            close(channel, succeededFuture(channel));
            return false;
        }

        return true;
    }
//è¿™ä¸ªæ–¹æ³•å®žçŽ°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œè¿”å›žChannelæ³¨å†Œåˆ°IOçº¿ç¨‹çš„Task.è¿™ä¸ªæ–¹æ³•ä¸€å®šæ˜¯åœ¨Bossçº¿ç¨‹ä¸­è¢«è°ƒç”¨çš„ï¼Œå½“bossçº¿ç¨‹æŽ¥æ”¶åˆ°æ–°çš„è¿žæŽ¥æˆ–ä¸€æ?¡æ–°çš„è¿žæŽ¥ä¸Žæœ?åŠ¡ç«¯å»ºç«‹ï¼Œåˆ™è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åˆ›å»ºçš„Taskå®Œæˆ?å°†Channelæ³¨å†Œåˆ°å·¥ä½œçº¿ç¨‹çš„Selectorä¸Š
protected Runnable createRegisterTask(Channel channel, ChannelFuture future) {
        boolean server = !(channel instanceof NioClientSocketChannel);
        return new RegisterTask((NioSocketChannel) channel, future, server);
    }

    private final class RegisterTask implements Runnable {
        private final NioSocketChannel channel;
        private final ChannelFuture future;
        private final boolean server;

        RegisterTask(
                NioSocketChannel channel, ChannelFuture future, boolean server) {

            this.channel = channel;
            this.future = future;
            this.server = server;
        }

        public void run() {
            SocketAddress localAddress = channel.getLocalAddress();
            SocketAddress remoteAddress = channel.getRemoteAddress();

            if (localAddress == null || remoteAddress == null) {
                if (future != null) {
                    future.setFailure(new ClosedChannelException());
                }
                close(channel, succeededFuture(channel));
                return;
            }

            try {
                if (server) {
                    channel.channel.configureBlocking(false);
                }

                channel.channel.register(
                        selector, channel.getRawInterestOps(), channel);//æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶(OP_READ)ï¼Œåœ¨write0æ–¹æ³•ä¸­ä¼šæ·»åŠ æˆ–ç§»é™¤OP_WRITE(è¯·å?‚çœ‹ä¸Šé?¢çš„write0æ–¹æ³•)

                if (future != null) {
                    channel.setConnected();
                    future.setSuccess();
                }

                if (server || !((NioClientSocketChannel) channel).boundManually) {//è§¦å?‘BOUNDäº‹ä»¶
                    fireChannelBound(channel, localAddress);
                }
//è§¦å?‘Connectedäº‹ä»¶
                fireChannelConnected(channel, remoteAddress);
            } catch (IOException e) {
                if (future != null) {
                    future.setFailure(e);
                }
                close(channel, succeededFuture(channel));
                if (!(e instanceof ClosedChannelException)) {
                    throw new ChannelException(
                            "Failed to register a socket to the selector.", e);
                }
            }
        }
    } 
</pre>
<p>Â åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œ NioWorkerå·¥ä½œçº¿ç¨‹(IOçº¿ç¨‹)æ ¸å¿ƒè·¯å¾„å·²ç»?åŸºæœ¬åˆ†æž?å®Œæ¯•ï¼ŒçŽ°åœ¨æ?¥çœ‹NioWorkerå®ƒä¸»è¦?æ˜¯å?šä¸‹é?¢è¿™ä¸¤ä»¶äº‹ã€‚</p>
<p><span style="line-height: 1.5;">Â </span></p>
<p><span style="line-height: 1.5;">1ã€?æ‰§è¡Œå†…éƒ¨å·¥ä½œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span></p>
<p class="MsoNormal"><span style="line-height: 1.5;">2ã€?å¤„ç?†SelectionKeyçš„è¯»å†™äº‹ä»¶</span></p>
<p class="MsoNormal"><span style="line-height: 1.5;">Â </span></p>
<p class="MsoNormal">Â </p>
<p class="MsoNormal">æˆ‘ä»¬çŸ¥é?“å¦‚æžœSelectorä¸?è¢«æ³¨å†Œåˆ°java.nio.channels.SelectableChannelä¸Šï¼Œå®ƒæ˜¯æ²¡æœ‰ä»»ä½•ä½œç”¨çš„ã€‚é‚£ä»€ä¹ˆæ—¶å€™å°†è¢«æ³¨å†Œåˆ°SelectableChannelä¸Šå‘¢(ä¸Šé?¢æ??åˆ°è¿‡RegisterTaskçš„è?Œè´£)?Bossçº¿ç¨‹ï¼Œæˆ‘ä»¬æ?¥çœ‹ä¸‹NioServerBossè¿™ä¸ªç±»</p>
<p class="MsoNormal"><strong>NioServerBoss</strong></p>
<p class="MsoNormal">è¯¥ç±»ç»§æ‰¿è‡ªAbstractNioSelectorç±»å¹¶ä¸”å®žçŽ°äº†processæŠ½è±¡æ–¹æ³•å¤„ç?†SelectionKeyå…³äºŽAbstractNioSelectorç±»å‰?é?¢å·²ç»?æ??è¿‡äº†ï¼Œprocessæ–¹æ³•</p>
<p class="MsoNormal">Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">protected void process(Selector selector) {
        Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();
        if (selectedKeys.isEmpty()) {
            return;
        }
        for (Iterator&lt;SelectionKey&gt; i = selectedKeys.iterator(); i.hasNext();) {
            SelectionKey k = i.next();
            i.remove();
            NioServerSocketChannel channel = (NioServerSocketChannel) k.attachment();

            try {
                for (;;) {
//èŽ·å?–æ–°è¿žæŽ¥åˆ°æœ?åŠ¡ç«¯çš„çš„SocketChannel
                    SocketChannel acceptedSocket = channel.socket.accept();
                    if (acceptedSocket == null) {
                        break;
                    }
//å?–å‡ºChannelï¼Œå¹¶æ³¨å†Œåˆ°IOçº¿ç¨‹
                    registerAcceptedChannel(channel, acceptedSocket, thread);
                }
            } catch (CancelledKeyException e) {
                // Raised by accept() when the server socket was closed.
                k.cancel();
                channel.close();
            } catch (SocketTimeoutException e) {
                // Thrown every second to get ClosedChannelException
                // raised.
            } catch (ClosedChannelException e) {
                // Closed as requested.
            } catch (Throwable t) {
                if (logger.isWarnEnabled()) {
                    logger.warn(
                            "Failed to accept a connection.", t);
                }

                try {
//é?¿å…?åœ¨å‡ºçŽ°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæ— çº¿å¾ªçŽ¯å¯¼è‡´cpuèµ„æº?æµªè´¹
                    Thread.sleep(1000);
                } catch (InterruptedException e1) {
                    // Ignore
                }
            }
        }
}
private static void registerAcceptedChannel(NioServerSocketChannel parent, SocketChannel acceptedSocket,
                                         Thread currentThread) {
        try {
            ChannelSink sink = parent.getPipeline().getSink();
            ChannelPipeline pipeline =
                    parent.getConfig().getPipelineFactory().getPipeline();
            NioWorker worker = parent.workerPool.nextWorker();//èŽ·å?–ä¸€ä¸ªå·¥ä½œçº¿ç¨‹
			//NioWorkerç±»çš„registeræ–¹æ³•å®Œæˆ?æ³¨å†Œï¼Œä¹‹å‰?è¯´è¿‡çš„
            worker.register(new NioAcceptedSocketChannel(
                    parent.getFactory(), pipeline, parent, sink
                    , acceptedSocket,
                    worker, currentThread), null);
        } catch (Exception e) {
            if (logger.isWarnEnabled()) {
                logger.warn(
                        "Failed to initialize an accepted socket.", e);
            }

            try {
                acceptedSocket.close();
            } catch (IOException e2) {
                if (logger.isWarnEnabled()) {
                    logger.warn(
                            "Failed to close a partially accepted socket.",
                            e2);
                }
            }
        }
    }
</pre>
<p>Â è¯¥ç±»å?Œæ ·ä¹Ÿæœ‰å®žçŽ°äº†çˆ¶ç±»çš„createRegisterTaskæ–¹æ³•æ?¥åˆ›å»ºå¹¶è¿”å›žä¸€ä¸ªTaskï¼Œè¿™ä¸ªTaskè´Ÿè´£ç›‘å?¬å®¢æˆ·ç«¯è¿žæŽ¥Channelï¼Œå¹¶æŠŠChannelæ³¨å†Œåˆ°IOçº¿ç¨‹ä¸Š.åœ¨å?Žé?¢è®²çš„NioServerSocketPipelineSinkç±»ä¼šè°ƒç”¨æ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•</p>
<p>Â </p>
<p class="MsoNormal">Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">void bind(final NioServerSocketChannel channel, final ChannelFuture future,
              final SocketAddress localAddress) {
        registerTask(new RegisterTask(channel, future, localAddress));//è¿™é‡Œä¼šè°ƒçˆ¶ç±»çš„registerTaskæ–¹æ³•ï¼Œçˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ªæ¨¡æ?¿æ–¹æ³•ï¼Œå…·ä½“bindä»»åŠ¡çš„åˆ›å»ºä¼šè°ƒç”¨è¯¥ç±»çš„createRegisterTaskæ–¹æ³•
}

protected Runnable createRegisterTask(Channel channel, ChannelFuture future) {
        return new RegisterTask((NioServerSocketChannel) channel, future, null);
    }

    private final class RegisterTask implements Runnable {
        private final NioServerSocketChannel channel;
        private final ChannelFuture future;
        private final SocketAddress localAddress;

        public RegisterTask(final NioServerSocketChannel channel, final ChannelFuture future,
                            final SocketAddress localAddress) {
            this.channel = channel;
            this.future = future;
            this.localAddress = localAddress;
        }

        public void run() {
            boolean bound = false;
            boolean registered = false;
            try {
                channel.socket.socket().bind(localAddress, channel.getConfig().getBacklog());//ç»‘å®šåˆ°æœ¬åœ°
                bound = true;

                future.setSuccess();
                fireChannelBound(channel, channel.getLocalAddress());
                channel.socket.register(selector, SelectionKey.OP_ACCEPT, channel);//å°†æ­¤IOçº¿ç¨‹çš„Selectoræ³¨å†Œåˆ°è¯¥ServerSocketChannelä¸Š

                registered = true;
            } catch (Throwable t) {
                future.setFailure(t);
                fireExceptionCaught(channel, t);
            } finally {
                if (!registered &amp;&amp; bound) {
                    close(channel, future);
                }
            }
        }
    }
</pre>
<p>Â çŽ°åœ¨çŸ¥é?“IOçº¿ç¨‹(NioWorker)çš„Selectoråœ¨ä»€ä¹ˆæ—¶å€™è¢«æ³¨å†Œåˆ°SelectableChannelä¸Šäº†ï¼Œé‚£Bossçº¿ç¨‹çš„Selectoræ˜¯ä»€ä¹ˆæ—¶å€™è¢«æ³¨å†Œåˆ°SelectableChannelå‘¢ï¼ŸServerBootstrapçš„bindæ–¹æ³•ã€‚</p>
<p>Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">public Channel bind(final SocketAddress localAddress) {
        ChannelFuture future = bindAsync(localAddress);

        // ç­‰å¾…å®Œæˆ?
        future.awaitUninterruptibly();
        if (!future.isSuccess()) {
            future.getChannel().close().awaitUninterruptibly();
            throw new ChannelException("Failed to bind to: " + localAddress, future.getCause());
        }

        return future.getChannel();
    }

public ChannelFuture bindAsync(final SocketAddress localAddress) {
        if (localAddress == null) {
            throw new NullPointerException("localAddress");
        }
        Binder binder = new Binder(localAddress);
        ChannelHandler parentHandler = getParentHandler();

        ChannelPipeline bossPipeline = pipeline();
        bossPipeline.addLast("binder", binder);//æ³¨æ„?è¿™ä¸ª
        if (parentHandler != null) {
            bossPipeline.addLast("userHandler", parentHandler);
        }
		//newChannelå®žé™…ä¸Šæ˜¯è°ƒç”¨çš„NioServerSocketChannelFactory.newChannelæ–¹æ³•new NioServerSocketChannelï¼ŒNioServerSocketChannelæž„é€ æ–¹æ³•åˆ›å»ºå®ŒServerSocketChannelå?Žä¼šè§¦å?‘UpStream(ChannelState.OPENäº‹ä»¶)è¿™ä¸ªäº‹ä»¶è¢«ServerBootstrapç±»çš„å†…éƒ¨ç±»Binderå¤„ç?†å¹¶å®Œæˆ?Selectorä¸ŽChannelçš„æ³¨å†Œæ“?ä½œ
        Channel channel = getFactory().newChannel(bossPipeline);
        final ChannelFuture bfuture = new DefaultChannelFuture(channel, false);
        binder.bindFuture.addListener(new ChannelFutureListener() {
            public void operationComplete(ChannelFuture future) throws Exception {
                if (future.isSuccess()) {
                    bfuture.setSuccess();
                } else {
                    // Call close on bind failure
                    bfuture.getChannel().close();
                    bfuture.setFailure(future.getCause());
                }
            }
        });
        return bfuture;
    }


private final class Binder extends SimpleChannelUpstreamHandler {

        private final SocketAddress localAddress;
        private final Map&lt;String, Object&gt; childOptions =
            new HashMap&lt;String, Object&gt;();
        private final DefaultChannelFuture bindFuture = new DefaultChannelFuture(null, false);
        Binder(SocketAddress localAddress) {
            this.localAddress = localAddress;
        }

        @Override
        public void channelOpen(
                ChannelHandlerContext ctx,
                ChannelStateEvent evt) {

            try {
                evt.getChannel().getConfig().setPipelineFactory(getPipelineFactory());

                // Split options into two categories: parent and child.
                Map&lt;String, Object&gt; allOptions = getOptions();
                Map&lt;String, Object&gt; parentOptions = new HashMap&lt;String, Object&gt;();
                for (Entry&lt;String, Object&gt; e: allOptions.entrySet()) {
                    if (e.getKey().startsWith("child.")) {
                        childOptions.put(
                                e.getKey().substring(6),
                                e.getValue());
                    } else if (!"pipelineFactory".equals(e.getKey())) {
                        parentOptions.put(e.getKey(), e.getValue());
                    }
                }

                // Apply parent options.
                evt.getChannel().getConfig().setOptions(parentOptions);
            } finally {
                ctx.sendUpstream(evt);
            }
			//è¿™é‡Œå°†NioServerSocketChannelç»‘å®šåˆ°æœ¬åœ°ç«¯å?£ï¼Œå¹¶è§¦å?‘Downstream(ChannelState.BOUND)äº‹ä»¶ï¼Œæœ€ç»ˆè¢«ä¼ é€’sinå¤„ç?†(NioServerSocketPipelineSink)
            evt.getChannel().bind(localAddress).addListener(new ChannelFutureListener() {
                public void operationComplete(ChannelFuture future) throws Exception {
                    if (future.isSuccess()) {
                        bindFuture.setSuccess();
                    } else {
                        bindFuture.setFailure(future.getCause());
                    }
                }
            });
        }
</pre>
<p class="MsoNormal">Â Â <span style="line-height: 1.5;">NioServerSocketPipelineSinkç±»ç”¨æ?¥å¤„ç?†æœ€åº•å±‚çš„äº‹ä»¶ã€‚</span></p>
<p class="MsoNormal">Â </p>
<pre class="wp-code-highlight prettyprint linenums:1">class NioServerSocketPipelineSink extends AbstractNioChannelSink {

    public void eventSunk(
            ChannelPipeline pipeline, ChannelEvent e) throws Exception {
        Channel channel = e.getChannel();
        if (channel instanceof NioServerSocketChannel) {
            handleServerSocket(e);//å¤„ç?†æœ?åŠ¡ç«¯Channel
        } else if (channel instanceof NioSocketChannel) {
            handleAcceptedSocket(e);//å¤„ç?†å®¢æˆ·ç«¯Channel
        }
    }

    private static void handleServerSocket(ChannelEvent e) {
        if (!(e instanceof ChannelStateEvent)) {
            return;
        }

        ChannelStateEvent event = (ChannelStateEvent) e;
        NioServerSocketChannel channel =
            (NioServerSocketChannel) event.getChannel();
        ChannelFuture future = event.getFuture();
        ChannelState state = event.getState();
        Object value = event.getValue();

        switch (state) {
        case OPEN://æ ¹æ?®ä¸€ä¸ªå€¼æ ‡è®°æ˜¯Openè¿˜æ˜¯Closeï¼Œå…¶å®ƒcaseä¹Ÿæ˜¯è¿™æ ·
            if (Boolean.FALSE.equals(value)) {
                ((NioServerBoss) channel.boss).close(channel, future);
            }
            break;
        case BOUND:
            if (value != null) {//åœ¨ServerBootStraupå†…éƒ¨ç±»Binderä¸­è§¦å?‘BOUNDäº‹ä»¶ï¼Œä¼ é€’æ­¤valueçš„å€¼ä¸ºlocalAddressï¼Œæ‰€ä»¥è¿›å…¥è¿™ä¸ªifè°ƒç”¨bossçš„bindæ–¹æ³•(NioServerBossç±»çš„)å®Œæˆ?åœ°å?€ç»‘å®šä¸ŽOP_ACCEPTçš„æ³¨å†Œï¼Œè¯·å?‚è§?ä¸Šé?¢è®²NioServerBossä¸­çš„bindæ–¹æ³•
                ((NioServerBoss) channel.boss).bind(channel, future, (SocketAddress) value);
            } else {
                ((NioServerBoss) channel.boss).close(channel, future);
            }
            break;
        default:
            break;
        }
    }

    private static void handleAcceptedSocket(ChannelEvent e) {
        if (e instanceof ChannelStateEvent) {
            ChannelStateEvent event = (ChannelStateEvent) e;
            NioSocketChannel channel = (NioSocketChannel) event.getChannel();
            ChannelFuture future = event.getFuture();
            ChannelState state = event.getState();
            Object value = event.getValue();

            switch (state) {
            case OPEN:
                if (Boolean.FALSE.equals(value)) {
                    channel.worker.close(channel, future);
                }
                break;
            case BOUND:
            case CONNECTED:
                if (value == null) {
                    channel.worker.close(channel, future);
                }
                break;
            case INTEREST_OPS:
                channel.worker.setInterestOps(channel, future, ((Integer) value).intValue());
                break;
            }
        } else if (e instanceof MessageEvent) {
            MessageEvent event = (MessageEvent) e;
            NioSocketChannel channel = (NioSocketChannel) event.getChannel();
            boolean offered = channel.writeBufferQueue.offer(event);//å°†æ¶ˆæ?¯æ??äº¤åˆ°è¯¥Channelçš„writeBufferä¸­
            assert offered;
            channel.worker.writeFromUserCode(channel);//å†™(ä¸?ä¸€å®šé©¬ä¸Šè¿›è¡Œå†™å…¥ï¼Œå®ƒä¼šæŠŠå†™å…¥å·¥ä½œæ”¾åˆ°IOçº¿ç¨‹ä¸­åŽ»å?š)
        }
    }
}</pre>
<p class="MsoNormal">Â  Â Nettyçš„ä»£ç ?å?¯ä»¥è¯´æ˜¯å?³æ¼‚äº®å?ˆç®€å?•ï¼Œäº†è§£å®žçŽ°åŽŸç?†å?Žï¼Œå†?åŽ»çœ‹ä»£ç ?æ„Ÿè§‰å¾ˆå®¹æ˜“ï¼Œå?‘çŽ°æ²¡ä»€ä¹ˆå?¯è®²çš„äº†&#8230;</p>
<p class="MsoNormal">Â </p>
						
		</td>
		</tr>
		</table>
		</div><!-- .entry-content -->
				<footer class="entry-meta">
			æœ¬æ?¡ç›®å?‘å¸ƒäºŽ <a href="http://www.w3c.com.cn/netty%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8bnioserversocketchannelfactory" title="ä¸Šå?ˆ 11:08" rel="bookmark"><time class="entry-date" datetime="2013-07-31T11:08:00+08:00">2013 å¹´ 7 æœˆ 31 æ—¥</time></a>ã€‚å±žäºŽ <a href="http://www.w3c.com.cn/category/%e7%a8%8b%e5%ba%8f%e5%91%98" title="æŸ¥çœ‹ ç¨‹åº?å‘˜ ä¸­çš„å…¨éƒ¨æ–‡ç« " rel="category tag">ç¨‹åº?å‘˜</a> åˆ†ç±»ã€‚<span class="by-author">ä½œè€…æ˜¯ <span class="author vcard">admin</span>ã€‚</span>			<span class="entry-counter"><span id="entry-view-num">0</span> æ¬¡æµ?è§ˆ</span>
						<!-- Baidu Button BEGIN -->
<div id="bdshare" class="bdshare_t bds_tools_32 get-codes-bdshare">
<a class="bds_tsina"></a>
<a class="bds_tqq"></a>
<a class="bds_t163"></a>
<a class="bds_twi"></a>
<a class="bds_fbook"></a>
<span class="bds_more"></span>
</div>
<script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6716486" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
</script>
<!-- Baidu Button END -->
		</footer><!-- .entry-meta -->
	</article><!-- #post -->
	
	
				<nav class="nav-single">
					<h3 class="assistive-text">æ–‡ç« å¯¼èˆª</h3>
					<span class="nav-previous"><a href="http://www.w3c.com.cn/c%e6%80%8e%e4%b8%b2%e5%8f%a3%e5%85%b3%e9%97%ad%e9%97%ae%e9%a2%98" rel="prev"><span class="meta-nav">&larr;</span> c#æ€Žä¸²å?£å…³é—­é—®é¢˜</a></span>
					<span class="nav-next"><a href="http://www.w3c.com.cn/delphi%e6%95%b0%e6%8d%ae%e5%92%8c%e8%a1%a8%e7%8e%b0%e6%98%af%e5%90%a6%e5%88%86%e5%bc%80%ef%bc%9f" rel="next">delphiæ•°æ?®å’Œè¡¨çŽ°æ˜¯å?¦åˆ†å¼€ï¼Ÿ <span class="meta-nav">&rarr;</span></a></span>
				</nav><!-- .nav-single -->

<div class="W3C-ads">
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3200764857528189"
     data-ad-slot="4974863353"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
				
				<!-- UYAN BEGIN -->
<div id=uyan_frame></div>
<script type=text/javascript id="UYScript" async="" src="http://v1.uyan.cc/js/iframe.js?UYUserId=1784569"></script>
<!-- UYAN END -->

			
		</div><!-- #content -->
	</div><!-- #primary -->

<div id="secondary" class="widget-area" role="complementary">
		<div class="first front-widgets">
<aside class="widget widget_search" id="search-2">
	<form onsubmit="if(q.value==''){q.focus();return false;}" target="_blank" action="http://www.google.com.hk/search" id="searchform" method="get">  
		<div>
			<label class="assistive-text" for="s">Search</label>
			<input type="text" placeholder="Search" id="s" name="q" class="field">
			<input type="submit" value="&lt;/&gt;" id="searchsubmit" name="submit" class="submit">
		</div>
		<input type="hidden" value="UTF-8" name="ie">
		<input type="hidden" value="UTF-8" name="oe">
		<input type="hidden" value="zh-CN" name="hl">
		<input type="hidden" value="www.w3c.com.cn" name="domains">
		<input type="hidden" value="www.w3c.com.cn" name="sitesearch">
	</form>
</aside>
<aside id="category-posts" class="widget widget_recent_entries">
<h2 class="widget-title">ç¨‹åº?å‘˜</h2>
<ul>
<li><a href="http://www.w3c.com.cn/springsecurity2session%e8%bf%87%e6%9c%9f%e6%8c%87%e5%ae%9a%e8%b7%b3%e8%bd%ac%e9%a1%b5%e9%9d%a2">SpringSecurity2sessionè¿‡æœŸæŒ‡å®šè·³è½¬é¡µé?¢</a></li>
<li><a href="http://www.w3c.com.cn/grails%e5%a4%9a%e5%af%b9%e4%b8%80%e5%85%b3%e8%81%94%e6%9f%a5%e8%af%a2%e7%9a%84%e8%b7%af%e5%be%84%e9%97%ae%e9%a2%98">grailså¤šå¯¹ä¸€å…³è?”æŸ¥è¯¢çš„è·¯å¾„é—®é¢˜</a></li>
<li><a href="http://www.w3c.com.cn/sublimetext2%e6%90%ad%e5%bb%bago%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83%ef%bc%88windows%ef%bc%89">SublimeText2æ?­å»ºGoå¼€å?‘çŽ¯å¢ƒï¼ˆWindowsï¼‰</a></li>
<li><a href="http://www.w3c.com.cn/%e4%bd%bf%e7%94%a8%e5%8d%95%e4%be%8b%e5%86%99jdbc%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e5%b7%a5%e5%85%b7%e7%b1%bb">ä½¿ç”¨å?•ä¾‹å†™JDBCæ“?ä½œæ•°æ?®åº“çš„å·¥å…·ç±»</a></li>
<li><a href="http://www.w3c.com.cn/%e5%9c%a8%e4%b8%8d%e6%98%afservlet%e7%9a%84%e6%99%ae%e9%80%9ajava%e6%96%87%e4%bb%b6%e4%b8%ad%e6%80%8e%e4%b9%88%e8%8e%b7%e5%8f%96%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%9a%84%e4%bf%a1%e6%81%af">åœ¨ä¸?æ˜¯servletçš„æ™®é€šJavaæ–‡ä»¶ä¸­æ€Žä¹ˆèŽ·å?–é…?ç½®æ–‡ä»¶çš„ä¿¡æ?¯</a></li>
<li><a href="http://www.w3c.com.cn/%e5%bc%80%e5%a7%8b%e5%86%99%e5%8d%9a%e5%ae%a2%e4%ba%86%e5%95%8a">å¼€å§‹å†™å?šå®¢äº†å•Š</a></li>
<li><a href="http://www.w3c.com.cn/java%e4%b8%adfinally%e5%ad%90%e5%8f%a5%e7%9a%84%e5%88%86%e6%9e%90">javaä¸­finallyå­?å?¥çš„åˆ†æž?</a></li>
<li><a href="http://www.w3c.com.cn/hadoop%e6%9d%83%e5%a8%81%e6%8c%87%e5%8d%97%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0">hadoopæ?ƒå¨?æŒ‡å?—è¯»ä¹¦ç¬”è®°</a></li>
<li><a href="http://www.w3c.com.cn/pig%e5%ae%9e%e6%88%98%ef%bc%88%e8%bd%ac%ef%bc%89">pigå®žæˆ˜ï¼ˆè½¬ï¼‰</a></li>
<li><a href="http://www.w3c.com.cn/erlang%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e7%bd%91%e7%bb%9c%e6%9e%b6%e6%9e%84">erlangæœ?åŠ¡å™¨ç«¯ç½‘ç»œæž¶æž„</a></li>
</ul>
</aside>
		<aside id="text-4" class="widget widget_text"><h2 class="widget-title">å¹¿è€Œå‘Šä¹‹</h2>			<div class="textwidget"><script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-3200764857528189"
     data-ad-slot="4510531751"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
		</aside><aside id="text-3" class="widget widget_text"><h2 class="widget-title">å›¾ä¹¦æŽ¨è??</h2>			<div class="textwidget"><ul class="menu">
<li><a href="http://www.w3c.com.cn/4bpa" target="_blank" rel="nofollow">ä»£ç ?ä¹‹ç¾Ž</a></li>
<li><a href="http://www.w3c.com.cn/lawc" target="_blank" rel="nofollow">æ•°æ?®ä¹‹ç¾Ž</a></li>
<li><a href="http://www.w3c.com.cn/1nhg" target="_blank" rel="nofollow">æ·±å…¥æµ…å‡ºè®¾è®¡æ¨¡å¼?</a></li>
<li><a href="http://www.w3c.com.cn/g08u" target="_blank" rel="nofollow">é»‘å®¢ä¸Žç”»å®¶</a></li>
<li><a href="http://www.w3c.com.cn/5c7i" target="_blank" rel="nofollow">ä¿¡æ?¯è®ºã€?ç¼–ç ?ä¸Žå¯†ç ?å­¦</a></li>
<li><a href="http://www.w3c.com.cn/bmue" target="_blank" rel="nofollow">ç²¾é€šæ­£åˆ™è¡¨è¾¾å¼?</a></li>
</ul></div>
		</aside><aside id="text-7" class="widget widget_text">			<div class="textwidget"></div>
		</aside><aside id="recent-comments-3" class="widget widget_recent_comments"><h2 class="widget-title">è¿‘æœŸè¯„è®º</h2><ul id="recentcomments"><li class="recentcomments">oilpainting å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/%e4%b8%80%e7%9b%b4%e6%b2%a1%e8%a7%a3%e5%86%b3%e7%9a%84%e9%94%99%e8%af%af%ef%bc%8c%e6%b1%82%e9%ab%98%e6%89%8b%e7%9f%a5%e9%81%93#comment-13228">ä¸€ç›´æ²¡è§£å†³çš„é”™è¯¯ï¼Œæ±‚é«˜æ‰‹çŸ¥é?“</a>ã€‹</li><li class="recentcomments">ms å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/%e6%9c%80%e8%bf%91%e6%89%93%e7%ae%97%e6%8a%8a%e7%9c%8b%e8%bf%87%e7%9a%84android%e5%ae%89%e5%85%a8%e7%9a%84%e6%96%87%e7%8c%ae%e6%95%b4%e7%90%86%e4%b8%80%e4%b8%8b%e3%80%82%e6%95%b4%e7%90%86%e4%b8%ad#comment-13229">æœ€è¿‘æ‰“ç®—æŠŠçœ‹è¿‡çš„androidå®‰å…¨çš„æ–‡çŒ®æ•´ç?†ä¸€ä¸‹ã€‚æ•´ç?†ä¸­ã€?æŒ?ç»­æ›´æ–°ï¼?~</a>ã€‹</li><li class="recentcomments">tey å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/mybatis-ognlexception#comment-13230">mybatis  OgnlException</a>ã€‹</li><li class="recentcomments">abc å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/%e5%a6%82%e4%bd%95%e4%bf%ae%e6%94%b9%e6%95%b0%e6%8d%ae%e5%ba%93%e8%a1%a8%e5%a6%82%e5%ad%97%e6%ae%b5%e6%9c%89%e5%80%bc%e5%b0%b1%e8%bf%bd%e5%8a%a0%ef%bc%8c%e6%b2%a1%e6%9c%89%e5%b0%b1%e6%9b%bf%e6%8d%a2#comment-13231">å¦‚ä½•ä¿®æ”¹æ•°æ?®åº“è¡¨,å¦‚å­—æ®µæœ‰å€¼å°±è¿½åŠ ï¼Œæ²¡æœ‰å°±æ›¿æ?¢ï¼Ÿï¼Ÿï¼Ÿ</a>ã€‹</li><li class="recentcomments">TEST å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/c%e4%bd%bf%e7%94%a8webbrower%e6%8e%a7%e4%bb%b6%e5%9c%a8editmode%e6%a8%a1%e5%bc%8f%e4%b8%8b%e9%9d%a2%e6%93%8d%e4%bd%9c%e8%a1%a8%e6%a0%bc%e7%9a%84%e5%90%88%e5%b9%b6%e7%ad%89%e6%93%8d%e4%bd%9c#comment-13232">C#ä½¿ç”¨WebBroweræŽ§ä»¶åœ¨EditModeæ¨¡å¼?ä¸‹é?¢æ“?ä½œè¡¨æ ¼çš„å?ˆå¹¶ç­‰æ“?ä½œ</a>ã€‹</li><li class="recentcomments">haimmmekkd å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/%e6%a0%91%e8%8e%93%e6%b4%be%e8%a3%85xbian%e3%80%81%e6%97%a0%e7%ba%bf%e7%bd%91%e5%8d%a1%e9%85%8d%e7%bd%ae%e3%80%81%e7%9c%8b%e7%94%b5%e5%bd%b1%e7%94%b5%e8%a7%86-%e7%bb%88%e6%9e%81%e8%8f%9c%e9%b8%9f#comment-13233">æ ‘èŽ“æ´¾è£…Xbianã€?æ— çº¿ç½‘å?¡é…?ç½®ã€?çœ‹ç”µå½±ç”µè§† ç»ˆæž?è?œé¸Ÿæ•™ç¨‹</a>ã€‹</li><li class="recentcomments"><a href='http://weibo.com/xiaojuna8' rel='external nofollow' class='url'>xiaojuna</a> å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/opencv-%e7%9b%ae%e5%bd%95%e6%96%87%e4%bb%b6%e9%81%8d%e5%8e%86#comment-13236">opencv ç›®å½•æ–‡ä»¶é??åŽ†</a>ã€‹</li><li class="recentcomments"><a href='http://weibo.com/xiaojuna8' rel='external nofollow' class='url'>xiaojuna</a> å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/opencv-%e7%9b%ae%e5%bd%95%e6%96%87%e4%bb%b6%e9%81%8d%e5%8e%86#comment-13234">opencv ç›®å½•æ–‡ä»¶é??åŽ†</a>ã€‹</li><li class="recentcomments">ITå°?ä¹¦ç«¥ å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/%e5%af%bb%e6%b1%82miniui%e7%a0%b4%e8%a7%a3%e7%89%88#comment-13279">å¯»æ±‚miniuiç ´è§£ç‰ˆ</a>ã€‹</li><li class="recentcomments">å±Œä¸? å?‘è¡¨åœ¨ã€Š<a href="http://www.w3c.com.cn/wtl%e4%b8%8bpretranslatemessage%e7%9a%84%e9%97%ae%e9%a2%98#comment-13235">WTLä¸‹PreTranslateMessageçš„é—®é¢˜</a>ã€‹</li></ul></aside>	</div><!-- .first -->
	
	</div><!-- #secondary -->	<!--WP Code Highlight_start-->
	<script type="text/javascript">
		window.onload = function(){prettyPrint();};
	</script>
	<script type="text/javascript" src="http://www.w3c.com.cn/wp-content/plugins/wp-code-highlight/js/wp-code-highlight.js"></script>
	<!--WP Code Highlight_end-->
	</div><!-- #main .wrapper -->
</div><!-- #page -->

<script type='text/javascript'>
/* <![CDATA[ */
var viewsCacheL10n = {"admin_ajax_url":"http:\/\/www.w3c.com.cn\/wp-admin\/admin-ajax.php","post_id":"2225922"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.w3c.com.cn/wp-content/plugins/wp-postviews/postviews-cache.js?ver=1.64'></script>
<script type='text/javascript' src='http://www.w3c.com.cn/wp-content/themes/twentytwelve/js/navigation.js?ver=1.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var post_ratings = {"blog_url":"http:\/\/www.w3c.com.cn\/"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.w3c.com.cn/wp-content/plugins/post-ratings/post-ratings.js?ver=2.4'></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40974733-1', 'w3c.com.cn');
  ga('send', 'pageview');

</script>


<script type="text/javascript">var ujian_config = {target:1};</script>
<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&btn=4&fade=1&uid=1784569"></script>
<a href="http://www.ujian.cc" style="border:0;"><img src="http://img.ujian.cc/pixel.png" alt="å?‹è??äº‘æŽ¨è??" style="border:0;padding:0;margin:0;" /></a>

</body>
</html>
