<!doctype html>
<!--[if gte IE 9]>
<html class="ie ie9">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8">
<![endif]-->
<!--[if IE 7]>
<html class="ie ie7">
<![endif]-->
<!--[if !IE]><!-->
<html lang="zh-CN">
 <!--<![endif]-->
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
	<title>Nettyä½¿ç”¨åˆ?æ­¥</title> 
	<link rel="pingback" href="http://www.chinasb.org/xmlrpc.php">
	<link rel="stylesheet" href="http://www.chinasb.org/wp-content/themes/modern-multipurpose/style.css" type="text/css">
<link rel="alternate" type="application/rss+xml" title="ç¨‹åº?çŒ¿æ—¥å¿— &raquo; Feed" href="http://www.chinasb.org/feed" />
<link rel="alternate" type="application/rss+xml" title="ç¨‹åº?çŒ¿æ—¥å¿— &raquo; è¯„è®ºFeed" href="http://www.chinasb.org/comments/feed" />
<link rel="alternate" type="application/rss+xml" title="ç¨‹åº?çŒ¿æ—¥å¿— &raquo; Nettyä½¿ç”¨åˆ?æ­¥è¯„è®ºFeed" href="http://www.chinasb.org/archives/2012/11/4966.shtml/feed" />
<link rel='stylesheet' id='wp-recentcomments-css'  href='http://www.chinasb.org/wp-content/plugins/wp-recentcomments/css/wp-recentcomments.css?ver=2.2.7' type='text/css' media='screen' />
<link rel='stylesheet' id='wp-pagenavi-css'  href='http://www.chinasb.org/wp-content/plugins/wp-pagenavi/pagenavi-css.css?ver=2.70' type='text/css' media='all' />
<link rel='stylesheet' id='lightboxStyle-css'  href='http://www.chinasb.org/wp-content/plugins/lightbox-plus/css/shadowed/colorbox.css?ver=2.6' type='text/css' media='screen' />
<script type='text/javascript' src='http://www.chinasb.org/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='http://www.chinasb.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://www.chinasb.org/wp-includes/js/comment-reply.min.js?ver=3.6.1'></script>
<script type='text/javascript' src='http://www.chinasb.org/wp-content/themes/modern-multipurpose/js/scripts.js?ver=3.6.1'></script>
<script type='text/javascript' src='http://www.chinasb.org/wp-content/themes/modern-multipurpose/js/html5.js?ver=3.6.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.chinasb.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.chinasb.org/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='MMORPGæœ?åŠ¡å™¨æž¶æž„' href='http://www.chinasb.org/archives/2012/11/4954.shtml' />
<link rel='next' title='Nettyå®žçŽ°åŽŸç?†æµ…æž?' href='http://www.chinasb.org/archives/2012/11/4967.shtml' />
<meta name="generator" content="WordPress 3.6.1" />
<link rel='shortlink' href='http://www.chinasb.org/?p=4966' />
<script type="text/javascript" src="http://www.chinasb.org/wp-content/plugins/flv-embed/swfobject.js"></script>
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>

<!-- All in One SEO Pack 2.0.4 by Michael Torbert of Semper Fi Web Design[382,408] -->
<meta name="keywords" content="netty" />

<link rel="canonical" href="http://www.chinasb.org/archives/2012/11/4966.shtml" />
		<script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-37350451-1']);
		  _gaq.push(['_trackPageview']);
		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		</script>
<!-- /all in one seo pack -->

</head>
<body class="single single-post postid-4966 single-format-standard">
	
	<header>
		<div>
			
			<div class="head-area">
            	<p class="title"><a href="http://www.chinasb.org/">ç¨‹åº?çŒ¿æ—¥å¿—</a></p>
           		<p class="tagline"></p>
            </div>
            <form method="get" class="searchform" action="http://www.chinasb.org">
<fieldset>
	<input type="text" value="" name="s" /><button type="submit" name="searchsubmit" value="Search"><span></span></button>
</fieldset>
</form>			
		</div>
	</header>
	<nav>
		<ul id="menu-navigation-menu" class="menu"><li id="menu-item-2596" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-2596"><a href="http://www.chinasb.org">é¦–é¡µ</a></li>
<li id="menu-item-2594" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2594"><a href="http://www.chinasb.org/ofc2">OFC2</a></li>
<li id="menu-item-2591" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2591"><a href="http://www.chinasb.org/nosql">NoSQLå®žæˆ˜</a></li>
<li id="menu-item-2593" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2593"><a href="http://www.chinasb.org/manual-shtml">å¼€å?‘æ‰‹å†Œ</a></li>
<li id="menu-item-4834" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4834"><a href="http://www.chinasb.org/it-link">ç«™ç‚¹å¯¼èˆª</a></li>
</ul>		<div class="clear"><!-- --></div>
	</nav>
	<section class="content"><div>
		<div class="main_content">
			<article class="post">
			<p class="post-date"><span>15</span> 11 2012</p>
				<div class="post-head">
					<h1>Nettyä½¿ç”¨åˆ?æ­¥ <span><g:plusone href="http://www.chinasb.org/archives/2012/11/4966.shtml"></g:plusone></span></h1>
					<p class="post-meta"><span><span class="icon author"></span> Ethan</span> | <span><span class="icon cats"></span><a href="http://www.chinasb.org/archives/category/java" title="æŸ¥çœ‹Javaä¸­çš„å…¨éƒ¨æ–‡ç« " >Java</a></span> | <a href="http://www.chinasb.org/archives/2012/11/4966.shtml#respond" class="comment-link"  title="ã€ŠNettyä½¿ç”¨åˆ?æ­¥ã€‹ä¸Šçš„è¯„è®º"><span class="icon comments"></span> 0</a></p>
				</div>
			<h2 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">1ã€?ç®€ä»‹</h2>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">Java1.4æ??ä¾›äº†NIOä½¿å¼€å?‘è€…å?¯ä»¥ä½¿ç”¨Javaç¼–å†™é«˜æ€§èƒ½çš„æœ?åŠ¡ç«¯ç¨‹åº?ï¼Œä½†ä½¿ç”¨åŽŸç”Ÿçš„NIO APIå°±åƒ?Linux Cä¸­ç½‘ç»œç¼–ç¨‹ä¸€æ ·ï¼Œè¿˜æ˜¯éœ€è¦?å?šIOå¤„ç?†ã€?å??è®®å¤„ç?†ç­‰ä½Žå±‚æ¬¡å·¥ä½œã€‚æ‰€ä»¥ï¼Œå°±åƒ?Cæœ?åŠ¡ç«¯ç¨‹åº?å¤§é‡?ä½¿ç”¨libeventä½œä¸ºç½‘ç»œåº”ç”¨æ¡†æž¶ä¸€æ ·ï¼ŒJavaç¤¾åŒºä¹Ÿä¸?æ–­æ¶ŒçŽ°å‡ºåŸºäºŽNIOçš„ç½‘ç»œåº”ç”¨æ¡†æž¶ã€‚åœ¨è¿™å…¶ä¸­ï¼ŒJbosså‡ºå“?çš„Nettyå°±æ˜¯ä¸ªä¸­ç¿˜æ¥šã€‚Nettyæ˜¯ä¸ªå¼‚æ­¥çš„äº‹ä»¶é©±åŠ¨ç½‘ç»œåº”ç”¨æ¡†æž¶ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€?é«˜æ‰©å±•æ€§ç­‰ç‰¹æ€§ã€‚Nettyæ??ä¾›äº†ç»Ÿä¸€çš„åº•å±‚å??è®®æŽ¥å?£ï¼Œä½¿å¾—å¼€å?‘è€…ä»Žåº•å±‚çš„ç½‘ç»œå??è®®ï¼ˆæ¯”å¦‚TCP/IPã€?UDPï¼‰ä¸­è§£è„±å‡ºæ?¥ã€‚å°±ä½¿ç”¨æ?¥è¯´ï¼Œå¼€å?‘è€…å?ªè¦?å?‚è€ƒ Nettyæ??ä¾›çš„è‹¥å¹²ä¾‹å­?å’Œå®ƒçš„æŒ‡å?—æ–‡æ¡£ï¼Œå°±å?¯ä»¥æ”¾æ‰‹å¼€å?‘åŸºäºŽNettyçš„æœ?åŠ¡ç«¯ç¨‹åº?äº†ã€‚</p>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">åœ¨Javaç¤¾åŒºï¼Œæœ€çŸ¥å??çš„å¼€æº?Java NIOæ¡†æž¶è¦?å±žMinaå’ŒNettyï¼Œè€Œä¸”ä¸¤è€…æ¸Šæº?é¢‡å¤šï¼Œå¯¹ä¸¤è€…çš„æ¯”è¾ƒè‡ªç„¶ä¸?å°‘ã€‚å®žé™…ä¸Šï¼ŒNettyçš„ä½œè€…åŽŸæ?¥å°±æ˜¯Minaä½œè€…ä¹‹ä¸€ï¼Œæ‰€ä»¥å?¯ä»¥æƒ³åˆ°ï¼ŒNettyå’ŒMinaåœ¨è®¾è®¡ç?†å¿µä¸Šä¼šæœ‰å¾ˆå¤šå…±å?Œç‚¹ã€‚æˆ‘å¯¹Minaæ²¡ä»€ä¹ˆç ”ç©¶ï¼Œä½†å…¶ä½œè€…ä»‹ç»?ï¼ŒNettyçš„è®¾è®¡å¯¹å¼€å?‘è€…æœ‰æ›´å?‹å¥½çš„æ‰©å±•æ€§ï¼Œå¹¶ä¸”æ€§èƒ½æ–¹é?¢è¦?ä¼˜äºŽMinaï¼Œè€ŒNettyå®Œå–„çš„æ–‡æ¡£ä¹Ÿå¾ˆå?¸å¼•äººã€‚æ‰€ä»¥ï¼Œå¦‚æžœä½ åœ¨å¯»æ‰¾Java NIOæ¡†æž¶ï¼ŒNettyæ˜¯ä¸ªå¾ˆä¸?é”™çš„é€‰æ‹©ã€‚æœ¬æ–‡çš„å†…å®¹å°±æ˜¯å›´ç»•ä¸€ä¸ªdemoä»‹ç»?ä½¿ç”¨Nettyçš„ç‚¹ç‚¹æ»´æ»´ã€‚</p>
<h2 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">2ã€?æœ?åŠ¡ç«¯ç¨‹åº?</h2>
<h3 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">2.1ã€?ChannelHandler</h3>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">æœ?åŠ¡ç«¯ç¨‹åº?é€šå¸¸çš„å¤„ç?†è¿‡ç¨‹æ˜¯ï¼šè§£ç ?è¯·æ±‚æ•°æ?®ã€?ä¸šåŠ¡é€»è¾‘å¤„ç?†ã€?ç¼–ç ?å“?åº”ã€‚ä»Žæ¡†æž¶è§’åº¦æ?¥è¯´ï¼Œå?¯ä»¥æ??ä¾›3ä¸ªæŽ¥å?£æ?¥æŽ§åˆ¶å¹¶è°ƒåº¦è¯¥å¤„ç?†è¿‡ç¨‹ï¼›ä»Žæ›´é€šç”¨çš„è§’åº¦æ?¥è¯´ï¼Œå¹¶ä¸?ç‰¹åŒ–å¤„ç?†å…¶ä¸­çš„æ¯?ä¸€æ­¥ï¼Œè€ŒæŠŠæ¯?ä¸€æ­¥å½“å?šè¿‡æ»¤å™¨é“¾ä¸­çš„ä¸€çŽ¯ï¼Œè¿™ä¹Ÿæ˜¯Nettyçš„å?šæ³•ã€‚Nettyå¯¹è¯·æ±‚å¤„ç?†è¿‡ç¨‹å®žçŽ°äº†è¿‡æ»¤å™¨é“¾æ¨¡å¼?ï¼ˆChannelPipelineï¼‰ï¼Œæ¯?ä¸ªè¿‡æ»¤å™¨å®žçŽ°äº†ChannelHandleræŽ¥å?£ã€‚Nettyä¸­æœ‰ä¸¤ç§?è¯·æ±‚äº‹ä»¶æµ?ç±»åž‹ä¹Ÿå?šäº†ç»†åˆ†ï¼š</p>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">1ï¼‰downstream eventï¼šå…¶å¯¹åº”çš„ChannelHandlerå­?æŽ¥å?£æ˜¯ChannelDownstreamHandlerã€‚downstream eventæ˜¯è¯´ä»Žå¤´åˆ°å°¾æ‰§è¡ŒChannelPipelineä¸­çš„ChannelDownstreamHandlerï¼Œè¿™ä¸€è¿‡ç¨‹ç›¸å½“äºŽå?‘å¤–å?‘é€?æ•°æ?®çš„è¿‡ç¨‹ã€‚ downstream eventæœ‰ï¼š&rdquo;write&rdquo;ã€?&rdquo;bind&rdquo;ã€?&rdquo;unbind&rdquo;ã€? &ldquo;connect&rdquo;ã€? &ldquo;disconnect&rdquo;ã€?&rdquo;close&rdquo;ã€‚</p>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">2ï¼‰upstream eventï¼šå…¶å¯¹åº”çš„ChannelHandlerå­?æŽ¥å?£æ˜¯ChannelUpstreamHandlerã€‚upstream eventå¤„ç?†çš„äº‹ä»¶æ–¹å?‘å’Œdownstream eventç›¸å??ï¼Œè¿™ä¸€è¿‡ç¨‹ç›¸å½“äºŽæŽ¥æ”¶å¤„ç?†å¤–æ?¥è¯·æ±‚çš„è¿‡ç¨‹ã€‚upstream eventæœ‰ï¼š&rdquo;messageReceived&rdquo;ã€? &ldquo;exceptionCaught&rdquo;ã€?&rdquo;channelOpen&rdquo;ã€?&rdquo;channelClosed&rdquo;ã€? &ldquo;channelBound&rdquo;ã€?&rdquo;channelUnbound&rdquo;ã€? &ldquo;channelConnected&rdquo;ã€?&rdquo;writeComplete&rdquo;ã€?&rdquo;channelDisconnected&rdquo;ã€?&rdquo;channelInterestChanged&rdquo;ã€‚</p>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">Nettyä¸­æœ‰ä¸ªæ³¨é‡Š@interface ChannelPipelineCoverageï¼Œå®ƒè¡¨ç¤ºè¢«æ³¨é‡Šçš„ChannelHandleræ˜¯å?¦èƒ½æ·»åŠ åˆ°å¤šä¸ªChannelPipelineä¸­ï¼Œå…¶å?¯é€‰çš„å€¼æ˜¯&rdquo;all&rdquo;å’Œ&rdquo;one&rdquo;ã€‚&rdquo;all&rdquo;è¡¨ç¤ºChannelHandleræ˜¯æ— çŠ¶æ€?çš„ï¼Œå?¯è¢«å¤šä¸ªChannelPipelineå…±äº«ï¼Œè€Œ&rdquo;one&rdquo;è¡¨ç¤ºChannelHandlerå?ªä½œç”¨äºŽå?•ä¸ªChannelPipelineä¸­ã€‚ä½†ChannelPipelineCoverageå?ªæ˜¯ä¸ªæ³¨é‡Šè€Œå·²ï¼Œå¹¶æ²¡æœ‰å®žé™…çš„æ£€æŸ¥ä½œç”¨ã€‚å¯¹äºŽChannelHandleræ˜¯&rdquo;all&rdquo;è¿˜æ˜¯&rdquo;one&rdquo;ï¼Œè¿˜æ˜¯æ ¹æ?®é€»è¾‘éœ€è¦?è€Œå®šã€‚æ¯”å¦‚ï¼Œåƒ?è§£ç ?è¯·æ±‚handlerï¼Œå› ä¸ºå?¯èƒ½è§£ç ?çš„æ•°æ?®ä¸?å®Œæ•´ï¼Œéœ€è¦?ç­‰å¾…ä¸‹ä¸€æ¬¡è¯»äº‹ä»¶æ?¥äº†ä¹‹å?Žå†?ç»§ç»­è§£æž?ï¼Œæ‰€ä»¥è§£ç ?è¯·æ±‚handlerå°±éœ€è¦?æ˜¯&rdquo;one&rdquo;çš„ï¼ˆå?¦åˆ™å¤šä¸ªChannelå…±äº«æ•°æ?®å°±ä¹±äº†ï¼‰ã€‚è€Œåƒ?ä¸šåŠ¡é€»è¾‘å¤„ç?†hanlderé€šå¸¸æ˜¯&rdquo;all&rdquo;çš„ã€‚</p>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">ä¸‹é?¢ä»¥ä¸€ä¸ªç®€å?•çš„ä¾‹å­?è¯´æ˜Žå¦‚ä½•ç¼–å†™&ldquo;è§£ç ?è¯·æ±‚æ•°æ?®ã€?ä¸šåŠ¡é€»è¾‘å¤„ç?†ã€?ç¼–ç ?å“?åº”&rdquo;è¿™ä¸€è¿‡ç¨‹ä¸­æ¶‰å?Šçš„ChannelHandlerã€‚è¯¥ä¾‹å­?å®žçŽ°çš„å??è®®æ ¼å¼?å¾ˆç®€å?•ï¼Œè¯·æ±‚å’Œå“?åº”æµ?ä¸­å¤´4ä¸ªå­—èŠ‚è¡¨ç¤ºå?Žé?¢è·Ÿçš„å†…å®¹é•¿åº¦ï¼Œæ ¹æ?®è¯¥é•¿åº¦å?¯å¾—åˆ°å†…å®¹ä½“ã€‚</p>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">é¦–å…ˆçœ‹ä¸‹è§£ç ?å™¨çš„å®žçŽ°ï¼š</p>
<div class="wp_syntax" style="color: rgb(17, 0, 0); background-color: rgb(249, 249, 249); border: 1px solid silver; margin: 0px 0px 1.5em; overflow-x: auto; overflow-y: hidden; width: 853.4166870117188px; font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; font-size: 13px; line-height: 20px; ">
<div class="code" style="vertical-align: top; padding: 2px 4px; ">
<pre class="java" style="margin-top: 0px; margin-bottom: 0px; width: auto; float: none; clear: none; overflow: visible; font-size: 12px; line-height: 1.333; "><span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span> MessageDecoder <span style="color: rgb(0, 0, 0); font-weight: bold; ">extends</span> FrameDecoder <span style="color: rgb(0, 153, 0); ">{</span>
&nbsp;
    @Override
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">protected</span> <span style="color: rgb(0, 51, 153); ">Object</span> decode<span style="color: rgb(0, 153, 0); ">(</span>
            ChannelHandlerContext ctx, Channel channel, ChannelBuffer buffer<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">throws</span> <span style="color: rgb(0, 51, 153); ">Exception</span> <span style="color: rgb(0, 153, 0); ">{</span>
        <span style="color: rgb(0, 0, 0); font-weight: bold; ">if</span> <span style="color: rgb(0, 153, 0); ">(</span>buffer.<span style="color: rgb(0, 102, 51); ">readableBytes</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(51, 153, 51); ">&lt;</span> <span style="color: rgb(204, 102, 204); ">4</span><span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
            <span style="color: rgb(0, 0, 0); font-weight: bold; ">return</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">null</span><span style="color: rgb(51, 153, 51); ">;</span><span style="color: rgb(102, 102, 102); font-style: italic; ">//(1)</span>
        <span style="color: rgb(0, 153, 0); ">}</span>
        <span style="color: rgb(0, 0, 102); font-weight: bold; ">int</span> dataLength <span style="color: rgb(51, 153, 51); ">=</span> buffer.<span style="color: rgb(0, 102, 51); ">getInt</span><span style="color: rgb(0, 153, 0); ">(</span>buffer.<span style="color: rgb(0, 102, 51); ">readerIndex</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 0, 0); font-weight: bold; ">if</span> <span style="color: rgb(0, 153, 0); ">(</span>buffer.<span style="color: rgb(0, 102, 51); ">readableBytes</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(51, 153, 51); ">&lt;</span> dataLength <span style="color: rgb(51, 153, 51); ">+</span> <span style="color: rgb(204, 102, 204); ">4</span><span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
            <span style="color: rgb(0, 0, 0); font-weight: bold; ">return</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">null</span><span style="color: rgb(51, 153, 51); ">;</span><span style="color: rgb(102, 102, 102); font-style: italic; ">//(2)</span>
        <span style="color: rgb(0, 153, 0); ">}</span>
&nbsp;
        buffer.<span style="color: rgb(0, 102, 51); ">skipBytes</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(204, 102, 204); ">4</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span><span style="color: rgb(102, 102, 102); font-style: italic; ">//(3)</span>
        <span style="color: rgb(0, 0, 102); font-weight: bold; ">byte</span><span style="color: rgb(0, 153, 0); ">[</span><span style="color: rgb(0, 153, 0); ">]</span> decoded <span style="color: rgb(51, 153, 51); ">=</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">byte</span><span style="color: rgb(0, 153, 0); ">[</span>dataLength<span style="color: rgb(0, 153, 0); ">]</span><span style="color: rgb(51, 153, 51); ">;</span>
        buffer.<span style="color: rgb(0, 102, 51); ">readBytes</span><span style="color: rgb(0, 153, 0); ">(</span>decoded<span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 51, 153); ">String</span> msg <span style="color: rgb(51, 153, 51); ">=</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> <span style="color: rgb(0, 51, 153); ">String</span><span style="color: rgb(0, 153, 0); ">(</span>decoded<span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span><span style="color: rgb(102, 102, 102); font-style: italic; ">//(4)</span>
        <span style="color: rgb(0, 0, 0); font-weight: bold; ">return</span> msg<span style="color: rgb(51, 153, 51); ">;</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
<span style="color: rgb(0, 153, 0); ">}</span></pre>
</p></div>
</div>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">MessageDecoderç»§æ‰¿è‡ªFrameDecoderï¼ŒFrameDecoderæ˜¯Netty codecåŒ…ä¸­çš„è¾…åŠ©ç±»ï¼Œå®ƒæ˜¯ä¸ªChannelUpstreamHandlerï¼Œdecodeæ–¹æ³•æ˜¯FrameDecoderå­?ç±»éœ€è¦?å®žçŽ°çš„ã€‚åœ¨ä¸Šé?¢çš„ä»£ç ?ä¸­ï¼Œæœ‰ï¼š</p>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">(1)æ£€æŸ¥ChannelBufferä¸­çš„å­—èŠ‚æ•°ï¼Œå¦‚æžœChannelBufferå?¯è¯»çš„å­—èŠ‚æ•°å°‘äºŽ4,åˆ™è¿”å›žnullç­‰å¾…ä¸‹æ¬¡è¯»äº‹ä»¶ã€‚<br />
	(2)ç»§ç»­æ£€æŸ¥ChannelBufferä¸­çš„å­—èŠ‚æ•°ï¼Œå¦‚æžœChannelBufferå?¯è¯»çš„å­—èŠ‚æ•°å°‘äºŽdataLength + 4ï¼Œåˆ™è¿”å›žnullç­‰å¾…ä¸‹æ¬¡è¯»äº‹ä»¶ã€‚<br />
	(3)è¶Šè¿‡dataLengthçš„å­—èŠ‚ã€‚<br />
	(4)æž„é€ è§£ç ?çš„å­—ç¬¦ä¸²è¿”å›žã€‚</p>
<div class="wp_syntax" style="color: rgb(17, 0, 0); background-color: rgb(249, 249, 249); border: 1px solid silver; margin: 0px 0px 1.5em; overflow-x: auto; overflow-y: hidden; width: 853.4166870117188px; font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; font-size: 13px; line-height: 20px; ">
<div class="code" style="vertical-align: top; padding: 2px 4px; ">
<pre class="java" style="margin-top: 0px; margin-bottom: 0px; width: auto; float: none; clear: none; overflow: visible; font-size: 12px; line-height: 1.333; ">@ChannelPipelineCoverage<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;all&quot;</span><span style="color: rgb(0, 153, 0); ">)</span>
<span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span> MessageServerHandler <span style="color: rgb(0, 0, 0); font-weight: bold; ">extends</span> SimpleChannelUpstreamHandler <span style="color: rgb(0, 153, 0); ">{</span>
&nbsp;
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">private</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">static</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">final</span> Logger logger <span style="color: rgb(51, 153, 51); ">=</span> Logger.<span style="color: rgb(0, 102, 51); ">getLogger</span><span style="color: rgb(0, 153, 0); ">(</span>
            MessageServerHandler.<span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span>.<span style="color: rgb(0, 102, 51); ">getName</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
&nbsp;
    @Override
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">void</span> messageReceived<span style="color: rgb(0, 153, 0); ">(</span>
            ChannelHandlerContext ctx, MessageEvent e<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
        <span style="color: rgb(0, 0, 0); font-weight: bold; ">if</span> <span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(51, 153, 51); ">!</span><span style="color: rgb(0, 153, 0); ">(</span>e.<span style="color: rgb(0, 102, 51); ">getMessage</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">instanceof</span> <span style="color: rgb(0, 51, 153); ">String</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
            <span style="color: rgb(0, 0, 0); font-weight: bold; ">return</span><span style="color: rgb(51, 153, 51); ">;</span><span style="color: rgb(102, 102, 102); font-style: italic; ">//(1)</span>
        <span style="color: rgb(0, 153, 0); ">}</span>
        <span style="color: rgb(0, 51, 153); ">String</span> msg <span style="color: rgb(51, 153, 51); ">=</span> <span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 51, 153); ">String</span><span style="color: rgb(0, 153, 0); ">)</span> e.<span style="color: rgb(0, 102, 51); ">getMessage</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 51, 153); ">System</span>.<span style="color: rgb(0, 102, 51); ">err</span>.<span style="color: rgb(0, 102, 51); ">println</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;got msg:&quot;</span><span style="color: rgb(51, 153, 51); ">+</span>msg<span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        e.<span style="color: rgb(0, 102, 51); ">getChannel</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span>.<span style="color: rgb(0, 102, 51); ">write</span><span style="color: rgb(0, 153, 0); ">(</span>msg<span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span><span style="color: rgb(102, 102, 102); font-style: italic; ">//(2)</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
&nbsp;
    @Override
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">void</span> exceptionCaught<span style="color: rgb(0, 153, 0); ">(</span>
            ChannelHandlerContext ctx, ExceptionEvent e<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
        logger.<span style="color: rgb(0, 102, 51); ">log</span><span style="color: rgb(0, 153, 0); ">(</span>
                Level.<span style="color: rgb(0, 102, 51); ">WARNING</span>,
                <span style="color: rgb(0, 0, 255); ">&quot;Unexpected exception from downstream.&quot;</span>,
                e.<span style="color: rgb(0, 102, 51); ">getCause</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        e.<span style="color: rgb(0, 102, 51); ">getChannel</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span>.<span style="color: rgb(0, 102, 51); ">close</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
<span style="color: rgb(0, 153, 0); ">}</span></pre>
</p></div>
</div>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">MessageServerHandleræ˜¯æœ?åŠ¡ç«¯ä¸šåŠ¡å¤„ç?†handlerï¼Œå…¶ç»§æ‰¿è‡ªSimpleChannelUpstreamHandlerï¼Œå¹¶ä¸»è¦?å®žçŽ°messageReceivedäº‹ä»¶ã€‚å…³äºŽè¯¥ç±»ï¼Œæœ‰å¦‚ä¸‹æ³¨è§£ï¼š</p>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">(1)è¯¥upstreamäº‹ä»¶æµ?ä¸­ï¼Œé¦–å…ˆç»?è¿‡MessageDecoderï¼Œå…¶ä¼šå°†decodeè¿”å›žçš„è§£ç ?å?Žçš„æ•°æ?®æž„é€ æˆ? MessageEvent.getMessage()ï¼Œæ‰€ä»¥åœ¨handlerä¸Šä¸‹æ–‡å…³ç³»ä¸­ï¼ŒMessageEvent.getMessage()å¹¶ä¸?ä¸€å®šéƒ½è¿”å›žChannelBufferç±»åž‹çš„æ•°æ?®ã€‚<br />
	(2)MessageServerHandlerå?ªæ˜¯ç®€å?•çš„å°†å¾—åˆ°çš„msgå†?å†™å›žç»™å®¢æˆ·ç«¯ã€‚e.getChannel().write(msg);æ“?ä½œå°†è§¦å?‘DownstreamMessageEventäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä¸‹é?¢çš„MessageEncoderå°†ç¼–ç ?çš„æ•°æ?®è¿”å›žç»™å®¢æˆ·ç«¯ã€‚</p>
<div class="wp_syntax" style="color: rgb(17, 0, 0); background-color: rgb(249, 249, 249); border: 1px solid silver; margin: 0px 0px 1.5em; overflow-x: auto; overflow-y: hidden; width: 853.4166870117188px; font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; font-size: 13px; line-height: 20px; ">
<div class="code" style="vertical-align: top; padding: 2px 4px; ">
<pre class="java" style="margin-top: 0px; margin-bottom: 0px; width: auto; float: none; clear: none; overflow: visible; font-size: 12px; line-height: 1.333; ">@ChannelPipelineCoverage<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;all&quot;</span><span style="color: rgb(0, 153, 0); ">)</span>
<span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span> MessageEncoder <span style="color: rgb(0, 0, 0); font-weight: bold; ">extends</span> OneToOneEncoder <span style="color: rgb(0, 153, 0); ">{</span>
&nbsp;
    @Override
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">protected</span> <span style="color: rgb(0, 51, 153); ">Object</span> encode<span style="color: rgb(0, 153, 0); ">(</span>
            ChannelHandlerContext ctx, Channel channel, <span style="color: rgb(0, 51, 153); ">Object</span> msg<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">throws</span> <span style="color: rgb(0, 51, 153); ">Exception</span> <span style="color: rgb(0, 153, 0); ">{</span>
        <span style="color: rgb(0, 0, 0); font-weight: bold; ">if</span> <span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(51, 153, 51); ">!</span><span style="color: rgb(0, 153, 0); ">(</span>msg <span style="color: rgb(0, 0, 0); font-weight: bold; ">instanceof</span> <span style="color: rgb(0, 51, 153); ">String</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
            <span style="color: rgb(0, 0, 0); font-weight: bold; ">return</span> msg<span style="color: rgb(51, 153, 51); ">;</span><span style="color: rgb(102, 102, 102); font-style: italic; ">//(1)</span>
        <span style="color: rgb(0, 153, 0); ">}</span>
&nbsp;
        <span style="color: rgb(0, 51, 153); ">String</span> res <span style="color: rgb(51, 153, 51); ">=</span> <span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 51, 153); ">String</span><span style="color: rgb(0, 153, 0); ">)</span>msg<span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 0, 102); font-weight: bold; ">byte</span><span style="color: rgb(0, 153, 0); ">[</span><span style="color: rgb(0, 153, 0); ">]</span> data <span style="color: rgb(51, 153, 51); ">=</span> res.<span style="color: rgb(0, 102, 51); ">getBytes</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 0, 102); font-weight: bold; ">int</span> dataLength <span style="color: rgb(51, 153, 51); ">=</span> data.<span style="color: rgb(0, 102, 51); ">length</span><span style="color: rgb(51, 153, 51); ">;</span>
        ChannelBuffer buf <span style="color: rgb(51, 153, 51); ">=</span> ChannelBuffers.<span style="color: rgb(0, 102, 51); ">dynamicBuffer</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span><span style="color: rgb(102, 102, 102); font-style: italic; ">//(2)</span>
        buf.<span style="color: rgb(0, 102, 51); ">writeInt</span><span style="color: rgb(0, 153, 0); ">(</span>dataLength<span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        buf.<span style="color: rgb(0, 102, 51); ">writeBytes</span><span style="color: rgb(0, 153, 0); ">(</span>data<span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 0, 0); font-weight: bold; ">return</span> buf<span style="color: rgb(51, 153, 51); ">;</span><span style="color: rgb(102, 102, 102); font-style: italic; ">//(3)</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
<span style="color: rgb(0, 153, 0); ">}</span></pre>
</p></div>
</div>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">MessageEncoderæ˜¯ä¸ªChannelDownstreamHandlerã€‚å¯¹è¯¥ç±»çš„æ³¨è§£å¦‚ä¸‹ï¼š</p>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">(1)å¦‚æžœç¼–ç ?çš„msgä¸?æ˜¯å?ˆæ³•ç±»åž‹ï¼Œå°±ç›´æŽ¥è¿”å›žè¯¥msgï¼Œä¹‹å?ŽOneToOneEncoderä¼šè°ƒç”¨ ctx.sendDownstream(evt);æ?¥è°ƒç”¨ä¸‹ä¸€ä¸ªChannelDownstreamHandlerã€‚å¯¹äºŽè¯¥ä¾‹å­?æ?¥è¯´ï¼Œè¿™ç§?æƒ…å†µæ˜¯ä¸?åº”è¯¥å‡ºçŽ°çš„ã€‚<br />
	(2)å¼€å?‘è€…åˆ›å»ºChannelBufferçš„ç”¨æ­¦ä¹‹åœ°å°±æ˜¯è¿™å„¿äº†ï¼Œé€šå¸¸ä½¿ç”¨dynamicBufferå?³å?¯ï¼Œè¡¨ç¤ºå¾—åˆ°çš„ChannelBufferå?¯åŠ¨æ€?å¢žåŠ å¤§å°?ã€‚<br />
	(3)è¿”å›žç¼–ç ?å?Žçš„ChannelBufferä¹‹å?Žï¼ŒOneToOneEncoderä¼šè°ƒç”¨Channels.writeå°†æ•°æ?®å†™å›žå®¢æˆ·ç«¯ã€‚</p>
<h3 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">2.2ã€?MessageServerPipelineFactory</h3>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">åˆ›å»ºäº†3ä¸ªChannelHandlerï¼Œéœ€è¦?å°†ä»–ä»¬æ³¨å†Œåˆ°ChannelPipelineï¼Œè€ŒChannelPipelineå?ˆæ˜¯å’ŒChannelå¯¹åº”çš„ï¼ˆæ˜¯å…¨å±€å?•ä¾‹è¿˜æ˜¯æ¯?ä¸ªChannelå¯¹åº”ä¸€ä¸ªChannelPipelineå®žä¾‹ä¾?èµ–äºŽå®žçŽ°ï¼‰ã€‚å?¯ä»¥å®žçŽ°ChannelPipelineçš„å·¥åŽ‚æŽ¥å?£ ChannelPipelineFactoryå®žçŽ°è¯¥ç›®çš„ã€‚MessageServerPipelineFactoryçš„ä»£ç ?å¦‚ä¸‹ï¼š</p>
<div class="wp_syntax" style="color: rgb(17, 0, 0); background-color: rgb(249, 249, 249); border: 1px solid silver; margin: 0px 0px 1.5em; overflow-x: auto; overflow-y: hidden; width: 853.4166870117188px; font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; font-size: 13px; line-height: 20px; ">
<div class="code" style="vertical-align: top; padding: 2px 4px; ">
<pre class="java" style="margin-top: 0px; margin-bottom: 0px; width: auto; float: none; clear: none; overflow: visible; font-size: 12px; line-height: 1.333; "><span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span> MessageServerPipelineFactory <span style="color: rgb(0, 0, 0); font-weight: bold; ">implements</span>
        ChannelPipelineFactory <span style="color: rgb(0, 153, 0); ">{</span>
&nbsp;
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> ChannelPipeline getPipeline<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">throws</span> <span style="color: rgb(0, 51, 153); ">Exception</span> <span style="color: rgb(0, 153, 0); ">{</span>
        ChannelPipeline pipeline <span style="color: rgb(51, 153, 51); ">=</span> pipeline<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
&nbsp;
        pipeline.<span style="color: rgb(0, 102, 51); ">addLast</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;decoder&quot;</span>, <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> MessageDecoder<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        pipeline.<span style="color: rgb(0, 102, 51); ">addLast</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;encoder&quot;</span>, <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> MessageEncoder<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        pipeline.<span style="color: rgb(0, 102, 51); ">addLast</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;handler&quot;</span>, <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> MessageServerHandler<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
&nbsp;
        <span style="color: rgb(0, 0, 0); font-weight: bold; ">return</span> pipeline<span style="color: rgb(51, 153, 51); ">;</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
<span style="color: rgb(0, 153, 0); ">}</span></pre>
</p></div>
</div>
<h3 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">2.3ã€?MessageServer</h3>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">æœ?åŠ¡ç«¯ç¨‹åº?å°±å‰©ä¸‹å?¯åŠ¨ä»£ç ?äº†ï¼Œä½¿ç”¨Nettyçš„ServerBootstrapä¸‰ä¸‹äº”é™¤äºŒå®Œæˆ?ä¹‹ã€‚</p>
<div class="wp_syntax" style="color: rgb(17, 0, 0); background-color: rgb(249, 249, 249); border: 1px solid silver; margin: 0px 0px 1.5em; overflow-x: auto; overflow-y: hidden; width: 853.4166870117188px; font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; font-size: 13px; line-height: 20px; ">
<div class="code" style="vertical-align: top; padding: 2px 4px; ">
<pre class="java" style="margin-top: 0px; margin-bottom: 0px; width: auto; float: none; clear: none; overflow: visible; font-size: 12px; line-height: 1.333; "><span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span> MessageServer <span style="color: rgb(0, 153, 0); ">{</span>
&nbsp;
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">static</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">void</span> main<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 51, 153); ">String</span><span style="color: rgb(0, 153, 0); ">[</span><span style="color: rgb(0, 153, 0); ">]</span> args<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">throws</span> <span style="color: rgb(0, 51, 153); ">Exception</span> <span style="color: rgb(0, 153, 0); ">{</span>
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Configure the server.</span>
        ServerBootstrap bootstrap <span style="color: rgb(51, 153, 51); ">=</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> ServerBootstrap<span style="color: rgb(0, 153, 0); ">(</span>
                <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> NioServerSocketChannelFactory<span style="color: rgb(0, 153, 0); ">(</span>
                        Executors.<span style="color: rgb(0, 102, 51); ">newCachedThreadPool</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span>,
                        Executors.<span style="color: rgb(0, 102, 51); ">newCachedThreadPool</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
&nbsp;
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Set up the default event pipeline.</span>
        bootstrap.<span style="color: rgb(0, 102, 51); ">setPipelineFactory</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> MessageServerPipelineFactory<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
&nbsp;
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Bind and start to accept incoming connections.</span>
        bootstrap.<span style="color: rgb(0, 102, 51); ">bind</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> InetSocketAddress<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(204, 102, 204); ">8080</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
&nbsp;
    <span style="color: rgb(0, 153, 0); ">}</span>
<span style="color: rgb(0, 153, 0); ">}</span></pre>
</p></div>
</div>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">ç¨?åŠ è¡¥å……çš„æ˜¯ï¼Œè¯¥Serverç¨‹åº?å¹¶ä¸?å®Œæ•´ï¼Œå®ƒæ²¡æœ‰å¤„ç?†å…³é—­æ—¶çš„èµ„æº?é‡Šæ”¾ï¼Œå°½ç®¡æš´åŠ›çš„æ?¥çœ‹å¹¶ä¸?ä¸€å®šéœ€è¦?å?šè¿™æ ·çš„å–„å?Žå·¥ä½œã€‚</p>
<h2 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">3ã€?å®¢æˆ·ç«¯ç¨‹åº?</h2>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">å®¢æˆ·ç«¯ç¨‹åº?å’Œæœ?åŠ¡ç«¯ç¨‹åº?å¤„ç?†æ¨¡åž‹ä¸Šæ˜¯å¾ˆç›¸ä¼¼çš„ï¼Œè¿™é‡Œè¿˜æ˜¯ä»˜ä¸Šä»£ç ?å¹¶ä½œç®€è¦?è¯´æ˜Žã€‚</p>
<h3 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">3.1ã€? ChannelHandler</h3>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">å®¢æˆ·ç«¯æ˜¯å…ˆå?‘é€?æ•°æ?®åˆ°æœ?åŠ¡ç«¯ï¼ˆdownstreamäº‹ä»¶æµ?ï¼‰ï¼Œç„¶å?Žæ˜¯å¤„ç?†ä»Žæœ?åŠ¡ç«¯æŽ¥æ”¶çš„æ•°æ?®ï¼ˆupstreamäº‹ä»¶æµ?ï¼‰ã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œæ€Žä¹ˆæŠŠéœ€è¦?å?‘é€?çš„æ•°æ?®é€?åˆ°downstreamäº‹ä»¶æµ?é‡Œå‘¢ï¼Ÿè¿™å°±ç”¨åˆ°äº†ChannelUpstreamHandlerçš„channelConnectedäº‹ä»¶äº†ã€‚å®žçŽ°çš„ MessageClientHandlerä»£ç ?å¦‚ä¸‹ï¼š</p>
<div class="wp_syntax" style="color: rgb(17, 0, 0); background-color: rgb(249, 249, 249); border: 1px solid silver; margin: 0px 0px 1.5em; overflow-x: auto; overflow-y: hidden; width: 853.4166870117188px; font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; font-size: 13px; line-height: 20px; ">
<div class="code" style="vertical-align: top; padding: 2px 4px; ">
<pre class="java" style="margin-top: 0px; margin-bottom: 0px; width: auto; float: none; clear: none; overflow: visible; font-size: 12px; line-height: 1.333; ">@ChannelPipelineCoverage<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;all&quot;</span><span style="color: rgb(0, 153, 0); ">)</span>
<span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span> MessageClientHandler <span style="color: rgb(0, 0, 0); font-weight: bold; ">extends</span> SimpleChannelUpstreamHandler <span style="color: rgb(0, 153, 0); ">{</span>
&nbsp;
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">private</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">static</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">final</span> Logger logger <span style="color: rgb(51, 153, 51); ">=</span> Logger.<span style="color: rgb(0, 102, 51); ">getLogger</span><span style="color: rgb(0, 153, 0); ">(</span>
            MessageClientHandler.<span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span>.<span style="color: rgb(0, 102, 51); ">getName</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
&nbsp;
&nbsp;
    @Override
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">void</span> channelConnected<span style="color: rgb(0, 153, 0); ">(</span>
            ChannelHandlerContext ctx, ChannelStateEvent e<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
        <span style="color: rgb(0, 51, 153); ">String</span> message <span style="color: rgb(51, 153, 51); ">=</span> <span style="color: rgb(0, 0, 255); ">&quot;hello kafka0102&quot;</span><span style="color: rgb(51, 153, 51); ">;</span>
        e.<span style="color: rgb(0, 102, 51); ">getChannel</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span>.<span style="color: rgb(0, 102, 51); ">write</span><span style="color: rgb(0, 153, 0); ">(</span>message<span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
&nbsp;
    @Override
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">void</span> messageReceived<span style="color: rgb(0, 153, 0); ">(</span>
            ChannelHandlerContext ctx, MessageEvent e<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Send back the received message to the remote peer.</span>
        <span style="color: rgb(0, 51, 153); ">System</span>.<span style="color: rgb(0, 102, 51); ">err</span>.<span style="color: rgb(0, 102, 51); ">println</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;messageReceived send message &quot;</span><span style="color: rgb(51, 153, 51); ">+</span>e.<span style="color: rgb(0, 102, 51); ">getMessage</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 0, 0); font-weight: bold; ">try</span> <span style="color: rgb(0, 153, 0); ">{</span>
            <span style="color: rgb(0, 51, 153); ">Thread</span>.<span style="color: rgb(0, 102, 51); ">sleep</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(204, 102, 204); ">1000</span><span style="color: rgb(51, 153, 51); ">*</span><span style="color: rgb(204, 102, 204); ">3</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 153, 0); ">}</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">catch</span> <span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 51, 153); ">Exception</span> ex<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
            ex.<span style="color: rgb(0, 102, 51); ">printStackTrace</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 153, 0); ">}</span>
        e.<span style="color: rgb(0, 102, 51); ">getChannel</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span>.<span style="color: rgb(0, 102, 51); ">write</span><span style="color: rgb(0, 153, 0); ">(</span>e.<span style="color: rgb(0, 102, 51); ">getMessage</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
&nbsp;
    @Override
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">void</span> exceptionCaught<span style="color: rgb(0, 153, 0); ">(</span>
            ChannelHandlerContext ctx, ExceptionEvent e<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 153, 0); ">{</span>
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Close the connection when an exception is raised.</span>
        logger.<span style="color: rgb(0, 102, 51); ">log</span><span style="color: rgb(0, 153, 0); ">(</span>
                Level.<span style="color: rgb(0, 102, 51); ">WARNING</span>,
                <span style="color: rgb(0, 0, 255); ">&quot;Unexpected exception from downstream.&quot;</span>,
                e.<span style="color: rgb(0, 102, 51); ">getCause</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        e.<span style="color: rgb(0, 102, 51); ">getChannel</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span>.<span style="color: rgb(0, 102, 51); ">close</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
<span style="color: rgb(0, 153, 0); ">}</span></pre>
</p></div>
</div>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">å¯¹äºŽç¼–ç ?å’Œè§£ç ?Handlerï¼Œå¤?ç”¨MessageEncoderå’ŒMessageDecoderå?³å?¯ã€‚</p>
<h3 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">3.2ã€? MessageClientPipelineFactory</h3>
<div class="wp_syntax" style="color: rgb(17, 0, 0); background-color: rgb(249, 249, 249); border: 1px solid silver; margin: 0px 0px 1.5em; overflow-x: auto; overflow-y: hidden; width: 853.4166870117188px; font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; font-size: 13px; line-height: 20px; ">
<div class="code" style="vertical-align: top; padding: 2px 4px; ">
<pre class="java" style="margin-top: 0px; margin-bottom: 0px; width: auto; float: none; clear: none; overflow: visible; font-size: 12px; line-height: 1.333; ">    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span> MessageClientPipelineFactory <span style="color: rgb(0, 0, 0); font-weight: bold; ">implements</span>
        ChannelPipelineFactory <span style="color: rgb(0, 153, 0); ">{</span>
&nbsp;
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> ChannelPipeline getPipeline<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">throws</span> <span style="color: rgb(0, 51, 153); ">Exception</span> <span style="color: rgb(0, 153, 0); ">{</span>
        ChannelPipeline pipeline <span style="color: rgb(51, 153, 51); ">=</span> pipeline<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
&nbsp;
        pipeline.<span style="color: rgb(0, 102, 51); ">addLast</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;decoder&quot;</span>, <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> MessageDecoder<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        pipeline.<span style="color: rgb(0, 102, 51); ">addLast</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;encoder&quot;</span>, <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> MessageEncoder<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        pipeline.<span style="color: rgb(0, 102, 51); ">addLast</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 255); ">&quot;handler&quot;</span>, <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> MessageClientHandler<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
&nbsp;
        <span style="color: rgb(0, 0, 0); font-weight: bold; ">return</span> pipeline<span style="color: rgb(51, 153, 51); ">;</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
<span style="color: rgb(0, 153, 0); ">}</span></pre>
</p></div>
</div>
<h3 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">3.3ã€?MessageClient</h3>
<div class="wp_syntax" style="color: rgb(17, 0, 0); background-color: rgb(249, 249, 249); border: 1px solid silver; margin: 0px 0px 1.5em; overflow-x: auto; overflow-y: hidden; width: 853.4166870117188px; font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; font-size: 13px; line-height: 20px; ">
<div class="code" style="vertical-align: top; padding: 2px 4px; ">
<pre class="java" style="margin-top: 0px; margin-bottom: 0px; width: auto; float: none; clear: none; overflow: visible; font-size: 12px; line-height: 1.333; "><span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">class</span> MessageClient <span style="color: rgb(0, 153, 0); ">{</span>
&nbsp;
    <span style="color: rgb(0, 0, 0); font-weight: bold; ">public</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">static</span> <span style="color: rgb(0, 0, 102); font-weight: bold; ">void</span> main<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 51, 153); ">String</span><span style="color: rgb(0, 153, 0); ">[</span><span style="color: rgb(0, 153, 0); ">]</span> args<span style="color: rgb(0, 153, 0); ">)</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">throws</span> <span style="color: rgb(0, 51, 153); ">Exception</span> <span style="color: rgb(0, 153, 0); ">{</span>
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Parse options.</span>
        <span style="color: rgb(0, 51, 153); ">String</span> host <span style="color: rgb(51, 153, 51); ">=</span> <span style="color: rgb(0, 0, 255); ">&quot;127.0.0.1&quot;</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(0, 0, 102); font-weight: bold; ">int</span> port <span style="color: rgb(51, 153, 51); ">=</span> <span style="color: rgb(204, 102, 204); ">8080</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Configure the client.</span>
        ClientBootstrap bootstrap <span style="color: rgb(51, 153, 51); ">=</span> <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> ClientBootstrap<span style="color: rgb(0, 153, 0); ">(</span>
                <span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> NioClientSocketChannelFactory<span style="color: rgb(0, 153, 0); ">(</span>
                        Executors.<span style="color: rgb(0, 102, 51); ">newCachedThreadPool</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span>,
                        Executors.<span style="color: rgb(0, 102, 51); ">newCachedThreadPool</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Set up the event pipeline factory.</span>
        bootstrap.<span style="color: rgb(0, 102, 51); ">setPipelineFactory</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> MessageClientPipelineFactory<span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Start the connection attempt.</span>
        ChannelFuture future <span style="color: rgb(51, 153, 51); ">=</span> bootstrap.<span style="color: rgb(0, 102, 51); ">connect</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 0, 0); font-weight: bold; ">new</span> InetSocketAddress<span style="color: rgb(0, 153, 0); ">(</span>host, port<span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Wait until the connection is closed or the connection attempt fails.</span>
        future.<span style="color: rgb(0, 102, 51); ">getChannel</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span>.<span style="color: rgb(0, 102, 51); ">getCloseFuture</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span>.<span style="color: rgb(0, 102, 51); ">awaitUninterruptibly</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
        <span style="color: rgb(102, 102, 102); font-style: italic; ">// Shut down thread pools to exit.</span>
        bootstrap.<span style="color: rgb(0, 102, 51); ">releaseExternalResources</span><span style="color: rgb(0, 153, 0); ">(</span><span style="color: rgb(0, 153, 0); ">)</span><span style="color: rgb(51, 153, 51); ">;</span>
    <span style="color: rgb(0, 153, 0); ">}</span>
<span style="color: rgb(0, 153, 0); ">}</span></pre>
</p></div>
</div>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">åœ¨å†™å®¢æˆ·ç«¯ä¾‹å­?æ—¶ï¼Œæˆ‘æƒ³åƒ?çš„ä»£ç ?å¹¶ä¸?æ˜¯è¿™æ ·çš„ï¼Œå¯¹å®¢æˆ·ç«¯çš„ä»£ç ?æˆ‘ä¹Ÿæ²¡å?šè¿‡å¤šçš„ç ”ç©¶ï¼Œæ‰€ä»¥ä¹Ÿå?¯èƒ½æ²¡æœ‰æ‰¾åˆ°æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨ä¸Šé?¢çš„ä¾‹å­?ä¸­ï¼Œbootstrap.connectæ–¹æ³•ä¸­ä¼šè§¦å?‘å®žé™…çš„è¿žæŽ¥æ“?ä½œï¼ŒæŽ¥ç?€è§¦å?‘ MessageClientHandler.channelConnectedï¼Œä½¿æ•´ä¸ªè¿‡ç¨‹è¿?è½¬èµ·æ?¥ã€‚ä½†æ˜¯ï¼Œæˆ‘æƒ³è¦?çš„æ˜¯ä¸€ä¸ªè¿žæŽ¥æ± ï¼Œå¹¶ä¸”å¦‚ä½•å†™æ•°æ?®ä¹Ÿä¸?åº”è¯¥åœ¨channelConnectedä¸­ï¼Œè¿™æ ·å¯¹äºŽåŠ¨æ€?çš„æ•°æ?®ï¼Œå?ªèƒ½åœ¨æž„é€ å‡½æ•°ä¸­ä¼ é€’éœ€è¦?å†™çš„æ•°æ?®äº†ã€‚ä½†åˆ°çŽ°åœ¨ï¼Œæˆ‘è¿˜ä¸?æ¸…æ¥šå¦‚ä½•å°†è¿žæŽ¥æ± å’Œ ChannelPipelineæœ‰æ•ˆçš„ç»“å?ˆèµ·æ?¥ã€‚æˆ–è®¸ï¼Œè¿™æ ·çš„éœ€æ±‚å?¯ä»¥è·¨è¿‡Nettyæ?¥å®žçŽ°ã€‚</p>
<h2 style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); ">4ã€?æ€»ç»“</h2>
<p style="margin: 0px; padding: 0px 0px 15px; font-size: 14px; line-height: 20px; color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; background-color: rgb(254, 255, 254); ">å…³äºŽNettyçš„åˆ?æ­¥ä½¿ç”¨ï¼Œå°šä¸”æ€»ç»“åˆ°è¿™é‡Œã€‚å…³äºŽè¿™ç¯‡æ–‡ç« ï¼Œå†™å¾—æ–­æ–­ç»­ç»­ï¼Œä»¥è‡³äºŽåˆ°å?Žæ?¥æˆ‘éƒ½æ²¡å…´è¶£æŠŠå†…å®¹éƒ½æ•´ç?†å‡ºæ?¥ã€‚å½“ç„¶ï¼Œè¿™å¤šå°‘ä¹Ÿæ˜¯å› ä¸ºæˆ‘æ˜¯å…ˆæ•´ç?† NettyåŽŸç?†æ–¹é?¢çš„ä¸œè¥¿æ‰€è‡´ã€‚æˆ‘ä¹Ÿå?ªèƒ½å?‘å¾®çš„æœŸæœ›ï¼Œè¯¥æ–‡å¯¹Nettyå…¥é—¨è€…ä¼šæœ‰äº›è®¸å¸®åŠ©ã€‚</p>
<p><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; font-size: 13px; line-height: 20px; background-color: rgb(254, 255, 254); ">==================== å?Žä¸½çš„ç»ˆæ­¢ç¬¦ ===================</span></p>
<div style="font-family: 'Trebuchet MS', verdana, arial, 'Times New Roman', serif; line-height: 20px; background-color: rgb(254, 255, 254); border: 1px solid rgb(238, 238, 238); color: rgb(153, 153, 153); padding: 5px; ">æœ¬æ–‡ä½œè€…ï¼š<strong><a href="http://www.kafka0102.com/" style="color: rgb(10, 99, 127); text-decoration: none; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(192, 192, 192); margin: 0px; padding: 0px; width: auto; ">kafka0102</a></strong><br />
	æœ¬æ–‡é“¾æŽ¥ï¼š<a href="http://www.kafka0102.com/2010/06/161.html" style="color: rgb(10, 99, 127); text-decoration: none; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(192, 192, 192); margin: 0px; padding: 0px; width: auto; " title="http://www.kafka0102.com/2010/06/161.html">http://www.kafka0102.com/2010/06/161.html</a></div>
<div>&nbsp;</div>
<div style="text-align: center;margin: 3px;"><script type="text/javascript"><!--
google_ad_client = "pub-1986945724311842";
google_alternate_color = "FFFFFF";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel ="2512962626";
google_color_border = "#004c63";
google_color_link = "#000000";
google_color_bg = "#ffffff";
google_color_text = "#999999";
google_color_url = "#5394A8";
google_ui_features = "rc:6";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>						<p class="tags"><span class="icon tags"></span><a href="http://www.chinasb.org/archives/tag/netty" rel="tag">Netty</a></p>
			<p></p>
			<p class="pagination">
				<span class="prev"><a href="http://www.chinasb.org/archives/2012/11/4954.shtml" rel="prev">MMORPGæœ?åŠ¡å™¨æž¶æž„</a></span>
				<span class="next"><a href="http://www.chinasb.org/archives/2012/11/4967.shtml" rel="next">Nettyå®žçŽ°åŽŸç?†æµ…æž?</a></span>
			</p>

			<div id="comments">
				

<!-- You can start editing here. -->
<div class="comments">
	
	
	<p></p>
									<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">å?‘è¡¨è¯„è®º <small><a rel="nofollow" id="cancel-comment-reply-link" href="/archives/2012/11/4966.shtml#respond" style="display:none;">å?–æ¶ˆå›žå¤?</a></small></h3>
									<form action="http://www.chinasb.org/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																			<p class="comment-notes">ç”µå­?é‚®ä»¶åœ°å?€ä¸?ä¼šè¢«å…¬å¼€ã€‚ å¿…å¡«é¡¹å·²ç”¨<span class="required">*</span>æ ‡æ³¨</p>							<p class="comment-form-author"><label for="author">å§“å?? <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-email"><label for="email">ç”µå­?é‚®ä»¶ <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-url"><label for="url">ç«™ç‚¹</label> <input id="url" name="url" type="text" value="" size="30" /></p>
												<p class="comment-form-comment"><label for="comment">è¯„è®º</label> <textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">æ‚¨å?¯ä»¥ä½¿ç”¨è¿™äº›<abbr title="HyperText Markup Language">HTML</abbr>æ ‡ç­¾å’Œå±žæ€§ï¼š <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="å?‘è¡¨è¯„è®º" />
							<input type='hidden' name='comment_post_ID' value='4966' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="39e75eee65" /></p><p><input type="checkbox" name="comment_mail_notify" id="comment_mail_notify" value="comment_mail_notify" checked="checked" style="width: auto;" /><label for="comment_mail_notify">æœ‰äººå›žå¤?æ—¶é‚®ä»¶é€šçŸ¥æˆ‘</label></p>					</form>
							</div><!-- #respond -->
						</div>
			</div>
		</article>
	</div>
	</div></section>


	<footer><div>
	
    	<div class="clearfix widgets">
        	<div class="cols">
				<div  class="col">
									</div >
				<div  class="col">
									</div >
			</div>
            <div class="cols">
				<div  class="col">
									</div >
				<div  class="col">
									</div >
			</div>
        </div >
    
		<div class="f-menu">
			<ul id="menu-navigation-menu-1" class="menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-2596"><a href="http://www.chinasb.org">é¦–é¡µ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2594"><a href="http://www.chinasb.org/ofc2">OFC2</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2591"><a href="http://www.chinasb.org/nosql">NoSQLå®žæˆ˜</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2593"><a href="http://www.chinasb.org/manual-shtml">å¼€å?‘æ‰‹å†Œ</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4834"><a href="http://www.chinasb.org/it-link">ç«™ç‚¹å¯¼èˆª</a></li>
</ul>		</div>
		
	</div></footer>
<script>
/* <![CDATA[ */
var rcGlobal = {
	serverUrl		:'http://www.chinasb.org',
	infoTemp		:'%REVIEWER% åœ¨ %POST%',
	loadingText		:'æ­£åœ¨åŠ è½½',
	noCommentsText	:'æ²¡æœ‰ä»»ä½•è¯„è®º',
	newestText		:'&laquo; æœ€æ–°çš„',
	newerText		:'&laquo; ä¸Šä¸€é¡µ',
	olderText		:'ä¸‹ä¸€é¡µ &raquo;',
	showContent		:'1',
	external		:'1',
	avatarSize		:'32',
	avatarPosition	:'left',
	anonymous		:'åŒ¿å??'
};
/* ]]> */
</script>
<!-- Lightbox Plus ColorBox v2.6/1.3.32 - 2013.01.24 - Message: 0-->
<script type="text/javascript">
jQuery(document).ready(function($){
  $("a[rel*=lightbox]").colorbox({speed:350,initialWidth:"300",initialHeight:"100",opacity:0.8,loop:false,scrolling:false,escKey:false,arrowKey:false,top:false,right:false,bottom:false,left:false});
});
</script>
<script type='text/javascript' src='http://www.chinasb.org/wp-content/plugins/wp-recentcomments/js/wp-recentcomments.js?ver=2.2.7'></script>
<script type='text/javascript' src='http://www.chinasb.org/wp-content/plugins/lightbox-plus/js/jquery.colorbox.1.3.32.js?ver=1.3.32'></script>
	
</body>
<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
  window.___gcfg = {lang: 'zh-CN'};

  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
</html>
<!-- Dynamic page generated in 0.971 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2013-10-15 13:12:16 -->

<!-- super cache -->
