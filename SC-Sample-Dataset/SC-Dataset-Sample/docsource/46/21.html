<!DOCTYPE HTML>
<!--
         _____________ 
        < TUICOOL.COM >
         ------------- 
              \                    / \  //\
               \    |\___/|      /   \//  \\
                    /0  0  \__  /    //  | \ \    
                   /     /  \/_/    //   |  \  \  
                   @_^_@'/   \/_   //    |   \   \ 
                   //_^_/     \/_ //     |    \    \
                ( //) |        \///      |     \     \
              ( / /) _|_ /   )  //       |      \     _\
            ( // /) '/,_ _ _/  ( ; -.    |    _ _\.-~        .-~~~^-.
          (( / / )) ,-{        _      `-.|.-~-.           .~         `.
         (( // / ))  '/\      /                 ~-. _ .-~      .-~^-.  \
         (( /// ))      `.   {            }                   /      \  \
          (( / ))     .----~-.\        \-'                 .~         \  `. \^-.
                     ///.----..>        \             _ -~             `.  ^-`  ^-_
                       ///-._ _ _ _ _ _ _}^ - - - - ~                     ~-- ,.-~
                                                                          /.-~
-->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="authenticity_token" name="csrf-param" />
<meta content="jjRlFMBI/qS0vCaV0BSJ1alnURQJKeccakCG3/0vI/c=" name="csrf-token" />
		<title>nettyåˆ?æ­¥ä½¿ç”¨ - æŽ¨é…·</title>
		<meta name="description" content="nettyåˆ?æ­¥ä½¿ç”¨"/>

	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  
  <link href="/assets/application-37c63992069f265dd83b68bfe513ee01.css" media="all" rel="stylesheet" type="text/css" />
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">

  <script src="/assets/application-9099d0b3b5c543383457b904797e6210.js" type="text/javascript"></script>
  <script src="/assets/bootstrap-popover-85edfa8a100b8e35ba76575e06738efc.js" type="text/javascript"></script>

  <!--[if IE 7]>
  <link rel="stylesheet" href="/assets/font-awesome-ie7.min.css">
  <![endif]--> 

    <script src="/assets/tip-a32d188a95cbab85121e3a6059dab75f.js" type="text/javascript"></script>

    
 	<link href="/assets/art_zoom-48eda4c0f1a722be6edc5f6d8bc65a9b.css" media="screen" rel="stylesheet" type="text/css" />
<script src="/assets/weibo-7585d869cd63846c6f174a8c58396405.js" type="text/javascript"></script>


</head>
<body>
  
  <div id="header" class="navbar-fixed-top">
    
      <div class="container">
        <div class="navbar">
          <div class="navbar-inner">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> 
              <span class="icon-bar"></span> 
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
    		      <span class="icon-bar"></span> 
            </a>
            <a href="/" class="brand">æŽ¨é…·<sub style="font-size:12px;">&nbsp;ä¸ªæ€§åŒ–ä½ çš„é˜…è¯»</sub></a>        
		      <nav class="nav-collapse collapse">
  		      <ul class="nav">
                  <li>
                  <a href="/ah/">
                    æ–‡ç«                     
                  </a>
                </li>
                  <li>
                  <a href="/qt/">
                    å¾®å?š                    
                  </a>
                </li>
                  <li>
                  <a href="/topics/">
                    ä¸»é¢˜                    
                  </a>
                </li>
                  <li>
                  <a href="/sites/">
                    ç«™ç‚¹                    
                  </a>
                </li>
                  <li>
                  <a href="/huodong/">
                    æ´»åŠ¨                    
                  </a>
                </li>
                  <li>
                  <a href="/mags/">
                    å‘¨åˆŠ                    
                  </a>
                </li>
  	        </ul>
            <form class="navbar-search pull-left" action="/topics/search">
              <input type="text" class="search-query span2" name="kw" placeholder="æ?œç´¢ä¸»é¢˜">
            </form>
            <ul class="nav pull-right">
              	<li><a href="/login" >ç™»å½•</a>
                </li>
    	      </ul>
        </nav>
      </div>
    </div>
	 </div>	
	</div>
  <div id ="flash_container" class="noPrint">    
    <!-- <a href='#'' class='close' data-dismiss='alert'>Ã—</a> -->
  </div>
    
<div class="container-fluid">  
  <!-- body start-->
  <script src="/assets/spin-e9abeea86a7144c7709122728dc4612e.min" type="text/javascript"></script>
<link rel="stylesheet" href="/assets/prettify/github.css">
<div class="row-fluid">
	<!--show start-->	
	<div class="span8 contant">
		<h1>nettyåˆ?æ­¥ä½¿ç”¨</h1>
		<div class="article_meta">
			<span class="timestamp">
				æ—¶é—´
     		2012-06-01 21:46:19
     	</span>

			<span class="from">				
				<i class="icon-globe"></i>
				<a class="cut cut28 from" href="/sites/yY73em" target="_blank">
					CSDNå?šå®¢
				</a>
			</span>
			
			<span id="dup-cnt">
				<a href="/articles/dup?id=ZJF3Av" target="_blank">ç›¸ä¼¼æ–‡ç« </a>
				(<i id="dup">0</i>)
			</span>

			<span class="pdf">
			</span>     
     	
     	<span class="source" style="display:block;">
     		<i style="float:left;">åŽŸæ–‡</i>&nbsp;
				<a class="cut cut70" href="http://blog.csdn.net/uohzoaix/article/details/7624850" style="display:inline-block;">http://blog.csdn.net/uohzoaix/article/details/7624850</a>
      </span>

          <a href="#add-article-to-kan" id="add-article-to-kan-btn" class="btn" data-toggle="modal" style="display:none;">æ·»åŠ åˆ°æŽ¨åˆŠ</a>  
          <!-- add_article to kan -->
<div id="add-article-to-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <span class="add-title">æ”¶è—?åˆ°ä½ çš„æŽ¨åˆŠ</span>
    <a href="#new-kan" class="btn btn-success pull-right" data-toggle="modal">åˆ›å»ºæŽ¨åˆŠ</a>
    <i class="clearfix"></i>
  </div>
  <div class="modal-body">
    <div class="add-article-to-kan-title">nettyåˆ?æ­¥ä½¿ç”¨</div>
    <label>é€‰æ‹©æŽ¨åˆŠ</label>
    <ul id="add-kan-list">
    </ul>
  </div>
  <div class="modal-footer">
    <input type="hidden" value="ZJF3Av" class="article-id" /> 
    <button class="btn btn-primary pull-left add-to-btn">æ”¶è—?</button>
    <button class="btn" data-dismiss="modal" aria-hidden="true">å?–æ¶ˆ</button>
  </div>
</div>
<div class="add-article-to-kan-alert">
  å·²æ”¶è—?åˆ°æŽ¨åˆŠï¼?
</div>

          <div id="new-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<!--
    <a href="new-kan" class="btn" data-toggle="modal">åˆ›å»ºæŽ¨åˆŠ</a>
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">Modal header</h3>
  </div>
-->
  <div class="modal-body">
    <input type="text" name="name" id="new-kan-name"  placeholder="æŽ¨åˆŠå??(å¿…å¡«)" required data-validation-required-message="è¯·å¡«å†™æŽ¨åˆŠå??" />
    <span class="new-ness-name">è¯·å¡«å†™æŽ¨åˆŠå??</span>
    <br/>
    <textarea name="desc" id="desc" rows="6" placeholder="æŽ¨åˆŠæ??è¿°"></textarea>
    <span class="new-ness-desc">æ??è¿°ä¸?èƒ½å¤§äºŽ100ä¸ªå­—ç¬¦!</span>
    <br/>
    æ?ƒé™?è®¾ç½®ï¼š<input type="radio" name="type" value="1" checked="checked" /> å…¬å¼€
    <input type="radio" name="type" value="0"> ä»…è‡ªå·±å?¯è§?
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary pull-left create-kan-btn" disabled>åˆ›å»º</button>
    <button class="btn dismiss-new-kan" data-dismiss="modal" aria-hidden="true">å?–æ¶ˆ</button>
  </div>
</div>


      
		</div>
		<div class="article_body"  id="nei">
			<div>
  <h2>1ã€?ç®€ä»‹</h2>
  <p>Java1.4æ??ä¾›äº†NIOä½¿å¼€å?‘è€…å?¯ä»¥ä½¿ç”¨Javaç¼–å†™é«˜æ€§èƒ½çš„æœ?åŠ¡ç«¯ç¨‹åº?ï¼Œä½†ä½¿ç”¨åŽŸç”Ÿçš„NIO APIå°±åƒ?Linux Cä¸­ç½‘ç»œç¼–ç¨‹ä¸€æ ·ï¼Œè¿˜æ˜¯éœ€è¦?å?šIOå¤„ç?†ã€?å??è®®å¤„ç?†ç­‰ä½Žå±‚æ¬¡å·¥ä½œã€‚æ‰€ä»¥ï¼Œå°±åƒ?Cæœ?åŠ¡ç«¯ç¨‹åº?å¤§é‡?ä½¿ç”¨libeventä½œä¸ºç½‘ç»œåº”ç”¨æ¡†æž¶ä¸€æ ·ï¼ŒJavaç¤¾åŒºä¹Ÿä¸?æ–­æ¶ŒçŽ°å‡ºåŸºäºŽNIOçš„ç½‘ç»œåº”ç”¨æ¡†æž¶ã€‚åœ¨è¿™å…¶ä¸­ï¼ŒJbosså‡ºå“?çš„Nettyå°±æ˜¯ä¸ªä¸­ç¿˜æ¥šã€‚Nettyæ˜¯ä¸ªå¼‚æ­¥çš„äº‹ä»¶é©±åŠ¨ç½‘ç»œåº”ç”¨æ¡†æž¶ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€?é«˜æ‰©å±•æ€§ç­‰ç‰¹æ€§ã€‚Nettyæ??ä¾›äº†ç»Ÿä¸€çš„åº•å±‚å??è®®æŽ¥å?£ï¼Œä½¿å¾—å¼€å?‘è€…ä»Žåº•å±‚çš„ç½‘ç»œå??è®®ï¼ˆæ¯”å¦‚TCP/IPã€?UDPï¼‰ä¸­è§£è„±å‡ºæ?¥ã€‚å°±ä½¿ç”¨æ?¥è¯´ï¼Œå¼€å?‘è€…å?ªè¦?å?‚è€ƒ Nettyæ??ä¾›çš„è‹¥å¹²ä¾‹å­?å’Œå®ƒçš„æŒ‡å?—æ–‡æ¡£ï¼Œå°±å?¯ä»¥æ”¾æ‰‹å¼€å?‘åŸºäºŽNettyçš„æœ?åŠ¡ç«¯ç¨‹åº?äº†ã€‚</p>
  <p>åœ¨Javaç¤¾åŒºï¼Œæœ€çŸ¥å??çš„å¼€æº?Java NIOæ¡†æž¶è¦?å±žMinaå’ŒNettyï¼Œè€Œä¸”ä¸¤è€…æ¸Šæº?é¢‡å¤šï¼Œå¯¹ä¸¤è€…çš„æ¯”è¾ƒè‡ªç„¶ä¸?å°‘ã€‚å®žé™…ä¸Šï¼ŒNettyçš„ä½œè€…åŽŸæ?¥å°±æ˜¯Minaä½œè€…ä¹‹ä¸€ï¼Œæ‰€ä»¥å?¯ä»¥æƒ³åˆ°ï¼ŒNettyå’ŒMinaåœ¨è®¾è®¡ç?†å¿µä¸Šä¼šæœ‰å¾ˆå¤šå…±å?Œç‚¹ã€‚æˆ‘å¯¹Minaæ²¡ä»€ä¹ˆç ”ç©¶ï¼Œä½†å…¶ä½œè€…ä»‹ç»?ï¼ŒNettyçš„è®¾è®¡å¯¹å¼€å?‘è€…æœ‰æ›´å?‹å¥½çš„æ‰©å±•æ€§ï¼Œå¹¶ä¸”æ€§èƒ½æ–¹é?¢è¦?ä¼˜äºŽMinaï¼Œè€ŒNettyå®Œå–„çš„æ–‡æ¡£ä¹Ÿå¾ˆå?¸å¼•äººã€‚æ‰€ä»¥ï¼Œå¦‚æžœä½ åœ¨å¯»æ‰¾Java NIOæ¡†æž¶ï¼ŒNettyæ˜¯ä¸ªå¾ˆä¸?é”™çš„é€‰æ‹©ã€‚æœ¬æ–‡çš„å†…å®¹å°±æ˜¯å›´ç»•ä¸€ä¸ªdemoä»‹ç»?ä½¿ç”¨Nettyçš„ç‚¹ç‚¹æ»´æ»´ã€‚</p>
  <h2>2ã€?æœ?åŠ¡ç«¯ç¨‹åº?</h2>
  <h3>2.1ã€?ChannelHandler</h3>
  <p>æœ?åŠ¡ç«¯ç¨‹åº?é€šå¸¸çš„å¤„ç?†è¿‡ç¨‹æ˜¯ï¼šè§£ç ?è¯·æ±‚æ•°æ?®ã€?ä¸šåŠ¡é€»è¾‘å¤„ç?†ã€?ç¼–ç ?å“?åº”ã€‚ä»Žæ¡†æž¶è§’åº¦æ?¥è¯´ï¼Œå?¯ä»¥æ??ä¾›3ä¸ªæŽ¥å?£æ?¥æŽ§åˆ¶å¹¶è°ƒåº¦è¯¥å¤„ç?†è¿‡ç¨‹ï¼›ä»Žæ›´é€šç”¨çš„è§’åº¦æ?¥è¯´ï¼Œå¹¶ä¸?ç‰¹åŒ–å¤„ç?†å…¶ä¸­çš„æ¯?ä¸€æ­¥ï¼Œè€ŒæŠŠæ¯?ä¸€æ­¥å½“å?šè¿‡æ»¤å™¨é“¾ä¸­çš„ä¸€çŽ¯ï¼Œè¿™ä¹Ÿæ˜¯Nettyçš„å?šæ³•ã€‚Nettyå¯¹è¯·æ±‚å¤„ç?†è¿‡ç¨‹å®žçŽ°äº†è¿‡æ»¤å™¨é“¾æ¨¡å¼?ï¼ˆChannelPipelineï¼‰ï¼Œæ¯?ä¸ªè¿‡æ»¤å™¨å®žçŽ°äº†ChannelHandleræŽ¥å?£ã€‚Nettyä¸­æœ‰ä¸¤ç§?è¯·æ±‚äº‹ä»¶æµ?ç±»åž‹ä¹Ÿå?šäº†ç»†åˆ†ï¼š</p>
  <p>1ï¼‰downstream eventï¼šå…¶å¯¹åº”çš„ChannelHandlerå­?æŽ¥å?£æ˜¯ChannelDownstreamHandlerã€‚downstream eventæ˜¯è¯´ä»Žå¤´åˆ°å°¾æ‰§è¡ŒChannelPipelineä¸­çš„ChannelDownstreamHandlerï¼Œè¿™ä¸€è¿‡ç¨‹ç›¸å½“äºŽå?‘å¤–å?‘é€?æ•°æ?®çš„è¿‡ç¨‹ã€‚ downstream eventæœ‰ï¼šâ€?writeâ€?ã€?â€?bindâ€?ã€?â€?unbindâ€?ã€? â€œconnectâ€?ã€? â€œdisconnectâ€?ã€?â€?closeâ€?ã€‚</p>
  <p>2ï¼‰upstream eventï¼šå…¶å¯¹åº”çš„ChannelHandlerå­?æŽ¥å?£æ˜¯ChannelUpstreamHandlerã€‚upstream eventå¤„ç?†çš„äº‹ä»¶æ–¹å?‘å’Œdownstream eventç›¸å??ï¼Œè¿™ä¸€è¿‡ç¨‹ç›¸å½“äºŽæŽ¥æ”¶å¤„ç?†å¤–æ?¥è¯·æ±‚çš„è¿‡ç¨‹ã€‚upstream eventæœ‰ï¼šâ€?messageReceivedâ€?ã€? â€œexceptionCaughtâ€?ã€?â€?channelOpenâ€?ã€?â€?channelClosedâ€?ã€? â€œchannelBoundâ€?ã€?â€?channelUnboundâ€?ã€? â€œchannelConnectedâ€?ã€?â€?writeCompleteâ€?ã€?â€?channelDisconnectedâ€?ã€?â€?channelInterestChangedâ€?ã€‚</p>
  <p>Nettyä¸­æœ‰ä¸ªæ³¨é‡Š@interface ChannelPipelineCoverageï¼Œå®ƒè¡¨ç¤ºè¢«æ³¨é‡Šçš„ChannelHandleræ˜¯å?¦èƒ½æ·»åŠ åˆ°å¤šä¸ªChannelPipelineä¸­ï¼Œå…¶å?¯é€‰çš„å€¼æ˜¯â€?allâ€?å’Œâ€?oneâ€?ã€‚â€?allâ€?è¡¨ç¤ºChannelHandleræ˜¯æ— çŠ¶æ€?çš„ï¼Œå?¯è¢«å¤šä¸ªChannelPipelineå…±äº«ï¼Œè€Œâ€?oneâ€?è¡¨ç¤ºChannelHandlerå?ªä½œç”¨äºŽå?•ä¸ªChannelPipelineä¸­ã€‚ä½†ChannelPipelineCoverageå?ªæ˜¯ä¸ªæ³¨é‡Šè€Œå·²ï¼Œå¹¶æ²¡æœ‰å®žé™…çš„æ£€æŸ¥ä½œç”¨ã€‚å¯¹äºŽChannelHandleræ˜¯â€?allâ€?è¿˜æ˜¯â€?oneâ€?ï¼Œè¿˜æ˜¯æ ¹æ?®é€»è¾‘éœ€è¦?è€Œå®šã€‚æ¯”å¦‚ï¼Œåƒ?è§£ç ?è¯·æ±‚handlerï¼Œå› ä¸ºå?¯èƒ½è§£ç ?çš„æ•°æ?®ä¸?å®Œæ•´ï¼Œéœ€è¦?ç­‰å¾…ä¸‹ä¸€æ¬¡è¯»äº‹ä»¶æ?¥äº†ä¹‹å?Žå†?ç»§ç»­è§£æž?ï¼Œæ‰€ä»¥è§£ç ?è¯·æ±‚handlerå°±éœ€è¦?æ˜¯â€?oneâ€?çš„ï¼ˆå?¦åˆ™å¤šä¸ªChannelå…±äº«æ•°æ?®å°±ä¹±äº†ï¼‰ã€‚è€Œåƒ?ä¸šåŠ¡é€»è¾‘å¤„ç?†hanlderé€šå¸¸æ˜¯â€?allâ€?çš„ã€‚</p>
  <p>ä¸‹é?¢ä»¥ä¸€ä¸ªç®€å?•çš„ä¾‹å­?è¯´æ˜Žå¦‚ä½•ç¼–å†™â€œè§£ç ?è¯·æ±‚æ•°æ?®ã€?ä¸šåŠ¡é€»è¾‘å¤„ç?†ã€?ç¼–ç ?å“?åº”â€?è¿™ä¸€è¿‡ç¨‹ä¸­æ¶‰å?Šçš„ChannelHandlerã€‚è¯¥ä¾‹å­?å®žçŽ°çš„å??è®®æ ¼å¼?å¾ˆç®€å?•ï¼Œè¯·æ±‚å’Œå“?åº”æµ?ä¸­å¤´4ä¸ªå­—èŠ‚è¡¨ç¤ºå?Žé?¢è·Ÿçš„å†…å®¹é•¿åº¦ï¼Œæ ¹æ?®è¯¥é•¿åº¦å?¯å¾—åˆ°å†…å®¹ä½“ã€‚</p>
  <p>é¦–å…ˆçœ‹ä¸‹è§£ç ?å™¨çš„å®žçŽ°ï¼š</p>
  <div>
    <div>
      <pre class="prettyprint"><span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>class</strong></span> MessageDecoder <span style="color:rgb(0,0,0)"><strong>extends</strong></span> FrameDecoder <span style="color:rgb(0,153,0)">{</span>
&nbsp;
    @Override
    <span style="color:rgb(0,0,0)"><strong>protected</strong></span> <span style="color:rgb(0,51,153)">Object</span> decode<span style="color:rgb(0,153,0)">(</span>
            ChannelHandlerContext ctx, Channel channel, ChannelBuffer buffer<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,0,0)"><strong>throws</strong></span> <span style="color:rgb(0,51,153)">Exception</span> <span style="color:rgb(0,153,0)">{</span>
        <span style="color:rgb(0,0,0)"><strong>if</strong></span> <span style="color:rgb(0,153,0)">(</span>buffer.<span style="color:rgb(0,102,51)">readableBytes</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(51,153,51)">&lt;</span> <span style="color:rgb(204,102,204)">4</span><span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
            <span style="color:rgb(0,0,0)"><strong>return</strong></span> <span style="color:rgb(0,0,102)"><strong>null</strong></span><span style="color:rgb(51,153,51)">;</span><span style="color:rgb(102,102,102)"><em>//(1)</em></span>
        <span style="color:rgb(0,153,0)">}</span>
        <span style="color:rgb(0,0,102)"><strong>int</strong></span> dataLength <span style="color:rgb(51,153,51)">=</span> buffer.<span style="color:rgb(0,102,51)">getInt</span><span style="color:rgb(0,153,0)">(</span>buffer.<span style="color:rgb(0,102,51)">readerIndex</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,0,0)"><strong>if</strong></span> <span style="color:rgb(0,153,0)">(</span>buffer.<span style="color:rgb(0,102,51)">readableBytes</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(51,153,51)">&lt;</span> dataLength <span style="color:rgb(51,153,51)">+</span> <span style="color:rgb(204,102,204)">4</span><span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
            <span style="color:rgb(0,0,0)"><strong>return</strong></span> <span style="color:rgb(0,0,102)"><strong>null</strong></span><span style="color:rgb(51,153,51)">;</span><span style="color:rgb(102,102,102)"><em>//(2)</em></span>
        <span style="color:rgb(0,153,0)">}</span>
&nbsp;
        buffer.<span style="color:rgb(0,102,51)">skipBytes</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(204,102,204)">4</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span><span style="color:rgb(102,102,102)"><em>//(3)</em></span>
        <span style="color:rgb(0,0,102)"><strong>byte</strong></span><span style="color:rgb(0,153,0)">[</span><span style="color:rgb(0,153,0)">]</span> decoded <span style="color:rgb(51,153,51)">=</span> <span style="color:rgb(0,0,0)"><strong>new</strong></span> <span style="color:rgb(0,0,102)"><strong>byte</strong></span><span style="color:rgb(0,153,0)">[</span>dataLength<span style="color:rgb(0,153,0)">]</span><span style="color:rgb(51,153,51)">;</span>
        buffer.<span style="color:rgb(0,102,51)">readBytes</span><span style="color:rgb(0,153,0)">(</span>decoded<span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,51,153)">String</span> msg <span style="color:rgb(51,153,51)">=</span> <span style="color:rgb(0,0,0)"><strong>new</strong></span> <span style="color:rgb(0,51,153)">String</span><span style="color:rgb(0,153,0)">(</span>decoded<span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span><span style="color:rgb(102,102,102)"><em>//(4)</em></span>
        <span style="color:rgb(0,0,0)"><strong>return</strong></span> msg<span style="color:rgb(51,153,51)">;</span>
    <span style="color:rgb(0,153,0)">}</span>
<span style="color:rgb(0,153,0)">}</span></pre>
    </div>
  </div>
  <p>MessageDecoderç»§æ‰¿è‡ªFrameDecoderï¼ŒFrameDecoderæ˜¯Netty codecåŒ…ä¸­çš„è¾…åŠ©ç±»ï¼Œå®ƒæ˜¯ä¸ªChannelUpstreamHandlerï¼Œdecodeæ–¹æ³•æ˜¯FrameDecoderå­?ç±»éœ€è¦?å®žçŽ°çš„ã€‚åœ¨ä¸Šé?¢çš„ä»£ç ?ä¸­ï¼Œæœ‰ï¼š</p>
  <p>
    (1)æ£€æŸ¥ChannelBufferä¸­çš„å­—èŠ‚æ•°ï¼Œå¦‚æžœChannelBufferå?¯è¯»çš„å­—èŠ‚æ•°å°‘äºŽ4,åˆ™è¿”å›žnullç­‰å¾…ä¸‹æ¬¡è¯»äº‹ä»¶ã€‚
    <br/>
    (2)ç»§ç»­æ£€æŸ¥ChannelBufferä¸­çš„å­—èŠ‚æ•°ï¼Œå¦‚æžœChannelBufferå?¯è¯»çš„å­—èŠ‚æ•°å°‘äºŽdataLength + 4ï¼Œåˆ™è¿”å›žnullç­‰å¾…ä¸‹æ¬¡è¯»äº‹ä»¶ã€‚
    <br/>
    (3)è¶Šè¿‡dataLengthçš„å­—èŠ‚ã€‚
    <br/>
    (4)æž„é€ è§£ç ?çš„å­—ç¬¦ä¸²è¿”å›žã€‚
  </p>
  <div>
    <div>
      <pre class="prettyprint">@ChannelPipelineCoverage<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;all&quot;</span><span style="color:rgb(0,153,0)">)</span>
<span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>class</strong></span> MessageServerHandler <span style="color:rgb(0,0,0)"><strong>extends</strong></span> SimpleChannelUpstreamHandler <span style="color:rgb(0,153,0)">{</span>
&nbsp;
    <span style="color:rgb(0,0,0)"><strong>private</strong></span> <span style="color:rgb(0,0,0)"><strong>static</strong></span> <span style="color:rgb(0,0,0)"><strong>final</strong></span> Logger logger <span style="color:rgb(51,153,51)">=</span> Logger.<span style="color:rgb(0,102,51)">getLogger</span><span style="color:rgb(0,153,0)">(</span>
            MessageServerHandler.<span style="color:rgb(0,0,0)"><strong>class</strong></span>.<span style="color:rgb(0,102,51)">getName</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
&nbsp;
    @Override
    <span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,102)"><strong>void</strong></span> messageReceived<span style="color:rgb(0,153,0)">(</span>
            ChannelHandlerContext ctx, MessageEvent e<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
        <span style="color:rgb(0,0,0)"><strong>if</strong></span> <span style="color:rgb(0,153,0)">(</span><span style="color:rgb(51,153,51)">!</span><span style="color:rgb(0,153,0)">(</span>e.<span style="color:rgb(0,102,51)">getMessage</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,0,0)"><strong>instanceof</strong></span> <span style="color:rgb(0,51,153)">String</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
            <span style="color:rgb(0,0,0)"><strong>return</strong></span><span style="color:rgb(51,153,51)">;</span><span style="color:rgb(102,102,102)"><em>//(1)</em></span>
        <span style="color:rgb(0,153,0)">}</span>
        <span style="color:rgb(0,51,153)">String</span> msg <span style="color:rgb(51,153,51)">=</span> <span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,51,153)">String</span><span style="color:rgb(0,153,0)">)</span> e.<span style="color:rgb(0,102,51)">getMessage</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,51,153)">System</span>.<span style="color:rgb(0,102,51)">err</span>.<span style="color:rgb(0,102,51)">println</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;got msg:&quot;</span><span style="color:rgb(51,153,51)">+</span>msg<span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        e.<span style="color:rgb(0,102,51)">getChannel</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span>.<span style="color:rgb(0,102,51)">write</span><span style="color:rgb(0,153,0)">(</span>msg<span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span><span style="color:rgb(102,102,102)"><em>//(2)</em></span>
    <span style="color:rgb(0,153,0)">}</span>
&nbsp;
    @Override
    <span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,102)"><strong>void</strong></span> exceptionCaught<span style="color:rgb(0,153,0)">(</span>
            ChannelHandlerContext ctx, ExceptionEvent e<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
        logger.<span style="color:rgb(0,102,51)">log</span><span style="color:rgb(0,153,0)">(</span>
                Level.<span style="color:rgb(0,102,51)">WARNING</span>,
                <span style="color:rgb(0,0,255)">&quot;Unexpected exception from downstream.&quot;</span>,
                e.<span style="color:rgb(0,102,51)">getCause</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        e.<span style="color:rgb(0,102,51)">getChannel</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span>.<span style="color:rgb(0,102,51)">close</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
    <span style="color:rgb(0,153,0)">}</span>
<span style="color:rgb(0,153,0)">}</span></pre>
    </div>
  </div>
  <p>MessageServerHandleræ˜¯æœ?åŠ¡ç«¯ä¸šåŠ¡å¤„ç?†handlerï¼Œå…¶ç»§æ‰¿è‡ªSimpleChannelUpstreamHandlerï¼Œå¹¶ä¸»è¦?å®žçŽ°messageReceivedäº‹ä»¶ã€‚å…³äºŽè¯¥ç±»ï¼Œæœ‰å¦‚ä¸‹æ³¨è§£ï¼š</p>
  <p>
    (1)è¯¥upstreamäº‹ä»¶æµ?ä¸­ï¼Œé¦–å…ˆç»?è¿‡MessageDecoderï¼Œå…¶ä¼šå°†decodeè¿”å›žçš„è§£ç ?å?Žçš„æ•°æ?®æž„é€ æˆ? MessageEvent.getMessage()ï¼Œæ‰€ä»¥åœ¨handlerä¸Šä¸‹æ–‡å…³ç³»ä¸­ï¼ŒMessageEvent.getMessage()å¹¶ä¸?ä¸€å®šéƒ½è¿”å›žChannelBufferç±»åž‹çš„æ•°æ?®ã€‚
    <br/>
    (2)MessageServerHandlerå?ªæ˜¯ç®€å?•çš„å°†å¾—åˆ°çš„msgå†?å†™å›žç»™å®¢æˆ·ç«¯ã€‚e.getChannel().write(msg);æ“?ä½œå°†è§¦å?‘DownstreamMessageEventäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä¸‹é?¢çš„MessageEncoderå°†ç¼–ç ?çš„æ•°æ?®è¿”å›žç»™å®¢æˆ·ç«¯ã€‚
  </p>
  <div>
    <div>
      <pre class="prettyprint">@ChannelPipelineCoverage<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;all&quot;</span><span style="color:rgb(0,153,0)">)</span>
<span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>class</strong></span> MessageEncoder <span style="color:rgb(0,0,0)"><strong>extends</strong></span> OneToOneEncoder <span style="color:rgb(0,153,0)">{</span>
&nbsp;
    @Override
    <span style="color:rgb(0,0,0)"><strong>protected</strong></span> <span style="color:rgb(0,51,153)">Object</span> encode<span style="color:rgb(0,153,0)">(</span>
            ChannelHandlerContext ctx, Channel channel, <span style="color:rgb(0,51,153)">Object</span> msg<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,0,0)"><strong>throws</strong></span> <span style="color:rgb(0,51,153)">Exception</span> <span style="color:rgb(0,153,0)">{</span>
        <span style="color:rgb(0,0,0)"><strong>if</strong></span> <span style="color:rgb(0,153,0)">(</span><span style="color:rgb(51,153,51)">!</span><span style="color:rgb(0,153,0)">(</span>msg <span style="color:rgb(0,0,0)"><strong>instanceof</strong></span> <span style="color:rgb(0,51,153)">String</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
            <span style="color:rgb(0,0,0)"><strong>return</strong></span> msg<span style="color:rgb(51,153,51)">;</span><span style="color:rgb(102,102,102)"><em>//(1)</em></span>
        <span style="color:rgb(0,153,0)">}</span>
&nbsp;
        <span style="color:rgb(0,51,153)">String</span> res <span style="color:rgb(51,153,51)">=</span> <span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,51,153)">String</span><span style="color:rgb(0,153,0)">)</span>msg<span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,0,102)"><strong>byte</strong></span><span style="color:rgb(0,153,0)">[</span><span style="color:rgb(0,153,0)">]</span> data <span style="color:rgb(51,153,51)">=</span> res.<span style="color:rgb(0,102,51)">getBytes</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,0,102)"><strong>int</strong></span> dataLength <span style="color:rgb(51,153,51)">=</span> data.<span style="color:rgb(0,102,51)">length</span><span style="color:rgb(51,153,51)">;</span>
        ChannelBuffer buf <span style="color:rgb(51,153,51)">=</span> ChannelBuffers.<span style="color:rgb(0,102,51)">dynamicBuffer</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span><span style="color:rgb(102,102,102)"><em>//(2)</em></span>
        buf.<span style="color:rgb(0,102,51)">writeInt</span><span style="color:rgb(0,153,0)">(</span>dataLength<span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        buf.<span style="color:rgb(0,102,51)">writeBytes</span><span style="color:rgb(0,153,0)">(</span>data<span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,0,0)"><strong>return</strong></span> buf<span style="color:rgb(51,153,51)">;</span><span style="color:rgb(102,102,102)"><em>//(3)</em></span>
    <span style="color:rgb(0,153,0)">}</span>
<span style="color:rgb(0,153,0)">}</span></pre>
    </div>
  </div>
  <p>MessageEncoderæ˜¯ä¸ªChannelDownstreamHandlerã€‚å¯¹è¯¥ç±»çš„æ³¨è§£å¦‚ä¸‹ï¼š</p>
  <p>
    (1)å¦‚æžœç¼–ç ?çš„msgä¸?æ˜¯å?ˆæ³•ç±»åž‹ï¼Œå°±ç›´æŽ¥è¿”å›žè¯¥msgï¼Œä¹‹å?ŽOneToOneEncoderä¼šè°ƒç”¨ ctx.sendDownstream(evt);æ?¥è°ƒç”¨ä¸‹ä¸€ä¸ªChannelDownstreamHandlerã€‚å¯¹äºŽè¯¥ä¾‹å­?æ?¥è¯´ï¼Œè¿™ç§?æƒ…å†µæ˜¯ä¸?åº”è¯¥å‡ºçŽ°çš„ã€‚
    <br/>
    (2)å¼€å?‘è€…åˆ›å»ºChannelBufferçš„ç”¨æ­¦ä¹‹åœ°å°±æ˜¯è¿™å„¿äº†ï¼Œé€šå¸¸ä½¿ç”¨dynamicBufferå?³å?¯ï¼Œè¡¨ç¤ºå¾—åˆ°çš„ChannelBufferå?¯åŠ¨æ€?å¢žåŠ å¤§å°?ã€‚
    <br/>
    (3)è¿”å›žç¼–ç ?å?Žçš„ChannelBufferä¹‹å?Žï¼ŒOneToOneEncoderä¼šè°ƒç”¨Channels.writeå°†æ•°æ?®å†™å›žå®¢æˆ·ç«¯ã€‚
  </p>
  <h3>2.2ã€?MessageServerPipelineFactory</h3>
  <p>åˆ›å»ºäº†3ä¸ªChannelHandlerï¼Œéœ€è¦?å°†ä»–ä»¬æ³¨å†Œåˆ°ChannelPipelineï¼Œè€ŒChannelPipelineå?ˆæ˜¯å’ŒChannelå¯¹åº”çš„ï¼ˆæ˜¯å…¨å±€å?•ä¾‹è¿˜æ˜¯æ¯?ä¸ªChannelå¯¹åº”ä¸€ä¸ªChannelPipelineå®žä¾‹ä¾?èµ–äºŽå®žçŽ°ï¼‰ã€‚å?¯ä»¥å®žçŽ°ChannelPipelineçš„å·¥åŽ‚æŽ¥å?£ ChannelPipelineFactoryå®žçŽ°è¯¥ç›®çš„ã€‚MessageServerPipelineFactoryçš„ä»£ç ?å¦‚ä¸‹ï¼š</p>
  <div>
    <div>
      <pre class="prettyprint"><span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>class</strong></span> MessageServerPipelineFactory <span style="color:rgb(0,0,0)"><strong>implements</strong></span>
        ChannelPipelineFactory <span style="color:rgb(0,153,0)">{</span>
&nbsp;
    <span style="color:rgb(0,0,0)"><strong>public</strong></span> ChannelPipeline getPipeline<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,0,0)"><strong>throws</strong></span> <span style="color:rgb(0,51,153)">Exception</span> <span style="color:rgb(0,153,0)">{</span>
        ChannelPipeline pipeline <span style="color:rgb(51,153,51)">=</span> pipeline<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
&nbsp;
        pipeline.<span style="color:rgb(0,102,51)">addLast</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;decoder&quot;</span>, <span style="color:rgb(0,0,0)"><strong>new</strong></span> MessageDecoder<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        pipeline.<span style="color:rgb(0,102,51)">addLast</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;encoder&quot;</span>, <span style="color:rgb(0,0,0)"><strong>new</strong></span> MessageEncoder<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        pipeline.<span style="color:rgb(0,102,51)">addLast</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;handler&quot;</span>, <span style="color:rgb(0,0,0)"><strong>new</strong></span> MessageServerHandler<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
&nbsp;
        <span style="color:rgb(0,0,0)"><strong>return</strong></span> pipeline<span style="color:rgb(51,153,51)">;</span>
    <span style="color:rgb(0,153,0)">}</span>
<span style="color:rgb(0,153,0)">}</span></pre>
    </div>
  </div>
  <h3>2.3ã€?MessageServer</h3>
  <p>æœ?åŠ¡ç«¯ç¨‹åº?å°±å‰©ä¸‹å?¯åŠ¨ä»£ç ?äº†ï¼Œä½¿ç”¨Nettyçš„ServerBootstrapä¸‰ä¸‹äº”é™¤äºŒå®Œæˆ?ä¹‹ã€‚</p>
  <div>
    <div>
      <pre class="prettyprint"><span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>class</strong></span> MessageServer <span style="color:rgb(0,153,0)">{</span>
&nbsp;
    <span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>static</strong></span> <span style="color:rgb(0,0,102)"><strong>void</strong></span> main<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,51,153)">String</span><span style="color:rgb(0,153,0)">[</span><span style="color:rgb(0,153,0)">]</span> args<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,0,0)"><strong>throws</strong></span> <span style="color:rgb(0,51,153)">Exception</span> <span style="color:rgb(0,153,0)">{</span>
        <span style="color:rgb(102,102,102)"><em>// Configure the server.</em></span>
        ServerBootstrap bootstrap <span style="color:rgb(51,153,51)">=</span> <span style="color:rgb(0,0,0)"><strong>new</strong></span> ServerBootstrap<span style="color:rgb(0,153,0)">(</span>
                <span style="color:rgb(0,0,0)"><strong>new</strong></span> NioServerSocketChannelFactory<span style="color:rgb(0,153,0)">(</span>
                        Executors.<span style="color:rgb(0,102,51)">newCachedThreadPool</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span>,
                        Executors.<span style="color:rgb(0,102,51)">newCachedThreadPool</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
&nbsp;
        <span style="color:rgb(102,102,102)"><em>// Set up the default event pipeline.</em></span>
        bootstrap.<span style="color:rgb(0,102,51)">setPipelineFactory</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,0)"><strong>new</strong></span> MessageServerPipelineFactory<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
&nbsp;
        <span style="color:rgb(102,102,102)"><em>// Bind and start to accept incoming connections.</em></span>
        bootstrap.<span style="color:rgb(0,102,51)">bind</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,0)"><strong>new</strong></span> InetSocketAddress<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(204,102,204)">8080</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
&nbsp;
    <span style="color:rgb(0,153,0)">}</span>
<span style="color:rgb(0,153,0)">}</span></pre>
    </div>
  </div>
  <p>ç¨?åŠ è¡¥å……çš„æ˜¯ï¼Œè¯¥Serverç¨‹åº?å¹¶ä¸?å®Œæ•´ï¼Œå®ƒæ²¡æœ‰å¤„ç?†å…³é—­æ—¶çš„èµ„æº?é‡Šæ”¾ï¼Œå°½ç®¡æš´åŠ›çš„æ?¥çœ‹å¹¶ä¸?ä¸€å®šéœ€è¦?å?šè¿™æ ·çš„å–„å?Žå·¥ä½œã€‚</p>
  <h2>3ã€?å®¢æˆ·ç«¯ç¨‹åº?</h2>
  <p>å®¢æˆ·ç«¯ç¨‹åº?å’Œæœ?åŠ¡ç«¯ç¨‹åº?å¤„ç?†æ¨¡åž‹ä¸Šæ˜¯å¾ˆç›¸ä¼¼çš„ï¼Œè¿™é‡Œè¿˜æ˜¯ä»˜ä¸Šä»£ç ?å¹¶ä½œç®€è¦?è¯´æ˜Žã€‚</p>
  <h3>3.1ã€? ChannelHandler</h3>
  <p>å®¢æˆ·ç«¯æ˜¯å…ˆå?‘é€?æ•°æ?®åˆ°æœ?åŠ¡ç«¯ï¼ˆdownstreamäº‹ä»¶æµ?ï¼‰ï¼Œç„¶å?Žæ˜¯å¤„ç?†ä»Žæœ?åŠ¡ç«¯æŽ¥æ”¶çš„æ•°æ?®ï¼ˆupstreamäº‹ä»¶æµ?ï¼‰ã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œæ€Žä¹ˆæŠŠéœ€è¦?å?‘é€?çš„æ•°æ?®é€?åˆ°downstreamäº‹ä»¶æµ?é‡Œå‘¢ï¼Ÿè¿™å°±ç”¨åˆ°äº†ChannelUpstreamHandlerçš„channelConnectedäº‹ä»¶äº†ã€‚å®žçŽ°çš„ MessageClientHandlerä»£ç ?å¦‚ä¸‹ï¼š</p>
  <div>
    <div>
      <pre class="prettyprint">@ChannelPipelineCoverage<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;all&quot;</span><span style="color:rgb(0,153,0)">)</span>
<span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>class</strong></span> MessageClientHandler <span style="color:rgb(0,0,0)"><strong>extends</strong></span> SimpleChannelUpstreamHandler <span style="color:rgb(0,153,0)">{</span>
&nbsp;
    <span style="color:rgb(0,0,0)"><strong>private</strong></span> <span style="color:rgb(0,0,0)"><strong>static</strong></span> <span style="color:rgb(0,0,0)"><strong>final</strong></span> Logger logger <span style="color:rgb(51,153,51)">=</span> Logger.<span style="color:rgb(0,102,51)">getLogger</span><span style="color:rgb(0,153,0)">(</span>
            MessageClientHandler.<span style="color:rgb(0,0,0)"><strong>class</strong></span>.<span style="color:rgb(0,102,51)">getName</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
&nbsp;
&nbsp;
    @Override
    <span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,102)"><strong>void</strong></span> channelConnected<span style="color:rgb(0,153,0)">(</span>
            ChannelHandlerContext ctx, ChannelStateEvent e<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
        <span style="color:rgb(0,51,153)">String</span> message <span style="color:rgb(51,153,51)">=</span> <span style="color:rgb(0,0,255)">&quot;hello world&quot;</span><span style="color:rgb(51,153,51)">;</span>
        e.<span style="color:rgb(0,102,51)">getChannel</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span>.<span style="color:rgb(0,102,51)">write</span><span style="color:rgb(0,153,0)">(</span>message<span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
    <span style="color:rgb(0,153,0)">}</span>
&nbsp;
    @Override
    <span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,102)"><strong>void</strong></span> messageReceived<span style="color:rgb(0,153,0)">(</span>
            ChannelHandlerContext ctx, MessageEvent e<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
        <span style="color:rgb(102,102,102)"><em>// Send back the received message to the remote peer.</em></span>
        <span style="color:rgb(0,51,153)">System</span>.<span style="color:rgb(0,102,51)">err</span>.<span style="color:rgb(0,102,51)">println</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;messageReceived send message &quot;</span><span style="color:rgb(51,153,51)">+</span>e.<span style="color:rgb(0,102,51)">getMessage</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,0,0)"><strong>try</strong></span> <span style="color:rgb(0,153,0)">{</span>
            <span style="color:rgb(0,51,153)">Thread</span>.<span style="color:rgb(0,102,51)">sleep</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(204,102,204)">1000</span><span style="color:rgb(51,153,51)">*</span><span style="color:rgb(204,102,204)">3</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,153,0)">}</span> <span style="color:rgb(0,0,0)"><strong>catch</strong></span> <span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,51,153)">Exception</span> ex<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
            ex.<span style="color:rgb(0,102,51)">printStackTrace</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,153,0)">}</span>
        e.<span style="color:rgb(0,102,51)">getChannel</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span>.<span style="color:rgb(0,102,51)">write</span><span style="color:rgb(0,153,0)">(</span>e.<span style="color:rgb(0,102,51)">getMessage</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
    <span style="color:rgb(0,153,0)">}</span>
&nbsp;
    @Override
    <span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,102)"><strong>void</strong></span> exceptionCaught<span style="color:rgb(0,153,0)">(</span>
            ChannelHandlerContext ctx, ExceptionEvent e<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,153,0)">{</span>
        <span style="color:rgb(102,102,102)"><em>// Close the connection when an exception is raised.</em></span>
        logger.<span style="color:rgb(0,102,51)">log</span><span style="color:rgb(0,153,0)">(</span>
                Level.<span style="color:rgb(0,102,51)">WARNING</span>,
                <span style="color:rgb(0,0,255)">&quot;Unexpected exception from downstream.&quot;</span>,
                e.<span style="color:rgb(0,102,51)">getCause</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        e.<span style="color:rgb(0,102,51)">getChannel</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span>.<span style="color:rgb(0,102,51)">close</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
    <span style="color:rgb(0,153,0)">}</span>
<span style="color:rgb(0,153,0)">}</span></pre>
    </div>
  </div>
  <p>å¯¹äºŽç¼–ç ?å’Œè§£ç ?Handlerï¼Œå¤?ç”¨MessageEncoderå’ŒMessageDecoderå?³å?¯ã€‚</p>
  <h3>3.2ã€? MessageClientPipelineFactory</h3>
  <div>
    <div>
      <pre class="prettyprint"><span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>class</strong></span> MessageClientPipelineFactory <span style="color:rgb(0,0,0)"><strong>implements</strong></span>
        ChannelPipelineFactory <span style="color:rgb(0,153,0)">{</span>
&nbsp;
    <span style="color:rgb(0,0,0)"><strong>public</strong></span> ChannelPipeline getPipeline<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,0,0)"><strong>throws</strong></span> <span style="color:rgb(0,51,153)">Exception</span> <span style="color:rgb(0,153,0)">{</span>
        ChannelPipeline pipeline <span style="color:rgb(51,153,51)">=</span> pipeline<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
&nbsp;
        pipeline.<span style="color:rgb(0,102,51)">addLast</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;decoder&quot;</span>, <span style="color:rgb(0,0,0)"><strong>new</strong></span> MessageDecoder<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        pipeline.<span style="color:rgb(0,102,51)">addLast</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;encoder&quot;</span>, <span style="color:rgb(0,0,0)"><strong>new</strong></span> MessageEncoder<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        pipeline.<span style="color:rgb(0,102,51)">addLast</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,255)">&quot;handler&quot;</span>, <span style="color:rgb(0,0,0)"><strong>new</strong></span> MessageClientHandler<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
&nbsp;
        <span style="color:rgb(0,0,0)"><strong>return</strong></span> pipeline<span style="color:rgb(51,153,51)">;</span>
    <span style="color:rgb(0,153,0)">}</span>
<span style="color:rgb(0,153,0)">}</span></pre>
    </div>
  </div>
  <h3>3.3ã€?MessageClient</h3>
  <div>
    <div>
      <pre class="prettyprint"><span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>class</strong></span> MessageClient <span style="color:rgb(0,153,0)">{</span>
&nbsp;
    <span style="color:rgb(0,0,0)"><strong>public</strong></span> <span style="color:rgb(0,0,0)"><strong>static</strong></span> <span style="color:rgb(0,0,102)"><strong>void</strong></span> main<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,51,153)">String</span><span style="color:rgb(0,153,0)">[</span><span style="color:rgb(0,153,0)">]</span> args<span style="color:rgb(0,153,0)">)</span> <span style="color:rgb(0,0,0)"><strong>throws</strong></span> <span style="color:rgb(0,51,153)">Exception</span> <span style="color:rgb(0,153,0)">{</span>
        <span style="color:rgb(102,102,102)"><em>// Parse options.</em></span>
        <span style="color:rgb(0,51,153)">String</span> host <span style="color:rgb(51,153,51)">=</span> <span style="color:rgb(0,0,255)">&quot;127.0.0.1&quot;</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(0,0,102)"><strong>int</strong></span> port <span style="color:rgb(51,153,51)">=</span> <span style="color:rgb(204,102,204)">8080</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(102,102,102)"><em>// Configure the client.</em></span>
        ClientBootstrap bootstrap <span style="color:rgb(51,153,51)">=</span> <span style="color:rgb(0,0,0)"><strong>new</strong></span> ClientBootstrap<span style="color:rgb(0,153,0)">(</span>
                <span style="color:rgb(0,0,0)"><strong>new</strong></span> NioClientSocketChannelFactory<span style="color:rgb(0,153,0)">(</span>
                        Executors.<span style="color:rgb(0,102,51)">newCachedThreadPool</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span>,
                        Executors.<span style="color:rgb(0,102,51)">newCachedThreadPool</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(102,102,102)"><em>// Set up the event pipeline factory.</em></span>
        bootstrap.<span style="color:rgb(0,102,51)">setPipelineFactory</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,0)"><strong>new</strong></span> MessageClientPipelineFactory<span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(102,102,102)"><em>// Start the connection attempt.</em></span>
        ChannelFuture future <span style="color:rgb(51,153,51)">=</span> bootstrap.<span style="color:rgb(0,102,51)">connect</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,0,0)"><strong>new</strong></span> InetSocketAddress<span style="color:rgb(0,153,0)">(</span>host, port<span style="color:rgb(0,153,0)">)</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(102,102,102)"><em>// Wait until the connection is closed or the connection attempt fails.</em></span>
        future.<span style="color:rgb(0,102,51)">getChannel</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span>.<span style="color:rgb(0,102,51)">getCloseFuture</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span>.<span style="color:rgb(0,102,51)">awaitUninterruptibly</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
        <span style="color:rgb(102,102,102)"><em>// Shut down thread pools to exit.</em></span>
        bootstrap.<span style="color:rgb(0,102,51)">releaseExternalResources</span><span style="color:rgb(0,153,0)">(</span><span style="color:rgb(0,153,0)">)</span><span style="color:rgb(51,153,51)">;</span>
    <span style="color:rgb(0,153,0)">}</span>
<span style="color:rgb(0,153,0)">}</span></pre>
    </div>
  </div>
  <p>åœ¨å†™å®¢æˆ·ç«¯ä¾‹å­?æ—¶ï¼Œæˆ‘æƒ³åƒ?çš„ä»£ç ?å¹¶ä¸?æ˜¯è¿™æ ·çš„ï¼Œå¯¹å®¢æˆ·ç«¯çš„ä»£ç ?æˆ‘ä¹Ÿæ²¡å?šè¿‡å¤šçš„ç ”ç©¶ï¼Œæ‰€ä»¥ä¹Ÿå?¯èƒ½æ²¡æœ‰æ‰¾åˆ°æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨ä¸Šé?¢çš„ä¾‹å­?ä¸­ï¼Œbootstrap.connectæ–¹æ³•ä¸­ä¼šè§¦å?‘å®žé™…çš„è¿žæŽ¥æ“?ä½œï¼ŒæŽ¥ç?€è§¦å?‘ MessageClientHandler.channelConnectedï¼Œä½¿æ•´ä¸ªè¿‡ç¨‹è¿?è½¬èµ·æ?¥ã€‚ä½†æ˜¯ï¼Œæˆ‘æƒ³è¦?çš„æ˜¯ä¸€ä¸ªè¿žæŽ¥æ± ï¼Œå¹¶ä¸”å¦‚ä½•å†™æ•°æ?®ä¹Ÿä¸?åº”è¯¥åœ¨channelConnectedä¸­ï¼Œè¿™æ ·å¯¹äºŽåŠ¨æ€?çš„æ•°æ?®ï¼Œå?ªèƒ½åœ¨æž„é€ å‡½æ•°ä¸­ä¼ é€’éœ€è¦?å†™çš„æ•°æ?®äº†ã€‚ä½†åˆ°çŽ°åœ¨ï¼Œæˆ‘è¿˜ä¸?æ¸…æ¥šå¦‚ä½•å°†è¿žæŽ¥æ± å’Œ ChannelPipelineæœ‰æ•ˆçš„ç»“å?ˆèµ·æ?¥ã€‚æˆ–è®¸ï¼Œè¿™æ ·çš„éœ€æ±‚å?¯ä»¥è·¨è¿‡Nettyæ?¥å®žçŽ°ã€‚</p>
  <h2>4ã€?æ€»ç»“</h2>
  <p>å…³äºŽNettyçš„åˆ?æ­¥ä½¿ç”¨ï¼Œå°šä¸”æ€»ç»“åˆ°è¿™é‡Œã€‚å…³äºŽè¿™ç¯‡æ–‡ç« ï¼Œå†™å¾—æ–­æ–­ç»­ç»­ï¼Œä»¥è‡³äºŽåˆ°å?Žæ?¥æˆ‘éƒ½æ²¡å…´è¶£æŠŠå†…å®¹éƒ½æ•´ç?†å‡ºæ?¥ã€‚å½“ç„¶ï¼Œè¿™å¤šå°‘ä¹Ÿæ˜¯å› ä¸ºæˆ‘æ˜¯å…ˆæ•´ç?† NettyåŽŸç?†æ–¹é?¢çš„ä¸œè¥¿æ‰€è‡´ã€‚æˆ‘ä¹Ÿå?ªèƒ½å?‘å¾®çš„æœŸæœ›ï¼Œè¯¥æ–‡å¯¹Nettyå…¥é—¨è€…ä¼šæœ‰äº›è®¸å¸®åŠ©ã€‚</p>
</div>

		</div>		
	</div>
	<div class="span4">
			<div id ="related_topics" class="related_topics">

			</div>
		<div class="operate_zone">
			<h4 class="side_article_list_title">å¦‚æžœä½ æ„Ÿå…´è¶£</h4>
			<div class="article_like">
					<button class="btn btn-large liked" id="my_like2" data_id="ZJF3Av">
						<!-- <i class="icon-thumbs-up"></i>-->
						<i class="icon-heart-empty"></i>
						å–œ æ¬¢
					</button>
					<button class="btn btn-large liked" id="my_like" data_id="ZJF3Av">
						<i class="icon-star-empty"></i>
						æ”¶ è—?
					</button>
			</div>

			<h4 class="side_article_list_title">åˆ†äº«è¯¥æ–‡ç« </h4>
			<div class="share_zone">				
				<script type="text/javascript" charset="utf-8">
				(function(){
				  var _w = 32 , _h = 32;
				  var param = {
				    url:location.href,
				    type:'1',
				    count:'', /**æ˜¯å?¦æ˜¾ç¤ºåˆ†äº«æ•°ï¼Œ1æ˜¾ç¤º(å?¯é€‰)*/
				    appkey:'', /**æ‚¨ç”³è¯·çš„åº”ç”¨appkey,æ˜¾ç¤ºåˆ†äº«æ?¥æº?(å?¯é€‰)*/
				    title:'nettyåˆ?æ­¥ä½¿ç”¨', /**åˆ†äº«çš„æ–‡å­—å†…å®¹(å?¯é€‰ï¼Œé»˜è®¤ä¸ºæ‰€åœ¨é¡µé?¢çš„title)*/
				    pic:'', /**åˆ†äº«å›¾ç‰‡çš„è·¯å¾„(å?¯é€‰)*/
				    ralateUid:'2609648351', /**å…³è?”ç”¨æˆ·çš„UIDï¼Œåˆ†äº«å¾®å?šä¼š@è¯¥ç”¨æˆ·(å?¯é€‰)*/
						language:'zh_cn', /**è®¾ç½®è¯­è¨€ï¼Œzh_cn|zh_tw(å?¯é€‰)*/
				    rnd:new Date().valueOf()
				  }
				  var temp = [];
				  for( var p in param ){
				    temp.push(p + '=' + encodeURIComponent( param[p] || '' ) )
				  }
				  document.write('<iframe id="sina_share" allowTransparency="true" frameborder="0" scrolling="no" src="http://hits.sinajs.cn/A1/weiboshare.html?' + temp.join('&') + '" width="'+ _w+'" height="'+_h+'"></iframe>')
				})()
				</script>	
				<div id="qqwb_share__" data-appkey="801319615" data-icon="0" data-counter="0" data-content="nettyåˆ?æ­¥ä½¿ç”¨ ï¼ˆåˆ†äº«è‡ª @tuicoolï¼‰" data-pic="http://img0.tuicool.com/"></div>
				<script src="http://mat1.gtimg.com/app/openjs/openjs.js#autoboot=no&debug=no"></script>
										
				<a id="douban_share" target="_blank" href="http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=douban&amp;url=http://www.tuicool.com/articles/ZJF3Av&amp;title=nettyåˆ?æ­¥ä½¿ç”¨" title="åˆ†äº«åˆ°è±†ç“£"></a>
				
				<a id="qqzone_share" target="_blank" href="http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=qzone&amp;url=http://www.tuicool.com/articles/ZJF3Av&amp;title=nettyåˆ?æ­¥ä½¿ç”¨ ï¼ˆåˆ†äº«è‡ª @tuicoolï¼‰" title="åˆ†äº«åˆ°QQç©ºé—´"></a>

				<div class="pull-left btn-group">
	        <button style="height: 32px; font-size:14px" class="btn btn-primary dropdown-toggle pull-right tohide" data-toggle="dropdown"><i class="icon icon-share-alt icon-white"></i> åˆ†äº«åˆ° <span class="caret"></span></button>
	        <ul class="dropdown-menu">	         
	          <li><a target="_blank" href="http://s.evernote.com/grclip?url=http://www.tuicool.com/articles/ZJF3Av&amp;title=nettyåˆ?æ­¥ä½¿ç”¨">å?°è±¡ç¬”è®°</a></li>
	          <li><a target="_blank" href="http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=renren&amp;url=http://www.tuicool.com/articles/ZJF3Av&amp;title=nettyåˆ?æ­¥ä½¿ç”¨" title="åˆ†äº«åˆ°äººäººç½‘">äººäººç½‘</a></li>
	          <li><a target="_blank" href="http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=fbook&amp;url=http://www.tuicool.com/articles/ZJF3Av&amp;title=nettyåˆ?æ­¥ä½¿ç”¨" title="åˆ†äº«åˆ°Facebook">Facebook</a></li>	
	          <li><a target="_blank" href="http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=twi&amp;url=http://www.tuicool.com/articles/ZJF3Av&amp;title=nettyåˆ?æ­¥ä½¿ç”¨" title="åˆ†äº«åˆ°Twitter">Twitter</a></li>	
	          <li><a target="_blank" href="http://share.baidu.com/s?type=text&amp;searchPic=0&amp;sign=on&amp;to=linkedin&amp;url=http://www.tuicool.com/articles/ZJF3Av&amp;title=nettyåˆ?æ­¥ä½¿ç”¨" title="åˆ†äº«åˆ°Linkedin">Linkedin</a></li>
	          <li>
	          	<a href="https://plus.google.com/share?url={http://www.tuicool.com/articles/ZJF3Av}" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" title="åˆ†äº«åˆ°G+">
	          		Google +
	          	</a>
	          </li>
	          <li class="divider"></li>
	          <li><a href="mailto:?subject=å¥½æ–‡åˆ†äº«ï¼šnettyåˆ?æ­¥ä½¿ç”¨&amp;body=/articles/ZJF3Av">E-Mail</a></li>
	        </ul>
	      </div>	
			</div>			
			
			<!--<a class="sept-bar " href="/septs" target="_blank">æœ‰ä¸€äº›ä¹¦è¦?é€?ç»™ä½  > </a> -->
			
		</div>		
	</div>
</div>	
	<div class="row-fluid" style="margin-top:0;">
	<div class="span8">		
		<div id="site_articles" ></div>
    
    <div id="kan_articles"></div>

    <div id="article_weibo" > 
    </div>

		<div class="comments">
			<div class="cover">
				<div class="comment-notlogin">
					è¯·ç™»å½•å?Žè¯„è®º</br>
				  <small style="margin-top: 5px;">å·²å?‘è¡¨è¯„è®ºæ•°(<span class="comment_cnt"></span>)</small>
				</div>
				<div class="comment-loading">
					<div id="spinner2"></div>
					è¯„è®ºåŠ è½½ä¸­
				</div>				
			</div>
			<div class="comments-area" style="display:none;">
				<div class="comments-list">
					<div class="empty-cmts alert alert-success" style="display:none;">æ²¡æœ‰æ›´å¤šè¯„è®ºäº†^^</div>					
				</div>
				<div class="more-comments" style="display:none;">
          <!--
					<a href="/articles/ZJF3Av/comments" target="_blank">æ‰€æœ‰è¯„è®º</a>-->
					<a href=""  >æ›´å¤šè¯„è®º</a>
				</div>
					<div class="load-fail" style="display:none;">è¯„è®ºåŠ è½½å¤±è´¥ï¼Œ<a href="javascript:reload_comments('ZJF3Av',1,0,-1);">é‡?æ–°åŠ è½½</a></div>
			</div>
		</div>

	</div>

	<div class="span4">		

	</div>
	</div>
<div id="article-correct-modal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
  <div class="modal-header">
  	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>æ–‡ç« çº é”™</h3>
  </div>
  <div class="modal-body">
  	<input type="hidden" value="ZJF3Av" id="article-correct-source">
  		<div>
		  	<label for="article-correct-email">é‚®ç®±</label>
		    <input type="email" id="article-correct-email" class="input-large" />
		  </div>
	  <div>
	  	<label for="article-correct-select">é”™è¯¯ç±»åž‹</label>
	  	<select id="article-correct-select">
	  		<option value="æ­£æ–‡ä¸?å‡†ç¡®">æ­£æ–‡ä¸?å‡†ç¡®</option>
	  		<option value="æŽ’ç‰ˆæœ‰é—®é¢˜">æŽ’ç‰ˆæœ‰é—®é¢˜</option>
	  		<option value="æ²¡æœ‰åˆ†é¡µå†…å®¹">æ²¡æœ‰åˆ†é¡µå†…å®¹</option>
	  		<option value="è§†é¢‘æ— æ³•æ˜¾ç¤º">è§†é¢‘æ— æ³•æ˜¾ç¤º</option>
	  		<option value="å›¾ç‰‡æ— æ³•æ˜¾ç¤º">å›¾ç‰‡æ— æ³•æ˜¾ç¤º</option>	  			  		
	  	</select>
	  </div>
	  <div>
	  	<label for="article-correct-other">è¡¥å……ä¿¡æ?¯</label>
	    <textarea id="article-correct-other" class="span6"></textarea>
	  </div>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary pull-right huodong_correct_submit" id="article-correct-submit">æ??äº¤</button>
  </div>
</div>
<div id="myLoginModal" class="modal hide fade">
	<div class="modal-header">
		<a class="close" data-dismiss="modal" >&times;</a>
		<h3>ç”¨æˆ·ç™»é™†</h3>
	</div>
	<div class="modal-body">
		<form method="post" action="/login" class="form-horizontal" id="login-form">
			<div class="control-group">
				<span class="control-label" for="xlEmail">é‚®ç®±</span>
				<div class="login-controls">
					<input class="input-medium" id="xlEmail" name="email" type="text" />
				</div>
			</div>
			<div class="control-group">
				<span class="control-label">å¯†ç ?</span>
				<div class="login-controls">
					<input id="xlPassword" name="password" class="input-medium" type="password" />
				</div>
			</div>
			<div class="form-actions">
				<button type="submit" class="btn btn-primary">
					&nbsp;&nbsp;ç™»&nbsp;&nbsp;&nbsp;é™†&nbsp;&nbsp;
				</button>
			</div>
		</form>
	</div>
</div>

<div class="read-later-alert"></div>
<style type="text/css">
#dup-cnt{
	display: none;
}
.btn-large{
	padding: 0;
}
.load-fail{
  display:none;
}
.header-title{
  margin-bottom:10px;
  line-height:25px;
}
.header-title span{
  font-size:16px;
  height:25px;
}
</style>	
<script src="/assets/highlight.pack.js"></script>

<script type="text/javascript">
		$(document).ready( function() {
	  	$.get("/articles/last_article_by_site_async?sid=yY73em&aid=ZJF3Av",function(data){$('#site_articles').append(data)});
	  		$.get("/articles/related_with_topics_async?aid=ZJF3Av",function(data){$('#related_topics').append(data)});
		});	
		$.get('/articles/dup_count?id=ZJF3Av',function(data){
			if(data.success){
				if(data.data > 0){
					$('#dup-cnt').show();
				}
				$('#dup').text(data.data);
			}
		})	

$(document).ready( function() {
	$('pre').each(function(i, e) {
		hljs.highlightBlock(e, "<span class='indent'>  </span>", false)		
	});
  // åŠ è½½ç›¸å…³å¾®
  get_weibo("ZJF3Av");
	//async_do_like_article();
    // åŠ è½½ç›¸å…³çš„æŽ¨åˆŠ
  related_kan("ZJF3Av");
  open_add_article_to_kan("false");
	async_do_like2_article(); 
	window.page = 0;
	window.last = 0;	
	window.first = true;	
	resize_article_image('#nei', 550);	
			$('.btn-submit').hide();
			load_comments("ZJF3Av",1,0,-1);
			window.uid = -1;				
	
});
	  

</script>

  <!-- body end -->
</div>

      <!--tc_footer start -->
<div class="footer" style="margin-top:50px;">
    <p>
      <a href="/about" target="_blank">å…³äºŽ</a>
      <a href="/mobile" target="_blank">åº”ç”¨</a>
      <a href="/bbs/go/issues" target="_blank">å??é¦ˆ</a>
      <a href="/bbs" target="_blank">è®¨è®º</a>
      <a href="/links" target="_blank">å?‹é“¾</a>
      <a href="http://chuang.tuicool.com" class="chuang">æŽ¨åˆ›</a>    
    </p>
</div>

<!--   <div class="sept-notify">
    <a href="javascript:close_sept();" class="close pull-right">&times;</a>
    <a class="sept-notify-body" href="/septs" target="_blank">æœ‰ä¸€äº›ä¹¦è¦?é€?ç»™ä½ [ç¬¬ä¸€å­£]</a>
  </div> -->

      <!--tc_footer end -->

<script src="http://s22.cnzz.com/stat.php?id=5541078&web_id=5541078&show=pic" language="JavaScript"></script>
</body>
</html>
