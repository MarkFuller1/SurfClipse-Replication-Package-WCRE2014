<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
			<html>
				<head>
					<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
					<link rel="stylesheet" href="/nabble.pack.css?v=27" type="text/css" />
	<link rel="stylesheet" href="/template/NamlServlet.jtp?macro=site_style" type="text/css" />
					<script src="/util/jquery-1.7.2.pack.js" type="text/javascript"></script>
	<script src="/util/nabbledropdown-2.4.1.pack.js" type="text/javascript"></script>
	<script src="/template/NamlServlet.jtp?macro=javascript_library&amp;v=60" type="text/javascript"></script>
					<script type="text/javascript">
		var terms = Nabble.getSearchTerms();
		var hasTurnOff = false;
		Nabble.searchHighlight = function($elem) {
			if (terms != null && terms.length > 0) {
				$elem.each(function() {
					Nabble.highlightSearchTerms(terms, this);
				});
				if (Nabble.hasHighlightedTerms && !hasTurnOff) {
					var turnOffLink = '<span id="turn-off-highlight-control"><span class="highlight">&nbsp;X&nbsp;</span> ';
					turnOffLink += '<a href="javascript:void(0)" onclick="Nabble.turnOffHighlight()">Turn off highlighting</a></span>';
					$('#topics-controls-right').prepend(turnOffLink);
					hasTurnOff = true;
				}
			}
		};
		Nabble.turnOffHighlight = function() {
			Nabble.deleteCookie("query");
			Nabble.deleteCookie("searchuser");
			Nabble.deleteCookie("searchterms");
			$('span.search-highlight').removeClass('bold highlight');
			$('#turn-off-highlight-control').hide();
		};
	</script>
	<script type="text/javascript">
		Nabble.messageTextWidth();
	</script>
			<script type="text/javascript"> $(document).ready(function() { Nabble.searchHighlight($('h2.post-subject,div.message-text')); }); </script> <script type="text/javascript"> var _hash = Nabble.hash(); if (_hash) { (function(){ var post = _hash.substr(2); var allPosts = [138658, 139313, 139556, 139567, 139576, 139826, 139852, 140125, 140970]; var allURLs = ["/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-td138658.html"]; var iPost = allPosts.indexOf(parseInt(post)); var lower = 0; var upper = lower + 20; if (iPost != -1 && (iPost < lower || iPost >= upper)) location.replace(allURLs[Math.floor(iPost/20)]+_hash); })(); } $(document).ready(function() { var rootId = '138658'; var currentPostId = rootId; var isChangingViews = _hash == '#none'; if (_hash && !isChangingViews) currentPostId = _hash.substr(2); Nabble.hideQuotes(); function scrollToSelectedPost() { var $arrow = $('#red-arrow'+currentPostId).show(); if ($arrow.size() > 0) { var isRootPost = currentPostId == rootId; if (Nabble.isEmbedded) { if (Nabble.canScroll()) scrollTo(0, 0); var y = isChangingViews? null : isRootPost? 1 : $arrow.parents('div.classic-row').offset().top; Nabble.resizeFrames('', y); } else if (Nabble.canScroll() && !isRootPost) { var yPos = $arrow.offset().top; scrollTo(0,yPos-20); } } else { if (Nabble.isEmbedded && Nabble.canScroll()) { Nabble.resizeFrames('', 1); } else { var tb = $('div.top-bar').get(0); if (tb) tb.scrollIntoView(); } } }; $(window).load(scrollToSelectedPost); if (Nabble.isEmbedded) { $('div.message-text img').load(Nabble.resizeFrames); } }); </script> <style type="text/css"> div.classic-header { height:2.2em; clear:both; overflow:hidden; } div.classic-author-name { float:left; width: 140px; overflow: hidden; text-align:center; font-weight:bold; } div.classic-subject-line { left:.5em; overflow:hidden; height:1.3em; position:relative; } div.classic-right-menu { float:right; padding-left:1em; } div.classic-bar { padding:.5em .3em; clear:both; height:1.8em; } table.classic-body { border-collapse:collapse; margin-bottom:1em; table-layout: fixed; width:100%; } td.classic-author { vertical-align: top; text-align:center; width:140px; padding-bottom:1em; } td.classic-message { vertical-align:top; padding:1em; } div.message-text { cursor:text; overflow-x:auto; } div.avatar-inner { margin-left:20px; } div.avatar-outer { width:140px; text-align:left; } div.avatar-label { white-space:nowrap; font-size:80%; } </style>

	<title>OpenJDK Java 2D API - JDK-6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException</title>
			<META NAME="description" CONTENT="JDK-6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException. Hi Phil, I just started looking into this Bug and have already written a test to prove a later fix though...."/>
			<META NAME="keywords" CONTENT="jdk-6870661, setting, custom, printservice, printerjob, leads, printerexception, phil, just, started, looking, into, bug, have, already, written, test, prove, later, fix, though, as, seems, missing, two, checks, make, sure, actual, openjdk, java, 2d, api"/>
			<style type="text/css">
			#search-box-dropdown {
				text-align:left;
				position:absolute;
				display:none;
				z-index:1000;
				overflow:hidden;
			}
		</style>
		<script type="text/javascript">
			$(document).ready(function() {
				var $sdd = $('#search-box-dropdown');
				var $sb = $('#search-input');
				var $form = $sb.parent();
				var timeout;
				$(document).click(function(o){
					var $target = $(o.target);
					if ($target.parents().hasClass('search-box-dropdown')) {
						clearTimeout(timeout);
						$sb.focus();
					}
				});
				$sb.focusin(function(e) {
					$sdd.css('left', $sb.position().left - 5);
					$sdd.width($sb.outerWidth() + 10);
					$sdd.show();
				});
				$sb.focusout(function() {
					timeout = setTimeout(function() {
						$sdd.hide();
					},250);
				});
				$('input[type=radio]', $sdd).change(function() {
					var nodeId = $(this).val();
					$('input[name="node"]', $form).val(nodeId);
				});
				$('input[name="node"]', $form).val(2);
			});
		</script><script type="text/javascript">
			Nabble.setView = function(view,url,post) {
				Nabble.setVar("tview",view);
				url += Nabble.getClientID(';');
				if (url.indexOf('#') == -1)
					url += '#none';
				location.replace(url);
			};
		</script><style type="text/css"> div.nabble-tooltip, div.nabble-tooltip * { color: #EEE; font-weight:bold; } div.nabble-tooltip { background: #000; font-size:90%; line-height:normal; display: none; position: absolute; z-index: 88888; padding: .5em; border: 1px solid #FFF; white-space:normal; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; } div.nabble-tooltip-small-row, div.nabble-tooltip-small-row * { color:#D0EAF2; } div.nabble-tooltip-small-row { font-size:80%; font-weight:normal; padding-top: .4em; } div.nabble-tooltip-arrow { font: 40px Arial, Sans-serif; line-height:1em; left:15px; position:absolute; bottom:-15px; height:15px; width:30px; overflow:hidden; } div.nabble-tooltip-arrow div { position:absolute; } div.nabble-tooltip-arrow div.d1 { top:-22px; color: #FFF; } div.nabble-tooltip-arrow div.d2 { top:-25px; color: #000; } </style> <script type="text/javascript"> Nabble.startTooltip = function(e, position, delay) { if (e.nabbletooltip) return; e.nabbletooltip = true; var $this = $(e); var $arrow = $this.children().last(); var $elem = $this.prev(); $elem.hover( function() { setTip(); setTimer(); }, function() { stopTimer(); $this.hide(); } ); function setTimer() { $this.showTipTimer = setTimeout(function() { $('div.nabble-tooltip').hide(); stopTimer(); $this.fadeTo('fast', .8); }, delay); }; function stopTimer() { clearInterval($this.showTipTimer); }; function setTip(){ if ($this.parent().get() != document.body) $(document.body).append($this); var useTitle = $this.attr('use_title') == 'true'; if (useTitle) { var title = $elem.attr('title'); if (title != '') { $arrow.remove(); $this.html(title); $elem.attr('title',''); $this.append($arrow); } } var win = $(window).width(); if (position == 'up') { var w = $this.outerWidth(); if (w > 250) { w = 250; $this.width(w); } var xMid = $elem.offset().left + $elem.outerWidth()/2; var xTip = xMid - w/2; if (xTip+w > win-5) xTip = win-w-5; if (xTip < 0) xTip = 0; var xArrow = xMid-xTip-11; var yTip = $elem.offset().top-$this.outerHeight()-12; $arrow.css('left', xArrow); $this.css({'top' : yTip, 'left' : xTip}); } else if (position == 'right') { var h = $this.outerHeight(); var yMid = $elem.offset().top + $elem.outerHeight()/2; var yTip = yMid - h/2; var xTip = $elem.offset().left + $elem.outerWidth() + 10; $arrow.width(8).height(24).css({bottom:0,left:-8}); var yArrow = (h - 24)/2; $arrow.css({top:yArrow}); var $d1 = $arrow.children().first(); var $d2 = $arrow.children().last(); $d1.css({top:-11}); $d2.css({top:-11,left:1}); $this.css({'top' : yTip, 'left' : xTip}); } }; }; </script><script type="text/javascript">
			Nabble.pinTopic = function(id) {
				var call = '/template/NamlServlet.jtp?macro=pin_topic&node=' + id + Nabble.getClientID();
				$.getScript(call, function() {
					$('#pin-icon').show();
					NabbleDropdown.show('unpinTopic');
					NabbleDropdown.hide('pinTopic');
					alert('This topic has been pinned.');
				});
			};
		</script><script type="text/javascript">
			Nabble.unpinTopic = function(id) {
				var call = '/template/NamlServlet.jtp?macro=unpin_topic&node=' + id + Nabble.getClientID();
				$.getScript(call, function() {
					$('#pin-icon').hide();
					NabbleDropdown.hide('unpinTopic');
					NabbleDropdown.show('pinTopic');
					alert('This topic has been unpinned.');
				});
			};
		</script><script type="text/javascript">
			Nabble.lockTopic = function(id) {
				var call = '/template/NamlServlet.jtp?macro=lock_topic&node=' + id + Nabble.getClientID();
				$.getScript(call, function() {
					$('#lock-icon').show();
					NabbleDropdown.show('unlockTopic');
					NabbleDropdown.hide('lockTopic');
					alert('This topic has been locked.');
				});
			};
		</script><script type="text/javascript">
			Nabble.unlockTopic = function(id) {
				var call = '/template/NamlServlet.jtp?macro=unlock_topic&node=' + id + Nabble.getClientID();
				$.getScript(call, function() {
					$('#lock-icon').hide();
					NabbleDropdown.hide('unlockTopic');
					NabbleDropdown.show('lockTopic');
					alert('This topic has been unlocked.');
				});
			};
		</script><script type="text/javascript">
		var starredImg = new Image();
		starredImg.src = "/images/icon_starred.png";
		var unstarredImg = new Image();
		unstarredImg.src = "/images/icon_unstarred.png";
		var star = '<img src="/images/icon_starred.png" class="star" alt="star"/>';

		function starInit(isStarred, c, id) {
			$('#star'+c+id)
				.css('cursor','pointer')
				.click(function(){
					starToggle(c,id);
				});

			starShow(isStarred,c,id);
		};

		function starShow(isStarred,c,id) {
			var $img = $('#img-star'+c+id);
			if (isStarred)
				$img.attr('src', starredImg.src).attr('title', "Favorite (click to remove this item from your favorites list)");
			else
				$img.attr('src', unstarredImg.src).attr('title', "Add this item to your favorites list");
			updateReadonlyStars(isStarred, id);
		};

		function updateReadonlyStars(isStarred, id) {
			var $stars = $('#starC'+id+',#starD'+id);
			$stars.html(isStarred? star : '');
		};

		function starToggle(c,id) {
			if (!Nabble.userId) {
				if( confirm("You must log in to star this item.\nWould you like to login now?") ) {
					parent.location = "/template/NamlServlet.jtp?macro=login_page&nextUrl="+encodeURIComponent(parent.location) + Nabble.getClientID();
				}
				return;
			}
			var $img = $('#img-star'+c+id);
			var isStarred = $img.attr('src') == starredImg.src;
			isStarred = !isStarred;
			var descendants = c == 'A';
			var path = "/template/NamlServlet.jtp?node=" + id;
			if( descendants && !isStarred )
				path += "&macro=clear_descendant_stars";
			else
				path += "&macro=set_star&star=" + isStarred;
			$.getScript(path + Nabble.getClientID(), function() {
				starShow(isStarred,c,id);
			});
		};
	</script><script type="text/javascript" src="http://www.adbayes.com/LoadUnit.jtp?c=1"></script>
			<script type="text/javascript">
				Nabble.adbayes();
			</script><script type="text/javascript">
			Nabble.nViews = function(id, views) {
				var $v = $('#v'+id);
				var pos = views=='1'?0:1;
				var t = $v.html()? $v.html().split('|')[pos]:'';
				$v.html(t == ''? views : t.replace(/%1/g,views)).show();
			};
		</script><style type="text/css">
			img.report-flag {
				vertical-align:middle;
				cursor: pointer;
			}
			#report-inappropriate-content {
				position: fixed;
				z-index:9999;
				display:none;
				padding:1.5em;
				left:8%;
				right:8%;
				top:8%;
				background-color:#555;
			}
			#report-inappropriate-content-inner { padding:.5em; }
			#report-inappropriate-content-inner div.big {
				height:5em;
				padding-top:2em;
				text-align:center;
				font-size:250%;
			}
			#report-inappropriate-content-inner div.big2 { font-size:70%; }
			div.inappropriate-option { margin:.5em 0; }
		</style>
		<script type="text/javascript">
			var reportNodeId = null;
			Nabble.reportContent = function(nodeId) {
				reportNodeId = nodeId;
				$('#report-inappropriate-content').show();
				var url = '/template/NamlServlet.jtp?macro=report_inappropriate_content_form';
				$.get(url, function(data) {
					$('#report-inappropriate-content-inner').html(data);
				});
			}
			Nabble.closeReport = function() {
				$('#report-inappropriate-content').hide();
			}
			Nabble.sendReport = function() {
				$('#send-report-button').attr('disabled','true').addClass('toolbar-disabled');
				var type = $('input[name=report_type]:checked').val();
				var url = '/template/NamlServlet.jtp?macro=report_inappropriate_content_submit&node='+reportNodeId+'&type='+type+Nabble.getClientID();
				$.get(url, function(data) {
					var h = 'Thank You';
					h += '<div class="weak-color big2">We will review your report soon.</div>';
					h += '<a href="javascript: void Nabble.closeReport()">Close</a>';
					$('#report-inappropriate-content-inner').html('<div class="big">'+h+'</div>');
				});
			}
		</script>
					<script type="text/javascript">
		Nabble.setFontSize();
		
	</script>
	<script type="text/javascript">
		if (Nabble.analytics) Nabble.analytics();
	</script>
	<!-- Start Quantcast tag -->
	<script type="text/javascript">
		_qoptions={ qacct:"p-34EL1DZyJypTI" };
	</script>
	<script type="text/javascript" src="http://edge.quantserve.com/quant.js"></script>
	<noscript>
		<a href="http://www.quantcast.com/p-34EL1DZyJypTI" target="_blank" rel="nofollow">
			<img src="http://pixel.quantserve.com/pixel/p-34EL1DZyJypTI.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
		</a>
	</noscript>
	<!-- End Quantcast tag -->
	<!-- Start Google Analytics -->
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['nabble._setAccount', 'UA-91855-9']);
		_gaq.push(['nabble._trackPageview']);
		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
	<!-- End Google Analytics -->
	<script type="text/javascript">
		var site_admins = [2];
	</script>
	<script type="text/javascript">
		var isSafe = true;
		var Ads = Ads || {};
		Ads.text = {
			daysLeft: 'Trial period ends in $1 day(s)',
			removeAds: 'Remove Ads',
			buyCredits: 'Buy credits'
		};
		$(document).ready(function() {
			if (Nabble.wasCreatedRecently && Nabble.currentCredits == 0) {
				var s = '<div class="weak-color" style="text-align:center;margin:1em;font-size:80%">';
				s += Ads.text.daysLeft.replace(/\$1/,daysLeft)+' &ndash; ';
				s += '<a href="'+Nabble.buyCreditsPath+'">'+(Nabble.isSafe?Ads.text.removeAds:Ads.text.buyCredits)+'</a>';
				s += '</div>';
				var isAdmin = Nabble.userId && site_admins.indexOf(Number(Nabble.userId)) >= 0;
				if (!isSafe || isAdmin)
					$('div.nabble').append(s);
			}
		});
	</script>
	<script type="text/javascript">
		$(document).ready(function() {
			if (Nabble.userId && site_admins.indexOf(Number(Nabble.userId)) >= 0)
				$('div.no-ads-message').show();
		});
	</script>
				</head>
				<body>
					<div id="notice" class="notice rounded-bottom"></div>
					<div class="nabble macro_classic_forum_topic" id="nabble">
						
			
			<div class="top-bar">
		<div class="breadcrumbs" style="float:left">
			<span id="breadcrumbs" class="weak-color">
		<a href="http://openjdk.5641.n7.nabble.com/">OpenJDK</a>
						<span> &rsaquo; </span>
				<a href="http://openjdk.5641.n7.nabble.com/OpenJDK-Java-2D-API-f95531.html">OpenJDK Java 2D API</a>
	</span>
		</div>
		<div style="text-align:right;">
			<span style="white-space:nowrap;" id="nabble-user-header"></span>
	<script type="text/javascript">Nabble.userHeader();</script>
		</div>
	</div>
			
			<div id="nabble-newsflash" class="info-message" style="display:none;padding:.5em;margin-bottom:.5em"></div>
	
			<div id="topic-search-box" class="search-box float-right" style="padding:.5em 0">
		<form action="/template/NamlServlet.jtp">
		<input type="hidden" name="macro" value="search_page" />
		<input type="hidden" name="node" value="138658" />
		
		
		
		
		<input id="search-input" name="query" size="18" class="medium-border-color"/>
		<div id="search-box-dropdown" class="search-box-dropdown light-bg-color drop-shadow border1 medium-border-color rounded-bottom">
		<div style="margin:.5em .5em 0 .5em">
					<b>Search</b><br/>
					<input id="search-root-node" type="radio" name="n" value="2" checked="true"/>
					<label for="search-root-node">everywhere</label><br/>

					<input id="search-this-node" type="radio" name="n" value="138658"/>
					<label for="search-this-node">
						only in this topic
					</label>
				</div>
		<div style="margin:.5em;line-height:2em">
			<input class="toolbar action-button float-right" type="submit" value="Search"/>
			<a href="/template/NamlServlet.jtp?macro=adv_search_page&amp;node=138658" rel="nofollow" style="font-size:80%">Advanced Search</a>
		</div>
	</div>
	</form>
	</div>

	<h1 id="post-title" class="adbayes-content" style="margin:0.25em 0 .8em">
		JDK-6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h1>
			<div style="margin:1.2em 0 5em">
		<div id="topics-controls-left" class="float-left nowrap">
			<table>
		<tr>
			<td style="padding-right:.1em">
		<img src="/images/view-classic.gif" width="18" height="18" style="border:none" alt="classic"/>
	</td>

	<td style="padding-right:1.1em">
		Classic
	</td>

			<td style="padding-right:.1em">
		<a href="javascript:void(0)" onclick="Nabble.setView('list', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tc138658.html',null)"><img src="/images/view-list.gif" width="18" height="18" style="border:none" alt="list"/></a>
	</td>

	<td style="padding-right:1.1em">
		<a href="javascript:void(0)" onclick="Nabble.setView('list', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tc138658.html',null)">List</a>
	</td>

			<td style="padding-right:.1em">
		<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html',null)"><img src="/images/view-threaded.gif" width="18" height="18" style="border:none" alt="threaded"/></a>
	</td>

	<td style="padding-right:1.1em">
		<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html',null)">Threaded</a>
	</td>
		</tr>
	</table>
		</div>
		<div id="topics-controls-right" class="float-right nowrap" style="padding-top:.3em">
			<span style="padding-right:1em;height:21px">
		<img id="pin-icon" src="/images/pin.png" width="20" height="21" title="This topic has been pinned in OpenJDK Java 2D API." style="vertical-align:middle;display:none;"/>
		<div id="tooltip81857" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip81857'), 'up', 400);
	</script>
	</span>
	<span id="lock-icon" class="weak-color" style="padding:0 .5em;margin-right:.5em;display:none;">
		<img src="/images/lock_sm.png" width="10" height="15" style="vertical-align:middle"/> Locked
	</span>
	<span style="padding-right:1em">
		9 messages
	</span>
	<img src="/images/gear.png" class="image16" alt="Options"/>
	<span id="dd_topicdropdown"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("topicdropdown", "Options","Click for more options");
		
		dropdown.add('topicSubscriptionLink', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dsubscribe&amp;node\x3D138658\" rel\x3D\"nofollow\"\x3ESubscribe via email\x3C/a\x3E');
		dropdown.addSeparator();
		dropdown.add('moveTopic', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D138658\" rel\x3D\"nofollow\"\x3EMove topic\x3C/a\x3E', 'display:none');
		dropdown.add('pinTopic', '\x3Ca href\x3D\"javascript: void Nabble.pinTopic(138658)\" rel\x3D\"nofollow\"\x3EPin topic\x3C/a\x3E', 'display:none');
		dropdown.add('unpinTopic', '\x3Ca href\x3D\"javascript: void Nabble.unpinTopic(138658)\" rel\x3D\"nofollow\"\x3EUnpin topic\x3C/a\x3E', 'display:none');
		dropdown.add('lockTopic', '\x3Ca href\x3D\"javascript: void Nabble.lockTopic(138658)\" rel\x3D\"nofollow\"\x3ELock topic\x3C/a\x3E', 'display:none');
		dropdown.add('unlockTopic', '\x3Ca href\x3D\"javascript: void Nabble.unlockTopic(138658)\" rel\x3D\"nofollow\"\x3EUnlock topic\x3C/a\x3E', 'display:none');
		dropdown.add('deleteRecursively', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(138658)\" rel\x3D\"nofollow\"\x3EDelete this topic\x3C/a\x3E', 'display:none');
			dropdown.add('deletePost', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(138658)\" rel\x3D\"nofollow\"\x3EDelete this topic\x3C/a\x3E', 'display:none');
		dropdown.add('changeMetaTags', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_title_and_meta_tags&amp;node\x3D138658\" rel\x3D\"nofollow\"\x3EChange title and meta tags\x3C/a\x3E', 'display:none');
		dropdown.add('embedPost138658', '\x3Ca href\x3D\"/embed/EmbedOptions.jtp?node\x3D138658\" rel\x3D\"nofollow\"\x3EEmbed post\x3C/a\x3E');
		dropdown.add('permalink138658', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.build('dd_topicdropdown');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=topic_dropdown_later&node=138658' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
		</div>
	</div>
			<div id="topic-contents" style="margin-top:1em;clear:both">
		<div id="classic-contents">
		
		<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889">Patrick Reinhart</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="/template/NamlServlet.jtp?macro=reply&amp;node=138658" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html',138658)">Threaded</a>
	<div id="tooltip34677" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip34677'), 'up', 400);
	</script> |
					<span id="dd_postdropdown138658"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown138658", "More","Click for more options");
		
		dropdown.add('replyToAuthor138658', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D138658\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost138658', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D138658\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost138658', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D138658\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost138658', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(138658)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively138658', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(138658)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate138658', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D138658\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print138658', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D138658\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink138658', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail138658', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D138658\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown138658');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=138658' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
					&nbsp;
					<img src="/images/flag_gray.png" class="report-flag" onclick="Nabble.reportContent(138658)"/>
	<div id="tooltip93336" class="nabble-tooltip" use_title="false">
		Report Content as Inappropriate
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip93336'), 'up', 400);
	</script>
					<span id="starB138658">
		<img id="img-starB138658" src="/images/icon_unstarred.png" class="star" alt="star" title="Add this item to your favorites list"/>
		<div id="tooltip33199" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip33199'), 'up', 400);
	</script>
	</span>
	
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow138658" class="float-left invisible" style="margin-top:.2em">
		<img title="Selected post" width="15" height="15" src="/images/arrow.png" alt="Selected post"/>
	</span>
					<span class="post-date float-left">
		<span id="d1370982744000-289"></span><script type="text/javascript">
		Nabble.get('d1370982744000-289').innerHTML= Nabble.formatDateLong(new Date(1370982744000));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		JDK-6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889" rel="nofollow" title="View profile of Patrick Reinhart" class="nowrap no-decoration"><img class="avatar medium-border-color" src="http://www.gravatar.com/avatar/684127484e37dd2ee0d4c70c6457066d?s=100&amp;r=pg&amp;d=http%3A%2F%2Fn7.nabble.com%2Fimages%2Favatar100.png" height="100" width="100" alt="Patrick Reinhart" title="Patrick Reinhart"/><img src="/images/online.png" class="online889 online invisible" title="User is online" alt="online"/></a>

	
	
		</div>
	</div>
	
	
	<div class="post-count889 avatar-label weak-color"></div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message138658" class="message-text adbayes-content">
		Hi Phil,
<br/><br/>I just started looking into this Bug and have already written a test to 
<br/>prove a later fix though. As it seems that there missing two checks make 
<br/>sure, that the actual PrintService is a instance of W32PrintService &nbsp;
<br/>before passing it to the native method setNativePrintService()
<br/><br/>Fix proposal for this bug is as follows:
<br/><br/><a href="http://reinharts.dyndns.org/6870661/webrev.00" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.00</a><br/><br/>Can you take a look into it and give me some feedback on it. 
<br/>Unfortunally I did not get the Jtreg test running under Windows 
<br/>(executing it as plain Java application at least does work)
<br/><br/>Cheers
<br/><br/>Patrick
<br/><br/>

	
	
	
	</div>
	<script type="text/javascript">
				Nabble.ads('first_classic_message');
			</script>
			
				</td>
			</tr>
		</table>
	</div>
	<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889">Patrick Reinhart</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="/template/NamlServlet.jtp?macro=reply&amp;node=139313" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html#a139313',139313)">Threaded</a>
	<div id="tooltip23087" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip23087'), 'up', 400);
	</script> |
					<span id="dd_postdropdown139313"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown139313", "More","Click for more options");
		
		dropdown.add('replyToAuthor139313', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D139313\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost139313', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D139313\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost139313', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D139313\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost139313', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(139313)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively139313', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(139313)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate139313', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D139313\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print139313', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D139313\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink139313', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658p139313.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail139313', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D139313\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown139313');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=139313' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
					&nbsp;
					<img src="/images/flag_gray.png" class="report-flag" onclick="Nabble.reportContent(139313)"/>
	<div id="tooltip63077" class="nabble-tooltip" use_title="false">
		Report Content as Inappropriate
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip63077'), 'up', 400);
	</script>
					<span id="starB139313">
		<img id="img-starB139313" src="/images/icon_unstarred.png" class="star" alt="star" title="Add this item to your favorites list"/>
		<div id="tooltip18593" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip18593'), 'up', 400);
	</script>
	</span>
	
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow139313" class="float-left invisible" style="margin-top:.2em">
		<img title="Selected post" width="15" height="15" src="/images/arrow.png" alt="Selected post"/>
	</span>
					<span class="post-date float-left">
		<span id="d1371309590000-777"></span><script type="text/javascript">
		Nabble.get('d1371309590000-777').innerHTML= Nabble.formatDateLong(new Date(1371309590000));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		RFR 6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889" rel="nofollow" title="View profile of Patrick Reinhart" class="nowrap no-decoration"><img class="avatar medium-border-color" src="http://www.gravatar.com/avatar/684127484e37dd2ee0d4c70c6457066d?s=100&amp;r=pg&amp;d=http%3A%2F%2Fn7.nabble.com%2Fimages%2Favatar100.png" height="100" width="100" alt="Patrick Reinhart" title="Patrick Reinhart"/><img src="/images/online.png" class="online889 online invisible" title="User is online" alt="online"/></a>

	
	
		</div>
	</div>
	
	
	<div class="post-count889 avatar-label weak-color"></div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message139313" class="message-text adbayes-content">
		Could someone review my fix?
<br/><br/><a href="http://reinharts.dyndns.org/6870661/webrev.00" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.00</a><br/><br/>Cheers
<br/><br/>Patrick
<br/><br/><br/>On 06/11/2013 10:32 PM, Patrick Reinhart wrote:
<div class='shrinkable-quote'><br/>&gt; Hi Phil,
<br/>&gt;
<br/>&gt; I just started looking into this Bug and have already written a test 
<br/>&gt; to prove a later fix though. As it seems that there missing two checks 
<br/>&gt; make sure, that the actual PrintService is a instance of 
<br/>&gt; W32PrintService &nbsp;before passing it to the native method 
<br/>&gt; setNativePrintService()
<br/>&gt;
<br/>&gt; Fix proposal for this bug is as follows:
<br/>&gt;
<br/>&gt; <a href="http://reinharts.dyndns.org/6870661/webrev.00" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.00</a><br/>&gt;
<br/>&gt; Can you take a look into it and give me some feedback on it. 
<br/>&gt; Unfortunally I did not get the Jtreg test running under Windows 
<br/>&gt; (executing it as plain Java application at least does work)
<br/>&gt;
<br/>&gt; Cheers
<br/>&gt;
<br/>&gt; Patrick
<br/>&gt;
</div><br/>

	
	
	
	</div>
	
			
				</td>
			</tr>
		</table>
	</div>
	<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=814">Phil Race</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="/template/NamlServlet.jtp?macro=reply&amp;node=139556" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html#a139556',139556)">Threaded</a>
	<div id="tooltip20308" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip20308'), 'up', 400);
	</script> |
					<span id="dd_postdropdown139556"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown139556", "More","Click for more options");
		
		dropdown.add('replyToAuthor139556', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D139556\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost139556', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D139556\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost139556', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D139556\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost139556', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(139556)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively139556', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(139556)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate139556', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D139556\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print139556', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D139556\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink139556', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658p139556.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail139556', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D139556\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown139556');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=139556' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
					&nbsp;
					<img src="/images/flag_gray.png" class="report-flag" onclick="Nabble.reportContent(139556)"/>
	<div id="tooltip34074" class="nabble-tooltip" use_title="false">
		Report Content as Inappropriate
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip34074'), 'up', 400);
	</script>
					<span id="starB139556">
		<img id="img-starB139556" src="/images/icon_unstarred.png" class="star" alt="star" title="Add this item to your favorites list"/>
		<div id="tooltip37469" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip37469'), 'up', 400);
	</script>
	</span>
	
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow139556" class="float-left invisible" style="margin-top:.2em">
		<img title="Selected post" width="15" height="15" src="/images/arrow.png" alt="Selected post"/>
	</span>
					<span class="post-date float-left">
		<span id="d1371498324792-485"></span><script type="text/javascript">
		Nabble.get('d1371498324792-485').innerHTML= Nabble.formatDateLong(new Date(1371498324792));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		Re: RFR 6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=814" rel="nofollow" title="View profile of Phil Race" class="nowrap no-decoration"><img class="avatar medium-border-color" src="http://www.gravatar.com/avatar/045203b5228012015b9f233fcb1e1933?s=100&amp;r=pg&amp;d=http%3A%2F%2Fn7.nabble.com%2Fimages%2Favatar100.png" height="100" width="100" alt="Phil Race" title="Phil Race"/><img src="/images/online.png" class="online814 online invisible" title="User is online" alt="online"/></a>

	
	
		</div>
	</div>
	
	
	<div class="post-count814 avatar-label weak-color"></div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message139556" class="message-text adbayes-content">
		Patrick,
<br/><br/>The spec. for PrinterJob.setPrintService() says :-
<br/><br/>*Throws:*
<br/>&nbsp; &nbsp; |PrinterException
<br/>&nbsp; &nbsp; &lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html" target="_top" rel="nofollow" link="external">http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html</a>&gt;|
<br/>&nbsp; &nbsp; - if the specified service does not support 2D printing,
<br/>&nbsp; &nbsp; &nbsp; or this PrinterJob class does not support setting a 2D print service,
<br/>&nbsp; &nbsp; or the specified service is otherwise not a valid print service.
<br/><br/>So an exception is expected.
<br/><br/>If I understand your fix you want to change it so that WPrinterJob simply
<br/>doesn't go down to native so is less specific about what Service it will
<br/>accept? But WPrinterJob is completely tied to Win32PrintService
<br/>and windows native printing. The Windows print dialog for example
<br/>will &nbsp;know nothing about your service.
<br/><br/>So this seems like not a bug. You should just use javax.print APIs in 
<br/>this case.
<br/><br/>-phil.
<br/><br/><br/><br/>On 6/15/2013 8:19 AM, Patrick Reinhart wrote:
<div class='shrinkable-quote'><br/>&gt; Could someone review my fix?
<br/>&gt;
<br/>&gt; <a href="http://reinharts.dyndns.org/6870661/webrev.00" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.00</a><br/>&gt;
<br/>&gt; Cheers
<br/>&gt;
<br/>&gt; Patrick
<br/>&gt;
<br/>&gt;
<br/>&gt; On 06/11/2013 10:32 PM, Patrick Reinhart wrote:
<br/>&gt;&gt; Hi Phil,
<br/>&gt;&gt;
<br/>&gt;&gt; I just started looking into this Bug and have already written a test 
<br/>&gt;&gt; to prove a later fix though. As it seems that there missing two 
<br/>&gt;&gt; checks make sure, that the actual PrintService is a instance of 
<br/>&gt;&gt; W32PrintService &nbsp;before passing it to the native method 
<br/>&gt;&gt; setNativePrintService()
<br/>&gt;&gt;
<br/>&gt;&gt; Fix proposal for this bug is as follows:
<br/>&gt;&gt;
<br/>&gt;&gt; <a href="http://reinharts.dyndns.org/6870661/webrev.00" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.00</a><br/>&gt;&gt;
<br/>&gt;&gt; Can you take a look into it and give me some feedback on it. 
<br/>&gt;&gt; Unfortunally I did not get the Jtreg test running under Windows 
<br/>&gt;&gt; (executing it as plain Java application at least does work)
<br/>&gt;&gt;
<br/>&gt;&gt; Cheers
<br/>&gt;&gt;
<br/>&gt;&gt; Patrick
<br/>&gt;&gt;
<br/>&gt;
</div><br/>

	
	
	
	</div>
	
			
				</td>
			</tr>
		</table>
	</div>
	<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889">Patrick Reinhart</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="/template/NamlServlet.jtp?macro=reply&amp;node=139567" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html#a139567',139567)">Threaded</a>
	<div id="tooltip41152" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip41152'), 'up', 400);
	</script> |
					<span id="dd_postdropdown139567"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown139567", "More","Click for more options");
		
		dropdown.add('replyToAuthor139567', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D139567\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost139567', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D139567\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost139567', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D139567\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost139567', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(139567)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively139567', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(139567)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate139567', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D139567\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print139567', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D139567\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink139567', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658p139567.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail139567', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D139567\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown139567');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=139567' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
					&nbsp;
					<img src="/images/flag_gray.png" class="report-flag" onclick="Nabble.reportContent(139567)"/>
	<div id="tooltip96530" class="nabble-tooltip" use_title="false">
		Report Content as Inappropriate
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip96530'), 'up', 400);
	</script>
					<span id="starB139567">
		<img id="img-starB139567" src="/images/icon_unstarred.png" class="star" alt="star" title="Add this item to your favorites list"/>
		<div id="tooltip29523" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip29523'), 'up', 400);
	</script>
	</span>
	
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow139567" class="float-left invisible" style="margin-top:.2em">
		<img title="Selected post" width="15" height="15" src="/images/arrow.png" alt="Selected post"/>
	</span>
					<span class="post-date float-left">
		<span id="d1371502820000-976"></span><script type="text/javascript">
		Nabble.get('d1371502820000-976').innerHTML= Nabble.formatDateLong(new Date(1371502820000));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		Re: RFR 6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889" rel="nofollow" title="View profile of Patrick Reinhart" class="nowrap no-decoration"><img class="avatar medium-border-color" src="http://www.gravatar.com/avatar/684127484e37dd2ee0d4c70c6457066d?s=100&amp;r=pg&amp;d=http%3A%2F%2Fn7.nabble.com%2Fimages%2Favatar100.png" height="100" width="100" alt="Patrick Reinhart" title="Patrick Reinhart"/><img src="/images/online.png" class="online889 online invisible" title="User is online" alt="online"/></a>

	
	
		</div>
	</div>
	
	
	<div class="post-count889 avatar-label weak-color"></div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message139567" class="message-text adbayes-content">
		Hi Phil,
<br/><br/>What irritates me though is the fact, that there is no check for the 
<br/>support/not support of 2D printing and also that the PrinterException 
<br/>does not reflect the described cases of the spec:
<br/><br/>java.awt.print.PrinterException: Invalid name of PrintService.
<br/><br/>I can not see any relation to one of the referred cases of the spec:
<br/>The spec. for PrinterJob.setPrintService() says :-
<div class='shrinkable-quote'><br/>&gt;
<br/>&gt; *Throws:*
<br/>&gt; &nbsp; &nbsp;|PrinterException
<br/>&gt; &lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html" target="_top" rel="nofollow" link="external">http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html</a>&gt;|
<br/>&gt; &nbsp; &nbsp;- if the specified service does not support 2D printing,
<br/>&gt; &nbsp; &nbsp; &nbsp;or this PrinterJob class does not support setting a 2D print 
<br/>&gt; service,
<br/>&gt; &nbsp; &nbsp;or the specified service is otherwise not a valid print service.
<br/>&gt;
<br/>&gt; So an exception is expected.
<br/>&gt;
<br/>&gt; If I understand your fix you want to change it so that WPrinterJob simply
<br/>&gt; doesn't go down to native so is less specific about what Service it will
<br/>&gt; accept? But WPrinterJob is completely tied to Win32PrintService
<br/>&gt; and windows native printing. The Windows print dialog for example
<br/>&gt; will &nbsp;know nothing about your service.
<br/>&gt;
<br/>&gt; So this seems like not a bug. You should just use javax.print APIs in 
<br/>&gt; this case.
<br/>&gt;
</div>Well in my case I had the plan to capture the printer interaction for 
<br/>testing reasons instead of using real printers. In my case a 3th party 
<br/>product was using the setPrintService() method internally, where I did 
<br/>not have the possibility of using the javax.print API in this case. Also 
<br/>irritating was the fact, that under Linux the same method call behaved 
<br/>not the same, in fact there it worked without any problem. Also it seems 
<br/>to be no problem if the print service is of type StreamPrintService 
<br/>where it does more or less the same as my supposed fix. So it can not be 
<br/>tied that completely to the WIn32PrintService.
<br/><br/>Cheers Patrick
<br/><br/><div class='shrinkable-quote'><br/>&gt; -phil.
<br/>&gt;
<br/>&gt;
<br/>&gt;
<br/>&gt; On 6/15/2013 8:19 AM, Patrick Reinhart wrote:
<br/>&gt;&gt; Could someone review my fix?
<br/>&gt;&gt;
<br/>&gt;&gt; <a href="http://reinharts.dyndns.org/6870661/webrev.00" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.00</a><br/>&gt;&gt;
<br/>&gt;&gt; Cheers
<br/>&gt;&gt;
<br/>&gt;&gt; Patrick
<br/>&gt;&gt;
<br/>&gt;&gt;
<br/>&gt;&gt; On 06/11/2013 10:32 PM, Patrick Reinhart wrote:
<br/>&gt;&gt;&gt; Hi Phil,
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; I just started looking into this Bug and have already written a test 
<br/>&gt;&gt;&gt; to prove a later fix though. As it seems that there missing two 
<br/>&gt;&gt;&gt; checks make sure, that the actual PrintService is a instance of 
<br/>&gt;&gt;&gt; W32PrintService &nbsp;before passing it to the native method 
<br/>&gt;&gt;&gt; setNativePrintService()
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Fix proposal for this bug is as follows:
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; <a href="http://reinharts.dyndns.org/6870661/webrev.00" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.00</a><br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Can you take a look into it and give me some feedback on it. 
<br/>&gt;&gt;&gt; Unfortunally I did not get the Jtreg test running under Windows 
<br/>&gt;&gt;&gt; (executing it as plain Java application at least does work)
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Cheers
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Patrick
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;
<br/>&gt;
</div><br/>

	
	
	
	</div>
	
			
				</td>
			</tr>
		</table>
	</div>
	<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=814">Phil Race</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="/template/NamlServlet.jtp?macro=reply&amp;node=139576" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html#a139576',139576)">Threaded</a>
	<div id="tooltip46878" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip46878'), 'up', 400);
	</script> |
					<span id="dd_postdropdown139576"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown139576", "More","Click for more options");
		
		dropdown.add('replyToAuthor139576', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D139576\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost139576', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D139576\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost139576', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D139576\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost139576', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(139576)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively139576', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(139576)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate139576', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D139576\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print139576', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D139576\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink139576', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658p139576.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail139576', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D139576\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown139576');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=139576' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
					&nbsp;
					<img src="/images/flag_gray.png" class="report-flag" onclick="Nabble.reportContent(139576)"/>
	<div id="tooltip34748" class="nabble-tooltip" use_title="false">
		Report Content as Inappropriate
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip34748'), 'up', 400);
	</script>
					<span id="starB139576">
		<img id="img-starB139576" src="/images/icon_unstarred.png" class="star" alt="star" title="Add this item to your favorites list"/>
		<div id="tooltip17487" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip17487'), 'up', 400);
	</script>
	</span>
	
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow139576" class="float-left invisible" style="margin-top:.2em">
		<img title="Selected post" width="15" height="15" src="/images/arrow.png" alt="Selected post"/>
	</span>
					<span class="post-date float-left">
		<span id="d1371505912000-719"></span><script type="text/javascript">
		Nabble.get('d1371505912000-719').innerHTML= Nabble.formatDateLong(new Date(1371505912000));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		Re: RFR 6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=814" rel="nofollow" title="View profile of Phil Race" class="nowrap no-decoration"><img class="avatar medium-border-color" src="http://www.gravatar.com/avatar/045203b5228012015b9f233fcb1e1933?s=100&amp;r=pg&amp;d=http%3A%2F%2Fn7.nabble.com%2Fimages%2Favatar100.png" height="100" width="100" alt="Phil Race" title="Phil Race"/><img src="/images/online.png" class="online814 online invisible" title="User is online" alt="online"/></a>

	
	
		</div>
	</div>
	
	
	<div class="post-count814 avatar-label weak-color"></div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message139576" class="message-text adbayes-content">
		The superclass does check that the service will (claims to) support 
<br/>printable/pageable.
<br/><br/>I've looked at what we did in the implementation when it comes to print 
<br/>which
<br/>is that for such a custom service we implicitly head it off to the 
<br/>javax.print API
<br/>so it probably could work.
<br/><br/>But the dialog code probably does need to be tweaked to always invoke
<br/>the cross-platform dialog in this case. Right now its bailing from native
<br/>only if it sees a StreamPrintService.
<br/><br/>So line 560 and maybe line 590 should be
<br/>if (!(service instanceof Win32PrintService)) ...
<br/><br/>pageDialog() needs similar treatment.
<br/><br/>Try those and see if you get sensible behaviour when showing the dialog.
<br/><br/>-phil.
<br/><br/>On 6/17/2013 2:00 PM, Patrick Reinhart wrote:
<div class='shrinkable-quote'><br/>&gt; Hi Phil,
<br/>&gt;
<br/>&gt; What irritates me though is the fact, that there is no check for the 
<br/>&gt; support/not support of 2D printing and also that the PrinterException 
<br/>&gt; does not reflect the described cases of the spec:
<br/>&gt;
<br/>&gt; java.awt.print.PrinterException: Invalid name of PrintService.
<br/>&gt;
<br/>&gt; I can not see any relation to one of the referred cases of the spec:
<br/>&gt; The spec. for PrinterJob.setPrintService() says :-
<br/>&gt;&gt;
<br/>&gt;&gt; *Throws:*
<br/>&gt;&gt; &nbsp; &nbsp;|PrinterException
<br/>&gt;&gt; &lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html" target="_top" rel="nofollow" link="external">http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html</a>&gt;| 
<br/>&gt;&gt;
<br/>&gt;&gt; &nbsp; &nbsp;- if the specified service does not support 2D printing,
<br/>&gt;&gt; &nbsp; &nbsp; &nbsp;or this PrinterJob class does not support setting a 2D print 
<br/>&gt;&gt; service,
<br/>&gt;&gt; &nbsp; &nbsp;or the specified service is otherwise not a valid print service.
<br/>&gt;&gt;
<br/>&gt;&gt; So an exception is expected.
<br/>&gt;&gt;
<br/>&gt;&gt; If I understand your fix you want to change it so that WPrinterJob 
<br/>&gt;&gt; simply
<br/>&gt;&gt; doesn't go down to native so is less specific about what Service it will
<br/>&gt;&gt; accept? But WPrinterJob is completely tied to Win32PrintService
<br/>&gt;&gt; and windows native printing. The Windows print dialog for example
<br/>&gt;&gt; will &nbsp;know nothing about your service.
<br/>&gt;&gt;
<br/>&gt;&gt; So this seems like not a bug. You should just use javax.print APIs in 
<br/>&gt;&gt; this case.
<br/>&gt;&gt;
<br/>&gt; Well in my case I had the plan to capture the printer interaction for 
<br/>&gt; testing reasons instead of using real printers. In my case a 3th party 
<br/>&gt; product was using the setPrintService() method internally, where I did 
<br/>&gt; not have the possibility of using the javax.print API in this case. 
<br/>&gt; Also irritating was the fact, that under Linux the same method call 
<br/>&gt; behaved not the same, in fact there it worked without any problem. 
<br/>&gt; Also it seems to be no problem if the print service is of type 
<br/>&gt; StreamPrintService where it does more or less the same as my supposed 
<br/>&gt; fix. So it can not be tied that completely to the WIn32PrintService.
<br/>&gt;
<br/>&gt; Cheers Patrick
<br/>&gt;
<br/>&gt;
<br/>&gt;&gt; -phil.
<br/>&gt;&gt;
<br/>&gt;&gt;
<br/>&gt;&gt;
<br/>&gt;&gt; On 6/15/2013 8:19 AM, Patrick Reinhart wrote:
<br/>&gt;&gt;&gt; Could someone review my fix?
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; <a href="http://reinharts.dyndns.org/6870661/webrev.00" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.00</a><br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Cheers
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Patrick
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; On 06/11/2013 10:32 PM, Patrick Reinhart wrote:
<br/>&gt;&gt;&gt;&gt; Hi Phil,
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; I just started looking into this Bug and have already written a 
<br/>&gt;&gt;&gt;&gt; test to prove a later fix though. As it seems that there missing 
<br/>&gt;&gt;&gt;&gt; two checks make sure, that the actual PrintService is a instance of 
<br/>&gt;&gt;&gt;&gt; W32PrintService &nbsp;before passing it to the native method 
<br/>&gt;&gt;&gt;&gt; setNativePrintService()
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; Fix proposal for this bug is as follows:
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; <a href="http://reinharts.dyndns.org/6870661/webrev.00" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.00</a><br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; Can you take a look into it and give me some feedback on it. 
<br/>&gt;&gt;&gt;&gt; Unfortunally I did not get the Jtreg test running under Windows 
<br/>&gt;&gt;&gt;&gt; (executing it as plain Java application at least does work)
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; Cheers
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; Patrick
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;
<br/>&gt;
</div><br/>

	
	
	
	</div>
	
			
				</td>
			</tr>
		</table>
	</div>
	<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889">Patrick Reinhart</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="/template/NamlServlet.jtp?macro=reply&amp;node=139826" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html#a139826',139826)">Threaded</a>
	<div id="tooltip55353" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip55353'), 'up', 400);
	</script> |
					<span id="dd_postdropdown139826"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown139826", "More","Click for more options");
		
		dropdown.add('replyToAuthor139826', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D139826\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost139826', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D139826\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost139826', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D139826\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost139826', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(139826)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively139826', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(139826)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate139826', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D139826\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print139826', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D139826\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink139826', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658p139826.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail139826', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D139826\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown139826');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=139826' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
					&nbsp;
					<img src="/images/flag_gray.png" class="report-flag" onclick="Nabble.reportContent(139826)"/>
	<div id="tooltip4781" class="nabble-tooltip" use_title="false">
		Report Content as Inappropriate
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip4781'), 'up', 400);
	</script>
					<span id="starB139826">
		<img id="img-starB139826" src="/images/icon_unstarred.png" class="star" alt="star" title="Add this item to your favorites list"/>
		<div id="tooltip58965" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip58965'), 'up', 400);
	</script>
	</span>
	
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow139826" class="float-left invisible" style="margin-top:.2em">
		<img title="Selected post" width="15" height="15" src="/images/arrow.png" alt="Selected post"/>
	</span>
					<span class="post-date float-left">
		<span id="d1371589483000-847"></span><script type="text/javascript">
		Nabble.get('d1371589483000-847').innerHTML= Nabble.formatDateLong(new Date(1371589483000));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		Re: RFR 6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889" rel="nofollow" title="View profile of Patrick Reinhart" class="nowrap no-decoration"><img class="avatar medium-border-color" src="http://www.gravatar.com/avatar/684127484e37dd2ee0d4c70c6457066d?s=100&amp;r=pg&amp;d=http%3A%2F%2Fn7.nabble.com%2Fimages%2Favatar100.png" height="100" width="100" alt="Patrick Reinhart" title="Patrick Reinhart"/><img src="/images/online.png" class="online889 online invisible" title="User is online" alt="online"/></a>

	
	
		</div>
	</div>
	
	
	<div class="post-count889 avatar-label weak-color"></div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message139826" class="message-text adbayes-content">
		Hi Phil,
<br/><br/>I will do the suggested changes and check the dialog and enhance my test 
<br/>accordingly.
<br/><br/>Do you think that the fields driverDoesMultipleCopies and 
<br/>driverDoesCollation should be reset on setPrintService() as follows, 
<br/>because the actual native settings will be obsolete in that case anyway?
<br/><br/><br/>@@ -587,11 +586,11 @@
<br/>&nbsp; &nbsp; &nbsp; public void setPrintService(PrintService service)
<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throws PrinterException {
<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; super.setPrintService(service);
<br/>- &nbsp; &nbsp; &nbsp; &nbsp;if (service instanceof StreamPrintService) {
<br/>+ &nbsp; &nbsp; &nbsp; &nbsp;driverDoesMultipleCopies = false;
<br/>+ &nbsp; &nbsp; &nbsp; &nbsp;driverDoesCollation = false;
<br/>+ &nbsp; &nbsp; &nbsp; &nbsp;if (!(service instanceof Win32PrintService)) {
<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;
<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br/>- &nbsp; &nbsp; &nbsp; &nbsp;driverDoesMultipleCopies = false;
<br/>- &nbsp; &nbsp; &nbsp; &nbsp;driverDoesCollation = false;
<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setNativePrintService(service.getName());
<br/>&nbsp; &nbsp; &nbsp; }
<br/><br/><br/>At last could you give me a hint, how you do a test for dialogs with Jtreg?
<br/><br/>Cheers
<br/><br/>Patrick
<br/><br/>Am 17.06.13 23:51, schrieb Phil Race:
<div class='shrinkable-quote'><br/>&gt; The superclass does check that the service will (claims to) support 
<br/>&gt; printable/pageable.
<br/>&gt;
<br/>&gt; I've looked at what we did in the implementation when it comes to 
<br/>&gt; print which
<br/>&gt; is that for such a custom service we implicitly head it off to the 
<br/>&gt; javax.print API
<br/>&gt; so it probably could work.
<br/>&gt;
<br/>&gt; But the dialog code probably does need to be tweaked to always invoke
<br/>&gt; the cross-platform dialog in this case. Right now its bailing from native
<br/>&gt; only if it sees a StreamPrintService.
<br/>&gt;
<br/>&gt; So line 560 and maybe line 590 should be
<br/>&gt; if (!(service instanceof Win32PrintService)) ...
<br/>&gt;
<br/>&gt; pageDialog() needs similar treatment.
<br/>&gt;
<br/>&gt; Try those and see if you get sensible behaviour when showing the dialog.
<br/>&gt;
<br/>&gt; -phil.
<br/>&gt;
<br/>&gt; On 6/17/2013 2:00 PM, Patrick Reinhart wrote:
<br/>&gt;&gt; Hi Phil,
<br/>&gt;&gt;
<br/>&gt;&gt; What irritates me though is the fact, that there is no check for the 
<br/>&gt;&gt; support/not support of 2D printing and also that the PrinterException 
<br/>&gt;&gt; does not reflect the described cases of the spec:
<br/>&gt;&gt;
<br/>&gt;&gt; java.awt.print.PrinterException: Invalid name of PrintService.
<br/>&gt;&gt;
<br/>&gt;&gt; I can not see any relation to one of the referred cases of the spec:
<br/>&gt;&gt; The spec. for PrinterJob.setPrintService() says :-
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; *Throws:*
<br/>&gt;&gt;&gt; &nbsp; &nbsp;|PrinterException
<br/>&gt;&gt;&gt; &lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html" target="_top" rel="nofollow" link="external">http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html</a>&gt;| 
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; &nbsp; &nbsp;- if the specified service does not support 2D printing,
<br/>&gt;&gt;&gt; &nbsp; &nbsp; &nbsp;or this PrinterJob class does not support setting a 2D print 
<br/>&gt;&gt;&gt; service,
<br/>&gt;&gt;&gt; &nbsp; &nbsp;or the specified service is otherwise not a valid print service.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; So an exception is expected.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; If I understand your fix you want to change it so that WPrinterJob 
<br/>&gt;&gt;&gt; simply
<br/>&gt;&gt;&gt; doesn't go down to native so is less specific about what Service it 
<br/>&gt;&gt;&gt; will
<br/>&gt;&gt;&gt; accept? But WPrinterJob is completely tied to Win32PrintService
<br/>&gt;&gt;&gt; and windows native printing. The Windows print dialog for example
<br/>&gt;&gt;&gt; will &nbsp;know nothing about your service.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; So this seems like not a bug. You should just use javax.print APIs 
<br/>&gt;&gt;&gt; in this case.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt; Well in my case I had the plan to capture the printer interaction for 
<br/>&gt;&gt; testing reasons instead of using real printers. In my case a 3th 
<br/>&gt;&gt; party product was using the setPrintService() method internally, 
<br/>&gt;&gt; where I did not have the possibility of using the javax.print API in 
<br/>&gt;&gt; this case. Also irritating was the fact, that under Linux the same 
<br/>&gt;&gt; method call behaved not the same, in fact there it worked without any 
<br/>&gt;&gt; problem. Also it seems to be no problem if the print service is of 
<br/>&gt;&gt; type StreamPrintService where it does more or less the same as my 
<br/>&gt;&gt; supposed fix. So it can not be tied that completely to the 
<br/>&gt;&gt; WIn32PrintService.
<br/>&gt;&gt;
<br/>&gt;&gt; Cheers Patrick
<br/>&gt;&gt;
</div><br/>

	
	
	
	</div>
	
			
				</td>
			</tr>
		</table>
	</div>
	<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=814">Phil Race</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="/template/NamlServlet.jtp?macro=reply&amp;node=139852" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html#a139852',139852)">Threaded</a>
	<div id="tooltip68606" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip68606'), 'up', 400);
	</script> |
					<span id="dd_postdropdown139852"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown139852", "More","Click for more options");
		
		dropdown.add('replyToAuthor139852', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D139852\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost139852', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D139852\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost139852', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D139852\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost139852', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(139852)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively139852', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(139852)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate139852', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D139852\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print139852', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D139852\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink139852', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658p139852.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail139852', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D139852\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown139852');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=139852' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
					&nbsp;
					<img src="/images/flag_gray.png" class="report-flag" onclick="Nabble.reportContent(139852)"/>
	<div id="tooltip36321" class="nabble-tooltip" use_title="false">
		Report Content as Inappropriate
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip36321'), 'up', 400);
	</script>
					<span id="starB139852">
		<img id="img-starB139852" src="/images/icon_unstarred.png" class="star" alt="star" title="Add this item to your favorites list"/>
		<div id="tooltip5303" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip5303'), 'up', 400);
	</script>
	</span>
	
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow139852" class="float-left invisible" style="margin-top:.2em">
		<img title="Selected post" width="15" height="15" src="/images/arrow.png" alt="Selected post"/>
	</span>
					<span class="post-date float-left">
		<span id="d1371591326000-13"></span><script type="text/javascript">
		Nabble.get('d1371591326000-13').innerHTML= Nabble.formatDateLong(new Date(1371591326000));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		Re: RFR 6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=814" rel="nofollow" title="View profile of Phil Race" class="nowrap no-decoration"><img class="avatar medium-border-color" src="http://www.gravatar.com/avatar/045203b5228012015b9f233fcb1e1933?s=100&amp;r=pg&amp;d=http%3A%2F%2Fn7.nabble.com%2Fimages%2Favatar100.png" height="100" width="100" alt="Phil Race" title="Phil Race"/><img src="/images/online.png" class="online814 online invisible" title="User is online" alt="online"/></a>

	
	
		</div>
	</div>
	
	
	<div class="post-count814 avatar-label weak-color"></div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message139852" class="message-text adbayes-content">
		Yes, the driverDoes* fields should be reset, even though
<br/>I am not sure we need them any more because I think
<br/>that ever since XP drivers always do their own collation.
<br/>But some of this code was written when win9x/win nt was supported.
<br/><br/><br/>@run main/manual=yesno
<br/>Can be used to write a manual test for dialogs.
<br/><br/>The test then generally has to have a window with instructions in it,
<br/>and the tester has to tell the harness if it passed based on understanding
<br/>and following the instructions.
<br/><br/>-phil.
<br/><br/><br/>On 6/18/2013 2:04 PM, Patrick Reinhart wrote:
<div class='shrinkable-quote'><br/>&gt; Hi Phil,
<br/>&gt;
<br/>&gt; I will do the suggested changes and check the dialog and enhance my 
<br/>&gt; test accordingly.
<br/>&gt;
<br/>&gt; Do you think that the fields driverDoesMultipleCopies and 
<br/>&gt; driverDoesCollation should be reset on setPrintService() as follows, 
<br/>&gt; because the actual native settings will be obsolete in that case anyway?
<br/>&gt;
<br/>&gt;
<br/>&gt; @@ -587,11 +586,11 @@
<br/>&gt; &nbsp; &nbsp; &nbsp;public void setPrintService(PrintService service)
<br/>&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throws PrinterException {
<br/>&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;super.setPrintService(service);
<br/>&gt; - &nbsp; &nbsp; &nbsp; &nbsp;if (service instanceof StreamPrintService) {
<br/>&gt; + &nbsp; &nbsp; &nbsp; &nbsp;driverDoesMultipleCopies = false;
<br/>&gt; + &nbsp; &nbsp; &nbsp; &nbsp;driverDoesCollation = false;
<br/>&gt; + &nbsp; &nbsp; &nbsp; &nbsp;if (!(service instanceof Win32PrintService)) {
<br/>&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;
<br/>&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
<br/>&gt; - &nbsp; &nbsp; &nbsp; &nbsp;driverDoesMultipleCopies = false;
<br/>&gt; - &nbsp; &nbsp; &nbsp; &nbsp;driverDoesCollation = false;
<br/>&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setNativePrintService(service.getName());
<br/>&gt; &nbsp; &nbsp; &nbsp;}
<br/>&gt;
<br/>&gt;
<br/>&gt; At last could you give me a hint, how you do a test for dialogs with 
<br/>&gt; Jtreg?
<br/>&gt;
<br/>&gt; Cheers
<br/>&gt;
<br/>&gt; Patrick
<br/>&gt;
<br/>&gt; Am 17.06.13 23:51, schrieb Phil Race:
<br/>&gt;&gt; The superclass does check that the service will (claims to) support 
<br/>&gt;&gt; printable/pageable.
<br/>&gt;&gt;
<br/>&gt;&gt; I've looked at what we did in the implementation when it comes to 
<br/>&gt;&gt; print which
<br/>&gt;&gt; is that for such a custom service we implicitly head it off to the 
<br/>&gt;&gt; javax.print API
<br/>&gt;&gt; so it probably could work.
<br/>&gt;&gt;
<br/>&gt;&gt; But the dialog code probably does need to be tweaked to always invoke
<br/>&gt;&gt; the cross-platform dialog in this case. Right now its bailing from 
<br/>&gt;&gt; native
<br/>&gt;&gt; only if it sees a StreamPrintService.
<br/>&gt;&gt;
<br/>&gt;&gt; So line 560 and maybe line 590 should be
<br/>&gt;&gt; if (!(service instanceof Win32PrintService)) ...
<br/>&gt;&gt;
<br/>&gt;&gt; pageDialog() needs similar treatment.
<br/>&gt;&gt;
<br/>&gt;&gt; Try those and see if you get sensible behaviour when showing the dialog.
<br/>&gt;&gt;
<br/>&gt;&gt; -phil.
<br/>&gt;&gt;
<br/>&gt;&gt; On 6/17/2013 2:00 PM, Patrick Reinhart wrote:
<br/>&gt;&gt;&gt; Hi Phil,
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; What irritates me though is the fact, that there is no check for the 
<br/>&gt;&gt;&gt; support/not support of 2D printing and also that the 
<br/>&gt;&gt;&gt; PrinterException does not reflect the described cases of the spec:
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; java.awt.print.PrinterException: Invalid name of PrintService.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; I can not see any relation to one of the referred cases of the spec:
<br/>&gt;&gt;&gt; The spec. for PrinterJob.setPrintService() says :-
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; *Throws:*
<br/>&gt;&gt;&gt;&gt; &nbsp; &nbsp;|PrinterException
<br/>&gt;&gt;&gt;&gt; &lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html" target="_top" rel="nofollow" link="external">http://docs.oracle.com/javase/6/docs/api/java/awt/print/PrinterException.html</a>&gt;| 
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; &nbsp; &nbsp;- if the specified service does not support 2D printing,
<br/>&gt;&gt;&gt;&gt; &nbsp; &nbsp; &nbsp;or this PrinterJob class does not support setting a 2D print 
<br/>&gt;&gt;&gt;&gt; service,
<br/>&gt;&gt;&gt;&gt; &nbsp; &nbsp;or the specified service is otherwise not a valid print service.
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; So an exception is expected.
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; If I understand your fix you want to change it so that WPrinterJob 
<br/>&gt;&gt;&gt;&gt; simply
<br/>&gt;&gt;&gt;&gt; doesn't go down to native so is less specific about what Service it 
<br/>&gt;&gt;&gt;&gt; will
<br/>&gt;&gt;&gt;&gt; accept? But WPrinterJob is completely tied to Win32PrintService
<br/>&gt;&gt;&gt;&gt; and windows native printing. The Windows print dialog for example
<br/>&gt;&gt;&gt;&gt; will &nbsp;know nothing about your service.
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; So this seems like not a bug. You should just use javax.print APIs 
<br/>&gt;&gt;&gt;&gt; in this case.
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Well in my case I had the plan to capture the printer interaction 
<br/>&gt;&gt;&gt; for testing reasons instead of using real printers. In my case a 3th 
<br/>&gt;&gt;&gt; party product was using the setPrintService() method internally, 
<br/>&gt;&gt;&gt; where I did not have the possibility of using the javax.print API in 
<br/>&gt;&gt;&gt; this case. Also irritating was the fact, that under Linux the same 
<br/>&gt;&gt;&gt; method call behaved not the same, in fact there it worked without 
<br/>&gt;&gt;&gt; any problem. Also it seems to be no problem if the print service is 
<br/>&gt;&gt;&gt; of type StreamPrintService where it does more or less the same as my 
<br/>&gt;&gt;&gt; supposed fix. So it can not be tied that completely to the 
<br/>&gt;&gt;&gt; WIn32PrintService.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Cheers Patrick
<br/>&gt;&gt;&gt;
<br/>&gt;
</div><br/>

	
	
	
	</div>
	
			
				</td>
			</tr>
		</table>
	</div>
	<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889">Patrick Reinhart</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="/template/NamlServlet.jtp?macro=reply&amp;node=140125" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html#a140125',140125)">Threaded</a>
	<div id="tooltip19698" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip19698'), 'up', 400);
	</script> |
					<span id="dd_postdropdown140125"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown140125", "More","Click for more options");
		
		dropdown.add('replyToAuthor140125', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D140125\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost140125', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D140125\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost140125', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D140125\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost140125', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(140125)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively140125', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(140125)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate140125', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D140125\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print140125', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D140125\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink140125', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658p140125.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail140125', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D140125\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown140125');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=140125' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
					&nbsp;
					<img src="/images/flag_gray.png" class="report-flag" onclick="Nabble.reportContent(140125)"/>
	<div id="tooltip18231" class="nabble-tooltip" use_title="false">
		Report Content as Inappropriate
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip18231'), 'up', 400);
	</script>
					<span id="starB140125">
		<img id="img-starB140125" src="/images/icon_unstarred.png" class="star" alt="star" title="Add this item to your favorites list"/>
		<div id="tooltip57087" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip57087'), 'up', 400);
	</script>
	</span>
	
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow140125" class="float-left invisible" style="margin-top:.2em">
		<img title="Selected post" width="15" height="15" src="/images/arrow.png" alt="Selected post"/>
	</span>
					<span class="post-date float-left">
		<span id="d1371674400000-288"></span><script type="text/javascript">
		Nabble.get('d1371674400000-288').innerHTML= Nabble.formatDateLong(new Date(1371674400000));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		Re: RFR 6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889" rel="nofollow" title="View profile of Patrick Reinhart" class="nowrap no-decoration"><img class="avatar medium-border-color" src="http://www.gravatar.com/avatar/684127484e37dd2ee0d4c70c6457066d?s=100&amp;r=pg&amp;d=http%3A%2F%2Fn7.nabble.com%2Fimages%2Favatar100.png" height="100" width="100" alt="Patrick Reinhart" title="Patrick Reinhart"/><img src="/images/online.png" class="online889 online invisible" title="User is online" alt="online"/></a>

	
	
		</div>
	</div>
	
	
	<div class="post-count889 avatar-label weak-color"></div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message140125" class="message-text adbayes-content">
		Hi Phil,
<br/><br/>I implemented your suggested changes in the class WPrinterJob now. I 
<br/>also created a simple test for showing a print dialog after register the 
<br/>custom PrintService on the PrintServiceLookup class and setting it to 
<br/>the PrinterJob using setPrintService().
<br/><br/><a href="http://reinharts.dyndns.org/6870661/webrev.01/" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.01/</a><br/><br/>According to the manual test. I did found different implementations 
<br/>where sometimes the instructions where just printed to the console and 
<br/>others where a applet was used. Could you point me out a existing test 
<br/>where it is done the way you want it to be?
<br/><br/>Cheers
<br/><br/>Patrick
<br/><br/><br/><br/>On 06/18/2013 11:35 PM, Phil Race wrote:
<div class='shrinkable-quote'><br/>&gt; Yes, the driverDoes* fields should be reset, even though
<br/>&gt; I am not sure we need them any more because I think
<br/>&gt; that ever since XP drivers always do their own collation.
<br/>&gt; But some of this code was written when win9x/win nt was supported.
<br/>&gt;
<br/>&gt;
<br/>&gt; @run main/manual=yesno
<br/>&gt; Can be used to write a manual test for dialogs.
<br/>&gt;
<br/>&gt; The test then generally has to have a window with instructions in it,
<br/>&gt; and the tester has to tell the harness if it passed based on 
<br/>&gt; understanding
<br/>&gt; and following the instructions.
<br/>&gt;
<br/>&gt; -phil.
<br/>&gt;
<br/>&gt;
<br/>&gt; On 6/18/2013 2:04 PM, Patrick Reinhart wrote:
<br/>&gt;&gt; Hi Phil,
<br/>&gt;&gt;
<br/>&gt;&gt; I will do the suggested changes and check the dialog and enhance my 
<br/>&gt;&gt; test accordingly.
<br/>&gt;&gt;
<br/>&gt;&gt; Do you think that the fields driverDoesMultipleCopies and 
<br/>&gt;&gt; driverDoesCollation should be reset on setPrintService() as follows, 
<br/>&gt;&gt; because the actual native settings will be obsolete in that case anyway?
<br/>&gt;&gt;
<br/>&gt;&gt;
<br/>&gt;&gt; @@ -587,11 +586,11 @@
<br/>&gt;&gt; &nbsp; &nbsp; &nbsp;public void setPrintService(PrintService service)
<br/>&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throws PrinterException {
<br/>&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;super.setPrintService(service);
<br/>&gt;&gt; - &nbsp; &nbsp; &nbsp; &nbsp;if (service instanceof StreamPrintService) {
<br/>&gt;&gt; + &nbsp; &nbsp; &nbsp; &nbsp;driverDoesMultipleCopies = false;
<br/>&gt;&gt; + &nbsp; &nbsp; &nbsp; &nbsp;driverDoesCollation = false;
<br/>&gt;&gt; + &nbsp; &nbsp; &nbsp; &nbsp;if (!(service instanceof Win32PrintService)) {
<br/>&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;
<br/>&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
<br/>&gt;&gt; - &nbsp; &nbsp; &nbsp; &nbsp;driverDoesMultipleCopies = false;
<br/>&gt;&gt; - &nbsp; &nbsp; &nbsp; &nbsp;driverDoesCollation = false;
<br/>&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setNativePrintService(service.getName());
<br/>&gt;&gt; &nbsp; &nbsp; &nbsp;}
<br/>&gt;&gt;
<br/>&gt;&gt;
<br/>&gt;&gt; At last could you give me a hint, how you do a test for dialogs with 
<br/>&gt;&gt; Jtreg?
<br/>&gt;&gt;
<br/>&gt;&gt; Cheers
<br/>&gt;&gt;
<br/>&gt;&gt; Patrick
<br/>&gt;&gt;
<br/>&gt;&gt; Am 17.06.13 23:51, schrieb Phil Race:
<br/>&gt;&gt;&gt; The superclass does check that the service will (claims to) support 
<br/>&gt;&gt;&gt; printable/pageable.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; I've looked at what we did in the implementation when it comes to 
<br/>&gt;&gt;&gt; print which
<br/>&gt;&gt;&gt; is that for such a custom service we implicitly head it off to the 
<br/>&gt;&gt;&gt; javax.print API
<br/>&gt;&gt;&gt; so it probably could work.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; But the dialog code probably does need to be tweaked to always invoke
<br/>&gt;&gt;&gt; the cross-platform dialog in this case. Right now its bailing from 
<br/>&gt;&gt;&gt; native
<br/>&gt;&gt;&gt; only if it sees a StreamPrintService.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; So line 560 and maybe line 590 should be
<br/>&gt;&gt;&gt; if (!(service instanceof Win32PrintService)) ...
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; pageDialog() needs similar treatment.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Try those and see if you get sensible behaviour when showing the 
<br/>&gt;&gt;&gt; dialog.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; -phil.
</div><br/>

	
	
	
	</div>
	
			
				</td>
			</tr>
		</table>
	</div>
	<div class="classic-row">
		<div class="classic-header">
			<div class="classic-bar shaded-bg-color rounded-top">
				<div class="classic-author-name nowrap">
					<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889">Patrick Reinhart</a>
				</div>
				<div class="classic-right-menu shaded-bg-color weak-color">
					<a href="/template/NamlServlet.jtp?macro=reply&amp;node=140970" rel="nofollow">Reply</a> |
					<a href="javascript:void(0)" onclick="Nabble.setView('threaded', '/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tt138658.html#a140970',140970)">Threaded</a>
	<div id="tooltip86827" class="nabble-tooltip" use_title="false">
		Open this post in threaded view
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip86827'), 'up', 400);
	</script> |
					<span id="dd_postdropdown140970"></span>
	<script type="text/javascript">
		var dropdown = new NabbleDropdown("postdropdown140970", "More","Click for more options");
		
		dropdown.add('replyToAuthor140970', '\x3Ca href\x3D\"/user/SendEmail.jtp?type\x3Dpm&amp;post\x3D140970\" rel\x3D\"nofollow\"\x3EReply to author\x3C/a\x3E', 'display:none');
		dropdown.add('editPost140970', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dedit_post&amp;node\x3D140970\" rel\x3D\"nofollow\"\x3EEdit post\x3C/a\x3E', 'display:none');
		dropdown.add('movePost140970', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dmove_node&amp;node\x3D140970\" rel\x3D\"nofollow\"\x3EMove post\x3C/a\x3E', 'display:none');
		dropdown.add('deletePost140970', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deletePost(140970)\" rel\x3D\"nofollow\"\x3EDelete this post\x3C/a\x3E', 'display:none');
			dropdown.add('deleteRecursively140970', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"Nabble.deleteFromSite(140970)\" rel\x3D\"nofollow\"\x3EDelete this post and replies\x3C/a\x3E', 'display:none');
		dropdown.add('changePostDate140970', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dchange_post_date&amp;node\x3D140970\" rel\x3D\"nofollow\"\x3EChange post date\x3C/a\x3E', 'display:none');
		dropdown.add('print140970', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Dprint_post&amp;node\x3D140970\" rel\x3D\"nofollow\"\x3EPrint post\x3C/a\x3E');
		dropdown.add('permalink140970', '\x3Ca href\x3D\"javascript: void(0)\" onclick\x3D\"prompt(\'Copy this:\',\'http://openjdk.5641.n7.nabble.com/JDK-6870661-Setting-a-custom-PrintService-on-a-PrinterJob-leads-to-a-PrinterException-tp138658p140970.html\')\"\x3EPermalink\x3C/a\x3E');
		dropdown.add('rawMail140970', '\x3Ca href\x3D\"/template/NamlServlet.jtp?macro\x3Draw_mail&amp;node\x3D140970\" rel\x3D\"nofollow\"\x3ERaw mail\x3C/a\x3E', 'display:none');
		dropdown.build('dd_postdropdown140970');
		dropdown.loadOnClick('/template/NamlServlet.jtp?macro=post_dropdown_later&node=140970' + Nabble.getClientID() + '&_=' + Math.floor(Math.random()*999999));
	</script>
					&nbsp;
					<img src="/images/flag_gray.png" class="report-flag" onclick="Nabble.reportContent(140970)"/>
	<div id="tooltip20935" class="nabble-tooltip" use_title="false">
		Report Content as Inappropriate
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip20935'), 'up', 400);
	</script>
					<span id="starB140970">
		<img id="img-starB140970" src="/images/icon_unstarred.png" class="star" alt="star" title="Add this item to your favorites list"/>
		<div id="tooltip33538" class="nabble-tooltip" use_title="true">
		
		<div class="nabble-tooltip-arrow">
			<div class="d1">&diams;</div>
			<div class="d2">&diams;</div>
		</div>
	</div>
	<script type="text/javascript">
		Nabble.startTooltip(Nabble.get('tooltip33538'), 'up', 400);
	</script>
	</span>
	
				</div>
				<div class="classic-subject-line">
					<span id="red-arrow140970" class="float-left invisible" style="margin-top:.2em">
		<img title="Selected post" width="15" height="15" src="/images/arrow.png" alt="Selected post"/>
	</span>
					<span class="post-date float-left">
		<span id="d1372194716000-400"></span><script type="text/javascript">
		Nabble.get('d1372194716000-400').innerHTML= Nabble.formatDateLong(new Date(1372194716000));
	</script>
	</span>
					<h2 class="post-subject float-left adbayes-content" style="width:30%;overflow:visible;font-family:inherit">
		Re: RFR 6870661 : Setting a custom PrintService on a PrinterJob leads to a PrinterException
	</h2>
				</div>
			</div>
		</div>
		<table class="classic-body">
			<tr>
				<td class="classic-author shaded-bg-color rounded-bottom">
					<div class="avatar-outer">
		<div class="avatar-inner">
			<a href="http://openjdk.5641.n7.nabble.com/template/NamlServlet.jtp?macro=user_nodes&amp;user=889" rel="nofollow" title="View profile of Patrick Reinhart" class="nowrap no-decoration"><img class="avatar medium-border-color" src="http://www.gravatar.com/avatar/684127484e37dd2ee0d4c70c6457066d?s=100&amp;r=pg&amp;d=http%3A%2F%2Fn7.nabble.com%2Fimages%2Favatar100.png" height="100" width="100" alt="Patrick Reinhart" title="Patrick Reinhart"/><img src="/images/online.png" class="online889 online invisible" title="User is online" alt="online"/></a>

	
	
		</div>
	</div>
	
	
	<div class="post-count889 avatar-label weak-color"></div>
	
				</td>
				<td class="classic-message">
					
	
	
	<div id="message140970" class="message-text adbayes-content">
		Hi Phil,
<br/><br/>Did not hear from you lately, had you got the time to look into my 
<br/>supposed fix?
<br/><br/>Cheers
<br/><br/>Patrick
<br/><br/>Am 19.06.13 22:40, schrieb Patrick Reinhart:
<div class='shrinkable-quote'><br/>&gt; Hi Phil,
<br/>&gt;
<br/>&gt; I implemented your suggested changes in the class WPrinterJob now. I 
<br/>&gt; also created a simple test for showing a print dialog after register 
<br/>&gt; the custom PrintService on the PrintServiceLookup class and setting it 
<br/>&gt; to the PrinterJob using setPrintService().
<br/>&gt;
<br/>&gt; <a href="http://reinharts.dyndns.org/6870661/webrev.01/" target="_top" rel="nofollow" link="external">http://reinharts.dyndns.org/6870661/webrev.01/</a><br/>&gt;
<br/>&gt; According to the manual test. I did found different implementations 
<br/>&gt; where sometimes the instructions where just printed to the console and 
<br/>&gt; others where a applet was used. Could you point me out a existing test 
<br/>&gt; where it is done the way you want it to be?
<br/>&gt;
<br/>&gt; Cheers
<br/>&gt;
<br/>&gt; Patrick
<br/>&gt;
<br/>&gt;
<br/>&gt;
<br/>&gt; On 06/18/2013 11:35 PM, Phil Race wrote:
<br/>&gt;&gt; Yes, the driverDoes* fields should be reset, even though
<br/>&gt;&gt; I am not sure we need them any more because I think
<br/>&gt;&gt; that ever since XP drivers always do their own collation.
<br/>&gt;&gt; But some of this code was written when win9x/win nt was supported.
<br/>&gt;&gt;
<br/>&gt;&gt;
<br/>&gt;&gt; @run main/manual=yesno
<br/>&gt;&gt; Can be used to write a manual test for dialogs.
<br/>&gt;&gt;
<br/>&gt;&gt; The test then generally has to have a window with instructions in it,
<br/>&gt;&gt; and the tester has to tell the harness if it passed based on 
<br/>&gt;&gt; understanding
<br/>&gt;&gt; and following the instructions.
<br/>&gt;&gt;
<br/>&gt;&gt; -phil.
<br/>&gt;&gt;
<br/>&gt;&gt;
<br/>&gt;&gt; On 6/18/2013 2:04 PM, Patrick Reinhart wrote:
<br/>&gt;&gt;&gt; Hi Phil,
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; I will do the suggested changes and check the dialog and enhance my 
<br/>&gt;&gt;&gt; test accordingly.
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Do you think that the fields driverDoesMultipleCopies and 
<br/>&gt;&gt;&gt; driverDoesCollation should be reset on setPrintService() as follows, 
<br/>&gt;&gt;&gt; because the actual native settings will be obsolete in that case 
<br/>&gt;&gt;&gt; anyway?
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; @@ -587,11 +586,11 @@
<br/>&gt;&gt;&gt; &nbsp; &nbsp; &nbsp;public void setPrintService(PrintService service)
<br/>&gt;&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throws PrinterException {
<br/>&gt;&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;super.setPrintService(service);
<br/>&gt;&gt;&gt; - &nbsp; &nbsp; &nbsp; &nbsp;if (service instanceof StreamPrintService) {
<br/>&gt;&gt;&gt; + &nbsp; &nbsp; &nbsp; &nbsp;driverDoesMultipleCopies = false;
<br/>&gt;&gt;&gt; + &nbsp; &nbsp; &nbsp; &nbsp;driverDoesCollation = false;
<br/>&gt;&gt;&gt; + &nbsp; &nbsp; &nbsp; &nbsp;if (!(service instanceof Win32PrintService)) {
<br/>&gt;&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;
<br/>&gt;&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
<br/>&gt;&gt;&gt; - &nbsp; &nbsp; &nbsp; &nbsp;driverDoesMultipleCopies = false;
<br/>&gt;&gt;&gt; - &nbsp; &nbsp; &nbsp; &nbsp;driverDoesCollation = false;
<br/>&gt;&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setNativePrintService(service.getName());
<br/>&gt;&gt;&gt; &nbsp; &nbsp; &nbsp;}
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; At last could you give me a hint, how you do a test for dialogs with 
<br/>&gt;&gt;&gt; Jtreg?
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Cheers
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Patrick
<br/>&gt;&gt;&gt;
<br/>&gt;&gt;&gt; Am 17.06.13 23:51, schrieb Phil Race:
<br/>&gt;&gt;&gt;&gt; The superclass does check that the service will (claims to) support 
<br/>&gt;&gt;&gt;&gt; printable/pageable.
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; I've looked at what we did in the implementation when it comes to 
<br/>&gt;&gt;&gt;&gt; print which
<br/>&gt;&gt;&gt;&gt; is that for such a custom service we implicitly head it off to the 
<br/>&gt;&gt;&gt;&gt; javax.print API
<br/>&gt;&gt;&gt;&gt; so it probably could work.
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; But the dialog code probably does need to be tweaked to always invoke
<br/>&gt;&gt;&gt;&gt; the cross-platform dialog in this case. Right now its bailing from 
<br/>&gt;&gt;&gt;&gt; native
<br/>&gt;&gt;&gt;&gt; only if it sees a StreamPrintService.
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; So line 560 and maybe line 590 should be
<br/>&gt;&gt;&gt;&gt; if (!(service instanceof Win32PrintService)) ...
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; pageDialog() needs similar treatment.
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; Try those and see if you get sensible behaviour when showing the 
<br/>&gt;&gt;&gt;&gt; dialog.
<br/>&gt;&gt;&gt;&gt;
<br/>&gt;&gt;&gt;&gt; -phil.
<br/>&gt;
</div><br/>

	
	
	
	</div>
	
			<script type="text/javascript">
				Nabble.ads('last_classic_message');
			</script>
				</td>
			</tr>
		</table>
	</div>
	
		
	</div>
	</div>
			<div id="topic-footer" class="weak-color" style="padding-top:1em">
		&laquo;
		<a href="http://openjdk.5641.n7.nabble.com/OpenJDK-Java-2D-API-f95531.html">Return to OpenJDK Java 2D API</a>
		&nbsp;|&nbsp;
		<span id="v138658" style="display:none">1 view|%1 views</span>
	
	
	</div>
			<div id="report-inappropriate-content" class="report-inappropriate-content rounded">
		<div id="report-inappropriate-content-inner" class="no-bg-color medium-border-color border2">
			<div class="big">Loading...</div>
		</div>
	</div>
				<script type="text/javascript">
				Nabble.ads('topic_bottom');
			</script>
	<script type="text/javascript">
	var infolinks_pid = 1480243;
	var infolinks_wsid = 0;
	</script>
	<script type="text/javascript" src="http://resources.infolinks.com/js/infolinks_main.js"></script>
			<table class="footer-table shaded-bg-color">
		<tr>
			<td class="footer-left weak-color">
				Powered by
				<a href="http://www.nabble.com/" target="_top">Nabble</a>
			</td>
			<td class="footer-right">
				<a href="/template/NamlServlet.jtp?macro=macro_viewer&amp;id=classic_forum_topic%21nabble%3Atopic.naml&amp;base=nabble.view.web.template.ServletNamespace" rel="nofollow">Edit this page</a>
			</td>
		</tr>
	</table>
	<!-- Ad.true -->
			<script type='text/javascript'>
var scriptUrl = '/template/NamlServlet.jtp?macro=js_page&searchSpecial=138658&incViewCount=138658&newsflash=&starB=138658|139313|139556|139567|139576|139826|139852|140125|140970&visitorOnline=&avatarOnline=889|814&postCount=889|814&markVisited=140970&views=138658';
scriptUrl += '&_=' + Math.floor(Math.random()*9999) + Nabble.getClientID();
$.getScript(scriptUrl, function() { Nabble.resizeFrames(); });
</script>

					</div>
					<script type="text/javascript">
		$(document).ready(function() { Nabble.fixCookieClientID(); });
		(function(){ var sNew = document.createElement("script"); sNew.defer = true; sNew.src = "http://tag.crsspxl.com/s1.js?d=1294"; var s0 = document.getElementsByTagName('script')[0]; s0.parentNode.insertBefore(sNew, s0); })();
	</script>
					<!-- n7.nabble.com | Site ID = 5641 -->
				</body>
			</html>
