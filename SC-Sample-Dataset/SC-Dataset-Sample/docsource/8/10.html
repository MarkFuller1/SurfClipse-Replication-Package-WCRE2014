<!DOCTYPE html>

<html lang="en-us">
    <head><script type="text/javascript">var NREUMQ=NREUMQ||[];NREUMQ.push(["mark","firstbyte",new Date().getTime()]);</script>
        <title>Trying to implement Marketplace Licensing, getting ClassNotFoundException - Atlassian Answers</title>
        <meta name="description" content="Hi all,
I am trying to enable a JIRA plugin for Atlassian-paid Marketplace licensing, but I am running into problems after applying the atlas-create-jira-plugin-module code to our plugin.
The main issue is that we are getting the following exception when trying to load our plugin into the host produ">
        <meta name="answers_tags" content="jira,jira-development,marketplace,licensing">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
        
        <link rel="canonical" href="https://answers.atlassian.com/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception" />
        <link rel="alternate" type="application/rss+xml" title="RSS - Answers Only" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception?type=rss">
        <link rel="alternate" type="application/rss+xml" title="RSS - Answers and Comments" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception?type=rss&comments=yes">

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="BZsv7UpJVZ6vjyH6gB7xa0XldXOL6DjbGFPvxQihDF8" />
        
        <link rel="shortcut icon" href="/m/atlassian/media/images/favicon.ico" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        
        
            <link type="text/css" rel="stylesheet" href="/m/atlassian/media/min/base.min.css?ec03b810" />
        

        <!--[if IE]>
        <style type="text/css">
        #landingClouds {
          filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/m/atlassian/media/images/clouds-home.png', sizingMethod='scale');
          background:none !important;
        }
        </style>
        <![endif]-->

        <script>
            var i18nLang = 'en';
            var scriptUrl = '/'
            var osqaSkin = 'atlassian';
            var authed = false;

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters",
                escalate: "Would you like to get Atlassian's attention on this question?"
            }
            var classes = {
                escalate: 'confirm-longtext'
            }
        </script>
        
            <script type="text/javascript" src="/m/atlassian/media/min/base.min.js?a64bcfe7"></script>
        
        
        
        
        
            <script type="text/javascript" src="/m/atlassian/media/min/qopen.min.js?e3ed3dac"></script>
        
        
        <script type='text/javascript' src='/m/atlassian/media/syntaxhighlighter/answers_loader.js' class='answers-syntax'></script>

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($.trim(strip_tags($("textarea#editor")[0].value)) != "") {
                //return yourWorkWillBeLost(e);
                return null;
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if($.trim(strip_tags(commentBoxes[index].value)) != "") {
                //return yourWorkWillBeLost(e);
                return null;
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Atlassian Answers Search" />
        
        <script type="text/javascript" src="https://use.typekit.com/bye5ahx.js"></script>
        <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

        
        <script type="text/javascript">
            var Answers = Answers || {};
            
                Answers.is_authenticated = false;
            
        </script>

<!-- Google Analytics -->
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-6032469-23']);
_gaq.push(['_setDomainName', '.atlassian.com']);
_gaq.push(['_trackPageview']);
_gaq.push(['_setAccount', 'UA-6032469-1']);
_gaq.push(['_setDomainName', '.atlassian.com']);
_gaq.push(['_trackPageview']);
_gaq.push(['_setAccount', 'UA-6032469-39']);
_gaq.push(['_setDomainName', '.atlassian.com']);
_gaq.push(['_trackPageview']);
(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();
</script>
<!-- end analytics -->
    </head>
    <body class="questiondetails hasbestanswer">
        
            <div id="custom_header">
                <script type="text/javascript">

$(document).ready(function() {

    var COOKIE_NAME = "DISMISS_BRAND_BANNER";

    var hide_banner = AJS.Cookie.read(COOKIE_NAME);
    if (hide_banner && hide_banner === "true") {
        // Don't show it.
        return;
    }
    
    // Are there any JIRA-Agile tags on the page?
    var hazAgile = $(".tag-link-jira-agile").length > 0 || $("div.tags > a:contains('jira-agile')").length > 0;
    //             ^ detects tags on main question list || ^ detects tags on an individual question page
    
    // Are there any JIRA-Capture tags on the page?
    var hazCapture = $(".tag-link-jira-capture").length > 0 || $("div.tags > a:contains('jira-capture')").length > 0;
    //               ^ detects tags on main question list   || ^ detects tags on an individual question page
    
    var bannerHeading;
    var bannerText;
    if (hazAgile && hazCapture)
    {
        bannerHeading = "Say hello to JIRA Agile and JIRA Capture";
        bannerText = "<strong>GreenHopper</strong> is now called <strong>JIRA Agile</strong>, and <strong>Bonfire</strong> is now called <strong>JIRA Capture</strong>.";
    }
    else if (hazAgile) {
        bannerHeading = "Say hello to JIRA Agile";
         bannerText = "<strong>GreenHopper</strong> is now called <strong>JIRA Agile</strong>.";
     }
    else if (hazCapture) {
        bannerHeading = "Say hello to JIRA Capture";
        bannerText = "<strong>Bonfire</strong> is now called <strong>JIRA Capture</strong>.";
    }
     else
     {
         // No banner to display here.
         return;
     }
    
    var bannerContent = '<span id="brand-amp-banner-close" ' + 
                              'style="border-radius: 50px; ' + 
                                      'cursor: pointer; ' + 
                                      'float: right; ' + 
                                      'line-height: 13px; ' + 
                                      'text-align: center; ' + 
                                      'background: #ccc; ' + 
                                      'width: 15px; ' + 
                                      'height: 15px; ' + 
                                      'font-size: 13px; ' + 
                                      'font-family: Helvetica, Arial, sans-serif; ' + 
                                      'font-weight: bold;">' + 
                            'x' + 
                        '</span>' + 
                        '<p style="text-align: center; ' + 
                                  'font-family: \'kulturista-web\',\'Kulturista\',Helvetica,Arial,sans-serif; ' + 
                                  'font-size: 21px; ' + 
                                  'font-weight: bold; ' + 
                                  'color: #036">' + 
                            bannerHeading + 
                        '</p>' + 
                        '<br>' + 
                        '<p style="text-align: center;">' +
                            bannerText + ' ' + 
                            '<a id="brand-amp-banner-learnmore" href="http://blogs.atlassian.com/2013/08/renaming-greenhopper-and-bonfire/?utm_source=answers">Learn more</a>' + 
                            '<span style="font-size: 21px; ' + 
                                         'position: relative; ' + 
                                         'top: 2px; ' + 
                                         'left: 3px;">' +
                                '»' + 
                            '</span>' + 
                        '</p>';
                        
    var banner = $('<div class="alert announcement warning" style="display: none"><div class="announcement-before"></div>' + bannerContent + '<div class="announcement-after"></div></div>');
    $("#page > .grid").append(banner);
    banner.slideDown();
    
    var closeWidget = $("#brand-amp-banner-close");
    var mouseoverFunc = function() {
        $(this).css("background", "#c09853");
    };
    closeWidget.mouseover(mouseoverFunc);
    
    var mouseoutFunc = function() {
        $(this).css("background", "#ccc");
    };
    closeWidget.mouseout(mouseoutFunc);
    
    closeWidget.click(function() {
        if (_gaq) {
            _gaq.push(['_trackEvent', 'Brand Amp', 'Dismiss', 'GreenHopper Present: ' + hazAgile + ' Bonfire Present: ' + hazCapture]);
        }
        AJS.Cookie.save(COOKIE_NAME, "true");
        banner.remove();
        
        closeWidget.unbind("mouseover", mouseoverFunc);
        closeWidget.unbind("mouseout", mouseoutFunc);
    });

    var learnMore = $("brand-amp-banner-learnmore");
    learnMore.click(function() {
        if (_gaq) {
        	_gaq.push(['_trackEvent', 'Brand Amp', 'LearnMore', 'GreenHopper Present: ' + hazAgile + ' Bonfire Present: ' + hazCapture]);
        }
    });
});

</script>
            </div>
        
        

<div id="page">
<header id="header" role="banner">
            <div id="mobile-header">
                <a id="mobile-menu-button" class="mobile-button" href="#"><img src="/m/atlassian/media/images/mobmenu.png"></a>
                <a class="mobile-button" id="mobile-options-button"><i class="icon-white icon-th"></i></a>
            </div>
  <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
  <div class="aui-header-inner">
      <div class="aui-header-primary">
          <h1 id="logo" class="aui-header-logo aui-header-logo-aui"><a href="/"><span class="aui-header-logo-device">Atlassian Answers</span></a></h1>
          <ul class="aui-nav">
              <li><a href="#browse" aria-owns="browse" aria-haspopup="true" class="aui-dropdown2-trigger" aria-controls="dropdown2-header7">Browse<span class="aui-icon-dropdown"></span></a>
                <div class="aui-dropdown2 aui-style-default aui-dropdown2-in-header" id="browse" style="display: none; top: 40px; min-width: 160px; left: 1213px; " aria-hidden="true">
                    <div class="aui-dropdown2-section">
                        <ul id="leftmenu">
                          <li><a href="/questions/">Questions</a></li>
                          <li><a href="/leaderboard/">Leaderboard</a></li>
                          
                          <li><a href="/browse_tags/">Tags</a></li>
                          
                          <li><a href="/badges/">Badges</a></li>
                          
                          <li><a href="/users/">Users</a></li>
                        </ul>
                    </div>
                </div>
              </li>
              <li id="askaquestion"><a class="aui-button aui-button-primary aui-style" href="/account/signin/">Ask a Question</a></li>
          </ul>
      </div>

      <div class="aui-header-secondary">
          <ul class="aui-nav">
              <li>
            	<div class="search" id="headersearch">
                	<form action="/search/">
                		<input type="hidden" value="question" name="t">
                		<input class="query" value="" name="q" placeholder="Quick Search" />
                 		<span title="Advanced Search Settings" class="advancedtrigger"></span>
            		</form>
            	</div>
              </li>
              <li><a href="#help" aria-owns="help" aria-haspopup="true" class="aui-dropdown2-trigger" aria-controls="dropdown2-header7"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span><span class="aui-icon-dropdown"></span></a>
                <div class="aui-dropdown2 aui-style-default aui-dropdown2-in-header" id="help" style="display: none; top: 40px; min-width: 160px; left: 1213px; " aria-hidden="true">
                    <div class="aui-dropdown2-section">
                        <ul id="helpmenu">
                        	<li><a href="/whatsnew/">What's New</a></li>
                            <li><a href="/gettingstarted/" class="active">Getting Started</a></li>
                            <li><a href="/karma/">Karma</a></li>
                        </ul>
                    </div>
                </div>
              </li>
              
              <li id="userlogin"><a href="/account/signin/">Log In</a></li>
              
          </ul>
      </div>
   </div>
  </nav>
  </header>

<div id="headeradvancedsearch">
    
<div class="advancedsearch">
    <form action="#" id="advsearchform">
        <div class="heading">
            <h4>Find Questions&hellip;</h4>
        </div>
        <div class="row">
            <label>with the words:</label>
            <div class="field">
                <input class="" type="text" value="" id="adv_question"/>
            </div>
        </div>
        <div class="row">
            <label>with the tags:</label>
            <div class="field">
                <input type="text" value="" name="" id="adv_tags"/>
            </div>
        </div>
        <div class="row">
            <label>that apply to:</label>
            <div class="field">
                <label class="checkbox">
                    <input type="radio" name="topic" value="download" />
                    <span>Download</span>
                </label>
                <label class="checkbox">
                    <input type="radio" name="topic" value="ondemand" />
                    <span>OnDemand</span>
                </label>
                <label class="checkbox">
                    <input type="radio" name="topic" value="all" checked />
                    <span>All</span>
                </label>
            </div>
        </div>
        <div class="row">
            <label>created date:</label>
            <div class="field">
                <input type="text" value="" name="" id = "adv_created"/>
            </div>
        </div>
        <div class="row">
            <label>modified date:</label>
            <div class="field">
                <input type="text" value="" name="" id = "adv_modified" />
            </div>
        </div>
        <div class="row last">
            <label>people involved:</label>
            <div class="field">
                <input type="text" value="" id = "adv_people"/>
            </div>
        </div>
         <div class="actions">
            <button class="button save" onclick="myFunc()">Advanced Search</button>
        </div>
    <script>
    function myFunc() {
        var questions = document.getElementById("adv_question");
        var tags  = document.getElementById("adv_tags");
        var alltags = tags.value.split(" ");
        var created  = document.getElementById("adv_created");
        var modified = document.getElementById("adv_modified");
        var people = document.getElementById("adv_people");
        var urlmod = "" ///search/ + '?t=questions&q=';
        if (questions.value != "") {
            urlmod = urlmod + questions.value;
        }
        if (alltags.length > 0) {
            for (tag in alltags) {
                if (alltags[tag] != "") {
                urlmod = urlmod + " " + "[" + alltags[tag] + "]";
                }
            }
        }
        if (created.value != "") {
            urlmod = urlmod + " " + 'created:"' + created.value +'"';
        }
        if (modified.value != "") {
            urlmod = urlmod + " " + 'modified:"' + modified.value +'"';
        }
        if (people.value != "") {
            urlmod = urlmod + " " + 'user:"' + people.value +'"';
        }
        var thisForm = document.getElementById("advsearchform");
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", "q");
            hiddenField.setAttribute("value", urlmod);
            thisForm.appendChild(hiddenField);
        thisForm.setAttribute("action", /search/);
        //console.log(thisForm["action"] + " " + thisForm["q"]);
    }
    </script>
    </form>
</div>
</div>

    <div class="grid">
    
    
        
        
            <div class="alert success">
                <div class="animated bounceInUp">
                    <span class="close">
                        <strong>Close</strong>
                        <span class="icon">&times;</span>
                    </span>
                    <div class="message">
                        First time here? Check out the <a href="/karma/">FAQ</a>!
                    </div>
                </div>
            </div>
        
        
    
    </div>

        





    <div id="main">
        
        <div class="grid">
            <div id="content">
                
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


 <script type="text/javascript">

  $(document).ready(function() {

  });

</script>


<div class="question">
    
    <h1>Trying to implement Marketplace Licensing, getting ClassNotFoundException</h1>
    <div class="tags">
        
            <a href="/tags/jira"
                title="See questions tagged 'jira'"
                rel="tag">jira</a>
        
            <a href="/tags/jira-development"
                title="See questions tagged 'jira-development'"
                rel="tag">jira-development</a>
        
            <a href="/tags/marketplace"
                title="See questions tagged 'marketplace'"
                rel="tag">marketplace</a>
        
            <a href="/tags/licensing"
                title="See questions tagged 'licensing'"
                rel="tag">licensing</a>
        
    </div>
</div>

<div class="post original  ">
    <div class="postvote">
        

<a title="Upvote this answer"
    id="post-159841-upvote"
    class="upvote ajax-command "
    href="/vote/159841/up/">
    Upvote</a>
<span title="Total votes for this answer"
        class="votecount" id="post-159841-score">0</span>
<a title="Downvote this answer"
    id="post-159841-downvote"
    class="downvote ajax-command "
    href="/vote/159841/down/">
    Downvote</a>

        

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/159841/" rel="nofollow"> </a>
<div id="favorite-count" class="votecount">
   
</div>

    </div>
    <div class="avatar">
        <a rel="hovercard" data-url="includes/hovercard.html?name=7041" href="" >
            <img class="user-icon" width="60" height="60" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
        </a>
    </div>
    <div class="postcontent">
        <h3>
            <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/" >
                <strong>Scott Dudley [Arsenale]</strong>
            </a>
            asked this question
            <span class="bullet">&middot;</span>
            111 karma
            <span class="bullet">&middot;</span>
            <a class="postdate" title="Permalink to this post" href="">Apr 18 at 12:26 PM</a>
        </h3>

        <p>Hi all,</p>
<p>I am trying to enable a JIRA plugin for Atlassian-paid Marketplace licensing, but I am running into problems after applying the atlas-create-jira-plugin-module code to our plugin.</p>
<p>The main issue is that we are getting the following exception when trying to load our plugin into the host product:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">2013-04-18 12:10:05,305 Spring executor 19 ERROR admin 730x11x1 18pyy3 127.0.0.1 /rest/plugins/1.0/ [extender.internal.activator.ContextLoaderListener] Application context refresh failed (NonValidatingOsgiBundleXmlApplicationContext(bundle=com.mycompany.myproduct, config=osgibundle:/META-INF/spring/*.xml))
java.lang.NoClassDefFoundError: com/atlassian/upm/license/storage/plugin/PluginLicenseStorageManager
	at java.lang.Class.getDeclaredMethods0(Native Method)
	at java.lang.Class.privateGetDeclaredMethods(Class.java:2451)
	at java.lang.Class.getDeclaredMethods(Class.java:1810)
</pre>
<p>After some painful bisection (comparing our product to the upm-licensing-compatibility sample), we tracked the issue down to a custom Spring configuration file of ours.</p>
<p>In particular, our plugin has the following in src/main/resources/META-INF/spring/spring.xml:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
                        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
"&gt;

    &lt;context:annotation-config/&gt;
    &lt;context:component-scan base-package="com.mycompany.myproduct" /&gt;
&lt;/beans&gt;
</pre>
<p>Our spring.xml exists only because, contrary to what the <a href="https://developer.atlassian.com/display/JIRADEV/JIRA+Plugin+Lifecycle">docs seem to say</a>, JIRA does not invoke any of our @PreDestroy annotated-methods unless we include the &lt;context:annotation-config&gt; element in the Spring configuration.</p>
<p>If I remove our custom spring.xml, the above PluginLicenseStorageManager error goes away and the plugin loads correctly, but then our @PreDestroy-annotated methods don't get called. And if I remove Marketplace licensing support, I can also build and install using our custom spring.xml (and get @PreDestroy annotations to work) with no problems. I just can't seem to get them to work all together.</p>
<p>Ideas?</p>
<p>For example, is there any way to tell the plugin framework to insert instructions directly into the auto-generated Spring configurations, rather than creating our own file? Or to adjust our spring.xml to be Marketplace Licensing-compatible?</p>
<p>(At runtime, in the transformed-plugins directory, I see that our spring.xml is just added to the three Spring configs that the plugin framework generates automatically, and I suspect the problem may be that we're having our code instantiated in a different context than the plugin licensing code.)</p>
<p>Alternatively, is there a way to get @PreDestroy to work without having to hack Spring?</p>
<p>Thanks,<br>Scott</p>

        <div class="postactions">
            





            <ul class="moderateactions">
                


                

            </ul>
            <span class="questionviews">1162 views</span>
        </div>
    </div>

    



<div class="comments" id="comments-159841">
    
    
</div>

</div>


<h2>2 Answers:</h2>




<div id="161120" class="post answer showcomments accepted-answer bestanswer">
    <div class="postvote">
        

<a title="Upvote this answer"
    id="post-161120-upvote"
    class="upvote ajax-command "
    href="/vote/161120/up/">
    Upvote</a>
<span title="Total votes for this answer"
        class="votecount" id="post-161120-score">2</span>
<a title="Downvote this answer"
    id="post-161120-downvote"
    class="downvote ajax-command "
    href="/vote/161120/down/">
    Downvote</a>

        



    </div>
    <div class="avatar">
        <a rel="hovercard" data-url="123" href="" >
            <img class="gravatar" width="60" height="60" src="https://secure.gravatar.com/avatar/b678753ff3ace802a8670bcc6e022c4d?s=60&amp;d=identicon&amp;r=g" alt="Joseph Clark [Atlassian]" />
        </a>
    </div>
    <div class="postcontent">
        <h3>
            <a rel="hovercard" data-url="123" class="hoveruser" href="/users/123/joseph-clark-atlassian/" >
                <strong>Joseph Clark [Atlassian]</strong>
            </a>
            <span class="bullet">&middot;</span>
            20,794 karma
            <span class="bullet">&middot;</span>
            <a class="postdate" title="Permalink to this post" href="">Apr 22 at 08:38 PM</a>
        </h3>

        <p>Have you tried implementing <strong>DisposableBean</strong> instead of annotating with the <strong>@PreDestroy</strong> annotation? That usually works for me!</p>
<p> </p>
<p> </p>

        <div class="postactions">
            





            
        </div>
    </div>

    



<div class="comments" id="comments-161120">
    
    <div class="post comment" id="comment-161122">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/161122">
                    Apr 22 at 08:58 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>Hi Joe,</p>
<p>Thanks for your answer! As it happens, we are already using DisposableBean for other things...but:</p>
<p>The issue is that we needed to move some specific processing to @PreDestroy because we could not make it work inside the regular DisposableBean destroy() method. This happened a while ago, so I am only 85% sure...but I believe our plugin was unable to access other required beans during the destroy() phase. I also seem to recall that the problems occurred during JIRA shutdown (because the other beans were already getting destroyed?), and the end result caused the JVM to fail to shut down cleanly.</p>
<p>To make a long story short: if at all possible, we'd like to keep the @PreDestroy method so that we don't need to retest that stuff and find other workarounds to that original problem.</p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-161123">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="123" data-hovercardclass="cluetip-smallavatar" href="/users/123/joseph-clark-atlassian/">
                <img class="gravatar" width="35" height="35" src="https://secure.gravatar.com/avatar/b678753ff3ace802a8670bcc6e022c4d?s=35&amp;d=identicon&amp;r=g" alt="Joseph Clark [Atlassian]" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="123" class="hoveruser" href="/users/123/joseph-clark-atlassian/">
                    <strong>Joseph Clark [Atlassian]</strong>
                    
                </a>
                <span class="bullet">·</span>
                20,794 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/161123">
                    Apr 22 at 09:01 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>OK, no problem. Let me go digging for more answers.</p>
<p> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-161724">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="123" data-hovercardclass="cluetip-smallavatar" href="/users/123/joseph-clark-atlassian/">
                <img class="gravatar" width="35" height="35" src="https://secure.gravatar.com/avatar/b678753ff3ace802a8670bcc6e022c4d?s=35&amp;d=identicon&amp;r=g" alt="Joseph Clark [Atlassian]" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="123" class="hoveruser" href="/users/123/joseph-clark-atlassian/">
                    <strong>Joseph Clark [Atlassian]</strong>
                    
                </a>
                <span class="bullet">·</span>
                20,794 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/161724">
                    Apr 23 at 10:45 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>I haven't been able to re-produce your problem so far.  Here's a skeleton plugin I've been testing with that has a component with the @PreDestroy annotation, a custom Spring.xml and the UPM plugin licensing code (added via the atlas-create-jira-plugin-module) command.</p>
<p><a href="https://dl.dropboxusercontent.com/u/7602897/test-licensing-plugin.zip">https://dl.dropboxusercontent.com/u/7602897/test-licensing-plugin.zip</a></p>
<p>The plugin loads successfully, I can access the licensing servlets, and the PreDestroy code is fired correctly when the plugin is disabled.</p>
<p>Can you identify any key differences between your plugin and this? Do you have any additional content in your custom spring.xml? Any custom bundle-instructions in your pom.xml or atlassian-plugin.xml?</p>
<p>If you want to share your code with me so I can examine it, feel free - you know my email address :-)</p>
<p> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-161726">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/161726">
                    Apr 23 at 11:14 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>Unfortunately, your code doesn't install here either!</p>
<p>I am building with SDK 4.1.7 and uploading to a JIRA 5.2.9-standalone instance w/production dB, all running on OS X 10.8.3 with Java 1.7u21. Installing with atlas-cli "pi" yields the following error for your code:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">2013-04-23 23:08:58,130 pool-8-thread-1 INFO admin 1388x2x1 1klw6jh 127.0.0.1 /rest/plugins/1.0/ [atlassian.plugin.util.WaitUntil] Plugins that have yet to be enabled: [com.atlassian.jira.test.test-licensing-plugin], 60 seconds remaining
2013-04-23 23:08:58,508 Spring executor 11 ERROR      [plugin.osgi.factory.OsgiPlugin] Unable to start the Spring context for plugin com.atlassian.jira.test.test-licensing-plugin
java.lang.NoClassDefFoundError: com/atlassian/upm/license/storage/plugin/PluginLicenseStorageManager
	at java.lang.Class.getDeclaredMethods0(Native Method)
	at java.lang.Class.privateGetDeclaredMethods(Class.java:2436)
	at java.lang.Class.getDeclaredMethods(Class.java:1793)
	at org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:460)
	at org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:443)
</pre>
<p>Is there anything I should be looking at in my configuration?</p>
<p> </p>
<p> </p>
<p> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-161727">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/161727">
                    Apr 23 at 11:14 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>For what it's worth, I was also able to reproduce the same error by starting with the stock UPM licensing compatibility and modifying it as follows:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">git clone https://bitbucket.org/atlassian_tutorial/upm-licensing-compatibility.git
cd upm-licensing-compatibility/
mkdir -p src/main/resources/META-INF/spring
mv /tmp/spring.xml src/main/resources/META-INF/spring/
atlas-cli -p 8085 --context-path ""
maven2&gt; pi</pre>
<p> ...where /tmp/spring.xml consists of exactly this:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
                        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
"&gt;

    &lt;context:annotation-config/&gt;
    &lt;context:component-scan base-package="com.example.plugins.tutorial" /&gt;
&lt;/beans&gt;</pre>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-161728">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="123" data-hovercardclass="cluetip-smallavatar" href="/users/123/joseph-clark-atlassian/">
                <img class="gravatar" width="35" height="35" src="https://secure.gravatar.com/avatar/b678753ff3ace802a8670bcc6e022c4d?s=35&amp;d=identicon&amp;r=g" alt="Joseph Clark [Atlassian]" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="123" class="hoveruser" href="/users/123/joseph-clark-atlassian/">
                    <strong>Joseph Clark [Atlassian]</strong>
                    
                </a>
                <span class="bullet">·</span>
                20,794 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/161728">
                    Apr 23 at 11:27 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>Hm, I was testing on JDK 6. Let me see if that makes a difference :)</p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-161744">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="123" data-hovercardclass="cluetip-smallavatar" href="/users/123/joseph-clark-atlassian/">
                <img class="gravatar" width="35" height="35" src="https://secure.gravatar.com/avatar/b678753ff3ace802a8670bcc6e022c4d?s=35&amp;d=identicon&amp;r=g" alt="Joseph Clark [Atlassian]" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="123" class="hoveruser" href="/users/123/joseph-clark-atlassian/">
                    <strong>Joseph Clark [Atlassian]</strong>
                    
                </a>
                <span class="bullet">·</span>
                20,794 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/161744">
                    Apr 24 at 01:18 AM
                </a>
            </h3>
            <div class="comment-text">
                <p>OK, I can repro the error if I use atlas-cli to install the plugin in a JIRA instance. If I use "atlas-run" or "atlas-debug" to simultaneously start a version of JIRA and install the upm licensing compatibility test plugin, then it works.</p>
<p>I believe that this has to do with the bundledArtifacts/pluginArtifacts configuration in the pom.xml, but not sure 100% sure as to the root cause yet.</p>
<p> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-162190">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/162190">
                    Apr 24 at 04:31 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>This is getting interesting now. :-)</p>
<p>I took the .JAR that was build by running "pi" and tried to upload it manually via the UPM--no dice.</p>
<p>I cleaned up target and rebuilt the JAR from "atlas-mvn package", then tried to upload it manually via UPM (again to a production JIRA instance), but that was also still broken.</p>
<p>However, I noticed that the "atlas-mvn package" JAR was significantly bigger, so I went to investigate:</p>
<ul>
<li>in META-INF/MANIFEST.MF, the "atlas-mvn package" version of the .JAR is missing the line "Originally-Created-By: Apache Maven Bundle Plugin". Does this point to it perhaps having been created with a different build tool than when it was created with "atlas-cli pi"?</li>
<li>the "atlas-mvn package" version has a copy of plugin-license-storage-plugin.jar in the root of the .JAR, whereas the "atlas-cli pi" version does not (!)</li>
</ul>
<p>For what it's worth, our product will support only JIRA 5.0.1+, so we don't even need to bundle the licensing JARs anyway. Is there documentation available on using Atlassian licensing without going through ThirdPartyPluginManager, or is there perhaps an easier way to handle it?</p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-164045">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="123" data-hovercardclass="cluetip-smallavatar" href="/users/123/joseph-clark-atlassian/">
                <img class="gravatar" width="35" height="35" src="https://secure.gravatar.com/avatar/b678753ff3ace802a8670bcc6e022c4d?s=35&amp;d=identicon&amp;r=g" alt="Joseph Clark [Atlassian]" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="123" class="hoveruser" href="/users/123/joseph-clark-atlassian/">
                    <strong>Joseph Clark [Atlassian]</strong>
                    
                </a>
                <span class="bullet">·</span>
                20,794 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/164045">
                    Apr 30 at 01:45 AM
                </a>
            </h3>
            <div class="comment-text">
                <p>OK, yeah, that does seem to be the problem. If the jar doesn't have the plugin-license-storage-plugin jar embedded within it, then the aforementioned class is actually missing.  For some reason, when you run atlas-cli &gt; pi, the the following declaration in your plugin's pom.xml gets ignored:</p>
<pre class="brush: xml; class-name: wrap; fontsize: 100; first-line: 1; ">&lt;plugin&gt;
  &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;copy-storage-plugin&lt;/id&gt;
      &lt;phase&gt;process-resources&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;copy-dependencies&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;outputDirectory&gt;${project.build.outputDirectory}&lt;/outputDirectory&gt;
        &lt;includeArtifactIds&gt;plugin-license-storage-plugin&lt;/includeArtifactIds&gt;
        &lt;stripVersion&gt;true&lt;/stripVersion&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre>
<p> </p>
<p> </p>
<p>So this definitely seems to be a bug in the atlas-cli. However, I wonder if maybe we're heading down a red herring trail here. JIRA 5.2.9 should come pre-packaged with a version of the UPM that provides the necessary license storage APIs, right? So the special "UPM License Storage" plugin should never actually be required?</p>
<p>So that makes me wonder if your custom spring.xml is somehow getting your plugin confused into thinking that the UPM's built-in functionality isn't available, causing it to fall back to attempting to use the legacy storage library, which then is not available for use due to the CLI bug.  This is total theory-crafting here, I don't have any evidence to prove that this is what's happening.  Still digging further, but at least we're making progress.</p>
<p>As for "other" ways to do this, I'm not sure. I've never deviated from the instructions provided by the UPM team. </p>
<p> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-164051">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="123" data-hovercardclass="cluetip-smallavatar" href="/users/123/joseph-clark-atlassian/">
                <img class="gravatar" width="35" height="35" src="https://secure.gravatar.com/avatar/b678753ff3ace802a8670bcc6e022c4d?s=35&amp;d=identicon&amp;r=g" alt="Joseph Clark [Atlassian]" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="123" class="hoveruser" href="/users/123/joseph-clark-atlassian/">
                    <strong>Joseph Clark [Atlassian]</strong>
                    
                </a>
                <span class="bullet">·</span>
                20,794 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/164051">
                    Apr 30 at 02:19 AM
                </a>
            </h3>
            <div class="comment-text">
                <p>OK, I take back that theory. It looks like the ThirdPartyPluginLicenseStorageManager stuff relies on the license storage plugin classes being present, even if the UPM is third-party license aware.</p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-164282">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/164282">
                    Apr 30 at 10:04 AM
                </a>
            </h3>
            <div class="comment-text">
                <p>Joe,</p>
<p>Thanks for all of the research thus far! Perhaps I should have called it out more explicitly in my last comment, but I should mention that even the JAR built with "atlas-mvn package" is still broken for me in the same way described above (despite it having the appropriate JAR included). In other words, I'm not able to get the JAR to load at all, regardless of which way I build or install it. :-(</p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-164506">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="123" data-hovercardclass="cluetip-smallavatar" href="/users/123/joseph-clark-atlassian/">
                <img class="gravatar" width="35" height="35" src="https://secure.gravatar.com/avatar/b678753ff3ace802a8670bcc6e022c4d?s=35&amp;d=identicon&amp;r=g" alt="Joseph Clark [Atlassian]" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="123" class="hoveruser" href="/users/123/joseph-clark-atlassian/">
                    <strong>Joseph Clark [Atlassian]</strong>
                    
                </a>
                <span class="bullet">·</span>
                20,794 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/164506">
                    Apr 30 at 09:58 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>Yeah, I just realised that after I made my comment. I had a chat with one of the marketplace/UPM devs who gave me a better understanding of the situation.</p>
<p>The problem seems to be that Spring's annotation-config processor's just can't handle the way in which the ThirdPartyPluginLicenseStorageManager is instantiated, and the 'lazy' way in which the plugin license storage plugin is installed.</p>
<p>So you have two ways to work around this, if you really need to use the spring annotations.</p>
<p>1) Distribute your plugin as an OBR, instead of a jar. This will ensure that all required dependencies are extracted and made available in the correct order. Some relevant details here: <a href="https://developer.atlassian.com/display/UPM/Alternate+Deployment+Model+for+Licensed+Plugins">https://developer.atlassian.com/display/UPM/Alternate+Deployment+Model+for+Licensed+Plugins</a> The downside to this approach is that you can't use atlas-cli or atlas-install-plugin when working with a plugin that's built as an OBR - the plugin SDK will continue to try to use the jar.</p>
<p>2) Since you know you will only ever run your plugin against versions of JIRA that have UPM 2.0 or higher, you can ignore the "ThirdPartyPluginLicenseManager" compatibility layer, and code against the UPM licensing API directly.  There's some rough javadoc on this API here: <a href="https://developer.atlassian.com/static/javadoc/upm/licensing/2.0/reference/com/atlassian/upm/api/license/PluginLicenseManager.html">https://developer.atlassian.com/static/javadoc/upm/licensing/2.0/reference/com/atlassian/upm/api/license/PluginLicenseManager.html</a></p>
<p>This is not yet the "officially sanctioned" way to write your licensing code, but it will become more prevalent as old versions of the UPM disappear from the wild. So you're just being an early adopter :-)  To use this API, you need to remove all licensing-related elements from your pom.xml and instead depend on the UPM licensing library in your pom. Then you can switch all your references from "ThirdPartyPluginLicenseStorageManager" to "PluginLicenseManager".</p>
<p> </p>
<p> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-164834">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/164834">
                    May 01 at 09:25 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>Joe,</p>
<p>Thanks for all of the assistance! We're trying to avoid having to ship OBRs, so we decided on option #2.</p>
<p>Just to clarify your instructions a little, for the sake of everyone else, here's what we ended up doing (starting from a completely non-Marketplace-enabled build):</p>
<p>1) Added to pom.xml:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">+        &lt;dependency&gt;
+            &lt;groupId&gt;com.atlassian.upm&lt;/groupId&gt;
+            &lt;artifactId&gt;upm-api&lt;/artifactId&gt;
+            &lt;version&gt;${upm.license.compatibility.version}&lt;/version&gt;
+            &lt;scope&gt;provided&lt;/scope&gt;
+        &lt;/dependency&gt;
+        &lt;dependency&gt;
+            &lt;groupId&gt;com.atlassian.upm&lt;/groupId&gt;
+            &lt;artifactId&gt;licensing-api&lt;/artifactId&gt;
+            &lt;version&gt;${upm.license.compatibility.version}&lt;/version&gt;
+            &lt;scope&gt;provided&lt;/scope&gt;
+        &lt;/dependency&gt;
...
     &lt;properties&gt;
+        &lt;upm.license.compatibility.version&gt;2.4.1&lt;/upm.license.compatibility.version&gt;
     &lt;/properties&gt;</pre>
<p> </p>
<p>2) Added to atlassian-plugin.xml:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">     &lt;plugin-info&gt;
+        &lt;param name="atlassian-licensing-enabled"&gt;true&lt;/param&gt;
     &lt;/plugin-info&gt;
...
+    &lt;component-import key="pluginLicenseManager" interface="com.atlassian.upm.api.license.PluginLicenseManager"/&gt;</pre>
<div>... continued in next comment</div>
<p> </p>
<p> </p>
<p> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-164835">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/164835">
                    May 01 at 09:26 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>3) Added licensing code to the appropriate points in our app (which also needs to be declared as a separate component itself):</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">+import com.atlassian.upm.api.license.PluginLicenseManager;
+import com.atlassian.upm.api.license.entity.PluginLicense;
 
...
 
public class MyAppLicenseManager
{
+    private PluginLicenseManager licenseManager;
+
+    public MyAppLicenseManager(PluginLicenseManager licenseManager)
+    {
+        this.licenseManager = licenseManager;
+    }
+
 
...
 
+    public boolean testLicenseStatus()
+    {
+         if (!licenseManager.getLicense().isDefined())
+            {
+                return false;
+            }
+
+            PluginLicense pluginLicense = licenseManager.getLicense().get();
+
+            // We have a valid license and no error is listed, so we're all good.
+
+            if (! pluginLicense.getError().isDefined())
+            {
+                return true;
+            }
+
+            switch (pluginLicense.getError().get())
+            {
+                 // handle different license error conditions here
...</pre>
<p> </p>
<p> </p>
<p> </p>
<p>4) Made one further edit to pom.xml to turn off the "extractDependencies" option:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">            &lt;plugin&gt;
                &lt;groupId&gt;com.atlassian.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-jira-plugin&lt;/artifactId&gt;
                &lt;version&gt;${amps.version}&lt;/version&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;productVersion&gt;${jira.version}&lt;/productVersion&gt;
+                    &lt;extractDependencies&gt;false&lt;/extractDependencies&gt;
                 &lt;/configuration&gt;
             &lt;/plugin&gt;</pre>
<p> </p>
<p>..continued</p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-164836">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/164836">
                    May 01 at 09:27 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>Step 4 may be optional--a feature of newer plugin SDKs is that they apparently unpack any dependent JARs and explode all of the class files within the top level of your plugin JAR, rather than leaving them as separately packaged JARs in META-INF/lib. We do some post-processing of our JAR and we had to turn this off to get it to work properly. Unless there's some good reason that we should be extracting the dependencies (was this done just for Marketplace licensing reasons?), we'd otherwise like to leave it turned off. Not only does it help with our post-processing, but it seems a good idea not to commingle our plugin classes with other potentially-conflicting GPL/BSD/etc licenses.</p>
<p>With all of that being said and done, everything now works perfectly. Thanks again!</p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-165265">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="66" data-hovercardclass="cluetip-smallavatar" href="/users/66/ben-woskow-atlassian/">
                <img class="gravatar" width="35" height="35" src="https://secure.gravatar.com/avatar/685b84088f35b64a4a526921db55016e?s=35&amp;d=identicon&amp;r=g" alt="Ben Woskow [Atlassian]" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="66" class="hoveruser" href="/users/66/ben-woskow-atlassian/">
                    <strong>Ben Woskow [Atlassian]</strong>
                    
                </a>
                <span class="bullet">·</span>
                1,367 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/165265">
                    May 02 at 12:57 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>Yes, step 4 is optional. Extracting dependencies will cause your plugin build time to increase a bit but ultimately will decrease plugin startup time. It was added to the SDK primarily for the remotable plugins work that is ongoing, however, can also be utilized by P2 plugins.</p>
<p>The one thing I noticed with your changes is that you're compiling against version 2.4.1 of UPM's API. Since this API no longer installs the necessary components at plugin startup (like the previous API), your plugin expects the licensing API to already be present. As a result, your plugin will only work in product versions where UPM 2.4.1 or later is installed. This may or may not be true; please check this page [1] to confirm and possibly require a lower minimum version if needed.</p>
<p>Cheers,<br>Ben</p>
<p>[1] <a href="https://ecosystem.atlassian.net/wiki/display/UPM/UPM+Bundling+Matrix" rel="nofollow">https://ecosystem.atlassian.net/wiki/display/UPM/UPM+Bundling+Matrix</a></p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-191104">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/191104">
                    Jul 16 at 04:18 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>So...two months later, everything was working fine in our labs and the product is now in the field. We have recently gotten sporadic (2) reports of users unable being able to install the plugin. The problems all display the symptoms in the log shown below, related to the PluginLicenseManagerImpl apparently not exposing the correct signature for the "Option getLicense()" method.</p>
<p>The two users who reported this problem were using JIRA 5.0.6 or 5.1.7 and (respectively) and they were all on the bundled UPM 2.1.5.</p>
<p>In our product, we are building with a upm.license.compatibility.version of 2.0.5. Did anything inadvertently change in 2.1.5 that might cause this problem to occur? (I admit that I cannot reproduce this issue on any of our systems, even using UPM 2.1.5.)</p>
<p>For at least one of the users, asking him to upgrade UPM to 2.12.1 and then reinstall our plugin got things working.</p>
<p>Here is the log:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">org.springframework.aop.AopInvocationException: AOP configuration
seems to be invalid: tried calling method [public abstract
com.atlassian.upm.api.util.Option
com.atlassian.upm.api.license.PluginLicenseManager.getLicense()]
on target
[com.atlassian.upm.license.internal.impl.PluginLicenseManagerImpl@94a1ceb];
nested exception is java.lang.IllegalArgumentException: object is
not an instance of declaring class
at
org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:315)
[...]
org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
at $Proxy1986.getLicense(Unknown Source)
at
com.arsenalesystems.myproduct.licensing.AppLicenseManager.getLicenseError(SourceFile:49)
at
com.arsenalesystems.myproduct.actions.AppConfigAction.doDefault(SourceFile:31)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown
Source)
at java.lang.reflect.Method.invoke(Unknown Source)
</pre>
<p> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-191565">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="66" data-hovercardclass="cluetip-smallavatar" href="/users/66/ben-woskow-atlassian/">
                <img class="gravatar" width="35" height="35" src="https://secure.gravatar.com/avatar/685b84088f35b64a4a526921db55016e?s=35&amp;d=identicon&amp;r=g" alt="Ben Woskow [Atlassian]" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="66" class="hoveruser" href="/users/66/ben-woskow-atlassian/">
                    <strong>Ben Woskow [Atlassian]</strong>
                    
                </a>
                <span class="bullet">·</span>
                1,367 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/191565">
                    Jul 17 at 01:18 PM
                </a>
            </h3>
            <div class="comment-text">
                <p>Hi Scott,</p>
<p>I don't know of any inadvertant changes in UPM 2.1.5 that would break licensing as you describe. If you or your customers want to file a UPM ticket [1], we can take a look and try to reproduce the problems.</p>
<p>Cheers,<br>Ben</p>
<p>[1] <a href="https://ecosystem.atlassian.net/browse/UPM" rel="nofollow">https://ecosystem.atlassian.net/browse/UPM</a> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"><span class="bullet">·</span><span class="likecount">1</span> user liked this</span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    
</div>

</div>

<div id="161245" class="post answer showcomments  ">
    <div class="postvote">
        

<a title="Upvote this answer"
    id="post-161245-upvote"
    class="upvote ajax-command "
    href="/vote/161245/up/">
    Upvote</a>
<span title="Total votes for this answer"
        class="votecount" id="post-161245-score">0</span>
<a title="Downvote this answer"
    id="post-161245-downvote"
    class="downvote ajax-command "
    href="/vote/161245/down/">
    Downvote</a>

        



    </div>
    <div class="avatar">
        <a rel="hovercard" data-url="638" href="" >
            <img class="user-icon" width="60" height="60" src="/upfiles/user_icons/cached/Florin_Manaila_avatar_icon128.png" alt="Florin%20Manaila" />
        </a>
    </div>
    <div class="postcontent">
        <h3>
            <a rel="hovercard" data-url="638" class="hoveruser" href="/users/638/florin-manaila/" >
                <strong>Florin Manaila</strong>
            </a>
            <span class="bullet">&middot;</span>
            4,087 karma
            <span class="bullet">&middot;</span>
            <a class="postdate" title="Permalink to this post" href="">Apr 23 at 04:27 AM</a>
        </h3>

        <p>You could add the PluginLicenseStorageManager to your spring.xml if there's no better way around it. Just look at what the build generates for that manager if you don't provide a spring.xml of your own and then add it. However, there should be a better way of handling the problem. </p>

        <div class="postactions">
            





            
        </div>
    </div>

    



<div class="comments" id="comments-161245">
    
    <div class="post comment" id="comment-161529">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="7041" data-hovercardclass="cluetip-smallavatar" href="/users/7041/scott-dudley-arsenale/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/nophoto_icon128.png" alt="Scott%20Dudley%20%5BArsenale%5D" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="7041" class="hoveruser" href="/users/7041/scott-dudley-arsenale/">
                    <strong>Scott Dudley [Arsenale]</strong>
                    
                </a>
                <span class="bullet">·</span>
                111 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/161529">
                    Apr 23 at 11:46 AM
                </a>
            </h3>
            <div class="comment-text">
                <p>I tried this. I had a look at the transformed/generated atlassian-plugins-components.xml and found only the following:</p>
<pre class="brush: plain; class-name: wrap; fontsize: 100; first-line: 1; ">  &lt;beans:bean id="thirdPartyPluginLicenseStorageManager" autowire="default" class="com.atlassian.upm.license.storage.lib.ThirdPartyPluginLicenseStorageManagerImpl"/&gt;
  &lt;beans:bean id="pluginLicenseStoragePluginInstaller" autowire="default" class="com.atlassian.upm.license.storage.lib.PluginLicenseStoragePluginInstaller"/&gt;
  &lt;beans:bean id="atlassianMarketplaceUriFactory" autowire="default" class="com.atlassian.upm.license.storage.lib.AtlassianMarketplaceUriFactoryImpl"/&gt;&nbsp;</pre>
<p>I notice that the exception refers to "com.atlassian.upm.license.storage.plugin.PluginLicenseStorageManager", but that bean doesn't seem to exist anywhere in the generated Spring configuration files. (I looked at atlassian-plugins-host-components.xml, atlassian-plugins-component-imports.xml, and atlassian-plugins-components.xml.)</p>
<p>That notwithstanding, I tried the above three lines by removing the "beans" namespace and adding them back to my own Spring configuration (above). Unfortunately, this still produced the same error on startup.</p>
<p> </p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    <div class="post comment" id="comment-161854">
        <div class="avatar">
            <a title="" rel="hovercard" data-url="638" data-hovercardclass="cluetip-smallavatar" href="/users/638/florin-manaila/">
                <img class="user-icon" width="35" height="35" src="/upfiles/user_icons/cached/Florin_Manaila_avatar_icon128.png" alt="Florin%20Manaila" />
            </a>
        </div>
        <div class="postcontent">
            <h3>
                <a rel="hovercard" data-url="638" class="hoveruser" href="/users/638/florin-manaila/">
                    <strong>Florin Manaila</strong>
                    
                </a>
                <span class="bullet">·</span>
                4,087 karma
                <span class="bullet">&middot;</span>
                <a class="postdate" title="Permalink to this post" href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception/161854">
                    Apr 24 at 05:00 AM
                </a>
            </h3>
            <div class="comment-text">
                <p>Now that Joseph mentioned it, I recall that we had the same problem only when trying to re-upload a plugin using the atlassian sdk (either atlas-cli or fastdev- which uses atlas-cli). On a fresh start using atlas-run/debug or install from "Manage Plugins" on a standalone instance it works well. So it might be sdk-related.</p>
            </div>
            <div class="postactions">
                
                <span class="likewrapper"></span>
                
                <ul class="moderateactions">
                    
                    
                    
                </ul>
            </div>
        </div>
    </div>
    
    
</div>

</div>








<form id="fmanswer" class="write writeanswer expanded">
    <div class="writeactions">
        <a href="/account/signin/?next=/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception" class="button save">
            Login/Signup to Post Your Answer
        </a>
    </div>
</form>


<div class="nextstep">
    <h3>Looking for something else?</h3>
    <div class="search">
        <form action="/search/" novalidate="novalidate">
            <input type="hidden" value="question" name="t">
            <input class="query" value="" name="q" placeholder="Search Questions or [Tags]" />
            
            
        </form>
    </div>
    
<div class="advancedsearch">
    <form action="#" id="advsearchform">
        <div class="heading">
            <h4>Find Questions&hellip;</h4>
        </div>
        <div class="row">
            <label>with the words:</label>
            <div class="field">
                <input class="" type="text" value="" id="adv_question"/>
            </div>
        </div>
        <div class="row">
            <label>with the tags:</label>
            <div class="field">
                <input type="text" value="" name="" id="adv_tags"/>
            </div>
        </div>
        <div class="row">
            <label>that apply to:</label>
            <div class="field">
                <label class="checkbox">
                    <input type="radio" name="topic" value="download" />
                    <span>Download</span>
                </label>
                <label class="checkbox">
                    <input type="radio" name="topic" value="ondemand" />
                    <span>OnDemand</span>
                </label>
                <label class="checkbox">
                    <input type="radio" name="topic" value="all" checked />
                    <span>All</span>
                </label>
            </div>
        </div>
        <div class="row">
            <label>created date:</label>
            <div class="field">
                <input type="text" value="" name="" id = "adv_created"/>
            </div>
        </div>
        <div class="row">
            <label>modified date:</label>
            <div class="field">
                <input type="text" value="" name="" id = "adv_modified" />
            </div>
        </div>
        <div class="row last">
            <label>people involved:</label>
            <div class="field">
                <input type="text" value="" id = "adv_people"/>
            </div>
        </div>
         <div class="actions">
            <button class="button save" onclick="myFunc()">Advanced Search</button>
        </div>
    <script>
    function myFunc() {
        var questions = document.getElementById("adv_question");
        var tags  = document.getElementById("adv_tags");
        var alltags = tags.value.split(" ");
        var created  = document.getElementById("adv_created");
        var modified = document.getElementById("adv_modified");
        var people = document.getElementById("adv_people");
        var urlmod = "" ///search/ + '?t=questions&q=';
        if (questions.value != "") {
            urlmod = urlmod + questions.value;
        }
        if (alltags.length > 0) {
            for (tag in alltags) {
                if (alltags[tag] != "") {
                urlmod = urlmod + " " + "[" + alltags[tag] + "]";
                }
            }
        }
        if (created.value != "") {
            urlmod = urlmod + " " + 'created:"' + created.value +'"';
        }
        if (modified.value != "") {
            urlmod = urlmod + " " + 'modified:"' + modified.value +'"';
        }
        if (people.value != "") {
            urlmod = urlmod + " " + 'user:"' + people.value +'"';
        }
        var thisForm = document.getElementById("advsearchform");
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", "q");
            hiddenField.setAttribute("value", urlmod);
            thisForm.appendChild(hiddenField);
        thisForm.setAttribute("action", /search/);
        //console.log(thisForm["action"] + " " + thisForm["q"]);
    }
    </script>
    </form>
</div>
    <p class="tagslabel">or <strong>Browse other questions tagged:</strong></p>
    <div class="tags">
        
        <a href="/tags/jira" title="See questions tagged 'jira'">jira</a>
        
        <a href="/tags/jira-development" title="See questions tagged 'jira-development'">jira-development</a>
        
        <a href="/tags/marketplace" title="See questions tagged 'marketplace'">marketplace</a>
        
        <a href="/tags/licensing" title="See questions tagged 'licensing'">licensing</a>
        
    </div>

    <p>or <strong><a href="/questions/ask/">Ask a Question</a></strong></p>
</div>



                
                
            </div>
            <div id="sidebar">
                
    

    


<div id="nps_vote" class="section">
    <h3>Help Us Improve</h3>
<form method="post" action="/nps_vote/" class="nps_vote_form">
<div style='display:none'><input type='hidden' name='csrfmiddlewaretoken' value='3e9b9d179335cd58a1632378ce0583b6' /></div>


    <input type="hidden" name="nps_question_id" value="159841">


<span class="nps_vote_display">
    
</span>

<p>
    How likely is it that you would recommend Atlassian Answers to a friend or colleague?
</p>


<div class="nps_vote" style="margin-bottom:2px;">
    

<div id="npsslider" style="width: 250px; margin-bottom: 5px; margin-left: 2px;" ></div>

<div style="float:left"><b>Not Likely</b></div><div style="float:right; margin-right: 2px"><b>Very Likely</b></div><br />
<input type="number" value="" id="nps_value" style="display:none;" name="nps_score"></input>
</div>



<input type="submit" value="Save" class="button save" style="width: 100px; margin-left:30%; margin-right:40%; margin-top: 8px">
</form>



<script>
$(function(){
    if (window.nps_vote_setup)
        return;
    window.nps_vote_setup = true
    $( "#npsslider" ).slider({
    min: 1,
    max: 10,
    slide: function( event, ui ) {
            //console.log(ui.value);
            $( "#nps_value").val(ui.value);
            $(".nps_vote_display").html(ui.value);
    }
    });

    $('.nps_vote_display').show();

    $('.nps_vote_form').live('submit', function(e){
        var form = $(e.target),
            pos = {
                pageX: (form.width() / 2) + form.offset().left,
                pageY: (form.height() / 2) + form.offset().top
            };
        $.ajax({
            url: "/nps_vote/",
            type: "POST",
            data: $(this).serialize(),
            success: function(data, status, xhr){
                if (data.success){
                    hide();
                    if (data.message)
                        show_message(pos, data.message);
                }
                else {
                    show_message(pos, data.error_message);
                }
            },
            error: function(xhr, status, error){
                show_message(pos, xhr.statusText);
            }
        });
        return false;
    });

    var score = $('.nps_vote_display').text().replace(/^\s*|\s*$/ig, '');

    var elements = $('.nps_vote').nextAll().andSelf(),
    linkP = $('<p>', {"class": "more"}),
    edit = $('<a>', {text: 'Change response', href: '#'});
    edit.click(function(){
        show();
        return false;
    });
    edit.appendTo(linkP);
    function hide(){
        elements.hide();
        linkP.insertAfter('.nps_comment');
    }
    function show(){
        elements.show();
        linkP.detach();
    }

    if (score){
        //radios.filter('#nps_score_'+score).click();
        hide();
        $("#npsslider").slider("value", score);
        $("#nps_value").val(score);
    } else {
        $("#npsslider").slider("value",6);
        $(".nps_vote_display").html(6);
        $("#nps_value").val(6);
    }
    //else radios.filter(':checked').click();
});
</script>

</div>


    <div class="section" id="rssquestion"><h3>Follow Question by RSS</h3><ul><li class="follow-rss"><a href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception?type=rss">Answers</a></li><li class="follow-rss"><a href="/questions/159841/trying-to-implement-marketplace-licensing-getting-classnotfoundexception?type=rss&amp;comments=yes">Answers + Comments</a></li></ul></div><div class="section" id="sharequestion"><h3>Share Question</h3><ul><li class="share-twitter"><div style="margin-top: 0px; float: left;"><a href="https://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></div><div class="fb-like" data-href="" data-send="false" data-layout="button_count" data-width="150" data-show-faces="false" style="float: left; margin-left: 20px;"></div></li></ul></div>


    <div class="section" id="relatedquestions">
        <h3>Related Questions</h3>
        
        <ul>
            
            <li class="inprogress">
                <a href="/questions/234995/gotomeeting-plugin-for-jira">GoToMeeting plugin for JIRA</a>
            </li>
            
            <li class="answered">
                <a href="/questions/140113/error-creating-bean-with-name-pluginlicensestorageplugininstaller">Error creating bean with name &#39;pluginLicenseStoragePluginInstaller&#39;</a>
            </li>
            
            <li class="inprogress">
                <a href="/questions/190043/how-to-license-a-jira-client">How to license a jira client?</a>
            </li>
            
            <li class="answered">
                <a href="/questions/237185/marketplace-submission-problem">Marketplace Submission Problem</a>
            </li>
            
            <li class="inprogress">
                <a href="/questions/56001/plugin-licensing-responsibility-for-locking-disabling-plugin">Plugin Licensing - responsibility for locking (disabling) plugin</a>
            </li>
            
            <li><span id="showmorequestions">Show more related questions</span></li>
        </ul>
        <ul id="morequestions">
            
            <li class="">
                <a href="/questions/226969/jira-uservoice-plugin">JIRA UserVoice Plugin</a>
            </li>
            
            <li class="answered">
                <a href="/questions/225817/multiple-supported-versions-in-the-marketplace">Multiple supported versions in the marketplace</a>
            </li>
            
            <li class="answered">
                <a href="/questions/218404/adding-license-support-to-plugin-problem">Adding license support to plugin problem</a>
            </li>
            
            <li class="answered">
                <a href="/questions/219723/promotion-not-showing-up">Promotion not showing up</a>
            </li>
            
            <li class="answered">
                <a href="/questions/224029/jira-api-rest-search-comment">JIRA API REST. Search comment.</a>
            </li>
            
        </ul>
        
    </div>

    
<!--
<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or __italic__
        </li>
        <li>
    		**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
    		numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
    		to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
    		basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>
-->

            </div>
        </div>
    </div>


<footer id="footer">
    <div class="content">
        <nav>
            <h4>Answers</h4>
            <ul>
                <li><a href="/questions/ask/">Ask a Question</a></li>
                <li><a href="/karma/">Karma</a></li>
                
                <li><a href="/account/signin/">Log In</a>/ <a href="https://my.atlassian.com/signup/?destination=https://answers.atlassian.com/account/signin/">Sign Up</a></li>
                
                <li><a href="http://jira.atlassian.com/browse/ANSWERS/">Report a Bug</a></li>
            </ul>
        </nav>
        <nav>
            <h4>Resources</h4>
            <ul>
                <li><a href="http://confluence.atlassian.com/display/ALLDOC/Atlassian+Documentation" target="_blank">Documentation</a></li>
                <li><a href="http://jira.atlassian.com" target="_blank">Bugs and Features</a></li>
    			<li><a href="http://www.atlassian.com/company/contact" target="_blank">Contact Us</a></li>
    			<li><a href="http://www.atlassian.com/resources/experts" target="_blank">Atlassian Experts</a></li>
    			<li><a href="http://www.atlassian.com/resources/support" target="_blank">Get Help</a></li>
    			<li><a href="http://www.atlassian.com/resources/training" target="_blank">Training</a></li>
    			<li><a href="http://www.atlassian.com/tv" target="_blank">AtlassianTV</a></li>
    			<li><a href="https://marketplace.atlassian.com/" target="_blank">Marketplace</a></li>
            </ul>
        </nav>
        <nav>
            <h4>Community</h4>
            <ul>
                <li><a href="https://www.atlassian.com/company/events" target="_blank">Events</a></li>
                <li><a href="https://confluence.atlassian.com/display/AUG/Home" target="_blank">Atlassian User Groups</a></li>
                <li><a href="https://developer.atlassian.com/" target="_blank">Atlassian Developers</a></li>
                <li><a href="http://www.atlassian.com/local" target="_blank">Local</a></li>
                <li><a href="http://swag.atlassian.com/" target="_blank">Atlassian Swag</a></li>
            </ul>
        </nav>
        <nav>
          <h4>Connect</h4>
          <ul>
            <li>
              <p id="newsletter-text">
                Subscribe to our <a href="http://www.atlassian.com/newsletter">newsletter</a>:
              </p>
              <form method="post" name="subscribeForm" action="https://cl.exct.net/subscribe.aspx?lid=234098" id="newsletter-form">
                <input type="hidden" value="http://www.atlassian.com/en/wac/newsletter/subscribe-confirmation" name="thx">
                <input type="hidden" value="http://www.atlassian.com/en/wac/newsletter/error" name="err">
                <input type="hidden" value="http://www.atlassian.com/en/wac/newsletter/unsubscribe-confirmation" name="usub">
                <input type="hidden" value="sub_add_update" name="SubAction">
                <input type="hidden" value="132689" name="MID">
                <input type="text" name="Email Address" value="" id="newsletter-subscribe">
                <button type="submit" id="newsletter-submit">Search</button>
              </form>
            </li>
            <li class="social"><a href="http://www.facebook.com/AtlassianSoftware" id="link-facebook" target="_blank">Facebook</a></li>
            <li class="social"><a href="http://twitter.com/atlassian" id="link-twitter" target="_blank">Twitter</a></li>
            <li class="social"><a href="http://blogs.atlassian.com" id="link-blogs" target="_blank">Blogs</a></li>
          </ul>
        </nav>
        <section id="copyright">
            Powered by <a href="http://www.osqa.net/" target="_blank">OSQA</a>,
            &nbsp;&nbsp;
            Copyright © 2013 <a href="http://www.atlassian.com/">Atlassian</a>. All rights reserved.
</section>
    </div>
</footer>


        
            
            <div id="ground">
                
                    <script type="text/javascript">


//$("body.questiondetails #sidebar").append("<a href='https://ace.atlassian.com/del/ck.php?oaparams=2__bannerid=100__zoneid=43__cb=692a92093b__oadest=http%3A%2F%2Fsummit.atlassian.com%2F%3Futm_source%3Daac-questions%26utm_medium%3Dbanner%26utm_campaign%3Dsummit-2013%26utm_content%3Dagenda-announced' target='_blank'><img style='margin-top:20px;' src='http://ace.atlassian.com/c/?zoneid=43&amp;amp;cb=summ1t4daac&amp;amp;n=a3bfdd0f' border='0' alt='' /></a>");

//$("body.ask #sidebar").append("<a href='https://ace.atlassian.com/del/ck.php?oaparams=2__bannerid=100__zoneid=43__cb=692a92093b__oadest=http%3A%2F%2Fsummit.atlassian.com%2F%3Futm_source%3Daac-questions%26utm_medium%3Dbanner%26utm_campaign%3Dsummit-2013%26utm_content%3Dagenda-announced' target='_blank'><img style='margin-top:20px;' src='http://ace.atlassian.com/c/?zoneid=43&amp;amp;cb=summ1t4daac&amp;amp;n=a3bfdd0f' border='0' alt='' /></a>");

</script>
                
            </div>
            
        
        

        </div>
        
        
        <script id="feedback-contents" type="text/html">
            <form id="feedback-form">
                <p>
                    We're here to help. If you've found a bug or have a feature
                    request, please hop on over to
                    <a href="https://jira.atlassian.com/browse/ANSWERS">JIRA</a>
                    and file it, or comment here and we'll get back to you.
                </p>
                <p>
                    <label for="feedback-email">Email:<input name="email" id="feedback-email" type="email" value=""></label>
                </p>
                <textarea name="description" id="feedback-desc"></textarea>
            </form>
        </script>

        <div class="hovercard">
    <div class="section info">
          <h3><a href="" id="hovertitle"></a></h3>
          
        <div class="clear"></div><!--/clear-->
    </div><!--/info-->
        <div class="section stats">
          <ul>
            <li>
            </li>
        </ul>
          <ul>
            <li>
              <a href="" id="karmalink">
                <strong><span id="hoverkarma"></span></strong>
                <small>Karma</small>
              </a>
            </li>
            <li>
              <a href="" id="answerslink">
                <strong><span id="hoveranswers"></span></strong>
                <small>Answers</small>
              </a>
            </li>
            <li>
              <a href="" id="questionslink">
                <strong><span id="hoverquestions"></span></strong>
                <small>Questions</small>
              </a>
            </li>
          </ul>
        </div><!--/stats-->
</div>
        <script>
            var tinyMCEPreInit = {
                base: '/m/atlassian/media/js/tinymce/jscripts/tiny_mce',
                suffix: ''
            };
        </script>
        
            <script type="text/javascript" src="/m/atlassian/media/min/editor.min.js?c9e7e434"></script>
        
    <script type="text/javascript">if(!NREUMQ.f){NREUMQ.f=function(){NREUMQ.push(["load",new Date().getTime()]);var e=document.createElement("script");e.type="text/javascript";e.src=(("http:"===document.location.protocol)?"http:":"https:")+"//"+"js-agent.newrelic.com/nr-100.js";document.body.appendChild(e);if(NREUMQ.a)NREUMQ.a();};NREUMQ.a=window.onload;window.onload=NREUMQ.f;};NREUMQ.push(["nrfj","beacon-1.newrelic.com","4558326637","1637994","MlRaZhBTVhcAAhAPWQsefkcMUUwNDg9LAFkXRFUcFFtdExJPFgNXAVRKQVhDTQESFQ0JWA==",0,606,new Date().getTime(),"","","","",""]);</script></body>
</html>
