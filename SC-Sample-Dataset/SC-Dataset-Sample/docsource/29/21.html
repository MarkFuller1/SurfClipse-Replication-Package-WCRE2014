<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//JP" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta name="description" content="rfc2822 javascript regex - page 6,The biggest code snippet collection" />
<title>rfc2822 javascript regex - Page 6 - Code Snippets Collection</title>

<meta http-equiv="Content-type" content="text/html; charset=UTF-8">
<meta name="keywords" content="snippets, code, programming, repository, share, source code">
<meta name="google-site-verification" content="xBbTvOgnOFB3sTMLEgyrRaPqwtdCmuUFpy7OJeUzEWM" />
<meta name="google-site-verification" content="CBIpDKCVstEwxcRrj_3HlbRWjxgUfx8f21aNnW-Poio" />
<link href="/static/css/style.css" rel="stylesheet" type="text/css">
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') +
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>
<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/5749136/top_banner', [728, 90], 'div-gpt-ad-1320055570202-0').addService(googletag.pubads());
googletag.pubads().enableSingleRequest();
googletag.enableServices();
});
</script>
</head>
<body>
<div id="pageslide-body-wrap">
<div id="all">
<div id="header">
<script>utmx_section("Headline")</script>
<h2><a href="/">Code Snippets Collection</a></h2>
</noscript>
</div>
<div id="menu">
<div id="menu_content">
<table>
<tbody><tr>
<td><a href="/" class="menu_icon_add">Home</a></td>
<td><a href="/language" class="menu_language_like">Languages</a></td>
<td><a class="menu_icon_star" href="/popular">Popular Snippets</a></td>
<td><a class="menu_icon_recent" href="/recent">Recent Search</a></td>
<td><a class="menu_icon_recent_comment" href="/comment">Recent Comment</a></td>
<td><a class="menu_icon_exploits" href="http://exploitsdownload.com">Exploits Code</a></td>
<td>
<form action="/search" id="cse-search-box" method="GET">
<input type="text" name="q" size="20" value="rfc2822 javascript regex">
<input type="submit" value="Search">
</form>
</td>
<td><g:plusone size="medium"></g:plusone></td>
</tr>
</tbody></table>
</div>
</div>
<div id="content" class="content">
<!-- top_banner -->
<script type="text/javascript"><!--
google_ad_client = "ca-pub-3617567196023504";
/* banner_728x90 */
google_ad_slot = "1174077166";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

<div id="code_search_results">
<div class="header">
<div class="title">Search result for 'rfc2822 javascript regex'</div>
<div class="info">(0.238789081573 seconds)</div>
</div>
<div id="mysnippets_pages">
6 pages :

<span class="paginate-first"><a href="/search/rfc2822 javascript regex/1">Â« First</a></span>
<span class="paginate-previous"><a href="/search/rfc2822 javascript regex/5">â€¹ Prev</a></span>



<span class="paginate-link"><a href="/search/rfc2822 javascript regex/1">1</a></span>



<span class="paginate-link"><a href="/search/rfc2822 javascript regex/2">2</a></span>



<span class="paginate-link"><a href="/search/rfc2822 javascript regex/3">3</a></span>



<span class="paginate-link"><a href="/search/rfc2822 javascript regex/4">4</a></span>



<span class="paginate-link"><a href="/search/rfc2822 javascript regex/5">5</a></span>



<span class="paginate-current">6</span>



</div>

<div class="result">
<h2 class="title">
<a href="/user/kendsnyder">kendsnyder</a>/<a href="/snippet/php/convert-html-to-text">Convert HTML to Text</a>
<span class="language">(<a href="/language/php/"> PHP</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: php;">
&lt;?php
// strip javascript, styles, html tags, normalize entities and spaces
// based on http://www.php.net/manual/en/function.strip-tags.php#68757
function html2text($html){
	$text = $html;
	static $search = array(
		'@&lt;script.+?&lt;/script&gt;@usi',  // Strip out javascript content
		'@&lt;style.+?&lt;/style&gt;@usi',    // Strip style content
		'@&lt;!--.+?--&gt;@us',            // Strip multi-line comments including CDATA
		'@&lt;/?[a-z].*?\&gt;@usi',         // Strip out HTML tags
	);
	$text = preg_replace($search, ' ', $text);
	// normalize common entities
	$text = normalizeEntities($text);
	// decode other entities
	$text = html_entity_decode($text, ENT_QUOTES, 'utf-8');
	// normalize possibly repeated newlines, tabs, spaces to spaces
	$text = preg_replace('/\s+/u', ' ', $text);
	$text = trim($text);
	// we must still run htmlentities on anything that comes out!
	// for instance:
	// &lt;&lt;a&gt;script&gt;alert('XSS')//&lt;&lt;a&gt;/script&gt;
	// will become
	// &lt;script&gt;alert('XSS')//&lt;/script&gt;
	return $text;
} 

// replace encoded and double encoded entities to equivalent unicode character
// also see /app/bookmarkletPopup.js
function normalizeEntities($text) {
	static $find = array();
	static $repl = array();
	if (!count($find)) {
		// build $find and $replace from map one time
		$map = array(
			array('\'', 'apos', 39, 'x27'), // Apostrophe
			array('\'', 'â€˜', 'lsquo', 8216, 'x2018'), // Open single quote
			array('\'', 'â€™', 'rsquo', 8217, 'x2019'), // Close single quote
			array('&quot;', 'â€œ', 'ldquo', 8220, 'x201C'), // Open double quotes
			array('&quot;', 'â€?', 'rdquo', 8221, 'x201D'), // Close double quotes
			array('\'', 'â€š', 'sbquo', 8218, 'x201A'), // Single low-9 quote
			array('&quot;', 'â€ž', 'bdquo', 8222, 'x201E'), // Double low-9 quote
			array('\'', 'â€²', 'prime', 8242, 'x2032'), // Prime/minutes/feet
			array('&quot;', 'â€³', 'Prime', 8243, 'x2033'), // Double prime/seconds/inches
			array(' ', 'nbsp', 160, 'xA0'), // Non-breaking space
			array('-', 'â€?', 8208, 'x2010'), // Hyphen
			array('-', 'â€“', 'ndash', 8211, 150, 'x2013'), // En dash
			array('--', 'â€”', 'mdash', 8212, 151, 'x2014'), // Em dash
			array(' ', 'â€‚', 'ensp', 8194, 'x2002'), // En space
			array(' ', 'â€ƒ', 'emsp', 8195, 'x2003'), // Em space
			array(' ', 'â€‰', 'thinsp', 8201, 'x2009'), // Thin space
			array('*', 'â€¢', 'bull', 8226, 'x2022'), // Bullet
			array('*', 'â€£', 8227, 'x2023'), // Triangular bullet
			array('...', 'â€¦', 'hellip', 8230, 'x2026'), // Horizontal ellipsis
			array('Â°', 'deg', 176, 'xB0'), // Degree
			array('â‚¬', 'euro', 8364, 'x20AC'), // Euro
			array('Â¥', 'yen', 165, 'xA5'), // Yen
			array('Â£', 'pound', 163, 'xA3'), // British Pound
			array('Â©', 'copy', 169, 'xA9'), // Copyright Sign
			array('Â®', 'reg', 174, 'xAE'), // Registered Sign
			array('â„¢', 'trade', 8482, 'x2122') // TM Sign
		);
		foreach ($map as $e) {
			for ($i = 1; $i &lt; count($e); ++$i) {
				$code = $e[$i];
				if (is_int($code)) {
					// numeric entity
					$regex = &quot;/&amp;amp;(amp;)?#0*$code;/&quot;;
				}
				elseif (preg_match('/^.$/u', $code)/* one unicode char*/) {
					// single character
					$regex = &quot;/$code/u&quot;;
				}
				elseif (preg_match('/^x([0-9A-F]{2}){1,2}$/i', $code)) {
					// hex entity
					$regex = &quot;/&amp;amp;(amp;)?#x0*&quot; . substr($code, 1) . &quot;;/i&quot;;
				}
				else {
					// named entity
					$regex = &quot;/&amp;amp;(amp;)?$code;/&quot;;
				}
				$find[] = $regex;
				$repl[] = $e[0];
			}
		}
	} // end first time build
	return preg_replace($find, $repl, $text);	
}
</pre>
</div>
<br>

</div>

<div class="result">
<h2 class="title">
<a href="/user/Meander365">Meander365</a>/<a href="/snippet/jquery/jquery-create-a-custom-filter-that-finds-elements-with-data">jQuery Create a Custom Filter That Finds Elements With Data</a>
<span class="language">(<a href="/language/jquery/"> jQuery</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: javascript;">
&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;../assets/js/jquery.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
	
$(function() {

	jQuery.expr[':'].data = function(elem, index, m) {
		// Remove &quot;:data(&quot; and the trailing &quot;)&quot; from the match, as these parts aren't needed:
		m[0] = m[0].replace(/:data\(|\)$/g, '');
		var regex = new RegExp('([\'&quot;]?)((?:\\\\\\1|.)+?)\\1(,|$)', 'g'),
		// Retrieve data key:
		key = regex.exec( m[0] )[2],
		// Retrieve data value to test against:
		val = regex.exec( m[0] );
		if (val) {
			val = val[2];
		}
		// If a value was passed then we test for it, otherwise we test that the value evaluates to true:
		return val ? jQuery(elem).data(key) == val : !!jQuery(elem).data(key);
		};
	

	$(&quot;#aa&quot;).data(&quot;id&quot;,123);
	$(&quot;#ab&quot;).data(&quot;id&quot;,245);
	$(&quot;#ac&quot;).data(&quot;id&quot;,678);	
	
	//find all that have id
		$(&quot;p:data('id')&quot;).css(&quot;color&quot;,&quot;blue&quot;);
	//find all that have an id of 123
		$(&quot;p:data('id',123)&quot;).css(&quot;color&quot;,&quot;red&quot;);
	
	});

&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;div id=&quot;wrapper&quot;&gt;
		&lt;em&gt;Example!&lt;/em&gt;			
		&lt;p id=&quot;aa&quot;&gt;sdf sadf dsf fds&lt;/p&gt;
		&lt;p id=&quot;ab&quot;&gt;sdf sadf dsf fds&lt;/p&gt;
		&lt;p id=&quot;ac&quot;&gt;sdf sadf dsf fds&lt;/p&gt;
		&lt;p id=&quot;ad&quot;&gt;sdf sadf dsf fds&lt;/p&gt;
	&lt;/div&gt;		
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
<br>
<p>This is dead handy. The purpose of the custom filter is to select all elements which have data attached. You can even find specific data.</p>

</div>

<div class="result">
<h2 class="title">
<a href="/user/rweng">rweng</a>/<a href="/snippet/bash/git-bash-completion">git bash completion</a>
<span class="language">(<a href="/language/bash/"> Bash</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: bash;">
#
# bash completion support for core Git.
#
# Copyright (C) 2006,2007 Shawn O. Pearce &lt;spearce@spearce.org&gt;
# Conceptually based on gitcompletion (http://gitweb.hawaga.org.uk/).
# Distributed under the GNU General Public License, version 2.0.
#
# The contained completion routines provide support for completing:
#
#    *) local and remote branch names
#    *) local and remote tag names
#    *) .git/remotes file names
#    *) git 'subcommands'
#    *) tree paths within 'ref:path/to/file' expressions
#    *) common --long-options
#
# To use these routines:
#
#    1) Copy this file to somewhere (e.g. ~/.git-completion.sh).
#    2) Added the following line to your .bashrc:
#        source ~/.git-completion.sh
#
#    3) You may want to make sure the git executable is available
#       in your PATH before this script is sourced, as some caching
#       is performed while the script loads.  If git isn't found
#       at source time then all lookups will be done on demand,
#       which may be slightly slower.
#
#    4) Consider changing your PS1 to also show the current branch:
#        PS1='[\u@\h \W$(__git_ps1 &quot; (%s)&quot;)]\$ '
#
#       The argument to __git_ps1 will be displayed only if you
#       are currently in a git repository.  The %s token will be
#       the name of the current branch.
#
# To submit patches:
#
#    *) Read Documentation/SubmittingPatches
#    *) Send all patches to the current maintainer:
#
#       &quot;Shawn O. Pearce&quot; &lt;spearce@spearce.org&gt;
#
#    *) Always CC the Git mailing list:
#
#       git@vger.kernel.org
#

__gitdir ()
{
	if [ -z &quot;$1&quot; ]; then
		if [ -n &quot;$__git_dir&quot; ]; then
			echo &quot;$__git_dir&quot;
		elif [ -d .git ]; then
			echo .git
		else
			git rev-parse --git-dir 2&gt;/dev/null
		fi
	elif [ -d &quot;$1/.git&quot; ]; then
		echo &quot;$1/.git&quot;
	else
		echo &quot;$1&quot;
	fi
}

__git_ps1 ()
{
	local b=&quot;$(git symbolic-ref HEAD 2&gt;/dev/null)&quot;
	if [ -n &quot;$b&quot; ]; then
		if [ -n &quot;$1&quot; ]; then
			printf &quot;$1&quot; &quot;${b##refs/heads/}&quot;
		else
			printf &quot; (%s)&quot; &quot;${b##refs/heads/}&quot;
		fi
	fi
}

__gitcomp ()
{
	local all c s=$'\n' IFS=' '$'\t'$'\n'
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	if [ $# -gt 2 ]; then
		cur=&quot;$3&quot;
	fi
	for c in $1; do
		case &quot;$c$4&quot; in
		--*=*) all=&quot;$all$c$4$s&quot; ;;
		*.)    all=&quot;$all$c$4$s&quot; ;;
		*)     all=&quot;$all$c$4 $s&quot; ;;
		esac
	done
	IFS=$s
	COMPREPLY=($(compgen -P &quot;$2&quot; -W &quot;$all&quot; -- &quot;$cur&quot;))
	return
}

__git_heads ()
{
	local cmd i is_hash=y dir=&quot;$(__gitdir &quot;$1&quot;)&quot;
	if [ -d &quot;$dir&quot; ]; then
		for i in $(git --git-dir=&quot;$dir&quot; \
			for-each-ref --format='%(refname)' \
			refs/heads ); do
			echo &quot;${i#refs/heads/}&quot;
		done
		return
	fi
	for i in $(git-ls-remote &quot;$1&quot; 2&gt;/dev/null); do
		case &quot;$is_hash,$i&quot; in
		y,*) is_hash=n ;;
		n,*^{}) is_hash=y ;;
		n,refs/heads/*) is_hash=y; echo &quot;${i#refs/heads/}&quot; ;;
		n,*) is_hash=y; echo &quot;$i&quot; ;;
		esac
	done
}

__git_tags ()
{
	local cmd i is_hash=y dir=&quot;$(__gitdir &quot;$1&quot;)&quot;
	if [ -d &quot;$dir&quot; ]; then
		for i in $(git --git-dir=&quot;$dir&quot; \
			for-each-ref --format='%(refname)' \
			refs/tags ); do
			echo &quot;${i#refs/tags/}&quot;
		done
		return
	fi
	for i in $(git-ls-remote &quot;$1&quot; 2&gt;/dev/null); do
		case &quot;$is_hash,$i&quot; in
		y,*) is_hash=n ;;
		n,*^{}) is_hash=y ;;
		n,refs/tags/*) is_hash=y; echo &quot;${i#refs/tags/}&quot; ;;
		n,*) is_hash=y; echo &quot;$i&quot; ;;
		esac
	done
}

__git_refs ()
{
	local cmd i is_hash=y dir=&quot;$(__gitdir &quot;$1&quot;)&quot;
	if [ -d &quot;$dir&quot; ]; then
		if [ -e &quot;$dir/HEAD&quot; ]; then echo HEAD; fi
		for i in $(git --git-dir=&quot;$dir&quot; \
			for-each-ref --format='%(refname)' \
			refs/tags refs/heads refs/remotes); do
			case &quot;$i&quot; in
				refs/tags/*)    echo &quot;${i#refs/tags/}&quot; ;;
				refs/heads/*)   echo &quot;${i#refs/heads/}&quot; ;;
				refs/remotes/*) echo &quot;${i#refs/remotes/}&quot; ;;
				*)              echo &quot;$i&quot; ;;
			esac
		done
		return
	fi
	for i in $(git-ls-remote &quot;$dir&quot; 2&gt;/dev/null); do
		case &quot;$is_hash,$i&quot; in
		y,*) is_hash=n ;;
		n,*^{}) is_hash=y ;;
		n,refs/tags/*) is_hash=y; echo &quot;${i#refs/tags/}&quot; ;;
		n,refs/heads/*) is_hash=y; echo &quot;${i#refs/heads/}&quot; ;;
		n,refs/remotes/*) is_hash=y; echo &quot;${i#refs/remotes/}&quot; ;;
		n,*) is_hash=y; echo &quot;$i&quot; ;;
		esac
	done
}

__git_refs2 ()
{
	local i
	for i in $(__git_refs &quot;$1&quot;); do
		echo &quot;$i:$i&quot;
	done
}

__git_refs_remotes ()
{
	local cmd i is_hash=y
	for i in $(git-ls-remote &quot;$1&quot; 2&gt;/dev/null); do
		case &quot;$is_hash,$i&quot; in
		n,refs/heads/*)
			is_hash=y
			echo &quot;$i:refs/remotes/$1/${i#refs/heads/}&quot;
			;;
		y,*) is_hash=n ;;
		n,*^{}) is_hash=y ;;
		n,refs/tags/*) is_hash=y;;
		n,*) is_hash=y; ;;
		esac
	done
}

__git_remotes ()
{
	local i ngoff IFS=$'\n' d=&quot;$(__gitdir)&quot;
	shopt -q nullglob || ngoff=1
	shopt -s nullglob
	for i in &quot;$d/remotes&quot;/*; do
		echo ${i#$d/remotes/}
	done
	[ &quot;$ngoff&quot; ] &amp;amp;&amp;amp; shopt -u nullglob
	for i in $(git --git-dir=&quot;$d&quot; config --list); do
		case &quot;$i&quot; in
		remote.*.url=*)
			i=&quot;${i#remote.}&quot;
			echo &quot;${i/.url=*/}&quot;
			;;
		esac
	done
}

__git_merge_strategies ()
{
	if [ -n &quot;$__git_merge_strategylist&quot; ]; then
		echo &quot;$__git_merge_strategylist&quot;
		return
	fi
	sed -n &quot;/^all_strategies='/{
		s/^all_strategies='//
		s/'//
		p
		q
		}&quot; &quot;$(git --exec-path)/git-merge&quot;
}
__git_merge_strategylist=
__git_merge_strategylist=&quot;$(__git_merge_strategies 2&gt;/dev/null)&quot;

__git_complete_file ()
{
	local pfx ls ref cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	?*:*)
		ref=&quot;${cur%%:*}&quot;
		cur=&quot;${cur#*:}&quot;
		case &quot;$cur&quot; in
		?*/*)
			pfx=&quot;${cur%/*}&quot;
			cur=&quot;${cur##*/}&quot;
			ls=&quot;$ref:$pfx&quot;
			pfx=&quot;$pfx/&quot;
			;;
		*)
			ls=&quot;$ref&quot;
			;;
	    esac
		COMPREPLY=($(compgen -P &quot;$pfx&quot; \
			-W &quot;$(git --git-dir=&quot;$(__gitdir)&quot; ls-tree &quot;$ls&quot; \
				| sed '/^100... blob /s,^.*	,,
				       /^040000 tree /{
				           s,^.*	,,
				           s,$,/,
				       }
				       s/^.*	//')&quot; \
			-- &quot;$cur&quot;))
		;;
	*)
		__gitcomp &quot;$(__git_refs)&quot;
		;;
	esac
}

__git_complete_revlist ()
{
	local pfx cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	*...*)
		pfx=&quot;${cur%...*}...&quot;
		cur=&quot;${cur#*...}&quot;
		__gitcomp &quot;$(__git_refs)&quot; &quot;$pfx&quot; &quot;$cur&quot;
		;;
	*..*)
		pfx=&quot;${cur%..*}..&quot;
		cur=&quot;${cur#*..}&quot;
		__gitcomp &quot;$(__git_refs)&quot; &quot;$pfx&quot; &quot;$cur&quot;
		;;
	*.)
		__gitcomp &quot;$cur.&quot;
		;;
	*)
		__gitcomp &quot;$(__git_refs)&quot;
		;;
	esac
}

__git_commands ()
{
	if [ -n &quot;$__git_commandlist&quot; ]; then
		echo &quot;$__git_commandlist&quot;
		return
	fi
	local i IFS=&quot; &quot;$'\n'
	for i in $(git help -a|egrep '^ ')
	do
		case $i in
		*--*)             : helper pattern;;
		applymbox)        : ask gittus;;
		applypatch)       : ask gittus;;
		archimport)       : import;;
		cat-file)         : plumbing;;
		check-attr)       : plumbing;;
		check-ref-format) : plumbing;;
		commit-tree)      : plumbing;;
		cvsexportcommit)  : export;;
		cvsimport)        : import;;
		cvsserver)        : daemon;;
		daemon)           : daemon;;
		diff-files)       : plumbing;;
		diff-index)       : plumbing;;
		diff-tree)        : plumbing;;
		fast-import)      : import;;
		fsck-objects)     : plumbing;;
		fetch-pack)       : plumbing;;
		fmt-merge-msg)    : plumbing;;
		for-each-ref)     : plumbing;;
		hash-object)      : plumbing;;
		http-*)           : transport;;
		index-pack)       : plumbing;;
		init-db)          : deprecated;;
		local-fetch)      : plumbing;;
		mailinfo)         : plumbing;;
		mailsplit)        : plumbing;;
		merge-*)          : plumbing;;
		mktree)           : plumbing;;
		mktag)            : plumbing;;
		pack-objects)     : plumbing;;
		pack-redundant)   : plumbing;;
		pack-refs)        : plumbing;;
		parse-remote)     : plumbing;;
		patch-id)         : plumbing;;
		peek-remote)      : plumbing;;
		prune)            : plumbing;;
		prune-packed)     : plumbing;;
		quiltimport)      : import;;
		read-tree)        : plumbing;;
		receive-pack)     : plumbing;;
		reflog)           : plumbing;;
		repo-config)      : deprecated;;
		rerere)           : plumbing;;
		rev-list)         : plumbing;;
		rev-parse)        : plumbing;;
		runstatus)        : plumbing;;
		sh-setup)         : internal;;
		shell)            : daemon;;
		send-pack)        : plumbing;;
		show-index)       : plumbing;;
		ssh-*)            : transport;;
		stripspace)       : plumbing;;
		svn)              : import export;;
		symbolic-ref)     : plumbing;;
		tar-tree)         : deprecated;;
		unpack-file)      : plumbing;;
		unpack-objects)   : plumbing;;
		update-index)     : plumbing;;
		update-ref)       : plumbing;;
		update-server-info) : daemon;;
		upload-archive)   : plumbing;;
		upload-pack)      : plumbing;;
		write-tree)       : plumbing;;
		verify-tag)       : plumbing;;
		*) echo $i;;
		esac
	done
}
__git_commandlist=
__git_commandlist=&quot;$(__git_commands 2&gt;/dev/null)&quot;

__git_aliases ()
{
	local i IFS=$'\n'
	for i in $(git --git-dir=&quot;$(__gitdir)&quot; config --list); do
		case &quot;$i&quot; in
		alias.*)
			i=&quot;${i#alias.}&quot;
			echo &quot;${i/=*/}&quot;
			;;
		esac
	done
}

__git_aliased_command ()
{
	local word cmdline=$(git --git-dir=&quot;$(__gitdir)&quot; \
		config --get &quot;alias.$1&quot;)
	for word in $cmdline; do
		if [ &quot;${word##-*}&quot; ]; then
			echo $word
			return
		fi
	done
}

__git_whitespacelist=&quot;nowarn warn error error-all strip&quot;

_git_am ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	if [ -d .dotest ]; then
		__gitcomp &quot;--skip --resolved&quot;
		return
	fi
	case &quot;$cur&quot; in
	--whitespace=*)
		__gitcomp &quot;$__git_whitespacelist&quot; &quot;&quot; &quot;${cur##--whitespace=}&quot;
		return
		;;
	--*)
		__gitcomp &quot;
			--signoff --utf8 --binary --3way --interactive
			--whitespace=
			&quot;
		return
	esac
	COMPREPLY=()
}

_git_apply ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--whitespace=*)
		__gitcomp &quot;$__git_whitespacelist&quot; &quot;&quot; &quot;${cur##--whitespace=}&quot;
		return
		;;
	--*)
		__gitcomp &quot;
			--stat --numstat --summary --check --index
			--cached --index-info --reverse --reject --unidiff-zero
			--apply --no-add --exclude=
			--whitespace= --inaccurate-eof --verbose
			&quot;
		return
	esac
	COMPREPLY=()
}

_git_add ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;--interactive --refresh&quot;
		return
	esac
	COMPREPLY=()
}

_git_bisect ()
{
	local i c=1 command
	while [ $c -lt $COMP_CWORD ]; do
		i=&quot;${COMP_WORDS[c]}&quot;
		case &quot;$i&quot; in
		start|bad|good|reset|visualize|replay|log)
			command=&quot;$i&quot;
			break
			;;
		esac
		c=$((++c))
	done

	if [ $c -eq $COMP_CWORD -a -z &quot;$command&quot; ]; then
		__gitcomp &quot;start bad good reset visualize replay log&quot;
		return
	fi

	case &quot;$command&quot; in
	bad|good|reset)
		__gitcomp &quot;$(__git_refs)&quot;
		;;
	*)
		COMPREPLY=()
		;;
	esac
}

_git_branch ()
{
	__gitcomp &quot;$(__git_refs)&quot;
}

_git_bundle ()
{
	local mycword=&quot;$COMP_CWORD&quot;
	case &quot;${COMP_WORDS[0]}&quot; in
	git)
		local cmd=&quot;${COMP_WORDS[2]}&quot;
		mycword=&quot;$((mycword-1))&quot;
		;;
	git-bundle*)
		local cmd=&quot;${COMP_WORDS[1]}&quot;
		;;
	esac
	case &quot;$mycword&quot; in
	1)
		__gitcomp &quot;create list-heads verify unbundle&quot;
		;;
	2)
		# looking for a file
		;;
	*)
		case &quot;$cmd&quot; in
			create)
				__git_complete_revlist
			;;
		esac
		;;
	esac
}

_git_checkout ()
{
	__gitcomp &quot;$(__git_refs)&quot;
}

_git_cherry ()
{
	__gitcomp &quot;$(__git_refs)&quot;
}

_git_cherry_pick ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;--edit --no-commit&quot;
		;;
	*)
		__gitcomp &quot;$(__git_refs)&quot;
		;;
	esac
}

_git_commit ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;
			--all --author= --signoff --verify --no-verify
			--edit --amend --include --only
			&quot;
		return
	esac
	COMPREPLY=()
}

_git_describe ()
{
	__gitcomp &quot;$(__git_refs)&quot;
}

_git_diff ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;--cached --stat --numstat --shortstat --summary
			--patch-with-stat --name-only --name-status --color
			--no-color --color-words --no-renames --check
			--full-index --binary --abbrev --diff-filter
			--find-copies-harder --pickaxe-all --pickaxe-regex
			--text --ignore-space-at-eol --ignore-space-change
			--ignore-all-space --exit-code --quiet --ext-diff
			--no-ext-diff&quot;
		return
		;;
	esac
	__git_complete_file
}

_git_diff_tree ()
{
	__gitcomp &quot;$(__git_refs)&quot;
}

_git_fetch ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;

	case &quot;${COMP_WORDS[0]},$COMP_CWORD&quot; in
	git-fetch*,1)
		__gitcomp &quot;$(__git_remotes)&quot;
		;;
	git,2)
		__gitcomp &quot;$(__git_remotes)&quot;
		;;
	*)
		case &quot;$cur&quot; in
		*:*)
			__gitcomp &quot;$(__git_refs)&quot; &quot;&quot; &quot;${cur#*:}&quot;
			;;
		*)
			local remote
			case &quot;${COMP_WORDS[0]}&quot; in
			git-fetch) remote=&quot;${COMP_WORDS[1]}&quot; ;;
			git)       remote=&quot;${COMP_WORDS[2]}&quot; ;;
			esac
			__gitcomp &quot;$(__git_refs2 &quot;$remote&quot;)&quot;
			;;
		esac
		;;
	esac
}

_git_format_patch ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;
			--stdout --attach --thread
			--output-directory
			--numbered --start-number
			--numbered-files
			--keep-subject
			--signoff
			--in-reply-to=
			--full-index --binary
			--not --all
			&quot;
		return
		;;
	esac
	__git_complete_revlist
}

_git_gc ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;--prune --aggressive&quot;
		return
		;;
	esac
	COMPREPLY=()
}

_git_ls_remote ()
{
	__gitcomp &quot;$(__git_remotes)&quot;
}

_git_ls_tree ()
{
	__git_complete_file
}

_git_log ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--pretty=*)
		__gitcomp &quot;
			oneline short medium full fuller email raw
			&quot; &quot;&quot; &quot;${cur##--pretty=}&quot;
		return
		;;
	--date=*)
		__gitcomp &quot;
			relative iso8601 rfc2822 short local default
		&quot; &quot;&quot; &quot;${cur##--date=}&quot;
		return
		;;
	--*)
		__gitcomp &quot;
			--max-count= --max-age= --since= --after=
			--min-age= --before= --until=
			--root --topo-order --date-order --reverse
			--no-merges --follow
			--abbrev-commit --abbrev=
			--relative-date --date=
			--author= --committer= --grep=
			--all-match
			--pretty= --name-status --name-only --raw
			--not --all
			--left-right --cherry-pick
			&quot;
		return
		;;
	esac
	__git_complete_revlist
}

_git_merge ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;${COMP_WORDS[COMP_CWORD-1]}&quot; in
	-s|--strategy)
		__gitcomp &quot;$(__git_merge_strategies)&quot;
		return
	esac
	case &quot;$cur&quot; in
	--strategy=*)
		__gitcomp &quot;$(__git_merge_strategies)&quot; &quot;&quot; &quot;${cur##--strategy=}&quot;
		return
		;;
	--*)
		__gitcomp &quot;
			--no-commit --no-summary --squash --strategy
			&quot;
		return
	esac
	__gitcomp &quot;$(__git_refs)&quot;
}

_git_merge_base ()
{
	__gitcomp &quot;$(__git_refs)&quot;
}

_git_name_rev ()
{
	__gitcomp &quot;--tags --all --stdin&quot;
}

_git_pull ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;

	case &quot;${COMP_WORDS[0]},$COMP_CWORD&quot; in
	git-pull*,1)
		__gitcomp &quot;$(__git_remotes)&quot;
		;;
	git,2)
		__gitcomp &quot;$(__git_remotes)&quot;
		;;
	*)
		local remote
		case &quot;${COMP_WORDS[0]}&quot; in
		git-pull)  remote=&quot;${COMP_WORDS[1]}&quot; ;;
		git)       remote=&quot;${COMP_WORDS[2]}&quot; ;;
		esac
		__gitcomp &quot;$(__git_refs &quot;$remote&quot;)&quot;
		;;
	esac
}

_git_push ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;

	case &quot;${COMP_WORDS[0]},$COMP_CWORD&quot; in
	git-push*,1)
		__gitcomp &quot;$(__git_remotes)&quot;
		;;
	git,2)
		__gitcomp &quot;$(__git_remotes)&quot;
		;;
	*)
		case &quot;$cur&quot; in
		*:*)
			local remote
			case &quot;${COMP_WORDS[0]}&quot; in
			git-push)  remote=&quot;${COMP_WORDS[1]}&quot; ;;
			git)       remote=&quot;${COMP_WORDS[2]}&quot; ;;
			esac
			__gitcomp &quot;$(__git_refs &quot;$remote&quot;)&quot; &quot;&quot; &quot;${cur#*:}&quot;
			;;
		+*)
			__gitcomp &quot;$(__git_refs)&quot; + &quot;${cur#+}&quot;
			;;
		*)
			__gitcomp &quot;$(__git_refs)&quot;
			;;
		esac
		;;
	esac
}

_git_rebase ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	if [ -d .dotest ] || [ -d .git/.dotest-merge ]; then
		__gitcomp &quot;--continue --skip --abort&quot;
		return
	fi
	case &quot;${COMP_WORDS[COMP_CWORD-1]}&quot; in
	-s|--strategy)
		__gitcomp &quot;$(__git_merge_strategies)&quot;
		return
	esac
	case &quot;$cur&quot; in
	--strategy=*)
		__gitcomp &quot;$(__git_merge_strategies)&quot; &quot;&quot; &quot;${cur##--strategy=}&quot;
		return
		;;
	--*)
		__gitcomp &quot;--onto --merge --strategy&quot;
		return
	esac
	__gitcomp &quot;$(__git_refs)&quot;
}

_git_config ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	local prv=&quot;${COMP_WORDS[COMP_CWORD-1]}&quot;
	case &quot;$prv&quot; in
	branch.*.remote)
		__gitcomp &quot;$(__git_remotes)&quot;
		return
		;;
	branch.*.merge)
		__gitcomp &quot;$(__git_refs)&quot;
		return
		;;
	remote.*.fetch)
		local remote=&quot;${prv#remote.}&quot;
		remote=&quot;${remote%.fetch}&quot;
		__gitcomp &quot;$(__git_refs_remotes &quot;$remote&quot;)&quot;
		return
		;;
	remote.*.push)
		local remote=&quot;${prv#remote.}&quot;
		remote=&quot;${remote%.push}&quot;
		__gitcomp &quot;$(git --git-dir=&quot;$(__gitdir)&quot; \
			for-each-ref --format='%(refname):%(refname)' \
			refs/heads)&quot;
		return
		;;
	pull.twohead|pull.octopus)
		__gitcomp &quot;$(__git_merge_strategies)&quot;
		return
		;;
	color.branch|color.diff|color.status)
		__gitcomp &quot;always never auto&quot;
		return
		;;
	color.*.*)
		__gitcomp &quot;
			black red green yellow blue magenta cyan white
			bold dim ul blink reverse
			&quot;
		return
		;;
	*.*)
		COMPREPLY=()
		return
		;;
	esac
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;
			--global --system --file=
			--list --replace-all
			--get --get-all --get-regexp
			--add --unset --unset-all
			--remove-section --rename-section
			&quot;
		return
		;;
	branch.*.*)
		local pfx=&quot;${cur%.*}.&quot;
		cur=&quot;${cur##*.}&quot;
		__gitcomp &quot;remote merge&quot; &quot;$pfx&quot; &quot;$cur&quot;
		return
		;;
	branch.*)
		local pfx=&quot;${cur%.*}.&quot;
		cur=&quot;${cur#*.}&quot;
		__gitcomp &quot;$(__git_heads)&quot; &quot;$pfx&quot; &quot;$cur&quot; &quot;.&quot;
		return
		;;
	remote.*.*)
		local pfx=&quot;${cur%.*}.&quot;
		cur=&quot;${cur##*.}&quot;
		__gitcomp &quot;
			url fetch push skipDefaultUpdate
			receivepack uploadpack tagopt
			&quot; &quot;$pfx&quot; &quot;$cur&quot;
		return
		;;
	remote.*)
		local pfx=&quot;${cur%.*}.&quot;
		cur=&quot;${cur#*.}&quot;
		__gitcomp &quot;$(__git_remotes)&quot; &quot;$pfx&quot; &quot;$cur&quot; &quot;.&quot;
		return
		;;
	esac
	__gitcomp &quot;
		apply.whitespace
		core.fileMode
		core.gitProxy
		core.ignoreStat
		core.preferSymlinkRefs
		core.logAllRefUpdates
		core.loosecompression
		core.repositoryFormatVersion
		core.sharedRepository
		core.warnAmbiguousRefs
		core.compression
		core.legacyHeaders
		core.packedGitWindowSize
		core.packedGitLimit
		clean.requireForce
		color.branch
		color.branch.current
		color.branch.local
		color.branch.remote
		color.branch.plain
		color.diff
		color.diff.plain
		color.diff.meta
		color.diff.frag
		color.diff.old
		color.diff.new
		color.diff.commit
		color.diff.whitespace
		color.pager
		color.status
		color.status.header
		color.status.added
		color.status.changed
		color.status.untracked
		diff.renameLimit
		diff.renames
		fetch.unpackLimit
		format.headers
		format.subjectprefix
		gitcvs.enabled
		gitcvs.logfile
		gitcvs.allbinary
		gitcvs.dbname gitcvs.dbdriver gitcvs.dbuser gitcvs.dvpass
		gc.packrefs
		gc.reflogexpire
		gc.reflogexpireunreachable
		gc.rerereresolved
		gc.rerereunresolved
		http.sslVerify
		http.sslCert
		http.sslKey
		http.sslCAInfo
		http.sslCAPath
		http.maxRequests
		http.lowSpeedLimit
		http.lowSpeedTime
		http.noEPSV
		i18n.commitEncoding
		i18n.logOutputEncoding
		log.showroot
		merge.tool
		merge.summary
		merge.verbosity
		pack.window
		pack.depth
		pack.windowMemory
		pack.compression
		pack.deltaCacheSize
		pack.deltaCacheLimit
		pull.octopus
		pull.twohead
		repack.useDeltaBaseOffset
		show.difftree
		showbranch.default
		tar.umask
		transfer.unpackLimit
		receive.unpackLimit
		receive.denyNonFastForwards
		user.name
		user.email
		user.signingkey
		whatchanged.difftree
		branch. remote.
	&quot;
}

_git_remote ()
{
	local i c=1 command
	while [ $c -lt $COMP_CWORD ]; do
		i=&quot;${COMP_WORDS[c]}&quot;
		case &quot;$i&quot; in
		add|rm|show|prune|update) command=&quot;$i&quot;; break ;;
		esac
		c=$((++c))
	done

	if [ $c -eq $COMP_CWORD -a -z &quot;$command&quot; ]; then
		__gitcomp &quot;add rm show prune update&quot;
		return
	fi

	case &quot;$command&quot; in
	rm|show|prune)
		__gitcomp &quot;$(__git_remotes)&quot;
		;;
	update)
		local i c='' IFS=$'\n'
		for i in $(git --git-dir=&quot;$(__gitdir)&quot; config --list); do
			case &quot;$i&quot; in
			remotes.*)
				i=&quot;${i#remotes.}&quot;
				c=&quot;$c ${i/=*/}&quot;
				;;
			esac
		done
		__gitcomp &quot;$c&quot;
		;;
	*)
		COMPREPLY=()
		;;
	esac
}

_git_reset ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;--mixed --hard --soft&quot;
		return
		;;
	esac
	__gitcomp &quot;$(__git_refs)&quot;
}

_git_shortlog ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;
			--max-count= --max-age= --since= --after=
			--min-age= --before= --until=
			--no-merges
			--author= --committer= --grep=
			--all-match
			--not --all
			--numbered --summary
			&quot;
		return
		;;
	esac
	__git_complete_revlist
}

_git_show ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--pretty=*)
		__gitcomp &quot;
			oneline short medium full fuller email raw
			&quot; &quot;&quot; &quot;${cur##--pretty=}&quot;
		return
		;;
	--*)
		__gitcomp &quot;--pretty=&quot;
		return
		;;
	esac
	__git_complete_file
}

_git_stash ()
{
	__gitcomp 'list show apply clear'
}

_git_submodule ()
{
	local i c=1 command
	while [ $c -lt $COMP_CWORD ]; do
		i=&quot;${COMP_WORDS[c]}&quot;
		case &quot;$i&quot; in
		add|status|init|update) command=&quot;$i&quot;; break ;;
		esac
		c=$((++c))
	done

	if [ $c -eq $COMP_CWORD -a -z &quot;$command&quot; ]; then
		local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
		case &quot;$cur&quot; in
		--*)
			__gitcomp &quot;--quiet --cached&quot;
			;;
		*)
			__gitcomp &quot;add status init update&quot;
			;;
		esac
		return
	fi
}

_git_tag ()
{
	local i c=1 f=0
	while [ $c -lt $COMP_CWORD ]; do
		i=&quot;${COMP_WORDS[c]}&quot;
		case &quot;$i&quot; in
		-d|-v)
			__gitcomp &quot;$(__git_tags)&quot;
			return
			;;
		-f)
			f=1
			;;
		esac
		c=$((++c))
	done

	case &quot;${COMP_WORDS[COMP_CWORD-1]}&quot; in
	-m|-F)
		COMPREPLY=()
		;;
	-*|tag|git-tag)
		if [ $f = 1 ]; then
			__gitcomp &quot;$(__git_tags)&quot;
		else
			COMPREPLY=()
		fi
		;;
	*)
		__gitcomp &quot;$(__git_refs)&quot;
		;;
	esac
}

_git ()
{
	local i c=1 command __git_dir

	while [ $c -lt $COMP_CWORD ]; do
		i=&quot;${COMP_WORDS[c]}&quot;
		case &quot;$i&quot; in
		--git-dir=*) __git_dir=&quot;${i#--git-dir=}&quot; ;;
		--bare)      __git_dir=&quot;.&quot; ;;
		--version|--help|-p|--paginate) ;;
		*) command=&quot;$i&quot;; break ;;
		esac
		c=$((++c))
	done

	if [ $c -eq $COMP_CWORD -a -z &quot;$command&quot; ]; then
		case &quot;${COMP_WORDS[COMP_CWORD]}&quot; in
		--*=*) COMPREPLY=() ;;
		--*)   __gitcomp &quot;
			--no-pager
			--git-dir=
			--bare
			--version
			--exec-path
			&quot;
			;;
		*)     __gitcomp &quot;$(__git_commands) $(__git_aliases)&quot; ;;
		esac
		return
	fi

	local expansion=$(__git_aliased_command &quot;$command&quot;)
	[ &quot;$expansion&quot; ] &amp;amp;&amp;amp; command=&quot;$expansion&quot;

	case &quot;$command&quot; in
	am)          _git_am ;;
	add)         _git_add ;;
	apply)       _git_apply ;;
	bisect)      _git_bisect ;;
	bundle)      _git_bundle ;;
	branch)      _git_branch ;;
	checkout)    _git_checkout ;;
	cherry)      _git_cherry ;;
	cherry-pick) _git_cherry_pick ;;
	commit)      _git_commit ;;
	config)      _git_config ;;
	describe)    _git_describe ;;
	diff)        _git_diff ;;
	fetch)       _git_fetch ;;
	format-patch) _git_format_patch ;;
	gc)          _git_gc ;;
	log)         _git_log ;;
	ls-remote)   _git_ls_remote ;;
	ls-tree)     _git_ls_tree ;;
	merge)       _git_merge;;
	merge-base)  _git_merge_base ;;
	name-rev)    _git_name_rev ;;
	pull)        _git_pull ;;
	push)        _git_push ;;
	rebase)      _git_rebase ;;
	remote)      _git_remote ;;
	reset)       _git_reset ;;
	shortlog)    _git_shortlog ;;
	show)        _git_show ;;
	show-branch) _git_log ;;
	stash)       _git_stash ;;
	submodule)   _git_submodule ;;
	tag)         _git_tag ;;
	whatchanged) _git_log ;;
	*)           COMPREPLY=() ;;
	esac
}

_gitk ()
{
	local cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
	case &quot;$cur&quot; in
	--*)
		__gitcomp &quot;--not --all&quot;
		return
		;;
	esac
	__git_complete_revlist
}

complete -o default -o nospace -F _git git
complete -o default -o nospace -F _gitk gitk
complete -o default -o nospace -F _git_am git-am
complete -o default -o nospace -F _git_apply git-apply
complete -o default -o nospace -F _git_bisect git-bisect
complete -o default -o nospace -F _git_branch git-branch
complete -o default -o nospace -F _git_bundle git-bundle
complete -o default -o nospace -F _git_checkout git-checkout
complete -o default -o nospace -F _git_cherry git-cherry
complete -o default -o nospace -F _git_cherry_pick git-cherry-pick
complete -o default -o nospace -F _git_commit git-commit
complete -o default -o nospace -F _git_describe git-describe
complete -o default -o nospace -F _git_diff git-diff
complete -o default -o nospace -F _git_fetch git-fetch
complete -o default -o nospace -F _git_format_patch git-format-patch
complete -o default -o nospace -F _git_gc git-gc
complete -o default -o nospace -F _git_log git-log
complete -o default -o nospace -F _git_ls_remote git-ls-remote
complete -o default -o nospace -F _git_ls_tree git-ls-tree
complete -o default -o nospace -F _git_merge git-merge
complete -o default -o nospace -F _git_merge_base git-merge-base
complete -o default -o nospace -F _git_name_rev git-name-rev
complete -o default -o nospace -F _git_pull git-pull
complete -o default -o nospace -F _git_push git-push
complete -o default -o nospace -F _git_rebase git-rebase
complete -o default -o nospace -F _git_config git-config
complete -o default -o nospace -F _git_remote git-remote
complete -o default -o nospace -F _git_reset git-reset
complete -o default -o nospace -F _git_shortlog git-shortlog
complete -o default -o nospace -F _git_show git-show
complete -o default -o nospace -F _git_stash git-stash
complete -o default -o nospace -F _git_submodule git-submodule
complete -o default -o nospace -F _git_log git-show-branch
complete -o default -o nospace -F _git_tag git-tag
complete -o default -o nospace -F _git_log git-whatchanged

# The following are necessary only for Cygwin, and only are needed
# when the user has tab-completed the executable name and consequently
# included the '.exe' suffix.
#
if [ Cygwin = &quot;$(uname -o 2&gt;/dev/null)&quot; ]; then
complete -o default -o nospace -F _git_add git-add.exe
complete -o default -o nospace -F _git_apply git-apply.exe
complete -o default -o nospace -F _git git.exe
complete -o default -o nospace -F _git_branch git-branch.exe
complete -o default -o nospace -F _git_bundle git-bundle.exe
complete -o default -o nospace -F _git_cherry git-cherry.exe
complete -o default -o nospace -F _git_describe git-describe.exe
complete -o default -o nospace -F _git_diff git-diff.exe
complete -o default -o nospace -F _git_format_patch git-format-patch.exe
complete -o default -o nospace -F _git_log git-log.exe
complete -o default -o nospace -F _git_ls_tree git-ls-tree.exe
complete -o default -o nospace -F _git_merge_base git-merge-base.exe
complete -o default -o nospace -F _git_name_rev git-name-rev.exe
complete -o default -o nospace -F _git_push git-push.exe
complete -o default -o nospace -F _git_config git-config
complete -o default -o nospace -F _git_shortlog git-shortlog.exe
complete -o default -o nospace -F _git_show git-show.exe
complete -o default -o nospace -F _git_log git-show-branch.exe
complete -o default -o nospace -F _git_tag git-tag.exe
complete -o default -o nospace -F _git_log git-whatchanged.exe
fi

</pre>
</div>
<br>

</div>

<div class="result">
<h2 class="title">
<a href="/user/agrus777">agrus777</a>/<a href="/snippet/python/work-with-gmail-accaunts-by-python">work with gmail accaunts by Python! </a>
<span class="language">(<a href="/language/python/"> python</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: python;">
#!/usr/bin/env python
#@+leo-ver=4
#@+node:@file tests.py
#@@first
#
#    Copyright (C) 2004  Richard Jones  &lt;richard followed by funny at sign then jones then a dot then name&gt;
#
#    GmailFS Test Cases
#
#    ./test.py mountpoint blocksize 
#    e.g. ./tests.py /gmailfs 5242880
#
#    This program can be distributed under the terms of the GNU GPL.
#    See the file COPYING.
#

&quot;&quot;&quot;
GmailFS Test Cases provides some tests to the author shooting himself in the foot between releases.
&quot;&quot;&quot;

import os,traceback,sys,md5
from stat import *
from os import *

#@+node:mainline
class TestFS:
    &quot;&quot;&quot;
    Class containing test cases for gmail filesystem
    &quot;&quot;&quot;
    
    def __init__(self,mountpath,blocksize):
        self.mountpath = mountpath
        self.blocksize = blocksize

    def check(self,passed,testname):
        if passed==1:
            print &quot;passed &quot;+testname
        else:
            print &quot;failed &quot;+testname
            

    def create_1(self,path,file1):
        try:
            pathname = os.path.join(self.mountpath,path)
            print 'pathname='+pathname+' path:'+path
            if not os.access(pathname,F_OK):
                os.makedirs(pathname)
            pathname = os.path.join(pathname,file1)
            f = file(pathname,&quot;w&quot;)
            writestr = 'hello world\n'
            f.write(writestr)
            f.close()
            f = file(pathname,&quot;r&quot;)
            readstr = f.read()
            if readstr != writestr:
                print 'readstr: '+readstr+' not equal to writestr:'+writestr
                return 0
        except:
            traceback.print_exc(file=sys.stdout)
            return 0

        return 1

    def create_big_1(self,path,file1,writelen):
        try:
            pathname = os.path.join(self.mountpath,path)
            if not os.access(pathname,F_OK):
                os.makedirs(pathname)
            pathname = os.path.join(pathname,file1)
            f = file(pathname,'w')
            count = 0
            num = 0
            m = md5.new()
            while count&lt;writelen:
               numstr = str(num)
               f.write(numstr)
               num+=1
               if num&gt;9:
                   num=0
               m.update(numstr)
               count+=1

            md5orig = m.digest()
            
            f.close()
            f = file(pathname,&quot;r&quot;)
            md5check = md5.new(f.read()).digest()
            if  md5orig != md5check:
                print 'readstr: '+readstr+' not equal to writestr:'+writestr
                return 0
        except:
            traceback.print_exc(file=sys.stdout)
            return 0

        return 1

    def link_1(self,path1,path2,sym):
        pathname1 = os.path.join(self.mountpath,path1)
        pathname2 = os.path.join(self.mountpath,path2)

        try:
            if (sym):
                symlink(pathname1,pathname2)
            else:
                link(pathname1,pathname2)
                
            if not os.access(pathname2,F_OK):
                os.remove(pathname2)
                return 0

        except:
            traceback.print_exc(file=sys.stdout)
            return 0

        os.remove(pathname2)
        return 1


    def deletedir_1(self,path):
        pathname = os.path.join(self.mountpath,path)
        try:
            os.rmdir(pathname)
        except:
            traceback.print_exc(file=sys.stdout)
            return 0

        if os.access(pathname,F_OK):
            return 0

        return 1

    def delete_1(self,path):
        pathname = os.path.join(self.mountpath,path)
        print &quot;test delete_1 deleting pathname:&quot;+pathname
        try:
            os.unlink(pathname)
        except:
            traceback.print_exc(file=sys.stdout)
            return 0

        if os.access(pathname,F_OK):
            return 0

        return 1
        
    def mkdir_1(self,path):
        pathname = os.path.join(self.mountpath,path)
        print 'pathname='+pathname+' path:'+path
        try:
            os.makedirs(pathname)
       
            if not os.access(pathname,F_OK):
                os.removedirs(pathname)
                return 0
            
            mode = os.stat(pathname)[ST_MODE]
            if not S_ISDIR(mode):
                os.removedirs(pathname)
                return 0
            
        except:
            traceback.print_exc(file=sys.stdout)
            return 0

        os.removedirs(pathname)
        return 1

    

if __name__ == '__main__':
    tester = TestFS(sys.argv[1],int(sys.argv[2]))
    print &quot;start tests&quot;
    tester.check(tester.mkdir_1(&quot;test1&quot;),&quot;mkdir test1&quot;)
        
    tester.check(tester.mkdir_1(&quot;test1/test2&quot;),&quot;mkdir test1/test2&quot;)
    tester.check(tester.create_1(&quot;&quot;,&quot;file1&quot;),&quot;create /file1&quot;)
    tester.check(tester.create_1(&quot;dir1&quot;,&quot;file1&quot;),&quot;create /dir1/file1&quot;)
    tester.check(tester.create_1(&quot;dir1/dir2&quot;,&quot;file1&quot;),&quot;create dir1/dir2/file1&quot;)
    tester.check(tester.create_big_1(&quot;dir3&quot;,&quot;bigfile1&quot;,tester.blocksize-1),&quot;create dir3/bigfile1 with size:&quot;+str(tester.blocksize))
    tester.check(tester.delete_1(&quot;dir3/bigfile1&quot;),&quot;delete dir3/bigfile1&quot;)
    tester.check(tester.create_big_1(&quot;dir3&quot;,&quot;bigfile1&quot;,tester.blocksize),&quot;create dir3/bigfile1 with size:&quot;+str(tester.blocksize))
    tester.check(tester.delete_1(&quot;dir3/bigfile1&quot;),&quot;delete dir3/bigfile1&quot;)
    tester.check(tester.create_big_1(&quot;dir3&quot;,&quot;bigfile1&quot;,tester.blocksize+1),&quot;create dir3/bigfile1 with size:&quot;+str(tester.blocksize+1))
    tester.check(tester.delete_1(&quot;dir3/bigfile1&quot;),&quot;delete dir3/bigfile1&quot;)
    tester.check(tester.create_big_1(&quot;dir3&quot;,&quot;bigfile1&quot;,(tester.blocksize*2+1)),&quot;create dir3/bigfile1 with size:&quot;+str(tester.blocksize*2+1))
    tester.check(tester.delete_1(&quot;dir3/bigfile1&quot;),&quot;delete dir3/bigfile1&quot;)
    tester.check(tester.deletedir_1(&quot;dir3&quot;),&quot;delete dir3&quot;)

#    tester.check(tester.link_1(&quot;/bin/df&quot;,&quot;testfile2&quot;,1),&quot;symlink testfile2 to /bin/df&quot;)
#    tester.check(tester.link_1(&quot;dir1/file1&quot;,&quot;testfile2&quot;,0),&quot;hardlink testfile2 to dir1/file1&quot;)
#    tester.check(tester.link_1(&quot;file1&quot;,&quot;testfile2&quot;,0),&quot;hardlink testfile2 to file1&quot;)
    tester.check(tester.link_1(&quot;dir1/dir2/file1&quot;,&quot;testfile2&quot;,0),&quot;hardlink testfile2 to dir1/dir2/file1&quot;)
    tester.check(tester.delete_1(&quot;file1&quot;),&quot;delete file1&quot;)
    tester.check(tester.delete_1(&quot;dir1/file1&quot;),&quot;delete dir1/file1&quot;)
    tester.check(tester.delete_1(&quot;dir1/dir2/file1&quot;),&quot;delete dir1/dir2/file1&quot;)
    tester.check(tester.deletedir_1(&quot;dir1/dir2&quot;),&quot;delete dir1/dir2&quot;)
    tester.check(tester.deletedir_1(&quot;dir1&quot;),&quot;delete dir1&quot;)

    
    print &quot;finished tests&quot;
#@-node:mainline
#@-node:@file gmailfs.py
#@-leo

######################################################################################################

######################################################################################################



#!/usr/bin/env python
#@+leo-ver=4
#@+node:@file mount.fuse
#@@first #!/usr/bin/env python

&quot;&quot;&quot;
This utility allows Gmail filesystems to be mounted with the regular
'mount' command, or even to be listed in /etc/fstab

Usage:
     1.  mount.gmailfs none /path/of/mount/point [options]
     2.  in /etc/fstab, add:
           none /path/of/mount/point gmailfs noauto[,options]
&quot;&quot;&quot;

import sys, os, os.path, time, optparse, getpass, re, tempfile, signal

DEFAULT_GMAILFS_LOCATION     = '/usr/share/gmailfs/gmailfs.py'
# delay (in seconds) after which we consider gmailfs could not mount, and
# we abort.
GMAILFS_MOUNTING_MAX_DELAY   = 20 
# delay (in seconds) between two consecutive checks for encfs still being
# mounted.                                
ENCFS_MOUNTPOINT_CHECK_DELAY = 5  # in seconds

def parseCommandLineArgs(args):
  usage = &quot;usage: %prog none mountpoint [options]&quot;

  parser = optparse.OptionParser(usage=usage)
  parser.add_option(&quot;-p&quot;, &quot;--prompt-for-password&quot;, dest=&quot;promptForPasswd&quot;,
                    action=&quot;store_true&quot;, default=False,
                    help=&quot;Prompt for the Gmail password&quot; )
  parser.add_option(&quot;-e&quot;, &quot;--use-transparent-encryption&quot;, dest=&quot;useEncfs&quot;,
                    action=&quot;store_true&quot;, default=False,
                    help=&quot;Use transparent encryption&quot; )
  parser.add_option(&quot;-o&quot;, &quot;--options&quot;, dest=&quot;gmailfsOptions&quot;,
                    help=&quot;Use those options&quot;, metavar=&quot;option1=value1,[option2=value2,...]&quot;,
                    default=&quot;&quot;)

  options, args = parser.parse_args(args)

  if len(args) != 2:
    parser.error(&quot;Wrong number of arguments&quot;)
  else:
    pyfile, mountpoint = args
    mountpoint = os.path.abspath(mountpoint)    
  odata = options.gmailfsOptions

  namedOptions = {}
  if odata:
    for o in odata.split(&quot;,&quot;):
     try:
       k, v = o.split(&quot;=&quot;, 1)
       namedOptions[k] = v
     except:
       print &quot;Ignored option :&quot;+o

  if options.promptForPasswd:
    namedOptions['password'] = getpass.getpass(&quot;Gmail password: &quot;)
    
  # pyfile sanitation
  if pyfile == 'none':
    pyfile = DEFAULT_GMAILFS_LOCATION
  else:
    pyfile = os.path.abspath(pyfile)
  if not os.path.isfile(pyfile):
    log.error(&quot;file %s doesn't exist, or is not a file&quot; % pyfile)
    sys.exit(1)

  return pyfile, mountpoint, namedOptions, options.useEncfs

def main(mountpoint, namedOptions, useEncfs):
  if useEncfs: # create a temp. dir to mount the encrypted gmailfs volume
    clearMountPoint = mountpoint
    mountpoint = tempfile.mkdtemp()

  gmailfsPID = os.fork()
  if gmailfsPID == 0:
    # this is the child process. We register a log-and-exit handler for
    # SIGHUP, then we start the actual child task: mounting the gmailfs
    childPID = os.getpid()
    log.info('Starting gmailfs in child process (PID %s)' % childPID)

    def handlerHUP(signum, frame):
      log.warning(&quot;Child process %s received SIGHUP, exiting...&quot; % childPID)
      os._exit(1)
    #signal.signal(signal.SIGHUP, handlerHUP)

    sys.argv = [] # blank the command-line params for this child
    gmailfs.main(mountpoint, namedOptions)
    log.info('gmailfs terminated')
  else:
    # this is the parent process. First we wait for gmailfs to become mounted
    # within GMAILFS_MOUNTING_MAX_DELAY seconds.
    # If this doesn't happen, we cleanup and exit.
    log.info('waiting for %s to become a mountpoint' % mountpoint)
    for i in range(GMAILFS_MOUNTING_MAX_DELAY): # give our child some time
      if not os.path.ismount(mountpoint): # not yet mounted
        # let's check our child is still alive, without blocking
        pid, status = os.waitpid(gmailfsPID, os.WNOHANG)
        if not pid == 0: # it died, let's exit
          log.error('gmailfs child died, exiting...')
          sys.exit(1)
      else: # success, gmailfs got mounted
        break
      time.sleep(1)

    if os.path.ismount(mountpoint):
      log.info('%s is now a mountpoint' % mountpoint)
    else: # gmailfs wasn't mounted in the allocated time frame, abort
      log.error(&quot;gmailfs did not connect in less than %s seconds, aborting...&quot; % GMAILFS_MOUNTING_MAX_DELAY)
      os.kill(gmailfsPID, signal.SIGHUP) # send SIGHUP to our child
      os.waitpid(gmailfsPID, 0) # upon receiving SIGHUP, it should exit, so we block-wait on it
      log.info('Successfully reaped child %s' % gmailfsPID)
      sys.exit(3)
      
    if useEncfs:
      # encfs was requested. The first thing we do is define a cleanup()
      # function to unmount the actual gmailfs volume and remove the temporary
      # mountpoint.
      # We then spawn a child to run encfs, and wait for the encfs process
      # to either return an error (in which case we cleanup and
      # exit), or background itself (in which case we fork a child that
      # periodically checks if encfs is still mounted, and deos the cleanup
      # when it's not anymore.
      
      def cleanup(exitCode):
        log.info('encfs hook: running fusermount -u %s' % mountpoint)
        os.spawnvp(os.P_WAIT, 'fusermount', ('fusermount', '-u', mountpoint))
	log.info('encfs hook: removing intermediate mountpoint %s' % mountpoint)
        os.rmdir(mountpoint)
	log.info('encfs hook: cleanup complete, exiting')
        sys.exit(exitCode)

      rc = os.spawnvp(os.P_WAIT, 'encfs', ('encfs', mountpoint, clearMountPoint))
      if not rc == 0:
	log.error('encfs error (RC = %s), exiting...' % rc)
	cleanup(2)
      else:
        log.info('encfs backgrounded')

      if os.fork() == 0:
        # this is the child that will periodically monitor encfs
        while os.path.ismount(clearMountPoint):
          log.debug('waiting for %s to become unmounted' % clearMountPoint)
          time.sleep(ENCFS_MOUNTPOINT_CHECK_DELAY)
        log.info('%s is not a mountpoint anymore, which means encfs has exited' % clearMountPoint)
        cleanup(0)
      else: # let the parent exit
        pass
    else: # encfs not requested, let the parent exit
      pass

if __name__ == '__main__':
  pyfile, mountpoint, namedOptions, useEncfs = parseCommandLineArgs(sys.argv[1:])

  # import gmailfs from the pyfile location
  sys.path.append(os.path.abspath(os.path.dirname(pyfile)))
  import gmailfs

  # use the gmailfs log facility
  log = gmailfs.log

  main(mountpoint, namedOptions, useEncfs)

#@-node:@file mount.fuse
#@-leo
######################################################################################################

######################################################################################################

#!/usr/bin/env python
#@+leo-ver=4
#@+node:@file gmailfs.py
#@@first
#
#    Copyright (C) 2004  Richard Jones  &lt;richard followed by funny at sign then jones then a dot then name&gt;
#
#    GmailFS - Gmail Filesystem Version 0.8.0
#    This program can be distributed under the terms of the GNU GPL.
#    See the file COPYING.
#

&quot;&quot;&quot;
GmailFS provides a filesystem using a Google Gmail account as its storage medium
&quot;&quot;&quot;

#@+others
#@+node:imports

import fuse
from fuse import Fuse
import os
from errno import *
from stat import *
from os.path import abspath, expanduser

fuse.fuse_python_api = (0, 2)


import thread
import quopri
import libgmail
from lgconstants import *

import sys,traceback,re,string,time,tempfile,array,logging,logging.handlers
   
try:
    import OpenSSLProxy
except:
    pass

#@-node:imports

# Globals
DefaultUsername = 'defaultUser'
DefaultPassword = 'defaultPassword'
DefaultFsname = 'gmailfs'
References={}

GMAILFS_VERSION = '3'

PathStartDelim  = '__a__'
PathEndDelim    = '__b__'
FileStartDelim  = '__c__'
FileEndDelim    = '__d__'
LinkStartDelim  = '__e__'
LinkEndDelim    = '__f__'
MagicStartDelim = '__g__'
MagicEndDelim   = '__h__'

InodeTag ='i'
DevTag = 'd'
NumberLinksTag = 'k'
FsNameTag = 'q'
ModeTag = 'e'
UidTag = 'u'
GidTag = 'g'
SizeTag = 's'
AtimeTag = 'a'
MtimeTag = 'm'
CtimeTag = 'c'
BlockSizeTag = 'z'
VersionTag = 'v'

RefInodeTag = 'r'
FileNameTag = 'n'
PathNameTag = 'p'
LinkToTag = 'l'

NumberQueryRetries = 3

regexObjectTrailingMB = re.compile(r'\s?MB$')

def _addLoggingHandlerHelper(handler):
    &quot;&quot;&quot; Sets our default formatter on the log handler before adding it to
        the log object. &quot;&quot;&quot;
    handler.setFormatter(defaultLogFormatter)
    log.addHandler(handler)

def GmailConfig(fname):
    import ConfigParser
    cp = ConfigParser.ConfigParser()
    global References
    global DefaultUsername, DefaultPassword, DefaultFsname
    global NumberQueryRetries
    if cp.read(fname) == []:
      log.warning(&quot;Unable to read configuration file: &quot; + str(fname))
      return

    sections = cp.sections()
    if &quot;account&quot; in sections:
      options = cp.options(&quot;account&quot;)
      if &quot;username&quot; in options:
          DefaultUsername = cp.get(&quot;account&quot;, &quot;username&quot;)
      if &quot;password&quot; in options:
          DefaultPassword = cp.get(&quot;account&quot;, &quot;password&quot;)
    else:
      log.error(&quot;Unable to find GMail account configuration&quot;)

    if &quot;filesystem&quot; in sections:
      options = cp.options(&quot;filesystem&quot;)
      if &quot;fsname&quot; in options:
          DefaultFsname = cp.get(&quot;filesystem&quot;, &quot;fsname&quot;)
    else:
      log.warning(&quot;Using default file system (Dangerous!)&quot;)
      
    if &quot;logs&quot; in sections:
      options = cp.options(&quot;logs&quot;)
      if &quot;level&quot; in options:
        level = cp.get(&quot;logs&quot;, &quot;level&quot;)
        log.setLevel(logging._levelNames[level])
      if &quot;logfile&quot; in options:
        logfile = abspath(expanduser(cp.get(&quot;logs&quot;, &quot;logfile&quot;)))
        log.removeHandler(defaultLoggingHandler)
        _addLoggingHandlerHelper(logging.handlers.RotatingFileHandler(logfile, &quot;a&quot;, 5242880, 3))
        
    if &quot;connection&quot; in sections:
      options = cp.options(&quot;connection&quot;)
      try:
        if &quot;proxy&quot; in options:
          OpenSSLProxy.OpenSSLInstallHandler(cp.get(&quot;connection&quot;, &quot;proxy&quot;))
        else:
          OpenSSLProxy.OpenSSLInstallHandler()
      except:
        log.error(&quot;OpenSSLProxy is missing. Can't use HTTPS proxy!&quot;);

      if &quot;retries&quot; in options:
          NumberQueryRetries = cp.getint(&quot;connection&quot;, &quot;retries&quot;)

    if &quot;references&quot; in sections:
      options = cp.options(&quot;references&quot;)
      for option in options:
          record = cp.get(&quot;references&quot;,option)
          fields = record.split(':')
          if len(fields)&lt;1 or len(fields)&gt;3:
              log.warning(&quot;Invalid reference '%s' in configuration.&quot; % (record))
              continue
          reference = reference_class(*fields)
          References[option] = reference
                                                                                
class reference_class:
    def __init__(self,fsname,username=None,password=None):
      self.fsname = fsname
      if username is None or username == '':
          self.username = DefaultUsername
      else:
          self.username = username
      if password is None or password == '':
          self.password = DefaultPassword
      else:
          self.password = password

# This ensures backwards compatability where
# old filesystems were stored with 7bit encodings
# but new ones are all quoted printable
def fixQuotedPrintable(body):
    # first remove headers
    newline = body.find(&quot;\r\n\r\n&quot;)
    if newline &gt;= 0:
	body = body[newline:]
    fixed = body
    if re.search(&quot;Content-Transfer-Encoding: quoted&quot;,body):
        fixed = quopri.decodestring(body)
    # Map unicode     
    return fixed.replace('\u003d','=')

def _getMessagesByQuery(ga,queryString):
    tries = 0
    while tries&lt;NumberQueryRetries:
        tries+=1
        try:
            folder = ga.getMessagesByQuery(queryString+&quot; subject:&quot;+FsNameTag+&quot;=&quot;+MagicStartDelim+ fsNameVar +MagicEndDelim)
            return folder
        except:
            log.error(&quot;Exception getting query:&quot;+queryString)

NumberSendRetries = 3            

#@+node:_sendMessages
def _sendMessage(ga,gmsg):
    &quot;&quot;&quot;
    Send an already composed GmailComposedMessage message to the users own email address
    &quot;&quot;&quot;
    
    tries = 0
    while tries&lt;NumberSendRetries:
        tries+=1
        try:
            if ga.sendMessage(gmsg):
                log.debug(&quot;Sent message ok&quot;)
                return 1
            else:
                log.info(&quot;Sent message failed&quot;)
        except:
            traceback.print_exc(file=sys.stdout)
            log.info(&quot;Sent message failed&quot;)
        
    log.error(&quot;Send failed too many times&quot;)
    return 0
#@+node:_sendMessages

def _pathSeparatorEncode(path):
    s1 = re.sub(&quot;/&quot;,&quot;__fs__&quot;,path)
    s2 = re.sub(&quot;-&quot;,&quot;__mi__&quot;,s1)
    return re.sub(&quot;\+&quot;,&quot;__pl__&quot;,s2)

def _pathSeparatorDecode(path):
    s1 = re.sub(&quot;__fs__&quot;,&quot;/&quot;,path)
    s2 = re.sub(&quot;__mi__&quot;,&quot;-&quot;,path)
    return re.sub(&quot;__pl__&quot;,&quot;+&quot;,path)


def _logException(msg):
    traceback.print_exc(file=sys.stderr)
    log.exception(msg)

#@+node:class GmailInode
class GmailInode:

    &quot;&quot;&quot;
    Class used to store gmailfs inode details
    &quot;&quot;&quot;

    #@+node:__init__
    def __init__(self, msg,ga):
        try:
            self.version = 2
            self.ino = 0
            self.mode = 0
            self.dev = 0
            self.nlink = 0
            self.uid = 0
            self.gid = 0
            self.size = 0
            self.atime = 0
            self.mtime = 0
            self.ctime = 0
            self.blocksize = DefaultBlockSize
            self.ga = ga
            self.msg = msg
            m = re.match(VersionTag+'=(.*) '+RefInodeTag+'=(.*) '+FsNameTag+'='+MagicStartDelim+'(.*)'+MagicEndDelim,msg.subject.replace('\u003d','='))
            matchInode = m.group(2)

            log.debug(&quot;trying to get inode with:&quot;+matchInode+&quot; from subject:&quot;+msg.subject)
            self.inode_msg = self.getinodeMsg(matchInode)
            self.setInode()
        except:
            _logException(&quot;got exception when getmessages&quot;)
    #@-node:__init__

    #@+node:getinodeMsg
    def getinodeMsg(self,inodeNumber):
        &quot;&quot;&quot;
        Get Gmail message handle for the message containing inodeNumber
        &quot;&quot;&quot;
        
        folder = _getMessagesByQuery(self.ga,'subject:'+InodeTag+'='+inodeNumber+'')
        if len(folder)!=1:
          log.error(&quot;could not find inode msg with inodenumber:&quot;+inodeNumber)
          return None;
        if len(folder._threads[0])!=1:
          return None;
        thread = folder._threads[0]
        if not thread._messages:
          thread._messages = thread._getMessages(thread)

        return thread._messages[len(thread._messages)-1]
    #@-node:getinodeMsg
    
    def update(self):
        &quot;&quot;&quot;
        Sync's the state of this inode back to the users gmail account
        &quot;&quot;&quot;
        
        timeString = str(int(time.time()))
        subject = (VersionTag+&quot;=&quot;+GMAILFS_VERSION+
                  &quot; &quot;+InodeTag+&quot;=&quot;+str(self.ino)+
	          &quot; &quot;+DevTag+&quot;=&quot;+str(self.dev)+
		  &quot; &quot;+NumberLinksTag+&quot;=&quot;+str(self.nlink)+
		  &quot; &quot;+FsNameTag+&quot;=&quot;+MagicStartDelim+ fsNameVar +MagicEndDelim )
        body    = (ModeTag+&quot;=&quot;+str(self.mode)+
	          &quot; &quot;+UidTag+&quot;=&quot;+str(self.uid)+
	          &quot; &quot;+GidTag+&quot;=&quot;+str(self.gid)+
	          &quot; &quot;+SizeTag+&quot;=&quot;+str(self.size)+
	          &quot; &quot;+AtimeTag+&quot;=&quot;+str(self.atime)+
	          &quot; &quot;+MtimeTag+&quot;=&quot;+timeString+
	          &quot; &quot;+CtimeTag+&quot;=&quot;+str(self.ctime)+
	          &quot; &quot;+BlockSizeTag+&quot;=&quot;+str(self.blocksize) )
        gmsg = libgmail.GmailComposedMessage(username, subject, body)
        if _sendMessage(self.ga,gmsg):
            log.debug(&quot;Sent &quot;+subject+&quot; ok&quot;)
            if (self.inode_msg):
                log.debug(&quot;trashing old inode:&quot;+str(self.inode_msg.subject))
                self.ga.trashMessage(self.inode_msg)
            self.inode_msg = self.getinodeMsg(str(self.ino))
        else:
            e = OSError(&quot;Couldnt send mesg:&quot;+gmsg.subject)
            e.errno = ENOSPC
            raise e
        

    def setInode(self):
        &quot;&quot;&quot;
        Setup the inode instances members from the gmail inode message
        &quot;&quot;&quot;
        
        try:
            subject = self.inode_msg.subject.replace('\u003d','=')
            body = self.inode_msg.source
	    body = fixQuotedPrintable(body)
            log.debug(&quot;setting inode from subject:&quot;+subject)
            log.debug(&quot;and body:&quot;+body)
            m = re.match(VersionTag+'=(.*) '+InodeTag+'=(.*) '+DevTag+'=(.*) '+NumberLinksTag+'=(.*) '+FsNameTag+'='+MagicStartDelim+'(.*)'+
                         MagicEndDelim, subject)
            self.version = int(m.group(1))
            self.ino = int(m.group(2))
            self.dev = int(m.group(3))
            self.nlink = int(m.group(4))
            #quotedEquals = &quot;=(?:3D)?(.*)&quot;
            quotedEquals = &quot;=(.*)&quot;
            m = re.search(re.compile(
	                  ModeTag+quotedEquals+' ?'+UidTag+quotedEquals+' ?'+
  			  GidTag+quotedEquals+' ?'+
                          SizeTag+quotedEquals+' ?'+
			  AtimeTag+quotedEquals+' ?'+
			  MtimeTag+quotedEquals+' ?'+
                          CtimeTag+quotedEquals+' ?'+
			  BlockSizeTag+quotedEquals, re.DOTALL),body)
	    self.mode = int(m.group(1))
            self.uid = int(m.group(2))
            self.gid = int(m.group(3))
            self.size = int(m.group(4))
            self.atime = int(m.group(5))
            self.mtime = int(m.group(6))
            self.ctime = int(m.group(7))
            self.blocksize = int(m.group(8))
        except:
            _logException(&quot;got exception when setInode&quot;)
            self.ino = None

    def unlink(self, path):
        &quot;&quot;&quot;
        Delete this inode and all of its data blocks
        &quot;&quot;&quot;
        log.debug(&quot;unlink path:&quot;+path+&quot; with nlinks:&quot;+str(self.nlink))
        self.nlink-=1
        if self.mode &amp; S_IFDIR:
            log.debug(&quot;unlinking dir&quot;)
            self.nlink-=1
        else:
            log.debug(&quot;unlinking file&quot;)
            

        self.ga.trashMessage(self.msg)
        if self.nlink&lt;1:
           log.debug(&quot;deleting inode or block nlink:&quot;+str(self.nlink))
           self.ga.trashMessage(self.inode_msg)
           subject = 'b='+str(self.ino)+''
           folder = _getMessagesByQuery(self.ga,'subject:'+subject)
           for thread in folder:
               for msg in thread:
                   self.ga.trashMessage(msg)
        else:
           log.debug(&quot;about to update inode&quot;)
           self.update()
           log.debug(&quot;not deleting inode or block nlink:&quot;+str(self.nlink))

        
#@-node:class GmailInode

#@+node:class OpenFile
class OpenFile:
    &quot;&quot;&quot;
    Class holding any currently open files, includes cached instance of the last data block retrieved
    &quot;&quot;&quot;
    
    def __init__(self, inode):
        self.inode = inode
        self.tmpfile = None
        self.blocksRead = 0
        self.needsWriting = 0
        self.blocksize = inode.blocksize
        self.buffer = list(&quot; &quot;*self.blocksize)
        self.currentOffset = -1
        self.lastBlock = 0
        self.lastBlockRead = -1
        self.lastBlockBuffer = []

    def close(self):
        &quot;&quot;&quot;
        Closes this file by committing any changes to the users gmail account
        &quot;&quot;&quot;
        
        if self.needsWriting:
           self.commitToGmail()


    def write(self,buf,off):
        &quot;&quot;&quot;
        Write data to file from buf, offset by off bytes into the file
        &quot;&quot;&quot;
        
        buflen = len(buf)
        towrite = buflen
        #if self.currentOffset == -1 or off&lt;self.currentOffset or off&gt;self.currentOffset+self.blocksize:
        #    self.commitToGmail()
        #    self.currentOffset = (off/self.blocksize)*self.blocksize+(off/self.blocksize)
        #    self.buffer = self.readFromGmail(self.currentOffset/self.blocksize,1)

        if self.currentOffset == -1 or off&lt;self.currentOffset or off&gt;self.currentOffset:
            self.commitToGmail()
            self.currentOffset = off;
            self.buffer = self.readFromGmail(self.currentOffset/self.blocksize,1)
            
        currentBlock = self.currentOffset/self.blocksize
        written = 0
        while towrite&gt;0:
            thiswrote = min(towrite,min(self.blocksize-(self.currentOffset%self.blocksize),self.blocksize))
            log.debug(&quot;wrote &quot;+str(thiswrote)+&quot; bytes off:&quot;+str(off)+&quot; self.currentOffset:&quot;+str(self.currentOffset))
            self.buffer[self.currentOffset%self.blocksize:] = buf[written:written+thiswrote]
            towrite -= thiswrote
            written += thiswrote
            self.currentOffset += thiswrote
            self.lastBlock=currentBlock
            if self.currentOffset/self.blocksize&gt;currentBlock:
                self.needsWriting = 1
                self.commitToGmail()
                currentBlock+=1
                if towrite&gt;0:
                    self.buffer = self.readFromGmail(currentBlock,1)
            else:
                self.needsWriting = 1

        if off+buflen&gt;self.inode.size:
            self.inode.size=off+buflen
            
        return buflen

    def commitToGmail(self):
        &quot;&quot;&quot;
        Send any unsaved data to users gmail account as an attachment
        &quot;&quot;&quot;
        
        if not self.needsWriting:
            return 1
        
        ga = self.inode.ga
        subject = ('b='+str(self.inode.ino)+
	          ' x='+str(self.lastBlock)+
		  ' '+FsNameTag+'='+MagicStartDelim+ fsNameVar +MagicEndDelim )
        tmpf = tempfile.NamedTemporaryFile()

        arr = array.array('c')
        arr.fromlist(self.buffer)
        if log.isEnabledFor(logging.DEBUG):
            log.debug(&quot;wrote to tmp file:&quot;+arr.tostring())
        tmpf.write(arr.tostring())
        tmpf.flush()
        gmsg = libgmail.GmailComposedMessage(username, subject, fsNameVar,filenames = [tmpf.name])
        if _sendMessage(ga,gmsg):
            log.debug(&quot;Sent write commit ok&quot;)
            self.needsWriting=0
            self.inode.update()
            tmpf.close()
            return 1
        else:
            log.error(&quot;Sent write commit failed&quot;)
            tmpf.close()
            return 0

    

    def read(self,readlen,offset):
        &quot;&quot;&quot;
        Read readlen bytes from an open file from position offset bytes into the files data
        &quot;&quot;&quot;
        
        readlen = min(self.inode.size-offset,readlen)
        outbuf = list(&quot; &quot;*readlen)
        toread = readlen;
        upto=0;
        while toread&gt;0:
           readoffset = (offset+upto)%self.blocksize
           thisread = min(toread,min(self.blocksize-(readoffset%self.blocksize),self.blocksize))
           outbuf[upto:] = self.readFromGmail((offset+upto)/self.blocksize,0)[readoffset:readoffset+thisread]
           upto+=thisread
           toread-=thisread
           log.debug(&quot;still to read:&quot;+str(toread))
        return outbuf

        return retbuf

    def readFromGmail(self,readblock,deleteAfter):
        &quot;&quot;&quot;
        Read data block with block number 'readblock' for this file from users gmail account, if 'deleteAfter' is
        true then the block will be removed from Gmail after reading
        &quot;&quot;&quot;
        
        log.debug(&quot;about to try and find inode:&quot;+str(self.inode.ino)+&quot; blocknumber:&quot;+str(readblock))
        if self.lastBlockRead == readblock:
            contentList = list(&quot; &quot;*self.blocksize)
	    contentList[0:] = self.lastBlockBuffer
            return contentList
        ga = self.inode.ga
        subject = 'b='+str(self.inode.ino)+' x='+str(readblock)+''
        folder = _getMessagesByQuery(ga,'subject:'+subject)
        if len(folder)!=1:
            return list(&quot; &quot;*self.blocksize)
        if len(folder._threads[0])!=1:
           return list(&quot; &quot;*self.blocksize)
        thread = folder._threads[0]
        if not thread._messages:
            thread._messages = thread._getMessages(thread)
        msg = thread._messages[len(thread._messages)-1]
        log.debug(&quot;got msg with subject:&quot;+msg.subject)
        log.debug(&quot;got &quot;+str(len(msg.attachments))+&quot; attachments&quot;)
        a = msg.attachments[0]
        if log.isEnabledFor(logging.DEBUG):
            log.debug(&quot;read from gmail:&quot;+a.content)
        if deleteAfter:
            ga.trashMessage(msg)
        self.lastBlockRead = readblock
        self.lastBlockBuffer = a.content
        contentList = list(&quot; &quot;*self.blocksize)
        contentList[0:] = a.content
        return contentList

#@-node:class OpenFile

#@+node:class Gmailfs
class Gmailfs(Fuse):

    #@	@+others

    
    #@+node:__init__
    def __init__(self, extraOpts, mountpoint, *args, **kw):
        Fuse.__init__(self, *args, **kw)
        self.fuse_args.mountpoint = mountpoint
        self.optdict = extraOpts
        log.info(&quot;Mountpoint: %s&quot; % mountpoint)
	# obfuscate sensitive fields before logging
	loggableOptdict = self.optdict.copy()
	loggableOptdict['password'] = '*' * 8
	log.info(&quot;Named mount options: %s&quot; % (loggableOptdict,))

        # do stuff to set up your filesystem here, if you want

        self.openfiles = {}
        self.inodeCache = {}

        global DefaultBlockSize
        
        global fsNameVar
        global password
        global username

        DefaultBlockSize = 5*1024*1024
        
        fsNameVar = DefaultFsname
        password = DefaultPassword
        username = DefaultUsername
	
	options_required = 1
	if self.optdict.has_key(&quot;reference&quot;):
	    try:
		reference = References[self.optdict['reference']]
		username = reference.username
		password = reference.password
		fsNameVar = reference.fsname
	    except:
		log.error(&quot;Invalid reference supplied. Using defaults.&quot;)
	    else:
		options_required = 0

        if not self.optdict.has_key(&quot;username&quot;):
	    if options_required:
	        log.warning('mount: warning, should mount with username=gmailuser option, using default')
        else:
            username = self.optdict['username']

        if not self.optdict.has_key(&quot;password&quot;):
	    if options_required:
        	log.warning('mount: warning, should mount with password=gmailpass option, using default')
        else:
            password = self.optdict['password']

        if not self.optdict.has_key(&quot;fsname&quot;):
	    if options_required:
        	log.warning('mount: warning, should mount with fsname=name option, using default')
        else:
            fsNameVar = self.optdict['fsname']

        if self.optdict.has_key(&quot;blocksize&quot;):
            DefaultBlockSize = int(self.optdict['blocksize'])

        self.ga = libgmail.GmailAccount(username, password)
        self.ga.login()
        if username.find(&quot;@&quot;)&lt;0:
            username = username+&quot;@gmail.com&quot;
        log.info(&quot;Connected to gmail&quot;)
        #thread.start_new_thread(self.mythread, ())
        pass
    #@-node:__init__

    #@+node:mythread
    def mythread(self):
    
        &quot;&quot;&quot;
        The beauty of the FUSE python implementation is that with the python interp
        running in foreground, you can have threads
        &quot;&quot;&quot;    
        log.debug(&quot;mythread: started&quot;)
        #while 1:
        #    time.sleep(120)
        #    print &quot;mythread: ticking&quot;
    
    #@-node:mythread

    #@+node:attribs
    flags = 1
    
    #@-node:attribs
    
    class GmailStat(fuse.Stat):
        def __init__(self):
            self.st_mode = 0
            self.st_ino = 0
            self.st_dev = 0
            self.st_nlink = 0
            self.st_uid = 0
            self.st_gid = 0
            self.st_size = 0
            self.st_atime = 0
            self.st_mtime = 0
            self.st_ctime = 0

    #@+node:getattr
    def getattr(self, path):
        st = Gmailfs.GmailStat();
        log.debug(&quot;get stat:&quot;+path)
        #st_mode (protection bits)
        #st_ino (inode number)
        #st_dev (device)
        #st_nlink (number of hard links)
        #st_uid (user ID of owner)
        #st_gid (group ID of owner)
        #st_size (size of file, in bytes)
        #st_atime (time of most recent access)
        #st_mtime (time of most recent content modification)
        #st_ctime (time of most recent content modification or metadata change).


        if path == '/':
            inode=self.getinode(path)
            if not inode:
                self._mkfileOrDir(&quot;/&quot;,None,S_IFDIR|S_IRUSR|S_IXUSR|S_IWUSR|S_IRGRP|S_IXGRP|S_IXOTH|S_IROTH,-1,1,2)
                inode = self.getinode(path)
        else:
            inode = self.getinode(path)
            
        if inode:
            if log.isEnabledFor(logging.DEBUG):
                log.debug(&quot;inode &quot;+str(inode))
            st.st_mode = inode.mode
            st.st_ino = inode.ino
            st.st_dev = inode.dev
            st.st_nlink = inode.nlink
            st.st_uid = inode.uid
            st.st_gid = inode.gid
            st.st_size = inode.size
            st.st_atime = inode.atime
            st.st_mtime = inode.mtime
            st.st_ctme = inode.ctime
#            statTuple = (inode.mode,inode.ino,inode.dev,inode.nlink,inode.uid,
#                         inode.gid,inode.size,inode.atime,inode.mtime,
#                         inode.ctime)
            if log.isEnabledFor(logging.DEBUG):
                log.debug(&quot;statsTuple &quot;+str(st))
            return st
        else:
            e = OSError(&quot;No such file&quot;+path)
            e.errno = ENOENT
            raise e
    #@-node:getattr
    
    #@+node:readlink
    def readlink(self, path):
        log.debug(&quot;readlink: path='%s'&quot; % path)
        inode = self.getinode(path)
        if not (inode.mode &amp; S_IFLNK):
            e = OSError(&quot;Not a link&quot;+path)
            e.errno = EINVAL
            raise e
        log.debug(&quot;about to follow link in body:&quot;+inode.msg.source)
	body = fixQuotedPrintable(inode.msg.source)
        m = re.search(LinkToTag+'='+LinkStartDelim+'(.*)'+
                      LinkEndDelim,body)
        return m.group(1)
    #@-node:readlink
    

   #@+node:readdir
    def readdir(self, path, offset):
        try:
            log.debug(&quot;at top of readdir&quot;);
            log.debug(&quot;getting dir &quot;+path)
            fspath = _pathSeparatorEncode(path)
            log.debug(&quot;querying for:&quot;+''+PathNameTag+'='+PathStartDelim+
                      fspath+PathEndDelim)
            # FIX need to check if directory exists and return error if it doesnt, actually
            # this may be done for us by fuse
            folder = _getMessagesByQuery(self.ga,''+PathNameTag+'='+
                                         PathStartDelim+fspath+PathEndDelim)
            log.debug(&quot;got folder &quot;)
            lst = []
            for dirlink in &quot;.&quot;, &quot;..&quot;:
                lst.append(dirlink)
                
            for thread in folder:
               assert len(thread) == 1
               for msg in thread:
                 log.debug(&quot;thread.summary is &quot; + thread.snippet)
                 m = re.search(FileNameTag+'='+FileStartDelim+'(.*)'+
                               FileEndDelim, thread.snippet)
                 if (m):
                     # Match succeeded, we got the whole filename.
                     log.debug(&quot;Used summary for filename&quot;)
                     filename = m.group(1)
                 else:
                     # Filename was too long, have to fetch message.
                     log.debug(&quot;Long filename, had to fetch message&quot;)
		     body = fixQuotedPrintable(msg.source)
                     m = re.search(FileNameTag+'='+FileStartDelim+'(.*)'+
                                   FileEndDelim, body)
                     filename = m.group(1)

                 log.debug(&quot;Found file:&quot;+filename)
                 # this test for length is a special case hack for the root directory to prevent ls /gmail_root
                 # returning &quot;&quot;. This is hack is requried due to adding modifiable root directory as an afterthought, rather
                 # than designed in at the start.
                 if len(filename)&gt;0:
                     lst.append(filename)
        except:
            _logException(&quot;got exception when getmessages&quot;)
            lst = None
        #return map(lambda x: (x,0), lst)
        for r in lst:
	    yield fuse.Direntry(r)
    #@-node:getdir
    
    #@+node:unlink
    def unlink(self, path):
        log.debug(&quot;unlink called on:&quot;+path)
        try:
            inode = self.getinode(path)
            inode.unlink(path)
            #del self.inodeCache[path]
            # this cache flushing in unfortunate but currently necessary
            # to avoid problems with hard links losing track of
            # number of the number of links
            self.inodeCache = {}
            return 0
        except:
            _logException(&quot;Error unlinking file&quot;+path)
            e = OSError(&quot;Error unlinking file&quot;+path)
            e.errno = EINVAL
            raise e
    #@-node:unlink

    #@+node:rmdir
    def rmdir(self, path):
        log.debug(&quot;rmdir called on:&quot;+path)
        #this is already checked before rmdir is even called
        #dirlist = self.getdir(path)
        #if len(dirlist)&gt;0:
        #    e = OSError(&quot;directory not empty&quot;+path)
        #    e.errno = ENOTEMPTY
        #    raise e
        inode = self.getinode(path)
        inode.unlink(path)
        #del self.inodeCache[path]

        # this cache flushing in unfortunate but currently necessary
        # to avoid problems with hard links losing track of
        # number of the number of links
        self.inodeCache = {}
        
        # update number of links in parent directory
        ind = string.rindex(path,'/')
        parentdir = path[:ind]
        log.debug(&quot;about to rmdir with parentdir:&quot;+parentdir)
        if len(parentdir)==0:
            parentdir = &quot;/&quot;
            
        parentdirinode = self.getinode(parentdir)
        parentdirinode.nlink-=1
        parentdirinode.update()
        del self.inodeCache[parentdir]
        return 0
        
    #@-node:rmdir
    
    #@+node:symlink
    def symlink(self, path, path1):
        log.debug(&quot;symlink: path='%s', path1='%s'&quot; % (path, path1))
        self._mkfileOrDir(path1,path,S_IFLNK|S_IRWXU|S_IRWXG|S_IRWXO,-1,0,1)
    #@-node:symlink

    #@+node:rename
    def rename(self, path, path1):
        log.debug(&quot;rename from:&quot;+path+&quot; to:&quot;+path1)
        msg = self.getinodemsg(path)

        ind = string.rindex(path1,'/')
        log.debug(&quot;ind:&quot;+str(ind))
        dirpath = path1[:ind]
        if len(dirpath)==0:
            dirpath=&quot;/&quot;
        name = path1[ind+1:]
        log.debug(&quot;dirpath:&quot;+dirpath+&quot; name:&quot;+name)
        fspath = _pathSeparatorEncode(dirpath)
        
        m = re.match(VersionTag+'=(.*) '+RefInodeTag+'=(.*) '+FsNameTag+'='+MagicStartDelim+'(.*)'+
                     MagicEndDelim, msg.subject)
        subject = ( VersionTag+&quot;=&quot;+GMAILFS_VERSION+
                  &quot; &quot;+RefInodeTag+&quot;=&quot;+m.group(2)+
	          &quot; &quot;+FsNameTag+&quot;=&quot;+MagicStartDelim+ fsNameVar +MagicEndDelim )
	bodytmp = fixQuotedPrintable(msg.source)
        m = re.search(FileNameTag+'='+FileStartDelim+'(.*)'+FileEndDelim+
	             ' '+PathNameTag+'='+PathStartDelim+'(.*)'+PathEndDelim+
		     ' '+LinkToTag+'='+LinkStartDelim+'(.*)'+LinkEndDelim,
                      bodytmp)
        body = (FileNameTag+&quot;=&quot;+FileStartDelim+ name +FileEndDelim+
	       &quot; &quot;+PathNameTag+&quot;=&quot;+PathStartDelim+ fspath +PathEndDelim+
	       &quot; &quot;+LinkToTag+&quot;=&quot;+LinkStartDelim+ m.group(3) +LinkEndDelim )
        gmsg = libgmail.GmailComposedMessage(username, subject, body)
        if _sendMessage(self.ga,gmsg):
            log.debug(&quot;Sent &quot;+subject+&quot; ok&quot;)
            self.ga.trashMessage(msg)
            if self.inodeCache.has_key(path):
                #del self.inodeCache[path]
                # this cache flushing in unfortunate but currently necessary
                # to avoid problems with hard links losing track of
                # number of the number of links
                self.inodeCache = {}
            return 0
        else:
            e = OSError(&quot;Couldnt send mesg&quot;+path)
            e.errno = ENOSPC
            raise e

    #@-node:rename
    
    #@+node:link
    def link(self, path, path1):
        log.debug(&quot;hard link: path='%s', path1='%s'&quot; % (path, path1))
        inode = self.getinode(path)
        if not (inode.mode &amp; S_IFREG):
            e = OSError(&quot;hard links only supported for regular files not directories:&quot;+path)
            e.errno = EPERM
            raise e
        inode.nlink+=1
        inode.update()
        self._mkfileOrDir(path1,None,inode.mode,inode.ino,0,1)
        return 0
    #@-node:link
    
    #@+node:chmod
    def chmod(self, path, mode):
        log.debug(&quot;chmod called with path:&quot;+path+&quot; mode:&quot;+str(mode))
        inode = self.getinode(path)
        inode.mode = (inode.mode &amp; ~(S_ISUID|S_ISGID|S_ISVTX|S_IRWXU|S_IRWXG|S_IRWXO)) | mode
        inode.update()
        return 0
    #@-node:chmod

    #@+node:chown
    def chown(self, path, user, group):
        log.debug(&quot;chown called with user:&quot;+str(user)+&quot; and group:&quot;+str(group))
        inode = self.getinode(path)
        inode.uid = user
        inode.gid = group
        inode.update()
        return 0
    #@-node:chown

    #@+node:truncate
    def truncate(self, path, size):
        log.debug(&quot;truncate &quot;+path+&quot; to size:&quot;+str(size))
        inode = self.getinode(path)
        # this is VERY lazy, we leave the truncated data around
        # it WILL be harvested when we grow the file again or
        # when we delete the file but should probably FIX
        inode.size = size;
        inode.update()
        return 0
    #@-node:truncate

    #@+node:mknod
    def mknod(self, path, mode, dev):
    	&quot;&quot;&quot; Python has no os.mknod, so we can only do some things &quot;&quot;&quot;
        log.debug(&quot;mknod:&quot;+path)
	if S_ISREG(mode) | S_ISFIFO(mode) | S_ISSOCK(mode):
            self._mkfileOrDir(path,None,mode,-1,0,1)
    	    #open(path, &quot;w&quot;)
    	else:
    		return -EINVAL
    #@-node:mknod

    def _mkfileOrDir(self,path,path2,mode,inodenumber,size,nlinks):
        ind = string.rindex(path,'/')
        log.debug(&quot;ind:&quot;+str(ind))
        dirpath = path[:ind]
        if len(dirpath)==0:
            dirpath=&quot;/&quot;
        name = path[ind+1:]
        log.debug(&quot;dirpath:&quot;+dirpath+&quot; name:&quot;+name)
        fspath = _pathSeparatorEncode(dirpath)
        if path2 == None:
            path2 = &quot;&quot;
        if inodenumber==-1:
            inodeno = int(time.time())
        else:
            inodeno = inodenumber
            
        subject = (VersionTag+&quot;=&quot;+GMAILFS_VERSION+
                  &quot; &quot;+RefInodeTag+&quot;=&quot;+str(inodeno)+
	          &quot; &quot;+FsNameTag+&quot;=&quot;+MagicStartDelim+ fsNameVar +MagicEndDelim )
        body    = (&quot;&quot;+FileNameTag+&quot;=&quot;+FileStartDelim+  name      +FileEndDelim+
	          &quot; &quot;+PathNameTag+&quot;=&quot;+PathStartDelim+  fspath    +PathEndDelim+
		  &quot; &quot;+LinkToTag+&quot;=&quot;+LinkStartDelim+  path2     +LinkEndDelim  )
        gmsg = libgmail.GmailComposedMessage(username, subject, body)
        if _sendMessage(self.ga,gmsg):
            log.debug(&quot;Sent &quot;+subject+&quot; ok&quot;)
        else:
            e = OSError(&quot;Couldnt send mesg in _mkfileOrDir &quot;+path)
            e.errno = ENOSPC
            raise e
        # only create inode if number not provided
        if inodenumber==-1:
            timeString = str(int(time.time()))
            subject = (VersionTag+&quot;=&quot;+GMAILFS_VERSION+
                      &quot; &quot;+InodeTag+&quot;=&quot;+str(inodeno)+
	              &quot; &quot;+DevTag+&quot;=11 &quot;+NumberLinksTag+&quot;=&quot;+str(nlinks)+
		      &quot; &quot;+FsNameTag+&quot;=&quot;+MagicStartDelim+ fsNameVar +MagicEndDelim )
            body = (&quot;&quot;+ModeTag+&quot;=&quot;+str(mode)+
	           &quot; &quot;+UidTag+&quot;=&quot;+str(os.getuid())+&quot; &quot;+GidTag+&quot;=&quot;+str(os.getgid())+&quot; &quot;+SizeTag+&quot;=&quot;+str(size)+
		   &quot; &quot;+AtimeTag+&quot;=&quot;+timeString+
		   &quot; &quot;+MtimeTag+&quot;=&quot;+timeString+
		   &quot; &quot;+CtimeTag+&quot;=&quot;+timeString+
		   &quot; &quot;+BlockSizeTag+&quot;=&quot;+str(DefaultBlockSize) )
            gmsg = libgmail.GmailComposedMessage(username, subject, body)
            if _sendMessage(self.ga,gmsg):
                log.debug(&quot;Sent &quot;+subject+&quot; ok&quot;)
            else:
                e = OSError(&quot;Couldnt send mesg&quot;+path)
                e.errno = ENOSPC
                raise e

    #@+node:mkdir
    def mkdir(self, path, mode):
        log.debug(&quot;mkdir path:&quot;+path+&quot; mode:&quot;+str(mode))
        self._mkfileOrDir(path,None,mode|S_IFDIR, -1,1,2)
        inode = self.getinode(path)
        ind = string.rindex(path,'/')
        log.debug(&quot;ind:&quot;+str(ind))
        parentdir = path[:ind]
        if len(parentdir)==0:
            parentdir=&quot;/&quot;
        parentdirinode = self.getinode(parentdir)
        parentdirinode.nlink+=1
        parentdirinode.update()
        del self.inodeCache[parentdir]
    #@-node:mkdir

    #@+node:utime
    def utime(self, path, times):
        log.debug(&quot;utime for path:&quot;+path+&quot; times:&quot;+str(times))
        inode = self.getinode(path)
        inode.atime = times[0]
        inode.mtime = times[1]
        return 0
    #@-node:utime

    #@+node:open
    def open(self, path, flags):
        log.debug(&quot;gmailfs.py:Gmailfs:open: %s&quot; % path)
        try:
            inode = self.getinode(path)
            f = OpenFile(inode)
            self.openfiles[path] = f
            return 0
        except:
            _logException(&quot;Error opening file&quot;+path)
            e = OSError(&quot;Error opening file&quot;+path)
            e.errno = EINVAL
            raise e
    #@-node:open

    #@+node:read
    def read(self, path, readlen, offset):
        try:
            log.debug(&quot;gmailfs.py:Gmailfs:read: %s&quot; % path)
            log.debug(&quot;reading len:&quot;+str(readlen)+&quot; offset:&quot;+str(offset))
            f = self.openfiles[path]
            buf = f.read(readlen,offset)
            arr = array.array('c')
            arr.fromlist(buf)
            rets = arr.tostring()

            return rets
        except:
            _logException(&quot;Error reading file&quot;+path)
            e = OSError(&quot;Error reading file&quot;+path)
            e.errno = EINVAL
            raise e
    
    #@-node:read

    #@+node:write
    def write(self, path, buf, off):
        try:
            log.debug(&quot;gmailfs.py:Gmailfs:write: %s&quot; % path)
            if log.isEnabledFor(logging.DEBUG):
                log.debug(&quot;writing:&quot;+str(buf))
            f = self.openfiles[path]
            written = f.write(buf,off)
    	    return written
        except:
            _logException(&quot;Error opening file&quot;+path)
            e = OSError(&quot;Error opening file&quot;+path)
            e.errno = EINVAL
            raise e
    #@-node:write

    #@+node:release
    def release(self, path, flags):
        log.debug(&quot;gmailfs.py:Gmailfs:release: %s %s&quot; % (path, flags))
        f = self.openfiles[path]
        f.close()
        del self.openfiles[path]
        return 0
    #@-node:release

    #@+node:statfs
    def statfs(self):
        &quot;&quot;&quot;
        Should return a tuple with the following 6 elements:
            - blocksize - size of file blocks, in bytes
            - totalblocks - total number of blocks in the filesystem
            - freeblocks - number of free blocks
            - availblocks - number of blocks available to non-superuser
            - totalfiles - total number of file inodes
            - freefiles - nunber of free file inodes
    
        Feel free to set any of the above values to 0, which tells
        the kernel that the info is not available.
        &quot;&quot;&quot;
        st = fuse.StatVfs()
        block_size = 1024
        quotaInfo = self.ga.getQuotaInfo()
        quotaMbUsed = quotaInfo[QU_SPACEUSED]
        quotaMbTotal = quotaInfo[QU_QUOTA]
        blocks = int(regexObjectTrailingMB.sub('', quotaMbTotal)) * 1024 * 1024 / block_size
        quotaPercent = quotaInfo[QU_PERCENT]
        blocks_free = blocks - int(regexObjectTrailingMB.sub('', quotaMbUsed)) * 1024 * 1024 / block_size
        blocks_avail = blocks_free # I guess...
        log.debug(&quot;%s of %s used. (%s)\n&quot; % (quotaMbUsed, quotaMbTotal, quotaPercent))
        log.debug(&quot;Blocks: %s free, %s total\n&quot; % (blocks_free, blocks))
        files = 0
        files_free = 0
        namelen = 80
        st.f_bsize = block_size
	st.f_frsize = block_size
	st.f_blocks = blocks
	st.f_bfree = blocks_free
	st.f_bavail = blocks_avail
	st.f_files = files
	st.f_ffree = files_free
	return st
    #@-node:statfs

    #@+node:fsync
    def fsync(self, path, isfsyncfile):
        log.debug(&quot;gmailfs.py:Gmailfs:fsync: path=%s, isfsyncfile=%s&quot; % (path, isfsyncfile))
        inode = self.getinode(path)
        f = self.openfiles[path]
        f.commitToGmail()
        return 0
    
    #@-node:fsync



    def getinodemsg(self, path):
      try:
          log.debug(&quot;check getnodemsg:&quot;+path)
          ind = string.rindex(path,'/')
          log.debug(&quot;ind:&quot;+str(ind))
          dirpath = path[:ind]
          if len(dirpath)==0:
              dirpath=&quot;/&quot;
          name = path[ind+1:]
          log.debug(&quot;dirpath:&quot;+dirpath+&quot; name:&quot;+name)
          fspath = _pathSeparatorEncode(dirpath)
          folder = _getMessagesByQuery(self.ga, FileNameTag+'='+
                                       FileStartDelim+name+FileEndDelim+
                                       ' '+PathNameTag+'='+PathStartDelim+
                                       fspath +PathEndDelim)
				       
          if len(folder)!=1:
              return None;
          if len(folder._threads[0])!=1:
              return None;
          thread = folder._threads[0]
          if not thread._messages:
            thread._messages = thread._getMessages(thread)
          return thread._messages[len(thread._messages)-1]
      except:
          _logException(&quot;no slash in path:&quot;+path)
          return None


    def getinode(self, path):
        if self.inodeCache.has_key(path):
            return self.inodeCache[path]
        
        msg = self.getinodemsg(path)

        if msg == None:
            return None

        inode = GmailInode(msg,self.ga)
        if inode:
            self.inodeCache[path] = inode
            
        return inode
    
    #@-others
    
#@-node:class Gmailfs
#@+node:mainline

# Setup logging
log = logging.getLogger('gmailfs')
defaultLogLevel = logging.WARNING
log.setLevel(defaultLogLevel)
defaultLogFormatter = logging.Formatter(&quot;%(asctime)s %(levelname)-10s %(message)s&quot;, &quot;%x %X&quot;)
    
# log to stdout while parsing the config while
defaultLoggingHandler = logging.StreamHandler(sys.stdout)
_addLoggingHandlerHelper(defaultLoggingHandler)

GmailConfig(['/etc/gmailfs.conf',os.path.expanduser('~/.gmailfs')])
try:
    libgmail.ConfigLogs(log)
except:
    pass

def main(mountpoint, namedOptions):
    server = Gmailfs(namedOptions,mountpoint,version=&quot;gmailfs 0.8.0&quot;,usage='',dash_s_do='setsingle')
#    server.parser.mountpoint = mountpoint
    server.parse(errex=1)
    server.flags = 0
    server.multithreaded = False;
    server.main()

if __name__ == '__main__':
    main()
    
#@-node:mainline
#@-others
#@-node:@file gmailfs.py
#@-leo
###################################################################################################

###################################################################################################



[connection]
# The proxy URL
#proxy = http://user:pass@proxyhost:port
# or just 
#proxy = http://proxyhost:port

# The number or retries for the proxy connection.
#retries = 3

[account]
username = vit.violli@gmail.com
password = 180577

[filesystem]
fsname = linux_fs_3

[references]
# reference = filesystem:username:password

[logs]
# Change this to DEBUG for verbose output (useful for debugging)
level = INFO

# if you'd like logs to go to stdout, comment out this variable.
# For logging to, say, stderr, use /dev/stderr of your system's
# equivalent for it
logfile = ~/gmailfs.log

</pre>
</div>
<br>

  <p>Desktop Integration
The first part of this book really highlights its entire theme:
that the Gmail service, although ostensibly a website, can
be dragged over to touch the desktop in ways that make
new and exciting applications possible.
The first five chapters deal with this on a very basic level, allowing
you to use Gmail to its limits before delving into the nitty
gritty of code and some rather extreme uses of the system.
This chapter deals with the situations that arise when you continue
to use Gmail within the browser but want to use it as your
day-to-day e-mail system. There are two areas to cover: new mail
notification and mailto: link redirection.
New Mail Notification
Gmailâ€™s great features have inspired many early adopters to move
their entire e-mail regime over to the service. But unlike other
e-mail clients, Gmail requires you to have your web browser open
to see if you have any new mail. Even with tabbed browsing, this
is annoying. The alternative is to use a new-mail notifier application.
This section details some of the best notifiers, grouped by
platform. This is not a definitive list even at the time of this writing.
By the time you read this, there will be even more options.
But this is a good start.
Windows
Perhaps not the operating system of choice for the readers of this
book, but certainly one with a lot of users,Windows is gifted with
a wide range of Gmail integration products.
Ë› New mail
notification
Ë› Available
applications
Ë› Redirecting mailto:
chapter
in this chapter
4 Part I â€” Starting to Use Gmail
Google Gmail Notifier
The first and most obvious application comes from Google itself. Their Gmail
Notifier sits in the system tray, and displays an unread mail count, and the subject
line, sender, and a synopsis of newly arriving mail, all shown in Figure 1-1. At
the time of writing, it, like Gmail itself, is in beta. Get the Gmail Notifier from
<a href="http://toolbar.google.com/gmail-helper/" rel="nofollow">http://toolbar.google.com/gmail-helper/</a>.
FIGURE 1-1: Googleâ€™s own Gmail Notifier in action
Mozilla Extension Gmail Notifier
Technically, this will work on any platform that can run Mozilla-based browsers, but
Iâ€™ll put Doron Rosenbergâ€™s Gmail Notifier browser extension here (see Figure 1-2).
Although it doesnâ€™t provide the same level of interface as a taskbar-based application,
for people who spend a lot of time in their web browser, the Mozilla extension
is very convenient.
You can find the extension at <a href="http://nexgenmedia.net/extensions/" rel="nofollow">http://nexgenmedia.net/extensions/</a>.
FIGURE 1-2: Mozilla
Gmail Notifier in the
Firefox status bar
Chapter 1 â€” Desktop Integration 5
Mac OS X
OS X users have a choice of two applications, both very similar to each other, and
doing pretty much the same thing: placing the mail notification in the menu bar
at the top of the screen.
GmailStatus
Carsten Guentherâ€™s GmailStatus (<a href="http://homepage.mac.com/carsten" rel="nofollow">http://homepage.mac.com/carsten</a>.
guenther/GmailStatus/) is a good example. It displays new mail counts for the
Inbox, and each individual label you might have set up, adds a hotkey to launch
Gmail in your browser, supports Growl notifications (see <a href="http://growl.info/" rel="nofollow">http://growl.info/</a>
for more on that), and gives a hotkey to write a new message in Gmail (see Figure
1-3).
FIGURE 1-3: GmailStatus in action, with Growl notification
gCount
Nathan Spindelâ€™s gCount (<a href="http://www.ocf.berkeley.edu/%7Enatan/gcount/" rel="nofollow">www.ocf.berkeley.edu/~natan/gcount/</a>), shown
in Figure 1-4, is very similar indeed to GmailStatus in terms of functionality, with
perhaps two interesting additions. First, you can have a new mail count in the
dock, and second, it takes your Gmail username and password from the keychain.
This is a nice touch.
Linux, etc.
People using Linux, or any other Unix-style operating system with the option to
compile things, have a whole series of potential Gmail applications to choose
from. Linux users will also find the scripting done in the later stages of this book
to be very simple to implement.
6 Part I â€” Starting to Use Gmail
FIGURE 1-4: gCount, showing the preference menu
Mail Notification
Jean-Yves Lefortâ€™s Mail Notification system for Linux desktops supports Gmail
as well as most of the other common e-mail systems. You can get it from www.
nongnu.org/mailnotify/ where it is released under the GPL. According to
Lefort, it works with system trays implementing the <a href="http://freedesktop.org" rel="nofollow">freedesktop.org</a> System
Tray Specification, such as the Gnome Panel Notification Area, the Xfce
Notification Area, and the KDE System Tray.
Wmgmail
Remarkably useful for the clarity of its Python-based code, Pasi Savolainenâ€™s
Wmgmail is intended for use with WindowMaker or fluxbox window managers
on the operating system of your choice. (If that sentence means nothing to you,
this is not for you, in other words.)
Itâ€™s a standard new mail notification app, with new mail preview added in, but it
also has one very nice feature that is perfect for the hacker: You can set it to run
another program whenever new mail arrives.
You can find Wmgmail at <a href="http://osx.freshmeat.net/projects/wmgmail/" rel="nofollow">http://osx.freshmeat.net/projects/wmgmail/</a>.
Redirecting mailto:
Now that you have your desktop telling you when you have new mail within your
Gmail account, the only remaining integration is to ensure that clicking on a
mailto: link on a web page opens Gmail instead of your operating systemâ€™s
default e-mail client.
Chapter 1 â€” Desktop Integration 7
Windows
Again, as with new mail notification,Windows users have the pick of the crop.
The Google-authored Gmail Notifier, as mentioned previously, gives you the
option to redirect mailto: links when you install it.
If you really want to, you can manually edit the Windows Registry to enact the
same effect. The website <a href="http://www.rabidsquirrel.net/G-Mailto/" rel="nofollow">www.rabidsquirrel.net/G-Mailto/</a> gives a rundown
of just how to do this.
Multiplatform/Mozilla
Other than the Mozilla extension, at the time of this writing there is no mailto:
link diversion for the Linux desktop. But happily, by far the best way of repurposing
mailto: links is to do it in the browser, and specifically in a Mozilla-based
browser, which runs on all of the platforms used in this book:Windows, OS X,
and Linux. The platforms can use Jed Brownâ€™s WebMailCompose extension (see
Figure 1-5), installable from <a href="http://jedbrown.net/mozilla/extensions/" rel="nofollow">http://jedbrown.net/mozilla/extensions/</a></p>

<h4>WebMailCompose.</h4>

<p>FIGURE 1-5: WebMailCompose in action in Firefox 1.0 on OS X
8 Part I â€” Starting to Use Gmail
This extension also allows mailto: links to point to many other web-based
e-mail systems, should you tire of all of this coolness.
OS X
GmailStatus, mentioned earlier, also has the effect of changing mailto: links
to launch Gmail instead of Mail.app. But if you donâ€™t want to use GmailStatus,
a good example for OS X users is Gmailto, found at <a href="http://gu.st/code/" rel="nofollow">http://gu.st/code/</a>
Gmailto/. Gmailto is simple to use: Just download and run it, and then go to
Mail.appâ€™s preference panel to change the default reader application to Gmailto
(displayed in Figure 1-6) instead of Mail.app.Why the preference panel is inside
the application you no longer wish to use is beyond the reckoning of mortal men.
FIGURE 1-6: Selecting Gmailto in Mail.appâ€™s preferences
GmailerXP
Well worth its own section, if only because itâ€™s really weird, the Windows software
GmailerXPâ€”http://gmailerxp.sourceforge.netâ€”does all of the above
but adds in a desktop version of all of the other Gmail features as well: labels,
stars, setting filters and contacts, and so on (see Figure 1-7). Iâ€™m not sure when
you would use it, but it is a brilliant example of a Gmail hack.
The second half of this book looks at how applications such as GmailerXP work
and how to make your own.
Chapter 1 â€” Desktop Integration 9
FIGURE 1-7: GmailerXP in action
And Now . . .
By now you should be happily using Gmail, with new mail showing up on your
desktop and mailto: links on the web causing Gmail to open, not the default
mail reader you got with the operating system. In the next chapter, you look at
using the POP interface to pull your Gmail mail down into that very reader.</p>

<p>Integrating Your
Existing Mail
Gmail is probably not your first e-mail account, but its features
may well make it your best. Certainly itâ€™s likely to be
the one with the biggest amount of storage available and
such an exemplary search system.
Importing Your Mail into Gmail
The most important thing for me, when starting to use Gmail
properly, was getting all of my existing mail into the Gmail system.
Alas, Gmail doesnâ€™t have an import facility, so in this chapter
you have to make use of someone elseâ€™s hack to get your existing
mail into the system. There are a few applications available to do
this, but none are as good as the one concentrated on in the following
section: Gmail Loader.
Gmail Loader
Mark Lyonâ€™s Gmail Loader (shown in Figure 2-1), which you can
find at <a href="http://www.marklyon.org/gmail/default.htm" rel="nofollow">www.marklyon.org/gmail/default.htm</a>, does the
trick very nicely indeed. Itâ€™s available in versions for Windows,
OS X, and Linux, and in a source-code version.To quote the
author, â€œThe GMail Loader is a graphical, cross-platform,
Python-based utility that supports two mBox formats (Netscape,
Mozilla, Thunderbird, Most Other Clients), MailDir (Qmail,
others), MMDF (Mutt), MH (NMH), and Babyl (Emacs
RMAIL). Eventually, I plan to add support for direct sending of
IMAP accounts, and am working on a library that can read and
export Microsoft Outlook PST files.â€? (This was in December
2004. That addition may well have happened by now.)
Ë› Importing your mail
Ë› Using Pop3 with
Gmail
Ë› Imap for Gmail?
chapter
in this chapter
12 Part I â€” Starting to Use Gmail
FIGURE 2-1: Gmail Loader on Windows
Mark Lyonâ€™s own instructions (<a href="http://www.marklyon.org/gmail/instruction.htm" rel="nofollow">www.marklyon.org/gmail/instruction.htm</a>)
are perfectly good, so you donâ€™t need to walk through them here. There are some
general problems to point out, however, which are a result of the shortcomings of
the way the system has to work. Because there is no direct method to import mail
into the system, Gmail Loader (and its clones) rely on just forwarding the mail
from your existing account. This means that all date information is based on the
time the mail was received by Gmail, not on the time you originally received it
elsewhere. Thereâ€™s no real way around this, although it can be worked around if
you want to find mail from, say, one particular month: Just use the search box to
look for it, or create a filter.
Setting Up Pop Access Inside Gmail
Log in to Gmail and click on the settings link at the top-right of the screen. Once
there, click on Forwarding and Pop. You should see a screen similar to Figure 2-2.
Chapter 2 â€” Integrating Your Existing Mail 13
FIGURE 2-2: The Pop mail settings inside Gmail
Setting Up Pop Within an Application
Full instructions on setting up the Pop mail access within individual e-mail
applications are available directly from Gmail at <a href="http://gmail.google.com/" rel="nofollow">http://gmail.google.com/</a>
support/bin/answer.py?answer=12103
For expert users, the settings, shown in Table 2-1, are very simple indeed.
14 Part I â€” Starting to Use Gmail
Table 2-1 Pop Settings in Gmail
The Setting What You Set It To
Incoming Mail (POP3) Server requires SSL <a href="http://pop.gmail.com" rel="nofollow">pop.gmail.com</a>
Use SSL: Yes
Port: 995
Outgoing Mail (SMTP) Server requires TLS <a href="http://smtp.gmail.com" rel="nofollow">smtp.gmail.com</a> (use authentication)
Use Authentication: Yes
Use STARTTLS: Yes (some clients call this SSL)
Port: 465 or 587
Account Name Your Gmail username (including @gmail.com)
E-mail Address Your full Gmail e-mail address (<a href="mailto:username@gmail.com">username@gmail.com</a>)
Password Your Gmail password
IMAP for Gmail
Gmailâ€™s features, the labeling and stars specifically, do not have counterparts in the
standard e-mail world. Thereâ€™s no facility within any e-mail format to apply labels,
for example, to your mail. Itâ€™s not surprising, therefore, that there is no existing
mail application that could understand or use them. Mail exported from Gmail
does not take its label with it.
Nor once the mail has been exported can the exported copy have any effect on the
original. Moving an exported mail into a different locally stored folder doesnâ€™t
change anything on Gmail itself.
Both of these facts are, in my view, great disadvantages to the idea of offline working
with Gmail. The first is a difficult problem, but the second can be solved by
replacing the Pop interface with one based on another standard: IMAP.
Gmail does not support IMAP at the time of this writing. No matter: The second
half of this book looks at building a Gmail-to-IMAP proxy server.
And Now . . .
In this chapter, you have moved your existing mail over to Gmail, integrated
Gmail into your desktop, and looked at settings that will allow you to access
Gmail from other applications and devices. Altogether, this means that Gmail can
now be used as your primary e-mail application.
In the next chapter, you look at ways to improve how you use Gmail itself: power
tips and the tricks of the advanced user. Once you know those, you can move on
to reverse engineering Gmail and use it to power your own applications.
Gmail Power Tips
Now youâ€™ve integrated Gmail into your desktop and moved
all of your mail over into it, but before you start to rip the
application apart, you should look at the ways to use
Gmail to its limits. This chapter does just that. This book is not
just about using Gmail itself but rather hacking the application to
do other things. Nevertheless, youâ€™ll need the techniques you are
about to discover in later chapters. They are also all very useful in
their own right.
Keyboard Shortcuts
The keyboard shortcuts available within Gmail are, without any
doubt, the quickest route to speedy productivity within the application.
The time investment in learning the keyboard shortcuts of
all of your computerâ€™s applications always pays off, as you are able
to navigate your system much more quickly than before. Instead
of reaching off the keyboard, grasping the mouse, moving it to
the right place and clicking, keyboard shortcuts allow you to press
just one button. You donâ€™t lift your hands off the keyboard, and
when youâ€™re really good at typing, you donâ€™t even need to look at
the screen.
Activating the keyboard shortcuts is simple. Go to the Settings
page and turn them on there, as shown in Figure 3-1.
Ë› Keyboard shortcuts
Ë› Plus addressing
Ë› Filters
Ë› Advanced searching
chapter
in this chapter
16 Part I â€” Starting to Use Gmail
FIGURE 3-1: The keyboard shortcuts checkbox
Save the settings, and you will find that the bottom of your Inbox screen has
changed to show some of the keyboard shortcut commands, as shown in Figure 3-2.
FIGURE 3-2: The bottom of the Inbox with keyboard
shortcuts turned on
To see what keyboard shortcuts are about, press the c key now. Immediately, the
page changes to the Compose Message window, with your cursor in the To:
addressing area.Type an e-mail address, and then press Tab. Your cursor moves to
the Subject line.Type something, and hit Tab again, and youâ€™re in the message
box. So far so good. Now a snag. Hit Tab again, and then Enter, and in Internet
Explorer your message is sent. In any other browserâ€”Firefox, sayâ€”the final tab
puts your cursor up into the search box. Hitting Enter brings up a warning box
(shown in Figure 3-3) asking if you are willing to lose the newly typed, and
unsaved, message.
FIGURE 3-3: Youâ€™re about to lose your work. Eek!
You most likely donâ€™t want to do that.
Chapter 3 â€” Gmail Power Tips 17
If youâ€™re not using Internet Explorerâ€”and for the sake of this book, at least, I recommend
you do not, and employ Firefox (as I am in this chapterâ€™s screenshots) or
Mozilla insteadâ€”this is a drawback to the keyboard shortcuts. Grasp your mouse,
and click the Send button instead.
The keyboard shortcuts come into their own when dealing with spam. Figure 3-4
shows my Inbox full of the stuff.
FIGURE 3-4: An Inbox full of spam
(I have to be honest hereâ€”Gmailâ€™s spam filters caught all of this before it hit my
Inbox. I just moved it out there for the sake of this demonstration.)
If you wake to find an Inbox full of such nastiness, itâ€™s easy to get rid of. Press o to
open a message, and when it has opened, press the exclamation point (!) to mark it
as spam. By using my left hand to press the Shift+1 to make the exclamation point,
and my right hand to press o, I find I can get quite a satisfying rhythm going and
my Inbox clear in little to no time. Making â€œPow!â€? noises is also recommended.
You can, of course, use the mouse to select the ones you want and then hit an
exclamation point.
18 Part I â€” Starting to Use Gmail
The keyboard shortcuts are many and various, and are all good to know about.
But theyâ€™re also very simple. By now you should have the hang of their power.
Here then, before moving on, in Table 3-1 is a complete rundown of the keyboard
shortcuts available at the time of this writing.
Table 3-1 Gmailâ€™s Keyboard Shortcuts
Key Definition Action
c Compose Allows you to compose a new message. Shift+c
allows you to compose a message in a new
window.
/ Search Puts your cursor in the search box.
k Move to newer conversation Opens or moves your cursor to a more recent
conversation. You can hit Enter to expand a
conversation.
j Move to older conversation Opens or moves your cursor to the next oldest
conversation. You can hit Enter to expand a
conversation.
n Next message Moves your cursor to the next message. You
can hit Enter to expand or collapse a message.
(Applicable only in Conversation View.)
p Previous message Moves your cursor to the previous message.
You can hit Enter to expand or collapse a
message. (Applicable only in Conversation
View.)
Enter Open Opens your conversation. Also expands or
collapses a message if you are in Conversation
View.
u Return to conversation list Refreshes your page and returns you to the
Inbox, or list of conversations.
y Archive (Remove from current view) Automatically removes the message or
conversation from your current view.
From Inbox, y means Archive.
From Starred, y means Unstar.
From Spam, y means Unmark as spam and
move to Inbox.
From Trash, y means move to Inbox.
From any label, y means Remove the label.
Pressing y has no effect if youâ€™re in Sent or
All Mail.
Chapter 3 â€” Gmail Power Tips 19
Key Definition Action
x Select conversation Automatically checks and selects a
conversation so you can archive, apply a label,
or choose an action from the drop-down menu
to apply to that conversation.
s Star a message or conversation Adds a star to or removes a star from a
message or conversation. Stars allow you to
give a message or conversation a special status.
! Report spam Marks a message as spam and removes it from
your conversation list.
r Reply Reply to the message sender. Shift+r allows
you to reply to a message in a new window.
(Applicable only in Conversation View.)
a Reply all Reply to all message recipients. Shift+a allows
you to reply to all message recipients in a new
window. (Applicable only in Conversation View.)
f Forward Forward a message. Shift+f allows you to
forward a message in a new window.
(Applicable only in Conversation View.)
esc Escape from input field Removes the cursor from your current input
field.
Now that youâ€™re familiar with Gmailâ€™s keyboard shortcuts,Table 3-2 outlines the
combo-key shortcuts.
Table 3-2 Combo-Keys Shortcuts
Shortcut Key Definition Action
Tab then Enter Send message After composing your message, use this combination to
automatically send it. (Supported in Internet Explorer
only.)
y then o Archive and next Archive your conversation and move to the next one.
g then a Go to All Mail Takes you to All Mail, the storage place for all the mail
youâ€™ve ever sent or received, but havenâ€™t deleted.
g then s Go to Starred Takes you to all of the conversations that youâ€™ve starred.
g then c Go to Contacts Takes you to your Contacts list.
g then d Go to Drafts Takes you to all the drafts that youâ€™ve saved.
g then i Go to Inbox Takes you back to the Inbox.
20 Part I â€” Starting to Use Gmail
Moving on from the keyboard shortcuts, the next section shows you how you can
avoid them altogether by using filters.
Plus Addressing and Filtering
One little-known feature of the more old school e-mail systems is the one called
plus addressing. It can be exceptionally useful both in Gmail and in your other
e-mail systems, and I use it extensively for things such as mailing lists and weblog
commenting.
In a nutshell, Gmail ignores anything in the first half of an e-mail address after a
plus sign. So <a href="mailto:ben.hammersley+chapter_three_comments@gmail.com">ben.hammersley+chapter_three_comments@gmail.com</a> is treated
in exactly the same way as <a href="mailto:ben.hammersley@gmail.com">ben.hammersley@gmail.com</a>. It is not, as you might
expect, a different address. You can put anything after the plus sign except for a
space or an at (@) sign, and it always gets delivered to your real Inbox. Figure 3-5
should prove that it works.
FIGURE 3-5: Plus addressing in action
Plus addressing is remarkably useful, as it enables you to set up filters for your
incoming mail. In order to do set up filters, click the â€œCreate a filterâ€? link to the
right of the search bar. You will be presented with a screen containing something
very much like Figure 3-6.
Chapter 3 â€” Gmail Power Tips 21
FIGURE 3-6: The first stage in setting up a filter
Copy, as shown, the address into the To: box, and click the Next Step button. Of
course, this is how you create filters for any other part of the message as well. Iâ€™ll
leave it to the readerâ€™s intelligence to see how this works. Figure 3-7 shows the
next stage.
FIGURE 3-7: Selecting the action you want Gmail to take when a
message arrives
A filter can move, star, directly archive, label, forward, trash, or a combination of
the five, any message that triggers it. Select the actions you want, and click the
Create Filter button. Figure 3-8 shows the final result.
Because plus addressing effectively gives you an unlimited number of e-mail
addresses to the same Gmail inbox, it allows you to assign one to each mailing list,
website, and so on that you subscribe to. You can also use it to track which e-mail
addresses have been sold to spammers, and send those to Trash automatically.
Other Addressing Tips
Gmail has a few other features to its addressing. First, the dot in the middle
of most peopleâ€™s Gmail addresses is entirely optional. As Figure 3-9 shows,
<a href="mailto:benhammersley@gmail.com">benhammersley@gmail.com</a> is exactly the same as <a href="mailto:ben.hammersley@gmail.com">ben.hammersley@gmail.com</a>.
22 Part I â€” Starting to Use Gmail
FIGURE 3-8: A filter, set up
FIGURE 3-9: Receiving mail from anti-dot fanatic
Indeed, as Figure 3-10 shows, the dot is basically ignored. Put it anywhere you
like or leave it out entirely: yet another way to produce filterable e-mail addresses
inside Gmail.
Chapter 3 â€” Gmail Power Tips 23
FIGURE 3-10: The blessing of the
wandering dot
One final thing about addressing: If you are sending a mail to someone elseâ€™s
Gmail account, you neednâ€™t add the @gmail.com section of the address. Just type
the first half and it is delivered perfectly well.
Quickly Mark a Group of E-Mails
Like most desktop applications, Gmail actually allows you to mark a group of
items without having to select each one individually (by mark, I mean to put a
check in the checkbox next to an e-mail when you are presented with a list of
e-mails).With Gmail, if youâ€™d like to select a group of consecutive messages without
marking each one separately, you simply need to check the first one in the list,
and then hold down the Shift key and check the last one you want to include in
the group of marked messagesâ€”the two e-mails you checked and all of the
e-mails between them will now be marked. You can use the same method to unmark
e-mails and to star or unstar them. Note, however, that this might not work
in all browsers.
Send Executables as Attachments
When you receive an e-mail from an address that doesnâ€™t end in @gmail.com,
Gmail looks at attachments for file extensions known to be executable (such as
.dll, .exe, .vbs, and so forth), so if someone sends you one of these file types, their
message will bounce back. This goes for files within ZIP archives as wellâ€”Gmail
looks inside these for executable extensions and the e-mail bounces back to the
sender if it contains any. Gmail doesnâ€™t look inside other archive formats, such as
RAR or ACE, so you might want to use one of these formats instead of going
through the hassle of the following workaround.
To get around this annoyance, you can use the same trick that has been used for
years. Simply tell the sender to rename the extension of the file to something
Gmail will allow (such as .jpg), and when you receive the file, rename it back to
the type it really is (for example, change file.jpg to file.exe).
24 Part I â€” Starting to Use Gmail
It seems that Gmail will allow you to send and receive executable attachments
between Gmail accounts and from Gmail to outside accounts.
Advanced Searching
Gmail is run by Google, so itâ€™s obvious that its built-in search engine is going to
be extremely powerful indeed. Everyone is used to the ordinary search technique
of putting keywords into the box and pressing Enter, but not everyone is aware of
the additional operators you can use.Table 3-3 gives a rundown.
Table 3-3 Gmailâ€™s Search Operators
Operator Definition Example(s)
from: Used to specify the sender. Example: from:amy
Meaning: Messages from Amy.
to: Used to specify a recipient. Example: to:david
Meaning: All messages that were sent to
David (by you or someone else).
subject: Search for words in the Example: subject:dinner
subject line. Meaning: Messages that have the word
â€œdinnerâ€? in the subject.
OR Search for messages matching Example: from:amy OR from:david
term A or term B. Meaning: Messages from Amy or from
OR must be in all caps. David.
- Used to exclude messages Example: dinner-movie
(hyphen) from your search. Meaning: Messages that contain the word
â€œdinnerâ€? but do not contain the word
â€œmovieâ€?.
label: Search for messages by label. Example: from:amy label:friends
There isnâ€™t a search operator Meaning: Messages from Amy that have the
for unlabeled messages. label â€œfriendsâ€?.
Example: from:david label:my-family
Meaning: Messages from David that have
the label My Family.
has:attachment Search for messages with Example: from:david has:attachment
an attachment. Meaning: Messages from David that have
an attachment.
Chapter 3 â€” Gmail Power Tips 25
Operator Definition Example(s)
filename: Search for an attachment Example: filename:physicshomework.txt
by name or type. Meaning: Messages with an attachment
named physicshomework.txt.
Example: label:work filename:pdf
Meaning: Messages labeled work that also
have a PDF file as an attachment.
â€œ â€œ(quotes) Used to search for an exact Example: â€œiâ€™m feeling luckyâ€?
phrase. Meaning: Messages containing the phrase
Capitalization isnâ€™t taken into â€œiâ€™m feeling luckyâ€? or â€œIâ€™m feeling luckyâ€?.
consideration. Example: subject:â€?dinner and a movieâ€?
Meaning: Messages containing the phrase
â€œdinner and a movieâ€? in the subject.
( ) Used to group words. Example: from:amy(dinner OR movie)
Used to specify terms that Meaning: Messages from Amy that contain
shouldnâ€™t be excluded. either the word â€œdinnerâ€? or the word
â€œmovieâ€?.
Example: subject:(dinner movie)
Meaning: Messages in which the subject
contains both the word â€œdinnerâ€? and the
word â€œmovieâ€?.
in:anywhere Search for messages Example: in:anywhere subject:movie
anywhere in your account. Meaning: Messages in All Mail, Spam, and
Messages in Spam and Trash Trash that contain the word â€œmovieâ€?.
are excluded from searches
by default.
in:inbox Search for messages in Inbox, Example: in:trash from:amy
in:trash Trash, or Spam. Meaning: Messages from Amy that are in
in:spam the trash.
is:starred Search for messages that are Example: is:read is:starred from:David
is:unread starred, unread, or read. Meaning: Messages from David that have
is:read been read and are marked with a star.
cc: Used to specify recipients Example: cc:david
bcc: in the cc: or bcc: fields. Meaning: Messages that were cc-ed to
Search on bcc: cannot retrieve David.
messages on which you were
blind carbon copied.
after: Search for messages after or Example: after:2004/04/17
before: before a certain date. before:2004/04/18
Date must be in yyyy/mm/dd Meaning: Messages sent on April 17, 2004.
format. More precisely: Messages sent on or after
April 17, 2004, but before April 18, 2004.
26 Part I â€” Starting to Use Gmail
The operators detailed in Table 3-3 are all self-explanatory and can be combined.
For example, consider the following search parameters:
in:inbox from:BenHammersley â€œfancy a pint?â€?
This search would result in any message from my Gmail account, in your Inbox,
suggesting a visit to the pub. In order to bring any unread mail sent before New
Yearâ€™s Eve 2004, with an attachment, and the subject line New Yearâ€™s Eve
Invitation, you would conduct the following search:
is:unread before:2004/12/31has:attachment subject:â€?New Years Eve
Invitationâ€?
Very simple indeed.
For more information on advanced searching with Google, a good place to start is
Google For Dummies.
And Now . . .
Youâ€™ve reached the end of Chapter 3. You should feel confident using Gmail itself,
in getting your mail into and out of the system, and in using the system with some
sort of flair. From the next chapter onward, youâ€™re going to delve into Gmailâ€™s
inner workings. Things get much more technical from now on. Letâ€™s go.
Getting Inside Gmail
So, by now you should be up to speed with actually using
Gmail. Itâ€™s time to get a bit dirtier.Time to get under the
hood, so to speak, and fiddle with the application. In this
part, you look at how Gmail works and how to make it work
for you.
First, you look at skinning Gmail in Chapter 4. Making Gmail
look different might seem to be a strange thing to do, but itâ€™s
both fun and educational. The knowledge you pick up there, and
in Chapter 5 where you investigate the JavaScript-ybased workings
of the application, will enable you to fully understand how
Gmail works. In Chapter 6, you learn how Greasemonkey and
Firefox can be used to radically improve your Gmail experience
and to build your own Greasemonkey scripts.
In Chapter 7, you encounter the various programming language
libraries available for use with Gmail, and you start to use them:
writing scripts to check for and read mail (Chapters 8 and 9), and
to send replies (Chapter 10). By the end of that chapter, youâ€™ll be
writing little mini applications that use Gmail as their remote
processing system. Exciting? Oh yes!
Chapter 4
Skinning Gmail
Chapter 5
How Gmail Works
Chapter 6
Gmail and Greasemonkey
Chapter 7
Gmail Libraries
Chapter 8
Checking for Mail
Chapter 9
Reading Mail
Chapter 10
Sending Mail
in this part
part</p>

<p>Skinning Gmail
Being a web-based application, and written by people who
understand modern practices, Gmail is skinnable using a
user-side CSS file. This chapter analyzes Gmailâ€™s HTML
layout, and shows you how to create and use CSS files that will
give the application a whole new look. It wonâ€™t change the way
that Gmail works, only the way it looks, but you will learn a lot
about the way Gmail has been built: knowledge that will prove
invaluable in the following chapters.
Besides, itâ€™s really cool.
Deconstructing Gmail
In order to pack most of its functionality into a browser-side
application, Gmail employs an extremely complex page structure.
It does use CSS very heavily, happily making the styling of the
page quite simple once you understand the names of the elements,
but it also consists of at least nine iframes inside a frameset.
To make things worse, much of the markup is dynamically
created by JavaScript, meaning that just viewing the source wonâ€™t
help you.
Before you can get onto reskinning Gmail, then, you need to
deconstruct it, and see how it is put together. Only then can you
think about messing around with it.
To do that, you should use the Mozilla Firefox browser (at the
time of this writing version 1.0), and the extremely popular
Web Developer Extension, written by Chris Pederick. These
are both highly recommended, and using them will help you
to follow along at home with the rest of this section. Go to
<a href="http://www.mozilla.org">www.mozilla.org</a> and <a href="http://www.chrispederick.com/work/">www.chrispederick.com/work/</a>
firefox/webdeveloper/, respectively, and download the
applications.
Ë› Gmailâ€™s layout
Ë› The user interface
Ë› Changing colors
Ë› Changing layout
chapter
in this chapter
30 Part II â€” Getting Inside Gmail
Once youâ€™ve downloaded the applications, you can start. Figure 4-1 shows my
own Gmail Inbox with a single message inside.
The first thing to do is open up Firefoxâ€™s DOM inspector, which tells you what
the browser itself is seeing. Half expanded, it looks like Figure 4-2.
The figure shows you that the application is made up of a single document (obviously),
containing a frameset and some markup. That tiny amount of markup,
shown in Figure 4-2 as the NOSCRIPT section, is simply a message that displays
only if youâ€™re trying to look at Gmail with JavaScript turned off, telling you that
youâ€™re out of luck without JavaScript. The frameset is where itâ€™s at. It contains two
frames, the first of which has 12 divs in its body, while the second frame has a
large script element, but nothing of note in the body. Further exploration, not
shown here, will point out that the second frame contains a vast amount of
JavaScript and nothing else. That, as you will see in later chapters, makes up the
real client-side workings of Gmail. For your purposes now, however, you can concentrate
on the first frame.
So, working with the first frame, you see it is made up of 12 divs, each with its
own class name, as illustrated in Figure 4-3.
FIGURE 4-1: A simple Gmail Inbox
Chapter 4 â€” Skinning Gmail 31
FIGURE 4-2: What the DOM
inspector tells you about the Inbox
FIGURE 4-3: The first frameâ€™s structure showing
class names
Thereâ€™s a great deal going on here, much of which will be revisited over the
course of this book. For now, you need to keep drilling down to the interface itself.
32 Part II â€” Getting Inside Gmail
To see which of these divs is the mother lode, use the Web Developer Extension
to Firefox to turn off the styling (click on the Disable menu, the first on the left,
and then Disable Styles), outline the block level elements in red, and display
their names. Doing this, you get the horrible Figure 4-4.
Itâ€™s very plain from Figure 4-4 that the div called d_tlist2 is the one youâ€™re
really interested in. Itâ€™s the one that isnâ€™t empty, which is something of a giveaway.
Using the DOM inspector, you can drill down further. Notice that d_tlist2
contains an iframe, called tlist, and that that iframe, when opened in a new
DOM inspector, looks like Figure 4-5.
You can also see from the DOM inspector that the iframe that makes
up this interface is addressed as follows: <a href="http://gmail.google">http://gmail.google</a>.
com/gmail?search=inbox&amp;view=tl&amp;start=0&amp;init=1&amp;zx=3177c401850460
90895581735.
FIGURE 4-4: Gmail with no styling . . . quite ugly
Chapter 4 â€” Skinning Gmail 33
FIGURE 4-5: Gmailâ€™s Inbox exposed in
the DOM inspector
Ferret that bit of information away for the moment. It will come in handy.
Meanwhile, back at the browser, you can dump the contents of this page from
the DOM inspector to a text editor. Remember that although this all seems a bit
long-winded, you cannot do it just by using View Source: Most of the markup is
created by JavaScript, and youâ€™ll get to see only some of the JavaScript if you do
that. You needed to use the DOM inspector to get to the actual code that the
browser is rendering and displaying on your screen. Rather than subject you, dear
readers, to the horrors of 14 pages of HTML here, Iâ€™ve placed the entire listing in
Appendix A. Before moving on to the style sheetâ€™s nuts and bolts, consider turning
to Appendix A and perusing Listing A-1 first.
To make things a bit easier, let me strip out the JavaScript and isolate the style
sheet, tidy the whole thing up a bit, and walk through the document showing you
what each section does. From the top, then.
The Top Section
Figure 4-6 shows the top section of the Gmail Inbox, with the table elements artificially
outlined with dotted lines.
FIGURE 4-6: The Gmail Inboxâ€™s top section, showing table elements
34 Part II â€” Getting Inside Gmail
In the code, the top section of the Inbox is produced by the following HTML,
shown in Listing 4-1.
Listing 4-1: The Top Section of the Gmail Inbox in HTML
&lt;body&gt;
&lt;table width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€?&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td width=â€?149â€? valign=â€?topâ€? rowspan=â€?2â€?&gt;
&lt;div id=â€?ds_inboxâ€? style=â€?padding-top: 1ex;â€? class=â€?hâ€?&gt;
&lt;img width=â€?143â€? height=â€?59â€? src=
â€œ/gmail/help/images/logo.gifâ€?&gt;&lt;/div&gt;&lt;/td&gt;
&lt;td valign=â€?topâ€? align=â€?rightâ€?&gt;
&lt;div class=â€?sâ€? style=â€?padding-bottom: 2px; text-align:
right;â€?&gt;
&lt;b&gt;ben.hammersley@gmail.com&lt;/b&gt; | &lt;span id=â€?prf_gâ€? class=
â€œlkâ€?&gt;Settings&lt;/span&gt; | &lt;a target=â€?_blankâ€? href=â€?/support/â€?
class=â€?lcâ€? id=â€?helpâ€?&gt;Help&lt;/a&gt; | &lt;a target=â€?_topâ€? onclick=
â€œreturn top.js._Main_OnLink(window,this,event)â€? class=â€?lkâ€?
href=â€œ?logoutâ€?&gt;Sign out&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td valign=â€?bottomâ€?&gt;
&lt;div class=â€?sâ€? id=â€?mt1â€?&gt;
&lt;table cellspacing=â€?0â€? cellpadding=â€?0â€?&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td valign=â€?bottomâ€?&gt;
&lt;form onsubmit=â€?return top.js._MH_OnSearch(window,0)â€? style=
â€œpadding-bottom: 5px; white-space: nowrap;â€? class=â€?sâ€? id=â€?sâ€?&gt;
&lt;input value=â€?â€? name=â€?qâ€? maxlength=â€?2048â€? size=â€?28â€?&gt; Â 
&lt;input type=â€?submitâ€? value=â€?Search Mailâ€?&gt; Â 
&lt;input type=â€?submitâ€? onclick=
â€œreturn top.js._MH_OnSearch(window,1)â€? value=
â€œSearch the Webâ€?&gt; Â &lt;/form&gt;&lt;/td&gt;
&lt;td&gt;
&lt;table cellspacing=â€?0â€? cellpadding=â€?0â€? style=
â€œvertical-align: top; padding-bottom: 4px;â€?&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;span id=â€?mt_advâ€? style=â€?font-size: 65%;â€? class=
â€œlkâ€?&gt;ShowÂ searchÂ options&lt;/span&gt;
Â Â &lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
Chapter 4 â€” Skinning Gmail 35
&lt;td&gt;&lt;span id=â€?mt_cf1â€? style=â€?font-size: 65%; vertical-align:
top;â€?
class=
â€œlkâ€?&gt;CreateÂ aÂ filter&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table
&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;
&lt;div style=
â€œheight: 2.1ex; padding-right: 149px; visibility: hidden;â€?
class=â€?ntâ€? id=â€?nt1â€?&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
As you can see, the HTML uses tables, divs, and spans, and takes its styling from
both the style sheet and some inline styling as well. This means that you must
forcibly override some of their styling using the !important modifier. More on
that in a few pages.
So, going from left to right, the Gmail logo is marked up with a div with an id of
ds_inbox and a class of h. Looking in the style sheet, notice that this class merely
changes the shape of your mouse pointer when you mouse over it. No styling there
as such, but plenty of opportunity to remove the Gmail logo and add your own.
Moving over, my e-mail address and the links to the Settings, Help, and Sign Out
buttons are all contained within an unnamed div, with a class of s. From the style
sheet, you can see that s simply sets the font size to 80 percent. So thereâ€™s scope
here for styling, but not specifically this section. Nor can you really move it around.
That row is the top half of a table. The bottom half of the table has another table
nesting inside it (and another nesting inside that one, as you shall see).
The outermost of those tables is split in two, with the left-hand side containing
the search form, and the right-hand side containing the innermost table, which
splits it into two rows. The top row, a span called mt_adv, acts as a link, showing
the search options. The cunning way in which this JavaScript works is dealt with
in Chapter 5.
The bottom row is another span called mt_cf1, which opens the filter creation
box. After that, the code closes the table and the surrounding div.
The Navigation Menu
After two divs with no content, we come to the div called nav, which contains the
entire navigation menu from the left of the screen, as in Figure 4-7.
36 Part II â€” Getting Inside Gmail
FIGURE 4-7: The Gmail
navigation menu
The code that produces this import part of the page is here, in Listing 4-2.
Listing 4-2: The HTML That Produces the Gmail Navigation Menu
&lt;div style=â€?padding-bottom: 1px;â€? id=â€?mt2â€?&gt;
&lt;div class=â€?ntâ€? id=â€?nt2â€? style=â€?display: none;â€?&gt;
&lt;div id=â€?navâ€? style=â€?position: absolute; left: 1ex; width:
14ex;â€?&gt;
&lt;div class=â€?nlâ€?&gt;&lt;span id=â€?compâ€? class=â€?lkâ€?&gt;&lt;b&gt;Compose
Mail&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=â€?padding-top: 9px;â€?&gt;
&lt;table cellspacing=â€?0â€? cellpadding=â€?0â€? border=â€?0â€? style=
â€œbackground: rgb(195, 217, 255) none repeat scroll 0%; -mozbackground-
clip: initial; -moz-background-origin: initial;
-moz-background-inline-policy: initial;â€?
class=â€?cvâ€?&gt;
&lt;tbody&gt;
&lt;tr height=â€?2â€?&gt;
&lt;td width=â€?8â€? class=â€?tlâ€?&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;td&gt;&lt;span id=â€?ds_inboxâ€? class=â€?lk bâ€?&gt;&lt;b&gt;Inbox
(1)&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr height=â€?2â€?&gt;
&lt;td class=â€?blâ€?&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
&lt;div class=â€?nlâ€?&gt;&lt;span id=â€?ds_starredâ€? class=â€?lkâ€?&gt;Starred
&lt;img width=â€?13â€? height=â€?13â€? src=
â€œ/gmail/images/star_on_sm_2.gifâ€? id=â€?_ssâ€?&gt;&lt;/span&gt;&lt;/div&gt;
Chapter 4 â€” Skinning Gmail 37
&lt;div class=â€?nlâ€?&gt;&lt;span id=â€?ds_sentâ€? class=â€?lkâ€?&gt;Sent
Mail&lt;/span&gt;&lt;/div&gt;
&lt;div class=â€?nlâ€?&gt;&lt;span id=â€?ds_draftsâ€?
class=â€?lkâ€?&gt;Drafts&lt;/span&gt;&lt;/div&gt;
&lt;div class=â€?nlâ€?&gt;&lt;span id=â€?ds_allâ€? class=â€?lkâ€?&gt;All
Mail&lt;/span&gt;&lt;/div&gt;
&lt;div class=â€?nlâ€?&gt;&lt;span id=â€?ds_spamâ€?
class=â€?lkâ€?&gt;Spam&lt;/span&gt;&lt;/div&gt;
&lt;div class=â€?nlâ€?&gt;&lt;span id=â€?ds_trashâ€? class=
â€œlkâ€?&gt;Trash&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div style=â€?padding-top: 8px;â€?&gt;
&lt;div class=â€?nlâ€?&gt;&lt;span id=â€?contâ€? class=
â€œlkâ€?&gt;&lt;b&gt;Contacts&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div id=â€?nb_0â€? style=â€?padding-top: 8px;â€?&gt;
&lt;div style=â€?width: 95%;â€?&gt;
&lt;table width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€? bgcolor=
â€œ#B5EDBCâ€?&gt;
&lt;tbody&gt;
&lt;tr height=â€?2â€?&gt;
&lt;td class=â€?tlâ€?&gt;
&lt;td class=â€?trâ€?&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
&lt;div style=
â€œpadding: 0pt 3px 1px; background: rgb(181, 237, 188) none
repeat scroll 0%; -moz-background-clip: initial; -mozbackground-
origin: initial; -moz-background-inline-policy:
initial;â€?&gt;
&lt;div id=â€?nt_0â€? class=â€?s hâ€?&gt;&lt;img width=â€?11â€? height=â€?11â€? src=
â€œ/gmail/images/opentriangle.gifâ€?&gt; Labels&lt;/div&gt;
&lt;table cellspacing=â€?2â€? class=â€?nbâ€?&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;div align=â€?rightâ€? id=â€?prf_lâ€? class=â€?lk csâ€?&gt;
EditÂ labels&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;
&lt;table width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€? bgcolor=
â€œ#B5EDBCâ€?&gt;
&lt;tbody&gt;
&lt;tr height=â€?2â€?&gt;
&lt;td class=â€?blâ€?&gt;
&lt;td class=â€?brâ€?&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div id=â€?nb_2â€? style=â€?padding-top: 7px;â€?&gt;
&lt;div style=â€?padding-top: 7px;â€? class=â€?sâ€?&gt;&lt;span style=
â€œcolor: rgb(170, 0, 0);â€? class=â€?ilcâ€? id=â€?ilâ€?&gt;Invite 4
friends&lt;br&gt;
to Gmail&lt;/span&gt; Â &lt;/div&gt;&lt;/div&gt;
38 Part II â€” Getting Inside Gmail
Youâ€™ll notice when you read through this code that what look like links (the
Inbox, Starred, Sent Mail, and so on) actually arenâ€™t. Theyâ€™re just plain text
wrapped in spans that provide just enough styling to make them look like links:
Theyâ€™re underlined, the mouse pointer changes, and so on. This is just another
symptom of how cunning the Gmail application is. Iâ€™ll be explaining all of this in
Chapter 5. Just so you know.
The styling is simple here. After the Compose Message link (thatâ€™s not, as I just
said, a link in the sense of &lt;a href=â€?â€?&gt;&lt;/a&gt; but rather just the plain text styled
up to look like one), thereâ€™s a table containing only the Inbox link and new mail
count and then a succession of divs with class nl, containing spans with each of
the menu options.
Then thereâ€™s another non-link link to the Contacts functionality, and another table
used to produce the label box.With labels defined, as you will see later, this table
has more content. Finally, after the table, is a div called il containing the invitation
link. (My bet is that il stands for Invitation Link, but ignorance of such things
is the mark of the reverse engineer.) As you will have noticed by now, Gmail is
built with very small names for all of the divs and spans. This is also true of the
JavaScript functions covered in the next chapter. This is because Gmail is serving
these pages millions of times a day, and the bandwidth saved by dropping everything
down to one- or two-letter variable names is well worth the obfuscation.
Onward, then, to the real meat of the page.
The Activity Area
Right in the middle of the page, surrounded with a blue border, is what Iâ€™ll call
the central activity area. Itâ€™s in this section that the majority of your work within
Gmail is done: writing and reading mail, for example. It looks like Figure 4-8.
FIGURE 4-8: The central activity area
Chapter 4 â€” Skinning Gmail 39
The central activity area is controlled by the code in Listing 4-3.
Listing 4-3: The Central Activity Area in HTML
&lt;div style=â€?margin-left: 14ex;â€? id=â€?coâ€?&gt;
&lt;div id=â€?tc_topâ€?&gt;
&lt;table width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€? bgcolor=
â€œ#C3D9FFâ€?&gt;
&lt;tbody&gt;
&lt;tr height=â€?2â€?&gt;
&lt;td class=â€?tlâ€?&gt;
&lt;td class=â€?trâ€?&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
&lt;table width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€? style=
â€œbackground: rgb(195, 217, 255) none repeat scroll 0%; -mozbackground-
clip: initial; -moz-background-origin: initial;
-moz-background-inline-policy: initial;â€?
class=â€?thâ€?&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td width=â€?8â€?&gt;
&lt;td&gt;&lt;button style=â€?font-weight: bold;â€? id=â€?ac_rc_^iâ€?
class=â€?abâ€?
type=â€?buttonâ€?&gt;Archive&lt;/button&gt; Â Â  &lt;button style=
â€œwidth: 8em; text-align: center;â€? id=â€?ac_spâ€? class=â€?abâ€?
type=â€?buttonâ€?&gt;ReportÂ Spam&lt;/button&gt; Â  &lt;select
id=
â€œtamuâ€? onchange=
â€œtop.js._TL_OnActionMenuChange(window,this)â€? onfocus=
â€œreturn
top.js._TL_MaybeUpdateActionMenus(window,this)â€?
onmouseover=
â€œreturn
top.js._TL_MaybeUpdateActionMenus(window,this)â€?
style=â€?vertical-align: middle;â€?&gt;
&lt;option style=â€?color: rgb(119, 119, 119);â€? id=â€?macâ€?&gt;More
Actions
...&lt;/option&gt;
&lt;option style=â€?color: rgb(119, 119, 119);â€? disabled id=â€?nilâ€?&gt;
--------&lt;/option&gt;
&lt;option style=â€?color: rgb(119, 119, 119);â€? disabled
id=â€?alâ€?&gt;Apply
label:&lt;/option&gt;
&lt;option value=â€?newâ€?&gt;Â Â Â New
label...&lt;/option&gt;&lt;/select&gt; Â Â  &lt;span id=â€?refreshâ€?
class=â€?lkâ€?&gt;Refresh&lt;/span&gt;&lt;/td&gt;
&lt;td align=â€?rightâ€?&gt;Â  &lt;span style=
Continued
40 Part II â€” Getting Inside Gmail
Listing 4-3 (continued)
â€œwhite-space: nowrap;â€?&gt;&lt;b&gt;1&lt;/b&gt; - &lt;b&gt;1&lt;/b&gt; of
&lt;b&gt;1&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;
&lt;td width=â€?4â€?&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;td valign=â€?bottomâ€? style=â€?padding-top: 3px;â€?
colspan=â€?2â€?&gt;Select:
&lt;span id=â€?sl_aâ€? class=â€?lâ€?&gt;All&lt;/span&gt; , &lt;span id=â€?sl_râ€? class=
â€œlâ€?&gt;Read&lt;/span&gt; , &lt;span id=â€?sl_uâ€? class=â€?lâ€?&gt;Unread&lt;/span&gt; ,
&lt;span id=â€?sl_sâ€? class=â€?lâ€?&gt;Starred&lt;/span&gt; , &lt;span id=â€?sl_tâ€?
class=â€?lâ€?&gt;Unstarred&lt;/span&gt; , &lt;span id=â€?sl_nâ€? class=
â€œlâ€?&gt;None&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr height=â€?3â€?&gt;
&lt;td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;
&lt;div style=â€?border-left: 9px solid rgb(195, 217, 255);â€?&gt;
&lt;div id=â€?tbdâ€?&gt;
&lt;form target=â€?histâ€? method=â€?postâ€? name=â€?afâ€? action=
â€œ/gmail?search=inbox&amp;amp;view=tl&amp;amp;start=0â€?&gt;&lt;input
type=â€?hiddenâ€?
name=â€?actâ€?&gt; &lt;input type=â€?hiddenâ€? name=â€?atâ€?&gt; &lt;input
type=â€?hiddenâ€?
name=â€?vpâ€?&gt;
&lt;table width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?1â€? id=â€?tbâ€?
class=â€?tlcâ€?&gt;
&lt;col style=â€?width: 31px; text-align: right;â€?&gt;
&lt;col style=â€?width: 20px;â€?&gt;
&lt;col style=â€?width: 24ex;â€?&gt;
&lt;col style=â€?width: 2ex;â€?&gt;
&lt;col&gt;
&lt;col style=â€?width: 17px;â€?&gt;
&lt;col style=â€?width: 8ex;â€?&gt;
&lt;tbody&gt;
&lt;tr id=â€?w_0â€? class=â€?urâ€?&gt;
&lt;td align=â€?rightâ€?&gt;&lt;input type=â€?checkboxâ€?&gt;&lt;/td&gt;
&lt;td&gt;&lt;img src=â€?/gmail/images/star_off_2.gifâ€?&gt;&lt;/td&gt;
&lt;td&gt;&lt;span id=â€?_user_ben@benhammersley.comâ€?&gt;&lt;b&gt;Ben
Hammersley&lt;/b&gt;&lt;/span&gt; (2)&lt;/td&gt;
&lt;td&gt;Â &lt;/td&gt;
&lt;td&gt;&lt;b&gt;Skinning Gmail? Thatâ€™s so cool!&lt;/b&gt; &lt;span class=â€?pâ€?&gt;-
BEGIN
PGP SIGNED MESSAGE-- Hash: SHA1 la la la --BEGIN PGP
SIGNATURE--
Version: GnuPG v1 â€¦&lt;/span&gt;&lt;/td&gt;
&lt;td&gt;Â &lt;/td&gt;
&lt;td&gt;&lt;b&gt;2:29pm&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/form&gt;
Chapter 4 â€” Skinning Gmail 41
&lt;div style=â€?padding: 0pt 20px;â€? class=â€?s câ€?&gt;&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;img width=â€?9â€? height=â€?11â€? src=â€?/gmail/images/chevron.gifâ€?
style=â€?position: absolute; display: none;â€? id=â€?arâ€?&gt;
&lt;div id=â€?tc_botâ€?&gt;
&lt;table width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€? style=
â€œbackground: rgb(195, 217, 255) none repeat scroll 0%; -mozbackground-
clip: initial; -moz-background-origin: initial;
-moz-background-inline-policy: initial;â€?
class=â€?thâ€?&gt;
&lt;tbody&gt;
&lt;tr height=â€?2â€?&gt;
&lt;td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td width=â€?8â€?&gt;
&lt;td&gt;Select: &lt;span id=â€?sl_aâ€? class=â€?lâ€?&gt;All&lt;/span&gt; , &lt;span
id=â€?sl_râ€?
class=â€?lâ€?&gt;Read&lt;/span&gt; , &lt;span id=â€?sl_uâ€?
class=â€?lâ€?&gt;Unread&lt;/span&gt; ,
&lt;span id=â€?sl_sâ€? class=â€?lâ€?&gt;Starred&lt;/span&gt; , &lt;span id=â€?sl_tâ€?
class=â€?lâ€?&gt;Unstarred&lt;/span&gt; , &lt;span id=â€?sl_nâ€? class=
â€œlâ€?&gt;None&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr height=â€?4â€?&gt;
&lt;td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;td&gt;&lt;button style=â€?font-weight: bold;â€? id=â€?ac_rc_^iâ€?
class=â€?abâ€?
type=â€?buttonâ€?&gt;Archive&lt;/button&gt; Â Â  &lt;button style=
â€œwidth: 8em; text-align: center;â€? id=â€?ac_spâ€? class=â€?abâ€?
type=â€?buttonâ€?&gt;ReportÂ Spam&lt;/button&gt; Â  &lt;select
id=
â€œbamuâ€? onchange=
â€œtop.js._TL_OnActionMenuChange(window,this)â€? onfocus=
â€œreturn
top.js._TL_MaybeUpdateActionMenus(window,this)â€?
onmouseover=
â€œreturn
top.js._TL_MaybeUpdateActionMenus(window,this)â€?
style=â€?vertical-align: middle;â€?&gt;
&lt;option style=â€?color: rgb(119, 119, 119);â€? id=â€?macâ€?&gt;More
Actions
Continued
42 Part II â€” Getting Inside Gmail
Listing 4-3 (continued)
...&lt;/option&gt;
&lt;option style=â€?color: rgb(119, 119, 119);â€? disabled id=â€?nilâ€?&gt;
--------&lt;/option&gt;
&lt;option style=â€?color: rgb(119, 119, 119);â€? disabled
id=â€?alâ€?&gt;Apply
label:&lt;/option&gt;
&lt;option value=â€?newâ€?&gt;Â Â Â New
label...&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;</p>

<h5>&lt;td align=â€?rightâ€?&gt;&lt;span style=â€?white-space: nowrap;â€?&gt;&lt;b&gt;1&lt;/b&gt;</h5>

<p>&lt;b&gt;1&lt;/b&gt; of &lt;b&gt;1&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;
&lt;td width=â€?4â€?&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
&lt;table width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€? bgcolor=
â€œ#C3D9FFâ€?&gt;
&lt;tbody&gt;
&lt;tr height=â€?2â€?&gt;
&lt;td class=â€?blâ€?&gt;
&lt;td class=â€?brâ€?&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;
This code is also quite complicated, but working through it is just a matter of
looking through the code for the class and id attributes and noting the tables in
the middle. By now, you should be quite good at this, so you wonâ€™t do that here.
The next section, after all, provides a map of all of the classes and ids you need.
The Bottom Section
Now we come to the last remaining section of the Gmail screen: the bottom of
the screen, as shown in Figure 4-9. Again, the drudgework is left out here; you
see only the code. In the tradition of software textbooks, the figuring out of the
names of the divs and spans within the bottom section is left as an exercise to the
reader. Listing 4-4 shows you the code if you want to do this, or you can skip past
Listing 4-4 to Figure 4-10, which outlines the whole pageâ€™s structure in CSS.
FIGURE 4-9: The bottom section of the screen
Chapter 4 â€” Skinning Gmail 43
Listing 4-4: The Bottom Section of the Screen in HTML
&lt;div style=â€?padding: 0ex 14ex;â€? id=â€?ftâ€?&gt;
&lt;div style=â€?margin-top: 20px;â€? class=â€?c sâ€?&gt;Use the &lt;span
id=â€?fsbâ€?
style=
â€œcolor: rgb(0, 0, 204); text-decoration: underline; cursor:
pointer; white-space: nowrap;â€?&gt;
search&lt;/span&gt; box or &lt;span id=â€?mt_advâ€? style=
â€œcolor: rgb(0, 0, 204); text-decoration: underline; cursor:
pointer; white-space: nowrap;â€?&gt;
search options&lt;/span&gt; to find messages quickly!&lt;/div&gt;
&lt;div style=â€?margin-top: 12px; color: rgb(0, 102, 51);â€? class=
â€œc s bâ€?&gt;You are currently using 0 MB (0%) of your 1000
MB.&lt;/div&gt;
&lt;div style=â€?margin-top: 4px;â€? class=â€?c xsâ€?&gt;
&lt;div&gt;&lt;a href=â€?/gmail/help/terms_of_use.htmlâ€? target=â€?_blankâ€?
class=â€?lcâ€?&gt;TermsÂ ofÂ Use&lt;/a&gt; - &lt;a href=
â€œ/gmail/help/privacy.htmlâ€? target=â€?_blankâ€? class=
â€œlcâ€?&gt;PrivacyÂ Policy&lt;/a&gt; - &lt;a href=
â€œ/gmail/help/program_policies.htmlâ€? target=â€?_blankâ€? class=
â€œlcâ€?&gt;ProgramÂ Policies&lt;/a&gt; - &lt;a href=
â€œhttp://www.google.com/â€? target=â€?_blankâ€? class=â€?lcâ€? id=
â€œgooghâ€?&gt;GoogleÂ Home&lt;/a&gt;&lt;/div&gt;
&lt;div style=â€?color: rgb(68, 68, 68); margin-top: 4px;â€?&gt;
Â©2004Â Google&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;script type=â€?text/javascriptâ€?&gt;
var fp=â€™9cf0974955f546daâ€™;
&lt;/script&gt;&lt;script type=â€?text/javascriptâ€?&gt;
var loaded=true;D([â€˜eâ€™]);
&lt;/script&gt;&lt;script type=â€?text/javascriptâ€?&gt;
try{top.js.L(window,45,â€™f4ba224ac4â€™);}
catch(e){}
&lt;/script&gt;
&lt;div id=â€?tipâ€? style=
â€œborder-style: outset; border-width: 1px; padding: 2px;
background: rgb(255, 255, 221) none repeat scroll 0%;
position: absolute; -moz-background-clip: initial; -mozbackground-
origin: initial; -moz-background-inline-policy:
initial; left: 309px; top: 125px; display: none;â€?&gt;
&lt;center&gt;&lt;small&gt;ben@benhammersley.com&lt;/small&gt;&lt;/center&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
44 Part II â€” Getting Inside Gmail
So, now you have worked your way through each of the separate sections of the
Gmail layout, and you should have a good idea of the structure of the page and
how it is produced by the HTML.
Why, you might ask have you just gone through 20 pages of gritty DOM inspection
and poring over code? Because, and you have to trust me on this, Gmailâ€™s
workings are almost entirely contained in that ungodly lump of framesets and
JavaScript. Over the majority of the rest of the book, you will spend your time
embedded in the depths of this code, so itâ€™s extremely useful to jump off into the
deep end, as it were.
Applying a New Style
Now that youâ€™ve slogged your way through the structure of the Gmail markup,
you can use this knowledge to give the application a new look. First, however, you
will need to install another extension to Firefox. You need the URIid extension
written by Chris Neale, found at <a href="http://extensionroom.mozdev.org/moreinfo/">http://extensionroom.mozdev.org/moreinfo/</a>
uriid.
Once that is installed, go to your Profile folder.With Firefox, which is the browser
Iâ€™m recommending for this chapter, the location of the Profile folder changes per
operating system. Look at <a href="http://www.mozilla.org/support/firefox/edit">www.mozilla.org/support/firefox/edit</a>.
html#profile for the official reference. Once inside the Profile folder, you will be
adding the CSS you are about to write to the userContent.css file inside the
chrome subdirectory.
Open the userContent-example.css file, and rename it as userContent.css.
You can now add any CSS you like, and have it affect the pages you are applying
them to. You differentiate between the sites you want it to act upon by appending
the base URL as a class. For example, to apply styles to Gmail, the ID gmailgoogle-
com will be added to the body. The style sheet can then use the</p>

<h4>gmail-google-com selector to apply styles only to that site. Once the CSS</h4>

<p>file is saved, restart Firefox, and your styles will take hold.
Creating Gmail Lite
During the course of my working day, I spend most of my time looking at my
computerâ€™s screen. After a while, I yearn for calmer pages, with less to focus on.
As I use Gmail a lot of the time, itâ€™s good to use the knowledge worked out in the
preceding text to restyle the page into something easier to look at after a hard day.
Figure 4-10 shows this newly styled Gmail, Gmail Lite.
Chapter 4 â€” Skinning Gmail 45
FIGURE 4-10: Gmail Lite
As you can see, itâ€™s a much simpler page layout, with no images, a muted color
scheme, and without the labels, invitation link, and other superfluous material that
just irritates after a dayâ€™s writing. Itâ€™s a minimalist Gmail whose styles are covered
in the next section.
Walking Through the Style Sheet
The effects you see in Figure 4-10 are simple to achieve with a style sheet, and
certainly much more impressive ones can be achieved by someone with more
design skill than myself.
Begin with the following CSS:
body#gmail-google-com {
background-color: #ffffff !important;
}
body#gmail-google-com img{
display: none !important;
}
/* regular links <em>/
46 Part II â€” Getting Inside Gmail
body#gmail-google-com span.lk,
body#gmail-google-com a.lc,
body#gmail-google-com a.lk
{
text-decoration: none !important;
color: #191b4c !important;
}
/</em> The Search Form <em>/
body#gmail-google-com div#mt1 form{
display: none !important;
}
body#gmail-google-com div#mt1 table{
display: none !important;
}
This code starts by declaring the background color of the whole page to be white,
and then turning off any images by setting them to display:none. This CSS
command is extremely useful for stripping sites of dullness, as you can see, after
the section giving the links and pseudo-links on the page a nice dark blue color.
From the previous section, you already know that the Gmail logo and the search
box are held in a table and a form, inside a div called mt1. By setting both of these
to display:none, you remove them entirely.
The next section of CSS is as follows:
/</em>------------------------------------------------------------
<em>/
/</em>The Navigation Menu <em>/
body#gmail-google-com span#comp {
font-family: cursive;
}
/</em> sidebar links <em>/
body#gmail-google-com div#nav table.cv,
body#gmail-google-com div#nav table.cv td {
background: #ffffff !important;
}
body#gmail-google-com table.cv td.tl,
body#gmail-google-com table.cv td.bl {
height: 0 !important;
Chapter 4 â€” Skinning Gmail 47
}
/</em> both current and other <em>/
body#gmail-google-com table.cv td span.lk,
body#gmail-google-com div.nl span.lk{
display: block !important;
background: #ffffff !important;
color: #191b4c;
border: none !important;
padding: 2px !important;
margin-right: 5px !important;
}
/</em> Override the background color for the unselected options<em>/
body#gmail-google-com div.nl span.lk {
background: #ffffff !important;
border: none !important;
}
/</em> For the mouse-over color change <em>/
body#gmail-google-com div.nl span.lk:hover {
background: #d3cbb8 !important;
border-color: #fef759 !important;
}
/</em> hide â€œNew!â€? super-script <em>/
body#gmail-google-com div#nav sup {
display: none !important;
}
/</em> remove the colored left border of the inbox <em>/
body#gmail-google-com div#co div {
border: 0 !important;
}
/</em>-------------------------------------------------------<em>/
This section of the CSS file deals with the navigation sidebar. It did look like
Figure 4-7, but now itâ€™s a great deal simpler. The link color change at the top of
the CSS takes care of the color, so the first thing you do is restyle the font for
the Compose Mail link. You know that this has an id of comp, so you set the
font-family: cursive. This will, in compatible browsers, choose the default
cursive typeface.
Next you override the background colors and borders of the menu items and
finally remove the light blue edge of the application area that stretches from the
48 Part II â€” Getting Inside Gmail
active menu option in the normal view. Itâ€™s much simpler now. Having manipulated
these elements, consider this CSS:
/</em> labels <em>/
body#gmail-google-com div#nb_0 {
display: none !important;
}
/</em> The Invitation Link <em>/
body#gmail-google-com #il {
display: none !important;
}
/</em> The footer <em>/
body#gmail-google-com div#ft {
display: none !important;
}
These three short sections turn off the labels, the invitation link, and the whole
footer section.Weâ€™re almost Zen-like now. Final stop: the application area:
/</em>------------------------------------------------------------
<em>/
/</em> THE APPLICATION AREA <em>/
/</em> top bar <em>/
body#gmail-google-com div#tc_top table,
body#gmail-google-com div#tc_top table td.tl,
body#gmail-google-com div#tc_top table td.tr,
body#gmail-google-com div#tc_top table.th,{
background: #ffffff !important;
border: none !important;
padding: 2px !important;
margin: 5px 0 5px 0 !important;
}
/</em> bottom bar<em>/
body#gmail-google-com div#tc_bot table,
body#gmail-google-com div#tc_bot table td.bl,
body#gmail-google-com div#tc_bot table td.br,
body#gmail-google-com div#tc_bot table.th{
display: none !important;
}
/</em> selection links in bar <em>/
body#gmail-google-com div#co div#tc_top span.l{
color: #191b4c !important;
}
Chapter 4 â€” Skinning Gmail 49
/</em> mailbox contents <em>/
body#gmail-google-com div#co div#tbd {
background: #ffffff !important;
border: none !important;
padding: 4px 0 4px 0 !important;
}
/</em> unread mail row inside the inbox <em>/
body#gmail-google-com table.tlc tr.ur {
background-color: #d7d7d7 !important;
height: 30px;
}
/</em>read mail row inside the inbox <em>/
body#gmail-google-com table.tlc tr.rr {
background-color: #ffffff !important;
}
body#gmail-google-com table.tlc tr.ur td,
body#gmail-google-com table.tlc tr.rr td{
border: 0 !important;
}
/</em> message hovering snippet expansion <em>/
body#gmail-google-com table.tlc tr.ur:hover,
body#gmail-google-com table.tlc tr.rr:hover{
background-color: #ffffff !important;
}
body#gmail-google-com table.tlc tr.ur:hover td,
body#gmail-google-com table.tlc tr.rr:hover td{
border: none !important;
vertical-align: top !important;
}
body#gmail-google-com table.tlc tr.ur:hover .sn,
body#gmail-google-com table.tlc tr.rr:hover .sn{
display: block !important;
white-space: normal !important;
}
/</em> and email address display <em>/
body#gmail-google-com table.tlc tr.ur:hover td span,
body#gmail-google-com table.tlc tr.rr:hover td span {
display: block; !important;
color: #ff0000;
}
/</em> labels should still be inline <em>/
50 Part II â€” Getting Inside Gmail
body#gmail-google-com table.tlc tr.ur:hover td span.ct,
body#gmail-google-com table.tlc tr.rr:hover td span.ct{
display: inline;
}
body#gmail-google-com table.tlc tr.ur:hover td span[id]:after,
body#gmail-google-com table.tlc tr.rr:hover td span[id]:after{
content: attr(id);
display: block;
margin-left: -38px; /</em> hack to hide â€œuser_â€? id prefix <em>/
color: #b6af9e;
}
/</em>-----------------------------------------------------------
<em>/
The first thing to notice is that you turned off the bottom button bar. Thereâ€™s no
need to have two, and you have one at the top already. Then you recolor the links
within the top bar.
The next section colors the background of the application white and removes the
solid borders. Then you have two bits of CSS: You define the background color of
the rows for each message within the mailbox that is being viewed.Within the
Inbox, these lines of CSS put a gray background behind unread mail, and a white
background behind read mail (see Figure 4-11).
FIGURE 4-11: The new style sheet applied
Chapter 4 â€” Skinning Gmail 51
The rest of the code deals with the physical layout of the application area, especially
removing the borders. If you want to see the CSS listing in its entirety, flip
to Appendix A and check out Listing A-2.
Thanks for the basis for this style sheet must go to Mihai Parparita, who released
the original underneath the Creative Commons Attribution-ShareAlike license at
<a href="http://persistent.info/archives/2004/10/05/gmail-skinning">http://persistent.info/archives/2004/10/05/gmail-skinning</a>. Now
that you have your new style sheet applied, you can get down to the business of
ridding Gmail of advertising.
Removing Googleâ€™s Advertising
Gmail is advertising-supported, and Googleâ€™s advertising is in no way intrusive,
and can be very useful. But if youâ€™re totally against the concept, and serene within
your soul about the idea of using a service without the quid pro quo, it is entirely
possible to remove the advertising using the techniques in this chapter. The advertising
is contained entirely within a div called ad, so the code in Listing 4-5 turns
off advertising.
I do not recommend you use this code to turn off advertising, but I include it
regardless and leave the determination to you.
Listing 4-5: Turning Off Googleâ€™s Advertising with CSS
/</em> Adverts <em>/
body#gmail-google-com div#ad {
display: none !important;
}
And Now . . .
In this chapter, you explored how Gmail is structured and saw that the entire
interface is loaded into a complex selection of frames. You learned how to change
the styling of this interface, and while doing so saw a lot of the interface code. You
52 Part II â€” Getting Inside Gmail
should be confident now that Gmail is not an enormously complex and incomprehensible
application that instills fear into your heart: Itâ€™s just very complex, slightly
incomprehensible, and not at all scary.
So, now youâ€™ve started to delve into Gmailâ€™s workings. The next chapter moves
beyond the surface and shows you how your browser communicates with the
Gmail server, how the interface is put together, and how Gmail actually works.
Youâ€™ll be using many of the same techniques as you did in this chapter but to a
much greater depth. Put the kettle on, make some coffee, and letâ€™s go.
How Gmail Works
By now youâ€™ve learned how to use Gmail with some flair, and
you can change the way it looks to a certain extent. Now
you have to look into exactly how it works. You already
know that the majority of the Gmail functionality is enacted
client-sideâ€”that is, on the browser, rather than at the serverâ€”
and is done with JavaScript. This chapter describes exactly how
this works and how you can exploit it.
What the Devil Is Going On?
Before revealing just whatâ€™s happening, letâ€™s recap. In Chapter 4
you used the DOM inspector inside Firefox to help you dissect
the HTML, and this will help you again. So, as before, open up
Gmail in Firefox, and open the DOM inspector.
You already know that the main document is made of two frames,
the first made of many subframes and the second one with nothing
but a huge chunk of JavaScript. Figure 5-1 shows you that in
the DOM inspector.
Using the DOM inspectorâ€™s right-click menu Copy as XML
function, you can grab the text of the script and copy it to a text
editor. Ordinarily, I would include this code as a listing right
here, but when I cut and pasted it into the manuscript of this
book, it added another 120 pages in a single keystroke. This does
not bode well, especially as Google has tried as hard as it can to
format the JavaScript as tightly as possible. This saves bandwidth
but doesnâ€™t help anyone else read what Google is doing.Weâ€™ll
reach that problem in a page or two.
Ë› Getting at the code
Ë› The interface
Ë› XMLHttpRequest
Ë› Packet sniffing
Ë› Probing the
interface
Ë› Decoding the data
chapter
in this chapter
54 Part II â€” Getting Inside Gmail
FIGURE 5-1: The location of the
Gmail JavaScript shown with
the DOM inspector
Back to the browser, then, and you find you have a very complicated page seemingly
made up of close to 250KB of JavaScript, one iFrame you can see, and
apparently ten or more that donâ€™t appear on the screen. Furthermore, the eagleeyed
in our midst will have noticed that the Gmail URL doesnâ€™t change very
much when youâ€™re moving around the application. Changing from Inbox to All
Mail for the subset of your mail you want to see on the screen changes the page
but not the URL. For anyone used to, say, Hotmail, this is all very puzzling.
Preloading the Interface
What is actually happening is this: Gmail loads its entire interface into the one
single HTML page.When you move around the application, youâ€™re not loading
new pages, but triggering the JavaScript to show you other parts of the page you
have already in your browserâ€™s memory. This is why it is so fast: Thereâ€™s no network
connection needed to bring up the Compose window, or show the Settings
page, as youâ€™ve already loaded it. You can see this inside the DOM inspector.
Figure 5-2 shows the section of the page with the various divs, each containing
part of the interface.
Youâ€™ll remember from Chapter 4 that the div d_tlist contains the majority of
the interface for the Inbox.Well, further inspection shows that d_comp holds the
Compose window, and d_prefs hold the Settings window, and so on.
This is all very interesting, but it doesnâ€™t really show how the application works. If
anything, it asks a difficult question: if the page never refreshes, how does it send
or receive any messages? The answer to this is in the JavaScript, and the use of one
very clever function, XMLHttpRequest.
Chapter 5 â€” How Gmail Works 55
FIGURE 5-2: The main interface divs
Introducing XMLHttpRequest
I like to think of this as quite a romantic story. JavaScript, you see, has had a bad
rap over the years: itâ€™s commonly misconceived as a scrappy language for dodgy
website effects circa 1999, and up there with the &lt;blink&gt; tag as something to be
avoided by the truly righteous web developer. This is, of course, utter rot: Modern
JavaScript is a rich and powerful language, and is rapidly regaining momentum.
Perhaps since IE5 was launched, and certainly since Mozilla and Safari became
mainstream, the majority of browsers have been capable of doing some very clever
things in JavaScript. Itâ€™s just that no one bothered to look.
One such function is XMLHttpRequest. Invented by Microsoft and now universally
implemented, it allows a JavaScript program to communicate with a server in
the background, without refreshing the page. This is very key for Gmail. It means
that the JavaScript code can, upon a button push or any other trigger, send a tiny
request to the Gmail server, parse the response, and throw it onto the screen,
entirely without refreshing the page or causing any more traffic than is really necessary.
Itâ€™s blazingly fast, especially if you have a server optimized for just such a
thing. Google, naturally, does.
Using XMLHttpRequest Yourself
To get an idea of just what is going on, itâ€™s a good idea to use XMLHttpRequest
yourself. In this section youâ€™ll use it to create a little application of your own. You
can skip this section if youâ€™re not interested in a deep understanding, but itâ€™s pretty
cool stuff to play with anyway.
56 Part II â€” Getting Inside Gmail
First, open up a directory on a website. Youâ€™ll need to access it via a proper
domain, you see. Create the directory, and make sure your browser can see it. In
that directory, place a text file, called Listing.txt, and put the exclamation
â€œHorrible!â€? inside the file. Bear with me.
Then create an HTML file, containing the code in Listing 5-1, and save this file
to the directory you created earlier.
Listing 5-1: Listing.htmlâ€”Showing XMLHttpRequest
-//W3C//DTD XHTML 1.0 Transitional//ENâ€?
â€œhttp://www.w3.org/tr/xhtml1/DTD/xhtml1-transitional.dtdâ€?&gt;
&lt;html&gt;
&lt;head&gt;
&lt;style&gt;&lt;/style&gt;
&lt;script type=â€?text/javascriptâ€?&gt;
var xmlhttp=false;
try {
xmlhttp = new ActiveXObject(â€œMsxml2.XMLHTTPâ€?);
} catch (e) {
try {
xmlhttp = new ActiveXObject(â€œMicrosoft.XMLHTTPâ€?);
} catch (E) {
xmlhttp = false;
}
}
if (!xmlhttp &amp;&amp; typeof XMLHttpRequest!=â€™undefinedâ€™) {
xmlhttp = new XMLHttpRequest();
}
function Listing1() {
xmlhttp.open(â€œGETâ€?, â€œListing.txtâ€?,true);
xmlhttp.onreadystatechange=function() {
if (xmlhttp.readyState==4) {
alert(xmlhttp.responseText)
}
}
xmlhttp.send()
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;My Dog Has No Nose.&lt;/h1&gt;
Chapter 5 â€” How Gmail Works 57
&lt;a href=â€?/â€? onclick=â€?Listing1();return false;â€?&gt;How does it
smell?&lt;/a&gt;
&lt;/body&gt;
&lt;html&gt;
Open Listing.html in a browser and it should appear very much like Figure 5-3.
FIGURE 5-3: Ready to click on the link?
And when you click on the link, you should get a pop-up alert box similar to
Figure 5-4.
FIGURE 5-4: The result of an XMLHttpRequest function call
58 Part II â€” Getting Inside Gmail
What has happened here? Well, the link in the code doesnâ€™t go anywhere, but
clicking it sets the JavaScript going. Have a look at the first half of the code again:
&lt;script type=â€?text/javascriptâ€?&gt;
var xmlhttp=false;
try {
xmlhttp = new ActiveXObject(â€œMsxml2.XMLHTTPâ€?);
} catch (e) {
try {
xmlhttp = new ActiveXObject(â€œMicrosoft.XMLHTTPâ€?);
} catch (E) {
xmlhttp = false;
}
}
if (!xmlhttp &amp;&amp; typeof XMLHttpRequest!=â€™undefinedâ€™) {
xmlhttp = new XMLHttpRequest();
}
Stepping through this from the beginning, you set up a variable called xmlhttp
and set it to false. You use this variable to help check which browser youâ€™re using.
The XMLHttpRequest object is called different things in different applications
(Technically speaking, itâ€™s not a standard part of the JavaScript specification, so
different people call it different things. Ho hum.). In Microsoft browsers, itâ€™s an
Active X object called Msxml2.XMLHTTP or Microsoft.XMLHTTP, whereas in
Mozilla, Safari, and others, itâ€™s a standard JavaScript function called
XMLHttpRequest.
So the first half of the code goes through the alternatives, trying to define xmlhttp
as an XMLHttpRequest object by calling each of the possible functions in
turn. First it tries Msxml2.XMLHTTP, then Microsoft.XMLHTTP, and finally
defaults to XMLHttpRequest. (Usually, of course, thereâ€™s another test for no-
JavaScript-support-at-all, but weâ€™ll skip that here for the sake of brevity.)
Now, go line by line through the second half of the code:
function Listing1() {
xmlhttp.open(â€œGETâ€?, â€œListing.txtâ€?,true);
xmlhttp.onreadystatechange=function() {
if (xmlhttp.readyState==4) {
alert(xmlhttp.responseText)
}
}
xmlhttp.send()
}
Chapter 5 â€” How Gmail Works 59
The first line defines the name of the function: Listing1.
The second line sets up the open method of the XMLHttpRequest function
youâ€™ve placed into the xmlhttp object. XMLHttpRequest has six possible methods
to call, as youâ€™ll see later. The open method takes three parameters: the HTTP
call (such as GET or POST), the URL, and a flag of true or false to indicate if
the request is asynchronous (set to true) or not (set to false). Asynchronous in
this context means that the script continues processing while it is waiting for the
server to reply. In this listing itâ€™s not a big deal, but in others this is very important:
If you set the request to false, and the server takes a long time to get back to
you, you can lock up the browser in the meantime.
The third line solves this problem. It sets up an onreadystatechange event
handler, which waits for the XMLHttpRequest functionâ€™s state to change before
running the function it has defined. The possible values for onreadystate
change are in Table 5-2, but in the meantime know that readyState=4 means
that the XMLHttpRequest function has completed its task. So, lines 3 and 4 mean
â€œWait until the functionâ€™s state has changed, and if the state has changed to â€˜completeâ€™
then do the following; if not, keep waiting.â€?
Line 5 is triggered if 3 and 4 come true. It displays an alert box, containing the
result of the responseText method. This contains the contents of Listing.txt.
Lines 6 and 7 close off the functions prettily, and line 8 triggers the communication
itself. Note the order this all comes in: Youâ€™ve set up the request ready to go.
Youâ€™ve set up an Event Handler, watching for any request to come back and say
itâ€™s done, and only then do you fire off the request itself.
So, now youâ€™ve got a page with JavaScript code that can go out, fetch another file,
and do something with its contents, all without refreshing the HTML. In our
listing, itâ€™s a file with plain text, but it can be just about anything: XML, for
example.
Before moving on to using this new knowledge to look into Gmailâ€™s code, have a
look at Tables 5-1 and 5-2, which serve as a reference of the XMLHttpRequest
functions, methods, and suchlike.
Table 5-1 XMLHttpRequest Object Methods
Method Description
abort() Stops the current request.
getAllResponseHeaders() Returns complete set of headers (labels and
values) as a string.
Continued
60 Part II â€” Getting Inside Gmail
Table 5-1 (continued)
Method Description
getResponseHeader(â€œheaderLabelâ€?) Returns the string value of a single header
label.
open(â€œmethodâ€?, â€œURLâ€?[, asyncFlag[, Assigns the method, the URL, and the other
â€œuserNameâ€?[, â€œpasswordâ€?]]]) optional attributes of a pending request.
send(content) Sends the request, with an optional postable
string or bit of DOM object data.
setRequestHeader(â€œlabelâ€?, â€œvalueâ€?) Assigns a label/value pair to the header to be
sent with a request.
Table 5-2 contains some of the XMLHttpRequest object properties youâ€™ll likely
need to use.
Table 5-2 Common XMLHttpRequest Object Properties
Property Description
onreadystatechange Event handler for an event. It fires whenever the state changes.
readyState Object status integer:
0 = uninitialized
1 = loading
2 = loaded
3 = interactive
4 = complete
responseText The data returned from the server, as a string.
responseXML The data returned from the server, as a DOM-compatible
document object.
status Numeric http status code returned by server, such as 404 for
â€œNot Foundâ€? or 200 for â€œOK.â€?
statusText Any string message accompanying the status code.
You should now feel confident that you understand how a simple HTML and
JavaScript document can request data from a server in the background. Thereâ€™s no
need for the page to reload in the browser for you to retrieve new information.
Chapter 5 â€” How Gmail Works 61
Finding XMLHttpRequest within the Gmail code
Donâ€™t take the presence of XMLHttpRequest within Gmail on trust. You can see
this in action in Gmailâ€™s own code. Go back to the DOM inspector and open the
second framesetâ€”the one with all of the JavaScript in it. Copy the entire script
into a text editor and save it, as youâ€™re going to refer to it a lot in this section.
Once youâ€™ve done that, search for the string xmlhttp. Youâ€™ll find the function in
Listing 5-2.
Listing 5-2: Gmailâ€™s XMLHttpRequest Function
function zd(){var R=null;if(da){var
vN=lJ?â€?Microsoft.XMLHTTPâ€?:â€?Msxml2.XMLHTTPâ€?;try{R=new
ActiveXObject(vN)}catch(f){C(f);alert(â€œYou need to enable active
scripting and activeX controls.â€?)}}else{R=new
XMLHttpRequest();if(!R){;alert(â€œXMLHttpRequest is not supported on
this browser.â€?)}}return R}
As with all of the Gmail JavaScript, this is compressed and slightly confusing.
Reformatted, it looks like Listing 5-3.
Listing 5-3: Gmailâ€™s XMLHttpRequest Function, Tidied
function zd(){
var R=null;
if(da){
var vN=lJ?â€?Microsoft.XMLHTTPâ€?:â€?Msxml2.XMLHTTPâ€?;
try{R=new ActiveXObject(vN)}
catch(f){
C(f);alert(â€œYou need to enable active scripting and
activeX controls.â€?)}
}else{
R=new XMLHttpRequest();
if(!R){
;alert(â€œXMLHttpRequest is not supported on this
browser.â€?)}
}
return R}
This listing does exactly the same thing you did earlier: tries out the Microsoft
Active X controls, then tries the more standard XMLHttpRequest and then, if all
fails, bails with an error message. For future reference, and remember this because
youâ€™ll need it later, the XMLHttpRequest object in the Gmail code is called R.
62 Part II â€” Getting Inside Gmail
Sniffing the Network Traffic
So now that you understand how XMLHttpRequest works, youâ€™re led to some further
questions:What is being sent and received using the XMLHttpRequest functions,
and what are the URLs? Once you know the answers to these questions,
you can write your own code to spoof these requests, and can then interface
directly with the Gmail system. The rest of the book relies on this idea.
To find out what Gmail is saying to the browser, use a new tool: the packet sniffer.
This is a generic term for a range of applications that can listen to raw network
traffic, display it on the screen, log it, analyze it, and so on.What youâ€™re interested
in is watching what your browser is doing in the background: what it is sending,
where it is sending it to, and then the replies it is getting.
My packet sniffer of choice for this job is Jeremy Elsonâ€™s Tcpflow, available at
<a href="http://www.circlemud.org/%7Ejelson/software/tcpflow/">www.circlemud.org/~jelson/software/tcpflow/</a>.
I use Marc Liyanageâ€™s OS X package, which you can download from
<a href="http://www.entropy.ch/software/macosx/#tcpflow">www.entropy.ch/software/macosx/#tcpflow</a>.
Tcpflow is available under the GPL, and can be compiled on most proper computing
platforms.Windows users will need to look elsewhere, but the following
techniques remain the same.
Firing Up Tcpflow
Install Tcpflow, and set it running inside a terminal window, monitoring port 80.
On my machine, that means typing the following:
sudo tcpflow -c port 80
Then open a browser and request a page. Any will do: Figure 5-5 shows the start
of a typical result.
As you can see from the figure and your own screen, Tcpflow captures all of the
traffic flowing backward and forward across Port 80â€”all your web traffic, in
other words. It shows the requests and the answers: headers, content, and all.
Tcpflow is perfect for the job. But thereâ€™s a snag. Open up Gmail, and let it sit
there for a while. After it settles down, you will notice that Tcpflow regularly
burps up new traffic looking very similar to Listing 5-4. This is Gmailâ€™s heartbeat:
checking for new mail. But itâ€™s very odd looking.
Chapter 5 â€” How Gmail Works 63
FIGURE 5-5: The start of a Tcpflow session
Listing 5-4: Gmail Checking for New Mail
216.239.057.107.00080-192.168.016.050.59607: HTTP/1.1 200 OK
Set-Cookie: SID=AfzuOeCbwFixNvWd6vNt7bUR2DpPxRz-
YhOB54dzyYwHeLIHjVq_eeHH5s6MYQbPE0hVUK_LMROFuRWkMhfSR-U=;
Domain=.google.com;Path=/;Expires=Tue, 06-Jan-2015 00:12:12 GMT
Set-Cookie: GBE=; Expires=Fri, 07-Jan-05 00:12:12 GMT; Path=/
Cache-control: no-cache
Pragma: no-cache
Content-Type: text/html; charset=utf-8
Content-Encoding: gzip
Transfer-Encoding: chunked
Server: GFE/1.3
Date: Sat, 08 Jan 2005 00:12:12 GMT
a
..........
216.239.057.107.00080-192.168.016.050.59607: 2c8
R...A{[uj...</em>..lQ...D.M.â€?.h...}...â€?G...RD..7../}.c...K
H$g.....U.........M-.J
4......Y.......&amp;....M.(..=.b..t...t.M.<em>...S!.....dZ.r.........
..w..iy....RQ.T.....n.....n.</em>.sqK.0.e.Y.m..g...h....{.k[i.k...
..,d!....X..â€?...Y.a..v......;...J.f29.4....E...Q..,.gA.D.&lt;....
l....r...n0X..z.]0...~g&gt;o1.. x1,...U..f.VK....R++.6.
Continued
64 Part II â€” Getting Inside Gmail
Listing 5-4 (continued)
.YG......Q...Y......V.O...v
Oh7.D.M.X..3{%f.6].N...V<em>j.....+.J....2z@..n..)8..?Z./o....j</em>o
.........3..
!=<em>.a.v.s..........â€?..i{.;o..nh....K+q.\||...G.3]....x.;h.].r
...+..U?,...c........s..PF.%!....i2...}..â€™+.zP._.
....M...a35u]9.........-A...2.].F|.=..eQK
..5k.qt.....Wt..@Wf{.y.I..
X..</em>;.D...&lt;<em>.r.E&gt;...?.uK9p...RC..c..C.~.&lt;..&lt;..0q..9..I.pg.&gt;...
.
...x$..........
The headers are understandable enough, but the content is very strange indeed.
This is because your browser is taking advantage of Gzip encoding. Most modern
web servers can serve content encoded with the Gzip algorithm, and most modern
browsers are happy to decode it on the fly. Human brains, of course, cannot, so
you need to force Gmail to send whatever it is sending over unencoded.
In the first few chapters of this book, youâ€™ve been using Firefox, so return to that
browser again now. In the address bar, type the URL about:config.
You should see a page looking like Figure 5-6.
FIGURE 5-6: The Firefox secret settings page
Chapter 5 â€” How Gmail Works 65
This page allows you to change the more fundamental browser settings. You need
to change only one. Scroll down to network.http.accept-encoding and click
on the string. By default it reads gzip/deflate. Just delete that, and leave it
blank, as shown in Figure 5-7.
FIGURE 5-7: The changed HTTP setting
Empty Firefoxâ€™s cache to prevent a strange bug, and restart the browser for good
measure. Now go back to Gmail and watch for the heartbeat. It will now look like
Listing 5-5.
Listing 5-5: Gmailâ€™s Heartbeat, Unencoded
192.168.016.050.59622-216.239.057.107.00080: GET
/gmail?ik=344af70c5d&amp;view=tl&amp;search=inbox&amp;start=0&amp;tlt=1014fb79
f15&amp;fp=54910421598b5190&amp;auto=1&amp;zx=24c4d6962ec6325a216123479
HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O;
en-GB; rv:1.7.5) Gecko/20041110 Firefox/1.0
Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9
,text/plain;q=0.8,image/png,</em>/<em>;q=0.5
Accept-Language: en-gb,en;q=0.5
Accept-Charset: ISO-8859-1,utf-8;q=0.7,</em>;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer:
<a href="http://gmail.google.com/gmail?ik=344af70c5d&amp;search=inbox&amp;view=">http://gmail.google.com/gmail?ik=344af70c5d&amp;search=inbox&amp;view=</a>
tl&amp;start=0&amp;zx=24c4d6962ec6325a116384500
Cookie: GV=101014fb09ab5-af53c8c5457de50bec33d5d6436e82c6;
PREF=ID=2dfd9a4e4dba3a9f:CR=1:TM=1100698881:LM=1101753089:GM=1
:S=nJnfdWng4uY7FKfO; SID=AcwnzkuZa4aCDnqVeiG6-
pM487sZLlfXBz2JqrHFdjIueLIHjVq_eeHH5s6MYQbPE4wm3vinOWMnavqPWq3
SNNY=; GMAIL_AT=e6980e93d906d564-1014fb09ab7;
S=gmail=h7zPAJFLoyE:gmproxy=bnNkgpqwUAI; TZ=-60
216.239.057.107.00080-192.168.016.050.59622: HTTP/1.1 200 OK
Continued
66 Part II â€” Getting Inside Gmail
Listing 5-5 (continued)
Set-Cookie:
SID=AbF6fUKA6tCIrC8Hv0JZuL5cLPt3vlO6qonGit87BAlMeLIHjVq_eeHH5s
6MYQbPE-F6IjzxJjnWuwgSIxPn3GQ=;Domain=.google.com;Path=/
Cache-control: no-cache
Pragma: no-cache
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Server: GFE/1.3
Date: Sat, 08 Jan 2005 00:31:09 GMT
62
&lt;script&gt;var
loaded=true;&lt;/script&gt;&lt;script&gt;try{top.js.L(window,29,â€™18fd02c90
a
â€˜);}catch(e){}&lt;/script&gt;
This you can recognize: The heartbeat had my browser requesting the following
URL:
/gmail?ik=344af70c5d&amp;view=tl&amp;search=inbox&amp;start=0&amp;tlt=1014fb79f15&amp;
fp=54910421598b5190&amp;auto=1&amp;zx=24c4d6962ec6325a216123479
Likewise, the heartbeat had my browser passing the following cookie:
Cookie: GV=101014fb09ab5-af53c8c5457de50bec33d5d6436e82c6;
PREF=ID=2dfd9a4e4dba3a9f:CR=1:TM=1100698881:LM=1101753089:GM=1:S=n
JnfdWng4uY7FKfO; SID=AcwnzkuZa4aCDnqVeiG6-
pM487sZLlfXBz2JqrHFdjIueLIHjVq_eeHH5s6MYQbPE4wm3vinOWMnavqPWq3SNNY
=; GMAIL_AT=e6980e93d906d564-1014fb09ab7;
S=gmail=h7zPAJFLoyE:gmproxy=bnNkgpqwUAI; TZ=-60
The browser then received a new cookie:
SID=AbF6fUKA6tCIrC8Hv0JZuL5cLPt3vlO6qonGit87BAlMeLIHjVq_eeHH5s6MYQ
bPE-F6IjzxJjnWuwgSIxPn3GQ=;Domain=.google.com;Path=/
Along with the new cookie, my browser also received a snippet of JavaScript as
the contents of the page:
&lt;script&gt;var
loaded=true;&lt;/script&gt;&lt;script&gt;try{top.js.L(window,29,â€™18fd02c90a
â€˜);}catch(e){}&lt;/script&gt;
What can you tell from all of this? Well, you now know how Gmail on your
browser communicates with the server, and you know how to listen in on the conversation.
Two things remain in this chapter, therefore: collecting as many of these
phrases as possible and then working out what they mean.
Chapter 5 â€” How Gmail Works 67
Prodding Gmail to Hear It Squeak
The technique to further learn Gmailâ€™s secrets is obvious. Use itâ€”sending mail,
receiving mail, and so onâ€”and watch what it does in the background. From
these clues, and the JavaScript listing you already have, you can piece together a
complete picture of the Gmail serverâ€™s interface. And itâ€™s that interface that you
ultimately want to deal with directly.
To get a clear idea of what is going on, you need to capture everything that happens
when Gmail is loaded, when it sits idle, and when you perform the common
actions with it.
Preparing to Watch the Gmail Boot Sequence
To start the process with gusto, open up Firefox again, and clear all of the caches.
Then open up a terminal window, and set Tcpflow running, and save its output to
a text file, like so:
sudo tcpflow -c â€˜(port 80 or 443)â€™ &gt;&gt; login_capture.txt
This records everything that goes over HTTP or HTTPS. Then log in to Gmail
until you get to a nice, calm, idle Inbox like the placid Inbox shown in Figure 5-8.
FIGURE 5-8: A nice, calm Inbox at the end of the boot sequence
68 Part II â€” Getting Inside Gmail
Youâ€™ll be referring back to this figure in a page or two.
Now, stop the Tcpflow application with a judicious Control+c and open up the
login_capture.txt file.
Cleaning Up the Log
Before looking through the log properly, it needs to be cleaned up a bit. Thereâ€™s a
lot of information that you donâ€™t need. For instance, every request sent by my
browser has this code, which is superfluous to your needs:
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O;
en-GB; rv:1.7.5) Gecko/20041110 Firefox/1.0
Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9
,text/plain;q=0.8,image/png,<em>/</em>;q=0.5
Accept-Language: en-gb,en;q=0.5
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Search for this code and replace it with a single new line. Next, toward the end,
line 1862 in my working version is a whole collection of requests and responses
for image files. Youâ€™re not interested in these at all, so you can reduce them until
they look like so:
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/help/images/logo.gif 216.239.057.106.00080-
192.168.016.053.64150: HTTP/1.1 200 OK
This makes things much more readable. Now, between lines 394 and 1712 (more
or less, it may be slightly different in your log file) is the serving of the one enormous
JavaScript file. Strip the code out, and replace it with your own comment.
Finally, right at the beginning, are a few pages going backward and forward that
seem to be made of utter nonsense. These are encrypted. So, again, strip them out
and replace them with a comment.
You should now have around 500 lines of traffic between your browser and Gmail.
Itâ€™s time to step through it and see what is going on.To see the entire boot
sequence log, flip to Appendix A and look through Listing A-3.
Stepping Through the Gmail Boot Sequence
To be able to write an API, you need to know how the login works, so we shall start
there. In all of the following, my machine has the IP address 192.168.016.053.
Chapter 5 â€” How Gmail Works 69
Logging In
Start by requesting the page <a href="http://gmail.google.com.Whereupon">http://gmail.google.com.Whereupon</a>,
Gmail replies back with an http 302 redirect to <a href="https://gmail.google">https://gmail.google</a>.
com/?dest=http%3A%2F%2Fgmail.google.com%2Fgmail, which the browser
automatically follows, switching to encrypted traffic:
192.168.016.053.64142-216.239.057.106.00080: GET / HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
216.239.057.106.00080-192.168.016.053.64142: HTTP/1.1 302
Moved Temporarily
Location:
<a href="https://gmail.google.com/?dest=http%253A%252F%252Fgmail.google.com%252">https://gmail.google.com/?dest=http%3A%2F%2Fgmail.google.com%2</a>
Fgmail
Cache-control: private
Content-Length: 0
Content-Type: text/html
Server: GFE/1.3
Date: Sun, 16 Jan 2005 17:11:18 GMT
192.168.016.053.64143-216.239.057.106.00443
LOTS OF ENCRYPTED TRAFFIC CLIPPED OUT FROM THIS SECTION
Because the login page is encryptedâ€”the traffic flows over HTTPS not HTTPâ€”
you canâ€™t follow what it does using the log. You need to use a script to follow the
URLs until you get back to the trace. I used the following snippet of Perl code to
pretend to be a browser to see what is going on:</p>

<h4>!/usr/bin/perl -w</h4>

<p>use LWP::UserAgent;
use HTTP::Request;
This Is Going to Break
During the writing of this book, the Gmail login sequence has changed at least three times. Not
massively so, it must be said, but enough to break code until I worked out just what had
changed. This section, and the chapters following, therefore, must be taken as guides to reverse
engineering the thing yourself, and not as a definitive reference to the Gmail login sequence. If
what I describe here no longer matches reality completely, I apologize. Take solace in the fact
that I have no idea what Google is up to either.
70 Part II â€” Getting Inside Gmail
use Crypt::SSLeay;
my $ua = LWP::UserAgent-&gt;new();
$ua -&gt; agent(â€œMozilla/4.0 (compatible; MSIE 6.0; Windows NT
5.1; .NET CLR 1.1.4322)â€?);
my $request = HTTP::Request-&gt;new(GET =&gt;
â€˜https://gmail.google.com/â€™);
my $result = $ua-&gt;request($request);
if ($result-&gt;is_success) {
print $result-&gt;content;
} else {
print $result-&gt;status_line;
}
You can infer from actually doing it, or by using a script like the one above, that
the page continues with another redirect (or perhaps more than one), finally
ending up at <a href="https://www.google.com/accounts/ServiceLogin?">https://www.google.com/accounts/ServiceLogin?</a>
service=mail&amp;continue=http%3A%2F%2Fgmail.google.com%2Fgmail,
as you can see in Figure 5-9.
FIGURE 5-9: The Gmail login screen
Chapter 5 â€” How Gmail Works 71
Viewing source on this page shows you two important things. First, there is the
username and password form itself and second some JavaScript that sets a cookie.
Deal with the form first. Listing 5-6 gives a cleaned-up version of the code, with
the styling removed.
Listing 5-6: The Gmail Login Form
&lt;form action=â€?ServiceLoginAuthâ€? id=â€?gaia_loginformâ€?
method=â€?postâ€?&gt;
&lt;input type=â€?hiddenâ€? name=â€?continueâ€?
value=â€?http://gmail.google.com/gmailâ€?&gt;
&lt;input type=â€?hiddenâ€? name=â€?serviceâ€? value=â€?mailâ€?&gt;
Username: &lt;input type=â€?textâ€? name=â€?Emailâ€? value=â€?â€? size=â€?18â€?&gt;
Password: &lt;input type=â€?passwordâ€? name=â€?Passwdâ€?
autocomplete=â€?offâ€? size=â€?18â€?&gt;
&lt;input type=â€?checkboxâ€? name=â€?PersistentCookieâ€? value=â€?yesâ€?&gt;
Donâ€™t ask for my password for 2 weeks.
&lt;input type=â€?submitâ€? name=â€?nullâ€? value=â€?Sign inâ€?&gt;
&lt;/form&gt;
From this we can see that the URL the page POSTs towards to log in is produced
as follows, split here for clarity.
<a href="https://www.google.com/accounts/ServiceLoginBoxAuth/continue=h">https://www.google.com/accounts/ServiceLoginBoxAuth/continue=h</a>
ttps://gmail.google.com/gmail
&amp;service=mail
&amp;Email=XXXXX
&amp;Passwd=XXXXX
&amp;PersistentCookie=yes
&amp;null=Sign%20in
You will need this later on, but now, the cookie setting.
The First Cookie
The relevant sections of the JavaScript listing inside the login page appear in
Listing 5-7.
72 Part II â€” Getting Inside Gmail
Listing 5-7: Cookie-Setting Code from the Gmail Login
function SetGmailCookie(name, value) {
document.cookie = name + â€œ=â€? + value +
â€œ;path=/;domain=google.comâ€?;
}
// This is called when the user logs in to gmail.
// We set a GMAIL_LOGIN2 cookie with the initial timings.
// The first letter â€œTâ€? in the cookie value means that the
login is not
// completed yet. The main JS will complete logging the
timings and update
// the GMAIL_LOGIN2 cookie. See main.js
function lg() {
var now = (new Date()).getTime();
// use start_time as a place holder for login_box_time until
weâ€™ve
// completely rolled out html-only login
var cookie = â€œTâ€? + start_time + â€œ/â€? + start_time + â€œ/â€? +
now;
SetGmailCookie(â€œGMAIL_LOGIN2â€?, cookie);
}
var login_box_time;
function IframeOnLoad() {
if (!login_box_time) {
login_box_time = (new Date()).getTime();
}
}
function el(id) {
if (document.getElementById) {
return document.getElementById(id);
}
return null;
}
var ONE_PX = â€œhttps://gmail.google.com/gmail/images/c.gif?t=â€?
+
(new Date()).getTime();
function LogRoundtripTime() {
var img = new Image();
var start = (new Date()).getTime();
img.onload = GetRoundtripTimeFunction(start);
Chapter 5 â€” How Gmail Works 73
img.src = ONE_PX;
}
function GetRoundtripTimeFunction(start) {
return function() {
var end = (new Date()).getTime();
SetGmailCookie(â€œGMAIL_RTT2â€?, (end - start));
}
}
function OnLoad() {
var form = document.getElementById(â€œgaia_loginformâ€?);
form.onsubmit = lg;
CheckBrowser();
LogRoundtripTime();
}
This JavaScript sets two cookies. The first, GMAIL_LOGIN2, is set with a value of
Tstart_time/start_time/now where both start_time and now are the datetime
exactly then. As you can see from the comments in the code, Google intends
to replace this in the future.
The second cookie is called GMAIL_RTT2 and contains the time it takes to retrieve
a 1-pixel image file from the Gmail servers. RTT, presumably, stands for Round
Trip Time.
You wonâ€™t look at it in this book, but the rest of the JavaScript code on that page
presents a very nice listing of a browser check that removes the login window if
the browser isnâ€™t capable of using Gmail.
If you watch the Gmail login sequence from your own browser, you will see that it
goes through more redirects before it settles into HTTP again, and you can see
what is going on from the Tcpflow trace file.
Hitting stop on the browser at just the right time (and that is, to quote the fine
words of my editor, a total crapshoot), gives you this URL:
<a href="https://www.google.com/accounts/CheckCookie?continue=http%253A%252F">https://www.google.com/accounts/CheckCookie?continue=http%3A%2F</a>
%2Fgmail.google.com%2Fgmail%3F_sgh%3D8a6d8ffbb159f1c7c9246bd4f4
9e78a1&amp;service=mail&amp;chtml=LoginDoneHtml
Viewing source on that page gives you Listing 5-8.
74 Part II â€” Getting Inside Gmail
Listing 5-8: The Gmail Cookie Check
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Redirecting&lt;/title&gt;
&lt;meta content=â€?0;
url=http://gmail.google.com/gmail?_sgh=8a6d8ffbb159f1c7c9246bd
4f49e78a1â€? http-equiv=â€?refreshâ€?&gt;&lt;/head&gt;
&lt;body alink=â€?#ff0000â€? text=â€?#000000â€? vlink=â€?#551a8bâ€?
link=â€?#0000ccâ€? bgcolor=â€?#ffffffâ€?&gt;
&lt;script type=â€?text/javascriptâ€? language=â€?javascriptâ€?&gt;<!--
location.replace(â€œhttp://gmail.google.com/gmail?_sgh=8a6d8ffbb
159f1c7c9246bd4f49e78a1â€?)
//--> &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
This HTML forces you onto the next page, in this case <a href="http://gmail.google">http://gmail.google</a>.
com/gmail?_sgh=8a6d8ffbb159f1c7c9246bd4f49e78a1.
You have seen this sort of URL before: Look back again at Listing A-3, after the
second excised block of encrypted code. So now you know that between the form
submission and the page you get in Listing 5-8, something else happens. You can
also guess that something happens to the cookie you set on the first pageâ€”it is
being checked for something. Considering that those cookies do not contain anything
but the time they were set, I am guessing that this step is to ensure that the
connection is current and not the result of caching from someoneâ€™s browser. Itâ€™s to
ensure a good, fresh session with Gmail on the part of the browser application and
the user himself. Or so I would guess.
Either way, the boot sequence continues from here automatically, with everything
in standard HTTP. You will see within the trace that the boot sequence loads the
Inbox next. So thatâ€™s what the next section considers.
Loading the Inbox
As you come to the end of the boot sequence you have nothing to do but load in the
Inbox and address book. This section deals specifically with the Inbox loading. The
output from the Tcpflow program earlier in this chapter doesnâ€™t contain enough
mail to be of use in this regard, but if you do the trace again, only this time with a
few more messages in the Inbox, you can see what is going on. Figure 5-10 shows
the new Inbox, loaded with messages.
Chapter 5 â€” How Gmail Works 75
FIGURE 5-10: Gmail with some new, unread messages
Listing 5-9 shows the new trace.
A Summary of the Login Procedure
As I have said before, the login procedure for Gmail seems to be changing on a very regular
basis. Check with the libraries examined in Chapter 6 for the latest news on this. Basically, however,
the login procedure goes like this, with each step moving on only if the previous was
reported successful.
1. Request the Gmail page.
2. Set the two cookies.
3. Send the contents of the form.
4. Request the cookie check page.
5. Request the Inbox.
76 Part II â€” Getting Inside Gmail
Listing 5-9: The Inbox with More Messages Within
192.168.016.051.59905-064.233.171.107.00080: GET
/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0&amp;init=1&amp;zx=vzmurwe44cpx
6l HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O;
en-GB; rv:1.7.5) Gecko/20041110 Firefox/1.0
Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9
,text/plain;q=0.8,image/png,<em>/</em>;q=0.5
Accept-Language: en-gb,en;q=0.5
Accept-Charset: ISO-8859-1,utf-8;q=0.7,<em>;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: <a href="http://gmail.google.com/gmail/html/hist2.html">http://gmail.google.com/gmail/html/hist2.html</a>
Cookie: GV=1010186d43b2b-b6b21a87a46b00d1bc5abf1a97357dd7;
PREF=ID=0070250e68e17190:CR=1:TM=1106068639:LM=1106068639:S=O1
Nivj_xqk7kvdGK;
GMAIL_LOGIN=T1106068635841/1106068635841/1106068648645;
SID=DQAAAGoAAAC06FIY2Ix4DJlCk7ceaOnWPvpK4eWn9oV6xpmOT4sNhdBPkZ
2npQE8Vi8mWY9RybWVwJet9CHeRBw99oUdRqQHvBb8IWxhLcurTBFZJstXoUbW
FDZTmxZKt55eUxnspTHLanel9LsAU1wqHcHhlHI7;
GMAIL_AT=5282720a551b82df-10186d43b2e;
S=gmail=WczKrZ6s5sc:gmproxy=UMnFEH_hYC8; TZ=-60
064.233.171.107.00080-192.168.016.051.59905: HTTP/1.1 200 OK
Set-Cookie:
SID=DQAAAGoAAAC06FIY2Ix4DJlCk7ceaOnWPvpK4eWn9oV6xpmOT4sNhdBPkZ
2npQE8Vi8mWY9RybWVwJet9CHeRBw99oUdRqQHvBb8IWxhLcurTBFZJstXoUbW
FDZTmxZKt55eUxnspTHLanel9LsAU1wqHcHhlHI7;Domain=.google.com;Pa
th=/
Cache-control: no-cache
Pragma: no-cache
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Server: GFE/1.3
Date: Tue, 18 Jan 2005 17:17:36 GMT
936
&lt;html&gt;&lt;head&gt;&lt;meta content=â€?text/html; charset=UTF-8â€? httpequiv=â€?
content-typeâ€?&gt;&lt;/head&gt;&lt;script&gt;D=(top.js&amp;&amp;top.js.init)?fu
nction(d){top.js.P(window,d)}:function(){};if(window==top){top
.location=â€?/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0&amp;init=1&amp;zx=v
zmurwe44cpx6l&amp;fs=1â€?;}&lt;/script&gt;&lt;script&gt;<!--
D([â€œvâ€?,â€?15b3e78585d3c7bbâ€?,â€?33fc762357568758â€?]
);
D([â€œudâ€?,â€?ben.hammersley@gmail.comâ€?,â€?{\â€?o\â€?:\â€?OPEN\â€?,\â€?/\â€?:\â€?SE
ARCH\â€?,\â€?\r\â€?:\â€?OPEN\â€?,\â€?k\â€?:\â€?PREV\â€?,\â€?r\â€?:\â€?REPLY\â€?,\â€?c\â€?:\
Chapter 5 â€” How Gmail Works 77
â€?COMPOSE\â€?,\â€?gc\â€?:\â€?GO_CONTACTS\â€?,\â€?gd\â€?:\â€?GO_DRAFTS\â€?,\â€?p\â€?:\
â€?PREVMSG\â€?,\â€?gi\â€?:\â€?GO_INBOX\â€?,\â€?m\â€?:\â€?IGNORE\â€?,\â€?a\â€?:\â€?REPLYA
LL\â€?,\â€?!\â€?:\â€?SPAM\â€?,\â€?f\â€?:\â€?FORWARD\â€?,\â€?u\â€?:\â€?BACK\â€?,\â€?ga\â€?:\â€?
GO_ALL\â€?,\â€?j\â€?:\â€?NEXT\â€?,\â€?y\â€?:\â€?REMOVE\â€?,\â€?n\â€?:\â€?NEXTMSG\â€?,\â€?g
s\â€?:\â€?GO_STARRED\â€?,\â€?x\â€?:\â€?SELECT\â€?,\â€?s\â€?:\â€?STAR\â€?}â€?,â€?344af70c
5dâ€?,â€?/gmail?view=page&amp;name=contacts&amp;ver=50c1485d48db7207â€?]
);
D([â€œsuâ€?,â€?33fc762357568758â€?,[â€œlâ€?,â€?/gmail/help/images/logo.gifâ€?,
â€?iâ€?,â€?Invite a friend to Gmailâ€?,â€?jâ€?,â€?Invite PH_NUM friends to
Gmailâ€?]
]
);
D([â€œpâ€?,[â€œbx_hsâ€?,â€?1â€?]
,[â€œbx_show0â€?,â€?1â€?]
,[â€œbx_scâ€?,â€?0
064.233.171.107.00080-192.168.016.051.59905: â€œ]
,[â€œbx_peâ€?,â€?1â€?]
,[â€œbx_nsâ€?,â€?1â€?]
]
);
D([â€œppdâ€?,0]
);
D([â€œiâ€?,6]
);
D([â€œquâ€?,â€?1 MBâ€?,â€?1000 MBâ€?,â€?0%â€?,â€?#006633â€?]
);
D([â€œftâ€?,â€?Search accurately with &lt;a style=color:#0000CC
target=_blank
href=\â€?/support/bin/answer.py?ctx=gmail&amp;answer=7190\â€?&gt;operator
s&lt;/a&gt; including &lt;b&gt;from:&lt;/b&gt; &nbsp;&lt;b&gt;to:&lt;/b&gt;
&nbsp;&lt;b&gt;subject:&lt;/b&gt;.â€?]
);
D([â€œdsâ€?,2,0,0,0,0,16,0]
);
D([â€œctâ€?,[[â€œHeadsâ€?,0]
,[â€œKneesâ€?,0]
,[â€œShouldersâ€?,0]
,[â€œToesâ€?,0]
]
]
);
D([â€œtsâ€?,0,50,3,0,â€?Inboxâ€?,â€?10186d450f9â€?,3,]
);
//-->&lt;/script&gt;&lt;script&gt;<!--
D([â€œtâ€?,[â€œ101865c04ac2427fâ€?,1,0,â€?&lt;b&gt;4:06pm&lt;/b&gt;â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;&lt;b&gt;Ben
Hammersley&lt;/b&gt;&lt;/span&gt;â€?,â€?&lt;b&gt;&raquo;&lt;/b&gt;&nbsp;â€?,â€?&lt;b&gt;This is the
third message&lt;/b&gt;â€?,,[]
Continued
78 Part II â€” Getting Inside Gmail
Listing 5-9 (continued)
,â€?â€?,â€?101865c04ac2427fâ€?,0,â€?Tue Jan 18 2005_7:06AMâ€?]
,[â€œ101865b95fc7a35aâ€?,1,0,â€?&lt;b&gt;4:05pm&lt;/b&gt;â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;&lt;b&gt;Ben
Hammersley&lt;/b&gt;&lt;/span&gt;â€?,â€?&lt;b&gt;&raquo;&lt;/b&gt;&nbsp;â€?,â€?&lt;b&gt;This is the
second message&lt;/b&gt;â€?,,[]
,â€?â€?,â€?101865b95fc7a35aâ€?,0,â€?Tue Jan 18 2005_7:05AMâ€?]
,[â€œ101480d8ef5dc74aâ€?,0,1,â€?Jan 6â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;Ben
Hammersley&lt;/span&gt;â€?,â€?&lt;b&gt;&raquo;&lt;/b&gt;&nbsp;â€?,â€?Here\â€™s a nice
message.â€?,,[â€œ^tâ€?,â€?Headsâ€?]
,â€?â€?,â€?101480d8ef5dc74aâ€?,0,â€?Thu Jan 6 2005_4:44AMâ€?]
]
);
D([â€œteâ€?]);
//-->&lt;/script&gt;&lt;script&gt;var
fp=â€™341d292f3e55766fâ€™;&lt;/script&gt;&lt;script&gt;var
loaded=true;D([â€˜eâ€™]);&lt;/script&gt;&lt;script&gt;try{top.js.L(window,45,â€™
cb803471f1â€™);}catch(e){}&lt;/script&gt;
What to make of these traces? First, you can see that to call the contents of the
Inbox, the browser requests two URLs. First, this one:
/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0&amp;init=1&amp;zx=z6te3fe41hmsjo
And next, this one:
/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0&amp;init=1&amp;zx=781ttme448dfs9
And second, it appears that the real workings of the Inbox are contained in the
JavaScript function that starts D([â€œtâ€?]), as Listings 5-10 and 5-11 show.
Listing 5-10: With One Message
D([â€œtâ€?,[â€œ101480d8ef5dc74aâ€?,0,0,â€?Jan 6â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;Ben
Hammersley&lt;/span&gt;â€?,â€?&lt;b&gt;Â»&lt;/b&gt;Â â€?,â€?Here\â€™s a nice
message.â€?,,[]
,â€?â€?,â€?101480d8ef5dc74aâ€?,0,â€?Thu Jan 6 2005_4:44AMâ€?]
]
);
Chapter 5 â€” How Gmail Works 79
Listing 5-11: With Three Messages
D([â€œtâ€?,[â€œ101865c04ac2427fâ€?,1,0,â€?&lt;b&gt;4:06pm&lt;/b&gt;â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;&lt;b&gt;Ben
Hammersley&lt;/b&gt;&lt;/span&gt;â€?,â€?&lt;b&gt;Â»&lt;/b&gt;Â â€?,â€?&lt;b&gt;This is the
third message&lt;/b&gt;â€?,,[]
,â€?â€?,â€?101865c04ac2427fâ€?,0,â€?Tue Jan 18 2005_7:06AMâ€?]
,[â€œ101865b95fc7a35aâ€?,1,0,â€?&lt;b&gt;4:05pm&lt;/b&gt;â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;&lt;b&gt;Ben
Hammersley&lt;/b&gt;&lt;/span&gt;â€?,â€?&lt;b&gt;Â»&lt;/b&gt;Â â€?,â€?&lt;b&gt;This is the
second message&lt;/b&gt;â€?,,[]
,â€?â€?,â€?101865b95fc7a35aâ€?,0,â€?Tue Jan 18 2005_7:05AMâ€?]
,[â€œ101480d8ef5dc74aâ€?,0,1,â€?Jan 6â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;Ben
Hammersley&lt;/span&gt;â€?,â€?&lt;b&gt;Â»&lt;/b&gt;Â â€?,â€?Here\â€™s a nice
message.â€?,,[â€œ^tâ€?,â€?Headsâ€?]
,â€?â€?,â€?101480d8ef5dc74aâ€?,0,â€?Thu Jan 6 2005_4:44AMâ€?]
]
);
From looking at these listings, you can deduce that the Inbox structure consists of
one or more of the following arrays (Iâ€™ve added in line breaks for clarity):
[
â€œ101480d8ef5dc74aâ€?,
0,
0,
â€œJan 6â€?,
â€œ&lt;span id=\â€™_user_ben@benhammersley.com\â€™&gt;Ben
Hammersley&lt;/span&gt;â€?,
â€œ&lt;b&gt;Â»&lt;/b&gt;Â â€?,
â€œHere\â€™s a nice message.â€?,
,[]
,â€?â€?
,â€?101480d8ef5dc74aâ€?
,0
,â€?Thu Jan 6 2005_4:44AMâ€?
]
From further deduction, where I sent different types of e-mail to Gmail and
watched what it didâ€”Iâ€™ll omit all of that here for the sake of brevity, but you
should have the ideaâ€”you can see that the array consists of the following:
[
â€œ101480d8ef5dc74aâ€?, -&gt; The message id.
0, -&gt; Unread=1, Read=0
0, -&gt; Starred=1, plain=0
80 Part II â€” Getting Inside Gmail
â€œJan 6â€?, -&gt; The date displayed
â€œ&lt;span id=\â€™_user_ben@benhammersley.com\â€™&gt;Ben
Hammersley&lt;/span&gt;â€?, -&gt; Who sent it
â€œ&lt;b&gt;Â»&lt;/b&gt;Â â€?, -&gt; The little icon in the inbox
â€œHere\â€™s a nice message.â€?, -&gt; The subject line
,[] -&gt; Labels
,â€?â€? -&gt; Attachments
,â€?101480d8ef5dc74aâ€? -&gt; The message ID
,0 -&gt; Unknown
,â€?Thu Jan 6 2005_4:44AMâ€? -&gt; The full date and time
]
You now know how to decode the Gmail mail listing. You can also see how to
request this data structureâ€”by calling the URL, and parsing the returned
JavaScript function. You can do this in simple regular expressions, a topic explored
in Chapter 7.
Storage Space
The detail of the mail in the Inbox isnâ€™t the only information sent when you
request that URL. Look above the mail function and you can see the following:
D([â€œquâ€?,â€?1 MBâ€?,â€?1000 MBâ€?,â€?0%â€?,â€?#006633â€?]
This line of data sent from Gmailâ€™s servers clearly corresponds to the display at
the bottom of the screen giving your mailbox usage statistics:
 D([â€œquâ€?,: The name of the Gmail function that deals with the usage
information.
 â€œ1 MBâ€?,: The amount of storage used.
 â€œ1000 MBâ€?,: The maximum amount available.
 â€œ0%â€?,: The percentage used.
 â€œ#006633â€?: The hex value for a nice shade of green.
Labels
In Figure 5-10 I have added some labels to the Gmail system. Spotting them in
the Tcpflow is easy:
D([â€œctâ€?,[[â€œHeadsâ€?,0],[â€œKneesâ€?,0],[â€œShouldersâ€?,0],[â€œToesâ€?,0]]]);
You can deduce straight away that the function starting with D([â€œctâ€? contains
the names and an unknown value (perhaps itâ€™s a Boolean, perhaps itâ€™s a string, you
donâ€™t know as yet) of the Labels. You can more easily harvest this data when you
come to write your own API.
Chapter 5 â€” How Gmail Works 81
Reading an Individual Mail
Fire up Tcpflow again, and click one of the messages in the Inbox in Figure 5-10.
The trace resulting from this action is shown in Listing 5-12.
Listing 5-12: Trace from Reading a Message
192.168.016.051.59936-064.233.171.105.00080: GET
/gmail?ik=344af70c5d&amp;view=cv&amp;search=inbox&amp;th=101865c04ac2427f&amp;
lvp=-1&amp;cvp=0&amp;zx=9m4966e44e98uu HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O;
en-GB; rv:1.7.5) Gecko/20041110 Firefox/1.0
Accept:text/xml,application/xml,application/xhtml+xml,text/htm
l;q=0.9,text/plain;q=0.8,image/png,</em>/<em>;q=0.5
Accept-Language: en-gb,en;q=0.5
Accept-Charset: ISO-8859-1,utf-8;q=0.7,</em>;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer:
<a href="http://gmail.google.com/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0">http://gmail.google.com/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0</a>
&amp;init=1&amp;zx=iv37tme44d1tx5
Cookie: GV=1010186dcc455-ce01891ce232fa09b7f9bcfb46adf4e7;
PREF=ID=0070250e68e17190:CR=1:TM=1106068639:LM=1106068659:GM=1
:S=3jNiVz8ZpaPf0GW0; S=gmail=WczKrZ6s5sc:gmproxy=UMnFEH_hYC8;
TZ=-60; SID=DQAAAGoAAACm_kF5GqnusK0rbFcAlLKoJUx26l6np-
H5Een1P_hN--yWqycLWSJUZt3G9Td_Cgw_ZK1naS891aWxZ6IkbNiBFN1J4lmO
COTvOn7r3bnYjWlOqB6netb06ByuEf56Cd12ilfgika0MxmuamO3FWzw;
GMAIL_AT=29a3f526e2461d87-10186dcc456; GBE=d-540-800
064.233.171.105.00080-192.168.016.051.59936: HTTP/1.1 200 OK
Set-Cookie: SID=DQAAAGoAAACm_kF5GqnusK0rbFcAlLKoJUx26l6np-
H5Een1P_hN--yWqycLWSJUZt3G9Td_Cgw_ZK1naS891aWxZ6IkbNiBFN1J4lmO
COTvOn7r3bnYjWlOqB6netb06ByuEf56Cd12ilfgika0MxmuamO3FWzw;Domai
n=.google.com;Path=/
Set-Cookie: GBE=; Expires=Mon, 17-Jan-05 18:00:37 GMT; Path=/
Cache-control: no-cache
Pragma: no-cache
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Server: GFE/1.3
Continued
82 Part II â€” Getting Inside Gmail
Listing 5-12 (continued)
Date: Tue, 18 Jan 2005 18:00:37 GMT
4d5
&lt;html&gt;&lt;head&gt;&lt;meta content=â€?text/html; charset=UTF-8â€? httpequiv=â€?
content-typeâ€?&gt;&lt;/head&gt;&lt;script&gt;D=(top.js&amp;&amp;top.js.init)?fu
nction(d){top.js.P(window,d)}:function(){};if(window==top){top
.location=â€?/gmail?ik=344af70c5d&amp;view=cv&amp;search=inbox&amp;th=101865
c04ac2427f&amp;lvp=-
1&amp;cvp=0&amp;zx=9m4966e44e98uu&amp;fs=1â€?;}&lt;/script&gt;&lt;script&gt;<!--
D([â€œvâ€?,â€?15b3e78585d3c7bbâ€?,â€?33fc762357568758â€?]
);
D([â€œiâ€?,6]
);
D([â€œquâ€?,â€?1 MBâ€?,â€?1000 MBâ€?,â€?0%â€?,â€?#006633â€?]
);
D([â€œftâ€?,â€?Compose a message in a new window by pressing
\â€?Shift\â€? while clicking Compose Mail or Reply.â€?]
);
D([â€œdsâ€?,1,0,0,0,0,16,0]
);
D([â€œctâ€?,[[â€œHeadsâ€?,0]
,[â€œKneesâ€?,0]
,[â€œShouldersâ€?,0]
,[â€œToesâ€?,0]
]
]
);
D([â€œcsâ€?,â€?101865c04ac2427fâ€?,â€?This is the third messageâ€?,â€?This
is the third messageâ€?,â€?â€?,[â€œ^iâ€?]
,[]
,0,1,â€?h3ttlgu1hqiz9324trq5kp5qo7wa96sâ€?,,â€?101865c04ac2427fâ€?]
);
D([â€œmiâ€?,0,1,â€?101865c04ac2427fâ€?,0,â€?0â€?,â€?Ben
Hammersleyâ€?,â€?ben@benhammersley.comâ€?,â€?meâ€?,â€?4:05pm (2&frac12;
hours ago)â€?,[â€œBen Hammersley <a href="&#109;a&#x69;&#x6c;t&#111;&#x3a;&#x62;&#101;&#110;&#46;&#x68;&#x61;&#x6d;m&#x65;&#114;&#x73;&#x6c;&#101;&#121;&#64;&#103;&#x6d;&#97;&#x69;&#x6c;&#x2e;&#99;&#x6f;&#109;">&#x62;&#101;&#110;&#46;&#x68;&#x61;&#x6d;m&#x65;&#114;&#x73;&#x6c;&#101;&#121;&#64;&#103;&#x6d;&#97;&#x69;&#x6c;&#x2e;&#99;&#x6f;&#109;</a>â€?]
,[]
,[]
,[
064.233.171.105.00080-192.168.016.051.59936: ]
,â€?Tue, 18 Jan 2005 16:05:17 +0100â€?,â€?This is the third
messageâ€?,â€?â€?,[]
,1,,,â€?Tue Jan 18 2005_7:05AMâ€?]
Chapter 5 â€” How Gmail Works 83
);
D([â€œmbâ€?,â€?3rd! THREE! THIRD!&lt;br&gt;&lt;br&gt;â€?,0]
);
D([â€œceâ€?]);
//-->&lt;/script&gt;&lt;script&gt;var
loaded=true;D([â€˜eâ€™]);&lt;/script&gt;&lt;script&gt;try{top.js.L(window,70,â€™
1
ab915da64â€™);}catch(e){}&lt;/script&gt;
First thing first: the URL. Requesting this message caused Gmail to load this
URL:
/gmail?ik=344af70c5d&amp;view=cv&amp;search=inbox&amp;th=101865c04ac2427f&amp;l
vp=-1&amp;cvp=0&amp;zx=9m4966e44e98uu.
Or, to put it more understandably:
/gmail?
ik=344af70c5d
&amp;view=cv
&amp;search=inbox
&amp;th=101865c04ac2427f
&amp;lvp=-1
&amp;cvp=0
&amp;zx=9m4966e44e98uu
As you can see, th is the message ID of the message I clicked on. But the others
are mysterious at the moment.
At this point in the proceedings, alarms went off in my head.Why, I was thinking,
is the variable for message ID thâ€”when that probably stands for thread. So,
I sent a few mails back and forth to create a thread, and loaded the Inbox and the
message back up again under Tcpflow. Listing 5-13 shows the resulting trace. It is
illuminating.
Listing 5-13: Retrieving a Thread, Not a Message
THE INBOX LOADING:
D([â€œtâ€?,[â€œ10187696869432e6â€?,1,0,â€?&lt;b&gt;9:00pm&lt;/b&gt;â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;Ben&lt;/span&gt;, &lt;span
id=\â€™_user_ben.hammersley@gmail.com\â€™&gt;me&lt;/span&gt;, &lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;&lt;b&gt;Ben&lt;/b&gt;&lt;/span&gt;
(3)â€?,â€?&lt;b&gt;Â»&lt;/b&gt;Â â€?,â€?&lt;b&gt;This is the third
message&lt;/b&gt;â€?,,[]
Continued
84 Part II â€” Getting Inside Gmail
Listing 5-13 (continued)
,â€?â€?,â€?10187696869432e6â€?,0,â€?Tue Jan 18 2005_12:00PMâ€?]
,[â€œ101865b95fc7a35aâ€?,1,0,â€?&lt;b&gt;4:05pm&lt;/b&gt;â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;&lt;b&gt;Ben
Hammersley&lt;/b&gt;&lt;/span&gt;â€?,â€?&lt;b&gt;Â»&lt;/b&gt;Â â€?,â€?&lt;b&gt;This is the
second message&lt;/b&gt;â€?,,[]
,â€?â€?,â€?101865b95fc7a35aâ€?,0,â€?Tue Jan 18 2005_7:05AMâ€?]
,[â€œ101480d8ef5dc74aâ€?,0,1,â€?Jan 6â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;Ben
Hammersley&lt;/span&gt;â€?,â€?&lt;b&gt;Â»&lt;/b&gt;Â â€?,â€?Here\â€™s a nice
message.â€?,,[â€œ^tâ€?,â€?Headsâ€?]
,â€?â€?,â€?101480d8ef5dc74aâ€?,0,â€?Thu Jan 6 2005_4:44AMâ€?]
]
);
D([â€œteâ€?]);
THE GETTING MESSAGE EXCHANGE
192.168.016.051.61753-216.239.057.105.00080: GET
/gmail?ik=344af70c5d&amp;view=cv&amp;search=inbox&amp;th=10187696869432e6&amp;
lvp=-1&amp;cvp=0&amp;zx=24lfl9e44iyx7g HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O;
en-GB; rv:1.7.5) Gecko/20041110 Firefox/1.0
Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9
,text/plain;q=0.8,image/png,<em>/</em>;q=0.5
Accept-Language: en-gb,en;q=0.5
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer:
<a href="http://gmail.google.com/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0">http://gmail.google.com/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0</a>
&amp;init=1&amp;zx=cs149e44iu4pd
Cookie: GV=101018770f6a0-36b4c5fcaa4913584af2219efa21740e;
SID=DQAAAGoAAACTZryXzUYHgTI4VWtHGXDY5J8vchRrqp_Ek4XjEgdZYQwBUE
Chapter 5 â€” How Gmail Works 85
pXOuyokCt-EOOmsaL8J8_bQ3jkrMfskffoH8Mb6GvEJJPAhS6noKP8IjnREcWN8MTvIPeqOYYoxE52oLva00EWdOrsGhtCy18RphU;
GMAIL_AT=aa5dcfedda2d8658-1018770f6a2; S=gmail=pl14BJCt_
4:gmproxy=c9z4V0uxx2o; TZ=-60; GMAIL_SU=1;
PREF=ID=e38a980ef675b953:TM=1106078936:LM=1106078936:GM=1:S=T0
D_V1EFUHr7faSw; GBE=d-540-800
216.239.057.105.00080-192.168.016.051.61753: HTTP/1.1 200 OK
Set-Cookie:
SID=DQAAAGoAAACTZryXzUYHgTI4VWtHGXDY5J8vchRrqp_Ek4XjEgdZYQwBUE
pXOuyokCt-EOOmsaL8J8_bQ3jkrMfskffoH8Mb6GvEJJPAhS6noKP8IjnREcWN8MTvIPeqOYYoxE52oLva00EWdOrsGhtCy18RphU;
<a href="http://Domain=.google.com">Domain=.google.com</a>
;Path=/
Set-Cookie: GBE=; Expires=Mon, 17-Jan-05 20:12:34 GMT; Path=/
Set-Cookie: GMAIL_SU=; Expires=Mon, 17-Jan-05 20:12:34 GMT;
Path=/
Cache-control: no-cache
Pragma: no-cache
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Server: GFE/1.3
Date: Tue, 18 Jan 2005 20:12:34 GMT
b23
&lt;html&gt;&lt;head&gt;&lt;meta content=â€?text/html; charset=UTF-8â€? httpequiv=â€?
content-typeâ€?&gt;&lt;/head&gt;&lt;script&gt;D=(top.js&amp;&amp;top.js.init)?fu
nction(d){top.js.P(window,d)}:function(){};if(window==top){top
.location=â€?/gmail?ik=344af70c5d&amp;view=cv&amp;search=inbox&amp;th=101876
96869432e6&amp;lvp=-
1&amp;cvp=0&amp;zx=24lfl9e44iyx7g&amp;fs=1â€?;}&lt;/script&gt;&lt;script&gt;<!--
D([â€œsuâ€?,â€?33fc762357568758â€?,[â€œlâ€?,â€?/gmail/help/images/logo.gifâ€?,
â€?iâ€?,â€?Invite a friend to Gmailâ€?,â€?jâ€?,â€?Invite PH_NUM friends to
Gmailâ€?]
Continued
86 Part II â€” Getting Inside Gmail
Listing 5-13 (continued)
]
);
D([â€œvâ€?,â€?15b3e78585d3c7bbâ€?,â€?33fc762357568758â€?]
);
D([â€œiâ€?,6]
);
D([â€œquâ€?,â€?1 MBâ€?,â€?1000 MBâ€?,â€?0%â€?,â€?#006633â€?]
);
D([â€œftâ€?,â€?Automatically &lt;span style=\â€?color:#0000CC;textdecoration:
underline;cursor:pointer;cursor:hand;white-space:no
wrap\â€? id=\â€?prf_d\â€?&gt;&lt;b&gt;forward&lt;/b&gt;&lt;/span&gt; your Gmail messages
to another email account. &nbsp; &lt;a style=color:#0000CC
target=_blank
href=\â€?/support/bin/answer.py?ctx=gmail&amp;answer=10957\â€?&gt;Learn&amp;n
bsp;more&lt;/a&gt;â€?]
);
D
216.239.057.105.00080-192.168.016.051.61753:
([â€œdsâ€?,1,0,0,0,0,16,0]
);
D([â€œctâ€?,[[â€œHeadsâ€?,0]
,[â€œKneesâ€?,0]
,[â€œShouldersâ€?,0]
,[â€œToesâ€?,0]
]
]
);
D([â€œcsâ€?,â€?10187696869432e6â€?,â€?This is the third messageâ€?,â€?This
is the third messageâ€?,â€?â€?,[â€œ^iâ€?]
,[]
,0,3,â€?g6yz3b2a3jhoga7fql7qx3yo6l9gvyfâ€?,,â€?10187696869432e6â€?]
);
D([â€œmiâ€?,2,1,â€?101865c04ac2427fâ€?,0,â€?0â€?,â€?Ben
Hammersleyâ€?,â€?ben@benhammersley.comâ€?,â€?meâ€?,â€?4:05pm (5 hours
ago)â€?,[â€œBen Hammersley <a href="&#109;&#x61;&#105;&#x6c;t&#x6f;&#x3a;&#x62;e&#110;&#46;&#x68;&#x61;&#x6d;&#x6d;&#x65;r&#x73;&#108;e&#121;&#64;g&#109;&#97;&#105;&#x6c;&#46;&#99;&#111;&#x6d;">&#x62;e&#110;&#46;&#x68;&#x61;&#x6d;&#x6d;&#x65;r&#x73;&#108;e&#121;&#64;g&#109;&#97;&#105;&#x6c;&#46;&#99;&#111;&#x6d;</a>â€?]
,[]
,[]
,[]
,â€?Tue, 18 Jan 2005 16:05:17 +0100â€?,â€?This is the third
messageâ€?,â€?3rd! THREE! THIRD!â€?,[]
,1,,,â€?Tue Jan 18 2005_7:05AMâ€?]
);
//-->&lt;/script&gt;&lt;script&gt;<!--
Chapter 5 â€” How Gmail Works 87
D([â€œmiâ€?,2,2,â€?101876847addcbd1â€?,0,â€?0â€?,â€?Ben
Hammersleyâ€?,â€?ben.hammersley@gmail.comâ€?,â€?Benâ€?,â€?8:59pm (13
minutes ago)â€?,[â€œBen Hammersley <a href="&#x6d;&#x61;i&#108;&#x74;&#x6f;&#58;&#x62;&#101;&#x6e;&#x40;&#98;&#101;&#110;h&#97;&#109;&#109;&#x65;&#x72;&#x73;&#108;&#x65;&#121;&#x2e;&#99;&#111;&#109;">&#x62;&#101;&#x6e;&#x40;&#98;&#101;&#110;h&#97;&#109;&#109;&#x65;&#x72;&#x73;&#108;&#x65;&#121;&#x2e;&#99;&#111;&#109;</a>â€?]
,[]
,[]
,[â€œBen Hammersley <a href="&#109;&#97;&#105;&#x6c;&#116;&#x6f;&#x3a;&#x62;&#x65;&#x6e;&#46;&#x68;&#97;&#109;&#x6d;&#x65;&#114;&#115;&#x6c;&#101;&#x79;&#64;&#103;&#109;&#x61;&#x69;&#x6c;&#46;c&#111;m">&#x62;&#x65;&#x6e;&#46;&#x68;&#97;&#109;&#x6d;&#x65;&#114;&#115;&#x6c;&#101;&#x79;&#64;&#103;&#109;&#x61;&#x69;&#x6c;&#46;c&#111;m</a>â€?]
,â€?Tue, 18 Jan 2005 20:59:13 +0100â€?,â€?Re: This is the third
messageâ€?,â€?And this is a reply back On Tue, 18 Jan 2005
16:05:17 +0100, Ben Hammersley &lt;...â€?,[]
,1,,,â€?Tue Jan 18 2005_11:59AMâ€?]
);
D([â€œmiâ€?,0,3,â€?10187696869432e6â€?,0,â€?0â€?,â€?Ben
Hammersleyâ€?,â€?ben@benhammersley.comâ€?,â€?meâ€?,â€?8:59pm (12 minutes
ago)â€?,[â€œBen Hammersley <a href="&#109;&#x61;&#105;&#x6c;t&#x6f;&#x3a;&#x62;&#101;&#x6e;&#x2e;h&#x61;&#x6d;&#x6d;&#x65;&#114;&#115;&#108;&#x65;&#121;&#64;&#x67;&#109;ail&#46;&#x63;&#111;&#109;">&#x62;&#101;&#x6e;&#x2e;h&#x61;&#x6d;&#x6d;&#x65;&#114;&#115;&#108;&#x65;&#121;&#64;&#x67;&#109;ail&#46;&#x63;&#111;&#109;</a>â€?]
,[]
,[]
,[]
,â€?Tue, 18 Jan 2005 20:59:40 +0100â€?,â€?Re: This is the third
messageâ€?,â€?â€?,[]
,1,,,â€?Tue Jan 18 2005_11:59AMâ€?]
);
D([â€œmbâ€?,â€?And this is another reply back yet again&lt;br&gt;â€?,1]
);
D([â€œmbâ€?,â€?&lt;div&gt;&lt;div class=ea&gt;&lt;span id=e_10187696869432e6_1&gt;-
Show quoted text -&lt;/span&gt;&lt;/div&gt;&lt;span class=e
216.239.057.105.00080-192.168.016.051.61753:
id=q_10187696869432e6_1&gt;&lt;br&gt;On 18 Jan 2005, at 20:59, Ben
Hammersley wrote:&lt;br&gt;&lt;br&gt;&gt; And this is a reply
back&lt;br&gt;&gt;&lt;br&gt;&gt;&lt;br&gt;&gt; On Tue, 18 Jan 2005 16:05:17
+0100, Ben Hammersley&lt;br&gt;&gt; &lt;&lt;a onclick=\â€?return
top.js.OpenExtLink(window,event,this)\â€?
href=\â€?mailto:ben@benhammersley.com\â€?&gt;ben@benhammersley.com&lt;/a
&gt;&gt; wrote:&lt;br&gt;&gt;&gt; 3rd! THREE!
THIRD!&lt;br&gt;&gt;&gt;&lt;br&gt;&gt;&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;â€?,0]
);
D([â€œceâ€?]);
//-->&lt;/script&gt;&lt;script&gt;var
loaded=true;D([â€˜eâ€™]);&lt;/script&gt;&lt;script&gt;try{top.js.L(window,32,â€™
9
36bba732bâ€™);}catch(e){}&lt;/script&gt;
As you can deduce, th does indeed stand for thread. In Gmail, it turns out, you do
not just retrieve single messages. Rather, you retrieve the requested message and
also the entire set of headers for the rest of the messages in the thread. You can see
88 Part II â€” Getting Inside Gmail
this quite clearly in the example above. The lines in bold type show the headers
for all three messages, and the whole thing finishes with the entire content of the
requested message.
You then allow the JavaScript code to wrangle the interface afterward. This is a
clever trick: it allows the interface to be very quick at the point the user wants it to
beâ€”when youâ€™re reading through a threadâ€”instead of loading each message
individually.
So, you now know how to retrieve messages. But how do you read them?
Listing 5-14 shows the relevant bit of JavaScript.
Listing 5-14: The Message Itself
D([â€œmiâ€?,0,3,â€?10187696869432e6â€?,0,â€?0â€?,â€?Ben
Hammersleyâ€?,â€?ben@benhammersley.comâ€?,â€?meâ€?,â€?8:59pm (12 minutes
ago)â€?,[â€œBen Hammersley <a href="mailto:ben.hammersley@gmail.com">ben.hammersley@gmail.com</a>â€?]
,[]
,[]
,[]
,â€?Tue, 18 Jan 2005 20:59:40 +0100â€?,â€?Re: This is the third
messageâ€?,â€?â€?,[]
,1,,,â€?Tue Jan 18 2005_11:59AMâ€?]
);
D([â€œmbâ€?,â€?And this is another reply back yet again&lt;br&gt;â€?,1]
);
D([â€œmbâ€?,â€?&lt;div&gt;&lt;div class=ea&gt;&lt;span id=e_10187696869432e6_1&gt;-
Show quoted text -&lt;/span&gt;&lt;/div&gt;&lt;span class=e
id=q_10187696869432e6_1&gt;&lt;br&gt;On 18 Jan 2005, at 20:59, Ben
Hammersley wrote:&lt;br&gt;&lt;br&gt;&gt; And this is a reply
back&lt;br&gt;&gt;&lt;br&gt;&gt;&lt;br&gt;&gt; On Tue, 18 Jan 2005 16:05:17
+0100, Ben Hammersley&lt;br&gt;&gt; &lt;&lt;a onclick=\â€?return
top.js.OpenExtLink(window,event,this)\â€?
href=\â€?mailto:ben@benhammersley.com\â€?&gt;ben@benhammersley.com&lt;/a
&gt;&gt; wrote:&lt;br&gt;&gt;&gt; 3rd! THREE!
THIRD!&lt;br&gt;&gt;&gt;&lt;br&gt;&gt;&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;â€?,0]
);
From this you can see that the message is sent in three JavaScript arrays. D([â€œmiâ€?
contains the header informationâ€”its status, the message ID, who sent it, and so
onâ€”and then there are two arrays starting with D([â€œmbâ€? that contain the first
Chapter 5 â€” How Gmail Works 89
line and the whole rest of the message, respectively, marked up in HTML. Parsing
this out, as you will in Chapter 8, will be easy. So you now know how to request a
message and read it.
And Now . . .
In this chapter, you learned how Gmail works, and you looked at the techniques
you would use to probe the system for the knowledge you need to communicate
with the Gmail server directly. You can log in, request mail, read mail, and access
label titles and other sorts of information. In the next chapter, however, you will
look at the existing APIs for Gmailâ€”both confirming what you have learned
hereâ€”and learn how to put your new expertise to use.</p>

<p>Gmail and
Greasemonkey
Another phenomenon to hit the web at the same time as
Gmail was the Firefox browser. Indeed, the growth of this
open source application easily rivaled Gmail for shocking
explosiveness. Apart from the additional security benefits and
tasty user interface advantages that Firefox gives, the browser is
also open to a considerable amount of hacking in itself. One of
the key hacks for Firefox was Greasemonkey. In this chapter, you
learn how Greasemonkey and Firefox can be used to radically
improve your Gmail experience, and how the understanding you
now have about the workings of Gmail will enable you to build
your own Greasemonkey scripts.
What Is Greasemonkey?
Greasemonkey allows the user to assign snippets of JavaScript
code to run automatically whenever a certain page is loaded. The
upshot of this is that you can write JavaScript code that will customize
those web pages, modifying layout, adding new features,
or removing extraneous parts of the page. Greasemonkey has
been used to remove advertising, rewrite links, add new links to
other sites, and even add completely new menus to sites. Gmail,
being one huge hunk of burning JavaScript, is beautifully positioned
to be taken advantage of by Greasemonkey.
To use Greasemonkey, you have to install it first. Do that by getting
the latest version from <a href="http://greasemonkey.mozdev">http://greasemonkey.mozdev</a>.
org/.
The snippets of JavaScript used by Greasemonkey are called userscripts.
They need to be installed into Firefox for the application to
work. You do that like this: Go to the page with the userscript in
it. It will look really ugly, with lots of JavaScript, and the top 20 or
so lines preceded by double forward-slashes, as in Figure 6-1.
Ë› What is
Greasemonkey?
Ë› Using userscripts
Ë› Customizing the
Gmail experience
chapter
in this chapter
92 Part II â€” Getting Inside Gmail
Click Tools, and then Install User Script. Check that everything looks okay.
(Nothing red and scary? Good, carry on.) Thatâ€™s it. Youâ€™re done.
FIGURE 6-1: Firefox and Greasemonkey
The Userscripts
Now that you know how to install userscripts, you can start to use them.
Ordinarily, you wouldnâ€™t have to type the code in, seeing as you just point your
browser to the site and let fly with the installation procedure, as detailed in the
preceding text, but you can learn a lot from looking at the code. For the next few
examples, therefore, you shall take a look. There are techniques to be learned, and
inspiration to be had, here.
Displaying Bloglines Within Gmail
Bloglinesâ€”shown in Figure 6-2â€”is another great web-based application. Itâ€™s an
RSS readerâ€”you can use it to keep track of hundreds of sitesâ€™ content by subscribing
to each of the sitesâ€™ feeds. Many users, myself included, keep close to a
hundred sites in their Bloglines subscription. Some have many more. Indeed, the
regular trawl of unread news items in Bloglines is close to as important as the regular
checking of my Inbox.
Chapter 6 â€” Gmail and Greasemonkey 93
FIGURE 6-2: The Bloglines Greasemonkey extension in action
Martin Sersaleâ€™s beautiful code, which can be installed from
<a href="http://www.n3rds.com.ar/greasemonkey/bloglines+gmail.user.js">http://www.n3rds.com.ar/greasemonkey/bloglines+gmail.user.js</a>,
allows you to combine the two. First, the listing, and then we shall talk about the
more interesting sections. The whole thing is listed here, in Listing 6-1, as itâ€™s full
of very useful stuff.
Listing 6-1: Displaying Bloglines with Gmail
// Displays a box in Gmail with your Bloglines feeds
// version 0.1
// 2005-05-02
// Copyright (c) 2005, Martin Sarsale -
<a href="mailto:martin@malditainternet.com">martin@malditainternet.com</a>
// Released under the GPL license
// <a href="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</a></p>

<h5>// -----------------------------------------------------------</h5>

<p>// ==UserScript==
// @name Bloglines
// @namespace
<a href="http://martin.malditainternet.com/greasemonkey/gmail+bloglines">http://martin.malditainternet.com/greasemonkey/gmail+bloglines</a>
/
// @include <a href="https://gmail.google.com/*">https://gmail.google.com/*</a>
Continued
94 Part II â€” Getting Inside Gmail
Listing 6-1 (continued)
// @include <a href="http://gmail.google.com/*">http://gmail.google.com/*</a>
// @include <a href="http://mail.google.com/*">http://mail.google.com/*</a>
// @include <a href="https://mail.google.com/*">https://mail.google.com/*</a>
// @include <a href="http://gmail.google.com/gmail?logout&amp;hl=en">http://gmail.google.com/gmail?logout&amp;hl=en</a>
// @include
<a href="https://www.google.com/accounts/ServiceLogin?service=mail*">https://www.google.com/accounts/ServiceLogin?service=mail*</a>
// @exclude
// @description Displays a box in Gmail with your Bloglines
feeds
// ==/UserScript==
(function(){
var __items={};
function cache_gotsubs(e){
GM_setValue(â€˜subsâ€™,e[â€˜responseTextâ€™]);
GM_setValue(â€˜subs_updatedâ€™,Date.parse(Date())/1000)
//GM_log/gci(â€˜getting data, subs_updated set to
â€˜+GM_getValue(â€˜subs_updatedâ€™,0));
gotsubs(e);
}
function getcachedsubs(){
var v=GM_getValue(â€˜subsâ€™,null);
if (v){
updated=GM_getValue(â€˜subs_updatedâ€™,0);
d=Date.parse(Date())/1000;
if ((d - updated) &gt; 300){
//GM_log/gci(â€˜cache expired: â€˜+(d -
updated)+â€?(â€œ+d+â€? - â€œ+updated+â€?)â€?);
return false;
}else{
return v;
}
}
return false;
}
function getsubs(){
v=getcachedsubs();
if (v){
gotsubs(v);
return true;
}
getsubs();
}
function _getsubs(){
GM_xmlhttpRequest({â€˜methodâ€™:â€™GETâ€™,â€™urlâ€™:â€?http://rpc.bloglines.
com/listsubsâ€?,â€™onloadâ€™:cache_gotsubs});
Chapter 6 â€” Gmail and Greasemonkey 95
}
function parsesubs(r){
parser=new DOMParser();
dom=parser.parseFromString(r,â€™text/xmlâ€™);
outlines=dom.getElementsByTagName(â€˜outlineâ€™);
subs=new Array();
for(i=0; i&lt;outlines.length; i++){
if (outlines[i].getAttribute(â€˜typeâ€™) != undefined
){
d={ â€˜titleâ€™:outlines[i].getAttribute(â€˜titleâ€™),
â€˜htmlUrlâ€™:outlines[i].getAttribute(â€˜htmlUrlâ€™),
â€˜typeâ€™:outlines[i].getAttribute(â€˜typeâ€™),
â€˜xmlUrlâ€™:outlines[i].getAttribute(â€˜xmlUrlâ€™),
â€˜BloglinesSubIdâ€™:outlines[i].getAttribute(â€˜BloglinesSubIdâ€™),
â€˜BloglinesUnreadâ€™:outlines[i].getAttribute(â€˜BloglinesUnreadâ€™)
};
subs[subs.length]=d;
}
}
return subs;
}
function gotsubs(response){
if (typeof(response)==â€™objectâ€™){
data=response[â€˜responseTextâ€™];
}else{
data=response;
}
r=parsesubs(data);
r.sort(function(a,b){; var r=a[â€˜BloglinesUnreadâ€™] &gt;
b[â€˜BloglinesUnreadâ€™]; if(r){return -1}else{return 1} });
addsubhtml_init();
for(i=0; i&lt;r.length; i++){
addsubhtml(r[i]);
}
addsubhtml_end();
}
function addsubhtml_end(){
ul=document.getElementById(â€˜bloglines_subsâ€™);
if (ul){
GM_setValue(â€˜subs_cached_htmlâ€™,ul.innerHTML);
}
}
function createbutton(str){
a=document.createElement(â€˜divâ€™);
a.appendChild(document.createTextNode(str))
a.style.backgroundColor=â€™#ddddddâ€™;
a.style.borderStyle=â€™outsetâ€™;
a.style.borderColor=â€™#eeeeeeâ€™;
Continued
96 Part II â€” Getting Inside Gmail
Listing 6-1 (continued)
a.style.borderWidth=â€™2pxâ€™;
a.style.width=â€™10pxâ€™;
a.style.height=â€™10pxâ€™;
a.style.lineHeight=â€™10pxâ€™;
a.style.verticalAlign=â€™middleâ€™;
a.style.textAlign=â€™centerâ€™;
a.style.fontSize=â€™x-smallâ€™;
a.style.fontWeight=â€™boldâ€™;
a.style.position=â€™absoluteâ€™;
a.style.top=â€™0pxâ€™;
a.style.right=â€™0pxâ€™;
return a;
}
function addsubhtml_init(){
ul=document.getElementById(â€˜bloglines_subsâ€™);
ul.innerHTML=â€™â€™;
if (!document.getElementById(â€˜bloglines_reloadâ€™)){
a=createbutton(â€˜Râ€™);
a.addEventListener(â€˜clickâ€™,_getsubs,false);
a.id=â€™bloglines_reloadâ€™;
ul.parentNode.appendChild(a);
}
}
function addsubhtml(d){
ul=document.getElementById(â€˜bloglines_subsâ€™);
li=document.createElement(â€˜liâ€™);
li.className=â€™nlâ€™;
li.style.padding=â€™0pxâ€™;
li.style.margin=â€™0pxâ€™;
li.style.width=â€™100%â€™;
li.style.overflow=â€™hiddenâ€™;
a=document.createElement(â€˜aâ€™);
a.id=d[â€˜BloglinesSubIdâ€™];
a.href=â€™http://www.bloglines.com/myblogs_display?sub=â€™+d[â€˜Blog
linesSubIdâ€™]+â€™&amp;site=0â€™;
a.target=â€™_blankâ€™;
txt=d[â€˜titleâ€™]
a.style.fontSize=â€™smallâ€™;
if (d[â€˜BloglinesUnreadâ€™]&gt;0){
a.style.fontWeight=â€™boldâ€™;
txt=txt+â€? (â€œ+d[â€˜BloglinesUnreadâ€™]+â€?)â€?;
Chapter 6 â€” Gmail and Greasemonkey 97
}
a.appendChild(document.createTextNode(txt));
li.appendChild(a);
ul.appendChild(li);
}
function getsub(e){
id=e.target.id;
GM_xmlhttpRequest({â€˜methodâ€™:â€™GETâ€™,â€™urlâ€™:â€?http://rpc.bloglines.
com/getitems?n=0&amp;s=â€?+id,â€™onloadâ€™:gotsub});
}
function gotsub(r){
var d=parsesub(r[â€˜responseTextâ€™]);
for(var i=0; i&lt;d.length; i++){
item=d[i];
items[getText(item.getElementsByTagName(â€˜guidâ€™)[0])]=item;
}
for(i=0; i&lt;d.length; i++){
item=d[i];
displaysubhtml(item);
}
}
function displaysubhtml(item){
li=document.createElement(â€˜liâ€™);
b=document.getElementById(â€˜itemsâ€™);
a=document.createElement(â€˜aâ€™);
a.id=getText(item.getElementsByTagName(â€˜guidâ€™)[0]);
a.addEventListener(â€˜clickâ€™,displayitem,false);
a.appendChild(document.createTextNode(getText(item.getElements
ByTagName(â€˜titleâ€™)[0])));
li.appendChild(a);
b.appendChild(li);
}
function displayitem(e){
id=e.target.id;
var item=__items[id];
displayitemhtml(item);
}
function displayitemhtml(item){
i=document.getElementById(â€˜itemâ€™);
i.innerHTML=getText(item.getElementsByTagName(â€˜descriptionâ€™)[0
]);
Continued
98 Part II â€” Getting Inside Gmail
Listing 6-1 (continued)
}
function getText(e){
nodes=e.childNodes;
for (var i=0; i&lt;nodes.length; i++){
if (nodes[i].nodeValue != null){
return nodes[i].nodeValue;
}
}
}
function parsesub(r){
parser=new DOMParser();
dom=parser.parseFromString(r,â€™text/xmlâ€™);
r=dom.getElementsByTagName(â€˜itemâ€™);
return r;
}
function checkifpresenthtml(){
d=document.getElementById(â€˜nt_9â€™);
if (!d){
inithtml();
getsubs();
}
}
function switch_labels(){
for(i=0; i&lt;window.labels_readed.length; i++){
label=window.labels_readed[i];
if (label.style.display != â€˜noneâ€™){
label.style.display=â€™noneâ€™;
}else{
label.style.display=â€™blockâ€™;
}
}
}
function inithtml(){
bar=document.getElementById(â€˜navâ€™);
if (bar){
document.styleSheets[0].insertRule(â€˜ul#bloglines_subs&gt;li&gt;a{tex
t-decoration:none}â€™,document.styleSheets[0].length);
v=getcachedsubs();
if (v){
data=GM_getValue(â€˜subs_cached_htmlâ€™,â€™â€™);
}else{
data=â€™â€™;
Chapter 6 â€” Gmail and Greasemonkey 99
}
invite=document.getElementById(â€˜nb_1â€™);
if (invite){ invite.style.display=â€™noneâ€™; }
document.getElementById(â€˜ds_spamâ€™).parentNode.style.display=â€™n
oneâ€™;
document.getElementById(â€˜ds_allâ€™).parentNode.style.display=â€™no
neâ€™;
document.getElementById(â€˜ds_trashâ€™).parentNode.style.display=â€™
noneâ€™;
document.getElementById(â€˜compâ€™).parentNode.style.display=â€™none
â€™;
div=document.createElement(â€˜divâ€™);
div.style.paddingTop=â€™0pxâ€™;
div.id=â€™nb_9â€™;
html=â€?&lt;div style=â€™width:
95%;padding:0px;position:relativeâ€™&gt;&lt;table width=â€™100%â€™
style=â€™margin-top:0px;â€™ cellspacing=â€™0â€™ cellpadding=â€™0â€™
bgcolor=â€™#c3d9ffâ€™&gt; &lt;tbody&gt; &lt;tr height=â€™2â€™&gt; &lt;td class=â€™tlâ€™&gt;
&lt;/td&gt; &lt;td class=â€™trâ€™&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;div
style=â€™padding: 0pt 3px 1px; background: rgb(195, 217, 255)
none repeat scroll 0%; -moz-background-clip: initial; -mozbackground-
origin: initial; -moz-background-inline-policy:
initial;â€™&gt; &lt;div id=â€™nt_9â€™ class=â€™s hâ€™&gt; &lt;table cellspacing=â€™0â€™
cellpadding=â€™0â€™&gt; &lt;tbody&gt; &lt;tr&gt; &lt;td style=â€™vertical-align: top;â€™
class=â€™s hâ€™&gt; &lt;img width=â€™11â€™ height=â€™11â€™
src=â€™/gmail/images/opentriangle.gifâ€™ /&gt; &lt;/td&gt; &lt;td class=â€™sâ€™&gt;
Bloglines&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;table
cellspacing=â€™2â€™ class=â€™nbâ€™&gt; &lt;tbody&gt; &lt;tr&gt; &lt;td&gt;&lt;ul
id=â€™bloglines_subsâ€™ style=â€™width:100%; margin:0px;
padding:0px; list-style-type:noneâ€™&gt;â€?+data+â€?&lt;/ul&gt;&lt;/td&gt; &lt;/tr&gt;
&lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;table width=â€™100%â€™ cellspacing=â€™0â€™
cellpadding=â€™0â€™ bgcolor=â€™#c3d9ffâ€™&gt; &lt;tbody&gt; &lt;tr height=â€™2â€™&gt; &lt;td
class=â€™blâ€™&gt; &lt;/td&gt; &lt;td class=â€™brâ€™&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt;
&lt;/table&gt;&lt;/div&gt;â€?;
div.innerHTML=html;
bar.appendChild(div);
return true;
}
return false;
}
function init(){
return inithtml();
Continued
100 Part II â€” Getting Inside Gmail
Listing 6-1 (continued)
}
if
(window.location.href==â€™http://gmail.google.com/gmail?logout&amp;h
l=enâ€™ || window.location.href.substr(0,57) ==
â€˜https://www.google.com/accounts/ServiceLogin?service=mailâ€™ ){
//GM_log/gci(â€˜logoutâ€™);
GM_setValue(â€˜subsâ€™,null);
GM_setValue(â€˜subs_updateâ€™,null);
GM_setValue(â€˜subs_cached_htmlâ€™,null);
}else{
if(init()){
getsubs();
setInterval(checkifpresenthtml,1000);
}
}
})()
How It Works
Have a read through the preceding code. From the knowledge you have from the
chapters on skinning CSS and how the JavaScript within Gmail works, you
should be able to glean a little inkling into how it works. For the sake of brevity, I
wonâ€™t repeat all of the functions here, but to walk through, the first interesting
things are the _getsubs (note the plural and underscore) and parsesubs functions.
_getsubs uses the same xmlhttprequest system that Gmail does. _getsubs
requests your list of subscriptions from Bloglines.
Once the subs have been got by _getsubs, the script goes through a series of
functions to cache them. That is all at the top of the script, and causes the subscriptions
list to be collected only once an hour. (At the bottom of the script, the
very last function, is code to check if the page Greasemonkey can see is the one
you get only if the user has logged out of Gmail. If that page is hit, the cache is
emptied as well.)
A freshly retrieved list of subs is then passed through the parsesubs function.
This parses the XML of the subscription list into an array.
Note here that this is, so far, very useful stuff. Many sites provide information
feeds in XML, and all you have here really is a script that pulls in a feed (after
checking itâ€™s not in a cache) and parses it. You can reuse that structure to pull in
data from just about anywhere. Indeed, if an ordinary website has no feed, but is
well-formed XHTML, you can even use this same technique to screenscrape
something and display that information within a page.
Chapter 6 â€” Gmail and Greasemonkey 101
Even better, the script then has to go use the data in the subs list, which is placed
inside an array. In the getsub function (note the singular, and lack of underscore),
the script retrieves the XML of the feed. Once you have that, use the functions
displaysubhtml and inithtml to convert the XML of the feed into HTML
and display it on the page. From Chapter 4, even if you know no JavaScript, you
should be able decipher the meaning of lines such as this:
document.getElementById(â€˜ds_spamâ€™).parentNode.style.display=â€™noneâ€™;
They prevent the browser from displaying that particular div, making space for the
HTML it then adds onto the screen.
To go more deeply into this script would require another book, on JavaScript and
Greasemonkey at the very least, but I hope by reading through it you can see how
it works. Itâ€™s very hackableâ€”have a go at converting it to displaying information
from other XML-providing sources. The weather forecasts available at <a href="http://">http://</a>
weather.gov/xml/ are a good starting point. For extra inspiration, consider displaying
the weather at the location of a new mailâ€™s sender.Tricky one, that.
Add a Delete Button
Not content with grabbing data from other sources and chucking it all over the
site like some crazed mash-up DJ, you can also use Greasemonkey to add additional
user interface elements. Anthony Lieuallenâ€™s script at <a href="http://www.arantius">www.arantius</a>.
com/article/arantius/gmail+delete+button/ adds a Delete button to the
menu, as shown in Figure 6-3.
FIGURE 6-3: The added
Delete button
Without such a button, as you know, you have to move the message to trash.
Not much of a change, admittedly, but a nice UI improvement. Listing 6-2 shows
the code.
102 Part II â€” Getting Inside Gmail
Listing 6-2: Adding the Delete Button
// ==UserScript==
// @name Gmail Delete Button
// @namespace
<a href="http://www.arantius.com/article/arantius/gmail+delete+button/">http://www.arantius.com/article/arantius/gmail+delete+button/</a>
// @description Add a â€œDeleteâ€? button to Gmailâ€™s interface.
// @include http<em>://</em>mail.google.com/<em>mail</em>?*
// @version 2.9.1
// ==/UserScript==
//
// Version 2.91:
// - Japanese and Hungarian translation
// Version 2.9:
// - Compatibility upgrade, works in GM 0.6.2 in Firefox 1.5
Beta 1
// Version 2.8.3:
// - Polish translation
// Version 2.8.2:
// - Russian translation
// Version 2.8.1:
// - Bulgarian translation
// Version 2.8:
// - Cleaned up bits of the code. No more global scope
objects.
// - Deer Park compatible.
// Version 2.7.2:
// - Better i81n, file encoded as unicode, to be compatible
with newer
// versions of greasemonkey.
// Version 2.7:
// - Internationalization. If you speak a language other
than english,
// please check the existing text (if there) and/or suggest
the right
// word to mean â€˜Deleteâ€™ in your language.
// - A change to the default include path.
// Version 2.6:
// - Add button into starred and sent mail section as per
user request.
// - Rework logic to use events (mouse click and key press)
instead of
// timers to further ameliorate lockouts. Iâ€™ve recieved at
least one
// report that it was fixed by 2.3, and others that it was
not at 2.5.
Chapter 6 â€” Gmail and Greasemonkey 103
// Perhaps it was fixed and the timing of reports was off,
but this
// should make things more certain. I always welcome
constructive
// bug reports, I have never had a problem so I need
information from
// those who have to change anything.
// Version 2.5:
// - Change default include pattern to match a change in
Gmailâ€™s code.
// Version 2.4:
// - Remove red text. You may restore the red color by uncommenting
// the proper line in _gd_make_dom_button.
// - Do not show for a message in the spam folder.
// - Minor tweaks.
// Version 2.3:
// - Add/change code to track down/eliminate error
conditions.
// - Display error when there are no selected messages to
delete.
// - Include delete button in all labels and â€˜All Mailâ€™
section.
// Version 2.2:
// - Patched to work with GreaseMonkey 0.3.3
//</p>

<h5>// -----------------------------------------------------------</h5>

<p>// Originally written by Anthony Lieuallen of
<a href="http://www.arantius.com/">http://www.arantius.com/</a>
// Licensed for unlimited modification and redistribution as
long as
// this notice is kept intact.</p>

<h5>// -----------------------------------------------------------</h5>

<p>//
// If possible, please contact me regarding new features,
bugfixes
// or changes that I could integrate into the existing code
instead of
// creating a different script. Thank you
//
(function(){
function _gd_dumpErr(e) {
var s=â€™Error in Gmail Delete Button:\nâ€™;
s+=â€™ Line: â€˜+e.lineNumber+â€™\nâ€™;
Continued
104 Part II â€” Getting Inside Gmail
Listing 6-2 (continued)
s+=â€™ â€˜+e.name+â€™: â€˜+e.message+â€™\nâ€™;
dump(s);
}
function _gd_element(id) {
try {
var el=window.document.getElementById(id);
} catch (e) {
gd_dumpErr(e);
return false;
}
if (el) return el;
return false;
}
function _gd_gmail_delete(e) {
dump(â€˜Called _gd_gmail_delete()...\nâ€™);
//find the command box
var delete_button=e.target;
var
command_box=delete_button.parentNode.getElementsByTagName(â€˜sel
ectâ€™)[0];
command_box.onfocus();
//find the command index for â€˜move to trashâ€™
var delete_index=-1;
for (var i=0; i&lt;command_box.options.length; i++) {
if (â€˜trâ€™==command_box.options[i].value &amp;&amp;
!command_box.options[i].disabled ) {
delete_index=i;
break;
}
}
//donâ€™t try to continue if we canâ€™t move to trash now
if (-1==delete_index) {
var box=_gd_element(â€˜nt1â€™);
if (box) {
try {
//if we find the box put an error message in
it
box.firstChild.style.visibility=â€™visibleâ€™;
box.getElementsByTagName(â€˜tdâ€™)[1].innerHTML=â€™Could not delete.
Make sure at least one conversation is selected.â€™;
Chapter 6 â€” Gmail and Greasemonkey 105
} catch (e) {
gd_dumpErr(e);
}
}
return;
}
//set the command index and fire the change event
command_box.selectedIndex=delete_index;
command_box.onchange();
//command_box.dispatchEvent(â€˜clickâ€™);
//var evt=createEvent();
}
function _gd_make_dom_button(id) {
var delete_button=window.document.createElement(â€˜buttonâ€™);
delete_button.setAttribute(â€˜classâ€™, â€˜abâ€™);
delete_button.setAttribute(â€˜idâ€™, â€˜_gd_delete_buttonâ€™+id);
delete_button.addEventListener(â€˜clickâ€™, _gd_gmail_delete,
false);
//uncomment (remove the two leading slashes) from the next
line for red text
//delete_button.style.color=â€™#EE3311â€™;
//this is a little hack-y, but we can find the code for
the language here
var lang=â€™â€™;
try {
var
urlToTest=window.top.document.getElementsByTagName(â€˜frameâ€™)[1]
.src;
var
m=urlToTest.match(/html\/([^\/]*)\/loading.html$/);
if (null!=m) lang=m[1];
} catch (e) {
gd_dumpErr(e);
}
//now check that language, and find the right word!
var buttonText=â€™Deleteâ€™; //the default text for the
button, overriden
//in the switch below if we know
the right word
switch (lang) {
case â€˜itâ€™: buttonText=â€™Eliminaâ€™; break;
case â€˜esâ€™: buttonText=â€™Borrarâ€™; break;
case â€˜frâ€™: buttonText=â€™Supprimerâ€™; break;
//case â€˜pt-BRâ€™: buttonText=â€™Supress&amp;#227;oâ€™; break;
Continued
106 Part II â€” Getting Inside Gmail
Listing 6-2 (continued)
//it was suggested by a user that â€˜Apagaâ€™ is more proper
for this language
case â€˜pt-BRâ€™: buttonText=â€™Apagaâ€™; break;
case â€˜deâ€™: buttonText=â€™L&amp;#246;schenâ€™; break;
case â€˜bgâ€™:
buttonText=â€™&amp;#1048;&amp;#1079;&amp;#1090;&amp;#1088;&amp;#1080;&amp;#1081;â€™;
break;
case â€˜ruâ€™:
buttonText=â€™&amp;#1059;&amp;#1076;&amp;#1072;&amp;#1083;&amp;#1080;&amp;#1090;&amp;#1100;â€™
; break;
case â€˜plâ€™: buttonText=â€™Usu&amp;#324;â€™; break;
case â€˜jaâ€™:
buttonText=â€™\u30b4\u30df\u7bb1\u3078\u79fb\u52d5â€™; break;
case â€˜huâ€™: buttonText=â€™T&amp;#246;r&amp;#246;lâ€™; break;
}
delete_button.innerHTML=â€™&lt;b&gt;â€™+buttonText+â€™&lt;/b&gt;â€™;
return delete_button;
}
function _gd_insert_button(insert_container, id) {
if (!insert_container) return false;
if (_gd_element(â€˜_gd_delete_buttonâ€™+id)) {
return false;
}
//get the elements
var spacer, delete_button;
delete_button=_gd_make_dom_button(id);
spacer=insert_container.firstChild.nextSibling.cloneNode(false
);
//pick the right place to put them
var insert_point=insert_container.firstChild; //this is
default
if (2==id || 3==id) {
// 2 and 3 are inside the message and go at a
different place
insert_point=insert_point.nextSibling.nextSibling;
}
if (window.document.location.search.match(/search=query/))
{
//inside the search page we go yet different places
with different spacers
Chapter 6 â€” Gmail and Greasemonkey 107
if (0==id) {
spacer=insert_container.firstChild.nextSibling.nextSibling.clo
neNode(false);
insert_point=insert_container.firstChild.nextSibling.nextSibli
ng.nextSibling;
}
if (1==id)
spacer=window.document.createElement(â€˜spanâ€™); //no space
really needed here
} else if
(window.document.location.search.match(/search=sent/)) {
//inside the sent page we go yet different places with
different spacers
if (0==id) {
//spacer=insert_container.firstChild.nextSibling.nextSibling.c
loneNode(false);
//insert_point=insert_container.firstChild.nextSibling.nextSib
ling.nextSibling;
spacer=window.document.createTextNode(â€˜ â€˜);
insert_point=insert_container.firstChild.nextSibling.nextSibli
ng;
}
if (1==id)
spacer=window.document.createElement(â€˜spanâ€™); //no space
really needed here
}
//put them in
insert_container.insertBefore(spacer, insert_point);
insert_container.insertBefore(delete_button, spacer);
}
function _gd_place_delete_buttons() {
if (!window || !window.document || !window.document.body)
return;
var top_menu=_gd_element(â€˜tamuâ€™); if (top_menu)
_gd_insert_button(top_menu.parentNode, 0);
var bot_menu=_gd_element(â€˜bamuâ€™); if (bot_menu)
_gd_insert_button(bot_menu.parentNode, 1);
var mtp_menu=_gd_element(â€˜ctamuâ€™); if (mtp_menu)
_gd_insert_button(mtp_menu.parentNode, 2);
var mbt_menu=_gd_element(â€˜cbamuâ€™); if (mbt_menu)
_gd_insert_button(mbt_menu.parentNode, 3);
Continued
108 Part II â€” Getting Inside Gmail
Listing 6-2 (continued)
}
function _gd_button_event() {
try{
setTimeout(_gd_place_delete_buttons, 333);
gd_place_delete_buttons();
} catch(e) {
gd_dumpErr(e);
}
}
var s=window.document.location.search;
dump(â€˜Load gmail page: â€˜+s+â€™\nâ€™);
if (s.match(/\bsearch=(inbox|query|cat|all|starred|sent)\b/)
||
( s.match(/view=cv/) &amp;&amp; !s.match(/search=(trash|spam)/) )
) {
dump(â€˜==== Apply Gmail Delete Button to: ====\nâ€™+s+â€™\nâ€™);
//put the main button in
try{_gd_place_delete_buttons();}catch(e){dump(e.message);}
//set events to try adding buttons when the user does
things
//because gmail might create new places to need buttons.
window.addEventListener(â€˜mouseupâ€™, _gd_button_event,
false);
window.addEventListener(â€˜keyupâ€™, _gd_button_event, false);
}
})();
Again, without going into JavaScript too deeply, there are two things to note here.
The first is how it draws a new button into the page. The second is that the script
checks the language the interface is being displayed in and labels the button
accordingly. Very pleasingly done.
GmailSecure
Mark Pilgrimâ€™s userscript, GmailSecure, found at <a href="http://userscripts.org/">http://userscripts.org/</a>
scripts/show/1404 and in Listing 6-3, has a simple function: to force Gmail to
use HTTPS instead of HTTP.
Chapter 6 â€” Gmail and Greasemonkey 109
It is ridiculously simple, consisting simply of only one line of actual code (the rest, to
the chagrin of those of us who print on dead trees, is simply the license under which
the code is released, which has to be included). Hereâ€™s the line. Brace yourself:
location.href = location.href.replace(/^http:/, â€˜https:â€™);
Because Gmail works via either HTTP or HTTPS, all the userscript needs to do
is make sure that every time a hyperlink starts with http: that part of the URL is
replaced with https:.
Greasemonkey does this by invoking the location.href.replace function.
Listing 6-3: The Ludicrously Simple GmailSecure
// GMailSecure
// version 0.3 BETA!
// 2005-06-28
// Copyright (c) 2005, Mark Pilgrim
// Released under the GPL license
// <a href="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</a>
//</p>

<h5>// -----------------------------------------------------------</h5>

<p>//
// This is a Greasemonkey user script.
//
// To install, you need Greasemonkey:
<a href="http://greasemonkey.mozdev.org/">http://greasemonkey.mozdev.org/</a>
// Then restart Firefox and revisit this script.
// Under Tools, there will be a new menu item to â€œInstall User
Scriptâ€?.
// Accept the default configuration and install.
//
// To uninstall, go to Tools/Manage User Scripts,
// select â€œGMailSecureâ€?, and click Uninstall.
//</p>

<h5>// -----------------------------------------------------------</h5>

<p>//
// ==UserScript==
// @name GMailSecure
// @namespace
<a href="http://diveintomark.org/projects/greasemonkey/">http://diveintomark.org/projects/greasemonkey/</a>
// @description force GMail to use secure connection
// @include <a href="http://mail.google.com/*">http://mail.google.com/*</a>
// ==/UserScript==
/* BEGIN LICENSE BLOCK
Continued
110 Part II â€” Getting Inside Gmail
Listing 6-3 (continued)
Copyright (C) 2005 Mark Pilgrim
This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.
This program is distributed in the hope that it will be
useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.
You can download a copy of the GNU General Public License at
<a href="http://diveintomark.org/projects/greasemonkey/COPYING">http://diveintomark.org/projects/greasemonkey/COPYING</a>
or get a free printed copy by writing to the Free Software
Foundation,
Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301,
USA.
END LICENSE BLOCK */
location.href = location.href.replace(/^http:/, â€˜https:â€™);
//
// ChangeLog
// 2005-07-08 - 0.3 - MAP - added license block
// 2005-06-28 - 0.2 - MAP - changed GMail URL
//
This idea, rewriting URLs, can be very powerfully used.With Mark Pilgrimâ€™s
technique of using location.href.replace, you can do this by brute force.
With the next example, â€œMailto Compose in Gmail,â€? you will see the more radical
version of this.
MailtoComposeInGmail
Perhaps the biggest issue that hits Gmail users, if they start to use the application
as their primary e-mail tool, is that mailto: links found within e-mails do not
trigger Gmail, but rather cause your operating system to load up what it thinks is
the default e-mail application. One moment of thoughtless clicking, and Outlook
Express starts appearing all over the screen. Nausea and discomfort result.
Chapter 6 â€” Gmail and Greasemonkey 111
Julien Couvreurâ€™s MailtoComposeInGmail userscript solves this issue. It applies
itself to every site apart from Gmail, rewriting the mailto: links it finds into a
link that opens the Gmail compose page, with the to: and subject: lines
already filled in.
Listing 6-4 elucidates the userscript. Afterwards, you will see how it works.
Listing 6-4: MailtoComposeInGmail
// MailtoComposeInGMail
// version 0.1
// 2005-03-28
// Copyright (c) 2005, Julien Couvreur
// Released under the GPL license
// <a href="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</a></p>

<h5>// -----------------------------------------------------------</h5>

<p>//
// This is a Greasemonkey user script.
//
// To install, you need Greasemonkey:
<a href="http://greasemonkey.mozdev.org/">http://greasemonkey.mozdev.org/</a>
// Then restart Firefox and revisit this script.
// Under Tools, there will be a new menu item to â€œInstall User
Scriptâ€?.
// Accept the default configuration and install.
//
// To uninstall, go to Tools/Manage User Scripts,
// select â€œMailto Compose In GMailâ€?, and click Uninstall.
//
// Aaron Boodman also has a similar script, at:
// <a href="http://youngpup.net/userscripts/gmailto.user.js">http://youngpup.net/userscripts/gmailto.user.js</a>
// In his approach, the links are re-written at the time that
you click
// on them. One benefit is that the link still looks like
mailto:x
// when you hover over it.</p>

<h5>// -----------------------------------------------------------</h5>

<p>//
// WHAT IT DOES:
// After the page is loaded, look for â€œmailto:â€? links and
hooks their onclick
// event to go to GMailâ€™s compose page, passing all the usual
parameters
// (to, cc, subject, body,...).
Continued
112 Part II â€” Getting Inside Gmail
Listing 6-4 (continued)</p>

<h5>// -----------------------------------------------------------</h5>

<p>//
// ==UserScript==
// @name Mailto Compose In GMail
// @namespace
<a href="http://blog.monstuff.com/archives/000238.html">http://blog.monstuff.com/archives/000238.html</a>
// @description Rewrites â€œmailto:â€? links to GMail compose
links
// @include *
// @exclude <a href="http://gmail.google.com">http://gmail.google.com</a>
// ==/UserScript==
(function() {
var processMailtoLinks = function() {
var xpath = â€œ//a[starts-with(@href,â€™mailto:â€™)]â€?;
var res = document.evaluate(xpath, document, null,
XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
var linkIndex, mailtoLink;
for (linkIndex = 0; linkIndex &lt; res.snapshotLength;
linkIndex++) {
mailtoLink = res.snapshotItem(linkIndex);
//alert(mailtoLink.href);
var m = mailtoLink.href;
var matches =
m.match(/^mailto:([^\?]+)(\?([^?]<em>))?/);
var emailTo, params, emailCC, emailSubject,
emailBody;
emailTo = matches[1];
//alert(â€œFound to=â€? + emailTo);
params = matches[3];
if (params) {
var splitQS = params.split(â€˜&amp;â€™);
var paramIndex, param;
for (paramIndex = 0; paramIndex &lt;
splitQS.length; paramIndex++) {
param = splitQS[paramIndex];
nameValue = param.match(/([^=]+)=(.</em>)/);
Chapter 6 â€” Gmail and Greasemonkey 113
if (nameValue &amp;&amp; nameValue.length == 3) {
// depending on name, store value in a
pre-defined location
switch(nameValue[1]) {
case â€œtoâ€?:
emailTo = emailTo + â€œ%2C%20â€? +
nameValue[2];
break;
case â€œccâ€?:
emailCC = nameValue[2];
//alert(â€œFound CC=â€? +
emailCC);
break;
case â€œsubjectâ€?:
emailSubject = nameValue[2];
//alert(â€œFound subject=â€? +
emailSubject);
break;
case â€œbodyâ€?:
emailBody = nameValue[2];
//alert(â€œFound body=â€? +
emailBody);
break;
}
}
}
}
mailtoLink.href =
â€œhttps://mail.google.com/mail?view=cm&amp;tf=0â€? +
(emailTo ? (â€œ&amp;to=â€? + emailTo) : â€œâ€?) +
(emailCC ? (â€œ&amp;cc=â€? + emailCC) : â€œâ€?) +
(emailSubject ? (â€œ&amp;su=â€? + emailSubject) : â€œâ€?)
+
(emailBody ? (â€œ&amp;body=â€? + emailBody) : â€œâ€?);
// mailtoLink.onclick = function() { location.href
= newUrl; return false; };
}
}
window.addEventListener(â€œloadâ€?, processMailtoLinks,
false);
})();
Instead of rewriting the mailto: links directly, as Mark Pilgrimâ€™s script does to
make HTTP links into HTTPS, this script adds a JavaScript onclick function
114 Part II â€” Getting Inside Gmail
to the link instead.When you click such a link, Firefox fires off the JavaScript
function instead of following the link. The onclick function, in turn, opens the
page in Gmail that allows a mail to be composed. Because mailto: links can contain
the recipients, message subject, and body text, the userscript has to retrieve
these and add them to the Gmail compose page. You already know that the compose
mail URL can be built up in this way, so itâ€™s pretty easy to do that. Hereâ€™s the
code that does it:
mailtoLink.href = â€œhttps://mail.google.com/mail?view=cm&amp;tf=0â€?
+
(emailTo ? (â€œ&amp;to=â€? + emailTo) : â€œâ€?) +
(emailCC ? (â€œ&amp;cc=â€? + emailCC) : â€œâ€?) +
(emailSubject ? (â€œ&amp;su=â€? + emailSubject) : â€œâ€?)
+
(emailBody ? (â€œ&amp;body=â€? + emailBody) : â€œâ€?);
// mailtoLink.onclick = function() { location.href
= newUrl; return false; };
}
When you run on a link that points to mailto:ben.hammersley@gmail.com,
this will produce the URL <a href="https://mail.google.com/mail?view=cm&amp;tf=">https://mail.google.com/mail?view=cm&amp;tf=</a>
<a href="mailto:0?&amp;to-ben@benhammersley.com">0?&amp;to-ben@benhammersley.com</a>.
Perfect. Using this code, you can compose other messages. Perhaps you might like
to use it to produce an â€œe-mail this to meâ€? userscript, populating the message body
with the contents of the page.
Other Userscripts
Greasemonkey continues to recruit happy developers, and the number of userscripts
is ever increasing. Here are some more scripts that provide additional functionality
to Gmail. More still can be found at <a href="http://userscripts.org">http://userscripts.org</a>.
As ever, of course, you must remember that Gmailâ€™s interface is an ever-changing
mÃ©lange of weirdness, and these userscripts may well fade in and out of functionality.
If one stops working, check its coderâ€™s website for updates.
Mark Read Button
Documentation: <a href="http://userscripts.org/scripts/show/689">http://userscripts.org/scripts/show/689</a>
Userscript: <a href="http://userscripts.org/scripts/source/689.user.js">http://userscripts.org/scripts/source/689.user.js</a>
Chapter 6 â€” Gmail and Greasemonkey 115
Jim Lawtonâ€™s userscript creates a button that, when mails are selected, allows them
to be marked as read, en masse. Very useful in itself, it also provides the core code for
acting on a large number of mails in one go: handy for your own scripts, perhaps.
Multiple Signatures
Documentation: <a href="http://userscripts.org/scripts/show/1592">http://userscripts.org/scripts/show/1592</a>
Userscript: <a href="http://userscripts.org/scripts/source/1592.user.js">http://userscripts.org/scripts/source/1592.user.js</a>
This is a very smart script indeed. Using the ability to change the reply-to:
address within Gmail, it allows the user to change both their e-mail signature,
their reply-to: address, andâ€”brilliantlyâ€”Gmailâ€™s color scheme at the same
time. This allows you to use Gmail for multiple mail accounts without getting
them mixed up in the heat and fury of a working day. Very clever.
Hide Invites
Documentation: <a href="http://userscripts.org/scripts/show/673">http://userscripts.org/scripts/show/673</a>
Userscript: <a href="http://userscripts.org/scripts/source/673.user.js">http://userscripts.org/scripts/source/673.user.js</a>
A very simple use of Greasemonkey. This userscript simply hides the box that
holds the facility to send Gmail invitations to your friends. As you have already
looked at the way Gmail is constructed, you can modify this userscript yourself to
stop the display of any section of the interface.
Random Signatures
Documentation: <a href="http://userscripts.org/scripts/show/1704">http://userscripts.org/scripts/show/1704</a>
Userscript: <a href="http://userscripts.org/scripts/source/1704.user.js">http://userscripts.org/scripts/source/1704.user.js</a>
Robson Braga Araujoâ€™s userscript adds a random tagline to the bottom of your
Gmail signature and also creates an option in the Settings menu to edit the
taglines and control how the userscript operates.
And Now . . .
In this chapter, you saw that Gmailâ€™s interface and workings are even more customizable
than you might have first thought. By using Greasemonkey, you can
seriously improve the Gmail experience. And by looking at the way the scripts
work, you can learn how to write your own.</p>

<p>Gmail Libraries
In the previous chapters, you discovered how Gmail works: how
it loads into your browser, and how it handles your mail
through a series of JavaScript tricks and the passing of data in
the background. You can use this newfound knowledge to take
control of the application from within your own programs.
To do that, you need to use a libraryâ€”a piece of code that
encapsulates the nitty gritty of the interaction between your program
and Gmail itself in such a way that it makes writing that
program very easy. Instead of, for example, having to write code
that requests the Inboxâ€™s JavaScript array, parses it, finds the message
identity, requests the thread, parses that, and finally displays
it on the screen, you can simply run the function to download the
next unread mail.
This approach, of wrapping complex activities up into their own
simpler-to-use functions, is one of the bases of software engineering,
so itâ€™s not surprising that there are already many such modules
for Gmail. This chapter examines examples for PHP, Perl,
and Python.
As with all of the code in this book, these libraries are
dependent on Gmailâ€™s code standing still for a while.
Google, on the other hand, likes to keep improving
things. You may find that the APIs donâ€™t quite work
when you try them. Usually this is because Google has
changed the login procedure to Gmail, or something
simple like that. Give it a few days, and you will probably
find that the APIâ€™s authors or user community has
hacked up a run-around.
Ë› What is a library?
Ë› Accessing Gmail
with PHP
Ë› Accessing Gmail
with Perl
Ë› Accessing Gmail
with Python
chapter
in this chapter
118 Part II â€” Getting Inside Gmail
PHPâ€”Gmailer
Yin Hung Ganâ€™s Gmailer library is the obvious choice for PHP coders. Gan wrote
it so that he could build a simplified interface for Gmail, and check his mail from
his PDA. It is really two projects: the Gmailer library and Gmail-Lite, which uses
the library to give Gan his simple HTML interface.
Getting and Installing the Library
Gmailer can be downloaded from <a href="http://gmail-lite.sourceforge.net/">http://gmail-lite.sourceforge.net/</a>. At
the time of this writing, Gmailer is at version 0.6.9a. The Gmailer homepage
looks like Figure 7-1.
FIGURE 7-1: The Gmailer homepage
Once downloaded, you need only unpack it into the directory your script will run
in. You will also need cURL, from <a href="http://curl.haxx.se/">http://curl.haxx.se/</a>, and the OpenSSL
package from <a href="http://www.openssl.org/">www.openssl.org/</a>, but it is very likely that you will already have
those installed as a matter of course. If not, follow the instructions on their websites
to download and install them properly.To save time, worry about those only
if any error messages tell you to.
Chapter 7 â€” Gmail Libraries 119
How to Use It
Gmailer provides a series of methods that can be used to log in to Gmail and perform
the usual functions.Table 7-1 gives the complete rundown of the methods.
Table 7-1 Gmailerâ€™s Methods
Method Function
void setSessionMethod To set the session handling method before connect. If you want
(GM_CONSTANT method) PHP to handle it with cookies, set it to GM_USE_PHPSESSION|
[0.6.4] GM_USE_COOKIE; if you want PHP to handle it but without
using cookies, set it to !GM_USE_COOKIE|GM_USE_
PHPSESSION; if you do not want PHP to handle it, set it to
GM_USE_COOKIE|!GM_USE_PHPSESSION. It will set to
GM_USE_PHPSESSION|GM_USE_COOKIE by default.
void setLoginInfo To set the login information before connect.
string name,
string password,
int GMT_timezone)
void setProxy(string To set the proxy information if necessary. If your proxy server
hostname, string does not require login, set both username and password to â€œâ€?
username, string
password) [0.6.4]
bool connect() To connect to Gmail. It will use header() to set cookies at the
client-side browser. So you shouldnâ€™t output anything before
calling this method, or use connectNoCookie() otherwise. It
returns 1 if it succeeds, 0 otherwise.
bool connectNoCookie() To connect to Gmail without storing any cookies at the client-side
browser. It returns 1 if it succeeds, 0 otherwise.
bool isConnected() To check if connected.
bool fetch(string query) To fetch the URL query result from Gmail. It is intended to be
used internally (private method). Use fetchBox() instead.
bool fetchBox To fetch a result from Gmail by given:
GM_CONSTANT type, type: Gmailer constant, such as GM_LABEL.
string box, int position) box: name of box (such as Inbox, your_label)
position: cursor for paged result.
bool fetchContact() To fetch the contact list.
Continued
120 Part II â€” Getting Inside Gmail
Table 7-1 (continued)
Method Function
GMailSnapshot get To get a snapshot, an object (see GMailSnapshot below) for you
Snapshot(GM_CONSTANT to access the query result at ease.
type)
bool getAttachment To download an attachment of a message.
(string attachment_id,
string message_id,
string filename)
array getAttachmentsOf To download all files attached to a conversation. The full path of
(array GMailSnapshot-&gt; downloaded files will be returned (as array).
conv, string path_to_
store_files)
bool send(string to, To send Gmail. to, cc, and bcc are comma-separated addresses.
string subject, attachments is an array of names of files to be attached.
string body, string cc,
string bcc,
string message_replying,
string thread_replying,
array attachments)
bool performAction To perform an action on a message. message_id can be a string
(GM_CONSTANT action_ if only one message is to be acted.
type, array message_id,
string label)
void disconnect() To disconnect from Gmail. Any cookies set at the client-side
browser by libgmailer will be removed.
string dump(string query) To dump all it gets from the URL query string, including headers.
array getStandardBox() To get an array of names of the standard box (Inbox, Starred, and
so on).
Logging in with Gmailer
Logging into Gmail with the Gmailer library is very simple. First you point your
script to the library itself:
require(â€œlibgmailer.phpâ€?);
Then you invoke the new Gmailer object:
$gm = new GMailer();
Chapter 7 â€” Gmail Libraries 121
Then you set the setLoginInfo method, giving the username, password, and
time zone from GMT:
$gm-&gt;setLoginInfo($name, $pwd, $tz);
Finally, you tell Gmailer to connect:
$gm-&gt;connect();
You need to use setLoginInfo only onceâ€”Gmailer saves your Gmail cookies,
so once youâ€™ve logged in, you only need to use the connect() method to pass
more commands.
Putting that all together, then, you arrive at Listing 7-1, which gets you logged in
to Gmail, ready for some more code.
Listing 7-1: Logging in to Gmail with PHP
<?php require(â€œlibgmailer.phpâ€?);
$gm = new GMailer();
$name = â€œusernameâ€?;
$pwd = â€œpasswordâ€?;
$tz = â€œ0â€?;
$gm->setLoginInfo($name, $pwd, $tz);
if ($gm-&gt;connect()) {
/<em>* THE REST OF YOUR CODE GOES IN HERE *</em>/
}
$gm-&gt;disconnect();
?&gt;
The disconnect() method logs you out again.
Retrieving the Inbox
Once you are logged in, retrieving a thread is simple and is a good example to
show the deeper functions available from the Gmailer library.
122 Part II â€” Getting Inside Gmail
Assuming youâ€™re logged in, request the Inbox like so:
$gm-&gt;fetchBox(GM_STANDARD, Inbox, 0);
Then parse it into an object called a Snapshot, like so:
$snapshot = $gm-&gt;getSnapshot(GM_STANDARD);
Once you have the Inbox loaded into a Snapshot, you can query that Snapshot
and get all of the information out of it. Youâ€™ll have noticed, however, two things
not yet covered: the phrase GM_STANDARD and the properties that Snapshots
themselves have.
The Constants
GM_STANDARD is a constant. Gmailer has 20 constants available, each representing
a different feature of the Gmail system: the Inbox, the Labels, the Contacts, and
so on.To work with Gmail, you need to use a method to retrieve one of the constants,
and then you create a Snapshot of it, and finally query that Snapshot.
This two-stage process is really all there is to the Gmailer library, so once you
understand it, you are good to go.
Table 7-2 gives the constants available to the programmer.
Table 7-2 Gmailerâ€™s Constants
Constant Description
GM_STANDARD All the information about a standard box (Inbox, Sent, All,
Starred, Spam, Trash).
GM_LABEL All the information about the labels.
GM_CONVERSATION All the information about a particular conversation.
GM_QUERY All about a search query.
GM_CONTACT All about the contact list.
GM_ACT_APPLYLABEL Apply or remove label from message.
GM_ACT_REMOVELABEL
GM_ACT_STAR Star or unstar a message.
GM_ACT_UNSTAR
GM_ACT_SPAM Mark or unmark a message as spam.
GM_ACT_UNSPAM
GM_ACT_READ Mark a message as read or unread.
GM_ACT_UNREAD
GM_ACT_ARCHIVE Move a message away from or to the Inbox.
GM_ACT_INBOX
Chapter 7 â€” Gmail Libraries 123
Constant Description
GM_ACT_TRASH Move message to or away from the Trash.
GM_ACT_UNTRASH
GM_ACT_DELFOREVER Delete message forever.
GM_USE_PHPSESSION Use PHP session to handle Gmail-lite session.
[0.6.4]
GM_USE_COOKIE [0.6.4] Use cookie to handle Gmail-lite session.
Table 7-3 gives special properties available for each constantâ€™s Snapshot.
Table 7-3 The Data Available via a Snapshot
Properties available to all Snapshot types except GM_CONTACT
Property Description
gmail_ver Version of Gmail JavaScript core program.
quota_mb Mailbox quota in MB.
quota_per Mailbox quota in percentage.
std_box_new Number-indexed array. Number of unread mails in each standard box. You
may call GMailer::getStandardBox() to get an array of names of
standard boxes.
have_invit Number of invites you have. 0 = no invitation, and so forth.
label_list Number-indexed array. An array of label names.
label_new Number-indexed array. Number of unread mails in each label. (A 1-to-1
mapping of label_list.)
Properties available to Snapshot types GM_STANDARD, GM_LABEL, and GM_QUERY
Property Description
box_name Name of the standard box or label, or query string currently viewing.
box_total Total number of conversations in current mailbox.
box_pos Current starting position (for paged results).
Number-indexed array. An array of conversations in the current mailbox.
Each conversation is a text-indexed array of the following:
Continued
124 Part II â€” Getting Inside Gmail
Table 7-3 (continued)
Index Description
Id Conversation ID.
is_read 0 = read; 1 = not read yet.
is_starred 0 = not starred; 1 = starred.
Date Arrival date/time of the most recent message.
sender Senders of message in this conversation.
Flag Flag.
Subj Subject of this conversation.
snippet Snippet, or preview, of this conversation.
Labels Number-indexed array. Name of labels that this
conversation is bearing.
attachment Number-indexed array. Name of all attaching files of
this conversation.
Msgid Message ID of the most recently received message of
this conversation.
For example, in order to get the subject of the sixth conversation of the
current viewing box you write $snapshot-&gt;box[5][â€œsubjâ€?].
Properties available to Snapshot type GM_CONVERSATION
Property Description
conv_title Subject (title) of this conversation.
conv_total Total number of messages in this conversation.
conv_id Conversation ID.
conv_labels Number-indexed array. Name of labels that this conversation is bearing.
conv_starred Is the conversation starred? This is true if any of the messages of a
[0.6.4] conversation are starred.
Number-indexed array. An array of messages of the current conversation.
Each message is a text-indexed array of the following:
Index Description
index Index.
id Message ID.
sender Name of sender of this message.
sender_email E-mail address of the sender.
recv Name of receiver of this message.
Chapter 7 â€” Gmail Libraries 125
Index Description
recv_email E-mail address of the receiver.
reply_email Replying address of this message.
dt_easy Arrival date/time of this message in easy format, such
as 9 Aug (2 days ago).
dt Arrival date/time of this message in long format, such
as Mon, 9 Aug 2004 19:34:03 +0800.
subj Subject of this message.
is_starred Is the message starred?
[0.6.4]
snippet Snippet, or preview, of this message.
body Message body.
attachment Number-indexed array. An array of attachment
information, which is a text-indexed array of the
following:
Index Description
id Attachment ID.
filename Filename of this attaching file.
type File type (such as JPG, GIF, PDF) of
this attaching file.
size Size in bytes of this file.
Example: $snapshot-</p>

<blockquote>
  <p>conv[3][â€œattachmentâ€?][1][â€œsizeâ€?]
  (size of the 2nd attaching file of the 4th
  messages of current conversation)
  Properties available to Snapshot type GM_CONTACT
  Property Description
  contacts_all Number-indexed array. Array of entries (see the table that follows) of your
  All address book.
  contacts_freq Number-indexed array. Array of entries of your frequently mailed address
  book:
  Index Description.
  name Name (nickname).
  email E-mail address.
  notes Notes.
  is_freq 0 = not frequently mailed; 1 = frequently mailed.
  126 Part II â€” Getting Inside Gmail
  Once youâ€™ve requested the Inbox and created a Snapshot, you can query that
  Snapshot for details.To print out the number of threads within the Inbox, you
  can say this:
  echo â€œThreads in the inbox:â€? . $snapshot-&gt;box_total;
  In order to get the Thread ID of the first thread in the Inbox, you can do this:
  $threaded = $snapshot-&gt;box[0][â€œidâ€?];
  As you can see from the code and the preceding tables, itâ€™s really quite a straightforward
  interface. Youâ€™ll be using the interface in later chapters, but to finish,
  Listing 7-2 shows PHP code using the Gmailer library to log in and display the
  contents of the first message in the first thread in the Inbox.
  Listing 7-2: Reading the First Message in the Inbox
  <?php require(â€œlibgmailer.phpâ€?);
  $gm = new GMailer();
  $name = â€œusernameâ€?;
  $pwd = â€œpasswordâ€?;
  $tz = â€œ0â€?;
  $gm->setLoginInfo($name, $pwd, $tz);
  if ($gm-&gt;connect()) {
  $gm-&gt;fetchBox(GM_STANDARD, Inbox, 0);
  $snapshot = $gm-&gt;getSnapshot(GM_STANDARD);
  $threaded = $snapshot-&gt;box[0][â€œidâ€?];
  $gm-&gt;fetchBox(GM_CONVERSATION, $threaded, 0);
  $snapshot = $gm-&gt;getSnapshot(GM_CONVERSATION);
  echo â€œThe first message readsâ€? . $snapshot-
  conv[0][â€œbodyâ€?];
  }
  $gm-&gt;disconnect();
  ?&gt;
  You return to this library in later chapters.
  Chapter 7 â€” Gmail Libraries 127
  Perlâ€”Mail::Webmail::Gmail
  CPAN, the directory of Perl modules, lists quite a few Gmail-related modules,
  one of which is shown in Figure 7-2. But at time of this writing, the only one
  working is Allen Holmanâ€™s Mail::Webmail::Gmail.
  FIGURE 7-2: A CPAN search resulting in a Gmail module
  Getting and Installing the Library
  Mail::Webmail::Gmail is available from CPAN. You can download it directly
  from <a href="http://search.cpan.org/%7Emincus/">http://search.cpan.org/~mincus/</a> or use the command line like this:
  sudo perl -MCPAN -e â€˜install Mail::Webmail::Gmailâ€™
  However installed, the module has a few dependencies that you will need to have
  installed already:
   LWP::UserAgent
   HTTP::Headers
   HTTP::Cookies
   HTTP::Request::Common
   Crypt::SSLeay
   Exporter
  128 Part II â€” Getting Inside Gmail
  Using the Library
  The Mail::Webmail::Gmail module is remarkably simple to use and very thorough.
  Youâ€™ll be using it extensively in the next few chapters, so here we shall just
  summarize the options.
  Logging In
  The standard call for logging into Gmail session is:
  my $gmail = Mail::Webmail::Gmail-&gt;new(username =&gt; â€˜usernameâ€™,
  password =&gt; â€˜passwordâ€™, );
  That call can also take some optional arguments. If given the details, you can use a
  proxy server, and you can also encrypt the entire session as opposed to just the
  login sequence. Call them all like so:
  my $gmail = Mail::Webmail::Gmail-&gt;new(
  username =&gt; â€˜usernameâ€™,
  password =&gt; â€˜passwordâ€™,
  proxy_username =&gt; â€˜proxy_usernameâ€™,
  proxy_password =&gt; â€˜proxy_passwordâ€™,
  proxy_name =&gt; â€˜proxy_serverâ€™,
  encrypt_session =&gt; 1
  );
  Once logged in, you can make requests for data and pass methods on the Gmail
  Inbox. There are lots of methods that you can use.
  The Other Functions
  This chapter provides only a table of the available functions (see Table 7-4). They
  are more fully explained as you use them in the rest of the book.
  Table 7-4 The Functions Within Mail::Gmail::Webmail
  Function What It Does
  get_labels() Retrieves an array of the labels in the account.
  edit_labels (label=&gt; Creates the label â€˜label nameâ€™.
  â€™label_nameâ€™, action =&gt;
  â€˜createâ€™);
  edit_labels( label =&gt; Renames the label â€˜label_nameâ€™ to â€˜renamed_labelâ€™.
  â€˜label_nameâ€™, action =&gt;
  â€˜renameâ€™, new_name =&gt;
  â€˜renamed_labelâ€™ );
  Chapter 7 â€” Gmail Libraries 129
  Function What It Does
  edit_labels( label =&gt; Deletes the label â€˜label_nameâ€™.
  â€˜label_nameâ€™, action =&gt;
  â€˜deleteâ€™ );
  edit_labels( label =&gt; Adds a label to a message.
  â€˜label_nameâ€™, action =&gt;
  â€˜addâ€™, msgid =&gt;
  $message_id );
  $gmail-&gt;edit_labels Removes a label from a message.
  ( label =&gt; â€˜label_nameâ€™,
  action =&gt; â€˜removeâ€™,
  msgid =&gt; $message_id );
  update_prefs Sets preferences inside Gmail. The available options are:
  ( indicators =&gt; 0, keyboard_shortcuts = ( 0, 1 )
  reply_to =&gt; indicators = ( 0, 1 )
  â€˜test@test.comâ€™ ); snippets = ( 0, 1 )
  max_page_size = ( 25, 50, 100 )
  display_name = ( â€˜â€™, string value up to 96
  characters )
  reply_to = ( â€˜â€™, string value up to 320
  characters )
  signature = ( â€˜â€™, string value up to 1000
  characters )
  edit_star( action =&gt; Stars a message.
  â€˜addâ€™, â€˜msgidâ€™ =&gt;
  $msgid );
  edit_star( action =&gt; Unstars the message.
  â€˜removeâ€™, â€˜msgidâ€™ =&gt;
  $msgid );
  edit_archive( action =&gt; Archives the message.
  â€˜archiveâ€™, â€˜msgidâ€™ =&gt;
  $msgid );
  edit_archive( action =&gt; Unarchives the message.
  â€˜unarchiveâ€™, â€˜msgidâ€™ =&gt;
  $msgid );
  Continued
  130 Part II â€” Getting Inside Gmail
  Table 7-4 (continued)
  Function What It Does
  $gmail-&gt;get_messages Retrieves a reference to an array of hashes for the messages
  ( label =&gt; â€˜workâ€™ ); within the stated label. Or you can use the Gmail standard folder
  names â€˜INBOXâ€™, â€˜STARREDâ€™, â€˜SPAMâ€™, or â€˜TRASHâ€™
  get_messages( label =&gt; $Mail::Webmail::Gmail::FOLDERS{
  â€˜INBOXâ€™ } );
  The array of hashes looks like this:
  $indv_email{ â€˜idâ€™ }
  $indv_email{ â€˜newâ€™ }
  $indv_email{ â€˜starredâ€™ }
  $indv_email{ â€˜date_receivedâ€™ }
  $indv_email{ â€˜sender_emailâ€™ }
  $indv_email{ â€˜subjectâ€™ }
  $indv_email{ â€˜blurbâ€™ }
  @{ $indv_email{ â€˜labelsâ€™ } }
  @{ $indv_email{ â€˜attachmentsâ€™ } }
  size_usage(); Returns a scalar value with the amount of megabytes remaining
  to use.
  get_indv_email( id =&gt; Retrieves a hash of hashes containing an individual message in
  $msgid) this format:
  $indv_email{ â€˜idâ€™ }
  $indv_email{ â€˜sender_emailâ€™ }
  $indv_email{ â€˜sentâ€™ }
  $indv_email{ â€˜toâ€™ }
  $indv_email{ â€˜readâ€™ }
  $indv_email{ â€˜subjectâ€™ }
  @{ $indv_email{ â€˜attachmentsâ€™ } }
  get_mime_email( msg =&gt; Retrieves the message as a string, in MIME format.
  $msgid )
  get_contacts( ); Retrieves an array of hashes containing the Gmail address book.
  The array of hashes is in the following format:
  $indv_contact{ â€˜idâ€™ }
  $indv_contact{ â€˜name1â€™ }
  $indv_contact{ â€˜name2â€™ }
  $indv_contact{ â€˜emailâ€™ }
  $indv_contact{ â€˜noteâ€™ }
  Chapter 7 â€” Gmail Libraries 131
  Function What It Does
  send_message( to =&gt; Sends a message to a single recipient.
  â€˜user@domain.comâ€™, To send to multiple users, send an arrayref containing all of the
  subject =&gt; â€˜Test Messageâ€™, users:
  msgbody =&gt; â€˜This is
  a test.â€™ );
  my $email_addrs = [
  â€˜user1@domain.comâ€™,
  â€˜user2@domain.comâ€™,
  â€˜user3@domain.comâ€™, ];
  $gmail-&gt;send_message( to =&gt; $email_addrs,
  subject =&gt; â€˜Test Messageâ€™, msgbody =&gt; â€˜This is a
  test.â€™ );
  send_message( to =&gt; Sends a message with an attachment.
  â€˜user@domain.comâ€™,
  subject =&gt; â€˜Test Messageâ€™,
  msgbody =&gt; â€˜This is a
  test.â€™, file0 =&gt; [â€œ/tmp/
  fooâ€?], file1 =&gt; [â€œ/tmp/
  barâ€?] );
  delete_message Sends a message to the Trash.
  ( msgid =&gt; $msgid, del_
  message =&gt; 0 );
  delete_message( msgid =&gt; Permanently deletes the message.
  $msgid );
  The rest of this module is covered in Chapter 8 onwards.
  Pythonâ€”Libgmail
  The trifecta of scripting languages beginning with P ends with ython, and is completed
  by Libgmail, the Python bindings for Gmail access.
  Getting and Installing the Library
  Libgmail is hosted on Sourceforge at <a href="http://Libgmail.sourceforge.net/">http://Libgmail.sourceforge.net/</a>
  and can be downloaded directly from there. The authors of Libgmail advise using
  the version from CVS if possible, as it is more likely to work with whatever
  changes Google has made to the service lately. Figure 7-3 gives the traditional
  screenshot of the projectâ€™s homepage.
  132 Part II â€” Getting Inside Gmail
  FIGURE 7-3: Pythonâ€™s Libgmail binding
  You should follow the instructions on their website to install the latest version. As
  mentioned before, if Libgmail stops working, it may just be a matter of time
  before a new version restores functionality.
  How to Use It
  Libgmail comes with some sample code, but no real documentation at the
  moment. There are currently 15 methods available, which offer the vast majority
  of the functionality that Gmail can give. Start by logging in.
  login
  To log in, import the Libgmail bindings, create a new GmailAccount object, and
  use the login method on it, like so:
  import Libgmail
  ga = Libgmail.GmailAccount(â€œgoogle@gmail.comâ€?,
  â€œmymailismypassâ€?)
  ga.login()
  Now that youâ€™re logged in, you want to retrieve the messages from a folder.
  Chapter 7 â€” Gmail Libraries 133
  getMessagesByFolder
  The getMessagesByFolder method takes the name of the folder, and an
  optional True/False flag to indicate selecting every page of that folderâ€™s listing.
  (Remember that these libraries interact with Gmail by scraping the pages it
  returns, effectively, so you still have to consider the information as it is meant for
  the real Gmail interface, not just yours).
  Leaving the flag off sets it to the default False.To place the details of the Inbox
  into an object called folder, you do the following:
  folder= ga.getMessagesByFolder(â€˜inboxâ€™)
  This returns a GmailSearchResult instance that you can query.
  getMessageByLabel
  The getMessageByLabel method works in exactly the same way as
  getMessagesByFolder but replaces the folder with a label. It returns a
  GmailSearchResult instance, which is examined in two paragraphsâ€™ time.
  getMessagesByQuery
  The getMessagesByQuery method works in exactly the same way as
  getMessagesByFolder but does so with a search query instead of the name of
  the mailbox. For example:
  messages = ga.getMessagesByQuery(â€˜ransom noteâ€™)
  This query will also return a GmailSearchResult instance.
  All this talk of GmailSearchResult instances begs the question:What exactly is
  a GmailSearchResult instance? A GmailSearchResult instance is a thread
  object. This contains details of the thread, plus one or more msg objects, corresponding
  to the messages within. These can be queried like so:
  for thread in folder:
  print thread.id # the id of the thread
  print len(thread) # the number of messages
  print thread.subject # the subject of the thread
  for msg in thread:
  print msg.id # the id of the message
  print msg.number # the number within the thread
  print msg.subject # the message subject
  print msg.source # the raw source of the message
  134 Part II â€” Getting Inside Gmail
  getQuotaInfo
  The getQuotaInfo method allows you to retrieve information on how much
  storage you are taking up inside Gmail. It returns an array of megabytes used,
  total megabytes available, and percentage of storage used.
  getUnreadMsgCount
  When invoked, the getUnreadMsgCount method returns an integer equal to the
  number of unread messages within the Inbox:
  new_messages = ga.getUnreadMsgCount()
  Reading the First Message in the Inbox
  Putting together the methods discussed so far, you can display the messages in the
  Inbox, and information about the amount of storage you have left, with the code
  in Listing 7-3.
  Listing 7-3: Using Python to Display the First Message in the Inbox</p>
  
  <h4>!/usr/bin/python2.3</h4>
</blockquote>

<p>import Libgmail
ga = Libgmail.GmailAccount(â€œgoogle@gmail.comâ€?,
â€œmymailismypassâ€?)
ga.login()
folder = ga.getMessagesByFolder(â€˜inboxâ€™)
for thread in folder:
print thread.id, len(thread), thread.subject
for msg in thread:
print â€œMessage ID:â€?, msg.id
print â€œMessage Number:â€?, msg.number
print â€œMessage Subject:â€?, msg.subject
print msg.source
Keeping Your Powder Dry
The remaining methodsâ€”sendMessage, trashMessage, trashThread, getLabelNames,
createLabel, deleteLabel, renameLabel, and storeFileâ€”are, apart from being selfexplanatorily
named, covered in great detail in the remainder of this book.
Chapter 7 â€” Gmail Libraries 135
quotaInfo = ga.getQuotaInfo()
quotaMbUsed = quotaInfo[QU_SPACEUSED]
quotaMbTotal = quotaInfo[QU_QUOTA]
quotaPercent = quotaInfo[QU_PERCENT]
print â€œ%s of %s used. (%s)\nâ€? % (quotaMbUsed, quotaMbTotal,
quotaPercent)
Setting Yourselves Up for the Remaining Chapters
To aid you in your coding over the next few chapters, you shall also need a small
Perl module of your own, which tidies up the boring things such as logging in.
Listing 7-4 gives the script Utils.pm, which you should place within the directory
in which you wish to work. You will need to place your own username and password
in the place indicated.
Listing 7-4: Utils.pm
package Utils;
require Mail::Webmail::Gmail;
require Exporter;
@ISA = qw(Exporter);
@EXPORT = qw(login strip_bold);
sub login {
return Mail::Webmail::Gmail-&gt;new(
username =&gt; â€œUSERNAMEâ€?,
password =&gt; â€œPASSWORDâ€?
);
}</p>

<h4>get rid of &lt;b&gt; and &lt;/b&gt; in subjects</h4>

<p>sub strip_bold {
my $str = shift;
$str =~ s/&lt;b&gt;(.*)&lt;\/b&gt;/$1/;
return $str;
}
1;
136 Part II â€” Getting Inside Gmail
You will also need the following Perl modules installed:
 libwww-perl: <a href="http://search.cpan.org/%7Egaas/libwww-perl-5.803/">http://search.cpan.org/~gaas/libwww-perl-5.803/</a>
 MIME-Base64: <a href="http://search.cpan.org/%7Egaas/MIME-Base64-3.05/">http://search.cpan.org/~gaas/MIME-Base64-3.05/</a>
 MIME-tools: <a href="http://search.cpan.org/%7Edskoll/MIME-tools-5.417/">http://search.cpan.org/~dskoll/MIME-tools-5.417/</a>
 MailFolder: <a href="http://search.cpan.org/%7Ekjohnson/MailFolder-0.07/">http://search.cpan.org/~kjohnson/MailFolder-0.07/</a>
 MD5: <a href="http://search.cpan.org/%7Egaas/MD5-2.03/">http://search.cpan.org/~gaas/MD5-2.03/</a>
And Now . . .
In this chapter, you worked through a quick overview of the most popular Gmail
libraries available for the most popular scripting languages. As you have seen, the
libraries are at varying stages of completeness and simplicity but are nevertheless
extremely useful.
In the next few chapters, you will use the Perl library to perform the basic Gmail
functions and start to produce Gmail-based applications of your own.
Checking for Mail
Now that youâ€™ve been introduced to the Gmail libraries, you
can them to use with a simple script to tell you when you
have new mail. In this chapter, you go through the first
stage of this code in all of the languages and then build on it in
Perl to make a standalone application.
As previously discussed, the APIs upon which this code
is based may cease to work every so often, as Google
changes the way that Gmail operates. If thatâ€™s the case,
your knowledge gained in Chapter 5 should help you
help the APIâ€™s author to fix things.
The Basics in Perl
Using the Mail::Webmail::Gmail module to check for mail is
simplicity itself. You need to set up the modules and then log in:
use Mail::Webmail::Gmail;
my $gmail = Mail::Webmail::Gmail-&gt;new(
username =&gt; â€œben.hammersley\@gmail.comâ€?,
password =&gt; â€œXXXXXXXXâ€?,
);
After that, retrieve the Inbox and step through the list of messages
in it.Within the Perl library, using the get_messages
method gives you an array of hashes, with the value of â€˜newâ€™
being the read/unread flag. So all you need to do is count the
number of messages with a true value in that reference, like so:
Ë› Checking for new
mail with Perl, PHP,
and Python
Ë› Instant Messenger
alerts
Ë› Alerts to your
mobile phone
chapter
in this chapter
138 Part II â€” Getting Inside Gmail
my $new_msgs = 0;
if ( defined($messages) ) {
foreach ( @{$messages} ) {
if ( $_-&gt;{â€˜newâ€™} ) {
$new_msgs++;
}
}
}
This leaves you with the variable $new_msgs to give you the number of unread
messages in the Inbox. Listing 8-1 gives an entire working script to display this.
Listing 8-1: Checking the New Mail Count in Perl</p>

<h4>!/usr/bin/perl</h4>

<p>use warnings;
use strict;
use Mail::Webmail::Gmail;
my $gmail = Mail::Webmail::Gmail-&gt;new(
username =&gt; â€œben.hammersley\@gmail.comâ€?,
password =&gt; â€œXXXXXXXXâ€?,
);
my $messages =
$gmail-&gt;get_messages( label =&gt;
$Mail::Webmail::Gmail::FOLDERS{â€˜INBOXâ€™} );
my $new_msgs = 0;
if ( defined($messages) ) {
foreach ( @{$messages} ) {
if ( $_-&gt;{â€˜newâ€™} ) {
$new_msgs++;
}
}
}
print â€œyou have $new_msgs new messages in your inbox\nâ€?;
Obviously, from here you can build out to produce all sorts of interesting alerts, as
you shall do later on in this chapter.
An alternative and easier way of doing this can be found in Listing 8-2.
Chapter 8 â€” Checking for Mail 139
Listing 8-2: An Even Easier Way to Check Mail
use Utils;
$gmail = login();
$messages = $gmail-&gt;get_messages(); # simply get all
messages
$count = 0;
foreach ( @{$messages} ) { # and iterate through
them
if ( $_-&gt;{â€œnewâ€?} ) { # if message is new
$count++;
}
}
print â€œNumber of unread messages: â€œ . $count . â€œ\nâ€?;
This uses the Utils module you created in Chapter 7â€”Listing 7-4 to be precise.
That module encapsulates the login process into one simple login() function,
allowing the script to be even simpler than before.
The Basics in PHP
PHP, too, provides a simple interface to check for new mail in Gmail. The libgmailler
library, as you saw in Chapter 6, handles it perfectly well. First, you need
to log in:
$gm-&gt;setLoginInfo($name, $pwd, $tz);
if ($gm-&gt;connect()) {
Then you fetch the Inbox and create the Snapshot object:
$gm-&gt;fetchBox(GM_STANDARD, â€œInboxâ€?, 0);
$snapshot = $gm-&gt;getSnapshot(GM_STANDARD);
After that, loop through all of the messages in the Inbox, incrementing a variable
by one for every unread mail you see:
if ($snapshot) {
for ($i = 0;$i &lt; $snapshot-&gt;box_total ; $i++ )
{
if ($snapshot-&gt;box[$i][â€œis_readâ€?] == 1)
{ $new++;
}
}
140 Part II â€” Getting Inside Gmail
Listing 8-3 gives you a complete script, printing to the screen a count of the new
mail in your account.
Listing 8-3: Checking for New Mail in PHP
<?PHP require(â€œlibgmailer.phpâ€?);
$gm = new GMailer();
$name = â€œUSERNAMEâ€?;
$pwd = â€œPASSWORDâ€?;
$tz = â€œ0â€?;
$new = 0;
$gm->setLoginInfo($name, $pwd, $tz);
if ($gm-&gt;connect()) {
$gm-&gt;fetchBox(GM_STANDARD, â€œInboxâ€?, 0);
$snapshot = $gm-&gt;getSnapshot(GM_STANDARD);
if ($snapshot) {
for ($i = 0;$i &lt; $snapshot-&gt;box_total ; $i++ )
{
if ($snapshot-&gt;box[$i][â€œis_readâ€?] == 1)
{ $new++;
}
}
echo â€œYou haveâ€?. $new . â€œnew messagesâ€?;
}
}
?&gt;
The Basics in Python
Pythonâ€™s libgmail provides the simplest method to get a new mail count: Thereâ€™s a
specific function that you can use.
So, as usual, you first need to log in and check for errors there:
Chapter 8 â€” Checking for Mail 141
ga = libgmail.GmailAccount(username, password)
try:
ga.login()
except:
new_messages = â€œlogin failedâ€?
Then run the getUnreadMsgCount function:
else:
new_messages = ga.getUnreadMsgCount()
Take the result of that function and display it. Listing 8-4 gives a complete script
to do this and gives grammatically correct display as well.
Listing 8-4: Checking for New Mail in Python</p>

<h4>!/usr/bin/env python</h4>

<p>import libgmail
username = â€œuserâ€?
password = â€œpassâ€?
ga = libgmail.GmailAccount(username, password)
try:
ga.login()
except:
new_messages = â€œlogin failedâ€?
else:
new_messages = ga.getUnreadMsgCount()
if new_messages == â€œlogin failedâ€?:
print â€œLogin â€œ
elif int(new_messages) == 0:
print â€œYou have no new messagesâ€?
elif int(new_messages) == 1:
print â€œYou have 1 new message.â€?
else:
print â€œYou have â€œ + new_messages + â€œ new messages.â€?
142 Part II â€” Getting Inside Gmail
Building on the Basics
Now that you have seen the basics for retrieving the number of unread messages,
you can look at new and interesting ways of displaying that number. You saw
desktop applications that do this in Chapter 2, so this section concentrates on the
more unusual ways of seeing the number.
New Mail Count in RSS
Itâ€™s a fair bet that the majority of the readers of a book like this one will also be
heavy users of RSS. The XML-based family of syndication technologies is now
very popular indeed, and presents a lot of opportunities for keeping track of many
different types of information. I personally use the following technique to keep
tabs on Gmail accounts that I use on an infrequent basis: for accounts where
checking them manually is too much bother but where a desktop alert is too
intrusive.
Start off, in the normal way, by loading the core Perl modules. In this case, you
will need Mail::Webmaiil::Gmail, as ever, and the commonly used XML::RSS
module to help produce the RSS feed, and the ubiquitous CGI module to deal
with the incoming parameters and the correct serving of the feed. XML::RSS is a
little out of the scope of this book, and is nevertheless very simple to understand
from its own documentation.
Then take the username and password from parameters in the URL, and set up
the WWW::Gmail object like so:
use CGI qw(standard);
use Mail::Webmail::Gmail;
my $username = param(â€œusernameâ€?);
my $password = param(â€œpasswordâ€?);
my $gmail = Mail::Webmail::Gmail-&gt;new(
username =&gt; $username,
password =&gt; $password,
);
And then itâ€™s the usual matter of downloading the Inbox and counting the unread
messages:
Chapter 8 â€” Checking for Mail 143
my $messages =
$gmail-&gt;get_messages( label =&gt;
$Mail::Webmail::Gmail::FOLDERS{â€˜INBOXâ€™} );
my $new_msgs = 0;
if ( defined($messages) ) {
foreach ( @{$messages} ) {
if ( $_-&gt;{â€˜newâ€™} ) {
$new_msgs++;
}
}
}
Once you have the unread message count, you need to use the XML::RSS module
to produce the feed. Listing 8-5 gives the entire script an airing and shows how
this works.
Listing 8-5: Producing a New Mail Count in an RSS Feed</p>

<h4>!/usr/bin/perl -w</h4>

<p>use strict;
use XML::RSS;
use CGI qw(standard);
use Mail::Webmail::Gmail;
my $username = param(â€œusernameâ€?);
my $password = param(â€œpasswordâ€?);
my $gmail = Mail::Webmail::Gmail-&gt;new(
username =&gt; $username,
password =&gt; $password,
);
my $messages =
$gmail-&gt;get_messages( label =&gt;
$Mail::Webmail::Gmail::FOLDERS{â€˜INBOXâ€™} );
my $new_msgs = 0;
if ( defined($messages) ) {
foreach ( @{$messages} ) {
if ( $_-&gt;{â€˜newâ€™} ) {
144 Part II â€” Getting Inside Gmail
$new_msgs++;
}
}
}
my $rss = new XML::RSS (version =&gt; â€˜0.91â€™);
$rss-&gt;channel( title =&gt; â€œUnread mail count for $usernameâ€?,
link =&gt; â€œhttp://gmail.google.com/â€?,
description =&gt; â€œThe unread mail count for
$usernameâ€?,
language =&gt; â€œenâ€?,
);
$rss-&gt;add_item(
title =&gt; â€œYou have $new_msgs messagesâ€?),
link =&gt; â€œhttp://gmail.google.comâ€?),
);
print header(â€˜application/xml+rssâ€™), $rss-&gt;as_string;
Installing this script on a web server and pointing your newsreader at the URL
produces a single-item RSS feed showing the number of unread messages in your
Inbox. Itâ€™s simple and unobtrusive in that way. The URL should be structured
like so:
<a href="http://www.example.com/gmail2rss.cgi?username=USERNAME&amp;password=">http://www.example.com/gmail2rss.cgi?username=USERNAME&amp;password=</a>
PASSWORD
You build upon this script in later chapters.
New Mail Count to AOL Instant Messenger
As well as an RSS reader, you might also have an AOL Instant Messenger (AIM)
application running. In this section, you build two ways of receiving new mail
notification via AIM. The first is by using a script very similar to that in Listing
8-4. This one checks for mail, logs in to AIM, and sends you a message with the
number. You just need to set the script to run on a schedule, and it keeps you up to
date in a relatively painless way.
To do this, you first log in and check for new mail, as per the preceding scripts,
and then use the Net::AOLIM module to send the message. Like so:
my $aim_user = â€œâ€?;
my $aim_password = â€œâ€?;
my $aim_destuser = â€œâ€?;
Chapter 8 â€” Checking for Mail 145
my $message = â€œYour Gmail inbox, $username, has a new message
count of $new_msgâ€?;
$aim = Net::AOLIM-&gt;new(â€˜usernameâ€™ =&gt; $aim_user,
â€˜passwordâ€™ =&gt; $aim_password,
);
$aim-&gt;signon or die â€œCannot sign on to AIMâ€?;
$aim-&gt;toc_send_im($aim_destuser, $message);
Listing 8-6 shows the entire code for this script.
Listing 8-6: New Mail Alerts to AOL Instant Messenger</p>

<h4>!/usr/bin/perl -w</h4>

<p>use strict;
use XML::RSS;
use CGI qw(standard);
use Mail::Webmail::Gmail;
use Net::AOLIM;
my $username = param(â€œusernameâ€?);
my $password = param(â€œpasswordâ€?);
my $gmail = Mail::Webmail::Gmail-&gt;new(
username =&gt; $username,
password =&gt; $password,
);
my $messages =
$gmail-&gt;get_messages( label =&gt;
$Mail::Webmail::Gmail::FOLDERS{â€˜INBOXâ€™} );
my $new_msgs = 0;
if ( defined($messages) ) {
foreach ( @{$messages} ) {
if ( $_-&gt;{â€˜newâ€™} ) {
$new_msgs++;
}
}
}
146 Part II â€” Getting Inside Gmail
my $aim_user = â€œâ€?;
my $aim_password = â€œâ€?;
my $aim_destuser = â€œâ€?;
my $message = â€œYour Gmail inbox, $username, has a new message
count of $new_msgâ€?;
$aim = Net::AOLIM-&gt;new(â€˜usernameâ€™ =&gt; $aim_user,
â€˜passwordâ€™ =&gt; $aim_password,
);
$aim-&gt;signon or die â€œCannot sign on to AIMâ€?;
$aim-&gt;toc_send_im($aim_destuser, $message);
To use this script, place your Gmail and AIM username and passwords in the
variables at the top. (You will need a separate AIM account for the script itself,
which you can sign up for at <a href="http://www.aol.com">www.aol.com</a>) and then use cron to schedule it to
run at the desired interval.
A good introduction to cron can be found at
<a href="http://www.unixgeeks.org/security/newbie/unix/cron-1.html">www.unixgeeks.org/security/newbie/unix/cron-1.html</a>, but I set mine
for this script to the following:
1 * * * * /usr/bin/perl ~/code/gmail2AIM.pl
The preceding code should give you an idea of how you should set up cron.
The second and perhaps more fun way of sending Gmail new mail counts over
AIM is to create an AIM bot. This is a script that logs in as an AIM user and
replies when you â€œtalkâ€? to it. In this case, itâ€™s not going to be particularly clever in
what it saysâ€”it will merely reply with the latest count.
To create a bot, start off by logging in to AIM as you did before and then permitting
anyone to send you a message:
$aim = Net::AOLIM-&gt;new(â€œusernameâ€? =&gt; $aim_user,
â€œpasswordâ€? =&gt; $aim_password,
â€œcallbackâ€? =&gt; \&amp;reply,
â€œallow_srv_settingsâ€? =&gt; 0,
â€œlogin_timeoutâ€? =&gt; 2 );
$aim-&gt;im_permit_all();
$aim -&gt; sign_on();
Once that is in place, set the script on a loop, waiting for an incoming message.
This is done with the Net::AOLIMâ€™s ui_dataget function, like so:
Chapter 8 â€” Checking for Mail 147
while (1)
{
last unless defined($foo-&gt;ui_dataget(undef));
}
When Net::AOLIM receives a message, it hands the script off to the subroutine
called reply. reply must check if the incoming message is a direct Instant
Message, not an internal error message. Once it has done that, it retrieves the
buddy name of the person who sent it.
sub reply
{
my $params = $_[ARG1];
my $aim_event_type = $params-&gt;[0];
if($aim_event_type eq â€˜IM_INâ€™) {
my $aimdestuser = $params-&gt;[1];
And all that remains to be done is to check Gmail for new mail and reply to the
message sender with a nice answer. Once that is done, the script returns to its
loop. Listing 8-7 shows all.
Listing 8-7: A New Mail Count AIM Bot</p>

<h4>!/usr/bin/perl -w</h4>

<p>use warnings;
use strict;
use Mail::Webmail::Gmail;
use Net::AOLIM;
my $gmail_user =â€?â€?;
my $gmail_password = â€œâ€?;
my $aim_user = â€œâ€?;
my $aim_password = â€œâ€?;
my $aim_destuser = â€œâ€?;
$aim = Net::AOLIM-&gt;new(â€œusernameâ€? =&gt; $aim_user,
â€œpasswordâ€? =&gt; $aim_password,
â€œcallbackâ€? =&gt; \&amp;reply,
â€œallow_srv_settingsâ€? =&gt; 0,
â€œlogin_timeoutâ€? =&gt; 2 );
148 Part II â€” Getting Inside Gmail
$aim-&gt;im_permit_all();
$aim -&gt; sign_on();
while (1)
{
last unless defined($foo-&gt;ui_dataget(undef));
}
sub reply
{
my $params = $_[ARG1];
my $aim_event_type = $params-&gt;[0];
if($aim_event_type eq â€˜IM_INâ€™) {
my $aimdestuser = $params-&gt;[1];
my $gmail = Mail::Webmail::Gmail-&gt;new(
username =&gt; $gmail_user,
password =&gt; $gmail_password,
);
my $messages =
$gmail-&gt;get_messages( label =&gt;
$Mail::Webmail::Gmail::FOLDERS{â€˜INBOXâ€™} );
my $new_msgs = 0;
if ( defined($messages) ) {
foreach ( @{$messages} ) {
if ( $_-&gt;{â€˜newâ€™} ) {
$new_msgs++;
}
}
}
my $message = â€œ$gmail_user has a new message count of
$new_msgâ€?;
$aim-&gt;toc_send_im($aim_destuser, $message);
}
}
s
Chapter 8 â€” Checking for Mail 149
Run this as a background application by typing the following command:
./google2rssbot.pl &amp;
You can kill it with a judicious control-c.
There are many ways to extend this scriptâ€”allowing different people to check
different accounts depending on their buddy name, and so on. It should be clear
from the listing how to do this.
And Now . . .
So now you have seen how to check for new mail in three languages, and how to
create some interesting applications to repurpose that data. In all, quite simple
stuff but a good starting point. In the next chapter, you move on to the next logical
stage: reading the mail.</p>

<p>Reading Mail
In Chapter 7, you built scripts and applications to tell you that
you had new mail. In this chapter, you move on to the next logical
step and retrieve that mail from Gmail so you can read it.
Reading an individual mail from Gmail is unlike reading individual
mails from a POP3 or IMAP server. In the more common e-mail
systems, an e-mail is identified by a number and can be retrieved
directly. In Gmail, as you found in Chapter 6, this isnâ€™t possible:
You have to retrieve the entire thread and then retrieve the message
from that. In an ideal world, a Gmail library would hide this horrible
fact, and they all do this to a lesser or greater extent.
Reading Mail with Perl
The process with Mail::Webmail::Gmail is remarkably easy. You
log in, retrieve the contents of the Inbox, find the thread with the
message you require, retrieve it, find the message within that
thread, and parse out the contents.
The Basics
Logging in and retrieving the contents of the Inbox, as ever,
looks like this:
my $gmail = Mail::Webmail::Gmail-&gt;new(
username =&gt; â€œben.hammersley\@gmail.comâ€?,
password =&gt; â€œXXXXXXXXâ€?,
);
my $messages =
$gmail-&gt;get_messages( label =&gt;
$Mail::Webmail::Gmail::FOLDERS{â€˜INBOXâ€™} );
Ë› Locating the mail
Ë› Retrieving the
message source
Ë› Parsing the
message source
chapter
in this chapter
152 Part II â€” Getting Inside Gmail
Now you have a reference to an array of hashes containing the contents of the
Inbox. You can loop through this array of hashes, and pull out the details of the
messages with the et_indv_email function. This function can either take the
message ID or, as in this case, take the reference to the specific message, like this:
foreach ( @{ $messages } ) {
my $message = $gmail-&gt;get_indv_email( msg =&gt; $_ );
print â€œ$message-&gt;{ $_-&gt;{ â€˜idâ€™ } }-&gt;{ â€˜bodyâ€™ }\nâ€?;
}
Of course, spinning through your Inbox and printing out all of the bodies might
be fun to do once, but itâ€™s not very useful.
Accessing All the Data of a Message
Mail::Webmail::Gmail can, of course, give you all of the information within a
message. However, relying on addressing the data directly within your script is a
recipe for trouble. Even as I type this sentence, the Gmail UI seems to be changing
and rendering bits of Mail::Webmail::Gmail out of date until either Gmail
changes back or the library is fixed.To make sure that your own code isnâ€™t entirely
broken by such changes, do something like this:
foreach ( @{ $messages } ) {
my $message = $gmail-&gt;get_indv_email( msg =&gt; $_ );
my $to = $message-&gt;{ $_-&gt;{ â€˜idâ€™ } }-&gt;{ â€˜toâ€™} || â€œTo
irretrievableâ€?;
my $sender_email = $message-&gt;{ $_-&gt;{ â€˜idâ€™ } }-&gt;{
â€˜sender_emailâ€™} || â€œSender_email irretrievableâ€?;
my $sent = $message-&gt;{ $_-&gt;{ â€˜idâ€™ } }-&gt;{ â€˜sentâ€™} ||
â€œTo irretrievableâ€?;
my $subject = $message-&gt;{ $_-&gt;{ â€˜idâ€™ } }-&gt;{ â€˜subjectâ€™}
|| â€œSubject irretrievableâ€?;
my $body = $message-&gt;{ $_-&gt;{ â€˜idâ€™ } }-&gt;{ â€˜bodyâ€™} ||
â€œBody irretrievableâ€?;
print â€œ$to \n $sender_email \n $sent \n $subject \n
$bodyâ€?;
}
The double pipe at the end of the variable setting lines basically means, â€œIf this call
to the API returns empty, make it this value instead.â€? This is a simple catch to make
sure that, at least, your script doesnâ€™t just fail on you.
Chapter 9 â€” Reading Mail 153
Listing the Mail and Displaying a Chosen Message
So, with that all fully understood, you can put your knowledge, and that of
Chapter 7, to use. Listing 9-1 shows code that logs in, displays the mail you have
in your account in a list, and then lets you select the one you want to read. Select
that, and it displays it. Easy and useful.
Listing 9-1 follows, and then Iâ€™ll walk you through it. It uses the Utils.pm module
from Chapter 7 to deal with the login procedure.
Listing 9-1: Mail Listing and Display
use Utils;
$gmail = login();
$messages = $gmail-&gt;get_messages(); # simply get all messages
$id = 1;
$num = 0;
@nums;
foreach (@{$messages}) { # and iterate through them
if ($_-&gt;{â€œnewâ€?}) {
........print $id . â€œ\tâ€? . $_-&gt;{â€œsender_emailâ€?} . â€œ\tâ€? .
strip_bold($_-&gt;{â€œsubjectâ€?}) . â€œ\nâ€?; # output message data
........push(@nums, $num);
........$id++;
}
$num++;
}
print â€œ\nâ€?;
print â€œenter message number to retrive it\nâ€?;
$num = &lt;&gt;;
print â€œ\nâ€?;
$message = @{$messages}[$nums[$num - 1]];
$msgid = $message-&gt;{â€œidâ€?};
if ($msgid) { # check if message id is OK
my $full_message = $gmail-&gt;get_indv_email(msg =&gt;
$message); # and retrive full message (including body but not
attachments - if we need them as well - we need to use
get_attachment method)
print â€œsender: â€œ . $full_message-&gt;{$id}-&gt;{â€œsenderâ€?} .
â€œ\nâ€?;
Continued
154 Part II â€” Getting Inside Gmail
Listing 9-1 (continued)
print â€œsent: â€œ . $full_message-&gt;{$id}-&gt;{â€œsentâ€?} . â€œ\nâ€?;
print â€œto: â€œ . $full_message-&gt;{$id}-&gt;{â€œtoâ€?} . â€œ\nâ€?;
print â€œsubject: â€œ . strip_bold($full_message-&gt;{$id}-</p>

<blockquote>
  <p>{â€œsubjectâ€?}) . â€œ\nâ€?;
  print $full_message-&gt;{$id}-&gt;{â€œbodyâ€?} . â€œ\n\nâ€?;
  }
  So how does this work? First you use the Utils.pm module you made at the end of
  Chapter 7 and have it log you in:
  use Utils;
  $gmail = login();
  Now that youâ€™re logged in, you need to retrieve the messages and loop through
  each one, numbering it and printing the sender and subject line.
  $messages = $gmail-&gt;get_messages(); # simply get all messages
  $id = 1;
  $num = 0;
  @nums;
  foreach (@{$messages}) { # and iterate through them
  if ($_-&gt;{â€œnewâ€?}) {
  ........print $id . â€œ\tâ€? . $_-&gt;{â€œsender_emailâ€?} . â€œ\tâ€? .
  strip_bold($_-&gt;{â€œsubjectâ€?}) . â€œ\nâ€?; # output message data
  ........push(@nums, $num);
  ........$id++;
  }
  $num++;
  }
  Now you give the option to enter the number (as printed in the preceding code)
  of the message you want to see.
  print â€œ\nâ€?;
  print â€œenter message number to retrive it\nâ€?;
  $num = &lt;&gt;;
  print â€œ\nâ€?;
  Once a number has been entered, retrieve the message and print it on the screen.
  $message = @{$messages}[$nums[$num - 1]];
  $msgid = $message-&gt;{â€œidâ€?};
  if ($msgid) { # check if message id is OK
  my $full_message = $gmail-&gt;get_indv_email(msg =&gt;
  $message); # and retrive full message (including body but not
  Chapter 9 â€” Reading Mail 155
  attachments - if we need them as well - we need to use
  get_attachment method)
  print â€œsender: â€œ . $full_message-&gt;{$id}-&gt;{â€œsenderâ€?} .
  â€œ\nâ€?;
  print â€œsent: â€œ . $full_message-&gt;{$id}-&gt;{â€œsentâ€?} . â€œ\nâ€?;
  print â€œto: â€œ . $full_message-&gt;{$id}-&gt;{â€œtoâ€?} . â€œ\nâ€?;
  print â€œsubject: â€œ . strip_bold($full_message-&gt;{$id}-
  {â€œsubjectâ€?}) . â€œ\nâ€?;
  print $full_message-&gt;{$id}-&gt;{â€œbodyâ€?} . â€œ\n\nâ€?;
  }
  Now, as you can see from the in-code comments, this code canâ€™t deal with attachments.
  Itâ€™s time you learned how. Oh. Look . . .
  Dealing with Attachments
  Gmailâ€™s enormous storage capacity gives you the opportunity to use it for very
  large attachments. There are many possibilities for this feature, but first you need
  to know how to retrieve the attachments themselves.
  You retrieve an attachment in a way very closely connected to the method you
  used in the RSS script in Listing 9-1. First, retrieve the list of messages and then
  loop through them, pulling out the data on each message. Here you differâ€”
  youâ€™re looking for an attachment, so you test to see if one is present, and if so you
  go on to do something about it. The first part of a script after logging in, therefore,
  is:
  my $messages = $gmail-&gt;get_messages();
  foreach ( @{$messages} ) {
  my $email = $gmail-&gt;get_indv_email( msg =&gt; $_ );
  if ( defined( $email-&gt;{ $_-&gt;{â€˜idâ€™} }-&gt;{â€˜attachmentsâ€™} ) )
  {
  foreach ( @{ $email-&gt;{ $_-&gt;{â€˜idâ€™} }-&gt;{â€˜attachmentsâ€™} }
  ) {</p>
  
  <h4>Here do something with each attachment</h4>
</blockquote>

<p>}
}
}
Making an RSS Feed of Your Inbox
So now you know how to gather the mail from a specific folder and print it out.
Letâ€™s do something more useful with it, as an exercise. How about an RSS feed of
156 Part II â€” Getting Inside Gmail
your Inbox? In Chapter 7 you already made a feed that displays the unread message
count. Do the same here, only displaying the messages instead.
Listing 9-2 shows the code, which is followed by a walkthrough.
Listing 9-2: Gmail Inbox to RSS</p>

<h4>!/usr/bin/perl</h4>

<p>use warnings;
use strict;
use XML::RSS;
use Mail::Webmail::Gmail;
use CGI qw(standard);
my $username = param(â€œusernameâ€?);
my $password = param(â€œpasswordâ€?);
my $gmail = Mail::Webmail::Gmail-&gt;new(
username =&gt; $username,
password =&gt; $password,
);
my $messages =
$gmail-&gt;get_messages( label =&gt;
$Mail::Webmail::Gmail::FOLDERS{â€˜INBOXâ€™} );
my $rss = new XML::RSS( version =&gt; â€˜2.0â€™ );
foreach ( @{$messages} ) {
my $message = $gmail-&gt;get_indv_email( msg =&gt; $_ );
my $messageid = $_-&gt;{â€˜idâ€™};
my $sender_email = $message-&gt;{ $_-&gt;{â€˜idâ€™} }-</p>

<blockquote>
  <p>{â€˜sender_emailâ€™}
  || â€œSender_email irretrievableâ€?;
  my $sent = $message-&gt;{ $_-&gt;{â€˜idâ€™} }-&gt;{â€˜sentâ€™}
  || â€œTo irretrievableâ€?;
  my $subject = $message-&gt;{ $_-&gt;{â€˜idâ€™} }-&gt;{â€˜subjectâ€™}
  || â€œSubject irretrievableâ€?;
  Chapter 9 â€” Reading Mail 157
  my $body = $message-&gt;{ $_-&gt;{â€˜idâ€™} }-&gt;{â€˜bodyâ€™}
  || â€œBody irretrievableâ€?;
  $rss-&gt;add_item(
  title =&gt; â€œ$subjectâ€?,
  link =&gt;
  â€œhttp://gmail.google.com/gmail/h/abcde12345/?th=$messageid&amp;v=c
  â€?,
  author =&gt; â€œ$sender_emailâ€?,
  description =&gt; â€œ$bodyâ€?,
  );
  }
  $rss-&gt;channel(
  title =&gt; â€œThe Gmail inbox for $usernameâ€?,
  link =&gt; â€œhttp://gmail.google.com/â€?,
  );
  print header(â€˜application/xml+rssâ€™);
  print $rss-&gt;as_string;
  The first thing to notice is that this script is very simple indeed. Thatâ€™s because of
  the Perl moduleâ€”the whole point of these modules is to abstract away this sort
  of thing. So, the first thing you do is load the modules up and log in as usual:
  use XML::RSS;
  use Mail::Webmail::Gmail;
  use CGI qw(standard);
  my $username = param(â€œusernameâ€?);
  my $password = param(â€œpasswordâ€?);
  my $gmail = Mail::Webmail::Gmail-&gt;new(
  username =&gt; $username,
  password =&gt; $password,
  );
  Because you want the script to return an RSS feed, youâ€™ve made it into a CGI script,
  to be called from, and run by, a server. The easiest way to make this useful is to take
  the Gmail accountâ€™s username and password from parameters in the scriptâ€™s URL.
  Saving this script as gmailinboxtorss.cgi would allow you to subscribe to the following
  URL:
  <a href="http://www.example.com/gmailinboxtorss.cgi?username=USERNAME&amp;passw">http://www.example.com/gmailinboxtorss.cgi?username=USERNAME&amp;passw</a>
  ord=PASSWORD
  158 Part II â€” Getting Inside Gmail
  By this point in the script, you have logged in. Now to retrieve the messages in
  the Inbox:
  my $messages =
  $gmail-&gt;get_messages( label =&gt;
  $Mail::Webmail::Gmail::FOLDERS{â€˜INBOXâ€™} );
  This places the contents of the Inbox into $messages as a reference to an array of
  hashes, which contains the messages within the Inbox. Before looping through
  this array and creating an RSS item from each one, first you need to create the
  object that creates the RSS feed. Do that with this line:
  my $rss = new XML::RSS( version =&gt; â€˜2.0â€™ );
  Now for the real workings. You have an array where each member is a hash, containing
  a single message and all its details.To get to these details, you need to be
  able to address them with the hashâ€™s key. So, loop through the array, take the name
  of the hash, use that as its key, and grab out the values:
  foreach ( @{$messages} ) {
  my $message = $gmail-&gt;get_indv_email( msg =&gt; $_ );
  my $messageid = $_-&gt;{â€˜idâ€™};
  my $sender_email = $message-&gt;{ $_-&gt;{â€˜idâ€™} }-
  {â€˜sender_emailâ€™}
  || â€œSender_email irretrievableâ€?;
  my $sent = $message-&gt;{ $_-&gt;{â€˜idâ€™} }-&gt;{â€˜sentâ€™}
  || â€œTo irretrievableâ€?;
  my $subject = $message-&gt;{ $_-&gt;{â€˜idâ€™} }-&gt;{â€˜subjectâ€™}
  || â€œSubject irretrievableâ€?;
  my $body = $message-&gt;{ $_-&gt;{â€˜idâ€™} }-&gt;{â€˜bodyâ€™}
  || â€œBody irretrievableâ€?;
  Noting, again, the double pipe in the statement that gives the variable a value even if
  the Mail::Webmail::Gmail module cannot. This protects you a little from Gmailâ€™s
  evolution breaking the module and hence your scripts.
  Next, create the RSS item for the message:
  $rss-&gt;add_item(
  title =&gt; â€œ$subjectâ€?,
  link =&gt;
  â€œhttp://gmail.google.com/gmail/h/abcde12345/?th=$messageid&amp;v=c
  â€?,
  Chapter 9 â€” Reading Mail 159
  author =&gt; â€œ$sender_emailâ€?,
  description =&gt; â€œ$bodyâ€?,
  );
  Thatâ€™s all quite self-explanatory, except for the line that creates the itemâ€™s link
  element. There you can see a long URL that is completed with the message ID
  number. This produces a link to the HTML-only version of the Gmail interface,
  but you will have to wait until Chapter 12 to see that fully explained. Skip ahead
  if youâ€™re curious.
  The only thing left to do here is serve the feed, so you do this:
  $rss-&gt;channel(
  title =&gt; â€œThe Gmail inbox for $usernameâ€?,
  link =&gt; â€œhttp://gmail.google.com/â€?,
  );
  print header(â€˜application/xml+rssâ€™);
  print $rss-&gt;as_string;
  To install and run this script, place it in a CGI-enabled directory on your server,
  and remember to CHMOD it to executable.
  This script highlights a simple method of gathering messages and doing something
  with them. As you saw in the previous chapter, you can easily direct the
  get_messages() function, which above retrieves the array of hashes from the
  Inbox. You can grab the messages from the Starred folder, for example, by changing
  the line in Listing 9-1 to the following:
  my $messages = $gmail-&gt;get_messages( label =&gt;
  $Mail::Webmail::Gmail::FOLDERS{ â€˜STARREDâ€™ } );
  Moving messages around the labels and default folders is examined in Chapter 10.
  There you will also look at finding which labels and folders you have.
  And Now . . .
  In this chapter, then, youâ€™ve learned how to retrieve e-mails from Gmail using
  Perl. You should now be able to access the data of any mail you wish and use it
  within your programs. As you will see in the later chapters, this opens many new
  opportunities. In the next chapter, you learn how to send mail via Gmail.</p>
</blockquote>

<p>Sending Mail
Now that you know how to read the mail in your Inbox
with your own programs, itâ€™s time to move on to replying
to those mails by sending your own messages.
Sending Mail with Gmail SMTP
The first thing to remember is that Gmail provides its own SMTP
server. This offers two major features. First, you can use the SMTP
server from your own e-mail application, which is a great help if
youâ€™re traveling and your usual e-mail provider is unreachable. The
second use is that every single scripting language you might have a
desire to use has standard SMTP support available as a library, and
the support for TLS encryption, which you need to connect to
Gmail, is being added apace.
First, though, the settings youâ€™ll need:
 Server name: <a href="http://smtp.google.com">smtp.google.com</a>
 Username: <a href="mailto:yourgmailname@gmail.com">yourgmailname@gmail.com</a>
 Password: Your Gmail password
 Security: Yes, using TLS
One thing to note about this technique is that Gmail will rewrite
your e-mail headers. It replaces the From: and Reply-to: lines
with your Gmail address because Gmail also automatically adds
the so-called Domain Keys to their outgoing e-mails, allowing
spam-hit system administrators to block fake Gmail mail from
their servers.Without the Domain Keys this wouldnâ€™t work, but
Gmail canâ€™t send mail with a different From: or Reply-to: address
without breaking the Domain Key.
Ë› Using the Gmail
SMTP server
Ë› Sending mail
with Perl
Ë› Replying to
mail with Perl
chapter
in this chapter
162 Part II â€” Getting Inside Gmail
One other advantage of using the Gmail SMTP client is that any mail sent via the
SMTP gateway is automatically stored within your Gmail account.
Using the SMTP Server Programmatically
If you want to talk directly to the SMTP server instead of using the APIs featured
in the rest of this chapter, then you will need to use a library that can deal with
TLS encryption. There is no standard module to do this within Perl or PHP at
the time of this writing, but Python users can use the standard smtplib, which
comes with the Python distribution.
Sending Mail with Perl
The Mail::Webmail::Gmail module encapsulates mail sending in one single function,
send_message. The basic method to send a message is:
$gmail-&gt;send_message(
to =&gt; â€˜user@domain.comâ€™,
subject =&gt; â€˜Test Messageâ€™,
msgbody =&gt; â€˜This is a test.â€™
);
To send to multiple addresses, you can use an arrayref containing all of the
addresses:
my $email_addrs = [
â€˜user1@domain.comâ€™,
â€˜user2@domain.comâ€™,
â€˜user3@domain.comâ€™, ];
$gmail-&gt;send_message(
to =&gt; $email_addrs,
subject =&gt; â€˜Test Messageâ€™,
msgbody =&gt; â€˜This is a test.â€™
);
You may also send mail using cc: and bcc:
$gmail-&gt;send_message(
to =&gt; $email_addrs,
cc=&gt; $cc_email_addrs,
subject =&gt; â€˜Test Messageâ€™,
msgbody =&gt; â€˜This is a test.â€™
);
Listing 10-1 shows a small script, using the Mail::Webmail::Gmail module and
the Utils.pm code introduced in Chapter 7. It takes input from the keyboard,
and sends the mail directly. Itâ€™s exceptionally easy to understand, so no walkthrough
is necessary.
Chapter 10 â€” Sending Mail 163
Listing 10-1: Sending Mail with Perl
use Utils;
$gmail = login();</p>

<h4>input data from keyboard</h4>

<p>print â€œto:\nâ€?;
$to = &lt;&gt;;
print â€œsubject:\nâ€?;
$subject = &lt;&gt;;
print â€œbody:\nâ€?;
$body = &lt;&gt;;
$gmail-&gt;send_message( to =&gt; $to, subject =&gt; $subject, msgbody
=&gt; $body ); # and send the message
print â€œmessage sent\nâ€?;
That script is, as you can see, remarkably simple. But it does provide the basis for
any number of more complicated scripts. Being able to send mail from a script
isnâ€™t a new thingâ€”itâ€™s pretty easy to do without Gmailâ€”but doing it via Gmail
does give you some advantages. First, itâ€™s easier, but second, the mail is automatically
archived. Using Gmail to handle outgoing mail from your applications can
therefore be more resilient, certainly easier, and much more useful than doing it
any other way.
In Chapter 9, you looked at downloading and reading new mail. Listing 10-2
shows a script that combines the techniques you learned there with your newfound
skills at sending mail.
Listing 10-2: Reading Unread Mail and Replying
use Utils;
$gmail = login();
$messages = $gmail-&gt;get_messages(); # simply get all
messages
$id = 1;
$num = 0;
@nums;
Continued
164 Part II â€” Getting Inside Gmail
Listing 10-2 (continued)
foreach ( @{$messages} ) {
if ( $_-&gt;{â€œnewâ€?} ) {
print $id . â€œ\tâ€?
. $_-&gt;{â€œsender_emailâ€?} . â€œ\tâ€?
. strip_bold( $_-&gt;{â€œsubjectâ€?} )
. â€œ\nâ€?;
push( @nums, $num );
$id++;
}
$num++;
}
print â€œ\nâ€?;
print â€œenter message number to reply to\nâ€?;
$num = &lt;&gt;;
print â€œ\nâ€?;
$message = @{$messages}[ $nums[ $num - 1 ] ];
$msgid = $message-&gt;{â€œidâ€?};
if ($msgid) { # check if message id is OK
print â€œbody:\nâ€?;
$body = &lt;&gt;;
$gmail-&gt;send_message(
to =&gt; $message-&gt;{â€œsender_emailâ€?},
subject =&gt; â€œRe: â€œ . strip_bold( $message-&gt;{â€œsubjectâ€?}
),
msgbody =&gt; $body
); # we are using sender and subject from the
original message
print â€œmessage sent\nâ€?;
}
Running this script produces a list of the new messages and gives you the option
to choose one and reply to it. You should see how this works from the code, but
letâ€™s walk through it.
The start is simple enough. Youâ€™re using the Utils.pm module you created in
Chapter 7, and you just want to log in. Logging in creates the Gmail object
used in the rest of the script:
use Utils;
$gmail = login();
Chapter 10 â€” Sending Mail 165
You then grab all of the messages in the Inbox and set up some variables you shall
use to keep track of them:
$messages = $gmail-&gt;get_messages(); # simply get all
messages
$id = 1;
$num = 0;
@nums;
Then you iterate through these messages, adding them to a list if they are marked
as unread. You print the senderâ€™s address and the subject line of the e-mail, with a
number next to it, pushing that number and the message:
foreach ( @{$messages} ) {
if ( $_-&gt;{â€œnewâ€?} ) {
print $id . â€œ\tâ€?
. $_-&gt;{â€œsender_emailâ€?} . â€œ\tâ€?
. strip_bold( $_-&gt;{â€œsubjectâ€?} )
. â€œ\nâ€?;
push( @nums, $num );
$id++;
}
$num++;
}
And then you ask the user to enter the number of the message she wants to
reply to:
print â€œ\nâ€?;
print â€œenter message number to reply to\nâ€?;
$num = &lt;&gt;;
print â€œ\nâ€?;
Finally, you retrieve the senderâ€™s e-mail and subject line from the chosen mail and
request some body text from the user. Once you have that, the message is created
and sent:
$message = @{$messages}[ $nums[ $num - 1 ] ];
$msgid = $message-&gt;{â€œidâ€?};
if ($msgid) { # check if message id is OK
print â€œbody:\nâ€?;
$body = &lt;&gt;;
$gmail-&gt;send_message(
to =&gt; $message-&gt;{â€œsender_emailâ€?},
subject =&gt; â€œRe: â€œ . strip_bold( $message-&gt;{â€œsubjectâ€?}
),
msgbody =&gt; $body
166 Part II â€” Getting Inside Gmail
); # we are using sender and subject from the
original message
print â€œmessage sent\nâ€?;
}
This is, of course, an extremely simple script and well positioned to be built upon.
Sending Attachments
To attach files to a message via the WWW::Webmail::Gmail module, you only
need use the send_message function as normal, but provide a file reference to the
attachment. Because youâ€™re programmers, remember, you start counting from zero.
So the first reference is file0, the second file1, and so on. Like so:
$gmail-&gt;send_message(
to =&gt; â€˜user@domain.comâ€™,
subject =&gt; â€˜Test Messageâ€™,
msgbody =&gt; â€˜This is a test.â€™,
file0 =&gt; [â€œ/tmp/fooâ€?],
file1 =&gt; [â€œ/tmp/barâ€?]
);
And Now . . .
So, in this short chapter, you learned how to send mail. In the next chapter, you
look at the much more advanced concepts of organizing your mail inside Gmail,
programmatically. This will allow you to go on and use Gmail for more complicated
applications.
Conquering Gmail
Youâ€™re the man! Youâ€™ve learned how to use Gmail to its
fullest, and now youâ€™re writing scripts that use scraped
APIs to control your mail. In the rest of the book, you take
your skills to the next level.
First, in Chapter 11, you look at organizing your mailâ€”using
Gmailâ€™s labeling system. Then Chapter 12 deals with e-mail
addresses and the import and export of addresses to the Gmail
address book.
Then, for a bit of a break, in Chapter 13 you look at the possibilities
that might open up with the HTML-only version of Gmail.
In the future, you might want to know about that so you can
build your own API library.
After that, itâ€™s back to practicalities, when you learn how to export
mail in Chapter 14, use Gmail for all sorts of interesting activities
(Chapter 14), and then, in perhaps the culmination of the whole
study of this fine web application, use Gmail as a mountable file
system. Really. Peep Chapter 16 if you donâ€™t believe.
Chapter 11
Dealing with Labels
Chapter 12
Addressing Addresses
Chapter 13
Building an API from
the HTML-Only Version
of Gmail
Chapter 14
Exporting Your Mail
Chapter 15
Using Gmail to . . .
Chapter 16
Using GmailFS
in this part
part</p>

<p>Dealing with
Labels
You can receive mail and you can send mail, but you have
yet to play with Gmailâ€™s main featureâ€”its immense storage
capacity. Youâ€™ll be using that over the next few chapters.
One of the biggest draws to Gmail is the way you organize
mail with labels. Labels are quite the fashionable thing on the
Internet at the moment:Whether you call them labels or the
commonly used idea of tags, it really doesnâ€™t matter. Gmailâ€™s system
works in the same way as the other cult Web 2.0 sites, Flickr
and del.icio.us.
In this chapter, then, you look at working with the labels programmatically,
listing them, setting them, changing them, and
deleting them.
Listing the Existing Labels
The simplest thing you can do with labels is list the ones you are
already using. Listing 11-1 shows a script to do just that. It uses
the Utils.pm module created earlier in the book, as do the rest of
the scripts in this chapter.
You can find Utils.pm, if you donâ€™t have it already, in
Listing 7-4.
The script is too simple to require any explanation, but just note
that it uses Mail::Webmail::Gmailâ€™s get_labels() function to
return an array.
Ë› Listing existing
labels
Ë› Setting and editing
labels
Ë› Deleting old labels
chapter
in this chapter
170 Part III â€” Conquering Gmail
Listing 11-1: Getting the Existing Labels
use Utils;
$gmail = login();
@labels = $gmail-&gt;get_labels(); # simply get all labels
foreach (@labels) { # and iterate through them
print $_ . â€œ\nâ€?;
}
Running this will simply print out a list of the labels you are using right now.
Thatâ€™s useful, but you can extend it a little bit. Listing 11-2 does the same thing,
but allows you to select a label, whereupon it prints all the messages labeled thusly.
Have a look at the listing, and then youâ€™ll walk through the clever bit.
Listing 11-2: Retrieving the Messages from a Certain Label
use Utils;
$gmail = login();
@labels = $gmail-&gt;get_labels(); # simply get all labels
$id = 1;
foreach (@labels) { # and iterate through them
print $id . â€œ\tâ€? . $_ . â€œ\nâ€?;
$id++;
}
print â€œ\nâ€?;
print â€œenter label number to retrive labeled messages:\nâ€?;
$num = &lt;&gt;;
print â€œ\nâ€?;
$label = $labels[ $num - 1 ];
if ($label) {
$messages =
$gmail-&gt;get_messages( label =&gt; $label );
foreach ( @{$messages} ) {
Chapter 11 â€” Dealing with Labels 171
print $_-&gt;{â€œsender_emailâ€?} . â€œ\tâ€?
. strip_bold( $_-&gt;{â€œsubjectâ€?} )
. â€œ\nâ€?;
}
}
The important section to note here is the code that follows:
if ($label) {
$messages =
$gmail-&gt;get_messages( label =&gt; $label );
foreach ( @{$messages} ) {
print $_-&gt;{â€œsender_emailâ€?} . â€œ\tâ€?
. strip_bold( $_-&gt;{â€œsubjectâ€?} )
. â€œ\nâ€?;
}
}
By this section of the script, youâ€™ve printed out the labels you know about, and
asked the user to choose one. So now you test to see if the number the user enters
is actually a value option, and if it is, you retrieve all of the messages with the pertinent
label. Thatâ€™s done, as ever, with the get_messages() function, which can
be modified by passing the name of a label with it:
$messages = $gmail-&gt;get_messages( label =&gt; $label );
And this returns messages in the same way as you dealt with in Chapter 8.
In Chapter 9, you requested new mail and gave the option to reply to it. Here, in
Listing 11-3, you can do a similar thing: request mail for a certain label and give
the option to reply to it.
Listing 11-3: Retrieving a Labeled Message and Replying
use Utils;
$gmail = login();
@labels = $gmail-&gt;get_labels(); # simply get all labels
$id = 1;
foreach (@labels) { # and iterate through them
print $id . â€œ â€œ . $_ . â€œ\nâ€?;
$id++;
Continued
172 Part III â€” Conquering Gmail
Listing 11-3 (continued)
}
print â€œ\nâ€?;
print â€œenter label number to retrive labeled messages:\nâ€?;
$num = &lt;&gt;;
print â€œ\nâ€?;
$label = $labels[ $num - 1 ];
if ($label) {
$messages =
$gmail-&gt;get_messages( label =&gt; $label ); # get all
labeled messages
$id = 1;
foreach ( @{$messages} ) { # and iterate through them
print $id . â€œ\tâ€?
. $_-&gt;{â€œsender_emailâ€?} . â€œ\tâ€?
. strip_bold( $_-&gt;{â€œsubjectâ€?} )
. â€œ\nâ€?; # output message data
$id++;
}
print â€œ\nâ€?;
print â€œenter message number to reply to\nâ€?;
$num = &lt;&gt;;
print â€œ\nâ€?;
$message = @{$messages}[ $num - 1 ];
$msgid = $message-&gt;{â€œidâ€?};
if ($msgid) { # check if message id is OK
print â€œbody:\nâ€?;
$body = &lt;&gt;;
$gmail-&gt;send_message(
to =&gt; $message-&gt;{â€œsender_emailâ€?},
subject =&gt; â€œRe: â€œ . strip_bold( $message-</p>

<blockquote>
  <p>{â€œsubjectâ€?} ),
  msgbody =&gt; $body
  ); # we are using sender and subject from the
  original message
  print â€œmessage sent\nâ€?;
  }
  }
  Chapter 11 â€” Dealing with Labels 173
  This is exactly the same technique as you used in Listing 11-2, added to Chapter
  10â€™s method for sending a reply. You should now be able to see how you can build
  simple applications and workflows with the Gmail and the Mail::Webmail::Gmail
  module.
  Setting New Labels
  Itâ€™s all very well being able to list the existing labels, but what about setting messages
  with them? To do that with Mail::Webmail::Gmail, use the edit_labels
  function. Listing 11-4 displays the unlabeled messages and the existing labels, and
  allows you to apply one to the other.
  First, the listing and then how it works.
  Listing 11-4: Labeling Unlabeled Messages
  use Utils;
  $gmail = login();
  $messages = $gmail-&gt;get_messages(); # simply get all
  messages
  $id = 1;
  $num = 0;
  @nums;
  foreach ( @{$messages} ) { # and iterate through
  them
  if ( $_-&gt;{â€œnewâ€?} ) {
  print $id . â€œ\tâ€?
  . $_-&gt;{â€œsender_emailâ€?} . â€œ\tâ€?
  . strip_bold( $_-&gt;{â€œsubjectâ€?} )
  . â€œ\nâ€?; # output message data
  push( @nums, $num );
  $id++;
  }
  $num++;
  }
  print â€œ\nâ€?;
  print â€œenter message number to label\nâ€?;
  $num = &lt;&gt;;
  print â€œ\nâ€?;
  Continued
  174 Part III â€” Conquering Gmail
  Listing 11-4 (continued)
  $message = @{$messages}[ $nums[ $num - 1 ] ];
  $msgid = $message-&gt;{â€œidâ€?};
  if ($msgid) {
  @labels = $gmail-&gt;get_labels(); # simply get all labels
  $id = 1;
  foreach (@labels) { # and iterate through
  them
  print $id . â€œ\tâ€? . $_ . â€œ\nâ€?;
  $id++;
  }
  print â€œ\nâ€?;
  print â€œenter label to set\nâ€?;
  $num = &lt;&gt;;
  print â€œ\nâ€?;
  $label = $labels[ $num - 1 ];
  if ($label) {
  $gmail-&gt;edit_labels(
  label =&gt; $label,
  action =&gt; â€œaddâ€?,
  msgid =&gt; $msgid
  ); # simply add label to message
  print â€œlabeled message\nâ€?;
  }
  }
  The key part of the script is the edit_labels function. Hereâ€™s the pertinent
  function call:
  $gmail-&gt;edit_labels(
  label =&gt; $label,
  action =&gt; â€œaddâ€?,
  msgid =&gt; $msgid
  );
  You set the label attribute to the label you require, the action to â€œaddâ€? and the
  msgid to the message ID of the message youâ€™re changing. It is, as you can see,
  very simple to understand.
  Chapter 11 â€” Dealing with Labels 175
  Creating a New Label
  The creation of new labels is done with the same edit_labels function, using
  the â€œcreateâ€? action. This code that follows creates a new label â€œfishâ€?. Labels
  can have a maximum of 40 characters.
  $gmail-&gt;edit_labels(
  label =&gt; â€œfishâ€?,
  action =&gt; â€œcreateâ€?,
  );
  When thatâ€™s done, you can go back and apply that label to the messages you wish.
  Removing Labels
  Of course, you might go completely label crazy. In which case, one day youâ€™ll wake
  up with regret and want to undo all that you did before. If thatâ€™s the case, use the
  final variation of the edit_labels function, like so:
  $gmail-&gt;edit_labels(
  label =&gt; $label,
  action =&gt; â€œremoveâ€?,
  msgid =&gt; $msgid
  );
  Listing 11-5 puts together the final variation of the chapter, with a script that
  allows you to choose a label, display the messages with that label, and choose a
  message to remove that label from. Complex? Not hardly!
  Listing 11-5: Getting Labeled Messages and Removing Labels
  use Utils;
  $gmail = login();
  @labels = $gmail-&gt;get_labels(); # simply get all labels
  $id = 1;
  foreach (@labels) { # and iterate through them
  print $id . â€œ â€œ . $_ . â€œ\nâ€?;
  $id++;
  }
  print â€œ\nâ€?;
  print â€œenter label number to retrieve labeled messages:\nâ€?;
  $num = &lt;&gt;;
  Continued
  176 Part III â€” Conquering Gmail
  Listing 11-5 (continued)
  print â€œ\nâ€?;
  $label = $labels[ $num - 1 ];
  if ($label) {
  $messages =
  $gmail-&gt;get_messages( label =&gt; $label ); # get all
  labeled messages
  $id = 1;
  $num = 0;
  foreach ( @{$messages} ) { # and
  iterate through them
  print $id . â€œ\tâ€?
  . $_-&gt;{â€œsender_emailâ€?} . â€œ\tâ€?
  . strip_bold( $_-&gt;{â€œsubjectâ€?} )
  . â€œ\nâ€?; # output
  message data
  $id++;
  }
  print â€œ\nâ€?;
  print â€œenter message number to remove label\nâ€?;
  $num = &lt;&gt;;
  print â€œ\nâ€?;
  $message = @{$messages}[ $num - 1 ];
  $msgid = $message-&gt;{â€œidâ€?};
  if ($msgid) { # check if
  message id is OK
  $gmail-&gt;edit_labels(
  label =&gt; $label,
  action =&gt; â€œremoveâ€?,
  msgid =&gt; $msgid
  );
  print â€œremoved label\nâ€?;
  }
  }
  And Now . . .
  You should now be able to deal confidently with the mail inside Gmail. But what
  of your address book? In the next chapter, you look at using the Perl API to communicate
  with the address book and to import and export your contacts.
  Addressing
  Addresses
  Gmailâ€™s mastery of your e-mail wouldnâ€™t be of much use
  without an address book. Lucky for us, Gmail provides a
  perfectly functional one. Indeed, it was the address autocompletion,
  where you can start typing a known address and have
  it appear automatically within the To: field of a new mail, that
  first excited the Gmail beta testers. As an example of Ajax programming,
  it was, at the time, second to none.
  The auto-completion system gets its addresses from, and is centered
  on, the Gmail Contacts list. In this chapter, you learn how
  to control the Contacts list from your own programs.
  The Contacts List
  The Contacts list is accessed from the link on the left of your
  Gmail screen. It looks, if youâ€™re logged into my system at least,
  very much like Figure 12-1.
  As far as an address book goes, itâ€™s pretty simple. But combined
  with the auto-complete function, it provides a very useful way of
  dealing with your (or at least my) failing memory when it comes
  to e-mail addresses.
  Adding and managing contacts from your browser is obvious and
  far below your geeky level, so letâ€™s go straight to the scripting.
  Ë› Importing contacts
  Ë› Displaying contacts
  Ë› Exporting contacts
  chapter
  in this chapter
  178 Part III â€” Conquering Gmail
  Figure 12-1 The Gmail contacts list
  Importing Contacts
  Youâ€™ve got a list of contacts, and youâ€™re not going home until youâ€™ve added them
  to your Gmail account. Hurrah, then, for Listing 12-1. This provides the basis
  for a script to allow you to add contacts programmatically. It uses, as ever, the
  Utils.pm and Mail::Webmail::Gmail modules that youâ€™ve been working with
  since Chapter 7.
  Listing 12-1: Adding a Contact
  use Utils;
  $gmail = login();</p>
  
  <h4>input data from keyboard</h4>
</blockquote>

<p>print â€œname:\nâ€?;
$name = &lt;&gt;;
print â€œemail:\nâ€?;
$email = &lt;&gt;;
print â€œnotes:\nâ€?;
$notes = &lt;&gt;;
Chapter 12 â€” Addressing Addresses 179
chomp($name);
chomp($email);
chomp($notes);
$gmail-&gt;add_contact( name =&gt; $name, email =&gt; $email, notes =&gt;
$notes )
; # simply add contact
print â€œcontact added\nâ€?;
Running this script from the command line provides three prompts, in order, for
the name, e-mail address, and notes regarding the contact. Enter those, and the
script adds the contact to your Gmail account.
If you have a long list of addresses to import, sometimes itâ€™s easier to turn that list
into a comma-separated values (CSV) file and use the import function thatâ€™s part
of the Gmail site itself.
A comma-separated values file for e-mail addresses looks like this:
First Name,Last Name,Email Address
<a href="mailto:Ben,Hammersley,ben.Hammersley@gmail.com">Ben,Hammersley,ben.Hammersley@gmail.com</a>
<a href="mailto:Julius,Caesar,example.account@gmail.com">Julius,Caesar,example.account@gmail.com</a>
With the first line called the header, defining the values separated by commas
(hence the name) in the rest of the file. Most e-mail programs will export in a
compatible version of CSV anyway, but if you need to make one by hand, thatâ€™s
how. Spreadsheets are also good programs to use to build CSV files.
So, to import large amounts of contacts, follow these steps:
1. Create a custom CSV file or export the address book from your other webmail
provider or e-mail client as a CSV file.
2. Log in to Gmail and click Contacts on the left side of the page. The Contacts
list then opens in a new window.
3. Click Import Contacts.
4. Click Browse and locate the CSV file youâ€™d like to upload.
5. Select the file and click Import Contacts. After successfully uploading the
document, a dialog box displays the number of new entries that were added
to your Contacts list.
180 Part III â€” Conquering Gmail
Showing Your Current Contacts
Once youâ€™ve got your old contacts in there and have added a load more, you might
want to list those and access them programmatically. Listing 12-2 shows you how.
Listing 12-2: Getting Your Contacts
use Utils;
$gmail = login();
(@contacts) = @{ $gmail-&gt;get_contacts() }; # simply get all
contacts
foreach (@contacts) { # and iterate
though them
print $_-&gt;{â€œname1â€?} . â€œ\tâ€? . $_-&gt;{â€œemailâ€?} . â€œ\nâ€?; #
output contact data
}
The Mail::Webmail::Gmail module provides for this with one lovely bite-sized
function: get_contacts(). This returns an array hash of your contacts, in this
format:
$contact{ â€˜idâ€™ }
$contact{ â€˜name1â€™ }
$contact{ â€˜name2â€™ }
$contact{ â€˜emailâ€™ }
$contact{ â€˜noteâ€™ }
And so, in the core of the script in Listing 12-2, you are just looping through the
Arrays of Hashes and printing out the first name and e-mail address. You could,
of course, change this to use the other values, too:
foreach (@contacts) {
print $_-&gt;{â€œname1â€?} . $_-&gt;{â€œname2â€?} . $_-&gt;{â€œidâ€?} . â€œ\tâ€? .
$_-&gt;{â€œemailâ€?} . â€œ\tâ€? . $_-&gt;{â€œnoteâ€?} . â€œ\nâ€?;
}
The get_contacts() function can also be limited to the Frequently Mailed
contacts with the frequent flag:
my $contacts = $gmail-&gt;get_contacts( frequent =&gt; 1 );
Chapter 12 â€” Addressing Addresses 181
Exporting Contacts
Gmail is a bit greedy here. There are ample opportunities to import contacts to
the system. As youâ€™ve seen, you can do it with comma-separated value files or via
the script in Listing 12-1. But if you want to get your contacts out again, and into
a desktop address book, youâ€™re stuck.
Not quite. In Listing 12-3, thereâ€™s a script to export your contacts into a large
vCard file. All the modern address book or e-mail clients will be able to understand
the vCard file, and re-import your addresses. Itâ€™s also useful for backups, if
you ever get wary of Googleâ€™s ability to do that for you.
Hereâ€™s the listing, and then youâ€™ll see how it works.
Listing 12-3: Exporting Contacts as vCards
use Utils;
$gmail = login();
open VCARDS, â€œ&gt;contacts.vcfâ€?;
(@contacts) = @{ $gmail-&gt;get_contacts() }; # simply get all
contacts
foreach (@contacts) { # and iterate
though them
print VCARDS â€œBEGIN:VCARD\nVERSION:3.0\nâ€?;
print VCARDS â€œFN:â€? . $_-&gt;{â€œname1â€?} . â€œ\nâ€?;
print VCARDS â€œEMAIL;type=INTERNET:â€? . $_-&gt;{â€œemailâ€?} .
â€œ\nâ€?;
print VCARDS â€œEND:VCARD\nâ€?;
print VCARDS â€œ\nâ€?;
}
close VCARDS;
A vCard is a small text file containing address data. The entire standard is complex
and extensive, defined in RFC2425; you can read about it at <a href="http://www.imc.org/pdi/">www.imc.org/pdi/</a>
vcardoverview.html.
182 Part III â€” Conquering Gmail
Here is an example of a very simple vCard file:
BEGIN:VCARD
VERSION:3.0
FN:Ben Hammersley
EMAIL;type=INTERNET:ben.hammersley@gmail.com
END:VCARD
Saving that to disk and importing it into a vCard-compatible program will result
in my lovely e-mail address being embedded into your system. vCard files can
contain more than one vCard within, and thatâ€™s what the script in Listing 12-3
does. Itâ€™s very, very simple. It opens up a filehandle to a file called contacts.vcf
in the directory youâ€™re running the script in (change that line to make it go elsewhere,
naturally), and then calls upon the Mail::Webmail::Gmail module to
provide a hash of the contacts in your Contacts list. It then just iterates through
them, creating vCards as it goes and printing them to the filehandle. Then it
closes the filehandle and exits. Simplicity itself, really. You can then go on and
import the large vCard file into your weapon of choice.
And Now . . .
In this chapter, you looked at dealing with contacts within Gmail. You should
have learned how to import contacts from other applications. You should also be
able to export them at will, in order to re-import them into other applications or
for backup purposes. In the next chapter, you look at scraping the Gmail interface.
Building an API from
the HTML-Only
Version of Gmail
The problem with reverse engineering web applicationsâ€”
other than the complexityâ€”is that they never stop evolving.
Thatâ€™s the advantage of building an application on the
web: It costs nothing to ship an upgrade to all of your users. Such
upgrades, as mentioned previously, do, however, tend to break the
third-party APIs that this book relies on.
The one thing worse than breaking an API is making it redundantly
complex, and about halfway through writing this book,
Gmail did just that by releasing a plain HTML version of
the site. Gmail users approaching the site with an old, non-
JavaScriptâ€“enabled browser are able to access a version of the
application that does not rely on the JavaScript techniques discussed
in previous chapters. The functionality is a little restricted,
but the basic capabilities to read, write, and organize your mail
are there. This chapter, therefore, looks at faking an API by
scraping the HTML versionâ€”something somewhat simpler
than messing with the JavaScript API.
A First Look at the HTML Version
To see the HTML version of Gmail, turn off the JavaScript in
your browser, and log in as normal. (Or, you can log in and switch
from standard view to basic HTML by using the choices at the
bottom of the page. Either way is good.) You should see something
very similar to Figure 13-1.
Ë› Gmail from an
HTML perspective
Ë› Basic scraping
chapter
in this chapter
184 Part III â€” Conquering Gmail
FIGURE 13-1: The HTML-only version of Gmail
Itâ€™s easy to see the differences between the JavaScript and non-JavaScript versions
of the site. The non-JavaScript version has the yellow banner along the top, andâ€”
key point thisâ€”the URL of the page is both longer, and as you shall see, changes
when you use the application.
The first order of business is to view the HTML source of the page. You can see
that the page is all one pieceâ€”thereâ€™s no iFrame nonsense hereâ€”and that itâ€™s
pretty unspectacular markup. In fact, saving the HTML to disk, and running the
tidy application on it produces the output in Listing 13-1.
Listing 13-1: What Happens When You Try to Tidy Gmailâ€™s HTML
line 7 column 26 - Warning: unescaped &amp; or unknown entity
â€œ&amp;nameâ€?
line 7 column 35 - Warning: unescaped &amp; or unknown entity â€œ&amp;verâ€?
line 12 column 30 - Warning: unescaped &amp; or unknown entity
â€œ&amp;nameâ€?
line 12 column 43 - Warning: unescaped &amp; or unknown entity
â€œ&amp;verâ€?
line 12 column 1 - Warning: &lt;script&gt; attribute â€œtypeâ€? lacks
value
line 13 column 33 - Warning: unescaped &amp; or unknown entity
â€œ&amp;nameâ€?
Chapter 13 â€” Building an API from the HTML-Only Version 185
line 13 column 41 - Warning: unescaped &amp; or unknown entity
â€œ&amp;verâ€?
line 13 column 1 - Warning: &lt;script&gt; attribute â€œtypeâ€? lacks
value
line 16 column 1 - Warning: &lt;table&gt; attribute â€œsummaryâ€? lacks
value
line 21 column 42 - Warning: unescaped &amp; or unknown entity
â€œ&amp;answerâ€?
line 24 column 1 - Warning: discarding unexpected &lt;/table&gt;
line 25 column 1 - Warning: &lt;script&gt; attribute â€œtypeâ€? lacks
value
line 17 column 1 - Warning: &lt;script&gt; isnâ€™t allowed in &lt;tr&gt;
elements
line 30 column 1 - Warning: &lt;table&gt; attribute â€œsummaryâ€? lacks
value
line 30 column 1 - Warning: discarding unexpected &lt;table&gt;
line 46 column 1 - Warning: missing &lt;td&gt;
line 48 column 2 - Warning: discarding unexpected &lt;td&gt;
line 49 column 1 - Warning: &lt;table&gt; attribute â€œsummaryâ€? lacks
value
line 59 column 21 - Warning: unescaped &amp; or unknown entity â€œ&amp;pvâ€?
line 62 column 1 - Error: discarding unexpected &lt;/form&gt;
line 63 column 1 - Error: discarding unexpected &lt;/table&gt;
line 66 column 1 - Error: discarding unexpected &lt;/table&gt;
line 67 column 1 - Warning: &lt;table&gt; attribute â€œsummaryâ€? lacks
value
line 67 column 1 - Error: discarding unexpected &lt;table&gt;
line 70 column 1 - Warning: &lt;table&gt; attribute â€œsummaryâ€? lacks
value
line 73 column 18 - Warning: unescaped &amp; or unknown entity â€œ&amp;vâ€?
line 73 column 22 - Warning: unescaped &amp; or unknown entity â€œ&amp;pvâ€?
line 112 column 1 - Error: discarding unexpected &lt;/table&gt;
61 warnings, 18 errors were found! Not all warnings/errors were
shown.
It is, in short, horrific HTML. Now, the modern-day browser is used to such
things and has no problem in displaying this monstrosity on the screen. Your
problems are only just beginning, however. If the page were compliant and wellformed
XHTML, you would be able to use any number of XML parsing tools on
the source. XPath, for example, would make your life incredibly simple. This is not
to be. Youâ€™re going to have to treat Gmailâ€™s HTML front page as any other horribly
coded page. Itâ€™s still much, much simpler than the JavaScript variety, for sure,
but itâ€™s not as simple as it could be.
It is, then, time for the Old School.
186 Part III â€” Conquering Gmail
Introducing Basic Scraping
Every page on the web can be scrapedâ€”it can be downloaded by a script and have
its content mined and used as the input for a program. The complexity of this task
is dependent on the way the page itself is coded: One of the key reasons why
XHTML is so encouraged is that to be correct, XHTML also has to be wellformed
XML.Well-formed XML can be processed with a whole raft of useful
tools that make the job a simple one. Badly formed markup, like that of Gmail, is
different. This â€œtag soupâ€? requires a more complicated processing model. There are
a few, but youâ€™re going to use the method produced by the Perl module
HTML::TokeParserâ€”Token Parsing.
HTML::TokeParser
Imagine the web page is a stream of tags.With HTML::TokeParser, you leap
from tag to tag, first to last, until you reach the one you want, whereupon you can
grab the content and move on. Because you start at the top of the page, and specify
exactly how many times you jump, and to which tags, an HTML::TokeParser
script can look a little complicated, but in reality itâ€™s pretty easy to follow. You can
find the HTML::TokeParser module at <a href="http://search.cpan.org/%7Egaas/">http://search.cpan.org/~gaas/</a>
HTML-Parser-3.45/lib/HTML/TokeParser.pm.
If you flip to Appendix A, Listing A-4 shows the HTML code of the Gmail Inbox
you want to walk through.
As you can see from the listing, the page is made up of lots of tables. The first displays
the yellow banner advertising the JavaScript-enhanced version. The second
holds the search section. The third holds the left-hand menu, the fourth the
labels, and so on, and so on. It is only until you get to the table that starts with the
following code that you get to the Inbox itself:
&lt;table width=100% cellpadding=2 cellspacing=0 border=0 bgcolor=#e8eef7
class=th&gt;
But looking at this section of the code brings you hope and joy. Listing 13-2
shows the code that displays the first and last messages in the Inbox shown in
Figure 13-1.
Chapter 13 â€” Building an API from the HTML-Only Version 187
Listing 13-2: A Single Message in the HTML-Only Inbox Source
&lt;tr bgcolor=#E8EEF7&gt;
&lt;td width=1% nowrap&gt;
&lt;input type=checkbox name=t
value=â€?1025a4065d9b40bfâ€?&gt;
&lt;img src=â€?/gmail/images/cleardot.gifâ€?
width=15 height=15 border=0 alt=â€?â€?&gt;
&lt;/td&gt;
&lt;td width=30%&gt;
Ben Hammersley&lt;/td&gt;
&lt;td width=68%&gt;
&lt;a href=â€??th=1025a4065d9b40bf&amp;v=câ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;
&lt;/font&gt;&lt;/font&gt;
hello me
&lt;/a&gt;&lt;/td&gt;
&lt;td nowrap width=1%&gt;FebÂ 28
...
&lt;td nowrap&gt;JanÂ 18
&lt;tr bgcolor=#E8EEF7&gt;
&lt;td&gt;
&lt;input type=checkbox name=t
value=â€?101480d8ef5dc74aâ€?&gt;
&lt;img src=â€?/gmail/images/star_on_2.gifâ€?
width=15 height=15 border=0 alt=Starred&gt;
&lt;/td&gt;
&lt;td &gt;
Ben Hammersley&lt;/td&gt;
&lt;td &gt;
&lt;a href=â€??th=101480d8ef5dc74a&amp;v=câ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;
Heads
&lt;/font&gt;&lt;/font&gt;
Hereâ€™s a nice message.
&lt;/a&gt;&lt;/td&gt;
...
&lt;tr bgcolor=#E8EEF7&gt;
&lt;td&gt;
Continued
188 Part III â€” Conquering Gmail
Listing 13-2 (continued)
&lt;input type=checkbox name=t
value=â€?101480d8ef5dc74aâ€?&gt;
&lt;img src=â€?/gmail/images/star_on_2.gifâ€?
width=15 height=15 border=0 alt=Starred&gt;
&lt;/td&gt;
&lt;td &gt;
Ben Hammersley&lt;/td&gt;
&lt;td &gt;
&lt;a href=â€??th=101480d8ef5dc74a&amp;v=câ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;
Heads
&lt;/font&gt;&lt;/font&gt;
Hereâ€™s a nice message.
&lt;/a&gt;&lt;/td&gt;
&lt;td nowrap&gt;JanÂ 6
If you look at this code, and know what you already do about the way Gmail
works, itâ€™s easy to deduce the structure of the page. Each line of the Inbox is structured
like this:
&lt;tr bgcolor=#E8EEF7&gt;
&lt;td&gt;&lt;input type=checkbox name=t value=â€?THREAD IDâ€?&gt;
A LINK TO A STAR IMAGE IF THE MESSAGE IS STARRED
&lt;/td&gt;
&lt;td &gt;THE AUTHOR NAME&lt;/td&gt;
&lt;td &gt;&lt;a href=â€?A RELATIVE LINK TO THE PAGE DISPLAYING THE MAILâ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;THE LABEL&lt;/font&gt;&lt;/font&gt;
THE SUBJECT LINE
&lt;/a&gt;&lt;/td&gt;
&lt;td nowrap&gt;THE DATE.
And so, to retrieve your Inbox, you simply retrieve this page, walk through the
code until you get to the correct table, collect every instance of the preceding
structure, and parse out the details. This is what you shall do now.
Parsing the Inbox
Listing 13-3 shows some Perl code that uses HTML::TokeParser to walk through
the HTML-only Inbox page that you saved earlier and print out details of the
messages therein. Note that it loads the page as a text file from the disk, and just
Chapter 13 â€” Building an API from the HTML-Only Version 189
prints the results out to the screen. You will need to save the Inbox source as
â€˜gmailinboxsource.htmlâ€™ and save it in the same directory as this script. Youâ€™ll use
these results in a more meaningful way later.
Listing 13-3: Walking Through the Inbox with HTML::TokeParser</p>

<h4>!/usr/bin/perl</h4>

<p>use warnings;
use strict;
use HTML::TokeParser;
open( FILEIN, â€œgmailinboxsource.htmlâ€? );
undef $/;
my $filecontents = &lt;FILEIN&gt;;
my $stream = HTML::TokeParser-&gt;new( \$filecontents );</p>

<h4>Go to the right part of the page, skipping 8 tables (!!!)</h4>

<p>$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);</p>

<h4>Now we loop through the table, getting the dates and</h4>

<p>locations. We need to stop at the bottom of the table, so we
test for a closing /table tag.
PARSE: while ( my $tag = $stream-&gt;get_tag ) {
my $nexttag = $stream-&gt;get_tag-&gt;[0];
last PARSE if ( $nexttag eq â€˜tableâ€™ );
$stream-&gt;unget_token();
my $input_tag = $stream-&gt;get_tag(â€œinputâ€?);
my $threadid = $input_tag-&gt;[1]{value};
my $starred = $stream-&gt;get_trimmed_text() || â€œNot
Starredâ€?;
Continued
190 Part III â€” Conquering Gmail
Listing 13-3 (continued)
$stream-&gt;get_tag(â€œtdâ€?);
my $sender = $stream-&gt;get_trimmed_text(â€œ/tdâ€?);
$stream-&gt;get_tag(â€œtdâ€?);
$stream-&gt;get_tag(â€œfontâ€?);
$stream-&gt;get_tag(â€œfontâ€?);
my $label = $stream-&gt;get_trimmed_text(â€œ/fontâ€?) || â€œNo
Labelâ€?;
$stream-&gt;get_tag(â€œ/fontâ€?);
my $subject = $stream-&gt;get_trimmed_text(â€œ/tdâ€?);
$stream-&gt;get_tag(â€œtdâ€?);
my $dateline = $stream-&gt;get_trimmed_text();
$dateline =~ s/â€ / /;
print
â€œTHREADID $threadid\nSTARRED $starred \nSENDER $sender\nLABEL
$label \nSUBJECT $subject\nDATE: $dateline \n\n\nâ€?;
}
Running this code on the saved page in Listing A-4 produces the output in
Listing 13-4.
Listing 13-4: The Result of 13-3 on A-4
THREADID 1025a4065d9b40bf
STARRED Not Starred
SENDER Ben Hammersley
LABEL No Label
SUBJECT hello me
DATE: Feb 28
THREADID 10237338e99e7a8c
STARRED Not Starred
SENDER Ben Hammersley
LABEL No Label
SUBJECT This is the subject line
DATE: Feb 21
Chapter 13 â€” Building an API from the HTML-Only Version 191
THREADID 10187696869432e6
STARRED Not Starred
SENDER Ben, me (3)
LABEL No Label
SUBJECT This is the third message
DATE: Jan 18
THREADID 101865b95fc7a35a
STARRED Not Starred
SENDER Ben Hammersley
LABEL No Label
SUBJECT This is the second message
DATE: Jan 18
THREADID 101480d8ef5dc74a
STARRED Starred
SENDER Ben Hammersley
LABEL Heads
SUBJECT Hereâ€™s a nice message.
This is a beautiful result. You can take all of the information out of the Inboxâ€”
the sender, the date, the subject line, and so onâ€”and do something with it programmatically.
You are well on the way to producing your own API.
Now, place that aside for a moment and look at the individual messages. You
know that the individual message is identified by the ThreadID, and you now
know how to identify that. You can also see, by looking at the HTML codeâ€”
repeated here in Listing 13-5â€”that the individual message is retrieved with a
URL constructed like so: <a href="http://gmail.google.com/gmail/h/CACHEBUSTINGSTRING/?">http://gmail.google.com/gmail/h/CACHEBUSTINGSTRING/?</a>
th=THREADID&amp;v=c.
Listing 13-5: The Pertinent Bits of Listing A-4 for Finding
the Individual Message
&lt;base href=â€?http://gmail.google.com/gmail/h/1m0fzst8pmgu0/â€?&gt;
...
&lt;input type=checkbox name=t
value=â€?1025a4065d9b40bfâ€?&gt;
&lt;img src=â€?/gmail/images/cleardot.gifâ€?
Continued
192 Part III â€” Conquering Gmail
Listing 13-5 (continued)
width=15 height=15 border=0 alt=â€?â€?&gt;
&lt;/td&gt;
&lt;td width=30%&gt;
Ben Hammersley&lt;/td&gt;
&lt;td width=68%&gt;
&lt;a href=â€??th=1025a4065d9b40bf&amp;v=câ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;
&lt;/font&gt;&lt;/font&gt;
hello me
&lt;/a&gt;&lt;/td&gt;
&lt;td nowrap width=1%&gt;FebÂ 28
So, you can now work out how to retrieve the message itself. You simply construct
the correct URL, retrieve it, parse the page, and there it is.
Retrieving the Individual Page
There are two types of individual message pages, and youâ€™ll need to work out how
to deal with them in a few paragraphs. In the meantime, jump to Appendix A and
check out Listing A-5, which shows the code for the page depicted in Figure 13-2.
FIGURE 13-2: An individual message page, with only one message
Chapter 13 â€” Building an API from the HTML-Only Version 193
There is a lot going on here. You have the entire message, and all of the associated
metadataâ€”the sender, the date, the subject line, and so forthâ€”and you have a
whole collection of actions to perform on the message, with (joy of joys) a seemingly
easy-to-decipher system of URLs to set them going. Later on in this chapter, you
return to this listing to work on these commands.
Meanwhile, you need to get at the message contents. The technique is exactly the
same as when you looked through the Inbox. Listing 13-6 shows the code that
does this.
Listing 13-6: Code to Parse an Individual Message Page</p>

<h4>!/usr/bin/perl</h4>

<p>use warnings;
use strict;
use HTML::TokeParser;
open( FILEIN, â€œGmail - single message.htmlâ€? );
undef $/;
my $filecontents = &lt;FILEIN&gt;;
my $stream = HTML::TokeParser-&gt;new( \$filecontents );
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œtableâ€?);
$stream-&gt;get_tag(â€œbâ€?);
my $subject = $stream-&gt;get_trimmed_text(â€œ/bâ€?);
$stream-&gt;get_tag(â€œbâ€?);
my $from_true_name = $stream-&gt;get_trimmed_text(â€œ/bâ€?);
$stream-&gt;get_tag(â€œ/fontâ€?);
my $from_email_address = $stream-&gt;get_trimmed_text(â€œ/tdâ€?);
Continued
194 Part III â€” Conquering Gmail
Listing 13-6 (continued)
$stream-&gt;get_tag(â€œtdâ€?);
my $dateline = $stream-&gt;get_trimmed_text(â€œtrâ€?);
$stream-&gt;get_tag(â€œtdâ€?);
my $to_line = $stream-&gt;get_trimmed_text(â€œtrâ€?);
$stream-&gt;get_tag(â€œdivâ€?);
$stream-&gt;get_tag(â€œdivâ€?);
my $message_text = $stream-&gt;get_text(â€œ/divâ€?);
print
â€œ \nSENDER $from_true_name $from_email_address \nSUBJECT
$subject\nDATE: $dateline \nTO: $to_line\nMESSAGE:
$message_text\nâ€?;
Running this scriptâ€”again, as with Listing 13-3, it works on the page saved to
diskâ€”produces the output shown in Figure 13-3.
So this is increasingly useful: You can retrieve the Inbox, find a ThreadID, and
bring down a message if the thread contains only one message. You can then take
that message and grab the information out of it.
FIGURE 13-3: The result of running Listing 13-6
Chapter 13 â€” Building an API from the HTML-Only Version 195
Dealing with Threads
Hereâ€™s the problem, however: Gmailâ€™s individual message page doesnâ€™t show an
individual message. Rather, it shows parts of an entire thread, and the entire message
of the last one in the thread.
However, look at the top right of the individual message page. Thereâ€™s a link to
â€œExpand All.â€? Clicking this link brings you a page that shows all of the content
of all of the messages within that particular ThreadID.To test this, I sent a series
of messages to my Gmail account with the same subject line. Gmail naturally
compiled these messages into a thread. The URL for the default view (the
one displaying the latest message in full, but the previous messagesâ€™ headers
only) was <a href="http://gmail.google.com/gmail/h/o1xhaxisf335/">http://gmail.google.com/gmail/h/o1xhaxisf335/</a>
?th=102f31cbbb3d650f&amp;v=c.
The Expand All viewâ€™s URL was
<a href="http://gmail.google.com/gmail/h/60blkjl9nnjc/">http://gmail.google.com/gmail/h/60blkjl9nnjc/</a>
?d=e&amp;th=102f31cbbb3d650f&amp;v=c.
The addition of the single flag d=e causes Gmail to return all of the information
you need. You already know that the random string in the middle of the URL is a
cache-busting string and can be anything, so you can say that the URL to retrieve
a full message thread is <a href="http://gmail.google.com/gmail/h/RANDOMSTRING/">http://gmail.google.com/gmail/h/RANDOMSTRING/</a>
?d=e&amp;th=THREADID&amp;v=c.
One thing remains to check.What happens if you try this URL with a ThreadID
of a thread with only one message? Will it still work? The answer, which you can
test yourself, is yes. It does. So now you can see how to read the mail in the Inbox.
You just need to make two passes with your scraping code. The first runs through
the Inbox listing, grabbing the ThreadIDs of each message. The second pass takes
that ThreadID and makes it into a URL as described. You then need only to
retrieve that page and scrape it to read the messages.
Dealing with Other Folders
As you may be noticing, working with the HTML-only version of Gmail is much
easier than the JavaScript versionâ€”when it comes to making an API, at least. Itâ€™s
a very steady, almost plodding, discovery of techniques. The next thing to look for,
I think, is how to read messages in the other folders: Starred, Sent Mail, All Mail,
Drafts, and so on.
196 Part III â€” Conquering Gmail
This is a simple matter.When I opened each of these folders, I found these URLS:
 Inbox: <a href="http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?">http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?</a>
 Starred: <a href="http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=r">http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=r</a>
 Sent Mail: <a href="http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=s">http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=s</a>
 Drafts: <a href="http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=d">http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=d</a>
 All Mail: <a href="http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=a">http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=a</a>
 Spam: <a href="http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=m">http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=m</a>
 Trash: <a href="http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=t">http://gmail.google.com/gmail/h/q2fuyjw4p8mu/?s=t</a>
Ignoring the random seed again, you can see that the s= attribute sets the folder
to view. Setting it to anything else but the preceding options returns an error,
except, happily setting it to s=i, which gives you the Inbox.
So, to retrieve the mail from another folder, you simply form the URL as in the
preceding list, send it to the scraping script you wrote earlier in this chapter, and
proceed from there.
And Now . . .
So, you now have the basic techniques down for interacting with the HTML-only
version of Gmail. You now know how to scrape the pages, and you now know how
to find and, in theory, gather information from, all of the messages. In the next
chapter, you learn how to export your mail, whether for re-import into another
application or to back it up. As good as Gmail is, always being able to leave is
sometimes a good excuse to stay.
Exporting Your Mail
The hallmark of a truly great web application is the ease with
which you can remove your data should you want to leave.
In the words of the poet, if you love someone set them free.
Sadly, Gmail doesnâ€™t make it easy to get your mail out of there.
Thereâ€™s no built-in facility to do so at all, at least at the time of
this writing. Of course, many would say that Gmail is so shiny
that youâ€™d be mad to stop using it. Maybe so, but in this chapter
you look at how to do that anyway.
Exporting as a Massive Text File
The first way to export your mail, and the simplest, is to dump
the lot to a big text fileâ€”illustrated in Listing 14-1. Itâ€™s not very
useful for re-importing your mail into another application, but it
is good for backups of data that youâ€™d like on paper, for example.
Listing 14-1: Export All Mail to a Text File
use Utils;
$gmail = login();
$messages = $gmail-&gt;get_messages();
open OUTPUT, â€œ&gt;mailarchive.txtâ€?;
foreach (@{$messages}) {
my $full_message = $gmail-&gt;get_indv_email(msg =&gt;
$message);
....print OUTPUT â€œSender: â€œ . $full_message-</p>

<blockquote>
  <p>{$id}-&gt;{â€œsender_emailâ€?} . â€œ\nâ€?;
  Continued
  Ë› Converting to a
  big text file
  Ë› Converting to
  Mbox
  Ë› Appending to IMAP
  chapter
  in this chapter
  198 Part III â€” Conquering Gmail
  Listing 14-1 (continued)
  ....print OUTPUT â€œSent: â€œ . $full_message-&gt;{$id}-&gt;{â€œsentâ€?}
  . â€œ\nâ€?;
  ....print OUTPUT â€œSubject: â€œ . strip_bold($full_message-
  {$id}-&gt;{â€œsubjectâ€?}) . â€œ\n\nâ€?;
  ....print OUTPUT $full_message-&gt;{$id}-&gt;{â€œbodyâ€?} . â€œ\n\n----
  \nâ€?;
  }
  close OUTPUT;
  Running the script produces a file in the directory the script is run from called
  mailarchive.txt. It will look rather like this:
  Sender: <a href="mailto:bobette@example.com">bobette@example.com</a>
  Sent: 12:01pm
  Subject: This is a mail
  You are a very sexy man.
  Love</p>
  
  <h5>Bob x</h5>
</blockquote>

<p>Sender: <a href="mailto:bobette@example.com">bobette@example.com</a>
Sent: 11:23pm
Subject: Terrible confession
Iâ€™ve lost my wristwatch. Have you seen it?
Puzzled</p>

<h5>Bob x</h5>

<p>And so on. Very nice for printing or storing on a keychain flash drive in case of
some form of dreadful server failure at the Google farm. Of course, flippancy aside,
it is nice to have a printout of a series of mails. As you know from previous chapters
how to select mails from specific labels, you can use a variation of Listing 14-1
to provide backups of mail specific to certain projects, or subjects, or whatever you
like. That is very useful, depending on your own personal work style.
Chapter 14 â€” Exporting Your Mail 199
Converting to Mbox
Much more useful, converting to the Mbox format allows your Gmail to be
imported into most popular e-mail applications. Listing 14-2 converts your Gmail
Inbox into an Mbox-compatible file. It needs two modules, in addition to the
Utils.pm module youâ€™ve been using for this section of the book (that, if youâ€™ve forgotten,
is found in Listing 7-4):
 Mail::Internet: Available from <a href="http://search.cpan.org/%7Emarkov/">http://search.cpan.org/~markov/</a>
 Mail::Folder::Mbox: Available from <a href="http://search.cpan.org/">http://search.cpan.org/</a>
~kjohnson
Listing 14-2: Convert to Mbox
use Utils;
use Mail::Internet;
use Mail::Folder::Mbox;
$gmail = login();
$inbox = new Mail::Folder(â€˜mboxâ€™);
$inbox-&gt;create(â€˜inboxâ€™);
$inbox-&gt;open(â€˜inboxâ€™);
$messages =
$gmail-&gt;get_messages( label =&gt;
$Mail::Webmail::Gmail::FOLDERS{â€œINBOXâ€?} )
; # simply get all messages from INBOX
foreach ( @{$messages} ) { # and iterate through them
$message = $gmail-&gt;get_mime_email( msg =&gt; $_ ); #
retrive MIME message
@message_lines = split( /\n/, $message ); # split
it into lines
map { $_ .= â€œ\nâ€? } @message_lines; # prevent joining of
lines in the body
$message_inet =
new Mail::Internet( \@message_lines )
; # construct RFC822
compilant message
$inbox-&gt;append_message($message_inet); # and append it
into mbox
Continued
200 Part III â€” Conquering Gmail
Listing 14-2 (continued)
}
$inbox-&gt;sync();
$inbox-&gt;close();
Running the script, as ever, produces an mbox file in the directory in which it is
run. This one is called â€œinboxâ€? and will contain the contents of your Gmail Inbox.
From the previous chapters, it should be easy to see how to vary this script to
deal with mail in the archive or with a specific label.
Apple Mail.app, Thunderbird, and Entorage and Eudora can all deal with
importing Mbox files directly. Outlook, however, cannot. It requires an .idx file for
each folder, which contains an index of the mails within. Itâ€™s easy to produce one
of these, however: Simply grab a copy of Eudora from <a href="http://eudora.com/">http://eudora.com/</a>
products/eudora/download/ and import into there. Then rename the folder
in Eudora (and rename it back again if you like) to force it to produce an .idx file.
Then you can export from Eudora, and the .idx file that Outlook needs will be
there. A bit fiddly, yes, but thatâ€™s what you get for using Outlook.
Appending to IMAP
The Internet Message Access Protocol, or IMAP, is by far the best protocol for
accessing e-mails from a desktop client. Unlike POP3, IMAP allows you to keep
your mail on a serverâ€”folders, sub-folders and allâ€”and access it from multiple
clients and devices. This means that you can, for example, have your mail synchronized
between your home and work desktop machines, your laptop, and your
phone. (Of course, Gmail does that too, without all the messing around, but whoâ€™s
quibbling at this point?)
It can be very useful to dump your Inbox into an IMAP account, and thatâ€™s what
Listing 14-3 does.
Chapter 14 â€” Exporting Your Mail 201
Listing 14-3: Appending to IMAP
use Utils;
use Net::IMAP;
$gmail = login();
$imap = new Net::IMAP( â€œIMAP SERVER ADDRESSâ€?, Debug =&gt; 1 );
$imap-&gt;login( â€œUSERNAMEâ€?, â€œPASSWORDâ€? );
$messages =
$gmail-&gt;get_messages( label =&gt;
$Mail::Webmail::Gmail::FOLDERS{â€œINBOXâ€?} )
; # simply get all messages from INBOX
foreach ( @{$messages} ) { # and iterate through them
$message = $gmail-&gt;get_mime_email( msg =&gt; $_ ); #
retrive MIME message
$imap-&gt;append( â€œINBOXâ€?, $message ); # and append it to
the IMAP INBOX
}
$imap-&gt;logout();
By now, as you come to the end of this book, you should be confident in dealing
with mail within the archive and under different labels. I leave it to you as an
exercise, therefore, to move labeled mail into the IMAP folders.
And Now . . .
For the final chapter of the book, youâ€™re going to look at the different applications
that have already been written using the techniques youâ€™ve learned in this section.</p>

<p>Using Gmail to . . .
Gmailâ€™s popularity, enormous storage, search capability, and
labels mean that many people have been hacking new
uses for the application. This chapter, then, looks at some
of the more unusual uses that people are putting the system to.
Using Gmail as a To-Do List
Around the same time as Gmail was launched, the tech world
spawned a fashion for being really, really organized.To-do lists
are a stylish accessory for any self-respecting geek, and, of course,
Gmail can be fashioned into a fine tool for such things.
Using Filters
The first way of making to-do lists is to use plus addresses
and filters. The plus address feature, as youâ€™ll remember from
Chapter 3, is the one where you can add a plus sign (+) and then
any string to your Gmail address without it making any difference.
For example, <a href="mailto:Ben.Hammersley+fanmail@gmail.com">Ben.Hammersley+fanmail@gmail.com</a> is exactly
the same as <a href="mailto:Ben.Hammersley@gmail.com">Ben.Hammersley@gmail.com</a> or Ben.Hammersley+
<a href="mailto:hatemail@gmail.com">hatemail@gmail.com</a> or Ben.Hammersley+dinner_
<a href="mailto:invitations@gmail.com">invitations@gmail.com</a> or whatever. Theyâ€™ll all be delivered to
my address, no matter what you put after the plus sign.
However, you can set filters on the address, and push specific ones
into specific labels. Figure 15-1 shows a filter set up to do just
that, sending <a href="mailto:ben.hammersley+todo@gmail.com">ben.hammersley+todo@gmail.com</a> to the label
â€œTodoâ€?.
Ë› To-do lists
Ë› Bittorrent
Ë› And much more . . .
chapter
in this chapter
204 Part III â€” Conquering Gmail
FIGURE 15-1: Setting a filter for a to-do list
Whatâ€™s the point of that? Well, itâ€™s easy to send e-mail, whether youâ€™re sat at your
main machine or using a mobile deviceâ€”and so you can send new to-do list items
to your Gmail account with a few simple keystrokes. Place the to-do item itself in
the subject line, and you can have a screen very much like Figure 15-2â€”showing
the â€œTodoâ€? label index, now passing muster as a very useful to-do list in itself.
FIGURE 15-2: The Todo label listing
Chapter 15 â€” Using Gmail to . . . 205
Using gmtodo
Gnome desktop users neednâ€™t go crazy with the preceding technique when they
have a complete to-do list application to use: gmtodo, from <a href="http://gmtodo">http://gmtodo</a>
.sourceforge.net/.
Paul Millerâ€™s application is written in Python, and hence uses Libgmail. It also
requires Pygtk, but most Linux distributions have that as standard. If you donâ€™t,
youâ€™ll get an error message, and will have to download it from <a href="http://www.pygtk.org">www.pygtk.org</a>.
Once youâ€™ve done that, or just gone ahead and unarchived the application, you run
it from the command line with a judicious python gmtodo.py.
gmtodo works in exactly the same way as the plus address method, only giving it a
nice GUI. The one thing you should know is that your Gmail username and password
are stored in plain text in a file called .gmtodo in your home directory. If you
consider that an unnecessary security risk, youâ€™ve been warned.
Using Gmail to Find Information in RSS Feeds
If youâ€™re like me, you probably spend the first 37 hours or so of your working week
trolling through your newsreader, in search of blog-borne snippets of wisdom and
genius. Fifteen thousand blog posts about cats and new Apple rumors later, and
youâ€™re none the wiser. But, still, somewhere back there, half an hour ago, there
might have been something vaguely interesting. If only you could remember
what it was.
Gmail, obviously, can help. By using an RSS to E-mail service, and the plus
address technique discussed earlier in the chapter, you can use Gmail to store your
RSS feeds, ready for the searching thereof.To do this, I like to use the free service
at <a href="http://www.rssfwd.com">www.rssfwd.com</a>, as shown in Figure 15-3.
By subscribing to the feeds I like to read and then setting up a plus addressâ€™nâ€™label
combo as you did in the previous section, I know that I will always have an archive
of all of the old feeds Iâ€™ve read. I donâ€™t actually use Gmail as my newsreaderâ€”
although I could, I guessâ€”because I prefer my desktop client for that. But as a
store and search system, itâ€™s perfect.
206 Part III â€” Conquering Gmail
FIGURE 15-3: A screenshot of <a href="http://rssfwd.com">rssfwd.com</a>
Using Gmail to Find Torrent Files
The technique used above, to filter RSS feeds into labels, can also be used to
search for torrent files from your favorite Bittorrent tracker site. These sites invariably
have RSS feeds of their latest offerings, but the feeds are far too fast moving,
and far too full of rubbish, to be worth reading manually. Instead, forward them to
Gmail in the same manner you would forward your RSS feeds, and use Gmailâ€™s
search capability to find the ones you want. If youâ€™re looking for a torrent for a
particular show but donâ€™t want to have to keep going back to Gmail to check, have
a filter forward it to another e-mail address, as in Figure 15-4.
Chapter 15 â€” Using Gmail to . . . 207
FIGURE 15-4: Not that youâ€™ll have anything to do with this naughty activity
Using Gmail as a Notepad
Jonathan Aquino, a blogger from British Columbia, called Gmail the Notepad of
the web. â€œToday,â€? he said at <a href="http://jonaquino.blogspot.com/2005/03/">http://jonaquino.blogspot.com/2005/03/</a>
gmail-as-notepad-of-web.html, â€œI realized that Gmailâ€™s latest features make
it an excellent replacement for Notepad and other basic desktop text editors. (Use
its Save Draft feature so that you can edit your text whenever you want.)â€?
Itâ€™s certainly a worthwhile insight making. Indeed, as he went on to say, Gmail has
a number of advantages over Notepad or any other ordinary text editors. Gmail,
he said, beats Notepad with the following:
 Filename is optional. No need to think of a unique filename to save underâ€”
just enter your content and go.
 Search all your past files at once.Try that, Notepad!
 Spell-checking on demand.
208 Part III â€” Conquering Gmail
 Load/save your text files from any computer in the world.
 Cross-platformâ€”you can access it from any make or model of machine, as
long as you can get online with a web browser.
 Undo Discard. Ever wish you could retrieve your file after closing it without
saving? Now you can.
This technique works pretty wellâ€”and now that Gmail has rich-text editing
capabilities, it has become even more powerful. Because you might be using
the Drafts folder for things other than stored notes, you might want to assign the
mail a label. Figure 15-5 shows my Drafts folder with three notes within. Iâ€™ve
labeled two.
Imaginative readersâ€”thatâ€™s all of youâ€”will have spotted that you can easily
write a script to keep your Gmail-held notes copied to your local machine. I leave
that as an exercise to the newly enlightened reader.
FIGURE 15-5: Using Gmail as a notepad application
Chapter 15 â€” Using Gmail to . . . 209
Using Gmail as a Spam Filter
If thereâ€™s one thing Gmail knows, itâ€™s spam. Hosting millions of e-mail addresses
means millions of spam messages arrive every dayâ€”and Google must unleash their
minions in the never-ending battle to stop that stuff from getting into your Inbox.
So, Gmailâ€™s spam filters are really good, and with a little bit of cunning technique,
you can use the system to filter all of your mail, and not just Gmail.
You can do this because Gmail allows you to forward messages. This is a little bit
complicated, so bear with me. Hereâ€™s what to do:
Go to the Settings page, click the Forwarding tab, and set Gmail to forward all
messages to your non-Gmail account (from now on referred to as <a href="http://example.com">example.com</a>).
Once youâ€™ve done that, all messages to <a href="http://gmail.com">gmail.com</a> will go to <a href="http://example.com">example.com</a>, except
for the spam, which will be filtered.
Now, go to your <a href="http://example.com">example.com</a> mail server and create a filter to check the headers
of any incoming e-mail. Have it forward to your Gmail account if it does not find
the following in the header:
X-Forwarded-For: <a href="mailto:user@gmail.com">user@gmail.com</a> <a href="mailto:user@example.com">user@example.com</a>
There are many ways to do this, and youâ€™d be wise to ask your system administrator
to advise you on it. For really advanced users, a procmail filter to do this looks
like this (with your Gmail account and real mail server replacing
<a href="mailto:user@gmail.com">user@gmail.com</a> and <a href="mailto:user@example.com">user@example.com</a> in the obvious places):
:0
* !^X-Forwarded-For: <a href="mailto:user@gmail.com">user@gmail.com</a> <a href="mailto:user@example.com">user@example.com</a>
! <a href="mailto:user@gmail.com">user@gmail.com</a>
When this is set up, your server sends all the mail that Gmail hasnâ€™t seen to
Gmail. Gmail filters it for spam, and then passes it back, having added in the
header. The filter ignores all the messages with the X-Forwarded-For header,
and so all you see in your <a href="http://example.com">example.com</a> account is beautifully filtered mail.
This technique also has the advantage of saving a copy of all of your mail within
Gmail, which is handy for backups. And remember, if you use Gmail as your
SMTP server, too, all your outgoing mail will be saved also.
210 Part III â€” Conquering Gmail
An Even Simpler Way of Doing It
There is, naturally, an even easier way to do this. Justin Blanton, this tomeâ€™s noble
technical editor, points out that if you canâ€™t set server-side filters but can create
multiple mail accounts, you can do the following:
1. Create a new mail account (the username doesnâ€™t matter; no one will see it).
2. Forward the e-mail from your current account to Gmail.
3. Forward your Gmail e-mail to the account you just created.
4. Gmail filters your e-mail before forwarding it along.
5. Use your new mail account (youâ€™ll obviously want to set the â€œreply-toâ€? and
â€œfromâ€? fields to your current address and not the one you just created).
This is very elegant but does require multiple e-mail accounts.
Using Gmail as Storage for a Photo Gallery
As something as a transition to the final chapter, this use of Gmail is borderline
naughty. Indeed, at the time of this writing, Google has taken the authorâ€™s Gmail
account away from him, so fiendish is his wares. Still, he fears nothing here in
Chapter 14 and so will happily point to Goollery, the PHP system for using
Gmail as the storage for an online photo gallery.
Figure 15-6 shows it in action on the demo site. You can download Goollery from
<a href="http://www.wirzm.ch/goollery/">www.wirzm.ch/goollery/</a>.
The authors, Martin Wirz, Andres Villegas, and Matias Daniel Medina, have
done a very nice job with Goollery. Itâ€™s easy to use, requiring only PHP, curl, and
ImageMagick to be installed on your server to begin with. (These are all pretty
standard, and your system administrator can help you.)
Once thatâ€™s done, you must create a label within your Gmail account called â€œpicturesâ€?
and then follow the rest of the installation instructions included within the
Goollery package.
Goollery uses PHP, and so libgmail, to access Gmail. In the next chapter, you see
precisely how this works.
Chapter 15 â€” Using Gmail to . . . 211
FIGURE 15-6: Goollery in action
And Now . . .
I hope that this chapter has shown you some of the interesting things you can do
when you have an almost limitless amount of storage space, some cunning filters,
or a bit of imagination.
To finish up the book, youâ€™re going to look at perhaps the most extreme use of
Gmailâ€”using the webmail application as a mountable file system.</p>

<p>Using GmailFS
Very early on in the life of the Gmail beta program, Richard
Jones out-geeked everyone with the release of version 0.1
of the GmailFSâ€”a mountable file system for Linux
machines that uses Gmail as the storage mechanism. This chapter
examines GmailFS and discusses how it works and how to use it.
The Underlying Idea
The shocking thing about Gmail, apart from the cleverness of the
asynchronous JavaScript and XML interface, is the amount of
storage available to the user. A gigabyte is a lot of space for mail,
especially when it is free. Itâ€™s so much space, indeed, that the second
question on a lot of peopleâ€™s lips (after â€œHow do they do
thatâ€? had been answered) was, â€œWhat can you do to fill it up?â€?
The answer, Richard Jones decided, was to use Gmail as the storage
for a file system. One gigabyte is a nice size for an emergency
backup, or to share files between friends. It is, after all, 200 or so
good-sized MP3 filesâ€”legally downloaded, of course.
Installing GmailFS
GmailFS works on Linux machines only. For Windows machines,
the equivalent program is GmailDrive.
The Correct Python
First, you need to make sure you have Python 2.3 installed. Python
will probably have come pre-installed with your OS, but you need
to make sure it is version 2.3 or above. There are many tests for
this, depending on your system.
Ë› Installing GmailFS
Ë› Using Gmail FS
Ë› How GmailFS works
chapter
in this chapter
214 Part III â€” Conquering Gmail
If you are using an RPM-based distributionâ€”Red Hat, Mandrake, or SuSE, for
exampleâ€”you can get a packageâ€™s version number by using rpm. Open a terminal
window, and type the following command:
rpm -q python
This should give a result similar to the following:
python-2.3.0
If the version number is too low, you should download the update from
<a href="http://python.org/download/">http://python.org/download/</a> and follow the instructions there.
If youâ€™re running a DEB-based distributionâ€”Debian or Knoppix, for exampleâ€”
use apt-cache by opening a terminal and typing the following:
apt-cache show python
Again, this should give a message showing the version number. Go to <a href="http://">http://</a>
python.org/download/ if the number is below 2.3.
If youâ€™re not using DEB or RPM, then you need to ask for the version number
from Python directly. Again, open the terminal window, and type python.
Figure 16-1 shows the result.
FIGURE 16-1: Python showing and telling
(This screenshot, the cunning amongst you will have noticed, was done on
an Apple, not a Linux box. For the sake of the Python version, this makes no
difference.)
To exit Python, you have to press Ctrl+D.
Chapter 16 â€” Using GmailFS 215
Installing FUSE
The majority of the cleverness that makes up the GmailFS package comes from
the FUSE library from <a href="http://fuse.sourceforge.net/">http://fuse.sourceforge.net/</a>.
Standing for File System in Userspace, FUSE is a package that allows programs
to implement their own fully functional file system. Your version of Linux may
have it already installedâ€”Debian does, for exampleâ€”but if not you can download
it from <a href="http://fuse.sourceforge.net/">http://fuse.sourceforge.net/</a>.
The GmailFS package was developed to work with version 1.3 of FUSE, which is
quite an old version. It is still available for download, however. Later versions of
FUSE may well work, too; itâ€™s worth experimenting.
You also need to install the FUSE Python bindings from <a href="http://cvs.source">http://cvs.source</a>
forge.net/viewcvs.py/fuse/.
Once you have downloaded these packages, you just need to unpack them and follow
the instructions within.
Installing Libgmail
The final tool you need before installing GmailFS is Libgmail. Youâ€™ve met this
many times before in earlier chapters. You can get the latest version from
<a href="http://libgmail.sourceforge.net/">http://libgmail.sourceforge.net/</a>. Remember to download the very latest
version from the CVS section of that site.
Installing GmailFS
Finally you are ready to install GmailFS. Download version 0.3 from
<a href="http://richard.jones.name/google-hacks/gmail-filesystem/">http://richard.jones.name/google-hacks/gmail-filesystem/</a>
gmailfs-0.3.tar.gz, unpack it, and copy gmailfs.py to /usr/local/bin.
After doing that, copy mount.gmailfs to /sbin.
Finally, the distribution contains a configuration file called gmailfs.conf. It
looks like Listing 16-1.
Listing 16-1: gmailfs.conf
[connection]</p>

<h4>proxy = <a href="http://user:pass%40proxyhost:port">http://user:pass@proxyhost:port</a></h4>

<h4>or just</h4>

<p>Continued
216 Part III â€” Conquering Gmail
Listing 16-1 (continued)</p>

<h4>proxy = <a href="http://proxyhost:port">http://proxyhost:port</a></h4>

<h4>retries = 3</h4>

<p>[account]
username = gmailusername
password = gmailpassword
[filesystem]
fsname = linux_fs_3
[references]</p>

<h4>reference = filesystem:username:password</h4>

<p>[logs]</p>

<h4>Change this to DEBUG for verbose output useful for debugging</h4>

<p>level = INFO
Simply place your username and password in the obvious places, and copy the
entire file to /etc.
If you are behind a proxy, you will need to enter the details into gmailfs.conf in
the obvious place and also install pyOpenSSL from <a href="http://pyOpenSSL.source">http://pyOpenSSL.source</a>
forge.net/, and pyOpenSSLProxy from <a href="http://richard.jones.name/">http://richard.jones.name/</a>
google-hacks/gmail-filesystem/pyOpenSSLProxy-0.1.tar.gz.
Once everything is installed, you are ready to use the system.
Using GmailFS
There are two ways to launch the GmailFS: You can either mount it from the
command line or use fstab.
Mounting GmailFS from the Command Line
To mount from the command line, type this command, press return, and proceed
to the section â€œPassing Commands to the File Systemâ€? a bit later:
mount -t gmailfs /usr/local/bin/gmailfs.py /gmailfs -o
fsname=XXXXX
Chapter 16 â€” Using GmailFS 217
Replace the XXXXX with a hard-to-guess string. This string, the name of the file
system, must be weird and difficult to guess, because (as you will see) people can
corrupt the system by sending you mail with that name in the subject line.
Mounting GmailFS from fstab
Linux machines have a file called /etc/fstab, which contains the details of all of
the drives and partitions the system can see. You can add GmailFS to the fstab
file to make the drive a permanent addition to your system.
To use fstab, place an entry inside /etc/fstab that looks like this:
/usr/local/bin/gmailfs.py /gmailfs gmailfs noauto,
fsname=XXXXX
Again, replace the XXXXX with the name you wish to give the file system. You will
probably need root access to add things to the fstab file. Once the line has been
added, reboot the machine.
Passing Commands to the File System
With the commands passed in the previous section, you now have a file system
mounted at /gmailfs. So, from the command line you can use cd /gmailfs
and then use any of the normal shell commands: ls, mkdir, rm, and so on. For
all intents and purposes, the GmailFS is just the same as if it were a 1 gigabyte
hard disk.
Copying files to and from a GmailFS directory is pretty quick, depending of
course on the speed of your Internet connection, but running ls to get a directory
listing takes a very long time if you have lots of mail.To understand why, take a
look at how GmailFS works.
Using Multiple GmailFS Drives
Because you are giving the GmailFS system a specific, hard-to-guess name, denoted in the command
line by the fsname= parameter, you are actually able to run more than one file system
from the same Gmail account. You can mount as many as you like, as long as each one has a
different name.
218 Part III â€” Conquering Gmail
How GmailFS Works
GmailFS works with four parts: FUSE, which provides the interface to the Linux
kernel that allows additional file systems to be created by programs (in what is
technically known as userspace); Libgmail, which provides the interface to Gmail;
Gmail, which provides the storage; and GmailFS itself, which links the three others
together.
The part of the system where FUSE talks with the Linux kernel is beyond the
scope of this book, and is well documented on the web. And by now you should
be confident with sending and receiving mail with Libgmail. So all you need to
understand is how the files are stored on Gmail.
What Makes Up a File?
To really understand the system, you need to know how a general UNIX file system
identifies a file. Under an ordinary Unix file system, a file consists of three
things: the content of the file itself; a file called an inode, which contains the
details of the file; and a pointer to the inode inside another file that represents a
directory.
This is perhaps a little confusing, so consider an example. Say you want to access a
file called supersecretpasswords.txt.To display the contents of the file you
would ordinarily use the command cat supersecretpasswords.txt. You can
see this in Figure 16-2.
FIGURE 16-2: Displaying the contents of a file
Chapter 16 â€” Using GmailFS 219
For the cat command to access the file, the operating system first opens the file
that represents the directory.Within that is a list of filenames, each with a corresponding
name of an inode file.
The operating system then opens the inode, and it is the inode that tells the operating
system where the file is on the disk and all of the rest of the data about the
file. This metadata is quite extensive and contains the following information:
 The location of the itemâ€™s contents on the disk
 What the item is (such as a file, directory, or symbolic link)
 The itemâ€™s size, in bytes
 The time the fileâ€™s inode was last modifiedâ€”also called the ctime
 The time the fileâ€™s contents were last modifiedâ€”the mtime
 The time the file was last accessedâ€”the atime
 The number of names the file hasâ€”hard links
 The fileâ€™s ownerâ€”the UID
 The fileâ€™s groupâ€”the GID
 The fileâ€™s permissionsâ€”for example, 755
Because the fileâ€™s contents, the inode, and the pointer to it from the directory are
all separate, a single file can have many names. Each name is called a hard link.
Deleting a link doesnâ€™t delete the file or the inode itself, only the link, as there may
be other links pointing to the inode, and hence to the contents of the file.When a
file has no hard links left, the kernel will count it as deleted and allow it to be
physically overwritten on the disk itself.
So, so far you have two types of file that dictate the file system: the directory file,
which matches the filename to the inode, and the inode, which matches lots of
metadata to a block of data on the disk.
The third part of the file system, then, is the physical block on the disk. For most
file systems, this is indeed a physical address, but as different types of storage have
different ways of addressing their own bits (pun intended), this section, too, can
be abstracted away into a file.
So, you have the directory pointing to the inode, the inode pointing to the datablock,
and the datablock pointing to the actual dataâ€”and then, as shown in
Figure 16-2, the data pointing to world domination. Excellent.
220 Part III â€” Conquering Gmail
Representing All of This in E-Mail
But lest you forget, youâ€™re trying to represent all of this data in e-mail messages
and not a proper storage medium. The translation between the two is the job of
FUSE and GmailFS.Together, they handle the requests from the operating system
for the data inside the directories, the inodes, and then the datablocks, and
feed it back in the manner that the kernel expects.
To do that, GmailFS needs to store all of these different types of data within the
framework that e-mail provides. Think on this:What is the framework available
for data within e-mail?
Itâ€™s easy, actually. You can use the subject line, the body of the message itself, and
any number of attachments. That is how GmailFS works.
The Actual Data in Action
GmailFS just uses the subject line and the attachments. Nothing is held in the
message body itself. There are three types of messages used.
 Directory and file entry messages: These hold the parent path and name of
a file or a directory. The subject of these messages has a reference to the fileâ€™s
or directoryâ€™s inode.
 Inode messages: The subject line of these messages holds the information
found in an inode.
 Datablock messages: These messages hold the fileâ€™s data in attachments.
The subject of the messages holding these structures contains a reference to
the fileâ€™s inode as well as the current block number. Because Gmail has a size
limit of 5MB for attachments, this message may contain more than one
attachment.
So, now when you run the cat supersecretpasswords.txt command on a file
within the GmailFS system, FUSE and the GmailFS script first use Libgmail to
request the corresponding file entry message. This command points them to the
inode message, which then points them to the datablock message and the data
you need.
As previously mentioned in a sidebar, each of the messagesâ€™ subject lines contains
the file system name. This allows you to use more than one file system off the
same Gmail account, and also provides some security. The security comes from
the way that GmailFS adds data to itselfâ€”by sending mail to itself.Without the
hard-to-guess file system name, it would be possible for an outside party to send
messages to the account that added data to the file system.
Chapter 16 â€” Using GmailFS 221
And Now . . .
And so, the end is near. In this chapter, youâ€™ve looked at how file systems work,
and how Gmail can be used as such. Doing so allows you to host large amounts
of files and applications â€œout thereâ€? on the Internet, with only the tiny GmailFS
application needed to access it. You can, for example, carry the GmailFS application
around on a so-cheap-itâ€™s-free thumbdrive and then have gigabytes of data
waiting on Gmail accounts. You can even, if youâ€™re feeling very, very, very geeky,
save a browser to a GmailFS drive, and check your Gmail via the browser hosting
on the same account. Ah, itâ€™s all too much for me, and so, with that, we come to
the end.</p>

<p>Long Code Listings
This book contains a lot of code. You love it really, but the
designers do not. So to make the book more readable I
moved all the long bits of code to this appendix. Enjoy!
Chapter 4
Listing A-1: The HTML That Displays the Inbox
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META http-equiv=â€?content-typeâ€?
content=â€?text/html; charset=UTF-8â€?/&gt;
&lt;SCRIPT&gt;
D=(top.js&amp;&amp;top.js.init)?function(d){top.
js.P(window,d)}:function(){};if(window==top){top
.location=â€™/gmail?search=inbox&amp;view=tl&amp;s
tart=0&amp;init=1&amp;zx=3177c401850460908955817
35&amp;fs=1â€™;} &lt;/SCRIPT&gt;
&lt;SCRIPT&gt;
&lt;!--
D(["v","3177c40185046090"]
);
<a href="mailto:D(%5B%22ud%22,%22ben.hammersley@gmail.com">D(["ud","ben.hammersley@gmail.com</a>
","{\"o\":\"OPEN\"
,\"/\":\"SEARCH\",\"\r
\":\"OPEN\",\"k\":\&amp;quo
t;PREV\",\"r\":\"REPLY\&amp;quot
;,\"c\":\"COMPOSE\",\"g
c\":\"GO_CONTACTS\",\"gd\&amp;qu
ot;:\"GO_DRAFTS\",\"p\":\&amp;qu
ot;PREVMSG\",\"gi\":\"GO_INB
OX\",\"a\":\"REPLYALL\"
,\"!\":\"SPAM\",\"f\&amp;qu
ot;:\"FORWARD\",\"u\":\&amp;quot
;BACK\"
Continued
Ë› Long code listings
Ë› More long code
listings
appendix
in this appendix
224 Appendix â€” Long Code Listings
Listing A-1 (continued)
,\"ga\":\"GO_ALL\",\"j\":\"
NEXT\",\"y\":\"REMOVE\",\"n\&amp;quo
t;:\"NEXTMSG\",\"gs\":\"GO_STARRED\&amp;q
uot;,\"x\":\"SELECT\",\"s\":\&amp;qu
ot;STAR\"}"]
);
D(["p",["sx_em",""]
,["sx_at","archive"]
,["bx_show0","1"]
]
);
D(["ppd",0]
);
D(["i",4]
);
D(["qu","0 MB","1000
MB","0%","#006633"]
);
D(["ft","Use the \&lt;span
style=\"color:#0000CC;textdecoration:
underline;cursor:pointer;cursor:hand;white-space:no
wrap\" id=\"fsb\"\&gt;search\&lt;/span\&gt; box
or \&lt;span style=\"color:#0000CC;textdecoration:
underline;cursor:pointer;cursor:hand;white-space:no
wrap\" id=\"mt_adv\"\&gt;search
options\&lt;/span\&gt; to find messages quickly!"]
);
D(["ds",1,0,0,0,0,0,0]
);
D(["ct",[]
]
);
D(["ts",0,50,1,0,"Inbox","100ae7248b9
",1,[]
]
);
D(["t",["100adb8b86f18e51",1,0,"\&lt;
b\&gt;2:29pm\&lt;/b\&gt;","\&lt;span
id=\â€™_user_ben@benhammersley.com\â€™\&gt;\&lt;b\&gt;Ben
Hammersley\&lt;/b\&gt;\&lt;/span\&gt;
(2)","\&lt;b\&gt;&amp;raquo;\&lt;/b\&gt;&amp;nbsp;&amp;q
uot;,"\&lt;b\&gt;Skinning Gmail? That\â€™s so
cool!\&lt;/b\&gt;","BEGIN PGP SIGNED MESSAGE-- Hash:
SHA1 la la la --BEGIN PGP SIGNATURE-- Version: GnuPG v1
&amp;hellip;",[]
,"","100adb8b86f18e51",0]
Appendix â€” Long Code Listings 225
]
);
D(["te"]);
//--&gt; &lt;/SCRIPT&gt;
&lt;STYLE&gt;
body {background:#fff;margin:1ex}body,td,input,textarea,select
{font-family:arial,sans-serif}input,textarea,select {fontsize:
100%}form {margin:0;width:100%}select {width:20ex}.b
{font-weight:bold}.r {text-align:right}.c {textalign:
center}img {border:0}.s {font-size:80%}.xs
{font-size:70%}.sxs {font-size:87%}.lk {color:#0000CC;textdecoration:
underline;cursor:pointer;cursor:hand;white-space:no
wrap}.l {color:#0000CC;cursor:pointer;cursor:hand;whitespace:
nowrap}.lc {color:#0000CC}.urlc {color:#006633}.g
{color:#444}.h {cursor:pointer;cursor:hand}.ilc {textdecoration:
underline;cursor:pointer;cursor:hand;white-space:no
wrap;font-weight:bold}.nfc {color:#AA0000;font-weight:bold}.gr
{color:#006633}.ab {font-size:85%;verticalalign:
middle;padding:0 10 0 10}.ct
{color:#006633;font-size:80%}.mh {font-size:80%}.mh div
{padding-bottom:4}.asl {font-weight:bold;textalign:
right;vertical-align:top;padding-top:4px;width:1%}.asbu
{font-size:80%}.nt table {background:#FAD163;fontsize:
80%;font-weight:bold;white-space:nowrap}.nm {padding:0 15
1}.phd {padding:6 0 10}.phd table {background:#FAD163;fontweight:
bold;margin:auto;font-size:80%}.ph {padding:7 12}.nl
{font-size:80%;white-space:nowrap;padding:2 0 2 8}.cv {fontsize:
80%;width:100%}.nb
{width:100%;background:white;table-layout:fixed}.nb div
{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.cs
{color:#063}.rv {color:#00c}.cs, .rv {font-size:70%;padding:0
2 2 2;width:100%;text-overflow:ellipsis}.th td {fontsize:
80%;}.tlc
{table-layout:fixed;cursor:pointer;cursor:hand}.tlc col {fontsize:
80%}.tlc td {border-bottom:1px #bbb
solid;font-size:80%;empty-cells:show}.cti {padding:20;}.ctn
{margin:10;font-size:110%;font-weight:bold}#cbs, #cts {textalign:
left;padding-left:20px;white-space:nowrap}#cit
{width:1%;font-size:80%;white-space:nowrap}.ctlf {paddingleft:
3em;width:1%;text-align:right;vertical-align:top;white-sp
ace:nowrap}.ctrf {white-space:nowrap}.cted {fontsize:
80%;padding:1em 0 0}.clc td {padding-right:1ex}.tlc td
{width:100%;white-space:nowrap;overflow:hidden;textoverflow:
ellipsis}.tlc img {width:15;height:15}.rr
{background:#E8EEF7}.rr b {font-weight:normal}.sr
{background:#FFFFCC}.p {color:#777}.p b {font-weight:bold}.lb
Continued
226 Appendix â€” Long Code Listings
Listing A-1 (continued)
{color:#080}#tt {padding:3 0}.msg {display:inline-block}#mm
{width:100%}#mm td {font-size:80%;white-space:nowrap}.rc
{width:100%;table-layout:fixed}.rc div {whitespace:
nowrap;overflow:hidden;text-overflow:ellipsis}.au
{font-weight:bold}.mb {font-size:80%;padding:6 0 0 10}.ma
{}.att td {font-size:80%}.mc {font-size:70%;padding:4 0 0
10;background:#eee}.q {color:#505}.e {display:none}.ea {fontsize:
80%;color:#5c6efc;padding:5;cursor:pointer;cursor:hand}.s
g, .sg *, .ad, .ad * {color:#888888}.st0
{background:#ffff88}#ap {font-size:80%;paddingbottom:
1.5ex}.al {padding-bottom:1ex}.ai
{vertical-align:middle}.cg {background:#eee}.cf
{background:#c3d9ff}.cb2 #cft, .cb2 #cfb {display:none}#cft td
{background-color:inherit}.ci {background:#e0ecff;verticalalign:
top}.cf td, .cg td {font-size:80%}.cn, .cto, .cn table,
.cto table {height:100%}.cn .tl {background-image:none}.cd
{padding:4 5 2 10;}.cd button {text-align:center;fontsize:
80%}.tb {padding:5;width:100%}.sp
{display:none;background:#e8f1ff;padding:7px;border:1px black
solid;cursor:default;overflow:auto;height:100%}.ms {textdecoration:
underline;cursor:pointer;cursor:hand;font-weight:bo
ld}.un {color:red}.cr {color:green}.mr {textdecoration:
none}.sm {position:absolute;display:none;margin:2px
0px;font-family:arial,sans-serif;backgroundcolor:#
c3d9ff;border:2px solid;border-color:#e8f1ff #9daecd</p>

<h4>9daecd #e8f1ff;z-index:1}.si {font-family:arial,sansserif;</h4>

<p>display:block;padding:3px
1em;white-space:nowrap;font-size:83%;cursor:default}.ih
{background-color:#66c;color:white}.sy {font-size:90%;fontweight:
bold}.hm {background-color:#ffff00}.tbo
{background:#c3d9ff;padding:2;-moz-user-select:none}.tbr
{cursor:default;width:100%;padding-left:0;verticalalign:
middle;-moz-user-select:none}.tbb {border:solid #c3d9ff
1px;padding:0 2 0 2;-moz-user-select:none}.tbm {fontsize:
80%;-moz-user-select:none}.db {border:1px
solid;border-color:#9daecd #e8f1ff #e8f1ff #9daecd}.ob
{background:#e8f1ff;border:1px solid;border-color:#9daecd</p>

<h4>e8f1ff #e8f1ff #9daecd}.hb {border:1px solid;bordercolor:</h4>

<p>e8f1ff #9daecd #9daecd #e8f1ff}.sv
{margin-left:12px}.pt
{display:none;position:absolute;background:#bbb;padding:2px}.p
t table {background:#bbb}.pt table td
{width:15px;height:15px;padding:0px;margin:0px;border:1px
solid #bbb}.ef {width:100%}.nw {white-space:nowrap}.hd
{display:none}.iv
Appendix â€” Long Code Listings 227
{position:absolute;left:0;right:0;width:0;height:0;padding:0;m
argin:0;border:0}#hm { position:absolute;z-index:3;border:1px</p>

<h4>000 outset;background:#eee;padding:2}.ac span {textdecoration:</h4>

<p>none;color:#00c;display:block;cursor:default;paddin
g:0 10 0 10;font-size:80%;white-space:nowrap}.ac span.sel
{background:#c4e4ff}.chc {background:#FAD163;padding:2 4 0
9}.chc, .chc td {font-size:80%;white-space:nowrap}#ctf {fontsize:
80%}#ctm {padding:9 8 5 0;white-space:nowrap}.ctum
{padding:5 8;font-weight:bold}.ctsm {padding:5
8;background:#FFFFF8;font-weight:bold}.y
{background:#FFFFF8}.z {background:#FFFFCC}.pr
{background:#FAD163}#pt {font-weight:bold;paddingleft:
4;padding-top:3}#pm {padding:6 0 3;font-size:80%}#pm span
{font-weight:bold}#pp {background:#FFF7D7;padding:8}.pum
{padding:3 8}.psm {padding:3 8;background:#FFF7D7}table.pe
{font-size:80%}.pl {color:#063;font-weight:bold}.tl
{background:url(/gmail/images/corner_tl.gif) top left}.bl
{background:url(/gmail/images/corner_bl.gif) bottom left}.tr
{background:url(/gmail/images/corner_tr.gif) top right}.br
{background:url(/gmail/images/corner_br.gif) bottom right}.tl,
.bl, .tr, .br {background-repeat:no-repeat;paddingleft:
4;width:4}.ctop
{background:url(/gmail/images/card_top.gif) top repeatx;
padding:1;width:100%}.ctl
{background:url(/gmail/images/card_tl.gif) top left}.ctr
{background:url(/gmail/images/card_tr.gif) top right}.stl
{background:url(/gmail/images/card_stl.gif) top left}.cbot
{background-image:url(/gmail/images/card_bot.gif);backgroundposition:
bottom;background-repeat:repeat-x;padding:1;width:100
%}.cbl {backgroundimage:
url(/gmail/images/card_bl.gif);background-position:botto
m left}.cbr {backgroundimage:
url(/gmail/images/card_br.gif);background-position:botto
m right}.cb {backgroundimage:
url(/gmail/images/card_left.gif);background-position:lef
t;background-repeat:repeat-y;border-right:1px #e8e8e8
solid;}.cb2 {backgroundimage:
url(/gmail/images/card_left2.gif);background-position:le
ft;background-repeat:repeat-y;border-right:1px #e8e8e8
solid;}.ctl, .ctr, .stl, .cbl, .cbr {background-repeat:norepeat}.
ctl, .cbl, .stl {padding:0 10 0 0}.ctr, .cbr
{padding:0 9 0 0}#rh {background:white}.metatable {marginbottom:
10} .metatable td {font-size:70%;padding:2 2 8 2}.rhh
{color:#333;text-align:center} &lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;TABLE width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€?&gt;
Continued
228 Appendix â€” Long Code Listings
Listing A-1 (continued)
&lt;TBODY&gt;
&lt;TR&gt;
&lt;TD width=â€?149â€? valign=â€?topâ€? rowspan=â€?2â€?&gt;
&lt;DIV id=â€?ds_inboxâ€? style=â€?padding-top: 1ex;â€?
class=â€?hâ€?&gt;
&lt;IMG width=â€?143â€? height=â€?59â€?
src=â€?/gmail/help/images/logo.gifâ€?/&gt;
&lt;/DIV&gt;
&lt;/TD&gt;
&lt;TD valign=â€?topâ€? align=â€?rightâ€?&gt;
&lt;DIV class=â€?sâ€? style=â€?padding-bottom: 2px; textalign:
right;â€?&gt;
&lt;B&gt;
<a href="mailto:ben.hammersley@gmail.com">ben.hammersley@gmail.com</a> &lt;/B&gt;
| &lt;SPAN id=â€?prf_gâ€? class=â€?lkâ€?&gt;
Settings &lt;/SPAN&gt;
| &lt;A target=â€?_blankâ€? href=â€?/support/â€?
class=â€?lcâ€? id=â€?helpâ€?&gt;
Help &lt;/A&gt;
| &lt;A target=â€?_topâ€?
onclick=â€?return
top.js._Main_OnLink(window,this,event)â€? class=â€?lkâ€?
href=â€??logoutâ€?&gt;
Sign out &lt;/A&gt;
&lt;/DIV&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;TR&gt;
&lt;TD valign=â€?bottomâ€?&gt;
&lt;DIV class=â€?sâ€? id=â€?mt1â€?&gt;
&lt;TABLE cellspacing=â€?0â€? cellpadding=â€?0â€?&gt;
&lt;TBODY&gt;
&lt;TR&gt;
&lt;TD valign=â€?bottomâ€?&gt;
&lt;FORM onsubmit=â€?return
top.js._MH_OnSearch(window,0)â€?
style=â€?padding-bottom: 5px; whitespace:
nowrap;â€? class=â€?sâ€? id=â€?sâ€?&gt;
&lt;INPUT value=â€?â€? name=â€?qâ€?
maxlength=â€?2048â€? size=â€?28â€?/&gt;
Â  &lt;INPUT type=â€?submitâ€?
value=â€?Search Mailâ€?/&gt;
Â  &lt;INPUT type=â€?submitâ€?
onclick=â€?return
top.js._MH_OnSearch(window,1)â€? value=â€?Search the Webâ€?/&gt;
Appendix â€” Long Code Listings 229
Â  &lt;/FORM&gt;
&lt;/TD&gt;
&lt;TD&gt;
&lt;TABLE cellspacing=â€?0â€? cellpadding=â€?0â€?
style=â€?vertical-align: top; padding-bottom: 4px;â€?&gt;
&lt;TBODY&gt;
&lt;TR&gt;
&lt;TD&gt;
&lt;SPAN id=â€?mt_advâ€? style=â€?fontsize:
65%;â€? class=â€?lkâ€?&gt;
ShowÂ searchÂ options
&lt;/SPAN&gt;
Â Â  &lt;/TD&gt;
&lt;/TR&gt;
&lt;TR&gt;
&lt;TD&gt;
&lt;SPAN id=â€?mt_cf1â€?
style=â€?font-size: 65%;
vertical-align: top;â€? class=â€?lkâ€?&gt;
CreateÂ aÂ filter &lt;/SPAN&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;/DIV&gt;
&lt;DIV
style=â€?height: 2.1ex; padding-right: 149px;
visibility: hidden;â€? class=â€?ntâ€? id=â€?nt1â€?/&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;DIV style=â€?padding-bottom: 1px;â€? id=â€?mt2â€?/&gt;
&lt;DIV class=â€?ntâ€? id=â€?nt2â€? style=â€?display: none;â€?/&gt;
&lt;DIV id=â€?navâ€? style=â€?position: absolute; left: 1ex; width:
14ex;â€?&gt;
&lt;DIV class=â€?nlâ€?&gt;
&lt;SPAN id=â€?compâ€? class=â€?lkâ€?&gt;
&lt;B&gt;
Compose Mail &lt;/B&gt;
&lt;/SPAN&gt;
&lt;/DIV&gt;
&lt;DIV style=â€?padding-top: 9px;â€?&gt;
&lt;TABLE cellspacing=â€?0â€? cellpadding=â€?0â€? border=â€?0â€?
Continued
230 Appendix â€” Long Code Listings
Listing A-1 (continued)
style=â€?background: rgb(195, 217, 255) none
repeat scroll 0%; -moz-background-clip: initial; -mozbackground-
origin: initial; -moz-background-inline-policy:
initial;â€? class=â€?cvâ€?&gt;
&lt;TBODY&gt;
&lt;TR height=â€?2â€?&gt;
&lt;TD width=â€?8â€? class=â€?tlâ€?/&gt;
&lt;/TR&gt;
&lt;TR&gt;
&lt;TD/&gt;
&lt;TD&gt;
&lt;SPAN id=â€?ds_inboxâ€? class=â€?lk bâ€?&gt;
&lt;B&gt;
Inbox (1) &lt;/B&gt;
&lt;/SPAN&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;TR height=â€?2â€?&gt;
&lt;TD class=â€?blâ€?/&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;DIV class=â€?nlâ€?&gt;
&lt;SPAN id=â€?ds_starredâ€? class=â€?lkâ€?&gt;
Starred &lt;IMG width=â€?13â€? height=â€?13â€?
src=â€?/gmail/images/star_on_sm_2.gifâ€? id=â€?_ssâ€?/&gt;
&lt;/SPAN&gt;
&lt;/DIV&gt;
&lt;DIV class=â€?nlâ€?&gt;
&lt;SPAN id=â€?ds_sentâ€? class=â€?lkâ€?&gt;
Sent Mail &lt;/SPAN&gt;
&lt;/DIV&gt;
&lt;DIV class=â€?nlâ€?&gt;
&lt;SPAN id=â€?ds_draftsâ€? class=â€?lkâ€?&gt;
Drafts &lt;/SPAN&gt;
&lt;/DIV&gt;
&lt;DIV class=â€?nlâ€?&gt;
&lt;SPAN id=â€?ds_allâ€? class=â€?lkâ€?&gt;
All Mail &lt;/SPAN&gt;
&lt;/DIV&gt;
&lt;DIV class=â€?nlâ€?&gt;
&lt;SPAN id=â€?ds_spamâ€? class=â€?lkâ€?&gt;
Spam &lt;/SPAN&gt;
&lt;/DIV&gt;
&lt;DIV class=â€?nlâ€?&gt;
Appendix â€” Long Code Listings 231
&lt;SPAN id=â€?ds_trashâ€? class=â€?lkâ€?&gt;
Trash &lt;/SPAN&gt;
&lt;/DIV&gt;
&lt;/DIV&gt;
&lt;DIV style=â€?padding-top: 8px;â€?&gt;
&lt;DIV class=â€?nlâ€?&gt;
&lt;SPAN id=â€?contâ€? class=â€?lkâ€?&gt;
&lt;B&gt;
Contacts &lt;/B&gt;
&lt;/SPAN&gt;
&lt;/DIV&gt;
&lt;/DIV&gt;
&lt;DIV id=â€?nb_0â€? style=â€?padding-top: 8px;â€?&gt;
&lt;DIV style=â€?width: 95%;â€?&gt;
&lt;TABLE width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€?
bgcolor=â€?#b5edbcâ€?&gt;
&lt;TBODY&gt;
&lt;TR height=â€?2â€?&gt;
&lt;TD class=â€?tlâ€?/&gt;
&lt;TD class=â€?trâ€?/&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;DIV style=â€?padding: 0pt 3px 1px; background:
rgb(181, 237, 188) none repeat scroll 0%; -moz-backgroundclip:
initial; -moz-background-origin: initial;
-moz-background-inline-policy: initial;â€?&gt;
&lt;DIV id=â€?nt_0â€? class=â€?s hâ€?&gt;
&lt;IMG width=â€?11â€? height=â€?11â€?
src=â€?/gmail/images/opentriangle.gifâ€?/&gt;
Labels &lt;/DIV&gt;
&lt;TABLE cellspacing=â€?2â€? class=â€?nbâ€?&gt;
&lt;TBODY&gt;
&lt;TR&gt;
&lt;TD&gt;
&lt;DIV align=â€?rightâ€? id=â€?prf_lâ€? class=â€?lk
csâ€?&gt;
EditÂ labels &lt;/DIV&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;/DIV&gt;
&lt;TABLE width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€?
bgcolor=â€?#b5edbcâ€?&gt;
&lt;TBODY&gt;
&lt;TR height=â€?2â€?&gt;
&lt;TD class=â€?blâ€?/&gt;
Continued
232 Appendix â€” Long Code Listings
Listing A-1 (continued)
&lt;TD class=â€?brâ€?/&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;/DIV&gt;
&lt;/DIV&gt;
&lt;DIV id=â€?nb_2â€? style=â€?padding-top: 7px;â€?/&gt;
&lt;DIV style=â€?padding-top: 7px;â€? class=â€?sâ€?&gt;
&lt;SPAN style=â€?color: rgb(170, 0, 0);â€? class=â€?ilcâ€?
id=â€?ilâ€?&gt;
Invite 4 friends &lt;BR/&gt;
to Gmail &lt;/SPAN&gt;
Â  &lt;/DIV&gt;
&lt;/DIV&gt;
&lt;DIV style=â€?margin-left: 14ex;â€? id=â€?coâ€?&gt;
&lt;DIV id=â€?tc_topâ€?&gt;
&lt;TABLE width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€?
bgcolor=â€?#c3d9ffâ€?&gt;
&lt;TBODY&gt;
&lt;TR height=â€?2â€?&gt;
&lt;TD class=â€?tlâ€?/&gt;
&lt;TD class=â€?trâ€?/&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;TABLE width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€?
style=â€?background: rgb(195, 217, 255) none
repeat scroll 0%; -moz-background-clip: initial; -mozbackground-
origin: initial; -moz-background-inline-policy:
initial;â€? class=â€?thâ€?&gt;
&lt;TBODY&gt;
&lt;TR&gt;
&lt;TD width=â€?8â€?/&gt;
&lt;TD&gt;
&lt;BUTTON style=â€?font-weight: bold;â€?
id=â€?ac_rc_^iâ€? class=â€?abâ€? type=â€?buttonâ€?&gt;
Archive &lt;/BUTTON&gt;
Â Â  &lt;BUTTON style=â€?width: 8em; textalign:
center;â€? id=â€?ac_spâ€?
class=â€?abâ€? type=â€?buttonâ€?&gt;
ReportÂ Spam &lt;/BUTTON&gt;
Â  &lt;SELECT id=â€?tamuâ€?
onchange=â€?top.js._TL_OnActionMenuChange(window,this)â€?
onfocus=â€?return
top.js._TL_MaybeUpdateActionMenus(window,this)â€?
Appendix â€” Long Code Listings 233
onmouseover=â€?return
top.js._TL_MaybeUpdateActionMenus(window,this)â€?
style=â€?vertical-align: middle;â€?&gt;
&lt;OPTION style=â€?color: rgb(119, 119, 119);â€?
id=â€?macâ€?&gt;
More Actions ... &lt;/OPTION&gt;
&lt;OPTION style=â€?color: rgb(119, 119, 119);â€?
disabled=â€?â€? id=â€?nilâ€?&gt;
-------- &lt;/OPTION&gt;
&lt;OPTION style=â€?color: rgb(119, 119, 119);â€?
disabled=â€?â€? id=â€?alâ€?&gt;
Apply label: &lt;/OPTION&gt;
&lt;OPTION value=â€?newâ€?&gt;
Â Â Â New label... &lt;/OPTION&gt;
&lt;/SELECT&gt;
Â Â  &lt;SPAN id=â€?refreshâ€? class=â€?lkâ€?&gt;
Refresh &lt;/SPAN&gt;
&lt;/TD&gt;
&lt;TD align=â€?rightâ€?&gt;
Â  &lt;SPAN style=â€?white-space: nowrap;â€?&gt;
&lt;B&gt;
1 &lt;/B&gt;
- &lt;B&gt;
1 &lt;/B&gt;
of &lt;B&gt;
1 &lt;/B&gt;
&lt;/SPAN&gt;
&lt;/TD&gt;
&lt;TD width=â€?4â€?/&gt;
&lt;/TR&gt;
&lt;TR&gt;
&lt;TD/&gt;
&lt;TD valign=â€?bottomâ€? style=â€?padding-top: 3px;â€?
colspan=â€?2â€?&gt;
Select: &lt;SPAN id=â€?sl_aâ€? class=â€?lâ€?&gt;
All &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_râ€? class=â€?lâ€?&gt;
Read &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_uâ€? class=â€?lâ€?&gt;
Unread &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_sâ€? class=â€?lâ€?&gt;
Starred &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_tâ€? class=â€?lâ€?&gt;
Unstarred &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_nâ€? class=â€?lâ€?&gt;
None &lt;/SPAN&gt;
&lt;/TD&gt;
&lt;/TR&gt;
Continued
234 Appendix â€” Long Code Listings
Listing A-1 (continued)
&lt;TR height=â€?3â€?&gt;
&lt;TD/&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;/DIV&gt;
&lt;DIV style=â€?border-left: 9px solid rgb(195, 217, 255);â€?&gt;
&lt;DIV id=â€?tbdâ€?&gt;
&lt;FORM target=â€?histâ€? method=â€?postâ€? name=â€?afâ€?
action=â€?/gmail?search=inbox&amp;amp;view=tl&amp;amp;start=0â€?&gt;
&lt;INPUT type=â€?hiddenâ€? name=â€?actâ€?/&gt;
&lt;INPUT type=â€?hiddenâ€? name=â€?atâ€?/&gt;
&lt;INPUT type=â€?hiddenâ€? name=â€?vpâ€?/&gt;
&lt;TABLE width=â€?100%â€? cellspacing=â€?0â€?
cellpadding=â€?1â€? id=â€?tbâ€? class=â€?tlcâ€?&gt;
&lt;COL style=â€?width: 31px; text-align: right;â€?/&gt;
&lt;COL style=â€?width: 20px;â€?/&gt;
&lt;COL style=â€?width: 24ex;â€?/&gt;
&lt;COL style=â€?width: 2ex;â€?/&gt;
&lt;COL/&gt;
&lt;COL style=â€?width: 17px;â€?/&gt;
&lt;COL style=â€?width: 8ex;â€?/&gt;
&lt;TBODY&gt;
&lt;TR id=â€?w_0â€? class=â€?urâ€?&gt;
&lt;TD align=â€?rightâ€?&gt;
&lt;INPUT type=â€?checkboxâ€?/&gt;
&lt;/TD&gt;
&lt;TD&gt;
&lt;IMG src=â€?/gmail/images/star_off_2.gifâ€?/&gt;
&lt;/TD&gt;
&lt;TD&gt;
&lt;SPAN id=â€?_user_ben@benhammersley.comâ€?&gt;
&lt;B&gt;
Ben Hammersley &lt;/B&gt;
&lt;/SPAN&gt;
(2) &lt;/TD&gt;
&lt;TD&gt;
Â  &lt;/TD&gt;
&lt;TD&gt;
&lt;B&gt;
Skinning Gmail? Thatâ€™s so cool! &lt;/B&gt;
&lt;SPAN class=â€?pâ€?&gt;
- BEGIN PGP SIGNED MESSAGE-- Hash: SHA1 la la la --BEGIN PGP
SIGNATURE-- Version: GnuPG v1 â€¦
&lt;/SPAN&gt;
&lt;/TD&gt;
Appendix â€” Long Code Listings 235
&lt;TD&gt;
Â  &lt;/TD&gt;
&lt;TD&gt;
&lt;B&gt;
2:29pm &lt;/B&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;/FORM&gt;
&lt;DIV style=â€?padding: 0pt 20px;â€? class=â€?s câ€?&gt;
&lt;BR/&gt;
&lt;BR/&gt;
&lt;BR/&gt;
&lt;BR/&gt;
&lt;BR/&gt;
&lt;BR/&gt;
&lt;BR/&gt;
&lt;BR/&gt;
&lt;/DIV&gt;
&lt;/DIV&gt;
&lt;/DIV&gt;
&lt;IMG width=â€?9â€? height=â€?11â€?
src=â€?/gmail/images/chevron.gifâ€?
style=â€?position: absolute; display: none;â€?
id=â€?arâ€?/&gt;
&lt;DIV id=â€?tc_botâ€?&gt;
&lt;TABLE width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€?
style=â€?background: rgb(195, 217, 255) none
repeat scroll 0%; -moz-background-clip: initial; -mozbackground-
origin: initial; -moz-background-inline-policy:
initial;â€? class=â€?thâ€?&gt;
&lt;TBODY&gt;
&lt;TR height=â€?2â€?&gt;
&lt;TD/&gt;
&lt;/TR&gt;
&lt;TR&gt;
&lt;TD width=â€?8â€?/&gt;
&lt;TD&gt;
Select: &lt;SPAN id=â€?sl_aâ€? class=â€?lâ€?&gt;
All &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_râ€? class=â€?lâ€?&gt;
Read &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_uâ€? class=â€?lâ€?&gt;
Unread &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_sâ€? class=â€?lâ€?&gt;
Starred &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_tâ€? class=â€?lâ€?&gt;
Continued
236 Appendix â€” Long Code Listings
Listing A-1 (continued)
Unstarred &lt;/SPAN&gt;
, &lt;SPAN id=â€?sl_nâ€? class=â€?lâ€?&gt;
None &lt;/SPAN&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;TR height=â€?4â€?&gt;
&lt;TD/&gt;
&lt;/TR&gt;
&lt;TR&gt;
&lt;TD/&gt;
&lt;TD&gt;
&lt;BUTTON style=â€?font-weight: bold;â€?
id=â€?ac_rc_^iâ€? class=â€?abâ€? type=â€?buttonâ€?&gt;
Archive &lt;/BUTTON&gt;
Â Â  &lt;BUTTON style=â€?width: 8em; textalign:
center;â€? id=â€?ac_spâ€?
class=â€?abâ€? type=â€?buttonâ€?&gt;
ReportÂ Spam &lt;/BUTTON&gt;
Â  &lt;SELECT id=â€?bamuâ€?
onchange=â€?top.js._TL_OnActionMenuChange(window,this)â€?
onfocus=â€?return
top.js._TL_MaybeUpdateActionMenus(window,this)â€?
onmouseover=â€?return
top.js._TL_MaybeUpdateActionMenus(window,this)â€?
style=â€?vertical-align: middle;â€?&gt;
&lt;OPTION style=â€?color: rgb(119, 119, 119);â€?
id=â€?macâ€?&gt;
More Actions ... &lt;/OPTION&gt;
&lt;OPTION style=â€?color: rgb(119, 119, 119);â€?
disabled=â€?â€? id=â€?nilâ€?&gt;
-------- &lt;/OPTION&gt;
&lt;OPTION style=â€?color: rgb(119, 119, 119);â€?
disabled=â€?â€? id=â€?alâ€?&gt;
Apply label: &lt;/OPTION&gt;
&lt;OPTION value=â€?newâ€?&gt;
Â Â Â New label... &lt;/OPTION&gt;
&lt;/SELECT&gt;
&lt;/TD&gt;
&lt;TD align=â€?rightâ€?&gt;
&lt;SPAN style=â€?white-space: nowrap;â€?&gt;
&lt;B&gt;
1 &lt;/B&gt;
- &lt;B&gt;
1 &lt;/B&gt;
of &lt;B&gt;
Appendix â€” Long Code Listings 237
1 &lt;/B&gt;
&lt;/SPAN&gt;
&lt;/TD&gt;
&lt;TD width=â€?4â€?/&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;TABLE width=â€?100%â€? cellspacing=â€?0â€? cellpadding=â€?0â€?
bgcolor=â€?#c3d9ffâ€?&gt;
&lt;TBODY&gt;
&lt;TR height=â€?2â€?&gt;
&lt;TD class=â€?blâ€?/&gt;
&lt;TD class=â€?brâ€?/&gt;
&lt;/TR&gt;
&lt;/TBODY&gt;
&lt;/TABLE&gt;
&lt;/DIV&gt;
&lt;/DIV&gt;
&lt;DIV style=â€?padding: 0ex 14ex;â€? id=â€?ftâ€?&gt;
&lt;DIV style=â€?margin-top: 20px;â€? class=â€?c sâ€?&gt;
Use the &lt;SPAN id=â€?fsbâ€? style=â€?color: rgb(0, 0, 204);
text-decoration: underline; cursor: pointer; white-space:
nowrap;â€?&gt;
search &lt;/SPAN&gt;
box or &lt;SPAN id=â€?mt_advâ€? style=â€?color: rgb(0, 0,
204); text-decoration: underline; cursor: pointer; whitespace:
nowrap;â€?&gt;
search options &lt;/SPAN&gt;
to find messages quickly! &lt;/DIV&gt;
&lt;DIV style=â€?margin-top: 12px; color: rgb(0, 102, 51);â€?
class=â€?c s bâ€?&gt;
You are currently using 0 MB (0%) of your 1000 MB. &lt;/DIV&gt;
&lt;DIV style=â€?margin-top: 4px;â€? class=â€?c xsâ€?&gt;
&lt;DIV&gt;
&lt;A href=â€?/gmail/help/terms_of_use.htmlâ€?
target=â€?_blankâ€? class=â€?lcâ€?&gt;
TermsÂ ofÂ Use &lt;/A&gt;
- &lt;A href=â€?/gmail/help/privacy.htmlâ€?
target=â€?_blankâ€? class=â€?lcâ€?&gt;
PrivacyÂ Policy &lt;/A&gt;
- &lt;A href=â€?/gmail/help/program_policies.htmlâ€?
target=â€?_blankâ€? class=â€?lcâ€?&gt;
ProgramÂ Policies &lt;/A&gt;
- &lt;A href=â€?http://www.google.com/â€? target=â€?_blankâ€?
class=â€?lcâ€? id=â€?googhâ€?&gt;
GoogleÂ Home &lt;/A&gt;
&lt;/DIV&gt;
&lt;DIV style=â€?color: rgb(68, 68, 68); margin-top: 4px;â€?&gt;
Continued
238 Appendix â€” Long Code Listings
Listing A-1 (continued)
Â©2004Â Google &lt;/DIV&gt;
&lt;/DIV&gt;
&lt;/DIV&gt;
&lt;SCRIPT&gt;
var fp=â€™9cf0974955f546daâ€™; &lt;/SCRIPT&gt;
&lt;SCRIPT&gt;
var loaded=true;D([â€˜eâ€™]); &lt;/SCRIPT&gt;
&lt;SCRIPT&gt;
try{top.js.L(window,45,â€™f4ba224ac4â€™);}catch(e){} &lt;/SCRIPT&gt;
&lt;DIV id=â€?tipâ€? style=â€?border-style: outset; border-width:
1px; padding: 2px; background: rgb(255, 255, 221) none repeat
scroll 0%; position: absolute; -moz-background-clip: initial;
-moz-background-origin: initial; -moz-background-inlinepolicy:
initial; left: 309px; top: 125px; display: none;â€?&gt;
&lt;CENTER&gt;
&lt;SMALL&gt;
<a href="mailto:ben@benhammersley.com">ben@benhammersley.com</a> &lt;/SMALL&gt;
&lt;/CENTER&gt;
&lt;/DIV&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;
Listing A-2: The Complete CSS Listing
body#gmail-google-com {
background-color: #ffffff !important;
}
body#gmail-google-com img{
display: none !important;
}
/* regular links <em>/
body#gmail-google-com span.lk,
body#gmail-google-com a.lc,
body#gmail-google-com a.lk
{
text-decoration: none !important;
color: #191b4c !important;
}
/</em> The Search Form <em>/
Appendix â€” Long Code Listings 239
body#gmail-google-com div#mt1 form{
display: none !important;
}
body#gmail-google-com div#mt1 table{
display: none !important;
}
/</em>------------------------------------------------------------
<em>/
/</em>The Navigation Menu <em>/
body#gmail-google-com span#comp {
font-family: cursive;
}
/</em> sidebar links <em>/
body#gmail-google-com div#nav table.cv,
body#gmail-google-com div#nav table.cv td {
background: #ffffff !important;
}
body#gmail-google-com table.cv td.tl,
body#gmail-google-com table.cv td.bl {
height: 0 !important;
}
/</em> both current and other <em>/
body#gmail-google-com table.cv td span.lk,
body#gmail-google-com div.nl span.lk{
display: block !important;
background: #ffffff !important;
color: #191b4c;
border: none !important;
padding: 2px !important;
margin-right: 5px !important;
}
/</em> Override the background color for the unselected options<em>/
body#gmail-google-com div.nl span.lk {
background: #ffffff !important;
border: none !important;
}
/</em> For the mouse-over color change <em>/
Continued
240 Appendix â€” Long Code Listings
Listing A-2 (continued)
body#gmail-google-com div.nl span.lk:hover {
background: #d3cbb8 !important;
border-color: #fef759 !important;
}
/</em> hide â€œNew!â€? super-script <em>/
body#gmail-google-com div#nav sup {
display: none !important;
}
/</em> remove the colored left border of the inbox <em>/
body#gmail-google-com div#co div {
border: 0 !important;
}
/</em>-------------------------------------------------------<em>/
/</em> labels <em>/
body#gmail-google-com div#nb_0 {
display: none !important;
}
/</em> The Invitation Link <em>/
body#gmail-google-com #il {
display: none !important;
}
/</em> The footer <em>/
body#gmail-google-com div#ft {
display: none !important;
}
/</em>------------------------------------------------------------
<em>/
/</em> THE APPLICATION AREA <em>/
/</em> top bar <em>/
body#gmail-google-com div#tc_top table,
body#gmail-google-com div#tc_top table td.tl,
body#gmail-google-com div#tc_top table td.tr,
Appendix â€” Long Code Listings 241
body#gmail-google-com div#tc_top table.th,{
background: #ffffff !important;
border: none !important;
padding: 2px !important;
margin: 5px 0 5px 0 !important;
}
/</em> bottom bar<em>/
body#gmail-google-com div#tc_bot table,
body#gmail-google-com div#tc_bot table td.bl,
body#gmail-google-com div#tc_bot table td.br,
body#gmail-google-com div#tc_bot table.th{
display: none !important;
}
/</em> selection links in bar <em>/
body#gmail-google-com div#co div#tc_top span.l{
color: #191b4c !important;
}
/</em> mailbox contents <em>/
body#gmail-google-com div#co div#tbd {
background: #ffffff !important;
border: none !important;
padding: 4px 0 4px 0 !important;
}
/</em> unread mail row inside the inbox <em>/
body#gmail-google-com table.tlc tr.ur {
background-color: #d7d7d7 !important;
height: 30px;
}
/</em>read mail row inside the inbox <em>/
body#gmail-google-com table.tlc tr.rr {
background-color: #ffffff !important;
}
body#gmail-google-com table.tlc tr.ur td,
body#gmail-google-com table.tlc tr.rr td{
border: 0 !important;
}
Continued
242 Appendix â€” Long Code Listings
Listing A-2 (continued)
/</em> message hovering snippet expansion <em>/
body#gmail-google-com table.tlc tr.ur:hover,
body#gmail-google-com table.tlc tr.rr:hover{
background-color: #ffffff !important;
}
body#gmail-google-com table.tlc tr.ur:hover td,
body#gmail-google-com table.tlc tr.rr:hover td{
border: none !important;
vertical-align: top !important;
}
body#gmail-google-com table.tlc tr.ur:hover .sn,
body#gmail-google-com table.tlc tr.rr:hover .sn{
display: block !important;
white-space: normal !important;
}
/</em> and email address display <em>/
body#gmail-google-com table.tlc tr.ur:hover td span,
body#gmail-google-com table.tlc tr.rr:hover td span {
display: block; !important;
color: #ff0000;
}
/</em> labels should still be inline <em>/
body#gmail-google-com table.tlc tr.ur:hover td span.ct,
body#gmail-google-com table.tlc tr.rr:hover td span.ct{
display: inline;
}
body#gmail-google-com table.tlc tr.ur:hover td span[id]:after,
body#gmail-google-com table.tlc tr.rr:hover td span[id]:after{
content: attr(id);
display: block;
margin-left: -38px; /</em> hack to hide â€œuser_â€? id prefix <em>/
color: #b6af9e;
}
/</em>-----------------------------------------------------------
<em>/
Appendix â€” Long Code Listings 243
Chapter 5
Listing A-3: The Edited Boot Sequence
192.168.016.053.64142-216.239.057.106.00080: GET / HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
216.239.057.106.00080-192.168.016.053.64142: HTTP/1.1 302
Moved Temporarily
Location:
<a href="https://gmail.google.com/?dest=http%253A%252F%252Fgmail.google.com%252">https://gmail.google.com/?dest=http%3A%2F%2Fgmail.google.com%2</a>
Fgmail
Cache-control: private
Content-Length: 0
Content-Type: text/html
Server: GFE/1.3
Date: Sun, 16 Jan 2005 17:11:18 GMT
192.168.016.053.64143-216.239.057.106.00443
LOTS OF ENCRYPTED TRAFFIC CLIPPED OUT FROM THIS SECTION
192.168.016.053.64147-066.102.007.104.00080: GET / HTTP/1.1
Host: <a href="http://www.google.com">www.google.com</a>
Cookie: GMAIL_RTT2=290
066.102.007.104.00080-192.168.016.053.64147: HTTP/1.1 302
Found
Location:
<a href="http://www.google.it/cxfer?c=PREF%253D:TM%253D1105895484:S%253Dy1QWQ">http://www.google.it/cxfer?c=PREF%3D:TM%3D1105895484:S%3Dy1QWQ</a>
vOGa-clmjwi&amp;prev=/
Set-Cookie:
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
J6wL_U141gaHs1; expires=Sun, 17-Jan-2038 19:14:07 GMT; path=/;
<a href="http://domain=.google.com">domain=.google.com</a>
Continued
244 Appendix â€” Long Code Listings
Listing A-3 (continued)
Content-Type: text/html
Server: GWS/2.1
Content-Length: 214
Date: Sun, 16 Jan 2005 17:11:24 GMT
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;302 Moved&lt;/H1&gt;
The document has moved
&lt;A
HREF=â€?http://www.google.it/cxfer?c=PREF%3D:TM%3D1105895484:S%3
Dy1QWQvOGa-clmjwi&amp;amp;prev=/â€?&gt;here&lt;/A&gt;.
&lt;/BODY&gt;&lt;/HTML&gt;
192.168.016.053.64148-216.239.063.104.00080: GET
/cxfer?c=PREF%3D:TM%3D1105895484:S%3Dy1QWQvOGa-clmjwi&amp;prev=/
HTTP/1.1
Host: <a href="http://www.google.it">www.google.it</a>
216.239.063.104.00080-192.168.016.053.64148: HTTP/1.1 302
Found
Location: <a href="http://www.google.it/">http://www.google.it/</a>
Set-Cookie:
PREF=ID=5f2f91cd13521ebf:LD=it:TM=1105895484:LM=1105895485:S=J
4G_HJAk1i5fY0Ip; expires=Sun, 17-Jan-2038 19:14:07 GMT;
path=/; domain=.google.it
Content-Type: text/html
Server: GWS/2.1
Content-Length: 151
Date: Sun, 16 Jan 2005 17:11:25 GMT
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;302 Moved&lt;/H1&gt;
The document has moved
&lt;A HREF=â€?http://www.google.it/â€?&gt;here&lt;/A&gt;.
&lt;/BODY&gt;&lt;/HTML&gt;
192.168.016.053.64148-216.239.063.104.00080: GET / HTTP/1.1
Host: <a href="http://www.google.it">www.google.it</a>
Cookie:PREF=ID=5f2f91cd13521ebf:LD=it:TM=1105895484:LM=1105895
485:S=J4G_HJAk1i5fY0Ip
216.239.063.104.00080-192.168.016.053.64148: HTTP/1.1 200 OK
Cache-Control: private
Appendix â€” Long Code Listings 245
Content-Type: text/html
Server: GWS/2.1
Transfer-Encoding: chunked
Date: Sun, 16 Jan 2005 17:11:25 GMT
a98
&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=â€?content-typeâ€?
content=â€?text/html; charset=UTF-
8â€?&gt;&lt;title&gt;Google&lt;/title&gt;&lt;style&gt;<!--
body,td,a,p,.h{font-family:arial,sans-serif;}
.h{font-size: 20px;}
.q{color:#0000cc;}
//-->
&lt;/style&gt;
&lt;script&gt;
<!--
function sf(){document.f.q.focus();}
// -->
&lt;/script&gt;
&lt;/head&gt;&lt;body bgcolor=#ffffff text=#000000 link=#0000cc
vlink=#551a8b alink=#ff0000 onLoad=sf()&gt;&lt;center&gt;&lt;img
src=â€?/intl/it_it/images/logo.gifâ€? width=276 height=110
alt=â€?Googleâ€?&gt;&lt;br&gt;&lt;br&gt;
&lt;form action=/search name=f&gt;&lt;script&gt;<!--
function qs(el) {if (window.RegExp &amp;&amp;
window.encodeURIComponent) {var
qe=encodeURIComponent(document.f.q.value);if
(el.href.indexOf(â€œq=â€?)!=-1) {el.href=el.href.replace(new
RegExp(â€œq=[^&amp;$]</em>â€?),â€?q=â€?+qe);} else {el.href+=â€?&amp;q=â€?+qe;}}return
1;}
// -->
&lt;/script&gt;&lt;table border=0 cellspacing=0 cellpadding=4&gt;&lt;tr&gt;&lt;td
nowrap&gt;&lt;font size=-1&gt;&lt;b&gt;Web&lt;/b&gt;Â Â Â Â &lt;a
id=1a class=q href=â€?/imghp?hl=it&amp;tab=wiâ€? onClick=â€?return
qs(this);â€?&gt;Immagini&lt;/a&gt;Â Â Â Â &lt;a id=2a
class=q href=â€?/grphp?hl=it&amp;tab=wgâ€? onClick=â€?return
qs(this);â€?&gt;Gruppi&lt;/a&gt;Â Â Â Â &lt;a id=3a class=q
href=â€?/dirhp?hl=it&amp;tab=wdâ€? onClick=â€?return
qs(this);â€?&gt;Directory&lt;/a&gt;Â Â Â Â &lt;a id=4a
class=q href=â€?/nwshp?hl=it&amp;tab=wnâ€? onClick=â€?return qs(this)
216.239.063.104.00080-192.168.016.053.64148:
;â€?&gt;News&lt;/a&gt;Â Â Â Â &lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;t
able cellspacing=0 cellpadding=0&gt;&lt;tr&gt;&lt;td
width=25%&gt;Â &lt;/td&gt;&lt;td align=center&gt;&lt;input type=hidden
name=hl value=it&gt;&lt;input maxLength=256 size=55 name=q
value=â€?â€?&gt;&lt;br&gt;&lt;input type=submit value=â€?Cerca con Googleâ€?
name=btnG&gt;&lt;input type=submit value=â€?Mi sento fortunatoâ€?
name=btnI&gt;&lt;/td&gt;&lt;td valign=top nowrap width=25%&gt;&lt;font size=-
2&gt;Â Â &lt;a href=/advanced_search?hl=it&gt;Ricerca
Continued
246 Appendix â€” Long Code Listings
Listing A-3 (continued)
avanzata&lt;/a&gt;&lt;br&gt;Â Â &lt;a
href=/preferences?hl=it&gt;Preferenze&lt;/a&gt;&lt;br&gt;Â Â &lt;a
href=/language_tools?hl=it&gt;Strumenti per le
lingue&lt;/a&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td colspan=3
align=center&gt;&lt;font size=-1&gt;Cerca: &lt;input id=all type=radio
name=meta value=â€?â€? checked&gt;&lt;label for=all&gt; il
Web&lt;/label&gt;&lt;input id=lgr type=radio name=meta
value=â€?lr=lang_itâ€? &gt;&lt;label for=lgr&gt; pagine in
Italiano&lt;/label&gt;&lt;input id=cty type=radio name=meta
value=â€?cr=countryITâ€? &gt;&lt;label for=cty&gt;pagine provenienti da:
Italia&lt;/label&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/form&gt;&lt;br&gt;&lt;font size=-
1&gt;&lt;a href=â€?http://www.google.it/tsunami_relief.htmlâ€?&gt;Come
aiutare le popolazioni colpite dal
maremoto&lt;/a&gt;&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;font size=-1&gt;&lt;a
href=/intl/it/ads/&gt;Pubblicit..&lt;/a&gt; - &lt;a
href=/intl/it/about.html&gt;Tutto su Google&lt;/a&gt; - &lt;a
href=http://www.google.it/jobs/&gt;Stiamo Assumendo&lt;/a&gt; - &lt;a
<a href="http://href=http://www.google.com/ncr&gt;Google.com">href=http://www.google.com/ncr&gt;Google.com</a> in
English&lt;/a&gt;&lt;/font&gt;&lt;p&gt;&lt;font size=-2&gt;Â©2005 Google - Ricerca
effettuata su 8.058.044.651 pa
216.239.063.104.00080-192.168.016.053.64148: gine
Web.&lt;/font&gt;&lt;/p&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;
0
192.168.016.053.64149-066.102.007.104.00443:
MORE ENCRYPTED TRAFFIC REMOVED FROM HERE
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail?_sgh=9f1fe07d6a3a70c03b32d8a3ebc7577e HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
Cookie: GMAIL_RTT2=290;
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
J6wL_U141gaHs1;
GMAIL_LOGIN2=T1105895481223/1105895481223/1105895499818;
SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
Appendix â€” Long Code Listings 247
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
Set-Cookie: GV=101017c822e49-b58a8eed922f7d0f8c9e1901388b8beb;
Domain=gmail.google.com; Path=/gmail
Set-Cookie: GMAIL_AT=58c7bf063b77e796-1017c822e4c; Path=/
Set-Cookie: GMAIL_RTT=; Expires=Sat, 15-Jan-05 17:11:41 GMT;
Path=/
Set-Cookie: GMAIL_RTT2=; Domain=google.com; Expires=Sat, 15-
Jan-05 17:11:41 GMT; Path=/
Set-Cookie: S=gmail=ZnUe1o8mp44:gmproxy=kROzNYRS5DA;
Domain=.google.com; Path=/
Cache-control: private
Content-Type: text/html; charset=utf-8
Expires: Sat, 05 Feb 2005 17:11:41 GMT
ETag: â€œ79be7effb0cf7b45â€?
Transfer-Encoding: chunked
Server: GFE/1.3
Date: Sun, 16 Jan 2005 17:11:41 GMT
487
&lt;title&gt;Gmail&lt;/title&gt;&lt;link rel=â€?alternateâ€?
type=â€?application/atom+xmlâ€? title=â€?Gmail Atom Feedâ€?
href=â€?https://gmail.google.com/gmail/feed/atomâ€?
/&gt;&lt;noscript&gt;Javascript is disabled in your browser. Gmail
requires Javascript to be enabled in order to operate.&lt;p&gt;To
use Gmail, enable Javascript by changing your browser
preferences.&lt;p&gt;After enabling Javascript, &lt;a href=/gmail&gt;try
again&lt;/a&gt;.&lt;/noscript&gt;&lt;script&gt;var fs_time=(new
Date()).getTime();var testcookie =
â€˜jscookietest=validâ€™;document.cookie = testcookie;if
(document.cookie.indexOf(testcookie) == -1) {top.location =
â€˜/gmail/html/nocookies.htmlâ€™;}document.cookie = testcookie +
â€˜;expires=â€™ + new Date(0).toGMTString();var agt =
navigator.userAgent.toLowerCase();if (agt.indexOf(â€˜msieâ€™)!= -1
&amp;&amp; document.all) {var control = (a
216.239.057.106.00080-192.168.016.053.64150: gt.indexOf(â€˜msie
5â€™) != -1) ? â€˜Microsoft.XMLHTTPâ€™ : â€˜Msxml2.XMLHTTPâ€™;try {new
ActiveXObject(control);} catch (e) {top.location =
â€˜/gmail/html/noactivex.htmlâ€™;}}&lt;/script&gt;&lt;frameset
rows=â€™100%,*â€™ border=0&gt;&lt;frame name=main
src=/gmail/html/loading.html frameborder=0 noresize
Continued
248 Appendix â€” Long Code Listings
Listing A-3 (continued)
scrolling=no&gt;&lt;frame name=js
src=/gmail?view=page&amp;name=js&amp;ver=84b4499b9788ada frameborder=0
noresize&gt;&lt;/frameset&gt;
0
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/html/loading.html HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
Referer:
<a href="http://gmail.google.com/gmail?_sgh=9f1fe07d6a3a70c03b32d8a3ebc">http://gmail.google.com/gmail?_sgh=9f1fe07d6a3a70c03b32d8a3ebc</a>
7577e
Cookie: GV=101017c822e49-b58a8eed922f7d0f8c9e1901388b8beb;
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
J6wL_U141gaHs1;
GMAIL_LOGIN2=T1105895481223/1105895481223/1105895499818;
SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59; GMAIL_AT=58c7bf063b77e796-1017c822e4c;
S=gmail=ZnUe1o8mp44:gmproxy=kROzNYRS5DA
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
Last-Modified: Sun, 09 Jan 2005 20:54:50 GMT
Cache-control: public
Expires: Mon, 16 Jan 2006 17:11:41 GMT
Content-Type: text/html
Server: GFE/1.3
Transfer-Encoding: chunked
Date: Sun, 16 Jan 2005 17:11:41 GMT
&lt;font size=+1&gt;Loading...&lt;/font&gt;
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail?view=page&amp;name=js&amp;ver=84b4499b9788ada HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
Appendix â€” Long Code Listings 249
Referer:
<a href="http://gmail.google.com/gmail?_sgh=9f1fe07d6a3a70c03b32d8a3ebc">http://gmail.google.com/gmail?_sgh=9f1fe07d6a3a70c03b32d8a3ebc</a>
7577e
Cookie: GV=101017c822e49-b58a8eed922f7d0f8c9e1901388b8beb;
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
J6wL_U141gaHs1;
GMAIL_LOGIN2=T1105895481223/1105895481223/1105895499818;
SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59; GMAIL_AT=58c7bf063b77e796-1017c822e4c;
S=gmail=ZnUe1o8mp44:gmproxy=kROzNYRS5DA
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
Cache-control: public
Content-Type: text/html; charset=utf-8
Expires: Sat, 05 Feb 2005 17:11:42 GMT
ETag: â€œ84b4499b9788adaâ€?
Last-Modified: Fri, 05 Sep 2003 02:11:15 GMT
Transfer-Encoding: chunked
Server: GFE/1.3
Date: Sun, 16 Jan 2005 17:11:42 GMT
f3ce
&lt;script&gt;<!--
var js_load_time=(new Date()).getTime();var product_name =
â€˜Gmailâ€™;var js_version=â€™84b4499b9788adaâ€™;var
js_url=â€™/gmail?view=page&amp;name=js&amp;ver=84b4499b9788adaâ€™;
try {
THE REST OF THE JAVASCRIPT GOES HERE.
-->&lt;/script&gt;
0
192.168.016.053.64150-216.239.057.106.00080: GET /favicon.ico
HTTP/1.1
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/html/hist1.html HTTP/1.1
Continued
250 Appendix â€” Long Code Listings
Listing A-3 (continued)
Host: <a href="http://gmail.google.com">gmail.google.com</a>
Referer:
<a href="http://gmail.google.com/gmail?view=page&amp;name=js&amp;ver=84b4499b97">http://gmail.google.com/gmail?view=page&amp;name=js&amp;ver=84b4499b97</a>
88ada
Cookie: GV=101017c822e49-b58a8eed922f7d0f8c9e1901388b8beb;
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
J6wL_U141gaHs1;
GMAIL_LOGIN2=T1105895481223/1105895481223/1105895499818;
SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59; GMAIL_AT=58c7bf063b77e796-1017c822e4c;
S=gmail=ZnUe1o8mp44:gmproxy=kROzNYRS5DA; TZ=-60
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
Last-Modified: Sun, 09 Jan 2005 20:54:50 GMT
Cache-control: public
Expires: Mon, 16 Jan 2006 17:11:48 GMT
Content-Type: text/html
Server: GFE/1.3
Transfer-Encoding: chunked
Date: Sun, 16 Jan 2005 17:11:48 GMT
&lt;body onload=â€?OnLoad()â€?&gt;
&lt;script&gt;
function OnLoad() {
try {
if (top.js.init) {
top.js.HI_OnNavigateHistory();
}
} catch(e) {
}
}
var loaded = true;
&lt;/script&gt;
&lt;/body&gt;
0
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/html/hist2.html HTTP/1.1
Appendix â€” Long Code Listings 251
Host: <a href="http://gmail.google.com">gmail.google.com</a>
Referer:
<a href="http://gmail.google.com/gmail?view=page&amp;name=js&amp;ver=84b4499b97">http://gmail.google.com/gmail?view=page&amp;name=js&amp;ver=84b4499b97</a>
88ada
Cookie: GV=101017c822e49-b58a8eed922f7d0f8c9e1901388b8beb;
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
J6wL_U141gaHs1;
GMAIL_LOGIN2=T1105895481223/1105895481223/1105895499818;
SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59; GMAIL_AT=58c7bf063b77e796-1017c822e4c;
S=gmail=ZnUe1o8mp44:gmproxy=kROzNYRS5DA; TZ=-60
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
Last-Modified: Sun, 09 Jan 2005 20:54:50 GMT
Cache-control: public
Expires: Mon, 16 Jan 2006 17:11:49 GMT
Content-Type: text/html
Server: GFE/1.3
Transfer-Encoding: chunked
Date: Sun, 16 Jan 2005 17:11:49 GMT
&lt;body onload=â€?OnLoad()â€?&gt;
&lt;script&gt;
function OnLoad() {
try {
if (top.js.init) {
top.js.HI_OnNavigateHistory();
}
} catch(e) {
}
}
var loaded = true;
&lt;/script&gt;
&lt;/body&gt;
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0&amp;init=1&amp;zx=z6te3fe41hms
jo HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
Referer: <a href="http://gmail.google.com/gmail/html/hist2.html">http://gmail.google.com/gmail/html/hist2.html</a>
Continued
252 Appendix â€” Long Code Listings
Listing A-3 (continued)
Cookie: GV=101017c822e49-b58a8eed922f7d0f8c9e1901388b8beb;
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
J6wL_U141gaHs1;
GMAIL_LOGIN2=T1105895481223/1105895481223/1105895499818;
SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59; GMAIL_AT=58c7bf063b77e796-1017c822e4c;
S=gmail=ZnUe1o8mp44:gmproxy=kROzNYRS5DA; TZ=-60
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
Set-Cookie: SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59;Domain=.google.com;Path=/
Cache-control: no-cache
Pragma: no-cache
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Server: GFE/1.3
Date: Sun, 16 Jan 2005 17:11:49 GMT
&lt;html&gt;&lt;head&gt;&lt;meta content=â€?text/html; charset=UTF-8â€? httpequiv=â€?
content-typeâ€?&gt;&lt;/head&gt;&lt;script&gt;D=(top.js&amp;&amp;top.js.init)?fu
nction(d){top.js.P(window,d)}:function(){};if(window==top){top
.location=â€?/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0&amp;init=1&amp;zx=z
6te3fe41hmsjo&amp;fs=1â€?;}&lt;/script&gt;&lt;script&gt;<!--
D([â€œvâ€?,â€?84b4499b9788adaâ€?,â€?33fc762357568758â€?]
);
D([â€œudâ€?,â€?ben.hammersley@gmail.comâ€?,â€?{\â€?o\â€?:\â€?OPEN\â€?,\â€?/\â€?:\â€?SE
ARCH\â€?,\â€?\r\â€?:\â€?OPEN\â€?,\â€?k\â€?:\â€?PREV\â€?,\â€?r\â€?:\â€?REPLY\â€?,\â€?c\â€?:\
â€?COMPOSE\â€?,\â€?gc\â€?:\â€?GO_CONTACTS\â€?,\â€?gd\â€?:\â€?GO_DRAFTS\â€?,\â€?p\â€?:\
â€?PREVMSG\â€?,\â€?gi\â€?:\â€?GO_INBOX\â€?,\â€?m\â€?:\â€?IGNORE\â€?,\â€?a\â€?:\â€?REPLYA
LL\â€?,\â€?!\â€?:\â€?SPAM\â€?,\â€?f\â€?:\â€?FORWARD\â€?,\â€?u\â€?:\â€?BACK\â€?,\â€?ga\â€?:\â€?
GO_ALL\â€?,\â€?j\â€?:\â€?NEXT\â€?,\â€?y\â€?:\â€?REMOVE\â€?,\â€?n\â€?:\â€?NEXTMSG\â€?,\â€?g
s\â€?:\â€?GO_STARRED\â€?,\â€?x\â€?:\â€?SELECT\â€?,\â€?s\â€?:\â€?STAR\â€?}â€?,â€?344af70c
5dâ€?,â€?/gmail?view=page&amp;name=contacts&amp;ver=50c1485d48db7207â€?]
);
D([â€œsuâ€?,â€?33fc762357568758â€?,[â€œlâ€?,â€?/gmail/help/images/logo.gifâ€?,
â€?iâ€?,â€?Invite a friend to Gmailâ€?,â€?jâ€?,â€?Invite PH_NUM friends to
Gmailâ€?]
Appendix â€” Long Code Listings 253
]
);
D([â€œpâ€?,[â€œbx_hsâ€?,â€?1â€?]
,[â€œbx_show0â€?,â€?1â€?]
,[â€œbx_scâ€?,â€?0â€?
216.239.057.106.00080-192.168.016.053.64150: ]
,[â€œbx_peâ€?,â€?1â€?]
,[â€œbx_nsâ€?,â€?1â€?]
]
);
D([â€œppdâ€?,0]
);
D([â€œiâ€?,6]
);
D([â€œquâ€?,â€?1 MBâ€?,â€?1000 MBâ€?,â€?0%â€?,â€?#006633â€?]
);
D([â€œftâ€?,â€?Compose a message in a new window by pressing
\â€?Shift\â€? while clicking Compose Mail or Reply.â€?]
);
D([â€œdsâ€?,0,0,0,0,0,20,0]
);
D([â€œctâ€?,[]
]
);
D([â€œtsâ€?,0,50,1,0,â€?Inboxâ€?,â€?1017c824deeâ€?,1,]
);
D([â€œtâ€?,[â€œ101480d8ef5dc74aâ€?,0,0,â€?Jan 6â€?,â€?&lt;span
id=\â€™_user_ben@benhammersley.com\â€™&gt;Ben
Hammersley&lt;/span&gt;â€?,â€?&lt;b&gt;&raquo;&lt;/b&gt;&nbsp;â€?,â€?Here\â€™s a nice
message.â€?,,[]
,â€?â€?,â€?101480d8ef5dc74aâ€?,0,â€?Thu Jan 6 2005_4:44AMâ€?]
]
);
D([â€œteâ€?]);
//-->&lt;/script&gt;&lt;script&gt;var
fp=â€™9055a1297cd86ff2â€™;&lt;/script&gt;&lt;script&gt;var
loaded=true;D([â€˜eâ€™]);&lt;/script&gt;&lt;script&gt;try{top.js.L(window,43,â€™
204c380d43â€™);}catch(e){}&lt;/script&gt;
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/help/images/logo.gif
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
Continued
254 Appendix â€” Long Code Listings
Listing A-3 (continued)
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/images/corner_tl.gif
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/images/corner_bl.gif
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/images/star_on_sm_2.gif
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/images/corner_tr.gif
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/images/opentriangle.gif
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/images/corner_br.gif
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/images/star_off_2.gif
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail/images/chevron.gif
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail?view=page&amp;name=contacts&amp;ver=50c1485d48db7207 HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
Cookie: GV=101017c822e49-b58a8eed922f7d0f8c9e1901388b8beb;
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
Appendix â€” Long Code Listings 255
J6wL_U141gaHs1;
GMAIL_LOGIN2=T1105895481223/1105895481223/1105895499818;
SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59; GMAIL_AT=58c7bf063b77e796-1017c822e4c;
S=gmail=ZnUe1o8mp44:gmproxy=kROzNYRS5DA; TZ=-60; GMAIL_SU=1
Pragma: no-cache
Cache-Control: no-cache
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
Cache-control: private
Content-Type: text/html; charset=utf-8
Expires: Sat, 05 Feb 2005 17:11:53 GMT
ETag: â€œ50c1485d48db7207â€?
Last-Modified: Fri, 05 Sep 2003 02:11:15 GMT
Transfer-Encoding: chunked
Server: GFE/1.3
Date: Sun, 16 Jan 2005 17:11:53 GMT
56
[[â€œben@benhammersley.comâ€?,â€?Hacking Gmailâ€?]
,[â€œBHerrmann@wiley.comâ€?,â€?Brian Herrmannâ€?]
]
192.168.016.053.64150-216.239.057.106.00080: GET
/gmail?view=page&amp;name=blank_modal&amp;ver=6ae1910f12c398eb
HTTP/1.1
Host: <a href="http://gmail.google.com">gmail.google.com</a>
Referer:
<a href="http://gmail.google.com/gmail?view=page&amp;name=js&amp;ver=84b4499b97">http://gmail.google.com/gmail?view=page&amp;name=js&amp;ver=84b4499b97</a>
88ada
Cookie: GV=101017c822e49-b58a8eed922f7d0f8c9e1901388b8beb;
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
J6wL_U141gaHs1;
GMAIL_LOGIN2=T1105895481223/1105895481223/1105895499818;
SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59; GMAIL_AT=58c7bf063b77e796-1017c822e4c;
S=gmail=ZnUe1o8mp44:gmproxy=kROzNYRS5DA; TZ=-60; GMAIL_SU=1
Continued
256 Appendix â€” Long Code Listings
Listing A-3 (continued)
216.239.057.106.00080-192.168.016.053.64150: HTTP/1.1 200 OK
Cache-control: private
Content-Type: text/html; charset=utf-8
Expires: Sat, 05 Feb 2005 17:11:53 GMT
ETag: â€œ6ae1910f12c398ebâ€?
Last-Modified: Fri, 05 Sep 2003 02:11:15 GMT
Transfer-Encoding: chunked
Server: GFE/1.3
Date: Sun, 16 Jan 2005 17:11:53 GMT
&lt;html&gt;&lt;head&gt;&lt;style&gt;body{margin:0;background:#FFF}
body,td,button{font-family:sans-serif;font-size:85%}
.tl {
background-image: url(/gmail/images/corner_tl.gif);
background-position:top left;
background-repeat:no-repeat;
}
.tr {
background-image: url(/gmail/images/corner_tr.gif);
background-position:top right;
background-repeat:no-repeat;
}
.bl {
background-image: url(/gmail/images/corner_bl.gif);
background-position:bottom left;
background-repeat:no-repeat;
}
.br {
background-image: url(/gmail/images/corner_br.gif);
background-position:bottom right;
background-repeat:no-repeat;
}
.bubble {
background-color:#C3D9FF;
}
.button {vertical-align:middle;padding:0 10;margin:0 5}</em></p>

<h4>title {font-weight:bold;padding:2 10}</h4>

<h4>message {font-size:95%;padding:10 0 0 10}</h4>

<h4>buttons {text-align:center;margin-top:15}</h4>

<h4>main {border:2px #c3D9FF solid;padding:10 10 10 0}</h4>

<p>&lt;/style&gt;&lt;/head&gt;&lt;body&gt;
&lt;table id=main width=100% height=100% cellpadding=0
cellspacing=0&gt;
&lt;tr&gt;&lt;td&gt;
Appendix â€” Long Code Listings 257
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
192.168.016.053.64151-066.102.007.104.00080: GET /setgmail
HTTP/1.1
Host: <a href="http://www.google.com">www.google.com</a>
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O;
en-GB; rv:1.7.5) Gecko/20041110 Firefox/1.0
Accept: image/png,<em>/</em>;q=0.5
Accept-Language: en-gb,en;q=0.5
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer:
<a href="http://gmail.google.com/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0">http://gmail.google.com/gmail?ik=&amp;search=inbox&amp;view=tl&amp;start=0</a>
&amp;init=1&amp;zx=z6te3fe41hmsjo
Cookie:
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895484:S=fq
J6wL_U141gaHs1;
GMAIL_LOGIN2=1105895481223/1105895481223/1105895499818/1105895
502118/1105895508496/1105895509753/1105895510624/false/false;
SID=DQAAAGsAAADNYMqIE3HRTYLVLhMDesqryUuzAxHlGKckFg7QgImGX4Y7tBrplUvz8Z8NHOJCuVrRKX64rmEMzaSoS
TdAy3QWJ4WE2GSEN46IOOMzBr14uI0wGOX_3Fnd-WUQIFpDxFrpuMP5-
J5OPEVdaxV2Y59; S=gmail=ZnUe1o8mp44:gmproxy=kROzNYRS5DA
066.102.007.104.00080-192.168.016.053.64151: HTTP/1.1 204 No
Content
Set-Cookie:
PREF=ID=1ded507398eab78d:CR=1:TM=1105895484:LM=1105895514:GM=1
:S=7pA3w_PCISy_m6mm; expires=Sun, 17-Jan-2038 19:14:07 GMT;
path=/; <a href="http://domain=.google.com">domain=.google.com</a>
Content-Type: text/html
Server: GWS/2.1
Content-Length: 0
Date: Sun, 16 Jan 2005 17:11:54 GMT
258 Appendix â€” Long Code Listings
Chapter 13
Listing A-4: The HTML-Only Gmail Inbox Source
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Gmail - Inbox&lt;/title&gt;
&lt;meta http-equiv=Content-Type content=â€?text/html; charset=UTF-
8â€?&gt;
&lt;link rel=â€?stylesheetâ€? type=â€?text/cssâ€?
href=â€?/gmail/h/?view=page&amp;name=css&amp;ver=4e9d6884374d2804â€?&gt;
&lt;style type=â€?text/cssâ€?&gt;
@import
url(â€œ/gmail/h/?view=page&amp;name=css2&amp;ver=e5dcae215b68fea6â€?);
&lt;/style&gt;
&lt;base href=â€?http://gmail.google.com/gmail/h/1m0fzst8pmgu0/â€?&gt;
&lt;script
src=â€?/gmail?view=page&amp;name=browser&amp;ver=b8da0131e81235c4â€?&gt;
&lt;script
src=â€?/gmail/h/?view=page&amp;name=js&amp;ver=198b37c9e12e6f72â€?&gt;
&lt;/head&gt;
&lt;body bgcolor=#ffffff&gt;
&lt;table width=100% cellpadding=4 cellspacing=0 border=0
class=bn&gt;
&lt;tr&gt;
&lt;td id=bm bgcolor=#FAE5B0&gt;
&lt;b&gt;For a better Gmail experience, use a
fully supported browser. Â 
&lt;a href=â€?/support/bin/answer.py?ctx=gmail&amp;answer=15046â€?
target=_blank
&gt;Learn more&lt;/a&gt;&lt;/b&gt;
&lt;/td&gt;
&lt;/table&gt;
&lt;script&gt;
<!--
sbm()
//-->
&lt;/script&gt;
&lt;table width=100% cellpadding=0 cellspacing=0 border=0&gt;
&lt;tr&gt;
&lt;td width=143 rowspan=3&gt;
&lt;a href=â€??â€?&gt;
&lt;img src=â€?/gmail/help/images/logo.gifâ€?
Appendix â€” Long Code Listings 259
width=143 height=59 border=0
alt=â€?Gmail by Googleâ€?&gt;
&lt;/a&gt;
&lt;/td&gt;
&lt;td width=1 rowspan=3&gt;Â &lt;/td&gt;
&lt;td height=25 colspan=2 align=right valign=top&gt;
&lt;b&gt;ben.hammersley@gmail.com&lt;/b&gt; |
&lt;a href=â€??v=prâ€?&gt;Settings&lt;/a&gt; |
&lt;a href=â€?/support/?ctx=gmailâ€? target=_blank&gt;Help&lt;/a&gt; |
&lt;a href=â€??logoutâ€?&gt;Sign out&lt;/a&gt;
&lt;tr&gt;
&lt;form action=? name=sf method=GET&gt;
&lt;input type=hidden name=s value=q&gt;
&lt;td&gt;
&lt;table width=100% cellpadding=0 cellspacing=0 border=0&gt;
&lt;tr&gt;
&lt;td width=1% height=25 nowrap&gt;
&lt;input size=28 maxlength=2048
name=q value=â€?â€?
&gt;Â &lt;input type=submit name=site value=â€?Search Mailâ€?
&gt;Â &lt;input type=submit name=site value=â€?Search the Webâ€?&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;font size=1&gt;
Â &lt;a href=â€??v=as&amp;pv=tlâ€?
&gt;ShowÂ searchÂ options&lt;/a&gt;
&lt;/font&gt;
&lt;/form&gt;
&lt;/table&gt;
&lt;tr&gt;
&lt;td height=25 colspan=2&gt;
&lt;/table&gt;
&lt;table width=100% cellpadding=0 cellspacing=0 border=0&gt;
&lt;tr&gt;
&lt;td width=120 valign=top&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
class=m&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;b&gt;&lt;a href=â€??ct=n&amp;v=b&amp;pv=tlâ€?
&gt;ComposeÂ Mail&lt;/a&gt;&lt;/b&gt;
&lt;tr&gt;
&lt;td height=5&gt;
&lt;tr&gt;
&lt;td bgcolor=#C3D9FF&gt;
Continued
260 Appendix â€” Long Code Listings
Listing A-4 (continued)
&lt;b&gt;&lt;a href=â€??â€?
&gt;Inbox&lt;/a&gt;&lt;/b&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=râ€?
&gt;StarredÂ &lt;img src=â€?/gmail/images/star_on_sm_2.gifâ€?
width=13 height=13 border=0 alt=â€?starâ€?&gt;&lt;/a&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=sâ€?
&gt;Sent Mail&lt;/a&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=dâ€?
&gt;Drafts&lt;/a&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=aâ€?
&gt;All Mail&lt;/a&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;b&gt;&lt;a href=â€??s=mâ€?
&gt;SpamÂ (1)&lt;/a&gt;&lt;/b&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=tâ€?
&gt;Trash&lt;/a&gt;
&lt;tr&gt;
&lt;td height=8&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;b&gt;&lt;a href=â€??v=clâ€?&gt;Contacts&lt;/a&gt;&lt;/b&gt;
&lt;tr&gt;
&lt;td height=8&gt;
&lt;/table&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
class=l&gt;
&lt;tr&gt;
&lt;td class=lb&gt;
&lt;font color=#000000&gt;Labels&lt;/font&gt;&lt;br&gt;
&lt;a href=â€??l=Heads&amp;s=lâ€?&gt;&lt;font color=#006633
&gt;Heads&lt;/font&gt;&lt;/a&gt;
&lt;br&gt;
Appendix â€” Long Code Listings 261
&lt;a href=â€??l=Knees&amp;s=lâ€?&gt;&lt;font color=#006633
&gt;Knees&lt;/font&gt;&lt;/a&gt;
&lt;br&gt;
&lt;a href=â€??l=Shoulders&amp;s=lâ€?&gt;&lt;font color=#006633
&gt;Shoulders&lt;/font&gt;&lt;/a&gt;
&lt;br&gt;
&lt;a href=â€??l=Toes&amp;s=lâ€?&gt;&lt;font color=#006633
&gt;Toes&lt;/font&gt;&lt;/a&gt;
&lt;br&gt;
&lt;/td&gt;
&lt;/table&gt;
&lt;/td&gt;
&lt;td valign=top&gt;
&lt;table width=100% cellpadding=0 cellspacing=0 border=0&gt;
&lt;tr&gt;
&lt;td width=5 bgcolor=#C3D9FF&gt;Â &lt;/td&gt;
&lt;td&gt;
&lt;form action=â€??at=946adde382e122c-102ca495e7dâ€? name=f
method=POST&gt;
&lt;input type=hidden name=redir
value=â€??â€?&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
bgcolor=#C3D9FF&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;input type=submit name=a value=â€?Archiveâ€?&gt;Â Â &lt;input
type=submit name=a value=â€?Report Spamâ€?&gt;Â Â 
&lt;select name=tact&gt;
&lt;option value=â€?â€?&gt;More Actions...&lt;/option&gt;
&lt;option value=rd&gt;Mark as read&lt;/option&gt;
&lt;option value=ur&gt;Mark as unread&lt;/option&gt;
&lt;option value=st&gt;Add star&lt;/option&gt;
&lt;option value=xst&gt;Remove star&lt;/option&gt;
&lt;option value=tr&gt;Move to Trash&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;--------&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;Apply label:&lt;/option&gt;
&lt;option value=â€?ac_Headsâ€?
&gt;Heads
&lt;/option&gt;
&lt;option value=â€?ac_Kneesâ€?
&gt;Knees
&lt;/option&gt;
&lt;option value=â€?ac_Shouldersâ€?
&gt;Shoulders
&lt;/option&gt;
&lt;option value=â€?ac_Toesâ€?
Continued
262 Appendix â€” Long Code Listings
Listing A-4 (continued)
&gt;Toes
&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;--------&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;Remove label:&lt;/option&gt;
&lt;option value=â€?rc_Headsâ€?
&gt;Heads
&lt;/option&gt;
&lt;option value=â€?rc_Kneesâ€?
&gt;Knees
&lt;/option&gt;
&lt;option value=â€?rc_Shouldersâ€?
&gt;Shoulders
&lt;/option&gt;
&lt;option value=â€?rc_Toesâ€?
&gt;Toes
&lt;/option&gt;
&lt;/select&gt;Â &lt;input type=submit name=tbu value=Go&gt;Â 
&lt;a href=â€??â€?&gt;Refresh&lt;/a&gt;
&lt;/td&gt;
&lt;td align=right&gt;
&lt;b&gt;1Â -Â 5&lt;/b&gt; of &lt;b&gt;5&lt;/b&gt;
&lt;/table&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
bgcolor=#e8eef7 class=th&gt;
&lt;tr bgcolor=#E8EEF7&gt;
&lt;td width=1% nowrap&gt;
&lt;input type=checkbox name=t
value=â€?1025a4065d9b40bfâ€?&gt;
&lt;img src=â€?/gmail/images/cleardot.gifâ€?
width=15 height=15 border=0 alt=â€?â€?&gt;
&lt;/td&gt;
&lt;td width=30%&gt;
Ben Hammersley&lt;/td&gt;
&lt;td width=68%&gt;
&lt;a href=â€??th=1025a4065d9b40bf&amp;v=câ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;
&lt;/font&gt;&lt;/font&gt;
hello me
&lt;/a&gt;&lt;/td&gt;
&lt;td nowrap width=1%&gt;FebÂ 28
&lt;tr bgcolor=#E8EEF7&gt;
&lt;td&gt;
&lt;input type=checkbox name=t
Appendix â€” Long Code Listings 263
value=â€?10237338e99e7a8câ€?&gt;
&lt;/td&gt;
&lt;td &gt;
Ben Hammersley&lt;/td&gt;
&lt;td &gt;
&lt;a href=â€??th=10237338e99e7a8c&amp;v=câ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;
&lt;/font&gt;&lt;/font&gt;
This is the subject line
&lt;/a&gt;&lt;/td&gt;
&lt;td nowrap&gt;FebÂ 21
&lt;tr bgcolor=#E8EEF7&gt;
&lt;td&gt;
&lt;input type=checkbox name=t
value=â€?10187696869432e6â€?&gt;
&lt;/td&gt;
&lt;td &gt;
Ben, me (3)&lt;/td&gt;
&lt;td &gt;
&lt;a href=â€??th=10187696869432e6&amp;v=câ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;
&lt;/font&gt;&lt;/font&gt;
This is the third message
&lt;/a&gt;&lt;/td&gt;
&lt;td nowrap&gt;JanÂ 18
&lt;tr bgcolor=#E8EEF7&gt;
&lt;td&gt;
&lt;input type=checkbox name=t
value=â€?101865b95fc7a35aâ€?&gt;
&lt;/td&gt;
&lt;td &gt;
Ben Hammersley&lt;/td&gt;
&lt;td &gt;
&lt;a href=â€??th=101865b95fc7a35a&amp;v=câ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;
&lt;/font&gt;&lt;/font&gt;
This is the second message
&lt;/a&gt;&lt;/td&gt;
&lt;td nowrap&gt;JanÂ 18
&lt;tr bgcolor=#E8EEF7&gt;
&lt;td&gt;
&lt;input type=checkbox name=t
value=â€?101480d8ef5dc74aâ€?&gt;
&lt;img src=â€?/gmail/images/star_on_2.gifâ€?
width=15 height=15 border=0 alt=Starred&gt;
&lt;/td&gt;
Continued
264 Appendix â€” Long Code Listings
Listing A-4 (continued)
&lt;td &gt;
Ben Hammersley&lt;/td&gt;
&lt;td &gt;
&lt;a href=â€??th=101480d8ef5dc74a&amp;v=câ€?&gt;
&lt;font size=1&gt;&lt;font color=#006633&gt;
Heads
&lt;/font&gt;&lt;/font&gt;
Hereâ€™s a nice message.
&lt;/a&gt;&lt;/td&gt;
&lt;td nowrap&gt;JanÂ 6
&lt;/table&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
bgcolor=#C3D9FF&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;input type=submit name=a value=â€?Archiveâ€?&gt;Â Â &lt;input
type=submit name=a value=â€?Report Spamâ€?&gt;Â Â 
&lt;select name=bact&gt;
&lt;option value=â€?â€?&gt;More Actions...&lt;/option&gt;
&lt;option value=rd&gt;Mark as read&lt;/option&gt;
&lt;option value=ur&gt;Mark as unread&lt;/option&gt;
&lt;option value=st&gt;Add star&lt;/option&gt;
&lt;option value=xst&gt;Remove star&lt;/option&gt;
&lt;option value=tr&gt;Move to Trash&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;--------&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;Apply label:&lt;/option&gt;
&lt;option value=â€?ac_Headsâ€?
&gt;Heads
&lt;/option&gt;
&lt;option value=â€?ac_Kneesâ€?
&gt;Knees
&lt;/option&gt;
&lt;option value=â€?ac_Shouldersâ€?
&gt;Shoulders
&lt;/option&gt;
&lt;option value=â€?ac_Toesâ€?
&gt;Toes
&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;--------&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;Remove label:&lt;/option&gt;
&lt;option value=â€?rc_Headsâ€?
&gt;Heads
&lt;/option&gt;
Appendix â€” Long Code Listings 265
&lt;option value=â€?rc_Kneesâ€?
&gt;Knees
&lt;/option&gt;
&lt;option value=â€?rc_Shouldersâ€?
&gt;Shoulders
&lt;/option&gt;
&lt;option value=â€?rc_Toesâ€?
&gt;Toes
&lt;/option&gt;
&lt;/select&gt;Â &lt;input type=submit name=bbu value=Go&gt;Â 
&lt;a href=â€??â€?&gt;Refresh&lt;/a&gt;
&lt;/td&gt;
&lt;td align=right&gt;
&lt;b&gt;1Â -Â 5&lt;/b&gt; of &lt;b&gt;5&lt;/b&gt;
&lt;/table&gt;
&lt;/tr&gt;
&lt;/form&gt;
&lt;/table&gt;
&lt;table cellpadding=2 cellspacing=0 border=0 align=center
class=ft&gt;
&lt;tr&gt;
&lt;td align=center&gt;
Search accurately with &lt;a style=color:#0000CC target=_blank
href=â€?/support/bin/answer.py?ctx=gmail&amp;answer=7190â€?&gt;operators&lt;
/a&gt; including &lt;b&gt;from:&lt;/b&gt; Â &lt;b&gt;to:&lt;/b&gt;
Â &lt;b&gt;subject:&lt;/b&gt;.
&lt;tr&gt;
&lt;td align=center&gt;
&lt;font color=â€?#006633â€?&gt;
&lt;b&gt;You are currently using 1 MB
(0%)
of your 1000 MB.&lt;/b&gt;
&lt;/font&gt;
&lt;script&gt;
<!--
wsl();
//-->
&lt;/script&gt;
&lt;tr&gt;
&lt;td align=center&gt;
&lt;font size=1&gt;
&lt;a href=â€?/gmail/help/terms_of_use.htmlâ€?
target=_blank&gt;Terms of Use&lt;/a&gt; -
&lt;a href=â€?/gmail/help/privacy.htmlâ€?
target=_blank&gt;Privacy Policy&lt;/a&gt; -
Continued
266 Appendix â€” Long Code Listings
Listing A-4 (continued)
&lt;a href=â€?/gmail/help/program_policies.htmlâ€?
target=_blank&gt;Program Policies&lt;/a&gt; -
&lt;a href=â€?http://www.google.comâ€? target=_blank&gt;Google Home&lt;/a&gt;
&lt;/font&gt;
&lt;tr&gt;
&lt;td align=center&gt;
&lt;font size=1&gt;Â©2005 Google&lt;/font&gt;
&lt;/table&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
Listing A-5: Code That Produces Figure 13-2
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Gmail - hello me&lt;/title&gt;
&lt;meta http-equiv=Content-Type content=â€?text/html; charset=UTF-
8â€?&gt;
&lt;link rel=â€?stylesheetâ€? type=â€?text/cssâ€?
href=â€?/gmail/h/?view=page&amp;name=css&amp;ver=4e9d6884374d2804â€?&gt;
&lt;style type=â€?text/cssâ€?&gt;
@import
url(â€œ/gmail/h/?view=page&amp;name=css2&amp;ver=e5dcae215b68fea6â€?);
&lt;/style&gt;
&lt;base href=â€?http://gmail.google.com/gmail/h/gmqifu8n7ale/â€?&gt;
&lt;script
src=â€?/gmail?view=page&amp;name=browser&amp;ver=b8da0131e81235c4â€?&gt;
&lt;script
src=â€?/gmail/h/?view=page&amp;name=js&amp;ver=198b37c9e12e6f72â€?&gt;
&lt;/head&gt;
&lt;body bgcolor=#ffffff&gt;
&lt;table width=100% cellpadding=4 cellspacing=0 border=0
class=bn&gt;
&lt;tr&gt;
&lt;td id=bm bgcolor=#FAE5B0&gt;
&lt;b&gt;For a better Gmail experience, use a
fully supported browser. Â 
Appendix â€” Long Code Listings 267
&lt;a href=â€?/support/bin/answer.py?ctx=gmail&amp;answer=15046â€?
target=_blank
&gt;Learn more&lt;/a&gt;&lt;/b&gt;
&lt;/td&gt;
&lt;/table&gt;
&lt;script&gt;
<!--
sbm()
//-->
&lt;/script&gt;
&lt;table width=100% cellpadding=0 cellspacing=0 border=0&gt;
&lt;tr&gt;
&lt;td width=143 rowspan=3&gt;
&lt;a href=â€??â€?&gt;
&lt;img src=â€?/gmail/help/images/logo.gifâ€?
width=143 height=59 border=0
alt=â€?Gmail by Googleâ€?&gt;
&lt;/a&gt;
&lt;/td&gt;
&lt;td width=1 rowspan=3&gt;Â &lt;/td&gt;
&lt;td height=25 colspan=2 align=right valign=top&gt;
&lt;b&gt;ben.hammersley@gmail.com&lt;/b&gt; |
&lt;a href=â€??v=prâ€?&gt;Settings&lt;/a&gt; |
&lt;a href=â€?/support/?ctx=gmailâ€? target=_blank&gt;Help&lt;/a&gt; |
&lt;a href=â€??logoutâ€?&gt;Sign out&lt;/a&gt;
&lt;tr&gt;
&lt;form action=? name=sf method=GET&gt;
&lt;input type=hidden name=s value=q&gt;
&lt;td&gt;
&lt;table width=100% cellpadding=0 cellspacing=0 border=0&gt;
&lt;tr&gt;
&lt;td width=1% height=25 nowrap&gt;
&lt;input size=28 maxlength=2048
name=q value=â€?â€?
&gt;Â &lt;input type=submit name=site value=â€?Search Mailâ€?
&gt;Â &lt;input type=submit name=site value=â€?Search the Webâ€?&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;font size=1&gt;
Â &lt;a href=â€??th=1025a4065d9b40bf&amp;v=as&amp;pv=cvâ€?
&gt;ShowÂ searchÂ options&lt;/a&gt;
&lt;/font&gt;
&lt;/form&gt;
&lt;/table&gt;
&lt;tr&gt;
&lt;td height=25 colspan=2&gt;
&lt;/table&gt;
Continued
268 Appendix â€” Long Code Listings
Listing A-5 (continued)
&lt;table width=100% cellpadding=0 cellspacing=0 border=0&gt;
&lt;tr&gt;
&lt;td width=120 valign=top&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
class=m&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;b&gt;&lt;a href=â€??th=1025a4065d9b40bf&amp;ct=n&amp;v=b&amp;pv=cvâ€?
&gt;ComposeÂ Mail&lt;/a&gt;&lt;/b&gt;
&lt;tr&gt;
&lt;td height=5&gt;
&lt;tr&gt;
&lt;td bgcolor=#C3D9FF&gt;
&lt;b&gt;&lt;a href=â€??â€?
&gt;Inbox&lt;/a&gt;&lt;/b&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=râ€?
&gt;StarredÂ &lt;img src=â€?/gmail/images/star_on_sm_2.gifâ€?
width=13 height=13 border=0 alt=â€?starâ€?&gt;&lt;/a&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=sâ€?
&gt;Sent Mail&lt;/a&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=dâ€?
&gt;Drafts&lt;/a&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=aâ€?
&gt;All Mail&lt;/a&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;b&gt;&lt;a href=â€??s=mâ€?
&gt;SpamÂ (1)&lt;/a&gt;&lt;/b&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??s=tâ€?
&gt;Trash&lt;/a&gt;
&lt;tr&gt;
&lt;td height=8&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;b&gt;&lt;a href=â€??v=clâ€?&gt;Contacts&lt;/a&gt;&lt;/b&gt;
&lt;tr&gt;
Appendix â€” Long Code Listings 269
&lt;td height=8&gt;
&lt;/table&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
class=l&gt;
&lt;tr&gt;
&lt;td class=lb&gt;
&lt;font color=#000000&gt;Labels&lt;/font&gt;&lt;br&gt;
&lt;a href=â€??l=Heads&amp;s=lâ€?&gt;&lt;font color=#006633
&gt;Heads&lt;/font&gt;&lt;/a&gt;
&lt;br&gt;
&lt;a href=â€??l=Knees&amp;s=lâ€?&gt;&lt;font color=#006633
&gt;Knees&lt;/font&gt;&lt;/a&gt;
&lt;br&gt;
&lt;a href=â€??l=Shoulders&amp;s=lâ€?&gt;&lt;font color=#006633
&gt;Shoulders&lt;/font&gt;&lt;/a&gt;
&lt;br&gt;
&lt;a href=â€??l=Toes&amp;s=lâ€?&gt;&lt;font color=#006633
&gt;Toes&lt;/font&gt;&lt;/a&gt;
&lt;br&gt;
&lt;/td&gt;
&lt;/table&gt;
&lt;td valign=top&gt;
&lt;table width=100% cellpadding=0 cellspacing=0 border=0&gt;
&lt;tr&gt;
&lt;td width=5 bgcolor=#C3D9FF&gt;Â &lt;/td&gt;
&lt;td&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
bgcolor=#C3D9FF&gt;
&lt;form
action=â€??t=1025a4065d9b40bf&amp;at=b2e38396b0a9faf8-102e93a7156â€?
name=f method=POST&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;input type=hidden name=redir
value=â€??â€?&gt;
&lt;b&gt;&lt;a href=â€??â€?
&gt;Â« Back to Inbox&lt;/a&gt;&lt;/b&gt;Â Â 
&lt;input type=submit name=a value=â€?Archiveâ€?&gt;Â Â &lt;input
type=submit name=a value=â€?Report Spamâ€?&gt;
Â Â &lt;select name=tact&gt;
&lt;option value=â€?â€?&gt;More Actions...&lt;/option&gt;
&lt;option value=rd&gt;Mark as read&lt;/option&gt;
&lt;option value=ur&gt;Mark as unread&lt;/option&gt;
&lt;option value=st&gt;Add star&lt;/option&gt;
&lt;option value=xst&gt;Remove star&lt;/option&gt;
&lt;option value=tr&gt;Move to Trash&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;--------&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;Apply label:&lt;/option&gt;
Continued
270 Appendix â€” Long Code Listings
Listing A-5 (continued)
&lt;option value=â€?ac_Headsâ€?
&gt;Heads
&lt;/option&gt;
&lt;option value=â€?ac_Kneesâ€?
&gt;Knees
&lt;/option&gt;
&lt;option value=â€?ac_Shouldersâ€?
&gt;Shoulders
&lt;/option&gt;
&lt;option value=â€?ac_Toesâ€?
&gt;Toes
&lt;/option&gt;
&lt;/select&gt;Â &lt;input type=submit name=tbu value=Go&gt;
&lt;/td&gt;
&lt;td align=right&gt;
&lt;b&gt;1&lt;/b&gt; of &lt;b&gt;5&lt;/b&gt;
&lt;a
href=â€??next=1&amp;th=1025a4065d9b40bf&amp;v=câ€?&gt;&lt;b&gt;OlderÂ â€º
b&gt;&lt;/a&gt;
&lt;/tr&gt;
&lt;/form&gt;
&lt;/table&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
bgcolor=#E0ECFF&gt;
&lt;tr&gt;
&lt;td align=right&gt;
&lt;table cellpadding=0 cellspacing=0 border=0 class=ac&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=â€??th=1025a4065d9b40bf&amp;v=ptâ€? class=nu target=_blank
&gt;&lt;img src=â€?/gmail/images/print_icon.gifâ€?
width=16 height=16 border=0 alt=â€?Print conversationâ€?
&gt;Â &lt;span class=u&gt;Print&lt;/span&gt;&lt;/a&gt;Â Â Â 
&lt;/td&gt;
&lt;td&gt;
&lt;a href=â€??th=1025a4065d9b40bf&amp;v=câ€? class=nu target=_blank
&gt;&lt;img src=â€?/gmail/images/tearoff_icon.gifâ€?
width=16 height=16 border=0 alt=â€?Open conversation in new
windowâ€?
&gt;Â &lt;span class=u&gt;New window&lt;/span&gt;&lt;/a&gt;Â 
&lt;/td&gt;
&lt;/table&gt;
&lt;/table&gt;
&lt;table width=98% cellpadding=0 cellspacing=0 border=0
align=center class=h&gt;
&lt;tr&gt;
Appendix â€” Long Code Listings 271
&lt;td&gt;
&lt;font size=+1&gt;&lt;b&gt;hello me&lt;/b&gt;&lt;/font&gt;Â Â 
&lt;a href=â€??â€?
&gt;&lt;font size=1 color=#006633&gt;Inbox&lt;/font&gt;&lt;/a&gt;Â 
&lt;/table&gt;
&lt;table width=98% cellpadding=1 cellspacing=0 border=0
bgcolor=#cccccc
align=center&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a name=m_1025a4065d9b40bf&gt;&lt;/a&gt;
&lt;table width=100% cellpadding=1 cellspacing=0 border=0
bgcolor=#efefef&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a
href=â€??m=1025a4065d9b40bf&amp;a=st&amp;th=1025a4065d9b40bf&amp;at=b2e38396
b0a9faf8-102e93a7156&amp;v=c#m_1025a4065d9b40bfâ€?&gt;
&lt;img src=â€?/gmail/images/star_off_sm_2.gifâ€?
width=13 height=13 border=0 alt=â€?Add starâ€?&gt;&lt;/a&gt;Â 
&lt;font color=#00681C&gt;
&lt;b&gt;Ben Hammersley&lt;/b&gt;
&lt;/font&gt;
&lt;<a href="mailto:ben@benhammersley.com">ben@benhammersley.com</a>&gt;
&lt;/td&gt;
&lt;td align=right valign=top&gt;
Mon, Feb 28, 2005 at 10:35AM
&lt;tr&gt;
&lt;td colspan=2&gt;
To: Ben Hammersley &lt;<a href="mailto:ben.hammersley@gmail.com">ben.hammersley@gmail.com</a>&gt;
&lt;tr&gt;
&lt;td colspan=2&gt;
&lt;div class=r&gt;
&lt;font size=1&gt;
&lt;a
href=â€??rm=1025a4065d9b40bf&amp;th=1025a4065d9b40bf&amp;ct=rn&amp;v=b&amp;pv=cv
â€?&gt;Reply&lt;/a&gt; |
&lt;a
href=â€??rm=1025a4065d9b40bf&amp;th=1025a4065d9b40bf&amp;ct=ran&amp;v=b&amp;pv=c
vâ€?&gt;Reply to all&lt;/a&gt; |
&lt;a
href=â€??rm=1025a4065d9b40bf&amp;th=1025a4065d9b40bf&amp;ct=fn&amp;v=b&amp;pv=cv
â€?&gt;Forward&lt;/a&gt; |
&lt;a href=â€??msgs=1025a4065d9b40bf&amp;th=1025a4065d9b40bf&amp;v=ptâ€?
target=_blank&gt;Print&lt;/a&gt; |
&lt;a
href=â€??m=1025a4065d9b40bf&amp;a=dm&amp;at=b2e38396b0a9faf8-102e93a7156
â€?&gt;Trash this message&lt;/a&gt; |
Continued
272 Appendix â€” Long Code Listings
Listing A-5 (continued)
&lt;a href=â€??th=1025a4065d9b40bf&amp;v=omâ€? target=_blank&gt;Show
original&lt;/a&gt;
&lt;/font&gt;
&lt;/div&gt;
&lt;tr bgcolor=#ffffff&gt;
&lt;td colspan=2&gt;
&lt;div class=msg&gt;
hello!&lt;br&gt;&lt;br&gt;
&lt;/div&gt;
&lt;/table&gt;
&lt;a name=m_&gt;&lt;/a&gt;
&lt;table width=100% cellpadding=1 cellspacing=0 border=0
bgcolor=#e0ecff
class=qr&gt;
&lt;tr&gt;
&lt;td bgcolor=#c3d9ff&gt;
&lt;b&gt;Quick Reply&lt;/b&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;table width=1% cellpadding=0 cellspacing=0 border=0
bgcolor=#e0ecff&gt;
&lt;form
action=â€??rm=1025a4065d9b40bf&amp;fv=cv&amp;th=1025a4065d9b40bf&amp;at=b2e3
8396b0a9faf8-102e93a7156&amp;ct=qfnq&amp;v=b&amp;pv=cv&amp;qrt=nâ€?
name=qrf method=POST&gt;
&lt;input type=hidden name=redir
value=â€??v=câ€?&gt;
&lt;tr&gt;
&lt;td colspan=2&gt;
&lt;table width=100% cellpadding=1 cellspacing=0 border=0&gt;
&lt;tr&gt;
&lt;td width=99%&gt;
&lt;b&gt;To:&lt;/b&gt;
&lt;input type=hidden name=qrr value=o&gt;
Ben Hammersley &lt;<a href="mailto:ben@benhammersley.com">ben@benhammersley.com</a>&gt;
&lt;/td&gt;
&lt;td width=1% valign=bottom&gt;
&lt;input type=submit name=bu value=â€?More Reply Optionsâ€?&gt;
&lt;/td&gt;
&lt;/table&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;textarea name=body rows=10 cols=50 wrap=virtual&gt;
&lt;/textarea&gt;
&lt;tr&gt;
&lt;td&gt;
Appendix â€” Long Code Listings 273
&lt;input type=submit name=bu value=Send&gt;Â 
&lt;input type=submit name=bu value=â€?Save Draftâ€?&gt;Â 
&lt;input type=checkbox id=diqt name=diqt value=1 checked&gt;
&lt;label for=diqt&gt;Include quoted text with reply&lt;/label&gt;
&lt;/tr&gt;
&lt;/form&gt;
&lt;/table&gt;
&lt;/table&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;br&gt;
&lt;table width=100% cellpadding=2 cellspacing=0 border=0
bgcolor=#C3D9FF&gt;
&lt;form
action=â€??t=1025a4065d9b40bf&amp;at=b2e38396b0a9faf8-102e93a7156â€?
name=f method=POST&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;input type=hidden name=redir
value=â€??â€?&gt;
&lt;b&gt;&lt;a href=â€??â€?
&gt;Â« Back to Inbox&lt;/a&gt;&lt;/b&gt;Â Â 
&lt;input type=submit name=a value=â€?Archiveâ€?&gt;Â Â &lt;input
type=submit name=a value=â€?Report Spamâ€?&gt;
Â Â &lt;select name=bact&gt;
&lt;option value=â€?â€?&gt;More Actions...&lt;/option&gt;
&lt;option value=rd&gt;Mark as read&lt;/option&gt;
&lt;option value=ur&gt;Mark as unread&lt;/option&gt;
&lt;option value=st&gt;Add star&lt;/option&gt;
&lt;option value=xst&gt;Remove star&lt;/option&gt;
&lt;option value=tr&gt;Move to Trash&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;--------&lt;/option&gt;
&lt;option value=â€?â€? disabled&gt;Apply label:&lt;/option&gt;
&lt;option value=â€?ac_Headsâ€?
&gt;Heads
&lt;/option&gt;
&lt;option value=â€?ac_Kneesâ€?
&gt;Knees
&lt;/option&gt;
&lt;option value=â€?ac_Shouldersâ€?
&gt;Shoulders
&lt;/option&gt;
&lt;option value=â€?ac_Toesâ€?
&gt;Toes
&lt;/option&gt;
&lt;/select&gt;Â &lt;input type=submit name=bbu value=Go&gt;
&lt;/td&gt;
Continued
274 Appendix â€” Long Code Listings
Listing A-5 (continued)
&lt;td align=right&gt;
&lt;b&gt;1&lt;/b&gt; of &lt;b&gt;5&lt;/b&gt;
&lt;a
href=â€??next=1&amp;th=1025a4065d9b40bf&amp;v=câ€?&gt;&lt;b&gt;OlderÂ â€º
b&gt;&lt;/a&gt;
&lt;/tr&gt;
&lt;/form&gt;
&lt;/table&gt;
&lt;/table&gt;
&lt;table cellpadding=2 cellspacing=0 border=0 align=center
class=ft&gt;
&lt;tr&gt;
&lt;td align=center&gt;
Search accurately with &lt;a style=color:#0000CC target=_blank
href=â€?/support/bin/answer.py?ctx=gmail&amp;answer=7190â€?&gt;operators&lt;
/a&gt; including &lt;b&gt;from:&lt;/b&gt; Â &lt;b&gt;to:&lt;/b&gt;
Â &lt;b&gt;subject:&lt;/b&gt;.
&lt;tr&gt;
&lt;td align=center&gt;
&lt;font color=â€?#006633â€?&gt;
&lt;b&gt;You are currently using 1 MB
(0%)
of your 1000 MB.&lt;/b&gt;
&lt;/font&gt;
&lt;script&gt;
<!--
wsl();
//-->
&lt;/script&gt;
&lt;tr&gt;
&lt;td align=center&gt;
&lt;font size=1&gt;
&lt;a href=â€?/gmail/help/terms_of_use.htmlâ€?
target=_blank&gt;Terms of Use&lt;/a&gt; -
&lt;a href=â€?/gmail/help/privacy.htmlâ€?
target=_blank&gt;Privacy Policy&lt;/a&gt; -
&lt;a href=â€?/gmail/help/program_policies.htmlâ€?
target=_blank&gt;Program Policies&lt;/a&gt; -
&lt;a href=â€?http://www.google.comâ€? target=_blank&gt;Google Home&lt;/a&gt;
&lt;/font&gt;
&lt;tr&gt;
&lt;td align=center&gt;
&lt;font size=1&gt;Â©2005 Google&lt;/font&gt;
&lt;/table&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
SYMBOLS
backslash (/) keyboard shortcut, 18
exclamation (!) keyboard shortcut, 19
hyphen (-) operator, 24
parentheses ( ) operator, 25
quotes (â€œ â€œ) operator, 25
A
a keyboard shortcut, 19
abort( ) method, 59
addresses
contacts
adding contacts, 178â€“179
Contacts list, 177
current contacts, showing, 180
exporting contacts, 181â€“182
importing contacts, 178â€“179
header, 179
overview, 177
vCards, 181â€“182
advertising, removing Google, 51â€“52
after: operator, 25
All Mail folder, 196
AOL Instant Messenger, new mail count to, 144â€“149
Aquino, Jonathan (notepad use of Gmail), 207
Araujo, Robson Braga (random signatures), 115
array getAttachmentsOf( ) method, 120
array getStandardBox( ) method, 120
attachments
executables sent as, 23â€“24
overview, 155
sending, 166
B
backslash (/) keyboard shortcut, 18
bcc: operator, 25
before: operator, 25
Blanton, Justin (spam filters), 210
Bloglines, displaying, 92â€“100
bool connect( ) method, 119
bool connectNoCookie( ) method, 119
bool fetch( ) method, 119
bool fetchBox( ) method, 119
bool fetchContact( ) method, 119
bool getAttachment( ) method, 120
bool isconnected( ) method, 119
bool performAction( ) method, 120
bool send( ) method, 120
boot sequence
labels, 80
log for, cleaning up, 68
login procedure, 75
long code listings for edited, 243â€“257
steps for
cookie, setting code for, 71â€“74
inbox, loading, 74â€“80
logging in, 69â€“71
multiple messages in inbox, 76â€“78
one message in inbox, 78â€“79
reading an individual mail, 81â€“89
storage space, 80
watching, preparing for, 67â€“68
bottom section of screen
HTML code for, 43â€“44
overview, 42â€“43
box_name property, 123
box_pos property, 123
box_total property, 123
Brown, Jed (WebMailCompose), 7
C
c keyboard shortcut, 18
cc: operator, 25
central activity area of screen
HTML code for, 39â€“42
overview, 38
certain label, retrieving messages from, 170â€“171
checking for mail
in Perl
AOL Instant Messenger, new mail count to,
144â€“149
overview, 137â€“139
RSS, new mail count in, 137â€“139
in PHP, 139â€“140
in Python, 140â€“141
RSS, new mail count in, 142â€“144
using Libgmail, 139â€“140
using Mail::Webmail::Gmail
AOL Instant Messenger, new mail count to,
144â€“149
overview, 137â€“139
RSS, new mail count in, 142â€“144
combo-keys shortcuts, 19
command line, mounting GmailFS from, 216â€“217
Index
comma-separated values (CSV) file, 179
constants, 122â€“123
contacts
adding contacts, 178â€“179
Contacts list, 177
current contacts, showing, 180
exporting contacts, 181â€“182
importing contacts, 178â€“179
Contacts list, 177
contacts_all property, 125
contacts_freq property, 125
conv_id property, 124
conv_labels property, 124
conv_starred property, 124
conv_title property, 124
conv_total property, 124
cookie, setting code for, 71â€“74
Copy as XML function, 53
Couvreur, Julien (MailtoComposeInGmail), 111
CSS listing, long code listings for complete, 238â€“242
CSV (comma-separated values) file, 179
current contacts, showing, 180
customization
advertising, removing Google, 51â€“52
Gmail Lite, 45
new style, applying, 44
style sheets, 45â€“51
D
data
accessing all data of a message, 152
e-mail used to represent all, 220
datablock messages, 220
Delete button, adding, 101â€“108
delete_message( ) function, 131
desktop integration
mailto: link redirection
in Mac OS X, 8
for Mozilla, 7â€“8
for multiplatform, 7â€“8
overview, 6
in Windows, 7
new mail notification
in Linux, 5â€“6
in Mac OS X, 5
overview, 3
in Windows, 3â€“4
direct use of Gmail SMTP, 162
directory file, 219
directory messages, 220
DOM inspector
Copy as XML function, 53
interface with, 30â€“33
downloading
Gmailer, 118
Libgmail, 131
Mail::Webmail::Gmail, 127
Drafts folder, 196, 208
drives, using multiple, 217
E
edit_archive( ) function, 129
edit_labels( ) function, 128â€“129
edit_star( ) function, 129
Elson, Jeremy (Tcpflow), 62
Enter keyboard shortcut, 18
esc keyboard shortcut, 19
exclamation (!) keyboard shortcut, 19
existing labels
certain label, retrieving messages from, 170â€“171
listing, 169â€“173
retrieving a labeled message and replying, 171â€“173
exporting contacts, 181â€“182
exporting mail
to IMAP account, 200â€“201
Mail::Folder::Mbox module, 199
Mail::Internet module, 199
Mbox format conversion, 199â€“200
as text file, 197â€“198
F
f keyboard shortcut, 19
file entry messages, 220
file, identifying a, 218â€“219
File System in Userspace (FUSE), 215
file system, passing commands to, 217
filename: operator, 25
filters
overview, 21
and to-do lists, 203â€“204
Firefox, 44
first message in inbox, reading
Gmailer, 126
Libgmail, 134â€“135
folders
and HTML::TokeParser, 195â€“196
Inbox folder, 196
Sent Mail folder, 196
Spam folder, 196
Starred folder, 196
Trash folder, 196
from: operator, 24
276 Index â–  Câ€“F
fstab, mounting GmailFS from, 217
functions, 128â€“131
FUSE (File System in Userspace), 215
G
g then a keyboard shortcut, 19
g then c keyboard shortcut, 19
g then d keyboard shortcut, 19
g then i keyboard shortcut, 19
g then s keyboard shortcut, 19
Gan, Yin Hung (Gmailer), 118
gCount (Spindel), 5
getAllResponseHeaders( ) method, 59
get_contacts( ) function, 130
get_indv_email( ) function, 130
get_labels( ) function, 128
getMessagesByFolder method, 133
getMessagesByLabel method, 133
getMessagesByQuery method, 133
get_mime_email( ) function, 130
getQuotaInfo method, 134
getResponseHeader( ) method, 60
getUnreadMsgCount method, 134
GM_ACT_APPLYLABEL constant, 122
GM_ACT_ARCHIVE constant, 122
GM_ACT_DELFOREVER constant, 123
GM_ACT_INBOX constant, 122
GM_ACT_READ constant, 122
GM_ACT_REMOVELABEL constant, 122
GM_ACT_SPAM constant, 122
GM_ACT_STAR constant, 122
GM_ACT_TRASH constant, 123
GM_ACT_UNREAD constant, 122
GM_ACT_UNSPAM constant, 122
GM_ACT_UNSTAR constant, 122
GM_ACT_UNTRASH constant, 123
Gmail Lite, 45
Gmail Loader (Lyon), 11â€“12
Gmail SMTP
attachments, sending, 166
direct use of Gmail SMTP, 162
Mail::Webmail::Gmail and, 162â€“166
overview, 161â€“162
Perl and, 162â€“166
unread mail, reading and replying to, 163â€“166
Gmailer
array getAttachmentsOf( ) method, 120
array getStandardBox( ) method, 120
bool connect( ) method, 119
bool connectNoCookie( ) method, 119
bool fetch( ) method, 119
bool fetchBox( ) method, 119
bool fetchContact( ) method, 119
bool getAttachment( ) method, 120
bool isconnected( ) method, 119
bool performAction( ) method, 120
bool send( ) method, 120
box_name property, 123
box_pos property, 123
box_total property, 123
constants, 122â€“123
contacts_all property, 125
contacts_freq property, 125
conv_id property, 124
conv_labels property, 124
conv_starred property, 124
conv_title property, 124
conv_total property, 124
downloading, 118
first message in inbox, reading, 126
GM_ACT_APPLYLABEL constant, 122
GM_ACT_ARCHIVE constant, 122
GM_ACT_DELFOREVER constant, 123
GM_ACT_INBOX constant, 122
GM_ACT_READ constant, 122
GM_ACT_REMOVELABEL constant, 122
GM_ACT_SPAM constant, 122
GM_ACT_STAR constant, 122
GM_ACT_TRASH constant, 123
GM_ACT_UNREAD constant, 122
GM_ACT_UNSPAM constant, 122
GM_ACT_UNSTAR constant, 122
GM_ACT_UNTRASH constant, 123
GMailSnapshot get Snapshot( ) method, 120
gmail_ver property, 123
GM_CONTACT constant, 122
GM_CONVERSATION constant, 122
GM_LABEL constant, 122
GM_QUERY constant, 122
GM_STANDARD constant, 122
GM_USE_COOKIE constant, 123
GM_USE_PHPSESSION constant, 123
have_invit property, 123
inbox, retrieval of, 121â€“122
installation of, 118
label_list property, 123
label_new property, 123
logging in with, 120â€“121
methods for, 119â€“120
overview, 118
quota_mb property, 123
quota_per property, 123
Snapshots, 123â€“124
std_box_new property, 123
Continued
Index â–  Fâ€“G 277
Gmailer (continued)
string dump( ) method, 120
using, 119â€“126
void disconnect( ) method, 120
void setLoginInfo method, 119
void setProxy method, 119
void setSessionMethod method, 119
GmailerXP, 8
GmailFS
command line, mounting GmailFS from, 216â€“217
datablock messages, 220
directory messages, 220
drives, using multiple, 217
e-mail used to represent all data, 220
file entry messages, 220
file, identifying a, 218â€“219
file system, passing commands to, 217
fstab, mounting GmailFS from, 217
FUSE, installing, 215
how it works, 218
inode messages, 220
installation of, 213â€“215
Libgmail, installing, 215
overview, 213, 218
Python 2.3 needed for, 213â€“214
use of, 216â€“217
GmailFS ( Jones), 213
GmailSecure, 108â€“110
GMailSnapshot get Snapshot( ) method, 120
GmailStatus, 8
GmailStatus (Guenther), 5
Gmailto, 8
gmail_ver property, 123
GM_CONTACT constant, 122
GM_CONVERSATION constant, 122
GM_LABEL constant, 122
GM_QUERY constant, 122
GM_STANDARD constant, 122
gmtodo (Miller), 205
GM_USE_COOKIE constant, 123
GM_USE_PHPSESSION constant, 123
Goollery, 210
Greasemonkey
installation of, 91
overview, 91â€“92
userscripts
Bloglines, displaying, 92â€“100
Delete button, adding, 101â€“108
GmailSecure, 108â€“110
hide invites, 115
how it works, 100â€“101
HTTPS, forcing Gmail to use, 108â€“110
installation of, 92
MailtoComposeInGmail, 110â€“114
mark read button, 114â€“115
multiple signatures, 115
random signatures, 115
Guenther, Carsten (GmailStatus), 5
Gzip encoding, 64
H
hard link, 219
has:attachment operator, 24
have_invit property, 123
header, 179
heartbeat, Gmailâ€™s unencoded, 65â€“66
hiding invites, userscript for, 115
Holman, Allen (Mail::Webmail::Gmail), 127
HTML code. See also HTML version of Gmail
for bottom section of screen, 43â€“44
for central activity area, 39â€“42
long code listings
boot sequence, edited, 243â€“257
CSS listing, complete, 238â€“242
HTML-only Gmail inbox source, 258â€“266
inbox, displaying, 223â€“238
individual message page with only one message,
266â€“274
for navigation menu, 36â€“38
for top section of screen, 34â€“35
XMLHttpRequest, 56â€“59
HTML version of Gmail
All Mail folder, 196
Drafts folder, 196
HTML::TokeParser
folders and, 195â€“196
inbox, parsing, 188â€“192
individual page, retrieving, 192â€“194
overview, 186â€“188
threads and, 195
Inbox folder, 196
overview, 183
scraping
HTML::TokeParser, 186â€“194
overview, 186
Sent Mail folder, 196
Spam folder, 196
Starred folder, 196
Trash folder, 196
viewing, 183â€“185
HTML::TokeParser
folders and, 195â€“196
inbox, parsing, 188â€“192
individual page, retrieving, 192â€“194
278 Index â–  Gâ€“H
overview, 186â€“188
threads and, 195
HTTPS, forcing Gmail to use, 108â€“110
hyphen (-) operator, 24
I
IMAP (Internet Message Access Protocol)
exporting mail to, 200â€“201
integration into your existing mail accounts, 14
importing contacts, 178â€“179
importing your mail into Gmail
with Gmail Loader, 11â€“12
overview, 11
in:anywhere operator, 25
inbox
loading, 74â€“80
long code listings for, 223â€“238
parsing, 188â€“192
retrieval of, 121â€“122
Inbox folder, 196
individual message page with only one message, long code
listings for, 266â€“274
individual page, retrieving, 192â€“194
in:inbox operator, 25
inode, 219
inode messages, 220
in:spam operator, 25
installation
of FUSE, 215
of Gmailer, 118
of Greasemonkey, 91
of Libgmail, 132, 215
of Mail::Webmail::Gmail, 127
integration into your existing mail accounts
IMAP and, 14
importing your mail into Gmail
with Gmail Loader, 11â€“12
overview, 11
Pop mail access, setting up, 12â€“14
interface
bottom section of screen
HTML code for, 43â€“44
overview, 42â€“43
central activity area
HTML code for, 39â€“42
overview, 38
Delete button, adding, 101â€“108
with DOM inspector, 29â€“33
HTML code for
bottom section, 43â€“44
central activity area, 39â€“42
navigation menu, 36â€“38
top section, 34â€“35
navigation menu
HTML code for, 36â€“38
overview, 35â€“36
overview, 29â€“33
preloading, 54
top section of screen
HTML code for, 34â€“35
overview, 33â€“34
Internet Message Access Protocol (IMAP)
exporting mail to, 200â€“201
integration into your existing mail accounts, 14
in:trash operator, 25
is:read operator, 25
is:starred operator, 25
is:unread operator, 25
J
j keyboard shortcut, 18
Jones, Richard (GmailFS), 213
K
keyboard shortcuts
a key, 19
/ (backslash) key, 18
c key, 18
combo-keys shortcuts, 19
Enter key, 18
esc key, 19
! (exclamation) key, 19
f key, 19
g then a keys, 19
g then c keys, 19
g then d keys, 19
g then i keys, 19
g then s keys, 19
j key, 18
k key, 18
n key, 18
overview, 15â€“17
p key, 18
r key, 19
s key, 19
spam filters and, 17
tab then enter keys, 19
u key, 18
x key, 19
y key, 18
y then o keys, 19
L
label: operator, 24
label_list property, 123
label_new property, 123
Index â–  Hâ€“L 279
labels
existing labels
certain label, retrieving messages from, 170â€“171
listing, 169â€“173
retrieving a labeled message and replying, 171â€“173
new labels
creating, 175
unlabeled messages, labeling, 173â€“174
overview, 80, 169
removing labels, 175â€“176
Lawton, Jim (mark read button), 115
Lefort, Jean-Yves (Mail Notification), 6
Libgmail
checking for mail, 139â€“140
downloading, 131
first message in inbox, reading, 134â€“135
getMessagesByFolder method, 133
getMessagesByLabel method, 133
getMessagesByQuery method, 133
getQuotaInfo method, 134
getUnreadMsgCount method, 134
gmtodo, 205
installation of, 132, 215
login method, 132
overview, 131
using, 132â€“135
libraries
Gmailer
array getAttachmentsOf( ) method, 120
array getStandardBox( ) method, 120
bool connect( ) method, 119
bool connectNoCookie( ) method, 119
bool fetch( ) method, 119
bool fetchBox( ) method, 119
bool fetchContact( ) method, 119
bool getAttachment( ) method, 120
bool isconnected( ) method, 119
bool performAction( ) method, 120
bool send( ) method, 120
box_name property, 123
box_pos property, 123
box_total property, 123
constants, 122â€“123
contacts_all property, 125
contacts_freq property, 125
conv_id property, 124
conv_labels property, 124
conv_starred property, 124
conv_title property, 124
conv_total property, 124
downloading, 118
first message in inbox, reading, 126
GM_ACT_APPLYLABEL constant, 122
GM_ACT_ARCHIVE constant, 122
GM_ACT_DELFOREVER constant, 123
GM_ACT_INBOX constant, 122
GM_ACT_READ constant, 122
GM_ACT_REMOVELABEL constant, 122
GM_ACT_SPAM constant, 122
GM_ACT_STAR constant, 122
GM_ACT_TRASH constant, 123
GM_ACT_UNREAD constant, 122
GM_ACT_UNSPAM constant, 122
GM_ACT_UNSTAR constant, 122
GM_ACT_UNTRASH constant, 123
GMailSnapshot get Snapshot( )
method, 120
gmail_ver property, 123
GM_CONTACT constant, 122
GM_CONVERSATION constant, 122
GM_LABEL constant, 122
GM_QUERY constant, 122
GM_STANDARD constant, 122
GM_USE_COOKIE constant, 123
GM_USE_PHPSESSION constant, 123
have_invit property, 123
inbox, retrieval of, 121â€“122
installation of, 118
label_list property, 123
label_new property, 123
logging in with, 120â€“121
methods for, 119â€“120
overview, 118
quota_mb property, 123
quota_per property, 123
Snapshots, 123â€“124
std_box_new property, 123
string dump( ) method, 120
using, 119â€“126
void disconnect( ) method, 120
void setLoginInfo method, 119
void setProxy method, 119
void setSessionMethod method, 119
Libgmail
downloading, 131
first message in inbox, reading, 134â€“135
getMessagesByFolder method, 133
getMessagesByLabel method, 133
getMessagesByQuery method, 133
getQuotaInfo method, 134
getUnreadMsgCount method, 134
installation of, 132
login method, 132
overview, 131
using, 132â€“135
280 Index â–  L
Mail::Webmail::Gmail
delete_message( ) function, 131
downloading, 127
edit_archive( ) function, 129
edit_labels( ) function, 128â€“129
edit_star( ) function, 129
functions, 128â€“131
get_contacts( ) function, 130
get_indv_email( ) function, 130
get_labels( ) function, 128
get_mime_email( ) function, 130
installation of, 127
logging in, 128
overview, 127
send_message( ) function, 131
size_usage( ) function, 130
update_prefs( ) function, 129
using, 128â€“131
overview, 117
Perl
libwww-perl module, 136
MailFolder module, 136
MD5 module, 136
MIME-Base64 module, 136
MIME-tools module, 136
Utils.pm module, 135
for PHP coders, 118â€“126
libwww-perl module, 136
Lieuallen, Anthony (Delete button, adding), 101
listing existing labels, 169â€“173
listing mail and displaying chosen message, 153â€“155
Liyanage, Marc (OS X package), 62
login method, 132
login procedure
boot sequence and, 69â€“71, 75
with Gmailer, 120â€“121
Mail::Webmail::Gmail, 128
long code listings
boot sequence, edited, 243â€“257
CSS listing, complete, 238â€“242
HTML-only Gmail inbox source, 258â€“266
inbox, displaying, 223â€“238
individual message page with only one message,
266â€“274
Lyon, Mark (Gmail Loader), 11â€“12
M
Mac OS X
gCount, 5
GmailStatus, 5
mailto: link redirection, 8
new mail notification, 5
Mail Notification (Lefort), 6
MailFolder module, 136
Mail::Folder::Mbox module, 199
Mail::Internet module, 199
mailto: link redirection
in Mac OS X, 8
for Mozilla, 7â€“8
for multiplatform, 7â€“8
overview, 6
in Windows, 7
MailtoComposeInGmail, 110â€“114
MailtoComposeInGmail (Couvreur), 111
Mail::Webmail::Gmail
all data of a message, accessing, 152
AOL Instant Messenger, new mail count to, 144â€“149
attachments, 155
delete_message( ) function, 131
downloading, 127
edit_archive( ) function, 129
edit_labels( ) function, 128â€“129
edit_star( ) function, 129
functions, 128â€“131
get_contacts( ) function, 130
get_indv_email( ) function, 130
get_labels( ) function, 128
get_mime_email( ) function, 130
installation of, 127
listing mail and displaying chosen message, 153â€“155
logging in, 128
overview, 127
reading mail, 151â€“152
RSS feed of inbox, creating, 155â€“159
RSS, new mail count in, 142â€“144
sending mail and, 162â€“166
send_message( ) function, 131
size_usage( ) function, 130
update_prefs( ) function, 129
using, 128â€“131
mark read button, userscript for, 114â€“115
marking a group of e-mails, 23
Mbox format conversion, 199â€“200
MD5 module, 136
Medina, Matias Daniel (Goollery), 210
metadata, 219
methods for Gmailer, 119â€“120
Miller, Paul (gmtodo), 205
MIME-Base64 module, 136
MIME-tools module, 136
Mozilla, 7â€“8
multiplatforms, 7â€“8
multiple messages in inbox, 76â€“78
multiple signatures, userscript for, 115
Index â–  Lâ€“M 281
N
n keyboard shortcut, 18
navigation menu
HTML code for, 36â€“38
overview, 35â€“36
Neale, Chris (URIid extension), 44
network traffic
boot sequence
log for, cleaning up, 68
steps for, 68â€“89
watching, preparing for, 67â€“68
overview, 62
Tcpflow
Gzip encoding, 64
heartbeat, Gmailâ€™s unencoded, 65â€“66
new mail, checking for, 63â€“65
overview, 62
new labels
creating, 175
unlabeled messages, labeling, 173â€“174
new mail, checking for, 63â€“65
new mail notification
in Linux
Mail Notification, 6
overview, 5
Wmgmail, 6
in Mac OS X, 5
in Windows
Gmail Notifier, 4
Mozilla Gmail Notifier, 4
overview, 3
new style, applying, 44
newsreaders
overview, 205
torrent files, finding, 206
notepad application, using Gmail as, 207â€“208
O
object methods
abort( ) method, 59
getAllResponseHeaders( ) method, 59
getResponseHeader( ) method, 60
open( ) method, 60
send( ) method, 60
setRequestHeader( ) method, 60
object properties
onreadystatechange property, 60
readyState property, 60
responseText property, 60
responseXML property, 60
status property, 60
statusText property, 60
one message in inbox, 78â€“79
onreadystatechange property, 60
open( ) method, 60
OR operator, 24
OS X package (Liyanage), 62
P
p keyboard shortcut, 18
parentheses ( ) operator, 25
Parparita, Mihai (style sheet), 51
password needed for sending mail, 161
Pederick, Chris (Web Developer Extension), 29
Perl
all data of a message, accessing, 152
AOL Instant Messenger, new mail count to, 144â€“149
attachments, 155
libwww-perl module, 136
listing mail and displaying chosen message, 153â€“155
MailFolder module, 136
MD5 module, 136
MIME-Base64 module, 136
MIME-tools module, 136
reading mail, 151â€“152
RSS feed of inbox, creating, 155â€“159
RSS, new mail count in, 137â€“139
sending mail and, 162â€“166
Utils.pm module, 135
photo gallery, using Gmail as storage for a, 210
PHP
checking for mail, 139â€“140
Goollery, 210
libraries for coders, 118â€“126
Pilgrim, Mark (GmailSecure), 108
plus addressing, 20â€“23
Pop mail access, setting up, 12â€“14
power tips
attachments, sending executables as, 23â€“24
filtering, 21
keyboard shortcuts
a key, 19
/ (backslash) key, 18
c key, 18
combo-keys shortcuts, 19
Enter key, 18
esc key, 19
! (exclamation) key, 19
f key, 19
g then a keys, 19
g then c keys, 19
g then d keys, 19
g then i keys, 19
g then s keys, 19
282 Index â–  Nâ€“P
j key, 18
k key, 18
n key, 18
overview, 15â€“17
p key, 18
r key, 19
s key, 19
spam filters and, 17
tab then enter keys, 19
u key, 18
x key, 19
y key, 18
y then o keys, 19
marking a group of e-mails, 23
plus addressing, 20â€“23
searching, advanced, 24â€“26
preloading interface, 54
Pygtk, 205
Python
checking for mail, 140â€“141
gmtodo, 205
Python 2.3, 213â€“214
Q
quota_mb property, 123
quota_per property, 123
quotes (â€œ â€œ) operator, 25
R
r keyboard shortcut, 19
random signatures, userscript for, 115
reading mail
individual mail, 81â€“89
with Perl
all data of a message, accessing, 152
attachments, 155
listing mail and displaying chosen message,
153â€“155
overview, 151â€“152
RSS feed of inbox, creating, 155â€“159
Utils.pm module used for, 153â€“155
readyState property, 60
removing labels, 175â€“176
responseText property, 60
responseXML property, 60
retrieving a labeled message and replying, 171â€“173
RSS feeds
of inbox, creating, 155â€“159
new mail count in, 142â€“144
overview, 205
torrent files, finding, 206
S
s keyboard shortcut, 19
Savolainen, Pasi (Wmgmail), 6
scraping HTML::TokeParser, 186â€“194
search operators
after: operator, 25
bcc: operator, 25
before: operator, 25
cc: operator, 25
filename: operator, 25
from: operator, 24
has:attachment operator, 24
- (hyphen) operator, 24
in:anywhere operator, 25
in:inbox operator, 25
in:read operator, 25
in:spam operator, 25
in:starred operator, 25
in:trash operator, 25
in:unread operator, 25
label: operator, 24
OR operator, 24
overview, 26
( ) (parentheses) operator, 25
â€œ â€œ (quotes) operator, 25
subject: operator, 24
to: operator, 24
overview, 186
searching, advanced, 24â€“26
send( ) method, 60
sending mail
with Gmail SMTP
attachments, sending, 166
direct use of, 162
Mail::Webmail::Gmail and, 162â€“166
overview, 161â€“162
Perl and, 162â€“166
unread mail, reading and replying to, 163â€“166
password needed for, 161
send_message( ) function, 131
Sent Mail folder, 196
setRequestHeader( ) method, 60
size_usage( ) function, 130
Snapshots, 123â€“124
spam filters, 17, 209â€“210
Spam folder, 196
Spindel, Nathan (gCount), 5
Starred folder, 196
status property, 60
statusText property, 60
std_box_new property, 123
storage space, 80
Index â–  Pâ€“S 283
string dump( ) method, 120
style sheets, 45â€“51
style sheets (Parparita), 51
subject: operator, 24
T
tab then enter keyboard shortcut, 19
Tcpflow
Gzip encoding, 64
heartbeat, Gmailâ€™s unencoded, 65â€“66
new mail, checking for, 63â€“65
overview, 62
thread, retrieving a, 83â€“88
trace from reading a message, 81â€“83
Tcpflow (Elson), 62
text-editing, 208
text file, exporting mail as, 197â€“198
threads
and HTML::TokeParser, 195
retrieving, 83â€“88
to: operator, 24
to-do lists
filters and, 203â€“204
gmtodo, using, 205
overview, 203
top section of screen
HTML code for, 34â€“35
overview, 33â€“34
torrent files, finding, 206
trace from reading a message, 81â€“83
Trash folder, 196
U
u keyboard shortcut, 18
unlabeled messages, labeling, 173â€“174
unread mail, reading and replying to, 163â€“166
update_prefs( ) function, 129
URIid extension (Neale), 44
userscripts
Bloglines, displaying, 92â€“100
Delete button, adding, 101â€“108
GmailSecure, 108â€“110
hide invites, 115
how it works, 100â€“101
HTTPS, forcing Gmail to use, 108â€“110
installation of, 92
MailtoComposeInGmail, 110â€“114
mark read button, 114â€“115
multiple signatures, 115
random signatures, 115
Utils.pm module, 135, 153â€“155
V
vCards, 181â€“182
viewing HTML version of Gmail, 183â€“185
Villegas, Andres (Goollery), 210
void disconnect( ) method, 120
void setLoginInfo method, 119
void setProxy method, 119
void setSessionMethod method, 119
W Web Developer Extension (
Pederick), 29
WebMailCompose (Brown), 7
Windows
Gmail Notifier, 4
mailto: link redirection, 7
Mozilla Gmail Notifier, 4
new mail notification, 3â€“4
overview, 3
Wirz, Martin (Goollery), 210
Wmgmail (Savolainen), 6
X
x keyboard shortcut, 19
XMLHttpRequest
within Gmail code, 61
HTML code for, 56â€“59
object methods, 59â€“60
object properties, 60
overview, 55
using yourself, 55â€“60
Y
y keyboard shortcut, 18
y then o keyboard shortcut, 19
284 Index â–  Sâ€“Y
Magazine
The most hardcore technology magazine
out there, for the do-it-yourselfers who
jump at the chance to be involved with
the latest and greatest technology products.
AVAILABLE NOW ON NEWSSTANDS
EVERYWHERE!
IF YOU ENJOYED THIS EXTREMETECH BOOK YOUâ€™LL LOVE...
Howto take it
to the Extreme.
Available wherever books are sold.
Wiley and the Wiley logo are trademarks of John Wiley &amp; Sons, Inc. and/or its affiliates. The ExtremeTech logo is a trademark of Ziff
Davis Publishing Holdings, Inc. Used under license. All other trademarks are the property of their respective owners.
â„¢
If you enjoyed this book,
there are many others like
it for you. From Podcasting
to Hacking Firefox,
ExtremeTech books can
fulfill your urge to hack,
tweak and modify,
providing the tech tips and
tricks readers need to get
the most out of their
hi-tech lives.
<a href="http://www.violli.kiev.ua">http://www.violli.kiev.ua</a></p>

  
</div>

<div class="result">
<h2 class="title">
<a href="/user/noah">noah</a>/<a href="/snippet/perl/show-jpegs-in-this-directory-in-a-simple-html-gallery">show JPEGs in this directory in a simple HTML gallery</a>
<span class="language">(<a href="/language/perl/"> Perl</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: perl;">
#! /usr/bin/perl -w
use strict;

#****************************************************************
# To Do: display a thumbnail link to every image on every page  *
#****************************************************************



####
my $start;
print &quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Images In This Directory&lt;/title&gt;&lt;/head&gt;\n&quot;;
####
print &lt;&lt;BEGINSCRIPT;
&lt;script type=&quot;text/javascript&quot;&gt;
var counter = -1;
var showstuff = new Array();
BEGINSCRIPT
####
print &quot;showstuff=[&quot;;
####
while (&lt;*\.jp*&gt;) {    #regex scans working directory and captures any filename with extension beginning &quot;JP&quot;
    print &quot;\&quot;$_\&quot;,&quot;;  #print each file name into the array
    $start = $_;
}
####
print &quot;];\n&quot;;
####
print &lt;&lt;STARTHTML;
function next () {
    if (showstuff[counter] != &quot;&quot; &amp;amp;&amp;amp; counter &lt; showstuff.length-1) {
          document.graphic.src=showstuff[++counter];
	  }
    else {
          counter = -1;
	  next();
	  }
}
function back () {
    if (showstuff[counter] != &quot;&quot; &amp;amp;&amp;amp; counter &gt; 0) {
          document.graphic.src=showstuff[--counter];
	  }
    else {
          counter = showstuff.length;
	  back();
	  }
}
&lt;/script&gt;&lt;body&gt;
&lt;p style=&quot;text-align:center&quot;&gt;
&lt;img src=&quot;&quot; alt=&quot;Click one of the links below to see a different image.&quot; name=&quot;graphic&quot; width=&quot;900&quot;  /&gt;
&lt;p  style=&quot;text-align:center&quot;&gt;
&lt;a href=&quot;javascript:back();&quot; style=&quot;font-size:30pt;font-weight:bold;&quot;&gt;&lt;-- BACK&lt;/a&gt;
...
&lt;a href=&quot;javascript:next();&quot; style=&quot;font-size:30pt;font-weight:bold;&quot;&gt;NEXT --&gt;&lt;/a&gt;
&lt;/body&gt;&lt;/html&gt;


&lt;script&gt;next();&lt;/script&gt;

STARTHTML
</pre>
</div>
<br>
<p>Creates an HTML page with the first image in the directory in the center.  Forward and Back buttons scroll through all the images in the directory in order.</p>

<p>This is how I lived before Firefox ~.^</p>

</div>

<div class="result">
<h2 class="title">
<a href="/user/tclancy">tclancy</a>/<a href="/snippet/csharp/net-html-formatter">.NET HTML Formatter</a>
<span class="language">(<a href="/language/csharp/"> C#</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: csharp;">
using System;
using System.Collections.Generic;
using System.Text;
using System.Text.RegularExpressions;
using System.Collections;

using TidyATL;

using ProjectName.Core.Interfaces;

namespace ProjectName.Core.Content
{
    public class HtmlFormatter : IFormatter
    {
        private string _contents;
        private Hashtable _tagMap = new Hashtable();
        private ArrayList _singleTags = new ArrayList();
        private string _urlPlaceholder = &quot;[** URL_ROOT **]&quot;;

        public HtmlFormatter(string content)
        {  
            this._contents = content;
            this.Setup();
        }

        private void Setup()
        {
            // create a lookup table for tags:
            // key = tag
            // -1 = strip tag and contents inside tag completely
            //  0 = allow tag, no attributes
            //  1 = allow tag with attributes
            //  N.B., all other tags should be stripped
            this._tagMap.Add(&quot;head&quot;, -1);
            this._tagMap.Add(&quot;select&quot;, -1);
            this._tagMap.Add(&quot;input&quot;, -1);
            this._tagMap.Add(&quot;script&quot;, -1);
            this._tagMap.Add(&quot;noscript&quot;, -1);
            this._tagMap.Add(&quot;xmp&quot;, -1);
            this._tagMap.Add(&quot;style&quot;, -1);
            this._tagMap.Add(&quot;a&quot;, 1);
            this._tagMap.Add(&quot;table&quot;, 1);
            this._tagMap.Add(&quot;tr&quot;, 1);
            this._tagMap.Add(&quot;th&quot;, 1);
            this._tagMap.Add(&quot;td&quot;, 1);
            this._tagMap.Add(&quot;ul&quot;, 0);
            this._tagMap.Add(&quot;ol&quot;, 0);
            this._tagMap.Add(&quot;li&quot;, 0);
            this._tagMap.Add(&quot;p&quot;, 1);
            this._tagMap.Add(&quot;xml&quot;, 1);
            this._tagMap.Add(&quot;img&quot;, 1);
            this._tagMap.Add(&quot;br&quot;, 0);
            this._tagMap.Add(&quot;hr&quot;, 0);
            this._tagMap.Add(&quot;b&quot;, 0);
            this._tagMap.Add(&quot;strong&quot;, 0);
            this._tagMap.Add(&quot;i&quot;, 0);
            this._tagMap.Add(&quot;u&quot;, 0);
            this._tagMap.Add(&quot;strike&quot;, 0);
            this._tagMap.Add(&quot;sup&quot;, 0);
            this._tagMap.Add(&quot;sub&quot;, 0);
            this._tagMap.Add(&quot;iframe&quot;, 1);
        }

        #region IFormatter Members

        public string Render()
        {
            // fix links
            formatMe = this.ReplaceRelativeUrlPlaceholder(formatMe);

            // find assets

            return formatMe;
        }

        public string Clean()
        {
            string formatMe = this.CleanTags(this._contents);
            return formatMe;
        }
        #endregion

        #region HTML Markup Handling

        private string InsertRelativeUrlPlaceholder(string input)
        {
            string formatMe = input;
            string searchTerm = System.Configuration.ConfigurationManager.AppSettings[&quot;URL_ROOT&quot;];

            if (formatMe.IndexOf(searchTerm) &gt; -1) 
            {
                Regex reg = new Regex(searchTerm);
                MatchCollection matches = reg.Matches(formatMe);
                foreach (Match m in matches)
                {
                    formatMe = formatMe.Replace(m.ToString(), this._urlPlaceholder);
                }
            }
            return formatMe;
        }

        private string ReplaceRelativeUrlPlaceholder(string input)
        {
            string formatMe = input;
            formatMe = formatMe.Replace(this._urlPlaceholder, System.Configuration.ConfigurationManager.AppSettings[&quot;URL_ROOT&quot;]);
            return formatMe;
        }   

        private string TidyHTML(string input)
        {
            Tidy.Document doc = new Tidy.Document();

            //doc.OnMessage += new Tidy.IDocumentEvents_OnMessageEventHandler(TidyDiagnostics);

            // set some options
            doc.SetOptBool(TidyOptionId.TidyBodyOnly, 1);
            doc.SetOptBool(TidyOptionId.TidyXhtmlOut, 1);
            doc.SetOptBool(TidyOptionId.TidyWord2000, 1);
            doc.SetOptValue(TidyOptionId.TidyIndentContent, &quot;auto&quot;);


            int err_code = doc.ParseString(input);
            if (err_code &lt; 0)
            {
                throw new Exception(&quot;Unable to parse string: &quot; + input);
            }

            err_code = doc.CleanAndRepair();

            if (err_code &lt; 0)
            {
                throw new Exception(&quot;Unable to clean/repair string: &quot; + input);
            }

            //err_code = doc.RunDiagnostics();

            //if (err_code &lt; 0)
            //{
            //    throw new Exception(&quot;Unable to run diagnostics on: &quot; + input);
            //}

            return(doc.SaveString().Trim());
        }

        public void TidyDiagnostics(TidyATL.TidyReportLevel level, int line, int col, string message)
        {
            Console.WriteLine(&quot;Tidy diagnostic message: &quot; + message);
        }

        private int InStrEndOfTag (string input)
        {
            bool attr = false;
            int pos = 0;

            while (pos &lt; input.Length)
            {
                pos++;
                if (!attr &amp;amp;&amp;amp; (input.Substring(pos, 1) == &quot;&gt;&quot;))
                {
                    return pos;
                }

                if (input.Substring(pos, 1) == &quot;&quot;)
                {
                    attr = !attr;
                }
            }

            return pos;
        }

        private string RemoveExtraTags(string input)
        {
            string temp = input;
            string output = &quot;&quot;;
            int pos;
            string tag, name;
            
            while (temp != &quot;&quot;)
            {
                if (temp.Substring(0, 1) == &quot;&lt;&quot;)
                {
                    pos = InStrEndOfTag(temp);
                    if (pos == 0)
                    {
                        tag = temp.Substring(2);
                        temp = &quot;&quot;;
                    }
                    else
                    {
                        tag = temp.Substring(1, pos - 1);
                        temp = temp.Substring(pos + 1);
                    }

                    name = tag.Split(new Char[] { ' ' })[0].ToLower();
                    
                    if (name.Substring(0, 1) == &quot;/&quot;)
                    {
                        name = name.Substring(1);
                    }

                    if (this._tagMap.Contains(name))
                    {
                        int val = Convert.ToInt32(this._tagMap[name].ToString());
                        switch (val)
                        {
                            case -1:
                                pos = temp.ToLower().IndexOf(&quot;&lt;/&quot; + name + &quot;&gt;&quot;);
                                if (pos &gt; 0)
                                {
                                    temp = temp.Substring(pos + name.Length + 3);
                                }
                                break;
                            case 0:
                                output += &quot;&lt;&quot;;
                                if (tag.Substring(0, 1) == &quot;/&quot;)
                                {
                                    output += &quot;/&quot;;
                                }
                                output += name + &quot;&gt;&quot;;
                                break;
                            case 1:
                                output += &quot;&lt;&quot; + tag + &quot;&gt;&quot;;
                                break;
                            default:
                                break;
                        }
                    }
                }
                else
                {
                    output += temp.Substring(0,1);
                    temp = temp.Substring(1);
                }
            }

            return output;
        }

        private string CleanTags(string input)
        {
            // run HTML Tidy on content
            string formatMe = this.TidyHTML(input.Trim());
            
            // get rid of comments first to make tag balancing a little easier
            formatMe = this.StripComments(formatMe);

            // remove attributes that are unacceptable in any case (e.g., JavaScript attributes, CSS)
            formatMe = this.ReplaceNastyAttributes(formatMe);

            formatMe = RemoveExtraTags(formatMe);

            // substitute placeholder for relative links
            formatMe = this.InsertRelativeUrlPlaceholder(formatMe);

            return formatMe;
        }

        private string StripComments(string input)
        {
            Regex regex = new Regex(&quot;&lt;!--.*--&gt;&quot;);
            return regex.Replace(input, &quot;&quot;);
        }

        private string ReplaceNastyAttributes(string input)
        {
            Regex regex = new Regex(&quot;( on[a-z]{1,}|style|id)=[\&quot;'](.*?)[\&quot;']&quot;);
            return regex.Replace(input, &quot;&quot;);
        }

        #endregion HTML Markup Handling

    }
}
</pre>
</div>
<br>
<p>Requires TidyATL library for .NET - http://www.devx.com/dotnet/Article/20505/1763/page/2</p>

</div>

<div class="result">
<h2 class="title">
<a href="/user/Yordan Georgiev">Yordan Georgiev</a>/<a href="/snippet/csharp/a-simple-cheat-class-code-snippets">A simple cheat class</a>
<span class="language">(<a href="/language/csharp/"> C#</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: csharp;">
    using System.Text;
    using System.Diagnostics;
    using System.Collections.Generic;
    using System.Collections;
        
    namespace GenApp.Utils.Theory
    {
    	/// &amp;lt;summary&amp;gt;
    	/// This is fake class for quick copy paste. Usage: 
    	/// type HowTo. - the intellisense will display the names you have figured out for each fake method 
    	/// select the name from the     , click in it , right button , G , will get you there , 
    	/// copy paste the text , Alt + F, C to close and remember to delete the fake call. 
    	/// &amp;lt;/summary&amp;gt;
    	public class HowTo
    	{
    
    		public static void UseRegexesWithWhiteSpace ()
    		{
    			//how-to use regexes with white space 
    			//                Regex re = new Regex( 
    			//                    @&quot;           # This pattern matches Foo
    			//                        (?i)     # turn on insensitivity
    			//                                 # The Foo bit
    			//                        \b(Foo)\b &quot;
    			//                , RegexOptions.IgnorePatternWhitespace ) ;
    			//                for ( Match m = re.Match( &quot;foo bar Foo&quot; ) ; m.Success ; m = m.NextMatch() ;
    
    		} //eof method 
    
    
    		public static void DisplayJavaScriptConfirmationDialog ()
    		{
    			//Active_chkbox.Attributes.Add(&quot;OnClick&quot; , &quot;return (confirm('Do you want do disable this user'));&quot;);
    		} //eof method 
    
    		public static void RegisterPageStartUpScript ()
    		{
    
    			//how-to Page.RegisterStartupScript(@&quot;startup&quot;,@&quot;&amp;lt;script&amp;gt;alert('Thank you!');&amp;lt;/script&amp;gt;&quot;);
    			//string JaScript = &quot;&amp;lt;script language=â€™javascriptâ€™&amp;gt; alert('User Details saved successfully') &amp;lt;/script&amp;gt; &quot; ;
    			//Response.Write( JaScript );
    
    		} //eof method RegionsterPageStartUpScript
    
    
    		public static void AddCallingMethodNameToDebug ()
    		{
    			string code = @&quot;
    	System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace();
    	string mName = st.GetFrame(1).GetMethod().Name; 
    	&quot;;
    
    		} //eof method AddCallingMethodNameToDebug
    
    
    		public static void SettersAndGetters ()
    		{
    			string help = @&quot;
    how-to generate those in textpad F8 
    how-to Generate member accessors , properties for C# asp.net with textpad 
    how-to setters and getters
    find:^(.*)$
    replace:private string _\1 ; \n public string \1 { \n \t\t get { return _\1 ; } \n \t\t set { _\1 = value ; } \n } //comm -- eof \1 property \n\n 
    find:^(.*) (.*)$
    private string s\1 ; \n public string \1 { \n \t\t get { return s\1 ; } \n \t\t set { s\1 = value ; } \n } //comm -- eof \1 property \n\n
    
    FIND:first remove all the [] from the copy paste of the table create screipt 
    ^\t\[([a-zA-Z_]*)\](.*)$
    FIND type and var
    ^(.*) (.*)$
    REPLACE Properties
    #region \2 \n private \1 _\2 ; \npublic \1 \2 { \n \t\t get { return _\2 ; } \n \t\t set { _\2 = value ; } \n } //eof property \2 \n\n\n #endregion \2 \n\
    
    //for the constructor 
    _\2= this.\2 ;
    
    //for the passing to the constuctor 
    \1 _\2 , 
    
    /* 
    ^(.*) (.*)$
    #region \2 \nprivate List&amp;lt;\1&amp;gt; _\2;\npublic List&amp;lt;\1&amp;gt; \2 { get { return _\2; } set { _\2 = value; } }\n#endregion \2\n\n
    
    &quot;;
    
    
    		} //eof method SettersAndGetters
    
    
    
    		public static void ListAllDbObjects ()
    		{
    			/*
    			--HOW-TO LIST ALL PROCEDURE IN A DATABASE
    			select s.name from sys.objects s where type = 'P' or type='UP'
    			-- GET THE GENERATED ONES ONLY 
    			 select s.name from sysobjects s where type = 'P' and s.name like '%gsp%'
    			--HOW-TO LIST ALL TRIGGERS BY NAME IN A DATABASE
    			select s.name from sysobjects s where type = 'TR'
    			--HOW-TO LIST TABLES IN A DATABASE 
    			select s.name from sysobjects s where type = 'U'
    			--how-to list all system tables in a database
    			select s.name from sysobjects s where type = 's'
    			--how-to list all the views in a database
    			select s.name from sysobjects s where type = 'v'
    
    
    			Similarly you can find out other objects created by user, simple change type = 
    
    			C = CHECK constraint 
    
    			D = Default or DEFAULT constraint 
    
    			F = FOREIGN KEY constraint 
    
    			L = Log 
    
    			FN = Scalar function 
    
    			IF = In-lined table-function 
    
    			P = Stored procedure 
    
    			PK = PRIMARY KEY constraint (type is K) 
    
    			RF = Replication filter stored procedure
    
    			S = System table 
    
    			TF = Table function 
    
    			TR = Trigger 
    
    			U = User table ( this is the one I discussed above in the example)
    
    			UQ = UNIQUE constraint (type is K) 
    
    			V = View 
    
    			X = Extended stored procedure
    			*/
    		} //eof method 
    
    		public static void GetProcedureMetaData ()
    		{
    			string answer = @&quot;
    	select PARAMETER_NAME as 'COLUMN_NAME', DATA_TYPE ,  CHARACTER_MAXIMUM_LENGTH AS 'MAX_LENGTH', IS_RESULT , PARAMETER_MODE  from INFORMATION_SCHEMA.PARAMETERS where SPECIFIC_NAME='Login_Check'
    	Select * from INFORMATION_SCHEMA.Routines --returns stored procedures and functions
    
    	exec sp_HelpText 'Login_Check'
    
    	&quot;;
    			answer = string.Empty;
    
    		} //eof method 
    
    
    		public static void GetRowColumnValuesFromDs ()
    		{
    			//(ds.Tables[&quot;TableName&quot;].Rows[0][&quot;ColumnName&quot;] == DBNull.Value) ? false : (bool)ds.Tables[&quot;TableName&quot;].Rows[0][&quot;ColumnName&quot;]; 
    
    		} //eof method 
    
    		public static void CopyMeAsTemplateMethod ()
    		{ } //eof method 
    
    		public static void ReflectionExample ()
    		{
    
    			//Type objectType = testObject.GetType();
    
    			//ConstructorInfo[] info = objectType.GetConstructors();
    			//MethodInfo[] methods = objectType.GetMethods();
    
    			//// get all the constructors
    			//Console.WriteLine(&quot;Constructors:&quot;);
    			//foreach (ConstructorInfo cf in info)
    			//{
    			//  Console.WriteLine(cf);
    			//}
    
    			//Console.WriteLine();
    			//// get all the methods
    			//Console.WriteLine(&quot;Methods:&quot;);
    			//foreach (MethodInfo mf in methods)
    			//{
    			//  Console.WriteLine(mf);
    			//}
    
    
    
    
    		}
    
    
    
    
    		public static void shortcuts ()
    		{
    			string _shortcuts =
    
    			@&quot;
    	//how-to shortcuts 
    
    
    	Ctrl + Shift + F -- recursive find 
    	F3 -- find next occurence
    	Ctrl + H -- find and replace
    	Ctrl + M + M -- collapse method 
    	Ctrl + B --- set a break point 
    	CTRL + â€œ-â€? and CTRL + SHIFT + â€œ-â€? -- web browser like backward and forward in code
    	Ctrl + Tab --- shift tabs
    	Shift + F5 --- stop debugging 
    	Ctrl + I --- fast search 
    	F5 -- start debugging
    	Tryf = try and finally block
    	Prop = property with get and set accessor
    	Switch = switch statement with default
    	Alt + W , L -- close all windows 
    	Alt + W , 1 -- open the first window
    	Alt + F , F , 1 -- open the latest file I closed 
    	Ctrl + F2 , Tab -- go to the methods dropdown , type a letter to get to the name of the method 
    	Alt + L --- select the Solution Explorer
    	Ctrl + Shift + Z --  press 2 (needs arsclip (google download arsclip)) -- get the second latest entry from my clipboard
    
    
    	&quot;;
    
    		} //eof shortcuts
    
    
    		public static void redirectToCurrentUrl ()
    		{
    			string _redirectToCurrentUrl =
    			@&quot;
    
    	Response.Redirect ( System.IO.Path.GetFileName ( System.Web.HttpContext.Current.Request.Url.AbsolutePath ) , false );
    
    	&quot;;
    		} //eof method 
    
    
    		public static void formTypes ()
    		{
    			string _formTypes =
    			@&quot; 
    	//how-to forms 1 - Empty Search Form , 2 - Filled Form , 3 - Empty New form ( new Margin Data , new Project )
    	//how-to formTypes 
    	//, 4 - filled search form from get by id procedure 
    	// 5 - FilledSearchForm (coming from params)
    
    	&quot;;
    		} //eof formTypes 
    
    		public static void GetTheFileNameWithoutTheExtension ()
    		{
    			/*					
    			System.IO.Path.GetFileNameWithoutExtension ( System.Web.HttpContext.Current.Request.Url.AbsolutePath ) );
    			 */
    
    
    		} //eof methoed 
    
    
    		public static void GetThePhysicalRootPathNoExtension ()
    		{
    			//how-to get the physical root path on the file system of the application 
    			//Utils.Dbg.Debugger.WriteIf ( &quot;My rootPath is &quot; + rootPath );
    		} //eof method 
    
    		public static void AccessConfVariables ()
    		{
    			//how-to access conf variables BL.Conf.Instance.Vars [ &quot;varName&quot; ] would give you &quot;theVarName ;
    		} //eof method 
    
    		public static void GetRowColumnValue ()
    		{
    			//how-to get row column value 
    			//(ds.Tables[&quot;TableName&quot;].Rows[0][&quot;ColumnName&quot;] == DBNull.Value ) ? false : (bool)ds.Tables[&quot;TableName&quot;].Rows[0][&quot;ColumnName&quot;] ; 
    
    		} //eof method 
    
    
    		public static void GenerateExtendedPropertiesForATable ()
    		{
    
    			//table column
    			//find:^(.*) (.*)$
    			//Replace:
    			//EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'title=&quot;\2&quot;,visible=&quot;1&quot;,fs=&quot;Basic Details&quot;,readonly=&quot;1&quot;' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'\1', @level2type=N'COLUMN',@level2name=N'\2'
    		} //eof method 
    
    
    
    		public static void RedirectToTheCurrentURL ()
    		{
    			//how-to redirect to current url = users.aspx or projects.aspx 
    			/*
    
    			Response.Redirect( System.IO.Path.GetFileName ( System.Web.HttpContext.Current.Request.Url.AbsolutePath ) , false );
    
    			 */
    		} //eof method 
    
    		public static void THEORY ()
    		{
    			//EVENTS AND DELEGATES IN ASP.NET -- http://msdn.microsoft.com/en-us/library/17sde2xt.aspx
    
    		} //eof method 
    
    
    		public static void ReplaceDebugging ()
    		{
    			/* find : replace 
    		^(.*)([^\/\/])(Utils\.Debugger)
    		\t\t\t\t\t//Utils.Dbg.Debugger
    			 */
    		}
    
    		public static void UseStringBuilderInsteadOfString ()
    		{
    			//Bad
    			string s = &quot;This &quot;;
    			s += &quot;is &quot;;
    			s += &quot;not &quot;;
    			s += &quot;the &quot;;
    			s += &quot;best &quot;;
    			s += &quot;way.&quot;;
    
    			//Good:
    			StringBuilder sb = new StringBuilder ();
    			sb.Append ( &quot;This &quot; );
    			sb.Append ( &quot;is &quot; );
    			sb.Append ( &quot;much &quot; );
    			sb.Append ( &quot;better. &quot; );
    
    		} //eof method 
    
    
        #region SomeObject.Value = SomeValue ?? null;
        class SomeObject
        {
          public string Value { get; set; } 
        }
    		public static void DummyAssignValueIfNotNull ( string SomeValue )
    		{
    			SomeObject SomeObject = new SomeObject ();
    			if (SomeValue == null)
    				SomeObject.Value = null;
    			else
    				SomeObject.Value = SomeValue;
    
        }
    
        public static void SmartyAssignValueIfNotNull ( string SomeValue )
        {			//Instead of this:
          SomeObject SomeObject = new SomeObject ();
          SomeObject.Value = SomeValue ?? null;
        }
        #endregion SomeObject.Value = SomeValue ?? null;
    
        //&amp;lt;source&amp;gt;http://stackoverflow.com/questions/28637/is-datetime-now-the-best-way-to-measure-a-functions-performance&amp;lt;/source&amp;gt;
        public static void MeasureMethodPerformance ()
    		{
    			Stopwatch sw = new Stopwatch ();
    			sw.Start ();
    			// Do Work to measure
    			sw.Stop ();
    			string StrDebug = string.Format ( &quot;Elapsed time: {0}&quot;, sw.Elapsed.TotalMilliseconds );
    		} //eof method 
    
    
    		public static void GenerateResxFileOutOfListing ()
    		{
    /*
    FIND:
    ^(.*)$
    REPLACE:
    &amp;lt;data name=&quot;\1&quot; xml:space=&quot;preserve&quot;&amp;gt; \n &amp;lt;value&amp;gt;value&amp;lt;/value&amp;gt;\n &amp;lt;comment&amp;gt;comment&amp;lt;/comment&amp;gt; \n&amp;lt;/data&amp;gt;\n
    
    
    */
    		
    		
    		} //eof method 
    	} //eof class 
    
    
      #region implement IEnumerable&amp;lt;T&amp;gt; for a type
      public class ClassImplementingIEnumerable : IEnumerable&amp;lt;string&amp;gt;
      {
        public IEnumerator&amp;lt;string&amp;gt; GetEnumerator()
        {
          yield return &quot;x&quot;;
          yield return &quot;y&quot;;
        }
    
        // Explicit interface implementation for nongeneric interface
        IEnumerator IEnumerable.GetEnumerator ()
        {
            return GetEnumerator(); // Just return the generic version
        }
    } //eof class 
      #endregion #region implement IEnumerable&amp;lt;T&amp;gt; for a type
    
    } //eof namespace
</pre>
</div>
<br>
A simple cheat class for simple 
</div>

<div class="result">
<h2 class="title">
<a href="/user/zachharkey">zachharkey</a>/<a href="/snippet/other/html5-boilerplate-htaccess">HTML5 Boilerplate .htaccess</a>
<span class="language">(<a href="/language/other/"> Other</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: text;">
# Apache configuration file
# httpd.apache.org/docs/2.2/mod/quickreference.html

# Note .htaccess files are an overhead, this logic should be in your Apache config if possible
# httpd.apache.org/docs/2.2/howto/htaccess.html

# Techniques in here adapted from all over, including:
#   Kroc Camen: camendesign.com/.htaccess
#   perishablepress.com/press/2006/01/10/stupid-htaccess-tricks/
#   Sample .htaccess file of CMS MODx: modxcms.com


###
### If you run a webserver other than apache, consider:
### github.com/paulirish/html5-boilerplate-server-configs
###



# ----------------------------------------------------------------------
# Better website experience for IE users
# ----------------------------------------------------------------------

# Force the latest IE version, in various cases when it may fall back to IE7 mode
#  github.com/rails/rails/commit/123eb25#commitcomment-118920
# Use ChromeFrame if it's installed for a better experience for the poor IE folk

&lt;IfModule mod_setenvif.c&gt;
  &lt;IfModule mod_headers.c&gt;
    BrowserMatch MSIE ie
    Header set X-UA-Compatible &quot;IE=Edge,chrome=1&quot; env=ie
  &lt;/IfModule&gt;
&lt;/IfModule&gt;

&lt;IfModule mod_headers.c&gt;
# Because X-UA-Compatible isn't sent to non-IE (to save header bytes),
#   We need to inform proxies that content changes based on UA
  Header append Vary User-Agent
# Cache control is set only if mod_headers is enabled, so that's unncessary to declare
&lt;/IfModule&gt;


# ----------------------------------------------------------------------
# Cross-domain AJAX requests
# ----------------------------------------------------------------------

# Serve cross-domain ajax requests, disabled.   
# enable-cors.org
# code.google.com/p/html5security/wiki/CrossOriginRequestSecurity

#  &lt;IfModule mod_headers.c&gt;
#    Header set Access-Control-Allow-Origin &quot;*&quot;
#  &lt;/IfModule&gt;



# ----------------------------------------------------------------------
# Webfont access
# ----------------------------------------------------------------------

# allow access from all domains for webfonts
# alternatively you could only whitelist
#   your subdomains like &quot;sub.domain.com&quot;

&lt;FilesMatch &quot;\.(ttf|otf|eot|woff|font.css)$&quot;&gt;
  &lt;IfModule mod_headers.c&gt;
    Header set Access-Control-Allow-Origin &quot;*&quot;
  &lt;/IfModule&gt;
&lt;/FilesMatch&gt;



# ----------------------------------------------------------------------
# Proper MIME type for all files
# ----------------------------------------------------------------------

# audio
AddType audio/ogg                      oga ogg

# video
AddType video/ogg                      ogv
AddType video/mp4                      mp4
AddType video/webm                     webm

# Proper svg serving. Required for svg webfonts on iPad
#   twitter.com/FontSquirrel/status/14855840545
AddType     image/svg+xml              svg svgz 
AddEncoding gzip                       svgz
                                       
# webfonts                             
AddType application/vnd.ms-fontobject  eot
AddType font/truetype                  ttf
AddType font/opentype                  otf
AddType application/x-font-woff        woff

# assorted types                                      
AddType image/x-icon                   ico
AddType image/webp                     webp
AddType text/cache-manifest            appcache manifest
AddType text/x-component               htc
AddType application/x-chrome-extension crx
AddType application/x-xpinstall        xpi
AddType application/octet-stream       safariextz



# ----------------------------------------------------------------------
# Allow concatenation from within specific js and css files 
# ----------------------------------------------------------------------

# e.g. Inside of script.combined.js you could have
#   &lt;!--#include file=&quot;libs/jquery-1.5.0.min.js&quot; --&gt;
#   &lt;!--#include file=&quot;plugins/jquery.idletimer.js&quot; --&gt;
# and they would be included into this single file

# this is not in use in the boilerplate as it stands. you may
#   choose to name your files in this way for this advantage
#   or concatenate and minify them manually.
# Disabled by default.

# &lt;FilesMatch &quot;\.combined\.(js|css)$&quot;&gt;
#         Options +Includes
#         SetOutputFilter INCLUDES
# &lt;/FilesMatch&gt;



# ----------------------------------------------------------------------
# gzip compression
# ----------------------------------------------------------------------

&lt;IfModule mod_deflate.c&gt;


# force deflate for mangled headers developer.yahoo.com/blogs/ydn/posts/2010/12/pushing-beyond-gzipping/
&lt;IfModule mod_setenvif.c&gt;
  &lt;IfModule mod_headers.c&gt;
    SetEnvIfNoCase ^(Accept-EncodXng|X-cept-Encoding|X{15}|~{15}|-{15})$ ^((gzip|deflate)\s,?\s(gzip|deflate)?|X{4,13}|~{4,13}|-{4,13})$ HAVE_Accept-Encoding
    RequestHeader append Accept-Encoding &quot;gzip,deflate&quot; env=HAVE_Accept-Encoding
  &lt;/IfModule&gt;
&lt;/IfModule&gt;
# html, txt, css, js, json, xml, htc:
&lt;IfModule filter_module&gt;
  FilterDeclare   COMPRESS
  FilterProvider  COMPRESS  DEFLATE resp=Content-Type /text/(html|css|javascript|plain|x(ml|-component))/
  FilterProvider  COMPRESS  DEFLATE resp=Content-Type /application/(javascript|json|xml|x-javascript)/
  FilterChain     COMPRESS
  FilterProtocol  COMPRESS  change=yes;byteranges=no
&lt;/IfModule&gt;

&lt;IfModule !mod_filter.c&gt;
  # Legacy versions of Apache
  AddOutputFilterByType DEFLATE text/html text/plain text/css application/json
  AddOutputFilterByType DEFLATE text/javascript application/javascript application/x-javascript 
  AddOutputFilterByType DEFLATE text/xml application/xml text/x-component
&lt;/IfModule&gt;

# webfonts and svg:
  &lt;FilesMatch &quot;\.(ttf|otf|eot|svg)$&quot; &gt;
    SetOutputFilter DEFLATE
  &lt;/FilesMatch&gt;
&lt;/IfModule&gt;



# ----------------------------------------------------------------------
# Expires headers (for better cache control)
# ----------------------------------------------------------------------

# these are pretty far-future expires headers
# they assume you control versioning with cachebusting query params like
#   &lt;script src=&quot;application.js?20100608&quot;&gt;
# additionally, consider that outdated proxies may miscache 
#   www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/

# if you don't use filenames to version, lower the css and js to something like
#   &quot;access plus 1 week&quot; or so

&lt;IfModule mod_expires.c&gt;
  ExpiresActive on

# Perhaps better to whitelist expires rules? Perhaps.
  ExpiresDefault                          &quot;access plus 1 month&quot;

# cache.appcache needs re-requests in FF 3.6 (thx Remy ~Introducing HTML5)
  ExpiresByType text/cache-manifest       &quot;access plus 0 seconds&quot;

# your document html 
  ExpiresByType text/html                 &quot;access plus 0 seconds&quot;
  
# data
  ExpiresByType text/xml                  &quot;access plus 0 seconds&quot;
  ExpiresByType application/xml           &quot;access plus 0 seconds&quot;
  ExpiresByType application/json          &quot;access plus 0 seconds&quot;

# rss feed
  ExpiresByType application/rss+xml       &quot;access plus 1 hour&quot;

# favicon (cannot be renamed)
  ExpiresByType image/x-icon              &quot;access plus 1 week&quot; 

# media: images, video, audio
  ExpiresByType image/gif                 &quot;access plus 1 month&quot;
  ExpiresByType image/png                 &quot;access plus 1 month&quot;
  ExpiresByType image/jpg                 &quot;access plus 1 month&quot;
  ExpiresByType image/jpeg                &quot;access plus 1 month&quot;
  ExpiresByType video/ogg                 &quot;access plus 1 month&quot;
  ExpiresByType audio/ogg                 &quot;access plus 1 month&quot;
  ExpiresByType video/mp4                 &quot;access plus 1 month&quot;
  ExpiresByType video/webm                &quot;access plus 1 month&quot;
  
# htc files  (css3pie)
  ExpiresByType text/x-component          &quot;access plus 1 month&quot;
  
# webfonts
  ExpiresByType font/truetype             &quot;access plus 1 month&quot;
  ExpiresByType font/opentype             &quot;access plus 1 month&quot;
  ExpiresByType application/x-font-woff   &quot;access plus 1 month&quot;
  ExpiresByType image/svg+xml             &quot;access plus 1 month&quot;
  ExpiresByType application/vnd.ms-fontobject &quot;access plus 1 month&quot;
    
# css and javascript
  ExpiresByType text/css                  &quot;access plus 2 months&quot;
  ExpiresByType application/javascript    &quot;access plus 2 months&quot;
  ExpiresByType text/javascript           &quot;access plus 2 months&quot;
  
  &lt;IfModule mod_headers.c&gt;
    Header append Cache-Control &quot;public&quot;
  &lt;/IfModule&gt;
  
&lt;/IfModule&gt;



# ----------------------------------------------------------------------
# ETag removal
# ----------------------------------------------------------------------

# Since we're sending far-future expires, we don't need ETags for
# static content.
#   developer.yahoo.com/performance/rules.html#etags
FileETag None



# ----------------------------------------------------------------------
# Stop screen flicker in IE on CSS rollovers
# ----------------------------------------------------------------------

# The following directives stop screen flicker in IE on CSS rollovers - in
# combination with the &quot;ExpiresByType&quot; rules for images (see above). If
# needed, un-comment the following rules.

# BrowserMatch &quot;MSIE&quot; brokenvary=1
# BrowserMatch &quot;Mozilla/4.[0-9]{2}&quot; brokenvary=1
# BrowserMatch &quot;Opera&quot; !brokenvary
# SetEnvIf brokenvary 1 force-no-vary



# ----------------------------------------------------------------------
# Cookie setting from iframes
# ----------------------------------------------------------------------

# Allow cookies to be set from iframes (for IE only)
# If needed, uncomment and specify a path or regex in the Location directive

# &lt;IfModule mod_headers.c&gt;
#   &lt;Location /&gt;
#     Header set P3P &quot;policyref=\&quot;/w3c/p3p.xml\&quot;, CP=\&quot;IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT\&quot;&quot;
#   &lt;/Location&gt;
# &lt;/IfModule&gt;



# ----------------------------------------------------------------------
# Start rewrite engine
# ----------------------------------------------------------------------

# Turning on the rewrite engine is necessary for the following rules and features.

&lt;IfModule mod_rewrite.c&gt;
  RewriteEngine On
&lt;/IfModule&gt;



# ----------------------------------------------------------------------
# Suppress or force the &quot;www.&quot; at the beginning of URLs
# ----------------------------------------------------------------------

# The same content should never be available under two different URLs - especially not with and
# without &quot;www.&quot; at the beginning, since this can cause SEO problems (duplicate content).
# That's why you should choose one of the alternatives and redirect the other one.

# By default option 1 (no &quot;www.&quot;) is activated. Remember: Shorter URLs are sexier.
# no-www.org/faq.php?q=class_b

# If you rather want to use option 2, just comment out all option 1 lines
# and uncomment option 2.
# IMPORTANT: NEVER USE BOTH RULES AT THE SAME TIME!

# ----------------------------------------------------------------------

# Option 1:
# Rewrite &quot;www.domain.com -&gt; domain.com&quot; 

&lt;IfModule mod_rewrite.c&gt;
  RewriteCond %{HTTPS} !=on
  RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
  RewriteRule ^(.*)$ http://%1/$1 [R=301,L]
&lt;/IfModule&gt;

# ----------------------------------------------------------------------

# Option 2:
# To rewrite &quot;domain.com -&gt; www.domain.com&quot; uncomment the following lines.
# Be aware that the following rule might not be a good idea if you
# use &quot;real&quot; subdomains for certain parts of your website.

# &lt;IfModule mod_rewrite.c&gt;
#   RewriteCond %{HTTPS} !=on
#   RewriteCond %{HTTP_HOST} !^www\..+$ [NC]
#   RewriteCond %{HTTP_HOST} (.+)$ [NC]
#   RewriteRule ^(.*)$ http://www.%1/$1 [R=301,L]
# &lt;/IfModule&gt;



# ----------------------------------------------------------------------
# Add/remove trailing slash to (non-file) URLs
# ----------------------------------------------------------------------

# Google treats URLs with and without trailing slashes separately.
# Forcing a trailing slash is usually preferred, but all that's really
# important is that one correctly redirects to the other.

# By default option 1 (force trailing slash) is activated.
# http://googlewebmastercentral.blogspot.com/2010/04/to-slash-or-not-to-slash.html
# http://www.alistapart.com/articles/slashforward/
# http://httpd.apache.org/docs/2.0/misc/rewriteguide.html#url Trailing Slash Problem

# ----------------------------------------------------------------------

# Option 1:
# Rewrite &quot;domain.com/foo -&gt; domain.com/foo/&quot;

&lt;IfModule mod_rewrite.c&gt;
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_URI} !(\.[a-zA-Z0-9]{1,5}|/|#(.*))$
  RewriteRule ^(.*)$ /$1/ [R=301,L]
&lt;/IfModule&gt;

# ----------------------------------------------------------------------

# Option 2:
# Rewrite &quot;domain.com/foo/ -&gt; domain.com/foo&quot;

#&lt;IfModule mod_rewrite.c&gt;
#  RewriteRule ^(.*)/$ /$1 [R=301,L]
#&lt;/IfModule&gt;



# ----------------------------------------------------------------------
# Built-in filename-based cache busting
# ----------------------------------------------------------------------

# If you're not using the build script to manage your filename version revving,
# you might want to consider enabling this, which will route requests for
# /css/all.20110203.css to /res/all.css

# To understand why this is important and a better idea than all.css?v1231,
# read: github.com/paulirish/html5-boilerplate/wiki/Version-Control-with-Cachebusting

# Uncomment to enable.
# &lt;IfModule mod_rewrite.c&gt;
#   RewriteCond %{REQUEST_FILENAME} !-f
#   RewriteCond %{REQUEST_FILENAME} !-d
#   RewriteRule ^(.+)\.(\d+)\.(js|css|png|jpg|gif)$ $1.$3 [L]
# &lt;/IfModule&gt;


	
# ----------------------------------------------------------------------
# Prevent SSL cert warnings
# ----------------------------------------------------------------------

# Rewrite secure requests properly to prevent SSL cert warnings, e.g. prevent 
# https://www.domain.com when your cert only allows https://secure.domain.com
# Uncomment the following lines to use this feature.

# &lt;IfModule mod_rewrite.c&gt;
#   RewriteCond %{SERVER_PORT} !^443
#   RewriteRule (.*) https://example-domain-please-change-me.com/$1 [R=301,L]
# &lt;/IfModule&gt;



# ----------------------------------------------------------------------
# Prevent 404 errors for non-existing redirected folders
# ----------------------------------------------------------------------

# without -MultiViews, Apache will give a 404 for a rewrite if a folder of the same name does not exist 
#   e.g. /blog/hello : webmasterworld.com/apache/3808792.htm

Options -MultiViews 



# ----------------------------------------------------------------------
# custom 404 page
# ----------------------------------------------------------------------

# You can add custom pages to handle 500 or 403 pretty easily, if you like.
ErrorDocument 404 /404.html



# ----------------------------------------------------------------------
# UTF-8 encoding
# ----------------------------------------------------------------------

# use utf-8 encoding for anything served text/plain or text/html
AddDefaultCharset utf-8

# force utf-8 for a number of file formats
AddCharset utf-8 .html .css .js .xml .json .rss



# ----------------------------------------------------------------------
# A little more security
# ----------------------------------------------------------------------


# Do we want to advertise the exact version number of Apache we're running?
# Probably not.
## This can only be enabled if used in httpd.conf - It will not work in .htaccess
# ServerTokens Prod


# &quot;-Indexes&quot; will have Apache block users from browsing folders without a default document
# Usually you should leave this activated, because you shouldn't allow everybody to surf through
# every folder on your server (which includes rather private places like CMS system folders).
# Options -Indexes


# Block access to &quot;hidden&quot; directories whose names begin with a period. This
# includes directories used by version control systems such as Subversion or Git.
&lt;IfModule mod_rewrite.c&gt;
  RewriteRule &quot;(^|/)\.&quot; - [F]
&lt;/IfModule&gt;


# If your server is not already configured as such, the following directive
# should be uncommented in order to set PHP's register_globals option to OFF.
# This closes a major security hole that is abused by most XSS (cross-site
# scripting) attacks. For more information: http://php.net/register_globals
#
# IF REGISTER_GLOBALS DIRECTIVE CAUSES 500 INTERNAL SERVER ERRORS :
#
# Your server does not allow PHP directives to be set via .htaccess. In that
# case you must make this change in your php.ini file instead. If you are
# using a commercial web host, contact the administrators for assistance in
# doing this. Not all servers allow local php.ini files, and they should
# include all PHP configurations (not just this one), or you will effectively
# reset everything to PHP defaults. Consult www.php.net for more detailed
# information about setting PHP directives.

# php_flag register_globals Off





</pre>
</div>
<br>

</div>

<div class="result">
<h2 class="title">
<a href="/user/ptejada">ptejada</a>/<a href="/snippet/php/all-in-one-php-user-class-uflex">All in one PHP user class - uFlex</a>
<span class="language">(<a href="/language/php/"> PHP</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: php;">
&lt;?php
// ---------------------------------------------------------------------------
//    uFlex - An all in one authentication system PHP class
//    Copyright (C) 2010  Pablo Tejada
//
//    This program is free software: you can redistribute it and/or modify
//    it under the terms of the GNU General Public License as published by
//    the Free Software Foundation, either version 3 of the License, or
//    (at your option) any later version.
//
//    This program is distributed in the hope that it will be useful,
//    but WITHOUT ANY WARRANTY; without even the implied warranty of
//    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//    GNU General Public License for more details.
//
//    You should have received a copy of the GNU General Public License
//    along with this program.  If not, see http://www.gnu.org/licenses/gpl-3.0.html.
// --------------------------------------------------------------------------- 
// V 0.10 - Last modified 4/26/2010
//  +Registration Method
//  	-Custome and Built-in fields validation
//  	-Extendable: add as many fields and validation as required
//  	-Built-in Redundancy check for email and username
//  	-Built-in account activation by email
//  +Update Method to update anyfield on database
//  	-Built-in Redundancy check for email
//  	-Custome and Built-in fields validation
//  +Automatic user session handler
//  	-Remember user with cookies
//  	-Handles sessions on new object
//  +Class wide console
//  	-track and log Errors
//  	-Report every steps for each method
//  	-log validations, connection, SQL queries etc...
// ---------------------------------------------------------------------------

/*Thought the Class Official name is userFlex the object is simply named uFlex*/
class uFlex{
	var $salt = &quot;sd5a4&quot;; //IMPORTANT: Please change this value as it will make this copy unique and secured
	var $id;
	var $username;
	var $pass;
	var $signed;
	var $data;
	var $console;
	var $log;
	var $confirm;	
	var $tmp_data;	
	var $validations;

///////////////////////////////////////////////////////////////////////////////////////////////////////
/*
Register A New User
-Takes two parameter the firs been required
	@info = array object (takes an associatve array, 
				the index being the fieldname(column in database) 
				and the value its content(value)
	+optional second parameter
	@activation = boolean(true/false)
		default = false 
Returns activation hash if second parameter @activation is true
Returns true if second parameter @activation is false
Returns false on Error
*/
///////////////////////////////////////////////////////////////////////////////////////////////////////
	function register($info,$activation=false){
		$this-&gt;log = &quot;registration&quot;;  //Index for Errors and Reports
		
		//Saves Registration Data in Class
		$this-&gt;tmp_data = $info;
		
		//Validate Fields Submited Fields
		$validation = array(
			&quot;username&quot; =&gt; array(
								&quot;limit&quot; =&gt; &quot;3-15&quot;,
								&quot;regEx&quot; =&gt; &quot;/^([a-zA-Z0-9_])+$/&quot;
								),
			&quot;password&quot; =&gt; array(
								&quot;limit&quot; =&gt; &quot;3-15&quot;,
								&quot;regEx&quot; =&gt; false
								),
			&quot;email&quot; =&gt; array(
								&quot;limit&quot; =&gt; &quot;4-45&quot;,
								&quot;regEx&quot; =&gt; &quot;/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$/&quot;,
								&quot;optional&quot; =&gt; true
								)
			);
		//Add Built in Validation to the Array
		$this-&gt;addValidation($validation);
		
		//Validate All Fields in the validations array
		foreach($this-&gt;validations as $field=&gt;$opt){
			$this-&gt;validate($field,$opt['limit'],$opt['regEx']);
		}
		//Check for errors
		if($this-&gt;has_error()) return false;
		
	//Built in actions for special fields
		//Hash Password
		if(isset($info['password'])){ 
			$this-&gt;hash_pass($info['password']);
			$info['password'] = $this-&gt;pass;
		}		
		//Check for Email in database
		if(isset($info['email'])){
			if($this-&gt;check_field('email',$info['email'],&quot;This Email is Already in Use&quot;)){
				$this-&gt;form_error('email');
			}
		}
		//Check for username in database
		if(isset($info['username'])){
			if($this-&gt;check_field('username',$info['username'],&quot;This Username is not available&quot;)){
				$this-&gt;form_error('username');
			}
		}
		
		//Check for errors
		if($this-&gt;has_error()) return false;
		
		//Updates $Info, add defaults, and clean left overs
		$info['password'] = $this-&gt;pass;
		$info['confirmation'] = $this-&gt;confirm;
		$info['reg_date'] = time();
		
		//Generates the Confirmation Code
		$this-&gt;uConfirm();
		
		//Activates user upon registration if there is not an activation method
		if(!$activation){
			$info['activated'] = 1;
		}
		
		//Prepare Info for SQL Insertion
		foreach($info as $index =&gt; $val){
			if(!preg_match(&quot;/2$/&quot;,$index)){ //Skips double fields
				$into[] = $index;
				$values[] = &quot;'&quot; . mysql_real_escape_string($val) . &quot;'&quot;;
			}
		}		
		
		$into = implode(&quot;, &quot;,$into);
		$values = implode(&quot;,&quot;,$values);
		
		//Prepare New User	Query
		$sql = &quot;INSERT INTO users ($into) 
					VALUES($values)&quot;;
		//exit($sql);
		
		//Enter New user to Database
		if($this-&gt;check_sql($sql,true) ){
			$this-&gt;report(&quot;New User \&quot;{$info['username']}\&quot; has been registered&quot;);
			if($activation) return &quot;{$this-&gt;confirm}:{$this-&gt;tmp_data['username']}&quot;;
			return true;
		}else{
			$this-&gt;error(&quot;New User Registration Failed&quot;);
			return false;
		}
	}

///////////////////////////////////////////////////////////////////////////////////////////////////////
/*
Similar to the register method function in structure
This Method validates and updates any field in the database
-Takes one parameter
	@info = array object (takes an associatve array, 
				the index being the fieldname(column in database) 
				and the value its content(value)
On Success returns true
On Failure return false	
*/
///////////////////////////////////////////////////////////////////////////////////////////////////////
	function update($info){
		$this-&gt;log = &quot;update&quot;;  //Index for Errors and Reports
		
		//Saves Updates Data in Class
		$this-&gt;tmp_data = $info;
		
		//Check if there have being Changes
		foreach($info as $index=&gt;$val){
			if($this-&gt;data[$index] == $val){
				$this-&gt;error(&quot;{$index} is the same. no changes were made&quot;);
				return false;
			}elseif(isset($info[$index.(2)])){
				//Check for equal fields
				if($info[$index] != $info[$index.(2)]){
					$this-&gt;error(&quot;{$index}s did not match&quot;);
					return false;
				}else{
					$this-&gt;report(&quot;{$index}s match&quot;);
				}
			}
		}
		
		//Defaults or Built in Validations
		$validation = array(
			&quot;username&quot; =&gt; array(
								&quot;limit&quot; =&gt; &quot;3-15&quot;,
								&quot;regEx&quot; =&gt; &quot;/^([a-zA-Z0-9_])+$/&quot;
								),
			&quot;password&quot; =&gt; array(
								&quot;limit&quot; =&gt; &quot;3-15&quot;,
								&quot;regEx&quot; =&gt; false
								),
			&quot;email&quot; =&gt; array(
								&quot;limit&quot; =&gt; &quot;4-45&quot;,
								&quot;regEx&quot; =&gt; &quot;/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$/&quot;,
								&quot;optional&quot; =&gt; true
								)
			);
		//Add Built in Validation to the quene
		$this-&gt;addValidation($validation);
		
		//Validate All Fields in the info array with the validation array
		foreach($this-&gt;validations as $field=&gt;$opt){
			if(isset($info[$field])){
				$this-&gt;validate($field,$opt['limit'],$opt['regEx']);
			}
		}
		//Check for errors
		if($this-&gt;has_error()) return false;
		
	//Built in actions for special fields
		//Hash Password
		if(isset($info['password'])){ 
			$this-&gt;hash_pass($info['password']);
			$info['password'] = $this-&gt;pass;
		}		
		//Check for Email in database
		if(isset($info['email'])){
			if($this-&gt;check_field('email',$info['email'],&quot;This Email is Already in Use&quot;)){
				$this-&gt;form_error('email');
			}
		}
		
		//Check for errors
		if($this-&gt;has_error()) return false;
				
		//Prepare Info for SQL Insertion
		foreach($info as $index =&gt; $val){
			if(!preg_match(&quot;/2$/&quot;,$index)){ //Skips double fields
				$value = &quot;'&quot;.mysql_real_escape_string($val).&quot;'&quot;;
				$set[] = &quot;{$index}={$value}&quot;;
			}			
		}		
		
		$set = implode(&quot;, &quot;,$set);
		
		//Prepare User Update	Query
		$sql = &quot;UPDATE users SET $set 
					WHERE user_id='{$this-&gt;id}'&quot;;		
		//exit($sql);
		
		//Check for Changes
		if($this-&gt;check_sql_change($sql,true) ){
			$this-&gt;report(&quot;Information Updated&quot;);
			$_SESSION['updated'] = true;
			return true;
		}else{
			$this-&gt;error(&quot;The Changes Could not be made&quot;);
			return false;
		}
	}

///////////////////////////////////////////////////////////////////////////////////////////////////////
/*
Adds validation to quene list for either the Registration or Update Method
Single Entry:
	Requires the first two parameters
		@name = string (name of the field to be validated)
		@limit    = string (range in the format of &quot;5-10&quot;)
			*to make a field optional start with 0 (Ex. &quot;0-10&quot;)
	Optional third paramenter
		@regEx = string (Regular Expresion to test the field)
Multiple Entry:
	Takes only the first argument
		@name = Array Object (takes an object in the following format:
			array(
				&quot;username&quot; =&gt; array(
									&quot;limit&quot; =&gt; &quot;3-15&quot;,
									&quot;regEx&quot; =&gt; &quot;/^([a-zA-Z0-9_])+$/&quot;
									),
				&quot;password&quot; =&gt; array(
									&quot;limit&quot; =&gt; &quot;3-15&quot;,
									&quot;regEx&quot; =&gt; false
									)
				);
*/
///////////////////////////////////////////////////////////////////////////////////////////////////////
	function addValidation($name,$limit=false,$regEx=false){
		$this-&gt;log = &quot;registration&quot;;
		if(is_array($name)){
			if(!is_array($this-&gt;validations)) $this-&gt;validations = array(); //If is not an array yet, make it one
			$new = array_merge($this-&gt;validations,$name);
			$this-&gt;validations = $new;
			$this-&gt;report(&quot;New Validation Object added&quot;);
		}else{
			$this-&gt;validations[$name]['limit'] = $limit;
			$this-&gt;validations[$name]['regEx'] = $regEx;
			$this-&gt;report(&quot;The $name field has been added for validation&quot;);
		}
	}
	
///////////////////////////////////////////////////////////////////////////////////////////////////////	
/*
Activates Account with hash
Takes Only and Only the URL c parameter of the comfirmation page
	@hash = string
Returns true on account activation and false on failure
*/
///////////////////////////////////////////////////////////////////////////////////////////////////////
	function activate($hash){
		$d = explode(&quot;:&quot;,$hash);
		$this-&gt;confirm = $d[0];
		$this-&gt;username = $d[1];		
		$sql = &quot;UPDATE users SET activated=1 WHERE confirmation='{$d[0]}' AND username='{$d[1]}'&quot;;
		
		if($this-&gt;check_sql_change($sql,true)){
			$this-&gt;report(&quot;Account has been Activated&quot;);
			return true;
		}else{
			$this-&gt;error(&quot;Account could not be activated&quot;);
			return false;
		}
	}

///////////////////////////////////////////////////////////////////////////////////////////////////////
/*
Method to reset password, sents an email with a confirmation code to reset password
-Takes one parameter and is required
	@email = string(user email to reset password)
On Success it returns a hash which could then be use to construct the confimration URL
On Failure it returns false
*/
///////////////////////////////////////////////////////////////////////////////////////////////////////
	function pass_reset($email){
		$this-&gt;log = &quot;pass_reset&quot;;
		$this-&gt;uConfirm();
		$sql = &quot;SELECT username,user_id FROM users WHERE email='{$email}'&quot;;
		$this-&gt;
		$query = mysql_query($sql);
		if(!$query){
			$this-&gt;error(mysql_error()); 
			return false;
		}
		$row = mysql_fetch_assoc($query);
		if(count($row) &gt; 1){
			//Send Email
			$code = $this-&gt;confirm.&quot;:{$row['user_id']}&quot;;
			return $code;
		}else{
			$this-&gt;error(&quot;We don't have an account with this email&quot;);
			return false;
		}
	}

///////////////////////////////////////////////////////////////////////////////////////////////////////
/*
Reset a Password with a Confirmation hash from the pass_reset method	
-Takes two parameters
	@hash = string (pass_reset method hash)
	@new  = string (New password)
					*Make sure to validate and comfirm new password in javascript for now
Returns true on a successfull password change
Returns false on error
*/
///////////////////////////////////////////////////////////////////////////////////////////////////////
	function new_pass($hash,$new){
		$d = explode(&quot;:&quot;,$hash);
		$this-&gt;confirm = $d[0];
		$this-&gt;id = $d[1];
		$pass = $this-&gt;hash_pass($new);
		$sql = &quot;UPDATE users SET password='{$pass}' WHERE confirmation='{$d[0]}' AND user_id='{$d[1]}'&quot;;
		
		if($this-&gt;check_sql($sql,true)){
			$this-&gt;report(&quot;Your Password has been Changed&quot;);
			return true;
		}else{
			$this-&gt;error(&quot;Password could not be changed&quot;);
			return false;
		}
	}
	
////////Private and Secondary Methods below this line\\\\\\\\\\\\\
/*Star up function*/
	function uFlex($user=false,$pass=false,$auto=false){
		$this-&gt;log = &quot;login&quot;;  //Index for Reports and Errors;
		session_start();	
		//$this-&gt;username = $user;
		//$this-&gt;pass = $pass;
		
		$result = $this-&gt;login($user,$pass,$auto);
		if($result == false){
			$this-&gt;id = 0;
			$this-&gt;username = &quot;Guess&quot;;
			$this-&gt;pass = &quot;&quot;;
			$this-&gt;signed = false;
			$_SESSION = array(&quot;username&quot; =&gt; &quot;Guess&quot;,
							  &quot;user_id&quot; =&gt; 0,
							  &quot;signed&quot; =&gt; false
							  );
			$this-&gt;report(&quot;User is Guess&quot;);
		}else{
			
		}
		return true;
	}
	
	private function login($user=false,$pass=false,$auto=false){
		$this-&gt;log = &quot;login&quot;;  //Index for Reports and Errors;
		//Session Login
		if(@$_SESSION['signed']){
			$this-&gt;report(&quot;User Is signed in from session&quot;);
			$this-&gt;update_from_session();
			if(isset($this-&gt;data['updated'])){
				//Get User From database because its info has change during current session
				$update = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM users WHERE user_id='{$this-&gt;id}'&quot;));
				$this-&gt;update_session($update);
				unset($_SESSION['updated']);
				$this-&gt;report(&quot;Session Updated From Database&quot;);
			}
			return true;
		}		
		if(isset($_COOKIE['auto'])){
		//Cookies Login	
			$c = $_COOKIE['auto'];
			$c = explode(&quot;:&quot;,$c);  //passHash:id =&gt; asd5453asf54a:52
			//if($c[1] != 1){ return false; $this-&gt;report(&quot;No auto Login&quot;); } //No AutoLogin set return false
			$this-&gt;id = $c[1];
			$this-&gt;pass = $c[0];
			$auto = true;
			$this-&gt;report(&quot;Attemping Login with cookies&quot;);
		}else{
		//Credetials Login
			if(!$user == false &amp;amp;&amp;amp; !$pass == false){
				$this-&gt;username = $user;
				$this-&gt;hash_pass($pass);
				$this-&gt;report(&quot;Creadentials recieved&quot;);
			}else{
				$this-&gt;error(&quot;No Username or Password provided&quot;);
				return false;
			}
		}

		$this-&gt;report(&quot;I got info Quering Database to autenticate user&quot;);
		//Query Database and check login
		$query = mysql_query(&quot;SELECT * FROM users WHERE user_id='{$this-&gt;id}' OR username='{$this-&gt;username}' AND password='{$this-&gt;pass}'&quot;);
		if(mysql_num_rows($query) == 1){
			$this-&gt;data = mysql_fetch_assoc($query);
			$d = $this-&gt;data;
			//If Account is not Activated
			if($d['activated'] != 1){
				if($d['last_login'] == 0){
					//Account has not been activated
					$this-&gt;error(&quot;Your Account has not been Activated. Check your Email for instructions&quot;);
				}else{
					//Account has been deactivated
					$this-&gt;error(&quot;Your account has been deactivated. Please contact Administrator&quot;);
				}
				return false;
			}
			//Account is Activated and user is logged in
			$this-&gt;update_session($d);
			
			//If auto Remember User
			if($auto){
				$this-&gt;setCookie();
			}
			//Update last_login
			$time = time();
			$sql = &quot;UPDATE users SET last_login='{$time}' WHERE user_id='{$this-&gt;id}'&quot;;
			$this-&gt;check_sql($sql,true);
			//Done
			$this-&gt;report(&quot;User Logged in Successfully&quot;);
			return true;
		}else{
			$this-&gt;error(&quot;Wrong Username or Password&quot;);
			return false;
		}
	}
	
	function logout(){
		$this-&gt;log = &quot;login&quot;;
		setcookie(&quot;auto&quot;, &quot;&quot;, time()-3600,&quot;/&quot;,&quot;.&quot;.$_SERVER['HTTP_HOST']); //Deletes the Auto Coookie
		session_unset();
		$this-&gt;report(&quot;User Logged out&quot;);
	}
	
	private function setCookie(){
		$value = $this-&gt;pass;
		$value .= &quot;:&quot;;
		$value .= $this-&gt;id;
		setcookie(&quot;auto&quot;,$value,strtotime(&quot;+15 days&quot;),&quot;/&quot;,&quot;.&quot;.$_SERVER['HTTP_HOST']);
		$this-&gt;report(&quot;Cookies have been updated for auto login&quot;);
	}
	
	function update_session($d){
		$_SESSION = $d;
		$_SESSION['signed'] = true;
		
		$this-&gt;id = $d['user_id'];
		$this-&gt;username = $d['username'];
		$this-&gt;pass = $d['password'];
		$this-&gt;signed = true;
		
		$this-&gt;report(&quot;session updated&quot;);
	}
	
	function update_from_session(){
		$d = $_SESSION;
		
		$this-&gt;id = $d['user_id'];
		$this-&gt;data = $d;
		$this-&gt;username = $d['username'];
		$this-&gt;pass = $d['password'];
		$this-&gt;signed = true;
	}
	function hash_pass($pass){
		$salt = $this-&gt;salt;
		$this-&gt;pass = md5($salt.$pass.$salt);
		return $this-&gt;pass;
	}
	
	function report($str=false){
		$index = $this-&gt;log;
		if($str){
			$str = ucfirst($str);
			$this-&gt;console['reports'][$index][] = $str; //Strore Report
		}else{
			if($index){
				return $this-&gt;console['reports'][$index]; //Return the $index Reports Array
			}else{
				return $this-&gt;console['reports']; //Return the Full Reports Array
			}
		}
	}

	function error($str=false){
		$index = $this-&gt;log;
		if($str){
			$str = ucfirst($str); //Style String by making first character uppercase
			$this-&gt;console['errors'][$index][] = $str; //Strore Error
			$this-&gt;report(&quot;Error: {$str}&quot;); //Report The error
		}else{
			if($index){
				return $this-&gt;console['errors'][$index]; //Return the $index Errors Array
			}else{
				return $this-&gt;console['errors']; //Return the Full Error Array
			}
		}
	}
	
	//Adds fields with errors to the console
	function form_error($field=false){
		$index = $this-&gt;log;
		if($field){
			$this-&gt;console['form'][$index][] = $field;	
		}else{
			if($index){
				return $this-&gt;console['form'][$index]; //Return the $index Errors Array
			}else{
				return $this-&gt;console['form']; //Return the Full form Array
			}
		}
	}
	
	//Check for errors in the console
	function has_error(){
		//Check for errors
		if($this-&gt;console['errors'][$this-&gt;log] != &quot;&quot;){
			$count = count($this-&gt;console['errors'][$this-&gt;log]);
			$this-&gt;report(&quot;$count Error(s) Found!&quot;);
			return true;
		}else{
			$this-&gt;report(&quot;No Error Found!&quot;);
			return false;
		}
	}
	
	//Generates a unique comfirm hash
	function uConfirm($length = false){
		$code = md5(uniqid(rand(), true));
		if($length != false){
			$this-&gt;confirm = substr($code, 0, $length);
		}else{
			$this-&gt;confirm = $code;
		}
	}
	
	//Test field in database for a value
	function check_field($field, $val, $str=false){
		$query = mysql_query(&quot;SELECT {$field} FROM users WHERE {$field}='{$val}' &quot;);
			if(mysql_num_rows($query) &gt;= 1){
				if($str){
					$this-&gt;error($str);
				}else{
					$this-&gt;error(&quot;There was a match for  $field = $val&quot;);
				}
				return true;
			}else{
				$this-&gt;report(&quot;No Match on Field $field=$val&quot;);
				return false;
			}
	}
	
	//Executes SQL query and checks for success
	function check_sql($sql,$debug = false){
		$this-&gt;report(&quot;SQL: {$sql}&quot;); //Log the SQL Query first
		if (!mysql_query($sql)){
			if($debug){
				$this-&gt;error(mysql_error());
			}
			return false;
		}else{
			return true;
		}
	}
	
	//Executes SQL query and expects a change in database
	function check_sql_change($sql,$debug = false){
		$this-&gt;report(&quot;SQL: {$sql}&quot;); //Log the SQL Query
		if (!mysql_query($sql)){
			if($debug){
				$this-&gt;error(mysql_error());
				return false; //die('Error: ' . mysql_error());
			}else{
				return false;
			}
		}else{
			$rows = mysql_affected_rows();
			if($rows &gt; 0){
				//Good, Rows where affected
				$this-&gt;report(&quot;$rows row(s) where Affected&quot;);
				return true;
			}else{
				//Bad, No Rows where Affected
				$this-&gt;report(&quot;No row was Affected&quot;);
				return false;
			}
		}
	}
	
	//Validates field($name) in tmp_data
	private function validate($name,$limit,$regEx=false){
		$str = $this-&gt;tmp_data[$name];
		$l = explode(&quot;-&quot;,$limit);
		$min = intval($l[0]);
		$max = intval($l[1]);
		if(!$max || !$min){
			$this-&gt;report(&quot;Invalid second paramater for the private validate method on $name&quot;);
			return false;
		}
		if(!$str){
			if(!isset($this-&gt;tmp_data[$name])){
				$this-&gt;error(&quot;missing index $name from the POST array&quot;);
			}
			if(strlen($str) == $min){
				$this-&gt;report(&quot;$name is blank and optional - skipped&quot;);
				return true;
			}
			$this-&gt;error(&quot;$name is required&quot;);
			$this-&gt;form_error($name);
			return false;
		}
		if(strlen($str) &gt; $max){
			$this-&gt;error(&quot;The $name is larger than $max character/digits&quot;);
			$this-&gt;form_error($name);
			return false;
		}
		if(strlen($str) &lt; $min){
			$this-&gt;error(&quot;The $name is too short. it should at least be $min character/digits long&quot;);
			$this-&gt;form_error($name);
			return false;
		}
		if($regEx){
			preg_match_all($regEx,$str,$match);
			//print_r($match);echo count($match[0]).&quot;+&quot;;
			
			if(count($match[0]) != 1){
				$this-&gt;error(&quot;The $name \&quot;{$str}\&quot; is not valid&quot;);
				$this-&gt;form_error($name);
				return false;
			}
		}
		
		$this-&gt;report(&quot;The $name is Valid&quot;);
		return true;
	}
}
	


?&gt;
</pre>
</div>
<br>
<p>uFlex or userFlex is an all in one PHP user class that provides developers with a simple yet secured, reliable and flexible framework like structure to authenticate their sites and applications. The purpose of uFlex is to handle the tedious processes involved in authenticating users.</p>

</div>

<div class="result">
<h2 class="title">
<a href="/user/creativeboulder">creativeboulder</a>/<a href="/snippet/apache/htaccess-standard-with-compression-and-bad-bot-rewrites">.htaccess (Standard with Compression and Bad-Bot ReWrites)</a>
<span class="language">(<a href="/language/apache/"> Apache</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: shell;">
# /.htacess
# Last Updated on February 10, 2011

# BEGIN Basic Settings
Options  +execCGI +FollowSymLinks
Options All -Indexes

ErrorDocument 404 /404.php
ErrorDocument 401 /404.php
ErrorDocument 403 /404.php
ErrorDocument 500 /404.php

order allow,deny
deny from 205.203.134.197
deny from 109.230.246.24
deny from 85.17.26.202
deny from 85.17.26.196
deny from 109.230.246.*
allow from all

# Remove ETags
Header unset ETag
FileETag None

# BEGIN GZip &amp;amp; Compression
&lt;IfModule mod_headers.c&gt;
    &lt;IfModule mod_mime.c&gt;
        # Add custom mime type, to be able to use it in the 'AddOutputFilterByType' declaration (gzip font-face files: http://www.phpied.com/gzip-your-font-face-files/)
        AddType application/vnd.ms-fontobject .eot
        AddType font/truetype .ttf
        AddType font/opentype .otf
        AddType font/woff .woff
        # Proper svg serving. Required for svg webfonts on iPad (http://twitter.com/FontSquirrel/status/14855840545)
        AddType image/svg+xml svg svgz
        AddEncoding gzip svgz
    &lt;/IfModule&gt;

    # Apache 1.3 uses mod_gzip while Apache 2.x uses mod_deflate (http://httpd.apache.org/docs/2.0/mod/mod_deflate.html)
    &lt;IfModule mod_deflate.c&gt;
        # Enable the compression (gzip) for any type of content
        #SetOutputFilter DEFLATE
        # Or (alternatively) define which filetypes should pass through the DEFLATE output filter (gzip compression)
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/x-javascript application/json
        # html, xml, css, and js above, webfonts and svg below
        &lt;FilesMatch &quot;\.(ttf|otf|woff|eot|svg|svgz)$&quot; &gt;
            SetOutputFilter DEFLATE
        &lt;/FilesMatch&gt;

        # Turne-off (or restrict) compression to files of type text/html for known problematic web browsers
        BrowserMatch ^Mozilla/4 gzip-only-text/html
        BrowserMatch ^Mozilla/4\.0[678] no-gzip
        #BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
        # NOTE: Due to a bug in mod_setenvif up to Apache 2.0.48
        # the above regex won't work. You can use the following
        # workaround to get the desired effect:
        BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

        # File types not to be compressed
        SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \.(?:swf|flv|pdf)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \.(?:avi|mov)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \.(?:mp3|mp4)$ no-gzip dont-vary

        # Make sure proxies don't deliver the wrong content
        Header append Vary User-Agent env=!dont-vary

    &lt;/IfModule&gt;
    # Allow access from all domains for webfonts (alternatively you could only whitelist your subdomains like &quot;sub.domain.com&quot;)
    &lt;FilesMatch &quot;\.(ttf|otf|eot|woff|font.css)$&quot;&gt;
        Header set Access-Control-Allow-Origin &quot;*&quot;
    &lt;/FilesMatch&gt;
&lt;/IfModule&gt;

# BEGIN EXPIRES
Header unset ETag
FileETag None
&lt;IfModule mod_expires.c&gt;
    &lt;FilesMatch &quot;\.(gif|jpg|jpeg|png|swf|flv|pdf|ico|avi|mov|ppt|doc|mp3|wmv|wav|txt|css|js|html?|php|xml|eot|ttf|otf|woff)$&quot;&gt;
        ExpiresActive On
        Header unset Last-Modified
        Header set Expires &quot;Fri, 21 Dec 2013 00:00:00 GMT&quot;
        Header set Cache-Control &quot;public, no-transform&quot;
        ExpiresDefault &quot;access plus 1 year&quot;
        FileETag Size
    &lt;/FilesMatch&gt;

    &lt;FilesMatch &quot;\.(gif|jpg|jpeg|png|swf|flv|ico|pdf|avi|mov|ppt|doc|mp3|wmv|wav|txt|eot|ttf|otf|woff)$&quot;&gt;
        Header append Cache-Control: public
    &lt;/FilesMatch&gt;
    &lt;FilesMatch &quot;\.(css|js|html?|php|xml)$&quot;&gt;
        Header append Cache-Control: private
    &lt;/FilesMatch&gt;
&lt;/IfModule&gt;

# BEGIN CACHING
&lt;IfModule mod_expires.c&gt;
ExpiresActive On
ExpiresDefault A86400
ExpiresByType image/x-icon A2592000
ExpiresByType application/x-javascript A2592000
ExpiresByType text/css A2592000
ExpiresByType image/gif A604800
ExpiresByType image/png A604800
ExpiresByType image/jpeg A604800
ExpiresByType text/plain A604800
ExpiresByType application/x-shockwave-flash A604800
ExpiresByType video/x-flv A604800
ExpiresByType application/pdf A604800
ExpiresByType text/html A900
&lt;/IfModule&gt;

# 3 Month
&lt;FilesMatch &quot;\.(flv|gif|jpg|jpeg|png|ico|swf)$&quot;&gt;
    Header set Cache-Control &quot;max-age=7257600&quot;
&lt;/FilesMatch&gt;
# 1 Week
&lt;FilesMatch &quot;\.(js|css|pdf|txt)$&quot;&gt;
    Header set Cache-Control &quot;max-age=604800&quot;
&lt;/FilesMatch&gt;
# 10 Minutes
&lt;FilesMatch &quot;\.(html|htm)$&quot;&gt;
    Header set Cache-Control &quot;max-age=600&quot;
&lt;/FilesMatch&gt;
# NONE
&lt;FilesMatch &quot;\.(pl|php|cgi|spl)$&quot;&gt;
    Header unset Cache-Control
    Header unset Expires
    Header unset Last-Modified
    FileETag None
    Header unset Pragma
&lt;/FilesMatch&gt;

# BEGIN Redirects from previous versions
&lt;IfModule mod_rewrite.c&gt;
RewriteEngine On
RewriteBase /
RewriteCond %{HTTP_USER_AGENT} ^(aesop_com_spiderman|alexibot|backweb|bandit|batchftp|bigfoot) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(black.?hole|blackwidow|blowfish|botalot|buddy|builtbottough|bullseye) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(cheesebot|cherrypicker|chinaclaw|collector|copier|copyrightcheck) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(cosmos|crescent|curl|custo|da|diibot|disco|dittospyder|dragonfly) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(drip|easydl|ebingbong|ecatch|eirgrabber|emailcollector|emailsiphon) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(emailwolf|erocrawler|exabot|eyenetie|filehound|flashget|flunky) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(frontpage|getright|getweb|go.?zilla|go-ahead-got-it|gotit|grabnet) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(grafula|harvest|hloader|hmview|httplib|httrack|humanlinks|ilsebot) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(infonavirobot|infotekies|intelliseek|interget|iria|jennybot|jetcar) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(joc|justview|jyxobot|kenjin|keyword|larbin|leechftp|lexibot|lftp|libweb) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(likse|linkscan|linkwalker|lnspiderguy|lwp|magnet|mag-net|markwatch) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(mata.?hari|memo|microsoft.?url|midown.?tool|miixpc|mirror|missigua) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(mister.?pix|moget|mozilla.?newt|nameprotect|navroad|backdoorbot|nearsite) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(net.?vampire|netants|netcraft|netmechanic|netspider|nextgensearchbot) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(attach|nicerspro|nimblecrawler|npbot|octopus|offline.?explorer) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(offline.?navigator|openfind|outfoxbot|pagegrabber|papa|pavuk) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(pcbrowser|php.?version.?tracker|pockey|propowerbot|prowebwalker) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(psbot|pump|queryn|recorder|realdownload|reaper|reget|true_robot) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(repomonkey|rma|internetseer|sitesnagger|siphon|slysearch|smartdownload) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(snake|snapbot|snoopy|sogou|spacebison|spankbot|spanner|sqworm|superbot) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(superhttp|surfbot|asterias|suzuran|szukacz|takeout|teleport) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(telesoft|the.?intraformant|thenomad|tighttwatbot|titan|urldispatcher) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(turingos|turnitinbot|urly.?warning|vacuum|vci|voideye|whacker) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(libwww-perl|widow|wisenutbot|wwwoffle|xaldon|xenu|zeus|zyborg|anonymouse) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^web(zip|emaile|enhancer|fetch|go.?is|auto|bandit|clip|copier|master|reaper|sauger|site.?quester|whack) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^.*(craftbot|download|extract|stripper|sucker|ninja|clshttp|webspider|leacher|collector|grabber|webpictures).*$ [NC]
RewriteCond %{HTTP_USER_AGENT} ^BlackWidow [OR]
RewriteCond %{HTTP_USER_AGENT} ^Bot\ mailto:craftbot@yahoo.com [OR]
RewriteCond %{HTTP_USER_AGENT} ^ChinaClaw [OR]
RewriteCond %{HTTP_USER_AGENT} ^Custo [OR]
RewriteCond %{HTTP_USER_AGENT} ^DISCo [OR]
RewriteCond %{HTTP_USER_AGENT} ^Download\ Demon [OR]
RewriteCond %{HTTP_USER_AGENT} ^eCatch [OR]
RewriteCond %{HTTP_USER_AGENT} ^EirGrabber [OR]
RewriteCond %{HTTP_USER_AGENT} ^EmailSiphon [OR]
RewriteCond %{HTTP_USER_AGENT} ^EmailWolf [OR]
RewriteCond %{HTTP_USER_AGENT} ^Express\ WebPictures [OR]
RewriteCond %{HTTP_USER_AGENT} ^ExtractorPro [OR]
RewriteCond %{HTTP_USER_AGENT} ^EyeNetIE [OR]
RewriteCond %{HTTP_USER_AGENT} ^FlashGet [OR]
RewriteCond %{HTTP_USER_AGENT} ^GetRight [OR]
RewriteCond %{HTTP_USER_AGENT} ^GetWeb! [OR]
RewriteCond %{HTTP_USER_AGENT} ^Go!Zilla [OR]
RewriteCond %{HTTP_USER_AGENT} ^Go-Ahead-Got-It [OR]
RewriteCond %{HTTP_USER_AGENT} ^GrabNet [OR]
RewriteCond %{HTTP_USER_AGENT} ^Grafula [OR]
RewriteCond %{HTTP_USER_AGENT} ^HMView [OR]
RewriteCond %{HTTP_USER_AGENT} HTTrack [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^Image\ Stripper [OR]
RewriteCond %{HTTP_USER_AGENT} ^Image\ Sucker [OR]
RewriteCond %{HTTP_USER_AGENT} Indy\ Library [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^InterGET [OR]
RewriteCond %{HTTP_USER_AGENT} ^Internet\ Ninja [OR]
RewriteCond %{HTTP_USER_AGENT} ^JetCar [OR]
RewriteCond %{HTTP_USER_AGENT} ^JOC\ Web\ Spider [OR]
RewriteCond %{HTTP_USER_AGENT} ^larbin [OR]
RewriteCond %{HTTP_USER_AGENT} ^LeechFTP [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mass\ Downloader [OR]
RewriteCond %{HTTP_USER_AGENT} ^MIDown\ tool [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mister\ PiX [OR]
RewriteCond %{HTTP_USER_AGENT} ^Navroad [OR]
RewriteCond %{HTTP_USER_AGENT} ^NearSite [OR]
RewriteCond %{HTTP_USER_AGENT} ^NetAnts [OR]
RewriteCond %{HTTP_USER_AGENT} ^NetSpider [OR]
RewriteCond %{HTTP_USER_AGENT} ^Net\ Vampire [OR]
RewriteCond %{HTTP_USER_AGENT} ^NetZIP [OR]
RewriteCond %{HTTP_USER_AGENT} ^Octopus [OR]
RewriteCond %{HTTP_USER_AGENT} ^Offline\ Explorer [OR]
RewriteCond %{HTTP_USER_AGENT} ^Offline\ Navigator [OR]
RewriteCond %{HTTP_USER_AGENT} ^PageGrabber [OR]
RewriteCond %{HTTP_USER_AGENT} ^Papa\ Foto [OR]
RewriteCond %{HTTP_USER_AGENT} ^pavuk [OR]
RewriteCond %{HTTP_USER_AGENT} ^pcBrowser [OR]
RewriteCond %{HTTP_USER_AGENT} ^RealDownload [OR]
RewriteCond %{HTTP_USER_AGENT} ^ReGet [OR]
RewriteCond %{HTTP_USER_AGENT} ^SiteSnagger [OR]
RewriteCond %{HTTP_USER_AGENT} ^SmartDownload [OR]
RewriteCond %{HTTP_USER_AGENT} ^SuperBot [OR]
RewriteCond %{HTTP_USER_AGENT} ^SuperHTTP [OR]
RewriteCond %{HTTP_USER_AGENT} ^Surfbot [OR]
RewriteCond %{HTTP_USER_AGENT} ^tAkeOut [OR]
RewriteCond %{HTTP_USER_AGENT} ^Teleport\ Pro [OR]
RewriteCond %{HTTP_USER_AGENT} ^VoidEYE [OR]
RewriteCond %{HTTP_USER_AGENT} ^Web\ Image\ Collector [OR]
RewriteCond %{HTTP_USER_AGENT} ^Web\ Sucker [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebAuto [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebCopier [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebFetch [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebGo\ IS [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebLeacher [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebReaper [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebSauger [OR]
RewriteCond %{HTTP_USER_AGENT} ^Website\ eXtractor [OR]
RewriteCond %{HTTP_USER_AGENT} ^Website\ Quester [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebStripper [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebWhacker [OR]
RewriteCond %{HTTP_USER_AGENT} ^WebZIP [OR]
RewriteCond %{HTTP_USER_AGENT} ^Wget [OR]
RewriteCond %{HTTP_USER_AGENT} ^Widow [OR]
RewriteCond %{HTTP_USER_AGENT} ^WWWOFFLE [OR]
RewriteCond %{HTTP_USER_AGENT} ^Xaldon\ WebSpider [OR]
RewriteCond %{HTTP_USER_AGENT} ^Zeus
RewriteRule ^somedirectory/(.*)$ http://yourDomain.com/someFile.php [L,R=301]
&lt;/IfModule&gt;
</pre>
</div>
<br>
<p>This is a basic .htaccess file for Apache. I have commented off certain sections for Gzip and File Type Compression, Basic Template for ReWrites and Web Font control, plus Cache-Control.</p>

</div>

<div class="result">
<h2 class="title">
<a href="/user/komposition">komposition</a>/<a href="/snippet/other/offspringjs">offspring.js</a>
<span class="language">(<a href="/language/other/"> Other</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: text;">
/*
	Offspring.js -- adds the following classes as needed:

		.first-child
		.last-child
		.only-child
		.nth-child-odd
		.nth-child-even
		.nth-child-##
		
	Configuration:
	
	Offspring can be configured by defining an &quot;offspringConfiguration&quot; 
	object before referencing offspring.js. That object can contain
	one or more of these parameters. (If any parameter is omitted -- which
	is fine -- it gets the default value as described below.) 
	
	offspringConfiguration = 
	{
		runningMode: 'full',                        &lt;-- valid values are 'full' and 'light' (default: 'full')
		autoStart: true,                            &lt;-- valid values are true and false (default: true)
		shouldRemoveOldOffspringClassesFirst: false &lt;-- valid values are true and false (default: false)
	}
	
	* runningMode: 
		'full' -- Offspring applies all of its classes (as listed at the very top) [default]
		'light' -- Offspring only applies 'first-child', 'last-child', and 'only-child',
					omitting 'nth-child-odd', 'nth-child-even', and 'nth-child-##'.
					(This may allow for faster page-processing in certain scenarios.)
					
	* autoStart:
		true -- Offspring runs automatically as soon as the DOM is ready [default]
		false -- Offspring must be run manually. This can be done by calling Offspring.start();
		
	* shouldRemoveOldOffspringClassesFirst:
		true --Offspring first removes any old Offspring classes before applying the new ones.
				(This might be of use if Offspring is to be called on a page that has already
				been processed, such as if a table has been sorted or content has been loaded
				via Ajax.)
		false -- Offspring applies its classes without first removing old Offspring classes that
				might be there. Unless you're doing fancy DOM updates, this is probably the
				better option in most cases. [default]

	================================================================== */


var offspring = {
	firstChildClass: &quot;first-child&quot;,
	lastChildClass:  &quot;last-child&quot;,
	oddChildClass:   &quot;nth-child-odd&quot;,
	evenChildClass:  &quot;nth-child-even&quot;,
	onlyChildClass:  &quot;only-child&quot;,
	nthChildClassPrefix:   &quot;nth-child-&quot;,

	classNamesArray: [],
	classNameSubstringsArray: [],

	cacheLevel: 0, // current size of the classNames cache

	nthChildren: [],

	regularHashTable: [],
	regularHashTableArray: [],

	lastChildHashTable: [],
	lastChildHashTableArray: [],

	/* Configuration defaults */
	configuration:
	{
		runningMode: 'full', /* Possible values: 'full' / 'light' */
		autoStart: true, /* If Offspring is configured in autoStart mode (which it is by default),
		 					it runs as soon as the DOM is ready */
		shouldRemoveOldOffspringClassesFirst: false /* If this is set to 'true', Offspring first
														removes any old Offspring-related classes
														before applying the new ones */
	},

	// Initialize
	init: function() {

		/*
			Offspring's configuration is stored in Offspring.configuration, but
			that con be overridden by users by defining an &quot;offspringConfiguratin&quot;
			object.
		*/
		if (typeof offspringConfiguration != &quot;undefined&quot;)
		{
			for (var configParameter in offspringConfiguration)
			{
				this.configuration[configParameter] = offspringConfiguration[configParameter];
			}

			// Make sure this option is stored in lowercase
			this.configuration.runningMode = this.configuration.runningMode.toLowerCase();
		}


		/* Set the values for classNamesArray &amp;amp; classNameSubstringArray */

		switch (this.configuration.runningMode)
		{
			case 'full':
				// this represents all possible offspring-related classnames
				this.classNamesArray = [this.firstChildClass, this.lastChildClass, this.oddChildClass, this.evenChildClass, this.onlyChildClass];

				// this represents a list of substrings to match such as for removing classNames
				this.classNameSubstringsArray = [this.nthChildClassPrefix];
				break;

			case 'light':
				// this represents all possible offspring-related classnames
				this.classNamesArray = [this.firstChildClass, this.lastChildClass, this.onlyChildClass];

				// this represents a list of substrings to match such as for removing classNames
				this.classNameSubstringsArray = [];
				break;
		}

		// Define the iterator function on-the-fly depending
		// on the configuration options that were sent in
		this.defineTraverseChildrenFunction();

		// Define the fillCacheTo funtion's iterator on-the-fly
		// depending on the configuration options that were sent in
		this.defineFillCacheToFunction();
		this.fillCacheTo(); // seed the cache with a basic set of values

 
		/* If Offspring is configured in autoStart mode (which it is by default),
		 	it runs as soon as the DOM is ready */
		if (this.configuration.autoStart)
		{
			var _this = this; // Closure

			this.ContentLoaded(window, function() {
				_this.start();
			});			
		}

	},

	// Executed once the page has loaded
	start: function() {
		var startTime = new Date();

		this.traverseChildren(document.getElementsByTagName(&quot;body&quot;)[0]);

		var endTime = new Date();
		// alert(&quot;Offspring Exec time: &quot; + (endTime.getTime() - startTime.getTime()) + &quot;ms&quot;);
		// window.status += &quot;Offspring Exec time: &quot; + (endTime.getTime() - startTime.getTime()) + &quot;ms&quot;;

	},

	/* Maintenance note for defineTraverseChildrenFunction:
	
		There are several blocks of code that are marked off as &quot;traverseChildren.A&quot;
		or &quot;traverseChildren.B&quot; -- each of these are identical, respectively. (That is,
		all &quot;traverseChildren.A&quot; blocks are the same and all &quot;traverseChildren.B&quot; are 
		the same.) 
		
		So, why not just create a function where the code can be kept in one place? 
		While normally a sensible idea, I decided against that approach only so 
		that the speed hits associated with the creation of the function stack
		could be averted. At the same time, I didn't want to compromise
		the code's maintainability; so, if any block needs to be updated, they
		can all be kept in sync with some basic copy-n-pasting from one 
		block to the next.
	*/


	/* This defines the internal iterator function on-the-fly,
		depending on the configuration options */
	defineTraverseChildrenFunction: function() {

		switch (this.configuration.shouldRemoveOldOffspringClassesFirst)
		{
			case true: // shouldRemoveOldOffspringClassesFirst is true

				switch (this.configuration.runningMode)
				{
					case 'full': // 'full' running mode and shouldRemoveOldOffspringClassesFirst is true
						this.traverseChildren = function(parent)
						{
							/* ============= Begin Code Block &quot;traverseChildren.A&quot; ================ */

								// If the node has no children, exit
								if (!parent.childNodes.length) return;


								/* First, gather up all the element nodes */
								var childElementNodes = [];

								var testNode = parent.childNodes[0]; // initialize

								while (testNode)
								{
									if (testNode.nodeType == 1)
									{
										childElementNodes.push(testNode);
									}
									testNode = testNode.nextSibling;
								}

								/*
									empty this variable to ensure that the JavaScript
									interpreter doesn't have to update the variable's
									nodelist as DOM changes are made
								*/
								testNode = null;

								var childElementNodesLength = childElementNodes.length;

								// If no element nodes were found, exit
								if (!childElementNodesLength) return;

								// Make sure that the CSS-classnames cache has enough entries to cover
								// the number of child nodes
								if (childElementNodesLength &gt; this.cacheLevel)
								{
									this.fillCacheTo(childElementNodesLength);
								}

								var lastIndex = childElementNodesLength - 1; // index of the last element node

							/* ============= /End Code Block &quot;traverseChildren.A&quot; ================ */

							// First, take care of all but the last element
							for (var i = 0; i &lt; lastIndex; i++)
							{
								var currentElement = childElementNodes[i];

								this.removeMultipleClassNames(currentElement, this.classNamesArray, this.classNameSubstringsArray);

								// argument syntax: node to act upon, current index, boolean for whether isLast
								this._addOffspringClassNames(currentElement, i, false);
								this.traverseChildren(currentElement);
							}

							currentElement = null; // prevent memory leaks

							// Then, take care of the last one
							var lastElement = childElementNodes[lastIndex];

							this.removeMultipleClassNames(lastElement, this.classNamesArray, this.classNameSubstringsArray);

							this._addOffspringClassNames(lastElement, lastIndex, true);
							this.traverseChildren(lastElement);

							lastElement = null; // prevent memory leaks

							/* ============= Begin Code Block &quot;traverseChildren.B&quot; ================ */

								// prevent memory leaks
								lastElement = null;
								parent = null;

							/* ============= /End Code Block &quot;traverseChildren.B&quot; ================ */

						}; // end of traverseChildren function definition
						break;

					case 'light': // 'light' running mode and shouldRemoveOldOffspringClassesFirst is true
						this.traverseChildren = function(parent)
						{
							/* ============= Begin Code Block &quot;traverseChildren.A&quot; ================ */

								// If the node has no children, exit
								if (!parent.childNodes.length) return;


								/* First, gather up all the element nodes */
								var childElementNodes = [];

								var testNode = parent.childNodes[0]; // initialize

								while (testNode)
								{
									if (testNode.nodeType == 1)
									{
										childElementNodes.push(testNode);
									}
									testNode = testNode.nextSibling;
								}

								/*
									empty this variable to ensure that the JavaScript
									interpreter doesn't have to update the variable's
									nodelist as DOM changes are made
								*/
								testNode = null;

								var childElementNodesLength = childElementNodes.length;

								// If no element nodes were found, exit
								if (!childElementNodesLength) return;

								// Make sure that the CSS-classnames cache has enough entries to cover
								// the number of child nodes
								if (childElementNodesLength &gt; this.cacheLevel)
								{
									this.fillCacheTo(childElementNodesLength);
								}

								var lastIndex = childElementNodesLength - 1; // index of the last element node

							/* ============= /End Code Block &quot;traverseChildren.A&quot; ================ */

							switch (childElementNodesLength)
							{
								case 0: return;
										break;

								case 1:
									/* Take care of the only element */

									var onlyElement = childElementNodes[0];
									this.removeMultipleClassNames(onlyElement, this.classNamesArray, this.classNameSubstringsArray);

									// argument syntax: node to act upon, current index, boolean for whether isLast
									this._addOffspringClassNames( onlyElement, lastIndex, true );

									onlyElement = null; // prevent memory leaks

									break;

								default:
									/* Take care of the first element */

									var firstElement = childElementNodes[0];
									this.removeMultipleClassNames(firstElement, this.classNamesArray, this.classNameSubstringsArray);

									// argument syntax: node to act upon, current index, boolean for whether isLast
									this._addOffspringClassNames( firstElement, 0, false );

									firstElement = null; // prevent memory leaks

									/* Take care of the last element */

									var lastElement = childElementNodes[lastIndex];
									this.removeMultipleClassNames(lastElement, this.classNamesArray, this.classNameSubstringsArray);

									// argument syntax: node to act upon, current index, boolean for whether isLast
									this._addOffspringClassNames( lastElement , lastIndex, true );

									lastElement = null; // prevent memory leaks

									break;

							} // end of switch statement for childElementNodesLength

							// Lastly, loop over all the childern elements
							for (var i = 0; i &lt; childElementNodesLength; i++)
							{
								this.traverseChildren( childElementNodes[i] );
							}

							/* ============= Begin Code Block &quot;traverseChildren.B&quot; ================ */

								// prevent memory leaks
								lastElement = null;
								parent = null;

							/* ============= /End Code Block &quot;traverseChildren.B&quot; ================ */

						}; // end of traverseChildren function definition

						break;

				} // end of switch-statement for configuration.runningMode

				break;

			case false: // shouldRemoveOldOffspringClassesFirst is false

				switch (this.configuration.runningMode)
				{
					case 'full': // 'full' running mode and shouldRemoveOldOffspringClassesFirst is false
						this.traverseChildren = function(parent)
						{
							/* ============= Begin Code Block &quot;traverseChildren.A&quot; ================ */

								// If the node has no children, exit
								if (!parent.childNodes.length) return;


								/* First, gather up all the element nodes */
								var childElementNodes = [];

								var testNode = parent.childNodes[0]; // initialize

								while (testNode)
								{
									if (testNode.nodeType == 1)
									{
										childElementNodes.push(testNode);
									}
									testNode = testNode.nextSibling;
								}

								/*
									empty this variable to ensure that the JavaScript
									interpreter doesn't have to update the variable's
									nodelist as DOM changes are made
								*/
								testNode = null;

								var childElementNodesLength = childElementNodes.length;

								// If no element nodes were found, exit
								if (!childElementNodesLength) return;

								// Make sure that the CSS-classnames cache has enough entries to cover
								// the number of child nodes
								if (childElementNodesLength &gt; this.cacheLevel)
								{
									this.fillCacheTo(childElementNodesLength);
								}

								var lastIndex = childElementNodesLength - 1; // index of the last element node

							/* ============= /End Code Block &quot;traverseChildren.A&quot; ================ */

							// First, take care of all but the last element
							for (var i = 0; i &lt; lastIndex; i++)
							{
								var currentElement = childElementNodes[i];

								// argument syntax: node to act upon, current index, boolean for whether isLast
								this._addOffspringClassNames(currentElement, i, false);
								this.traverseChildren(currentElement);
							}

							currentElement = null; // prevent memory leaks

							/*
								Then, take care of the last one
								(this set of code isn't integrated into
								the for-loop above so as to avoid having
								an addiitional if-statement inside there)
							*/
							var lastElement = childElementNodes[lastIndex];

							this._addOffspringClassNames(lastElement, lastIndex, true);
							this.traverseChildren(lastElement);
							lastElement = null; // prevent memory leaks

							/* ============= Begin Code Block &quot;traverseChildren.B&quot; ================ */

								// prevent memory leaks
								lastElement = null;
								parent = null;

							/* ============= /End Code Block &quot;traverseChildren.B&quot; ================ */

						}; // end of traverseChildren function definition
						break;

					case 'light': // 'light' running mode and shouldRemoveOldOffspringClassesFirst is false
						this.traverseChildren = function(parent)
						{
							/* ============= Begin Code Block &quot;traverseChildren.A&quot; ================ */

								// If the node has no children, exit
								if (!parent.childNodes.length) return;


								/* First, gather up all the element nodes */
								var childElementNodes = [];

								var testNode = parent.childNodes[0]; // initialize

								while (testNode)
								{
									if (testNode.nodeType == 1)
									{
										childElementNodes.push(testNode);
									}
									testNode = testNode.nextSibling;
								}

								/*
									empty this variable to ensure that the JavaScript
									interpreter doesn't have to update the variable's
									nodelist as DOM changes are made
								*/
								testNode = null;

								var childElementNodesLength = childElementNodes.length;

								// If no element nodes were found, exit
								if (!childElementNodesLength) return;

								// Make sure that the CSS-classnames cache has enough entries to cover
								// the number of child nodes
								if (childElementNodesLength &gt; this.cacheLevel)
								{
									this.fillCacheTo(childElementNodesLength);
								}

								var lastIndex = childElementNodesLength - 1; // index of the last element node

							/* ============= /End Code Block &quot;traverseChildren.A&quot; ================ */

							switch (childElementNodesLength)
							{
								case 0: break;

								case 1:
									/* Take care of the only element */

									// argument syntax: node to act upon, current index, boolean for whether isLast
									this._addOffspringClassNames( childElementNodes[0], lastIndex, true );

									// Lastly, loop over all the childern elements
									for (var i = 0; i &lt; childElementNodesLength; i++)
									{
										this.traverseChildren( childElementNodes[i] );
									}

									break;

								default:
									/* Take care of the first element */

									// argument syntax: node to act upon, current index, boolean for whether isLast
									this._addOffspringClassNames( childElementNodes[0], 0, false );

									/* Take care of the last element */

									// argument syntax: node to act upon, current index, boolean for whether isLast
									this._addOffspringClassNames( childElementNodes[lastIndex] , lastIndex, true );

									// Lastly, loop over all the childern elements
									for (var i = 0; i &lt; childElementNodesLength; i++)
									{
										this.traverseChildren( childElementNodes[i] );
									}

									break;
							}

							/* ============= Begin Code Block &quot;traverseChildren.B&quot; ================ */

								// prevent memory leaks
								lastElement = null;
								parent = null;

							/* ============= /End Code Block &quot;traverseChildren.B&quot; ================ */

						}; // end of traverseChildren function definition

						break;
				} // end of switch-statement for configuration.runningMode

				break;

		} // end of switch-statement for configuration.shouldRemoveOldOffspringClassesFirst

	}, // end of defineTraverseChildrenFunction

	// Recursive

	/*
		If &quot;shouldRemoveOldOffspringClassesFirst&quot; is deined and set to true
	 	(it's optional), traverseChildren will remove old Offspring-related
	 	classes before applying new ones to a node. This could be useful
	 	for reapplying classes if the DOM is rejiggered.
	*/

	traverseChildren: function(parent) {

		/* ============= Begin Code Block &quot;traverseChildren.A&quot; ================ */

			// If the node has no children, exit
			if (!parent.childNodes.length) return;


			/* First, gather up all the element nodes */
			var childElementNodes = [];

			var testNode = parent.childNodes[0]; // initialize

			while (testNode)
			{
				if (testNode.nodeType == 1)
				{
					childElementNodes.push(testNode);
				}
				testNode = testNode.nextSibling;
			}

			/*
				empty this variable to ensure that the JavaScript
				interpreter doesn't have to update the variable's
				nodelist as DOM changes are made
			*/
			testNode = null;

			var childElementNodesLength = childElementNodes.length;

			// If no element nodes were found, exit
			if (!childElementNodesLength) return;

			// Make sure that the CSS-classnames cache has enough entries to cover
			// the number of child nodes
			if (childElementNodesLength &gt; this.cacheLevel)
			{
				this.fillCacheTo(childElementNodesLength);
			}

			var lastIndex = childElementNodesLength - 1; // index of the last element node

		/* ============= /End Code Block &quot;traverseChildren.A&quot; ================ */


		/* ==== Add the classes ====== */

		this._childrenIterator(childElementNodes, childElementNodesLength, lastIndex);


		/* ============= Begin Code Block &quot;traverseChildren.B&quot; ================ */

			// prevent memory leaks
			lastElement = null;
			parent = null;

		/* ============= /End Code Block &quot;traverseChildren.B&quot; ================ */

	},

	/*
		This function adds the Offspring classnames to a given element,
		given its position among it siblings (with zero being &quot;first&quot;)
		and whether it's the last element in its set.
	*/
	_addOffspringClassNames: function(element, index, isLastElement) {

		index++; // normalize since the arrays are indexed with a &quot;1&quot; starting point

		// Steps if the element has no existing classnames...

		if ((!element.className) || (!element.className.length))
		{
			switch (isLastElement)
			{
				case false: // it isn't the last element
						element.className = this.regularHashTable[index];
						return;
						break;

				case true: // it is the last element
				 		element.className = this.lastChildHashTable[index];
						return;
						break;

			} // end of isLastElement switch-statement

		} // end of if-statement for checking whether the element has no existing className

		// At this point, the incoming element already has className(s)

		switch (isLastElement)
		{
			case false: // it isn't the last element
					var applicableClassNames = this.regularHashTableArray[index];
					break;

			case true: // it is the last element
					var applicableClassNames = this.lastChildHashTableArray[index];
					break;

		} // end of isLastElement switch-statement

		var originalClassNames = element.className.split(' ');

		var classNamesToAdd = originalClassNames; // initialize

		for (var i = 0, applicableClassNamesLength = applicableClassNames.length; i &lt; applicableClassNamesLength; i++)
		{
			var alreadyThere = false; // boolean for whether a given class name is already assigned to the element

			var testApplicableClassName = applicableClassNames[i];

			for (var j = 0, originalClassNamesLength = originalClassNames.length; j &lt; originalClassNamesLength; j++)
			{
				if (originalClassNames[j] == testApplicableClassName)
				{
					alreadyThere = true;
					break;
				} // end of if-statement for checking if the element already has a given className

			} // end of the originalClassNames for-loop

			if (!alreadyThere)
			{
				classNamesToAdd.push(testApplicableClassName);
			}

		} // end of applicableClassNames for-loop


		// Then, after checking over the element's existing classNames, add the new version
		element.className = classNamesToAdd.join(' ');
		element = null; // prevent memory leaks

		return;

	}, // end of _addOffspringClassNames()

	/* Maintenance note for defineFillCacheToFunction:
	
		[Aside: This is basically conveys the same idea as the comment above 
		defineTraverseChildrenFunction. So, if you're read that one, you 
		probably already have the basic idea of what's going on here.]
	
		There are several blocks of code that are marked off as &quot;fillCacheTo.A&quot;
		or &quot;fillCacheTo.B&quot; -- each of these are identical, respectively. (That is,
		all &quot;fillCacheTo.A&quot; blocks are the same and all &quot;fillCacheTo.B&quot; are 
		the same.) 
		
		So, why not just create a function where the code can be kept in one place? 
		While normally a sensible idea, I decided against that approach only so 
		that the speed hits associated with the creation of the function stack
		could be averted. At the same time, I didn't want to compromise
		the code's maintainability; so, if any block needs to be updated, they
		can all be kept in sync with some basic copy-n-pasting from one 
		block to the next.
	*/


	/* This defines the internal loop function for fillCacheTo,
		depending on how the configuration options are set */
	defineFillCacheToFunction: function() {

		switch (this.configuration.runningMode)
		{
			case 'full': // 'full' running mode
				this.fillCacheTo = function(fillAmount)
				{
					/* ============= Begin Code Block &quot;fillCacheTo.A&quot; ================ */

						var fillAmount = fillAmount || 15; // default value

						if (!this.cacheLevel) this.cacheLevel = 0; // set this to a default value if needed

						// If the cache level is already full enough, exit
						if (this.cacheLevel &gt;= fillAmount) return;

						var startingPoint = this.cacheLevel++;

					/* ============= /End Code Block &quot;fillCacheTo.A&quot; ================ */

					var isOdd = !((startingPoint % 2) == 0); // initialize

					// cache these object name resolutions
					var firstChildClass = this.firstChildClass;
					var lastChildClass = this.lastChildClass;
					var oddChildClass = this.oddChildClass;
					var evenChildClass = this.evenChildClass;
					var onlyChildClass = this.onlyChildClass;
					var nthChildClassPrefix = this.nthChildClassPrefix;

					for (var i = startingPoint; i &lt;= fillAmount; i++)
					{
						this.nthChildren[i] = [nthChildClassPrefix, i].join('');

						var nthChildrenI = this.nthChildren[i]; // cache this look-up

						switch (i)
						{
							case 1:
									this.regularHashTableArray[i] = [firstChildClass, oddChildClass, nthChildrenI];
									this.lastChildHashTableArray[i] = [firstChildClass, oddChildClass, onlyChildClass, nthChildrenI, lastChildClass];
									break;

							default:
									switch (isOdd)
									{
										case true: // &quot;odd&quot; is true
												this.regularHashTableArray[i] = [oddChildClass, nthChildrenI];
												this.lastChildHashTableArray[i] = [oddChildClass, nthChildrenI, lastChildClass];
												break;

										case false: // &quot;odd&quot; is false
												this.regularHashTableArray[i] = [evenChildClass, nthChildrenI];
												this.lastChildHashTableArray[i] = [evenChildClass, nthChildrenI, lastChildClass];
												break;

									} // end of isOdd switch-statement


						} // end of switch-statement for i

						// Now make the joined versions for a given &quot;i&quot;

						this.regularHashTable[i] = this.regularHashTableArray[i].join(' ');
						this.lastChildHashTable[i] = this.lastChildHashTableArray[i].join(' ');

						isOdd = !isOdd; // flip the isOdd flag

					} // end of filling for-loop

					/* ============= Begin Code Block &quot;fillCacheTo.B&quot; ================ */

						// If it got this far, the cacheLevel must made it to the fill amount, so update that
						this.cacheLevel = fillAmount;

					/* ============= /End Code Block &quot;fillCacheTo.B&quot; ================ */

				}; // end of fillCacheTo function definition
				break;

			case 'light': // 'light' running mode
				this.fillCacheTo = function(fillAmount)
				{
					/* ============= Begin Code Block &quot;fillCacheTo.A&quot; ================ */

						var fillAmount = fillAmount || 15; // default value

						if (!this.cacheLevel) this.cacheLevel = 0; // set this to a default value if needed

						// If the cache level is already full enough, exit
						if (this.cacheLevel &gt;= fillAmount) return;

						var startingPoint = this.cacheLevel++;

					/* ============= /End Code Block &quot;fillCacheTo.A&quot; ================ */

					// cache these object name resolutions
					var firstChildClass = this.firstChildClass;
					var lastChildClass = this.lastChildClass;

					var onlyChildClass = this.onlyChildClass;

					for (var i = startingPoint; i &lt;= fillAmount; i++)
					{

						switch (i)
						{
							case 1:
									this.regularHashTableArray[i] = [firstChildClass];
									this.lastChildHashTableArray[i] = [firstChildClass, onlyChildClass, lastChildClass];
									break;

							default:

									this.regularHashTableArray[i] = [];
									this.lastChildHashTableArray[i] = [lastChildClass];

						} // end of switch-statement for i

						// Now make the joined versions for a given &quot;i&quot;

						this.regularHashTable[i] = this.regularHashTableArray[i].join(' ');
						this.lastChildHashTable[i] = this.lastChildHashTableArray[i].join(' ');

					} // end of filling for-loop

					/* ============= Begin Code Block &quot;fillCacheTo.B&quot; ================ */

						// If it got this far, the cacheLevel must made it to the fill amount, so update that
						this.cacheLevel = fillAmount;

					/* ============= /End Code Block &quot;fillCacheTo.B&quot; ================ */

				}; // end of fillCacheTo function definition
				break;

		} // end of switch statement for this.configuration.runningMode

	}, // end of defineFillCacheToFunction

	// This fills the className caches to the specified amount
	fillCacheTo: function(fillAmount) {

		/* ============= Begin Code Block &quot;fillCacheTo.A&quot; ================ */

			var fillAmount = fillAmount || 15; // default value

			if (!this.cacheLevel) this.cacheLevel = 0; // set this to a default value if needed

			// If the cache level is already full enough, exit
			if (this.cacheLevel &gt;= fillAmount) return;

			var startingPoint = this.cacheLevel++;

		/* ============= /End Code Block &quot;fillCacheTo.A&quot; ================ */

		this._fillCacheToIterator(startingPoint, fillAmount);

		/* ============= Begin Code Block &quot;fillCacheTo.B&quot; ================ */

			// If it got this far, the cacheLevel must made it to the fill amount, so update that
			this.cacheLevel = fillAmount;

		/* ============= /End Code Block &quot;fillCacheTo.B&quot; ================ */

	}, // end of fillCacheTo()

	/* Returns true if testString is found in the array,
		or returns false otherwise */
	_checkIfStringFoundInArray: function(testString, testArray) {

		// Loop through all testArray[] and if/when there's a match, return true
		for (var i = 0, len=testArray.length; i &lt; len; i++)
		{
			if (testString == testArray[i]) return true;
		}

		// If it got this far, it must not have found the string in the array
		return false;

	}, // end of _checkIfStringFoundInArray

	/* Returns true if the beginning of testString matches one of the substrings
		in the array. Otherwise, it returns false.

		For example, given the array ['plum', 'orange', 'pine'] and
		the testString 'pineapples', the function would return true. However,
		given the testString 'range', it would return false (since none of
		the strings in the array start with 'range')
	*/
	_checkIfStringMatchInSubstringArray: function(testString, testArray) {

		// Loop through all testArray[] and if/when there's a match, return true
		for (var i = 0, len=testArray.length; i &lt; len; i++)
		{
			var currentArrayItem = testArray[i];

			/* string.substr() accepts two parameters:
				- The starting point of the substring
				- The length of the substring
			*/
			var testSubstring = testString.substr(0, currentArrayItem.length);

			if (testSubstring == currentArrayItem) return true;
		}

		// If it got this far, it must not have found the string in the array
		return false;

	}, // end of _checkIfStringMatchInSubstringArray

	/*
		This removes multiple classnames from an element. It does this by
		checking each of an element's class names against
		classNameStrings[] for an exact match and, if a given class name
		didn't match there, it's then checked to see if it matches
		as a substring against classNAmeSubstrings[].

		Of note, when comparing substrings, this intentionally only compares
		the beginning of the strings for a match. So, for example, &quot;ora&quot; would
		match as a substring of &quot;orange&quot;, but &quot;range&quot; would not match as a substring
		of &quot;orange&quot;. It was done this way because that was the only type of substring-
		comparison that was needed in this case, and a more thorough substring
		comparison would needlesslly use processor time.
	*/
	removeMultipleClassNames: function(element, classNameStrings, classNameSubstrings) {

		if (!element) return;
		var newClassName = '';
		var classNamesArray = element.className.split(' ');

    	for (var i = 0, len = classNamesArray.length; i &lt; len; i++)
		{
			var currentClassName = classNamesArray[i];

			var isStringInClassNameStrings = this._checkIfStringFoundInArray(currentClassName, classNameStrings);

			if (isStringInClassNameStrings) continue;

			var isStringMatchingClassNameSubstrings = this._checkIfStringMatchInSubstringArray(currentClassName, classNameSubstrings);

			if (isStringMatchingClassNameSubstrings) continue;

			// If it got this far, it must not have matched any of the potential classNameStrings
			// or classNameRegexes, so add the current iteration to the neClassName

			if (i &gt; 0) newClassName = newClassName + ' ';
    		newClassName = newClassName + currentClassName;

    	}
   		element.className = newClassName;

	}, // end of removeMultipleClassNames


	/*
	 *
	 * ContentLoaded.js
	 *
	 * Author: Diego Perini (diego.perini at gmail.com)
	 * Summary: Cross-browser wrapper for DOMContentLoaded
	 * Updated: 05/10/2007
	 * License: GPL/CC
	 * Version: 1.0
	 *
	 * http://javascript.nwbox.com/ContentLoaded/
	 *
	 * Notes:
	 *
	 *  based on code by Dean Edwards and John Resig
	 *  http://dean.edwards.name/weblog/2006/06/again/
	 *
	 *
	 */

	/*
	 * Example call, in this case:

	 	Offspring.ContentLoaded(window,
			function () {
				document.body.style.backgroundColor = 'green';
			}
		);
	*
	*/

	// @w	window reference
	// @f	function reference
	ContentLoaded: function (w, fn) {
		var d = w.document,
			u = w.navigator.userAgent.toLowerCase();

		function init(e) {
			if (!arguments.callee.done) {
				arguments.callee.done = true;
				fn(e);
			}
		}

		// konqueror/safari
		if (/khtml|webkit/.test(u)) {

			(function () {
				if (/complete|loaded/.test(d.readyState)) {
					init('poll');
				} else {
					setTimeout(arguments.callee, 10);
				}
			})();

		// internet explorer all versions
		} else if (/msie/.test(u) &amp;amp;&amp;amp; !w.opera) {

			(function () {
				try {
					d.documentElement.doScroll('left');
				} catch (e) {
					setTimeout(arguments.callee, 10);
					return;
				}
				init('poll');
			})();
			d.attachEvent('onreadystatechange',
				function (e) {
					if (d.readyState == 'complete') {
						d.detachEvent('on'+e.type, arguments.callee);
						init(e.type);
					}
				}
			);

		// browsers having native DOMContentLoaded
		} else if (d.addEventListener &amp;amp;&amp;amp;
			(/gecko/.test(u) &amp;amp;&amp;amp; parseFloat(u.split('rv:')[1]) &gt;= 1.8) ||
			(/opera/.test(u) &amp;amp;&amp;amp; parseFloat(u.split('opera ')[1]) &gt; 9)) {

			d.addEventListener('DOMContentLoaded',
				function (e) {
					this.removeEventListener(e.type, arguments.callee, false);
					init(e.type);
				}, false
			);

		// fallback to last resort
		} else {

			// from Simon Willison
			var oldonload = w.onload;
			w.onload = function (e) {
				if (typeof oldonload == 'function') {
					oldonload(e || w.event);
				}
				init((e || w.event).type);
			};

		}
	} // end of ContentLoaded

}


// Kick off
offspring.init();
</pre>
</div>
<br>

</div>

<div class="result">
<h2 class="title">
<a href="/user/jerryvig">jerryvig</a>/<a href="/snippet/java/gov-auctions-15">Gov Auctions 15</a>
<span class="language">(<a href="/language/java/"> Java</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: java;">
package com.mktneutral;

import java.io.IOException;
import java.util.List;
import java.util.ArrayList;
import java.util.HashMap;
import java.sql.Connection;
import java.sql.Statement;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.net.URL;
import java.net.MalformedURLException;
import java.net.HttpURLConnection;
import java.net.URLEncoder;
import java.io.OutputStreamWriter;
import java.io.InputStreamReader;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.OutputStream;
import java.util.regex.Pattern;
import org.htmlparser.Parser;
import org.htmlparser.Node;
import org.htmlparser.util.NodeList;
import org.htmlparser.util.ParserException;

public class GovAuctions {
    private static String searchString;
    private static String responseData; 
    private static Connection hsql;
    private static Statement stmt;
    private static String searchState;
    private static HashMap&lt;String,String&gt; stateMap;

    public static void main( String[] args ) {
	String resp = runScrapers(&quot;ford&quot;,15,&quot;ALL&quot;);
	System.out.println( resp );        
    }

    public static String runScrapers( String _searchString, int searchEngineInt, String _searchState ) { 
	try {
	   Class.forName(&quot;org.hsqldb.jdbcDriver&quot;);
	} catch ( ClassNotFoundException cnfe ) { cnfe.printStackTrace(); }
   
        String[] stateNameList = { &quot;Alabama&quot;, &quot;Alaska&quot;, &quot;Arizona&quot;, &quot;Arkansas&quot;, &quot;California&quot;, &quot;Colorado&quot;, &quot;Connecticut&quot;, &quot;Delaware&quot;, &quot;District of Columbia&quot;, &quot;Florida&quot;, &quot;Georgia&quot;, &quot;Hawaii&quot;, &quot;Idaho&quot;, &quot;Illinois&quot;, &quot;Indiana&quot;, &quot;Iowa&quot;, &quot;Kansas&quot;, &quot;Kentucky&quot;, &quot;Louisiana&quot;, &quot;Maine&quot;, &quot;Maryland&quot;, &quot;Massachusetts&quot;, &quot;Michigan&quot;, &quot;Minnesota&quot;, &quot;Mississippi&quot;, &quot;Missouri&quot;, &quot;Montana&quot;, &quot;Nebraska&quot;, &quot;Nevada&quot;, &quot;New Hampshire&quot;, &quot;New Jersey&quot;, &quot;New Mexico&quot;, &quot;New York&quot;, &quot;North Carolina&quot;, &quot;North Dakota&quot;, &quot;Ohio&quot;, &quot;Oklahoma&quot;, &quot;Oregon&quot;, &quot;Pennsylvania&quot;, &quot;Rhode Island&quot;, &quot;South Carolina&quot;, &quot;South Dakota&quot;, &quot;Tennessee&quot;, &quot;Texas&quot;, &quot;Utah&quot;, &quot;Vermont&quot;, &quot;Virginia&quot;, &quot;Washington&quot;, &quot;West Virginia&quot;, &quot;Wisconsin&quot;, &quot;Wyoming&quot;, &quot;American Samoa&quot;, &quot;Guam&quot;, &quot;Northern Mariana Islands&quot;, &quot;Puerto Rico&quot; };
        String[] stateAbbrevList = { &quot;AL&quot;, &quot;AK&quot;, &quot;AZ&quot;, &quot;AR&quot;, &quot;CA&quot;, &quot;CO&quot;, &quot;CT&quot;, &quot;DE&quot;, &quot;DC&quot;, &quot;FL&quot;, &quot;GA&quot;, &quot;HI&quot;, &quot;ID&quot;, &quot;IL&quot;, &quot;IN&quot;, &quot;IA&quot;, &quot;KS&quot;, &quot;KY&quot;, &quot;LA&quot;, &quot;ME&quot;, &quot;MD&quot;, &quot;MA&quot;, &quot;MI&quot;, &quot;MN&quot;, &quot;MS&quot;, &quot;MO&quot;, &quot;MT&quot;, &quot;NE&quot;, &quot;NV&quot;, &quot;NH&quot;, &quot;NJ&quot;, &quot;NM&quot;, &quot;NY&quot;, &quot;NC&quot;, &quot;ND&quot;, &quot;OH&quot;, &quot;OK&quot;, &quot;OR&quot;, &quot;PA&quot;, &quot;RI&quot;, &quot;SC&quot;, &quot;SD&quot;, &quot;TN&quot;, &quot;TX&quot;, &quot;UT&quot;, &quot;VT&quot;, &quot;VA&quot;, &quot;WA&quot;, &quot;WV&quot;, &quot;WI&quot;, &quot;WY&quot;, &quot;AS&quot;, &quot;GU&quot;, &quot;MP&quot;, &quot;PR&quot; };
          
        stateMap = new HashMap&lt;String,String&gt;();
        for ( int i=0; i&lt;stateNameList.length; i++ ) {
	   stateMap.put( stateAbbrevList[i], stateNameList[i] );
        }

	hsql = null;
	try {
	   hsql = DriverManager.getConnection( &quot;jdbc:hsqldb:file:govauctionsdb&quot;, &quot;SA&quot;, &quot;&quot; );
	}
	catch ( SQLException sqle ) { sqle.printStackTrace(); }

	try {
	    stmt = hsql.createStatement();
	    stmt.executeUpdate( &quot;DROP TABLE IF EXISTS auction_records&quot; );
	    stmt.executeUpdate( &quot;CREATE TABLE auction_records ( website VARCHAR(64), url VARCHAR(1024), results_content VARCHAR(1536) )&quot; );
	} catch ( SQLException sqle ) { sqle.printStackTrace(); }

	searchState = _searchState;
	searchString = _searchString;

	responseData = &quot;&quot;;

	if ( searchEngineInt == 0 ) {
	    GovLiquidation();  
	}
	if ( searchEngineInt == 1 ) {
	    GSAAuctions();
	}
	if ( searchEngineInt == 2 ) {
	    IRSAuctions(); 
	}
	if ( searchEngineInt == 3 ) {
	    BidCorp();
	}
	if ( searchEngineInt == 4 ) {
	    bid4Assets();
	}
       	if ( searchEngineInt == 5 ) {
	    BankruptcySales();
	}
       	if ( searchEngineInt == 6 ) {
	    PublicSurplus();
	}
       	if ( searchEngineInt == 7 ) {
	    GovernmentAuction();
	}
       	if ( searchEngineInt == 8 ) {
	    HomeSteps();
	}
       	if ( searchEngineInt == 9 ) {
	    HomePath();
	}
       	if ( searchEngineInt == 10 ) {
	    HomeSalesGov();
	}
       	if ( searchEngineInt == 16 ) {
	    HudHomeStore();
	}
       	if ( searchEngineInt == 11 ) {
	    GSAGov();
	}
       	if ( searchEngineInt == 12 ) {
	    GovSales();
	}
       	if ( searchEngineInt == 13 ) {
	    LonestarOnline();
	}
       	if ( searchEngineInt == 14 ) {
	    GovDeals();
	}
       	if ( searchEngineInt == 15 ) {
	    IllinoisIbid();
	}
          
	try {
	    hsql.close();
	} 
	catch ( SQLException sqle ) { sqle.printStackTrace(); }

	return responseData;
    }
   
    public static void GovLiquidation() {
       String location = &quot;&quot;;
       String ntt = &quot;&quot;;
       String ntk = &quot;&quot;;

       if ( !searchState.equals(&quot;ALL&quot;) ) {
           ntt = &quot;US_&quot; + searchState + &quot;|&quot; + searchString;
           location = &quot;&amp;amp;location=US_&quot; + searchState;
           ntk = &quot;P_Auction_Country_State|P_Lot_Title&quot;;
       }
       else { 
          ntt = searchString;
          location = &quot;&quot;;
          ntk = &quot;P_Lot_Title&quot;; 
       }
    
       String message = &quot;Ntt=&quot; + ntt + &quot;&amp;amp;Ntk=&quot; + ntk + &quot;&amp;amp;Ntx=mode+matchall|mode+matchall&amp;amp;N=0&amp;amp;Nty=1&amp;amp;Ns=P_Lot_Number|0&quot; + location + &quot;&amp;amp;words=&quot; + searchString + &quot;&amp;amp;cmd=keyword&quot;;

       try {
        URL theUrl = new URL( &quot;http://www.govliquidation.com/auction/endecaSearch?&quot; + message );
        String resp = &quot;&quot;;        
        BufferedReader reader = new BufferedReader(new InputStreamReader(theUrl.openStream()));
        String line;
        while ((line = reader.readLine()) != null) {
	    resp += line;
        }
        reader.close();

        int startIdx = resp.indexOf(&quot;&lt;TABLE CELLSPACING=\&quot;0\&quot; CELLPADDING=\&quot;0\&quot; border=\&quot;0\&quot; WIDTH=\&quot;748\&quot; ALIGN=\&quot;CENTER\&quot; id=\&quot;lots_table\&quot;&gt;&quot;);
        int endIdx = resp.indexOf(&quot;&lt;!-- Load the Brightcove JavaScript API --&gt;&quot;);

        Parser htmlParser = new Parser();
        if ( endIdx &gt; 0 &amp;amp;&amp;amp; startIdx &gt; 0 ) {
          try {
	     htmlParser.setInputHTML( resp.substring( startIdx, endIdx ) );  
             NodeList nList = htmlParser.parse(null);
             if ( nList.size() &gt; 0 ) {
	       NodeList trList = nList.elementAt(0).getChildren();
               for ( int i=0; i&lt;trList.size(); i++ ) {
		   if ( trList.elementAt(i).getText().contains(&quot;resultsBackground1&quot;) || trList.elementAt(i).getText().contains(&quot;resultsBackground2&quot;) ) {
		     NodeList tdList = trList.elementAt(i).getChildren();
		     for ( int j=0; j&lt;tdList.size(); j++ ) {
		       if ( (tdList.elementAt(j).getText()).trim().equals(&quot;TD VALIGN=\&quot;top\&quot; class=\&quot;annotationText1\&quot;&quot;) ) {
			  String resultsContent = (tdList.elementAt(j).toPlainTextString()).trim();
                          resultsContent = resultsContent.replaceAll(&quot;\&quot;&quot;, &quot;'&quot; );
			  resultsContent = resultsContent.replaceAll(&quot;\n&quot;, &quot;&quot;);
                          resultsContent = resultsContent.replaceAll(&quot;\t&quot;, &quot;&quot;);

			  NodeList aList = tdList.elementAt(j).getChildren();
                          for ( int k=0; k&lt;aList.size(); k++ ) {
			    if ( aList.elementAt(k).getText().contains(&quot;A HREF=\&quot;http://www.govliquidation.com/auction/view&quot;) ) {
			       String anchorHref = aList.elementAt(k).getText().trim();
                               String[] pieces = anchorHref.split(&quot;\&quot;&quot;);
                               anchorHref = pieces[1].trim();
                               
                               try {
                                 System.out.println( &quot;INSERT INTO auction_records ( website, url, results_content ) VALUES ( 'http://www.govliquidation.com/', '&quot; + anchorHref + &quot;', '&quot; +  resultsContent + &quot;' )&quot; );

			          stmt.executeUpdate( &quot;INSERT INTO auction_records ( website, url, results_content ) VALUES ( 'http://www.govliquidation.com/', '&quot; + anchorHref + &quot;', '&quot; +  resultsContent + &quot;' )&quot; );
                               } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                            }   
                          } 
                       }   
                     }
                   }
               }
             }
          } catch ( ParserException pe ) { pe.printStackTrace(); }
        }
       } catch ( MalformedURLException me ) { me.printStackTrace(); }
       catch ( IOException ioe ) { ioe.printStackTrace(); }
    }

    public static void GSAAuctions() {
      if ( searchState.equals(&quot;ALL&quot;) ) {
       try {
	String message = &quot;Continue=&quot; + URLEncoder.encode(&quot;Continue&quot;);       
        
        URL theUrl = new URL(&quot;http://gsaauctions.gov/gsaauctions/gsaauctions/&quot;);
        HttpURLConnection conn = (HttpURLConnection) theUrl.openConnection();
        conn.setDoOutput(true);
        conn.setRequestMethod(&quot;POST&quot;);
        conn.setRequestProperty(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);
        conn.setRequestProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0&quot;);
        OutputStream os = conn.getOutputStream();
        os.write(message.getBytes(&quot;UTF-8&quot;));
        os.close();

        BufferedReader myReader = new BufferedReader(new InputStreamReader(conn.getInputStream()));
        String line;
        String resp = &quot;&quot;;
        while ((line = myReader.readLine()) != null) {
	    resp += line;
        }
        myReader.close();
       
        int scIdx = resp.indexOf(&quot;name=\&quot;scParam\&quot; VALUE=\&quot;&quot;);
        if ( scIdx &gt; 0 ) {
	  String[] pieces = resp.substring( scIdx+10, scIdx+80 ).split(&quot;VALUE=\&quot;&quot;);
          if ( pieces.length &gt; 1 ) {          
	    String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
	    String scParam =  piecesII[0].trim();

            int webPcmIdx = resp.indexOf(&quot;name=\&quot;WEBPCMTRANSID\&quot; VALUE=\&quot;&quot;);
            if ( webPcmIdx &gt; 1 ) {
	       pieces = resp.substring( webPcmIdx+10, webPcmIdx+80 ).split(&quot;VALUE=\&quot;&quot;);
               if ( pieces.length &gt; 0 ) {
		 piecesII = pieces[1].split(&quot;\&quot;&quot;);
                 String webPcmParam = piecesII[0].trim();
                  
                 String msg2 = &quot;scParam=&quot; + URLEncoder.encode(scParam) + &quot;&amp;amp;WEBPCMTRANSID=&quot; + URLEncoder.encode( webPcmParam ) + &quot;&amp;amp;sc=&amp;amp;scAction=&quot; + URLEncoder.encode(&quot;AUCALSRH&quot;) + &quot;&amp;amp;scRegn=&amp;amp;scSalNo=&amp;amp;scLotNo=&amp;amp;scQuery=&amp;amp;query=&amp;amp;order=&amp;amp;af2eq=&amp;amp;scCatCode=&amp;amp;scStCode=&amp;amp;scPassUpd=&amp;amp;scSrchDesc=&quot; + URLEncoder.encode( searchString ) + &quot;&amp;amp;scSrchDescCtxt=&amp;amp;catMenuNew=&quot;;

                 URL url2 = new URL(&quot;http://gsaauctions.gov/gsaauctions/aucindx&quot;);
                 HttpURLConnection con2 = (HttpURLConnection) url2.openConnection();
                 con2.setDoOutput(true);
                 con2.setRequestMethod(&quot;POST&quot;);
                 con2.setRequestProperty(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);
                 con2.setRequestProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0&quot;);

                 OutputStream writer = con2.getOutputStream();
                 writer.write(msg2.getBytes(&quot;UTF-8&quot;));
	         writer.close();
             
                 BufferedReader leer = new BufferedReader(new InputStreamReader(con2.getInputStream()));
                 line = &quot;&quot;;
                 resp = &quot;&quot;;
                 while ((line = leer.readLine()) != null) {
	          resp += line;
                 }
                 leer.close();

                 int startIdx = resp.indexOf(&quot;var tab=[&quot;);
                 int endIdx = resp.indexOf(&quot;bldTr();&quot;); 

                 pieces =  resp.substring( startIdx, endIdx ).split(Pattern.quote(&quot;[&quot;));
                 if ( pieces.length &gt; 1 ) {
                   piecesII = pieces[1].split(Pattern.quote(&quot;]&quot;));
		   pieces = piecesII[0].split(&quot;\&quot;,\&quot;&quot;);

                   String resultsContent = &quot;&quot;;
                   String anchorHref = &quot;&quot;;
                   if ( pieces.length &gt; 6 ) {
                    for ( int j=0; j&lt;pieces.length; j+=7 ) {
		     resultsContent = pieces[j].replace(&quot;\&quot;&quot;,&quot;&quot;) + &quot; &quot; + pieces[j+1] + &quot; &quot; + pieces[j+2] + &quot; &quot; + pieces[j+3] + &quot; &quot; + pieces[j+4] + &quot; &quot; + pieces[j+5] + &quot; &quot; + pieces[j+6].replace(&quot;\&quot;,&quot;,&quot;&quot;);
                     anchorHref = &quot;javascript:itemSel('&quot; + pieces[j+1].substring(0,11) + &quot;','&quot; + pieces[j+1].substring(11) + &quot;');&quot;;
                     try {
                       stmt.executeUpdate( &quot;INSERT INTO auction_records ( website, url, results_content ) VALUES ( 'http://gsaauctions.gov/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                     } catch ( SQLException sqle ) { sqle.printStackTrace(); }
		    }
                   }
		 }
	       }
	    }
          }
	}
         
       } catch ( MalformedURLException me ) { me.printStackTrace(); }
       catch ( IOException ioe ) { ioe.printStackTrace(); }
      }
    }

    public static void IRSAuctions() {
      if ( searchState.equals(&quot;ALL&quot;) ) {
        try {         
	 URL theUrl = new URL(&quot;http://search.treas.gov/search?q=&quot; + URLEncoder.encode(searchString) + &quot;&amp;amp;output=xml_no_dtd&amp;amp;sort=date%3AD%3AL%3Ad1&amp;amp;ie=UTF-8&amp;amp;client=auctions&amp;amp;oe=UTF-8&amp;amp;proxystylesheet=auctions&amp;amp;site=Auctions&quot;);
         String resp = &quot;&quot;;        
         BufferedReader reader = new BufferedReader(new InputStreamReader(theUrl.openStream()));
         String line;
         while ((line = reader.readLine()) != null) {
	    resp += line;
         }
         reader.close();

         int startIdx =  resp.indexOf(&quot;&lt;p&gt;&lt;font size=\&quot;-2\&quot;&gt;&quot;);
         int endIdx = resp.indexOf(&quot;In order to show you&quot;);

         if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; startIdx ) {
           Parser htmlParser = new Parser();
           try {
             htmlParser.setInputHTML( resp.substring(startIdx,endIdx) );
             NodeList nList = htmlParser.parse(null);
             
             for ( int i=0; i&lt;nList.size(); i++ ) {
	      if ( nList.elementAt(i).getText().startsWith(&quot;p&quot;) ) {
		NodeList pChildList = nList.elementAt(i).getChildren();
                for ( int j=0; j&lt;pChildList.size(); j++ ) {
		  String anchorHref = &quot;&quot;;
		  if ( pChildList.elementAt(j).getText().startsWith(&quot;a href=\&quot;http://www.treasury&quot;) ) {
		    String[] pieces = pChildList.elementAt(j).getText().split(&quot;\&quot;&quot;);
                    anchorHref = pieces[1].trim();      
                  }
                  if ( pChildList.elementAt(j).getText().startsWith(&quot;span class=\&quot;s\&quot;&quot;) ) {
		    String resultsContent = pChildList.elementAt(j).toPlainTextString().trim();
                    resultsContent = resultsContent.replaceAll(&quot;\&quot;&quot;, &quot;&quot;);
		    resultsContent = resultsContent.replaceAll(&quot;\n&quot;, &quot;&quot;);
                    try {
                      stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://search.treas.gov/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                    } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                  } 
                }   
              }   
             }            
           } catch ( ParserException pe ) { pe.printStackTrace(); }                             
         }
	} catch ( IOException ioe ) { ioe.printStackTrace(); }
         
      }
    }

    public static void BidCorp() {
      if ( searchState.equals(&quot;ALL&quot; ) ) {
        try {
	  URL theUrl = new URL(&quot;http://www.bidcorp.com/AdvancedSearch.aspx&quot;); 
          String resp = &quot;&quot;;        
          BufferedReader reader = new BufferedReader(new InputStreamReader(theUrl.openStream()));
          String line;
          while ((line = reader.readLine()) != null) {
	    resp += line;
          }
          reader.close();
     
          int vsIdx = resp.indexOf(&quot;id=\&quot;__VIEWSTATE\&quot;&quot;);
          int endIdx = resp.indexOf(&quot;=\&quot; /&gt;&quot;);
          String viewState = resp.substring(vsIdx,endIdx+1).split(&quot;value=\&quot;&quot;)[1];
          vsIdx = resp.indexOf(&quot;id=\&quot;__EVENTVALIDATION\&quot;&quot;);
          endIdx = resp.indexOf(&quot;&lt;table class=\&quot;mainTable\&quot;&quot;); 
	  String[] pieces = resp.substring(vsIdx,endIdx).split(&quot;value=\&quot;&quot;);
          String evtValidation = pieces[1].split(&quot;\&quot;&quot;)[0].trim();
          
          String message = &quot;__EVENTTARGET=&amp;amp;__EVENTARGUMENT=&amp;amp;__VIEWSTATE=&quot; + URLEncoder.encode(viewState) + &quot;&amp;amp;__EVENTVALIDATION=&quot; + URLEncoder.encode(evtValidation) +  &quot;&amp;amp;ctl00$ContentPlaceHolder1$txtKeywords=&quot; + URLEncoder.encode( searchString ) + &quot;&amp;amp;ctl00$ContentPlaceHolder1$rdoKeywordStatus=&quot; + URLEncoder.encode(&quot;3&quot;) + &quot;&amp;amp;ctl00$ContentPlaceHolder1$btnSubmitKeyword=&quot; + URLEncoder.encode(&quot;Submit&quot;) + &quot;&amp;amp;ctl00$ContentPlaceHolder1$txtLotNumber=&quot;;

          URL url2 = new URL(&quot;http://www.bidcorp.com/AdvancedSearch.aspx&quot;);
          HttpURLConnection conn = (HttpURLConnection) url2.openConnection();
          conn.setDoOutput(true);
          conn.setRequestMethod(&quot;POST&quot;);
          conn.setRequestProperty(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);
          conn.setRequestProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0&quot;);

          OutputStream writer = conn.getOutputStream();
          writer.write(message.getBytes(&quot;UTF-8&quot;));
	  writer.close();
             
          BufferedReader myReader = new BufferedReader(new InputStreamReader(conn.getInputStream()));
          line = &quot;&quot;;
          resp = &quot;&quot;;
          while ((line = myReader.readLine()) != null) {
	     resp += line;
          }
          myReader.close();

          int startIdx = resp.indexOf(&quot;&lt;table cellspacing=\&quot;0\&quot; cellpadding=\&quot;4\&quot;&quot;);
          endIdx = resp.indexOf(&quot;&lt;div style=\&quot;margin: 5px; &quot;);

          if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; startIdx ) { 
	    Parser htmlParser = new Parser();
            try {
              htmlParser.setInputHTML( resp.substring(startIdx,endIdx) );
              NodeList nList = htmlParser.parse(null);
              if ( nList.size() &gt; 0 ) {
		NodeList trList = nList.elementAt(0).getChildren();
                for ( int i=0; i&lt;trList.size(); i++ ) {
		  if ( trList.elementAt(i).getText().contains(&quot;bgcolor=\&quot;White\&quot;&quot;) || trList.elementAt(i).getText().contains(&quot;bgcolor=\&quot;#CCCCCC\&quot;&quot;) ) {
		     NodeList tdList = trList.elementAt(i).getChildren();
                     if ( tdList.size() &gt; 2 ) {
		        String resultsContent = (tdList.elementAt(2).toPlainTextString()).trim();
                        resultsContent = resultsContent.replaceAll(&quot;\&quot;&quot;, &quot;&quot;);
		        resultsContent = resultsContent.replaceAll(&quot;\n&quot;, &quot;&quot;);
                        resultsContent = resultsContent.replaceAll(&quot;\t&quot;, &quot;&quot;); 
           
                        String[] piecesII = (tdList.elementAt(2).getChildren().elementAt(1).getText()).split(&quot;'&quot;);
                        String anchorHref = &quot;http://www.bidcorp.com/&quot; + piecesII[1].trim();
                        try {
			   
                          stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.bidcorp.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );

                        } catch ( SQLException sqle ) { sqle.printStackTrace(); }

                     }
                  }             
                }
              }
	    } catch ( ParserException pe ) { pe.printStackTrace(); }
          }
        } catch ( IOException ioe ) { ioe.printStackTrace(); }   
      }
    }

    public static void bid4Assets() {
	try { 
            String stateSearch = &quot;&quot;;
            if ( searchState.equals(&quot;ALL&quot;) ) {
		stateSearch = &quot;all&quot;; }
            else { stateSearch = searchState; }
             
	    String message = &quot;fuseaction=&quot; + URLEncoder.encode(&quot;search&quot;) + &quot;&amp;amp;type=&quot; + URLEncoder.encode( &quot;powerSearch&quot; ) + &quot;&amp;amp;criteria=&quot; + URLEncoder.encode( searchString ) + &quot;&amp;amp;keywordType=&quot; + URLEncoder.encode( &quot;allWords&quot; ) + &quot;&amp;amp;channel=&quot; + URLEncoder.encode(&quot;all&quot;) + &quot;&amp;amp;cat2=&quot; + URLEncoder.encode(&quot;all&quot;) + &quot;&amp;amp;cat3=&quot; + URLEncoder.encode(&quot;all&quot;) + &quot;&amp;amp;LocationChoice=&quot; + URLEncoder.encode(&quot;1&quot;) + &quot;&amp;amp;locatedState=&quot; + URLEncoder.encode( stateSearch ) + &quot;&amp;amp;ZIp=&amp;amp;ZipRadius=&quot; + URLEncoder.encode(&quot;1&quot;) + &quot;&amp;amp;assetstatus=&quot; + URLEncoder.encode(&quot;Live&quot;) + &quot;&amp;amp;DateHistory=&quot; + URLEncoder.encode(&quot;6&quot;) + &quot;&amp;amp;sort=&quot; + URLEncoder.encode(&quot;bidCloseTime&quot;);

	    URL theUrl = new URL( &quot;http://www.bid4assets.com/search/index.cfm&quot; );
	    HttpURLConnection connection = (HttpURLConnection) theUrl.openConnection();
	    connection.setDoOutput( true );
	    connection.setRequestMethod( &quot;POST&quot; );
	    connection.setRequestProperty( &quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot; );

	    OutputStream writer = connection.getOutputStream();
	    writer.write( message.getBytes(&quot;UTF-8&quot;) );
	    writer.close();

	    BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream()));
	    String line;
	    String responseContent = &quot;&quot;;

	    while ((line = reader.readLine()) != null) {
		responseContent += line;       
	    }
	    reader.close();

	    int startIdx = responseContent.indexOf( &quot;&lt;table width=\&quot;100%\&quot; border=\&quot;0\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;3\&quot;&gt;&quot; );
	    int endIdx = responseContent.indexOf( &quot;&lt;!-- google_ad_section_end&quot; ); 

            if ( startIdx&lt;0 || endIdx&lt;0 ) return;

	    Parser htmlParser = new Parser();
	    try {
		//  System.out.println( startIdx + &quot; &quot; + endIdx );
	      if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; 0 ) { 
               
		htmlParser.setInputHTML( responseContent.substring( startIdx, endIdx ) );
		NodeList nList = htmlParser.parse( null );               
	
		if ( nList.size() &gt; 4 ) {
		   
		   NodeList trList = nList.elementAt(4).getChildren();

		   for ( int i=0; i&lt;trList.size(); i++ ) {
		     if ( !trList.elementAt(i).toPlainTextString().trim().equals(&quot;&quot;) ) {
		       String resultsContent = trList.elementAt(i).toPlainTextString().trim();
                       resultsContent = resultsContent.replaceAll(&quot;\&quot;&quot;, &quot;&quot;);
		       resultsContent = resultsContent.replaceAll(&quot;\n&quot;, &quot; &quot;);
                       resultsContent = resultsContent.replaceAll(&quot;\t&quot;, &quot; &quot;);
                       resultsContent = resultsContent.replace(&quot;\\&quot;, &quot;&quot;);
                       resultsContent = resultsContent.replaceAll(&quot;'&quot;, &quot;&quot;);
                      
                       NodeList tdList = trList.elementAt(i).getChildren();
                      try {
                       for ( int j=0; j&lt;tdList.size(); j++ ) {
			 if ( tdList.elementAt(j).getText().contains(&quot;mediumArial02&quot;) ) {
			     NodeList aList = tdList.elementAt(j).getChildren();
                             for ( int k=0; k&lt;aList.size(); k++ ) {
			       if ( aList.elementAt(k).getText().contains(&quot;href&quot;) ) {
				 String href = aList.elementAt(k).getText().trim();
                                
                                  String anchorHref = href.split(&quot;=\&quot;&quot;)[1];
                                  anchorHref = &quot;http://www.bid4assets.com/&quot; + anchorHref.substring(0,anchorHref.length()-1);                  
				  //System.out.println( &quot;6&quot; );
                                  try {
                                    stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.bid4assets.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                                  } catch ( SQLException sqle ) { sqle.printStackTrace(); }
				
                               }   
                             }
                         }
		       }
                      } catch ( NullPointerException npe ) { npe.printStackTrace(); }
		     }
		   }
		}
	      }
	    } catch ( ParserException pe ) { pe.printStackTrace(); }      
	} catch ( IOException ioe ) { ioe.printStackTrace(); }
    }
   
    public static void BankruptcySales() {
      if ( searchState.equals(&quot;ALL&quot; ) ) {
       try {
	 String msg = &quot;keyWord=&quot; + URLEncoder.encode( searchString );

         URL theUrl = new URL(&quot;http://www.bankruptcysales.com/assets_search2.cfm&quot;); 
         HttpURLConnection conn = (HttpURLConnection) theUrl.openConnection();
         conn.setDoOutput(true);        
         conn.setRequestMethod(&quot;POST&quot;);
         conn.setRequestProperty(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);           
         conn.setRequestProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0&quot;); 
         OutputStream os = conn.getOutputStream();
         os.write(msg.getBytes(&quot;UTF-8&quot;));
         os.close();

         BufferedReader lector = new BufferedReader(new InputStreamReader(conn.getInputStream()));
         String line;
         String resp = &quot;&quot;;
         while ((line = lector.readLine())!= null) {
	   resp = resp.concat(line);
         }
         lector.close();

         int startIdx = resp.indexOf(&quot;&lt;!-- InstanceBeginEditable name=\&quot;Body\&quot; --&gt;&quot;);
         int endIdx = resp.indexOf(&quot;CLASS=\&quot;bottomLinks\&quot;&quot;);

         Parser htmlParser = new Parser();
         try {
	   htmlParser.setInputHTML( resp.substring(startIdx,endIdx) );
           NodeList nList = htmlParser.parse(null);
           
           for ( int i=0; i&lt;nList.size(); i++ ) {
	     if ( nList.elementAt(i).getText().startsWith(&quot;TABLE WIDTH=\&quot;95%\&quot;&quot;) ) {
	       NodeList nextChildren = nList.elementAt(i).getChildren();
               for ( int j=0; j&lt;nextChildren.size(); j++ ) {
		 if ( nextChildren.elementAt(j).getText().equals(&quot;TR&quot;) ) {
		   NodeList nxtChildren = nextChildren.elementAt(j).getChildren();
                   if ( nxtChildren.size() &gt; 0 ) {
		     NodeList pChildren = nxtChildren.elementAt(1).getChildren();
                     for ( int k=0; k&lt;pChildren.size(); k++ ) {
		       if ( pChildren.elementAt(k).getText().startsWith(&quot;TABLE WIDTH=\&quot;95%\&quot;&quot;) ) {
			  NodeList trList = pChildren.elementAt(k).getChildren();
                          for ( int l=2; l&lt;trList.size(); l++ ) {
			     if ( !trList.elementAt(l).toPlainTextString().trim().equals(&quot;&quot;) ) {
			       String resultsContent = trList.elementAt(l).toPlainTextString().trim();
                               resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                               resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);                                  
                               while ( resultsContent.contains(&quot;  &quot;) ) {
				  resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot;&quot;);   
                               }
                             
                               String[] hrefCandidates = trList.elementAt(l).toHtml().split(&quot;HREF=\&quot;&quot;);
                               if ( hrefCandidates.length &gt; 0 ) {
				  String anchorHref = hrefCandidates[1].split(&quot;\&quot;&quot;)[0];
                                  anchorHref = &quot;http://www.bankruptcysales.com/&quot; + anchorHref;
                                  try {
				      //System.out.println(  &quot;INSERT INTO auction_records VALUES ( 'http://www.bankruptcysales.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                                     stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.bankruptcysales.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                                  } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                               }
                               
                             }    
                          }
                       } 
                     }   
                   }
                 }     
               } 
             }  
           }

         } catch ( ParserException pe ) { pe.printStackTrace(); }
	} catch ( IOException ioe ) { ioe.printStackTrace(); }
      }
    }

    public static void PublicSurplus() {
      try {
	String stateSearch = searchState;  
	if ( searchState.equals(&quot;ALL&quot;) ) stateSearch = &quot;&quot;;

	String message = &quot;http://www.publicsurplus.com/sms/browse/search?posting=y&amp;amp;slth=&amp;amp;page=0&amp;amp;sortBy=timeLeft&amp;amp;keyWord=&quot; + searchString + &quot;&amp;amp;catId=-1&amp;amp;endHours=-1&amp;amp;startHours=-1&amp;amp;lowerPrice=0&amp;amp;higherPrice=0&amp;amp;milesLocation=-1&amp;amp;zipCode=&amp;amp;region=&quot; + &quot;all%2C&quot; + stateSearch;

	URL theUrl = new URL( message );
        String resp = &quot;&quot;;        
        BufferedReader reader = new BufferedReader(new InputStreamReader(theUrl.openStream()));
        String line;
        while ((line = reader.readLine()) != null) {
	   resp += line;
        }
        reader.close(); 
 
        int startIdx = resp.indexOf(&quot;&lt;div class=\&quot;SepTable\&quot;&gt;&quot;);
        int endIdx = resp.indexOf(&quot;Hide Images&quot;);

        if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; 0 ) {
        //System.out.println( resp.substring(startIdx,endIdx) );

         Parser htmlParser = new Parser();
         try {
	  htmlParser.setInputHTML(resp.substring(startIdx,endIdx));
          NodeList nList = htmlParser.parse(null);   

          for ( int i=0; i&lt;nList.size(); i++ ) {
	    if ( nList.elementAt(i).getText().equals(&quot;table width=\&quot;100%\&quot; border=\&quot;0\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;5\&quot; class=\&quot;tabCurr\&quot;&quot;) ) {
	       NodeList tHeadList = nList.elementAt(i).getChildren();
               for ( int j=4; j&lt;tHeadList.size(); j++ ) {
		 if ( tHeadList.elementAt(j).getText().startsWith(&quot;tr&quot;) ) {
		     String resultsContent = tHeadList.elementAt(j).toPlainTextString().trim();
		     resultsContent = resultsContent.replaceAll(&quot;&amp;amp;nbsp;&quot;,&quot;&quot;);
                     resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                     resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                     while ( resultsContent.contains(&quot;  &quot;) ) {
			 resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot; &quot;);
                     }
                     //System.out.println( resultsContent );
		     String[] pieces = tHeadList.elementAt(j).toHtml().split(&quot;href=\&quot;&quot;);
                     String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
                     String anchorHref = &quot;http://www.publicsurplus.com&quot; + piecesII[0].trim();
                     try {
		        stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://http://www.publicsurplus.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                     } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                 }
               } 
            }  
          }

         } catch ( ParserException pe ) { pe.printStackTrace(); }
	}
      } catch ( IOException ioe ) { ioe.printStackTrace(); }    
    }

    public static void GovernmentAuction() {
      if ( searchState.equals(&quot;ALL&quot; ) ) {
	String message = &quot;http://auctions.governmentauction.com/view-auctions/individual-lots/?key=&quot; + searchString + &quot;&amp;amp;page=1&amp;amp;cat=&amp;amp;catm=any&amp;amp;order=timeleft&amp;amp;live=yes&amp;amp;timed=yes&amp;amp;regular=yes&amp;amp;buynow=yes&amp;amp;makeoffer=yes&amp;amp;auctioneer=&amp;amp;minprice=&amp;amp;maxprice=&amp;amp;items=48&quot;;
        try {
	 URL theUrl = new URL( message );
         String resp = &quot;&quot;;        
         BufferedReader reader = new BufferedReader(new InputStreamReader(theUrl.openStream()));
         String line;
         while ((line = reader.readLine()) != null) {
	   resp += line;
         }
         reader.close(); 

         int startIdx = resp.indexOf(&quot;&lt;div id=\&quot;lac&quot;);
         int endIdx = resp.indexOf(&quot;&lt;div id=\&quot;footer\&quot;&gt;&quot;);
         
         Parser prse = new Parser();
         try {
	   prse.setInputHTML( resp.substring(startIdx,endIdx) );
           NodeList nList = prse.parse(null);   

           for ( int i=0; i&lt;nList.size(); i++ ) {
	     if ( nList.elementAt(i).getText().contains(&quot;id=\&quot;lac&quot;) ) {
		NodeList divList = nList.elementAt(i).getChildren();
                for ( int j=0; j&lt;divList.size(); j++ ) {
		  if ( divList.elementAt(j).getText().equals(&quot;div class=\&quot;name\&quot;&quot;) ) {
		    String resultsContent = divList.elementAt(j).toPlainTextString();
                    resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                    resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                    while ( resultsContent.contains(&quot;  &quot;) ) {
		       resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot; &quot;);
                    }
                    //System.out.println( resultsContent );
                    String[] pieces = divList.elementAt(j).toHtml().split(&quot;href=\&quot;&quot;);
                    String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
                    String anchorHref = piecesII[0].trim();
                    anchorHref = &quot;http://auctions.governmentauction.com&quot; + anchorHref;
                    try {
		        stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://auctions.governmentauction.com', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                     } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                  }  
                }
             }
           }
         } catch ( ParserException pe ) { pe.printStackTrace(); } 
        } catch ( IOException ioe ) { ioe.printStackTrace(); }
      }
    }

    public static void HomeSteps() {
      if ( searchState.equals(&quot;ALL&quot; ) ) {
	  return;
      }
      String msg = &quot;City=&amp;amp;County=&amp;amp;State=&quot; + URLEncoder.encode(searchState) + &quot;&amp;amp;Zip=&amp;amp;PriceRangeLow=&quot; + URLEncoder.encode(&quot;*&quot;) + &quot;&amp;amp;PriceRangeHigh=&quot; + URLEncoder.encode(&quot;*&quot;) + &quot;&amp;amp;TotalRooms=&quot; + URLEncoder.encode(&quot;*&quot;) + &quot;&amp;amp;NumberBedrooms=&quot; + URLEncoder.encode(&quot;*&quot;) + &quot;&amp;amp;NumberBathrooms=&quot; + URLEncoder.encode(&quot;*&quot;) + &quot;&amp;amp;B1=Find Homes&amp;amp;IPP=50&quot;;

      try {
        URL theUrl = new URL(&quot;http://www.homesteps.com/cgi-bin/dynamic/formsearch.cgi&quot;); 
        HttpURLConnection conn = (HttpURLConnection) theUrl.openConnection();
        conn.setDoOutput(true);        
        conn.setRequestMethod(&quot;POST&quot;);
        conn.setRequestProperty(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);           
        conn.setRequestProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0&quot;); 
        OutputStream os = conn.getOutputStream();
        os.write(msg.getBytes(&quot;UTF-8&quot;));
        os.close();

        BufferedReader myReader = new BufferedReader(new InputStreamReader(conn.getInputStream()));
        String line;
        String resp = &quot;&quot;;
        while ((line = myReader.readLine())!= null) {
          resp = resp.concat(line);
        }
        myReader.close();
     
        int startIdx = resp.indexOf(&quot;&lt;table cellpadding=1 cellspacing=1 class=tblHomesteps&gt;&quot;);
        int endIdx = resp.indexOf(&quot;Freddie Mac takes&quot;);
 
        Parser prsr = new Parser();
        try {
	  prsr.setInputHTML(resp.substring(startIdx,endIdx));
          NodeList nList = prsr.parse(null);
          for ( int i=0; i&lt;nList.size(); i++ ) {            
	    if ( nList.elementAt(i).getText().equals(&quot;table cellpadding=1 cellspacing=1 class=tblHomesteps&quot;) ) {
	       NodeList trList = nList.elementAt(i).getChildren();
               for ( int j=2; j&lt;trList.size(); j++ ) {
		 if ( trList.elementAt(j).getText().equals(&quot;tr&quot;) ) {
		    String resultsContent = trList.elementAt(j).toPlainTextString();
                    resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                    resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                    while ( resultsContent.contains(&quot;  &quot;) ) {
		       resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot; &quot;);
                    }
                    String anchorHref = &quot;http://www.homesteps.com/featuresearch.html&quot;;
                    try {
		        stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.homesteps.com/featuresearch.html', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                     } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                 } 
               }
            }
          }
        } catch ( ParserException pe ) { pe.printStackTrace(); }
      } catch ( IOException ioe ) { ioe.printStackTrace(); }
    }

    public static void HomePath() {
      if ( searchState.equals(&quot;ALL&quot; ) ) {
	  return;
      }

      String message = &quot;http://www.homepath.com/search.html?st=&quot; + searchState + &quot;&amp;amp;cno=000&amp;amp;ci=&amp;amp;zip=&amp;amp;src_ref=&amp;amp;mlsid=&amp;amp;pi=&amp;amp;pa=&amp;amp;bdi=&amp;amp;bhi=&amp;amp;x=26&amp;amp;y=11&amp;amp;ms=&amp;amp;xs=&quot;;
      try {
	 URL ubl = new URL( message );
         String resp = &quot;&quot;;        
         BufferedReader reader = new BufferedReader(new InputStreamReader(ubl.openStream()));
         String line;
         while ((line = reader.readLine()) != null) {
	   resp += line;
         }
         reader.close(); 

         int startIdx = resp.indexOf(&quot;&lt;table class=\&quot;multipleLinesSearchResults\&quot;&quot;);
         int endIdx = resp.indexOf(&quot;Get FREE HomePath&quot;);
 
         if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; 0 ) {
	   Parser htmlParser = new Parser();
           try {
	     htmlParser.setInputHTML(resp.substring(startIdx,endIdx));
             NodeList nList = htmlParser.parse(null);

             for ( int i=0; i&lt;nList.size(); i++ ) {
	       if ( nList.elementAt(i).getText().equals(&quot;table class=\&quot;multipleLinesSearchResults\&quot; cellpadding=\&quot;0\&quot; cellspacing=\&quot;0\&quot; border=\&quot;0\&quot;&quot;) ) {
		  NodeList trList = nList.elementAt(i).getChildren();
                  for ( int j=0; j&lt;trList.size(); j++ ) {
		    if ( trList.elementAt(j).getText().startsWith(&quot;tr class&quot;) ) {
		      String resultsContent = trList.elementAt(j).toPlainTextString().trim();
                      resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                      resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                      resultsContent = resultsContent.replaceAll(&quot;&amp;amp;nbsp;&quot;,&quot;&quot;);
                      resultsContent = resultsContent.replaceAll(&quot;SaveMap&quot;,&quot;&quot;);
                      while ( resultsContent.contains(&quot;  &quot;) ) {
		        resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot; &quot;);
                      }
                      //System.out.println( resultsContent );
                      String[] pieces = trList.elementAt(j).toHtml().split(&quot;href=\&quot;&quot;);
                      String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
                      String anchorHref = piecesII[0].trim();
                      anchorHref = anchorHref;
                      anchorHref = &quot;http://www.homepath.com&quot; + anchorHref;
                      if ( !resultsContent.equals(&quot;&quot;) ) {
                        try {
		          stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.homepath.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                        } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                      }
                    }  
                  } 
               }  
             }
           } catch ( ParserException pe ) { pe.printStackTrace(); }
	 }
      } catch ( IOException ioe ) { ioe.printStackTrace(); }
    }

    public static void HomeSalesGov() {
      if ( searchState.equals(&quot;ALL&quot; ) ) {
	  return;
      }  
      String msg = &quot;selectedCities=&quot; + URLEncoder.encode(&quot;ALL&quot;) + &quot;&amp;amp;selBedrooms=&amp;amp;selBaths=&amp;amp;pageAction=&quot; + URLEncoder.encode(&quot;Search for Properties&quot;) + &quot;&amp;amp;stateName=&quot; + URLEncoder.encode( stateMap.get(searchState) ) + &quot;&amp;amp;state=&quot; + URLEncoder.encode(searchState) + &quot;&amp;amp;propertyType=&quot; + URLEncoder.encode(&quot;RESIDENTIAL&quot;);
      try {     
        URL theUrl = new URL(&quot;http://www.homesales.gov/homesales/mainAction.do&quot;); 
        HttpURLConnection conn = (HttpURLConnection) theUrl.openConnection();
        conn.setDoOutput(true);        
        conn.setRequestMethod(&quot;POST&quot;);
        conn.setRequestProperty(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);           
        conn.setRequestProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0&quot;); 
        OutputStream os = conn.getOutputStream();
        os.write(msg.getBytes(&quot;UTF-8&quot;));
        os.close();

        BufferedReader myReader = new BufferedReader(new InputStreamReader(conn.getInputStream()));
        String line;
        String resp = &quot;&quot;;
        while ((line = myReader.readLine())!= null) {
          resp = resp.concat(line);
        }
        myReader.close();

        int startIdx = resp.indexOf(&quot;&lt;table width=\&quot;80%\&quot; align=\&quot;center\&quot; border=\&quot;0\&quot; rules=\&quot;none\&quot;&gt;&quot;);
        int endIdx = resp.indexOf(&quot; Total Result Pages:&quot;);
        
        if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; startIdx ) {
         try {
	  Parser prs = new Parser();
          prs.setInputHTML(resp.substring(startIdx,endIdx));

          NodeList nList = prs.parse(null);
          for ( int i=0; i&lt;nList.size(); i++ ) {     
	    if ( nList.elementAt(i).getText().startsWith(&quot;table width=\&quot;80%\&quot;&quot;) ) {
	       NodeList trList = nList.elementAt(i).getChildren();
               for ( int j=0; j&lt;trList.size(); j++ ) {
		 if ( trList.elementAt(j).getText().equals(&quot;tr&quot;) ) {
		    String resultsContent = trList.elementAt(j).toPlainTextString();
                    resultsContent = resultsContent.replaceAll(&quot;&amp;amp;nbsp;&quot;,&quot;&quot;);
                    resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                    resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                    while ( resultsContent.contains(&quot;  &quot;) ) {
		       resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot; &quot;);
                    }
                   
                    String[] pieces = trList.elementAt(j).toHtml().split(&quot;href=\&quot;&quot;);
                    if ( pieces.length &gt; 1 ) {
                     String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
                     if ( piecesII.length &gt; 0 ) {
                      String anchorHref = piecesII[0].trim();
                      anchorHref = anchorHref;
                      try {
		        stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.homepath.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                      } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                     }
                    }
                 }  
               }
            }
          }
         } catch ( ParserException pe ) { pe.printStackTrace(); }
        }
      } catch ( IOException ioe ) { ioe.printStackTrace(); }
    }

    public static void HudHomeStore() {
      if ( searchState.equals(&quot;ALL&quot; ) ) {
	  return;
      }

      String message = &quot;https://hudhomestore.secureportalk.net/HUD/PropertySearchResult.aspx?PageId=1&amp;amp;zipCode=&amp;amp;city=&amp;amp;county=&amp;amp;sState=&quot;+searchState+&quot;&amp;amp;fromPrice=0&amp;amp;toPrice=0&amp;amp;caseNumber=&amp;amp;bed=0&amp;amp;bath=0&amp;amp;street=&amp;amp;buyerType=0&amp;amp;specialProgram=&amp;amp;Status=0&amp;amp;OrderbyName=SCASENUMBER&amp;amp;OrderbyValue=ASC&amp;amp;sPageSize=50&quot;;
      try {
	 URL ubl = new URL( message );
         String resp = &quot;&quot;;        
         BufferedReader reader = new BufferedReader(new InputStreamReader(ubl.openStream()));
         String line;
         while ((line = reader.readLine()) != null) {
	   resp += line;
         }
         reader.close(); 

         int startIdx = resp.indexOf(&quot;&lt;tr class=\&quot;FormTablerow\&quot;&quot;);
         int endIdx = resp.indexOf(&quot;&lt;!-- =============  Data List&quot;);

         try {
	   Parser p = new Parser();
           p.setInputHTML(resp.substring(startIdx,endIdx));           
           NodeList nList = p.parse(null);
           for ( int i=0; i&lt;nList.size(); i++ ) {  
	     if ( nList.elementAt(i).getText().startsWith(&quot;tr class=\&quot;FormTablerow&quot;) ) {
                 String resultsContent = nList.elementAt(i).toPlainTextString();
                 resultsContent = resultsContent.replaceAll(&quot;&amp;amp;nbsp;&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;Exclusive&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;View&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;Street&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;Map it&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;Email&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;Info&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;Extended&quot;,&quot;&quot;);
                 resultsContent = resultsContent.replaceAll(&quot;Lottery&quot;,&quot;&quot;);
                 while ( resultsContent.contains(&quot;  &quot;) ) {
		    resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot; &quot;);
                 }
                 //System.out.println( resultsContent );
                 NodeList tdList = nList.elementAt(i).getChildren();
                 for ( int j=0; j&lt;tdList.size(); j++ ) {
		   if ( tdList.elementAt(j).getText().startsWith(&quot;td align=\&quot;center\&quot; valign=\&quot;middle\&quot;&quot;) ) {
		     NodeList aList = tdList.elementAt(j).getChildren();
                     for ( int k=0; k&lt;aList.size(); k++ ) {
		       if ( aList.elementAt(k).getText().startsWith(&quot;a href=\&quot;#;\&quot;&quot;) ) {
			   String[] pieces = aList.elementAt(k).getText().split(Pattern.quote(&quot;getGoogleTranslationstring(&amp;amp;#039;&quot;));
                         if ( pieces.length &gt; 0 ) {
			   String[] piecesII = pieces[1].split(Pattern.quote(&quot;&amp;amp;#039;&quot;));
                           if ( piecesII.length &gt; 0 ) {
			     String anchorHref = piecesII[0].trim();
                             try {
			       System.out.println( &quot;INSERT INTO auction_records VALUES ( 'http://www.hudhomestore.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
		                stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.hudhomestore.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                             } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                           }  
                         }  
                       }  
                     }  
                   }   
                 }
             }                 
           }
         } catch ( ParserException pe ) { pe.printStackTrace(); }
      } catch ( IOException ioe ) { ioe.printStackTrace(); }
    }

    public static void GSAGov() {
      if ( searchState.equals(&quot;ALL&quot; ) ) {
	  return;
      }

      String message = &quot;https://extportal.pbs.gsa.gov/ResourceCenter/PRHomePage/searchProperty.do?state=5&amp;amp;amp;statename=&quot; + stateMap.get(searchState).toUpperCase() +  &quot;&amp;amp;amp;propType=&amp;amp;amp;propTypeName=ALL&amp;amp;amp;searchType=S&quot;;
      try {
	 URL ubl = new URL( message );
         String resp = &quot;&quot;;        
         BufferedReader reader = new BufferedReader(new InputStreamReader(ubl.openStream()));
         String line;
         while ((line = reader.readLine()) != null) {
	   resp += line;
         }
         reader.close(); 

         int startIdx = resp.indexOf(&quot;&lt;div class=\&quot;cmSectionText\&quot;&gt;&quot;);
         int endIdx = resp.indexOf(&quot;&lt;!-- div cmSectionText --&gt;&quot;);
           
        if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; startIdx ) {
	  Parser p = new Parser();
	  try {   
	    p.setInputHTML( resp.substring(startIdx,endIdx) );
            NodeList nList = p.parse(null); 

            for ( int i=0; i&lt;nList.size(); i++ ) {
	      if ( nList.elementAt(i).getText().startsWith(&quot;div class=\&quot;cmSectionText\&quot;&quot;) ) {
		NodeList divChildren = nList.elementAt(i).getChildren();
                for ( int j=0; j&lt;divChildren.size(); j++ ) {
		  if ( divChildren.elementAt(j).getText().contains(&quot;D1D1D1&quot;) ) {
		    String resultsContent = divChildren.elementAt(j).toPlainTextString().trim();
                    resultsContent = resultsContent.replaceAll(&quot;Click here for more information&quot;,&quot;&quot;);
                    resultsContent = resultsContent.replaceAll(&quot;&amp;amp;nbsp;&quot;,&quot;&quot;);
                    resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                    resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                    resultsContent = resultsContent.replaceAll(&quot;\&quot;&quot;,&quot;&quot;);
                    while ( resultsContent.contains(&quot;  &quot;) ) {
		       resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot; &quot;);
                    }  
                    //System.out.println( resultsContent );  
                    String htm = divChildren.elementAt(j).toHtml();
                    //System.out.println( htm );  
                    int hrefIdx = htm.indexOf(&quot;loadProperty.do&quot;);
                    if ( hrefIdx &gt; 0 ) {
		      String[] pieces = htm.substring(hrefIdx,hrefIdx+34).split(&quot;&gt;&quot;);
                      if ( pieces.length &gt; 0 ) {
			 String anchorHref = pieces[0].substring(0,pieces[0].length()-1);
                         anchorHref = &quot;https://extportal.pbs.gsa.gov/ResourceCenter/PRHomePage/&quot; + anchorHref;
                          try {
			      //System.out.println( &quot;INSERT INTO auction_records VALUES ( 'https://propertydisposal.gsa.gov/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
		                stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'https://propertydisposal.gsa.gov/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; );
                          } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                      }
                    }
                  } 
                } 
              }  
            }  
	  } catch ( ParserException pe ) { pe.printStackTrace(); }
        }
      } catch ( IOException ioe ) { ioe.printStackTrace(); }
    }

    public static void GovSales() {
      String msg = &quot;http://www.govsales.gov/fassys/fassys/?function=010000000000&quot;;
      
      try {
	URL ubl = new URL( msg );
        String resp = &quot;&quot;;        
        BufferedReader reader = new BufferedReader(new InputStreamReader(ubl.openStream()));
        String line;
        while ((line = reader.readLine()) != null) {
	   resp += line;
        }
        reader.close(); 

        String scParam = &quot;&quot;;
	int scParamIdx = resp.indexOf(&quot;name=scParam VALUE=\&quot;&quot;);
        if ( scParamIdx &gt; 0 ) {
	   scParam = resp.substring(scParamIdx, scParamIdx+80);
	   String[] pieces = scParam.split(&quot;VALUE=\&quot;&quot;);
           if ( pieces.length &gt; 1 ) {
             String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
             if ( piecesII.length &gt; 1 ) {
		scParam = piecesII[0].trim();
             } 
	   }
        }
        String webPcm = &quot;&quot;;
        int webPcmIdx = resp.indexOf(&quot;WEBPCMTRANSID&quot;);
        if ( webPcmIdx &gt; 0 ) {
	   webPcm = resp.substring(webPcmIdx, webPcmIdx+40);
           String[] pieces = webPcm.split(&quot;VALUE=&quot;);
           if ( pieces.length &gt; 1 ) {
             String[] piecesII =  pieces[1].split(&quot;\&quot;&quot;);
             if ( piecesII.length &gt; 1 ) {
                webPcm = piecesII[1].trim();
             }  
           }
        }

        String msg2 = &quot;scParam=&quot; + URLEncoder.encode( scParam ) + &quot;&amp;amp;scCurTabCat=&quot; + URLEncoder.encode(&quot;010000000000&quot;) + &quot;&amp;amp;scSelTabCat=&quot; + URLEncoder.encode(&quot;010000000000&quot;) + &quot;&amp;amp;scSelLink=&quot; + URLEncoder.encode(&quot;GS&quot;) + &quot;&amp;amp;scGSName=&quot; + URLEncoder.encode( searchString.toUpperCase() ) + &quot;&amp;amp;scGSOptn=&quot; + URLEncoder.encode(&quot;1&quot;) + &quot;&amp;amp;scSelState=&amp;amp;scSelBCCat=&amp;amp;scSelRow=&amp;amp;scSelCatList=&amp;amp;scSeeAllCat=&amp;amp;WEBPCMTRANSID=&quot; + URLEncoder.encode( webPcm );

        URL usl = new URL(&quot;http://www.govsales.gov/fassys/fasallcat/&quot;);
        HttpURLConnection conn = (HttpURLConnection) usl.openConnection();
        conn.setDoOutput(true);        
        conn.setRequestMethod(&quot;POST&quot;);
        conn.setRequestProperty(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);           
        conn.setRequestProperty(&quot;User-Agent&quot;,&quot;Mozilla/5.0&quot;); 
        OutputStream os = conn.getOutputStream();
        os.write(msg2.getBytes(&quot;UTF-8&quot;));
        os.close();

        BufferedReader lecteur = new BufferedReader(new InputStreamReader(conn.getInputStream()));
        String rayo;
        String resp2 = &quot;&quot;;
        while ((rayo = lecteur.readLine())!= null) {
	    resp2 += rayo;
        }
        lecteur.close();

        scParam = &quot;&quot;;
	scParamIdx = resp2.indexOf(&quot;name=scParam VALUE=\&quot;&quot;);
        if ( scParamIdx &gt; 0 ) {
	   scParam = resp2.substring(scParamIdx, scParamIdx+80);
	   String[] pieces = scParam.split(&quot;VALUE=\&quot;&quot;);
           if ( pieces.length &gt; 1 ) {
             String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
             if ( piecesII.length &gt; 1 ) {
		scParam = piecesII[0].trim();
             } 
	   }
        }
        String scStoreLocal1 = &quot;&quot;;
	int scSL1Idx = resp2.indexOf(&quot;name=scStoreLocal1&quot;);
        if ( scSL1Idx &gt; 0 ) {
	   scStoreLocal1 = resp2.substring(scSL1Idx, scSL1Idx+160);
	   String[] pieces = scStoreLocal1.split(&quot;VALUE=\&quot;&quot;);
           if ( pieces.length &gt; 1 ) {
             String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
             if ( piecesII.length &gt; 1 ) {
		scStoreLocal1 = piecesII[0].trim();
             } 
	   }
        }
        String scStoreLocal2 = &quot;&quot;;
	int scSL2Idx = resp2.indexOf(&quot;name=scStoreLocal2&quot;);
        if ( scSL1Idx &gt; 0 ) {
	   scStoreLocal2 = resp2.substring(scSL2Idx, scSL2Idx+160);
	   String[] pieces = scStoreLocal2.split(&quot;VALUE=\&quot;&quot;);
           if ( pieces.length &gt; 1 ) {
             String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
             if ( piecesII.length &gt; 1 ) {
		scStoreLocal2 = piecesII[0];
             } 
	   }
        }
        String scStoreLocal3 = &quot;&quot;;
	int scSL3Idx = resp2.indexOf(&quot;name=scStoreLocal3&quot;);
        if ( scSL3Idx &gt; 0 ) {
	   scStoreLocal3 = resp2.substring(scSL3Idx, scSL3Idx+160);
	   String[] pieces = scStoreLocal3.split(&quot;VALUE=\&quot;&quot;);
           if ( pieces.length &gt; 1 ) {
             String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
             if ( piecesII.length &gt; 1 ) {
		scStoreLocal3 = piecesII[0];
             } 
	   }
        }
        String scStoreLocal5 = &quot;&quot;;
	int scSL5Idx = resp2.indexOf(&quot;name=scStoreLocal5&quot;);
        if ( scSL5Idx &gt; 0 ) {
	   scStoreLocal5 = resp2.substring(scSL5Idx, scSL5Idx+160);
	   String[] pieces = scStoreLocal5.split(&quot;VALUE=\&quot;&quot;);
           if ( pieces.length &gt; 1 ) {
             String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
             if ( piecesII.length &gt; 1 ) {
		scStoreLocal5 = piecesII[0];
             } 
	   }
        }
        webPcm = &quot;&quot;;
        webPcmIdx = resp2.indexOf(&quot;WEBPCMTRANSID&quot;);
        if ( webPcmIdx &gt; 0 ) {
	   webPcm = resp2.substring(webPcmIdx, webPcmIdx+40);
           String[] pieces = webPcm.split(&quot;VALUE=&quot;);
           if ( pieces.length &gt; 1 ) {
             String[] piecesII =  pieces[1].split(&quot;\&quot;&quot;);
             if ( piecesII.length &gt; 1 ) {
                webPcm = piecesII[1].trim();
             }  
           }
        }

        String msg3 = &quot;scParam=&quot; + URLEncoder.encode( scParam ) + &quot;&amp;amp;scStoreLocal1=&quot; + URLEncoder.encode( scStoreLocal1 ) + &quot;&amp;amp;scStoreLocal2=&quot; + URLEncoder.encode( scStoreLocal2 ) + &quot;&amp;amp;scStoreLocal3=&quot; + URLEncoder.encode( scStoreLocal3 ) + &quot;&amp;amp;scStoreLocal4=&amp;amp;scStoreLocal5=&quot; + URLEncoder.encode( scStoreLocal5 ) + &quot;&amp;amp;scStoreLocal6=&amp;amp;scStoreLocal7=&amp;amp;scStoreLocal8=&amp;amp;scStoreLocal9=&amp;amp;scStoreLocal10=&amp;amp;scStoreLocal11=&amp;amp;scStoreLocal12=&amp;amp;scCurTabCat=&amp;amp;scSelTabCat=&amp;amp;scSelLink=&amp;amp;scGSName=&amp;amp;scGSOptn=&quot; + URLEncoder.encode(&quot;1&quot;) + &quot;&amp;amp;scSelState=&amp;amp;scSelRow=&quot; + URLEncoder.encode(&quot;2G1WB58K381263163&quot;) + &quot;&amp;amp;scSortOrder=&amp;amp;scPageNo=&quot; + URLEncoder.encode(&quot;1&quot;) + &quot;&amp;amp;WEBPCMTRANSID=&quot; + URLEncoder.encode(&quot;0690484,2970121&quot;);

        //System.out.println( msg3 );

        int startIdx = resp2.indexOf(&quot;var tab=&quot;);
        int endIdx = resp2.indexOf(&quot;bldTr();&quot;);
       
        String dataBlock = resp2.substring(startIdx,endIdx).replaceAll(Pattern.quote(&quot;[&quot;),&quot;&quot;).replaceAll(Pattern.quote(&quot;];&quot;),&quot;&quot;);
        dataBlock = dataBlock.replaceAll(&quot;var tab=\&quot;&quot;,&quot;&quot;);
        dataBlock = dataBlock.replaceAll(&quot;  &quot;,&quot; &quot;); 
	//System.out.println( dataBlock );
        String[] dataBlockPieces = dataBlock.split(&quot;\&quot;, \&quot;&quot;);

        ArrayList&lt;String&gt; resultsContentStrings = new ArrayList&lt;String&gt;();
        ArrayList&lt;String&gt; urlIdList = new ArrayList&lt;String&gt;();

        for ( int i=0; i&lt;dataBlockPieces.length; i+=12 ) {
	  String content = &quot;&quot;;
	  for ( int j=0; j&lt;12; j++ ) {
	    content += dataBlockPieces[i+j] + &quot; &quot;;
	  }
	  resultsContentStrings.add( content );
          urlIdList.add( dataBlockPieces[i+1] );
        }
 
        ArrayList&lt;String&gt; msgs = new ArrayList&lt;String&gt;();

        for ( String urlId : urlIdList ) {
	    msgs.add( &quot;scParam=&quot; + URLEncoder.encode( scParam ) + &quot;&amp;amp;scStoreLocal1=&quot; + URLEncoder.encode( scStoreLocal1 ) + &quot;&amp;amp;scStoreLocal2=&quot; + URLEncoder.encode( scStoreLocal2 ) + &quot;&amp;amp;scStoreLocal3=&quot; + URLEncoder.encode( scStoreLocal3 ) + &quot;&amp;amp;scStoreLocal4=&amp;amp;scStoreLocal5=&quot; + URLEncoder.encode( scStoreLocal5 ) + &quot;&amp;amp;scStoreLocal6=&amp;amp;scStoreLocal7=&amp;amp;scStoreLocal8=&amp;amp;scStoreLocal9=&amp;amp;scStoreLocal10=&amp;amp;scStoreLocal11=&amp;amp;scStoreLocal12=&amp;amp;scCurTabCat=&amp;amp;scSelTabCat=&amp;amp;scSelLink=&amp;amp;scGSName=&amp;amp;scGSOptn=&quot; + URLEncoder.encode(&quot;1&quot;) + &quot;&amp;amp;scSelState=&amp;amp;scSelRow=&quot; + URLEncoder.encode( urlId ) + &quot;&amp;amp;scSortOrder=&amp;amp;scPageNo=&quot; + URLEncoder.encode(&quot;1&quot;) + &quot;&amp;amp;WEBPCMTRANSID=&quot; + URLEncoder.encode(&quot;0690484,2970121&quot;) );
        }

        ArrayList&lt;String&gt; urlList = new ArrayList&lt;String&gt;();

        for ( String msg1 : msgs ) {
	  urlList.add( &quot;javascript:jQuery.post( &amp;amp;quot;http://www.govsales.gov/fassys/fassrchlist/&amp;amp;quot;, &amp;amp;quot;&quot; + msg1 + &quot;&amp;amp;quot; )&quot; ); 
        }

        for ( int i=0; i&lt;resultsContentStrings.size()-1; i++ ) {
          try {	
	      stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.govsales.gov/', '&quot; + urlList.get(i) + &quot;', '&quot; + resultsContentStrings.get(i) + &quot;' )&quot; ); 
          } catch ( SQLException sqle ) { sqle.printStackTrace(); }
        }

      } catch ( IOException ioe ) { ioe.printStackTrace(); }

    }

    public static void LonestarOnline() {   
       String msg = &quot;search_type=title_search&amp;amp;search_name=Title+%26+Description+Search&amp;amp;search_text=&quot; + searchString + &quot;&amp;amp;phrase_match=any&amp;amp;category=-1&amp;amp;search_span=title&amp;amp;search_limit=active&amp;amp;order_by=title&amp;amp;sort_order=ASC&quot;;
 
       try {
         URL theUrl = new URL( &quot;http://www.lonestaronline.com/search/search_results.cfm?&quot; + msg );
         String resp = &quot;&quot;;        
         BufferedReader reader = new BufferedReader(new InputStreamReader(theUrl.openStream()));
         String line;
         while ((line = reader.readLine()) != null) {
	    resp += line;
         }
         reader.close();

         int startIdx = resp.indexOf(&quot;&lt;table border=0 cellspacing=0 cellpadding=2 noshade width=780&gt;&quot;);
         int endIdx = resp.indexOf(&quot;&lt;form name=\&quot;blah\&quot;&quot;);
         if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; startIdx ) {
	     //System.out.println( startIdx + &quot; &quot; + endIdx );

            Parser psr = new Parser();
            try {
		//System.out.println( resp.substring( startIdx, endIdx ) );
              psr.setInputHTML( resp.substring(startIdx,endIdx) );   
              NodeList nList = psr.parse(null);
              
              for ( int i=0; i&lt;nList.size(); i++ ) {
		if ( nList.elementAt(i).getText().equals(&quot;table border=0 cellspacing=0 cellpadding=2 noshade width=780&quot;) ) {
		   NodeList trList =  nList.elementAt(i).getChildren();
                   for ( int j=0; j&lt;trList.size(); j++ ) {
		     if ( trList.elementAt(j).getText().startsWith(&quot;tr&quot;) ) {
			String resultsContent = trList.elementAt(j).toPlainTextString();
                        resultsContent = resultsContent.replaceAll(&quot;&amp;amp;nbsp;&quot;,&quot;&quot;);
                        resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                        resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                        resultsContent = resultsContent.replaceAll(&quot;\&quot;&quot;,&quot;&quot;);
                        resultsContent = resultsContent.replaceAll(&quot;'&quot;,&quot;&quot;);
                        while ( resultsContent.contains(&quot;  &quot;) ) {
		          resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot; &quot;);
                        }
                        NodeList tdList = trList.elementAt(j).getChildren();
                        for ( int k=0; k&lt;tdList.size(); k++ ) {
			   if ( tdList.elementAt(k).getText().equals(&quot;td width=\&quot;496\&quot;&quot;) ) {
			       String tdContent = tdList.elementAt(k).toHtml();
                               String[] pieces = tdContent.split(&quot;href=\&quot;&quot;);
                               if ( pieces.length &gt; 1 ) {
				  String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
                                  String anchorHref = &quot;http://www.lonestaronline.com&quot; + piecesII[0].trim();
				  try {	
	                            stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.lonestaronline.com', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; ); 
                                  } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                               }   
                           }   
                        }
                     }  
                   }  
                }  
              }
            } catch ( ParserException pe ) { pe.printStackTrace(); }
         }
       } catch ( IOException ioe ) { ioe.printStackTrace(); }
    }

    public static void GovDeals() {
      String msg = &quot;&quot;;
      if ( searchState.equals(&quot;ALL&quot;) ) {    
         msg = &quot;fa=Main.AdvSearchResults&amp;amp;timing1=&amp;amp;mystate=&amp;amp;myseller=0&amp;amp;myselectbox=00&amp;amp;desc=&quot; + searchString + &quot;&amp;amp;inv_nbr=&quot;;
      }
      else {
	  msg = &quot;fa=Main.AdvSearchResults&amp;amp;timing1=&amp;amp;mystate=&quot; + searchState + &quot;&amp;amp;myseller=0&amp;amp;myselectbox=00&amp;amp;desc=&quot; + searchString + &quot;&amp;amp;inv_nbr=&quot;;
      }  

       try {
         URL ubl = new URL( &quot;http://www.govdeals.com/index.cfm?&quot; + msg );
         String resp = &quot;&quot;;        
         BufferedReader reader = new BufferedReader(new InputStreamReader(ubl.openStream()));
         String line;
         while ((line = reader.readLine()) != null) {
	    resp += line;
         }
         reader.close();

         int startIdx = resp.indexOf(&quot;&lt;tr bgcolor=\&quot;#CCCCCC\&quot;&gt;&quot;);
         int endIdx = resp.indexOf(&quot;&lt;td colspan=\&quot;9\&quot; style=\&quot;border-bottom:none\&quot; scope=\&quot;row\&quot;&gt;&quot;);

         if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; startIdx ) {
	     // System.out.println( startIdx + &quot; &quot; + endIdx );
           Parser prse = new Parser();
           try {
	      prse.setInputHTML( resp.substring( startIdx, endIdx ) );
              NodeList nList = prse.parse(null);
              for ( int i=0; i&lt;nList.size(); i++ ) { 
		 if ( nList.elementAt(i).getText().startsWith(&quot;tr valign=\&quot;top\&quot;&quot;) ) {
		   String resultsContent = nList.elementAt(i).toPlainTextString();
                   resultsContent = resultsContent.replaceAll(&quot;&amp;amp;nbsp;&quot;,&quot;&quot;);
                   resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                   resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                   resultsContent = resultsContent.replaceAll(&quot;\&quot;&quot;,&quot;&quot;);
                   resultsContent = resultsContent.replaceAll(&quot;'&quot;,&quot;&quot;);
                   resultsContent = resultsContent.replaceAll(&quot;View by same:CategoryLocationMake/BrandModelProximity-------------Terms &amp;amp; ConditionsView this Item&quot;,&quot;&quot;);
                   while ( resultsContent.contains(&quot;  &quot;) ) {
		      resultsContent = resultsContent.replaceAll(&quot;  &quot;,&quot; &quot;);
                   }
                   resultsContent = resultsContent.replaceAll(&quot;0Bids&quot;,&quot;0 Bids&quot;);
                   //System.out.println( resultsContent );
                   NodeList tdList = nList.elementAt(i).getChildren();
                   for ( int j=0; j&lt;tdList.size(); j++ ) {
		     if ( tdList.elementAt(j).getText().equals(&quot;td valign=\&quot;top\&quot; nowrap=\&quot;nowrap\&quot;&quot;) ) {
		      String[] pieces = tdList.elementAt(j).toHtml().split(&quot;href=\&quot;&quot;);
                      if ( pieces.length &gt; 1 ) {
			String[] piecesII = pieces[1].split(&quot;\&quot;&quot;);
                        String anchorHref = &quot;http://www.govdeals.com/&quot; + piecesII[0];
                        try {	
	                   stmt.executeUpdate( &quot;INSERT INTO auction_records VALUES ( 'http://www.govdeals.com/', '&quot; + anchorHref + &quot;', '&quot; + resultsContent + &quot;' )&quot; ); 
                        } catch ( SQLException sqle ) { sqle.printStackTrace(); }
                      }
                     }   
                   }                        
                 }
              }
           } catch ( ParserException pe ) { pe.printStackTrace(); }
         }
       } catch ( IOException ioe ) { ioe.printStackTrace(); }    
    }

    public static void IllinoisIbid() {
      String msg = &quot;search=1&amp;amp;catid=&amp;amp;SearchStr=&quot; + searchString + &quot;&amp;amp;AllAnyExact=all&amp;amp;Region1=&amp;amp;Region2=&amp;amp;Region3=&amp;amp;Region4=&amp;amp;customs_criteria=1&amp;amp;cfs_txt_EqNum=&amp;amp;cfs_txt_VIN=&amp;amp;cfs_int_min_Odometer=&amp;amp;cfs_int_max_Odometer=&amp;amp;cfs_txt_make=&amp;amp;cfs_txt_model=&amp;amp;cfs_txt_modelyear=&amp;amp;PriceFrom=&amp;amp;PriceTo=&amp;amp;StartFrom=&amp;amp;StartTo=&amp;amp;EndFrom=&amp;amp;EndTo=&amp;amp;ExcludeStr=&amp;amp;OrderBy=end_asc&amp;amp;MaxResults=50&amp;amp;sbmtAdvSearch=Go#results&quot;;    
      try {
       URL ubl = new URL( &quot;http://ibid.illinois.gov/advancedsearch.asp?&quot; + msg );
       String resp = &quot;&quot;;
       BufferedReader lecteur = new BufferedReader(new InputStreamReader(ubl.openStream()));
       String line;
       while ((line = lecteur.readLine()) != null) {
          resp += line;
       }
       lecteur.close();

       int startIdx = resp.indexOf( &quot;&lt;div id=\&quot;SearchResults\&quot;&gt;&quot;);
       int endIdx = resp.indexOf( &quot;&lt;div id=\&quot;PageLinksS\&quot;&gt;&quot; );       
       //System.out.println( startIdx + &quot; &quot; + endIdx ); 
       if ( startIdx &gt; 0 &amp;amp;&amp;amp; endIdx &gt; startIdx ) {
	 Parser prs = new Parser();
         try { 
	   prs.setInputHTML( resp.substring(startIdx,endIdx) );
           NodeList nList = prs.parse(null);

           for ( int i=0; i&lt;nList.size(); i++ ) {
	      if ( nList.elementAt(i).getText().equals(&quot;div id=\&quot;SearchResults\&quot;&quot;) ) {
		 NodeList tblList = nList.elementAt(i).getChildren();
                 for ( int j=0; j&lt;tblList.size(); j++ ) {
		    if ( tblList.elementAt(j).getText().equals(&quot;table cellpadding=\&quot;2\&quot; cellspacing=\&quot;1\&quot;&quot;) ) {
		      NodeList trList = tblList.elementAt(j).getChildren();
                      for ( int k=0; k&lt;trList.size(); k++ ) {
			if ( trList.elementAt(k).getText().startsWith(&quot;tr class=\&quot;Color&quot;) ) {
			  String resultsContent = trList.elementAt(k).toPlainTextString();
                          resultsContent = resultsContent.replaceAll(&quot;&amp;amp;nbsp;&quot;,&quot;&quot;);
                          resultsContent = resultsContent.replaceAll(&quot;\n&quot;,&quot;&quot;);
                          resultsContent = resultsContent.replaceAll(&quot;\t&quot;,&quot;&quot;);
                          resultsContent = resultsContent.replaceAll(&quot;\&quot;&quot;,&quot;&quot;);
                          resultsContent = resultsContent.replaceAll(&quot;'&quot;,&quot;&quot;);
                          r
</pre>
</div>
<br>
<p>Version 15 of the Government auctions scraping programs. This code scrapes from 17 different government auctions websites and aggregates those data into an SQL database.</p>

</div>

<div class="result">
<h2 class="title">
<a href="/user/mindshare">mindshare</a>/<a href="/snippet/xml/wordpress-api-code-hints-auto-completion-for-adobe-dreamweaver">WordPress API Code Hints (Auto Completion) for Adobe Dreamweaver</a>
<span class="language">(<a href="/language/xml/"> XML</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: xml;">
&lt;!--
	---------------------------------------------------------------
	WordPress Code Hinting for Dreamweaver
	
	Version: 0.2.5
	$Revision$
	$Date$
	$Id$
	Copyright: Mindshare Studios, Inc.
	
	Contributors:
		Damian Taggart
		Bryce Corkins
		http://mind.sh/are/
	
	Project Home: http://code.google.com/p/wordpress-codehints/
	Donate: http://mind.sh/are/donate/
	$HeadURL$
	Support/bugs: http://code.google.com/p/wordpress-codehints/issues/list

	---------------------------------------------------------------
	Changelog:
		0.2.4 - bugfixes, added query_posts
		0.2.4 - bugfix for WP menus
		0.2.3 - another bloginfo bugfix
		0.2.2 - bloginfo bugfix, combined all &quot;wp...&quot; menus into one
		0.2.1 - bugfix added missing DOCTYPE attributes to menu tags
		0.2 ~ first release includes API up to WordPress API 3.3.1, ready for external testing, first commit
		0.1 ~ first release includes API up to WordPress API 3.3
	
	Usage:
		This file provides code hinting (auto-completion) for the
		WordPress API in Dreamweaver's code view.
		
		- Step 1 -
		Copy this XML file into your Dreamweaver configuration
		folder into the appropriate location for your OS, replacing
		&lt;USERNAME&gt; with your own username, &lt;VERSION&gt; with your
		Dreamweaver version (e.g. 'CS5'), and &lt;LANGUAGE&gt; with your
		language code (e.g. 'en_US'): NOTE: On Windows you may need
		to enable viewing of hidden folders to find the Dreamweaver
		config folder.
		
		Windows XP:
		C:\Documents and Settings\&lt;USERNAME&gt;\Application Data\Adobe\Dreamweaver &lt;VERSION&gt;\Configuration\CodeHints
		
		Windows	Vista/7:
		C:\Users\&lt;USERNAME&gt;\AppData\Roaming\Adobe\Dreamweaver &lt;VERSION&gt;\&lt;LANGUAGE&gt;\Configuration\CodeHints
		
		Macintosh:
		&lt;DRIVE&gt;/Users/&lt;USERNAME&gt;/Library/Application Support/Adobe/Dreamweaver &lt;VERSION&gt;/Configuration/CodeHints
		
		- Step 2 - 
		Start Dreamweaver &gt; go to Edit &gt; Preferences &gt; Code Hints 
		and make sure the checkbox next to &quot;WordPress Code Hints&quot; is 
		enabled, press OK to save your changes. That's it!

	TODO:
		- package as a Dreamweaver extension
		- add extract_from_markers(); insert_with_markers();
		fix value attributes
		add secondary menus -&gt; orderby, etc
		add filters/hooks API?
		- add variables from codex ($post, $etc)
	
	---------------------------------------------------------------
	GNU PUBLIC LICENSE
	---------------------------------------------------------------
	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.
	
	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the
	GNU General Public License for more details.
	
	You should have received a copy of the GNU General Public License
	along with this program. If not, see http://www.gnu.org/licenses
	---------------------------------------------------------------
--&gt;
&lt;codehints xmlns:MMString=&quot;http://www.macromedia.com/schemes/data/string/&quot;&gt;
&lt;menugroup MMString:name=&quot;codehints_wordpressapi&quot; id=&quot;CodeHints_WordPressAPI&quot; name=&quot;WordPress Code Hints ($Revision$)&quot; enabled=&quot;true&quot;&gt;
	&lt;description&gt;
		&lt;![CDATA[ WordPress Code Hinting for Dreamweaver ($Revision$) ]]&gt;
	&lt;/description&gt;

	&lt;function pattern=&quot;addslashes_gpc($gpc)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_action($tag, $function_to_add, $priority, $accepted_args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_blog_option($id, $key, $value)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_custom_background($header_callback, $admin_header_callback, $admin_image_div_callback)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_custom_image_header($header_callback, $admin_header_callback, $admin_image_div_callback)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_existing_user_to_blog($blog_id, $user_id, $role)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_filter($tag, $function_to_add, $priority, $accepted_args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_magic_quotes($array)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_menu_page($page_title, $menu_title, $capability, $menu_slug, $function, $icon_url, $position)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_meta_box($id, $title, $callback, $page, $context, $priority, $callback_args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_new_user_to_blog($blog_id, $user_id, $role)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_object_page($page_title, $menu_title, $capability, $menu_slug, $function, $icon_url, $position)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_option($name, $value, $deprecated, $autoload)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_ping($post_id, $uri)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_post_meta($post_id, $meta_key, $meta_value, $unique)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_post_type_support($post_type, $supports)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_query_arg($param1, $param2, $old_query_or_uri)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_role($role, $display_name, $capabilities)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_shortcode($tag , $func)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_submenu_page($parent_slug, $page_title, $menu_title, $capability, $menu_slug, $function)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_theme_support($feature)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_user_meta($user_id, $meta_key, $meta_value, $unique)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_user_to_blog($blog_id, $user_id, $role)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_utility_page($page_title, $menu_title, $capability, $menu_slug, $function, $icon_url, $position)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;admin_notice_feed()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;admin_url($path, $scheme)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;allowed_tags()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;antispambot($emailaddy, $mailto)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;apply_filters($tag, $value, $var)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;attribute_escape($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;author_can($post, $capability)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;auth_redirect()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;avoid_blog_page_permalink_collision()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;backslashit($string)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;balanceTags($text, $force)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;bloginfo($show)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;bloginfo_rss($show)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;body_class($class)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;bool_from_yn($yn)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;cache_javascript_headers()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;calendar_week_mod()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;cancel_comment_reply_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;category_description()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;cat_is_ancestor_of($cat1, $cat2)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;check_admin_referer($action, $query_arg)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;check_ajax_referer($action, $query_arg, $die)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;check_comment($author, $email, $url, $comment, $user_ip, $user_agent, $comment_type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;check_import_new_users()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;check_upload_mimes()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;check_upload_size($file)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;choose_primary_blog()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;clean_pre($matches)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;clean_url($url, $protocols, $context)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comments_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comments_number($zero, $one, $more)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comments_open($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comments_popup_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comments_popup_script()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comments_rss_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comments_template($file, $separate_comments)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_author($comment_ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_author_email()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_author_email_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_author_IP()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_author_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_author_rss()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_author_url()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_author_url_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_class($class)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_date('d', $comment_ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_excerpt()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_form($args, $post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_form_title()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_ID()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_id_fields()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_reply_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_text($comment_ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_text_rss()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_time('d')&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;comment_type()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;confirm_delete_users()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;content_url($path)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;convert_chars($content, $deprecated)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;convert_smilies($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;count_many_users_posts($users)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;count_users($strategy)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;count_user_posts($userid)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;create_empty_blog($domain, $path, $weblog_title, $site_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;current_filter()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;current_theme_supports($feature)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;current_time($type, $gmt = 0)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;current_user_can($capability)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;current_user_can_for_blog($blog_id, $capability)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;dashboard_quota()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;date_i18n($dateformatstring, $unixtimestamp, $gmt)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;delete_blog_option($id, $key)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;delete_get_calendar_cache()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;delete_option($name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;delete_post_meta($post_id, $meta_key, $meta_value)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;delete_user_meta($user_id, $meta_key, $meta_value)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;did_action($tag)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;discover_pingback_server_uri($url, $deprecated)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;display_space_usage()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;domain_exists($domain, $path, $site_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_action($tag, $arg)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_action_ref_array($tag, $arg)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_all_pings()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_enclose($content, $post_ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_feed()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_feed_atom($for_comments)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_feed_rdf()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_feed_rss()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_feed_rss2($for_comments)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_robots()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_shortcode($content)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_shortcode_tag($m)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;do_trackbacks($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;dynamic_sidebar($index)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;edit_bookmark_link($link, $before, $after, $bookmark)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;edit_comment_link($link, $before, $after)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;edit_post_link($link, $before, $after, $id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;edit_tag_link($link, $before, $after, $tag)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;email_exists($email)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;ent2ncr($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;esc_attr($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;esc_html($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;esc_js($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;esc_textarea($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;esc_url($url, (array) $protocols = null)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;extract_from_markers($filename, $marker)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;fetch_feed($uri)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;filter_SSL($url)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;fix_import_form_size($size)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;fix_phpmailer_messageid($phpmailer)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;force_balance_tags($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;force_ssl_content($force)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;format_code_lang($code)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;format_to_edit($content, $richedit)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;format_to_post($content)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;form_option($option)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;add_cap($role, $cap, $grant)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_cap($role, $cap)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;funky_javascript_fix($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;generic_ping($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_404_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_active_blog_for_user($user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_adjacent_post($in_same_cat, $excluded_categories, $previous)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_admin_url()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_admin_users_for_domain($sitedomain, $path)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_alloptions()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_all_category_ids()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_all_page_ids()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_ancestors($object_id, $object_type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_approved_comments($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_archives_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_archive_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_attached_file($attachment_id, $unfiltered)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_attachment_link($id, $size, $permalink, $icon, $text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_attachment_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_author_feed_link($author_id, $feed)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_author_posts_url($author_id, $author_nicename)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_author_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_avatar($id_or_email, $size, $default, $alt)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blogaddress_by_domain($domain, $path)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blogaddress_by_id($blog_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blogaddress_by_name($blogname)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_bloginfo($show, $filter)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_bloginfo_rss($show)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blogs_of_user($user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blog_count($id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blog_details($blog_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blog_id_from_url($domain, $path)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blog_option($blog_id, $setting , $default)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blog_permalink($_blog_id, $post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blog_post($blog_id, $post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_blog_status($id, $pref)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_bookmark($bookmark, $output, $filter)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_bookmarks($args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_bookmark_field()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_boundary_post($in_same_cat, $excluded_categories, $start)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_calendar($initial, $echo)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_categories($args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_category($category, $output, $filter)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_category_by_path($category_path, $full_match, $output)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_category_by_slug($slug)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_category_feed_link($cat_id, $feed)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_category_link($category_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_category_parents($category, $display_link, $separator, $nice_name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_category_template|get_category_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_cat_ID($cat_name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_cat_name($cat_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_children($args, $output)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_comment($id, $output)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_comments($args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_comments_popup_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_comment_author_rss()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_comment_link($comment, $args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_comment_text($comment_ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_currentuserinfo()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_current_blog_id()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_current_site()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_current_site_name($current_site)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_current_theme()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_dashboard_blog()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_date_from_gmt($string, $format)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_date_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_day_link($year, $month, $day)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_dirsize($directory)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_edit_post_link($id, $context)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_enclosed($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_extended($post)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_footer($name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_gmt_from_date()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_header($string)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_header_image()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_header_textcolor()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_home_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_home_url()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_id_from_blogname($name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_lastcommentmodified($timezone)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_lastpostdate($timezone)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_lastpostmodified($timezone)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_last_updated($depreciated, $start, $quantity)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_locale_stylesheet_uri()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_month_link($year, $month)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_most_recent_post_of_user($user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_next_post($in_same_cat, $excluded_categories)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_num_queries()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_option($show, $default)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_page($page_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_paged_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_pages($args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_page_by_path($page_path, $output, $post_type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_page_by_title($page_title, $output, $post_type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_page_children($page_id, $pages)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_page_hierarchy($posts, $parent)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_page_link($id, $leavename, $sample)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_page_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_page_uri($page_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_permalink($id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post($post_id, $output)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_posts($args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_ancestors($post)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_comments_feed_link($post_id, $feed)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_custom($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_custom_keys($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_custom_values($key, $post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_meta($post_id, $key, $single)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_mime_type($ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_permalink()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_status($ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_thumbnail_id()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_type($post)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_type_capabilities($args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_type_labels($post_type_object)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_type_object($post_type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_post_types($args, $output, $operator)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_previous_post($in_same_cat, $excluded_categories)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_profile($field, $user)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_pung($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_query_template($type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_query_var($var)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_role($role)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_search_comments_feed_link($search_query, $feed)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_search_feed_link($search_query, $feed)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_search_form($echo)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_search_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_search_query()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_search_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_shortcode_regex()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_sidebar($name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_single_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_sitestats()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_site_allowed_themes()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_site_option($option, $default , $use_cache)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_site_url($blog_id, $path, $scheme)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_space_allowed()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_stylesheet()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_stylesheet_directory()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_stylesheet_directory_uri()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_stylesheet_uri()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_super_admins()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_tag($tag, $output, $filter)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_tags($orderby, $order, $hide_empty, $exclude, $include, $number, $offset, $fields, $slug, $hierarchical, $search, $name__like)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_tag_link($tag_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_tag_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_taxonomies($args, $output, $operator)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_taxonomy_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_template()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_template_directory()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_template_directory_uri()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_template_part($slug, $name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_term($term, $taxonomy, $output, $filter)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_terms($taxonomies, $args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_term_by($field, $value, $taxonomy, $output, $filter)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_term_children($term, $taxonomy)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_term_link($term, $taxonomy)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_theme($theme)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_themes()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_theme_data($theme_filename)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_theme_mod($name, $default)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_theme_root()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_theme_root_uri()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_author()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_author_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_category($id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_category_by_ID($cat_ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_category_rss($type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_content($more_link_text, $stripteaser, $more_file)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_date()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_excerpt($deprecated)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_ID()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_post_thumbnail($post_id, $size, $attr)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_tags($id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_tag_list($before, $sep, $after)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_terms($id, $taxonomy)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_term_list($id, $taxonomy, $before, $sep, $after)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_time($d, $post)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_title($ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_the_title_rss()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_to_ping($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_upload_space_available()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_userdata($userid)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_userdatabylogin($user_login)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_usernumposts($userid)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_users($args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_users_of_blog()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_user_count()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_user_id_from_string($string)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_user_meta($user_id, $key, $single)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_user_option($option, $user)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_weekstartend($mysqlstring, $start_of_week)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;get_year_link($year)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;global_terms($term_id, $deprecated)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;grant_super_admin($user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;has_action($tag, $function_to_check)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;has_filter($tag, $function_to_check)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;has_nav_menu($location)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;has_post_thumbnail()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;has_tag($tag)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;have_comments()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;header_image()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;header_textcolor()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;home_url($path, $scheme)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;htmlentities2($myHTML)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;human_time_diff($from, $to)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;includes_url($path)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;insert_blog($domain, $path, $site_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;insert_with_markers($filename, $marker, $insertion)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;install_blog($blog_id, $blog_title)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;install_blog_defaults($blog_id, $user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;in_category($category, $_post)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;iso8601_timezone_to_offset($timezone)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;iso8601_to_datetime($date_string, $timezone)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_404()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_admin()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_archive()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_archived()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_attachment()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_author($author)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_blog_installed()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_blog_user($blog_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_category($category)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_comments_popup()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_date()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_day()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_email($email)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_email_address_unsafe($user_email)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_feed()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_front_page()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_home()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_local_attachment($url)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_main_site($blog_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_month()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_new_day()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_page($page)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_paged()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_page_template($template)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_post_type_archive($post_types)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_post_type_hierarchical($post_type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_preview()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_search()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_serialized($data)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_serialized_string($data)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_single($post)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_singular($post_types)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_ssl()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_sticky($post_ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_subdomain_install()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_super_admin($user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_tag($slug)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_tax($taxonomy, $term)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_taxonomy_hierarchical($taxonomy)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_time()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_trackback()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_upload_space_available()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_user_logged_in()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_user_member_of_blog()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_user_option_local($key, $user_id, $blog_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_user_spammy($username)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;is_year()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;load_template($_template_file)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;locale_stylesheet()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;locate_template($template_names, $load, $require_once)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;log_app($label, $msg)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;make_clickable($ret)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;map_meta_cap($cap, $user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;maybe_add_existing_user_to_blog()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;maybe_redirect_404()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;maybe_serialize($data)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;maybe_unserialize($original)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;menu_page_url($menu_slug, $echo)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;merge_filters($tag)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;ms_cookie_constants()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;ms_deprecated_blogs_file()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;ms_file_constants()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;ms_not_installed()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;ms_site_check()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;ms_subdomain_constants()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;ms_upload_constants()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;mu_dropdown_languages($lang_files, $current)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;mysql2date($dateformatstring, $mysqlstring, $translate = true)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;newblog_notify_siteadmin($blog_id, $deprecated)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;newuser_notify_siteadmin($user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;new_user_email_admin_notice()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;next_comments_link($label, $max_page)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;next_image_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;next_posts_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;next_post_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;nocache_headers()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;page_uri_index()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;paginate_comments_links($args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;permalink_anchor()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;permalink_comments_rss()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;permalink_single_rss($file)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;pingback($content, $post_ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;pings_open($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;plugins_url($path, $plugin)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;plugin_basename($file)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;popuplinks($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;posts_nav_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;post_class()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;post_comments_feed_link($link_text, $post_id, $feed)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;post_password_required()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;post_permalink()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;post_type_archive_title($prefix, $display)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;post_type_supports($post_type, $supports)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;preview_theme()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;preview_theme_ob_filter($content)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;preview_theme_ob_filter_callback($matches)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;previous_comments_link($label)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;previous_image_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;previous_posts_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;previous_post_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;privacy_ping_filter($sites)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;recurse_dirsize($directory)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;redirect_mu_dashboard()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;redirect_this_site($deprecated)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;redirect_user_to_blog()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;refresh_blog_details($blog_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;refresh_user_details($id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;register_activation_hook($file, $function)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;register_deactivation_hook($file, $function)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;register_nav_menu($location, $description)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;register_nav_menus($locations)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;register_post_type($post_type, $args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;register_setting($option_group, $option_name, $sanitize_callback)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;register_taxonomy($taxonomy, $object_type, $args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;register_taxonomy_for_object_type($taxonomy, $object_type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;register_theme_directory($directory)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_accents($string)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_action($tag, $function_to_remove, $priority, $accepted_args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_all_actions($tag, $priority)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_all_filters($tag, $priority)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_all_shortcodes()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_filter($tag, $function_to_remove, $priority, $accepted_args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_meta_box($id, $page, $context)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_post_type_support($post_type, $supports)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_query_arg($key, $query)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_role($role)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_shortcode($tag)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_theme_mod($name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_theme_mods()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;remove_user_from_blog($user_id, $blog_id, $reassign)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;require_if_theme_supports($feature, $include)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;restore_current_blog()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;revoke_super_admin($user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;rss_enclosure()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;sanitize_comment_cookies()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;sanitize_email($email)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;sanitize_file_name($name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;sanitize_title($title, $fallback_title)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;sanitize_title_with_dashes($title)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;sanitize_user($username, $strict)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;search_theme_directories()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;secret_salt_warning()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;seems_utf8($str)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;send_confirmation_on_profile_email()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;settings_fields($option_group)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;set_current_user($id, $name)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;set_post_type($post_id, $post_type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;set_theme_mod($name, $value)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;shortcode_atts($pairs , $atts)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;shortcode_parse_atts($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;show_post_thumbnail_warning()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;signup_nonce_check($result)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;signup_nonce_fields()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;single_cat_title()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;single_month_title()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;single_post_title()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;single_tag_title()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;single_term_title()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;site_admin_notice()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;site_url($path, $scheme)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;spawn_cron($local_time)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;status_header($header)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;sticky_class()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;stripslashes_deep($value)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;strip_shortcodes($content)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;switch_theme($template, $stylesheet)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;switch_to_blog($new_blog, $validate)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;sync_category_tag_slugs($term, $taxonomy)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;tag_description()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;taxonomy_exists($taxonomy)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;term_description()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;term_exists($term, $taxonomy, $parent)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_attachment_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_author()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_author_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_author_meta()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_author_posts()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_author_posts_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_category()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_category_rss($type)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_content()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_content_rss($more_link_text, $stripteaser, $more_file, $cut, $encode_html)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_date($format, $before, $after, $echo)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_date_xml()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_excerpt()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_excerpt_rss()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_feed_link()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_ID()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_meta()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_modified_author()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_modified_date()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_modified_time()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_permalink()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_post_thumbnail()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_search_query()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_shortlink()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_tags()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_taxonomies()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_terms()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_time()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_title()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_title_attribute()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;the_title_rss()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;trackback($trackback_url, $title, $excerpt, $ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;trackback_url()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;trackback_url_list($tb_list, $post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;trailingslashit($string)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;unregister_nav_menu($location)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;unregister_setting($option_group, $option_name, $sanitize_callback)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;untrailingslashit($string)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_archived($id, $archived)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_attached_file($attachment_id, $file)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_blog_details($blog_id, $details)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_blog_option($id, $key, $value, $depreciated)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_blog_public($old_value, $value)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_blog_status($blog_id, $pref, $value, $refresh)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_option($option_name, $newvalue)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_option_new_admin_email($old_value, $value)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_posts_count($deprecated)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_post_meta($post_id, $meta_key, $meta_value, $prev_value)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_user_meta($user_id, $meta_key, $meta_value, $prev_value)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_user_option($user_id, $option_name, $newvalue, $global)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;update_user_status($id, $pref, $value, $deprecated)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;upload_is_file_too_big($upload)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;upload_is_user_over_quota($echo)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;upload_size_limit_filter($size)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;upload_space_setting($id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;url_shorten($url)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;username_exists($username)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;users_can_register_signup_filter()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;user_can($user, $capability)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;user_pass_ok($user_login, $user_pass)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;user_trailingslashit()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;utf8_uri_encode($utf8_string, $length)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;validate_current_theme()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;validate_username($username)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;walk_nav_menu_tree()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;weblog_ping($server, $path)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;welcome_user_msg_filter($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wordpressmu_wp_mail_from()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp($query_vars)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpautop($foo, $br)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_activate_signup($key)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_admin_redirect_add_updated_param()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_create_blog($domain, $path, $title, $user_id, $meta, $site_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_create_user($user_name, $password, $email)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_current_site()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_delete_blog($blog_id, $drop)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_delete_user($id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_get_blog_allowedthemes($blog_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_log_new_registrations($blog_id, $user_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_signup_blog($domain, $path, $title, $user, $user_email, $meta)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_signup_blog_notification($domain, $path, $title, $user, $user_email, $key, $meta)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_signup_user($user, $user_email, $meta)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_signup_user_notification($user, $user_email, $key, $meta)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_update_blogs_date()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_validate_blog_signup($blogname, $blog_title, $user)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_validate_user_signup($user_name, $user_email)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_welcome_notification($blog_id, $user_id, $password, $title, $meta)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wpmu_welcome_user_notification($user_id, $password, $meta)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wptexturize($text)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_ajaxurl()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_allow_comment($commentdata)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_attachment_is_image($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_category_checklist()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_check_filetype($filename, $mimes)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_check_for_changed_slugs($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_clearcookie()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_clear_scheduled_hook($hook, $args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_count_comments($post_id)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_count_posts($type, $perm)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_create_category($cat_name, $parent)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_create_nonce($action)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_create_user($username, $password, $email)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_cron()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_delete_attachment()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_delete_category($cat_ID)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_delete_comment($attachmentid, $force_delete = false)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_delete_post($postid, $force_delete)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_delete_term($term_id, $taxonomy, $args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_delete_user($id, $reassign)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_die($message, $title, $args)&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_dropdown_categories()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=&quot;wp_dropdown_users()&quot; DOCTYPES=&quot;PHP_MySQL&quot; casesensitive=&quot;true&quot; /&gt;
	&lt;function pattern=
</pre>
</div>
<br>
<p>This file provides code hinting (auto-completion) for the WordPress API in Dreamweaver's code view. There are currently 1422 functions and keywords from the WordPress API supported!</p>

<p>Grab the latest version from the repo: http://code.google.com/p/wordpress-codehints/</p>
&#13;
&#13;
					
</div>

<div class="result">
<h2 class="title">
<a href="/user/localhorst">localhorst</a>/<a href="/snippet/php/emulate-php-5-for-backwards-compatibility">emulate PHP 5 for backwards compatibility</a>
<span class="language">(<a href="/language/php/"> PHP</a>)</span>
</h2>
<div class="snippet">
<pre class="brush: php;">
&lt;?php
/**
 * api:		php
 * title:	upgrade.php
 * description:	backwards compatibility for older PHP interpreters
 * version:	14
 * license:	Public Domain
 * url:		http://freshmeat.net/p/upgradephp
 * type:	functions
 * category:	library
 * priority:	auto
 * sort:	-200
 * provides:	upgrade-php
 *
 *
 * You get PHP version independence by including() this script. It provides
 * downwards compatibility to older PHP installations by emulating missing
 * functions or constants using IDENTICAL NAMES. So this doesn't slow down
 * script execution on setups where the native functions already exist. It
 * is meant as quick drop-in solution, and to free you from rewriting or
 * cumbersome workarounds - instead of using the real &amp;amp; more powerful funcs.
 *
 * It cannot mirror PHP5s extended OO-semantics and functionality into PHP4
 * however. A few features are added here that weren't part of PHP yet. And
 * some other function collections are separated out into the ext/ directory.
 *
 * And further this is PUBLIC DOMAIN (no copyright, no license, no warranty)
 * so threrefore compatible to ALL open source licenses. You could rip this
 * paragraph out to republish this instead only under more restrictive terms
 * or your favorite license (GNU LGPL/GPL, BSDL, MPL/CDDL, Artist, PHPL, ...)
 *
 * Get update notes via &quot;http://freshmeat.net/projects/upgradephp&quot; or
 * google for it. Any contribution is appreciated. &lt;milky*usersÂ·sfÂ·net&gt;
 *
 */



/**
 *                                   ------------------------------ CVS ---
 * @group CVS
 * @since CVS
 *
 * planned, but as of yet unimplemented functions
 * - some of these might appear in 6.0 or ParrotPHP
 *
 * @emulated
 *    sys_get_temp_dir
 *
 */



/**
 * returns path of the system directory for temporary files
 *
 */
if (!function_exists(&quot;sys_get_temp_dir&quot;)) {
   function sys_get_temp_dir() {
      # check possible alternatives
      ($temp = ini_get(&quot;temp_dir&quot;))
      or
      ($temp = $_SERVER[&quot;TEMP&quot;])
      or
      ($temp = $_SERVER[&quot;TMP&quot;])
      or
      ($temp = &quot;/tmp&quot;);
      # fin
      return($temp);
   }
}





/**
 *                                   ------------------------------ 5.2 ---
 * @group 5_2
 * @since 5.2
 *
 * Additions of PHP 5.2.0
 * - some listed here, might have appeared earlier or in release candidates
 *
 * @emulated
 *    json_encode
 *    json_decode
 *    error_get_last
 *    preg_last_error
 *    lchown
 *    lchgrp
 *    E_RECOVERABLE_ERROR
 *    M_SQRTPI
 *    M_LNPI
 *    M_EULER
 *    M_SQRT3
 *
 * @missing
 *    sys_getloadavg
 *    inet_ntop
 *    inet_pton
 *    array_fill_keys
 *    array_intersect_key
 *    array_intersect_ukey
 *    array_diff_key
 *    array_diff_ukey
 *    array_product
 *    pdo_drivers
 *    ftp_ssl_connect
 *    XmlReader
 *    XmlWriter
 *    PDO*
 *
 * @unimplementable
 *    stream_*
 *
 */



/**
 * @since unknown
 */
if (!defined(&quot;E_RECOVERABLE_ERROR&quot;)) { define(&quot;E_RECOVERABLE_ERROR&quot;, 4096); }



/**
 * Converts PHP variable or array into &quot;JSON&quot; (a JavaScript value expression
 * or &quot;object notation&quot;).
 *
 * @compat
 *    output seems identical to PECL versions
 * @bugs
 *    doesn't take care with unicode too much
 *
 */
if (!function_exists(&quot;json_encode&quot;)) {
   function json_encode($var, /*emu_args*/$obj=FALSE) {

      #-- prepare JSON string
      $json = &quot;&quot;;

      #-- add array entries
      if (is_array($var) || ($obj=is_object($var))) {

         #-- check if array is associative
         if (!$obj) foreach ((array)$var as $i=&gt;$v) {
            if (!is_int($i)) {
               $obj = 1;
               break;
            }
         }

         #-- concat invidual entries
         foreach ((array)$var as $i=&gt;$v) {
            $json .= ($json ? &quot;,&quot; : &quot;&quot;)    // comma separators
                   . ($obj ? (&quot;\&quot;$i\&quot;:&quot;) : &quot;&quot;)   // assoc prefix
                   . (json_encode($v));    // value
         }

         #-- enclose into braces or brackets
         $json = $obj ? &quot;{&quot;.$json.&quot;}&quot; : &quot;[&quot;.$json.&quot;]&quot;;
      }

      #-- strings need some care
      elseif (is_string($var)) {
         if (!utf8_decode($var)) {
            $var = utf8_encode($var);
         }
         $var = str_replace(array(&quot;\&quot;&quot;, &quot;\\&quot;, &quot;/&quot;, &quot;\b&quot;, &quot;\f&quot;, &quot;\n&quot;, &quot;\r&quot;, &quot;\t&quot;), array(&quot;\\\&quot;&quot;, &quot;\\\\&quot;, &quot;\\/&quot;, &quot;\\b&quot;, &quot;\\f&quot;, &quot;\\n&quot;, &quot;\\r&quot;, &quot;\\t&quot;), $var);
         $json = '&quot;' . $var . '&quot;';
      }

      #-- basic types
      elseif (is_bool($var)) {
         $json = $var ? &quot;true&quot; : &quot;false&quot;;
      }
      elseif ($var === NULL) {
         $json = &quot;null&quot;;
      }
      elseif (is_int($var) || is_float($var)) {
         $json = &quot;$var&quot;;
      }

      #-- something went wrong
      else {
         trigger_error(&quot;json_encode: don't know what a '&quot; .gettype($var). &quot;' is.&quot;, E_USER_ERROR);
      }

      #-- done
      return($json);
   }
}



/**
 * Parses JSON (JavaScript value expression) into PHP variable
 * (array or object).
 *
 * @compat
 *    behaves similiar to PECL version
 *    but is less quiet on errors
 *    might ignore some misformed representations
 * @bugs
 *    doesn't decode unicode \uXXXX string escapes
 *
 */
if (!function_exists(&quot;json_decode&quot;)) {
   function json_decode($json, $assoc=FALSE, /*emu_args*/$n=0,$state=0,$waitfor=0) {

      #-- result var
      $val = NULL;
      static $lang_eq = array(&quot;true&quot; =&gt; TRUE, &quot;false&quot; =&gt; FALSE, &quot;null&quot; =&gt; NULL);
      static $str_eq = array(&quot;n&quot;=&gt;&quot;\012&quot;, &quot;r&quot;=&gt;&quot;\015&quot;, &quot;\\&quot;=&gt;&quot;\\&quot;, '&quot;'=&gt;'&quot;', &quot;f&quot;=&gt;&quot;\f&quot;, &quot;b&quot;=&gt;&quot;\b&quot;, &quot;t&quot;=&gt;&quot;\t&quot;, &quot;/&quot;=&gt;&quot;/&quot;);

      #-- flat char-wise parsing
      for (/*n*/; $n&lt;strlen($json); /*n*/) {
         $c = $json[$n];

         #-= in-string
         if ($state==='&quot;') {
            if ($c == '\\') {
               $c = $json[++$n];
               if (isset($str_eq[$c])) {
                  $val .= $str_eq[$c];
               }
               elseif ($c == &quot;u&quot;) {
                  $val .= &quot;\\u&quot;;
               }
               else {
                  $val .= &quot;\\&quot; . $c;
               }
            }
            elseif ($c == '&quot;') {
               $state = 0;
            }
            else {
               $val .= $c;
            }
         }

         #-&gt; end of sub-call (array/object)
         elseif ($waitfor &amp;amp;&amp;amp; (strpos($waitfor, $c) !== false)) {
            return array($val, $n);  // return current value and state
         }

         #-= in-array
         elseif ($state===']') {
            list($v, $n) = json_decode($json, 0, $n, 0, &quot;,]&quot;);
            $val[] = $v;
            if ($json[$n] == &quot;]&quot;) { return array($val, $n); }
         }

         #-= in-object
         elseif ($state==='}') {
            list($i, $n) = json_decode($json, 0, $n, 0, &quot;:&quot;);   // this allowed non-string indicies
            list($v, $n) = json_decode($json, 0, $n+1, 0, &quot;,}&quot;);
            $val[$i] = $v;
            if ($json[$n] == &quot;}&quot;) { return array($val, $n); }
         }

         #-- looking for next item (0)
         else {

            #-&gt; whitesapce
            if (preg_match(&quot;/\s/&quot;, $c)) {
               // skip
            }

            #-&gt; string begin
            elseif ($c == '&quot;') {
               $state = '&quot;';
            }

            #-&gt; object
            elseif ($c == &quot;{&quot;) {
               list($val, $n) = json_decode($json, $assoc, $n+1, '}', &quot;}&quot;);
               if ($val &amp;amp;&amp;amp; $n &amp;amp;&amp;amp; !$assoc) {
                  $obj = new stdClass();
                  foreach ($val as $i=&gt;$v) {
                     $obj-&gt;{$i} = $v;
                  }
                  $val = $obj;
                  unset($obj);
               }
            }
            #-&gt; array
            elseif ($c == &quot;[&quot;) {
               list($val, $n) = json_decode($json, $assoc, $n+1, ']', &quot;]&quot;);
            }

            #-&gt; comment
            elseif (($c == &quot;/&quot;) &amp;amp;&amp;amp; ($json[$n+1]==&quot;*&quot;)) {
               // just find end, skip over
               ($n = strpos($json, &quot;*/&quot;, $n+1)) or ($n = strlen($json));
            }

            #-&gt; numbers
            elseif (preg_match(&quot;#^(-?\d+(?:\.\d+)?)(?:[eE](-?\d+))?#&quot;, substr($json, $n), $uu)) {
               $val = $uu[1];
               $n += strlen($uu[0]) - 1;
               $val = strpos($val, &quot;.&quot;) ? (float)$val : (int)$val;
               if (isset($uu[2])) {
                  $val *= pow(10, (int)$uu[2]);
               }
            }

            #-&gt; boolean or null
            elseif (preg_match(&quot;#^(true|false|null)\b#&quot;, substr($json, $n), $uu)) {
               $val = $lang_eq[$uu[1]];
               $n += strlen($uu[1]) - 1;
            }

            #-- parsing error
            else {
               // PHPs native json_decode() breaks here usually and QUIETLY
              trigger_error(&quot;json_decode: error parsing '$c' at position $n&quot;, E_USER_WARNING);
               return $waitfor ? array(NULL, 1&lt;&lt;30) : NULL;
            }

         }//state

         #-- next char
         if ($n === NULL) { return NULL; }
         $n++;
      }//for

      #-- final result
      return ($val);
   }
}




/**
 * @stub
 * @cannot-reimplement
 *
 */
if (!function_exists(&quot;preg_last_error&quot;)) {
   if (!defined(&quot;PREG_NO_ERROR&quot;)) { define(&quot;PREG_NO_ERROR&quot;, 0); }
   if (!defined(&quot;PREG_INTERNAL_ERROR&quot;)) { define(&quot;PREG_INTERNAL_ERROR&quot;, 1); }
   if (!defined(&quot;PREG_BACKTRACK_LIMIT_ERROR&quot;)) { define(&quot;PREG_BACKTRACK_LIMIT_ERROR&quot;, 2); }
   if (!defined(&quot;PREG_RECURSION_LIMIT_ERROR&quot;)) { define(&quot;PREG_RECURSION_LIMIT_ERROR&quot;, 3); }
   if (!defined(&quot;PREG_BAD_UTF8_ERROR&quot;)) { define(&quot;PREG_BAD_UTF8_ERROR&quot;, 4); }
   function preg_last_error() {
      return PREG_NO_ERROR;
   }
}




/**
 * @stub
 *
 * Returns associative array with last error message.
 *
 */
if (!function_exists(&quot;error_get_last&quot;)) {
   function error_get_last() {
      return array(
         &quot;type&quot; =&gt; 0,
         &quot;message&quot; =&gt; $GLOBALS[php_errormsg],
         &quot;file&quot; =&gt; &quot;unknonw&quot;,
         &quot;line&quot; =&gt; 0,
      );
   }
}




/**
 * @flag quirky, exec
 *
 * Change owner/group of a symlink filename.
 *
 */
if (!function_exists(&quot;lchown&quot;)) {
   function lchown($fn, $user) {
      if (PHP_OS != &quot;Linux&quot;) {
         return false;
      }
      $user = escapeshellcmd($user);
      $fn = escapeshellcmd($fn);
      exec(&quot;chown -h '$user' '$fn'&quot;, $uu, $state);
      return($state);
   }
}
if (!function_exists(&quot;lchgrp&quot;)) {
   function lchgrp($fn, $group) {
      return lchown($fn, &quot;:$group&quot;);
   }
}














/**
 *                                   ------------------------------ 5.1 ---
 * @group 5_1
 * @since 5.1
 *
 * Additions in PHP 5.1
 * - most functions here appeared in -rc1 already
 * - and were backported to 4.4 series?
 *
 * @emulated
 *    property_exists
 *    time_sleep_until
 *    fputcsv
 *    strptime
 *    ENT_COMPAT
 *    ENT_QUOTES
 *    ENT_NOQUOTES
 *    htmlspecialchars_decode
 *    PHP_INT_SIZE
 *    PHP_INT_MAX
 *    M_SQRTPI
 *    M_LNPI
 *    M_EULER
 *    M_SQRT3
 *
 * @missing
 *    strptime
 *
 * @unimplementable
 *    ...
 *
 */



/**
 * Constants for future 64-bit integer support.
 *
 */
if (!defined(&quot;PHP_INT_SIZE&quot;)) { define(&quot;PHP_INT_SIZE&quot;, 4); }
if (!defined(&quot;PHP_INT_MAX&quot;)) { define(&quot;PHP_INT_MAX&quot;, 2147483647); }



/**
 * @flag bugfix
 * @see #33895
 *
 * Missing constants in 5.1, originally appeared in 4.0.
 */
if (!defined(&quot;M_SQRTPI&quot;)) { define(&quot;M_SQRTPI&quot;, 1.7724538509055); }
if (!defined(&quot;M_LNPI&quot;)) { define(&quot;M_LNPI&quot;, 1.1447298858494); }
if (!defined(&quot;M_EULER&quot;)) { define(&quot;M_EULER&quot;, 0.57721566490153); }
if (!defined(&quot;M_SQRT3&quot;)) { define(&quot;M_SQRT3&quot;, 1.7320508075689); }




#-- removes entities &amp;amp;lt; &amp;amp;gt; &amp;amp;amp; and &amp;amp;quot; eventually from HTML string
if (!function_exists(&quot;htmlspecialchars_decode&quot;)) {
   if (!defined(&quot;ENT_COMPAT&quot;)) { define(&quot;ENT_COMPAT&quot;, 2); }
   if (!defined(&quot;ENT_QUOTES&quot;)) { define(&quot;ENT_QUOTES&quot;, 3); }
   if (!defined(&quot;ENT_NOQUOTES&quot;)) { define(&quot;ENT_NOQUOTES&quot;, 0); }
   function htmlspecialchars_decode($string, $quotes=2) {
      $d = $quotes &amp;amp; ENT_COMPAT;
      $s = $quotes &amp;amp; ENT_QUOTES;
      return str_replace(
         array(&quot;&amp;amp;lt;&quot;, &quot;&amp;amp;gt;&quot;, ($s ? &quot;&amp;amp;quot;&quot; : &quot;&amp;amp;.-;&quot;), ($d ? &quot;&amp;amp;#039;&quot; : &quot;&amp;amp;.-;&quot;), &quot;&amp;amp;amp;&quot;),
         array(&quot;&lt;&quot;,    &quot;&gt;&quot;,    &quot;'&quot;,                      &quot;\&quot;&quot;,                     &quot;&amp;amp;&quot;),
         $string
      );
   }
}


/**
 * @flag quirky, needs5
 *
 * Checks for existence of object property, should return TRUE even for NULL values.
 *
 * @compat
 *    uses (array) conversion to test, but that might not always work
 * @bugs
 *    probably can't handle static classes well
 */
# doesn't return true for NULL values, can't handle public/private
if (!function_exists(&quot;property_exists&quot;)) {
   function property_exists($obj, $prop) {
      if (!is_object($obj) &amp;amp;&amp;amp; class_exists($obj)) {
         $obj = new $obj();
      }
      if (is_object($obj)) {
         return isset($obj-&gt;{$prop}) || in_array($prop, array_keys((array)$obj));
      }
   }
}


#-- halt execution, until given timestamp
// I wonder who always comes up with such useless function ideas
if (!function_exists(&quot;time_sleep_until&quot;)) {
   function time_sleep_until($t) {
      $delay = $t - time();
      if ($delay &lt; 0) {
         trigger_error(&quot;time_sleep_until: timestamp in the past&quot;, E_USER_WARNING);
         return false;
      }
      else {
         sleep((int)$delay);
         usleep(($delay - floor($delay)) * 1000000);
         return true;
      }
   }
}



/**
 * @untested
 *
 * Writes an array as CSV text line into opened filehandle.
 *
 */
if (!function_exists(&quot;fputcsv&quot;)) {
   function fputcsv($fp, $fields, $delim=&quot;,&quot;, $encl='&quot;') {
      $line = &quot;&quot;;
      foreach ((array)$fields as $str) {
         $line .= ($line ? $delim : &quot;&quot;)
                . $encl
                . str_replace(array('\\', $encl), array('\\\\'. '\\'.$encl), $str)
                . $encl;
      }
      fwrite($fp, $line.&quot;\n&quot;);
   }
}



/**
 * @stub
 * @untested
 * @flag basic
 *
 * @compat
 *    only implements a few basic regular expression lookups
 *    no idea how to handle all of it
 */
if (!function_exists(&quot;strptime&quot;)) {
   function strptime($str, $format) {
      static $expand = array(
         &quot;%D&quot; =&gt; &quot;%m/%d/%y&quot;,
         &quot;%T&quot; =&gt; &quot;%H:%M:%S&quot;,
      );
      static $map_r = array(
          &quot;%S&quot;=&gt;&quot;tm_sec&quot;,
          &quot;%M&quot;=&gt;&quot;tm_min&quot;,
          &quot;%H&quot;=&gt;&quot;tm_hour&quot;,
          &quot;%d&quot;=&gt;&quot;tm_mday&quot;,
          &quot;%m&quot;=&gt;&quot;tm_mon&quot;,
          &quot;%Y&quot;=&gt;&quot;tm_year&quot;,
          &quot;%y&quot;=&gt;&quot;tm_year&quot;,
          &quot;%W&quot;=&gt;&quot;tm_wday&quot;,
          &quot;%D&quot;=&gt;&quot;tm_yday&quot;,
          &quot;%u&quot;=&gt;&quot;unparsed&quot;,
      );
      static $names = array(
         &quot;Jan&quot; =&gt; 1, &quot;Feb&quot; =&gt; 2, &quot;Mar&quot; =&gt; 3, &quot;Apr&quot; =&gt; 4, &quot;May&quot; =&gt; 5, &quot;Jun&quot; =&gt; 6,
         &quot;Jul&quot; =&gt; 7, &quot;Aug&quot; =&gt; 8, &quot;Sep&quot; =&gt; 9, &quot;Oct&quot; =&gt; 10, &quot;Nov&quot; =&gt; 11, &quot;Dec&quot; =&gt; 12,
         &quot;Sun&quot; =&gt; 0, &quot;Mon&quot; =&gt; 1, &quot;Tue&quot; =&gt; 2, &quot;Wed&quot; =&gt; 3, &quot;Thu&quot; =&gt; 4, &quot;Fri&quot; =&gt; 5, &quot;Sat&quot; =&gt; 6,
      );

      #-- transform $format into extraction regex
      $format = str_replace(array_keys($expand), array_values($expand), $format);
      $preg = preg_replace(&quot;/(%\w)/&quot;, &quot;(\w+)&quot;, preg_quote($format));

      #-- record the positions of all STRFCMD-placeholders
      preg_match_all(&quot;/(%\w)/&quot;, $format, $positions);
      $positions = $positions[1];

      #-- get individual values
      if (preg_match(&quot;#$preg#&quot;, &quot;$str&quot;, $extracted)) {

         #-- get values
         foreach ($positions as $pos=&gt;$strfc) {
            $v = $extracted[$pos + 1];

            #-- add
            if ($n = $map_r[$strfc]) {
               $vals[$n] = ($v &gt; 0) ? (int)$v : $v;
            }
            else {
               $vals[&quot;unparsed&quot;] .= $v . &quot; &quot;;
            }
         }

         #-- fixup some entries
         $vals[&quot;tm_wday&quot;] = $names[ substr($vals[&quot;tm_wday&quot;], 0, 3) ];
         if ($vals[&quot;tm_year&quot;] &gt;= 1900) {
            $tm_year -= 1900;
         }
         elseif ($vals[&quot;tm_year&quot;] &gt; 0) {
            $vals[&quot;tm_year&quot;] += 100;
         }
         if ($vals[&quot;tm_mon&quot;]) {
            $vals[&quot;tm_mon&quot;] -= 1;
         }
         else {
            $vals[&quot;tm_mon&quot;] = $names[ substr($vals[&quot;tm_mon&quot;], 0, 3) ] - 1;
         }

         #-- calculate wday
         // ... (mktime)
      }
      return isset($vals) ? $vals : false;
   }
}










/**
 *                                   --------------------------- FUTURE ---
 * @group FUTURE
 * @since unknown
 *
 * Following functions aren't implemented in current PHP versions allthough
 * they are logical and required counterparts to existing features or exist
 * in the according external library.
 *
 * @emulated
 *    gzdecode
 *    ob_get_headers
 *    xmlentities
 *
 * @missing
 *    ...
 *
 * @unimplementable
 *    ...
 *
 */





#-- inflates a string enriched with gzip headers
#   (this is the logical counterpart to gzencode(), but don't tell anyone!)
if (!function_exists(&quot;gzdecode&quot;)) {
   function gzdecode($data, $maxlen=NULL) {

      #-- decode header
      $len = strlen($data);
      if ($len &lt; 20) {
         return;
      }
      $head = substr($data, 0, 10);
      $head = unpack(&quot;n1id/C1cm/C1flg/V1mtime/C1xfl/C1os&quot;, $head);
      list($ID, $CM, $FLG, $MTIME, $XFL, $OS) = array_values($head);
      $FTEXT = 1&lt;&lt;0;
      $FHCRC = 1&lt;&lt;1;
      $FEXTRA = 1&lt;&lt;2;
      $FNAME = 1&lt;&lt;3;
      $FCOMMENT = 1&lt;&lt;4;
      $head = unpack(&quot;V1crc/V1isize&quot;, substr($data, $len-8, 8));
      list($CRC32, $ISIZE) = array_values($head);

      #-- check gzip stream identifier
      if ($ID != 0x1f8b) {
         trigger_error(&quot;gzdecode: not in gzip format&quot;, E_USER_WARNING);
         return;
      }
      #-- check for deflate algorithm
      if ($CM != 8) {
         trigger_error(&quot;gzdecode: cannot decode anything but deflated streams&quot;, E_USER_WARNING);
         return;
      }

      #-- start of data, skip bonus fields
      $s = 10;
      if ($FLG &amp;amp; $FEXTRA) {
         $s += $XFL;
      }
      if ($FLG &amp;amp; $FNAME) {
         $s = strpos($data, &quot;\000&quot;, $s) + 1;
      }
      if ($FLG &amp;amp; $FCOMMENT) {
         $s = strpos($data, &quot;\000&quot;, $s) + 1;
      }
      if ($FLG &amp;amp; $FHCRC) {
         $s += 2;  // cannot check
      }

      #-- get data, uncompress
      $data = substr($data, $s, $len-$s);
      if ($maxlen) {
         $data = gzinflate($data, $maxlen);
         return($data);  // no checks(?!)
      }
      else {
         $data = gzinflate($data);
      }

      #-- check+fin
      $chk = crc32($data);
      if ($CRC32 != $chk) {
         trigger_error(&quot;gzdecode: checksum failed (real$chk != comp$CRC32)&quot;, E_USER_WARNING);
      }
      elseif ($ISIZE != strlen($data)) {
         trigger_error(&quot;gzdecode: stream size mismatch&quot;, E_USER_WARNING);
      }
      else {
         return($data);
      }
   }
}


#-- get all already made headers(),
#   CANNOT be emulated, because output buffering functions
#   already swallow up any sent http header
if (!function_exists(&quot;ob_get_headers&quot;)) {
   function ob_get_headers() {
      return (array)NULL;
   }
}


#-- encodes required named XML entities, like htmlentities(),
#   but does not re-encode numeric &amp;amp;#xxxx; character references
#   - could screw up scripts which then implement this themselves
#   - doesn't fix bogus or invalid numeric entities
if (!function_exists(&quot;xmlentities&quot;)) {
   function xmlentities($str) {
      return strtr($str, array(
        &quot;&amp;amp;#&quot;=&gt;&quot;&amp;amp;#&quot;, &quot;&amp;amp;&quot;=&gt;&quot;&amp;amp;amp;&quot;, &quot;'&quot;=&gt;&quot;&amp;amp;apos;&quot;,
        &quot;&lt;&quot;=&gt;&quot;&amp;amp;lt;&quot;, &quot;&gt;&quot;=&gt;&quot;&amp;amp;gt;&quot;, &quot;\&quot;&quot;=&gt;&quot;&amp;amp;quot;&quot;,
      ));
   }
}





/**
 *                                   ------------------------------ 5.0 ---
 * @group 5_0
 * @since 5.0
 *
 * PHP 5.0 introduces the Zend Engine 2 with new object-orientation features
 * which cannot be reimplemented/defined for PHP4. The additional procedures
 * and functions however can.
 *
 * @emulated
 *    stripos
 *    strripos
 *    str_ireplace
 *    get_headers
 *    headers_list
 *    fprintf
 *    vfprintf
 *    str_split
 *    http_build_query
 *    convert_uuencode
 *    convert_uudecode
 *    scandir
 *    idate
 *    time_nanosleep
 *    strpbrk
 *    get_declared_interfaces
 *    array_combine
 *    array_walk_recursive
 *    substr_compare
 *    spl_classes
 *    class_parents
 *    session_commit
 *    dns_check_record
 *    dns_get_mx
 *    setrawcookie
 *    file_put_contents
 *    COUNT_NORMAL
 *    COUNT_RECURSIVE
 *    count_recursive
 *    FILE_USE_INCLUDE_PATH
 *    FILE_IGNORE_NEW_LINES
 *    FILE_SKIP_EMPTY_LINES
 *    FILE_APPEND
 *    FILE_NO_DEFAULT_CONTEXT
 *    E_STRICT
 *
 * @missing
 *    proc_nice
 *    dns_get_record
 *    date_sunrise - undoc.
 *    date_sunset - undoc.
 *    PHP_CONFIG_FILE_SCAN_DIR
 *
 * @unimplementable
 *    set_exception_handler
 *    restore_exception_handler
 *    debug_print_backtrace
 *    class_implements
 *    proc_terminate
 *    proc_get_status
 *
 */



#-- constant: end of line
if (!defined(&quot;PHP_EOL&quot;)) { define(&quot;PHP_EOL&quot;, ( (DIRECTORY_SEPARATOR == &quot;\\&quot;) ? &quot;\015\012&quot; : (strncmp(PHP_OS, &quot;D&quot;, 1) ? &quot;\012&quot; : &quot;\015&quot;) )  ); } # &quot;D&quot; for Darwin


#-- case-insensitive string search function,
#   - finds position of first occourence of a string c-i
#   - parameters identical to strpos()
if (!function_exists(&quot;stripos&quot;)) {
   function stripos($haystack, $needle, $offset=NULL) {

      #-- simply lowercase args
      $haystack = strtolower($haystack);
      $needle = strtolower($needle);

      #-- search
      $pos = strpos($haystack, $needle, $offset);
      return($pos);
   }
}


#-- case-insensitive string search function
#   - but this one starts from the end of string (right to left)
#   - offset can be negative or positive
if (!function_exists(&quot;strripos&quot;)) {
   function strripos($haystack, $needle, $offset=NULL) {

      #-- lowercase incoming strings
      $haystack = strtolower($haystack);
      $needle = strtolower($needle);

      #-- [-]$offset tells to ignore a few string bytes,
      #   we simply cut a bit from the right
      if (isset($offset) &amp;amp;&amp;amp; ($offset &lt; 0)) {
         $haystack = substr($haystack, 0, strlen($haystack) - 1);
      }

      #-- let PHP do it
      $pos = strrpos($haystack, $needle);

      #-- [+]$offset =&gt; ignore left haystack bytes
      if (isset($offset) &amp;amp;&amp;amp; ($offset &gt; 0) &amp;amp;&amp;amp; ($pos &gt; $offset)) {
         $pos = false;
      }

      #-- result
      return($pos);
   }
}


#-- case-insensitive version of str_replace
if (!function_exists(&quot;str_ireplace&quot;)) {
   function str_ireplace($search, $replace, $subject, $count=NULL) {

      #-- call ourselves recursively, if parameters are arrays/lists
      if (is_array($search)) {
         $replace = array_values($replace);
         foreach (array_values($search) as $i=&gt;$srch) {
            $subject = str_ireplace($srch, $replace[$i], $subject);
         }
      }

      #-- sluice replacement strings through the Perl-regex module
      #   (faster than doing it by hand)
      else {
         $replace = addcslashes($replace, &quot;$\\&quot;);
         $search = &quot;{&quot; . preg_quote($search) . &quot;}i&quot;;
         $subject = preg_replace($search, $replace, $subject);
      }

      #-- result
      return($subject);
   }
}


#-- performs a http HEAD request
if (!function_exists(&quot;get_headers&quot;)) {
   function get_headers($url, $parse=0) {

      #-- extract URL parts ($host, $port, $path, ...)
      $c = parse_url($url);
      extract($c);
      if (!isset($port)) {
         $port = 80;
      }

      #-- try to open TCP connection
      $f = fsockopen($host, $port, $errno, $errstr, $timeout=15);
      if (!$f) {
         return;
      }

      #-- send request header
      socket_set_blocking($f, true);
      fwrite($f, &quot;HEAD $path HTTP/1.0\015\012&quot;
               . &quot;Host: $host\015\012&quot;
               . &quot;Connection: close\015\012&quot;
               . &quot;Accept: */*, xml/*\015\012&quot;
               . &quot;User-Agent: &quot;.trim(ini_get(&quot;user_agent&quot;)).&quot;\015\012&quot;
               . &quot;\015\012&quot;);

      #-- read incoming lines
      $ls = array();
      while ( !feof($f) &amp;amp;&amp;amp; ($line = trim(fgets($f, 1&lt;&lt;16))) ) {

         #-- read header names to make result an hash (names in array index)
         if ($parse) {
            if ($l = strpos($line, &quot;:&quot;)) {
               $name = substr($line, 0, $l);
               $value = trim(substr($line, $l + 1));
               #-- merge headers
               if (isset($ls[$name])) {
                  $ls[$name] .= &quot;, $value&quot;;
               }
               else {
                  $ls[$name] = $value;
               }
            }
            #-- HTTP response status header as result[0]
            else {
               $ls[] = $line;
            }
         }

         #-- unparsed header list (numeric indices)
         else {
            $ls[] = $line;
         }
      }

      #-- close TCP connection and give result
      fclose($f);
      return($ls);
   }
}


#-- list of already/potentially sent HTTP responsee headers(),
#   CANNOT be implemented (except for Apache module maybe)
if (!function_exists(&quot;headers_list&quot;)) {
   function headers_list() {
      trigger_error(&quot;headers_list(): not supported by this PHP version&quot;, E_USER_WARNING);
      return (array)NULL;
   }
}


#-- write formatted string to stream/file,
#   arbitrary numer of arguments
if (!function_exists(&quot;fprintf&quot;)) {
   function fprintf(/*...*/) {
      $args = func_get_args();
      $stream = array_shift($args);
      return fwrite($stream, call_user_func_array(&quot;sprintf&quot;, $args));
   }
}


#-- write formatted string to stream, args array
if (!function_exists(&quot;vfprintf&quot;)) {
   function vfprintf($stream, $format, $args=NULL) {
      return fwrite($stream, vsprintf($format, $args));
   }
}


#-- splits a string in evenly sized chunks
#   and returns this as array
if (!function_exists(&quot;str_split&quot;)) {
   function str_split($str, $chunk=1) {
      $r = array();

      #-- return back as one chunk completely, if size chosen too low
      if ($chunk &lt; 1) {
         $r[] = $str;
      }

      #-- add substrings to result array until subject strings end reached
      else {
         $len = strlen($str);
         for ($n=0; $n&lt;$len; $n+=$chunk) {
            $r[] = substr($str, $n, $chunk);
         }
      }
      return($r);
   }
}


#-- constructs a QUERY_STRING (application/x-www-form-urlencoded format, non-raw)
#   from a nested array/hash with name=&gt;value pairs
#   - only first two args are part of the original API - rest used for recursion
if (!function_exists(&quot;http_build_query&quot;)) {
   function http_build_query($data, $int_prefix=&quot;&quot;, $subarray_pfix=&quot;&quot;, $level=0) {

      #-- empty starting string
      $s = &quot;&quot;;
      ($SEP = ini_get(&quot;arg_separator.output&quot;)) or ($SEP = &quot;&amp;amp;&quot;);

      #-- traverse hash/array/list entries
      foreach ($data as $index=&gt;$value) {

         #-- add sub_prefix for subarrays (happens for recursed innovocation)
         if ($subarray_pfix) {
            if ($level) {
               $index = &quot;[&quot; . $index . &quot;]&quot;;
            }
            $index =  $subarray_pfix . $index;
         }
         #-- add user-specified prefix for integer-indices
         elseif (is_int($index) &amp;amp;&amp;amp; strlen($int_prefix)) {
            $index = $int_prefix . $index;
         }

         #-- recurse for sub-arrays
         if (is_array($value)) {
            $s .= http_build_query($value, &quot;&quot;, $index, $level + 1);
         }
         else {   // or just literal URL parameter
            $s .= $SEP . $index . &quot;=&quot; . urlencode($value);
         }
      }

      #-- remove redundant &quot;&amp;amp;&quot; from first round (-not checked above to simplifiy loop)
      if (!$subarray_pfix) {
         $s = substr($s, strlen($SEP));
      }

      #-- return result / to previous array level and iteration
      return($s);
   }
}


#-- transform into 3to4 uuencode
#   - this is the bare encoding, not the uu file format
if (!function_exists(&quot;convert_uuencode&quot;)) {
   function convert_uuencode($data) {

      #-- init vars
      $out = &quot;&quot;;
      $line = &quot;&quot;;
      $len = strlen($data);
#      $data .= &quot;\252\252\252&quot;;   // PHP and uuencode(1) use some special garbage??, looks like &quot;\000&quot;* and &quot;`\n`&quot; simply appended

      #-- canvass source string
      for ($n=0; $n&lt;$len; ) {

         #-- make 24-bit integer from first three bytes
         $x = (ord($data[$n++]) &lt;&lt; 16)
            + (ord($data[$n++]) &lt;&lt;  8)
            + (ord($data[$n++]) &lt;&lt;  0);

         #-- disperse that into 4 ascii characters
         $line .= chr( 32 + (($x &gt;&gt; 18) &amp;amp; 0x3f) )
                . chr( 32 + (($x &gt;&gt; 12) &amp;amp; 0x3f) )
                . chr( 32 + (($x &gt;&gt;  6) &amp;amp; 0x3f) )
                . chr( 32 + (($x &gt;&gt;  0) &amp;amp; 0x3f) );

         #-- cut lines, inject count prefix before each
         if (($n % 45) == 0) {
            $out .= chr(32 + 45) . &quot;$line\n&quot;;
            $line = &quot;&quot;;
         }
      }

      #-- throw last line, +length prefix
      if ($trail = ($len % 45)) {
         $out .= chr(32 + $trail) . &quot;$line\n&quot;;
      }

      // uuencode(5) doesn't tell so, but spaces are replaced with the ` char in most implementations
      $out = strtr(&quot;$out \n&quot;, &quot; &quot;, &quot;`&quot;);
      return($out);
   }
}


#-- decodes uuencoded() data again
if (!function_exists(&quot;convert_uudecode&quot;)) {
   function convert_uudecode($data) {

      #-- prepare
      $out = &quot;&quot;;
      $data = strtr($data, &quot;`&quot;, &quot; &quot;);

      #-- go through lines
      foreach(explode(&quot;\n&quot;, ltrim($data)) as $line) {
         if (!strlen($line)) {
            break;  // end reached
         }

         #-- current line length prefix
         unset($num);
         $num = ord($line{0}) - 32;
         if (($num &lt;= 0) || ($num &gt; 62)) {  // 62 is the maximum line length
            break;          // according to uuencode(5), so we stop here too
         }
         $line = substr($line, 1);

         #-- prepare to decode 4-char chunks
         $add = &quot;&quot;;
         for ($n=0; strlen($add)&lt;$num; ) {

            #-- merge 24 bit integer from the 4 ascii characters (6 bit each)
            $x = ((ord($line[$n++]) - 32) &lt;&lt; 18)
               + ((ord($line[$n++]) - 32) &lt;&lt; 12)  // were saner with &quot;&amp;amp; 0x3f&quot;
               + ((ord($line[$n++]) - 32) &lt;&lt;  6)
               + ((ord($line[$n++]) - 32) &lt;&lt;  0);

            #-- reconstruct the 3 original data chars
            $add .= chr( ($x &gt;&gt; 16) &amp;amp; 0xff )
                  . chr( ($x &gt;&gt;  8) &amp;amp; 0xff )
                  . chr( ($x &gt;&gt;  0) &amp;amp; 0xff );
         }

         #-- cut any trailing garbage (last two decoded chars may be wrong)
         $out .= substr($add, 0, $num);
         $line = &quot;&quot;;
      }

      return($out);
   }
}


#-- return array of filenames in a given directory
#   (only works for local files)
if (!function_exists(&quot;scandir&quot;)) {
   function scandir($dirname, $desc=0) {

      #-- check for file:// protocol, others aren't handled
      if (strpos($dirname, &quot;file://&quot;) === 0) {
         $dirname = substr($dirname, 7);
         if (strpos($dirname, &quot;localh&quot;) === 0) {
            $dirname = substr($dirname, strpos($dirname, &quot;/&quot;));
         }
      }

      #-- directory reading handle
      if ($dh = opendir($dirname)) {
         $ls = array();
         while ($fn = readdir($dh)) {
            $ls[] = $fn;  // add to array
         }
         closedir($dh);

         #-- sort filenames
         if ($desc) {
            rsort($ls);
         }
         else {
            sort($ls);
         }
         return $ls;
      }

      #-- failure
      return false;
   }
}


#-- like date(), but returns an integer for given one-letter format parameter
if (!function_exists(&quot;idate&quot;)) {
   function idate($formatchar, $timestamp=NULL) {

      #-- reject non-simple type parameters
      if (strlen($formatchar) != 1) {
         return false;
      }

      #-- get current time, if not given
      if (!isset($timestamp)) {
         $timestamp = time();
      }

      #-- get and turn into integer
      $str = date($formatchar, $timestamp);
      return (int)$str;
   }
}



#-- combined sleep() and usleep()
if (!function_exists(&quot;time_nanosleep&quot;)) {
   function time_nanosleep($sec, $nano) {
      sleep($sec);
      usleep($nano);
   }
}



#-- search first occourence of any of the given chars, returns rest of haystack
#   (char_list must be a string for compatibility with the real PHP func)
if (!function_exists(&quot;strpbrk&quot;)) {
   function strpbrk($haystack, $char_list) {

      #-- prepare
      $len = strlen($char_list);
      $min = strlen($haystack);

      #-- check with every symbol from $char_list
      for ($n = 0; $n &lt; $len; $n++) {
         $l = strpos($haystack, $char_list{$n});

         #-- get left-most occourence
         if (($l !== false) &amp;amp;&amp;amp; ($l &lt; $min)) {
            $min = $l;
         }
      }

      #-- result
      if ($min) {
         return(substr($haystack, $min));
      }
      else {
         return(false);
      }
   }
}



#-- logo image activation URL query strings (gaga feature)
if (!function_exists(&quot;php_real_logo_guid&quot;)) {
   function php_real_logo_guid() { return php_logo_guid(); }
   function php_egg_logo_guid() { return zend_logo_guid(); }
}


#-- no need to implement this
#   (there aren't interfaces in PHP4 anyhow)
if (!function_exists(&quot;get_declared_interfaces&quot;)) {
   function get_declared_interfaces() {
      trigger_error(&quot;get_declared_interfaces(): Current script won't run reliably with PHP4.&quot;, E_USER_WARNING);
      return( (array)NULL );
   }
}


#-- creates an array from lists of $keys and $values
#   (both should have same number of entries)
if (!function_exists(&quot;array_combine&quot;)) {
   function array_combine($keys, $values) {

      #-- convert input arrays into lists
      $keys = array_values($keys);
      $values = array_values($values);
      $r = array();

      #-- one from each
      foreach ($values as $i=&gt;$val) {
         if ($key = $keys[$i]) {
            $r[$key] = $val;
         }
         else {
            $r[] = $val;   // useless, PHP would have long aborted here
         }
      }
      return($r);
   }
}


#-- apply userfunction to each array element (descending recursively)
#   use it like:  array_walk_recursive($_POST, &quot;stripslashes&quot;);
#   - $callback can be static function name or object/method, class/method
if (!function_exists(&quot;array_walk_recursive&quot;)) {
   function array_walk_recursive(&amp;amp;$input, $callback, $userdata=NULL) {
      #-- each entry
      foreach ($input as $key=&gt;$value) {

         #-- recurse for sub-arrays
         if (is_array($value)) {
            array_walk_recursive($input[$key], $callback, $userdata);
         }

         #-- $callback handles scalars
         else {
            call_user_func_array($callback, array(&amp;amp;$input[$key], $key, $userdata) );
         }
      }

      // no return value
   }
}


#-- complicated wrapper around substr() and and strncmp()
if (!function_exists(&quot;substr_compare&quot;)) {
   function substr_compare($haystack, $needle, $offset=0, $len=0, $ci=0) {

      #-- check params
      if ($len &lt;= 0) {   // not well documented
         $len = strlen($needle);
         if (!$len) { return(0); }
      }
      #-- length exception
      if ($len + $offset &gt;= strlen($haystack)) {
         trigger_error(&quot;substr_compare: given length exceeds main_str&quot;, E_USER_WARNING);
         return(false);
      }

      #-- cut
      if ($offset) {
         $haystack = substr($haystack, $offset, $len);
      }
      #-- case-insensitivity
      if ($ci) {
         $haystack = strtolower($haystack);
         $needle = strtolower($needle);
      }

      #-- do
      return(strncmp($haystack, $needle, $len));
   }
}


#-- stub, returns empty list as usual;
#   you must load &quot;ext/spl.php&quot; beforehand to get this
if (!function_exists(&quot;spl_classes&quot;)) {
   function spl_classes() {
      trigger_error(&quot;spl_classes(): not built into this PHP version&quot;);
      return (array)NULL;
   }
}



#-- gets you list of class names the given objects class was derived from, slow
if (!function_exists(&quot;class_parents&quot;)) {
   function class_parents($obj) {

      #-- first get full list
      $all = get_declared_classes();
      $r = array();

      #-- filter out
      foreach ($all as $potential_parent) {
         if (is_subclass_of($obj, $potential_parent)) {
            $r[$potential_parent] = $potential_parent;
         }
      }
      return($r);
   }
}


#-- an alias
if (!function_exists(&quot;session_commit&quot;) &amp;amp;&amp;amp; function_exists(&quot;session_write_close&quot;)) {
   function session_commit() {
      // simple
      session_write_close();
   }
}


#-- aliases
if (!function_exists(&quot;dns_check_record&quot;)) {
   function dns_check_record($host, $type=NULL) {
      // synonym to
      return checkdnsrr($host, $type);
   }
}
if (!function_exists(&quot;dns_get_mx&quot;)) {
   function dns_get_mx($host, $mx) {
      $args = func_get_args();
      // simple alias - except the optional, but referenced third parameter
      if ($args[2]) {
         $w = &amp;amp; $args[2];
      }
      else {
         $w = false;
      }
      return getmxrr($host, $mx, $w);
   }
}


#-- setrawcookie(),
#   can this be emulated 100% exactly?
if (!function_exists(&quot;setrawcookie&quot;)) {
   // we output everything directly as HTTP header(), PHP doesn't seem
   // to manage an internal cookie list anyhow
   function setrawcookie($name, $value=NULL, $expire=NULL, $path=NULL, $domain=NULL, $secure=0) {
      if (isset($value) &amp;amp;&amp;amp; strpbrk($value, &quot;,; \r\t\n\f\014\013&quot;)) {
         trigger_error(&quot;setrawcookie: value may not contain any of ',; 
' and some other control chars; thrown away&quot;, E_USER_WARNING);
      }
      else {
         $h = &quot;Set-Cookie: $name=$value&quot;
            . ($expire ? &quot;; expires=&quot; . gmstrftime(&quot;%a, %d-%b-%y %H:%M:%S %Z&quot;, $expire) : &quot;&quot;)
            . ($path ? &quot;; path=$path&quot;: &quot;&quot;)
            . ($domain ? &quot;; domain=$domain&quot; : &quot;&quot;)
            . ($secure ? &quot;; secure&quot; : &quot;&quot;);
         header($h);
      }
   }
}


#-- write-at-once file access (counterpart to file_get_contents)
if (!function_exists(&quot;file_put_contents&quot;)) {
   function file_put_contents($filename, $data, $flags=0, $resource=NULL) {

      #-- prepare
      $mode = ($flags &amp;amp; FILE_APPEND ? &quot;a&quot; : &quot;w&quot; ) .&quot;b&quot;;
      $incl = $flags &amp;amp; FILE_USE_INCLUDE_PATH;
      $length = strlen($data);

      #-- open for writing
      $f = fopen($filename, $mode, $incl);
      if ($f) {
         $written = fwrite($f, $data);
         fclose($f);

         #-- only report success, if completely saved
         return($length == $written);
      }
   }
}


#-- file-related constants
if (!defined(&quot;FILE_USE_INCLUDE_PATH&quot;)) { define(&quot;FILE_USE_INCLUDE_PATH&quot;, 1); }
if (!defined(&quot;FILE_IGNORE_NEW_LINES&quot;)) { define(&quot;FILE_IGNORE_NEW_LINES&quot;, 2); }
if (!defined(&quot;FILE_SKIP_EMPTY_LINES&quot;)) { define(&quot;FILE_SKIP_EMPTY_LINES&quot;, 4); }
if (!defined(&quot;FILE_APPEND&quot;)) { define(&quot;FILE_APPEND&quot;, 8); }
if (!defined(&quot;FILE_NO_DEFAULT_CONTEXT&quot;)) { define(&quot;FILE_NO_DEFAULT_CONTEXT&quot;, 16); }


#-- more new constants for 5.0
if (!defined(&quot;E_STRICT&quot;)) { define(&quot;E_STRICT&quot;, 2048); }  // _STRICT is a special case of _NOTICE (_DEBUG)
# PHP_CONFIG_FILE_SCAN_DIR


#-- array count_recursive()
if (!defined(&quot;COUNT_NORMAL&quot;)) { define(&quot;COUNT_NORMAL&quot;, 0); }      // count($array, 0);
if (!defined(&quot;COUNT_RECURSIVE&quot;)) { define(&quot;COUNT_RECURSIVE&quot;, 1); }    // not supported


#-- we introduce a new function, because we cannot emulate the
#   newly introduced second parameter to count()
if (!function_exists(&quot;count_recursive&quot;)) {
   function count_recursive($array, $mode=1) {
      if (!$mode) {
         return(count($array));
      }
      else {
         $c = count($array);
         foreach ($array as $sub) {
            if (is_array($sub)) {
               $c += count_recursive($sub);
            }
         }
         return($c);
      }
   }
}





/**
 *                                   ------------------------------ 4.4 ---
 * @group 4_4
 * @since 4.4
 *
 * PHP 4.4 is a bugfix and backporting version created after PHP 5. It went
 * mostly unchanged, but changes a few language semantics (e.g. references).
 *
 * @emulated
 *    PHP_INT_SIZE
 *    PHP_INT_MAX
 *    SORT_LOCALE_STRING
 *
 */

if (!defined(&quot;PHP_INT_SIZE&quot;)) { define(&quot;PHP_INT_SIZE&quot;, 4); }
if (!defined(&quot;PHP_INT_MAX&quot;)) { define(&quot;PHP_INT_MAX&quot;, 2147483647); }
if (!defined(&quot;SORT_LOCALE_STRING&quot;)) { define(&quot;SORT_LOCALE_STRING&quot;, 5); }






/**
 *                                   ------------------------------ 4.3 ---
 * @group 4_3
 * @since 4.3
 *
 *  Additions in 4.3 version of PHP interpreter.
 *
 * @emulated
 *    file_get_contents
 *    array_key_exists
 *    array_intersect_assoc
 *    array_diff_assoc
 *    html_entity_decode
 *    str_word_count
 *    str_shuffle
 *    get_include_path
 *    set_include_path
 *    restore_include_path
 *    fnmatch
 *    FNM_PATHNAME
 *    FNM_NOESCAPE
 *    FNM_PERIOD
 *    FNM_LEADING_DIR
 *    FNM_CASEFOLD
 *    FNM_EXTMATCH
 *    glob
 *    GLOB_MARK
 *    GLOB_NOSORT
 *    GLOB_NOCHECK
 *    GLOB_NOESCAPE
 *    GLOB_BRACE
 *    GLOB_ONLYDIR
 *    GLOB_NOCASE
 *    GLOB_DOTS
 *    __FUNCTION__
 *    PATH_SEPARATOR
 *    PHP_SHLIB_SUFFIX
 *    PHP_SAPI
 *    PHP_PREFIX
 *
 * @missing
 *    sha1_file
 *    sha1 - too much code, and has been reimplemented elsewhere
 *
 * @unimplementable
 *    money_format
 *
 */


#-- simplified file read-at-once function
if (!function_exists(&quot;file_get_contents&quot;)) {
   function file_get_contents($filename, $use_include_path=1) {

      #-- open file, let fopen() report error
      $f = fopen($filename, &quot;rb&quot;, $use_include_path);
      if (!$f) { return; }

      #-- read max 2MB
      $content = fread($f, 1&lt;&lt;21);
      fclose($f);
      return($content);
   }
}



#-- shell-like filename matching (* and ? globbing characters)
if (!function_exists(&quot;fnmatch&quot;)) {

   #-- associated constants
   if (!defined(&quot;FNM_PATHNAME&quot;)) { define(&quot;FNM_PATHNAME&quot;, 1&lt;&lt;0); }  // no wildcard ever matches a &quot;/&quot;
   if (!defined(&quot;FNM_NOESCAPE&quot;)) { define(&quot;FNM_NOESCAPE&quot;, 1&lt;&lt;1); }  // backslash can't escape meta chars
   if (!defined(&quot;FNM_PERIOD&quot;)) { define(&quot;FNM_PERIOD&quot;,   1&lt;&lt;2); }  // leading dot must be given explicit
   if (!defined(&quot;FNM_LEADING_DIR&quot;)) { define(&quot;FNM_LEADING_DIR&quot;, 1&lt;&lt;3); }  // not in PHP
   if (!defined(&quot;FNM_CASEFOLD&quot;)) { define(&quot;FNM_CASEFOLD&quot;, 0x50); }  // match case-insensitive
   if (!defined(&quot;FNM_EXTMATCH&quot;)) { define(&quot;FNM_EXTMATCH&quot;, 1&lt;&lt;5); }  // not in PHP

   #-- implementation
   function fnmatch($pattern, $str, $flags=0x0000) {

      #-- 'hidden' files
      if ($flags &amp;amp; FNM_PERIOD) {
         if (($str[0] == &quot;.&quot;) &amp;amp;&amp;amp; ($pattern[0] != &quot;.&quot;)) {
            return(false);    // abort early
         }
      }

      #-- case-insensitivity
      $rxci = &quot;&quot;;
      if ($flags &amp;amp; FNM_CASEFOLD) {
         $rxci = &quot;i&quot;;
      }
      #-- handline of pathname separators (/)
      $wild = &quot;.&quot;;
      if ($flags &amp;amp; FNM_PATHNAME) {
         $wild = &quot;[^/&quot;.DIRECTORY_SEPARATOR.DIRECTORY_SEPARATOR.&quot;]&quot;;
      }

      #-- check for cached regular expressions
      static $cmp = array();
      if (isset($cmp[&quot;$pattern+$flags&quot;])) {
         $rx = $cmp[&quot;$pattern+$flags&quot;];
      }

      #-- convert filename globs into regex
      else {
         $rx = preg_quote($pattern);
         $rx = strtr($rx, array(
            &quot;\\*&quot;=&gt;&quot;$wild*?&quot;, &quot;\\?&quot;=&gt;&quot;$wild&quot;, &quot;\\[&quot;=&gt;&quot;[&quot;, &quot;\\]&quot;=&gt;&quot;]&quot;,
         ));
         $rx = &quot;{^&quot; . $rx . &quot;$}&quot; . $rxci;

         #-- cache
         if (count($cmp) &gt;= 50) {
            $cmp = array();   // free
         }
         $cmp[&quot;$pattern+$flags&quot;] = $rx;
      }

      #-- compare
      return(preg_match($rx, $str));
   }
}


#-- file search and name matching (with shell patterns)
if (!function_exists(&quot;glob&quot;)) {

   #-- introduced constants
   if (!defined(&quot;GLOB_MARK&quot;)) { define(&quot;GLOB_MARK&quot;, 1&lt;&lt;0); }
   if (!defined(&quot;GLOB_NOSORT&quot;)) { define(&quot;GLOB_NOSORT&quot;, 1&lt;&lt;1); }
   if (!defined(&quot;GLOB_NOCHECK&quot;)) { define(&quot;GLOB_NOCHECK&quot;, 1&lt;&lt;2); }
   if (!defined(&quot;GLOB_NOESCAPE&quot;)) { define(&quot;GLOB_NOESCAPE&quot;, 1&lt;&lt;3); }
   if (!defined(&quot;GLOB_BRACE&quot;)) { define(&quot;GLOB_BRACE&quot;, 1&lt;&lt;4); }
   if (!defined(&quot;GLOB_ONLYDIR&quot;)) { define(&quot;GLOB_ONLYDIR&quot;, 1&lt;&lt;5); }
   if (!defined(&quot;GLOB_NOCASE&quot;)) { define(&quot;GLOB_NOCASE&quot;, 1&lt;&lt;6); }
   if (!defined(&quot;GLOB_DOTS&quot;)) { define(&quot;GLOB_DOTS&quot;, 1&lt;&lt;7); }
   // unlikely to work under Win(?), without replacing the explode() with
   // a preg_split() incorporating the native DIRECTORY_SEPARATOR as well

   #-- implementation
   function glob($pattern, $flags=0x0000) {
      $ls = array();
      $rxci = ($flags &amp;amp; GLOB_NOCASE) ? &quot;i&quot; : &quot;&quot;;
#echo &quot;\n=&gt; glob($pattern)...\n&quot;;

      #-- transform glob pattern into regular expression
      #   (similar to fnmatch() but still different enough to require a second func)
      if ($pattern) {

         #-- look at each directory/fn spec part separately
         $parts2 = explode(&quot;/&quot;, $pattern);
         $pat = preg_quote($pattern);
         $pat = strtr($pat, array(&quot;\\*&quot;=&gt;&quot;.*?&quot;, &quot;\\?&quot;=&gt;&quot;.?&quot;));
         if ($flags ^ GLOB_NOESCAPE) {
            // uh, oh, ouuch - the above is unclean enough...
         }
         if ($flags ^ GLOB_BRACE) {
            $pat = preg_replace(&quot;/\{(.+?)\}/e&quot;, 'strtr(&quot;[$1]&quot;, &quot;,&quot;, &quot;&quot;)', $pat);
         }
         $parts = explode(&quot;/&quot;, $pat);
#echo &quot;parts == &quot;.implode(&quot; // &quot;, $parts) . &quot;\n&quot;;
         $lasti = count($parts) - 1;
         $dn = &quot;&quot;;
         foreach ($parts as $i=&gt;$p) {

            #-- basedir included (yet no pattern matching necessary)
            if (!strpos($p, &quot;*?&quot;) &amp;amp;&amp;amp; (strpos($p, &quot;.?&quot;)===false)) {
               $dn .= $parts2[$i] . ($i!=$lasti ? &quot;/&quot; : &quot;&quot;);
#echo &quot;skip:$i, cause no pattern matching char found -&gt; only a basedir spec\n&quot;;
               continue;
            }

            #-- start reading dir + match filenames against current pattern
            if ($dh = opendir($dn ?$dn:'.')) {
               $with_dot = ($p[1]==&quot;.&quot;) || ($flags &amp;amp; GLOB_DOTS);
#echo &quot;part:$i:$p\n&quot;;
#echo &quot;reading dir \&quot;$dn\&quot;\n&quot;;
               while ($fn = readdir($dh)) {
                  if (preg_match(&quot;\007^$p$\007$rxci&quot;, $fn)) {

                     #-- skip over 'hidden' files
                     if (($fn[0] == &quot;.&quot;) &amp;amp;&amp;amp; !$with_dot) {
                        continue;
                     }

                     #-- add filename only if last glob/pattern part
                     if ($i==$lasti) {
                        if (is_dir(&quot;$dn$fn&quot;)) {
                           if ($flags &amp;amp; GLOB_ONLYDIR) {
                              continue;
                           }
                           if ($flags &amp;amp; GLOB_MARK) {
                              $fn .= &quot;/&quot;;
                           }
                        }
#echo &quot;adding '$fn' for dn=$dn to list\n&quot;;
                        $ls[] = &quot;$dn$fn&quot;;
                     }

                     #-- initiate a subsearch, merge result list in
                     elseif (is_dir(&quot;$dn$fn&quot;)) {
                        // add reamaining search patterns to current basedir
                        $remaind = implode(&quot;/&quot;, array_slice($parts2, $i+1));
                        $ls = array_merge($ls, glob(&quot;$dn$fn/$remaind&quot;, $flags));
                     }
                  }
               }
               closedir($dh);

               #-- prevent scanning a 2nd part/dir in same glob() instance:
               break;
            }

            #-- given dirname doesn't exist
            else {
               return($ls);
            }

         }// foreach $parts
      }

      #-- return result list
      if (!$ls &amp;amp;&amp;amp; ($flags &amp;amp; GLOB_NOCHECK)) {
         $ls[] = $pattern;
      }
      if ($flags ^ GLOB_NOSORT) {
         sort($ls);
      }
#print_r($ls);
#echo &quot;&lt;=\n&quot;;
      return($ls);
   }
} //@FIX: fully comment, remove debugging code (- as soon as it works ;)


#-- redundant alias for isset()
if (!function_exists(&quot;array_key_exists&quot;)) {
   function array_key_exists($key, $search) {
      return isset($search[$key]);
   }
}


#-- who could need that?
if (!function_exists(&quot;array_intersect_assoc&quot;)) {
   function array_intersect_assoc( /*array, array, array...*/ ) {

      #-- parameters, prepare
      $in = func_get_args();
      $cmax = count($in);
      $whatsleftover = array();

      #-- walk through each array pair
      #   (take first as checklist)
      foreach ($in[0] as $i =&gt; $v) {
         for ($c = 1; $c &lt; $cmax; $c++) {
            #-- remove entry, as soon as it isn't present
            #   in one of the other arrays
            if (!isset($in[$c][$i]) || (@$in[$c][$i] !== $v)) {
               continue 2;
            }
         }
         #-- it was found in all other arrays
         $whatsleftover[$i] = $v;
      }
      return $whatsleftover;
   }
}


#-- the opposite of the above
if (!function_exists(&quot;array_diff_assoc&quot;)) {
   function array_diff_assoc( /*array, array, array...*/ ) {

      #-- params
      $in = func_get_args();
      $diff = array();

      #-- compare each array with primary/first
      foreach ($in[0] as $i=&gt;$v) {
         for ($c=1; $c&lt;count($in); $c++) {
            #-- skip as soon as it matches with entry in another array
            if (isset($in[$c][$i]) &amp;amp;&amp;amp; ($in[$c][$i] == $v)) {
               continue 2;
            }
         }
         #-- else
         $diff[$i] = $v;
      }
      return $diff;
   }
}


#-- opposite of htmlentities
if (!function_exists(&quot;html_entity_decode&quot;)) {
   function html_entity_decode($string, $quote_style=ENT_COMPAT, $charset=&quot;ISO-8859-1&quot;) {
      //@FIX: we fall short on anything other than Latin-1
      $y = array_flip(get_html_translation_table(HTML_ENTITIES, $quote_style));
      return strtr($string, $y);
   }
}


#-- extracts single words from a string
if (!function_exists(&quot;str_word_count&quot;)) {
   function str_word_count($string, $result=0) {

      #-- let someone else do the work
      preg_match_all('/([\w](?:[-\'\w]?[\w]+)*)/', $string, $uu);

      #-- return full word list
      if ($result == 1) {
         return($uu[1]);
      }

      #-- array() of $pos=&gt;$word entries
      elseif ($result &gt;= 2) {
         $r = array();
         $l = 0;
         foreach ($uu[1] as $word) {
            $l = strpos($string, $word, $l);
            $r[$l] = $word;
            $l += strlen($word);  // speed up next search
         }
         return($r);
      }

      #-- only count
      else {
         return(count($uu[1]));
      }
   }
}


#-- creates a permutation of the given strings characters
#   (let's hope the random number generator was alread initialized)
if (!function_exists(&quot;str_shuffle&quot;)) {
   function str_shuffle($str) {
      $r = &quot;&quot;;

      #-- cut string down with every iteration
      while (strlen($str)) {
         $n = strlen($str) - 1;
         if ($n) {
            $n = rand(0, $n);   // glibcs` rand is ok since 2.1 at least
         }

         #-- cut out elected char, add to result string
         $r .= $str{$n};
         $str = substr($str, 0, $n) . substr($str, $n + 1);
      }
      return($r);
   }
}


#-- simple shorthands
if (!function_exists(&quot;get_include_path&quot;)) {
   function get_include_path() {
      return(get_cfg_var(&quot;include_path&quot;));
   }
   function set_include_path($new) {
      return ini_set(&quot;include_path&quot;, $new);
   }
   function restore_include_path() {
      ini_restore(&quot;include_path&quot;);
   }
}


#-- constants for 4.3
   if (!defined(&quot;PATH_SEPARATOR&quot;)) { define(&quot;PATH_SEPARATOR&quot;, ((DIRECTORY_SEPARATOR=='\\') ? ';' :':')); }
   if (!defined(&quot;PHP_SHLIB_SUFFIX&quot;)) { define(&quot;PHP_SHLIB_SUFFIX&quot;, ((DIRECTORY_SEPARATOR=='\\') ? 'dll' :'so')); }
   if (!defined(&quot;PHP_SAPI&quot;)) { define(&quot;PHP_SAPI&quot;, php_sapi_name()); }
   if (!defined(&quot;__FUNCTION__&quot;)) { define(&quot;__FUNCTION__&quot;, NULL); }   // empty string would signalize main()


#-- not identical to what PHP reports (it seems to `which` for itself)
if (!defined(&quot;PHP_PREFIX&quot;) &amp;amp;&amp;amp; isset($_ENV[&quot;_&quot;])) { define(&quot;PHP_PREFIX&quot;, substr($_ENV[&quot;_&quot;], 0, strpos($_ENV[&quot;_&quot;], &quot;bin/&quot;))); }






#------------------------------------------------------------------ 4.2 ---
# almost complete!?


#-- shy away from this one - it was broken in all real PHP4.2 versions, and
#   this function emulation script won't change that
if (!function_exists(&quot;str_rot13&quot;)) {
   function str_rot13($str) {
      static $from = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;;
      static $to = &quot;NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm&quot;;
      return strtr($str, $from, $to);
   }
}


#-- well, if you need it
if (!function_exists(&quot;array_change_key_case&quot;)) {

   #-- introduced constants
   if (!defined(&quot;CASE_LOWER&quot;)) { define(&quot;CASE_LOWER&quot;, 0); }
   if (!defined(&quot;CASE_UPPER&quot;)) { define(&quot;CASE_UPPER&quot;, 1); }

   #-- implementation
   function array_change_key_case($array, $case=CASE_LOWER) {

      #-- loop through
      foreach ($array as $i=&gt;$v) {
         #-- do anything for strings only
         if (is_string($i)) {
            unset($array[$i]);
            $i = ($case==CASE_LOWER) ? strtolower($i) : strtoupper($i);
            $array[$i] = $v;
         }
         // non-recursive
      }
      return($array);
   }
}


#-- create fixed-length array made up of $value data
if (!function_exists(&quot;array_fill&quot;)) {
   function array_fill($start_index, $num, $value) {

      #-- params
      $r = array();
      $i = $start_index;
      $end = $num + $start_index;

      #-- append
      for (; $i &lt; $end; $i++)
      {
         $r[$i] = $value;
      }
      return($r);
   }
}


#-- split an array into evenly sized parts
if (!function_exists(&quot;array_chunk&quot;)) {
   function array_chunk($input, $size, $preserve_keys=false) {

      #-- array for chunked output
      $r = array();
      $n = -1;  // chunk index

      #-- enum input array blocks
      foreach ($input as $i=&gt;$v) {

         #-- new chunk
         if (($n &lt; 0) || (count($r[$n]) == $size)) {
            $n++;
            $r[$n] = array();
         }

         #-- add input value into current [$n] chunk
         if ($preserve_keys) {
            $r[$n][$i] = $v;
         }
         else {
            $r[$n][] = $v;
         }
      }
      return($r);
   }
}


#-- convenience wrapper
if (!function_exists(&quot;md5_file&quot;)) {
   function md5_file($filename, $raw_output=false) {

      #-- read file, apply hash function
      $data = file_get_contents($filename, &quot;rb&quot;);
      $r = md5($data);
      $data = NULL;

      #-- transform? and return
      if ($raw_output) {
         $r = pack(&quot;H*&quot;, $r);
      }
      return $r;
   }
}


#-- object type checking
if (!function_exists(&quot;is_a&quot;)) {
   function is_a($obj, $classname) {

      #-- lowercase everything for comparison
      $classnaqme = strtolower($classname);
      $obj_class =  strtolower(get_class($obj));

      #-- two possible checks
      return ($obj_class == $classname) or is_subclass_of($obj, $classname);
   }
}


#-- floating point modulo
if (!function_exists(&quot;fmod&quot;)) {
   function fmod($x, $y) {
      $r = $x / $y;
      $r -= (int)$r;
      $r *= $y;
      return($r);
   }
}


#-- makes float variable from string
if (!function_exists(&quot;floatval&quot;)) {
   function floatval($str) {
      $str = ltrim($str);
      return (float)$str;
   }
}


#-- floats
if (!function_exists(&quot;is_infinite&quot;)) {

   #-- constants as-is
   if (!defined(&quot;NAN&quot;)) { define(&quot;NAN&quot;, &quot;NAN&quot;); }
   if (!defined(&quot;INF&quot;)) { define(&quot;INF&quot;, &quot;INF&quot;); }   // there is also &quot;-INF&quot;

   #-- simple checks
   function is_infinite($f) {
      $s = (string)$f;
      return(  ($s==&quot;INF&quot;) || ($s==&quot;-INF&quot;)  );
   }
   function is_nan($f) {
      $s = (string)$f;
      return(  $s==&quot;NAN&quot;  );
   }
   function is_finite($f) {
      $s = (string)$f;
      return(  !strpos($s, &quot;N&quot;)  );
   }
}


#-- throws value-instantiation PHP-code for given variable
#   (a bit different from the standard, was intentional for its orig use)
if (!function_exists(&quot;var_export&quot;)) {
   function var_export($var, $return=false, $indent=&quot;&quot;, $output=&quot;&quot;) {

      #-- output as in-class variable definitions
      if (is_object($var)) {
         $output = &quot;class &quot; . get_class($var) . &quot; {\n&quot;;
         foreach (((array)$var) as $id=&gt;$var) {
            $output .= &quot;  var \$$id = &quot; . var_export($var, true) . &quot;;\n&quot;;
         }
         $output .= &quot;}&quot;;
      }

      #-- array constructor
      elseif (is_array($var)) {
         foreach ($var as $id=&gt;$next) {
            if ($output) $output .= &quot;,\n&quot;;
                    else $output = &quot;array(\n&quot;;
            $output .= $indent . '  '
                    . (is_numeric($id) ? $id : '&quot;'.addslashes($id).'&quot;')
                    . ' =&gt; ' . var_export($next, true, &quot;$indent  &quot;);
         }
         if (empty($output)) $output = &quot;array(&quot;;
         $output .= &quot;\n{$indent})&quot;;
       #if ($indent == &quot;&quot;) $output .= &quot;;&quot;;
      }

      #-- literals
      elseif (is_numeric($var)) {
         $output = &quot;$var&quot;;
      }
      elseif (is_bool($var)) {
         $output = $var ? &quot;true&quot; : &quot;false&quot;;
      }
      else {
         $output = &quot;'&quot; . preg_replace(&quot;/([\\\\\'])/&quot;, '\\\\$1', $var) . &quot;'&quot;;
      }

      #-- done
      if ($return) {
         return($output);
      }
      else {
         print($output);
      }
   }
}


#-- strcmp() variant that respects locale setting,
#   existed since PHP 4.0.5, but under Win32 first since 4.3.2
if (!function_exists(&quot;strcoll&quot;)) {
   function strcoll($str1, $str2) {
      return strcmp($str1, $str2);
   }
}





#------------------------------------------------------------------ 4.1 ---
# nl_langinfo - unimpl?
# getmygid
# version_compare
#
# See also &quot;ext/math41.php&quot; for some more (rarely used mathematical funcs).




#-- aliases (an earlier fallen attempt to unify PHP function names)
if (!function_exists(&quot;diskfreespace&quot;)) {
   function diskfreespace() {
      return disk_free_sapce();
   }
   function disktotalspace() {
      return disk_total_sapce();
   }
}


#-- variable count of arguments (in array list) printf variant
if (!function_exists(&quot;vprintf&quot;)) {
   function vprintf($format, $args=NULL) {
      call_user_func_array(&quot;fprintf&quot;, get_func_args());
   }
}


#-- same as above, but doesn't output directly and returns formatted string
if (!function_exists(&quot;vsprintf&quot;)) {
   function vsprintf($format, $args=NULL) {
      $args = array_merge(array($format), array_values((array)$args));
      return call_user_func_array(&quot;sprintf&quot;, $args);
   }
}


#-- can be used to simulate a register_globals=on environment
if (!function_exists(&quot;import_request_variables&quot;)) {
   function import_request_variables($types=&quot;GPC&quot;, $pfix=&quot;&quot;) {

      #-- associate abbreviations to global var names
      $alias = array(
         &quot;G&quot; =&gt; &quot;_GET&quot;,
         &quot;P&quot; =&gt; &quot;_POST&quot;,
         &quot;C&quot; =&gt; &quot;_COOKIE&quot;,
         &quot;S&quot; =&gt; &quot;_SERVER&quot;,   // non-standard
         &quot;E&quot; =&gt; &quot;_ENV&quot;,      // non-standard
      );
      #-- alias long names (PHP &lt; 4.0.6)
      if (!isset($_REQUEST)) {
         $_GET = &amp;amp; $HTTP_GET_VARS;
         $_POST = &amp;amp; $HTTP_POST_VARS;
         $_COOKIE = &amp;amp; $HTTP_COOKIE_VARS;
      }

      #-- copy
      for ($i=0; $i&lt;strlen($types); $i++) {
         if ($FROM = $alias[strtoupper($c)]) {
            foreach ($$FROM as $key=&gt;$val) {
               if (!isset($GLOBALS[$pfix.$key])) {
                  $GLOBALS[$pfix . $key] = $val;
               }
            }
         }
      }
      // done
   }
}


// a few mathematical functions follow
// (wether we should really emulate them is a different question)

#-- me has no idea what this function means
if (!function_exists(&quot;hypot&quot;)) {
   function hypot($num1, $num2) {
      return sqrt($num1*$num1 + $num2*$num2);  // as per PHP manual ;)
   }
}

#-- more accurate logarithm func, but we cannot simulate it
#   (too much work, too slow in PHP)
if (!function_exists(&quot;log1p&quot;)) {
   function log1p($x) {
      return(  log(1+$x)  );
   }
   #-- same story for:
   function expm1($x) {
      return(  exp($x)-1  );
   }
}

#-- as per PHP manual
if (!function_exists(&quot;sinh&quot;)) {
   function sinh($f) {
      return(  (exp($f) - exp(-$f)) / 2  );
   }
   function cosh($f) {
      return(  (exp($f) + exp(-$f)) / 2  );
   }
   function tanh($f) {
      return(  sinh($f) / cosh($f)  );   // ok, that one makes sense again :)
   }
}

#-- these look a bit more complicated
if (!function_exists(&quot;asinh&quot;)) {
   function asinh($x) {
      return(  log($x + sqrt($x*$x+1))  );
   }
   function acosh($x) {
      return(  log($x + sqrt($x*$x-1))  );
   }
   function atanh($x) {
      return(  log1p( 2*$x / (1-$x) ) / 2  );
   }
}


#-- HMAC from RFC2104, but see also PHP_Compat and Crypt_HMAC
if (!function_exists(&quot;mhash&quot;)) {

   #-- constants
   if (!defined(&quot;MHASH_CRC32&quot;)) { define(&quot;MHASH_CRC32&quot;, 0); }
   if (!defined(&quot;MHASH_MD5&quot;)) { define(&quot;MHASH_MD5&quot;, 1); }       // RFC1321
   if (!defined(&quot;MHASH_SHA1&quot;)) { define(&quot;MHASH_SHA1&quot;, 2); }      // RFC3174
   if (!defined(&quot;MHASH_TIGER&quot;)) { define(&quot;MHASH_TIGER&quot;, 7); }
   if (!defined(&quot;MHASH_MD4&quot;)) { define(&quot;MHASH_MD4&quot;, 16); }      // RFC1320
   if (!defined(&quot;MHASH_SHA256&quot;)) { define(&quot;MHASH_SHA256&quot;, 17); }
   if (!defined(&quot;MHASH_ADLER32&quot;)) { define(&quot;MHASH_ADLER32&quot;, 18); }

   #-- implementation
   function mhash($hashtype, $text, $key) {

      #-- hash function
      if (!($func = mhash_get_hash_name($hashtype)) || !function_exists($func)) {
         return trigger_error(&quot;mhash: cannot use hash algorithm #$hashtype/$func&quot;, E_USER_ERROR);
      }
      if (!$key) {
         trigger_error(&quot;mhash: called without key&quot;, E_USER_WARNING);
      }

      #-- params
      $bsize = mhash_get_block_size($hashtype);   // fixed size, 64

      #-- pad key
      if (strlen($key) &gt; $bsize) {  // hash key, when it's too long
         $key = $func($key);
         $key = pack(&quot;H*&quot;, $key);   // binarify
      }
      $key = str_pad($key, $bsize, &quot;\0&quot;);  // fill up with NULs (1)

      #-- prepare inner and outer padding stream
      $ipad = str_pad(&quot;&quot;, $bsize, &quot;6&quot;);   // %36
      $opad = str_pad(&quot;&quot;, $bsize, &quot;\\&quot;);  // %5C

      #-- call hash func    // php can XOR strings for us
      $dgst = pack(&quot;H*&quot;,  $func(  ($key ^ $ipad)  .  $text  ));  // (2,3,4)
      $dgst = pack(&quot;H*&quot;,  $func(  ($key ^ $opad)  .  $dgst  ));  // (5,6,7)
      return($dgst);
   }

   #-- return which hash functions are implemented
   function mhash_count() {
      return(MHASH_SHA1);
   }

   #-- map numeric identifier to hash function name
   function mhash_get_hash_name($i) {
      static $hash_funcs = array(
          MHASH_CRC32 =&gt; &quot;crc32&quot;,   // would need dechex()ing in main func?
          MHASH_MD5 =&gt; &quot;md5&quot;,
          MHASH_SHA1 =&gt; &quot;sha1&quot;,
      );
      return(strtoupper($hash_funcs[$i]));
   }

   #-- static value
   function mhash_get_block_size($i) {
      return(64);
   }
}



#-- other stuff
/*
  removed funcs??
      [18] =&gt; leak
*/



#-- pre-4.1 -- end
// no need to implement anything below that, because such old versions
// will be incompatbile anyhow (- none of the newer superglobals known),
// but see also &quot;ext/old&quot;


?&gt;
</pre>
</div>
<br>

</div>

</div>

</div>
<div id="footer">
<div>
Copyright 2000-2011 Â© Code Snippets Collection
</div>
<div>
<a href="http://tipforlinux.com" title="Tips for Linux">Tips for Linux</a>
<a href="http://ezinephoto.com" title="Daily funny commics">Daily funny commics</a>
<a href="http://gpluspic.com/banner" alt="Google plus banners">Google plus banners</a>
<a href="http://gpluspic.com" alt="Google plus profile picture">Google plus profile picture</a>
<a href="http://html5example.net" alt="HTML5 example">HTML5 example</a>
<a href="http://html5example.net" alt="HTML5 examples">HTML5 examples</a>
<a href="http://html5canvasdemo.com/category/HTML5%20Canvas/" alt="HTML5 canvas demo">HTML5 canvas demo</a>
<a href="http://icodesnip.com" alt="code snippets">code snippets</a>
<a href="http://icodesnippet.com/" alt="Html5 example">code snippets</a>
<a href="http://gplusbanner.com" alt="Create Your Own Google Plus Profile Banner">Create Your Own Google Plus Profile Banner</a>
</div>
</div>
</div>
</div>

<link href="/static/css/shCore.css" rel="stylesheet" type="text/css" />
<link href="/static/css/shThemeDefault.css" rel="stylesheet" type="text/css" />
<script src='/static/js/shCore.js' type='text/javascript'></script>
<script src='/static/js/shAutoloader.js' type='text/javascript'></script>
<script src='/static/js/main.js' type='text/javascript'></script>

<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-22578953-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
</body></html>
