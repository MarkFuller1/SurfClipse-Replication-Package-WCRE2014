<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"><![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"><![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"><![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--><html lang="en" class="no-js"><!--<![endif]-->
    <head>
        
        <meta charset="utf-8">
        <!--SourceForge.net: Find and Build Open Source Software-->
        <!--Copyright (c) 1999-2013 SourceForge, Inc. All rights reserved.-->
        <!-- Create Server: sfs-web-5 -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta name="description" content="A web based Geographic Metadata Catalog for data description and discovery. It implements international standards (e.g. ISO19115/19139, Z39.50, CSW 2.0, OGC). It originates from the United Nations and is used by many governments as geoportal software" />
        <meta name="keywords" content="GeoNetwork - Geographic Metadata Catalog, File Sharing, Dynamic Content, GIS, Archiving, Open Source, Development, Community, Source Code, Downloads, Software" />
                <title>SourceForge.net: GeoNetwork - Geographic Metadata Catalog: geonetwork-commit</title>        <link href='//fonts.googleapis.com/css?family=Ubuntu:regular,bold' rel='stylesheet' type='text/css'>
                <style type="text/css">
            @font-face {
                font-family: "Pictos";
                src: url('http://static.sourceforge.net/include/fonts/sftheme/pictos-web.eot');
                src: local("â˜º"), url('http://static.sourceforge.net/include/fonts/sftheme/pictos-web.woff') format('woff'), url('http://static.sourceforge.net/include/fonts/sftheme/pictos-web.ttf') format('truetype'), url('http://static.sourceforge.net/include/fonts/sftheme/pictos-web.svg') format('svg');
            }
            #site-header .logo span {
              background-image: url("http://static.sourceforge.net/images/neotheme/sftheme/logo.png");
            }
            #site-footer .wrapper {
              background-image: url("http://static.sourceforge.net/images/neotheme/sftheme/sf-footer-logo.png") !important;
            }
        </style>
        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/develop/style.php?secure=0&amp;1385769361" media="all" />
        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/develop/global.php?secure=0&amp;1385769361" media="all" />
        
        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/neotheme/sfx.css?1385769361" media="all" />
                       <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/phoneix/table.php?secure=0&amp;1385769361" media="all" />
                        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/css/develop/droppy.php?secure=0&amp;1385769361" media="all" />
                                        <!--   -->
        <script type="text/javascript" src="http://static.sourceforge.net/include/js/sftheme/modernizr.custom.90514.js"></script>
        <script type="text/javascript" src="http://static.sourceforge.net/include/jquery/jquery-1.3.2.min.js"></script>
        <script type="text/javascript">
            
                jQuery.noConflict();
            
        </script>

        <script type="text/javascript" src="http://static.sourceforge.net/include/jquery/jquery.cookie.js"></script>
                        <script type='text/javascript'>
          jQuery(function() {
            jQuery('#fad19 p, .project_summary .downloadbar, .vertical_widget, .horizontal_widget').wrap('<div class="sc"><div class="l1"><div class="l2"><div class="l3"><div class="l4"></div></div></div></div></div>');
          });
        </script>
                <script type="text/javascript" src="http://static.sourceforge.net/include/jquery/jquery.droppy.js"></script>
        <script type="text/javascript" src="http://static.sourceforge.net/include/js/sylvester.js"></script>
        <script type="text/javascript" src="http://static.sourceforge.net/include/js/pb.transformie.js"></script>
        <script type='text/javascript'>
            jQuery(function(){
                jQuery('.b-hornav > li:last-child').addClass('last');
                jQuery('.b-hornav > li').each(function() {
                    jQuery('li[class!=disabled]', this).eq(0).addClass('first');
                });
                jQuery('.b-hornav').droppy({speed:0, delay:0});
            });
        </script>
                <script type="text/javascript" src="http://static.sourceforge.net/include/c_jquerytabs.js"></script>

        <script type="text/javascript">
        
            jQuery(function(){
                jQuery('.vertical_widget_content ul.tab, #container2 ul.tab, #container3 ul.tab, #container4 ul.tab').tabs({ selected: 0 });
            });
        
        </script>
        <link rel="stylesheet" type="text/css" href="http://static.sourceforge.net/include/jquery/jquery.tabs.css?secure=0&amp;1385769361" media="all" />
            
                            <script type="text/javascript" src="http://static.sourceforge.net/include/js/preferences.js"></script>
            <script type="text/javascript">
                        var _visitor = "";
            var jsonly = document.createElement('link');
            jsonly.setAttribute('rel', 'stylesheet');
            jsonly.setAttribute('type', 'text/css');
            jsonly.setAttribute('href', 'http://static.sourceforge.net/css/phoneix/jsonly.css?secure=0&amp;1385769361');
            document.getElementsByTagName('head')[0].appendChild(jsonly);
                    </script>
                                                                    <!-- DoubleClick Random Number -->
    <script type="text/javascript">var dfp_ord=Math.random()*10000000000000000; var dfp_tile = 1; var dfp_ptile = 1;</script>
    <!-- End DoubleClick Random Number -->
    <!-- After META tags -->
                                    
        <script type="text/javascript" src="http://static.sourceforge.net/sfx.js"></script>
        
            <script type="text/javascript">
                        var _gaq = _gaq || [];
                        _gaq.push(['t1._setAccount', 'UA-32013-6']);
                        _gaq.push(['t1._trackPageview']);
                        _gaq.push(['t2._setAccount', 'UA-36130941-1']);
                        _gaq.push(['t2._trackPageview']);
                        (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
            })();
        </script>
        <script type="text/javascript" src="http://static.sourceforge.net/include/jquery/jquery.notify.js"></script>
    <script type="text/javascript" src="http://static.sourceforge.net/include/js/header.js"></script>
    </head>

    <body id="c2" class="short-head">
    
    <!--[if IE 7]><div id="ie7only"><![endif]-->
    <!--[if IE 6]><div id="ie6only"><![endif]-->
    <!--[if IE]><div id="ieonly"><![endif]-->
        
        <div class="mail_archive">
                        <header id="site-header">
                <div class="wrapper">
                    <a href="/" class="logo">
                        <span>SourceForge</span>
                    </a>
                    <form method="get" action="/directory/">
                        <input type="text" id="words" name="q" placeholder="Search">
                    </form>
                    <nav id="nav-site">
                        <a href="/directory/" title="Browse our software.">Browse</a>
                        <a href="/directory/enterprise" title="Browse our Enterprise software.">Enterprise</a>
                        <a href="/blog/" title="Read the latest news from the SF HQ.">Blog</a>
                        <a href="/support" title="Contact us for help and feedback.">Help</a>
                        <a href="/jobs?source=header" title="Search 80k+ tech jobs." class="featured-link">Jobs</a>
                    </nav>
                    <nav id="nav-account">
                                                  <div class="logged_out">
                            <a href="https://sourceforge.net/account/login.php">Log In</a>
                            <span>or</span>
                            <a href="https://sourceforge.net/user/registration">Join</a>
                          </div>
                                            </nav>
                </div>
            </header>
            <header id="site-sec-header">
                <div class="wrapper">
                    <nav id="nav-hubs">
                        <h4>Solution Centers</h4>
                        <a href="http://ibmsmartercommerce.sourceforge.net/">Smarter Commerce</a>
                        <a href="http://goparallel.sourceforge.net/">Go Parallel</a>
                        <a href="http://html5center.sourceforge.net/">HTML5</a>
                        <a href="http://ibmsmarteritservices.sourceforge.net/">Smarter IT</a>
                    </nav>
                    <nav id="nav-collateral">
                      <a href="http://library.slashdotmedia.com/?source=sfnet_header">Resources</a>  
                                              <a href="https://sourceforge.net/user/registration/">Newsletters</a>
                                            </nav>
                </div>
            </header>
                            <!-- DoubleClick Ad Tag -->
<script type="text/javascript">
//<![CDATA[
    document.write('<script src="http://ad.doubleclick.net/adj/ostg.sourceforge/sf_pg_mailarchive_leader;pg=/mailarchive/forum.php;psrch=0;logged_in=0;tile='+dfp_tile+';sz=728x90;ord='+dfp_ord+'?" type="text/javascript"><\/script>');
    dfp_tile++;
//]]>
</script>
<!-- End DoubleClick Ad Tag -->
                                                <div id="page-body">
            <div id="bd" class="inner-bd">
                <div id="doc4" class="yui-t6">
                                                            <div id="breadcrumbs">
                                                    <a href="/">Home</a>
 / <a href="/directory/" >Browse</a>
 / <a href="/projects/geonetwork/" >GeoNetwork - Geographic Metadata Catalog</a>
 / <a href="/mail/?group_id=72096" >Mail</a>
 / <a href="/mailarchive/forum.php?thread_name=E1Hvv7N-0003AJ-Sz%40sc8-pr-svn3.sourceforge.net&amp;forum_name=geonetwork-commit"  class="selected">Archive</a>
                                            </div>
                    <!-- begin content -->
            <a name="projectnav"></a>
        <div id="project_nav_container">
            <div class="b-proj__side">
                                
                
                
                <span class="award-bar"></span>
            </div>
            <h1>
                <a href="/projects/geonetwork/">GeoNetwork - Geographic Metadata Catalog</a>
                            </h1>
                    <div class="firstwave">
                <ul class="b-hornav">
                    <li id="menu_consume_summary"><a href="/projects/geonetwork/"><span><span>Summary</span></span></a></li>
<li id="menu_consume_files"><a href="/projects/geonetwork/files/"><span><span>Files</span></span></a></li>
<li id="menu_consume_reviews"><a href="/projects/geonetwork/reviews/"><span><span>Reviews</span></span></a></li>
<li id="menu_project_support"><a href="/projects/geonetwork/support"><span><span>Support</span></span></a></li>
<li id="menu_project_develop"><a href="/projects/geonetwork/develop"><span><span>Develop</span></span></a>
<ul>
<li id="menu_project_website"><a href="http://geonetwork-opensource.org">Web Site</a></li>
<li id="menu_project_screenshots"><a href="/project/screenshots.php?group_id=72096">Screenshots</a></li>
<li id="menu_project_news"><a href="/news/?group_id=72096">News</a></li>
<li id="menu_stats"><a href="/projects/geonetwork/stats/traffic">Project Statistics</a></li>
<li id="menu_download_stats_dist"><a href="/downloads/geonetwork/stats_timeline">Download Stats</a></li>
</ul>
</li>
<li id="menu_hostedapps"><a href="/hostedapp/?group_id=72096"><span><span>Hosted&nbsp;Apps</span></span></a>
<ul>
<li id="menu_hostedapp_piwik"><a href="/apps/piwik/geonetwork/">Piwik</a></li>
</ul>
</li>
<li id="menu_tracker" class="disabled tier" style="display: none;"><a href="/tracker/?group_id=72096"><span><span>Tracker</span></span></a>
<ul>
<li id="menu_tracker_stats" class="tools"><a href="/projects/geonetwork/stats/tracker">Statistics for Trackers</a></li>
<li id="menu_tracker_reports" class="disabled" style="display: none;"><a href="/tracker/reporting/?group_id=72096">Reporting for Trackers</a></li>
<li id="menu_tracker_search"><a href="/search/?group_id=72096&amp;type_of_search=artifact">Search Trackers</a></li>
</ul>
</li>
<li id="menu_mail" class="selected tier"><a href="/mail/?group_id=72096"><span><span>Mailing&nbsp;Lists</span></span></a>
<ul>
<li id="menu_mlist_geonetwork-users-fr"><a href="/mailarchive/forum.php?forum_name=geonetwork-users-fr">geonetwork-users-fr</a></li>
<li id="menu_mlist_geonetwork-users"><a href="/mailarchive/forum.php?forum_name=geonetwork-users">geonetwork-users</a></li>
<li id="menu_mlist_geonetwork-devel"><a href="/mailarchive/forum.php?forum_name=geonetwork-devel">geonetwork-devel</a></li>
<li id="menu_mlist_geonetwork-commit"><a href="/mailarchive/forum.php?forum_name=geonetwork-commit">geonetwork-commit</a></li>
<li id="menu_mlist_geonetwork-usuarios-es"><a href="/mailarchive/forum.php?forum_name=geonetwork-usuarios-es">geonetwork-usuarios-es</a></li>
<li id="menu_mail_search" class="tools"><a href="/search/?group_id=72096&amp;type_of_search=mlists">Search Mail Lists</a></li>
</ul>
<div class="diamond"></div></li>
<li id="menu_forums" class="disabled tier" style="display: none;"><a href="/projects/geonetwork/forums"><span><span>Forums</span></span></a>
<ul>
<li id="menu_forum_245726"><a href="/projects/geonetwork/forums/forum/245726">Help</a></li>
<li id="menu_forum_245725"><a href="/projects/geonetwork/forums/forum/245725">Open Discussion</a></li>
<li id="menu_forums_stats" class="tools"><a href="/projects/geonetwork/stats/forums">Statistics for Forums</a></li>
<li id="menu_forums_search"><a href="/search/?group_id=72096&amp;type_of_search=forums">Search Forums</a></li>
</ul>
</li>
<li id="menu_code"><a href="/scm/?type=svn&amp;group_id=72096"><span><span>Code</span></span></a>
<ul>
<li id="menu_git_about" class="disabled" style="display: none;"><a href="/scm/?type=git&amp;group_id=72096">Git</a></li>
<li id="menu_git_browse" class="disabled" style="display: none;"><a href="http://geonetwork.git.sourceforge.net/">Git Browse</a></li>
<li id="menu_git_stats" class="disabled" style="display: none;"><a href="/projects/geonetwork/stats/scm?repo=GitRepository">Git Statistics</a></li>
<li id="menu_hg_about" class="disabled" style="display: none;"><a href="/scm/?type=hg&amp;group_id=72096">Mercurial</a></li>
<li id="menu_hg_browse" class="disabled" style="display: none;"><a href="http://geonetwork.hg.sourceforge.net/hgweb/geonetwork/">Mercurial Browse</a></li>
<li id="menu_hg_stats" class="disabled" style="display: none;"><a href="/projects/geonetwork/stats/scm?repo=HgRepository">Mercurial Statistics</a></li>
<li id="menu_bzr_about" class="disabled" style="display: none;"><a href="/scm/?type=bzr&amp;group_id=72096">Bazaar</a></li>
<li id="menu_bzr_browse" class="disabled" style="display: none;"><a href="http://geonetwork.bzr.sourceforge.net/bzr/geonetwork/">Bazaar Browse</a></li>
<li id="menu_bzr_stats" class="disabled" style="display: none;"><a href="/projects/geonetwork/stats/scm?repo=BazaarBranch">Bazaar Statistics</a></li>
<li id="menu_cvs_about" class="disabled" style="display: none;"><a href="/scm/?type=cvs&amp;group_id=72096">CVS</a></li>
<li id="menu_cvs_browse" class="disabled" style="display: none;"><a href="http://geonetwork.cvs.sourceforge.net/geonetwork/">CVS Browse</a></li>
<li id="menu_cvs_stats" class="disabled" style="display: none;"><a href="/projects/geonetwork/stats/scm?repo=CVSRepository">CVS Statistics</a></li>
<li id="menu_svn_about"><a href="/scm/?type=svn&amp;group_id=72096">SVN</a></li>
<li id="menu_svn_browse"><a href="http://geonetwork.svn.sourceforge.net/viewvc/geonetwork/">SVN Browse</a></li>
<li id="menu_svn_stats"><a href="/projects/geonetwork/stats/scm?repo=SVNRepository">SVN Statistics</a></li>
</ul>
</li>
<li id="menu_newadmin" class="disabled tier" style="display: none;"><a href="/project/admin/?group_id=72096"><span><span>Project&nbsp;Admin</span></span></a>
<ul>
<li id="menu_editgroupinfo" class="disabled" style="display: none;"><a href="/project/admin/public_info.php?group_id=72096">Settings</a></li>
<li id="menu_features" class="disabled" style="display: none;"><a href="/project/admin/features.php?group_id=72096">Features</a></li>
<li id="menu_userperms" class="disabled" style="display: none;"><a href="/project/admin/project_membership.php?group_id=72096">Members</a></li>
<li id="menu_stats_admin" class="disabled" style="display: none;"><a href="/project/admin/stats.php?group_id=72096">Analytics</a></li>
</ul>
</li>

                </ul>
            </div>
                </div>
        <div style="clear: both;"></div>
            




<p>
<h3>Email Archive: <a href="forum.php?forum_name=geonetwork-commit"><!-- google_ad_section_start -->geonetwork-commit<!-- google_ad_section_end --></A> (read-only)
</h3>
</p>

<table width="450" border=0>
    <tr>
        <td>
            <table width="100%" border="1" cellpadding="1" cellspacing="0">
	<tr>
		<th>
			<center><b>2006:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200608">(7)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200609">(5)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200610">(194)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200612">(1)</a>
								</td>
		<tr>
		<th>
			<center><b>2007:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									&nbsp;&nbsp;&nbsp;
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200702">(43)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200703">(140)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200704">(65)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200705">(36)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200706">(67)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200707">(178)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200708">(72)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200709">(112)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200710">(71)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200711">(29)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200712">(14)</a>
								</td>
		<tr>
		<th>
			<center><b>2008:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200801">(65)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200802">(112)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200803">(55)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200804">(52)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200805">(29)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200806">(25)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200807">(116)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200808">(24)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200809">(38)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200810">(128)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200811">(199)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200812">(210)</a>
								</td>
		<tr>
		<th>
			<center><b>2009:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200901">(178)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200902">(376)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200903">(418)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200904">(768)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200905">(828)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200906">(324)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200907">(280)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200908">(434)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200909">(214)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200910">(125)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200911">(154)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=200912">(165)</a>
								</td>
		<tr>
		<th>
			<center><b>2010:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201001">(96)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201002">(63)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201003">(113)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201004">(150)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201005">(48)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201006">(170)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201007">(83)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201008">(196)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201009">(90)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201010">(100)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201011">(198)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201012">(152)</a>
								</td>
		<tr>
		<th>
			<center><b>2011:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201101">(165)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201102">(131)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201103">(223)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201104">(79)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201105">(134)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201106">(144)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201107">(107)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201108">(108)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201109">(61)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201110">(164)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201111">(70)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201112">(65)</a>
								</td>
		<tr>
		<th>
			<center><b>2012:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201201">(100)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201202">(92)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201203">(223)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201204">(126)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201205">(83)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201206">(150)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201207">(55)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201208">(13)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201209">(28)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201210">(73)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201211">(74)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201212">(129)</a>
								</td>
		<tr>
		<th>
			<center><b>2013:</b></center>
		</th>
			<td bgcolor="#eeeeee">
			<sub>Jan</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201301">(105)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Feb</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201302">(72)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Mar</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201303">(21)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Apr</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201304">(64)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>May</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201305">(101)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jun</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201306">(46)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Jul</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201307">(26)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Aug</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201308">(4)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Sep</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201309">(1)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Oct</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201310">(44)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Nov</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201311">(60)</a>
								</td>
			<td bgcolor="#eeeeee">
			<sub>Dec</sub><br />
									<a href="forum.php?forum_name=geonetwork-commit&amp;max_rows=25&amp;style=nested&amp;viewmonth=201312">(25)</a>
								</td>
	</table>
            
        </td>
    </tr>
</table>

<form action="/mailarchive/forum.php" method="get">
<input type="hidden" name="set" value="custom">
<input type="hidden" name="viewmonth" value="">
<input type="hidden" name="viewday" value="">


    <!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=4451884">[GeoNetwork-commit] SF.net SVN: geonetwork: [947] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;acarboni@us...&gt; -	2007-10-19 22:34</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 947
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=947&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=947&amp;view=rev</a>
Author:   acarboni
Date:     2007-10-19 15:35:00 -0700 (Fri, 19 Oct 2007)

Log Message:
-----------
Added popularity and rating mechanism

Modified Paths:
--------------
    trunk/docs/changes.txt
    trunk/docs/lyx/server-reference.lyx
    trunk/docs/manuals/server-reference.pdf
    trunk/gast/setup/database.druid
    trunk/gast/setup/sql/create-db-mckoi.sql
    trunk/gast/setup/sql/create-db-mysql.sql
    trunk/gast/setup/sql/create-db-oracle.sql
    trunk/gast/setup/sql/create-db-postgres.sql
    trunk/src/org/fao/geonet/constants/Edit.java
    trunk/src/org/fao/geonet/constants/Geonet.java
    trunk/src/org/fao/geonet/constants/Params.java
    trunk/src/org/fao/geonet/kernel/DataManager.java
    trunk/src/org/fao/geonet/kernel/harvest/HarvestManager.java
    trunk/src/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java
    trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet/Aligner.java
    trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet/GeonetHarvester.java
    trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet20/Geonet20Harvester.java
    trunk/src/org/fao/geonet/kernel/mef/Exporter.java
    trunk/src/org/fao/geonet/kernel/mef/Importer.java
    trunk/src/org/fao/geonet/kernel/mef/MEFConstants.java
    trunk/src/org/fao/geonet/kernel/search/LuceneSearcher.java
    trunk/src/org/fao/geonet/lib/Lib.java
    trunk/src/org/fao/geonet/services/login/Login.java
    trunk/src/org/fao/geonet/services/metadata/Show.java
    trunk/src/org/fao/geonet/services/resources/Download.java
    trunk/src/org/fao/geonet/services/util/MainUtil.java
    trunk/web/geonetwork/WEB-INF/config-metadata.xml
    trunk/web/geonetwork/WEB-INF/config.xml
    trunk/web/geonetwork/geonetwork.css
    trunk/web/geonetwork/loc/en/xml/strings.xml
    trunk/web/geonetwork/scripts/gn_search.js
    trunk/web/geonetwork/xml/user-profiles.xml
    trunk/web/geonetwork/xsl/search-results-xhtml.xsl

Added Paths:
-----------
    trunk/src/org/fao/geonet/lib/MetadataLib.java
    trunk/src/org/fao/geonet/services/metadata/Rate.java
    trunk/web/geonetwork/xsl/rating-popup.xsl

Modified: trunk/docs/changes.txt
===================================================================
--- trunk/docs/changes.txt	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/docs/changes.txt	2007-10-19 22:35:00 UTC (rev 947)
@@ -19,6 +19,11 @@
 
 - Added text only search results for low bandwitdh connections 
 
+- Added metadata popularity concept (used to sort search results)
+
+- Added metadata rating system (used to sort search results). It is possible
+  to rate remote metadata harvested using the geonetwork's harvesting type.
+
 --------------------------------------------------------------------------------
 --- Changes
 --------------------------------------------------------------------------------

Modified: trunk/docs/lyx/server-reference.lyx
===================================================================
--- trunk/docs/lyx/server-reference.lyx	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/docs/lyx/server-reference.lyx	2007-10-19 22:35:00 UTC (rev 947)
@@ -106,7 +106,7 @@
 \align center
 
 \size larger
-Revision 9 (28-Aug-2007)
+Revision 10 (20-Oct-2007)
 \end_layout
 
 \begin_layout Standard
@@ -1098,7 +1098,7 @@
 
 \end_inset
 
-Metadata Exchange Format v1.0
+Metadata Exchange Format v1.1
 \end_layout
 
 \begin_layout Section
@@ -1537,6 +1537,51 @@
  }.
 \end_layout
 
+\begin_layout Itemize
+
+\family sans
+\series bold
+rating
+\family default
+\series default
+ : This is an optional element.
+ If present, indicates the users' rating of the metadata ranging from 
+\family sans
+\series bold
+1
+\family default
+\series default
+ (a bad rating) to 
+\family sans
+\series bold
+5
+\family default
+\series default
+ (an excellent rating).
+ The special value 
+\family sans
+\series bold
+0
+\family default
+\series default
+ means that the metadata has not been rated yet.
+ Can be used to sort search results.
+\end_layout
+
+\begin_layout Itemize
+
+\family sans
+\series bold
+popularity
+\family default
+\series default
+ : Another optional value.
+ If present, indicates the popularity of the metadata.
+ The value must be positive and high values mean high popularity.
+ The criteria used to set the popularity is left to the writer.
+ Its main purpose is to provide a metadata ordering during a search.
+\end_layout
+
 \end_deeper
 \begin_layout Itemize
 

Modified: trunk/docs/manuals/server-reference.pdf
===================================================================
(Binary files differ)

Modified: trunk/gast/setup/database.druid
===================================================================
--- trunk/gast/setup/database.druid	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/gast/setup/database.druid	2007-10-19 22:35:00 UTC (rev 947)
@@ -2,8 +2,8 @@
 
 &lt;project version="2"&gt;
 	&lt;attribs&gt;
-		&lt;attrib name="build"&gt;145&lt;/attrib&gt;
-		&lt;attrib name="serial"&gt;63913&lt;/attrib&gt;
+		&lt;attrib name="build"&gt;148&lt;/attrib&gt;
+		&lt;attrib name="serial"&gt;65484&lt;/attrib&gt;
 	&lt;/attribs&gt;
 	&lt;database&gt;
 		&lt;attribs&gt;
@@ -633,6 +633,27 @@
 								&lt;/list&gt;
 							&lt;/domain&gt;
 						&lt;/alias&gt;
+						&lt;alias&gt;
+							&lt;attribs&gt;
+								&lt;attrib name="name"&gt;IPAddress&lt;/attrib&gt;
+								&lt;attrib name="ddEquiv"/&gt;
+								&lt;attrib name="id"&gt;64699&lt;/attrib&gt;
+								&lt;attrib name="size"&gt;32&lt;/attrib&gt;
+							&lt;/attribs&gt;
+							&lt;domain&gt;
+								&lt;attribs&gt;
+									&lt;attrib name="minValue"/&gt;
+									&lt;attrib name="outRange"&gt;false&lt;/attrib&gt;
+									&lt;attrib name="maxValue"/&gt;
+									&lt;attrib name="type"&gt;none&lt;/attrib&gt;
+								&lt;/attribs&gt;
+								&lt;list&gt;
+									&lt;header&gt;
+										&lt;elem&gt;value&lt;/elem&gt;
+									&lt;/header&gt;
+								&lt;/list&gt;
+							&lt;/domain&gt;
+						&lt;/alias&gt;
 					&lt;/aliases&gt;
 				&lt;/type&gt;
 			&lt;/varFolder&gt;
@@ -1369,6 +1390,59 @@
 						&lt;/attribs&gt;
 						&lt;modsConfig/&gt;
 					&lt;/field&gt;
+					&lt;field&gt;
+						&lt;fieldAttribs&gt;
+							&lt;attribs&gt;
+								&lt;attrib name="63909"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="54374"&gt;0&lt;/attrib&gt;
+								&lt;attrib name="61528"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="17"&gt;true&lt;/attrib&gt;
+								&lt;attrib name="15"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="340"&gt;false&lt;/attrib&gt;
+							&lt;/attribs&gt;
+						&lt;/fieldAttribs&gt;
+						&lt;attribs&gt;
+							&lt;attrib name="comment"/&gt;
+							&lt;attrib name="matchType"&gt;s&lt;/attrib&gt;
+							&lt;attrib name="refField"&gt;0&lt;/attrib&gt;
+							&lt;attrib name="name"&gt;rating&lt;/attrib&gt;
+							&lt;attrib name="id"&gt;63916&lt;/attrib&gt;
+							&lt;attrib name="onDelete"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="onUpdate"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="refTable"&gt;0&lt;/attrib&gt;
+							&lt;attrib name="type"&gt;5&lt;/attrib&gt;
+						&lt;/attribs&gt;
+						&lt;modsConfig/&gt;
+						&lt;docs&gt;
+							&lt;p&gt;
+								&lt;t&gt;Range is 0..5&lt;/t&gt;
+							&lt;/p&gt;
+						&lt;/docs&gt;
+					&lt;/field&gt;
+					&lt;field&gt;
+						&lt;fieldAttribs&gt;
+							&lt;attribs&gt;
+								&lt;attrib name="63909"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="54374"&gt;0&lt;/attrib&gt;
+								&lt;attrib name="61528"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="17"&gt;true&lt;/attrib&gt;
+								&lt;attrib name="15"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="340"&gt;false&lt;/attrib&gt;
+							&lt;/attribs&gt;
+						&lt;/fieldAttribs&gt;
+						&lt;attribs&gt;
+							&lt;attrib name="comment"/&gt;
+							&lt;attrib name="matchType"&gt;s&lt;/attrib&gt;
+							&lt;attrib name="refField"&gt;0&lt;/attrib&gt;
+							&lt;attrib name="name"&gt;popularity&lt;/attrib&gt;
+							&lt;attrib name="id"&gt;63917&lt;/attrib&gt;
+							&lt;attrib name="onDelete"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="onUpdate"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="refTable"&gt;0&lt;/attrib&gt;
+							&lt;attrib name="type"&gt;5&lt;/attrib&gt;
+						&lt;/attribs&gt;
+						&lt;modsConfig/&gt;
+					&lt;/field&gt;
 				&lt;/table&gt;
 				&lt;table&gt;
 					&lt;vars&gt;
@@ -1738,6 +1812,11 @@
 											&lt;elem&gt;Idx1&lt;/elem&gt;
 											&lt;elem/&gt;
 										&lt;/row&gt;
+										&lt;row&gt;
+											&lt;elem&gt;63909&lt;/elem&gt;
+											&lt;elem&gt;Idx2&lt;/elem&gt;
+											&lt;elem/&gt;
+										&lt;/row&gt;
 									&lt;/list&gt;
 								&lt;/idx&gt;
 							&lt;/stdSql&gt;
@@ -1762,6 +1841,15 @@
 											&lt;elem&gt;false&lt;/elem&gt;
 											&lt;elem&gt;false&lt;/elem&gt;
 										&lt;/row&gt;
+										&lt;row&gt;
+											&lt;elem&gt;63909&lt;/elem&gt;
+											&lt;elem&gt;Idx2&lt;/elem&gt;
+											&lt;elem/&gt;
+											&lt;elem&gt;0&lt;/elem&gt;
+											&lt;elem&gt;false&lt;/elem&gt;
+											&lt;elem&gt;false&lt;/elem&gt;
+											&lt;elem&gt;false&lt;/elem&gt;
+										&lt;/row&gt;
 									&lt;/list&gt;
 								&lt;/idx&gt;
 							&lt;/oraSql&gt;
@@ -1778,6 +1866,11 @@
 											&lt;elem&gt;Idx1&lt;/elem&gt;
 											&lt;elem/&gt;
 										&lt;/row&gt;
+										&lt;row&gt;
+											&lt;elem&gt;63909&lt;/elem&gt;
+											&lt;elem&gt;Idx2&lt;/elem&gt;
+											&lt;elem/&gt;
+										&lt;/row&gt;
 									&lt;/list&gt;
 								&lt;/idx&gt;
 							&lt;/mckoiSql&gt;
@@ -1798,6 +1891,13 @@
 											&lt;elem&gt;default&lt;/elem&gt;
 											&lt;elem/&gt;
 										&lt;/row&gt;
+										&lt;row&gt;
+											&lt;elem&gt;63909&lt;/elem&gt;
+											&lt;elem&gt;Idx2&lt;/elem&gt;
+											&lt;elem/&gt;
+											&lt;elem&gt;default&lt;/elem&gt;
+											&lt;elem/&gt;
+										&lt;/row&gt;
 									&lt;/list&gt;
 								&lt;/idx&gt;
 							&lt;/pgSql&gt;
@@ -1852,6 +1952,208 @@
 						&lt;modsConfig/&gt;
 					&lt;/field&gt;
 				&lt;/table&gt;
+				&lt;table&gt;
+					&lt;vars&gt;
+						&lt;list&gt;
+							&lt;header&gt;
+								&lt;elem&gt;name&lt;/elem&gt;
+								&lt;elem&gt;type&lt;/elem&gt;
+								&lt;elem&gt;value&lt;/elem&gt;
+								&lt;elem&gt;descr&lt;/elem&gt;
+							&lt;/header&gt;
+						&lt;/list&gt;
+					&lt;/vars&gt;
+					&lt;triggers/&gt;
+					&lt;rules/&gt;
+					&lt;attribs&gt;
+						&lt;attrib name="comment"/&gt;
+						&lt;attrib name="name"&gt;MetadataRating&lt;/attrib&gt;
+						&lt;attrib name="id"&gt;64377&lt;/attrib&gt;
+						&lt;attrib name="schema"/&gt;
+						&lt;attrib name="tempPK"/&gt;
+						&lt;attrib name="tempFK"/&gt;
+						&lt;attrib name="tempOther"/&gt;
+						&lt;attrib name="sqlCommands"/&gt;
+					&lt;/attribs&gt;
+					&lt;modsConfig&gt;
+						&lt;SqlGenModule&gt;
+							&lt;stdSql&gt;
+								&lt;idx type="l"&gt;
+									&lt;list&gt;
+										&lt;header&gt;
+											&lt;elem type="i"&gt;id&lt;/elem&gt;
+											&lt;elem type="s"&gt;index&lt;/elem&gt;
+											&lt;elem type="s"&gt;name&lt;/elem&gt;
+										&lt;/header&gt;
+										&lt;row&gt;
+											&lt;elem&gt;61528&lt;/elem&gt;
+											&lt;elem&gt;Idx1&lt;/elem&gt;
+											&lt;elem/&gt;
+										&lt;/row&gt;
+										&lt;row&gt;
+											&lt;elem&gt;63909&lt;/elem&gt;
+											&lt;elem&gt;Idx2&lt;/elem&gt;
+											&lt;elem/&gt;
+										&lt;/row&gt;
+									&lt;/list&gt;
+								&lt;/idx&gt;
+							&lt;/stdSql&gt;
+							&lt;oraSql&gt;
+								&lt;idx type="l"&gt;
+									&lt;list&gt;
+										&lt;header&gt;
+											&lt;elem type="i"&gt;id&lt;/elem&gt;
+											&lt;elem type="s"&gt;index&lt;/elem&gt;
+											&lt;elem type="s"&gt;name&lt;/elem&gt;
+											&lt;elem type="i"&gt;ts&lt;/elem&gt;
+											&lt;elem type="b"&gt;bitmap&lt;/elem&gt;
+											&lt;elem type="b"&gt;stats&lt;/elem&gt;
+											&lt;elem type="b"&gt;noSort&lt;/elem&gt;
+										&lt;/header&gt;
+										&lt;row&gt;
+											&lt;elem&gt;61528&lt;/elem&gt;
+											&lt;elem&gt;Idx1&lt;/elem&gt;
+											&lt;elem/&gt;
+											&lt;elem&gt;0&lt;/elem&gt;
+											&lt;elem&gt;false&lt;/elem&gt;
+											&lt;elem&gt;false&lt;/elem&gt;
+											&lt;elem&gt;false&lt;/elem&gt;
+										&lt;/row&gt;
+										&lt;row&gt;
+											&lt;elem&gt;63909&lt;/elem&gt;
+											&lt;elem&gt;Idx2&lt;/elem&gt;
+											&lt;elem/&gt;
+											&lt;elem&gt;0&lt;/elem&gt;
+											&lt;elem&gt;false&lt;/elem&gt;
+											&lt;elem&gt;false&lt;/elem&gt;
+											&lt;elem&gt;false&lt;/elem&gt;
+										&lt;/row&gt;
+									&lt;/list&gt;
+								&lt;/idx&gt;
+							&lt;/oraSql&gt;
+							&lt;pgSql&gt;
+								&lt;idx type="l"&gt;
+									&lt;list&gt;
+										&lt;header&gt;
+											&lt;elem type="i"&gt;id&lt;/elem&gt;
+											&lt;elem type="s"&gt;index&lt;/elem&gt;
+											&lt;elem type="s"&gt;name&lt;/elem&gt;
+											&lt;elem type="s"&gt;access&lt;/elem&gt;
+											&lt;elem type="s"&gt;where&lt;/elem&gt;
+										&lt;/header&gt;
+										&lt;row&gt;
+											&lt;elem&gt;61528&lt;/elem&gt;
+											&lt;elem&gt;Idx1&lt;/elem&gt;
+											&lt;elem/&gt;
+											&lt;elem&gt;default&lt;/elem&gt;
+											&lt;elem/&gt;
+										&lt;/row&gt;
+										&lt;row&gt;
+											&lt;elem&gt;63909&lt;/elem&gt;
+											&lt;elem&gt;Idx2&lt;/elem&gt;
+											&lt;elem/&gt;
+											&lt;elem&gt;default&lt;/elem&gt;
+											&lt;elem/&gt;
+										&lt;/row&gt;
+									&lt;/list&gt;
+								&lt;/idx&gt;
+							&lt;/pgSql&gt;
+							&lt;mckoiSql&gt;
+								&lt;idx type="l"&gt;
+									&lt;list&gt;
+										&lt;header&gt;
+											&lt;elem type="i"&gt;id&lt;/elem&gt;
+											&lt;elem type="s"&gt;index&lt;/elem&gt;
+											&lt;elem type="s"&gt;name&lt;/elem&gt;
+										&lt;/header&gt;
+										&lt;row&gt;
+											&lt;elem&gt;61528&lt;/elem&gt;
+											&lt;elem&gt;Idx1&lt;/elem&gt;
+											&lt;elem/&gt;
+										&lt;/row&gt;
+										&lt;row&gt;
+											&lt;elem&gt;63909&lt;/elem&gt;
+											&lt;elem&gt;Idx2&lt;/elem&gt;
+											&lt;elem/&gt;
+										&lt;/row&gt;
+									&lt;/list&gt;
+								&lt;/idx&gt;
+							&lt;/mckoiSql&gt;
+						&lt;/SqlGenModule&gt;
+					&lt;/modsConfig&gt;
+					&lt;field&gt;
+						&lt;fieldAttribs&gt;
+							&lt;attribs&gt;
+								&lt;attrib name="63909"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="54374"/&gt;
+								&lt;attrib name="61528"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="17"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="15"&gt;true&lt;/attrib&gt;
+								&lt;attrib name="340"&gt;false&lt;/attrib&gt;
+							&lt;/attribs&gt;
+						&lt;/fieldAttribs&gt;
+						&lt;attribs&gt;
+							&lt;attrib name="comment"/&gt;
+							&lt;attrib name="matchType"&gt;s&lt;/attrib&gt;
+							&lt;attrib name="refField"&gt;44102&lt;/attrib&gt;
+							&lt;attrib name="name"&gt;metadataId&lt;/attrib&gt;
+							&lt;attrib name="id"&gt;64386&lt;/attrib&gt;
+							&lt;attrib name="onDelete"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="onUpdate"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="refTable"&gt;44101&lt;/attrib&gt;
+							&lt;attrib name="type"&gt;0&lt;/attrib&gt;
+						&lt;/attribs&gt;
+						&lt;modsConfig/&gt;
+					&lt;/field&gt;
+					&lt;field&gt;
+						&lt;fieldAttribs&gt;
+							&lt;attribs&gt;
+								&lt;attrib name="63909"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="54374"/&gt;
+								&lt;attrib name="61528"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="17"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="15"&gt;true&lt;/attrib&gt;
+								&lt;attrib name="340"&gt;false&lt;/attrib&gt;
+							&lt;/attribs&gt;
+						&lt;/fieldAttribs&gt;
+						&lt;attribs&gt;
+							&lt;attrib name="comment"/&gt;
+							&lt;attrib name="matchType"&gt;s&lt;/attrib&gt;
+							&lt;attrib name="refField"&gt;0&lt;/attrib&gt;
+							&lt;attrib name="name"&gt;ipAddress&lt;/attrib&gt;
+							&lt;attrib name="id"&gt;64387&lt;/attrib&gt;
+							&lt;attrib name="onDelete"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="onUpdate"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="refTable"&gt;0&lt;/attrib&gt;
+							&lt;attrib name="type"&gt;64699&lt;/attrib&gt;
+						&lt;/attribs&gt;
+						&lt;modsConfig/&gt;
+					&lt;/field&gt;
+					&lt;field&gt;
+						&lt;fieldAttribs&gt;
+							&lt;attribs&gt;
+								&lt;attrib name="63909"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="54374"/&gt;
+								&lt;attrib name="61528"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="17"&gt;true&lt;/attrib&gt;
+								&lt;attrib name="15"&gt;false&lt;/attrib&gt;
+								&lt;attrib name="340"&gt;false&lt;/attrib&gt;
+							&lt;/attribs&gt;
+						&lt;/fieldAttribs&gt;
+						&lt;attribs&gt;
+							&lt;attrib name="comment"/&gt;
+							&lt;attrib name="matchType"&gt;s&lt;/attrib&gt;
+							&lt;attrib name="refField"&gt;0&lt;/attrib&gt;
+							&lt;attrib name="name"&gt;rating&lt;/attrib&gt;
+							&lt;attrib name="id"&gt;64388&lt;/attrib&gt;
+							&lt;attrib name="onDelete"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="onUpdate"&gt;n&lt;/attrib&gt;
+							&lt;attrib name="refTable"&gt;0&lt;/attrib&gt;
+							&lt;attrib name="type"&gt;5&lt;/attrib&gt;
+						&lt;/attribs&gt;
+						&lt;modsConfig/&gt;
+					&lt;/field&gt;
+				&lt;/table&gt;
 			&lt;/folder&gt;
 			&lt;folder&gt;
 				&lt;attribs&gt;

Modified: trunk/gast/setup/sql/create-db-mckoi.sql
===================================================================
--- trunk/gast/setup/sql/create-db-mckoi.sql	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/gast/setup/sql/create-db-mckoi.sql	2007-10-19 22:35:00 UTC (rev 947)
@@ -1,7 +1,7 @@
 -- ======================================================================
 -- ===   Sql Script for Database : Geonet
 -- ===
--- === Build : 145
+-- === Build : 148
 -- ======================================================================
 
 CREATE TABLE Relations
@@ -233,6 +233,8 @@
     owner        int            not null,
     groupOwner   int,
     harvestUri   varchar(255),
+    rating       int            default 0 not null,
+    popularity   int            default 0 not null,
 
     primary key(id),
     unique(uuid,source,harvestUuid),
@@ -274,3 +276,16 @@
 
 -- ======================================================================
 
+CREATE TABLE MetadataRating
+  (
+    metadataId  int,
+    ipAddress   varchar(32),
+    rating      int           not null,
+
+    primary key(metadataId,ipAddress),
+
+    foreign key(metadataId) references Metadata(id)
+  );
+
+-- ======================================================================
+

Modified: trunk/gast/setup/sql/create-db-mysql.sql
===================================================================
--- trunk/gast/setup/sql/create-db-mysql.sql	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/gast/setup/sql/create-db-mysql.sql	2007-10-19 22:35:00 UTC (rev 947)
@@ -1,7 +1,7 @@
 -- ======================================================================
 -- ===   Sql Script for Database : Geonet
 -- ===
--- === Build : 145
+-- === Build : 148
 -- ======================================================================
 
 CREATE TABLE Relations
@@ -233,6 +233,8 @@
     owner        int            not null,
     groupOwner   int,
     harvestUri   varchar(255),
+    rating       int            default 0 not null,
+    popularity   int            default 0 not null,
 
     primary key(id),
     unique(uuid,source,harvestUuid),
@@ -274,3 +276,16 @@
 
 -- ======================================================================
 
+CREATE TABLE MetadataRating
+  (
+    metadataId  int,
+    ipAddress   varchar(32),
+    rating      int           not null,
+
+    primary key(metadataId,ipAddress),
+
+    foreign key(metadataId) references Metadata(id)
+  );
+
+-- ======================================================================
+

Modified: trunk/gast/setup/sql/create-db-oracle.sql
===================================================================
--- trunk/gast/setup/sql/create-db-oracle.sql	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/gast/setup/sql/create-db-oracle.sql	2007-10-19 22:35:00 UTC (rev 947)
@@ -1,7 +1,7 @@
 REM ======================================================================
 REM ===   Sql Script for Database : Geonet
 REM ===
-REM === Build : 145
+REM === Build : 148
 REM ======================================================================
 
 CREATE TABLE Relations
@@ -209,6 +209,8 @@
     owner        int            not null,
     groupOwner   int,
     harvestUri   varchar(255),
+    rating       int            default 0 not null,
+    popularity   int            default 0 not null,
     primary key(id),
     unique(uuid,source,harvestUuid),
     foreign key(owner) references Users(id),
@@ -244,3 +246,14 @@
 
 REM ======================================================================
 
+CREATE TABLE MetadataRating
+  (
+    metadataId  int,
+    ipAddress   varchar(32),
+    rating      int           not null,
+    primary key(metadataId,ipAddress),
+    foreign key(metadataId) references Metadata(id)
+  );
+
+REM ======================================================================
+

Modified: trunk/gast/setup/sql/create-db-postgres.sql
===================================================================
--- trunk/gast/setup/sql/create-db-postgres.sql	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/gast/setup/sql/create-db-postgres.sql	2007-10-19 22:35:00 UTC (rev 947)
@@ -1,7 +1,7 @@
 -- ======================================================================
 -- ===   Sql Script for Database : Geonet
 -- ===
--- === Build : 145
+-- === Build : 148
 -- ======================================================================
 
 CREATE TABLE Relations
@@ -233,6 +233,8 @@
     owner        int            not null,
     groupOwner   int,
     harvestUri   varchar(255),
+    rating       int            default 0 not null,
+    popularity   int            default 0 not null,
 
     primary key(id),
     unique(uuid,source,harvestUuid),
@@ -274,3 +276,16 @@
 
 -- ======================================================================
 
+CREATE TABLE MetadataRating
+  (
+    metadataId  int,
+    ipAddress   varchar(32),
+    rating      int           not null,
+
+    primary key(metadataId,ipAddress),
+
+    foreign key(metadataId) references Metadata(id)
+  );
+
+-- ======================================================================
+

Modified: trunk/src/org/fao/geonet/constants/Edit.java
===================================================================
--- trunk/src/org/fao/geonet/constants/Edit.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/constants/Edit.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -77,6 +77,8 @@
 			public static final String TITLE       = "title";
 			public static final String IS_HARVESTED= "isHarvested";
 			public static final String HARVEST_INFO= "harvestInfo";
+			public static final String POPULARITY  = "popularity";
+			public static final String RATING      = "rating";
 
 			//--- privileges
 

Modified: trunk/src/org/fao/geonet/constants/Geonet.java
===================================================================
--- trunk/src/org/fao/geonet/constants/Geonet.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/constants/Geonet.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -264,6 +264,7 @@
 		public static final String XML_INFO          = "xml.info";
 		public static final String XML_SEARCH        = "xml.search";
 		public static final String XML_METADATA_GET  = "xml.metadata.get";
+		public static final String XML_METADATA_RATE = "xml.metadata.rate";
 		public static final String MEF_IMPORT        = "mef.import";
 		public static final String MEF_EXPORT        = "mef.export";
 	}

Modified: trunk/src/org/fao/geonet/constants/Params.java
===================================================================
--- trunk/src/org/fao/geonet/constants/Params.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/constants/Params.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -44,6 +44,7 @@
 	public static final String GROUP        = "group";
 	public static final String GROUPS       = "groups";
 	public static final String ID           = "id";
+	public static final String UUID         = "uuid";
 	public static final String URI          = "uri";
 	public static final String NAME         = "name";
 	public static final String ORG          = "org";
@@ -68,6 +69,7 @@
 	public static final String ZIP          = "zip";
 	public static final String COUNTRY      = "country";
 	public static final String KIND         = "kind";
+	public static final String RATING       = "rating";
 
 	public static final String SCALING              = "scaling";
 	public static final String SCALING_DIR          = "scalingDir";

Modified: trunk/src/org/fao/geonet/kernel/DataManager.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/DataManager.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/DataManager.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -110,7 +110,7 @@
 			{
 				docs.remove(id);
 
-				String lastChange = record.getChildText("changedate");
+				String lastChange    = record.getChildText("changedate");
 				String idxLastChange = (String)idxRec.get("_changeDate");
 
 				// System.out.println("  - lastChange: " + lastChange); // DEBUG
@@ -164,7 +164,7 @@
 		String  root = md.getName();
 
 		String query ="SELECT schemaId, createDate, changeDate, source, isTemplate, title, uuid, "+
-									"isHarvested, owner, groupOwner FROM Metadata WHERE id = " + id;
+									"isHarvested, owner, groupOwner, popularity, rating FROM Metadata WHERE id = " + id;
 
 		Element rec = dbms.select(query).getChild("record");
 
@@ -178,6 +178,8 @@
 		String  isHarvested= rec.getChildText("isharvested");
 		String  owner      = rec.getChildText("owner");
 		String  groupOwner = rec.getChildText("groupowner");
+		String  popularity = rec.getChildText("popularity");
+		String  rating     = rec.getChildText("rating");
 
 		moreFields.add(makeField("_root",        root,        true, true, false));
 		moreFields.add(makeField("_schema",      schema,      true, true, false));
@@ -190,6 +192,8 @@
 		moreFields.add(makeField("_isHarvested", isHarvested, true, true, false));
 		moreFields.add(makeField("_owner",       owner,       true, true, false));
 		moreFields.add(makeField("_dummy",       "0",        false, true, false));
+		moreFields.add(makeField("_popularity",  popularity,  true, true, false));
+		moreFields.add(makeField("_rating",      rating,      true, true, false));
 
 		if (groupOwner != null)
 			moreFields.add(makeField("_groupOwner", groupOwner, true, true, false));
@@ -496,6 +500,62 @@
 	}
 
 	//--------------------------------------------------------------------------
+
+	public void increasePopularity(Dbms dbms, String id) throws Exception
+	{
+		String query = "UPDATE Metadata SET popularity = popularity +1 WHERE "+
+							"id = ? AND isHarvested='n'";
+
+		dbms.execute(query, new Integer(id));
+		indexMetadata(dbms, id);
+	}
+
+	//--------------------------------------------------------------------------
+	/** Allow to rate a metadata
+	  * @param ipAddress IP address of the submitting client
+	  * @param rating range should be 1..5
+	  */
+
+	public int rateMetadata(Dbms dbms, int id, String ipAddress, int rating) throws Exception
+	{
+		//--- first, update rating on the database
+
+		String query = "UPDATE MetadataRating SET rating=? WHERE metadataId=? AND ipAddress=?";
+
+		int res = dbms.execute(query, rating, id, ipAddress);
+
+		if (res == 0)
+		{
+			query = "INSERT INTO MetadataRating(metadataId, ipAddress, rating) VALUES(?,?,?)";
+			dbms.execute(query, id, ipAddress, rating);
+		}
+
+		//--- then, calculate new rating
+
+		query = "SELECT sum(rating) as total FROM MetadataRating WHERE metadataId=?";
+		List list = dbms.select(query, id).getChildren();
+
+		String sum = ((Element) list.get(0)).getChildText("total");
+
+		query = "SELECT count(*) as numr FROM MetadataRating WHERE metadataId=?";
+		list  = dbms.select(query, id).getChildren();
+
+		String count = ((Element) list.get(0)).getChildText("numr");
+
+		rating = (int)(Float.parseFloat(sum) / Float.parseFloat(count) + 0.5);
+
+		Log.debug(Geonet.DATA_MANAGER, "Setting rating for id:"+ id +" --&gt; rating is:"+rating);
+
+		//--- finally, update metadata and reindex it
+
+		query = "UPDATE Metadata SET rating=? WHERE id=?";
+		dbms.execute(query, rating, id);
+		indexMetadata(dbms, Integer.toString(id));
+
+		return rating;
+	}
+
+	//--------------------------------------------------------------------------
 	//---
 	//--- Metadata Insert API
 	//---
@@ -1082,6 +1142,8 @@
 		//--- remove categories
 		deleteAllMetadataCateg(dbms, id);
 
+		dbms.execute("DELETE FROM MetadataRating WHERE metadataId=?", new Integer(id));
+
 		//--- remove metadata
 		XmlSerializer.delete(dbms, "Metadata", id);
 
@@ -1395,7 +1457,7 @@
 		Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
 
 		String query ="SELECT schemaId, createDate, changeDate, source, isTemplate, title, "+
-									"uuid, isHarvested, harvestUuid FROM Metadata WHERE id = " + id;
+									"uuid, isHarvested, harvestUuid, popularity, rating FROM Metadata WHERE id = " + id;
 
 		// add Metadata table infos: schemaId, createDate, changeDate, source,
 		Element rec = dbms.select(query).getChild("record");
@@ -1409,6 +1471,8 @@
 		String  uuid       = rec.getChildText("uuid");
 		String  isHarvested= rec.getChildText("isharvested");
 		String  harvestUuid= rec.getChildText("harvestuuid");
+		String  popularity = rec.getChildText("popularity");
+		String  rating     = rec.getChildText("rating");
 
 		Element info = new Element(Edit.RootChild.INFO, Edit.NAMESPACE);
 
@@ -1421,6 +1485,8 @@
 		addElement(info, Edit.Info.Elem.SOURCE,      source);
 		addElement(info, Edit.Info.Elem.UUID,        uuid);
 		addElement(info, Edit.Info.Elem.IS_HARVESTED,isHarvested);
+		addElement(info, Edit.Info.Elem.POPULARITY,  popularity);
+		addElement(info, Edit.Info.Elem.RATING,      rating);
 
 		if (isHarvested.equals("y"))
 			info.addContent(harvestMan.getHarvestInfo(harvestUuid, id, uuid));

Modified: trunk/src/org/fao/geonet/kernel/harvest/HarvestManager.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/harvest/HarvestManager.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/harvest/HarvestManager.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -240,6 +240,13 @@
 	}
 
 	//---------------------------------------------------------------------------
+
+	public AbstractHarvester getHarvester(String harvestUuid)
+	{
+		return hmHarvestLookup.get(harvestUuid);
+	}
+
+	//---------------------------------------------------------------------------
 	//---
 	//--- Private methods
 	//---

Modified: trunk/src/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -282,7 +282,10 @@
 	/** Adds harvesting information to each metadata element. Some sites can generate
 	  * url for thumbnails */
 
-	public void addHarvestInfo(Element info, String id, String uuid) {}
+	public void addHarvestInfo(Element info, String id, String uuid)
+	{
+		info.addContent(new Element("type").setText(getType()));
+	}
 
 	//---------------------------------------------------------------------------
 	//---

Modified: trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet/Aligner.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet/Aligner.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet/Aligner.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -234,6 +234,8 @@
 		String changeDate = general.getChildText("changeDate");
 		String isTemplate = general.getChildText("isTemplate");
 		String siteId     = general.getChildText("siteId");
+		String rating     = general.getChildText("rating");
+		String popularity = general.getChildText("popularity");
 
 		if ("true".equals(isTemplate))	isTemplate = "y";
 			else 									isTemplate = "n";
@@ -248,6 +250,12 @@
 		dataMan.setTemplate(dbms, iId, isTemplate, null);
 		dataMan.setHarvested(dbms, iId, params.uuid);
 
+		if (rating != null)
+			dbms.execute("UPDATE Metadata SET rating=? WHERE id=?", new Integer(rating), iId);
+
+		if (popularity != null)
+			dbms.execute("UPDATE Metadata SET popularity=? WHERE id=?", new Integer(popularity), iId);
+
 		String pubDir = Lib.resource.getDir(context, "public",  id);
 		String priDir = Lib.resource.getDir(context, "private", id);
 
@@ -481,6 +489,17 @@
 			result.updatedMetadata++;
 		}
 
+		Element general = info.getChild("general");
+
+		String rating     = general.getChildText("rating");
+		String popularity = general.getChildText("popularity");
+
+		if (rating != null)
+			dbms.execute("UPDATE Metadata SET rating=? WHERE id=?", new Integer(rating), new Integer(id));
+
+		if (popularity != null)
+			dbms.execute("UPDATE Metadata SET popularity=? WHERE id=?", new Integer(popularity), new Integer(id));
+
 		dbms.execute("DELETE FROM MetadataCateg WHERE metadataId=?", Integer.parseInt(id));
 		addCategories(id);
 

Modified: trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet/GeonetHarvester.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet/GeonetHarvester.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet/GeonetHarvester.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -41,6 +41,8 @@
 
 public class GeonetHarvester extends AbstractHarvester
 {
+	public static final String TYPE = "geonetwork";
+
 	//--------------------------------------------------------------------------
 	//---
 	//--- Static init
@@ -55,7 +57,7 @@
 	//---
 	//--------------------------------------------------------------------------
 
-	public String getType() { return "geonetwork"; }
+	public String getType() { return TYPE; }
 
 	//--------------------------------------------------------------------------
 	//---
@@ -181,10 +183,12 @@
 
 	public void addHarvestInfo(Element info, String id, String uuid)
 	{
-		String small = "/"+ context.getBaseUrl() +
+		super.addHarvestInfo(info, id, uuid);
+
+		String small = context.getBaseUrl() +
 							"/srv/en/resources.get?access=public&amp;id="+id+"&amp;fname=";
 
-		String large = "/"+ context.getBaseUrl() +
+		String large = context.getBaseUrl() +
 							"/srv/en/graphover.show?access=public&amp;id="+id+"&amp;fname=";
 
 		info.addContent(new Element("smallThumbnail").setText(small));

Modified: trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet20/Geonet20Harvester.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet20/Geonet20Harvester.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/harvest/harvester/geonet20/Geonet20Harvester.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -179,6 +179,8 @@
 
 	public void addHarvestInfo(Element info, String id, String uuid)
 	{
+		super.addHarvestInfo(info, id, uuid);
+
 		String small = "http://"+ params.host +":"+ params.port +"/"+ params.servlet +
 							"/srv/en/resources.get2?access=public&amp;uuid="+uuid+"&amp;fname=";
 

Modified: trunk/src/org/fao/geonet/kernel/mef/Exporter.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/mef/Exporter.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/mef/Exporter.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -218,6 +218,8 @@
 		String createDate = md.getChildText("createdate");
 		String changeDate = md.getChildText("changedate");
 		String siteId     = md.getChildText("source");
+		String rating     = md.getChildText("rating");
+		String popularity = md.getChildText("popularity");
 
 		Element general = new Element("general")
 			.addContent(new Element("createDate").setText(createDate))
@@ -225,7 +227,9 @@
 			.addContent(new Element("schema")    .setText(schema))
 			.addContent(new Element("isTemplate").setText(isTemplate))
 			.addContent(new Element("localId")   .setText(id))
-			.addContent(new Element("format")    .setText(format.toString()));
+			.addContent(new Element("format")    .setText(format.toString()))
+			.addContent(new Element("rating")    .setText(rating))
+			.addContent(new Element("popularity").setText(popularity));
 
 		if (!skipUUID)
 		{

Modified: trunk/src/org/fao/geonet/kernel/mef/Importer.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/mef/Importer.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/mef/Importer.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -88,6 +88,8 @@
 				String sourceName = general.getChildText("siteName");
 				String schema     = general.getChildText("schema");
 				String isTemplate = general.getChildText("isTemplate").equals("true") ? "y" : "n";
+				String rating     = general.getChildText("rating");
+				String popularity = general.getChildText("popularity");
 
 				boolean dcore  = schema.equals("dublin-core");
 				boolean fgdc   = schema.equals("fgdc-std");
@@ -121,6 +123,12 @@
 
 				int iId = Integer.parseInt(id[0]);
 
+				if (rating != null)
+					dbms.execute("UPDATE Metadata SET rating=? WHERE id=?", new Integer(rating), iId);
+
+				if (popularity != null)
+					dbms.execute("UPDATE Metadata SET popularity=? WHERE id=?", new Integer(popularity), iId);
+
 				dm.setTemplate(dbms, iId, isTemplate, null);
 				dm.setHarvested(dbms, iId, null);
 

Modified: trunk/src/org/fao/geonet/kernel/mef/MEFConstants.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/mef/MEFConstants.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/mef/MEFConstants.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -33,7 +33,7 @@
 	static final String DIR_PRIVATE   = "private/";
 	static final String FILE_METADATA = "metadata.xml";
 	static final String FILE_INFO     = "info.xml";
-	static final String VERSION       = "1.0";
+	static final String VERSION       = "1.1";
 }
 
 //=============================================================================

Modified: trunk/src/org/fao/geonet/kernel/search/LuceneSearcher.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/search/LuceneSearcher.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/kernel/search/LuceneSearcher.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -1,3 +1,4 @@
+//==============================================================================
 //===	Copyright (C) 2001-2007 Food and Agriculture Organization of the
 //===	United Nations (FAO-UN), United Nations World Food Programme (WFP)
 //===	and United Nations Environment Programme (UNEP)
@@ -35,6 +36,7 @@
 import jeeves.server.UserSession;
 import jeeves.server.context.ServiceContext;
 import jeeves.utils.Log;
+import jeeves.utils.Util;
 import jeeves.utils.Xml;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
@@ -48,6 +50,8 @@
 import org.apache.lucene.search.PrefixQuery;
 import org.apache.lucene.search.Query;
 import org.apache.lucene.search.RangeQuery;
+import org.apache.lucene.search.Sort;
+import org.apache.lucene.search.SortField;
 import org.apache.lucene.search.TermQuery;
 import org.apache.lucene.search.WildcardQuery;
 import org.fao.geonet.GeonetContext;
@@ -57,7 +61,7 @@
 import org.fao.geonet.lib.Lib;
 import org.jdom.Element;
 
-//--------------------------------------------------------------------------------
+//==============================================================================
 // search metadata locally using lucene
 //--------------------------------------------------------------------------------
 
@@ -89,14 +93,16 @@
 		throws Exception
 	{
 		computeQuery(srvContext, request, config);
-		performQuery();
+		performQuery(request);
 		initSearchRange(srvContext);
 	}
 
+	//--------------------------------------------------------------------------------
+
 	public Element present(ServiceContext srvContext, Element request, ServiceConfig config)
 		throws Exception
 	{
-		if (!isValid()) performQuery();
+		if (!isValid()) performQuery(request);
 
 		updateSearchRange(request);
 
@@ -149,11 +155,15 @@
 		return response;
 	}
 
+	//--------------------------------------------------------------------------------
+
 	public int getSize()
 	{
 		return _hits.length();
 	}
 
+	//--------------------------------------------------------------------------------
+
 	public Element getSummary() throws Exception
 	{
 		Element response =  new Element("response");
@@ -161,7 +171,9 @@
 		return response;
 	}
 
+	//--------------------------------------------------------------------------------
 	// RGFIX: check this
+
 	public void close()
 	{
 		try
@@ -218,22 +230,53 @@
 		_query = makeQuery(xmlQuery);
 	}
 
+	//--------------------------------------------------------------------------------
 	// perform the query
-	private void performQuery() throws Exception
+
+	private void performQuery(Element request) throws Exception
 	{
+		String sortBy = Util.getParam(request, Geonet.SearchResult.SORT_BY, Geonet.SearchResult.SortBy.RELEVANCE);
+
+		Log.debug(Geonet.SEARCH_ENGINE, "Sorting by : "+ sortBy);
+
+		Sort sort = null;
+
+		if (sortBy.equals(Geonet.SearchResult.SortBy.DATE))
+			sort = new Sort(new SortField[]
+								{
+									new SortField("_changeDate", SortField.STRING, true),
+									SortField.FIELD_SCORE
+								});
+
+		else if (sortBy.equals(Geonet.SearchResult.SortBy.POPULARITY))
+			sort = new Sort(new SortField[]
+								{
+									new SortField("_popularity", SortField.INT, true),
+									SortField.FIELD_SCORE
+								});
+
+		else if (sortBy.equals(Geonet.SearchResult.SortBy.RATING))
+			sort = new Sort(new SortField[]
+								{
+									new SortField("_rating", SortField.INT, true),
+									SortField.FIELD_SCORE
+								});
+
 		_reader = IndexReader.open(_sm.getLuceneDir());
 		_searcher = new IndexSearcher(_reader);
-		_hits = _searcher.search(_query);
+		_hits = _searcher.search(_query, sort);
 
-		// srvContext.log("METASEARCHER " + _styleSheetName + ": FOUND " + _hits.length() + " HITS"); // DEBUG
+		Log.debug(Geonet.SEARCH_ENGINE, "Hits found : "+ _hits.length());
 
 		makeSummary();
 
 		setValid(true);
 	}
 
+	//--------------------------------------------------------------------------------
 	// makes a new lucene query
 	// converts to lowercase if needed as the StandardAnalyzer
+
 	public static Query makeQuery(Element xmlQuery) throws Exception
 	{
 		String name = xmlQuery.getName();
@@ -307,6 +350,8 @@
 			throw new Exception("unknown lucene query type: " + name);
 	}
 
+	//--------------------------------------------------------------------------------
+
 	private void makeSummary() throws Exception
 	{
 		_elSummary = new Element("summary");
@@ -455,6 +500,8 @@
 		_elSummary.addContent(elSources);
 	}
 
+	//--------------------------------------------------------------------------------
+
 	private static Element getMetadataFromIndex(Document doc, String id)
 	{
 		String root       = doc.get("_root");
@@ -488,3 +535,5 @@
 	}
 }
 
+//==============================================================================
+

Modified: trunk/src/org/fao/geonet/lib/Lib.java
===================================================================
--- trunk/src/org/fao/geonet/lib/Lib.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/lib/Lib.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -34,6 +34,7 @@
 	public static TypeLib     type      = new TypeLib();
 	public static NetLib      net       = new NetLib();
 	public static SourcesLib  sources   = new SourcesLib();
+	public static MetadataLib metadata  = new MetadataLib();
 }
 
 //=============================================================================

Added: trunk/src/org/fao/geonet/lib/MetadataLib.java
===================================================================
--- trunk/src/org/fao/geonet/lib/MetadataLib.java	                        (rev 0)
+++ trunk/src/org/fao/geonet/lib/MetadataLib.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -0,0 +1,33 @@
+//=============================================================================
+//===	Copyright (C) 2001-2007 Food and Agriculture Organization of the
+//===	United Nations (FAO-UN), United Nations World Food Programme (WFP)
+//===	and United Nations Environment Programme (UNEP)
+//===
+//===	This program is free software; you can redistribute it and/or modify
+//===	it under the terms of the GNU General Public License as published by
+//===	the Free Software Foundation; either version 2 of the License, or (at
+//===	your option) any later version.
+//===
+//===	This program is distributed in the hope that it will be useful, but
+//===	WITHOUT ANY WARRANTY; without even the implied warranty of
+//===	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+//===	General Public License for more details.
+//===
+//===	You should have received a copy of the GNU General Public License
+//===	along with this program; if not, write to the Free Software
+//===	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+//===
+//===	Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
+//===	Rome - Italy. email: geonetwork@...
+//==============================================================================
+
+package org.fao.geonet.lib;
+
+//=============================================================================
+
+public class MetadataLib
+{
+}
+
+//=============================================================================
+

Modified: trunk/src/org/fao/geonet/services/login/Login.java
===================================================================
--- trunk/src/org/fao/geonet/services/login/Login.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/services/login/Login.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -96,7 +96,7 @@
 		String sSurname  = user.getChildText(Geonet.Elem.SURNAME);
 		String sProfile  = user.getChildText(Geonet.Elem.PROFILE);
 
-		context.info("User '" + user + "' logged in.");
+		context.info("User '"+ username +"' logged in as '"+ sProfile +"'");
 		context.getUserSession().authenticate(sId, username, sName, sSurname, sProfile);
 
 		return new Element("ok");

Added: trunk/src/org/fao/geonet/services/metadata/Rate.java
===================================================================
--- trunk/src/org/fao/geonet/services/metadata/Rate.java	                        (rev 0)
+++ trunk/src/org/fao/geonet/services/metadata/Rate.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -0,0 +1,171 @@
+//=============================================================================
+//===	Copyright (C) 2001-2007 Food and Agriculture Organization of the
+//===	United Nations (FAO-UN), United Nations World Food Programme (WFP)
+//===	and United Nations Environment Programme (UNEP)
+//===
+//===	This program is free software; you can redistribute it and/or modify
+//===	it under the terms of the GNU General Public License as published by
+//===	the Free Software Foundation; either version 2 of the License, or (at
+//===	your option) any later version.
+//===
+//===	This program is distributed in the hope that it will be useful, but
+//===	WITHOUT ANY WARRANTY; without even the implied warranty of
+//===	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+//===	General Public License for more details.
+//===
+//===	You should have received a copy of the GNU General Public License
+//===	along with this program; if not, write to the Free Software
+//===	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+//===
+//===	Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
+//===	Rome - Italy. email: geonetwork@...
+//==============================================================================
+
+package org.fao.geonet.services.metadata;
+
+import java.util.List;
+import jeeves.exceptions.BadParameterEx;
+import jeeves.exceptions.BadServerResponseEx;
+import jeeves.exceptions.MissingParameterEx;
+import jeeves.interfaces.Service;
+import jeeves.resources.dbms.Dbms;
+import jeeves.server.ServiceConfig;
+import jeeves.server.context.ServiceContext;
+import jeeves.utils.Util;
+import jeeves.utils.XmlRequest;
+import org.fao.geonet.GeonetContext;
+import org.fao.geonet.constants.Geonet;
+import org.fao.geonet.constants.Params;
+import org.fao.geonet.exceptions.MetadataNotFoundEx;
+import org.fao.geonet.kernel.DataManager;
+import org.fao.geonet.kernel.harvest.HarvestManager;
+import org.fao.geonet.kernel.harvest.harvester.AbstractHarvester;
+import org.fao.geonet.kernel.harvest.harvester.geonet.GeonetHarvester;
+import org.fao.geonet.kernel.harvest.harvester.geonet.GeonetParams;
+import org.fao.geonet.lib.Lib;
+import org.jdom.Element;
+
+//=============================================================================
+
+/** Allow to rate a metadata (local or harvested by the geonetwork harvesting type)
+  */
+
+public class Rate implements Service
+{
+	//--------------------------------------------------------------------------
+	//---
+	//--- Init
+	//---
+	//--------------------------------------------------------------------------
+
+	public void init(String appPath, ServiceConfig params) throws Exception {}
+
+	//--------------------------------------------------------------------------
+	//---
+	//--- Service
+	//---
+	//--------------------------------------------------------------------------
+
+	public Element exec(Element params, ServiceContext context) throws Exception
+	{
+		Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
+
+		GeonetContext  gc = (GeonetContext) context.getHandlerContext(Geonet.CONTEXT_NAME);
+		DataManager    dm = gc.getDataManager();
+		HarvestManager hm = gc.getHarvestManager();
+
+		String id  = Util.getParam(params, Params.ID,   null);
+		String uuid= Util.getParam(params, Params.UUID, null);
+		String rat = Util.getParam(params, Params.RATING);
+		String ip  = context.getIpAddress();
+
+		if (id == null &amp;&amp; uuid == null)
+			throw new MissingParameterEx("id or uuid");
+
+		//--- resolve id &amp; uuid
+
+		if (id != null) 	uuid = dm.getMetadataUuid(dbms, id);
+			else				id   = dm.getMetadataId(dbms, uuid);
+
+		if (id == null || uuid == null)
+			throw new MetadataNotFoundEx("id:"+ id +" or uuid:"+ uuid);
+
+		if (ip == null)
+			ip = "???.???.???.???";
+
+		if (!Lib.type.isInteger(rat))
+			throw new BadParameterEx(Params.RATING, rat);
+
+		int rating = Integer.parseInt(rat);
+
+		if (rating &lt; 1 || rating &gt; 5)
+			throw new BadParameterEx(Params.RATING, rat);
+
+		String harvUuid = getHarvestingUuid(dbms, id);
+
+		if (harvUuid == null)
+			//--- metadata is local, just rate it
+			rating = dm.rateMetadata(dbms, new Integer(id), ip, rating);
+		else
+		{
+			//--- the metadata is harvested, is type=geonetwork?
+
+			AbstractHarvester ah = hm.getHarvester(harvUuid);
+
+			if (ah.getType().equals(GeonetHarvester.TYPE))
+				rating = setRemoteRating(context, (GeonetParams) ah.getParams(), uuid, rating);
+			else
+				rating = -1;
+		}
+
+		return new Element(Params.RATING).setText(Integer.toString(rating));
+	}
+
+	//--------------------------------------------------------------------------
+
+	private String getHarvestingUuid(Dbms dbms, String id) throws Exception
+	{
+		String query = "SELECT harvestUuid FROM Metadata WHERE id=?";
+
+		List list = dbms.select(query, new Integer(id)).getChildren();
+
+		//--- if we don't have any metadata, just return
+
+		if (list.size() == 0)
+			throw new MetadataNotFoundEx("id:"+ id);
+
+		Element rec = (Element) list.get(0);
+
+		String harvUuid = rec.getChildText("harvestuuid");
+
+		//--- metadata not harvested
+
+		return (harvUuid.length() == 0) ? null : harvUuid;
+	}
+
+	//--------------------------------------------------------------------------
+
+	private int setRemoteRating(ServiceContext context, GeonetParams params, String uuid, int rating) throws Exception
+	{
+		context.debug("Rating remote metadata with uuid:"+ uuid);
+
+		XmlRequest req = new XmlRequest(params.host, params.port);
+
+		Lib.net.setupProxy(context, req);
+
+		req.setAddress("/"+ params.servlet +"/srv/en/"+ Geonet.Service.XML_METADATA_RATE);
+		req.clearParams();
+		req.addParam("uuid",   uuid);
+		req.addParam("rating", rating);
+
+		Element response = req.execute();
+
+		if (!response.getName().equals(Params.RATING))
+			throw new BadServerResponseEx(response);
+
+		return Integer.parseInt(response.getText());
+	}
+}
+
+//=============================================================================
+

Modified: trunk/src/org/fao/geonet/services/metadata/Show.java
===================================================================
--- trunk/src/org/fao/geonet/services/metadata/Show.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/services/metadata/Show.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -24,6 +24,7 @@
 package org.fao.geonet.services.metadata;
 
 import jeeves.interfaces.Service;
+import jeeves.resources.dbms.Dbms;
 import jeeves.server.ServiceConfig;
 import jeeves.server.UserSession;
 import jeeves.server.context.ServiceContext;
@@ -50,8 +51,13 @@
 	//---
 	//--------------------------------------------------------------------------
 
-	public void init(String appPath, ServiceConfig params) throws Exception {}
+	public void init(String appPath, ServiceConfig params) throws Exception
+	{
+		String skip = params.getValue("skipPopularity", "n");
 
+		skipPopularity = skip.equals("y");
+	}
+
 	//--------------------------------------------------------------------------
 	//---
 	//--- Service
@@ -88,8 +94,23 @@
 		if (elMd == null)
 			throw new MetadataNotFoundEx(id);
 
+		//--- increase metadata popularity
+
+		Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
+
+		if (!skipPopularity)
+			dm.increasePopularity(dbms, id);
+
 		return elMd;
 	}
+
+	//--------------------------------------------------------------------------
+	//---
+	//--- Variables
+	//---
+	//--------------------------------------------------------------------------
+
+	private boolean skipPopularity;
 }
 
 //=============================================================================

Modified: trunk/src/org/fao/geonet/services/resources/Download.java
===================================================================
--- trunk/src/org/fao/geonet/services/resources/Download.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/services/resources/Download.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -36,6 +36,7 @@
 import org.fao.geonet.constants.Geonet;
 import org.fao.geonet.constants.Params;
 import org.fao.geonet.kernel.AccessManager;
+import org.fao.geonet.kernel.DataManager;
 import org.fao.geonet.kernel.setting.SettingManager;
 import org.fao.geonet.lib.Lib;
 import org.fao.geonet.util.MailSender;
@@ -87,7 +88,17 @@
 
 		GeonetContext  gc = (GeonetContext) context.getHandlerContext(Geonet.CONTEXT_NAME);
 		SettingManager sm = gc.getSettingManager();
+		DataManager    dm = gc.getDataManager();
 
+		//--- increase metadata popularity
+
+		Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
+
+		if (access.equals(Params.Access.PRIVATE))
+			dm.increasePopularity(dbms, id);
+
+		//--- send email notification
+
 		if (doNotify)
 		{
 			String host = sm.getValue("system/feedback/mailServer/host");
@@ -103,7 +114,6 @@
 				context.debug("Sending email notification for file : "+ file);
 
 				// send emails about downloaded file to groups with notify privilege
-				Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
 
 				StringBuffer query = new StringBuffer();
 				query.append("SELECT g.id, g.name, g.email ");

Modified: trunk/src/org/fao/geonet/services/util/MainUtil.java
===================================================================
--- trunk/src/org/fao/geonet/services/util/MainUtil.java	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/src/org/fao/geonet/services/util/MainUtil.java	2007-10-19 22:35:00 UTC (rev 947)
@@ -204,13 +204,13 @@
 			if (sSortBy != null)
 			{
 				if (sSortBy.equals(Geonet.SearchResult.SortBy.DATE))
-					elSortBy.setText(sOutput);
+					elSortBy.setText(sSortBy);
 
 				else if (sSortBy.equals(Geonet.SearchResult.SortBy.POPULARITY))
-					elSortBy.setText(sOutput);
+					elSortBy.setText(sSortBy);
 
 				else if (sSortBy.equals(Geonet.SearchResult.SortBy.RATING))
-					elSortBy.setText(sOutput);
+					elSortBy.setText(sSortBy);
 				else
 					elSortBy.setText(Geonet.SearchResult.SortBy.RELEVANCE);
 			}

Modified: trunk/web/geonetwork/WEB-INF/config-metadata.xml
===================================================================
--- trunk/web/geonetwork/WEB-INF/config-metadata.xml	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/web/geonetwork/WEB-INF/config-metadata.xml	2007-10-19 22:35:00 UTC (rev 947)
@@ -329,6 +329,14 @@
 		&lt;service name="xml.ownership.transfer"&gt;
 			&lt;class name=".services.ownership.Transfer"/&gt;
 		&lt;/service&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+		&lt;!-- Rating                                                        --&gt;
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+
+		&lt;service name="xml.metadata.rate"&gt;
+			&lt;class name=".services.metadata.Rate"/&gt;
+		&lt;/service&gt;
 	&lt;/services&gt;
 &lt;/geonet&gt;
 

Modified: trunk/web/geonetwork/WEB-INF/config.xml
===================================================================
--- trunk/web/geonetwork/WEB-INF/config.xml	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/web/geonetwork/WEB-INF/config.xml	2007-10-19 22:35:00 UTC (rev 947)
@@ -68,8 +68,8 @@
 			&lt;name&gt;main-db&lt;/name&gt;
 			&lt;provider&gt;jeeves.resources.dbms.DbmsPool&lt;/provider&gt;
 			&lt;config&gt;
-				&lt;user&gt;GiN6RGJk&lt;/user&gt;
-				&lt;password&gt;AY1bdNLN&lt;/password&gt;
+				&lt;user&gt;GCCC0tPe&lt;/user&gt;
+				&lt;password&gt;GP2j4Z0a&lt;/password&gt;
 				&lt;driver&gt;com.mckoi.JDBCDriver&lt;/driver&gt;
 				&lt;url&gt;jdbc:<a href="mckoi://localhost:9157/&lt;/url" target="_new">mckoi://localhost:9157/&lt;/url</a>&gt;
 				&lt;poolSize&gt;10&lt;/poolSize&gt;
@@ -209,6 +209,8 @@
 			&lt;/output&gt;
 		&lt;/service&gt;
 
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+
 		&lt;service name="main.searchform.simple.embedded"&gt;
 			&lt;output sheet="searchform_simple.xsl"&gt;
 				&lt;call name="searchDefaults" class=".guiservices.search.GetDefaults" /&gt;
@@ -226,6 +228,12 @@
 
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
 
+		&lt;service name="rating.popup"&gt;
+			&lt;output sheet="rating-popup.xsl"/&gt;
+		&lt;/service&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+
 		&lt;service name="main.present"&gt;
 			&lt;class name=".services.main.Result"&gt;
 				&lt;param name="maxRecords" value="10" /&gt;
@@ -625,13 +633,15 @@
 		&lt;service name="xml.search"&gt;
 			&lt;class name=".services.main.XmlSearch" /&gt;
 
-			&lt;output sheet="portal-present.xsl" contentType="application/xml; charset=UTF-8"/&gt;
+			&lt;output sheet="portal-present.xsl" contentType="application/xml; charset=UTF-8" /&gt;
 		&lt;/service&gt;
 
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
 
 		&lt;service name="xml.metadata.get"&gt;
-			&lt;class name=".services.metadata.Show" /&gt;
+			&lt;class name=".services.metadata.Show"&gt;
+				&lt;param name="skipPopularity" value="y" /&gt;
+			&lt;/class&gt;
 		&lt;/service&gt;
 
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
@@ -705,7 +715,7 @@
 				&lt;param name="maxSummaryKeys" value="10" /&gt;
 			&lt;/class&gt;
 			&lt;output sheet="rss-search.xsl" contentType="text/xml; charset=UTF-8"&gt;
-				&lt;call name="rssItems" class=".services.main.Result"/&gt;
+				&lt;call name="rssItems" class=".services.main.Result" /&gt;
 				&lt;call name="siteURL" class=".guiservices.util.GetSiteURL" /&gt;
 			&lt;/output&gt;
 		&lt;/service&gt;

Modified: trunk/web/geonetwork/geonetwork.css
===================================================================
--- trunk/web/geonetwork/geonetwork.css	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/web/geonetwork/geonetwork.css	2007-10-19 22:35:00 UTC (rev 947)
@@ -597,3 +597,39 @@
 .ilwhiteboard {
     position:relative;
 }
+
+/* Rating popup */
+
+button.rating 
+{
+	font-family: Verdana;
+	font-size: 9pt;
+	color: #064377;
+	max-width: 400px;
+	width: 100px;
+	cursor: pointer;
+	cursor: hand;
+	border: 1px solid #266397; /* moved here from tr since IE accepts it only here */
+	margin-bottom: 4px;
+}
+
+.ratingBox
+{
+	position: absolute;
+	background-color: #E0E0FF;
+	border:  solid black 1px;
+	padding: 0px;
+	margin: 0px;
+}
+
+.ratingCloser 
+{
+    position: absolute;
+    top:     1px;
+    right:   3px;
+    width:  16px;
+    height: 16px;
+    cursor: pointer;
+    
+    z-index: 20;    
+}

Modified: trunk/web/geonetwork/loc/en/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/en/xml/strings.xml	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/web/geonetwork/loc/en/xml/strings.xml	2007-10-19 22:35:00 UTC (rev 947)
@@ -390,7 +390,9 @@
 	&lt;sortByType id="rating"&gt;Rating&lt;/sortByType&gt;
 	&lt;sortByType id="popularity"&gt;Popularity&lt;/sortByType&gt;
 	&lt;sortByType id="date"&gt;Change date&lt;/sortByType&gt;
-	
+	&lt;rateIt&gt;Rate It&lt;/rateIt&gt;
+	&lt;mdRating&gt;Metadata Rating&lt;/mdRating&gt;
+	&lt;ratingMsg&gt;Press a button to rate. Note that for harvested metadata you have to wait the new run.&lt;/ratingMsg&gt;
 	&lt;resetSearch&gt;Reset the search form&lt;/resetSearch&gt;
 	&lt;resetFeedbackForm&gt;Reset the feedback form&lt;/resetFeedbackForm&gt;
 	&lt;restrictTo&gt;Restrict to&lt;/restrictTo&gt;

Modified: trunk/web/geonetwork/scripts/gn_search.js
===================================================================
--- trunk/web/geonetwork/scripts/gn_search.js	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/web/geonetwork/scripts/gn_search.js	2007-10-19 22:35:00 UTC (rev 947)
@@ -23,6 +23,97 @@
 	div.toggle();
 }
 
+//-------------------------------------------------------------------
+
+function setSortAndSearch()
+{
+	$('sortBy').value = $F('sortBy.live');
+	
+	if ($('protocol') == null)	runSimpleSearch();
+		else							runAdvancedSearch();
+}
+
+//-------------------------------------------------------------------
+
+var ratingPopup = null;
+
+//-------------------------------------------------------------------
+
+function showRatingPopup(id)
+{
+	if (ratingPopup == null)
+	{
+		ker.loadURL('rating.popup', ker.wrap(this, 
+			function(t)
+			{
+				var p = document.createElement('div');
+	
+				p.className     = 'ratingBox';
+				p.innerHTML     = t.responseText;
+				p.style.display = 'none';
+				p.style.zIndex  = 32000;
+				
+				p.setAttribute('id', 'rating.popup');				
+				document.body.appendChild(p);
+				
+				ratingPopup = p;
+				
+				setTimeout(ker.wrap(this, function(){ showRatingPopup(id); }), 10);	
+			}));
+		
+		return;
+	}
+			
+	var pos = Position.cumulativeOffset($('rating.link.'+ id));
+
+	ratingPopup.style.left = pos[0] -100;
+	ratingPopup.style.top  = pos[1] +16;
+	
+	ratingPopup.setAttribute('mdid', id);
+	
+	Element.show(ratingPopup);
+}
+
+//-------------------------------------------------------------------
+
+function hideRatingPopup()
+{
+	var popup = $('rating.popup');
+	
+	if (popup != null)
+	{
+		Element.hide(popup);
+		Element.hide('rating.image');	
+	}
+}
+
+//-------------------------------------------------------------------
+
+function rateMetadata(rating)
+{
+	var id = ratingPopup.getAttribute('mdid');
+	
+	Element.show('rating.image');	
+	
+	var request =
+		'&lt;request&gt;'+
+		'   &lt;id&gt;'+ id +'&lt;/id&gt;'+
+		'   &lt;rating&gt;'+ rating +'&lt;/rating&gt;'+
+		'&lt;/request&gt;';
+	
+	ker.send('xml.metadata.rate', request, ker.wrap(this, rateMetadata_OK));	
+}
+
+//-------------------------------------------------------------------
+
+function rateMetadata_OK(xmlRes)
+{
+	if (xmlRes.nodeName == 'error')
+		ker.showError('Cannot rate metadata', xmlRes);
+	else
+		hideRatingPopup();
+}
+
 /********************************************************************
 * 
 *  Toggling between simple/advanced search

Modified: trunk/web/geonetwork/xml/user-profiles.xml
===================================================================
--- trunk/web/geonetwork/xml/user-profiles.xml	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/web/geonetwork/xml/user-profiles.xml	2007-10-19 22:35:00 UTC (rev 947)
@@ -185,6 +185,7 @@
 		&lt;allow service="metadata.show"/&gt;
 		&lt;allow service="metadata.show.embedded"/&gt; &lt;!--  ETj --&gt;
 		&lt;allow service="remote.show"/&gt;
+		&lt;allow service="rating.popup"/&gt;
 
 		&lt;!-- Login and logout services --&gt;
 		&lt;allow service="user.login"/&gt;
@@ -269,6 +270,9 @@
 		&lt;!-- Metadata schema related --&gt;
 		&lt;allow service="xml.schema.info"/&gt;
 
+		&lt;!-- Rating services --&gt;
+		&lt;allow service="xml.metadata.rate"/&gt;
+		
 		&lt;!-- Thesaurus services --&gt;
 	 	&lt;allow service="keywords.search"/&gt;
 	 	&lt;allow service="keywords.sort"/&gt;

Added: trunk/web/geonetwork/xsl/rating-popup.xsl
===================================================================
--- trunk/web/geonetwork/xsl/rating-popup.xsl	                        (rev 0)
+++ trunk/web/geonetwork/xsl/rating-popup.xsl	2007-10-19 22:35:00 UTC (rev 947)
@@ -0,0 +1,68 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+
+&lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"&gt;
+
+	&lt;!-- ============================================================================== --&gt;
+	&lt;!-- Rating popup --&gt;
+	&lt;!-- ============================================================================== --&gt;
+	
+	&lt;xsl:template match="/"&gt;				
+		&lt;div style="padding: 0px; margin: 0px"&gt;
+			&lt;div style="background-color: #064377; color: #ffffff;" align="left"&gt;
+				&lt;h1 style="padding-bottom: 4px; margin: 0px 0px 4px 0px;"&gt;
+					&lt;xsl:value-of select="/root/gui/strings/mdRating"/&gt;
+					&lt;img class="ratingCloser" src="{/root/gui/url}/images/fileclose.png" onClick="hideRatingPopup()"/&gt;
+				&lt;/h1&gt;
+			&lt;/div&gt;
+			
+			&lt;div align="center"&gt;
+				&lt;button class="rating" onclick="rateMetadata(5)"&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+				&lt;/button&gt;
+				&lt;br/&gt;
+				
+				&lt;button class="rating" onclick="rateMetadata(4)"&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+				&lt;/button&gt;
+				&lt;br/&gt;
+				
+				&lt;button class="rating" onclick="rateMetadata(3)"&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+				&lt;/button&gt;
+				&lt;br/&gt;
+				
+				&lt;button class="rating" onclick="rateMetadata(2)"&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+				&lt;/button&gt;
+				&lt;br/&gt;
+				
+				&lt;button class="rating" onclick="rateMetadata(1)"&gt;
+					&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+				&lt;/button&gt;
+			&lt;/div&gt;
+			
+			&lt;div&gt;
+				&lt;xsl:value-of select="/root/gui/strings/ratingMsg"/&gt;
+			&lt;/div&gt;
+			
+			&lt;div id="rating.image" align="center" style="display: none;"&gt;
+				&lt;img src="{/root/gui/url}/images/loading.gif" /&gt;
+			&lt;/div&gt;
+			
+		&lt;/div&gt;
+		
+	&lt;/xsl:template&gt;
+	
+	&lt;!-- ============================================================================== --&gt;
+
+&lt;/xsl:stylesheet&gt;

Modified: trunk/web/geonetwork/xsl/search-results-xhtml.xsl
===================================================================
--- trunk/web/geonetwork/xsl/search-results-xhtml.xsl	2007-10-16 12:52:34 UTC (rev 946)
+++ trunk/web/geonetwork/xsl/search-results-xhtml.xsl	2007-10-19 22:35:00 UTC (rev 947)
@@ -36,7 +36,7 @@
 					&amp;#160;
 					&lt;xsl:value-of select="$from"/&gt;-&lt;xsl:value-of select="$to"/&gt;/&lt;xsl:value-of select="$count"/&gt;
 					&amp;#160;
-					(page &lt;xsl:value-of select="$currPage"/&gt;/&lt;xsl:value-of select="$pages"/&gt;)					
+					(page &lt;xsl:value-of select="$currPage"/&gt;/&lt;xsl:value-of select="$pages"/&gt;),
 &lt;!--					&lt;xsl:value-of select="/root/response/summary/@count"/&gt;--&gt;
 				&lt;/xsl:with-param&gt;
 				&lt;xsl:with-param name="indent" select="50"/&gt;
@@ -69,7 +69,23 @@
 &lt;!--			&lt;td class="padded-content" width="{$indent}"/&gt;--&gt;
 			&lt;td class="dots"/&gt;
 			&lt;td class="padded-content"&gt;
-				&lt;h1&gt;&lt;xsl:value-of select="$title"/&gt;&lt;/h1&gt;
+				&lt;h1&gt;
+					&lt;xsl:value-of select="$title"/&gt;
+					&amp;#xA0;&lt;xsl:value-of select="/root/gui/strings/sortBy"/&gt;&amp;#xA0;
+					
+					&lt;!-- sort by - - - - - - - - - - - - - - - - - - - - --&gt;
+								
+					&lt;select id="sortBy.live" size="1" class="content" onChange="setSortAndSearch()"&gt;
+						&lt;xsl:for-each select="/root/gui/strings/sortByType"&gt;
+							&lt;option value="{@id}"&gt;
+								&lt;xsl:if test="@id = /root/gui/searchDefaults/sortBy"&gt;
+									&lt;xsl:attribute name="selected"/&gt;
+								&lt;/xsl:if&gt;
+								&lt;xsl:value-of select="."/&gt;
+							&lt;/option&gt;
+						&lt;/xsl:for-each&gt;
+					&lt;/select&gt;
+				&lt;/h1&gt;				
 			&lt;/td&gt;
 		&lt;/tr&gt;
 	&lt;/xsl:template&gt;
@@ -276,14 +292,15 @@
 					
 				&lt;xsl:if test="/root/gui/searchDefaults/output = 'full'"&gt;
 					&lt;td class="padded" align="center" valign="center" width="200"&gt;
-&lt;!--					&lt;xsl:call-template name="score"&gt;
-						&lt;xsl:with-param name="score" select="$metadata/geonet:info/score * 100"/&gt;
-						&lt;xsl:with-param name="class" select="5"/&gt;
-						&lt;xsl:with-param name="currentClass" select="0"/&gt;
-					&lt;/xsl:call-template&gt;
 					
-					&lt;br/&gt; --&gt;
+						&lt;!-- metadata rating --&gt;
+						
+						&lt;xsl:call-template name="rating"&gt;
+							&lt;xsl:with-param name="info" select="$metadata/geonet:info"/&gt;
+						&lt;/xsl:call-template&gt;
 					
+						&lt;br/&gt; &lt;!-- metadata thumbnail --&gt;
+					
 						&lt;xsl:call-template name="thumbnail"&gt;
 							&lt;xsl:with-param name="metadata" select="$metadata"/&gt;
 						&lt;/xsl:call-template&gt;
@@ -492,31 +509,61 @@
 	&lt;!-- ================================================================================== --&gt;
 	&lt;!-- Display rating information --&gt;
 
-	&lt;xsl:template name="score"&gt;
-		&lt;xsl:param name="score"/&gt;
-		&lt;xsl:param name="class"/&gt;
-		&lt;xsl:param name="currentClass"/&gt;
-		&lt;xsl:param name="interval" select="100 div $class"/&gt;
-		&lt;xsl:param name="value" select="100 - $interval * $currentClass"/&gt;
+	&lt;xsl:template name="rating"&gt;
+		&lt;xsl:param name="info"/&gt;
 
+		&lt;xsl:variable name="id"     select="$info/id"/&gt;
+		&lt;xsl:variable name="rating" select="$info/rating"/&gt;
+		
+		&lt;xsl:if test="$info/isHarvested = 'n' or $info/harvestInfo/type = 'geonetwork'"&gt;
+			&lt;xsl:call-template name="showRating"&gt;
+				&lt;xsl:with-param name="rating" select="$rating"/&gt;
+			&lt;/xsl:call-template&gt;
+		
+			&lt;a id="rating.link.{$id}" style="cursor:pointer; padding-left:10px;" onClick="showRatingPopup({$id})"&gt;
+				&lt;xsl:value-of select="/root/gui/strings/rateIt"/&gt;
+			&lt;/a&gt;
+		&lt;/xsl:if&gt;
+	&lt;/xsl:template&gt;
+	
+	&lt;!-- ================================================================================== --&gt;
+	
+	&lt;xsl:template name="showRating"&gt;
+		&lt;xsl:param name="rating"/&gt;
+		&lt;xsl:param name="currRating" select="$rating"/&gt;
+		
 		&lt;xsl:choose&gt;
-			&lt;xsl:when test="$score &amp;gt;= $value"&gt;		
-				&lt;img src="{/root/gui/url}/images/score.png" title="{floor($score)}%" alt="{floor($score)}%"/&gt;
+			&lt;xsl:when test="$currRating &amp;gt; 0"&gt;		
+				&lt;img src="{/root/gui/url}/images/score.png" /&gt;
+				
+				&lt;xsl:call-template name="showRating"&gt;
+					&lt;xsl:with-param name="rating"     select="$rating"/&gt;
+					&lt;xsl:with-param name="currRating" select="$currRating -1"/&gt;
+				&lt;/xsl:call-template&gt;
 			&lt;/xsl:when&gt;
+			
 			&lt;xsl:otherwise&gt;
-				&lt;img src="{/root/gui/url}/images/scoreno.png" title="{floor($score)}%" alt="{floor($score)}%"/&gt;
+				&lt;xsl:call-template name="showRatingDiff"&gt;
+					&lt;xsl:with-param name="diff" select="5 - $rating"/&gt;
+				&lt;/xsl:call-template&gt;				
 			&lt;/xsl:otherwise&gt;
-		&lt;/xsl:choose&gt;
-
-		&lt;xsl:choose&gt;
-			&lt;xsl:when test="$currentClass &amp;lt; $class - 1"&gt;			
-				&lt;xsl:call-template name="score"&gt;
-					&lt;xsl:with-param name="score" select="$score"/&gt;
-					&lt;xsl:with-param name="class" select="$class"/&gt;
-					&lt;xsl:with-param name="currentClass" select="$currentClass + 1"/&gt;
-				&lt;/xsl:call-template&gt;
-			&lt;/xsl:when&gt;
-		&lt;/xsl:choose&gt;
+		&lt;/xsl:choose&gt;		
+	&lt;/xsl:template&gt;
 	
+	&lt;!-- ================================================================================== --&gt;
+	
+	&lt;xsl:template name="showRatingDiff"&gt;
+		&lt;xsl:param name="diff"/&gt;
+							
+		&lt;xsl:if test="$diff &amp;gt; 0"&gt;
+			&lt;img src="{/root/gui/url}/images/scoreno.png" /&gt;
+			
+			&lt;xsl:call-template name="showRatingDiff"&gt;
+				&lt;xsl:with-param name="diff" select="$diff -1"/&gt;
+			&lt;/xsl:call-template&gt;
+		&lt;/xsl:if&gt;
 	&lt;/xsl:template&gt;
+		
+	&lt;!-- ================================================================================== --&gt;
+
 &lt;/xsl:stylesheet&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
    <br />
    
<ul>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=4451894">[GeoNetwork-commit] SF.net SVN: geonetwork: [951] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;acarboni@us...&gt; -	2007-10-30 13:28</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 951
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=951&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=951&amp;view=rev</a>
Author:   acarboni
Date:     2007-10-30 06:28:35 -0700 (Tue, 30 Oct 2007)

Log Message:
-----------
mef.export service made accessible to guests

Modified Paths:
--------------
    trunk/docs/changes.txt
    trunk/src/org/fao/geonet/services/mef/Export.java

Modified: trunk/docs/changes.txt
===================================================================
--- trunk/docs/changes.txt	2007-10-19 22:40:46 UTC (rev 950)
+++ trunk/docs/changes.txt	2007-10-30 13:28:35 UTC (rev 951)
@@ -43,6 +43,9 @@
  
 - Added 'sources' to search summary
 
+- Now the mef.export service is accessible to users. Export is limited by metadata
+  privileges.
+
 --------------------------------------------------------------------------------
 --- Bugs fixed
 --------------------------------------------------------------------------------

Modified: trunk/src/org/fao/geonet/services/mef/Export.java
===================================================================
--- trunk/src/org/fao/geonet/services/mef/Export.java	2007-10-19 22:40:46 UTC (rev 950)
+++ trunk/src/org/fao/geonet/services/mef/Export.java	2007-10-30 13:28:35 UTC (rev 951)
@@ -65,14 +65,10 @@
 		if (id == null)
 			throw new MetadataNotFoundEx("uuid="+uuid);
 
-		if (format.equals("partial"))
-			Lib.resource.checkPrivilege(context, id, AccessManager.OPER_VIEW);
+		Lib.resource.checkPrivilege(context, id, AccessManager.OPER_VIEW);
 
-		else if (format.equals("full"))
-		{
-			Lib.resource.checkPrivilege(context, id, AccessManager.OPER_VIEW);
+		if (format.equals("full"))
 			Lib.resource.checkPrivilege(context, id, AccessManager.OPER_DOWNLOAD);
-		}
 
 		String file = MEFLib.doExport(context, uuid, format, skipUUID.equals("true"));
 


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=4451897">[GeoNetwork-commit] SF.net SVN: geonetwork: [952] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;acarboni@us...&gt; -	2007-10-30 16:04</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 952
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=952&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=952&amp;view=rev</a>
Author:   acarboni
Date:     2007-10-30 09:04:32 -0700 (Tue, 30 Oct 2007)

Log Message:
-----------
Moved indexing stylesheets to proper folders

Modified Paths:
--------------
    trunk/src/org/fao/geonet/kernel/search/SearchManager.java
    trunk/web/geonetwork/xml/schemas/dublin-core/dc.xsd

Added Paths:
-----------
    trunk/web/geonetwork/xml/schemas/dublin-core/index-fields.xsl
    trunk/web/geonetwork/xml/schemas/fgdc-std/index-fields.xsl
    trunk/web/geonetwork/xml/schemas/iso19115/index-fields.xsl
    trunk/web/geonetwork/xml/schemas/iso19139/index-fields.xsl

Removed Paths:
-------------
    trunk/web/geonetwork/xml/search/dublin-core.xsl
    trunk/web/geonetwork/xml/search/fgdc-std.xsl
    trunk/web/geonetwork/xml/search/iso19115.xsl
    trunk/web/geonetwork/xml/search/iso19139.xsl

Modified: trunk/src/org/fao/geonet/kernel/search/SearchManager.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/search/SearchManager.java	2007-10-30 13:28:35 UTC (rev 951)
+++ trunk/src/org/fao/geonet/kernel/search/SearchManager.java	2007-10-30 16:04:32 UTC (rev 952)
@@ -59,8 +59,10 @@
 	public static final int UNUSED = 3;
 
 	private static final String SEARCH_STYLESHEETS_DIR_PATH = "xml/search";
+	private static final String SCHEMA_STYLESHEETS_DIR_PATH = "xml/schemas";
 
 	private File           _stylesheetsDir;
+	private File           _schemasDir;
 	private File           _luceneDir;
 	private LoggingContext _cat;
 	private Searchable     _hssSearchable;
@@ -70,6 +72,8 @@
 	public SearchManager(String appPath, String luceneDir) throws Exception
 	{
 		_stylesheetsDir = new File(appPath, SEARCH_STYLESHEETS_DIR_PATH);
+		_schemasDir     = new File(appPath, SCHEMA_STYLESHEETS_DIR_PATH);
+
 		if (!_stylesheetsDir.isDirectory())
 			throw new Exception("directory " + _stylesheetsDir + " not found");
 
@@ -182,12 +186,9 @@
 		}
 		else
 		{
-			// get metadata fields
-			String stylesheetName = type + ".xsl";
-
 			Log.debug(Geonet.INDEX_ENGINE, "Metadata to index:\n"+ Xml.getString(metadata));
 
-			xmlDoc = transform(stylesheetName, metadata);
+			xmlDoc = getIndexFields(type, metadata);
 
 			Log.debug(Geonet.INDEX_ENGINE, "Indexing fields:\n"+ Xml.getString(xmlDoc));
 		}
@@ -321,6 +322,26 @@
 	//-----------------------------------------------------------------------------
 	// utilities
 
+	Element getIndexFields(String schema, Element xml)
+		throws Exception
+	{
+		File schemaDir = new File(_schemasDir, schema);
+
+		try
+		{
+			String styleSheet = new File(schemaDir, "index-fields.xsl").getAbsolutePath();
+			return Xml.transform(xml, styleSheet);
+		}
+		catch(Exception e)
+		{
+			Log.error(Geonet.SEARCH_ENGINE, "Indexing stylesheet contains errors : "+ e.getMessage());
+			throw e;
+		}
+	}
+
+	//-----------------------------------------------------------------------------
+	// utilities
+
 	Element transform(String styleSheetName, Element xml)
 		throws Exception
 	{

Modified: trunk/web/geonetwork/xml/schemas/dublin-core/dc.xsd
===================================================================
--- trunk/web/geonetwork/xml/schemas/dublin-core/dc.xsd	2007-10-30 13:28:35 UTC (rev 951)
+++ trunk/web/geonetwork/xml/schemas/dublin-core/dc.xsd	2007-10-30 16:04:32 UTC (rev 952)
@@ -41,8 +41,8 @@
   &lt;xs:import namespace="<a href="http://www.w3.org/XML/1998/namespace" target="_new">http://www.w3.org/XML/1998/namespace</a>"
              schemaLocation="xml.xsd"/&gt;
 
-  &lt;xs:import namespace="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"
-              schemaLocation="dcterms.xsd"/&gt;
+  &lt;!--xs:import namespace="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"
+              schemaLocation="dcterms.xsd"/--&gt;
 
 
   &lt;xs:complexType name="SimpleLiteral"&gt;

Added: trunk/web/geonetwork/xml/schemas/dublin-core/index-fields.xsl
===================================================================
--- trunk/web/geonetwork/xml/schemas/dublin-core/index-fields.xsl	                        (rev 0)
+++ trunk/web/geonetwork/xml/schemas/dublin-core/index-fields.xsl	2007-10-30 16:04:32 UTC (rev 952)
@@ -0,0 +1,122 @@
+&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
+&lt;xsl:stylesheet version="1.0"
+					 xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
+					 xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
+					 xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
+
+&lt;xsl:output method="xml" indent="yes"/&gt;
+
+&lt;xsl:template match="/"&gt;
+	&lt;Document&gt;
+
+		&lt;xsl:variable name="coverage" select="/simpledc/dc:coverage"/&gt;
+		&lt;xsl:variable name="n" select="substring-after($coverage,'North ')"/&gt;
+		&lt;xsl:variable name="north" select="substring-before($n,',')"/&gt;
+		&lt;xsl:variable name="s" select="substring-after($coverage,'South ')"/&gt;
+		&lt;xsl:variable name="south" select="substring-before($s,',')"/&gt;
+		&lt;xsl:variable name="e" select="substring-after($coverage,'East ')"/&gt;
+		&lt;xsl:variable name="east" select="substring-before($e,',')"/&gt;
+		&lt;xsl:variable name="w" select="substring-after($coverage,'West ')"/&gt;
+		&lt;xsl:variable name="west" select="substring-before($w,'. ')"/&gt;
+		&lt;xsl:variable name="p" select="substring-after($coverage,'(')"/&gt;
+		&lt;xsl:variable name="place" select="substring-before($p,')')"/&gt;
+		
+		&lt;xsl:for-each select="/simpledc/dc:identifier"&gt;
+			&lt;Field name="identifier" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;xsl:for-each select="/simpledc/dct:abstract"&gt;
+			&lt;Field name="abstract" string="{string(.)}" store="true" index="true" token="true"/&gt;
+		&lt;/xsl:for-each&gt;
+		
+		&lt;xsl:for-each select="/simpledc/dct:modified"&gt;
+			&lt;Field name="changeDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;xsl:for-each select="/simpledc/dc:format"&gt;
+			&lt;Field name="format" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;xsl:for-each select="/simpledc/dc:type"&gt;
+			&lt;Field name="type" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;xsl:for-each select="/simpledc/dc:relation"&gt;
+			&lt;Field name="relation" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;xsl:for-each select="/simpledc/dct:spatial"&gt;
+			&lt;Field name="spatial" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- This is needed by the CITE test script to look for strings like 'a b*'
+			  strings that contain spaces --&gt;
+
+		&lt;xsl:for-each select="/simpledc/dc:title"&gt;
+			&lt;Field name="title" string="{string(.)}" store="false" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;xsl:apply-templates select="/simpledc/dc:title"&gt;
+			&lt;xsl:with-param name="name" select="'title'"/&gt;
+			&lt;xsl:with-param name="token" select="'true'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+
+		&lt;xsl:apply-templates select="/simpledc/dc:description"&gt;
+			&lt;xsl:with-param name="name" select="'description'"/&gt;
+			&lt;xsl:with-param name="token" select="'true'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		
+		&lt;Field name="westBL"  string="{$west  + 360}" store="true" index="true" token="false"/&gt;
+		&lt;Field name="eastBL"  string="{$east  + 360}" store="true" index="true" token="false"/&gt;
+		&lt;Field name="southBL" string="{$south + 360}" store="true" index="true" token="false"/&gt;
+		&lt;Field name="northBL" string="{$north + 360}" store="true" index="true" token="false"/&gt;
+		
+		&lt;Field name="keyword" string="{$place}" store="true" index="true" token="false"/&gt;
+
+		
+		&lt;xsl:apply-templates select="/simpledc/dc:subject"&gt;
+			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
+			&lt;xsl:with-param name="store" select="'true'"/&gt;
+
+			&lt;!--  the value was 'true' and has been changed to false to pass the CITE scripts 
+					Anyway, users should add several dc:subject elements each one containing a
+					single word. Hence, it is lecit to not tokenize the subject --&gt;
+
+			&lt;xsl:with-param name="token" select="'false'"/&gt; 
+		&lt;/xsl:apply-templates&gt;
+
+		&lt;Field name="any" store="false" index="true" token="true"&gt;
+			&lt;xsl:attribute name="string"&gt;
+				&lt;xsl:apply-templates select="/simpledc" mode="allText"/&gt;
+			&lt;/xsl:attribute&gt;
+		&lt;/Field&gt;
+
+		&lt;!-- locally searchable fields --&gt;
+		
+		&lt;!-- defaults to true --&gt;
+		&lt;Field name="digital" string="true" store="false" index="true" token="false"/&gt;
+			
+	&lt;/Document&gt;
+&lt;/xsl:template&gt;
+
+&lt;!-- text element, by default indexed, not stored, tokenized --&gt;
+&lt;xsl:template match="*"&gt;
+	&lt;xsl:param name="name"  select="name(.)"/&gt;
+	&lt;xsl:param name="store" select="'false'"/&gt;
+	&lt;xsl:param name="index" select="'true'"/&gt;
+	&lt;xsl:param name="token" select="'false'"/&gt;
+	
+   &lt;Field name="{$name}" string="{string(.)}" store="{$store}" index="{$index}" token="{$token}"/&gt;
+&lt;/xsl:template&gt;
+
+&lt;!--allText --&gt;
+&lt;xsl:template match="*" mode="allText"&gt;
+	&lt;xsl:for-each select="@*"&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:for-each&gt;
+	&lt;xsl:choose&gt;
+		&lt;xsl:when test="*"&gt;&lt;xsl:apply-templates select="*" mode="allText"/&gt;&lt;/xsl:when&gt;
+		&lt;xsl:otherwise&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:otherwise&gt;
+	&lt;/xsl:choose&gt;
+&lt;/xsl:template&gt;
+
+&lt;/xsl:stylesheet&gt;
+

Added: trunk/web/geonetwork/xml/schemas/fgdc-std/index-fields.xsl
===================================================================
--- trunk/web/geonetwork/xml/schemas/fgdc-std/index-fields.xsl	                        (rev 0)
+++ trunk/web/geonetwork/xml/schemas/fgdc-std/index-fields.xsl	2007-10-30 16:04:32 UTC (rev 952)
@@ -0,0 +1,88 @@
+&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
+&lt;xsl:stylesheet xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>" version="1.0"&gt;
+
+&lt;xsl:template match="/"&gt;
+	&lt;Document&gt;
+
+		&lt;xsl:apply-templates select="/metadata/idinfo/citation/citeinfo/title"&gt;
+			&lt;xsl:with-param name="token" select="'true'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		
+		&lt;xsl:apply-templates select="/metadata/idinfo/descript/abstract"&gt;
+			&lt;xsl:with-param name="token" select="'true'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		
+		&lt;xsl:apply-templates select="/metadata/idinfo/spdom/bounding/westbc" mode="latLon"&gt;
+			&lt;xsl:with-param name="name" select="'westBL'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		&lt;xsl:apply-templates select="/metadata/idinfo/spdom/bounding/eastbc" mode="latLon"&gt;
+			&lt;xsl:with-param name="name" select="'eastBL'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		&lt;xsl:apply-templates select="/metadata/idinfo/spdom/bounding/southbc" mode="latLon"&gt;
+			&lt;xsl:with-param name="name" select="'southBL'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		&lt;xsl:apply-templates select="/metadata/idinfo/spdom/bounding/northbc" mode="latLon"&gt;
+			&lt;xsl:with-param name="name" select="'northBL'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		
+		&lt;xsl:apply-templates select="/metadata/idinfo/keywords/theme/themekey"&gt;
+			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
+			&lt;xsl:with-param name="store" select="'true'"/&gt;
+			&lt;xsl:with-param name="token" select="'false'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		&lt;xsl:apply-templates select="/metadata/idinfo/keywords/place/placekey"&gt;
+			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
+			&lt;xsl:with-param name="store" select="'true'"/&gt;
+			&lt;xsl:with-param name="token" select="'false'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		&lt;xsl:apply-templates select="/metadata/idinfo/keywords/stratum/stratkey"&gt;
+			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
+			&lt;xsl:with-param name="store" select="'true'"/&gt;
+			&lt;xsl:with-param name="token" select="'false'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		&lt;xsl:apply-templates select="/metadata/idinfo/keywords/temporal/tempkey"&gt;
+			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
+			&lt;xsl:with-param name="store" select="'true'"/&gt;
+			&lt;xsl:with-param name="token" select="'false'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+
+		&lt;Field name="any" store="false" index="true" token="true"&gt;
+			&lt;xsl:attribute name="string"&gt;
+				&lt;xsl:apply-templates select="/metadata" mode="allText"/&gt;
+			&lt;/xsl:attribute&gt;
+		&lt;/Field&gt;
+
+		&lt;!-- locally searchable fields --&gt;
+		
+		&lt;!-- defaults to true --&gt;
+		&lt;Field name="digital" string="true" store="false" index="true" token="false"/&gt;
+			
+	&lt;/Document&gt;
+&lt;/xsl:template&gt;
+
+&lt;!-- text element, by default indexed, not stored, tokenized --&gt;
+&lt;xsl:template match="*"&gt;
+	&lt;xsl:param name="name"  select="name(.)"/&gt;
+	&lt;xsl:param name="store" select="'false'"/&gt;
+	&lt;xsl:param name="index" select="'true'"/&gt;
+	&lt;xsl:param name="token" select="'false'"/&gt;
+	
+   &lt;Field name="{$name}" string="{string(.)}" store="{$store}" index="{$index}" token="{$token}"/&gt;
+&lt;/xsl:template&gt;
+
+&lt;!-- latlon coordinates + 360, zero-padded, indexed, not stored, not tokenized --&gt;
+&lt;xsl:template match="*" mode="latLon"&gt;
+	&lt;xsl:param name="name" select="name(.)"/&gt;
+	&lt;Field name="{$name}" string="{string(.) + 360}" store="true" index="true" token="false"/&gt;
+&lt;/xsl:template&gt;
+
+&lt;!--allText --&gt;
+&lt;xsl:template match="*" mode="allText"&gt;
+	&lt;xsl:for-each select="@*"&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:for-each&gt;
+	&lt;xsl:choose&gt;
+		&lt;xsl:when test="*"&gt;&lt;xsl:apply-templates select="*" mode="allText"/&gt;&lt;/xsl:when&gt;
+		&lt;xsl:otherwise&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:otherwise&gt;
+	&lt;/xsl:choose&gt;
+&lt;/xsl:template&gt;
+
+&lt;/xsl:stylesheet&gt;

Added: trunk/web/geonetwork/xml/schemas/iso19115/index-fields.xsl
===================================================================
--- trunk/web/geonetwork/xml/schemas/iso19115/index-fields.xsl	                        (rev 0)
+++ trunk/web/geonetwork/xml/schemas/iso19115/index-fields.xsl	2007-10-30 16:04:32 UTC (rev 952)
@@ -0,0 +1,161 @@
+&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
+&lt;xsl:stylesheet xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>" version="1.0"&gt;
+
+&lt;xsl:template match="/"&gt;
+	&lt;Document&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Title === --&gt;	
+		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/idCitation/resTitle"&gt;
+			&lt;xsl:with-param name="name"  select="'title'"/&gt;
+			&lt;xsl:with-param name="token" select="'true'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Abstract === --&gt;	
+		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/idAbs"&gt;
+			&lt;xsl:with-param name="name"  select="'abstract'"/&gt;
+			&lt;xsl:with-param name="token" select="'true'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+		
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Revision date === --&gt;
+		&lt;xsl:for-each select="/Metadata/dataIdInfo/idCitation/resRefDate[dateType/DateTypCd/@value='revision']/refDate"&gt;
+			&lt;Field name="revisionDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === creation date === --&gt;
+		&lt;xsl:for-each select="/Metadata/dataIdInfo/idCitation/resRefDate[dateType/DateTypCd/@value='creation']/refDate"&gt;
+			&lt;Field name="creationDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Publication date === --&gt;
+		&lt;xsl:for-each select="/Metadata/dataIdInfo/idCitation/resRefDate[dateType/DateTypCd/@value='publication']/refDate"&gt;
+			&lt;Field name="publicationDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === metadata language === --&gt;
+		&lt;xsl:for-each select="/Metadata/mdLang/languageCode/@value"&gt;
+			&lt;Field name="language" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Metadata file identifier (GUID in GeoNetwork) === --&gt;
+		&lt;xsl:apply-templates select="/Metadata/mdFileID"&gt;
+			&lt;xsl:with-param name="name"  select="'fileId'"/&gt;
+			&lt;xsl:with-param name="token" select="'false'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Parent identifier (should be mapped if available) === --&gt;
+&lt;!--		&lt;xsl:for-each select="/Metadata/parentIdentifier"&gt;
+			&lt;Field name="parentId" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt; --&gt;
+		
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Responsible organization === --&gt;		
+		&lt;xsl:for-each select="/Metadata/mdContact/rpOrgName"&gt;
+			&lt;Field name="orgName" string="{string(.)}" store="true" index="true" token="true"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Security constraints (yes or no) === --&gt;	
+		&lt;xsl:choose&gt;
+			&lt;xsl:when test="/Metadata/mdConst/SecConsts"&gt;
+				&lt;Field name="secConstr" string="true" store="true" index="true" token="false"/&gt;
+			&lt;/xsl:when&gt;
+			&lt;xsl:otherwise&gt;
+				&lt;Field name="secConstr" string="false" store="true" index="true" token="false"/&gt;
+			&lt;/xsl:otherwise&gt;
+		&lt;/xsl:choose&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === latlon coordinates + 360, zero-padded, indexed, not stored, not tokenized === --&gt;
+		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/geoBox/westBL" mode="latLon"/&gt;
+		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/geoBox/eastBL" mode="latLon"/&gt;
+		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/geoBox/southBL" mode="latLon"/&gt;
+		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/geoBox/northBL" mode="latLon"/&gt;
+		
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === keywords === --&gt;
+		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/descKeys/keyword"&gt;
+			&lt;xsl:with-param name="store" select="'true'"/&gt;
+			&lt;xsl:with-param name="token" select="'false'"/&gt;
+		&lt;/xsl:apply-templates&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Online Resources protocol === --&gt;		
+
+		&lt;xsl:for-each select="/Metadata/distInfo/distTranOps"&gt;
+			&lt;xsl:for-each select="onLineSrc/protocol"&gt;
+				&lt;!-- this field MUST NOT be tokenized, otherwise search fails --&gt;
+				&lt;Field name="protocol" string="{string(.)}" store="true" index="true" token="false"/&gt;
+			&lt;/xsl:for-each&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Topic category === --&gt;	
+		
+		&lt;xsl:for-each select="/Metadata/dataIdInfo/tpCat/TopicCatCd/@value"&gt;
+			&lt;Field name="topicCat" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === all text === --&gt;
+		&lt;Field name="any" store="false" index="true" token="true"&gt;
+			&lt;xsl:attribute name="string"&gt;
+				&lt;xsl:apply-templates select="/Metadata" mode="allText"/&gt;
+			&lt;/xsl:attribute&gt;
+		&lt;/Field&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === locally searchable fields === --&gt;
+		
+		&lt;xsl:if test="/Metadata/dataIdInfo/idCitation/presForm[contains(PresFormCd/@value, 'Digital')]"&gt;
+			&lt;Field name="digital" string="true" store="false" index="true" token="false"/&gt;
+		&lt;/xsl:if&gt;
+		
+		&lt;xsl:if test="/Metadata/dataIdInfo/idCitation/presForm[contains(PresFormCd/@value, 'Hardcopy')]"&gt;
+			&lt;Field name="paper" string="true" store="false" index="true" token="false"/&gt;
+		&lt;/xsl:if&gt;
+
+	&lt;/Document&gt;
+&lt;/xsl:template&gt;
+
+&lt;!-- text element, by default indexed, not stored nor tokenized --&gt;
+&lt;xsl:template match="*"&gt;
+	&lt;xsl:param name="name"  select="name(.)"/&gt;
+	&lt;xsl:param name="store" select="'false'"/&gt;
+	&lt;xsl:param name="index" select="'true'"/&gt;
+	&lt;xsl:param name="token" select="'false'"/&gt;
+	
+	&lt;Field name="{$name}" string="{string(.)}" store="{$store}" index="{$index}" token="{$token}"/&gt;
+&lt;/xsl:template&gt;
+
+&lt;!-- codelist element, indexed, not stored nor tokenized --&gt;
+&lt;xsl:template match="*[./*/@value]"&gt;
+	&lt;xsl:param name="name" select="name(.)"/&gt;
+	
+	&lt;Field name="{$name}" string="{*/@value}" store="false" index="true" token="false"/&gt;
+&lt;/xsl:template&gt;
+
+&lt;!-- latlon coordinates + 360, zero-padded, indexed, not stored, not tokenized --&gt;
+&lt;xsl:template match="*" mode="latLon"&gt;
+	&lt;xsl:param name="name" select="name(.)"/&gt;
+	
+	&lt;Field name="{$name}" string="{string(.) + 360}" store="true" index="true" token="false"/&gt;
+&lt;/xsl:template&gt;
+
+&lt;!--allText --&gt;
+&lt;xsl:template match="*" mode="allText"&gt;
+	&lt;xsl:for-each select="@*"&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:for-each&gt;
+	&lt;xsl:choose&gt;
+		&lt;xsl:when test="*"&gt;&lt;xsl:apply-templates select="*" mode="allText"/&gt;&lt;/xsl:when&gt;
+		&lt;xsl:otherwise&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:otherwise&gt;
+	&lt;/xsl:choose&gt;
+&lt;/xsl:template&gt;
+
+&lt;/xsl:stylesheet&gt;

Added: trunk/web/geonetwork/xml/schemas/iso19139/index-fields.xsl
===================================================================
--- trunk/web/geonetwork/xml/schemas/iso19139/index-fields.xsl	                        (rev 0)
+++ trunk/web/geonetwork/xml/schemas/iso19139/index-fields.xsl	2007-10-30 16:04:32 UTC (rev 952)
@@ -0,0 +1,289 @@
+&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
+
+&lt;xsl:stylesheet version="1.0" xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
+										xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"
+										xmlns:gml="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>"
+										xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"&gt;
+
+	&lt;!-- ========================================================================================= --&gt;
+	
+	&lt;xsl:output method="xml" version="1.0" encoding="UTF-8" indent="yes" /&gt;
+	
+	&lt;!-- ========================================================================================= --&gt;
+
+	&lt;xsl:template match="/"&gt;
+		&lt;Document&gt;
+			&lt;xsl:apply-templates select="gmd:MD_Metadata" mode="metadata"/&gt;
+		&lt;/Document&gt;
+	&lt;/xsl:template&gt;
+	
+	&lt;!-- ========================================================================================= --&gt;
+
+	&lt;xsl:template match="*" mode="metadata"&gt;
+
+		&lt;!-- === Data Identification === --&gt;		
+
+		&lt;!-- the double // here seems needed to index MD_DataIdentification when
+           it is nested in a SV_ServiceIdentification class --&gt;
+
+		&lt;xsl:for-each select="gmd:identificationInfo//gmd:MD_DataIdentification"&gt;
+
+			&lt;xsl:for-each select="gmd:citation/gmd:CI_Citation"&gt;
+				&lt;xsl:for-each select="gmd:identifier/gmd:MD_Identifier/gmd:code/gco:CharacterString"&gt;
+					&lt;Field name="identifier" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+	
+				&lt;xsl:for-each select="gmd:title/gco:CharacterString"&gt;
+					&lt;Field name="title" string="{string(.)}" store="true" index="true" token="true"/&gt;
+				&lt;/xsl:for-each&gt;
+	
+				&lt;xsl:for-each select="gmd:alternateTitle/gco:CharacterString"&gt;
+					&lt;Field name="altTitle" string="{string(.)}" store="true" index="true" token="true"/&gt;
+				&lt;/xsl:for-each&gt;
+
+				&lt;xsl:for-each select="gmd:date/gmd:CI_Date[gmd:dateType/gmd:CI_DateTypeCode/@codeListValue='revision']/gmd:date/gco:Date"&gt;
+					&lt;Field name="revisionDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+
+				&lt;xsl:for-each select="gmd:date/gmd:CI_Date[gmd:dateType/gmd:CI_DateTypeCode/@codeListValue='creation']/gmd:date/gco:Date"&gt;
+					&lt;Field name="createDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+
+				&lt;xsl:for-each select="gmd:date/gmd:CI_Date[gmd:dateType/gmd:CI_DateTypeCode/@codeListValue='publication']/gmd:date/gco:Date"&gt;
+					&lt;Field name="publicationDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+
+				&lt;!-- fields used to search for metadata in paper or digital format --&gt;
+
+				&lt;xsl:for-each select="gmd:presentationForm"&gt;
+					&lt;xsl:if test="contains(gmd:CI_PresentationFormCode/@codeListValue, 'Digital')"&gt;
+						&lt;Field name="digital" string="true" store="true" index="true" token="false"/&gt;
+					&lt;/xsl:if&gt;
+				
+					&lt;xsl:if test="contains(gmd:CI_PresentationFormCode/@codeListValue, 'Hardcopy')"&gt;
+						&lt;Field name="paper" string="true" store="true" index="true" token="false"/&gt;
+					&lt;/xsl:if&gt;
+				&lt;/xsl:for-each&gt;
+			&lt;/xsl:for-each&gt;
+
+			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+	
+			&lt;xsl:for-each select="gmd:abstract/gco:CharacterString"&gt;
+				&lt;Field name="abstract" string="{string(.)}" store="true" index="true" token="true"/&gt;
+			&lt;/xsl:for-each&gt;
+
+			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+
+			&lt;xsl:for-each select="gmd:extent/gmd:EX_Extent"&gt;
+				&lt;xsl:apply-templates select="gmd:geographicElement/gmd:EX_GeographicBoundingBox" mode="latLon"/&gt;
+
+				&lt;xsl:for-each select="gmd:geographicElement/gmd:EX_GeographicDescription/gmd:geographicIdentifier/gmd:MD_Identifier/gmd:code/gco:CharacterString"&gt;
+					&lt;Field name="geoDescCode" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+
+				&lt;xsl:for-each select="gmd:temporalElement/gmd:EX_TemporalExtent/gmd:extent"&gt;
+					&lt;xsl:for-each select="gml:TimePeriod/gml:beginPosition"&gt;
+						&lt;Field name="tempExtentBegin" string="{string(.)}" store="true" index="true" token="false"/&gt;
+					&lt;/xsl:for-each&gt;
+
+					&lt;xsl:for-each select="gml:TimePeriod/gml:endPosition"&gt;
+						&lt;Field name="tempExtentEnd" string="{string(.)}" store="true" index="true" token="false"/&gt;
+					&lt;/xsl:for-each&gt;
+				&lt;/xsl:for-each&gt;
+			&lt;/xsl:for-each&gt;
+
+			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+
+			&lt;xsl:for-each select="gmd:descriptiveKeywords/gmd:MD_Keywords"&gt;
+				&lt;xsl:for-each select="gmd:keyword/gco:CharacterString"&gt;
+					&lt;Field name="keyword" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+
+				&lt;xsl:for-each select="gmd:type/gmd:MD_KeywordTypeCode/@codeListValue"&gt;
+					&lt;Field name="keywordType" string="{string(.)}" store="true" index="true" token="true"/&gt;
+				&lt;/xsl:for-each&gt;
+			&lt;/xsl:for-each&gt;
+	
+			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+	
+			&lt;xsl:for-each select="gmd:pointOfContact/gmd:CI_ResponsibleParty/gmd:organisationName/gco:CharacterString"&gt;
+				&lt;Field name="orgName" string="{string(.)}" store="true" index="true" token="true"/&gt;
+			&lt;/xsl:for-each&gt;
+
+			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+	
+			&lt;xsl:choose&gt;
+				&lt;xsl:when test="gmd:resourceConstraints/gmd:MD_SecurityConstraints"&gt;
+					&lt;Field name="secConstr" string="true" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:when&gt;
+				&lt;xsl:otherwise&gt;
+					&lt;Field name="secConstr" string="false" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:otherwise&gt;
+			&lt;/xsl:choose&gt;
+
+			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+	
+			&lt;xsl:for-each select="gmd:topicCategory/gmd:MD_TopicCategoryCode/@codeListValue"&gt;
+				&lt;Field name="topicCat" string="{string(.)}" store="true" index="true" token="false"/&gt;
+			&lt;/xsl:for-each&gt;
+
+			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+	
+			&lt;xsl:for-each select="gmd:language/gco:CharacterString"&gt;
+				&lt;Field name="datasetLang" string="{string(.)}" store="true" index="true" token="false"/&gt;
+			&lt;/xsl:for-each&gt;
+
+			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+
+			&lt;xsl:for-each select="gmd:spatialResolution/gmd:MD_Resolution"&gt;
+				&lt;xsl:for-each select="gmd:equivalentScale/gmd:MD_RepresentativeFraction/gmd:denominator/gco:Integer"&gt;
+					&lt;Field name="denominator" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+
+				&lt;xsl:for-each select="gmd:distance/gco:Distance"&gt;
+					&lt;Field name="distanceVal" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+
+				&lt;xsl:for-each select="gmd:distance/gco:Distance/@uom"&gt;
+					&lt;Field name="distanceUom" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+			&lt;/xsl:for-each&gt;
+
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Distribution === --&gt;		
+
+		&lt;xsl:for-each select="gmd:distributionInfo/gmd:MD_Distribution"&gt;
+			&lt;xsl:for-each select="gmd:distributionFormat/gmd:MD_Format/gmd:name/gco:CharacterString"&gt;
+				&lt;Field name="format" string="{string(.)}" store="true" index="true" token="false"/&gt;
+			&lt;/xsl:for-each&gt;
+
+			&lt;!-- index online protocol --&gt;
+			
+			&lt;xsl:for-each select="gmd:transferOptions/gmd:MD_DigitalTransferOptions/gmd:onLine/gmd:CI_OnlineResource/gmd:protocol/gco:CharacterString"&gt;
+				&lt;Field name="protocol" string="{string(.)}" store="true" index="true" token="false"/&gt;
+			&lt;/xsl:for-each&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === General stuff === --&gt;		
+
+		&lt;xsl:choose&gt;
+			&lt;xsl:when test="gmd:hierarchyLevel"&gt;
+				&lt;xsl:for-each select="gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue"&gt;
+					&lt;Field name="type" string="{string(.)}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:for-each&gt;
+			&lt;/xsl:when&gt;
+			&lt;xsl:otherwise&gt;
+				&lt;Field name="type" string="dataset" store="true" index="true" token="false"/&gt;
+			&lt;/xsl:otherwise&gt;
+		&lt;/xsl:choose&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+
+		&lt;xsl:for-each select="gmd:hierarchyLevelName/gco:CharacterString"&gt;
+			&lt;Field name="levelName" string="{string(.)}" store="true" index="true" token="true"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+
+		&lt;xsl:for-each select="gmd:language/gco:CharacterString"&gt;
+			&lt;Field name="language" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+
+		&lt;xsl:for-each select="gmd:fileIdentifier/gco:CharacterString"&gt;
+			&lt;Field name="fileId" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+
+		&lt;xsl:for-each select="gmd:parentIdentifier/gco:CharacterString"&gt;
+			&lt;Field name="parentId" string="{string(.)}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Reference system info === --&gt;		
+
+		&lt;xsl:for-each select="gmd:referenceSystemInfo/gmd:MD_ReferenceSystem"&gt;
+			&lt;xsl:for-each select="gmd:referenceSystemIdentifier/gmd:RS_Identifier"&gt;
+				&lt;xsl:variable name="crs" select="concat(string(gmd:codeSpace/gco:CharacterString),'::',string(gmd:code/gco:CharacterString))"/&gt;
+
+				&lt;xsl:if test="$crs != '::'"&gt;
+					&lt;Field name="crs" string="{$crs}" store="true" index="true" token="false"/&gt;
+				&lt;/xsl:if&gt;
+			&lt;/xsl:for-each&gt;
+		&lt;/xsl:for-each&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- === Free text search === --&gt;		
+
+		&lt;Field name="any" store="false" index="true" token="true"&gt;
+			&lt;xsl:attribute name="string"&gt;
+				&lt;xsl:apply-templates select="." mode="allText"/&gt;
+			&lt;/xsl:attribute&gt;
+		&lt;/Field&gt;
+
+		&lt;xsl:apply-templates select="." mode="codeList"/&gt;
+		
+	&lt;/xsl:template&gt;
+
+	&lt;!-- ========================================================================================= --&gt;
+	&lt;!-- codelist element, indexed, not stored nor tokenized --&gt;
+	
+	&lt;xsl:template match="*[./*/@codeListValue]" mode="codeList"&gt;
+		&lt;xsl:param name="name" select="name(.)"/&gt;
+		
+		&lt;Field name="{$name}" string="{*/@codeListValue}" store="false" index="true" token="false"/&gt;		
+	&lt;/xsl:template&gt;
+
+	&lt;!-- ========================================================================================= --&gt;
+	
+	&lt;xsl:template match="*" mode="codeList"&gt;
+		&lt;xsl:apply-templates select="*" mode="codeList"/&gt;
+	&lt;/xsl:template&gt;
+	
+	&lt;!-- ========================================================================================= --&gt;
+	&lt;!-- latlon coordinates + 360, zero-padded, indexed, not stored, not tokenized --&gt;
+	
+	&lt;xsl:template match="*" mode="latLon"&gt;
+	
+		&lt;xsl:for-each select="gmd:westBoundLongitude"&gt;
+			&lt;Field name="westBL" string="{string(gco:Decimal) + 360}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+	
+		&lt;xsl:for-each select="gmd:southBoundLatitude"&gt;
+			&lt;Field name="southBL" string="{string(gco:Decimal) + 360}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+	
+		&lt;xsl:for-each select="gmd:eastBoundLongitude"&gt;
+			&lt;Field name="eastBL" string="{string(gco:Decimal) + 360}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+	
+		&lt;xsl:for-each select="gmd:northBoundLatitude"&gt;
+			&lt;Field name="northBL" string="{string(gco:Decimal) + 360}" store="true" index="true" token="false"/&gt;
+		&lt;/xsl:for-each&gt;
+	
+	&lt;/xsl:template&gt;
+
+	&lt;!-- ========================================================================================= --&gt;
+	&lt;!--allText --&gt;
+	
+	&lt;xsl:template match="*" mode="allText"&gt;
+		&lt;xsl:for-each select="@*"&gt;
+			&lt;xsl:if test="name(.) != 'codeList' "&gt;
+				&lt;xsl:value-of select="concat(string(.),' ')"/&gt;
+			&lt;/xsl:if&gt;	
+		&lt;/xsl:for-each&gt;
+
+		&lt;xsl:choose&gt;
+			&lt;xsl:when test="*"&gt;&lt;xsl:apply-templates select="*" mode="allText"/&gt;&lt;/xsl:when&gt;
+			&lt;xsl:otherwise&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:otherwise&gt;
+		&lt;/xsl:choose&gt;
+	&lt;/xsl:template&gt;
+
+	&lt;!-- ========================================================================================= --&gt;
+
+&lt;/xsl:stylesheet&gt;

Deleted: trunk/web/geonetwork/xml/search/dublin-core.xsl
===================================================================
--- trunk/web/geonetwork/xml/search/dublin-core.xsl	2007-10-30 13:28:35 UTC (rev 951)
+++ trunk/web/geonetwork/xml/search/dublin-core.xsl	2007-10-30 16:04:32 UTC (rev 952)
@@ -1,122 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
-&lt;xsl:stylesheet version="1.0"
-					 xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-					 xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
-					 xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
-
-&lt;xsl:output method="xml" indent="yes"/&gt;
-
-&lt;xsl:template match="/"&gt;
-	&lt;Document&gt;
-
-		&lt;xsl:variable name="coverage" select="/simpledc/dc:coverage"/&gt;
-		&lt;xsl:variable name="n" select="substring-after($coverage,'North ')"/&gt;
-		&lt;xsl:variable name="north" select="substring-before($n,',')"/&gt;
-		&lt;xsl:variable name="s" select="substring-after($coverage,'South ')"/&gt;
-		&lt;xsl:variable name="south" select="substring-before($s,',')"/&gt;
-		&lt;xsl:variable name="e" select="substring-after($coverage,'East ')"/&gt;
-		&lt;xsl:variable name="east" select="substring-before($e,',')"/&gt;
-		&lt;xsl:variable name="w" select="substring-after($coverage,'West ')"/&gt;
-		&lt;xsl:variable name="west" select="substring-before($w,'. ')"/&gt;
-		&lt;xsl:variable name="p" select="substring-after($coverage,'(')"/&gt;
-		&lt;xsl:variable name="place" select="substring-before($p,')')"/&gt;
-		
-		&lt;xsl:for-each select="/simpledc/dc:identifier"&gt;
-			&lt;Field name="identifier" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;xsl:for-each select="/simpledc/dct:abstract"&gt;
-			&lt;Field name="abstract" string="{string(.)}" store="true" index="true" token="true"/&gt;
-		&lt;/xsl:for-each&gt;
-		
-		&lt;xsl:for-each select="/simpledc/dct:modified"&gt;
-			&lt;Field name="changeDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;xsl:for-each select="/simpledc/dc:format"&gt;
-			&lt;Field name="format" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;xsl:for-each select="/simpledc/dc:type"&gt;
-			&lt;Field name="type" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;xsl:for-each select="/simpledc/dc:relation"&gt;
-			&lt;Field name="relation" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;xsl:for-each select="/simpledc/dct:spatial"&gt;
-			&lt;Field name="spatial" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- This is needed by the CITE test script to look for strings like 'a b*'
-			  strings that contain spaces --&gt;
-
-		&lt;xsl:for-each select="/simpledc/dc:title"&gt;
-			&lt;Field name="title" string="{string(.)}" store="false" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;xsl:apply-templates select="/simpledc/dc:title"&gt;
-			&lt;xsl:with-param name="name" select="'title'"/&gt;
-			&lt;xsl:with-param name="token" select="'true'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-
-		&lt;xsl:apply-templates select="/simpledc/dc:description"&gt;
-			&lt;xsl:with-param name="name" select="'description'"/&gt;
-			&lt;xsl:with-param name="token" select="'true'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		
-		&lt;Field name="westBL"  string="{$west  + 360}" store="true" index="true" token="false"/&gt;
-		&lt;Field name="eastBL"  string="{$east  + 360}" store="true" index="true" token="false"/&gt;
-		&lt;Field name="southBL" string="{$south + 360}" store="true" index="true" token="false"/&gt;
-		&lt;Field name="northBL" string="{$north + 360}" store="true" index="true" token="false"/&gt;
-		
-		&lt;Field name="keyword" string="{$place}" store="true" index="true" token="false"/&gt;
-
-		
-		&lt;xsl:apply-templates select="/simpledc/dc:subject"&gt;
-			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
-			&lt;xsl:with-param name="store" select="'true'"/&gt;
-
-			&lt;!--  the value was 'true' and has been changed to false to pass the CITE scripts 
-					Anyway, users should add several dc:subject elements each one containing a
-					single word. Hence, it is lecit to not tokenize the subject --&gt;
-
-			&lt;xsl:with-param name="token" select="'false'"/&gt; 
-		&lt;/xsl:apply-templates&gt;
-
-		&lt;Field name="any" store="false" index="true" token="true"&gt;
-			&lt;xsl:attribute name="string"&gt;
-				&lt;xsl:apply-templates select="/simpledc" mode="allText"/&gt;
-			&lt;/xsl:attribute&gt;
-		&lt;/Field&gt;
-
-		&lt;!-- locally searchable fields --&gt;
-		
-		&lt;!-- defaults to true --&gt;
-		&lt;Field name="digital" string="true" store="false" index="true" token="false"/&gt;
-			
-	&lt;/Document&gt;
-&lt;/xsl:template&gt;
-
-&lt;!-- text element, by default indexed, not stored, tokenized --&gt;
-&lt;xsl:template match="*"&gt;
-	&lt;xsl:param name="name"  select="name(.)"/&gt;
-	&lt;xsl:param name="store" select="'false'"/&gt;
-	&lt;xsl:param name="index" select="'true'"/&gt;
-	&lt;xsl:param name="token" select="'false'"/&gt;
-	
-   &lt;Field name="{$name}" string="{string(.)}" store="{$store}" index="{$index}" token="{$token}"/&gt;
-&lt;/xsl:template&gt;
-
-&lt;!--allText --&gt;
-&lt;xsl:template match="*" mode="allText"&gt;
-	&lt;xsl:for-each select="@*"&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:for-each&gt;
-	&lt;xsl:choose&gt;
-		&lt;xsl:when test="*"&gt;&lt;xsl:apply-templates select="*" mode="allText"/&gt;&lt;/xsl:when&gt;
-		&lt;xsl:otherwise&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:otherwise&gt;
-	&lt;/xsl:choose&gt;
-&lt;/xsl:template&gt;
-
-&lt;/xsl:stylesheet&gt;
-

Deleted: trunk/web/geonetwork/xml/search/fgdc-std.xsl
===================================================================
--- trunk/web/geonetwork/xml/search/fgdc-std.xsl	2007-10-30 13:28:35 UTC (rev 951)
+++ trunk/web/geonetwork/xml/search/fgdc-std.xsl	2007-10-30 16:04:32 UTC (rev 952)
@@ -1,88 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
-&lt;xsl:stylesheet xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>" version="1.0"&gt;
-
-&lt;xsl:template match="/"&gt;
-	&lt;Document&gt;
-
-		&lt;xsl:apply-templates select="/metadata/idinfo/citation/citeinfo/title"&gt;
-			&lt;xsl:with-param name="token" select="'true'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		
-		&lt;xsl:apply-templates select="/metadata/idinfo/descript/abstract"&gt;
-			&lt;xsl:with-param name="token" select="'true'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		
-		&lt;xsl:apply-templates select="/metadata/idinfo/spdom/bounding/westbc" mode="latLon"&gt;
-			&lt;xsl:with-param name="name" select="'westBL'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		&lt;xsl:apply-templates select="/metadata/idinfo/spdom/bounding/eastbc" mode="latLon"&gt;
-			&lt;xsl:with-param name="name" select="'eastBL'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		&lt;xsl:apply-templates select="/metadata/idinfo/spdom/bounding/southbc" mode="latLon"&gt;
-			&lt;xsl:with-param name="name" select="'southBL'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		&lt;xsl:apply-templates select="/metadata/idinfo/spdom/bounding/northbc" mode="latLon"&gt;
-			&lt;xsl:with-param name="name" select="'northBL'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		
-		&lt;xsl:apply-templates select="/metadata/idinfo/keywords/theme/themekey"&gt;
-			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
-			&lt;xsl:with-param name="store" select="'true'"/&gt;
-			&lt;xsl:with-param name="token" select="'false'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		&lt;xsl:apply-templates select="/metadata/idinfo/keywords/place/placekey"&gt;
-			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
-			&lt;xsl:with-param name="store" select="'true'"/&gt;
-			&lt;xsl:with-param name="token" select="'false'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		&lt;xsl:apply-templates select="/metadata/idinfo/keywords/stratum/stratkey"&gt;
-			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
-			&lt;xsl:with-param name="store" select="'true'"/&gt;
-			&lt;xsl:with-param name="token" select="'false'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		&lt;xsl:apply-templates select="/metadata/idinfo/keywords/temporal/tempkey"&gt;
-			&lt;xsl:with-param name="name" select="'keyword'"/&gt;
-			&lt;xsl:with-param name="store" select="'true'"/&gt;
-			&lt;xsl:with-param name="token" select="'false'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-
-		&lt;Field name="any" store="false" index="true" token="true"&gt;
-			&lt;xsl:attribute name="string"&gt;
-				&lt;xsl:apply-templates select="/metadata" mode="allText"/&gt;
-			&lt;/xsl:attribute&gt;
-		&lt;/Field&gt;
-
-		&lt;!-- locally searchable fields --&gt;
-		
-		&lt;!-- defaults to true --&gt;
-		&lt;Field name="digital" string="true" store="false" index="true" token="false"/&gt;
-			
-	&lt;/Document&gt;
-&lt;/xsl:template&gt;
-
-&lt;!-- text element, by default indexed, not stored, tokenized --&gt;
-&lt;xsl:template match="*"&gt;
-	&lt;xsl:param name="name"  select="name(.)"/&gt;
-	&lt;xsl:param name="store" select="'false'"/&gt;
-	&lt;xsl:param name="index" select="'true'"/&gt;
-	&lt;xsl:param name="token" select="'false'"/&gt;
-	
-   &lt;Field name="{$name}" string="{string(.)}" store="{$store}" index="{$index}" token="{$token}"/&gt;
-&lt;/xsl:template&gt;
-
-&lt;!-- latlon coordinates + 360, zero-padded, indexed, not stored, not tokenized --&gt;
-&lt;xsl:template match="*" mode="latLon"&gt;
-	&lt;xsl:param name="name" select="name(.)"/&gt;
-	&lt;Field name="{$name}" string="{string(.) + 360}" store="true" index="true" token="false"/&gt;
-&lt;/xsl:template&gt;
-
-&lt;!--allText --&gt;
-&lt;xsl:template match="*" mode="allText"&gt;
-	&lt;xsl:for-each select="@*"&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:for-each&gt;
-	&lt;xsl:choose&gt;
-		&lt;xsl:when test="*"&gt;&lt;xsl:apply-templates select="*" mode="allText"/&gt;&lt;/xsl:when&gt;
-		&lt;xsl:otherwise&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:otherwise&gt;
-	&lt;/xsl:choose&gt;
-&lt;/xsl:template&gt;
-
-&lt;/xsl:stylesheet&gt;

Deleted: trunk/web/geonetwork/xml/search/iso19115.xsl
===================================================================
--- trunk/web/geonetwork/xml/search/iso19115.xsl	2007-10-30 13:28:35 UTC (rev 951)
+++ trunk/web/geonetwork/xml/search/iso19115.xsl	2007-10-30 16:04:32 UTC (rev 952)
@@ -1,161 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
-&lt;xsl:stylesheet xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>" version="1.0"&gt;
-
-&lt;xsl:template match="/"&gt;
-	&lt;Document&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Title === --&gt;	
-		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/idCitation/resTitle"&gt;
-			&lt;xsl:with-param name="name"  select="'title'"/&gt;
-			&lt;xsl:with-param name="token" select="'true'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Abstract === --&gt;	
-		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/idAbs"&gt;
-			&lt;xsl:with-param name="name"  select="'abstract'"/&gt;
-			&lt;xsl:with-param name="token" select="'true'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-		
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Revision date === --&gt;
-		&lt;xsl:for-each select="/Metadata/dataIdInfo/idCitation/resRefDate[dateType/DateTypCd/@value='revision']/refDate"&gt;
-			&lt;Field name="revisionDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === creation date === --&gt;
-		&lt;xsl:for-each select="/Metadata/dataIdInfo/idCitation/resRefDate[dateType/DateTypCd/@value='creation']/refDate"&gt;
-			&lt;Field name="creationDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Publication date === --&gt;
-		&lt;xsl:for-each select="/Metadata/dataIdInfo/idCitation/resRefDate[dateType/DateTypCd/@value='publication']/refDate"&gt;
-			&lt;Field name="publicationDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === metadata language === --&gt;
-		&lt;xsl:for-each select="/Metadata/mdLang/languageCode/@value"&gt;
-			&lt;Field name="language" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Metadata file identifier (GUID in GeoNetwork) === --&gt;
-		&lt;xsl:apply-templates select="/Metadata/mdFileID"&gt;
-			&lt;xsl:with-param name="name"  select="'fileId'"/&gt;
-			&lt;xsl:with-param name="token" select="'false'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Parent identifier (should be mapped if available) === --&gt;
-&lt;!--		&lt;xsl:for-each select="/Metadata/parentIdentifier"&gt;
-			&lt;Field name="parentId" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt; --&gt;
-		
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Responsible organization === --&gt;		
-		&lt;xsl:for-each select="/Metadata/mdContact/rpOrgName"&gt;
-			&lt;Field name="orgName" string="{string(.)}" store="true" index="true" token="true"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Security constraints (yes or no) === --&gt;	
-		&lt;xsl:choose&gt;
-			&lt;xsl:when test="/Metadata/mdConst/SecConsts"&gt;
-				&lt;Field name="secConstr" string="true" store="true" index="true" token="false"/&gt;
-			&lt;/xsl:when&gt;
-			&lt;xsl:otherwise&gt;
-				&lt;Field name="secConstr" string="false" store="true" index="true" token="false"/&gt;
-			&lt;/xsl:otherwise&gt;
-		&lt;/xsl:choose&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === latlon coordinates + 360, zero-padded, indexed, not stored, not tokenized === --&gt;
-		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/geoBox/westBL" mode="latLon"/&gt;
-		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/geoBox/eastBL" mode="latLon"/&gt;
-		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/geoBox/southBL" mode="latLon"/&gt;
-		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/geoBox/northBL" mode="latLon"/&gt;
-		
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === keywords === --&gt;
-		&lt;xsl:apply-templates select="/Metadata/dataIdInfo/descKeys/keyword"&gt;
-			&lt;xsl:with-param name="store" select="'true'"/&gt;
-			&lt;xsl:with-param name="token" select="'false'"/&gt;
-		&lt;/xsl:apply-templates&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Online Resources protocol === --&gt;		
-
-		&lt;xsl:for-each select="/Metadata/distInfo/distTranOps"&gt;
-			&lt;xsl:for-each select="onLineSrc/protocol"&gt;
-				&lt;!-- this field MUST NOT be tokenized, otherwise search fails --&gt;
-				&lt;Field name="protocol" string="{string(.)}" store="true" index="true" token="false"/&gt;
-			&lt;/xsl:for-each&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Topic category === --&gt;	
-		
-		&lt;xsl:for-each select="/Metadata/dataIdInfo/tpCat/TopicCatCd/@value"&gt;
-			&lt;Field name="topicCat" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === all text === --&gt;
-		&lt;Field name="any" store="false" index="true" token="true"&gt;
-			&lt;xsl:attribute name="string"&gt;
-				&lt;xsl:apply-templates select="/Metadata" mode="allText"/&gt;
-			&lt;/xsl:attribute&gt;
-		&lt;/Field&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === locally searchable fields === --&gt;
-		
-		&lt;xsl:if test="/Metadata/dataIdInfo/idCitation/presForm[contains(PresFormCd/@value, 'Digital')]"&gt;
-			&lt;Field name="digital" string="true" store="false" index="true" token="false"/&gt;
-		&lt;/xsl:if&gt;
-		
-		&lt;xsl:if test="/Metadata/dataIdInfo/idCitation/presForm[contains(PresFormCd/@value, 'Hardcopy')]"&gt;
-			&lt;Field name="paper" string="true" store="false" index="true" token="false"/&gt;
-		&lt;/xsl:if&gt;
-
-	&lt;/Document&gt;
-&lt;/xsl:template&gt;
-
-&lt;!-- text element, by default indexed, not stored nor tokenized --&gt;
-&lt;xsl:template match="*"&gt;
-	&lt;xsl:param name="name"  select="name(.)"/&gt;
-	&lt;xsl:param name="store" select="'false'"/&gt;
-	&lt;xsl:param name="index" select="'true'"/&gt;
-	&lt;xsl:param name="token" select="'false'"/&gt;
-	
-	&lt;Field name="{$name}" string="{string(.)}" store="{$store}" index="{$index}" token="{$token}"/&gt;
-&lt;/xsl:template&gt;
-
-&lt;!-- codelist element, indexed, not stored nor tokenized --&gt;
-&lt;xsl:template match="*[./*/@value]"&gt;
-	&lt;xsl:param name="name" select="name(.)"/&gt;
-	
-	&lt;Field name="{$name}" string="{*/@value}" store="false" index="true" token="false"/&gt;
-&lt;/xsl:template&gt;
-
-&lt;!-- latlon coordinates + 360, zero-padded, indexed, not stored, not tokenized --&gt;
-&lt;xsl:template match="*" mode="latLon"&gt;
-	&lt;xsl:param name="name" select="name(.)"/&gt;
-	
-	&lt;Field name="{$name}" string="{string(.) + 360}" store="true" index="true" token="false"/&gt;
-&lt;/xsl:template&gt;
-
-&lt;!--allText --&gt;
-&lt;xsl:template match="*" mode="allText"&gt;
-	&lt;xsl:for-each select="@*"&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:for-each&gt;
-	&lt;xsl:choose&gt;
-		&lt;xsl:when test="*"&gt;&lt;xsl:apply-templates select="*" mode="allText"/&gt;&lt;/xsl:when&gt;
-		&lt;xsl:otherwise&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:otherwise&gt;
-	&lt;/xsl:choose&gt;
-&lt;/xsl:template&gt;
-
-&lt;/xsl:stylesheet&gt;

Deleted: trunk/web/geonetwork/xml/search/iso19139.xsl
===================================================================
--- trunk/web/geonetwork/xml/search/iso19139.xsl	2007-10-30 13:28:35 UTC (rev 951)
+++ trunk/web/geonetwork/xml/search/iso19139.xsl	2007-10-30 16:04:32 UTC (rev 952)
@@ -1,289 +0,0 @@
-&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
-
-&lt;xsl:stylesheet version="1.0" xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
-										xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"
-										xmlns:gml="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>"
-										xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"&gt;
-
-	&lt;!-- ========================================================================================= --&gt;
-	
-	&lt;xsl:output method="xml" version="1.0" encoding="UTF-8" indent="yes" /&gt;
-	
-	&lt;!-- ========================================================================================= --&gt;
-
-	&lt;xsl:template match="/"&gt;
-		&lt;Document&gt;
-			&lt;xsl:apply-templates select="gmd:MD_Metadata" mode="metadata"/&gt;
-		&lt;/Document&gt;
-	&lt;/xsl:template&gt;
-	
-	&lt;!-- ========================================================================================= --&gt;
-
-	&lt;xsl:template match="*" mode="metadata"&gt;
-
-		&lt;!-- === Data Identification === --&gt;		
-
-		&lt;!-- the double // here seems needed to index MD_DataIdentification when
-           it is nested in a SV_ServiceIdentification class --&gt;
-
-		&lt;xsl:for-each select="gmd:identificationInfo//gmd:MD_DataIdentification"&gt;
-
-			&lt;xsl:for-each select="gmd:citation/gmd:CI_Citation"&gt;
-				&lt;xsl:for-each select="gmd:identifier/gmd:MD_Identifier/gmd:code/gco:CharacterString"&gt;
-					&lt;Field name="identifier" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-	
-				&lt;xsl:for-each select="gmd:title/gco:CharacterString"&gt;
-					&lt;Field name="title" string="{string(.)}" store="true" index="true" token="true"/&gt;
-				&lt;/xsl:for-each&gt;
-	
-				&lt;xsl:for-each select="gmd:alternateTitle/gco:CharacterString"&gt;
-					&lt;Field name="altTitle" string="{string(.)}" store="true" index="true" token="true"/&gt;
-				&lt;/xsl:for-each&gt;
-
-				&lt;xsl:for-each select="gmd:date/gmd:CI_Date[gmd:dateType/gmd:CI_DateTypeCode/@codeListValue='revision']/gmd:date/gco:Date"&gt;
-					&lt;Field name="revisionDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-
-				&lt;xsl:for-each select="gmd:date/gmd:CI_Date[gmd:dateType/gmd:CI_DateTypeCode/@codeListValue='creation']/gmd:date/gco:Date"&gt;
-					&lt;Field name="createDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-
-				&lt;xsl:for-each select="gmd:date/gmd:CI_Date[gmd:dateType/gmd:CI_DateTypeCode/@codeListValue='publication']/gmd:date/gco:Date"&gt;
-					&lt;Field name="publicationDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-
-				&lt;!-- fields used to search for metadata in paper or digital format --&gt;
-
-				&lt;xsl:for-each select="gmd:presentationForm"&gt;
-					&lt;xsl:if test="contains(gmd:CI_PresentationFormCode/@codeListValue, 'Digital')"&gt;
-						&lt;Field name="digital" string="true" store="true" index="true" token="false"/&gt;
-					&lt;/xsl:if&gt;
-				
-					&lt;xsl:if test="contains(gmd:CI_PresentationFormCode/@codeListValue, 'Hardcopy')"&gt;
-						&lt;Field name="paper" string="true" store="true" index="true" token="false"/&gt;
-					&lt;/xsl:if&gt;
-				&lt;/xsl:for-each&gt;
-			&lt;/xsl:for-each&gt;
-
-			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-	
-			&lt;xsl:for-each select="gmd:abstract/gco:CharacterString"&gt;
-				&lt;Field name="abstract" string="{string(.)}" store="true" index="true" token="true"/&gt;
-			&lt;/xsl:for-each&gt;
-
-			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-
-			&lt;xsl:for-each select="gmd:extent/gmd:EX_Extent"&gt;
-				&lt;xsl:apply-templates select="gmd:geographicElement/gmd:EX_GeographicBoundingBox" mode="latLon"/&gt;
-
-				&lt;xsl:for-each select="gmd:geographicElement/gmd:EX_GeographicDescription/gmd:geographicIdentifier/gmd:MD_Identifier/gmd:code/gco:CharacterString"&gt;
-					&lt;Field name="geoDescCode" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-
-				&lt;xsl:for-each select="gmd:temporalElement/gmd:EX_TemporalExtent/gmd:extent"&gt;
-					&lt;xsl:for-each select="gml:TimePeriod/gml:beginPosition"&gt;
-						&lt;Field name="tempExtentBegin" string="{string(.)}" store="true" index="true" token="false"/&gt;
-					&lt;/xsl:for-each&gt;
-
-					&lt;xsl:for-each select="gml:TimePeriod/gml:endPosition"&gt;
-						&lt;Field name="tempExtentEnd" string="{string(.)}" store="true" index="true" token="false"/&gt;
-					&lt;/xsl:for-each&gt;
-				&lt;/xsl:for-each&gt;
-			&lt;/xsl:for-each&gt;
-
-			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-
-			&lt;xsl:for-each select="gmd:descriptiveKeywords/gmd:MD_Keywords"&gt;
-				&lt;xsl:for-each select="gmd:keyword/gco:CharacterString"&gt;
-					&lt;Field name="keyword" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-
-				&lt;xsl:for-each select="gmd:type/gmd:MD_KeywordTypeCode/@codeListValue"&gt;
-					&lt;Field name="keywordType" string="{string(.)}" store="true" index="true" token="true"/&gt;
-				&lt;/xsl:for-each&gt;
-			&lt;/xsl:for-each&gt;
-	
-			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-	
-			&lt;xsl:for-each select="gmd:pointOfContact/gmd:CI_ResponsibleParty/gmd:organisationName/gco:CharacterString"&gt;
-				&lt;Field name="orgName" string="{string(.)}" store="true" index="true" token="true"/&gt;
-			&lt;/xsl:for-each&gt;
-
-			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-	
-			&lt;xsl:choose&gt;
-				&lt;xsl:when test="gmd:resourceConstraints/gmd:MD_SecurityConstraints"&gt;
-					&lt;Field name="secConstr" string="true" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:when&gt;
-				&lt;xsl:otherwise&gt;
-					&lt;Field name="secConstr" string="false" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:otherwise&gt;
-			&lt;/xsl:choose&gt;
-
-			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-	
-			&lt;xsl:for-each select="gmd:topicCategory/gmd:MD_TopicCategoryCode/@codeListValue"&gt;
-				&lt;Field name="topicCat" string="{string(.)}" store="true" index="true" token="false"/&gt;
-			&lt;/xsl:for-each&gt;
-
-			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-	
-			&lt;xsl:for-each select="gmd:language/gco:CharacterString"&gt;
-				&lt;Field name="datasetLang" string="{string(.)}" store="true" index="true" token="false"/&gt;
-			&lt;/xsl:for-each&gt;
-
-			&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-
-			&lt;xsl:for-each select="gmd:spatialResolution/gmd:MD_Resolution"&gt;
-				&lt;xsl:for-each select="gmd:equivalentScale/gmd:MD_RepresentativeFraction/gmd:denominator/gco:Integer"&gt;
-					&lt;Field name="denominator" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-
-				&lt;xsl:for-each select="gmd:distance/gco:Distance"&gt;
-					&lt;Field name="distanceVal" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-
-				&lt;xsl:for-each select="gmd:distance/gco:Distance/@uom"&gt;
-					&lt;Field name="distanceUom" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-			&lt;/xsl:for-each&gt;
-
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Distribution === --&gt;		
-
-		&lt;xsl:for-each select="gmd:distributionInfo/gmd:MD_Distribution"&gt;
-			&lt;xsl:for-each select="gmd:distributionFormat/gmd:MD_Format/gmd:name/gco:CharacterString"&gt;
-				&lt;Field name="format" string="{string(.)}" store="true" index="true" token="false"/&gt;
-			&lt;/xsl:for-each&gt;
-
-			&lt;!-- index online protocol --&gt;
-			
-			&lt;xsl:for-each select="gmd:transferOptions/gmd:MD_DigitalTransferOptions/gmd:onLine/gmd:CI_OnlineResource/gmd:protocol/gco:CharacterString"&gt;
-				&lt;Field name="protocol" string="{string(.)}" store="true" index="true" token="false"/&gt;
-			&lt;/xsl:for-each&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === General stuff === --&gt;		
-
-		&lt;xsl:choose&gt;
-			&lt;xsl:when test="gmd:hierarchyLevel"&gt;
-				&lt;xsl:for-each select="gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue"&gt;
-					&lt;Field name="type" string="{string(.)}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:for-each&gt;
-			&lt;/xsl:when&gt;
-			&lt;xsl:otherwise&gt;
-				&lt;Field name="type" string="dataset" store="true" index="true" token="false"/&gt;
-			&lt;/xsl:otherwise&gt;
-		&lt;/xsl:choose&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-
-		&lt;xsl:for-each select="gmd:hierarchyLevelName/gco:CharacterString"&gt;
-			&lt;Field name="levelName" string="{string(.)}" store="true" index="true" token="true"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-
-		&lt;xsl:for-each select="gmd:language/gco:CharacterString"&gt;
-			&lt;Field name="language" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-
-		&lt;xsl:for-each select="gmd:fileIdentifier/gco:CharacterString"&gt;
-			&lt;Field name="fileId" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-
-		&lt;xsl:for-each select="gmd:parentIdentifier/gco:CharacterString"&gt;
-			&lt;Field name="parentId" string="{string(.)}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Reference system info === --&gt;		
-
-		&lt;xsl:for-each select="gmd:referenceSystemInfo/gmd:MD_ReferenceSystem"&gt;
-			&lt;xsl:for-each select="gmd:referenceSystemIdentifier/gmd:RS_Identifier"&gt;
-				&lt;xsl:variable name="crs" select="concat(string(gmd:codeSpace/gco:CharacterString),'::',string(gmd:code/gco:CharacterString))"/&gt;
-
-				&lt;xsl:if test="$crs != '::'"&gt;
-					&lt;Field name="crs" string="{$crs}" store="true" index="true" token="false"/&gt;
-				&lt;/xsl:if&gt;
-			&lt;/xsl:for-each&gt;
-		&lt;/xsl:for-each&gt;
-
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
-		&lt;!-- === Free text search === --&gt;		
-
-		&lt;Field name="any" store="false" index="true" token="true"&gt;
-			&lt;xsl:attribute name="string"&gt;
-				&lt;xsl:apply-templates select="." mode="allText"/&gt;
-			&lt;/xsl:attribute&gt;
-		&lt;/Field&gt;
-
-		&lt;xsl:apply-templates select="." mode="codeList"/&gt;
-		
-	&lt;/xsl:template&gt;
-
-	&lt;!-- ========================================================================================= --&gt;
-	&lt;!-- codelist element, indexed, not stored nor tokenized --&gt;
-	
-	&lt;xsl:template match="*[./*/@codeListValue]" mode="codeList"&gt;
-		&lt;xsl:param name="name" select="name(.)"/&gt;
-		
-		&lt;Field name="{$name}" string="{*/@codeListValue}" store="false" index="true" token="false"/&gt;		
-	&lt;/xsl:template&gt;
-
-	&lt;!-- ========================================================================================= --&gt;
-	
-	&lt;xsl:template match="*" mode="codeList"&gt;
-		&lt;xsl:apply-templates select="*" mode="codeList"/&gt;
-	&lt;/xsl:template&gt;
-	
-	&lt;!-- ========================================================================================= --&gt;
-	&lt;!-- latlon coordinates + 360, zero-padded, indexed, not stored, not tokenized --&gt;
-	
-	&lt;xsl:template match="*" mode="latLon"&gt;
-	
-		&lt;xsl:for-each select="gmd:westBoundLongitude"&gt;
-			&lt;Field name="westBL" string="{string(gco:Decimal) + 360}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-	
-		&lt;xsl:for-each select="gmd:southBoundLatitude"&gt;
-			&lt;Field name="southBL" string="{string(gco:Decimal) + 360}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-	
-		&lt;xsl:for-each select="gmd:eastBoundLongitude"&gt;
-			&lt;Field name="eastBL" string="{string(gco:Decimal) + 360}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-	
-		&lt;xsl:for-each select="gmd:northBoundLatitude"&gt;
-			&lt;Field name="northBL" string="{string(gco:Decimal) + 360}" store="true" index="true" token="false"/&gt;
-		&lt;/xsl:for-each&gt;
-	
-	&lt;/xsl:template&gt;
-
-	&lt;!-- ========================================================================================= --&gt;
-	&lt;!--allText --&gt;
-	
-	&lt;xsl:template match="*" mode="allText"&gt;
-		&lt;xsl:for-each select="@*"&gt;
-			&lt;xsl:if test="name(.) != 'codeList' "&gt;
-				&lt;xsl:value-of select="concat(string(.),' ')"/&gt;
-			&lt;/xsl:if&gt;	
-		&lt;/xsl:for-each&gt;
-
-		&lt;xsl:choose&gt;
-			&lt;xsl:when test="*"&gt;&lt;xsl:apply-templates select="*" mode="allText"/&gt;&lt;/xsl:when&gt;
-			&lt;xsl:otherwise&gt;&lt;xsl:value-of select="concat(string(.),' ')"/&gt;&lt;/xsl:otherwise&gt;
-		&lt;/xsl:choose&gt;
-	&lt;/xsl:template&gt;
-
-	&lt;!-- ========================================================================================= --&gt;
-
-&lt;/xsl:stylesheet&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=4451907">[GeoNetwork-commit] SF.net SVN: geonetwork: [955] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;e_tajariol@us...&gt; -	2007-11-04 22:00</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 955
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=955&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=955&amp;view=rev</a>
Author:   e_tajariol
Date:     2007-11-04 14:00:46 -0800 (Sun, 04 Nov 2007)

Log Message:
-----------
Major update:
- Intermap JS code have been heavily refactorized and cleaned;
- Intermap can now work on its own (and also embedded elsewhere);
- readded identify feature;
- fixed jumpy zoomin;
- fixed AoI;
- fixed importing of Interactive maps from GN entries.

Modified Paths:
--------------
    trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/WmsService.java
    trunk/src/org/wfp/vam/intermap/services/map/Identify.java
    trunk/src/org/wfp/vam/intermap/services/map/Reset.java
    trunk/src/org/wfp/vam/intermap/services/map/Update.java
    trunk/web/geonetwork/scripts/gn_intermap.js
    trunk/web/geonetwork/scripts/gn_search.js
    trunk/web/geonetwork/xsl/main-page.xsl
    trunk/web/geonetwork/xsl/searchform_advanced.xsl
    trunk/web/geonetwork/xsl/searchform_simple_template.xsl
    trunk/web/intermap/WEB-INF/config.xml
    trunk/web/intermap/index.html
    trunk/web/intermap/intermap-embedded.css
    trunk/web/intermap/scripts/im_ajax.js
    trunk/web/intermap/scripts/im_bigmap.js
    trunk/web/intermap/scripts/im_extras.js
    trunk/web/intermap/scripts/im_layers.js
    trunk/web/intermap/scripts/im_minimap.js
    trunk/web/intermap/scripts/util.js
    trunk/web/intermap/xml/user-profiles.xml
    trunk/web/intermap/xsl/im_identify.xsl
    trunk/web/intermap/xsl/index-embedded.xsl
    trunk/web/intermap/xsl/index.xsl
    trunk/web/intermap/xsl/map.xsl

Added Paths:
-----------
    trunk/web/intermap/scripts/im_class.js
    trunk/web/intermap/scripts/im_integration.js
    trunk/web/intermap/scripts/im_standalone.js
    trunk/web/intermap/static/
    trunk/web/intermap/static/iframepoc.html

Removed Paths:
-------------
    trunk/web/intermap/scripts/etj.js

Modified: trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/WmsService.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/WmsService.java	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/WmsService.java	2007-11-04 22:00:46 UTC (rev 955)
@@ -202,30 +202,31 @@
 				+ "&amp;INFO_FORMAT=" + infoFormat;
 
 
-//		System.out.println("GetFeatureInfo request: " + url.toString()); // DEBUG
+		lastResponse = new Element("url").setText(url);
 
-		HttpClient h = new HttpClient(url);
+		// Use the following code if you need to proxy the WMS server response.
 
-		if(infoFormat == WMSFormat.APP_GML
-		   || infoFormat == WMSFormat.TEXT_XHTML  //.equals(Constants.FORMAT_GML) || infoFormat.equals(Constants.FORMAT_XHTML)) {
-		   || infoFormat == WMSFormat.v100_GML1  // TODO test me
-		   || infoFormat == WMSFormat.v100_GML2  // TODO test me
-		   || infoFormat == WMSFormat.v100_GML3) // TODO test me
-		{
-			lastResponse = new Element("gml").addContent(h.getElement());
-//			System.out.println("lastResponse element, " + infoFormat + ": " + Xml.getString(lastResponse)); // DEBUG
-		}
-		else if (infoFormat == WMSFormat.TEXT_HTML) // infoFormat.equals(Constants.FORMAT_HTML)) {
-		{
-			String strResult = h.getString();
-//			System.out.println("Server response: " + strResult); // DEBUG
-			lastResponse = new Element("html").addContent(new CDATA(strResult)); //Add the html as content to an &lt;html&gt; element
-		}
-		else {
-			lastResponse = new Element("text").addContent(new CDATA(h.getString()));
-		}
-//		System.out.println("lastResponse element, "+infoFormat+": " + Xml.getString(lastResponse)); // DEBUG
-
+//		HttpClient h = new HttpClient(url);
+//
+//		if(infoFormat == WMSFormat.APP_GML
+//		   || infoFormat == WMSFormat.TEXT_XHTML  //.equals(Constants.FORMAT_GML) || infoFormat.equals(Constants.FORMAT_XHTML)) {
+//		   || infoFormat == WMSFormat.v100_GML1  // TODO test me
+//		   || infoFormat == WMSFormat.v100_GML2  // TODO test me
+//		   || infoFormat == WMSFormat.v100_GML3) // TODO test me
+//		{
+//			lastResponse = new Element("gml").addContent(h.getElement());
+////			System.out.println("lastResponse element, " + infoFormat + ": " + Xml.getString(lastResponse)); // DEBUG
+//		}
+//		else if (infoFormat == WMSFormat.TEXT_HTML) // infoFormat.equals(Constants.FORMAT_HTML)) {
+//		{
+//			String strResult = h.getString();
+////			System.out.println("Server response: " + strResult); // DEBUG
+//			lastResponse = new Element("html").addContent(new CDATA(strResult)); //Add the html as content to an &lt;html&gt; element
+//		}
+//		else {
+//			lastResponse = new Element("text").addContent(new CDATA(h.getString()));
+//		}
+////		System.out.println("lastResponse element, "+infoFormat+": " + Xml.getString(lastResponse)); // DEBUG
 	}
 
 	/**

Modified: trunk/src/org/wfp/vam/intermap/services/map/Identify.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/services/map/Identify.java	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/src/org/wfp/vam/intermap/services/map/Identify.java	2007-11-04 22:00:46 UTC (rev 955)
@@ -23,18 +23,15 @@
 
 package org.wfp.vam.intermap.services.map;
 
-import java.util.*;
-
-import org.jdom.*;
-
-import jeeves.interfaces.*;
-import jeeves.server.*;
-import jeeves.server.context.*;
-
-import org.wfp.vam.intermap.kernel.map.*;
-
+import jeeves.interfaces.Service;
+import jeeves.server.ServiceConfig;
+import jeeves.server.context.ServiceContext;
+import org.jdom.Element;
 import org.wfp.vam.intermap.Constants;
+import org.wfp.vam.intermap.kernel.map.MapMerger;
+import org.wfp.vam.intermap.kernel.map.mapServices.BoundingBox;
 import org.wfp.vam.intermap.kernel.map.mapServices.MapService;
+import org.wfp.vam.intermap.util.Util;
 
 //=============================================================================
 
@@ -44,33 +41,37 @@
 public class Identify implements Service
 {
 	public void init(String appPath, ServiceConfig config) throws Exception {}
-	
+
 	//--------------------------------------------------------------------------
 	//---
 	//--- Service
 	//---
 	//--------------------------------------------------------------------------
-	
+
 	public Element exec(Element params, ServiceContext context) throws Exception
 	{
 		// Get request parameters
 		String activeLayer = params.getChildText("activeLayer");
 		int x = Integer.parseInt(params.getChildText("mapimgx"));
 		int y = Integer.parseInt(params.getChildText("mapimgy"));
+		int width  = Integer.parseInt(params.getChildText("width"));
+		int height = Integer.parseInt(params.getChildText("height"));
+		BoundingBox bb = Util.parseBoundingBox(params); // search bb in params
+
 		String responseFormat = params.getChildText(Constants.IDENTIFY_FORMAT);
-		
+
 		// Get the MapMerger object from the user session
 		MapMerger mm = MapUtil.getMapMerger(context);
-//		BoundingBox bb = mm.getBoundingBox();
-		
+		mm.setBoundingBox(bb);
+
 		if ("".equals(activeLayer)) return null;
-		
+
 		int service = Integer.parseInt(activeLayer);
 		MapService ms = mm.getService(service);
-		ms.identify(0, x, y, MapUtil.getImageWidth(context), MapUtil.getImageHeight(context), Constants.PIXEL_TOLERANCE, responseFormat);
+		ms.identify(0, x, y, width, height, Constants.PIXEL_TOLERANCE, responseFormat);
 		return new Element("response").addContent(ms.toElement());
 	}
-	
+
 }
 
 //=============================================================================

Modified: trunk/src/org/wfp/vam/intermap/services/map/Reset.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/services/map/Reset.java	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/src/org/wfp/vam/intermap/services/map/Reset.java	2007-11-04 22:00:46 UTC (rev 955)
@@ -54,9 +54,9 @@
 		MapUtil.setDefaultContext(mm);
 		//MapUtil.setDefBoundingBox(mm);
 		context.getUserSession().setProperty(Constants.SESSION_MAP, mm);
-		return null;
+		return mm.toElement();
 	}
-	
+
 }
 
 //=============================================================================

Modified: trunk/src/org/wfp/vam/intermap/services/map/Update.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/services/map/Update.java	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/src/org/wfp/vam/intermap/services/map/Update.java	2007-11-04 22:00:46 UTC (rev 955)
@@ -23,6 +23,7 @@
 
 package org.wfp.vam.intermap.services.map;
 
+import jeeves.exceptions.MissingParameterEx;
 import jeeves.interfaces.Service;
 import jeeves.server.ServiceConfig;
 import jeeves.server.context.ServiceContext;
@@ -49,11 +50,12 @@
 
 	public Element exec(Element params, ServiceContext context) throws Exception
 	{
-		// Get the current image size from the user session
-		/*DEBUG*/if(params.getChildText("width") == null) System.out.println("\n\nNO WIDTH SPECIFIED IN Update()\n");
+		String pwidth  = params.getChildText("width");
+		String pheight = params.getChildText("height");
 
-		int width  = Integer.parseInt(params.getChildText("width"));
-		int height = Integer.parseInt(params.getChildText("height"));
+		// Sanity check
+		if(pwidth == null || pheight == null)
+			throw new MissingParameterEx("Width and height parameters are required");
 
 		MapMerger mm = MapUtil.getMapMerger(context);
 
@@ -71,6 +73,9 @@
 			mm.setBoundingBox(bb);
 
 		// Merge the images now
+		int width  = Integer.parseInt(pwidth);
+		int height = Integer.parseInt(pheight);
+
 		String imagename = mm.merge(width, height);
 		String url = MapUtil.getTempUrl() + "/" + imagename;
 

Modified: trunk/web/geonetwork/scripts/gn_intermap.js
===================================================================
--- trunk/web/geonetwork/scripts/gn_intermap.js	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/geonetwork/scripts/gn_intermap.js	2007-11-04 22:00:46 UTC (rev 955)
@@ -22,25 +22,41 @@
 ***    selecting getCapab resources, a list of the layers offered by the server will be shown, and the user shall select the wanted ones.
 *** 139/115 templates may call one two functions,  
 *** 
-*** 
+*** Requires:
+*** 	getGNServiceURL(service)
+*** 	im_extra_afterLayerUpdated()
+***		im_buildLayerList(req);
+***
 **********************************************************/
 
-/* 
-## Hook from GN xsl for dynamic data
-*/
+/** 
+ * Hook from GN xsl for dynamic data.
+ * Add a layer to the current context.
+ * 
+ * @param {string} url     The WMS server URL
+ * @param {string} service The WMS service name
+ * @param {int} type       The Intermap server type (refer to java source code)
+ */
 function runIM_addService(url, service, type)
 {
-    imc_addService(url, service, type, function(req) {
-             im_buildLayerList(req);
-             refreshNeeded(true);
-             //imc_mm_update(im_mm_width, im_mm_height);
-        });    
+    imc_addService(url, service, type, 
+					function(req) 
+					{
+			             im_buildLayerList(req);
+						 
+						 if(im_extra_afterLayerUpdated)
+						 	im_extra_afterLayerUpdated();
+			        });    
 }
 
-/* 
-## Hook from GN xsl for dynamic data
-## A server url has been specified. A list of selectable services will be displayed
-*/
+/**
+ * Hook from GN xsl for dynamic data.
+ * A server url has been specified. A list of selectable services will be displayed
+ * 
+ * @param {string} url 		The WMS server URL
+ * @param {int} type   		The Intermap server type (refer to java source code)
+ * @param {int} mdid   		The Geonetwork metadata id
+ */
 function runIM_selectService(url, type, mdid)
 {
     gn_showGetCapabilities(url, type, mdid);
@@ -51,10 +67,13 @@
 *  Show list of addable interactive maps
 *
 ********************************************************************/
-/*
-## This method is called by the "Interactive map [+]" button in a displayed metadata.  
-## It will display the metadata distribution info in a div .
-*/
+
+/**
+ * This method is called by the "Interactive map [+]" button in a displayed metadata.
+ * It will display the metadata distribution info in a div .
+ *  
+ * @param {int} id   		The Geonetwork metadata id
+ */
 function gn_showInterList(id) 
 {
     var pars = 'id=' + id + "&amp;currTab=distribution";
@@ -64,7 +83,7 @@
     $('gn_loadinterlist_' + id) .show();
     
     var myAjax = new Ajax.Request(
-        '/geonetwork/srv/'+Env.lang+'/metadata.show.embedded', 
+        getGNServiceURL('metadata.show.embedded'), 
         {
             method: 'get',
             parameters: pars,
@@ -72,7 +91,6 @@
                 // This is a normally invisible DIV below every MD 
                 var parent = $('ilwhiteboard_' + id);
                 clearNode(parent);
-                
                 parent.show();
                 
                 $('gn_loadinterlist_' + id) .hide();
@@ -81,11 +99,11 @@
                 // create new element
                 var div = document.createElement('div');
                 div.className = 'metadata_current';
-                div.hide();
+				div.style.width = '100%'; 
+                $(div).hide();
                 parent.appendChild(div);
                 
                 div.innerHTML = req.responseText;
-                
                 Effect.BlindDown(div);
                 
                 var tipman = new TooltipManager();
@@ -95,6 +113,12 @@
         });
 }
 
+/**
+ * This method is called by the "Interactive map [-]" button in a displayed metadata.
+ * It will hide and delete the div displaying the metadata distribution info.
+ *  
+ * @param {int} id   		The Geonetwork metadata id
+ */
 function gn_hideInterList(id) 
 {
     var parent = $('ilwhiteboard_' + id);
@@ -137,9 +161,10 @@
             
     // Load and transform server's getCapabilities:
     imc_loadURLServices(url, // WMS server 
-                                    -2, // type = -2: free WMS server url 
-                                   function(req) {gn_getCapabLoaded(req,id);}, // callback: function called when ajax request completes 
-                                   "gn_layersRequested("+id+");" ); // jscallback: function called by the button in the HTML returned by the AJAX service (ugly hack)
+    					'0',
+                        -2, // type = -2: free WMS server url 
+                       function(req) {gn_getCapabLoaded(req,id);}, // callback: function called when ajax request completes 
+                       "gn_layersRequested("+id+");" ); // jscallback: function called by the button in the HTML returned by the AJAX service (ugly hack)
 }
 
 function gn_getCapabLoaded(req, mdid)
@@ -155,12 +180,13 @@
     div.innerHTML = req.responseText;    
 }
 
-/*
-## Called by the ok button generated by service mapServers.getServices.embedded
-*/
+/**
+ * Called by the ok button generated by service mapServers.getServices.embedded
+ * @param {int} mdid   		The Geonetwork metadata id
+ */
 function gn_layersRequested(mdid)
 {
-            var im = $('ilwhiteboard_' + mdid);
+	var im = $('ilwhiteboard_' + mdid);
 	//var im = $('im_serverList');
 	
 	// next two elements are created by the mapServers.getServices.embedded service
@@ -204,24 +230,24 @@
 
     im_buildLayerList(req); // rebuild layers' list
     
-    // refreshes should be chained
-    refreshNeeded(true); // refresh big map 
-    im_mm_refreshNeeded(); // refresh minimap			
+	 if(im_extra_afterLayerUpdated)
+	 	im_extra_afterLayerUpdated();			
 }
 
 
 function gn_addCloser(domnode, callback)
 {
-    var closer = Builder.node('div', {class: "im_wbcloser"});
-    var img = Builder.node('img',
-    {
-        title: i18n("close"), 
-        src: "/intermap/images/close.png"
-    });
-    closer.appendChild(img);
-    
-    domnode.appendChild(closer);
-    Event.observe(closer, 'click', 
+	var closer = document.createElement('div');
+	closer.className = 'im_wbcloser';
+	
+	var img = document.createElement('img');
+	img.title = i18n("close");
+	img.src = "/intermap/images/close.png";
+	
+	closer.appendChild(img);
+	
+	domnode.appendChild(closer);
+	Event.observe(closer, 'click', 
         function()
         {  
             clearNode(domnode);
@@ -232,5 +258,4 @@
         
 }
 
-
 /* EOF ******************************************************* EOF */

Modified: trunk/web/geonetwork/scripts/gn_search.js
===================================================================
--- trunk/web/geonetwork/scripts/gn_search.js	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/geonetwork/scripts/gn_search.js	2007-11-04 22:00:46 UTC (rev 955)
@@ -5,9 +5,260 @@
 * - Metadata search &amp; reset
 * - Area of Interest Map behavior
 * - metadata present
+* - metadata vote rating
 *
 ********************************************************************/
 
+/**********************************************************
+***
+***		SIMPLE SEARCH
+***
+**********************************************************/
+
+function initSimpleSearch(wmc)
+{
+	im_mm_init(wmc, function()
+			{
+				$('openIMBtn').style.cursor = 'pointer';
+				Event.observe('openIMBtn', 'click',  function(){openIntermap()} );
+			}
+		);		
+}
+
+function gn_anyKeyObserver(e)
+{
+	if(e.keyCode == Event.KEY_RETURN)
+		runSimpleSearch();
+}
+
+/*  */
+function runSimpleSearch() 
+{
+	preparePresent();
+
+	var pars = "any=" + encodeURIComponent($('any') .value);
+	pars += "&amp;"+im_mm_getURLselectedbbox();
+	pars += fetchParam('relation');
+	pars += "&amp;attrset=geo";
+	pars += fetchParam('region');
+	pars += fetchParam('sortBy');
+	pars += fetchParam('hitsPerPage');
+	pars += fetchParam('output');
+	
+	// Load results via AJAX
+	gn_search(pars);    
+}
+
+function resetSimpleSearch()
+{
+/* make sure all values are completely reset (instead of just using the default
+   form.reset that would only return to the values stored in the session */
+    setParam('any','');		
+    setParam('relation','overlaps');		
+    setParam('region',null);
+    
+    $('northBL').value='90'; 
+    $('southBL').value='-90';
+    $('eastBL').value='180';
+    $('westBL').value='-180';		
+    
+    // FIXME: maybe we should zoom back to a fullExtent (not to the whole world)  
+    im_mm_redrawAoI();
+    im_mm_zoomToAoI(); 	
+ 	setParam('sortBy',      'relevance');
+ 	setParam('hitsPerPage', '10');
+ 	setParam('output',      'full');
+}
+
+/********************************************************************
+* 
+*  Toggling between simple/advanced search
+*
+********************************************************************/
+
+function showAdvancedSearch()
+{
+	closeIntermap();
+	closeSearch('simplesearch');
+	document.cookie = "search=advanced";
+
+	var myAjax = new Ajax.Updater (
+		'advancedsearch',    
+		getGNServiceURL('main.searchform.advanced.embedded'), 
+		{
+			method: 'get',    		    	
+			onComplete: function()
+			{
+				openSearch('advancedsearch');
+				initAdvancedSearch();				
+			},
+			onFailure: im_load_error
+		}
+	);	
+ 
+}
+
+function showSimpleSearch()
+{
+	closeSearch('advancedsearch');
+	document.cookie = "search=default";
+	
+	var myAjax = new Ajax.Updater (
+		'simplesearch',    
+		getGNServiceURL('main.searchform.simple.embedded'), 
+		{
+			method: 'get',
+			onComplete: function()
+			{
+				openSearch('simplesearch');
+				initSimpleSearch();								
+			},
+			onFailure: im_load_error
+		}
+	);	
+}
+
+function openSearch(s)
+{
+	if( ! Prototype.Browser.IE )
+	{
+		Effect.BlindDown(s);
+	}
+	else
+	{    
+		$(s).show();		    
+	}
+}
+
+function closeSearch(s)
+{
+	clearNode('im_mm_map');
+
+	if( ! Prototype.Browser.IE )
+	{
+		Effect.BlindUp($(s), {afterFinish: function(){ clearNode($(s)); } });
+	}
+	else
+	{    
+		$(s).hide();	
+		clearNode($(s))	    
+	}
+}
+
+/**********************************************************
+***
+***		ADVANCED SEARCH
+***
+**********************************************************/
+
+function initAdvancedSearch()
+{
+	im_mm_init();
+
+	new Ajax.Autocompleter('themekey', 'keywordList', 'portal.search.keywords?',{paramName: 'keyword', updateElement : addQuote});
+
+	Calendar.setup({
+		inputField     :    "dateFrom",     // id of the input field
+		ifFormat       :    "%Y-%m-%dT%H:%M:00",      // format of the input field
+		button         :    "from_trigger_c",  // trigger for the calendar (button ID)
+		showsTime 		 :		true,
+		align          :    "Tl",           // alignment (defaults to "Bl")
+		singleClick    :    true
+	});
+	
+	Calendar.setup({
+		inputField	:    "dateTo",     // id of the input field
+		ifFormat	:    "%Y-%m-%dT%H:%M:00",      // format of the input field           
+		button		:    "to_trigger_c",  // trigger for the calendar (button ID)
+		showsTime	:    true,
+		align		:    "Tl",           // alignment (defaults to "Bl")
+		singleClick	:    true
+	});
+
+}
+
+function runAdvancedSearch() 
+{
+	preparePresent();
+
+	var pars = "any=" + encodeURIComponent($('any') .value);
+	pars += "&amp;attrset=geo";
+	pars += fetchParam('title');
+	pars += fetchParam('abstract');
+	pars += fetchParam('themekey');
+	pars += fetchRadioParam('similarity');
+
+	pars += "&amp;"+im_mm_getURLselectedbbox();
+	pars += fetchParam('relation');
+	pars += fetchParam('region');
+
+	if($('radfrom1').checked)
+	{
+		pars += fetchParam('dateFrom');
+		pars += fetchParam('dateTo');
+	}
+
+	pars += fetchParam('group');
+	pars += fetchParam('category');
+	pars += fetchParam('siteId');
+	
+	pars += fetchBoolParam('digital');
+	pars += fetchBoolParam('paper');
+	pars += fetchBoolParam('dynamic');
+	pars += fetchBoolParam('download');
+	pars += fetchParam('protocol').toLowerCase();
+	pars += fetchParam('template');
+	pars += fetchParam('sortBy');
+	pars += fetchParam('hitsPerPage');
+	pars += fetchParam('output');
+
+	// Load results via AJAX
+	gn_search(pars);    
+}
+
+function resetAdvancedSearch()
+{
+/* make sure all values are completely reset (instead of just using the default
+   form.reset that would only return to the values stored in the session */
+	setParam('any','');		
+	setParam('title','');		
+	setParam('abstract','');		
+	setParam('themekey','');		
+	var radioSimil = document.getElementsByName('similarity');
+	radioSimil[1].checked=true;
+	setParam('relation','overlaps');		
+	setParam('region',null);		
+	$('northBL').value='90';
+	$('southBL').value='-90';
+	$('eastBL').value='180';
+	$('westBL').value='-180';
+            im_mm_redrawAoI();
+            im_mm_zoomToAoI();	
+ 	
+	setParam('dateFrom','');
+	setParam('dateTo','');
+	$('radfrom0').checked=true;
+	$('radfrom1').disabled='disabled';
+	setParam('group','');		
+	setParam('category','');		
+	setParam('siteId','');		
+	$('digital') .checked = true;		
+	$('paper')   .checked = false;		
+	$('dynamic') .checked = false;
+	$('download').checked = true;		
+	setParam('protocol',    '');
+	setParam('template',    'n');
+ 	setParam('sortBy',      'relevance');
+ 	setParam('hitsPerPage', '10');
+ 	setParam('output',      'full');
+}
+
+/**********************************************************
+***
+***		RATING
+***
+**********************************************************/
+
 function showOptions()
 {
 	var img = $('options.img');
@@ -114,131 +365,62 @@
 		hideRatingPopup();
 }
 
-/********************************************************************
-* 
-*  Toggling between simple/advanced search
-*
-********************************************************************/
 
-function showAdvancedSearch()
-{
-	closeIntermap();
-	closeSearch('simplesearch');
-	document.cookie = "search=advanced";
-
-	var myAjax = new Ajax.Updater (
-		'advancedsearch',    
-		'/geonetwork/srv/'+Env.lang+'/main.searchform.advanced.embedded', 
-		{
-			method: 'get',    		    	
-			onComplete: function()
-			{
-				openSearch('advancedsearch');
-				initAdvancedSearch();				
-			},
-			onFailure: im_load_error
-		}
-	);	
-}
-
-function showSimpleSearch()
-{
-	closeSearch('advancedsearch');
-	document.cookie = "search=default";
-	
-	var myAjax = new Ajax.Updater (
-		'simplesearch',    
-		'/geonetwork/srv/'+Env.lang+'/main.searchform.simple.embedded', 
-		{
-			method: 'get',
-			onComplete: function()
-			{
-				openSearch('simplesearch');
-				initSimpleSearch();								
-			},
-			onFailure: im_load_error
-		}
-	);	
-}
-
-function openSearch(s)
-{
-	if( ! Prototype.Browser.IE )
-	{
-		Effect.BlindDown(s);
-	}
-	else
-	{    
-		$(s).show();		    
-	}
-}
-
-function closeSearch(s)
-{
-	clearNode('im_mm_map');
-
-	if( ! Prototype.Browser.IE )
-	{
-		Effect.BlindUp($(s), {afterFinish: function(){ clearNode($(s)); } });
-	}
-	else
-	{    
-		$(s).hide();	
-		clearNode($(s))	    
-	}
-}
-
 /********************************************************************
 *** GET BOUNDINGBOX COORDINATES FOR A REGION
 ********************************************************************/
 
 function doRegionSearch()
 {
-	var region = $('region').value
-	if(region=="") 
-	{
-		region=null;
-    $('northBL').value='90';
-    $('southBL').value='-90';
-    $('eastBL').value='180';
-    $('westBL').value='-180';		
-   	im_mm_setAOIandZoom();
-	}
-	else
-	{
-   	getRegion(region);
-	}
+    var region = $('region').value;
+    if(region=="") 
+    {
+        region=null;
+        $('northBL').value='90';
+        $('southBL').value='-90';
+        $('eastBL').value='180';
+        $('westBL').value='-180';
+        
+        im_mm_redrawAoI();
+        im_mm_zoomToAoI();        
+    }
+    else
+    {
+        getRegion(region);
+    }
 }
 
 function getRegion(region) 
 {
     if(region)
         var pars = "id="+region;
-        
+    
     var myAjax = new Ajax.Request(
-    '/geonetwork/srv/'+Env.lang+'/xml.region.get', {
-        method: 'get',
-        parameters: pars,
-        onSuccess: getRegion_complete,
-        onFailure: getRegion_error
-    });
+        getGNServiceURL('xml.region.get'), 
+        {
+            method: 'get',
+            parameters: pars,
+            onSuccess: getRegion_complete,
+            onFailure: getRegion_error
+        }
+    );
 }
 
 function getRegion_complete(req) {
-    var rlist = $('resultList');
-    
     //Response received 
     var node = req.responseXML;
     var northcc = xml.evalXPath(node, 'response/record/north');
     var southcc = xml.evalXPath(node, 'response/record/south');
     var eastcc = xml.evalXPath(node, 'response/record/east');
     var westcc = xml.evalXPath(node, 'response/record/west');
+
     $('northBL').value=northcc;
     $('southBL').value=southcc;
     $('eastBL').value=eastcc;
     $('westBL').value=westcc;
 
-	im_mm_setAOIandZoom();
+    im_mm_redrawAoI();
+    im_mm_zoomToAoI();
 }
 
 function getRegion_error() {
@@ -259,7 +441,8 @@
   else if (wU &lt; -180) { alert("West &lt; -180 degrees"); }
   else 
   { 
-    im_mm_setAOIandZoom(); 
+    im_mm_redrawAoI();
+    im_mm_zoomToAoI(); 
     $('updateBB').style.visibility="hidden";
   }
 }
@@ -283,7 +466,7 @@
 function gn_search(pars) 
 {
 	var myAjax = new Ajax.Request(
-		'/geonetwork/srv/'+Env.lang+'/main.search.embedded', 
+		getGNServiceURL('main.search.embedded'), 
 		{
 			method: 'get',
 			parameters: pars,
@@ -300,7 +483,7 @@
 	var pars = 'from=' + frompage + "&amp;to=" + topage;
 	
 	var myAjax = new Ajax.Request(
-		'/geonetwork/srv/'+Env.lang+'/main.present.embedded', 
+		getGNServiceURL('main.present.embedded'), 
 		{
 			method: 'get',
 			parameters: pars,
@@ -328,7 +511,7 @@
    var pars = 'id=' + id + '&amp;currTab=simple';
 
    var myAjax = new Ajax.Request(
-        '/geonetwork/srv/'+Env.lang+'/metadata.show.embedded', 
+        getGNServiceURL('metadata.show.embedded'), 
         {
             method: 'get',
             parameters: pars,
@@ -361,7 +544,7 @@
     $('gn_loadmd_' + id) .show();
     
     var myAjax = new Ajax.Request(
-        '/geonetwork/srv/'+Env.lang+'/metadata.show.embedded', 
+        getGNServiceURL('metadata.show.embedded'), 
         {
             method: 'get',
             parameters: pars,
@@ -413,63 +596,7 @@
 }
 
 
-/**********************************************************
-***
-***		STUFF FOR SIMPLE SEARCH
-***
-**********************************************************/
 
-function initSimpleSearch(wmc)
-{
-	im_mm_init(wmc, function()
-			{
-				$('openIMBtn').style.cursor = 'pointer';
-				Event.observe('openIMBtn', 'click',  function(){openIntermap()} );
-			}
-		);		
-}
-
-function gn_anyKeyObserver(e)
-{
-	if(e.keyCode == Event.KEY_RETURN)
-		runSimpleSearch();
-}
-
-/*  */
-function runSimpleSearch() 
-{
-	preparePresent();
-
-	var pars = "any=" + encodeURIComponent($('any') .value);
-	pars += "&amp;"+im_mm_getURLselectedbbox();
-	pars += fetchParam('relation');
-	pars += "&amp;attrset=geo";
-	pars += fetchParam('region');
-	pars += fetchParam('sortBy');
-	pars += fetchParam('hitsPerPage');
-	pars += fetchParam('output');
-	
-	// Load results via AJAX
-	gn_search(pars);    
-}
-
-function resetSimpleSearch()
-{
-/* make sure all values are completely reset (instead of just using the default
-   form.reset that would only return to the values stored in the session */
-	setParam('any','');		
-	setParam('relation','overlaps');		
-	setParam('region',null);		
-	$('northBL').value='50'; // ETJ ??? what do these values mean ???
-	$('southBL').value='-50';
-	$('eastBL').value='100';
-	$('westBL').value='-100';		
- 	im_mm_setAOIandZoom();
- 	setParam('sortBy',      'relevance');
- 	setParam('hitsPerPage', '10');
- 	setParam('output',      'full');
-}
-
 /**********************************************************
 ***
 ***		STUFF FOR CATEGORY SEARCH
@@ -487,112 +614,7 @@
 	gn_search(pars);    
 }
 
-/**********************************************************
-***
-***		STUFF FOR ADVANCED SEARCH
-***
-**********************************************************/
 
-function initAdvancedSearch()
-{
-	im_mm_init();
-
-	new Ajax.Autocompleter('themekey', 'keywordList', 'portal.search.keywords?',{paramName: 'keyword', updateElement : addQuote});
-
-	Calendar.setup({
-		inputField     :    "dateFrom",     // id of the input field
-		ifFormat       :    "%Y-%m-%dT%H:%M:00",      // format of the input field
-		button         :    "from_trigger_c",  // trigger for the calendar (button ID)
-		showsTime 		 :		true,
-		align          :    "Tl",           // alignment (defaults to "Bl")
-		singleClick    :    true
-	});
-	
-	Calendar.setup({
-		inputField	:    "dateTo",     // id of the input field
-		ifFormat	:    "%Y-%m-%dT%H:%M:00",      // format of the input field           
-		button		:    "to_trigger_c",  // trigger for the calendar (button ID)
-		showsTime	:    true,
-		align		:    "Tl",           // alignment (defaults to "Bl")
-		singleClick	:    true
-	});
-
-}
-
-function runAdvancedSearch() 
-{
-	preparePresent();
-
-	var pars = "any=" + encodeURIComponent($('any') .value);
-	pars += "&amp;attrset=geo";
-	pars += fetchParam('title');
-	pars += fetchParam('abstract');
-	pars += fetchParam('themekey');
-	pars += fetchRadioParam('similarity');
-
-	pars += "&amp;"+im_mm_getURLselectedbbox();
-	pars += fetchParam('relation');
-	pars += fetchParam('region');
-
-	if($('radfrom1').checked)
-	{
-		pars += fetchParam('dateFrom');
-		pars += fetchParam('dateTo');
-	}
-
-	pars += fetchParam('group');
-	pars += fetchParam('category');
-	pars += fetchParam('siteId');
-	
-	pars += fetchBoolParam('digital');
-	pars += fetchBoolParam('paper');
-	pars += fetchBoolParam('dynamic');
-	pars += fetchBoolParam('download');
-	pars += fetchParam('protocol').toLowerCase();
-	pars += fetchParam('template');
-	pars += fetchParam('sortBy');
-	pars += fetchParam('hitsPerPage');
-	pars += fetchParam('output');
-
-	// Load results via AJAX
-	gn_search(pars);    
-}
-
-function resetAdvancedSearch()
-{
-/* make sure all values are completely reset (instead of just using the default
-   form.reset that would only return to the values stored in the session */
-	setParam('any','');		
-	setParam('title','');		
-	setParam('abstract','');		
-	setParam('themekey','');		
-	var radioSimil = document.getElementsByName('similarity');
-	radioSimil[1].checked=true;
-	setParam('relation','overlaps');		
-	setParam('region',null);		
-	$('northBL').value='90';
-	$('southBL').value='-90';
-	$('eastBL').value='180';
-	$('westBL').value='-180';		
- 	im_mm_setAOIandZoom();
-	setParam('dateFrom','');
-	setParam('dateTo','');
-	$('radfrom0').checked=true;
-	$('radfrom1').disabled='disabled';
-	setParam('group','');		
-	setParam('category','');		
-	setParam('siteId','');		
-	$('digital') .checked = true;		
-	$('paper')   .checked = false;		
-	$('dynamic') .checked = false;
-	$('download').checked = true;		
-	setParam('protocol',    '');
-	setParam('template',    'n');
- 	setParam('sortBy',      'relevance');
- 	setParam('hitsPerPage', '10');
- 	setParam('output',      'full');
-}
-
 /**********************************************************
 *** Search helper functions
 **********************************************************/

Modified: trunk/web/geonetwork/xsl/main-page.xsl
===================================================================
--- trunk/web/geonetwork/xsl/main-page.xsl	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/geonetwork/xsl/main-page.xsl	2007-11-04 22:00:46 UTC (rev 955)
@@ -23,17 +23,20 @@
 		&lt;script type="text/javascript" src="{/root/gui/url}/scripts/calendar/lang/calendar-en.js"/&gt;
 		&lt;link rel="stylesheet" type="text/css" href="{/root/gui/url}/scripts/calendar/calendar-blue2.css" /&gt;
 		
-
+		
 		&lt;script type="text/javascript" src="{/root/gui/url}/scripts/gn_search.js?"/&gt;
 		&lt;script type="text/javascript" src="{/root/gui/url}/scripts/gn_intermap.js?"/&gt;
-		
-		&lt;script type="text/javascript" src="/intermap/scripts/etj.js?"/&gt;
+
+		&lt;script type="text/javascript" src="/intermap/scripts/util.js?" /&gt;
 		&lt;script type="text/javascript" src="/intermap/scripts/im_extras.js?"/&gt;
 		&lt;script type="text/javascript" src="/intermap/scripts/im_ajax.js?" /&gt;
+		
+		&lt;script type="text/javascript" src="/intermap/scripts/im_class.js?"/&gt;
 		&lt;script type="text/javascript" src="/intermap/scripts/im_minimap.js?"/&gt;
 		&lt;script type="text/javascript" src="/intermap/scripts/im_bigmap.js?" /&gt;
+		&lt;script type="text/javascript" src="/intermap/scripts/im_integration.js?"/&gt;
+		
 		&lt;script type="text/javascript" src="/intermap/scripts/im_layers.js?" /&gt;
-		&lt;script type="text/javascript" src="/intermap/scripts/util.js?" /&gt;
 
 		&lt;script type="text/javascript" src="{/root/gui/url}/scripts/core/kernel/kernel.js?"/&gt;
 		&lt;script type="text/javascript" src="{/root/gui/url}/scripts/editor/tooltip-manager.js?"&gt;&lt;/script&gt;
@@ -45,23 +48,30 @@
 		
 		&lt;script type="text/javascript" language="JavaScript1.2"&gt;
 
-			&lt;xsl:choose&gt;
-				&lt;xsl:when test="/root/gui/searchDefaults/intermap='on'"&gt;
-					function init()
-					{
-						var currentSearch = get_cookie('search');
-						if (currentSearch=='advanced') {
-							showAdvancedSearch();
-						} else {
-							initSimpleSearch("&lt;xsl:value-of select="$wmc"/&gt;");
-						}
-					}
-				&lt;/xsl:when&gt;
-			&lt;/xsl:choose&gt;
-								
+			function init()
+			{
+				var currentSearch = get_cookie('search');
+				if (currentSearch=='advanced') {
+					showAdvancedSearch();
+				} else {
+					initSimpleSearch("&lt;xsl:value-of select="$wmc"/&gt;");
+				}
+			}
 			
-			function getWmsLayerInfo(name, url) 
+			var getGNServiceURL = function(service)
+			{				
+				return Env.locService+"/"+service;
+			};
+			
+			var getIMServiceURL = function(service)
 			{
+				// FIXME: the "/intermap/" context should be parametrized
+				return "/intermap/srv/"+Env.lang+"/"+service;
+			};
+					
+			
+&lt;!--			function getWmsLayerInfo(name, url) 
+			{
 				window.open('/intermap/srv/en/map.service.wmsLayerInfo?url='+url+'&amp;amp;name=' + name, 'dialog', 'HEIGHT=300,WIDTH=400,scrollbars=yes,toolbar=no,status=no,menubar=no,location=no,resizable=yes');
 			}
 			
@@ -122,7 +132,7 @@
 					if (document.search.servers.options[i].value == server)
 						document.search.servers.options[i].selected = true;
 			}
-		
+--&gt;		
 			function checkSubmit()
 			{
 				if (document.search.remote.value == 'on')

Modified: trunk/web/geonetwork/xsl/searchform_advanced.xsl
===================================================================
--- trunk/web/geonetwork/xsl/searchform_advanced.xsl	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/geonetwork/xsl/searchform_advanced.xsl	2007-11-04 22:00:46 UTC (rev 955)
@@ -257,11 +257,15 @@
 							&lt;/table&gt;
 						&lt;/td&gt;
 						&lt;td id="im_mm_mapContainer" style="position:relative;width:202px;height:102px;" &gt;
-							&lt;div id="im_mm_map" style="position: absolute;width:202px;height:102px;overflow: hidden;"&gt;
+							&lt;div id="im_mm_map" style="position: absolute;width:200px;height:100px;overflow: hidden;"&gt;
 								&lt;img id="im_mm_image" width="200px" height="100px" src="/intermap/images/map0.jpg"/&gt;
-								&lt;div id="im_mm_aoibox" style="left:0px;top:0px;width:200px;height:100px;position:absolute;border: 1px dashed #f00;visibility: visible;overflow: hidden;"/&gt;
+								&lt;div id="im_mm_aoibox_n" style="left:0px;top:0px;width:0px;height:0px;position:absolute;border-top: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
+								&lt;div id="im_mm_aoibox_e" style="left:0px;top:0px;width:0px;height:0px;position:absolute;border-right: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
+								&lt;div id="im_mm_aoibox_s" style="left:0px;top:0px;width:0px;height:0px;position:absolute;border-bottom: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
+								&lt;div id="im_mm_aoibox_w" style="left:0px;top:0px;width: 0px;height:0px;position:absolute;border-left: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
+								&lt;!--&lt;div id="im_mm_aoibox" style="left:0px;top:0px;width:200px;height:100px;position:absolute;border: 1px dashed #f00;visibility: visible;overflow: hidden;"/&gt;--&gt;
 							&lt;/div&gt;
-							&lt;div id="im_mm_wait" style="position: relative; z-index:999; left:59px; top:45px;"&gt;
+							&lt;div id="im_mm_image_waitdiv" style="position: relative; z-index:999; left:59px; top:45px;"&gt;
 								&lt;img id="im_mm_waitimage" style="position: absolute; z-index:1000;" src="/intermap/images/waiting.gif" /&gt;
 							&lt;/div&gt;
 						&lt;/td&gt;

Modified: trunk/web/geonetwork/xsl/searchform_simple_template.xsl
===================================================================
--- trunk/web/geonetwork/xsl/searchform_simple_template.xsl	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/geonetwork/xsl/searchform_simple_template.xsl	2007-11-04 22:00:46 UTC (rev 955)
@@ -48,11 +48,16 @@
 						&lt;/tr&gt;
 						&lt;tr height="102px" style="position:relative;"&gt;
 							&lt;td id="im_mm_mapContainer" style="position:relative;width:202px;height:102px;" colspan="6"  &gt;
-								&lt;div id="im_mm_map" style="position: absolute;width:202px;height:102px;overflow: hidden;"&gt;
-									&lt;img id="im_mm_image" width="200px" height="100px" style="left:1px;"  src="/intermap/images/map0.jpg"/&gt;
-									&lt;div id="im_mm_aoibox" style="left:0px;top:0px;width:200px;height:100px;position:absolute;border: 1px dashed #f00;visibility: visible;overflow: hidden;"/&gt;
+								&lt;div id="im_mm_map" style="position: absolute;width:200px;height:100px;overflow: hidden;"&gt;
+									&lt;img id="im_mm_image" width="200px" height="100px" style="left:1px;"  src="/geonetwork/images/header-right.gif"/&gt; &lt;!-- "/intermap/images/map0.jpg"/&gt;--&gt;
+
+									&lt;div id="im_mm_aoibox_n" style="left:0px;top:0px;width:0px;height:0px;position:absolute;border-top: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
+									&lt;div id="im_mm_aoibox_e" style="left:0px;top:0px;width:0px;height:0px;position:absolute;border-right: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
+									&lt;div id="im_mm_aoibox_s" style="left:0px;top:0px;width:0px;height:0px;position:absolute;border-bottom: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
+									&lt;div id="im_mm_aoibox_w" style="left:0px;top:0px;width: 0px;height:0px;position:absolute;border-left: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
+&lt;!--									&lt;div id="im_mm_aoibox" style="left:0px;top:0px;width:200px;height:100px;position:absolute;border: 1px dashed #f00;visibility: visible;overflow: hidden;"/&gt;--&gt;
 								&lt;/div&gt;
-								&lt;div id="im_mm_wait" style="position: relative; z-index:999; left:59px; top:45px;"&gt;
+								&lt;div id="im_mm_image_waitdiv" style="position: relative; z-index:999; left:59px; top:45px;"&gt;
 									&lt;img id="im_mm_waitimage" style="position: absolute; z-index:1000;" src="/intermap/images/waiting.gif" /&gt;
 								&lt;/div&gt;
 							&lt;/td&gt;

Modified: trunk/web/intermap/WEB-INF/config.xml
===================================================================
--- trunk/web/intermap/WEB-INF/config.xml	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/intermap/WEB-INF/config.xml	2007-11-04 22:00:46 UTC (rev 955)
@@ -15,7 +15,7 @@
 	&lt;!-- ====================================================================== --&gt;
 
 	&lt;default&gt;
-		&lt;service&gt;mapContexts.get&lt;/service&gt;
+		&lt;service&gt;main&lt;/service&gt;
 		&lt;language&gt;en&lt;/language&gt;
 		&lt;localized&gt;true&lt;/localized&gt;
 		&lt;contentType&gt;text/html; charset=UTF-8&lt;/contentType&gt;
@@ -33,10 +33,10 @@
 
 		&lt;!-- no privileges to access the service --&gt;
 
-		&lt;error id="privileges" sheet="error.xsl"&gt;
+&lt;!--		&lt;error id="privileges" sheet="error.xsl"&gt;
 			&lt;xml name="error" file="xml/privileges-error.xml" /&gt;
 		&lt;/error&gt;
-
+--&gt;
 		&lt;!-- general error --&gt;
 
 		&lt;error sheet="error.xsl"&gt;
@@ -56,7 +56,6 @@
 
 		&lt;param name="mapServers" value="WEB-INF/mapServers.xml" /&gt;
 		&lt;param name="axlRequests" value="WEB-INF/axl" /&gt;
-		&lt;param name="wmsTransform" value="WEB-INF/wms" /&gt;
 		
 		&lt;!-- proxy server --&gt;
 
@@ -95,16 +94,17 @@
 
 	&lt;services package="org.wfp.vam.intermap"&gt;
 		
-		&lt;!--&lt;service name="map.getMain"&gt;
-			&lt;class name=".services.map.Main" /&gt;
+		&lt;service name="main"&gt;
+			&lt;class name=".services.map.Update" /&gt;
 			
-			&lt;output test="/response/status/@empty='false'" sheet="index.xsl" /&gt;
+&lt;!--			&lt;output test="/response/status/@empty='false'" sheet="index.xsl" /&gt;
 			&lt;output test="/response/status/@empty='true'" forward="mapContexts.get" /&gt;
-
+--&gt;
 			&lt;output sheet="index.xsl" /&gt;
- 
+			
+			&lt;error sheet="copy_error.xsl" contentType="text/xml; charset=UTF-8"/&gt;			
 		&lt;/service&gt;
---&gt;
+
 		&lt;!-- ETj: return an XHTML to be embedded elsewhere --&gt;
 		
 		&lt;service name="map.getMain.embedded"&gt;			
@@ -370,9 +370,7 @@
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
 		
 		&lt;service name="map.reset"&gt;
-			&lt;class name=".services.map.Reset" /&gt;
-			
-			&lt;output forward="mapContexts.get" /&gt;
+			&lt;class name=".services.map.Reset" /&gt;			
 		&lt;/service&gt;
 
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;

Modified: trunk/web/intermap/index.html
===================================================================
--- trunk/web/intermap/index.html	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/intermap/index.html	2007-11-04 22:00:46 UTC (rev 955)
@@ -1,14 +1,14 @@
 &lt;html&gt;
 	&lt;head&gt;
-		&lt;meta http-equiv="refresh" content="0; URL=/intermap/srv/en/map.getMain"&gt;
+		&lt;meta http-equiv="refresh" content="0; URL=/intermap/srv/en/main?width=200&amp;height=100"&gt;
 		&lt;meta http-equiv="Pragma" content="no-cache"&gt;
 		&lt;meta http-equiv="Cache-Control" content="no-cache,no-store"&gt;
 	
 		&lt;script language="Javascript1.5" type="text/javascript"&gt;
-			window.location="/intermap/srv/en/map.getMain"
+			window.location="/intermap/srv/en/main?width=200&amp;height=100";
 		&lt;/script&gt;
 	&lt;/head&gt;
 	&lt;body bgcolor="#FFFFFF"&gt;
-		&lt;font size=-5&gt;&lt;a href="/intermap/srv/en/map.getMain"&gt;InterMap&lt;/a&gt;&lt;/font&gt;
+		&lt;font size=-5&gt;&lt;a href="/intermap/srv/en/main"&gt;InterMap&lt;/a&gt;&lt;/font&gt;
 	&lt;/body&gt;
 &lt;/html&gt;

Modified: trunk/web/intermap/intermap-embedded.css
===================================================================
--- trunk/web/intermap/intermap-embedded.css	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/intermap/intermap-embedded.css	2007-11-04 22:00:46 UTC (rev 955)
@@ -72,15 +72,20 @@
     	z-index: 10;	
 }
 
-.pan #im_mm_image {    cursor: move; }
-.zoomin #im_mm_image {    cursor: crosshair; }
+.pan #im_mm_image 
+{    cursor: move; }
 
+.zoomin #im_mm_image, 
+.zoomout #im_mm_image,
+.aoi #im_mm_image 
+{    cursor: crosshair; }
+
 td.im_mmtool  {
     width:18px;
     height:18px;
 }
 
-.im_mmtool  {
+.im_mmtool, .im_tool  {
 	padding: 0px 0px 0px 0px;	
 	color: white;
 	vertical-align: middle;
@@ -101,6 +106,7 @@
 	cursor: pointer;
 }
 
+.im_tool img, 
 .im_mmtool img {
 	padding: 2px 2px 2px 2px;
 	border: 1px transparent solid;
@@ -157,18 +163,27 @@
 .zoomin     #im_tool_zoomin,
 .zoomout   #im_tool_zoomout,
 .pan          #im_tool_pan,
+.mark        #im_tool_mark ,
 .identify     #im_tool_identify 
 {
 	background: yellow;
 	color: #266397;
 }
 
-/*hovering*/
+/***********
+hovering
+************/
+
+/* These buttons are one-shot actions */
 #im_tool_fullextent :hover, 
 #im_tool_zoomsel :hover,
+#im_tool_mark :hover, 
+#im_tool_refresh :hover,
 #im_tool_reset :hover, 
+
 #im_tool_fullextent img:hover, 
 #im_tool_zoomsel img:hover,
+#im_tool_mark img:hover, 
 #im_tool_refresh img:hover,
 #im_tool_reset img:hover
 {
@@ -176,14 +191,18 @@
 	cursor: pointer;
 }
 
+/* These buttons are persistent tools */
 #im_tool_aoi :hover,
 #im_tool_zoomin :hover,
 #im_tool_zoomout :hover,
 #im_tool_pan :hover, 
+#im_tool_identify :hover, 
+
 #im_tool_aoi img:hover,
 #im_tool_zoomin img:hover,
 #im_tool_zoomout img:hover,
-#im_tool_pan img:hover 
+#im_tool_pan img:hover, 
+#im_tool_identify img:hover 
 {
 	border: 1px blue solid;
 	cursor: pointer;
@@ -363,11 +382,6 @@
 banner
 *******************************************************************************/
 
-
-
-
-
-
 td.im_padded-content {
 	background: #e7edf5;
 	padding-top: 4px;
@@ -549,8 +563,10 @@
 	visibility: visible;
 }
 
-div#im_mm_zoombox,
-div#im_zoombox {
+div#im_mm_image_zoombox,
+div#im_zoombox,
+div#im_bm_image_zoombox
+{
 	position: absolute;
 	border-style: dashed;
 	border-color: red;
@@ -560,9 +576,16 @@
 	padding: 0px;
 	margin: 0px;
 	font-size: 0px;
+
+           background-color: white;
+	filter:alpha (opacity=30); /* MS Internet Explorer */ 
+	filter:progid:DXImageTransform.Microsoft.Alpha (style=0, opacity=30); /* MS IE proprietory */ 
+	-moz-opacity: 0.3; /* Mozilla v1.6 and below */ 
+	opacity: 0.3; /* CSS-3 Standards */ 
+	-khtml-opacity:.3; /* Safari */	
 }
 
-#im_mm_aoibox {
+/*#im_mm_aoibox {
 	position: absolute;
 	border-style: solid;
 	border-color: blue;
@@ -573,7 +596,7 @@
 	margin: 0px;
 	font-size: 0px;
 }
-
+*/
 div#im_bm_resizebox {
 	position: absolute;
 	border-style: dotted;
@@ -609,7 +632,7 @@
 	height: 20px;
 }
 
-div#im_pleaseWait
+div#im_bm_image_waitdiv
 {
 	width: 100%;
 /*	height: 400px;*/
@@ -638,18 +661,27 @@
 */
 
 #im_mm_image,
-#im_mapImg {
-	position: absolute;
+#im_bm_image {
+/*	position: absolute;*/
 	left: 0;
 	top: 0px; 
 	z-index: 1;
 	visibility: visible;
 }
 
-.pan #im_mapImg {    cursor: move; }
-.zoomin #im_mapImg {    cursor: crosshair; }
+/* set the cursor on the bigmap according to the tool*/
+.pan #im_bm_image 
+{    cursor: move; }
 
+.zoomin #im_bm_image,
+.zoomout #im_bm_image
+{   cursor: crosshair; }
 
+.identify #im_bm_image
+{    cursor: help; }
+
+
+
 #im_scale {
 	position: absolute;
 /*	left: 5px;*/
@@ -840,3 +872,24 @@
     
     z-index: 20;    
 }
+
+.im_marker
+{
+           position: absolute;
+           z-index: 100;
+}
+
+.im_markerbox
+{
+           position: absolute;
+           z-index: 100;
+           border: 1px solid #555555;
+           background-color: white;
+           
+	filter:alpha (opacity=50); /* MS Internet Explorer */ 
+	filter:progid:DXImageTransform.Microsoft.Alpha (style=0, opacity=50); /* MS IE proprietory */ 
+	-moz-opacity: 0.5; /* Mozilla v1.6 and below */ 
+	opacity: 0.5; /* CSS-3 Standards */ 
+	-khtml-opacity:.5; /* Safari */
+           
+}
\ No newline at end of file

Deleted: trunk/web/intermap/scripts/etj.js
===================================================================
--- trunk/web/intermap/scripts/etj.js	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/intermap/scripts/etj.js	2007-11-04 22:00:46 UTC (rev 955)
@@ -1,157 +0,0 @@
-
-var minLayersDivWidth = 176;
-
-/*
-* The init procedure goes like this:
-* - load minimap
-* - enable the "Open Map Viewer"
-* - wait for the "Open Map Viewer" command, then 
-*    - load map viewer html skeleton 
-*/
-
-var im_1stTimeIntermap = true;
-
-function openIntermap()
-{
-    if(im_1stTimeIntermap)
-    {
-        im_1stTimeIntermap = false;
-        
-        $('openIMBtn').hide(); 
-        $('loadIMBtn').show(); 
-        
-        imc_init_loadSkel();
-        return;        // loadSkel should call us back
-    }
-    
-    $('openIMBtn').hide(); 
-    $('loadIMBtn').hide(); 
-    $('closeIMBtn').show(); 
-    
-    if( ! Prototype.Browser.IE )
-    {
-        Effect.BlindDown('im_map');
-        Effect.BlindDown('im_mapImg');
-        Effect.BlindDown('fillMeWithIntermap');
-    }
-    else
-    {    
-        $('im_map').show();	
-        $('im_mapImg').show();
-        $('fillMeWithIntermap').show();
-    }
-        
-//	forceIErefresh();        
-}				 
-
-function closeIntermap()
-{
-	if( ! $('im_map'))
-		return;
-
-	// These buttons may have been already removed from page if we're leaving simple search 
-	try {
-		$('closeIMBtn').hide();
-		$('openIMBtn').show();
-	} catch(e) { /*nothing to do*/} 
-	
-	if( ! Prototype.Browser.IE )
-	{
-		Effect.BlindUp('im_map');
-		Effect.BlindUp('fillMeWithIntermap');
-	}
-	else
-	{
-		$('im_map').hide();
-		$('fillMeWithIntermap').hide();
-	}
-}
-
-function imc_init_loadSkel()
-{
-	var myAjax = new Ajax.Request (
-		'/intermap/srv/'+Env.lang+'/map.getMain.embedded', 
-		{
-			method: 'get',
-			parameters: '',
-			onSuccess: im_init_loadCompleted,
-			onFailure: im_load_error
-		}
-	);
-}
-//			onSuccess: ker.wrap(this, im_load_complete),
-
-
-function im_init_loadCompleted(req)
-{				
-	// Dinamically generate content
-	var im = $('fillMeWithIntermap');          
-    	im.innerHTML = req.responseText;
-	$('im_mm_wait').hide(); 
-	new Effect.Pulsate('openIMBtn');
-			
-	refreshNeeded(false, im_init_bmLoaded);
-}
-
-function im_init_bmLoaded()
-{		
-	Event.observe('im_map', 'mousedown', mousedownEventListener);
-	Event.observe('im_mm_map', 'mousedown', im_mm_mousedownEventListener);
-	Event.observe('im_resize', 'mousedown', im_bm_resizeStart);
-	
-	setTool('zoomin'); // set the default tool	
-	imc_reloadLayers(); // append layers to list
-
-           openIntermap();
-}
-
-
-function im_reset()
-{
-            setStatus('busy');
-            im_mm_setStatus('busy');
-            
-            imc_reset();
-}
-
-function imc_reset()
-{
-	var myAjax = new Ajax.Request (
-		'/intermap/srv/'+Env.lang+'/map.reset', //'/intermap/srv/'+Env.lang+'/map.getMain.embedded', 
-		{
-			method: 'get',
-			onSuccess: im_reset_complete,
-			onFailure: im_load_error
-		}
-	);
-}
-
-function im_reset_complete(req)
-{				
-	setTool('zoomin'); // set the default tool
-	im_mm_setTool('zoomin'); // set the default tool
-	
-	imc_reloadLayers(); // append layers to list
-
-           imc_updateBigMap(im_bm_width, im_bm_height, null, false, 
-               function() { imc_mm_update(im_mm_width, im_mm_height, null);});              
-}
-
-
-/********************************************************************
-*** UTILS
-********************************************************************/
-
-function i18n(key)
-{
-    var v = $('i18n_'+key);
-    if(v)
-    {
-        if(v.value=='')
-            return '{'+key+'}';
-        else 
-            return v.value;
-    }        
-    else
-        return '['+key+']';    
-}

Modified: trunk/web/intermap/scripts/im_ajax.js
===================================================================
--- trunk/web/intermap/scripts/im_ajax.js	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/intermap/scripts/im_ajax.js	2007-11-04 22:00:46 UTC (rev 955)
@@ -1,34 +1,24 @@
 /*****************************************************************************
  *
- *       This file contains most of the Intermap's AJAX calls.
+ *       This file contains some of the Intermap's AJAX calls.
  *
+ * Requires:
+ *   getIMServiceURL(service)
  *****************************************************************************/
 
 
-var activeLayerId = null; // active layer
+im_load_error = function() {alert("Loading error");};
 
-im_load_error = function() {alert("Loading error")};
 
-function imc_reloadLayers()
-{
-/*	var url = '/intermap/srv/'+Env.lang+'/map.layers.getOrder';*/
-	var url = '/intermap/srv/'+Env.lang+'/map.getLayers.embedded';	
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			onComplete: im_buildLayerList
-		}
-	);
-}
-
-
 /*****************************************************************************
  *                                                                           *
  *                                  Layers                                   *
  *                                                                           *
  *****************************************************************************/
 
+/*
+// Not used at the moment
+// TODO: Should we restore it adding a button in each layer's tab? 
 
 function imc_zoomToLayer(layerId)
 {
@@ -37,444 +27,50 @@
 	//$('im_geonetRecords').className = 'hidden';	
 	
 	setStatus('busy');
-	var url = '/intermap/srv/'+Env.lang+'/map.zoomToService';
 	var pars = 'id=' + layerId;
 	
 	var myAjax = new Ajax.Request (
-		url,
+		getIMServiceURL('map.zoomToService'),
 		{
 			method: 'get',
 			parameters: pars,
-			onComplete: function(req) { refreshNeeded(true) },
+			onComplete: function(req) { im_bm_refreshNeeded(true);}, // FIXME
 			onFailure: reportError
 		}
 	);
 }
 
-function toggleVisibility(id) {
-	var url = '/intermap/srv/'+Env.lang+'/map.layers.toggleVisibility';
-	var pars = 'id=' + id;
-	
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: function(request) { setLayerVisibility(request, id); },
-			onFailure: reportError
-		}
-	);
-}
+*/
 
-function showActiveLayerLegend(id) {
-    showLegend(activeLayerId);
-}
-
-function hideLegend()
+function im_setWMC(wmc, callback) 
 {
-    var div=$('im_legendPopup');
-    if(div)
-    {
-        Event.stopObserving(div, 'click', hideLegend);
-        document.body.removeChild(div);
-    }
-}
-
-function showLegend(url, btn) {
-//	window.open('/intermap/srv/'+Env.lang+'/map.service.getLegend?id=' + id, 'dialog', 'HEIGHT=300,WIDTH=400,scrollbars=yes,toolbar=yes,status=yes,menubar=yes,location=yes,resizable=yes');
-    hideLegend();
-
-    var div = document.createElement("div");
-    div.id="im_legendPopup";
-    div.style.position = "absolute";
-    document.body.appendChild(div);    
-
-    var offset = Position.cumulativeOffset($(btn));
-    var x = offset[0];
-    var y = offset[1];
-
-    div.style.left=x+"px";
-    div.style.top=y+"px";
-    div.style.width="100px";
-    div.style.height="50px";
-//    div.style.border="solid black 1px";
-//    div.style.background-color="064377";
-    
-    var img = document.createElement("img");
-//    img.src = "intermap/images/waiting.gif";
-    img.src = url;
-    img.alt = "Loading legend..."
-    img.style.position = "absolute";
-    img.style.border="solid black 1px";
-    div.appendChild(img);    
-
-    Event.observe(div, 'click', hideLegend);
-    
-
-    //window.open(url);
-	
-	
-}
-
-
-/*****************************************************************************
- *                                                                           *
- *                                Delete layer                               *
- *                                                                           *
- *****************************************************************************/
-
-
-/*****************************************************************************
- *                                                                           *
- *                                 Add layer                                 *
- *                                                                           *
- *****************************************************************************/
-
-
-/*****************************************************************************
- *                                                                           *
- *                            Layer transparency                             *
- *                                                                           *
- *****************************************************************************/
-
-function imc_setLayerTransparency(id, transparency)
-{
-	var url = '/intermap/srv/'+Env.lang+'/map.layers.setTransparency';
-	var pars = 'id=' + id + '&amp;transparency=' + transparency / 100.0;
-	
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: refreshNeeded,
-			onFailure: reportError
-		}
-	);
-}
-
-
-/*****************************************************************************
- *                                                                           *
- *                    Map operations (zoom, pan, identify)                   *
- *                                                                           *
- *****************************************************************************/
-
-// Starts ajax transaction to perform a map action (zoomin, zoomout)
-function imc_bm_action(tool, xmin, ymin, xmax, ymax, w, h)
-{
-	var url = '/intermap/srv/'+Env.lang+'/map.action';
-	var pars = 'maptool=' + tool + 
-	                '&amp;mapimgx=' + xmin + '&amp;mapimgy=' + ymin + 
-	                '&amp;mapimgx2=' + xmax + '&amp;mapimgy2=' + ymax + 
-	                "&amp;width=" + w + "&amp;height="+h +
-	                "&amp;"+im_bm_getURLbbox(); // FIXME: we should pass bb as param 
-	
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: function(req) 
-			{
-				updateMapImage(req);			
-			    	im_mm_followBM();  
-			},
-			onFailure: reportError
-		}
-	);
-}
-
-function imc_mm_action(tool, xmin, ymin, xmax, ymax, w, h)
-{
-	var url = '/intermap/srv/'+Env.lang+'/map.action';
-	var pars = 'maptool=' + tool + 
-	                '&amp;mapimgx=' + xmin + '&amp;mapimgy=' + ymin + 
-	                '&amp;mapimgx2=' + xmax + '&amp;mapimgy2=' + ymax + 
-	                "&amp;width=" + w + "&amp;height="+h +
-	                "&amp;"+im_mm_getURLbbox(); // FIXME: we should pass bb as param 
-	
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: im_mm_imageRebuilt,
-			onFailure: reportError
-		}
-	);
-}
-
-function imc_bm_move(deltax, deltay, width, height, qbbox)
-{
-	var url = '/intermap/srv/'+Env.lang+'/map.move';
-	var pars = 'deltax=' + deltax + '&amp;deltay=' + deltay +
-	                "&amp;width=" + width + "&amp;height=" + height +
-	                "&amp;" + qbbox;
-	
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: updateMapImage,
-			onFailure: reportError
-		}
-	);
-}
-
-function imc_mm_move(deltax, deltay, width, height)
-{
-	var url = '/intermap/srv/'+Env.lang+'/map.move';  
-	var pars = 'deltax=' + deltax + '&amp;deltay=' + deltay + 
-	                "&amp;width=" + width + "&amp;height=" + height +
-	                "&amp;" + im_mm_getURLbbox();	 // FIXME: we need it as func param                
-	
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: im_mm_imageRebuilt,
-			onFailure: reportError
-		}
-	);
-}
-
-function imc_bm_setScale(w, h, bbox, scale )
-{
-	var url = '/intermap/srv/'+Env.lang+'/map.setScale';
-	var pars = "width=" + w + "&amp;height="+h +
-	                "&amp;"+bbox+
-	                "&amp;scale=" + scale;
-
-	setStatus('busy');
-
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: updateMapImage,
-			onFailure: reportError
-		}
-	);
-}
-
-/*****************************************************************************
- *                                                                           *
- *                              Area of interest                             *
- *                                                                           *
- *****************************************************************************/
-
-function setAoi(xmin, ymin, xmax, ymax)
-{
-	var url = '/intermap/srv/'+Env.lang+'/map.setAoi';
-	var pars = 'minx=' + xmin + '&amp;miny=' + ymin + '&amp;maxx=' + xmax + '&amp;maxy=' + ymax;
-	//alert(pars); // DEBUG
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			//onComplete: showResponse,
-			onFailure: reportError
-		}
-	);
-}
-
-function unsetAoi()
-{
-	var url = '/intermap/srv/'+Env.lang+'/map.unsetAoi';
-	
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			//onComplete: showResponse,
-			onFailure: reportError
-		}
-	);
-}
-
-
-/*****************************************************************************
- *                                                                           *
- *                                Map refresh                                *
- *                                                                           *
- *****************************************************************************/
-
-
-function imc_updateBigMap(width, height, qbbox, doUpdateMM, callback)
-{
-    if(doUpdateMM == null)
-        followmm = true;
-    
-    var pars = "width=" + width + "&amp;height=" + height;
-    if(qbbox)
-        pars +=  "&amp;" + qbbox;
-    
-    setStatus('busy');
-
+    var pars = 'wmc=' + wmc;               //encodeURIComponent(surl) 
+    		
     var myAjax = new Ajax.Request (
-    	'/intermap/srv/'+Env.lang+'/map.update', 
+    	getIMServiceURL('wmc.setContext'),
     	{
     		method: 'get',
     		parameters: pars,
-    		onComplete: function(req) 
-    		{ 
-                            updateMapImage(req);
-                            if( doUpdateMM )
-                                // !!! check if this refresh is not due to a minimap action, or we'll get a refresh loop !!!
-                                im_mm_followBM();
-                            if(callback)
-                                callback();
-    		 },
+    
+    		onComplete: callback,
     		onFailure: reportError
     	}
-    );
+    );    
 }
 
-function im_mm_followBM()
-{
-	imc_mm_update(im_mm_width, im_mm_height, im_dezoom(im_bm_north, im_bm_east, im_bm_south, im_bm_west));
-}
 
-function imc_mm_update(width, height, qbbox, callback)
-{
-	im_mm_setStatus('busy');
-	
-	var url = '/intermap/srv/'+Env.lang+'/map.update';
-
-	var pars = "width=" + width + "&amp;height=" + height;
-	if(qbbox)
-	    pars += "&amp;" + qbbox
-
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: function(req)
-			{
-				im_mm_imageRebuilt(req);
-				if(callback) callback();
-			},
-			onFailure: reportError
-		}
-	);
-}
-
-/*
-function imc_mm_action_mm()
-{
-	im_mm_setStatus('busy');
-	var url = '/intermap/srv/'+Env.lang+'/map.update';
-	
-	var im_mm_bb=im_dezoomDegrees(im_mm_ctrl_n.value,im_mm_ctrl_e.value,im_mm_ctrl_s.value,im_mm_ctrl_w.value);
-
-	var pars = 'maptool=' + 'zoomin' + 
-	                "&amp;width=" + '200' + "&amp;height="+'100' +
-	                "&amp;"+im_mm_bb; // FIXME: we should pass bb as param 
-	
-	var myAjax = new Ajax.Request (
-		url, 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: im_mm_imageRebuilt,
-			onFailure: reportError
-		}
-	);
-}
-*/
-
 /*****************************************************************************
  *                                                                           *
- *                                Full extent                                *
- *                                                                           *
  *****************************************************************************/
 
-function imc_bm_fullExtent(w,h)
-{
-	setStatus('busy');
-	
-//	deleteAoi();
-	
-	if (currentTool == 'zoomout' || currentTool == 'pan') 
-	    setTool('zoomin');
-
-           var pars = "width=" + w + "&amp;height="+h;
-
-	var myAjax = new Ajax.Request (
-		'/intermap/srv/'+Env.lang+'/map.fullExtent', 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: updateMapImage,
-			onFailure: reportError
-		}
-	);
-}
-
-function imc_mm_fullExtent(w,h)
-{
-	im_mm_setStatus('busy');
-	
-//	im_mm_deleteAoi();
-	
-	if (im_mm_currentTool == 'zoomout' || im_mm_currentTool == 'pan') 
-	    im_mm_setTool('zoomin');
-	
-	var pars = "width=" + w + "&amp;height="+h;
-		
-	var myAjax = new Ajax.Request (
-		'/intermap/srv/'+Env.lang+'/map.fullExtent', 
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: im_mm_imageRebuilt,
-			onFailure: reportError
-		}
-	);
-}
-
-
-
-/*****************************************************************************
- *                                                                           *
- *****************************************************************************/
-
-/* ETj:unused?
-function addLayer(baseUrl, serviceName) // DEBUG
-{
-	setStatus('busy');
-	
-	var url = 'map.layers.add';
-	var pars = 'url=' + baseUrl + '&amp;service=' + serviceName;
-	var myAjax = new Ajax.Request (
-		url,
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: layerAdded,
-			onFailure: reportError
-		}
-	);
-}
-*/
-
-
 function imc_addService(surl, service, type, callback)
 {
-	var url = '/intermap/srv/'+Env.lang+'/map.addServices.embedded';
-	
 	var pars = 'url=' + encodeURIComponent(surl) 
 			+ '&amp;service=' + encodeURIComponent(service) 
 			+ '&amp;type=' + type;
 			
 	var myAjax = new Ajax.Request (
-		url,
+		getIMServiceURL('map.addServices.embedded'),
 		{
 			method: 'get',
 			parameters: pars,
@@ -488,7 +84,6 @@
 
 function imc_addServices(surl, serviceArray, type, callback)
 {
-	var url = '/intermap/srv/'+Env.lang+'/map.addServices.embedded';	
 	var pars = 'url=' + encodeURIComponent(surl) + '&amp;type=' + type;
 	
 	serviceArray.each(
@@ -499,7 +94,7 @@
 	);
 	
 	var myAjax = new Ajax.Request (
-		url,
+		getIMServiceURL('map.addServices.embedded'),
 		{
 			method: 'post',
 			parameters: pars,
@@ -513,9 +108,9 @@
 function imc_loadServices( id, callback )
 {
 	var myAjax = new Ajax.Request (
-		'/intermap/srv/'+Env.lang+'/mapServers.getServices.xml',
+		getIMServiceURL('mapServers.getServices.xml'),
 		{
-		           parameters: "mapserver="+id,
+			parameters: "mapserver="+id,
 			method: 'get',
 
 			onComplete: callback,

Modified: trunk/web/intermap/scripts/im_bigmap.js
===================================================================
--- trunk/web/intermap/scripts/im_bigmap.js	2007-11-02 21:28:48 UTC (rev 954)
+++ trunk/web/intermap/scripts/im_bigmap.js	2007-11-04 22:00:46 UTC (rev 955)
@@ -1,150 +1,104 @@
-/*****************************************************************************
- *
- *                 Functions related to the big IM map
- *
- *****************************************************************************/
+//===================================================================
+//
+//                 Functions related to the big IM map
+//
+//===================================================================
 
-var autoRefresh = true;
-
-
-// Opens the print window
-function print() {
-	window.open('{/root/gui/locService}/map.getPrintImage','print', width='620', height='620');
-}
-
-/*****************************************************************************
- *
- *                      Main vars and setup
- *
- *****************************************************************************/
+//===================================================================
+//                      Main vars and setup
+//===================================================================
  
- // these are the values of initial width and height.
+ // these are the values of initial width and height. 
+var im_bm_wsize0 = 368;
+var im_bm_hsize0 = 276;
+																					
+var im_bm = new Intermap(im_bm_wsize0, im_bm_hsize0, 'im_bm_image');
+	
+im_bm.setBBox(90, 180, -90, -180);
  
- var im_bm_wsize0 = 368;
- var im_bm_hsize0 = 276;
- 
-// Current image size
-var im_bm_width = im_bm_wsize0; 
-var im_bm_height = im_bm_hsize0; 
-
-// Current bounding box
-var im_bm_north, im_bm_east, im_bm_south, im_bm_west;
-
-// Parse a response and set bm props accordingly
-function im_bm_set(bmResponse)
+im_bm.setSize = function (w, h) // override
 {
-    // Image URL
-    var url = bmResponse.getElementsByTagName('imgUrl')[0].firstChild.nodeValue;
-    $('im_mapImg').src = url;
-    
-    im_bm_setBBox_dom(bmResponse)
-    im_bm_setSize_dom(bmResponse);
-}
+    this.width  = parseInt(w);
+    this.height = parseInt(h);
 
-// Set bounding box
-function im_bm_setBBox_dom(bmResponse)
-{
-    var extent= bmResponse.getElementsByTagName('extent')[0];
-    var minx  = extent.getAttribute('minx');
-    var maxx = extent.getAttribute('maxx');
-    var miny  = extent.getAttribute('miny');
-    var maxy = extent.getAttribute('maxy');
-    
-    im_bm_setBBox(maxy, maxx, miny, minx);
-}
-function im_bm_setBBox(n, e, s, w)
-{
-    im_bm_north   = parseFloat(n);
-    im_bm_east     = parseFloat(e);
-    im_bm_south   = parseFloat(s);
-    im_bm_west    = parseFloat(w);    
-}
-
-// Set width, height
-function im_bm_setSize_dom(node)
-{
-    // Image size
-    var w = node.getElementsByTagName('width')[0].firstChild.nodeValue;
-    var h = node.getElementsByTagName('height')[0].firstChild.nodeValue;
-    
-    im_bm_setSize(w, h);
-}
-function im_bm_setSize(w, h)
-{
-    im_bm_width  = parseInt(w);
-    im_bm_height = parseInt(h);
-
-    if($('im_mapImg'))
+    if($('im_bm_image'))
     {
-        // lines from resizeMap()
-        $('im_mapImg').style.width = w;
-        $('im_mapImg').style.height = h;
+        $('im_bm_image').style.width = w;
+        $('im_bm_image').style.height = h; 
         //$('im_map').style.width = w;
         //$('im_map').style.height = h;
-        // end
         
-        $('im_mapContainer').style.width = im_bm_width + 2; 
-        $('im_mapContainer').style.height = im_bm_height + 2; 
+        $('im_mapContainer').style.width = im_bm.width + 2; 
+        $('im_mapContainer').style.height = im_bm.height + 2; 
         
         $('im_map').style.width = w; 
         $('im_map').style.height = h;
         
-        $('im_pleaseWait').style.width = w;
+        $('im_bm_image_waitdiv').style.width = w;
     }
+};
+
+//===================================================================
+//
+//  Wrappers for GUI buttons
+//
+//===================================================================
+
+/** Called by GUI button */
+function setTool(tool) 
+{
+	im_bm.setTool(tool);
 }
 
-function im_bm_getURLbbox()
+/** Called by GUI button */
+function im_bm_fullExtent()
 {
-    return   "northBL="+im_bm_north+
-                "&amp;eastBL="+im_bm_east+
-                "&amp;southBL="+im_bm_south+
-                "&amp;westBL="+im_bm_west;    
+    im_bm.fullExtent();
 }
 
+/** Called by GUI button */
+function im_bm_refresh()
+{
+    im_bm.rebuild();
+}
 
-/*****************************************************************************
- *
- *                      Map operations (zoom, pan, identify)
- *
- *****************************************************************************/
+//===================================================================
+//
+//                      Map operations (zoom, pan, identify)
+//
+//===================================================================
 
 var startX, startY; // start (mousedown) coordinates
 
 var startOffsetX;
 var startOffsetY;
 
-var currentTool;
 
-function setTool(tool) {
-	deleteAoi();
-	currentTool = tool;
-	$('intermap_root').className = tool; //document.body.className = tool;
-/*	if (tool != 'aoi') 
-	    $('im_geonetRecords').className = 'im_hidden';*/
-}
+im_bm.afterToolSet = function(tool)
+{
+    $('intermap_root').className = tool; 
+};
 
+im_bm.beforeMouseDown = function(e)
+{
+    if($('im_marker_tmp'))
+        $('im_marker_tmp').remove();
+    if($('im_markerbox_tmp'))
+        $('im_markerbox_tmp').remove();
+};
 
-function mousedownEventListener(e)
+im_bm.unresolvedMouseDown = function(e)
 {
-	switch(currentTool)
+	switch(this.tool)
 	{
-		case 'zoomin':
-			startZoombox(e);
-			break;
-		case 'zoomout':
-			startZoombox(e);
-			break;
-		case 'pan':
-			startDrag(e);
-			break;
-		case 'aoi':
-			startAoi(e);
-			break;
 		case 'identify':
 			identify(e);
 			break;
+		case 'mark':
+			im_setMark(e);
+			break;
 	}
-}
+};
 
 // IDENTIFY - TODO: move some part intermap.js
 function identify(e)
@@ -152,7 +106,7 @@
 	Event.stop(e); // prevents from dragging the map image (on Firefox)
 	
 	// get map image offset
-	var offset = Position.cumulativeOffset($('im_mapImg'));
+	var offset = Position.cumulativeOffset($(im_bm.imageId));
 	var offsetX = offset[0];
 	var offsetY = offset[1];
 	
@@ -160,696 +114,78 @@
 	pointerX = Event.pointerX(e);
 	pointerY = Event.pointerY(e);
 	
-	var url = '/intermap/srv/'+Env.lang+'/map.identify';
+	var url = getIMServiceURL('map.identify');
 	var t1 = pointerX - offsetX;
 	var t2 = pointerY - offsetY;
-	var pars = 'mapimgx=' + t1 + '&amp;mapimgy=' + t2 + '&amp;activeLayer=' + activeLayerId + "&amp;format=" + "text%2Fhtml";
+	var pars = 'mapimgx=' + t1 + '&amp;mapimgy=' + t2 +
+				"&amp;width=" + im_bm.width + "&amp;height=" + im_bm.height +
+				"&amp;"+ im_bm.getURLbbox() +
+				'&amp;activeLayer=' + activeLayerId + "&amp;format=text%2Fhtml";
 	
-	window.open(url + '?' + pars, "Query result", "width=600,height=400,scrollbars=yes,toolbar=no,status=yes,menubar=no,location=yes,resizable=yes");
+	window.open(url + "?" + pars, 
+				"Queryresult", 
+				"width=600,height=400,scrollbars=yes,toolbar=no,status=yes,menubar=no,location=yes,resizable=yes");
 }
 
-//==================================================
-// ZOOM
-//==================================================
-
-var zoombox; // zoombox div
-
-function startZoombox(e)
+function im_setMark(e)
 {
 	Event.stop(e); // prevents from dragging the map image (on Firefox)
 	
-	// add mousemove and mouseup listeners
-	Event.observe(document, 'mousemove', resizeZoombox);
-	Event.observe(document, 'mouseup', stopZoombox);
-	
-	// store starting cursor position
-	startX = Event.pointerX(e);
-	startY = Event.pointerY(e);
-	
-	// dynamically create the zoombox div
-	zoombox = document.createElement('div')
-	zoombox.setAttribute('id', 'im_zoombox');
-	im_drawBox(zoombox, startX, startY, 0, 0);
-	document.body.appendChild(zoombox);
-}
-
-// mousemove event listener
-function resizeZoombox(e)
-{
-	Event.stop(e); // prevents from dragging the map image (on Explorer)
-	
-	// get the current cursor position
-	var pX = Event.pointerX(e);
-	var pY = Event.pointerY(e);
-	
 	// get map image offset
-	var offset = Position.cumulativeOffset($('im_mapImg'));
+	var offset = Position.cumulativeOffset($(im_bm.imageId));
 	var offsetX = offset[0];
 	var offsetY = offset[1];
-
-            var w = $('im_mapImg').clientWidth;
-            var h = $('im_mapImg').clientHeight;
-
-            // Prevents zoombox exiting from map area
-            pX = Math.max(pX, offsetX+2);
-            pY = Math.max(pY, offsetY+2);
-            
-            pX = Math.min(pX, offsetX + w );
-            pY = Math.min(pY, offsetY + h );
-
-	// set the zoom box position and size
-	im_drawBox ( $('im_zoombox'),
-		Math.min(pX, startX),  // left
-		Math.min(pY, startY),  // top
-		Math.abs(pX - startX), // width
-		Math.abs(pY - startY)  // height
-	);
-}
-
-// mouseup event listener
-function stopZoombox(e)
-{
-	// get the current cursor position
-	var pX = Event.pointerX(e);
-	var pY = Event.pointerY(e);
 	
-	// get map image offset
-	var offset = Position.cumulativeOffset($('im_mapImg'));
-	var offsetX = offset[0];
-	var offsetY = offset[1];
-
-            var w = $('im_mapImg').clientWidth;
-            var h = $('im_mapImg').clientHeight;
-
-	setStatus('busy');
-	
-	imc_bm_action(currentTool,
-		Math.min(pX, startX) - offsetX, // xmin
-		Math.max(pY, startY) - offsetY, // ymax
-		Math.max(pX, startX) - offsetX, // xmax
-		Math.min(pY, startY) - offsetY,  // ymin
-		w,h
-	);
-	
-	// remove listeners and div
-	Event.stopObserving(document, 'mousemove', resizeZoombox);
-	Event.stopObserving(document, 'mouseup', stopZoombox);
-	Element.remove($('im_zoombox'));
-}
-
-/*// Draws the zoombox
-function drawZoombox(left, top, width, height)
-{
-	zoombox.style.left = left + 'px';
-	zoombox.style.top = top + 'px';
-	zoombox.style.width = width + 'px';
-	zoombox.style.height = height + 'px';
-}
-*/
-//==================================================
-// MOVE
-//==================================================
-
-function startDrag(e)
-{
-	Event.stop(e); // prevents from dragging the map image (on Firefox)
-	
-	// get map initial image offset
-	var offset = Position.cumulativeOffset($('im_mapImg'));
-	startOffsetX = offset[0];
-	startOffsetY = offset[1];
-	
-	// add mousemove and mouseup listeners
-	Event.observe(document, 'mousemove', dragImage);
-	Event.observe(document, 'mouseup', stopDrag);
-	
 	// store starting cursor position
-	startX = Event.pointerX(e);
-	startY = Event.pointerY(e);
-}
-
-function dragImage(e)
-{
-	window.status = Event.pointerX(e) + ' - ' + Event.pointerY(e); // DEBUG
+	pointerX = Event.pointerX(e);
+	pointerY = Event.pointerY(e);
 	
-	Event.stop(e); // prevents from dragging the map image (on Explorer)
+	var x = pointerX - offsetX;
+	var y = pointerY - offsetY;
 	
-	var vMapImg = $('im_mapImg');
+	var lat  = im_bm.y2lat(y);
+	var lon = im_bm.x2lon(x);
 	
-	// get map image offset
-	var offset = Position.cumulativeOffset(vMapImg);
-	var offsetX = offset[0];
-	var offsetY = offset[1];
+	var img = document.createElement("img");
+	img.id='im_marker_tmp';
+	img.className = 'im_marker';
+	img.src = '/intermap/images/marker.png'; // FIXME context
+	img.style.left = pointerX;
+	img.style.top = pointerY;
+/*           img.style.position = "absolute";
+           img.style.z-index = "10";
+*/           document.body.appendChild(img);    
 	
-	vMapImg.style.position = 'absolute';
-	var t = Event.pointerX(e) - startX;
-	vMapImg.style.left = t + 'px';
-	t = Event.pointerY(e) - startY;
-	vMapImg.style.top = t + 'px';
-}
-
-function stopDrag(e)
-{
-	// get map image offset
-	var offset = Position.cumulativeOffset($('im_mapImg'));
-	var offsetX = offset[0];
-	var offsetY = offset[1];
 	
-	// get the current cursor position
-	setStatus('busy');
-	
-	imc_bm_move(startOffsetX - offsetX, offsetY - startOffsetY, 
-	                        im_bm_width, im_bm_height, im_bm_getURLbbox() );
-	
-	Event.stopObserving(document, 'mousemove', dragImage);
-	Event.stopObserving(document, 'mouseup', stopDrag);
-}
+            var div = document.createElement("div");
+            div.id="im_markerbox_tmp";
+            div.className = "im_markerbox";
+/*            div.style.position = "absolute";
+            div.style.z-index = "10";*/
+            document.body.appendChild(div);    
 
-//==================================================
-// AOI (Area Of Interest)
-//==================================================
-
-var aoi = null;
-var ghostImg = null;
-var dotUL, dotUR, dotBR, dotBL, dotUM, dotBM, dotMR, dotML;
-var divUL, divUR, divBR, divBL, divUM, divBM, divMR, divML;
-var aoiLeft, aoiRight, aoiTop, aoiBottom;
-var dragUL, dragUR, dragBL, dragBR, dragUM, dragBM, dragML, dragMR;
-
-var mapImgOffsetX;
-var mapImgOffsetY;
-
-// TODO: fa schifo
-function startAoi(e)
-{
-	// TODO: all this staff is useless here - too much javascript - move HTML to XSL
-	Event.stop(e); // prevents from dragging the map image (on Firefox)
-	
-	// get map image offset
-	var offset = Position.cumulativeOffset($('im_mapImg'));
-	mapImgOffsetX = offset[0];
-	mapImgOffsetY = offset[1];
-	
-	// add mousemove and mouseup listeners
-	Event.observe(document, 'mousemove', resizeAoi);
-	Event.observe(document, 'mouseup', stopAoi);
-	
-	// store starting cursor position
-	startX = Event.pointerX(e);
-	startY = Event.pointerY(e);
-	
-	vMap = $('im_map');
-	
-	// dynamically create the aoi div
-	aoi = document.createElement('div')
-	aoi.setAttribute('id', 'im_aoi');
-	vMap.appendChild(aoi);
-	new Draggable('im_aoi', {change:dragAoi,starteffect:null,endeffect:null,zindex:21000}); // set aoi div draggable
-	
-	// draw hide  mask (gray overlay over map image)
-	var hideMask = document.createElement('div');
-	hideMask.setAttribute('id', 'im_hideMask');
-	vMap.appendChild(hideMask);
-	Position.clone(vMap, hideMask);
-	
-	// create ghost image
-	ghostImg = document.createElement('img');
-	ghostImg.setAttribute('id', 'im_ghostImg');
-	aoi.appendChild(ghostImg);
-	ghostImg.setAttribute('src', $('im_mapImg').src);
-	
-	
-	// when user clicks outside the aoi a new aoi is drawn
-	Event.observe($('im_hideMask'), 'mousedown', restartAoi);
-	
-	// add resoze handles images
-	dotUL = document.createElement('img');
-	dotUR = document.createElement('img');
-	dotBL = document.createElement('img');
-	dotBR = document.createElement('img');
-	dotUM = document.createElement('img');
-	dotBM = document.createElement('img');
-	dotML = document.createElement('img');
-	dotMR = document.createElement('img');
-	
-	dotUL.setAttribute('src', '/intermap/images/dot.gif');
-	dotUR.setAttribute('src', '/intermap/images/dot.gif');
-	dotBL.setAttribute('src', '/intermap/images/dot.gif');
-	dotBR.setAttribute('src', '/intermap/images/dot.gif');
-	dotUM.setAttribute('src', '/intermap/images/dot.gif');
-	dotBM.setAttribute('src', '/intermap/images/dot.gif');
-	dotML.setAttribute('src', '/intermap/images/dot.gif');
-	dotMR.setAttribute('src', '/intermap/images/dot.gif');
-	
-	dotUL.className = 'im_resizeDot';
-	dotUR.className = 'im_resizeDot';
-	dotBL.className = 'im_resizeDot';
-	dotBR.className = 'im_resizeDot';
-	dotUM.className = 'im_resizeDot';
-	dotBM.className = 'im_resizeDot';
-	dotML.className = 'im_resizeDot';
-	dotMR.className = 'im_resizeDot';
-		
-	vMap.appendChild(dotUL);
-	vMap.appendChild(dotUR);
-	vMap.appendChild(dotBL);
-	vMap.appendChild(dotBR);
-	vMap.appendChild(dotUM);
-	vMap.appendChild(dotBM);
-	vMap.appendChild(dotML);
-	vMap.appendChild(dotMR);
-	
-	// add resize handles transparent divs
-	divUL = document.createElement('div');
-	divUR = document.createElement('div');
-	divBL = document.createElement('div');
-	divBR = document.createElement('div');
-	divUM = document.createElement('div');
-	divBM = document.createElement('div');
-	divML = document.createElement('div');
-	divMR = document.createElement('div');
-	
-	divUL.className = 'im_transparentDrag';
-	divUR.className = 'im_transparentDrag';
-	divBL.className = 'im_transparentDrag';
-	divBR.className = 'im_transparentDrag';
-	divUM.className = 'im_transparentDrag';
-	divBM.className = 'im_transparentDrag';
-	divML.className = 'im_transparentDrag';
-	divMR.className = 'im_transparentDrag';
-	
-	divUL.style.cursor = "nw-resize";
-	divUR.style.cursor = "ne-resize";
-	divBL.style.cursor = "sw-resize";
-	divBR.style.cursor = "se-resize";
-	divUM.style.cursor = "n-resize";
-	divBM.style.cursor = "s-resize";
-	divML.style.cursor = "w-resize";
-	divMR.style.cursor = "e-resize";
-	
-	vMap.appendChild(divUL);
-	vMap.appendChild(divUR);
-	vMap.appendChild(divBL);
-	vMap.appendChild(divBR);
-	vMap.appendChild(divUM);
-	vMap.appendChild(divBM);
-	vMap.appendChild(divML);
-	vMap.appendChild(divMR);
-	
-	dragUL = new Draggable(divUL, {change:dragULListener,starteffect:null,endeffect:null,zindex:32000});
-	dragUR = new Draggable(divUR, {change:dragURListener,starteffect:null,endeffect:null,zindex:32000});
-	dragBL = new Draggable(divBL, {change:dragBLListener,starteffect:null,endeffect:null,zindex:32000});
-	dragBR = new Draggable(divBR, {change:dragBRListener,starteffect:null,endeffect:null,zindex:32000});
-	dragUM = new Draggable(divUM, {change:dragUMListener,starteffect:null,endeffect:null,zindex:32000,constraint:'vertical'});
-	dragBM = new Draggable(divBM, {change:dragBMListener,starteffect:null,endeffect:null,zindex:32000,constraint:'vertical'});
-	dragML = new Draggable(divML, {change:dragMLListener,starteffect:null,endeffect:null,zindex:32000,constraint:'horizontal'});
-	dragMR = new Draggable(divMR, {change:dragMRListener,starteffect:null,endeffect:null,zindex:32000,constraint:'horizontal'});
-	
-	Draggables.addObserver(new divDragEndObserver(divUL));
-	Draggables.addObserver(new divDragEndObserver(divUR));
-	Draggables.addObserver(new divDragEndObserver(divBL));
-	Draggables.addObserver(new divDragEndObserver(divBR));
-	Draggables.addObserver(new divDragEndObserver(divUM));
-	Draggables.addObserver(new divDragEndObserver(divBM));
-	Draggables.addObserver(new divDragEndObserver(divML));
-	Draggables.addObserver(new divDragEndObserver(divMR));
-	
-	Draggables.addObserver(new divDragEndObserver(aoi));
-	
-	Event.observe('im_aoi', 'dblclick', zoomToAoi);
-}
-
-function zoomToAoi() {
-	var aoiOffset = Position.cumulativeOffset($('im_aoi'));
-	var left = aoiOffset[0];
-	var top = aoiOffset[1];
-	
-	var d = Element.getDimensions($('aoi'));
-	var width = d.width;
-	var height = d.height;
-	
-	// get map image offset
-	var mapImgOffset = Position.cumulativeOffset($('im_mapImg'));
-	var offsetX = mapImgOffset[0];
-	var offsetY = mapImgOffset[1];
-
-            var iw = $('im_mapImg').clientWidth;
-            var ih = $('im_mapImg').clientHeight;
-
-	deleteAoi();
-	unsetAoi();
-		
-	setStatus('busy');
-	
-	imc_bm_action('zoomin',
-		left - offsetX,
-		top - offsetY + height,
-		left - offsetX + width,
-		top - offsetY,
-		iw, ih
-	);
-	
-}
-
-var divDragEndObserver = Class.create();
-divDragEndObserver.prototype = {
-	initialize: function(element) {
-		this.element = $(element);
-	},
-	
-	onEnd: function(eventName, draggable, event) {
-		if (Draggables.activeDraggable.element == this.element)
-			handleMouseupListener();
-	}
-}
-
-function handleMouseupListener()
-{
-	var aoiOffset = Position.cumulativeOffset(aoi);
-	var left = aoiOffset[0];
-	var top = aoiOffset[1];
-	
-	var d = Element.getDimensions(aoi);
-	var width = d.width;
-	var height = d.height;
-	
-	// get map image offset
-	var mapImgOffset = Position.cumulativeOffset($('im_mapImg'));
-	var offsetX = mapImgOffset[0];
-	var offsetY = mapImgOffset[1];
-	
-	setAoi(
-		left - offsetX,
-		top - offsetY + height,
-		left - offsetX + width,
-		top - offsetY
-	);
-	
-	repositionHandleDivs(left, top, width, height);
-/*
-	getGeonetData(
-		left - offsetX,
-		top - offsetY + height,
-		left - offsetX + width,
-		top - offsetY,
-		1,
-		10
-	); // DEBUG
+/*    var offset = Position.cumulativeOffset($(btn));
+    var x = offset[0];
+    var y = offset[1];
 */
+    div.style.left=(pointerX-100)+"px";
+    div.style.top=(pointerY+20)+"px";
+    div.style.width="200px";
+    div.style.height="50px";
+    
+/*    var img = document.createElement("img");
+//    img.src = "intermap/images/waiting.gif";
+    img.src = url;
+    img.alt = "Loading legend..."
+    img.style.position = "absolute";
+    img.style.border="solid black 1px";
+    div.appendChild(img);    
+*/
+/*    Event.observe(div, 'click', hideLegend);*/
+    
 }
 
-// deletes the aoi
-// TODO: Remove event handlers too???
-function deleteAoi()
-{
-	if (aoi == null) return;
-	
-	Element.remove(aoi);
-	Element.remove($('im_hideMask'));
-	
-	Element.remove(dotUL);
-	Element.remove(dotUR);
-	Element.remove(dotBR);
-	Element.remove(dotBL);
-	Element.remove(dotUM);
-	Element.remove(dotBM);
-	Element.remove(dotMR);
-	Element.remove(dotML);
-	
-	Element.remove(divUL);
-	Element.remove(divUR);
-	Element.remove(divBR);
-	Element.remove(divBL);
-	Element.remove(divUM);
-	Element.remove(divBM);
-	Element.remove(divMR);
-	Element.remove(divML);
-	
-	aoi = null;
-	ghostImg = null;
-}
 
-// called when the user clicks in the grayed area
-function restartAoi(e)
-{
-	deleteAoi();
-	startAoi(e);
-}
-
-// TODO: Clean and optimize!!!
-function dragULListener(e)
-{
-	var divBROffset = Position.cumulativeOffset(divBR);
-	var divULOffset = Position.cumulativeOffset(divUL);
-	
-	var width = divBROffset[0] - divULOffset[0];
-	var height = divBROffset[1] - divULOffset[1];
-	
-	width = (width &gt; 5 ? width : 5);
-	height = (height &gt; 5 ? height : 5);
-	
-	var top = divULOffset[1] + 3;
-	if (top &gt; divBROffset[1] - 2) top = divBROffset[1] - 2;
-	var left = divULOffset[0] + 3;
-	if (left &gt; divBROffset[0] - 2) left = divBROffset[0] - 2;
-	
-	drawAoi(left, top, width, height);
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-}
-
-function dragBRListener(e)
-{
-	var divBROffset = Position.cumulativeOffset(divBR);
-	var divULOffset = Position.cumulativeOffset(divUL);
-	
-	var width = divBROffset[0] - divULOffset[0];
-	var height = divBROffset[1] - divULOffset[1];
-	
-	width = (width &gt; 5 ? width : 5);
-	height = (height &gt; 5 ? height : 5);
-	
-	drawAoi(divULOffset[0] + 3, divULOffset[1] + 3, width, height);
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-}
-
-function dragURListener()
-{
-	var divUROffset = Position.cumulativeOffset(divUR);
-	var divBLOffset = Position.cumulativeOffset(divBL);
-	
-	var width = divUROffset[0] - divBLOffset[0];
-	var height = divBLOffset[1] - divUROffset[1];
-	
-	width = (width &gt; 5 ? width : 5);
-	height = (height &gt; 5 ? height : 5);
-	
-	var top = divUROffset[1] + 3;
-	if (top &gt; divBLOffset[1] - 2) top = divBLOffset[1] - 2;
-	var left = divBLOffset[0] + 3;
-	
-	drawAoi(left, top, width, height);
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-}
-
-function dragBLListener()
-{
-	var divUROffset = Position.cumulativeOffset(divUR);
-	var divBLOffset = Position.cumulativeOffset(divBL);
-	
-	var width = divUROffset[0] - divBLOffset[0];
-	var height = divBLOffset[1] - divUROffset[1];
-	
-	width = (width &gt; 5 ? width : 5);
-	height = (height &gt; 5 ? height : 5);
-		
-	var top = divUROffset[1] + 3;
-//	if (top &gt; divBLOffset[1] - 2) top = divBLOffset[1] - 2;
-	var left = divBLOffset[0] + 3;
-	if (left &gt; divUROffset[0] - 2) left = divUROffset[0] - 2;
-	
-	drawAoi(left, top, width, height);
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-}
-
-function dragUMListener()
-{
-	var d = Element.getDimensions(aoi);
-	
-	var height = Position.cumulativeOffset(divBM)[1] - Position.cumulativeOffset(divUM)[1];
-	height = (height &gt; 5 ? height : 5);
-	
-	var top = Position.cumulativeOffset(divUM)[1] + 3;
-	if (top &gt; Position.cumulativeOffset(divBM)[1] - 2) top = Position.cumulativeOffset(divBM)[1] - 2;
-	
-	drawAoi(Position.cumulativeOffset(divUL)[0] + 3, top , d.width, height);
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-}
-
-function dragBMListener()
-{
-	var d = Element.getDimensions(aoi);
-	
-	var height = Position.cumulativeOffset(divBM)[1] - Position.cumulativeOffset(divUM)[1];
-	height = (height &gt; 5 ? height : 5);
-	
-	drawAoi(Position.cumulativeOffset(divUL)[0] + 3, Position.cumulativeOffset(divUM)[1] + 3, d.width, height);
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-}
-
-function dragMLListener()
-{
-	var d = Element.getDimensions(aoi);
-	
-	var width =  Position.cumulativeOffset(divMR)[0] - Position.cumulativeOffset(divML)[0];
-	width = (width &gt; 5 ? width : 5);
-	
-	var left = Position.cumulativeOffset(divML)[0] + 3;
-	if (left &gt; Position.cumulativeOffset(divMR)[0] - 2) left = Position.cumulativeOffset(divMR)[0] - 2;
-	
-	drawAoi(left, Position.cumulativeOffset(divUL)[1] + 3, width, d.height);
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-}
-
-function dragMRListener()
-{
-	var d = Element.getDimensions(aoi);
-	
-	var width = Position.cumulativeOffset(divMR)[0] - Position.cumulativeOffset(divML)[0];
-	width = (width &gt; 5 ? width : 5);
-	
-	drawAoi(Position.cumulativeOffset(divML)[0] + 3, Position.cumulativeOffset(divUL)[1] + 3, width, d.height);
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-}
-
-// aoi mousemove event listener
-function resizeAoi(e)
-{
-	Event.stop(e); // prevents from dragging the map image (on Explorer)
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-	
-	// get the current cursor position
-	var pX = Event.pointerX(e);
-	var pY = Event.pointerY(e);
-	
-	// set the zoom box position and size
-	drawAoi (
-		Math.min(pX, startX),  // left
-		Math.min(pY, startY),  // top
-		Math.abs(pX - startX), // width
-		Math.abs(pY - startY)  // height
-	);
-	
-	Position.clone($('im_mapImg'), $('im_ghostImg'));
-}
-
-// aoi mouseup event listener
-function stopAoi(e)
-{
-	// remove listeners and div
-	Event.stopObserving(document, 'mousemove', resizeAoi);
-	Event.stopObserving(document, 'mouseup', stopAoi);
-	
-	// if area is 0 delete aoi
-	var d = Element.getDimensions(aoi);
-	if (d.width == 0 || d.height == 0) {
-		deleteAoi();
-		unsetAoi();
-		$('im_geonetRecords').className = 'im_hidden';
-	}
-	// else set the aoi
-	else
-		handleMouseupListener();
-}
-
-// Draws the aoi
-function drawAoi(left, top, width, height)
-{
-	aoi.style.left = left - mapImgOffsetX + 'px';
-	aoi.style.top = top - mapImgOffsetY + 'px';
-	aoi.style.width = width + 'px';
-	aoi.style.height = height + 'px';
-	
-	drawResizeHandles(left, top, width, height);
-}
-
-function dragAoi()
-{
-	Position.clone($('im_mapImg'), $('im_ghostImg'))
-	
-	var offset = Position.cumulativeOffset(aoi);
-	var left = offset[0];
-	var top = offset[1];
-	
-	var d = Element.getDimensions(aoi);
-	var width = d.width;
-	var height = d.height;
-	
-	drawResizeHandles(left, top, width, height);
-}
-
-function drawResizeHandles(left, top, width, height)
-{	
-	var a = left - mapImgOffsetX - 3;
-	var b = top - mapImgOffsetY - 3;
-	var c = a + width;
-	var d = b + height;
-	
-	dotUL.style.left = a + 'px';
-	dotUL.style.top = b + 'px';
-	dotUR.style.left = c + 'px';
-	dotUR.style.top = b + 'px';
-	dotBL.style.left = a + 'px';
-	dotBL.style.top = d + 'px';
-	dotBR.style.left = c + 'px';
-	dotBR.style.top = d + 'px';
-	var t = a + width / 2;
-	dotUM.style.left = t + 'px';
-	dotUM.style.top = b + 'px';
-	dotBM.style.left = dotUM.style.left;
-	dotBM.style.top = d + 'px';
-	dotML.style.left = a + 'px';
-	t = b + height / 2;
-	dotML.style.top = t + 'px';
-	dotMR.style.left = c + 'px';
-	dotMR.style.top = dotML.style.top;
-}
-
-function repositionHandleDivs(left, top, width, height)
-{
-	var a = left - mapImgOffsetX - 3;
-	var b = top - mapImgOffsetY - 3;
-	var c = a + width;
-	var d = b + height;
-	
-	divUL.style.left = a + 'px';
-	divUL.style.top = b + 'px';
-	divUR.style.left = c + 'px';
-	divUR.style.top = b + 'px';
-	divBL.style.left = a + 'px';
-	divBL.style.top = d + 'px';
-	divBR.style.left = c + 'px';
-	divBR.style.top = d + 'px';
-	var t = a + width / 2;
-	divUM.style.left = t + 'px';
-	divUM.style.top = b + 'px';
-	divBM.style.left = divUM.style.left;
-	divBM.style.top = d + 'px';
-	divML.style.left = a + 'px';
-	t = b + height / 2;
-	divML.style.top = t + 'px';
-	divMR.style.left = c + 'px';
-	divMR.style.top = divML.style.top;
-}
-
 //==================================================
 // RESIZE
 //==================================================
@@ -863,7 +199,7 @@
 	Event.observe(document, 'mouseup', im_bm_resizeStop);
 
 	// get map image offset
-	var offset = Position.cumulativeOffset($('im_mapImg'));
+	var offset = Position.cumulativeOffset($('im_bm_image'));
 	var offsetX = offset[0];
 	var offsetY = offset[1];
 
@@ -874,18 +210,18 @@
 	// dynamically create the zoombox div
 	var resizebox = document.createElement('div');
 	resizebox.setAttribute('id', 'im_bm_resizebox');
-	im_drawBox(resizebox, startX, startY, 
-			$('im_mapImg').clientWidth, 
-			$('im_mapImg').clientHeight);
+	MapUtils.drawBox(resizebox, startX, startY, 
+			$('im_bm_image').clientWidth, 
+			$('im_bm_image').clientHeight);
 	document.body.appendChild(resizebox);
 	
 	// ghost image
 	var resizeGhost = document.createElement('img');
 	resizeGhost.id = 'im_bm_resizeGhost';
-	resizeGhost.src = $('im_mapImg').src;
-	im_drawBox(resizeGhost, startX, startY, 
-			$('im_mapImg').clientWidth, 
-			$('im_mapImg').clientHeight);
+	resizeGhost.src = $('im_bm_image').src;
+	MapUtils.drawBox(resizeGhost, startX, startY, 
+			$('im_bm_image').clientWidth, 
+			$('im_bm_image').clientHeight);
 	document.body.appendChild(resizeGhost);			
 }
 
@@ -899,24 +235,24 @@
 	var pY = Event.pointerY(e);
 	
 	// get map image offset
-	var offset = Position.cumulativeOffset($('im_mapImg'));
+	var offset = Position.cumulativeOffset($('im_bm_image'));
 	var offsetX = offset[0];
 	var offsetY = offset[1];
 
-            // Keeps map large enough
-            pX = Math.max(pX, offsetX+250);
-            pY = Math.max(pY, offsetY+200);
+	// Keeps map large enough
+	pX = Math.max(pX, offsetX+250);
+	pY = Math.max(pY, offsetY+200);
 
 	var windowsize = getWindowSize();
 	var winw = windowsize[0];
 	var winh = windowsize[1];
 
-            // Keeps map inside portview
-            pX = Math.min(pX,  winw - im_layer_width - 30); // 30 to stay comfortably within borders, padding and what else
-            pY = Math.min(pY,  800);
+	// Keeps map inside portview
+	pX = Math.min(pX,  winw - im_layer_width - 30); // 30 to stay comfortably within borders, padding and what else
+	pY = Math.min(pY,  800);
 
 	// set the zoom box position and size
-	im_drawBox ($('im_bm_resizebox'),
+	MapUtils.drawBox ($('im_bm_resizebox'),
 		offsetX +1,  // left
 		offsetY +1,  // top
 		Math.abs(pX - startX), // width
@@ -924,7 +260,7 @@
 	);
 	
 	// ghost image
-	im_drawBox( $('im_bm_resizeGhost'), 
+	MapUtils.drawBox( $('im_bm_resizeGhost'), 
 		offsetX +1,  // left
 		offsetY +1,  // top
 		Math.abs(pX - startX), // width
@@ -940,7 +276,7 @@
 	var pY = Event.pointerY(e);
 	
 	// get map image offset
-	var offset = Position.cumulativeOffset($('im_mapImg'));
+	var offset = Position.cumulativeOffset($(im_bm.imageId));
 	var offsetX = offset[0];
 	var offsetY = offset[1];
 	
@@ -953,39 +289,49 @@
 	Element.remove($('im_bm_resizeGhost'));
 	Element.remove($('im_bm_resizebox'));
 
-	imc_updateBigMap( w, h,
-				im_bm_getURLbbox(),
-				false);
-			
 	// do a preventive resizing, so user will get the whole layout before the image gets loaded
-	im_bm_setSize(w, h); 
+	im_bm.setSize(w, h);
+	
+	im_bm.rebuild();
 
+/*	imc_updateBigMap( w, h,
+				im_bm.getURLbbox(),
+				false);
+*/			
 }
 
-// Draws the zoombox
-function im_drawBox(box, left, top, width, height)
-{
-	box.style.left = left + 'px';
-	box.style.top = top + 'px';
-	box.style.width = width + 'px';
-	box.style.height = height + 'px';
-}
-
 /*****************************************************************************
  *
  *                          Scale
  *
  *****************************************************************************/
-
-
+ 
 function im_bm_setScale()
 {	
-	imc_bm_setScale(im_bm_width,  im_bm_height,
-			    im_bm_getURLbbox(),
+	imc_bm_setScale(im_bm.width,  im_bm.height,
+			    im_bm.getURLbbox(),
 			    $('im_setscale').value);
 }
 
+function imc_bm_setScale(w, h, bbox, scale )
+{
+	var pars = "width=" + w + "&amp;height="+h +
+	                "&amp;"+bbox+
+	                "&amp;scale=" + scale;
 
+	im_bm.setStatus('busy');
+
+	var myAjax = new Ajax.Request (
+		getIMServiceURL('map.setScale'), 
+		{
+			method: 'get',
+			parameters: pars,
+			onComplete: im_bm.imageRebuilt.bindAsEventListener(im_bm),
+			onFailure: reportError
+		}
+	);
+}
+
 /*****************************************************************************
  *
  *                          Generic utility functions
@@ -1010,167 +356,32 @@
 	while (target.childNodes.length &gt; 0) {target.removeChild(target.childNodes[target.childNodes.length - 1]);}
 }
 
-function refreshNeeded(refreshmm, callback)
-{          
-	if (autoRefresh)
-	{
-	    if($('im_mapImg'))
-		imc_updateBigMap(im_bm_width, im_bm_height, im_bm_getURLbbox(), refreshmm, callback);
-	    else // big one is not there: must we refresh the minimap?
-	        if(refreshmm)
-	        {
-                        im_mm_refreshNeeded(callback);
-	        }
-	}
-	else
-	{
-		setStatus('refresh');
-	}
-}
 
-function setStatus(status)
-{
-/*	var refreshButton = $('im_refreshButton');*/
-	
-	switch(status)
-	{
-		case 'busy': // not allowed to refresh - wait for ajax transaction to finish
-			// disable zoom, pan...
-			
-			// if(!$('map')) break; // ETj
-			
-			Event.stopObserving('im_map', 'mousedown', mousedownEventListener);
-			Event.observe('im_map', 'mousedown', noOp);
-			
-			// change cursor
-			$('im_map').style.cursor = 'wait'
-			
-			// change refresh button status
-/*			refreshButton.className = 'im_disabled';
-			refreshButton.disabled = true;*/
-			
-			$('im_pleaseWait').show(); //style.display = 'block';
-			break;
-		case 'idle': // all operations allowed
-			// enable zoom, pan...
-			Event.stopObserving('im_map', 'mousedown', noOp);
-			Event.observe('im_map', 'mousedown', mousedownEventListener);
-			
-			// change refresh button status
-			$('im_map').style.cursor = 'crosshair'
-/*			refreshButton.className = 'im_disabled';
-			refreshButton.disabled = true;*/
-			
-			$('im_pleaseWait').hide(); //style.display = 'none';
-			break;
-		case 'refresh': // refresh buton highlighted - means that refresh is needed after the user made some operations on layers
-			// change refresh button status
-/*			refreshButton.className = 'im_refresh';
-			refreshButton.disabled = false;*/
-			break;
-	}
-}
-
-// Just prevents the user to drag the image while trying to zoom
-function noOp(e)
-{
-	Event.stop(e); // prevents from dragging the map image (on Firefox)
-}
-
 //==================================================
 // 
 //==================================================
 
 
-function layerAdded(req)
+/*function layerAdded(req) // FIXME
 {
 	updateMapImage(req);
 	imc_reloadLayers();
 }
+*/
 
-function im_bm_toggleImageSize()
-{
-    // Set width
-    if( im_bm_width == im_bm_wsize0 )
-        im_bm_width = im_bm_wsize1;
-    else
-        im_bm_width = im_bm_wsize0;
-    
-    // Set height
-    if( im_bm_height == im_bm_hsize0 )
-        im_bm_height = im_bm_hsize1;
-    else
-        im_bm_height = im_bm_hsize0;
-    
-    deleteAoi();
-    unsetAoi();
-    
-    // Reload image
-    imc_updateBigMap(im_bm_width, im_bm_height, im_bm_getURLbbox(), false);        
-//	imc_toggleImageSize();
-}
 
-function im_bm_fullExtent()
-{
-    imc_bm_fullExtent(im_bm_width, im_bm_height);
-}
-
-
-/*****************************************************************************
- *
- *                             Keyboard events
- *
- *****************************************************************************/
-/*
-function keyPressed(e)
-{
-	
-	if (e.keyCode == 8) // backspace
-	{ 
-		deleteButtonListener();
-		Event.stop(e);
-	}
-}
-*/
 //==================================================
 // 
 //==================================================
 
-// updates the map images
-function updateMapImage(req)
+im_bm.afterImageRebuilt = function(req)
 {
-	var vMapImg = $('im_mapImg');
-	var vGhostImg = $('im_ghostImg');
-
-	// set inner vars
-            im_bm_set(req.responseXML);
-
-	// get the new values from response XML
-	var imageSrc = req.responseXML.getElementsByTagName('imgUrl')[0].firstChild.nodeValue;
-	var scale = req.responseXML.getElementsByTagName('scale')[0].firstChild.nodeValue;
-	
-/*	src is set by im_bm_set() 
-            // update the map image
-	vMapImg.src = imageSrc;
-*/	
-	// set map image offset
-	vMapImg.style.left = '0';
-	vMapImg.style.top = '0';
-	if (ghostImg != null)
-	{
-		vGhostImg.src = imageSrc;
-		vGhostImg.style.left = '0';
-		vGhostImg.style.top = '0';
-	}
-
 	// update the scale text
+	var scale = req.responseXML.getElementsByTagName('scale')[0].firstChild.nodeValue;
 	deleteChildNodes($('im_scale'));
 	$('im_scale').appendChild( document.createTextNode('1:' + scale));
 	
 	$('im_currentscale').innerHTML= '1:' + scale;
 	$('im_setscale').selectedIndex = 0;
-	
-//	Event.observe(vMapImg, 'load', function(e) { setStatus('idle') }); // better behaviour but needs debugging on explorer (newer version of prototype?)
-	setStatus('idle');
-}
+};
 

Added: trunk/web/intermap/scripts/im_class.js
===================================================================
--- trunk/web/intermap/scripts/im_class.js	                        (rev 0)
+++ trunk/web/intermap/scripts/im_class.js	2007-11-04 22:00:46 UTC (rev 955)
@@ -0,0 +1,608 @@
+/**
+ *                      Intermap class 
+ *
+ * This js class handles the map, its properties (size, bbox) and some
+ * functionalities, such as zoomin, zoomout and panning.
+ *
+ * You can customize the behaviour a great deal by defining some callback functions.
+ *
+ * &lt;br/&gt;&lt;b&gt;Requires:&lt;/b&gt;
+ *   getIMServiceURL(service)
+ *
+ * @param {int} initWidth The initial width for the image in pixels 
+ * @param {int} initHeight The initial height for the image in pixels
+ * @param {string} imageId The id attribute of the img element containing the map
+ * 
+ * @constructor
+ * 
+ * @author ETj
+ *
+ */
+function Intermap(initWidth, initHeight, imageId)
+{
+    this.width = initWidth;
+    this.height = initHeight;
+    this.imageId = imageId;
+    
+    this.mouseDownListener = null; //this.mousedownEventListener.bindAsEventListener(this);
+}
+
+

@@ Diff output truncated at 100000 characters. @@

This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=6027232">[GeoNetwork-commit] SF.net SVN: geonetwork: [969] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;ticheler@us...&gt; -	2007-11-14 16:15</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 969
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=969&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=969&amp;view=rev</a>
Author:   ticheler
Date:     2007-11-14 08:15:51 -0800 (Wed, 14 Nov 2007)

Log Message:
-----------
Moved version variables to properties file and fill them in the appropriate locations
(for now the readme.html and the installer configuration files)

Modified Paths:
--------------
    trunk/docs/readme.html
    trunk/installer/build.xml
    trunk/installer/installer-config-win-jre.xml
    trunk/installer/installer-config.xml

Modified: trunk/docs/readme.html
===================================================================
--- trunk/docs/readme.html	2007-11-13 11:35:02 UTC (rev 968)
+++ trunk/docs/readme.html	2007-11-14 16:15:51 UTC (rev 969)
@@ -9,7 +9,7 @@
 &lt;/style&gt;&lt;/head&gt;
 
 &lt;body&gt;
-	&lt;div align="right"&gt;&lt;span class="style1"&gt;GeoNetwork opensource V2.1.0 Date: 2007-08-30&lt;/span&gt;&lt;/div&gt;
+	&lt;div align="right"&gt;&lt;span class="style1"&gt;GeoNetwork opensource V@...@ @subVersion@ Date: @day@...&gt;
 	&lt;h1&gt;GeoNetwork opensource - Getting started&lt;/h1&gt;
 
 	&lt;h2&gt;Running the application&lt;/h2&gt;
@@ -43,7 +43,7 @@
 	&lt;/ul&gt;
  	&lt;/p&gt;
  	&lt;p&gt;
-		&lt;cite&gt;Note: A Java Runtime Environment (JRE) &lt;em&gt;1.5.0 Standard Edition&lt;/em&gt; (download from &lt;a href="<a href="http://java.sun.com/javase/downloads/index_jdk5.jsp"&gt;http://java.sun.com)&lt;/a" target="_new">http://java.sun.com/javase/downloads/index_jdk5.jsp"&gt;http://java.sun.com)&lt;/a</a>&gt; is required to run GeoNetwork opensource. See the Troubleshooting sections if normal 
+		&lt;cite&gt;Note: A Java Runtime Environment (JRE) &lt;em&gt;@javaVersion@ Standard Edition&lt;/em&gt; (download from &lt;a href="@jre_url@... href="http://java.sun.com)&lt;/a" target="_new">http://java.sun.com)&lt;/a</a>&gt; is required to run GeoNetwork opensource. See the Troubleshooting sections if normal 
 		installation or start up fails.&lt;/cite&gt;
 	&lt;/p&gt;
 	
@@ -68,7 +68,7 @@
 
 	&lt;h3&gt;Web server&lt;/h3&gt;
 	&lt;p&gt;
-		The application comes with an embedded &lt;a href="<a href="http://jetty.mortbay.org/"&gt;Jetty&lt;/a" target="_new">http://jetty.mortbay.org/"&gt;Jetty&lt;/a</a>&gt; web server. You can use &lt;a href="<a href="http://jakarta.apache.org/tomcat"&gt;Jakarta" target="_new">http://jakarta.apache.org/tomcat"&gt;Jakarta</a> Tomcat&lt;/a&gt; instead if required. You have to setup new contexts in Tomcat that point to the applications in the &lt;code&gt;web&lt;/code&gt; folder of the GeoNetwork installation.
+		The application comes with an embedded &lt;a href="<a href="http://jetty.mortbay.org/"&gt;Jetty&lt;/a" target="_new">http://jetty.mortbay.org/"&gt;Jetty&lt;/a</a>&gt; web server. You can use &lt;a href="<a href="http://jakarta.apache.org/tomcat"&gt;Jakarta" target="_new">http://jakarta.apache.org/tomcat"&gt;Jakarta</a> Tomcat&lt;/a&gt; version 5.5 instead if required. You have to setup new contexts in Tomcat that point to the applications in the &lt;code&gt;web&lt;/code&gt; folder of the GeoNetwork installation.
 	&lt;/p&gt;
 	
 	&lt;h3&gt;Database system &lt;/h3&gt;

Modified: trunk/installer/build.xml
===================================================================
--- trunk/installer/build.xml	2007-11-13 11:35:02 UTC (rev 968)
+++ trunk/installer/build.xml	2007-11-14 16:15:51 UTC (rev 969)
@@ -11,7 +11,7 @@
 &lt;project name="geonetwork" default="installer" basedir="."&gt;
 
 	&lt;!-- =================================================================================== --&gt;
-	
+
 	&lt;condition property="osys" value="macosx"&gt;
 		&lt;os family="mac"/&gt;
 	&lt;/condition&gt;
@@ -23,6 +23,15 @@
 	&lt;/condition&gt;
 		
 	&lt;!-- =================================================================================== --&gt;
+
+	&lt;property name="version" value="2.2.0" /&gt;
+	&lt;property name="subVersion" value="beta1" /&gt;
+	&lt;property name="javaVersion" value="1.5.0" /&gt; &lt;!-- Minimum version required --&gt;
+	&lt;property name="jre_url" value="<a href="http://java.sun.com/javase/downloads/index_jdk5.jsp" target="_new">http://java.sun.com/javase/downloads/index_jdk5.jsp</a>" /&gt;
+	&lt;property name="OS" value="Compiled on ${os.name} (${osys})" /&gt;
+	&lt;property name="propsdir" value="../.props" /&gt;
+
+	&lt;!-- =================================================================================== --&gt;
 	
 	&lt;taskdef name="izpack" 
 				classpath="lib/standalone-compiler.jar" 
@@ -35,21 +44,69 @@
 	&lt;!-- =================================================================================== --&gt;
 
 	&lt;target name="setProperties"&gt;
+	
+		&lt;delete	dir ="${propsdir}" /&gt;
+		&lt;mkdir	dir ="${propsdir}" /&gt;
+
 		&lt;!-- Update the properties file --&gt;
 		&lt;propertyfile
 		    file="../web/geonetwork/WEB-INF/server.prop"
-		    comment="GeoNetwork opensource properties. 
-			           These are also used by both gast and geonetwork at runtime"&gt;
+		    comment="GeoNetwork opensource properties. These are also used by both gast and geonetwork at runtime"&gt;
 			&lt;!-- These are used by both gast and geonetwork at runtime --&gt;
 			&lt;!-- Do not remove !! --&gt;
-			&lt;entry  key="version" value="2.1.0"/&gt;
-			&lt;entry  key="subVersion" value="RC2"/&gt;
-			&lt;entry  key="release" value="2.1.0"/&gt;
+			&lt;entry  key="version" value="${version}"/&gt;
+			&lt;entry  key="subVersion" value="${subVersion}"/&gt;
+			&lt;entry  key="release" value="${version}"/&gt;
+			
+			&lt;entry  key="javaVersion" value="${javaVersion}"/&gt;
+			&lt;entry	key="jre_url" value="${jre_url}"/&gt;
 
 			&lt;entry  key="date" type="date" value="now" pattern="yymmddHHmm"/&gt;
-			&lt;entry  key="OS" value="Compiled on ${os.name} (${osys})"/&gt;
+			&lt;entry  key="day" type="date" value="now" pattern="dd-M-yyyy"/&gt;
+			&lt;entry  key="OS" value="${OS}"/&gt;
 		  
 		&lt;/propertyfile&gt;
+		
+		&lt;!-- make sure all files that need have version numbers etc updated --&gt;
+
+	    &lt;!-- Windows installer build --&gt;
+	    &lt;copy 	file="../installer/installer-config.xml" 
+	    		tofile="${propsdir}/installer-config.xml" 
+	    		filtering="on" overwrite="yes"/&gt;
+
+		&lt;replace 	file="${propsdir}/installer-config.xml" 
+					propertyFile="../web/geonetwork/WEB-INF/server.prop"&gt;
+			&lt;replacefilter token="@version@" property="version"/&gt;
+			&lt;replacefilter token="@subVersion@" property="subVersion"/&gt;
+			&lt;replacefilter token="@javaVersion@" property="javaVersion"/&gt;
+		&lt;/replace&gt;
+
+	    &lt;!-- Windows with JRE installer build --&gt;
+	    &lt;copy 	file="../installer/installer-config-win-jre.xml" 
+	    		tofile="${propsdir}/installer-config-win-jre.xml" 
+	    		filtering="on" overwrite="yes"/&gt;
+
+		&lt;replace 	file="${propsdir}/installer-config-win-jre.xml"
+					propertyFile="../web/geonetwork/WEB-INF/server.prop"&gt;
+			&lt;replacefilter token="@version@" property="version"/&gt;
+			&lt;replacefilter token="@subVersion@" property="subVersion"/&gt;
+			&lt;replacefilter token="@javaVersion@" property="javaVersion"/&gt;
+		&lt;/replace&gt;
+
+		&lt;!-- help file --&gt;
+	    &lt;copy 	file="../docs/readme.html" 
+	    		tofile="${propsdir}/readme.html" 
+	    		filtering="on" overwrite="yes"/&gt;
+
+		&lt;replace 	file="${propsdir}/readme.html"
+					propertyFile="../web/geonetwork/WEB-INF/server.prop"&gt;
+			&lt;replacefilter token="@version@" property="version"/&gt;
+			&lt;replacefilter token="@subVersion@" property="subVersion"/&gt;
+			&lt;replacefilter token="@day@" property="day"/&gt;
+			&lt;replacefilter token="@javaVersion@" property="javaVersion"/&gt;
+			&lt;replacefilter token="@jre_url@" property="jre_url"/&gt;
+		&lt;/replace&gt;
+
 	&lt;/target&gt;
 
 	&lt;!-- =================================================================================== --&gt;
@@ -62,8 +119,10 @@
 		
 		&lt;delete dir="../geonetwork-${release}"/&gt;
 		&lt;mkdir  dir="../geonetwork-${release}"/&gt;
-		
-		&lt;izpack	input="${basedir}/installer-config.xml" 
+
+		&lt;echo message="Building platform independent installer on ${osys} using IzPack"/&gt;
+
+		&lt;izpack	input="${propsdir}/installer-config.xml" 
 					output="../geonetwork-${release}/geonetwork-install-${release}.jar" 
 					installerType="standard" 
 					basedir="${basedir}"/&gt;
@@ -98,13 +157,13 @@
 
 		&lt;property file="../web/geonetwork/WEB-INF/server.prop"/&gt;
 
-		&lt;echo message="Building Windows installer with JRE on ${osys} using launch4j"/&gt;
-
-		&lt;izpack	input="${basedir}/installer-config-win-jre.xml" 
+		&lt;izpack	input="${propsdir}/installer-config-win-jre.xml" 
 					output="../geonetwork-${release}/geonetwork-install-win-jre-${release}.jar" 
 					installerType="standard" 
 					basedir="${basedir}"/&gt; 
 
+		&lt;echo message="Building Windows installer with JRE on ${osys} using launch4j"/&gt;
+
 		&lt;launch4j configFile="${basedir}/launch4j/launch4jConfig-jre.xml"
 			jar="../geonetwork-${release}/geonetwork-install-win-jre-${release}.jar"
 			outfile="../geonetwork-${release}/geonetwork-install-with-jre-${release}.exe"

Modified: trunk/installer/installer-config-win-jre.xml
===================================================================
--- trunk/installer/installer-config-win-jre.xml	2007-11-13 11:35:02 UTC (rev 968)
+++ trunk/installer/installer-config-win-jre.xml	2007-11-14 16:15:51 UTC (rev 969)
@@ -6,7 +6,7 @@
 	
 	&lt;info&gt;
 		&lt;appname&gt;geonetwork&lt;/appname&gt;
-		&lt;appversion&gt;2.1.0 RC2&lt;/appversion&gt;
+		&lt;appversion&gt;@version@ @subVersion@...&gt;
 		&lt;authors&gt;
 			&lt;author name="FAO GeoNetwork Team" email="GeoNetwork@..."/&gt;
 			&lt;author name="VAM WFP"             email="vamsie@..."/&gt;
@@ -15,7 +15,7 @@
 			&lt;author name="OSGeo"                email="geonetwork@..."/&gt;			 
 		&lt;/authors&gt;
 		&lt;url&gt;<a href="http://geonetwork-opensource.org/&lt;/url" target="_new">http://geonetwork-opensource.org/&lt;/url</a>&gt;
-		&lt;javaversion&gt;1.5.0&lt;/javaversion&gt;
+		&lt;javaversion&gt;@javaVersion@...&gt;
 	&lt;/info&gt;
 	
 	&lt;!-- =================================================================================== --&gt;
@@ -38,7 +38,7 @@
 	
 	&lt;resources&gt;
 		&lt;res id="HTMLLicencePanel.licence" src="../docs/license.html"/&gt;
-		&lt;res id="HTMLInfoPanel.info"       src="../docs/readme.html"/&gt;
+		&lt;res id="HTMLInfoPanel.info"       src="../.props/readme.html"/&gt;
 		&lt;res id="Installer.image"          src="installer.png"/&gt;
 		&lt;res id="shortcutSpec.xml"         src="windows-shortcuts.xml"/&gt;
 		&lt;res id="Unix_shortcutSpec.xml"    src="unix-shortcuts.xml"/&gt;
@@ -71,12 +71,15 @@
 			&lt;/description&gt;
 			
 			&lt;fileset dir="../docs" targetdir="$INSTALL_PATH/docs"&gt;
+				&lt;exclude name="docbook/**"/&gt;
 				&lt;exclude name="javadoc-gn/**"/&gt;
 				&lt;exclude name="javadoc-im/**"/&gt;
 				&lt;exclude name="lyx/**"/&gt;
 				&lt;exclude name="developers/**"/&gt;
 			&lt;/fileset&gt;						
 			
+			&lt;singlefile src="../.props/readme.html" target="$INSTALL_PATH/docs/readme.html" override="true"/&gt;
+
 			&lt;fileset dir="../bin"   targetdir="$INSTALL_PATH/bin"&gt;
 				&lt;exclude name="jre/**"/&gt;
 				&lt;exclude name="jetty.xml_with_geoserver"/&gt;

Modified: trunk/installer/installer-config.xml
===================================================================
--- trunk/installer/installer-config.xml	2007-11-13 11:35:02 UTC (rev 968)
+++ trunk/installer/installer-config.xml	2007-11-14 16:15:51 UTC (rev 969)
@@ -6,16 +6,16 @@
 	
 	&lt;info&gt;
 		&lt;appname&gt;geonetwork&lt;/appname&gt;
-		&lt;appversion&gt;2.1.0 RC2&lt;/appversion&gt;
+		&lt;appversion&gt;@version@ @subVersion@...&gt;
 		&lt;authors&gt;
 			&lt;author name="FAO GeoNetwork Team" email="GeoNetwork@..."/&gt;
 			&lt;author name="VAM WFP"             email="vamsie@..."/&gt;
 			&lt;author name="UNEP.net"            email="info@..."/&gt;			 
 			&lt;author name="OCHA"                email="ochageodata@..."/&gt;			 
-			&lt;author name="OSGeo"                email="geonetwork@..."/&gt;			 
+			&lt;author name="OSGeo"               email="geonetwork@..."/&gt;			 
 		&lt;/authors&gt;
 		&lt;url&gt;<a href="http://geonetwork-opensource.org/&lt;/url" target="_new">http://geonetwork-opensource.org/&lt;/url</a>&gt;
-		&lt;javaversion&gt;1.5.0&lt;/javaversion&gt;
+		&lt;javaversion&gt;@javaVersion@...&gt;
 	&lt;/info&gt;
 	
 	&lt;!-- =================================================================================== --&gt;
@@ -38,7 +38,7 @@
 	
 	&lt;resources&gt;
 		&lt;res id="HTMLLicencePanel.licence" src="../docs/license.html"/&gt;
-		&lt;res id="HTMLInfoPanel.info"       src="../docs/readme.html"/&gt;
+		&lt;res id="HTMLInfoPanel.info"       src="../.props/readme.html"/&gt;
 		&lt;res id="Installer.image"          src="installer.png"/&gt;
 		&lt;res id="shortcutSpec.xml"         src="windows-shortcuts.xml"/&gt;
 		&lt;res id="Unix_shortcutSpec.xml"    src="unix-shortcuts.xml"/&gt;
@@ -71,11 +71,14 @@
 			&lt;/description&gt;
 			
 			&lt;fileset dir="../docs" targetdir="$INSTALL_PATH/docs"&gt;
+				&lt;exclude name="docbook/**"/&gt;
 				&lt;exclude name="javadoc-gn/**"/&gt;
 				&lt;exclude name="javadoc-im/**"/&gt;
 				&lt;exclude name="lyx/**"/&gt;
 				&lt;exclude name="developers/**"/&gt;
 			&lt;/fileset&gt;						
+
+			&lt;singlefile src="../.props/readme.html" target="$INSTALL_PATH/docs/readme.html" override="true"/&gt;
 			
 			&lt;fileset dir="../bin"   targetdir="$INSTALL_PATH/bin"&gt;
 				&lt;exclude name="jre/**"/&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=6027257">[GeoNetwork-commit] SF.net SVN: geonetwork: [980] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;e_tajariol@us...&gt; -	2007-11-27 22:19</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 980
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=980&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=980&amp;view=rev</a>
Author:   e_tajariol
Date:     2007-11-27 14:19:32 -0800 (Tue, 27 Nov 2007)

Log Message:
-----------
When adding a new layer, the whole context can now be cleared.

Modified Paths:
--------------
    trunk/src/org/wfp/vam/intermap/services/map/AddServices.java
    trunk/web/intermap/scripts/im_ajax.js

Modified: trunk/src/org/wfp/vam/intermap/services/map/AddServices.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/services/map/AddServices.java	2007-11-27 22:15:03 UTC (rev 979)
+++ trunk/src/org/wfp/vam/intermap/services/map/AddServices.java	2007-11-27 22:19:32 UTC (rev 980)
@@ -27,14 +27,16 @@
 import jeeves.interfaces.Service;
 import jeeves.server.ServiceConfig;
 import jeeves.server.context.ServiceContext;
-import org.fao.geonet.csw.common.util.Xml;
 import org.jdom.Element;
 import org.wfp.vam.intermap.Constants;
 import org.wfp.vam.intermap.kernel.map.MapMerger;
+import org.wfp.vam.intermap.kernel.map.mapServices.wms.schema.impl.Utils;
 
 //=============================================================================
 
 /** main.result service. shows search results
+ *
+ * FIXME: this class and map.layers.Add seem to do the same thing. Please clean up.
   */
 
 public class AddServices implements Service
@@ -52,74 +54,64 @@
 		// get some request parameters
 		String serverUrl = params.getChildText(Constants.MAP_SERVER_URL);
 		int serverType = Integer.parseInt(params.getChildText(Constants.MAP_SERVER_TYPE));
-		List&lt;Element&gt; lServices = params.getChildren(Constants.MAP_SERVICE);
+		List&lt;Element&gt; lServices = (List&lt;Element&gt;)params.getChildren(Constants.MAP_SERVICE);
 
-		// if no services are specified then forward to GetServices
 		if (lServices.size() == 0)
-		{
-			Element response = new Element("response");
-			response.addContent(new Element("status").setAttribute("services", "false"));
-			response.addContent(new Element("mapserver").setText("-" + serverType + ""));
-			response.addContent(new Element("url").setText(serverUrl));
+			throw new IllegalArgumentException("Missing services.");
 
-			return response;
-		}
-//		else
-//			response.addContent(new Element("status").setAttribute("services", "true"));
-
 		// Get the other request parameters
 		String vsp = params.getChildText("vendor_spec_par"); // vendor specific parameters
 		String bbox = params.getChildText("BBOX");
 
-		MapMerger mm = MapUtil.getMapMerger(context);
+		String sreplace  = params.getChildText("clear");
+		boolean breplace = Utils.getBooleanAttrib(sreplace, false);
 
+		MapMerger mm = breplace ?
+			new MapMerger() :
+			MapUtil.getMapMerger(context);
+
 		Element added = new Element("added");
 
-		if (lServices.size() &gt; 0)
-		{
-			// Get the MapMerger object from the user session
+		// Set a flag to indicate that no services were in the MapMerger
+		boolean mmWasEmpty = mm.size() == 0;
 
-			// Set a flag to indicate that no services were in the MapMerger
-			boolean mmWasEmpty = mm.size() == 0;
-
-			// Create the Service objects and attach them to the MapMerge object
-			for (Element eService : lServices)
+		// Create the Service objects and attach them to the MapMerge object
+		for (Element eService : lServices)
+		{
+			String serviceName = eService.getText();
+			int servid = MapUtil.addService(serverType, serverUrl, serviceName, vsp, mm);
+			if ( servid != -1 )
 			{
-				String serviceName = eService.getText();
-				int servid = MapUtil.addService(serverType, serverUrl, serviceName, vsp, mm);
-				if ( servid != -1 )
-				{
-					//System.err.println("ADDING SERVICE " + serviceName + " @ " + servid);
-					added.addContent(new Element("newLayer")
-										 .setAttribute("name", serviceName)
-										 .setAttribute("id", ""+servid)
-									);
-				}
+				//System.err.println("ADDING SERVICE " + serviceName + " @ " + servid);
+				added.addContent(new Element("newLayer")
+									 .setAttribute("name", serviceName)
+									 .setAttribute("id", ""+servid)
+								);
 			}
+		}
 
-			// Set the bounding box as specified in the URL
-			if (bbox != null)
-			{
-				MapUtil.setBBoxFromUrl(bbox, mm);
-			}
+		// Set the bounding box as specified in the URL
+		if (bbox != null)
+		{
+			MapUtil.setBBoxFromUrl(bbox, mm);
+		}
+		// Calculate the starting BoundingBox if flag is set
+		else if (mmWasEmpty)
+		{
+			MapUtil.setDefBoundingBox(mm);
+		}
 
-			// Calculate the starting BoundingBox if flag is set
-			else if (mmWasEmpty)
-			{
-				MapUtil.setDefBoundingBox(mm);
-			}
+		// Update the user session
+		context.getUserSession().setProperty(Constants.SESSION_MAP, mm);
 
-			// Update the user session
-			context.getUserSession().setProperty(Constants.SESSION_MAP, mm);
-		}
+		// DEBUGME: side server image dimensioning is obsolete. Please make sure the client does not rely on this stuff.
+//		// Set image size if not set
+//		String size = (String)context.getUserSession().getProperty(Constants.SESSION_SIZE);
+//		if (size == null) {
+////			System.out.println("defaultImageSize = " + MapUtil.getDefaultImageSize()); // DEBUG
+//			context.getUserSession().setProperty(Constants.SESSION_SIZE, MapUtil.getDefaultImageSize());
+//		}
 
-		// Set image size if not set
-		String size = (String)context.getUserSession().getProperty(Constants.SESSION_SIZE);
-		if (size == null) {
-//			System.out.println("defaultImageSize = " + MapUtil.getDefaultImageSize()); // DEBUG
-			context.getUserSession().setProperty(Constants.SESSION_SIZE, MapUtil.getDefaultImageSize());
-		}
-		
 		//System.err.println(" --ADDED --&gt; " + Xml.getString(added));
 		return mm.toElementSimple().addContent(added);
 	}

Modified: trunk/web/intermap/scripts/im_ajax.js
===================================================================
--- trunk/web/intermap/scripts/im_ajax.js	2007-11-27 22:15:03 UTC (rev 979)
+++ trunk/web/intermap/scripts/im_ajax.js	2007-11-27 22:19:32 UTC (rev 980)
@@ -13,10 +13,11 @@
 function im_checkError(req)
 {
 	var doc = req.responseXML;	
-	if(!doc) {return false;}
+	if(!doc) // It's not XML 
+	{
+		return false;
+	}	
 	
-	doc.getElementByTagName
-	
 	if(doc.firstChild.tagName=="error")
 	{ 
 		return true;
@@ -30,7 +31,10 @@
 function im_showError(req)
 {
 	var doc = req.responseXML;	
-	if(!doc) {return false;}
+	if(!doc) // It's not XML 
+	{
+		return false;
+	}	
 	
 	if(doc.firstChild.tagName=="error")
 	{ 
@@ -97,7 +101,7 @@
 
 function imc_setContextFromURL(url, callback) 
 {
-	var pars = 'url=' + encodeURIComponent(url) 
+	var pars = 'url=' + encodeURIComponent(url);
     		
     var myAjax = new Ajax.Request (
     	getIMServiceURL('wmc.setContextFromURL'),
@@ -115,12 +119,25 @@
  *                                                                           *
  *****************************************************************************/
 
-function imc_addService(surl, service, type, callback)
+/**
+ * 
+ * @param {String} surl
+ * @param {String} service
+ * @param {int} type
+ * @param {boolean} doClearContext
+ * @param {function} callback
+ */
+function imc_addService(surl, service, type, doClearContext, callback)
 {
 	var pars = 'url=' + encodeURIComponent(surl) 
 			+ '&amp;service=' + encodeURIComponent(service) 
 			+ '&amp;type=' + type;
 			
+	if(doClearContext===true)
+	{
+		pars += "&amp;clear=true";		
+	}
+			
 	var myAjax = new Ajax.Request (
 		getIMServiceURL('map.addServices.embedded'),
 		{
@@ -134,9 +151,15 @@
 
 }
 
-function imc_addServices(surl, serviceArray, type, callback)
+function imc_addServices(surl, serviceArray, type, /*doClearContext,*/ callback)
 {
-	var pars = 'url=' + encodeURIComponent(surl) + '&amp;type=' + type;
+	var pars = 'url=' + encodeURIComponent(surl) 
+			 + '&amp;type=' + type;
+
+//	if(doClearContext===true)
+//	{
+//		pars += "&amp;clear=true";		
+//	}
 	
 	serviceArray.each(
 	    function(service)


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=15569001">[GeoNetwork-commit] SF.net SVN: geonetwork: [996] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;bluenetdevteam@us...&gt; -	2008-01-08 19:39</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 996
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=996&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=996&amp;view=rev</a>
Author:   bluenetdevteam
Date:     2008-01-08 11:37:56 -0800 (Tue, 08 Jan 2008)

Log Message:
-----------
Schema parsing fixes and schematron validation

Modified Paths:
--------------
    trunk/gast/setup/sample-data/iso-19139-basins-in-africa.mef
    trunk/gast/setup/sample-data/iso-19139-physiographic.mef
    trunk/gast/setup/templates/iso19139/raster.xml
    trunk/gast/setup/templates/iso19139/vector.xml
    trunk/installer/installer-config.xml
    trunk/src/org/fao/geonet/Geonetwork.java
    trunk/src/org/fao/geonet/constants/Edit.java
    trunk/src/org/fao/geonet/constants/Geonet.java
    trunk/src/org/fao/geonet/kernel/DataManager.java
    trunk/src/org/fao/geonet/kernel/EditLib.java
    trunk/src/org/fao/geonet/kernel/schema/AttributeEntry.java
    trunk/src/org/fao/geonet/kernel/schema/ComplexContentEntry.java
    trunk/src/org/fao/geonet/kernel/schema/ComplexTypeEntry.java
    trunk/src/org/fao/geonet/kernel/schema/ElementEntry.java
    trunk/src/org/fao/geonet/kernel/schema/GroupEntry.java
    trunk/src/org/fao/geonet/kernel/schema/Logger.java
    trunk/src/org/fao/geonet/kernel/schema/MetadataAttribute.java
    trunk/src/org/fao/geonet/kernel/schema/MetadataSchema.java
    trunk/src/org/fao/geonet/kernel/schema/MetadataType.java
    trunk/src/org/fao/geonet/kernel/schema/SchemaLoader.java
    trunk/src/org/fao/geonet/kernel/schema/SimpleContentEntry.java
    trunk/src/org/fao/geonet/kernel/schema/SimpleTypeEntry.java
    trunk/src/org/fao/geonet/services/metadata/EditUtils.java
    trunk/src/org/fao/geonet/services/metadata/Update.java
    trunk/web/geonetwork/WEB-INF/config.xml
    trunk/web/geonetwork/xml/schemas/dublin-core/dc.xsd
    trunk/web/geonetwork/xml/schemas/dublin-core/xml.xsd
    trunk/web/geonetwork/xml/schemas/iso19139/index-fields.xsl
    trunk/web/geonetwork/xml/schemas/iso19139/loc/en/codelists.xml
    trunk/web/geonetwork/xml/schemas/iso19139/loc/en/labels.xml
    trunk/web/geonetwork/xml/schemas/iso19139/schema-suggestions.xml
    trunk/web/geonetwork/xml/schemas/iso19139/schema.xsd
    trunk/web/geonetwork/xml/schemas/iso19139/update-fixed-info.xsl
    trunk/web/geonetwork/xsl/metadata-iso19139.xsl
    trunk/web/geonetwork/xsl/metadata-validate.xsl
    trunk/web/geonetwork/xsl/metadata.xsl

Added Paths:
-----------
    trunk/schematrons/
    trunk/schematrons/READMEprocessrules.sh
    trunk/schematrons/allSchtrnRules.sch
    trunk/schematrons/allSchtrnRulesNone.sch
    trunk/schematrons/saxon8-ant.jar
    trunk/schematrons/saxon8-dom.jar
    trunk/schematrons/saxon8-dom4j.jar
    trunk/schematrons/saxon8-jdom.jar
    trunk/schematrons/saxon8-sql.jar
    trunk/schematrons/saxon8-xom.jar
    trunk/schematrons/saxon8-xpath.jar
    trunk/schematrons/saxon8-xqj.jar
    trunk/schematrons/saxon8.jar
    trunk/schematrons/saxonb8-9j.zip
    trunk/schematrons/schematron-basic.xsl
    trunk/schematrons/schematron-frame.html
    trunk/schematrons/schematron-report-geonetwork-xml.xsl
    trunk/schematrons/schematron-report.xsl
    trunk/schematrons/schematron.xsl
    trunk/schematrons/schematron_xml.xsl
    trunk/schematrons/skeleton1-5.xsl
    trunk/schematrons/verbid.xsl
    trunk/src/org/fao/geonet/kernel/schema/AttributeGroupEntry.java
    trunk/src/org/fao/geonet/kernel/schema/SchemaSubstitutions.java
    trunk/src/org/fao/geonet/util/FileCopyMgr.java
    trunk/web/geonetwork/images/schematron.gif
    trunk/web/geonetwork/schematronCache/
    trunk/web/geonetwork/schematronCache/schematronscripts/
    trunk/web/geonetwork/schematronCache/schematronscripts/schematron-frame.html
    trunk/web/geonetwork/schematronCache/schematronscripts/skeleton1-5.xsl
    trunk/web/geonetwork/schematronCache/schematronscripts/verbid.xsl
    trunk/web/geonetwork/xml/schemas/dublin-core/schema-substitutes.xml
    trunk/web/geonetwork/xml/schemas/dublin-core/schematron.xsl
    trunk/web/geonetwork/xml/schemas/dublin-core/schematron_verbid.xsl
    trunk/web/geonetwork/xml/schemas/dublin-core/schematron_xml.xsl
    trunk/web/geonetwork/xml/schemas/fgdc-std/schema-substitutes.xml
    trunk/web/geonetwork/xml/schemas/fgdc-std/schematron.xsl
    trunk/web/geonetwork/xml/schemas/fgdc-std/schematron_verbid.xsl
    trunk/web/geonetwork/xml/schemas/fgdc-std/schematron_xml.xsl
    trunk/web/geonetwork/xml/schemas/iso19115/schema-substitutes.xml
    trunk/web/geonetwork/xml/schemas/iso19115/schematron.xsl
    trunk/web/geonetwork/xml/schemas/iso19115/schematron_verbid.xsl
    trunk/web/geonetwork/xml/schemas/iso19115/schematron_xml.xsl
    trunk/web/geonetwork/xml/schemas/iso19139/schema/srv/
    trunk/web/geonetwork/xml/schemas/iso19139/schema/srv/serviceMetadata.xsd
    trunk/web/geonetwork/xml/schemas/iso19139/schema/srv/serviceModel.xsd
    trunk/web/geonetwork/xml/schemas/iso19139/schema/srv/srv.xsd
    trunk/web/geonetwork/xml/schemas/iso19139/schema-substitutes.xml
    trunk/web/geonetwork/xml/schemas/iso19139/schematron.xsl
    trunk/web/geonetwork/xml/schemas/iso19139/schematron_verbid.xsl
    trunk/web/geonetwork/xml/schemas/iso19139/schematron_xml.xsl

Modified: trunk/gast/setup/sample-data/iso-19139-basins-in-africa.mef
===================================================================
(Binary files differ)

Modified: trunk/gast/setup/sample-data/iso-19139-physiographic.mef
===================================================================
(Binary files differ)

Modified: trunk/gast/setup/templates/iso19139/raster.xml
===================================================================
--- trunk/gast/setup/templates/iso19139/raster.xml	2007-12-19 21:43:24 UTC (rev 995)
+++ trunk/gast/setup/templates/iso19139/raster.xml	2008-01-08 19:37:56 UTC (rev 996)
@@ -313,7 +313,7 @@
 &lt;temporalElement&gt;
 &lt;EX_TemporalExtent&gt;
 &lt;extent&gt;
-&lt;gml:TimePeriod&gt;
+&lt;gml:TimePeriod gml:id=""&gt;
 &lt;gml:beginPosition/&gt;
 &lt;gml:endPosition/&gt;
 &lt;/gml:TimePeriod&gt;

Modified: trunk/gast/setup/templates/iso19139/vector.xml
===================================================================
--- trunk/gast/setup/templates/iso19139/vector.xml	2007-12-19 21:43:24 UTC (rev 995)
+++ trunk/gast/setup/templates/iso19139/vector.xml	2008-01-08 19:37:56 UTC (rev 996)
@@ -261,7 +261,7 @@
 &lt;temporalElement&gt;
 &lt;EX_TemporalExtent&gt;
 &lt;extent&gt;
-&lt;gml:TimePeriod&gt;
+&lt;gml:TimePeriod gml:id=""&gt;
 &lt;gml:beginPosition/&gt;
 &lt;gml:endPosition/&gt;
 &lt;/gml:TimePeriod&gt;

Modified: trunk/installer/installer-config.xml
===================================================================
--- trunk/installer/installer-config.xml	2007-12-19 21:43:24 UTC (rev 995)
+++ trunk/installer/installer-config.xml	2008-01-08 19:37:56 UTC (rev 996)
@@ -107,6 +107,10 @@
 				&lt;exclude name="geoserver/**"/&gt;
 			&lt;/fileset&gt;
 			
+			&lt;fileset dir="../schematrons"   targetdir="$INSTALL_PATH/schematrons"&gt;
+				&lt;exclude name="saxon*"/&gt;
+			&lt;/fileset&gt;
+
 			&lt;executable targetfile="$INSTALL_PATH/bin/start-geonetwork.sh" /&gt;
 			&lt;executable targetfile="$INSTALL_PATH/bin/stop-geonetwork.sh" /&gt;
 			&lt;executable targetfile="$INSTALL_PATH/bin/start-gast.sh" /&gt;

Added: trunk/schematrons/READMEprocessrules.sh
===================================================================
--- trunk/schematrons/READMEprocessrules.sh	                        (rev 0)
+++ trunk/schematrons/READMEprocessrules.sh	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,25 @@
+#!/bin/sh
+# An example of how to create the schematrons for geonetwork - you'll need 
+# saxon8.jar and some kind of Unix environment for this script to work.
+java -jar saxon8.jar -s allSchtrnRules.sch -o schematron.xsl schematron-report.xsl
+java -jar saxon8.jar -s allSchtrnRules.sch -o schematron_xml.xsl schematron-report-geonetwork-xml.xsl
+# After this they need to be copied to the relevant schema directory:
+# (NOTE: you may want to back up the ones supplied with this release first!)
+#
+# The first xsl runs the standard schematron report for use by the editor
+# validation function, the second xsl is run each time a metadata record is
+# read and saved by the editor - it is responsible for the orange "i" alert
+# icons next to the element names in the editor
+#
+# If you are testing an xml file (eg. junk.xml) against the rules then you 
+# could do the following to get the schematron-report:
+# 
+# java -jar saxon8.jar -s junk.xml -o schematron-errors.html anzlic.xsl
+# java -jar saxon8.jar -s junk.xml -o schematron-out.html verbid.xsl
+#
+# then open schematron-frame.html in your favourite browser
+#
+# NOTE there appears to be no include mechanism in schematron 1.5 so
+# its rather difficult to include these rules in another set of rules for
+# a profile - a pain but what can we do except roll on to ISO schematron?
+# Simon Pigot - September 2007


Property changes on: trunk/schematrons/READMEprocessrules.sh
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/schematrons/allSchtrnRules.sch
===================================================================
--- trunk/schematrons/allSchtrnRules.sch	                        (rev 0)
+++ trunk/schematrons/allSchtrnRules.sch	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,222 @@
+&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
+&lt;sch:schema xmlns:sch="<a href="http://www.ascc.net/xml/schematron" target="_new">http://www.ascc.net/xml/schematron</a>"&gt;
+&lt;!--
+
+This Schematron schema merges three sets of Schematron rules
+1. Schematron rules embedded in the GML 3.2 schema
+2. Schematron rules implementing the Additional Constraints described in 
+   ISO 19139 Table A.1
+
+This script was written by CSIRO for the Australia-New Zealand Land 
+Information Council (ANZLIC) as part of a project to develop an XML 
+implementation of the ANZLIC ISO Metadata Profile. 
+
+December 2006, March 2007
+
+Port back to good old Schematron-1.5 for use with schematron-report.xsl
+and change titles for use as bare bones 19115/19139 schematron checker 
+in GN 2.2 onwards.
+
+Simon Pigot, 2007
+
+This work is licensed under the Creative Commons Attribution 2.5 License. 
+To view a copy of this license, visit 
+    <a href="http://creativecommons.org/licenses/by/2.5/au/" target="_new">http://creativecommons.org/licenses/by/2.5/au/</a> 
+
+or send a letter to:
+
+Creative Commons, 
+543 Howard Street, 5th Floor, 
+San Francisco, California, 94105, 
+USA.
+
+--&gt;
+
+	&lt;sch:title xmlns="<a href="http://www.w3.org/2001/XMLSchema"&gt;Schematron" target="_new">http://www.w3.org/2001/XMLSchema"&gt;Schematron</a> validation for ISO 19115(19139)&lt;/sch:title&gt;
+	&lt;sch:ns prefix="gml" uri="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>" /&gt;
+	&lt;sch:ns prefix="gmd" uri="<a href="http://www.isotc211.org/2005/gmd"/" target="_new">http://www.isotc211.org/2005/gmd"/</a>&gt;
+	&lt;sch:ns prefix="gco" uri="<a href="http://www.isotc211.org/2005/gco"/" target="_new">http://www.isotc211.org/2005/gco"/</a>&gt;
+	&lt;sch:ns prefix="geonet" uri="<a href="http://www.fao.org/geonetwork"/" target="_new">http://www.fao.org/geonetwork"/</a>&gt;
+	&lt;sch:ns prefix="xlink" uri="<a href="http://www.w3.org/1999/xlink"/" target="_new">http://www.w3.org/1999/xlink"/</a>&gt;
+
+	&lt;!-- Test that every CharacterString element has content or it's parent has a
+   		 valid nilReason attribute value - this is not necessary for geonetwork 
+			 because update-fixed-info.xsl supplies a gco:nilReason of missing for 
+			 all gco:CharacterString elements with no content and removes it if the
+			 user fills in a value - this is the same for all gco:nilReason tests 
+			 used below - the test for gco:nilReason in 'inapplicable....' etc is
+			 "mickey mouse" for that reason. --&gt;
+    &lt;sch:pattern name="CharacterString must have content or it's parent must have a valid nilReason attribute."&gt;
+      &lt;sch:rule context="*[gco:CharacterString]"&gt;
+        &lt;sch:report test="(normalize-space(gco:CharacterString) = '') and (not(@gco:nilReason) or not(contains('inapplicable missing template unknown withheld',@gco:nilReason)))"&gt;CharacterString must have content or parent\'s nilReason attribute must be legitimate.&lt;/sch:report&gt;
+        &lt;/sch:rule&gt;
+    &lt;/sch:pattern&gt;
+
+	&lt;sch:pattern name="CRS attributes constraints"&gt;
+		&lt;!-- UNVERIFIED --&gt;
+		&lt;sch:rule id="CRSLabelsPosType" context="//gml:DirectPositionType"&gt;
+			&lt;sch:report test="not(@srsDimension) or @srsName"&gt;The presence of a dimension attribute implies the presence of the srsName attribute.&lt;/sch:report&gt;
+			&lt;sch:report test="not(@axisLabels) or @srsName"&gt;The presence of an axisLabels attribute implies the presence of the srsName attribute.&lt;/sch:report&gt;
+			&lt;sch:report test="not(@uomLabels) or @srsName"&gt;The presence of an uomLabels attribute implies the presence of the srsName attribute.&lt;/sch:report&gt;
+			&lt;sch:report test="(not(@uomLabels) and not(@axisLabels)) or (@uomLabels and @axisLabels)"&gt;The presence of an uomLabels attribute implies the presence of the axisLabels attribute and vice versa.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+
+	&lt;!--anzlic/trunk/gml/3.2.0/gmd/citation.xsd--&gt;
+	&lt;!-- TEST 21 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row24 - name required"&gt;
+		&lt;sch:rule context="//gmd:CI_ResponsibleParty"&gt;
+			&lt;sch:assert test="(count(gmd:individualName) + count(gmd:organisationName) + count(gmd:positionName)) &gt; 0"&gt;You must specify one or more of individualName, organisationName or positionName.&lt;/sch:assert&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- anzlic/trunk/gml/3.2.0/gmd/constraints.xsd--&gt;
+	&lt;!-- TEST  4 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row07 - otherConstraints required if otherRestrictions"&gt;
+		&lt;sch:rule context="//gmd:MD_LegalConstraints"&gt;
+			&lt;sch:report test="gmd:accessConstraints/gmd:MD_RestrictionCode/@codeListValue='otherRestrictions' and not(gmd:otherConstraints)"&gt;otherConstraints: documented if accessConstraints or useConstraints = \"otherRestrictions\."&lt;/sch:report&gt;
+			&lt;sch:report test="gmd:useConstraints/gmd:MD_RestrictionCode/@codeListValue='otherRestrictions' and not(gmd:otherConstraints)"&gt;otherConstraints: documented if accessConstraints or useConstraints = \"otherRestrictions\."&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- anzlic/trunk/gml/3.2.0/gmd/content.xsd--&gt;
+	&lt;!-- TEST 13 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row16 - units required for values"&gt;
+		&lt;sch:rule context="//gmd:MD_Band"&gt;
+			&lt;sch:report test="(gmd:maxValue or gmd:minValue) and not(gmd:units)"&gt;\"units\" is mandatory if \"maxValue\" or \"minValue\" are provided.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- anzlic/trunk/gml/3.2.0/gmd/dataQuality.xsd --&gt;
+	&lt;!-- TEST 10 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row13 - description required if no sourceExtent"&gt;
+		&lt;sch:rule context="//gmd:LI_Source"&gt;
+			&lt;sch:assert test="gmd:description or gmd:sourceExtent"&gt;\"description\" is mandatory if \"sourceExtent\" is not documented.&lt;/sch:assert&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST 11 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row14 - sourceExtent required if no description"&gt;
+		&lt;sch:rule context="//gmd:LI_Source"&gt;
+			&lt;sch:assert test="gmd:description or gmd:sourceExtent"&gt;\"description\" is mandatory if \"sourceExtent\" is not documented.&lt;/sch:assert&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST  7 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row10 - content mandatory for dataset or series"&gt;
+		&lt;sch:rule context="//gmd:DQ_DataQuality"&gt;
+			&lt;sch:report test="(((count(*/gmd:LI_Lineage/gmd:source) + count(*/gmd:LI_Lineage/gmd:processStep)) = 0) and (gmd:scope/gmd:DQ_Scope/gmd:level/gmd:MD_ScopeCode/@codeListValue='dataset' or gmd:scope/gmd:DQ_Scope/gmd:level/gmd:MD_ScopeCode/@codeListValue='series')) and not(gmd:lineage/gmd:LI_Lineage/gmd:statement) and (gmd:lineage)"&gt;If(count(source) + count(processStep) =0) and (DQ_DataQuality.scope.level = \'dataset\' or \'series\') then statement is mandatory.
+			&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST  8 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row11 - source required if no statement or processStep"&gt;
+		&lt;sch:rule context="//gmd:LI_Lineage"&gt;
+			&lt;sch:report test="not(gmd:source) and not(gmd:statement) and not(gmd:processStep)"&gt;\"source\" role is mandatory if LI_Lineage.statement and \"processStep\" role are not documented.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST  9 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row12 - processStep required if no statement or source"&gt;
+		&lt;sch:rule context="//gmd:LI_Lineage"&gt;
+			&lt;sch:report test="not(gmd:processStep) and not(gmd:statement) and not(gmd:source)"&gt;\"processStep\" role is mandatory if LI_Lineage.statement and \"source\" role are not documented.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST 5 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row08 - dataset must have report or lineage"&gt;
+		&lt;sch:rule context="//gmd:DQ_DataQuality"&gt;
+			&lt;sch:report test="gmd:scope/gmd:DQ_Scope/gmd:level/gmd:MD_ScopeCode/@codeListValue='dataset' and not(gmd:report) and not(gmd:lineage)"&gt;\"report\" or \"lineage\" role is mandatory if scope.DQ_Scope.level = \'dataset\'.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST  6 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row09 - levelDescription needed unless dataset or series"&gt;
+		&lt;sch:rule context="//gmd:DQ_Scope"&gt;
+			&lt;sch:assert test="gmd:level/gmd:MD_ScopeCode/@codeListValue='dataset' or gmd:level/gmd:MD_ScopeCode/@codeListValue='series' or (gmd:levelDescription and ((normalize-space(gmd:levelDescription) != '') or (gmd:levelDescription/gmd:MD_ScopeDescription) or (gmd:levelDescription/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:levelDescription/@gco:nilReason))))"&gt;\"levelDescription\" is mandatory if \"level\" notEqual \'dataset\' or \'series\'.&lt;/sch:assert&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- anzlic/trunk/gml/3.2.0/gmd/distribution.xsd--&gt;
+	&lt;!-- TEST 14 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row17 - units required for density values"&gt;
+		&lt;sch:rule context="//gmd:MD_Medium"&gt;
+			&lt;sch:report test="gmd:density and not(gmd:densityUnits)"&gt;\"densityUnits\" is mandatory if \"density\" is provided.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST15 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row18 - MD_Format required"&gt;
+		&lt;sch:rule context="//gmd:MD_Distribution"&gt;
+			&lt;sch:assert test="count(gmd:distributionFormat)&gt;0 or count(gmd:distributor/gmd:MD_Distributor/gmd:distributorFormat)&gt;0"&gt;count (distributionFormat + distributor/MD_Distributor/distributorFormat) &gt; 0.&lt;/sch:assert&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- anzlic/trunk/gml/3.2.0/gmd/extent.xsd--&gt;
+	&lt;!-- TEST 20 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row23 - element required"&gt;
+		&lt;sch:rule context="//gmd:EX_Extent"&gt;
+			&lt;sch:assert test="count(gmd:description)&gt;0 or count(gmd:geographicElement)&gt;0 or count(gmd:temporalElement)&gt;0 or count(gmd:verticalElement)&gt;0"&gt;count(description + geographicElement + temporalElement + verticalElement) &amp;gt; 0.&lt;/sch:assert&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST  1 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row04 - dataset must have extent"&gt;
+		&lt;sch:rule context="//*[gmd:identificationInfo/gmd:MD_DataIdentification]"&gt;
+			&lt;sch:report test="(not(gmd:hierarchyLevel) or gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue='dataset') and (count(//gmd:MD_DataIdentification/gmd:extent/*/gmd:geographicElement/gmd:EX_GeographicBoundingBox) + count (//gmd:MD_DataIdentification/gmd:extent/*/gmd:geographicElement/gmd:EX_GeographicDescription)) =0 "&gt;MD_Metadata.hierarchyLevel = \"dataset\" (i.e. the default value of this property on the parent) implies count (extent.geographicElement.EX_GeographicBoundingBox) + count (extent.geographicElement.EX_GeographicDescription) &amp;gt;=1.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST  2 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row05 - dataset or series must have topicCategory"&gt;
+		&lt;sch:rule context="//gmd:MD_DataIdentification"&gt;
+			&lt;sch:report test="(not(../../gmd:hierarchyLevel) or (../../gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue='dataset') or (../../gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue='series')) and (not(gmd:topicCategory))"&gt; topicCategory is mandatory  if MD_Metadata.hierarchyLevel equal \"dataset\" or \"series\" or doesn\'t exist.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST  3 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row06 - either aggregateDataSetName or aggregateDataSetIdentifier must be documented"&gt;
+		&lt;sch:rule context="//gmd:MD_AggregateInformation"&gt;
+			&lt;sch:assert test="gmd:aggregateDataSetName or gmd:aggregateDataSetIdentifier"&gt;Either \"aggregateDataSetName\" or \"aggregateDataSetIdentifier\" must be documented.&lt;/sch:assert&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- anzlic/trunk/gml/3.2.0/gmd/metadataEntity.xsd: --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row01 - language indication"&gt;
+    &lt;!-- UNVERIFIED --&gt;
+    &lt;sch:rule context="//gmd:MD_Metadata|//*[@gco:isoType='gmd:MD_Metadata']"&gt;
+      &lt;sch:assert test="gmd:language and ((normalize-space(gmd:language) != '')  or (normalize-space(gmd:language/gco:CharacterString) != '') or (gmd:language/gmd:LanguageCode) or (gmd:language/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:language/@gco:nilReason)))"&gt;language not present.&lt;/sch:assert&gt;
+      &lt;!-- language: documented if not defined by the encoding standard. 
+					 It can't be documented by the encoding because GML doesn't 
+					 include xml:language. --&gt;
+    &lt;/sch:rule&gt;
+  &lt;/sch:pattern&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row02 - character set indication"&gt;
+    &lt;!-- UNVERIFIED --&gt;
+    &lt;sch:rule context="//gmd:MD_Metadata|//*[@gco:isoType='gmd:MD_Metadata']"&gt;
+      &lt;!-- characterSet: documented if ISO/IEC 10646 not used and not defined by
+        the encoding standard. Can't tell if XML declaration has an encoding
+        attribute. --&gt;
+    &lt;/sch:rule&gt;
+  &lt;/sch:pattern&gt;
+
+	&lt;!-- anzlic/trunk/gml/3.2.0/gmd/metadataExtension.xsd--&gt;
+	&lt;!-- TEST 16 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row19 - detail required unless simple term"&gt;
+		&lt;sch:rule context="//gmd:MD_ExtendedElementInformation"&gt;
+			&lt;sch:assert test="(gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelist' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='enumeration' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement') or (gmd:obligation and ((normalize-space(gmd:obligation) != '')  or (gmd:obligation/gmd:MD_ObligationCode) or (gmd:obligation/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:obligation/@gco:nilReason))))"&gt;if \"dataType\" notEqual \'codelist\', \'enumeration\' or \'codelistElement\' then \"obligation\" is mandatory.&lt;/sch:assert&gt;
+			&lt;sch:assert test="(gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelist' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='enumeration' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement') or (gmd:maximumOccurrence and ((normalize-space(gmd:maximumOccurrence) != '')  or (normalize-space(gmd:maximumOccurrence/gco:CharacterString) != '') or (gmd:maximumOccurrence/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:maximumOccurrence/@gco:nilReason))))"&gt;if \"dataType\" notEqual \'codelist\', \'enumeration\' or \'codelistElement\' then \"maximumOccurence\" is mandatory.&lt;/sch:assert&gt;
+			&lt;sch:assert test="(gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelist' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='enumeration' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement') or (gmd:domainValue and ((normalize-space(gmd:domainValue) != '')  or (normalize-space(gmd:domainValue/gco:CharacterString) != '') or (gmd:domainValue/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:domainValue/@gco:nilReason))))"&gt;if \"dataType\" notEqual \'codelist\', \'enumeration\' or \'codelistElement\' then \"domainValue\" is mandatory.&lt;/sch:assert&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST 17 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row20 - condition"&gt;
+		&lt;sch:rule context="//gmd:MD_ExtendedElementInformation"&gt;
+			&lt;sch:report test="gmd:obligation/gmd:MD_ObligationCode='conditional' and not(gmd:condition)"&gt;if \"obligation\" = \'conditional\' then \"condition\" is mandatory.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST 18 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row21 - domainCode"&gt;
+		&lt;sch:rule context="//gmd:MD_ExtendedElementInformation"&gt;
+			&lt;sch:report test="gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement' and not(gmd:domainCode)"&gt;if \"dataType\" = \'codelistElement\' then \"domainCode\" is mandatory.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- TEST 19 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row22 - shortName"&gt;
+		&lt;sch:rule context="//gmd:MD_ExtendedElementInformation"&gt;
+			&lt;sch:report test="gmd:dataType/gmd:MD_DatatypeCode/@codeListValue!='codelistElement' and not(gmd:shortName)"&gt;if \"dataType\" not equal to \'codelistElement\' then \"shortName\" is mandatory.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+	&lt;!-- anzlic/trunk/gml/3.2.0/gmd/spatialRepresentation.xsd--&gt;
+	&lt;!-- TEST 12 --&gt;
+	&lt;sch:pattern name="ISOFTDS19139:2005-TableA1-Row15 - checkPointDescription required if available"&gt;
+		&lt;sch:rule context="//gmd:MD_Georectified"&gt;
+			&lt;sch:report test="(gmd:checkPointAvailability/gco:Boolean='1' or gmd:checkPointAvailability/gco:Boolean='true') and not(gmd:checkPointDescription)"&gt;\"checkPointDescription\" is mandatory if \"checkPointAvailability\" = 1 or true.&lt;/sch:report&gt;
+		&lt;/sch:rule&gt;
+	&lt;/sch:pattern&gt;
+&lt;/sch:schema&gt;

Added: trunk/schematrons/allSchtrnRulesNone.sch
===================================================================
--- trunk/schematrons/allSchtrnRulesNone.sch	                        (rev 0)
+++ trunk/schematrons/allSchtrnRulesNone.sch	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,8 @@
+&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
+&lt;sch:schema xmlns:sch="<a href="http://www.ascc.net/xml/schematron" target="_new">http://www.ascc.net/xml/schematron</a>"&gt;
+&lt;!-- use this for metadata schemas that don't have schematrons defined 
+eg. dublin-core --&gt;
+	&lt;sch:title xmlns="<a href="http://www.w3.org/2001/XMLSchema"&gt;No" target="_new">http://www.w3.org/2001/XMLSchema"&gt;No</a> schematron rules defined&lt;/sch:title&gt;
+	&lt;sch:ns prefix="geonet" uri="<a href="http://www.fao.org/geonetwork"/" target="_new">http://www.fao.org/geonetwork"/</a>&gt;
+	&lt;sch:ns prefix="xlink" uri="<a href="http://www.w3.org/1999/xlink"/" target="_new">http://www.w3.org/1999/xlink"/</a>&gt;
+&lt;/sch:schema&gt;

Added: trunk/schematrons/saxon8-ant.jar
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxon8-ant.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/saxon8-dom.jar
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxon8-dom.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/saxon8-dom4j.jar
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxon8-dom4j.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/saxon8-jdom.jar
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxon8-jdom.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/saxon8-sql.jar
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxon8-sql.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/saxon8-xom.jar
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxon8-xom.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/saxon8-xpath.jar
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxon8-xpath.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/saxon8-xqj.jar
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxon8-xqj.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/saxon8.jar
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxon8.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/saxonb8-9j.zip
===================================================================
(Binary files differ)


Property changes on: trunk/schematrons/saxonb8-9j.zip
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/schematrons/schematron-basic.xsl
===================================================================
--- trunk/schematrons/schematron-basic.xsl	                        (rev 0)
+++ trunk/schematrons/schematron-basic.xsl	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,66 @@
+&lt;?xml version="1.0" ?&gt;
+&lt;!-- Basic metastylesheet for the Schematron XML Schema Language.
+	<a href="http://www.ascc.net/xml/resource/schematron/schematron.html" target="_new">http://www.ascc.net/xml/resource/schematron/schematron.html</a>
+
+ Copyright (c) 2000,2001 Rick Jelliffe and Academia Sinica Computing Center, Taiwan
+
+ This software is provided 'as-is', without any express or implied warranty. 
+ In no event will the authors be held liable for any damages arising from 
+ the use of this software.
+
+ Permission is granted to anyone to use this software for any purpose, 
+ including commercial applications, and to alter it and redistribute it freely,
+ subject to the following restrictions:
+
+ 1. The origin of this software must not be misrepresented; you must not claim
+ that you wrote the original software. If you use this software in a product, 
+ an acknowledgment in the product documentation would be appreciated but is 
+ not required.
+
+ 2. Altered source versions must be plainly marked as such, and must not be 
+ misrepresented as being the original software.
+
+ 3. This notice may not be removed or altered from any source distribution.
+--&gt;
+
+&lt;!-- Schematron basic --&gt;
+
+&lt;xsl:stylesheet
+   version="1.0"
+   xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
+   xmlns:axsl="<a href="http://www.w3.org/1999/XSL/TransformAlias" target="_new">http://www.w3.org/1999/XSL/TransformAlias</a>"&gt;
+
+&lt;xsl:import href="skeleton1-5.xsl"/&gt;
+
+&lt;xsl:template name="process-prolog"&gt;
+   &lt;axsl:output method="text" /&gt;
+&lt;/xsl:template&gt;
+
+&lt;xsl:template name="process-root"&gt;
+   &lt;xsl:param name="title" /&gt;
+   &lt;xsl:param name="contents" /&gt;
+   &lt;xsl:value-of select="$title" /&gt;
+   &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
+   &lt;xsl:copy-of select="$contents" /&gt;
+&lt;/xsl:template&gt;
+
+&lt;!-- use default rule for process-pattern: ignore name and see --&gt;
+&lt;!-- use default rule for process-name: output name --&gt;
+&lt;!-- use default rule for process-assert and process-report:
+     call process-message --&gt;
+
+&lt;xsl:template name="process-message"&gt;
+   &lt;xsl:param name="pattern" /&gt;
+   &lt;xsl:param name="role" /&gt;
+   &lt;xsl:text&gt;In pattern &lt;/xsl:text&gt;
+   &lt;xsl:value-of select="$pattern" /&gt;
+   &lt;xsl:if test="$role"&gt;
+      &lt;xsl:text&gt; (&lt;/xsl:text&gt;
+      &lt;xsl:value-of select="$role" /&gt;
+      &lt;xsl:text&gt;)&lt;/xsl:text&gt;
+   &lt;/xsl:if&gt;:
+   &lt;xsl:apply-templates mode="text" /&gt;
+   &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
+&lt;/xsl:template&gt;
+
+&lt;/xsl:stylesheet&gt;

Added: trunk/schematrons/schematron-frame.html
===================================================================
--- trunk/schematrons/schematron-frame.html	                        (rev 0)
+++ trunk/schematrons/schematron-frame.html	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,6 @@
+&lt;html&gt;
+&lt;FRAMESET rows="75%,25%"&gt;
+ &lt;FRAME src="schematron-errors.html" name="errors"&gt;
+ &lt;FRAME src="schematron-out.html" name="out"&gt;
+&lt;/FRAMESET&gt;
+&lt;/html&gt;

Added: trunk/schematrons/schematron-report-geonetwork-xml.xsl
===================================================================
--- trunk/schematrons/schematron-report-geonetwork-xml.xsl	                        (rev 0)
+++ trunk/schematrons/schematron-report-geonetwork-xml.xsl	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,104 @@
+&lt;?xml version="1.0" ?&gt;
+&lt;!-- Report Generator for the Schematron XML Schema Language.
+	<a href="http://www.ascc.net/xml/resource/schematron/schematron.html" target="_new">http://www.ascc.net/xml/resource/schematron/schematron.html</a>
+   
+ Copyright (c) 2000,2001 David Calisle, Oliver Becker,
+	 Rick Jelliffe and Academia Sinica Computing Center, Taiwan
+
+ This software is provided 'as-is', without any express or implied warranty. 
+ In no event will the authors be held liable for any damages arising from 
+ the use of this software.
+
+ Permission is granted to anyone to use this software for any purpose, 
+ including commercial applications, and to alter it and redistribute it freely,
+ subject to the following restrictions:
+
+ 1. The origin of this software must not be misrepresented; you must not claim
+ that you wrote the original software. If you use this software in a product, 
+ an acknowledgment in the product documentation would be appreciated but is 
+ not required.
+
+ 2. Altered source versions must be plainly marked as such, and must not be 
+ misrepresented as being the original software.
+
+ 3. This notice may not be removed or altered from any source distribution.
+
+    1999-10-25  Version for David Carlisle's schematron-report error browser
+    1999-11-5   Beta for 1.2 DTD
+    1999-12-26  Add code for namespace: thanks DC
+    1999-12-28  Version fix: thanks Uche Ogbuji
+    2000-03-27  Generate version: thanks Oliver Becker
+    2000-10-20  Fix '/' in do-all-patterns: thanks Uche Ogbuji
+    2001-02-15  Port to 1.5 code
+    2001-03-15  Diagnose test thanks Eddie Robertsson
+--&gt;
+
+&lt;!-- Schematron report --&gt;
+
+&lt;xsl:stylesheet
+   version="1.0"
+   xmlns:geonet="<a href="http://www.fao.org/geonetwork" target="_new">http://www.fao.org/geonetwork</a>"
+   xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
+   xmlns:axsl="<a href="http://www.w3.org/1999/XSL/TransformAlias" target="_new">http://www.w3.org/1999/XSL/TransformAlias</a>"&gt;
+
+&lt;xsl:import href="skeleton1-5.xsl"/&gt;
+&lt;xsl:param name="diagnose"&gt;yes&lt;/xsl:param&gt;     
+
+&lt;xsl:template name="process-prolog"&gt;
+   &lt;axsl:output method="xml" /&gt;
+&lt;/xsl:template&gt;
+
+&lt;xsl:template name="process-root"&gt;
+   &lt;xsl:param name="title" /&gt;
+   &lt;xsl:param name="icon" /&gt;
+   &lt;xsl:param name="contents" /&gt;
+&lt;geonet:schematronerrors&gt;
+&lt;xsl:copy-of select="$contents"/&gt;
+&lt;/geonet:schematronerrors&gt;
+&lt;/xsl:template&gt;
+
+&lt;xsl:template name="process-p"&gt;
+   &lt;xsl:param name="icon" /&gt;
+	 &lt;xsl:apply-templates mode="text"/&gt;
+&lt;/xsl:template&gt;
+
+&lt;xsl:template name="process-pattern"&gt;
+   &lt;xsl:param name="icon" /&gt;
+   &lt;xsl:param name="name" /&gt;
+   &lt;xsl:param name="see" /&gt;
+&lt;/xsl:template&gt;
+
+&lt;!-- use default rule for process-name: output name --&gt;
+
+&lt;xsl:template name="process-assert"&gt;
+   &lt;xsl:param name="role" /&gt;
+   &lt;xsl:param name="id" /&gt;
+   &lt;xsl:param name="test" /&gt;
+   &lt;xsl:param name="icon" /&gt;
+   &lt;xsl:param name="subject" /&gt;
+   &lt;xsl:param name="diagnostics" /&gt;
+   &lt;geonet:errorFound ref="#_{{geonet:element/@ref}}"&gt;
+	 	&lt;geonet:pattern name="{{name(.)}}"/&gt;
+		&lt;geonet:diagnostics&gt;
+	 		&lt;xsl:apply-templates mode="text"/&gt;
+		&lt;/geonet:diagnostics&gt;
+	&lt;/geonet:errorFound&gt;
+&lt;/xsl:template&gt;
+
+&lt;xsl:template name="process-report"&gt;
+   &lt;xsl:param name="role" /&gt;
+   &lt;xsl:param name="test" /&gt;
+   &lt;xsl:param name="icon" /&gt;
+   &lt;xsl:param name="id" /&gt;
+   &lt;xsl:param name="subject" /&gt;
+   &lt;xsl:param name="diagnostics" /&gt;
+   &lt;geonet:errorFound ref="#_{{geonet:element/@ref}}"&gt;
+	 	&lt;geonet:pattern name="{{name(.)}}"/&gt;
+		&lt;geonet:diagnostics&gt;
+	 		&lt;xsl:apply-templates mode="text"/&gt;
+		&lt;/geonet:diagnostics&gt;
+	&lt;/geonet:errorFound&gt;
+&lt;/xsl:template&gt;
+
+
+&lt;/xsl:stylesheet&gt;

Added: trunk/schematrons/schematron-report.xsl
===================================================================
--- trunk/schematrons/schematron-report.xsl	                        (rev 0)
+++ trunk/schematrons/schematron-report.xsl	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,176 @@
+&lt;?xml version="1.0" ?&gt;
+&lt;!-- Report Generator for the Schematron XML Schema Language.
+	<a href="http://www.ascc.net/xml/resource/schematron/schematron.html" target="_new">http://www.ascc.net/xml/resource/schematron/schematron.html</a>
+   
+ Copyright (c) 2000,2001 David Calisle, Oliver Becker,
+	 Rick Jelliffe and Academia Sinica Computing Center, Taiwan
+
+ This software is provided 'as-is', without any express or implied warranty. 
+ In no event will the authors be held liable for any damages arising from 
+ the use of this software.
+
+ Permission is granted to anyone to use this software for any purpose, 
+ including commercial applications, and to alter it and redistribute it freely,
+ subject to the following restrictions:
+
+ 1. The origin of this software must not be misrepresented; you must not claim
+ that you wrote the original software. If you use this software in a product, 
+ an acknowledgment in the product documentation would be appreciated but is 
+ not required.
+
+ 2. Altered source versions must be plainly marked as such, and must not be 
+ misrepresented as being the original software.
+
+ 3. This notice may not be removed or altered from any source distribution.
+
+    1999-10-25  Version for David Carlisle's schematron-report error browser
+    1999-11-5   Beta for 1.2 DTD
+    1999-12-26  Add code for namespace: thanks DC
+    1999-12-28  Version fix: thanks Uche Ogbuji
+    2000-03-27  Generate version: thanks Oliver Becker
+    2000-10-20  Fix '/' in do-all-patterns: thanks Uche Ogbuji
+    2001-02-15  Port to 1.5 code
+    2001-03-15  Diagnose test thanks Eddie Robertsson
+
+ALTERED by Simon Pigot to remove escaping of quotes necessary for javascript
+   alert display - see translate below
+
+--&gt;
+
+&lt;!-- Schematron report --&gt;
+
+&lt;xsl:stylesheet
+   version="1.0"
+   xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
+   xmlns:axsl="<a href="http://www.w3.org/1999/XSL/TransformAlias" target="_new">http://www.w3.org/1999/XSL/TransformAlias</a>"&gt;
+
+&lt;xsl:import href="skeleton1-5.xsl"/&gt;
+&lt;xsl:param name="diagnose"&gt;yes&lt;/xsl:param&gt;     
+
+&lt;xsl:template name="process-prolog"&gt;
+   &lt;axsl:output method="html" /&gt;
+&lt;/xsl:template&gt;
+
+&lt;xsl:template name="process-root"&gt;
+   &lt;xsl:param name="title" /&gt;
+   &lt;xsl:param name="icon" /&gt;
+   &lt;xsl:param name="contents" /&gt;
+   &lt;html&gt;
+      &lt;style&gt;
+         a:link    { color: black}
+         a:visited { color: gray}
+         a:active  { color: #FF0088}
+         h3        { background-color:black; color:white;
+                     font-family:Arial Black; font-size:12pt; }
+         h3.linked { background-color:black; color:white;
+                     font-family:Arial Black; font-size:12pt; }
+      &lt;/style&gt;
+      &lt;h2 title="Schematron contact-information is at the end of 
+                 this page"&gt;
+         &lt;xsl:if test="$icon"&gt;&lt;img src="{$icon}" /&gt;&lt;/xsl:if&gt;
+         &lt;font color="#FF0080" &gt;Schematron&lt;/font&gt; Report
+      &lt;/h2&gt;
+      &lt;h1 title="{@ns} {@fpi}"&gt;
+					&lt;!-- modified to remove javascript escapes --&gt;
+         &lt;xsl:value-of select="$title" /&gt;
+      &lt;/h1&gt;
+      &lt;div class="errors"&gt;
+         &lt;ul&gt;
+            &lt;xsl:copy-of select="$contents" /&gt;
+         &lt;/ul&gt;
+      &lt;/div&gt;
+      &lt;hr color="#FF0080" /&gt;
+      &lt;p&gt;&lt;font size="2"&gt;Schematron Report by David Carlisle.
+      &lt;a href="<a href="http://www.ascc.net/xml/resource/schematron/schematron.html" target="_new">http://www.ascc.net/xml/resource/schematron/schematron.html</a>"
+         title="Link to the home page of the Schematron, 
+                a tree-pattern schema language"&gt;
+         &lt;font color="#FF0080" &gt;The Schematron&lt;/font&gt;
+      &lt;/a&gt; by
+      &lt;a href="mailto:ricko@..."
+         title="Email to Rick Jelliffe (pronounced RIK JELIF)"
+      &gt;Rick Jelliffe&lt;/a&gt;,
+      &lt;a href="<a href="http://www.sinica.edu.tw" target="_new">http://www.sinica.edu.tw</a>"
+         title="Link to home page of Academia Sinica"
+      &gt;Academia Sinica Computing Centre&lt;/a&gt;.
+      &lt;/font&gt;&lt;/p&gt;
+   &lt;/html&gt;
+&lt;/xsl:template&gt;
+
+&lt;xsl:template name="process-p"&gt;
+   &lt;xsl:param name="icon" /&gt;
+&lt;p&gt;&lt;xsl:if test="$icon"&gt;&lt;img src="{$icon}" /&gt; &lt;/xsl:if
+&gt;&lt;xsl:apply-templates mode="text"/&gt;&lt;/p&gt;
+&lt;/xsl:template&gt;
+
+&lt;xsl:template name="process-pattern"&gt;
+   &lt;xsl:param name="icon" /&gt;
+   &lt;xsl:param name="name" /&gt;
+   &lt;xsl:param name="see" /&gt;
+   &lt;xsl:choose&gt;
+      &lt;xsl:when test="$see"&gt;
+         &lt;a href="{$see}" target="SRDOCO" 
+            title="Link to User Documentation:"&gt;
+            &lt;h3 class="linked"&gt;
+               &lt;xsl:value-of select="$name" /&gt;
+            &lt;/h3&gt;
+         &lt;/a&gt;
+      &lt;/xsl:when&gt;
+      &lt;xsl:otherwise&gt;
+         &lt;h3&gt;&lt;xsl:value-of select="$name" /&gt;&lt;/h3&gt;
+      &lt;/xsl:otherwise&gt;
+   &lt;/xsl:choose&gt;
+   &lt;xsl:if test="$icon"&gt;&lt;img src="{$icon}" /&gt; &lt;/xsl:if&gt;
+&lt;/xsl:template&gt;
+
+&lt;!-- use default rule for process-name: output name --&gt;
+
+&lt;xsl:template name="process-assert"&gt;
+   &lt;xsl:param name="role" /&gt;
+   &lt;xsl:param name="id" /&gt;
+   &lt;xsl:param name="test" /&gt;
+   &lt;xsl:param name="icon" /&gt;
+   &lt;xsl:param name="subject" /&gt;
+   &lt;xsl:param name="diagnostics" /&gt;
+   &lt;li&gt;
+   &lt;xsl:if test="$icon"&gt;&lt;img src="{$icon}" /&gt; &lt;/xsl:if&gt;
+      &lt;a href="schematron-out.html#{{generate-id(.)}}" target="out"
+         title="Link to where this pattern was expected"&gt;
+         &lt;i&gt;&lt;xsl:value-of select="$role"/&gt;&lt;/i&gt;
+				 &lt;xsl:variable name="textLink"&gt;
+         &lt;xsl:apply-templates mode="text"/&gt;
+				 &lt;/xsl:variable&gt;
+				 &lt;xsl:value-of select="translate($textLink,'\','')"/&gt;
+         &lt;xsl:if test="$diagnose = 'yes'"&gt;
+          &lt;b&gt;&lt;xsl:call-template name="diagnosticsSplit"&gt;
+               &lt;xsl:with-param name="str" select="$diagnostics" /&gt;
+           &lt;/xsl:call-template&gt;&lt;/b&gt;
+         &lt;/xsl:if&gt;
+      &lt;/a&gt;
+   &lt;/li&gt;                    
+&lt;/xsl:template&gt;
+
+&lt;xsl:template name="process-report"&gt;
+   &lt;xsl:param name="role" /&gt;
+   &lt;xsl:param name="test" /&gt;
+   &lt;xsl:param name="icon" /&gt;
+   &lt;xsl:param name="id" /&gt;
+   &lt;xsl:param name="subject" /&gt;
+   &lt;xsl:param name="diagnostics" /&gt;
+   &lt;li&gt;
+   &lt;xsl:if test="$icon"&gt;&lt;img src="{$icon}" /&gt; &lt;/xsl:if&gt;
+      &lt;a href="schematron-out.html#{{generate-id(.)}}" target="out"
+         title="Link to where this pattern was found"&gt;
+         &lt;i&gt;&lt;xsl:value-of select="$role"/&gt;&lt;/i&gt;
+				 &lt;xsl:variable name="textLink"&gt;
+         &lt;xsl:apply-templates mode="text"/&gt;
+				 &lt;/xsl:variable&gt;
+				 &lt;xsl:value-of select="translate($textLink,'\','')"/&gt;
+          &lt;b&gt;&lt;xsl:call-template name="diagnosticsSplit"&gt;
+               &lt;xsl:with-param name="str" select="$diagnostics" /&gt;
+           &lt;/xsl:call-template&gt;&lt;/b&gt;
+      &lt;/a&gt;
+   &lt;/li&gt;
+&lt;/xsl:template&gt;
+
+
+&lt;/xsl:stylesheet&gt;

Added: trunk/schematrons/schematron.xsl
===================================================================
--- trunk/schematrons/schematron.xsl	                        (rev 0)
+++ trunk/schematrons/schematron.xsl	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,485 @@
+&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
+&lt;xsl:stylesheet xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
+                xmlns:sch="<a href="http://www.ascc.net/xml/schematron" target="_new">http://www.ascc.net/xml/schematron</a>"
+                xmlns:gml="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>"
+                xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
+                xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"
+                xmlns:geonet="<a href="http://www.fao.org/geonetwork" target="_new">http://www.fao.org/geonetwork</a>"
+                xmlns:xlink="<a href="http://www.w3.org/1999/xlink" target="_new">http://www.w3.org/1999/xlink</a>"
+                version="1.0"
+                gml:dummy-for-xmlns=""
+                gmd:dummy-for-xmlns=""
+                gco:dummy-for-xmlns=""
+                geonet:dummy-for-xmlns=""
+                xlink:dummy-for-xmlns=""&gt;
+   &lt;xsl:output method="html"/&gt;
+   &lt;xsl:template match="*|@*" mode="schematron-get-full-path"&gt;
+      &lt;xsl:apply-templates select="parent::*" mode="schematron-get-full-path"/&gt;
+      &lt;xsl:text&gt;/&lt;/xsl:text&gt;
+      &lt;xsl:if test="count(. | ../@*) = count(../@*)"&gt;@&lt;/xsl:if&gt;
+      &lt;xsl:value-of select="name()"/&gt;
+      &lt;xsl:text&gt;[&lt;/xsl:text&gt;
+      &lt;xsl:value-of select="1+count(preceding-sibling::*[name()=name(current())])"/&gt;
+      &lt;xsl:text&gt;]&lt;/xsl:text&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="/"&gt;
+      &lt;html&gt;
+         &lt;style&gt;
+         a:link    { color: black}
+         a:visited { color: gray}
+         a:active  { color: #FF0088}
+         h3        { background-color:black; color:white;
+                     font-family:Arial Black; font-size:12pt; }
+         h3.linked { background-color:black; color:white;
+                     font-family:Arial Black; font-size:12pt; }
+      &lt;/style&gt;
+         &lt;h2 title="Schematron contact-information is at the end of                   this page"&gt;
+            &lt;font color="#FF0080"&gt;Schematron&lt;/font&gt; Report
+      &lt;/h2&gt;
+         &lt;h1 title=" "&gt;Schematron validation for ISO 19115(19139)&lt;/h1&gt;
+         &lt;div class="errors"&gt;
+            &lt;ul&gt;
+               &lt;h3&gt;CharacterString must have content or it's parent must have a valid nilReason attribute.&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M6"/&gt;
+               &lt;h3&gt;CRS attributes constraints&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M7"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row24 - name required&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M8"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row07 - otherConstraints required if otherRestrictions&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M9"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row16 - units required for values&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M10"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row13 - description required if no sourceExtent&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M11"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row14 - sourceExtent required if no description&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M12"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row10 - content mandatory for dataset or series&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M13"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row11 - source required if no statement or processStep&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M14"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row12 - processStep required if no statement or source&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M15"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row08 - dataset must have report or lineage&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M16"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row09 - levelDescription needed unless dataset or series&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M17"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row17 - units required for density values&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M18"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row18 - MD_Format required&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M19"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row23 - element required&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M20"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row04 - dataset must have extent&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M21"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row05 - dataset or series must have topicCategory&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M22"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row06 - either aggregateDataSetName or aggregateDataSetIdentifier must be documented&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M23"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row01 - language indication&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M24"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row02 - character set indication&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M25"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row19 - detail required unless simple term&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M26"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row20 - condition&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M27"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row21 - domainCode&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M28"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row22 - shortName&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M29"/&gt;
+               &lt;h3&gt;ISOFTDS19139:2005-TableA1-Row15 - checkPointDescription required if available&lt;/h3&gt;
+               &lt;xsl:apply-templates select="/" mode="M30"/&gt;
+            &lt;/ul&gt;
+         &lt;/div&gt;
+         &lt;hr color="#FF0080"/&gt;
+         &lt;p&gt;
+            &lt;font size="2"&gt;Schematron Report by David Carlisle.
+      &lt;a href="<a href="http://www.ascc.net/xml/resource/schematron/schematron.html" target="_new">http://www.ascc.net/xml/resource/schematron/schematron.html</a>"
+                  title="Link to the home page of the Schematron,                  a tree-pattern schema language"&gt;
+                  &lt;font color="#FF0080"&gt;The Schematron&lt;/font&gt;
+               &lt;/a&gt; by
+      &lt;a href="mailto:ricko@..."
+                  title="Email to Rick Jelliffe (pronounced RIK JELIF)"&gt;Rick Jelliffe&lt;/a&gt;,
+      &lt;a href="<a href="http://www.sinica.edu.tw" target="_new">http://www.sinica.edu.tw</a>" title="Link to home page of Academia Sinica"&gt;Academia Sinica Computing Centre&lt;/a&gt;.
+      &lt;/font&gt;
+         &lt;/p&gt;
+      &lt;/html&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="*[gco:CharacterString]" priority="4000" mode="M6"&gt;
+      &lt;xsl:if test="(normalize-space(gco:CharacterString) = '') and (not(@gco:nilReason) or not(contains('inapplicable missing template unknown withheld',@gco:nilReason)))"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;CharacterString must have content or parent's nilReason attribute must be legitimate.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M6"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M6"/&gt;
+   &lt;xsl:template match="//gml:DirectPositionType" priority="4000" mode="M7"&gt;
+      &lt;xsl:if test="not(@srsDimension) or @srsName"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;The presence of a dimension attribute implies the presence of the srsName attribute.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:if test="not(@axisLabels) or @srsName"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;The presence of an axisLabels attribute implies the presence of the srsName attribute.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:if test="not(@uomLabels) or @srsName"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;The presence of an uomLabels attribute implies the presence of the srsName attribute.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:if test="(not(@uomLabels) and not(@axisLabels)) or (@uomLabels and @axisLabels)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;The presence of an uomLabels attribute implies the presence of the axisLabels attribute and vice versa.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M7"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M7"/&gt;
+   &lt;xsl:template match="//gmd:CI_ResponsibleParty" priority="4000" mode="M8"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="(count(gmd:individualName) + count(gmd:organisationName) + count(gmd:positionName)) &amp;gt; 0"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;You must specify one or more of individualName, organisationName or positionName.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M8"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M8"/&gt;
+   &lt;xsl:template match="//gmd:MD_LegalConstraints" priority="4000" mode="M9"&gt;
+      &lt;xsl:if test="gmd:accessConstraints/gmd:MD_RestrictionCode/@codeListValue='otherRestrictions' and not(gmd:otherConstraints)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;otherConstraints: documented if accessConstraints or useConstraints = "otherRestrictions."&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:if test="gmd:useConstraints/gmd:MD_RestrictionCode/@codeListValue='otherRestrictions' and not(gmd:otherConstraints)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;otherConstraints: documented if accessConstraints or useConstraints = "otherRestrictions."&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M9"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M9"/&gt;
+   &lt;xsl:template match="//gmd:MD_Band" priority="4000" mode="M10"&gt;
+      &lt;xsl:if test="(gmd:maxValue or gmd:minValue) and not(gmd:units)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;"units" is mandatory if "maxValue" or "minValue" are provided.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M10"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M10"/&gt;
+   &lt;xsl:template match="//gmd:LI_Source" priority="4000" mode="M11"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:description or gmd:sourceExtent"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;"description" is mandatory if "sourceExtent" is not documented.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M11"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M11"/&gt;
+   &lt;xsl:template match="//gmd:LI_Source" priority="4000" mode="M12"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:description or gmd:sourceExtent"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;"description" is mandatory if "sourceExtent" is not documented.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M12"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M12"/&gt;
+   &lt;xsl:template match="//gmd:DQ_DataQuality" priority="4000" mode="M13"&gt;
+      &lt;xsl:if test="(((count(*/gmd:LI_Lineage/gmd:source) + count(*/gmd:LI_Lineage/gmd:processStep)) = 0) and (gmd:scope/gmd:DQ_Scope/gmd:level/gmd:MD_ScopeCode/@codeListValue='dataset' or gmd:scope/gmd:DQ_Scope/gmd:level/gmd:MD_ScopeCode/@codeListValue='series')) and not(gmd:lineage/gmd:LI_Lineage/gmd:statement) and (gmd:lineage)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;If(count(source) + count(processStep) =0) and (DQ_DataQuality.scope.level = 'dataset' or 'series') then statement is mandatory.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M13"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M13"/&gt;
+   &lt;xsl:template match="//gmd:LI_Lineage" priority="4000" mode="M14"&gt;
+      &lt;xsl:if test="not(gmd:source) and not(gmd:statement) and not(gmd:processStep)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;"source" role is mandatory if LI_Lineage.statement and "processStep" role are not documented.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M14"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M14"/&gt;
+   &lt;xsl:template match="//gmd:LI_Lineage" priority="4000" mode="M15"&gt;
+      &lt;xsl:if test="not(gmd:processStep) and not(gmd:statement) and not(gmd:source)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;"processStep" role is mandatory if LI_Lineage.statement and "source" role are not documented.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M15"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M15"/&gt;
+   &lt;xsl:template match="//gmd:DQ_DataQuality" priority="4000" mode="M16"&gt;
+      &lt;xsl:if test="gmd:scope/gmd:DQ_Scope/gmd:level/gmd:MD_ScopeCode/@codeListValue='dataset' and not(gmd:report) and not(gmd:lineage)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;"report" or "lineage" role is mandatory if scope.DQ_Scope.level = 'dataset'.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M16"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M16"/&gt;
+   &lt;xsl:template match="//gmd:DQ_Scope" priority="4000" mode="M17"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:level/gmd:MD_ScopeCode/@codeListValue='dataset' or gmd:level/gmd:MD_ScopeCode/@codeListValue='series' or (gmd:levelDescription and ((normalize-space(gmd:levelDescription) != '') or (gmd:levelDescription/gmd:MD_ScopeDescription) or (gmd:levelDescription/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:levelDescription/@gco:nilReason))))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;"levelDescription" is mandatory if "level" notEqual 'dataset' or 'series'.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M17"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M17"/&gt;
+   &lt;xsl:template match="//gmd:MD_Medium" priority="4000" mode="M18"&gt;
+      &lt;xsl:if test="gmd:density and not(gmd:densityUnits)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;"densityUnits" is mandatory if "density" is provided.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M18"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M18"/&gt;
+   &lt;xsl:template match="//gmd:MD_Distribution" priority="4000" mode="M19"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="count(gmd:distributionFormat)&amp;gt;0 or count(gmd:distributor/gmd:MD_Distributor/gmd:distributorFormat)&amp;gt;0"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;count (distributionFormat + distributor/MD_Distributor/distributorFormat) &amp;gt; 0.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M19"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M19"/&gt;
+   &lt;xsl:template match="//gmd:EX_Extent" priority="4000" mode="M20"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="count(gmd:description)&amp;gt;0 or count(gmd:geographicElement)&amp;gt;0 or count(gmd:temporalElement)&amp;gt;0 or count(gmd:verticalElement)&amp;gt;0"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;count(description + geographicElement + temporalElement + verticalElement) &amp;gt; 0.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M20"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M20"/&gt;
+   &lt;xsl:template match="//*[gmd:identificationInfo/gmd:MD_DataIdentification]" priority="4000"
+                 mode="M21"&gt;
+      &lt;xsl:if test="(not(gmd:hierarchyLevel) or gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue='dataset') and (count(//gmd:MD_DataIdentification/gmd:extent/*/gmd:geographicElement/gmd:EX_GeographicBoundingBox) + count (//gmd:MD_DataIdentification/gmd:extent/*/gmd:geographicElement/gmd:EX_GeographicDescription)) =0 "&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;MD_Metadata.hierarchyLevel = "dataset" (i.e. the default value of this property on the parent) implies count (extent.geographicElement.EX_GeographicBoundingBox) + count (extent.geographicElement.EX_GeographicDescription) &amp;gt;=1.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M21"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M21"/&gt;
+   &lt;xsl:template match="//gmd:MD_DataIdentification" priority="4000" mode="M22"&gt;
+      &lt;xsl:if test="(not(../../gmd:hierarchyLevel) or (../../gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue='dataset') or (../../gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue='series')) and (not(gmd:topicCategory))"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;topicCategory is mandatory if MD_Metadata.hierarchyLevel equal "dataset" or "series" or doesn't exist.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M22"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M22"/&gt;
+   &lt;xsl:template match="//gmd:MD_AggregateInformation" priority="4000" mode="M23"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:aggregateDataSetName or gmd:aggregateDataSetIdentifier"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;Either "aggregateDataSetName" or "aggregateDataSetIdentifier" must be documented.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M23"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M23"/&gt;
+   &lt;xsl:template match="//gmd:MD_Metadata|//*[@gco:isoType='gmd:MD_Metadata']" priority="4000"
+                 mode="M24"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:language and ((normalize-space(gmd:language) != '')  or (normalize-space(gmd:language/gco:CharacterString) != '') or (gmd:language/gmd:LanguageCode) or (gmd:language/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:language/@gco:nilReason)))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;language not present.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M24"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M24"/&gt;
+   &lt;xsl:template match="//gmd:MD_Metadata|//*[@gco:isoType='gmd:MD_Metadata']" priority="4000"
+                 mode="M25"&gt;
+      &lt;xsl:apply-templates mode="M25"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M25"/&gt;
+   &lt;xsl:template match="//gmd:MD_ExtendedElementInformation" priority="4000" mode="M26"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="(gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelist' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='enumeration' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement') or (gmd:obligation and ((normalize-space(gmd:obligation) != '')  or (gmd:obligation/gmd:MD_ObligationCode) or (gmd:obligation/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:obligation/@gco:nilReason))))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;if "dataType" notEqual 'codelist', 'enumeration' or 'codelistElement' then "obligation" is mandatory.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="(gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelist' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='enumeration' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement') or (gmd:maximumOccurrence and ((normalize-space(gmd:maximumOccurrence) != '')  or (normalize-space(gmd:maximumOccurrence/gco:CharacterString) != '') or (gmd:maximumOccurrence/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:maximumOccurrence/@gco:nilReason))))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;if "dataType" notEqual 'codelist', 'enumeration' or 'codelistElement' then "maximumOccurence" is mandatory.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="(gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelist' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='enumeration' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement') or (gmd:domainValue and ((normalize-space(gmd:domainValue) != '')  or (normalize-space(gmd:domainValue/gco:CharacterString) != '') or (gmd:domainValue/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:domainValue/@gco:nilReason))))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;li&gt;
+               &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+                  title="Link to where this pattern was expected"&gt;
+                  &lt;i/&gt;if "dataType" notEqual 'codelist', 'enumeration' or 'codelistElement' then "domainValue" is mandatory.&lt;b/&gt;
+               &lt;/a&gt;
+            &lt;/li&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M26"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M26"/&gt;
+   &lt;xsl:template match="//gmd:MD_ExtendedElementInformation" priority="4000" mode="M27"&gt;
+      &lt;xsl:if test="gmd:obligation/gmd:MD_ObligationCode='conditional' and not(gmd:condition)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;if "obligation" = 'conditional' then "condition" is mandatory.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M27"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M27"/&gt;
+   &lt;xsl:template match="//gmd:MD_ExtendedElementInformation" priority="4000" mode="M28"&gt;
+      &lt;xsl:if test="gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement' and not(gmd:domainCode)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;if "dataType" = 'codelistElement' then "domainCode" is mandatory.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M28"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M28"/&gt;
+   &lt;xsl:template match="//gmd:MD_ExtendedElementInformation" priority="4000" mode="M29"&gt;
+      &lt;xsl:if test="gmd:dataType/gmd:MD_DatatypeCode/@codeListValue!='codelistElement' and not(gmd:shortName)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;if "dataType" not equal to 'codelistElement' then "shortName" is mandatory.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M29"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M29"/&gt;
+   &lt;xsl:template match="//gmd:MD_Georectified" priority="4000" mode="M30"&gt;
+      &lt;xsl:if test="(gmd:checkPointAvailability/gco:Boolean='1' or gmd:checkPointAvailability/gco:Boolean='true') and not(gmd:checkPointDescription)"&gt;
+         &lt;li&gt;
+            &lt;a href="schematron-out.html#{generate-id(.)}" target="out"
+               title="Link to where this pattern was found"&gt;
+               &lt;i/&gt;"checkPointDescription" is mandatory if "checkPointAvailability" = 1 or true.&lt;b/&gt;
+            &lt;/a&gt;
+         &lt;/li&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M30"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M30"/&gt;
+   &lt;xsl:template match="text()" priority="-1"/&gt;
+&lt;/xsl:stylesheet&gt;
\ No newline at end of file

Added: trunk/schematrons/schematron_xml.xsl
===================================================================
--- trunk/schematrons/schematron_xml.xsl	                        (rev 0)
+++ trunk/schematrons/schematron_xml.xsl	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,371 @@
+&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
+&lt;xsl:stylesheet xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
+                xmlns:sch="<a href="http://www.ascc.net/xml/schematron" target="_new">http://www.ascc.net/xml/schematron</a>"
+                xmlns:gml="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>"
+                xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
+                xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"
+                xmlns:geonet="<a href="http://www.fao.org/geonetwork" target="_new">http://www.fao.org/geonetwork</a>"
+                xmlns:xlink="<a href="http://www.w3.org/1999/xlink" target="_new">http://www.w3.org/1999/xlink</a>"
+                version="1.0"
+                gml:dummy-for-xmlns=""
+                gmd:dummy-for-xmlns=""
+                gco:dummy-for-xmlns=""
+                geonet:dummy-for-xmlns=""
+                xlink:dummy-for-xmlns=""&gt;
+   &lt;xsl:output method="xml"/&gt;
+   &lt;xsl:template match="*|@*" mode="schematron-get-full-path"&gt;
+      &lt;xsl:apply-templates select="parent::*" mode="schematron-get-full-path"/&gt;
+      &lt;xsl:text&gt;/&lt;/xsl:text&gt;
+      &lt;xsl:if test="count(. | ../@*) = count(../@*)"&gt;@&lt;/xsl:if&gt;
+      &lt;xsl:value-of select="name()"/&gt;
+      &lt;xsl:text&gt;[&lt;/xsl:text&gt;
+      &lt;xsl:value-of select="1+count(preceding-sibling::*[name()=name(current())])"/&gt;
+      &lt;xsl:text&gt;]&lt;/xsl:text&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="/"&gt;
+      &lt;geonet:schematronerrors&gt;
+         &lt;xsl:apply-templates select="/" mode="M6"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M7"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M8"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M9"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M10"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M11"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M12"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M13"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M14"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M15"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M16"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M17"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M18"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M19"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M20"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M21"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M22"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M23"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M24"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M25"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M26"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M27"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M28"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M29"/&gt;
+         &lt;xsl:apply-templates select="/" mode="M30"/&gt;
+      &lt;/geonet:schematronerrors&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="*[gco:CharacterString]" priority="4000" mode="M6"&gt;
+      &lt;xsl:if test="(normalize-space(gco:CharacterString) = '') and (not(@gco:nilReason) or not(contains('inapplicable missing template unknown withheld',@gco:nilReason)))"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;CharacterString must have content or parent\'s nilReason attribute must be legitimate.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M6"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M6"/&gt;
+   &lt;xsl:template match="//gml:DirectPositionType" priority="4000" mode="M7"&gt;
+      &lt;xsl:if test="not(@srsDimension) or @srsName"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;The presence of a dimension attribute implies the presence of the srsName attribute.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:if test="not(@axisLabels) or @srsName"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;The presence of an axisLabels attribute implies the presence of the srsName attribute.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:if test="not(@uomLabels) or @srsName"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;The presence of an uomLabels attribute implies the presence of the srsName attribute.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:if test="(not(@uomLabels) and not(@axisLabels)) or (@uomLabels and @axisLabels)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;The presence of an uomLabels attribute implies the presence of the axisLabels attribute and vice versa.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M7"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M7"/&gt;
+   &lt;xsl:template match="//gmd:CI_ResponsibleParty" priority="4000" mode="M8"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="(count(gmd:individualName) + count(gmd:organisationName) + count(gmd:positionName)) &amp;gt; 0"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;You must specify one or more of individualName, organisationName or positionName.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M8"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M8"/&gt;
+   &lt;xsl:template match="//gmd:MD_LegalConstraints" priority="4000" mode="M9"&gt;
+      &lt;xsl:if test="gmd:accessConstraints/gmd:MD_RestrictionCode/@codeListValue='otherRestrictions' and not(gmd:otherConstraints)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;otherConstraints: documented if accessConstraints or useConstraints = \"otherRestrictions\."&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:if test="gmd:useConstraints/gmd:MD_RestrictionCode/@codeListValue='otherRestrictions' and not(gmd:otherConstraints)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;otherConstraints: documented if accessConstraints or useConstraints = \"otherRestrictions\."&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M9"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M9"/&gt;
+   &lt;xsl:template match="//gmd:MD_Band" priority="4000" mode="M10"&gt;
+      &lt;xsl:if test="(gmd:maxValue or gmd:minValue) and not(gmd:units)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;\"units\" is mandatory if \"maxValue\" or \"minValue\" are provided.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M10"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M10"/&gt;
+   &lt;xsl:template match="//gmd:LI_Source" priority="4000" mode="M11"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:description or gmd:sourceExtent"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;\"description\" is mandatory if \"sourceExtent\" is not documented.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M11"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M11"/&gt;
+   &lt;xsl:template match="//gmd:LI_Source" priority="4000" mode="M12"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:description or gmd:sourceExtent"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;\"description\" is mandatory if \"sourceExtent\" is not documented.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M12"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M12"/&gt;
+   &lt;xsl:template match="//gmd:DQ_DataQuality" priority="4000" mode="M13"&gt;
+      &lt;xsl:if test="(((count(*/gmd:LI_Lineage/gmd:source) + count(*/gmd:LI_Lineage/gmd:processStep)) = 0) and (gmd:scope/gmd:DQ_Scope/gmd:level/gmd:MD_ScopeCode/@codeListValue='dataset' or gmd:scope/gmd:DQ_Scope/gmd:level/gmd:MD_ScopeCode/@codeListValue='series')) and not(gmd:lineage/gmd:LI_Lineage/gmd:statement) and (gmd:lineage)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;If(count(source) + count(processStep) =0) and (DQ_DataQuality.scope.level = \'dataset\' or \'series\') then statement is mandatory.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M13"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M13"/&gt;
+   &lt;xsl:template match="//gmd:LI_Lineage" priority="4000" mode="M14"&gt;
+      &lt;xsl:if test="not(gmd:source) and not(gmd:statement) and not(gmd:processStep)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;\"source\" role is mandatory if LI_Lineage.statement and \"processStep\" role are not documented.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M14"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M14"/&gt;
+   &lt;xsl:template match="//gmd:LI_Lineage" priority="4000" mode="M15"&gt;
+      &lt;xsl:if test="not(gmd:processStep) and not(gmd:statement) and not(gmd:source)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;\"processStep\" role is mandatory if LI_Lineage.statement and \"source\" role are not documented.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M15"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M15"/&gt;
+   &lt;xsl:template match="//gmd:DQ_DataQuality" priority="4000" mode="M16"&gt;
+      &lt;xsl:if test="gmd:scope/gmd:DQ_Scope/gmd:level/gmd:MD_ScopeCode/@codeListValue='dataset' and not(gmd:report) and not(gmd:lineage)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;\"report\" or \"lineage\" role is mandatory if scope.DQ_Scope.level = \'dataset\'.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M16"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M16"/&gt;
+   &lt;xsl:template match="//gmd:DQ_Scope" priority="4000" mode="M17"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:level/gmd:MD_ScopeCode/@codeListValue='dataset' or gmd:level/gmd:MD_ScopeCode/@codeListValue='series' or (gmd:levelDescription and ((normalize-space(gmd:levelDescription) != '') or (gmd:levelDescription/gmd:MD_ScopeDescription) or (gmd:levelDescription/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:levelDescription/@gco:nilReason))))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;\"levelDescription\" is mandatory if \"level\" notEqual \'dataset\' or \'series\'.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M17"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M17"/&gt;
+   &lt;xsl:template match="//gmd:MD_Medium" priority="4000" mode="M18"&gt;
+      &lt;xsl:if test="gmd:density and not(gmd:densityUnits)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;\"densityUnits\" is mandatory if \"density\" is provided.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M18"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M18"/&gt;
+   &lt;xsl:template match="//gmd:MD_Distribution" priority="4000" mode="M19"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="count(gmd:distributionFormat)&amp;gt;0 or count(gmd:distributor/gmd:MD_Distributor/gmd:distributorFormat)&amp;gt;0"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;count (distributionFormat + distributor/MD_Distributor/distributorFormat) &amp;gt; 0.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M19"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M19"/&gt;
+   &lt;xsl:template match="//gmd:EX_Extent" priority="4000" mode="M20"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="count(gmd:description)&amp;gt;0 or count(gmd:geographicElement)&amp;gt;0 or count(gmd:temporalElement)&amp;gt;0 or count(gmd:verticalElement)&amp;gt;0"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;count(description + geographicElement + temporalElement + verticalElement) &amp;gt; 0.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M20"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M20"/&gt;
+   &lt;xsl:template match="//*[gmd:identificationInfo/gmd:MD_DataIdentification]" priority="4000"
+                 mode="M21"&gt;
+      &lt;xsl:if test="(not(gmd:hierarchyLevel) or gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue='dataset') and (count(//gmd:MD_DataIdentification/gmd:extent/*/gmd:geographicElement/gmd:EX_GeographicBoundingBox) + count (//gmd:MD_DataIdentification/gmd:extent/*/gmd:geographicElement/gmd:EX_GeographicDescription)) =0 "&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;MD_Metadata.hierarchyLevel = \"dataset\" (i.e. the default value of this property on the parent) implies count (extent.geographicElement.EX_GeographicBoundingBox) + count (extent.geographicElement.EX_GeographicDescription) &amp;gt;=1.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M21"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M21"/&gt;
+   &lt;xsl:template match="//gmd:MD_DataIdentification" priority="4000" mode="M22"&gt;
+      &lt;xsl:if test="(not(../../gmd:hierarchyLevel) or (../../gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue='dataset') or (../../gmd:hierarchyLevel/gmd:MD_ScopeCode/@codeListValue='series')) and (not(gmd:topicCategory))"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;topicCategory is mandatory if MD_Metadata.hierarchyLevel equal \"dataset\" or \"series\" or doesn\'t exist.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M22"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M22"/&gt;
+   &lt;xsl:template match="//gmd:MD_AggregateInformation" priority="4000" mode="M23"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:aggregateDataSetName or gmd:aggregateDataSetIdentifier"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;Either \"aggregateDataSetName\" or \"aggregateDataSetIdentifier\" must be documented.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M23"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M23"/&gt;
+   &lt;xsl:template match="//gmd:MD_Metadata|//*[@gco:isoType='gmd:MD_Metadata']" priority="4000"
+                 mode="M24"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="gmd:language and ((normalize-space(gmd:language) != '')  or (normalize-space(gmd:language/gco:CharacterString) != '') or (gmd:language/gmd:LanguageCode) or (gmd:language/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:language/@gco:nilReason)))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;language not present.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M24"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M24"/&gt;
+   &lt;xsl:template match="//gmd:MD_Metadata|//*[@gco:isoType='gmd:MD_Metadata']" priority="4000"
+                 mode="M25"&gt;
+      &lt;xsl:apply-templates mode="M25"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M25"/&gt;
+   &lt;xsl:template match="//gmd:MD_ExtendedElementInformation" priority="4000" mode="M26"&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="(gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelist' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='enumeration' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement') or (gmd:obligation and ((normalize-space(gmd:obligation) != '')  or (gmd:obligation/gmd:MD_ObligationCode) or (gmd:obligation/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:obligation/@gco:nilReason))))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;if \"dataType\" notEqual \'codelist\', \'enumeration\' or \'codelistElement\' then \"obligation\" is mandatory.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="(gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelist' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='enumeration' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement') or (gmd:maximumOccurrence and ((normalize-space(gmd:maximumOccurrence) != '')  or (normalize-space(gmd:maximumOccurrence/gco:CharacterString) != '') or (gmd:maximumOccurrence/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:maximumOccurrence/@gco:nilReason))))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;if \"dataType\" notEqual \'codelist\', \'enumeration\' or \'codelistElement\' then \"maximumOccurence\" is mandatory.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:choose&gt;
+         &lt;xsl:when test="(gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelist' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='enumeration' or gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement') or (gmd:domainValue and ((normalize-space(gmd:domainValue) != '')  or (normalize-space(gmd:domainValue/gco:CharacterString) != '') or (gmd:domainValue/@gco:nilReason and contains('inapplicable missing template unknown withheld',gmd:domainValue/@gco:nilReason))))"/&gt;
+         &lt;xsl:otherwise&gt;
+            &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+               &lt;geonet:pattern name="{name(.)}"/&gt;
+               &lt;geonet:diagnostics&gt;if \"dataType\" notEqual \'codelist\', \'enumeration\' or \'codelistElement\' then \"domainValue\" is mandatory.&lt;/geonet:diagnostics&gt;
+            &lt;/geonet:errorFound&gt;
+         &lt;/xsl:otherwise&gt;
+      &lt;/xsl:choose&gt;
+      &lt;xsl:apply-templates mode="M26"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M26"/&gt;
+   &lt;xsl:template match="//gmd:MD_ExtendedElementInformation" priority="4000" mode="M27"&gt;
+      &lt;xsl:if test="gmd:obligation/gmd:MD_ObligationCode='conditional' and not(gmd:condition)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;if \"obligation\" = \'conditional\' then \"condition\" is mandatory.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M27"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M27"/&gt;
+   &lt;xsl:template match="//gmd:MD_ExtendedElementInformation" priority="4000" mode="M28"&gt;
+      &lt;xsl:if test="gmd:dataType/gmd:MD_DatatypeCode/@codeListValue='codelistElement' and not(gmd:domainCode)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;if \"dataType\" = \'codelistElement\' then \"domainCode\" is mandatory.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M28"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M28"/&gt;
+   &lt;xsl:template match="//gmd:MD_ExtendedElementInformation" priority="4000" mode="M29"&gt;
+      &lt;xsl:if test="gmd:dataType/gmd:MD_DatatypeCode/@codeListValue!='codelistElement' and not(gmd:shortName)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;if \"dataType\" not equal to \'codelistElement\' then \"shortName\" is mandatory.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M29"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M29"/&gt;
+   &lt;xsl:template match="//gmd:MD_Georectified" priority="4000" mode="M30"&gt;
+      &lt;xsl:if test="(gmd:checkPointAvailability/gco:Boolean='1' or gmd:checkPointAvailability/gco:Boolean='true') and not(gmd:checkPointDescription)"&gt;
+         &lt;geonet:errorFound ref="#_{geonet:element/@ref}"&gt;
+            &lt;geonet:pattern name="{name(.)}"/&gt;
+            &lt;geonet:diagnostics&gt;\"checkPointDescription\" is mandatory if \"checkPointAvailability\" = 1 or true.&lt;/geonet:diagnostics&gt;
+         &lt;/geonet:errorFound&gt;
+      &lt;/xsl:if&gt;
+      &lt;xsl:apply-templates mode="M30"/&gt;
+   &lt;/xsl:template&gt;
+   &lt;xsl:template match="text()" priority="-1" mode="M30"/&gt;
+   &lt;xsl:template match="text()" priority="-1"/&gt;
+&lt;/xsl:stylesheet&gt;
\ No newline at end of file

Added: trunk/schematrons/skeleton1-5.xsl
===================================================================
--- trunk/schematrons/skeleton1-5.xsl	                        (rev 0)
+++ trunk/schematrons/skeleton1-5.xsl	2008-01-08 19:37:56 UTC (rev 996)
@@ -0,0 +1,556 @@
+&lt;?xml version="1.0"?&gt;
+&lt;!-- Beta Skeleton Module for the Schematron 1.5 XML Schema Language.
+	<a href="http://www.ascc.net/xml/schematron/" target="_new">http://www.ascc.net/xml/schematron/</a>
+ 
+ Copyright (c) 2000,2001 Rick Jelliffe and Academia Sinica Computing Center, Taiwan
+
+ This software is provided 'as-is', without any express or implied warranty. 
+ In no event will the authors be held liable for any damages arising from 
+ the use of this software.
+
+ Permission is granted to anyone to use this software for any purpose, 
+ including commercial applications, and to alter it and redistribute it freely,
+ subject to the following restrictions:
+
+ 1. The origin of this software must not be misrepresented; you must not claim
+ that you wrote the original software. If you use this software in a product, 
+ an acknowledgment in the product documentation would be appreciated but is 
+ not required.
+
+ 2. Altered source versions must be plainly marked as such, and must not be 
+ misrepresented as being the original software.
+
+ 3. This notice may not be removed or altered from any source distribution.
+--&gt;
+&lt;!-- 
+    Version: 2001-06-12
+           * same skeleton now supports namespace or no namespace
+           * parameters to handlers updated for all 1.5 attributes 
+           * diagnostic hints supported: command-line option diagnose=yes|no
+           * phases supported: command-line option phase=#ALL|...
+           * abstract rules
+           * compile-time error messages
+           * 1.6 feature: @match on sch:key  
+          
+    Contributors: Rick Jelliffe (original), Oliver Becker (architecture), 
+             Miloslav Nic (diagnostic, phase, options), Ludwig Svenonius (abstract)
+             Uche Ogbuji (misc. bug fixes), Jim Ancona (SAXON workaround),
+             Eddie Robertsson (misc. bug fixes)
+
+    XSLT versions tested and working as-is: 
+           * MS XML 3
+           * Oracle 
+           * SAXON + Instant Saxon  
+           * XT n.b. key() not available, will die
+
+   XSLT version reliably reported working
+           *  FourThought's Python implementation
+
+    XSLT versions tested and requires small workaround from you
+           * Sablotron does not support import, so merge meta-stylesheets by hand
+           * Xalan for Java 2.0 outputs wrong namespace URI, so alter by hand or script
+           * Xalan for C 1.0 has problem with key, so edit by hand. Find "KEY" below  
+
+   If you create your own meta-stylesheet to override this one, it is a
+   good idea to have both in the same directory and to run the stylesheet
+   from that directory, as many XSLT implementations have ideosyncratic
+   handling of URLs: keep it simple.
+         
+--&gt;
+&lt;xsl:stylesheet version="1.0" 
+	xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>" 
+	xmlns:axsl="<a href="http://www.w3.org/1999/XSL/TransformAlias" target="_new">http://www.w3.org/1999/XSL/TransformAlias</a>" 
+	xmlns:sch="<a href="http://www.ascc.net/xml/schematron" target="_new">http://www.ascc.net/xml/schematron</a>"
+	 &gt;
+&lt;!-- Note that this namespace is not version specific.
+This program implements schematron 1.5 with some 1.6 extensions --&gt;
+&lt;xsl:namespace-alias stylesheet-prefix="axsl" result-prefix="xsl"/&gt;
+&lt;!-- Category: top-level-element --&gt;
+&lt;xsl:output method="xml" omit-xml-declaration="no" standalone="yes"  indent="yes"/&gt;
+&lt;xsl:param name="block"&gt;&lt;/xsl:param&gt;&lt;!-- reserved --&gt;
+&lt;xsl:param name="phase"&gt;
+  &lt;xsl:choose&gt;
+    &lt;xsl:when test="//sch:schema/@defaultPhase"&gt;
+      &lt;xsl:value-of select="//sch:schema/@defaultPhase"/&gt;
+    &lt;/xsl:when&gt;
+    &lt;xsl:otherwise&gt;#ALL&lt;/xsl:otherwise&gt;
+  &lt;/xsl:choose&gt;
+&lt;/xsl:param&gt;
+&lt;xsl:param name="hiddenKey"&gt; key &lt;/xsl:param&gt;&lt;!-- workaround for Xalan4J 2.0 --&gt;
+
+&lt;!-- SCHEMA --&gt;
+&lt;xsl:template match="sch:schema | schema"&gt;
+	&lt;axsl:stylesheet version="1.0"&gt;
+		&lt;xsl:for-each select="sch:ns | ns"&gt;
+			&lt;xsl:attribute name="{concat(@prefix,':dummy-for-xmlns')}" namespace="{@uri}"/&gt;
+		&lt;/xsl:for-each&gt;
+ 
+		&lt;xsl:if test="count(sch:title/* | title/* )"&gt;
+			&lt;xsl:message&gt;
+				&lt;xsl:text&gt;Warning: &lt;/xsl:text&gt;
+				&lt;xsl:value-of select="name(.)"/&gt;
+				&lt;xsl:text&gt; must not contain any child elements&lt;/xsl:text&gt;
+			&lt;/xsl:message&gt;
+		&lt;/xsl:if&gt;
+ 
+		&lt;xsl:call-template name="process-prolog"/&gt;
+		&lt;!-- utility routine for implementations --&gt;
+   		&lt;axsl:template match="*|@*" mode="schematron-get-full-path"&gt;
+
+			&lt;axsl:apply-templates select="parent::*" mode="schematron-get-full-path"/&gt;
+			&lt;axsl:text&gt;/&lt;/axsl:text&gt;
+			&lt;axsl:if test="count(. | ../@*) = count(../@*)"&gt;@&lt;/axsl:if&gt;
+			&lt;axsl:value-of select="name()"/&gt;
+			&lt;axsl:text&gt;[&lt;/axsl:text&gt;
+	  		&lt;axsl:value-of select="1+count(preceding-sibling::*[name()=name(current())])"/&gt;
+	  		&lt;axsl:text&gt;]&lt;/axsl:text&gt;
+       	 	&lt;/axsl:template&gt;
+
+		&lt;xsl:apply-templates mode="do-keys" 
+                select="sch:pattern/sch:rule/sch:key | pattern/rule/key | sch:key | key "/&gt;
+
+
+		&lt;axsl:template match="/"&gt;
+			&lt;xsl:call-template name="process-root"&gt;
+				&lt;xsl:with-param name="fpi" select="@fpi"/&gt;
+				&lt;xsl:with-param 	xmlns:sch="<a href="http://www.ascc.net/xml/schematron" target="_new">http://www.ascc.net/xml/schematron</a>"
+				name="title" select="./sch:title | title"/&gt;
+				&lt;xsl:with-param name="id" select="@id"/&gt;
+				&lt;xsl:with-param name="icon" select="@icon"/&gt;
+				&lt;xsl:with-param name="lang" select="@xml:lang"/&gt;
+				&lt;xsl:with-param name="version" select="@version" /&gt;
+				&lt;xsl:with-param name="schemaVersion" select="@schemaVersion" /&gt;
+				&lt;xsl:with-param name="contents"&gt;
+					&lt;xsl:apply-templates mode="do-all-patterns"/&gt;
+				&lt;/xsl:with-param&gt;
+			&lt;/xsl:call-template&gt;
+		&lt;/axsl:template&gt;
+ 
+		&lt;xsl:apply-templates/&gt;
+		&lt;axsl:template match="text()" priority="-1"&gt;
+			&lt;!-- strip characters --&gt;
+		&lt;/axsl:template&gt;
+	&lt;/axsl:stylesheet&gt;
+&lt;/xsl:template&gt;
+
+	&lt;!-- ACTIVE --&gt;
+	&lt;xsl:template match="sch:active | active"&gt;
+                &lt;xsl:if test="not(@pattern)"&gt;
+                    &lt;xsl:message&gt;Markup Error: no pattern attribute in &amp;lt;active&gt;&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+                &lt;xsl:if test="//sch:rule[@id= current()/@pattern]"&gt;
+                    &lt;xsl:message&gt;Reference Error: the pattern  "&lt;xsl:value-of select="@pattern"/&gt;" has been activated but is not declared&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+        &lt;/xsl:template&gt;
+
+	&lt;!-- ASSERT and REPORT --&gt;
+	&lt;xsl:template match="sch:assert | assert"&gt;
+                &lt;xsl:if test="not(@test)"&gt;
+                    &lt;xsl:message&gt;Markup Error: no test attribute in &amp;lt;assert&gt;&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+		&lt;axsl:choose&gt;
+			&lt;axsl:when test="{@test}"/&gt;
+			&lt;axsl:otherwise&gt;
+				&lt;xsl:call-template name="process-assert"&gt;
+					&lt;xsl:with-param name="role" select="@role"/&gt;
+					&lt;xsl:with-param name="id" select="@id"/&gt;
+					&lt;xsl:with-param name="test" select="normalize-space(@test)" /&gt;
+					&lt;xsl:with-param name="icon" select="@icon"/&gt;
+					&lt;xsl:with-param name="subject" select="@subject"/&gt;
+					&lt;xsl:with-param name="diagnostics" select="@diagnostics"/&gt;
+				&lt;/xsl:call-template&gt;  
+			&lt;/axsl:otherwise&gt;
+		&lt;/axsl:choose&gt;
+	&lt;/xsl:template&gt;
+	&lt;xsl:template match="sch:report | report"&gt;
+                &lt;xsl:if test="not(@test)"&gt;
+                    &lt;xsl:message&gt;Markup Error: no test attribute in &amp;lt;report&gt;&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+		&lt;axsl:if test="{@test}"&gt;
+			&lt;xsl:call-template name="process-report"&gt;
+				&lt;xsl:with-param name="role" select="@role"/&gt;
+				&lt;xsl:with-param name="test" select="normalize-space(@test)" /&gt;
+				&lt;xsl:with-param name="icon" select="@icon"/&gt;
+				&lt;xsl:with-param name="id" select="@id"/&gt;
+				&lt;xsl:with-param name="subject" select="@subject"/&gt;
+				&lt;xsl:with-param name="diagnostics" select="@diagnostics"/&gt;
+			&lt;/xsl:call-template&gt;
+		&lt;/axsl:if&gt;
+	&lt;/xsl:template&gt;
+
+
+	&lt;!-- DIAGNOSTIC --&gt;
+	&lt;xsl:template match="sch:diagnostic | diagnostic"
+              &gt;&lt;xsl:if test="not(@id)"
+                    &gt;&lt;xsl:message&gt;Markup Error: no id attribute in &amp;lt;diagnostic&gt;&lt;/xsl:message
+                &gt;&lt;/xsl:if&gt;&lt;xsl:call-template name="process-diagnostic"&gt;
+                &lt;xsl:with-param name="id" select="@id" /&gt;
+               &lt;/xsl:call-template&gt;
+        &lt;/xsl:template&gt;
+
+	&lt;!-- DIAGNOSTICS --&gt;
+	&lt;xsl:template match="sch:diagnostics | diagnostics"/&gt;
+
+	&lt;!-- DIR --&gt;
+	&lt;xsl:template match="sch:dir | dir"  mode="text"
+		&gt;&lt;xsl:call-template name="process-dir"&gt;
+			&lt;xsl:with-param name="value" select="@value"/&gt;
+		&lt;/xsl:call-template&gt;
+	&lt;/xsl:template&gt;
+
+	&lt;!-- EMPH --&gt;
+	&lt;xsl:template match="sch:emph | emph"  mode="text"
+		&gt;&lt;xsl:call-template name="process-emph"/&gt;
+	&lt;/xsl:template&gt;
+
+	&lt;!-- EXTENDS --&gt;
+	&lt;xsl:template match="sch:extends | extends"&gt;
+		&lt;xsl:if test="not(@rule)"
+                    &gt;&lt;xsl:message&gt;Markup Error: no rule attribute in &amp;lt;extends&gt;&lt;/xsl:message
+                &gt;&lt;/xsl:if&gt;
+     		&lt;xsl:if test="not(//sch:rule[@abstract='true'][@id= current()/@rule] )
+                    and not(//rule[@abstract='true'][@id= current()/@rule])"&gt;
+                    &lt;xsl:message&gt;Reference Error: the abstract rule  "&lt;xsl:value-of select="@rule"/&gt;" has been referenced but is not declared&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+	        &lt;xsl:call-template name="IamEmpty" /&gt;
+
+  		&lt;xsl:if test="//sch:rule[@id=current()/@rule]"&gt;
+    			&lt;xsl:apply-templates select="//sch:rule[@id=current()/@rule]"
+				mode="extends"/&gt;
+  		&lt;/xsl:if&gt;
+
+	&lt;/xsl:template&gt;
+
+	&lt;!-- KEY --&gt;
+	&lt;!-- do we need something to test uniqueness too? --&gt; 
+	&lt;!-- NOTE: if you get complaint about "key" here (e.g. Xalan4C 1.0) replace
+		"key" with "$hiddenKey" --&gt;
+	&lt;xsl:template  match="sch:key | key " mode="do-keys" &gt;
+                &lt;xsl:if test="not(@name)"&gt;
+                    &lt;xsl:message&gt;Markup Error: no name attribute in &amp;lt;key&gt;&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+               &lt;xsl:if test="not(@match) and not(../sch:rule)"&gt;
+                    &lt;xsl:message&gt;Markup Error:  no match attribute on &amp;lt;key&gt; outside &amp;lt;rule&gt;&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+                &lt;xsl:if test="not(@path)"&gt;
+                    &lt;xsl:message&gt;Markup Error: no path attribute in &amp;lt;key&gt;&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+	        &lt;xsl:call-template name="IamEmpty" /&gt;
+
+             &lt;xsl:choose&gt;
+			&lt;xsl:when test="@match"&gt;
+				&lt;axsl:key match="{@match}" name="{@name}" use="{@path}"/&gt;
+			&lt;/xsl:when&gt;
+			&lt;xsl:otherwise&gt;
+				&lt;axsl:key name="{@name}" match="{parent::sch:rule/@context}" use="{@path}"/&gt;
+			&lt;/xsl:otherwise&gt;
+		&lt;/xsl:choose&gt;
+	&lt;/xsl:template&gt;
+
+      &lt;xsl:template match="sch:key | key"  /&gt;&lt;!-- swallow --&gt; 
+
+	&lt;!-- NAME --&gt;
+	&lt;xsl:template match="sch:name | name" mode="text"&gt;
+		&lt;axsl:text xml:space="preserve"&gt; &lt;/axsl:text&gt;
+			&lt;xsl:if test="@path"
+				&gt;&lt;xsl:call-template name="process-name"&gt;
+					&lt;xsl:with-param name="name" select="concat('name(',@path,')')"/&gt;
+					&lt;!-- SAXON needs that instead of  select="'name({@path})'"  --&gt;
+				&lt;/xsl:call-template&gt;
+			&lt;/xsl:if&gt;
+			&lt;xsl:if test="not(@path)"
+				&gt;&lt;xsl:call-template name="process-name"&gt;
+					&lt;xsl:with-param name="name" select="'name(.)'"/&gt;
+				&lt;/xsl:call-template&gt;
+			&lt;/xsl:if&gt;
+	        	&lt;xsl:call-template name="IamEmpty" /&gt;
+		&lt;axsl:text xml:space="preserve"&gt; &lt;/axsl:text&gt;
+	&lt;/xsl:template&gt;
+
+	&lt;!-- NS --&gt;
+	&lt;xsl:template match="sch:ns | ns"  mode="do-all-patterns" &gt;
+               &lt;xsl:if test="not(@uri)"&gt;
+                    &lt;xsl:message&gt;Markup Error: no uri attribute in &amp;lt;ns&gt;&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+               &lt;xsl:if test="not(@prefix)"&gt;
+                    &lt;xsl:message&gt;Markup Error: no prefix attribute in &amp;lt;ns&gt;&lt;/xsl:message&gt;
+                &lt;/xsl:if&gt;
+	        &lt;xsl:call-template name="IamEmpty" /&gt;
+		&lt;xsl:call-template name="process-ns" &gt;
+			&lt;xsl:with-param name="prefix" select="@prefix"/&gt;
+			&lt;xsl:with-param name="uri" select="@uri"/&gt;
+		&lt;/xsl:call-template&gt;
+	&lt;/xsl:template&gt;
+	&lt;xsl:template match="sch:ns | ns"  /&gt;&lt;!-- swallow --&gt;
+
+	&lt;!-- P --&gt;
+	&lt;xsl:template match="sch:schema/sch:p | schema/p" mode="do-schema-p" &gt;
+		&lt;xsl:call-template name="process-p"&gt;
+			&lt;xsl:with-param name="class" select="@class"/&gt;
+			&lt;xsl:with-param name="icon" select="@icon"/&gt;
+			&lt;xsl:with-param name="id" select="@id"/&gt;
+			&lt;xsl:with-param name="lang" select="@xml:lang"/&gt;
+		&lt;/xsl:call-template&gt;
+	&lt;/xsl:template&gt;
+	&lt;xsl:template match="sch:pattern/sch:p | pattern/p" mode="do-pattern-p" &gt;
+		&lt;xsl:call-template name="process-p"&gt;
+			&lt;xsl:with-param name="class" select="@class"/&gt;
+			&lt;xsl:with-param name="icon" select="@icon"/&gt;
+			&lt;xsl:with-param name="id" select="@id"/&gt;
+			&lt;xsl:with-param name="lang" select="@xml:lang"/&gt;
+		&lt;/xsl:call-template&gt;
+	&lt;/xsl:template&gt;
+	&lt;xsl:template match="sch:phase/sch:p" /&gt;&lt;!-- We don't use these --&gt;
+	&lt;xsl:template match="sch:p | p" /&gt;
+
+	&lt;!-- PATTERN --&gt;
+	&lt;xsl:template match="sch:pattern | pattern" mode="do-all-patterns"&gt;
+	&lt;xsl:if test="($phase = '#ALL') 
+	or (../sch:phase[@id= ($phase)]/sch:active[@pattern= current()/@id])
+	or (../phase[@id= ($phase)]/active[@id= current()/@id])"&gt;
+		&lt;xsl:call-template name="process-pattern"&gt;
+			&lt;xsl:with-param name="name" select="@name"/&gt;
+			&lt;xsl:with-param name="id" select="@id"/&gt;
+			&lt;xsl:with-param name="see" select="@see"/&gt;
+			&lt;xsl:with-param name="fpi" select="@fpi"/&gt;
+			&lt;xsl:with-param name="icon" select="@icon"/&gt;
+		&lt;/xsl:call-template&gt;
+		&lt;axsl:apply-templates select="/" mode="M{count(preceding-sibling::*)}"/&gt;
+        &lt;/xsl:if&gt;
+	&lt;/xsl:template&gt;
+	
+	&lt;xsl:template match="sch:pattern | pattern"&gt;

@@ Diff output truncated at 100000 characters. @@

This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=15569005">[GeoNetwork-commit] SF.net SVN: geonetwork: [999] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;e_tajariol@us...&gt; -	2008-01-08 23:22</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 999
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=999&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=999&amp;view=rev</a>
Author:   e_tajariol
Date:     2008-01-08 15:22:28 -0800 (Tue, 08 Jan 2008)

Log Message:
-----------
Fix: the hidden icon was mistakenly reset when layers got redrawn.

Modified Paths:
--------------
    trunk/src/org/wfp/vam/intermap/kernel/map/MapMerger.java
    trunk/web/intermap/xsl/im_get-layers-embedded.xsl

Modified: trunk/src/org/wfp/vam/intermap/kernel/map/MapMerger.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/kernel/map/MapMerger.java	2008-01-08 20:07:05 UTC (rev 998)
+++ trunk/src/org/wfp/vam/intermap/kernel/map/MapMerger.java	2008-01-08 23:22:28 UTC (rev 999)
@@ -205,10 +205,12 @@
 			catch (Exception e) {}
 
 			Element eLayer = new Element("layer")
-									  .setAttribute("id", idx + "")
-								 	  .setAttribute("title", "" + s.getTitle())
+									  .setAttribute("id", "" + idx)
+								 	  .setAttribute("title", s.getTitle())
 								 	  .setAttribute("type", "" + s.getType())
-								 	  .setAttribute("transparency", "" + layer.getIntTransparency());
+								 	  .setAttribute("transparency", "" + layer.getIntTransparency())
+								 	  .setAttribute("visible", layer.isVisible()?"true":"false");
+
 			if(legend != null)
 				eLayer.setAttribute("legend", legend);
 

Modified: trunk/web/intermap/xsl/im_get-layers-embedded.xsl
===================================================================
--- trunk/web/intermap/xsl/im_get-layers-embedded.xsl	2008-01-08 20:07:05 UTC (rev 998)
+++ trunk/web/intermap/xsl/im_get-layers-embedded.xsl	2008-01-08 23:22:28 UTC (rev 999)
@@ -21,17 +21,24 @@
 			&lt;/xsl:if&gt;
 			
 &lt;!--
-	
 	&lt;xsl:variable name="action"&gt;im_mapServerSelected(&lt;xsl:value-of select="@id" /&gt;,"&lt;xsl:value-of select="@name" /&gt;");&lt;/xsl:variable&gt;
 	&lt;li id="im_mapserver_{@id}" onclick="{$action}"&gt;&lt;a&gt;&lt;xsl:value-of select="@name" /&gt;&lt;/a&gt;&lt;/li&gt;
 --&gt;		
+			&lt;xsl:variable name="toggleVisibilityIcon"&gt;
+				&lt;xsl:choose&gt;
+					&lt;xsl:when test="@visible='true'"&gt;/intermap/images/showLayer.png&lt;/xsl:when&gt;
+					&lt;xsl:otherwise&gt;/intermap/images/hideLayer.png&lt;/xsl:otherwise&gt;
+				&lt;/xsl:choose&gt;				
+			&lt;/xsl:variable&gt;
+			
+			
 			&lt;table&gt;
 				&lt;tbody&gt;
 					&lt;tr height="35px"&gt;
 						&lt;td height="35px" class="im_layerControl"&gt;
 							&lt;img id="visibility_{@id}"  class="im_layerControl" 
 								onclick="toggleVisibility({@id})" 
-								src="/intermap/images/showLayer.png" title="{/root/gui/strings/layerShowHide}"&gt;&lt;/img&gt;
+								src="{$toggleVisibilityIcon}" title="{/root/gui/strings/layerShowHide}"&gt;&lt;/img&gt;
 							&lt;xsl:if test="position()&gt;1"&gt;
 								&lt;img id="im_layerUp_{@id}" class="im_layerControl" 
 									onclick="im_layerMoveUp({@id})"


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=15569006">[GeoNetwork-commit] SF.net SVN: geonetwork: [1000] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;e_tajariol@us...&gt; -	2008-01-09 03:10</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1000
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1000&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1000&amp;view=rev</a>
Author:   e_tajariol
Date:     2008-01-08 19:10:28 -0800 (Tue, 08 Jan 2008)

Log Message:
-----------
Added back the 'zoom to layer' feature.

Modified Paths:
--------------
    trunk/src/org/wfp/vam/intermap/services/map/ZoomToService.java
    trunk/web/intermap/WEB-INF/config.xml
    trunk/web/intermap/scripts/im_ajax.js
    trunk/web/intermap/scripts/im_integration.js
    trunk/web/intermap/scripts/im_layers.js

Modified: trunk/src/org/wfp/vam/intermap/services/map/ZoomToService.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/services/map/ZoomToService.java	2008-01-08 23:22:28 UTC (rev 999)
+++ trunk/src/org/wfp/vam/intermap/services/map/ZoomToService.java	2008-01-09 03:10:28 UTC (rev 1000)
@@ -23,23 +23,17 @@
 
 package org.wfp.vam.intermap.services.map;
 
-import java.util.*;
-
-import org.jdom.*;
-
-import jeeves.interfaces.*;
-import jeeves.server.*;
-import jeeves.server.context.*;
-
-import org.wfp.vam.intermap.kernel.map.*;
-
+import jeeves.interfaces.Service;
+import jeeves.server.ServiceConfig;
+import jeeves.server.context.ServiceContext;
+import org.jdom.Element;
 import org.wfp.vam.intermap.Constants;
+import org.wfp.vam.intermap.kernel.map.MapMerger;
 import org.wfp.vam.intermap.kernel.map.mapServices.MapService;
-import org.wfp.vam.intermap.kernel.map.mapServices.BoundingBox;
 
 //=============================================================================
 
-/** main.result service. shows search results
+/**
   */
 
 public class ZoomToService implements Service
@@ -55,22 +49,28 @@
 	public Element exec(Element params, ServiceContext context) throws Exception
 	{
 		int id = Integer.parseInt(params.getChildText("id"));
-		
+		int width  = Integer.parseInt(params.getChildText("width"));
+		int height = Integer.parseInt(params.getChildText("height"));
+
 		// Get the MapMerger object from the user session
 		MapMerger mm = MapUtil.getMapMerger(context);
-		
-//		MapUtil.setActiveLayer(params, mm);
-//		MapUtil.setVisibleLayers(params, mm);
-//		MapUtil.setTransparency(params, mm);
-		
+
 		MapService ms = mm.getService(id);
 		mm.setBoundingBox(ms.getDefBoundingBox());
-		
 		context.getUserSession().setProperty(Constants.SESSION_MAP, mm);
-		
-		return null;
+
+		// Merge the images now
+		String imagename = mm.merge(width, height);
+		String url = MapUtil.getTempUrl() + "/" + imagename;
+
+		return new Element("response")
+			.addContent(new Element("imgUrl").setText(url))
+			.addContent(new Element("scale").setText(mm.getDistScale()))
+			.addContent(mm.getBoundingBox().toElement())
+			.addContent(new Element("width").setText(""+width))
+			.addContent(new Element("height").setText(""+height));
 	}
-	
+
 }
 
 //=============================================================================

Modified: trunk/web/intermap/WEB-INF/config.xml
===================================================================
--- trunk/web/intermap/WEB-INF/config.xml	2008-01-08 23:22:28 UTC (rev 999)
+++ trunk/web/intermap/WEB-INF/config.xml	2008-01-09 03:10:28 UTC (rev 1000)
@@ -250,8 +250,9 @@
 		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
 		
+		
 		&lt;service name="map.layers.add"&gt;
-			&lt;class name=".services.map.layers.Add"/&gt;
+			&lt;class name=".services.map.layers.Add"/&gt; &lt;!-- return null --&gt;
 			
 			&lt;output forward="map.update" /&gt;
 		&lt;/service&gt;
@@ -326,6 +327,7 @@
 		&lt;/service&gt;
 		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+		&lt;!-- return a full image response --&gt;
 		
 		&lt;service name="map.action"&gt;
 			&lt;class name=".services.map.Action" /&gt;
@@ -338,12 +340,14 @@
 		&lt;/service&gt;
 
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+		&lt;!-- return a full image response --&gt;
 		
 		&lt;service name="map.setScale"&gt;
 			&lt;class name=".services.map.SetScale" /&gt;
 		&lt;/service&gt;
 		
-		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;		
+		&lt;!-- return a full image response --&gt;
 		
 		&lt;service name="map.update"&gt;
 			&lt;class name=".services.map.Update" /&gt;
@@ -360,6 +364,7 @@
  --&gt;
 
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+		&lt;!-- return new images params (size+bbox) --&gt;
 		
 		&lt;service name="map.fullExtent"&gt;
 			&lt;class name=".services.map.FullExtent" /&gt;
@@ -368,11 +373,10 @@
 		&lt;/service&gt;
 		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+		&lt;!-- return a full image response --&gt;
 		
 		&lt;service name="map.zoomToService"&gt;
 			&lt;class name=".services.map.ZoomToService"/&gt;
-			
-			&lt;output forward="map.getMain"/&gt;
 		&lt;/service&gt;
 		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;

Modified: trunk/web/intermap/scripts/im_ajax.js
===================================================================
--- trunk/web/intermap/scripts/im_ajax.js	2008-01-08 23:22:28 UTC (rev 999)
+++ trunk/web/intermap/scripts/im_ajax.js	2008-01-09 03:10:28 UTC (rev 1000)
@@ -57,32 +57,6 @@
  *                                                                           *
  *****************************************************************************/
 
-/*
-// Not used at the moment
-// TODO: Should we restore it adding a button in each layer's tab? 
-
-function imc_zoomToLayer(layerId)
-{
-	deleteAoi();
-	//unsetAoi();
-	//$('im_geonetRecords').className = 'hidden';	
-	
-	setStatus('busy');
-	var pars = 'id=' + layerId;
-	
-	var myAjax = new Ajax.Request (
-		getIMServiceURL('map.zoomToService'),
-		{
-			method: 'get',
-			parameters: pars,
-			onComplete: function(req) { im_bm_refreshNeeded(true);}, // FIXME
-			onFailure: reportError
-		}
-	);
-}
-
-*/
-
 function im_setWMC(wmc, callback) 
 {
     var pars = 'wmc=' + wmc;               //encodeURIComponent(surl) 

Modified: trunk/web/intermap/scripts/im_integration.js
===================================================================
--- trunk/web/intermap/scripts/im_integration.js	2008-01-08 23:22:28 UTC (rev 999)
+++ trunk/web/intermap/scripts/im_integration.js	2008-01-09 03:10:28 UTC (rev 1000)
@@ -86,10 +86,13 @@
 
 im_extra_afterLayerUpdated = im_refreshBothMaps;
 
+// TODO: this function's name has to be changed: it is called: 
+//  - after wmc is set   
+//  - after a zoomtolayer 
 im_extra_afterWmcSet = function(resp)
 {
 	im_bm.set_dom(resp);
-	im_bm.setBBox_dom(resp);
+	im_bm.setBBox_dom(resp); // ? set_dom already calls this one. To be removed?
 	  
 	im_mm.setBBox_dom(resp);  
 	im_mm.rebuild(im_mm_fullAoI);

Modified: trunk/web/intermap/scripts/im_layers.js
===================================================================
--- trunk/web/intermap/scripts/im_layers.js	2008-01-08 23:22:28 UTC (rev 999)
+++ trunk/web/intermap/scripts/im_layers.js	2008-01-09 03:10:28 UTC (rev 1000)
@@ -5,6 +5,8 @@
  * Requires:
  *    im_extra_afterLayerUpdated()
  *    getIMServiceURL(servicename)
+ *    im_extra_afterWmcSet(resp) -- this function's name has to be changed
+ *    im_extra_drivingMap
  *****************************************************************************/
 
 var im_layer_width = 176;
@@ -66,16 +68,48 @@
 
 /*****************************************************************************
  *
- *                                   Layers
+ *                    Double click
  *
  *****************************************************************************/
 
 function layerDblClickListener(id)
 {
-//	deleteAoi(); // FIXME
-//	imc_zoomToLayer(id); // FIXME
+	imc_zoomToLayer(id);
 }
 
+// TODO: Should we move this functionality into buttons in each layer's tab?
+// TODO: what about the AOI?  (read also into im_extra_afterWmcSet)
+function imc_zoomToLayer(layerId)
+{
+	im_extra_drivingMap.setStatus('busy');
+	var pars = 'id=' + layerId + 
+				'&amp;width='  + im_extra_drivingMap.width +
+				'&amp;height=' + im_extra_drivingMap.height;
+	
+	var myAjax = new Ajax.Request (
+		getIMServiceURL('map.zoomToService'),
+		{
+			method: 'get',
+			parameters: pars,
+			onComplete: function(req) 
+			{ 
+				var resp = req.responseXML;
+				im_extra_afterWmcSet(resp); // function's name has to be changed 
+				im_extra_drivingMap.setStatus('idle');
+			}, 
+			onFailure: reportError
+		}
+	);
+}
+
+
+
+/*****************************************************************************
+ *
+ *                      Visibility toggling
+ *
+ *****************************************************************************/
+
 function toggleVisibility(id) {
 	var pars = 'id=' + id;
 	


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18405320">[GeoNetwork-commit] SF.net SVN: geonetwork: [1028] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;e_tajariol@us...&gt; -	2008-01-22 21:45</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1028
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1028&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1028&amp;view=rev</a>
Author:   e_tajariol
Date:     2008-01-22 13:45:26 -0800 (Tue, 22 Jan 2008)

Log Message:
-----------
Aligning API for clearing existing context.

Modified Paths:
--------------
    trunk/src/org/wfp/vam/intermap/services/wmc/SetWmcContext.java
    trunk/src/org/wfp/vam/intermap/services/wmc/SetWmcFromURL.java
    trunk/web/intermap/scripts/im_ajax.js
    trunk/web/intermap/scripts/im_standalone.js
    trunk/web/intermap/static/iframepoc.html

Modified: trunk/src/org/wfp/vam/intermap/services/wmc/SetWmcContext.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/services/wmc/SetWmcContext.java	2008-01-22 21:34:53 UTC (rev 1027)
+++ trunk/src/org/wfp/vam/intermap/services/wmc/SetWmcContext.java	2008-01-22 21:45:26 UTC (rev 1028)
@@ -40,7 +40,7 @@
 /**
  * Set the WMC from an URL-encoded parameter.
  *
- * @author Etj
+ * @author ETj
  */
 public class SetWmcContext implements Service
 {
@@ -65,7 +65,7 @@
 //		System.out.println(" ============= request wmc is:\n\n" +xo.outputString(mapContext));
 
 		// Create a new MapMerger object
-		String sreplace  = params.getChildText("clearLayers");
+		String sreplace  = params.getChildText("clearLayers"); // TODO: let's set the same param in all services supporting it. "clear" is simpler.
 		boolean breplace = Utils.getBooleanAttrib(sreplace, true);
 
 		MapMerger mm = breplace?

Modified: trunk/src/org/wfp/vam/intermap/services/wmc/SetWmcFromURL.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/services/wmc/SetWmcFromURL.java	2008-01-22 21:34:53 UTC (rev 1027)
+++ trunk/src/org/wfp/vam/intermap/services/wmc/SetWmcFromURL.java	2008-01-22 21:45:26 UTC (rev 1028)
@@ -75,7 +75,7 @@
 //		System.out.println(" ============= wmc is:\n\n" +xo.outputString(mapContext));
 
 		// Create a new MapMerger object
-		String sreplace  = params.getChildText("clearLayers");
+		String sreplace  = params.getChildText("clear");
 		boolean breplace = Utils.getBooleanAttrib(sreplace, true);
 
 		MapMerger mm = breplace?

Modified: trunk/web/intermap/scripts/im_ajax.js
===================================================================
--- trunk/web/intermap/scripts/im_ajax.js	2008-01-22 21:34:53 UTC (rev 1027)
+++ trunk/web/intermap/scripts/im_ajax.js	2008-01-22 21:45:26 UTC (rev 1028)
@@ -73,9 +73,10 @@
     );    
 }
 
-function imc_setContextFromURL(url, callback) 
+function imc_setContextFromURL(url, doClearContext, callback) 
 {
 	var pars = 'url=' + encodeURIComponent(url);
+	pars += "&amp;clear=" + (doClearContext===true ? "true" : "false");		
     		
     var myAjax = new Ajax.Request (
     	getIMServiceURL('wmc.setContextFromURL'),
@@ -107,10 +108,7 @@
 			+ '&amp;service=' + encodeURIComponent(service) 
 			+ '&amp;type=' + type;
 			
-	if(doClearContext===true)
-	{
-		pars += "&amp;clear=true";		
-	}
+	pars += "&amp;clear=" + (doClearContext===true ? "true" : "false");		
 			
 	var myAjax = new Ajax.Request (
 		getIMServiceURL('map.addServices.embedded'),
@@ -130,10 +128,8 @@
 	var pars = 'url=' + encodeURIComponent(surl) 
 			 + '&amp;type=' + type;
 
-//	if(doClearContext===true)
-//	{
-//		pars += "&amp;clear=true";		
-//	}
+	//pars += "&amp;clear=" + (doClearContext===true ? "true" : "false");		
+
 	
 	serviceArray.each(
 	    function(service)

Modified: trunk/web/intermap/scripts/im_standalone.js
===================================================================
--- trunk/web/intermap/scripts/im_standalone.js	2008-01-22 21:34:53 UTC (rev 1027)
+++ trunk/web/intermap/scripts/im_standalone.js	2008-01-22 21:45:26 UTC (rev 1028)
@@ -5,6 +5,13 @@
 // This file contains the initialization, callback and eventhandler functions 
 // to make a bigmap live on its own.
 //
+// Requires:
+//		im_bm as an Intermap object
+//		imc_addService()
+//		imc_setContextFromURL()
+//		imc_reloadLayers()
+//
+//
 //===================================================================
 
 //===================================================================
@@ -16,10 +23,18 @@
 //
 //===================================================================
 
-function imep_loadLayer(url, service, doClearContext)
+/**
+ * Loads a layer into the map.
+ * The map image and the layerlist will be updated.
+ * 
+ * @param {String} url: the WMS server URL.
+ * @param {String} layer: the name of the layer as reported by the WMS server.
+ * @param {boolean} doClearContext: set it to true if the existing context has to be cleared. 
+ */
+function imep_loadLayer(url, layer, doClearContext)
 {
 	im_bm.setStatus('busy');
-    imc_addService(url, service, 2, doClearContext,
+    imc_addService(url, layer, 2, doClearContext,
 					function(req) 
 					{
 			             im_buildLayerList(req);
@@ -29,16 +44,32 @@
 			        });		
 }
 
+/**
+ * Set a new bounding box for the map.
+ * The map image will be updated.
+ * 
+ * @param {Float} n: north latitude
+ * @param {Float} e: east longitude
+ * @param {Float} s: south latitude
+ * @param {Float} w: west longitude
+ */
 function imep_setBBox(n,e,s,w)
 {
 	im_bm.setBBox(n,e,s,w);
 	im_bm.rebuild();		
 }
 
-function imep_loadWmcFromUrl(url)
+/**
+ * Loads a new WMC context into the map.
+ * The map image and the layerlist will be updated.
+ * 
+ * @param {String} url: the WMC URL.
+ * @param {boolean} doClearContext: set it to true if the existing context has to be cleared. 
+ */
+function imep_loadWmcFromUrl(url, doClearContext)
 {
 	im_bm.setStatus('busy');
-	imc_setContextFromURL(url, 
+	imc_setContextFromURL(url, doClearContext,
 							function(req)
 							{
 								if(im_checkError(req))
@@ -82,6 +113,11 @@
   }
 });
 
+//===================================================================
+// BOOT
+// 
+// Functions related to the map bootstrap
+//===================================================================
 
 /**
  * This function is called by the onload property in the Intermap frame 
@@ -94,16 +130,36 @@
 	//alert("W:"+size[0]+" H:"+size[1]);	
 	im_bm.setSize( size[0] - im_layer_width - 35, size[1] - 50);
 	
+	if( im_tryWMCBoot()) 
+		return;
+
+	if( im_tryLayerBoot()) 
+		return;
+			
+	// These calls are skipped if the tryXXX functions load anything
+	//    and these actions will be performed asynch'ly
+	im_bm.rebuild(imc_reloadLayers);		
+	im_bm.setStatus("idle");
+}
+
+/**
+ * Try using an external defined function imcb_getBootWmcUrl.
+ * If it exists, and returns a valid WMC context, the function will return true. 
+ */
+function im_tryWMCBoot()
+{
 	var func = parent.imcb_getBootWmcUrl;
-	var wmcurl;
 
 	if(typeof func == 'function')
 	{
-		wmcurl = func();
+		var arr = func();
 		
-		if(wmcurl)
+		if(arr)
 		{
-			imc_setContextFromURL(wmcurl,
+			var wmcurl = arr[0];
+			var clr    = arr[1];
+			
+			imc_setContextFromURL(wmcurl, clr,
 									function(req)
 									{
 										if(im_checkError(req))
@@ -122,13 +178,52 @@
 										im_bm.setStatus('idle');
 									}
 								);
-			return;
+			return true;
 		}			
 	}
+	
+	return false;
+}
+
+/**
+ * Try using an external defined function imcb_getBootWmcUrl.
+ * If it exists, and returns a valid WMC context, the function will return true. 
+ */
+function im_tryLayerBoot()
+{
+	var func = parent.imcb_getBootLayer;
+
+	if(typeof func == 'function')
+	{
+		var arr = func();
 		
+		if(arr)
+		{
+			var url   = arr[0];
+			var layer = arr[1];
+			var clr   = arr[2];
 			
-	im_bm.rebuild(imc_reloadLayers);		
-	im_bm.setStatus("idle");
+			imc_addService(url, layer, 2, clr,
+									function(req)
+									{
+										if(im_checkError(req))
+										{
+											im_bm.setStatus('idle');
+											im_showError(req);
+											return;
+										}
+										
+										im_buildLayerList(req);
+
+										im_bm.rebuild(function(){
+											im_bm.setStatus('idle');});
+									}
+								);
+			return true;
+		}			
+	}
+	
+	return false;
 }
 
 //===================================================================

Modified: trunk/web/intermap/static/iframepoc.html
===================================================================
--- trunk/web/intermap/static/iframepoc.html	2008-01-22 21:34:53 UTC (rev 1027)
+++ trunk/web/intermap/static/iframepoc.html	2008-01-22 21:45:26 UTC (rev 1028)
@@ -35,8 +35,9 @@
 			function sample_loadWmcUrl()
 			{
 				var wmcurl = document.getElementById('wmcurl').value;
+				var clear = document.getElementById('lwclearcontext').checked;
 				
-				window.frames.intermapIframe.imep_loadWmcFromUrl(wmcurl); 
+				window.frames.intermapIframe.imep_loadWmcFromUrl(wmcurl, clear); 
 			}
 			
 			/**
@@ -46,7 +47,7 @@
 			{
 				var url = document.getElementById('wmsurl').value;
 				var layer = document.getElementById('layername').value;
-				var clear = document.getElementById('clearcontext').checked;
+				var clear = document.getElementById('llclearcontext').checked;
 
 //			var d = document;
 //			var f = d.frames ? d.frames['intermapIframe'] : d.getElementById('intermapIframe');
@@ -70,19 +71,66 @@
 			}
 		
 			/**
-			 * InterMap CallBack function &lt;p&gt;
+			 * InterMap CallBack function &lt;b&gt;imcb_getBootWmcUrl()&lt;/b&gt; &lt;p&gt;
 			 * 
+			 * Sets the WMC that intermap must show when loading.
+			 * 
 			 * If this function exists and returns a not null value,
-			 * the returned value must be an URL to a WMC context document.
-			 * This is the first context InterMap will load.
+			 * the returned value must be an array containing:
+			 *  - [0]: the URL to a WMC context document; 
+			 *  		The given WMC is the context InterMap will show as soon as it is loaded.
+			 *  - [1]: true if the existing layer list has to be cleared, 
+			 * 			or false if the context's layers have to be added to the existing ones.
 			 * 
-			 * @return {String} the URL of the WMC context file
+			 *  Note that if the user session is not open yet (i.e. the user is loading intermap 
+			 *  for the first time in a while), there is no existing layer list and the map 
+			 *  will be build only with the loaded WMC, in the same way as the param [1] was set to true.  
+			 * 
+			 *  When both imcb_getBootLayer() and imcb_getBootWmcUrl() are defined, 
+			 *  only imcb_getBootWmcUrl() will be considered.
+			 * 
+			 * @return {Array} [0]: the URL of the WMC context file ; [1]: true if context has to be cleared
 			 */			
 			function imcb_getBootWmcUrl()
-			{				
-				return "<a href="http://localhost:8080/intermap/static/context_australia.xml" target="_new">http://localhost:8080/intermap/static/context_australia.xml</a>";
+			{	
+				var ret = new Array();
+				ret[0] = "<a href="http://localhost:8080/intermap/static/context_australia.xml" target="_new">http://localhost:8080/intermap/static/context_australia.xml</a>";
+				ret[1] = true; 			
+				return ret;
 			}
 
+			/**
+			 * InterMap CallBack function &lt;b&gt;imcb_getBootLayer()&lt;/b&gt;&lt;p&gt;
+			 * 
+			 * Sets the layer that intermap must show when loading.
+			 * 
+			 * If this function exists and returns a not null value,
+			 * the returned value must be an array containing:
+			 *  - [0]: the URL to a WMS; 
+			 *  - [1]: the name of the layer to load;
+			 *  - [2]: true if the existing layer list has to be cleared, 
+			 *      or false if the given layer has to be added to the existing ones.
+			 *        
+			 *  The given layer will be loaded in InterMap as soon as IM is loaded.
+			 *  
+			 *  Note that if the user session is not open yet (i.e. the user is loading intermap 
+			 *  for the first time in a while), there is no existing layer list and the map 
+			 *  will be build only with the loaded layer, in the same way as the param [2] was set to true.
+			 * 
+			 * When both imcb_getBootLayer() and imcb_getBootWmcUrl() are defined, 
+			 * only imcb_getBootWmcUrl() will be considered.
+			 * 
+			 * @return {Array} [0]: the WMS URL; [1]: the layer's name; [2]: true if context has to be cleared
+			 */			
+			function imcb_getBootLayer()
+			{	
+				var ret = new Array();
+				ret[0] = "<a href="http://www2.demis.nl/wms/wms.asp?wms=WorldMap&amp" target="_new">http://www2.demis.nl/wms/wms.asp?wms=WorldMap&amp</a>;";
+				ret[1] = "Countries";				
+				ret[2] = true; 			
+				return ret;
+			}
+
 		&lt;/script&gt;
 				 
 	&lt;/head&gt;
@@ -98,6 +146,8 @@
 							&lt;legend&gt;imep_loadWmcFromUrl&lt;/legend&gt;
 							WMC url 
 							&lt;input type="text" id="wmcurl" value="<a href="http://localhost:8080/intermap/static/context_australia.xml"/" target="_new">http://localhost:8080/intermap/static/context_australia.xml"/</a>&gt; 
+							&lt;br/&gt;Clear context
+							&lt;input type="checkbox" id="lwclearcontext" title="Clear context"/&gt;
 							
 							&lt;br/&gt;&lt;a href="javascript:void(0);" onclick="sample_loadWmcUrl();"&gt;LOAD CONTEXT&lt;/a&gt;							
 						&lt;/fieldset&gt;
@@ -116,7 +166,7 @@
 							&lt;br/&gt;Layer name 
 							&lt;input type="text" id="layername" value="Countries"/&gt;
 							&lt;br/&gt;Clear context
-							&lt;input type="checkbox" id="clearcontext" title="Clear context"/&gt;
+							&lt;input type="checkbox" id="llclearcontext" title="Clear context"/&gt;
 							 
 							&lt;br/&gt;&lt;a href="javascript:void(0);" onclick="sample_loadWmsLayer();"&gt;ADD LAYER&lt;/a&gt;
 						&lt;/fieldset&gt;
@@ -157,4 +207,4 @@
 		
 	&lt;/body&gt;
 
-&lt;/html&gt;
\ No newline at end of file
+&lt;/html&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18535256">[GeoNetwork-commit] SF.net SVN: geonetwork: [1054] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;bluenetdevteam@us...&gt; -	2008-02-08 20:04</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1054
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1054&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1054&amp;view=rev</a>
Author:   bluenetdevteam
Date:     2008-02-08 12:04:38 -0800 (Fri, 08 Feb 2008)

Log Message:
-----------
Fixes for attributeGroup inheritance and automatic srsName plus other small
fixes

Modified Paths:
--------------
    trunk/src/org/fao/geonet/kernel/schema/SchemaLoader.java
    trunk/web/geonetwork/xml/schemas/iso19139/convert/oai-dc.xsl
    trunk/web/geonetwork/xml/schemas/iso19139/schema-suggestions.xml
    trunk/web/geonetwork/xml/schemas/iso19139/update-fixed-info.xsl
    trunk/web/geonetwork/xsl/metadata-iso19139.xsl

Modified: trunk/src/org/fao/geonet/kernel/schema/SchemaLoader.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/schema/SchemaLoader.java	2008-01-31 14:17:47 UTC (rev 1053)
+++ trunk/src/org/fao/geonet/kernel/schema/SchemaLoader.java	2008-02-08 20:04:38 UTC (rev 1054)
@@ -975,8 +975,18 @@
 		}
 		// otherwise base type was an extension so add the attributes we got
 		// from the extension to these
-		else 
+		else { 
 			result.addAll((ArrayList)cte.complexContent.alAttribs);
+			if (cte.complexContent.alAttribGroups != null) {
+				for (int k=0;k&lt;cte.complexContent.alAttribGroups.size();k++) {
+					String attribGroup = (String)cte.complexContent.alAttribGroups.get(k);					ArrayList al = (ArrayList) hmAttrGrp.get(attribGroup);
+					if (al == null) 
+						throw new IllegalArgumentException("Attribute group not found : " + attribGroup);
+					for(int j=0; j&lt;al.size(); j++)
+						result.add(al.get(j));
+				}
+			}
+		}
 
 		// No one seems clear on what to do with attributeGroups so treat them
 		// as an extension

Modified: trunk/web/geonetwork/xml/schemas/iso19139/convert/oai-dc.xsl
===================================================================
--- trunk/web/geonetwork/xml/schemas/iso19139/convert/oai-dc.xsl	2008-01-31 14:17:47 UTC (rev 1053)
+++ trunk/web/geonetwork/xml/schemas/iso19139/convert/oai-dc.xsl	2008-02-08 20:04:38 UTC (rev 1054)
@@ -63,7 +63,7 @@
 						&lt;dc:rights&gt;&lt;xsl:value-of select="."/&gt;&lt;/dc:rights&gt;
 					&lt;/xsl:for-each&gt;
 
-					&lt;xsl:for-each select="otherConstraints/gco:CharacterString"&gt;
+					&lt;xsl:for-each select="gmd:otherConstraints/gco:CharacterString"&gt;
 						&lt;dc:rights&gt;&lt;xsl:value-of select="."/&gt;&lt;/dc:rights&gt;
 					&lt;/xsl:for-each&gt;
 				&lt;/xsl:for-each&gt;

Modified: trunk/web/geonetwork/xml/schemas/iso19139/schema-suggestions.xml
===================================================================
--- trunk/web/geonetwork/xml/schemas/iso19139/schema-suggestions.xml	2008-01-31 14:17:47 UTC (rev 1053)
+++ trunk/web/geonetwork/xml/schemas/iso19139/schema-suggestions.xml	2008-02-08 20:04:38 UTC (rev 1054)
@@ -95,7 +95,7 @@
 		&lt;suggest name="uuidref"/&gt;
 	&lt;/field&gt;
 
-	&lt;field name="gml:polygon"&gt;
+	&lt;field name="gml:Polygon"&gt;
 		&lt;suggest name="srsName"/&gt;
 	&lt;/field&gt;
 

Modified: trunk/web/geonetwork/xml/schemas/iso19139/update-fixed-info.xsl
===================================================================
--- trunk/web/geonetwork/xml/schemas/iso19139/update-fixed-info.xsl	2008-01-31 14:17:47 UTC (rev 1053)
+++ trunk/web/geonetwork/xml/schemas/iso19139/update-fixed-info.xsl	2008-02-08 20:04:38 UTC (rev 1054)
@@ -43,23 +43,15 @@
 
 	&lt;!-- ================================================================= --&gt;
 	
-	&lt;xsl:template match="gmd:MD_Metadata/gmd:characterSet"&gt;
+	&lt;xsl:template match="gmd:metadataStandardName" priority="10"&gt;
 		&lt;xsl:copy&gt;
-			&lt;gmd:MD_CharacterSetCode codeList="<a href="http://www.isotc211.org/2005/resources/codeList.xml#MD_CharacterSetCode" target="_new">http://www.isotc211.org/2005/resources/codeList.xml#MD_CharacterSetCode</a>" codeListValue="utf8" /&gt;
-		&lt;/xsl:copy&gt;
-	&lt;/xsl:template&gt;
-
-	&lt;!-- ================================================================= --&gt;
-	
-	&lt;xsl:template match="gmd:metadataStandardName"&gt;
-		&lt;xsl:copy&gt;
 			&lt;gco:CharacterString&gt;ISO 19115:2003/19139&lt;/gco:CharacterString&gt;
 		&lt;/xsl:copy&gt;
 	&lt;/xsl:template&gt;
 
 	&lt;!-- ================================================================= --&gt;
 	
-	&lt;xsl:template match="gmd:metadataStandardVersion"&gt;
+	&lt;xsl:template match="gmd:metadataStandardVersion" priority="10"&gt;
 		&lt;xsl:copy&gt;
 			&lt;gco:CharacterString&gt;1.0&lt;/gco:CharacterString&gt;
 		&lt;/xsl:copy&gt;
@@ -67,39 +59,33 @@
 
 	&lt;!-- ================================================================= --&gt;
 	
-	&lt;xsl:template match="*[@gml:id]"&gt;
-		&lt;xsl:copy&gt;
-			&lt;xsl:choose&gt;
-				&lt;xsl:when test="normalize-space(@gml:id)=''"&gt;
-					&lt;xsl:attribute name="gml:id"&gt;
-						&lt;xsl:value-of select="generate-id(.)"/&gt;
-					&lt;/xsl:attribute&gt;
-					&lt;xsl:apply-templates select="@*[name()!='gml:id']|node()"/&gt;
-				&lt;/xsl:when&gt;
-				&lt;xsl:otherwise&gt;
-					&lt;xsl:apply-templates select="@*|node()"/&gt;
-				&lt;/xsl:otherwise&gt;
-			&lt;/xsl:choose&gt;
-		&lt;/xsl:copy&gt;
+	&lt;xsl:template match="@gml:id"&gt;
+		&lt;xsl:choose&gt;
+			&lt;xsl:when test="normalize-space(.)=''"&gt;
+				&lt;xsl:attribute name="gml:id"&gt;
+					&lt;xsl:value-of select="generate-id(.)"/&gt;
+				&lt;/xsl:attribute&gt;
+			&lt;/xsl:when&gt;
+			&lt;xsl:otherwise&gt;
+				&lt;xsl:copy-of select="."/&gt;
+			&lt;/xsl:otherwise&gt;
+		&lt;/xsl:choose&gt;
 	&lt;/xsl:template&gt;
 
 	&lt;!-- ================================================================= --&gt;
 	&lt;!-- Fix srsName attribute and generate epsg:4326 entry by default --&gt;
 
-	&lt;xsl:template match="*[@gml:srsName]"&gt;
-		&lt;xsl:copy&gt;
-			&lt;xsl:choose&gt;
-				&lt;xsl:when test="normalize-space(@gml:srsName)=''"&gt;
-					&lt;xsl:attribute name="gml:srsName"&gt;
-						&lt;xsl:text&gt;urn:x-ogc:def:crs:EPSG:6.6:4326&lt;/xsl:text&gt;
-					&lt;/xsl:attribute&gt;
-					&lt;xsl:apply-templates select="@*[name()!='gml:srsName']|node()"/&gt;
-				&lt;/xsl:when&gt;
-				&lt;xsl:otherwise&gt;
-					&lt;xsl:apply-templates select="@*|node()"/&gt;
-				&lt;/xsl:otherwise&gt;
-			&lt;/xsl:choose&gt;
-		&lt;/xsl:copy&gt;
+	&lt;xsl:template match="@srsName"&gt;
+		&lt;xsl:choose&gt;
+			&lt;xsl:when test="normalize-space(.)=''"&gt;
+				&lt;xsl:attribute name="srsName"&gt;
+					&lt;xsl:text&gt;urn:x-ogc:def:crs:EPSG:6.6:4326&lt;/xsl:text&gt;
+				&lt;/xsl:attribute&gt;
+			&lt;/xsl:when&gt;
+			&lt;xsl:otherwise&gt;
+				&lt;xsl:copy-of select="."/&gt;
+			&lt;/xsl:otherwise&gt;
+		&lt;/xsl:choose&gt;
 	&lt;/xsl:template&gt;
 	
 	&lt;!-- ================================================================= --&gt;

Modified: trunk/web/geonetwork/xsl/metadata-iso19139.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-01-31 14:17:47 UTC (rev 1053)
+++ trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-02-08 20:04:38 UTC (rev 1054)
@@ -204,7 +204,7 @@
 	&lt;!-- codelists --&gt;
 	&lt;!-- ================================================================= --&gt;
 
-	&lt;xsl:template mode="iso19139" match="gmd:*[*/@codeList]"&gt;
+	&lt;xsl:template mode="iso19139" match="gmd:*[*/@codeList]|srv:*[*/@codeList]"&gt;
 		&lt;xsl:param name="schema"/&gt;
 		&lt;xsl:param name="edit"/&gt;
 		


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18578493">[GeoNetwork-commit] SF.net SVN: geonetwork: [1083] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;ticheler@us...&gt; -	2008-02-13 09:30</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1083
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1083&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1083&amp;view=rev</a>
Author:   ticheler
Date:     2008-02-13 01:30:19 -0800 (Wed, 13 Feb 2008)

Log Message:
-----------
Renamed gast startup files. Makes it slightly easier to run start-geonetwork.sh from terminal on a *NIX machine.
Small updates in shortcut menus

Modified Paths:
--------------
    trunk/installer/installer-config-win-jre.xml
    trunk/installer/installer-config.xml
    trunk/installer/unix-shortcuts.xml
    trunk/installer/windows-shortcuts.xml

Added Paths:
-----------
    trunk/bin/gast.bat
    trunk/bin/gast.sh
    trunk/bin/jre/gast-jre.bat

Removed Paths:
-------------
    trunk/bin/jre/start-gast-jre.bat
    trunk/bin/start-gast.bat
    trunk/bin/start-gast.sh

Added: trunk/bin/gast.bat
===================================================================
--- trunk/bin/gast.bat	                        (rev 0)
+++ trunk/bin/gast.bat	2008-02-13 09:30:19 UTC (rev 1083)
@@ -0,0 +1,2 @@
+cd ..\gast
+java -jar gast.jar

Added: trunk/bin/gast.sh
===================================================================
--- trunk/bin/gast.sh	                        (rev 0)
+++ trunk/bin/gast.sh	2008-02-13 09:30:19 UTC (rev 1083)
@@ -0,0 +1,2 @@
+cd ../gast
+java -jar gast.jar

Added: trunk/bin/jre/gast-jre.bat
===================================================================
--- trunk/bin/jre/gast-jre.bat	                        (rev 0)
+++ trunk/bin/jre/gast-jre.bat	2008-02-13 09:30:19 UTC (rev 1083)
@@ -0,0 +1,2 @@
+cd ..\gast
+..\jre1.5.0_12\bin\java -jar gast.jar

Deleted: trunk/bin/jre/start-gast-jre.bat
===================================================================
--- trunk/bin/jre/start-gast-jre.bat	2008-02-13 09:24:40 UTC (rev 1082)
+++ trunk/bin/jre/start-gast-jre.bat	2008-02-13 09:30:19 UTC (rev 1083)
@@ -1,2 +0,0 @@
-cd ..\gast
-..\jre1.5.0_12\bin\java -jar gast.jar

Deleted: trunk/bin/start-gast.bat
===================================================================
--- trunk/bin/start-gast.bat	2008-02-13 09:24:40 UTC (rev 1082)
+++ trunk/bin/start-gast.bat	2008-02-13 09:30:19 UTC (rev 1083)
@@ -1,2 +0,0 @@
-cd ..\gast
-java -jar gast.jar

Deleted: trunk/bin/start-gast.sh
===================================================================
--- trunk/bin/start-gast.sh	2008-02-13 09:24:40 UTC (rev 1082)
+++ trunk/bin/start-gast.sh	2008-02-13 09:30:19 UTC (rev 1083)
@@ -1,2 +0,0 @@
-cd ../gast
-java -jar gast.jar

Modified: trunk/installer/installer-config-win-jre.xml
===================================================================
--- trunk/installer/installer-config-win-jre.xml	2008-02-13 09:24:40 UTC (rev 1082)
+++ trunk/installer/installer-config-win-jre.xml	2008-02-13 09:30:19 UTC (rev 1083)
@@ -89,7 +89,7 @@
 			
 			&lt;singlefile target="$INSTALL_PATH/bin/start-geonetwork.bat" src="../bin/jre/start-geonetwork-jre.bat" override="true"/&gt;
 			&lt;singlefile target="$INSTALL_PATH/bin/stop-geonetwork.bat" src="../bin/jre/stop-geonetwork-jre.bat" override="true"/&gt;
-			&lt;singlefile target="$INSTALL_PATH/bin/start-gast.bat" src="../bin/jre/start-gast-jre.bat" override="true"/&gt;
+			&lt;singlefile target="$INSTALL_PATH/bin/gast.bat" src="../bin/jre/gast-jre.bat" override="true"/&gt;
 			
 			&lt;fileset dir="../jre1.5.0_12"  targetdir="$INSTALL_PATH/jre1.5.0_12" /&gt;
 			
@@ -117,7 +117,7 @@
 			
 			&lt;executable targetfile="$INSTALL_PATH/bin/start-geonetwork.sh" /&gt;
 			&lt;executable targetfile="$INSTALL_PATH/bin/stop-geonetwork.sh" /&gt;
-			&lt;executable targetfile="$INSTALL_PATH/bin/start-gast.sh" /&gt;
+			&lt;executable targetfile="$INSTALL_PATH/bin/gast.sh" /&gt;
 			&lt;executable targetfile="$INSTALL_PATH/gast/gast.jar" 
 							type      ="jar" 
 							keep      ="true"

Modified: trunk/installer/installer-config.xml
===================================================================
--- trunk/installer/installer-config.xml	2008-02-13 09:24:40 UTC (rev 1082)
+++ trunk/installer/installer-config.xml	2008-02-13 09:30:19 UTC (rev 1083)
@@ -115,7 +115,7 @@
 
 			&lt;executable targetfile="$INSTALL_PATH/bin/start-geonetwork.sh" /&gt;
 			&lt;executable targetfile="$INSTALL_PATH/bin/stop-geonetwork.sh" /&gt;
-			&lt;executable targetfile="$INSTALL_PATH/bin/start-gast.sh" /&gt;
+			&lt;executable targetfile="$INSTALL_PATH/bin/gast.sh" /&gt;
 			&lt;executable targetfile="$INSTALL_PATH/gast/gast.jar" 
 							type      ="jar" 
 							keep      ="true"

Modified: trunk/installer/unix-shortcuts.xml
===================================================================
--- trunk/installer/unix-shortcuts.xml	2008-02-13 09:24:40 UTC (rev 1082)
+++ trunk/installer/unix-shortcuts.xml	2008-02-13 09:30:19 UTC (rev 1083)
@@ -85,7 +85,7 @@
 	&lt;shortcut
 		name="Documentation" 
 		description="GeoNetwork opensource documentation"
-		target="$INSTALL_PATH/docs/manuals/"
+		target="$INSTALL_PATH/docs/"
 		commandLine="" 
 		workingDirectory="$INSTALL_PATH" 
 		iconFile="$INSTALL_PATH/bin/ico/docs.ico" 

Modified: trunk/installer/windows-shortcuts.xml
===================================================================
(Binary files differ)


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18609476">[GeoNetwork-commit] SF.net SVN: geonetwork: [1097] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;ticheler@us...&gt; -	2008-02-17 16:54</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1097
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1097&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1097&amp;view=rev</a>
Author:   ticheler
Date:     2008-02-17 08:54:25 -0800 (Sun, 17 Feb 2008)

Log Message:
-----------
Marker updates
Added Mail server port number to InterMap
branch synchronizing updates
prototype fix

Modified Paths:
--------------
    trunk/src/org/wfp/vam/intermap/services/wmc/MailWmcContext.java
    trunk/web/geonetwork/images/georss.png
    trunk/web/geonetwork/scripts/prototype.js
    trunk/web/geonetwork/xsl/header.xsl
    trunk/web/geonetwork/xsl/main-page.xsl
    trunk/web/geonetwork/xsl/metadata-edit.xsl
    trunk/web/geonetwork/xsl/metadata-iso19139.xsl
    trunk/web/geonetwork/xsl/searchform_advanced.xsl
    trunk/web/geonetwork/xsl/searchform_simple_template.xsl
    trunk/web/intermap/WEB-INF/config.xml
    trunk/web/intermap/scripts/im_integration.js
    trunk/web/intermap/scripts/im_markers.js
    trunk/web/intermap/scripts/im_standalone.js
    trunk/web/intermap/scripts/prototype.js
    trunk/web/intermap/xsl/index-embedded.xsl

Added Paths:
-----------
    trunk/web/intermap/images/marker.gif
    trunk/web/intermap/images/markerlist.gif

Removed Paths:
-------------
    trunk/web/geonetwork/images/rss.gif
    trunk/web/intermap/images/marker.png
    trunk/web/intermap/images/marker2.gif
    trunk/web/intermap/images/markerlist.png

Modified: trunk/src/org/wfp/vam/intermap/services/wmc/MailWmcContext.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/services/wmc/MailWmcContext.java	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/src/org/wfp/vam/intermap/services/wmc/MailWmcContext.java	2008-02-17 16:54:25 UTC (rev 1097)
@@ -52,6 +52,7 @@
 {
 	static private File   _xslfile;
 	static private String _mailserver;
+	static private int _smtpport;
 	static private String _gnURL;
 
 	public void init(String appPath, ServiceConfig config) throws Exception
@@ -63,6 +64,16 @@
 		{
 			Logger.getLogger("MailWmcContext").warning("*** The mailserver config property has not been set. WMC mail will not be available.");
 		}
+		
+		try 
+		{
+			_smtpport =Integer.parseInt(config.getValue("smtpport"));
+		}
+		catch (NumberFormatException e)
+		{
+			Logger.getLogger("MailWmcContect").warning("*** The mail server smtpport property has not been set. Using default port 25");
+			_smtpport = 25;
+		}
 	}
 
 	//--------------------------------------------------------------------------
@@ -96,10 +107,12 @@
 		System.out.println("   from: " + mailfrom);
 		System.out.println("   to:   " + mailto);
 		System.out.println("   by: "   + _mailserver);
+		System.out.println("   on port: "   + _smtpport);
 
 		 // Create the email message
 		HtmlEmail email = new HtmlEmail();
 		email.setHostName(_mailserver);
+		email.setSmtpPort(_smtpport);
 		email.addTo(mailto);
 		email.setFrom(mailfrom);
 		email.setSubject(title);

Modified: trunk/web/geonetwork/images/georss.png
===================================================================
(Binary files differ)

Deleted: trunk/web/geonetwork/images/rss.gif
===================================================================
(Binary files differ)

Modified: trunk/web/geonetwork/scripts/prototype.js
===================================================================
--- trunk/web/geonetwork/scripts/prototype.js	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/geonetwork/scripts/prototype.js	2008-02-17 16:54:25 UTC (rev 1097)
@@ -102,7 +102,8 @@
 Function.prototype.bind = function() {
   var __method = this, args = $A(arguments), object = args.shift();
   return function() {
-    return __method.apply(object, args.concat($A(arguments)));
+    if(typeof $A === 'function')
+      return __method.apply(object, args.concat($A(arguments)));
   }
 }
 

Modified: trunk/web/geonetwork/xsl/header.xsl
===================================================================
--- trunk/web/geonetwork/xsl/header.xsl	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/geonetwork/xsl/header.xsl	2008-02-17 16:54:25 UTC (rev 1097)
@@ -15,7 +15,7 @@
 		&lt;link rel="stylesheet" type="text/css" href="{/root/gui/url}/geonetwork.css"/&gt;
 		
 		&lt;!-- Recent updates newsfeed --&gt;
-		&lt;link href="{/root/gui/locService}/rss.latest" rel="alternate" type="application/rss+xml" title="GeoNetwork opensource | {/root/gui/strings/recentAdditions}" /&gt;
+		&lt;link href="{/root/gui/locService}/rss.latest?georss=gml" rel="alternate" type="application/rss+xml" title="GeoNetwork opensource GeoRSS | {/root/gui/strings/recentAdditions}" /&gt;
 		&lt;link href="{/root/gui/locService}/portal.opensearch" rel="search" type="application/opensearchdescription+xml"&gt;
 
 		&lt;xsl:attribute name="title"&gt;GeoNetwork|&lt;xsl:value-of select="//site/organization"/&gt;|&lt;xsl:value-of select="//site/name"/&gt;&lt;/xsl:attribute&gt;

Modified: trunk/web/geonetwork/xsl/main-page.xsl
===================================================================
--- trunk/web/geonetwork/xsl/main-page.xsl	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/geonetwork/xsl/main-page.xsl	2008-02-17 16:54:25 UTC (rev 1097)
@@ -526,11 +526,8 @@
 	--&gt;
 	&lt;xsl:template name="latestUpdates"&gt;
 		&lt;h1 align="left"&gt;
-			&lt;xsl:value-of select="/root/gui/strings/recentAdditions"/&gt; &amp;#160;&amp;#160;&amp;#160; &lt;a
-				href="{/root/gui/locService}/rss.latest"&gt;
-				&lt;img style="cursor:hand;cursor:pointer" src="{/root/gui/url}/images/rss.png"
-					alt="RSS" title="{/root/gui/strings/rss}" align="top"/&gt;
-			&lt;/a&gt; &amp;#160; &lt;a href="{/root/gui/locService}/rss.latest?georss=gml"&gt;
+			&lt;xsl:value-of select="/root/gui/strings/recentAdditions"/&gt; &amp;#160;&amp;#160;&amp;#160; 
+			&lt;a href="{/root/gui/locService}/rss.latest?georss=gml"&gt;
 				&lt;img style="cursor:hand;cursor:pointer" src="{/root/gui/url}/images/georss.png"
 					alt="GeoRSS-GML" title="{/root/gui/strings/georss}" align="top"/&gt;
 			&lt;/a&gt;

Modified: trunk/web/geonetwork/xsl/metadata-edit.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-edit.xsl	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/geonetwork/xsl/metadata-edit.xsl	2008-02-17 16:54:25 UTC (rev 1097)
@@ -249,18 +249,18 @@
 				&lt;/xsl:if&gt;
 				&lt;xsl:value-of select="/root/gui/strings/template"/&gt;
 			&lt;/option&gt;
-			&lt;option value="s"&gt;
+			&lt;!-- &lt;option value="s"&gt;
 				&lt;xsl:if test="string(geonet:info/isTemplate)='s'"&gt;
 					&lt;xsl:attribute name="selected"&gt;true&lt;/xsl:attribute&gt;
 				&lt;/xsl:if&gt;
 				&lt;xsl:value-of select="/root/gui/strings/subtemplate"/&gt;
-			&lt;/option&gt;
+			&lt;/option&gt; --&gt;
 		&lt;/select&gt;
-		&lt;xsl:text&gt;&amp;#160;&lt;/xsl:text&gt;
+		&lt;!--&lt;xsl:text&gt;&amp;#160;&lt;/xsl:text&gt;
 		&lt;xsl:value-of select="/root/gui/strings/subtemplateTitle"/&gt;
 		&lt;xsl:text&gt;&amp;#160;&lt;/xsl:text&gt;
 		&lt;input class="content" type="text" name="title" value="{geonet:info/title}"/&gt;
-		&lt;!--
+		
 		&lt;input class="content" type="checkbox" name="template"&gt;
 			&lt;xsl:if test="geonet:info/isTemplate='y'"&gt;
 				&lt;xsl:attribute name="checked"/&gt;

Modified: trunk/web/geonetwork/xsl/metadata-iso19139.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-02-17 16:54:25 UTC (rev 1097)
@@ -1978,7 +1978,21 @@
 						&lt;/xsl:element&gt;
 
 				&lt;/xsl:if&gt;
-				
+
+				&lt;!-- Generate a KML output link for a WMS service --&gt;
+				&lt;xsl:if test="string($linkage)!='' and starts-with($protocol,'OGC:WMS-') and contains($protocol,'-get-map') and $name"&gt;
+					
+					&lt;xsl:element name="link"&gt;
+						&lt;xsl:attribute name="title"&gt;&lt;xsl:value-of select="$desc"/&gt;&lt;/xsl:attribute&gt;
+						&lt;xsl:attribute name="href"&gt;
+							&lt;xsl:value-of select="concat('<a href="http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?id=',$id,'&amp;amp;layers=',$name)"/" target="_new">http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?id=',$id,'&amp;amp;layers=',$name)"/</a>&gt;
+						&lt;/xsl:attribute&gt;
+						&lt;xsl:attribute name="name"&gt;&lt;xsl:value-of select="$name"/&gt;&lt;/xsl:attribute&gt;
+						&lt;xsl:attribute name="type"&gt;application/vnd.google-earth.kml+xml&lt;/xsl:attribute&gt;
+					&lt;/xsl:element&gt;
+				&lt;/xsl:if&gt;
+
+				&lt;!-- The old links still in use by some systems. Deprecated --&gt;
 				&lt;xsl:choose&gt;
 					&lt;xsl:when test="starts-with($protocol,'WWW:DOWNLOAD-') and contains($protocol,'http--download') and $name"&gt;
 						&lt;link type="download"&gt;&lt;xsl:value-of select="$linkage"/&gt;&lt;/link&gt;
@@ -1993,9 +2007,7 @@
 						&lt;link type="wms"&gt;
 &lt;!--							&lt;xsl:value-of select="concat('javascript:popInterMap(&amp;#34;',/root/gui/url,'/intermap/srv/',/root/gui/language,'/map.addServicesExt?url=',$linkage,'&amp;amp;service=',$name,'&amp;amp;type=2&amp;#34;)')"/&gt;--&gt;
 							&lt;xsl:value-of select="concat('javascript:runIM_addService(&amp;#34;'  ,  $linkage  ,  '&amp;#34;, &amp;#34;', $name  ,'&amp;#34;, 2)' )"/&gt;
-							
 						&lt;/link&gt;
-
 						&lt;link type="googleearth"&gt;
 							&lt;xsl:value-of select="concat(/root/gui/locService,'/google.kml?id=',$id,'&amp;amp;layers=',$name)"/&gt;
 						&lt;/link&gt;

Modified: trunk/web/geonetwork/xsl/searchform_advanced.xsl
===================================================================
--- trunk/web/geonetwork/xsl/searchform_advanced.xsl	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/geonetwork/xsl/searchform_advanced.xsl	2008-02-17 16:54:25 UTC (rev 1097)
@@ -120,35 +120,35 @@
 					&lt;table width="100%"&gt;
 						&lt;tr&gt;
 							&lt;td&gt;
-								&lt;input name="digital" id="digital" type="checkbox" value="on"&gt;
-									&lt;xsl:if test="/root/gui/searchDefaults/digital='on'"&gt;
-										&lt;xsl:attribute name="checked"/&gt;
-									&lt;/xsl:if&gt;
-									&lt;xsl:value-of select="/root/gui/strings/digital"/&gt;
-								&lt;/input&gt;
-								&lt;br/&gt;
-								&lt;input name="paper" id="paper" type="checkbox" value="on"&gt;
-									&lt;xsl:if test="/root/gui/searchDefaults/paper='on'"&gt;
-										&lt;xsl:attribute name="checked"/&gt;
-									&lt;/xsl:if&gt;
-									&lt;xsl:value-of select="/root/gui/strings/paper"/&gt;
-								&lt;/input&gt;
-							&lt;/td&gt;
-							&lt;td&gt;
-								&lt;input name="dynamic" id="dynamic" type="checkbox"&gt;
-									&lt;xsl:if test="/root/gui/searchDefaults/dynamic='on'"&gt;
-										&lt;xsl:attribute name="checked"/&gt;
-									&lt;/xsl:if&gt;
-									&lt;xsl:value-of select="/root/gui/strings/dynamic"/&gt;
-								&lt;/input&gt;
-								&lt;br/&gt;
-								&lt;input name="download" id="download" type="checkbox"&gt;
-									&lt;xsl:if test="/root/gui/searchDefaults/download='on'"&gt;
-										&lt;xsl:attribute name="checked"/&gt;
-									&lt;/xsl:if&gt;
-									&lt;xsl:value-of select="/root/gui/strings/downloadable"/&gt;
-								&lt;/input&gt;
-							&lt;/td&gt;
+							&lt;input name="digital" id="digital" type="checkbox" value="on"&gt;
+                        		&lt;xsl:if test="/root/gui/searchDefaults/digital='on'"&gt;
+		                            &lt;xsl:attribute name="checked"/&gt;
+		                        &lt;/xsl:if&gt;
+		                        &lt;label for="digital"&gt;&lt;xsl:value-of select="/root/gui/strings/digital"/&gt;&lt;/label&gt;
+		                    &lt;/input&gt;
+							&lt;br/&gt;
+		                    &lt;input name="paper" id="paper" type="checkbox" value="on"&gt;
+		                        &lt;xsl:if test="/root/gui/searchDefaults/paper='on'"&gt;
+		                            &lt;xsl:attribute name="checked"/&gt;
+		                        &lt;/xsl:if&gt;
+		                        &lt;label for="paper"&gt;&lt;xsl:value-of select="/root/gui/strings/paper"/&gt;&lt;/label&gt;
+		                    &lt;/input&gt;
+						&lt;/td&gt;
+						&lt;td&gt;
+	    	                &lt;input name="dynamic" id="dynamic" type="checkbox"&gt;
+    	    	                &lt;xsl:if test="/root/gui/searchDefaults/dynamic='on'"&gt;
+                	            &lt;xsl:attribute name="checked"/&gt;
+                    	    &lt;/xsl:if&gt;
+		                        &lt;label for="dynamic"&gt;&lt;xsl:value-of select="/root/gui/strings/dynamic"/&gt;&lt;/label&gt;
+		                    &lt;/input&gt;
+							&lt;br/&gt;
+		                    &lt;input name="download" id="download" type="checkbox"&gt;
+		                        &lt;xsl:if test="/root/gui/searchDefaults/download='on'"&gt;
+	    	                        &lt;xsl:attribute name="checked"/&gt;
+            	    	        &lt;/xsl:if&gt;
+                	    	    &lt;label for="download"&gt;&lt;xsl:value-of select="/root/gui/strings/downloadable"/&gt;&lt;/label&gt;
+		                    &lt;/input&gt;
+        	           		&lt;/td&gt;
 						&lt;/tr&gt;
 					&lt;/table&gt;
 &lt;!--					&lt;br/&gt;
@@ -361,7 +361,7 @@
 					&lt;xsl:if test="string(/root/gui/searchDefaults/dateFrom)='' and string(/root/gui/searchDefaults/dateTo)=''"&gt;
 						&lt;xsl:attribute name="checked" /&gt;
  					&lt;/xsl:if&gt;
-					&lt;xsl:value-of select="/root/gui/strings/anytime"/&gt;
+					&lt;label for="radfrom0"&gt;&lt;xsl:value-of select="/root/gui/strings/anytime"/&gt;&lt;/label&gt;
 				&lt;/input&gt;
 			&lt;/td&gt;
 		&lt;/tr&gt;

Modified: trunk/web/geonetwork/xsl/searchform_simple_template.xsl
===================================================================
--- trunk/web/geonetwork/xsl/searchform_simple_template.xsl	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/geonetwork/xsl/searchform_simple_template.xsl	2008-02-17 16:54:25 UTC (rev 1097)
@@ -5,7 +5,6 @@
 
 
 	&lt;xsl:template name="geofields"&gt;
-		&lt;form name="defsearch" id="defsearch" onsubmit="javascript:runSimpleSearch();"&gt;
 		&lt;table class="geosearchfields" width="211px"&gt;
 			&lt;tr&gt;
 				&lt;td rowspan="6" style="vertical-align: bottom;"&gt;
@@ -230,7 +229,7 @@
 				&lt;/td&gt;
 			&lt;/tr&gt;
 		&lt;/table&gt;
-		&lt;/form&gt;
+		
 	&lt;/xsl:template&gt;
 
 &lt;/xsl:stylesheet&gt;

Modified: trunk/web/intermap/WEB-INF/config.xml
===================================================================
--- trunk/web/intermap/WEB-INF/config.xml	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/intermap/WEB-INF/config.xml	2008-02-17 16:54:25 UTC (rev 1097)
@@ -528,7 +528,8 @@
 			
 			&lt;class name=".services.wmc.MailWmcContext"&gt;
 				&lt;param name="customstylesheet" value="../web/intermap/xsl/im_wmc_custom_mail.xsl"/&gt;
-				&lt;!--&lt;param name="mailserver" value=""/&gt;--&gt; &lt;!-- PLEASE  SET THIS PARAM TO A VALID MAIL SERVER --&gt;				
+				&lt;!--&lt;param name="mailserver" value=""/&gt;--&gt; &lt;!-- PLEASE  SET THIS PARAM TO A VALID MAIL SERVER --&gt;	
+				&lt;param name="smtpport" value="25"/&gt;	 &lt;!-- port 25 is the default value --&gt;	
 				&lt;param name="gnurl" value="<a href="http://localhost:8080/geonetwork/srv/en/main.home"/" target="_new">http://localhost:8080/geonetwork/srv/en/main.home"/</a>&gt; &lt;!-- THIS PARAM HAS TO BE CONFIGURED BY THE INSTALLER --&gt;				
 			&lt;/class&gt;
 			

Added: trunk/web/intermap/images/marker.gif
===================================================================
(Binary files differ)


Property changes on: trunk/web/intermap/images/marker.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: trunk/web/intermap/images/marker.png
===================================================================
(Binary files differ)

Deleted: trunk/web/intermap/images/marker2.gif
===================================================================
(Binary files differ)

Added: trunk/web/intermap/images/markerlist.gif
===================================================================
(Binary files differ)


Property changes on: trunk/web/intermap/images/markerlist.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: trunk/web/intermap/images/markerlist.png
===================================================================
(Binary files differ)

Modified: trunk/web/intermap/scripts/im_integration.js
===================================================================
--- trunk/web/intermap/scripts/im_integration.js	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/intermap/scripts/im_integration.js	2008-02-17 16:54:25 UTC (rev 1097)
@@ -5,21 +5,33 @@
 //
 //===================================================================
 
+//===================================================================
+// DEBUG
+//
+// Next lines will popup an alert window 
+// whenever a prototype error happens.
+// Set debug to true to enable full alert messages
+//
+//===================================================================
+
 Ajax.Responders.register({
   onException: function(req, e){
+
+	var debug = false;
+
 	var qqq = document.createElement('div');
 	qqq.innerHTML = "Exception '" + e.message + "'";
 	document.body.appendChild(qqq);
 	
-	alert("Exception: " + e.message + 
-		  "\nFile "+e.fileName+ 
-		  "\nLine " +e.lineNumber+
-		  "\nStack " +e.stack);
+	if (debug) {
+		alert("Exception: " + e.message + 
+			  "\nFile "+e.fileName+ 
+			  "\nLine " +e.lineNumber+
+			  "\nStack " +e.stack);
+	}
   }
 });
 
-
-
 /**
  * Init the mm+bm
  * 

Modified: trunk/web/intermap/scripts/im_markers.js
===================================================================
--- trunk/web/intermap/scripts/im_markers.js	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/intermap/scripts/im_markers.js	2008-02-17 16:54:25 UTC (rev 1097)
@@ -9,6 +9,10 @@
 
 var im_mark_tmp_id = 0;
 
+//The marker offset ensures the point of the marker image is presented on the point clicked with the mouse
+var marker_offset_x = 6;
+var marker_offset_y = 22;
+
  function im_setMark(e)
 {
 	Event.stop(e); // prevents from dragging the map image (on Firefox)
@@ -38,10 +42,11 @@
 	var img = document.createElement("img");
 	img.id='im_marker_img_tmp';
 	img.className = 'im_marker';
-	img.src = '/intermap/images/marker.png'; // FIXME context
+	img.src = '/intermap/images/marker.gif'; // FIXME context
 	// FIXME the image should be centered on the mouse click
-	img.style.left = pointerX;
-	img.style.top = pointerY;           
+
+	img.style.left = pointerX - 6;
+	img.style.top = pointerY - 21;           
 	document.body.appendChild(img);    
 	
 	
@@ -302,12 +307,12 @@
 	var img = document.createElement("img");
 	img.id='im_marker_' + (btemp?"tmp_":"") + id;
 	img.className = 'im_marker';
-	img.src = '/intermap/images/marker2.gif'; // FIXME 
+	img.src = '/intermap/images/marker.gif'; // FIXME 
 	img.title = title;
 
 	// FIXME the image should be centered on the coords	
-	img.style.left = x + offsetX - img.width/2;
-	img.style.top  = y + offsetY - img.height/2;
+	img.style.left = x + offsetX - 6;
+	img.style.top  = y + offsetY - 21;
 	
 	document.body.appendChild(img);
 

Modified: trunk/web/intermap/scripts/im_standalone.js
===================================================================
--- trunk/web/intermap/scripts/im_standalone.js	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/intermap/scripts/im_standalone.js	2008-02-17 16:54:25 UTC (rev 1097)
@@ -14,8 +14,36 @@
 //
 //===================================================================
 
+
 //===================================================================
+// DEBUG
 //
+// Next lines will popup an alert window 
+// whenever a prototype error happens.
+// Set debug to true to enable full alert messages
+//
+//===================================================================
+
+Ajax.Responders.register({
+  onException: function(req, e){
+
+  	var debug = false;
+
+	var qqq = document.createElement('div');
+	qqq.innerHTML = "Exception '" + e.message + "'";
+	document.body.appendChild(qqq);
+	
+	if (debug) {
+		alert("Exception: " + e.message + 
+			  "\nFile "+e.fileName+ 
+			  "\nLine " +e.lineNumber+
+			  "\nStack " +e.stack);
+	}
+  }
+});
+
+//===================================================================
+//
 // InterMap Entry Points
 //
 // External scripts can call the imep_* functions to update
@@ -92,28 +120,7 @@
 	
 }
 
-
 //===================================================================
-// DEBUG
-//
-// Next lines will popup an alert window 
-// whenever a prototype error happens.
-//===================================================================
-
-Ajax.Responders.register({
-  onException: function(req, e){
-	var qqq = document.createElement('div');
-	qqq.innerHTML = "Exception '" + e.message + "'";
-	document.body.appendChild(qqq);
-	
-	alert("Exception: " + e.message + 
-		  "\nFile "+e.fileName+ 
-		  "\nLine " +e.lineNumber+
-		  "\nStack " +e.stack);
-  }
-});
-
-//===================================================================
 // BOOT
 // 
 // Functions related to the map bootstrap

Modified: trunk/web/intermap/scripts/prototype.js
===================================================================
--- trunk/web/intermap/scripts/prototype.js	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/intermap/scripts/prototype.js	2008-02-17 16:54:25 UTC (rev 1097)
@@ -102,7 +102,8 @@
 Function.prototype.bind = function() {
   var __method = this, args = $A(arguments), object = args.shift();
   return function() {
-    return __method.apply(object, args.concat($A(arguments)));
+    if(typeof $A === 'function')
+      return __method.apply(object, args.concat($A(arguments)));
   }
 }
 

Modified: trunk/web/intermap/xsl/index-embedded.xsl
===================================================================
--- trunk/web/intermap/xsl/index-embedded.xsl	2008-02-17 16:50:24 UTC (rev 1096)
+++ trunk/web/intermap/xsl/index-embedded.xsl	2008-02-17 16:54:25 UTC (rev 1097)
@@ -23,7 +23,7 @@
 								&lt;td class="im_tool" id="im_tool_zoomin" onClick="javascript:setTool('zoomin');" &gt;&lt;img src="{/root/gui/url}/images/zoomin.png" title="{/root/gui/strings/zoomIn}"/&gt;&lt;/td&gt;
 								&lt;td class="im_tool" id="im_tool_zoomout" onClick="javascript:setTool('zoomout');"&gt;&lt;img  src="{/root/gui/url}/images/zoomout.png" title="{/root/gui/strings/zoomOut}"/&gt;&lt;/td&gt;
 								&lt;td class="im_tool" id="im_tool_pan" onClick="javascript:setTool('pan');"&gt;&lt;img src="{/root/gui/url}/images/pan.png" title="{/root/gui/strings/pan}"/&gt;&lt;/td&gt;															
-								&lt;td class="im_tool" id="im_tool_mark" onClick="javascript:setTool('mark');"&gt;&lt;img src="{/root/gui/url}/images/marker.png" title="{/root/gui/strings/marker}"/&gt;&lt;/td&gt;
+								&lt;td class="im_tool" id="im_tool_mark" onClick="javascript:setTool('mark');"&gt;&lt;img src="{/root/gui/url}/images/marker.gif" title="{/root/gui/strings/marker}"/&gt;&lt;/td&gt;
 &lt;!--								&lt;td class="im_tool" id="im_tool_zoomsel"	onClick="javascript:imc_zoomToLayer(activeLayerId)"&gt;&lt;img src="{/root/gui/url}/images/zoomsel.png" title="Zoom to selected layer extent"/&gt;&lt;/td&gt; --&gt;
 &lt;!--								&lt;td class="im_tool" id="im_tool_aoi"		onClick="javascript:setTool('aoi')"&gt;&lt;img src="{/root/gui/url}/images/im_aoi16x16.png" title="Select an Area Of Interest"/&gt;&lt;/td&gt; --&gt; 
 								&lt;td class="im_tool" id="im_tool_identify"	onClick="javascript:setTool('identify');"&gt;&lt;img src="{/root/gui/url}/images/info.png" title="{/root/gui/strings/identify}"/&gt;&lt;/td&gt;
@@ -125,7 +125,7 @@
 								&lt;td style="padding:2px" onClick="im_openWMCform('mail');" &gt;&lt;a&gt;&lt;img src="{/root/gui/url}/images/im_mail.png" title="{/root/gui/strings/wmcbuttonmail}"/&gt;&lt;/a&gt;&lt;/td&gt;								
 								&lt;td style="padding:2px" onClick="im_openWMCform('upload');" &gt;&lt;a&gt;&lt;img src="{/root/gui/url}/images/fileopen.png" title="{/root/gui/strings/wmcbuttonupload}"/&gt;&lt;/a&gt;&lt;/td&gt;								
 								&lt;td style="padding:2px" onClick="im_downloadWMC();" &gt;&lt;a&gt;&lt;img src="{/root/gui/url}/images/filesave.png" title="{/root/gui/strings/wmcbuttondownload}"/&gt;&lt;/a&gt;&lt;/td&gt;
-								&lt;td style="padding:2px" onClick="im_markerList();" &gt;&lt;a&gt;&lt;img src="{/root/gui/url}/images/markerlist.png" title="{/root/gui/strings/markerlistbutton}"/&gt;&lt;/a&gt;&lt;/td&gt;
+								&lt;td style="padding:2px" onClick="im_markerList();" &gt;&lt;a&gt;&lt;img src="{/root/gui/url}/images/markerlist.gif" title="{/root/gui/strings/markerlistbutton}" width="16px"/&gt;&lt;/a&gt;&lt;/td&gt;
 								
 								&lt;td width="100%" style="border-top:0px;"/&gt; &lt;!-- spacer --&gt;								
 								&lt;td class="im_tool" id="im_tool_scale"&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18643080">[GeoNetwork-commit] SF.net SVN: geonetwork: [1127] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;ticheler@us...&gt; -	2008-02-21 14:56</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1127
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1127&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1127&amp;view=rev</a>
Author:   ticheler
Date:     2008-02-21 06:56:53 -0800 (Thu, 21 Feb 2008)

Log Message:
-----------
Add and remove parent - child relations between metadata records. (No GUI is provided with this service and the functionality relates to the already existing xml.relation.get search function)

Modified Paths:
--------------
    trunk/src/org/fao/geonet/constants/Params.java
    trunk/web/geonetwork/WEB-INF/config.xml
    trunk/web/geonetwork/xml/user-profiles.xml

Added Paths:
-----------
    trunk/src/org/fao/geonet/services/relations/Insert.java
    trunk/src/org/fao/geonet/services/relations/Remove.java

Modified: trunk/src/org/fao/geonet/constants/Params.java
===================================================================
--- trunk/src/org/fao/geonet/constants/Params.java	2008-02-21 14:52:50 UTC (rev 1126)
+++ trunk/src/org/fao/geonet/constants/Params.java	2008-02-21 14:56:53 UTC (rev 1127)
@@ -44,6 +44,8 @@
 	public static final String GROUP        = "group";
 	public static final String GROUPS       = "groups";
 	public static final String ID           = "id";
+    public static final String PARENT_ID    = "parentId";
+    public static final String CHILD_ID     = "childId";
 	public static final String UUID         = "uuid";
 	public static final String URI          = "uri";
 	public static final String NAME         = "name";

Added: trunk/src/org/fao/geonet/services/relations/Insert.java
===================================================================
--- trunk/src/org/fao/geonet/services/relations/Insert.java	                        (rev 0)
+++ trunk/src/org/fao/geonet/services/relations/Insert.java	2008-02-21 14:56:53 UTC (rev 1127)
@@ -0,0 +1,85 @@
+//=============================================================================
+//===	Copyright (C) 2001-2007 Food and Agriculture Organization of the
+//===	United Nations (FAO-UN), United Nations World Food Programme (WFP)
+//===	and United Nations Environment Programme (UNEP)
+//===
+//===	This program is free software; you can redistribute it and/or modify
+//===	it under the terms of the GNU General Public License as published by
+//===	the Free Software Foundation; either version 2 of the License, or (at
+//===	your option) any later version.
+//===
+//===	This program is distributed in the hope that it will be useful, but
+//===	WITHOUT ANY WARRANTY; without even the implied warranty of
+//===	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+//===	General Public License for more details.
+//===
+//===	You should have received a copy of the GNU General Public License
+//===	along with this program; if not, write to the Free Software
+//===	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+//===
+//===	Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
+//===	Rome - Italy. email: geonetwork@...
+//==============================================================================
+
+package org.fao.geonet.services.relations;
+
+import jeeves.constants.Jeeves;
+import jeeves.interfaces.Service;
+import jeeves.resources.dbms.Dbms;
+import jeeves.server.ServiceConfig;
+import jeeves.server.context.ServiceContext;
+import jeeves.utils.Util;
+import org.fao.geonet.constants.Geonet;
+import org.fao.geonet.constants.Params;
+import org.jdom.Element;
+
+//=============================================================================
+
+/** Insert the relation between two metadata records
+ * 
+  */
+
+public class Insert implements Service
+{
+	//--------------------------------------------------------------------------
+	//---
+	//--- Init
+	//---
+	//--------------------------------------------------------------------------
+
+	public void init(String appPath, ServiceConfig params) throws Exception {}
+
+	//--------------------------------------------------------------------------
+	//---
+	//--- Service
+	//---
+	//--------------------------------------------------------------------------
+	
+	
+	/* Insert the relation between two metadata records
+	 * @see jeeves.interfaces.Service#exec(org.jdom.Element, jeeves.server.context.ServiceContext)
+	 * Parameter name: parentId - Parent metadata identifier 
+     * Parameter name: childId - Child metadata identifier 
+     */
+	public Element exec(Element params, ServiceContext context) throws Exception
+	{
+		int parentId       = Util.getParamAsInt(params, Params.PARENT_ID);
+		int childId = Util.getParamAsInt(params, Params.CHILD_ID);
+
+		Dbms dbms = (Dbms) context.getResourceManager().open (Geonet.Res.MAIN_DB);
+
+		// Add new relation
+		String query = "INSERT INTO Relations (id, relatedId) "+"VALUES (?, ?)";
+
+		dbms.execute(query, parentId, childId);
+		
+		Element response = new Element(Jeeves.Elem.RESPONSE)
+		    .addContent(new Element("parentId").setText(String.valueOf(parentId)))
+		    .addContent(new Element("childId").setText(String.valueOf(childId)));
+		
+		return response;
+	}
+}
+
+//=============================================================================
+

Added: trunk/src/org/fao/geonet/services/relations/Remove.java
===================================================================
--- trunk/src/org/fao/geonet/services/relations/Remove.java	                        (rev 0)
+++ trunk/src/org/fao/geonet/services/relations/Remove.java	2008-02-21 14:56:53 UTC (rev 1127)
@@ -0,0 +1,73 @@
+//=============================================================================
+//===	Copyright (C) 2001-2007 Food and Agriculture Organization of the
+//===	United Nations (FAO-UN), United Nations World Food Programme (WFP)
+//===	and United Nations Environment Programme (UNEP)
+//===
+//===	This program is free software; you can redistribute it and/or modify
+//===	it under the terms of the GNU General Public License as published by
+//===	the Free Software Foundation; either version 2 of the License, or (at
+//===	your option) any later version.
+//===
+//===	This program is distributed in the hope that it will be useful, but
+//===	WITHOUT ANY WARRANTY; without even the implied warranty of
+//===	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+//===	General Public License for more details.
+//===
+//===	You should have received a copy of the GNU General Public License
+//===	along with this program; if not, write to the Free Software
+//===	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+//===
+//===	Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
+//===	Rome - Italy. email: geonetwork@...
+//==============================================================================
+
+package org.fao.geonet.services.relations;
+
+import org.jdom.*;
+
+import jeeves.constants.*;
+import jeeves.interfaces.*;
+import jeeves.resources.dbms.*;
+import jeeves.server.*;
+import jeeves.server.context.*;
+import jeeves.utils.*;
+
+import org.fao.geonet.constants.*;
+
+//=============================================================================
+
+/** Removes a user from the system. It removes the relationship to a group too
+  */
+
+public class Remove implements Service
+{
+	//--------------------------------------------------------------------------
+	//---
+	//--- Init
+	//---
+	//--------------------------------------------------------------------------
+
+	public void init(String appPath, ServiceConfig params) throws Exception {}
+
+	//--------------------------------------------------------------------------
+	//---
+	//--- Service to delete a related resource
+	//--- 
+	//--------------------------------------------------------------------------
+
+	public Element exec(Element params, ServiceContext context) throws Exception
+	{
+		int parentId = Util.getParamAsInt(params, Params.PARENT_ID);
+        int childId = Util.getParamAsInt(params, Params.CHILD_ID);
+
+		Dbms dbms = (Dbms) context.getResourceManager().open (Geonet.Res.MAIN_DB);
+
+		dbms.execute ("DELETE FROM Relations WHERE id=" + String.valueOf(parentId) 
+		        + " AND relatedId=" + String.valueOf(childId));
+
+		return new Element(Jeeves.Elem.RESPONSE);
+	}
+}
+
+//=============================================================================
+

Modified: trunk/web/geonetwork/WEB-INF/config.xml
===================================================================
--- trunk/web/geonetwork/WEB-INF/config.xml	2008-02-21 14:52:50 UTC (rev 1126)
+++ trunk/web/geonetwork/WEB-INF/config.xml	2008-02-21 14:56:53 UTC (rev 1127)
@@ -773,6 +773,20 @@
 			&lt;/output&gt;
 		&lt;/service&gt;
 
+		&lt;service name="xml.relation.insert"&gt;
+			&lt;class name=".services.relations.Insert" /&gt;
+			&lt;error id="insert" sheet="error.xsl"&gt;
+				&lt;xml  name="error"   file="xml/error.xml" /&gt;
+			&lt;/error&gt;
+		&lt;/service&gt;
+		
+		&lt;service name="xml.relation.delete"&gt;
+			&lt;class name=".services.relations.Remove" /&gt;
+			&lt;error id="delete" sheet="error.xsl"&gt;
+				&lt;xml  name="error"   file="xml/error.xml" /&gt;
+			&lt;/error&gt;
+		&lt;/service&gt;
+		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
 		&lt;!-- Thesaurus services                                             --&gt;
 		&lt;!-- Search Keywords services --&gt;

Modified: trunk/web/geonetwork/xml/user-profiles.xml
===================================================================
--- trunk/web/geonetwork/xml/user-profiles.xml	2008-02-21 14:52:50 UTC (rev 1126)
+++ trunk/web/geonetwork/xml/user-profiles.xml	2008-02-21 14:56:53 UTC (rev 1127)
@@ -152,6 +152,10 @@
 		&lt;!-- MEF facilities --&gt;
 		&lt;allow service="mef.import"/&gt;
 
+		&lt;!-- Relation services --&gt;
+		&lt;allow service="xml.relation.insert"/&gt;
+		&lt;allow service="xml.relation.delete"/&gt;
+		
 	&lt;/profile&gt;
 
 	&lt;!-- ====================================================================== --&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18643269">[GeoNetwork-commit] SF.net SVN: geonetwork: [1133] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;ticheler@us...&gt; -	2008-02-21 15:19</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1133
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1133&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1133&amp;view=rev</a>
Author:   ticheler
Date:     2008-02-21 07:19:28 -0800 (Thu, 21 Feb 2008)

Log Message:
-----------
Changed startup scripts for Windows to hide (or allow to hide) the dos window. Patch by Zha Zhuhua

Modified Paths:
--------------
    trunk/bin/gast.bat
    trunk/bin/start-geonetwork.bat
    trunk/csw/cswClient.bat

Modified: trunk/bin/gast.bat
===================================================================
--- trunk/bin/gast.bat	2008-02-21 15:18:51 UTC (rev 1132)
+++ trunk/bin/gast.bat	2008-02-21 15:19:28 UTC (rev 1133)
@@ -1,2 +1,2 @@
 cd ..\gast
-java -jar gast.jar
+start javaw -jar gast.jar

Modified: trunk/bin/start-geonetwork.bat
===================================================================
--- trunk/bin/start-geonetwork.bat	2008-02-21 15:18:51 UTC (rev 1132)
+++ trunk/bin/start-geonetwork.bat	2008-02-21 15:19:28 UTC (rev 1133)
@@ -6,4 +6,9 @@
 rem try changing the Xmx parameter if your machine has little RAM
 rem java -Xms48m -Xmx256m -DSTOP.PORT=8079 -jar start.jar ..\bin\jetty.xml
 
-java -Xms48m -Xmx512m -DSTOP.PORT=8079 -jar start.jar ..\bin\jetty.xml
\ No newline at end of file
+rem if you want to hide the dos window when GeoNetwork is started, 
+rem comment out the next line and comment the last line
+
+java -Xms48m -Xmx512m -DSTOP.PORT=8079 -jar start.jar ..\bin\jetty.xml
+
+rem start javaw -Xms48m -Xmx512m -DSTOP.PORT=8079 -jar start.jar ..\bin\jetty.xml
\ No newline at end of file

Modified: trunk/csw/cswClient.bat
===================================================================
--- trunk/csw/cswClient.bat	2008-02-21 15:18:51 UTC (rev 1132)
+++ trunk/csw/cswClient.bat	2008-02-21 15:19:28 UTC (rev 1133)
@@ -3,5 +3,5 @@
 setlocal EnableDelayedExpansion
 set CP=lib/csw-client.jar;lib/csw-common.jar
 for %%g in (../web/geonetwork/WEB-INF/lib/*.jar) do set CP=!CP!;"../web/geonetwork/WEB-INF/lib/%%g"
-java -cp %CP% org.fao.geonet.csw.client.CswClient
+start javaw -cp %CP% org.fao.geonet.csw.client.CswClient
 endlocal


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18691697">[GeoNetwork-commit] SF.net SVN: geonetwork: [1146] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;ticheler@us...&gt; -	2008-02-27 15:01</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1146
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1146&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1146&amp;view=rev</a>
Author:   ticheler
Date:     2008-02-27 07:00:40 -0800 (Wed, 27 Feb 2008)

Log Message:
-----------
Updated strings &amp; documentation
Fix for feedback

Modified Paths:
--------------
    trunk/docs/docbook/gn_manual/admin_gast.xml
    trunk/docs/docbook/gn_manual/admin_import_export_tools.xml
    trunk/docs/docbook/styles/pdf/custom.xsl
    trunk/src/org/fao/geonet/services/feedback/Insert.java
    trunk/src/org/fao/geonet/services/resources/Download.java
    trunk/web/geonetwork/loc/ar/xml/config.xml
    trunk/web/geonetwork/loc/ar/xml/strings.xml
    trunk/web/geonetwork/loc/cn/xml/config.xml
    trunk/web/geonetwork/loc/cn/xml/metadata-validate.xml
    trunk/web/geonetwork/loc/cn/xml/strings.xml
    trunk/web/geonetwork/loc/en/xml/strings.xml
    trunk/web/geonetwork/loc/es/xml/config.xml
    trunk/web/geonetwork/loc/es/xml/metadata-validate.xml
    trunk/web/geonetwork/loc/es/xml/strings.xml
    trunk/web/geonetwork/loc/fr/xml/strings.xml

Modified: trunk/docs/docbook/gn_manual/admin_gast.xml
===================================================================
--- trunk/docs/docbook/gn_manual/admin_gast.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/docs/docbook/gn_manual/admin_gast.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -6,7 +6,7 @@
         &lt;title&gt;GeoNetworkâ€™s Administrator Survival Tool - GAST&lt;/title&gt;
         &lt;section&gt;
             &lt;title&gt;What is GAST?&lt;/title&gt;
-            &lt;para&gt;GAST stands for "GeoNetworkâ€™s Administrator Survival Toolâ€? and is a standalone
+            &lt;para&gt;GAST stands for &lt;literal&gt;GeoNetworkâ€™s Administrator Survival Tool&lt;/literal&gt; and is a standalone
                 application whose purpose is to simplify some low level tasks like change of the
                 servlet, configuration of the JDBC account, setup the database and so on. Most
                 of the GASTâ€™s facilities work only for the GeoNetworkâ€™s installation where GAST
@@ -14,32 +14,29 @@
                 (like Tomcat) you will not be able to change some options (like the servletâ€™s
                 name). Other facilities work for any servlet container but you have to specify
                 the GeoNetworkâ€™s URL into the GASTâ€™s configuration dialog.&lt;/para&gt;
-            
         &lt;/section&gt;
         &lt;section&gt;
             &lt;title&gt;Starting GAST&lt;/title&gt;
-            &lt;para&gt;GAST belongs to the core components so it is installed by default. It is
-                located into the gast folder and to start it you can either use the java command
-                or just click its jarâ€™s icon. To use the java command you have to:&lt;/para&gt;
-            
+            &lt;para&gt;GAST belongs to the core components so it is installed by default.&lt;/para&gt;
+            &lt;para&gt;On Windows computers, simply select the &lt;literal&gt;Start GAST&lt;/literal&gt; option under the 
+                GeoNetwork opensource program group under &lt;literal&gt;Start &gt; Programs &gt; GeoNetwork opensource&lt;/literal&gt;&lt;/para&gt;
+            &lt;para&gt;Other options to start GAST are either to use a java command &lt;emphasis 
+                role="bold"&gt;from a terminal window&lt;/emphasis&gt;
+                or just click its jarâ€™s icon. To issue the java command you have to:&lt;/para&gt;
             &lt;orderedlist&gt;
                 &lt;listitem&gt;
-                    &lt;para&gt;from the GeoNetworkâ€™s root folder, issue the command:&lt;/para&gt;
+                    &lt;para&gt;change directory to the GeoNetwork installation folder&lt;/para&gt;
                 &lt;/listitem&gt;
-            &lt;/orderedlist&gt;
-            &lt;para&gt;&lt;code&gt;java -jar gast/gast.jar&lt;/code&gt;&lt;/para&gt;
-            
-            &lt;orderedlist&gt;
                 &lt;listitem&gt;
-                    &lt;para&gt;from the gast folder, issue the command:&lt;/para&gt;
+                    &lt;para&gt;issue the command &lt;code&gt;java -jar gast/gast.jar&lt;/code&gt;&lt;/para&gt;
                 &lt;/listitem&gt;
             &lt;/orderedlist&gt;
-            &lt;para&gt;&lt;code&gt;java -jar gast.jar&lt;/code&gt;&lt;/para&gt;
-            &lt;para&gt;To use your window manager, simply open the GeoNetworkâ€™s folder, go inside the
-                gast folder and click the gast.jar icon. If you have Java installed, GAST should
+            
+            &lt;para&gt;You can also try to simply open the GeoNetwork installation folder, go to the
+                gast folder and doubleclick on the gast.jar file. If you have Java installed, GAST should
                 start in a few seconds.&lt;/para&gt;
-            &lt;para&gt;To run, GAST needs at least Java 1.5. It will not work on Java 1.4 and it
-                should run on Java 1.6 (anyway, it has not been tested).&lt;/para&gt;
+            &lt;para&gt;To run, GAST requires Java 1.5. It will not work on Java 1.4 and it
+                should run on Java 1.6 (this has not been tested!).&lt;/para&gt;
             
         &lt;/section&gt;
         &lt;section&gt;
@@ -59,7 +56,7 @@
                 &lt;/mediaobject&gt;
             &lt;/figure&gt;
             
-            &lt;para&gt;Every GAST tool has an operating mode, which defines the condition under which
+            &lt;para&gt;Every function has an operating mode, which defines the condition under which
                 the tool can be used. The toolâ€™s mode is shown with an icon on the right side of
                 the toolâ€™s name. The operating modes, with their icons are summarized in the
                 following table:&lt;/para&gt;
@@ -157,15 +154,15 @@
             
         &lt;/section&gt;
         &lt;section&gt;
-            &lt;title&gt;Configuration dialog&lt;/title&gt;
-            &lt;para&gt;Some of the GASTâ€™s tools access a running GeoNetwork. Usually, GAST connects
+            &lt;title&gt;Server and Account configuration dialog&lt;/title&gt;
+            &lt;para&gt;Some of the GASTâ€™s tools access a running GeoNetwork application. Usually, GAST connects
                 to GeoNetwork using the connection parameters it finds on the installation
                 folder but you can specify other parameters in order to connect to other
-                instances. This is mandatory when the GeoNetwork instance is not running on the
+                instances. This is required when the GeoNetwork instance is not running on the
                 embedded Jetty server. In addition to that, some tools require authentication so
                 account parameters must be provided.&lt;/para&gt;
             &lt;para&gt;To provide these parameters, you have to use the GAST â€™s configuration dialog.
-                To open the dialog, simply select Options âŠ³ âŠ³ Config from the menubar. You will
+                To open the dialog, select &lt;literal&gt;Options &gt;&gt; Config&lt;/literal&gt; from the menubar. You will
                 get the dialog shown in &lt;xref linkend="admin_gast_config"/&gt;.&lt;/para&gt;
             
             &lt;figure id="admin_gast_config" &gt;

Modified: trunk/docs/docbook/gn_manual/admin_import_export_tools.xml
===================================================================
--- trunk/docs/docbook/gn_manual/admin_import_export_tools.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/docs/docbook/gn_manual/admin_import_export_tools.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -6,95 +6,137 @@
         &lt;title&gt;Import / export tools&lt;/title&gt;
         &lt;section&gt;
             &lt;title&gt;Introduction&lt;/title&gt;
-            &lt;para&gt;Using GAST, you can import and export metadata as will. These facilities allow
-                you a broad variety of tasks:&lt;/para&gt;
+            &lt;para&gt;Using GAST, you can import and export metadata at will. It allows you to:&lt;/para&gt;
             
             &lt;orderedlist&gt;
                 &lt;listitem&gt;
-                    &lt;para&gt;Backup of the entire metadata set. Each metadata has its own file with
-                        maps and other data files. Once you have the backup, you can decide to
-                        import all or only some of them.&lt;/para&gt;
+                    &lt;para&gt;Create a &lt;emphasis role="bold"&gt;backup&lt;/emphasis&gt; of the entire metadata set. 
+                        Each metadata has its own file, including maps and other data files. 
+                        Once you have the backup, you can decide to import all or only some of them.&lt;/para&gt;
                 &lt;/listitem&gt;
                 &lt;listitem&gt;
-                    &lt;para&gt;Move your metadata from one GeoNetworkâ€™s installation to another. This
+                    &lt;para&gt;&lt;emphasis role="bold"&gt;Move your metadata&lt;/emphasis&gt; from one GeoNetwork catalog to another. This
                         can be done to mirror your metadata or to upgrade an old installation.
                         In the last case, you export your metadata from your old installation
                         and then reimport them into the new one.&lt;/para&gt;
                 &lt;/listitem&gt;
                 &lt;listitem&gt;
-                    &lt;para&gt;Fill the system with test data. Using the â€™skip uuidâ€™ option, you can
+                    &lt;para&gt;Fill the system with &lt;emphasis role="bold"&gt;test data&lt;/emphasis&gt;. Using the â€™skip uuidâ€™ option, you can
                         reimport the same metadata over and over again. This is usefull, for
                         example, if you want to perform stress tests.&lt;/para&gt;
                 &lt;/listitem&gt;
             &lt;/orderedlist&gt;
             &lt;para&gt;Metadata are exported using the MEF format.&lt;/para&gt;
-            
+            &lt;important&gt;
+                &lt;title&gt;Ownership&lt;/title&gt;
+                &lt;para&gt;Please, consider that the MEF format version 1.0 does not take into account
+                    user and group ownership. When exporting metadata, you loose this information.
+                    When importing metadata, the new owner becomes the user that is performing the
+                    import while the group ownership is set to null.&lt;/para&gt;
+            &lt;/important&gt;
         &lt;/section&gt;
-        &lt;section&gt;
-            &lt;title&gt;Export&lt;/title&gt;
-            &lt;para&gt;This facility is located inside the Management node on the left panel and
-                allows you to export a set of metadata using the MEF format. Clicking the Export
-                node you get its option panel on the right, as you can see from &lt;xref linkend="admin_export_panel"/&gt;.&lt;/para&gt;
+        &lt;section id="mef_import"&gt;
+            &lt;title&gt;Import&lt;/title&gt;
+            &lt;para&gt;This tool is located under Management tools on the left panel and
+                allows you to import a set of metadata that have been previously exported using
+                the export facility (see &lt;xref linkend="mef_export"/&gt;). Selecting the Import tool opens the option
+                panel on the right (&lt;xref linkend="admin_import_panel"/&gt;).&lt;/para&gt;
             
-            &lt;figure id="admin_export_panel"&gt;
-                &lt;title&gt;The metadata export panel&lt;/title&gt;
+            &lt;figure id="admin_import_panel"&gt;
+                &lt;title&gt;The metadata import panel&lt;/title&gt;
                 &lt;mediaobject&gt;
                     &lt;imageobject&gt;
-                        &lt;imagedata fileref="images/admin/gast-mef-export.png" width="14cm" align="center"/&gt;
+                        &lt;imagedata fileref="images/admin/gast-mef-import.png" width="14cm" align="center"/&gt;
                     &lt;/imageobject&gt;
                 &lt;/mediaobject&gt;
             &lt;/figure&gt;
             
-            &lt;para&gt;Here follows a detailed explanation of the options:&lt;/para&gt;
-            &lt;para&gt;Output folder This is the target folder in your system where GAST will put the
-                exported metadata. You can either press the Browse button to navigate through
-                your file system to choose a better location or enter it manually into the
-                textfield. Format Here you can specify the metadataâ€™s output format. See the MEF
-                specification for more information. Skip UUID Normally is not selected. If you
-                select it, you will loose the metadataâ€™s unique identifier (uuid) but you will
-                be able to reimport that metadata over and over again. This is usefull to fill
-                the system with test data. Search This panel contains some search criteria that
-                you can enter when exporting metadata.&lt;/para&gt;
-            &lt;para&gt;Please notice that the exportâ€™s result will depend on the metadata visible to
-                the searching user. If you do not authenticate, you will get only public
-                metadata.&lt;/para&gt;
-            &lt;para&gt;Pressing the Export button will start the process. A progress dialog will be
-                opened to show the export status.&lt;/para&gt;
+            &lt;itemizedlist&gt;
+                &lt;listitem&gt;
+                    &lt;formalpara&gt;
+                        &lt;title&gt;Input folder&lt;/title&gt;
+                        &lt;para&gt;the source folder in your system that GAST will scan to
+                            collect metadata to import. GAST will try to import all files with the mef
+                            extension.&lt;note&gt;&lt;para&gt;Subfolders are not scanned.&lt;/para&gt;&lt;/note&gt;&lt;/para&gt;
+                    &lt;/formalpara&gt;
+                &lt;/listitem&gt;
+                &lt;listitem&gt;
+                    &lt;formalpara&gt;
+                        &lt;title&gt;Browse button&lt;/title&gt;
+                        &lt;para&gt;Navigate through your file system to choose an output
+                            location or enter it manually into the textfield.&lt;/para&gt;
+                    &lt;/formalpara&gt;
+                &lt;/listitem&gt;
+                &lt;listitem&gt;
+                    &lt;formalpara&gt;
+                        &lt;title&gt;Import&lt;/title&gt;
+                        &lt;para&gt;This will start the process. A progress dialog will be
+                            opened to show the import status.&lt;/para&gt;
+                    &lt;/formalpara&gt;
+                &lt;/listitem&gt;
+            &lt;/itemizedlist&gt;
             
         &lt;/section&gt;
-        &lt;section&gt;
-            &lt;title&gt;Import&lt;/title&gt;
-            &lt;para&gt;This facility is located inside the Management node on the left panel and
-                allows you to import a set of metadata that have been previously exported using
-                the export facility described above. Clicking the Import node you get its option
-                panel on the right, as you can see from &lt;xref linkend="admin_import_panel"/&gt;.&lt;/para&gt;
+        &lt;section id="mef_export"&gt;
+            &lt;title&gt;Export&lt;/title&gt;
+            &lt;para&gt;This tool is located under the Management tool on the left panel and
+                allows you to export a set of metadata using the MEF format. Selecting the Export
+                tool opens the option panel on the right (&lt;xref linkend="admin_export_panel"/&gt;).&lt;/para&gt;
             
-            &lt;figure id="admin_import_panel"&gt;
-                &lt;title&gt;The metadata import panel&lt;/title&gt;
+            &lt;figure id="admin_export_panel"&gt;
+                &lt;title&gt;The metadata export panel&lt;/title&gt;
                 &lt;mediaobject&gt;
                     &lt;imageobject&gt;
-                        &lt;imagedata fileref="images/admin/gast-mef-import.png" width="14cm" align="center"/&gt;
+                        &lt;imagedata fileref="images/admin/gast-mef-export.png" width="14cm" align="center"/&gt;
                     &lt;/imageobject&gt;
                 &lt;/mediaobject&gt;
             &lt;/figure&gt;
             
-            &lt;para&gt;Here follows a detailed explanation of the options:&lt;/para&gt;
-            &lt;para&gt;Input folder This is the source folder in your system that GAST will scan to
-                collect metadata to import. GAST will try to import all files with the mef
-                extension. Please notice that subfolders are not scanned. You can either press
-                the Browse button to navigate through your file system to choose a better
-                location or enter it manually into the textfield.&lt;/para&gt;
-            &lt;para&gt;Pressing the Export button will start the process. A progress dialog will be
-                opened to show the import status.&lt;/para&gt;
-            
+            &lt;itemizedlist&gt;
+                &lt;listitem&gt;
+                    &lt;formalpara&gt;
+                        &lt;title&gt;Output folder&lt;/title&gt;
+                        &lt;para&gt;The target folder in your file system where GAST will put the
+                            exported metadata. You can either select the Browse button to navigate through
+                            your file system to choose a better location or enter it manually in the
+                            text field.&lt;/para&gt;
+                    &lt;/formalpara&gt;
+                &lt;/listitem&gt;
+                &lt;listitem&gt;
+                    &lt;formalpara&gt;
+                        &lt;title&gt;Format&lt;/title&gt;
+                        &lt;para&gt;Here you can specify the metadataâ€™s output format. See the MEF
+                            specification for more information.&lt;/para&gt;
+                    &lt;/formalpara&gt;
+                &lt;/listitem&gt;
+                &lt;listitem&gt;
+                    &lt;formalpara&gt;
+                        &lt;title&gt;Skip UUID&lt;/title&gt;
+                        &lt;para&gt;Normally this option is not required (see &lt;xref linkend="warn_skipuuid"/&gt;). If you
+                            select it, you will loose the metadataâ€™s unique identifier (uuid) but you will
+                            be able to reimport that metadata over and over again. This is usefull to fill
+                            the system with test data.&lt;/para&gt;
+                    &lt;/formalpara&gt;
+                &lt;/listitem&gt;
+                &lt;listitem&gt;
+                    &lt;formalpara&gt;
+                        &lt;title&gt;Search&lt;/title&gt;
+                        &lt;para&gt;Allows to specify free text search criteria to limit the set of exported records.
+                            &lt;note&gt;&lt;para&gt;the export result will depend on the metadata visible to
+                            the searching user. If you do not authenticate, you will get only public
+                            metadata.&lt;/para&gt;&lt;/note&gt;&lt;/para&gt;
+                    &lt;/formalpara&gt;
+                &lt;/listitem&gt;
+                &lt;listitem&gt;
+                    &lt;formalpara&gt;
+                        &lt;title&gt;Export&lt;/title&gt;
+                        &lt;para&gt;This will start the export process. A progress dialog will be
+                            opened to show the export status.&lt;/para&gt;
+                    &lt;/formalpara&gt;
+                &lt;/listitem&gt;
+            &lt;/itemizedlist&gt;
+            &lt;warning id="warn_skipuuid"&gt;&lt;para&gt;Skipping the UUID on import or export can cause metadata to be duplicated. 
+                This should normally always be avoided&lt;/para&gt;&lt;/warning&gt;
         &lt;/section&gt;
-        &lt;section&gt;
-            &lt;title&gt;A note on ownership&lt;/title&gt;
-            &lt;para&gt;Please, consider that the MEF format version 1.0 does not take into account
-                user and group ownership. When exporting metadata, you loose this information.
-                When importing metadata, the new owner becomes the user that is performing the
-                import while the group ownership is set to null.&lt;/para&gt;
-            
-        &lt;/section&gt;
     &lt;/chapter&gt;
 &lt;/book&gt;
\ No newline at end of file

Modified: trunk/docs/docbook/styles/pdf/custom.xsl
===================================================================
--- trunk/docs/docbook/styles/pdf/custom.xsl	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/docs/docbook/styles/pdf/custom.xsl	2008-02-27 15:00:40 UTC (rev 1146)
@@ -358,6 +358,7 @@
         &lt;xsl:value-of select="$body.font.master"/&gt;
         &lt;xsl:text&gt;pt&lt;/xsl:text&gt;
       &lt;/xsl:attribute&gt;
+      &lt;xsl:attribute name="text-align"&gt;center&lt;/xsl:attribute&gt;
       &lt;xsl:attribute name="hyphenate"&gt;false&lt;/xsl:attribute&gt;
       &lt;xsl:attribute name="space-before.minimum"&gt;0.1em&lt;/xsl:attribute&gt;
       &lt;xsl:attribute name="space-before.optimum"&gt;0.1em&lt;/xsl:attribute&gt;

Modified: trunk/src/org/fao/geonet/services/feedback/Insert.java
===================================================================
--- trunk/src/org/fao/geonet/services/feedback/Insert.java	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/src/org/fao/geonet/services/feedback/Insert.java	2008-02-27 15:00:40 UTC (rev 1146)
@@ -66,8 +66,8 @@
 		String comments = Util.getParam(params, Params.COMMENTS);
 		String subject  = Util.getParam(params, Params.SUBJECT, "New feedback");
 
-		String host = sm.getValue("system/feedback/smtpHost");
-		String port = sm.getValue("system/feedback/smtpPort");
+		String host = sm.getValue("system/feedback/mailServer/host");
+		String port = sm.getValue("system/feedback/mailServer/port");
 		String to   = sm.getValue("system/feedback/email");
 
 		MailSender sender = new MailSender(context);

Modified: trunk/src/org/fao/geonet/services/resources/Download.java
===================================================================
--- trunk/src/org/fao/geonet/services/resources/Download.java	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/src/org/fao/geonet/services/resources/Download.java	2008-02-27 15:00:40 UTC (rev 1146)
@@ -133,7 +133,7 @@
 					if (email.trim().length() != 0)
 					{
 						String subject = "File " + fname + " has been downloaded";
-						String message = "GeoNetwork notifies you, as supervisor of group "+ name
+						String message = "GeoNetwork notifies you, as contact person of group "+ name
 							+ " that data file "+ fname
 							+ " belonging metadata "+ id
 							+ " has beed downloaded from address " + context.getIpAddress() + ".";

Modified: trunk/web/geonetwork/loc/ar/xml/config.xml
===================================================================
--- trunk/web/geonetwork/loc/ar/xml/config.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/ar/xml/config.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -28,7 +28,19 @@
 	
 	&lt;save&gt;Save&lt;/save&gt;
 	&lt;refresh&gt;Refresh&lt;/refresh&gt;
-	
+	&lt;username&gt;Username&lt;/username&gt;
+	&lt;removedMetadata&gt;Removed metadata&lt;/removedMetadata&gt;
+	&lt;dir&gt;Directory&lt;/dir&gt;
+	&lt;ldap&gt;LDAP Authentication&lt;/ldap&gt;
+	&lt;defProfile&gt;Default profile&lt;/defProfile&gt;
+	&lt;login&gt;Login&lt;/login&gt;
+	&lt;userDN&gt;User DN&lt;/userDN&gt;
+	&lt;distNames&gt;Distinguished names&lt;/distNames&gt;
+	&lt;baseDN&gt;Base&lt;/baseDN&gt;
+	&lt;usersDN&gt;Users&lt;/usersDN&gt;
+	&lt;userAttribs&gt;User's attributes&lt;/userAttribs&gt;
+	&lt;password&gt;Password&lt;/password&gt;
+	&lt;profile&gt;Profile&lt;/profile&gt;
 	&lt;!-- validator messages --&gt;
 	
 	&lt;validator&gt;

Modified: trunk/web/geonetwork/loc/ar/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/ar/xml/strings.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/ar/xml/strings.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -1,92 +1,6 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;strings&gt;
 	
-	&lt;!-- new strings --&gt;
-	&lt;searchUnusedTitle&gt;Search for Unused&lt;/searchUnusedTitle&gt;
-
-	&lt;batchImportTitle&gt;Batch Import&lt;/batchImportTitle&gt;
-
-	&lt;xmlInsertTitle&gt;XML Metadata Insert&lt;/xmlInsertTitle&gt;
-
-	&lt;fuzzy&gt;Search accuracy&lt;/fuzzy&gt;
-	&lt;fuzzySearch&gt;Set the precision of the search (from exact term search to fuzzy search).&lt;/fuzzySearch&gt;
-	&lt;fuzzyImprecise&gt;Imprecise&lt;/fuzzyImprecise&gt;
-	&lt;fuzzyPrecise&gt;Precise&lt;/fuzzyPrecise&gt;
-	&lt;address&gt;Address&lt;/address&gt;
-	&lt;state&gt;State&lt;/state&gt;
-	&lt;zip&gt;Zip&lt;/zip&gt;
-	&lt;country&gt;Country&lt;/country&gt;
-	&lt;email&gt;Email&lt;/email&gt;
-	&lt;kind&gt;Kind&lt;/kind&gt;
-	&lt;kindChoice value="gov"&gt;Government&lt;/kindChoice&gt;
-	&lt;kindChoice value="int-org"&gt;International organisation&lt;/kindChoice&gt;
-	&lt;kindChoice value="ngo"&gt;NGO&lt;/kindChoice&gt;
-	&lt;kindChoice value="uni"&gt;University/research centre&lt;/kindChoice&gt;
-	&lt;kindChoice value="company"&gt;Private company&lt;/kindChoice&gt;
-	&lt;kindChoice value="consultant"&gt;Independent consultant&lt;/kindChoice&gt;
-	&lt;kindChoice value="other"&gt;Other&lt;/kindChoice&gt;
-	&lt;userInfo&gt;Change user information&lt;/userInfo&gt;
-	&lt;userInfoDes&gt;Allow current user to change user information&lt;/userInfoDes&gt;
-	&lt;subtemplate&gt;Subtemplate&lt;/subtemplate&gt;
-	&lt;subtemplateTitle&gt;subtemplate title&lt;/subtemplateTitle&gt;
-	&lt;edit&gt;Edit&lt;/edit&gt;
-	&lt;view&gt;View&lt;/view&gt;
-	&lt;Term&gt;Term&lt;/Term&gt;
-	&lt;startsWith&gt;Start with&lt;/startsWith&gt;
-	&lt;contains&gt;Contains&lt;/contains&gt;
-	&lt;exactTerm&gt;Exact term&lt;/exactTerm&gt;
-	&lt;foundWords&gt;Number of terms found:&lt;/foundWords&gt;
-	&lt;selection&gt;Selection&lt;/selection&gt;
-	&lt;label&gt;Label&lt;/label&gt;
-	&lt;type&gt;Type&lt;/type&gt;
-	&lt;sort&gt;Sort&lt;/sort&gt;
-	&lt;definition&gt;Definition&lt;/definition&gt;
-	&lt;close&gt;Close&lt;/close&gt;
-	&lt;identifier&gt;Identifier&lt;/identifier&gt;
-	&lt;keyword&gt;keyword&lt;/keyword&gt;
-	&lt;res&gt;results&lt;/res&gt;
-	&lt;ress&gt;result&lt;/ress&gt;
-
-	&lt;thesaurus&gt;
-		&lt;category&gt;Thesaurus category&lt;/category&gt;
-		&lt;management&gt;Manage thesauri&lt;/management&gt;
-		&lt;manDes&gt;Add/modify/delete and show thesauri&lt;/manDes&gt;
-		&lt;edition&gt;Edit thesaurus&lt;/edition&gt;
-		&lt;consultation&gt;View thesaurus&lt;/consultation&gt;
-		&lt;thesaurus&gt;Thesaurus&lt;/thesaurus&gt;
-		&lt;admin&gt;Manage thesaurus&lt;/admin&gt;
-		&lt;edit&gt;Edit thesaurus&lt;/edit&gt;
-		&lt;update&gt;Update thesaurus&lt;/update&gt;
-		&lt;upload&gt;Upload thesaurus&lt;/upload&gt;
-		&lt;download&gt;Download thesaurus&lt;/download&gt;
-		&lt;delete&gt;Delete thesaurus&lt;/delete&gt;	
-		&lt;editelement&gt;Edit element&lt;/editelement&gt;
-		&lt;addelement&gt;Add element&lt;/addelement&gt;			
-		&lt;deleteelement&gt;Delete element&lt;/deleteelement&gt;
-		&lt;updateelement&gt;Update element&lt;/updateelement&gt;
-		&lt;keywordDescription&gt;Keyword definition:&lt;/keywordDescription&gt;
-		&lt;keywordConfirm&gt;Confirm keyword suppression&lt;/keywordConfirm&gt;
-		&lt;unknown&gt;Unknown thesaurus&lt;/unknown&gt;
-		&lt;narrower&gt;Narrower Term&lt;/narrower&gt;
-		&lt;broader&gt;Broader Term&lt;/broader&gt;
-		&lt;related&gt;Related Term&lt;/related&gt;
-		&lt;en&gt;in&lt;/en&gt;
-		&lt;foundKeyWords&gt;Number of terms found&lt;/foundKeyWords&gt;
-		&lt;foundKeyWordsLimit&gt;Maximum number of terms found&lt;/foundKeyWordsLimit&gt;
-	&lt;/thesaurus&gt;
-
-	&lt;searchBox&gt;Search for Data and Information&lt;/searchBox&gt;
-	&lt;searchIndex&gt;Search index&lt;/searchIndex&gt;
-	&lt;contactUs&gt;Contact us&lt;/contactUs&gt;
-	&lt;highlights&gt;Highlights&lt;/highlights&gt;
-	&lt;recentAdditions&gt;Recent Additions&lt;/recentAdditions&gt;
-	&lt;feedbackCardTitle&gt;Feedback and Comments&lt;/feedbackCardTitle&gt;
-	&lt;loginCardTitle&gt;Login / Signup&lt;/loginCardTitle&gt;
-	&lt;organisation&gt;Organisation / department&lt;/organisation&gt;
-	&lt;emailAddress&gt;Email address&lt;/emailAddress&gt;
-	&lt;feedbackComments&gt;Feedback / comments&lt;/feedbackComments&gt;
-	&lt;!-- End new strings --&gt;
-	
 	&lt;language&gt;ar&lt;/language&gt;
 	&lt;!-- ISO code --&gt;
 	&lt;about&gt;Ø¹Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬&lt;/about&gt;
@@ -94,6 +8,7 @@
 	&lt;accept&gt;Ù‚Ø¨ÙˆÙ„&lt;/accept&gt;
 	&lt;add&gt;Ø¥Ø¶Ø§Ù?Ø©&lt;/add&gt;
 	&lt;addNewMetadata&gt;Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Metadata Ø¬Ø¯ÙŠØ¯Ø©&lt;/addNewMetadata&gt;
+	&lt;address&gt;Address&lt;/address&gt;
 	&lt;admin&gt;Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆÙ‚Ø¹&lt;/admin&gt;
 	&lt;Administrator&gt;Ù…Ø¯ÙŠØ± Ù…ÙˆÙ‚Ø¹&lt;/Administrator&gt;
 	&lt;agrovocKeyword&gt;Ø¯ÙˆØ§Ù„ Ø£Ø¬Ø±ÙˆÙ?ÙˆÙƒ&lt;/agrovocKeyword&gt;
@@ -109,6 +24,7 @@
 	&lt;backToPreviousPage&gt;Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙ?Ø­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©&lt;/backToPreviousPage&gt;
 	&lt;backToEditor&gt;Ø±Ø¬ÙˆØ¹ Ù„ØªØ­Ø±ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ©&lt;/backToEditor&gt;
 	&lt;batchImport&gt;Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø­Ø±Ø±Ø© Ø¨ÙˆØ§Ø³Ø·Ø© XML Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²&lt;/batchImport&gt;
+	&lt;batchImportTitle&gt;Batch Import&lt;/batchImportTitle&gt;
 	&lt;begdate&gt;ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©&lt;/begdate&gt;
 	&lt;begtime&gt;ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©&lt;/begtime&gt;
 	&lt;bgFileDescChoice value="thumbnail"&gt;ØµÙˆØ±Ø©&lt;/bgFileDescChoice&gt;
@@ -132,7 +48,9 @@
 	&lt;chooseLargeThumbnail&gt;Ø¹ÙŠÙ† Ù…ÙƒØ§Ù† Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©&lt;/chooseLargeThumbnail&gt;
 	&lt;chooseThumbnail&gt;Ø¹ÙŠÙ† Ù…ÙƒØ§Ù† Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ© Ø§Ù„ØµØºÙŠØ±Ø©&lt;/chooseThumbnail&gt;
 	&lt;clear&gt;Ù…Ø³Ø­&lt;/clear&gt;
- &lt;cn&gt;ä¸­æ–‡&lt;/cn&gt; &lt;!-- Do not translate! --&gt;
+	&lt;clearAll&gt;Clear All&lt;/clearAll&gt;
+	&lt;close&gt;Close&lt;/close&gt;
+	&lt;cn&gt;ä¸­æ–‡&lt;/cn&gt; &lt;!-- Do not translate! --&gt;
 	&lt;completeTab&gt;Ø¹Ø±Ø¶ Ù…ØªÙ‚Ø¯Ù…&lt;/completeTab&gt;
 	&lt;completeTabEditor&gt;ØªØ­Ø±ÙŠØ± Ù…ØªÙ‚Ø¯Ù…&lt;/completeTabEditor&gt;
 	&lt;confirmDelete&gt;Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© meta data Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ&lt;/confirmDelete&gt;
@@ -140,11 +58,14 @@
 	&lt;confirmNewPassword&gt;Ø£Ø¹Ø§Ø¯Ø© ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±&lt;/confirmNewPassword&gt;
 	&lt;constraintsTab&gt;Ø§Ù„Ù…Ø¹ÙˆÙ‚Ø§Øª&lt;/constraintsTab&gt;
 	&lt;contactUs&gt;Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø§&lt;/contactUs&gt;
+	&lt;contains&gt;Contains&lt;/contains&gt;
+	&lt;contentInfoTab&gt;Content Info&lt;/contentInfoTab&gt;
 	&lt;convert&gt;ØªØ­ÙˆÙŠÙ„&lt;/convert&gt;
 	&lt;copyright1&gt;Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø·Ø¨Ø¹&lt;/copyright1&gt;
 	&lt;copyright2&gt;
 	&lt;p&gt;Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø·Ø¨Ø¹ Ù…Ø­Ù?ÙˆØ¸Ø©&lt;br/&gt;Ø¹Ø¨Ø§Ø±Ø© Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø·Ø¨Ø¹&lt;/p&gt;
 	&lt;/copyright2&gt;
+	&lt;country&gt;Country&lt;/country&gt;
 	&lt;create&gt;Ø¬Ø¯ÙŠØ¯&lt;/create&gt;
 	&lt;createTip&gt;Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ÙˆØ¹Ø§Ø¡&lt;/createTip&gt;
 	&lt;dataQualityTab&gt;Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª&lt;/dataQualityTab&gt;
@@ -156,11 +77,12 @@
 	&lt;dateRelChoice value="17"&gt;Ø®Ù„Ø§Ù„ Ø£Ùˆ Ø¨Ø¹Ø¯&lt;/dateRelChoice&gt;
 	&lt;dateRelChoice value="18"&gt;Ø¨Ø¹Ø¯&lt;/dateRelChoice&gt;
 	&lt;decline&gt;Ø±Ù?Ø¶&lt;/decline&gt;
+	&lt;definition&gt;Definition&lt;/definition&gt;
 	&lt;del&gt;del&lt;/del&gt;
 	&lt;delete&gt;Ø­Ø°Ù?&lt;/delete&gt;
-	&lt;digital&gt;Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ&lt;/digital&gt;
 	&lt;descriptionTab&gt;ØªÙˆØµÙŠÙ?&lt;/descriptionTab&gt;
  &lt;desSchema&gt;Destination schema&lt;/desSchema&gt;
+	&lt;digital&gt;Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ&lt;/digital&gt;
 	&lt;directory&gt;Ù…Ø¬Ù„Ø¯&lt;/directory&gt;
 	&lt;dirParameter&gt;ØªØ­ØªØ§Ø¬ Ù„Ø¯Ø§Ù„Ø© DIR&lt;/dirParameter&gt;
 	&lt;disclaimer1&gt;Ø¹Ù†ÙˆØ§Ù† Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø³Ø¦ÙˆÙ„ÙŠØ©&lt;/disclaimer1&gt;
@@ -168,8 +90,11 @@
 	&lt;distributionTab&gt;ØªÙˆØµÙŠÙ?&lt;/distributionTab&gt;
 	&lt;down&gt;Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³Ù?Ù„&lt;/down&gt;
 	&lt;download&gt;ØªØ­Ù…ÙŠÙ„&lt;/download&gt;
+	&lt;downloadable&gt;Downloadable&lt;/downloadable&gt;
 	&lt;downloadData&gt;Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù…ÙŠÙ„&lt;/downloadData&gt;
+	&lt;downloadEmail&gt;Download Email&lt;/downloadEmail&gt;
 	&lt;dsgpoly&gt;Data Set G-Polygon&lt;/dsgpoly&gt;
+	&lt;dynamic&gt;Interactive&lt;/dynamic&gt;
 	&lt;eastbc&gt;Ø§Ù„Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø´Ø±Ù‚ÙŠØ©&lt;/eastbc&gt;
 	&lt;edit&gt;Ù€Ø¹Ø¯ÙŠÙ„&lt;/edit&gt;
 	&lt;Editor&gt;Ù…Ø­Ø±Ø±&lt;/Editor&gt;
@@ -179,20 +104,30 @@
 	&lt;enclosing&gt;ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰&lt;/enclosing&gt;
 	&lt;enclosingCoordinate&gt;Ø§Ù„Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª&lt;/enclosingCoordinate&gt;
 	&lt;enttypl&gt;Ø¹Ù†ÙˆØ§Ù† Ø¬Ø²Ø¦ÙŠØ© Ù†ÙˆØ¹&lt;/enttypl&gt;
- &lt;es&gt;EspaÃ±ol&lt;/es&gt; &lt;!-- Do not translate! --&gt;
+	&lt;email&gt;Email&lt;/email&gt;
+	&lt;emailAddress&gt;Email address&lt;/emailAddress&gt;
+	&lt;es&gt;EspaÃ±ol&lt;/es&gt; &lt;!-- Do not translate! --&gt;
 	&lt;exactCoordinate&gt;Ø§Ù„Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ø¯Ù‚Ø©&lt;/exactCoordinate&gt;
+	&lt;exactTerm&gt;Exact term&lt;/exactTerm&gt;
 	&lt;extended&gt;Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª&lt;/extended&gt;
+	&lt;extensionInfoTab&gt;Ext. Info&lt;/extensionInfoTab&gt;
 	&lt;extent&gt;ØªÙ…Ø§Ù…Ø§&lt;/extent&gt;
 	&lt;featuredMap&gt;Ø®Ø±ÙŠØ·Ø© Ù…Ø®ØªØ§Ø±Ø©&lt;/featuredMap&gt;
 	&lt;feedback&gt;ØªØ¹Ù„ÙŠÙ‚Ø§Øª&lt;/feedback&gt;
-	&lt;!--  &lt;feedbackCardTitle&gt;ØªØ¹Ù„ÙŠÙ‚Ø§Øª&lt;/feedbackCardTitle&gt; --&gt;
-	&lt;!--  &lt;feedbackComments&gt;ØªØ¹Ù„ÙŠÙ‚Ø§Øª&lt;/feedbackComments&gt; --&gt;
+  &lt;feedbackCardTitle&gt;ØªØ¹Ù„ÙŠÙ‚Ø§Øª&lt;/feedbackCardTitle&gt;
+	 &lt;feedbackComments&gt;ØªØ¹Ù„ÙŠÙ‚Ø§Øª&lt;/feedbackComments&gt;
 	&lt;feedbackRequest&gt;Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„&lt;/feedbackRequest&gt;
 	&lt;file&gt;Ù…Ù„Ù?&lt;/file&gt;
 	&lt;firstName&gt;Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„&lt;/firstName&gt;
- &lt;fr&gt;FranÃ§ais&lt;/fr&gt; &lt;!-- Do not translate! --&gt;
+	&lt;foundWords&gt;Number of terms found:&lt;/foundWords&gt;
+	&lt;fr&gt;FranÃ§ais&lt;/fr&gt; &lt;!-- Do not translate! --&gt;
 	&lt;freeKeyword&gt;ÙƒØ§ØªØ¨Ø© Ø­Ø±Ø©&lt;/freeKeyword&gt;
 	&lt;from&gt;ØªØ§Ø±ÙŠØ® Ù…Ù†:&lt;/from&gt;
+	&lt;fromDateSelector&gt;Select FROM date&lt;/fromDateSelector&gt; 
+	&lt;fuzzy&gt;Search accuracy&lt;/fuzzy&gt;
+	&lt;fuzzySearch&gt;Set the precision of the search (from exact term search to fuzzy search).&lt;/fuzzySearch&gt;
+	&lt;fuzzyImprecise&gt;Imprecise&lt;/fuzzyImprecise&gt;
+	&lt;fuzzyPrecise&gt;Precise&lt;/fuzzyPrecise&gt;
 	&lt;general&gt;Ø¹Ø§Ù…&lt;/general&gt;
 	&lt;generalInfo&gt;Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©&lt;/generalInfo&gt;
 	&lt;georss&gt;Ù?ØªØ­ GeoRSS&lt;/georss&gt;
@@ -220,7 +155,7 @@
 	&lt;help&gt;ØªØ¹Ù„ÙŠÙ…Ø§Øª&lt;/help&gt;
 	&lt;helpComplete&gt;ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙƒØ§Ù…Ù„Ø©&lt;/helpComplete&gt;
  &lt;hideAdvancedOptions&gt;Ø®ÙŠØ§Ø±Ø§Øª Ø£Ù‚Ù„&lt;/hideAdvancedOptions&gt;
-	&lt;!--  &lt;highlights&gt;ØªØ­Ø¯ÙŠØ¯&lt;/highlights&gt; --&gt;
+	&lt;highlights&gt;ØªØ­Ø¯ÙŠØ¯&lt;/highlights&gt;
 	&lt;hitsPerPage&gt;Ù†ØªÙŠØ¬Ø© Ø¹Ù„Ù‰ Ø§Ù„ØµÙ?Ø­Ø©&lt;/hitsPerPage&gt;
 	&lt;hitsPerPageChoice value="10"&gt;10&lt;/hitsPerPageChoice&gt;
 	&lt;hitsPerPageChoice value="20"&gt;20&lt;/hitsPerPageChoice&gt;
@@ -228,7 +163,16 @@
 	&lt;hitsPerPageChoice value="100"&gt;100&lt;/hitsPerPageChoice&gt;
 	&lt;home&gt;Ø§Ù„ØµÙ?Ø­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©&lt;/home&gt;
 	&lt;identificationTab&gt;Identification&lt;/identificationTab&gt;
+	&lt;identifier&gt;Identifier&lt;/identifier&gt;
 	&lt;import&gt;Ø§Ø¯Ø±Ø§Ø¬&lt;/import&gt;
+	&lt;!--  intermap tooltips --&gt;
+	&lt;imAreaInterest&gt;Select an Area Of Interest&lt;/imAreaInterest&gt;
+	&lt;imPan&gt;Pan&lt;/imPan&gt;
+	&lt;imZoomFull&gt;Zoom to full map extent&lt;/imZoomFull&gt;
+	&lt;imZoomIn&gt;Zoom in&lt;/imZoomIn&gt;
+	&lt;imZoomOut&gt;Zoom out&lt;/imZoomOut&gt;
+	&lt;imZoomToLayer&gt;Zoom to selected layer extent&lt;/imZoomToLayer&gt;
+	&lt;!-- end intermap tooltips --&gt;
 	&lt;infoTitle&gt;Ù…Ø¹Ù„ÙˆÙ…Ø§Øª&lt;/infoTitle&gt;
 	&lt;insert&gt;Ø¥Ø¯Ø®Ø§Ù„&lt;/insert&gt;
 	&lt;interactiveMap&gt;Ø®Ø±ÙŠØ·Ø© ØªÙ?Ø§Ø¹Ù„ÙŠØ©&lt;/interactiveMap&gt;
@@ -241,8 +185,19 @@
 		Consortium&lt;/a&gt; compliant WMS Map Servers and &lt;a class="sm" href="<a href="http://www.esri.com" target="_new">http://www.esri.com</a>"
 		  target="_blank"&gt;ESRIÂ® ArcIMS&lt;/a&gt;.
 	&lt;/interMapInfo&gt;
+	&lt;intermapSearch&gt;Geographic search&lt;/intermapSearch&gt;
+	&lt;keyword&gt;keyword&lt;/keyword&gt;
 	&lt;keywords&gt;ÙƒÙ„Ù…Ø§Øª Ø¯Ø§Ù„Ø©&lt;/keywords&gt;
 	&lt;keywordshelp&gt;Ù„Ø£ÙƒØ«Ø± Ù…Ù† ÙƒÙ„Ù…Ø© Ø¯Ø§Ù„Ø© Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„Ø¶ØºØ· ctrl+key Ù…Ø¹ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù?Ø£Ø±Ø©&lt;/keywordshelp&gt;
+	&lt;kind&gt;Kind&lt;/kind&gt;
+	&lt;kindChoice value="gov"&gt;Government&lt;/kindChoice&gt;
+	&lt;kindChoice value="int-org"&gt;International organisation&lt;/kindChoice&gt;
+	&lt;kindChoice value="ngo"&gt;NGO&lt;/kindChoice&gt;
+	&lt;kindChoice value="uni"&gt;University/research centre&lt;/kindChoice&gt;
+	&lt;kindChoice value="company"&gt;Private company&lt;/kindChoice&gt;
+	&lt;kindChoice value="consultant"&gt;Independent consultant&lt;/kindChoice&gt;
+	&lt;kindChoice value="other"&gt;Other&lt;/kindChoice&gt;
+	&lt;label&gt;Label&lt;/label&gt;
 	&lt;large_thumbnail&gt;Ø§Ø¶ØºØ· Ù„Ø±Ø¤ÙŠØ© ØµÙˆØ±Ø© Ø£ÙƒØ¨Ø±&lt;/large_thumbnail&gt;
 	&lt;latitude&gt;Ø®Ø· Ø·ÙˆÙ„ Ø¨ÙŠÙ† 90 Ùˆ 90- Ø¯Ø±Ø¬Ø©&lt;/latitude&gt;
  &lt;latMax&gt;lat (max)&lt;/latMax&gt;
@@ -255,7 +210,7 @@
  &lt;localizDes&gt;Allows to change localized entities, like groups, categories etc...&lt;/localizDes&gt;
 	&lt;location&gt;Ù…ÙˆÙ‚Ø¹&lt;/location&gt;
 	&lt;login&gt;Ø¯Ø®ÙˆÙ„ Ø£Ø¹Ø¶Ø§Ø¡&lt;/login&gt;
-	&lt;!--  &lt;loginCardTitle&gt;Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„&lt;/loginCardTitle&gt; --&gt;
+	&lt;loginCardTitle&gt;Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„&lt;/loginCardTitle&gt;
 	&lt;loginwarning&gt;Ù?Ù‚Ø· Ù…Ø·Ù„ÙˆØ¨Ø© Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹&lt;/loginwarning&gt;
 	&lt;logout&gt;Ø®Ø±ÙˆØ¬&lt;/logout&gt;
 	&lt;logoutDes&gt;Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø®Ø±ÙˆØ¬&lt;/logoutDes&gt;
@@ -328,6 +283,7 @@
 	&lt;metadataAdded&gt;Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Metadata Ø£Ø¶ÙŠÙ?Øª Ø¨Ø±Ù‚Ù… Ù…Ù…ÙŠØ²:&lt;/metadataAdded&gt;
 	&lt;metadataDeleted&gt;Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Metadata Ø­Ø°Ù?Øª Ø¨Ø±Ù‚Ù… Ù…Ù…ÙŠØ²:&lt;/metadataDeleted&gt;
 	&lt;metadataJSForm&gt;Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø­Ù‚ÙˆÙ„ JS&lt;/metadataJSForm&gt;
+	&lt;mdRating&gt;Metadata Rating&lt;/mdRating&gt;
 	&lt;min&gt;Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†ÙŠ&lt;/min&gt;
 	&lt;more&gt;Ø§Ù„Ù…Ø²ÙŠØ¯&lt;/more&gt;
 	&lt;moreinfo&gt;Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø§ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø§ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„ØªØ§Ù„ÙŠ&lt;/moreinfo&gt;
@@ -349,8 +305,13 @@
 &lt;!--  &lt;nteaphome&gt;Ù…ÙˆÙ‚Ø¹ Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ&lt;/nteaphome&gt; --&gt;
 	&lt;online&gt;Ø®Ø±ÙŠØ·Ø© ØªÙ?Ø§Ø¹Ù„ÙŠØ©&lt;/online&gt;
 	&lt;onlink&gt;Ø±ÙˆØ§Ø¨Ø· Ø­ÙŠØ©&lt;/onlink&gt;
+	&lt;opensearch&gt;GeoNetwork opensearch service allow search to be made into the metadata catalog.&lt;/opensearch&gt;
 	&lt;operation&gt;Ø¹Ù…Ù„ÙŠØ©&lt;/operation&gt;
+	&lt;options&gt;Options&lt;/options&gt;
 	&lt;organisation&gt;Ø¬Ù‡Ø© / ÙˆØ­Ø¯Ø©&lt;/organisation&gt;
+	&lt;output&gt;Output&lt;/output&gt;
+	&lt;outputType id="full"&gt;Full&lt;/outputType&gt;
+	&lt;outputType id="text"&gt;Text only&lt;/outputType&gt;
 	&lt;paper&gt;ÙˆØ±Ù‚ÙŠØ©&lt;/paper&gt;
 	&lt;partial&gt;ØªØºØ·ÙŠØ© Ø¬Ø²Ø¦ÙŠØ©&lt;/partial&gt;
 	&lt;partialCooordinate&gt;Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¬Ø²Ø¦ÙŠØ©&lt;/partialCooordinate&gt;
@@ -366,6 +327,7 @@
 	&lt;progressChoice value="complete"&gt;Ø¥Ù†ØªÙ‡Ø§Ø¡&lt;/progressChoice&gt;
 	&lt;progressChoice value="in-work"&gt;ÙŠØ¹Ù…Ù„&lt;/progressChoice&gt;
 	&lt;progressChoice value="planned"&gt;Ù…Ø¨Ø±Ù…Ø¬Ø©&lt;/progressChoice&gt;
+	&lt;protocol&gt;Protocol&lt;/protocol&gt;
 	&lt;protocolChoice value="WWW:LINK-1.0-http--link"&gt;Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ&lt;/protocolChoice&gt;
 	&lt;protocolChoice value="WWW:LINK-1.0-http--samples"&gt;Showcase product (URL)&lt;/protocolChoice&gt;
 	&lt;protocolChoice value="WWW:LINK-1.0-http--related"&gt;Related link (URL)&lt;/protocolChoice&gt;
@@ -387,13 +349,19 @@
 	&lt;publicationDate&gt;ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø±ÙŠØ±&lt;/publicationDate&gt;
 	&lt;publisher&gt;Ù…Ø­Ø±Ø±&lt;/publisher&gt;
 	&lt;purpose&gt;Ø§Ù„ØºØ±Ø¶ Ù…Ù†&lt;/purpose&gt;
+	&lt;rateIt&gt;Rate It&lt;/rateIt&gt;
+	&lt;ratingMsg&gt;
+		Press a button to rate. Note that for harvested metadata you have to wait the new run.
+	&lt;/ratingMsg&gt;
 	&lt;rawMetadata&gt;Ø£Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Metadata Ø®Ø§Ù…&lt;/rawMetadata&gt;
-&lt;!--	&lt;recentAdditions&gt;Ø§Ù„Ø§Ø¶Ø§Ù?Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«&lt;/recentAdditions&gt; --&gt;
+	&lt;recentAdditions&gt;Ø§Ù„Ø§Ø¶Ø§Ù?Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«&lt;/recentAdditions&gt;
 	&lt;refSysTab&gt;Ref. system&lt;/refSysTab&gt;
 	&lt;region&gt;Ø¥Ù‚Ù„ÙŠÙ…&lt;/region&gt;
 	&lt;RegisteredUser&gt;Ø¹Ø¶Ùˆ Ù…Ø³Ø¬Ù„&lt;/RegisteredUser&gt;
 	&lt;remote&gt;Ø¨Ø­Ø« Ø®Ø§Ø±Ø¬ÙŠ&lt;/remote&gt;
 	&lt;remove&gt;Ø¥Ø²Ø§Ù„Ø©&lt;/remove&gt;
+	&lt;res&gt;results&lt;/res&gt;
+	&lt;ress&gt;result&lt;/ress&gt;
 	&lt;reset&gt;Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©&lt;/reset&gt;
 	&lt;resetSearch&gt;Ø£Ø¹Ø§Ø¯Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø« Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©&lt;/resetSearch&gt;
 	&lt;resetFeedbackForm&gt;Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©&lt;/resetFeedbackForm&gt;
@@ -402,11 +370,19 @@
 	&lt;resultsCoordinate&gt;Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø­Ø³Ø¨ Ø§Ù„Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©&lt;/resultsCoordinate&gt;
 	&lt;resultsFreeText&gt;Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø­Ø³Ø¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø©&lt;/resultsFreeText&gt;
 	&lt;resultsMatching&gt;Aggregate Results matching search criteria :&lt;/resultsMatching&gt;
+	&lt;Reviewer&gt;Content reviewer&lt;/Reviewer&gt;
 	&lt;rss&gt;Ù?ØªØ­ RSS&lt;/rss&gt;
 	&lt;rtitle&gt;Ø¹Ù†ÙˆØ§Ù†&lt;/rtitle&gt;
 	&lt;save&gt;Ø­Ù?Ø¸&lt;/save&gt;
 	&lt;saveAndClose&gt;Ø­Ù?Ø¸ ÙˆØ¥ØºÙ„Ø§Ù‚&lt;/saveAndClose&gt;
 	&lt;saveAndValidate&gt;Ø§Ù„ØªØ­Ù‚Ù‚&lt;/saveAndValidate&gt;
+	&lt;savexml&gt;
+		&lt;dc&gt;Save Dublin Core metadata as XML&lt;/dc&gt;
+		&lt;fgdc&gt;Save FGDC metadata as XML&lt;/fgdc&gt;
+		&lt;iso19115Esri&gt;Save ISO19115 metadata in XML for ESRI ArcCatalog&lt;/iso19115Esri&gt;
+		&lt;iso19139&gt;Save ISO19115/19139 metadata as XML&lt;/iso19139&gt;
+		&lt;iso19139fra&gt;Save ISO19115/19139 Fra metadata as XML&lt;/iso19139fra&gt;
+	&lt;/savexml&gt;
 	&lt;schema&gt;ÙˆØ­Ø¯Ø©&lt;/schema&gt;
 	&lt;search&gt;Ø¨Ø­Ø«&lt;/search&gt;
 	&lt;searchBox&gt;Ø¨Ø­Ø« Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª&lt;/searchBox&gt;
@@ -417,6 +393,8 @@
 	&lt;searchTemplates&gt;Ø¨Ø­Ø« Ø¹Ù† Ù‚ÙˆØ§Ù„Ø¨&lt;/searchTemplates&gt;
 	&lt;searchText&gt;ÙƒØªØ§Ø¨Ø© Ø­Ø±Ø©&lt;/searchText&gt;
 	&lt;searchUnused&gt;Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø³Ø§Ø³ÙŠØ© Metadata Ø®Ø§Ù„ÙŠØ©&lt;/searchUnused&gt;
+	&lt;searchUnusedTitle&gt;Search for Unused&lt;/searchUnusedTitle&gt;
+	&lt;selection&gt;Selection&lt;/selection&gt;
 	&lt;server&gt;Ù…Ø®Ø¯Ù…&lt;/server&gt;
 	&lt;setAll&gt;Set All&lt;/setAll&gt;
 	&lt;show&gt;Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©&lt;/show&gt;
@@ -425,18 +403,56 @@
 	&lt;simpleTabEditor&gt;Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ø§Ù?ØªØ±Ø§Ø¶ÙŠ&lt;/simpleTabEditor&gt;
 	&lt;siteId&gt;Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù…ÙŠØ²&lt;/siteId&gt;
 	&lt;site&gt;Ø§Ù„Ù…ÙˆÙ‚Ø¹&lt;/site&gt;
+	&lt;sort&gt;Sort&lt;/sort&gt;
+	&lt;sortBy&gt;Sort by&lt;/sortBy&gt;
+	&lt;sortByType id="relevance"&gt;Relevance&lt;/sortByType&gt;
+	&lt;sortByType id="rating"&gt;Rating&lt;/sortByType&gt;
+	&lt;sortByType id="popularity"&gt;Popularity&lt;/sortByType&gt;
+	&lt;sortByType id="date"&gt;Change date&lt;/sortByType&gt;
 	&lt;southbc&gt;Ø§Ù„Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©&lt;/southbc&gt;
 	&lt;spatial2Tab&gt;Spat. Repr.&lt;/spatial2Tab&gt;
 	&lt;spatialTab&gt;Spat. Info&lt;/spatialTab&gt;
+	&lt;state&gt;State&lt;/state&gt;
+	&lt;startsWith&gt;Start with&lt;/startsWith&gt;
 	&lt;styleSheet&gt;StyleSheet&lt;/styleSheet&gt;
 	&lt;submit&gt;Ø£Ø±Ø³Ø§Ù„&lt;/submit&gt;
+	&lt;subtemplate&gt;Subtemplate&lt;/subtemplate&gt;
+	&lt;subtemplateTitle&gt;subtemplate title&lt;/subtemplateTitle&gt;
 	&lt;summaryTab&gt;Ù…Ù„Ø®Øµ&lt;/summaryTab&gt;
 	&lt;surName&gt;Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ±&lt;/surName&gt;
 	&lt;systemConfig&gt;System configuration&lt;/systemConfig&gt;
 	&lt;systemConfigDes&gt;Allows to change some system's parameters&lt;/systemConfigDes&gt;
 	&lt;template&gt;Ù‚Ø§Ù„Ø¨&lt;/template&gt;
+	&lt;Term&gt;Term&lt;/Term&gt;
 	&lt;thanks&gt;Ø´ÙƒØ±Ø§ Ù„Ù…Ø¬Ù‡ÙˆØ¯Ùƒ&lt;/thanks&gt;
 	&lt;theme&gt;ISO topic category&lt;/theme&gt;
+	&lt;thesaurus&gt;
+		&lt;category&gt;Thesaurus category&lt;/category&gt;
+		&lt;management&gt;Manage thesauri&lt;/management&gt;
+		&lt;manDes&gt;Add/modify/delete and show thesauri&lt;/manDes&gt;
+		&lt;edition&gt;Edit thesaurus&lt;/edition&gt;
+		&lt;consultation&gt;View thesaurus&lt;/consultation&gt;
+		&lt;thesaurus&gt;Thesaurus&lt;/thesaurus&gt;
+		&lt;admin&gt;Manage thesaurus&lt;/admin&gt;
+		&lt;edit&gt;Edit thesaurus&lt;/edit&gt;
+		&lt;update&gt;Update thesaurus&lt;/update&gt;
+		&lt;upload&gt;Upload thesaurus&lt;/upload&gt;
+		&lt;download&gt;Download thesaurus&lt;/download&gt;
+		&lt;delete&gt;Delete thesaurus&lt;/delete&gt;	
+		&lt;editelement&gt;Edit element&lt;/editelement&gt;
+		&lt;addelement&gt;Add element&lt;/addelement&gt;			
+		&lt;deleteelement&gt;Delete element&lt;/deleteelement&gt;
+		&lt;updateelement&gt;Update element&lt;/updateelement&gt;
+		&lt;keywordDescription&gt;Keyword definition:&lt;/keywordDescription&gt;
+		&lt;keywordConfirm&gt;Confirm keyword suppression&lt;/keywordConfirm&gt;
+		&lt;unknown&gt;Unknown thesaurus&lt;/unknown&gt;
+		&lt;narrower&gt;Narrower Term&lt;/narrower&gt;
+		&lt;broader&gt;Broader Term&lt;/broader&gt;
+		&lt;related&gt;Related Term&lt;/related&gt;
+		&lt;en&gt;in&lt;/en&gt;
+		&lt;foundKeyWords&gt;Number of terms found&lt;/foundKeyWords&gt;
+		&lt;foundKeyWordsLimit&gt;Maximum number of terms found&lt;/foundKeyWordsLimit&gt;
+	&lt;/thesaurus&gt;
 	&lt;thumbnails&gt;ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©&lt;/thumbnails&gt;
 	&lt;timeout&gt;Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª&lt;/timeout&gt;
 	&lt;timeoutChoice value="10"&gt;Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ&lt;/timeoutChoice&gt;
@@ -444,8 +460,12 @@
 	&lt;timeoutChoice value="30"&gt;Ø¨Ø¹Ø¯ 30 Ø«Ø§Ù†ÙŠØ©&lt;/timeoutChoice&gt;
 	&lt;title&gt;GeoNetwork- The portal to spatial data and information&lt;/title&gt;
 	&lt;to&gt;Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰:&lt;/to&gt;
+	&lt;toDateSelector&gt;Select TO date&lt;/toDateSelector&gt; 
 	&lt;tools&gt;Ø£Ø¯ÙˆØ§Øª&lt;/tools&gt;
 	&lt;topic&gt;Ø¹Ù†ÙˆØ§Ù†&lt;/topic&gt;
+	&lt;transferOwnership&gt;Transfer ownership&lt;/transferOwnership&gt;
+	&lt;transferOwnershipDes&gt;Transfer metadata ownership to another user&lt;/transferOwnershipDes&gt;
+	&lt;type&gt;Type&lt;/type&gt;
 	&lt;up&gt;Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰&lt;/up&gt;
 	&lt;update&gt;ØªØ­Ø¯ÙŠØ«&lt;/update&gt;
 	&lt;updateGroup&gt;ØªØ­Ø¯ÙŠØ« Ù…Ø¬Ù…ÙˆØ¹Ø©&lt;/updateGroup&gt;
@@ -454,6 +474,8 @@
 	&lt;upload&gt;ØªØ­Ù…ÙŠÙ„&lt;/upload&gt;
 	&lt;user&gt;Ù…Ø³ØªØ®Ø¯Ù…&lt;/user&gt;
 	&lt;UserAdmin&gt;Ù…Ø³ØªØ¹Ù…Ù„ Ø£Ø¯Ø§Ø±Ø© Ù…ÙˆÙ‚Ø¹&lt;/UserAdmin&gt;
+	&lt;userInfo&gt;Change user information&lt;/userInfo&gt;
+	&lt;userInfoDes&gt;Allow current user to change user information&lt;/userInfoDes&gt;
 	&lt;userManagement&gt;Ø£Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø¹Ø¶Ø§Ø¡&lt;/userManagement&gt;
 	&lt;userManDes&gt;Ø£Ø¶Ø§Ù?Ø©/ØªØ­Ø¯ÙŠØ«/Ø­Ø°Ù? Ùˆ Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…&lt;/userManDes&gt;
 	&lt;username&gt;Ø§Ø³Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„&lt;/username&gt;
@@ -462,7 +484,9 @@
 	&lt;validate&gt;ØªÙ?ÙŠÙŠØ±&lt;/validate&gt;
 	&lt;validityBegins&gt;Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙŠØ¨Ø¯Ø£&lt;/validityBegins&gt;
 	&lt;validityEnds&gt;ÙˆÙŠÙ†ØªÙ‡ÙŠ&lt;/validityEnds&gt;
+	&lt;view&gt;View&lt;/view&gt;
 	&lt;viewInGE&gt;Google Earth&lt;/viewInGE&gt;
+	&lt;waitGetCap&gt;Loading server layers, please wait...&lt;/waitGetCap&gt;
 	&lt;westbc&gt;Ø§Ù„Ø§Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„ØºØ±Ø¨ÙŠØ©&lt;/westbc&gt;
 	&lt;what&gt;What?&lt;/what&gt;
 	&lt;where&gt;Where?&lt;/where&gt;
@@ -474,6 +498,7 @@
 	Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù?ÙŠ Ù†Ø§Ù?Ø°Ø© Ù…Ø±Ø§Ø¬Ø¹&lt;/winInfo2&gt;
 	&lt;wwwlink&gt;Ø±Ø§Ø¨Ø· ØµÙ?Ø­Ø©&lt;/wwwlink&gt;
 	&lt;xmlInsert&gt;Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠÙ†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Ø­Ø±Ø±Øª ÙƒÙ€XML&lt;/xmlInsert&gt;
+	&lt;xmlInsertTitle&gt;XML Metadata Insert&lt;/xmlInsertTitle&gt;
 	&lt;xmlTab&gt;Ø¹Ø±Ø¶ XML&lt;/xmlTab&gt;
-
+	&lt;zip&gt;Zip&lt;/zip&gt;
 &lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/cn/xml/config.xml
===================================================================
--- trunk/web/geonetwork/loc/cn/xml/config.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/cn/xml/config.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -23,7 +23,19 @@
 	
 	&lt;proxy&gt;Proxy&lt;/proxy&gt;
 		&lt;use&gt;Use&lt;/use&gt;
-	
+	&lt;username&gt;Username&lt;/username&gt;
+	&lt;removedMetadata&gt;Removed metadata&lt;/removedMetadata&gt;
+	&lt;dir&gt;Directory&lt;/dir&gt;
+	&lt;ldap&gt;LDAP Authentication&lt;/ldap&gt;
+	&lt;defProfile&gt;Default profile&lt;/defProfile&gt;
+	&lt;login&gt;Login&lt;/login&gt;
+	&lt;userDN&gt;User DN&lt;/userDN&gt;
+	&lt;distNames&gt;Distinguished names&lt;/distNames&gt;
+	&lt;baseDN&gt;Base&lt;/baseDN&gt;
+	&lt;usersDN&gt;Users&lt;/usersDN&gt;
+	&lt;userAttribs&gt;User's attributes&lt;/userAttribs&gt;
+	&lt;password&gt;Password&lt;/password&gt;
+	&lt;profile&gt;Profile&lt;/profile&gt;
 	&lt;!-- Buttons --&gt;
 	
 	&lt;save&gt;Save&lt;/save&gt;

Modified: trunk/web/geonetwork/loc/cn/xml/metadata-validate.xml
===================================================================
--- trunk/web/geonetwork/loc/cn/xml/metadata-validate.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/cn/xml/metadata-validate.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -2,7 +2,7 @@
 &lt;strings&gt;
 	&lt;heading&gt;å…ƒæ•°æ?®æœ‰æ•ˆæ€§æ£€æŸ¥&lt;/heading&gt;
 	&lt;message&gt;å…ƒæ•°æ?®æœ‰æ•ˆæ€§æ£€æŸ¥æˆ?åŠŸ&lt;/message&gt;
-  &lt;schemaTronError&gt;but there were Error(s) in validating against schematron rules&lt;/schemaTronError&gt;
+	&lt;schemaTronError&gt;but there were Error(s) in validating against schematron rules&lt;/schemaTronError&gt;
   &lt;schemaTronValid&gt;Validation against schematron rules succeeded&lt;/schemaTronValid&gt;
   &lt;schemaTronReport&gt;Schematron report available here&lt;/schemaTronReport&gt;
 &lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/cn/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/cn/xml/strings.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/cn/xml/strings.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -1,6 +1,37 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;strings&gt;
-	&lt;savexml&gt;
+	&lt;contentInfoTab&gt;Content Info&lt;/contentInfoTab&gt;
+	&lt;dateRelChoice/&gt;
+	&lt;downloadable&gt;Downloadable&lt;/downloadable&gt;
+	&lt;dynamic&gt;Interactive&lt;/dynamic&gt;
+	&lt;downloadEmail&gt;Download Email&lt;/downloadEmail&gt;
+	&lt;extensionInfoTab&gt;Ext. Info&lt;/extensionInfoTab&gt;
+	&lt;transferOwnership&gt;Transfer ownership&lt;/transferOwnership&gt;
+	&lt;transferOwnershipDes&gt;Transfer metadata ownership to another user&lt;/transferOwnershipDes&gt;
+	&lt;intermapSearch&gt;Geographic search&lt;/intermapSearch&gt;
+	&lt;opensearch&gt;
+	GeoNetwork opensearch service allow search to be made into the metadata catalog.
+	&lt;/opensearch&gt;
+	&lt;progressChoice/&gt;
+	&lt;protocol&gt;Protocol&lt;/protocol&gt;
+	&lt;options&gt;Options&lt;/options&gt;
+	&lt;output&gt;Output&lt;/output&gt;
+	&lt;outputType id="full"&gt;Full&lt;/outputType&gt;
+	&lt;outputType id="text"&gt;Text only&lt;/outputType&gt;
+	&lt;sortBy&gt;Sort by&lt;/sortBy&gt;
+	&lt;sortByType id="relevance"&gt;Relevance&lt;/sortByType&gt;
+	&lt;sortByType id="rating"&gt;Rating&lt;/sortByType&gt;
+	&lt;sortByType id="popularity"&gt;Popularity&lt;/sortByType&gt;
+	&lt;sortByType id="date"&gt;Change date&lt;/sortByType&gt;
+	&lt;rateIt&gt;Rate It&lt;/rateIt&gt;
+	&lt;mdRating&gt;Metadata Rating&lt;/mdRating&gt;
+	&lt;ratingMsg&gt;
+	Press a button to rate. Note that for harvested metadata you have to wait the new run.
+	&lt;/ratingMsg&gt;
+	&lt;setAll&gt;Set All&lt;/setAll&gt;
+	&lt;Reviewer&gt;Content reviewer&lt;/Reviewer&gt;
+	&lt;waitGetCap&gt;Loading server layers, please wait...&lt;/waitGetCap&gt;
+    &lt;savexml&gt;
 		&lt;dc&gt;Save Dublin Core metadata as XML&lt;/dc&gt;
 		&lt;fgdc&gt;Save FGDC metadata as XML&lt;/fgdc&gt;
 		&lt;iso19115Esri&gt;Save ISO19115 metadata in XML for ESRI ArcCatalog&lt;/iso19115Esri&gt;
@@ -450,6 +481,17 @@
 	&lt;wwwlink&gt;ç½‘ç«™é“¾æŽ¥&lt;/wwwlink&gt;
 	&lt;xmlInsert&gt;å¯¼å…¥ISO19115 XMLæ ¼å¼?çš„å…ƒæ•°æ?®&lt;/xmlInsert&gt;
 	&lt;xmlTab&gt;XMLè§†å›¾&lt;/xmlTab&gt;
+
+	&lt;!--  intermap tooltips --&gt;
+	&lt;imZoomFull&gt;Zoom to full map extent&lt;/imZoomFull&gt;
+	&lt;imZoomIn&gt;Zoom in&lt;/imZoomIn&gt;
+	&lt;imZoomOut&gt;Zoom out&lt;/imZoomOut&gt;
+	&lt;imPan&gt;Pan&lt;/imPan&gt;
+	&lt;imZoomToLayer&gt;Zoom to selected layer extent&lt;/imZoomToLayer&gt;
+	&lt;imAreaInterest&gt;Select an Area Of Interest&lt;/imAreaInterest&gt;
 	
-	
+	&lt;!-- date selector --&gt;
+	&lt;fromDateSelector&gt;Select FROM date&lt;/fromDateSelector&gt; 
+	&lt;toDateSelector&gt;Select TO date&lt;/toDateSelector&gt; 
+
 &lt;/strings&gt;
\ No newline at end of file

Modified: trunk/web/geonetwork/loc/en/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/en/xml/strings.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/en/xml/strings.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -477,4 +477,16 @@
 
 	&lt;xmlInsertTitle&gt;XML Metadata Insert&lt;/xmlInsertTitle&gt;
 	&lt;xmlTab&gt;XML view&lt;/xmlTab&gt;
+        
+        &lt;!--  intermap tooltips --&gt;
+        &lt;imZoomFull&gt;Zoom to full map extent&lt;/imZoomFull&gt;
+        &lt;imZoomIn&gt;Zoom in&lt;/imZoomIn&gt;
+        &lt;imZoomOut&gt;Zoom out&lt;/imZoomOut&gt;
+        &lt;imPan&gt;Pan&lt;/imPan&gt;
+        &lt;imZoomToLayer&gt;Zoom to selected layer extent&lt;/imZoomToLayer&gt;
+        &lt;imAreaInterest&gt;Select an Area Of Interest&lt;/imAreaInterest&gt;
+
+        &lt;!-- date selector --&gt;
+        &lt;fromDateSelector&gt;Select FROM date&lt;/fromDateSelector&gt; 
+        &lt;toDateSelector&gt;Select TO date&lt;/toDateSelector&gt; 
 &lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/es/xml/config.xml
===================================================================
--- trunk/web/geonetwork/loc/es/xml/config.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/es/xml/config.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -23,7 +23,19 @@
 	
 	&lt;proxy&gt;Proxy&lt;/proxy&gt;
 		&lt;use&gt;Uso&lt;/use&gt;
-	
+	&lt;username&gt;Username&lt;/username&gt;
+	&lt;removedMetadata&gt;Removed metadata&lt;/removedMetadata&gt;
+	&lt;dir&gt;Directory&lt;/dir&gt;
+	&lt;ldap&gt;LDAP Authentication&lt;/ldap&gt;
+	&lt;defProfile&gt;Default profile&lt;/defProfile&gt;
+	&lt;login&gt;Login&lt;/login&gt;
+	&lt;userDN&gt;User DN&lt;/userDN&gt;
+	&lt;distNames&gt;Distinguished names&lt;/distNames&gt;
+	&lt;baseDN&gt;Base&lt;/baseDN&gt;
+	&lt;usersDN&gt;Users&lt;/usersDN&gt;
+	&lt;userAttribs&gt;User's attributes&lt;/userAttribs&gt;
+	&lt;password&gt;Password&lt;/password&gt;
+	&lt;profile&gt;Profile&lt;/profile&gt;
 	&lt;!-- Buttons --&gt;
 	
 	&lt;save&gt;Guardar&lt;/save&gt;

Modified: trunk/web/geonetwork/loc/es/xml/metadata-validate.xml
===================================================================
--- trunk/web/geonetwork/loc/es/xml/metadata-validate.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/es/xml/metadata-validate.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -2,7 +2,7 @@
 &lt;strings&gt;
 	&lt;heading&gt;ValidaciÃ³n de metadatos&lt;/heading&gt;
 	&lt;message&gt;Metadatos validados exitosamente&lt;/message&gt;
-  &lt;schemaTronError&gt;but there were Error(s) in validating against schematron rules&lt;/schemaTronError&gt;
+	&lt;schemaTronError&gt;but there were Error(s) in validating against schematron rules&lt;/schemaTronError&gt;
   &lt;schemaTronValid&gt;Validation against schematron rules succeeded&lt;/schemaTronValid&gt;
   &lt;schemaTronReport&gt;Schematron report available here&lt;/schemaTronReport&gt;
 &lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/es/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/es/xml/strings.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/es/xml/strings.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -1,6 +1,23 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;strings&gt;
-
+	&lt;clearAll&gt;Clear All&lt;/clearAll&gt;
+	&lt;contentInfoTab&gt;Content Info&lt;/contentInfoTab&gt;
+	&lt;dateRelChoice/&gt;
+	&lt;downloadable&gt;Downloadable&lt;/downloadable&gt;
+	&lt;dynamic&gt;Interactive&lt;/dynamic&gt;
+	&lt;downloadEmail&gt;Download Email&lt;/downloadEmail&gt;
+	&lt;extensionInfoTab&gt;Ext. Info&lt;/extensionInfoTab&gt;
+	&lt;transferOwnership&gt;Transfer ownership&lt;/transferOwnership&gt;
+	&lt;transferOwnershipDes&gt;Transfer metadata ownership to another user&lt;/transferOwnershipDes&gt;
+	&lt;highlights&gt;Highlights&lt;/highlights&gt;
+	&lt;intermapSearch&gt;Geographic search&lt;/intermapSearch&gt;
+	   &lt;opensearch&gt;
+	GeoNetwork opensearch service allow search to be made into the metadata catalog.
+	&lt;/opensearch&gt;
+	&lt;progressChoice/&gt;
+	&lt;protocol&gt;Protocol&lt;/protocol&gt;
+	&lt;Reviewer&gt;Content reviewer&lt;/Reviewer&gt;
+	&lt;waitGetCap&gt;Loading server layers, please wait...&lt;/waitGetCap&gt;
 	&lt;savexml&gt;
 		&lt;dc&gt;Guardar metadatos de Dublin Core como XML&lt;/dc&gt;
 		&lt;fgdc&gt;Guardar metadatos FGDC como XML&lt;/fgdc&gt;
@@ -484,55 +501,7 @@
 	&lt;xmlInsert&gt;ImportaciÃ³n de un fichero XML de Metadatos&lt;/xmlInsert&gt;
 	&lt;xmlTab&gt;Ã?rbol XML&lt;/xmlTab&gt;
 
-	&lt;!-- these strings are not defined in the main language
-	&lt;batchImportDesc&gt;ImportaciÃ³n por lotes&lt;/batchImportDesc&gt;
-	&lt;buttonAccept&gt;Aceptar&lt;/buttonAccept&gt;
-	&lt;buttonAdd&gt;AÃ±adir&lt;/buttonAdd&gt;
-	&lt;buttonAddNewGroup&gt;AÃ±adir Grupo&lt;/buttonAddNewGroup&gt;
-	&lt;buttonAddNewUser&gt;AÃ±adir Usuario&lt;/buttonAddNewUser&gt;
-	&lt;buttonAdvancedSearch&gt;BÃºsqueda Avanzada&lt;/buttonAdvancedSearch&gt;
-	&lt;buttonBack&gt;AtrÃ¡s&lt;/buttonBack&gt;
-	&lt;buttonBatchImport&gt;Importar Remesa&lt;/buttonBatchImport&gt;
-	&lt;buttonBrowse&gt;Ojear&lt;/buttonBrowse&gt;
-	&lt;buttonCancel&gt;Cancelar&lt;/buttonCancel&gt;
-	&lt;buttonClear&gt;Limpiar&lt;/buttonClear&gt;
-	&lt;buttonCreate&gt;Crear&lt;/buttonCreate&gt;
-	&lt;buttonDecline&gt;Rechazar&lt;/buttonDecline&gt;
-	&lt;buttonDefaultSearch&gt;BÃºsqueda Simple&lt;/buttonDefaultSearch&gt;
-	&lt;buttonDelete&gt;Borrar&lt;/buttonDelete&gt;
-	&lt;buttonDescription&gt;DescripciÃ³n&lt;/buttonDescription&gt;
-	&lt;buttonDownload&gt;Bajar informaciÃ³n&lt;/buttonDownload&gt;
-	&lt;buttonEdit&gt;Editar&lt;/buttonEdit&gt;
-	&lt;buttonGroupManagement&gt;Gestionar grupos&lt;/buttonGroupManagement&gt;
-	&lt;buttonImport&gt;Importar&lt;/buttonImport&gt;
-	&lt;buttonInsertXMLMetadata&gt;Insertar metadato XML&lt;/buttonInsertXMLMetadata&gt;
-	&lt;buttonInteractiveMap&gt;Mapa Interactivo&lt;/buttonInteractiveMap&gt;
-	&lt;buttonLogin&gt;Entrar&lt;/buttonLogin&gt;
-	&lt;buttonMap&gt;Mapa&lt;/buttonMap&gt;
-	&lt;buttonNewMetadata&gt;Nuevo Metadato&lt;/buttonNewMetadata&gt;
-	&lt;buttonPrint&gt;Imprimir&lt;/buttonPrint&gt;
-	&lt;buttonPrivileges&gt;Privilegios&lt;/buttonPrivileges&gt;
-	&lt;buttonRemove&gt;Suprimir&lt;/buttonRemove&gt;
-	&lt;buttonReset&gt;Vaciar formulario&lt;/buttonReset&gt;
-	&lt;buttonSave&gt;Salvar&lt;/buttonSave&gt;
-	&lt;buttonSaveAndClose&gt;Salvar y Cerrar&lt;/buttonSaveAndClose&gt;
-	&lt;buttonSearch&gt;Buscar&lt;/buttonSearch&gt;
-	&lt;buttonSubmit&gt;Enviar&lt;/buttonSubmit&gt;
-	&lt;buttonTabbedView&gt;Vista en forma de Tabla&lt;/buttonTabbedView&gt;
-	&lt;buttonUpload&gt;Subir InformaciÃ³n&lt;/buttonUpload&gt;
-	&lt;buttonUserManagement&gt;Gestionar Usuarios&lt;/buttonUserManagement&gt;
-	&lt;copyright3&gt;Â© ......&lt;/copyright3&gt;
-	&lt;count&gt;NÃºmero&lt;/count&gt;
-	&lt;mapServer&gt;ConexiÃ³n con el servidor de mapas&lt;/mapServer&gt;
-	&lt;metadataPerRegion&gt;Metadatos para una regiÃ³n&lt;/metadataPerRegion&gt;
-	&lt;xmlMetadataInsert&gt;Insertar Metadato en base a un fichero XML&lt;/xmlMetadataInsert&gt;
-	&lt;xmlInsertDesc&gt;Insertar Metadato desde un fichero XML&lt;/xmlInsertDesc&gt;
-	&lt;orderBy&gt;Ordenar por&lt;/orderBy&gt;
-	&lt;rank&gt;Los mejores resultados&lt;/rank&gt;
-	&lt;downloads&gt;NÃºmero de descargas&lt;/downloads&gt;
-	&lt;lastChange&gt;Fecha del Ãºltimo cambio&lt;/lastChange&gt;
-	--&gt;
-        &lt;!--  intermap tooltips --&gt;
+	&lt;!--  intermap tooltips --&gt;
         &lt;imZoomFull&gt;Zoom a la extensiÃ³n del mapa&lt;/imZoomFull&gt;
         &lt;imZoomIn&gt;Acercar&lt;/imZoomIn&gt;
         &lt;imZoomOut&gt;Alejar&lt;/imZoomOut&gt;
@@ -544,5 +513,4 @@
         &lt;fromDateSelector&gt;Selector de fecha de inicio&lt;/fromDateSelector&gt; 
         &lt;toDateSelector&gt;Selector de fecha de fin&lt;/toDateSelector&gt; 
 
-
 &lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/fr/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/fr/xml/strings.xml	2008-02-27 07:27:51 UTC (rev 1145)
+++ trunk/web/geonetwork/loc/fr/xml/strings.xml	2008-02-27 15:00:40 UTC (rev 1146)
@@ -1,5 +1,18 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;strings&gt;
+	&lt;clearAll&gt;Clear All&lt;/clearAll&gt;
+	&lt;contentInfoTab&gt;Content Info&lt;/contentInfoTab&gt;
+	&lt;convert&gt;Conversion&lt;/convert&gt;
+	&lt;dateRelChoice/&gt;
+	&lt;downloadEmail&gt;Email TÃ©lÃ©chargement&lt;/downloadEmail&gt;
+	&lt;extensionInfoTab&gt;Ext. Info&lt;/extensionInfoTab&gt;
+	&lt;feedbackCardTitle&gt;Commentaire&lt;/feedbackCardTitle&gt;
+	&lt;feedbackComments&gt;Retour/Commentaires&lt;/feedbackComments&gt;
+	&lt;transferOwnership&gt;Transfert de privilÃ¨ges&lt;/transferOwnership&gt;
+	&lt;transferOwnershipDes&gt;Transfert des privilÃ¨ges de mÃ©tadonnÃ©es pour un autre utilisateur&lt;/transferOwnershipDes&gt;
+	&lt;intermapSearch&gt;Recherche gÃ©ographique&lt;/intermapSearch&gt;
+	&lt;Reviewer&gt;Content reviewer&lt;/Reviewer&gt;
+	&lt;waitGetCap&gt;Chargement en cours ...&lt;/waitGetCap&gt;
     &lt;downloadable&gt;TÃ©lÃ©chargeable&lt;/downloadable&gt;
     &lt;dynamic&gt;Interactive&lt;/dynamic&gt;
 	&lt;opensearch&gt;Service de recherche OpenSearch de GeoNetwork permettant la recherche de mÃ©tadonnÃ©es dans le catalogue.&lt;/opensearch&gt;
@@ -495,4 +508,16 @@
 
 	&lt;xmlInsertTitle&gt;Import de fichiers XML&lt;/xmlInsertTitle&gt;
 	&lt;xmlTab&gt;XML&lt;/xmlTab&gt;	
+
+	&lt;!--  intermap tooltips --&gt;
+	&lt;imZoomFull&gt;Zoom to full map extent&lt;/imZoomFull&gt;
+	&lt;imZoomIn&gt;Zoom in&lt;/imZoomIn&gt;
+	&lt;imZoomOut&gt;Zoom out&lt;/imZoomOut&gt;
+	&lt;imPan&gt;Pan&lt;/imPan&gt;
+	&lt;imZoomToLayer&gt;Zoom to selected layer extent&lt;/imZoomToLayer&gt;
+	&lt;imAreaInterest&gt;Select an Area Of Interest&lt;/imAreaInterest&gt;
+	
+	&lt;!-- date selector --&gt;
+	&lt;fromDateSelector&gt;Select FROM date&lt;/fromDateSelector&gt; 
+	&lt;toDateSelector&gt;Select TO date&lt;/toDateSelector&gt; 
 &lt;/strings&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18797304">[GeoNetwork-commit] SF.net SVN: geonetwork: [1204] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;ticheler@us...&gt; -	2008-03-10 14:26</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1204
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1204&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1204&amp;view=rev</a>
Author:   ticheler
Date:     2008-03-10 07:26:01 -0700 (Mon, 10 Mar 2008)

Log Message:
-----------
Synchronizing changes that are part of v2.2RC2 and have been first committed on branch 2.2.x

Modified Paths:
--------------
    trunk/docs/changes.txt
    trunk/gast/data/index.html
    trunk/web/geonetwork/WEB-INF/config-export.xml
    trunk/web/geonetwork/WEB-INF/config-metadata.xml
    trunk/web/geonetwork/WEB-INF/config.xml
    trunk/web/geonetwork/geonetwork.css
    trunk/web/geonetwork/index.html
    trunk/web/geonetwork/loc/ar/xml/strings.xml
    trunk/web/geonetwork/loc/cn/xml/strings.xml
    trunk/web/geonetwork/loc/en/xml/privileges-error.xml
    trunk/web/geonetwork/loc/en/xml/strings.xml
    trunk/web/geonetwork/loc/es/xml/strings.xml
    trunk/web/geonetwork/loc/fr/xml/strings.xml
    trunk/web/geonetwork/scripts/gn_search.js
    trunk/web/geonetwork/xml/schemas/dublin-core/loc/ar/labels.xml
    trunk/web/geonetwork/xml/schemas/dublin-core/loc/cn/labels.xml
    trunk/web/geonetwork/xml/schemas/dublin-core/loc/es/labels.xml
    trunk/web/geonetwork/xml/schemas/dublin-core/loc/fr/labels.xml
    trunk/web/geonetwork/xml/schemas/iso19139/loc/ar/labels.xml
    trunk/web/geonetwork/xml/schemas/iso19139/loc/cn/labels.xml
    trunk/web/geonetwork/xml/schemas/iso19139/loc/es/labels.xml
    trunk/web/geonetwork/xml/schemas/iso19139/loc/fr/labels.xml
    trunk/web/geonetwork/xsl/error.xsl
    trunk/web/geonetwork/xsl/main-page.xsl
    trunk/web/geonetwork/xsl/metadata-error.xsl
    trunk/web/geonetwork/xsl/metadata-iso19115.xsl
    trunk/web/geonetwork/xsl/metadata-iso19139.xsl
    trunk/web/geonetwork/xsl/metadata-show-embedded.xsl
    trunk/web/geonetwork/xsl/metadata-show.xsl
    trunk/web/geonetwork/xsl/rss-latest.xsl
    trunk/web/geonetwork/xsl/rss-search.xsl
    trunk/web/geonetwork/xsl/rss-utils.xsl
    trunk/web/geonetwork/xsl/searchform_advanced.xsl
    trunk/web/geonetwork/xsl/searchform_simple_template.xsl
    trunk/web/geonetwork/xsl/utils.xsl
    trunk/web/intermap/scripts/im_minimap.js

Added Paths:
-----------
    trunk/web/geonetwork/images/bookmark.png
    trunk/web/geonetwork/images/mail.png
    trunk/web/geonetwork/loc/ar/xml/metadata-show-error.xml
    trunk/web/geonetwork/loc/cn/xml/metadata-show-error.xml
    trunk/web/geonetwork/loc/en/xml/metadata-show-error.xml
    trunk/web/geonetwork/loc/es/xml/metadata-show-error.xml
    trunk/web/geonetwork/loc/fr/xml/metadata-show-error.xml
    trunk/web/geonetwork/xsl/error-embedded.xsl

Property Changed:
----------------
    trunk/


Property changes on: trunk
___________________________________________________________________
Name: svn:ignore
   + .props
.settings
geonetwork-2.2.0
jre1.5.0_12
.classpath
.project


Modified: trunk/docs/changes.txt
===================================================================
--- trunk/docs/changes.txt	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/docs/changes.txt	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,5 +1,146 @@
 ================================================================================
 ===
+=== GeoNetwork 2.2.0 RC2: List of changes
+===
+================================================================================
+--------------------------------------------------------------------------------
+--- New
+--------------------------------------------------------------------------------
+
+- Migration of all documentation into DocBook based on the Apache Velocity 
+  DocBook framework. All documentation is now written in DocBook format and 
+  build into HTML and PDF output using Ant.
+  
+- RESTful URL to metadata resources using URLs formatted as:
+	<a href="http://mysite.org/geonetwork?uuid=xxx-xxx-xxx" target="_new">http://mysite.org/geonetwork?uuid=xxx-xxx-xxx</a>
+	
+- uuid can be used to show a record. This is now used for RSS feeds, KML, latest
+  updates and searches
+  
+- Added Social Bookmarking links to delicious, digg, stumbleupon and facebook
+  (not visible for resources on local machine (localhost, 127.0.0.1)
+
+- Added Send by email link for metadata records
+  (not visible for resources on local machine (localhost, 127.0.0.1)
+  
+- Add push pins with comments on InterMap. The markers can be edited and are
+  stored in GeoRSS format within the Web Map Context document and in the HTML
+  email users can send to friends.
+  
+- Add and remove parent - child relations between metadata records. (No GUI is 
+  provided with this service and the functionality relates to the already 
+  existing xml.relation.get search function)
+  
+- Added local GeoServer link to InterMap default list of map servers.
+
+- Added support for PHRASE, OR and WITHOUT queries (for now hidden in search 
+  form, but can easily be made visible)
+      
+--------------------------------------------------------------------------------
+--- Changes
+--------------------------------------------------------------------------------
+
+- Improved RSS feeds on search and latest updates are consolidated 
+  (use same templates for output of items)
+  
+- Updates to documentation
+
+- Improved error reporting in AJAX interface
+
+- Minor translation updates
+
+- Improved email message send out by InterMap with Web Map Context document
+
+- language support and simplified messaging to the validation output
+
+- Changed startup scripts for Windows to hide (or allow to hide) the dos window.
+
+- GeoRSS opens in new browser window
+
+- Added SMTP port to WMC mail function
+
+- Hide sub-template elements (option and title) for 2.2RC2
+
+- Add debug parameter to avoid popup alerts on InterMap for operational 
+  deployments.
+  
+- Renamed gast startup files. Makes it slightly easier to run 
+  start-geonetwork.sh from terminal on a *NIX machine.
+  
+- Small updates in shortcut menus
+
+- Added a docs context as part of the Jetty configuration.
+
+- Added "label for" for checkbox elements to be able to check boxes when 
+  clicking the label
+  
+- Added some gml labels for nicer display and editing.
+
+- Upgrade Lucene to version 2.3.0
+
+- Change of content type for RSS services
+
+- Automatically open the map viewer when a WMC context is given in the URL.
+
+- Updated help on Localization interface
+
+- Cleanup OnlineResources display to prevent display of download and interactive
+  map buttons when no URL is actually found in the metadata
+  
+- Added warning &amp; help to the categories and groups admin forms
+
+--------------------------------------------------------------------------------
+--- Bugs fixed
+--------------------------------------------------------------------------------
+
+- Fixed geographic search (communication between small map AoI and dropdown 
+  list, added User defined as an option to dropdown)
+  
+- Fix problem retrieving string from editor.xml that causes internet exploder 
+  to choke on tooltips for elements without a help string
+  
+- Retrieve the keywords relevant to the record in preparing brief summary xml
+
+- Fix for the info request to a WMS service
+
+- Feedback fix (feedback was not processed by application)
+
+- Fixes for attributeGroup inheritance and automatic srsName. Added support for 
+  the srsName attribute in gml featuretypes for display and editing the Extent 
+  as an EX_BoundingPolygon.
+
+- Fixed #55 adding an observer for Enter key on main.home page
+
+- Fixed #44 switch lower/upper corners of geokeywords
+  
+- MySQL longtext fix to avoid truncated metadata records
+
+- Initial minimap extent is now set to the union of the bboxes of all the 
+  displayed layers.
+
+- Ensure UUIDs are stored in lower case
+
+- Copy attributes before inserting new fileIdentifier element
+
+- Fix for IE: clicking on a marker now opens its info panel.
+
+- Fixed: Layer list not displayed in IE.
+
+--------------------------------------------------------------------------------
+--- Known issues
+--------------------------------------------------------------------------------
+
+- default settings reset function in advanced search not in synch with 
+  application defaults (fixed for Final Release)
+
+- Namespace issue for some labels in languages other than English in 
+  ISO19115/19139 (fixed for Final Release)
+
+- Some missing labels for Dublin Core fields in languages other than English 
+  (fixed for Final Release)
+
+================================================================================
+===
 === GeoNetwork 2.2.0 RC1: List of changes
 ===
 ================================================================================

Modified: trunk/gast/data/index.html
===================================================================
--- trunk/gast/data/index.html	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/gast/data/index.html	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,14 +1,16 @@
-&lt;HTML&gt;
-	&lt;HEAD&gt;
-		&lt;META http-equiv="refresh" content="0; URL=/$SERVLET/srv/en/main.home"&gt;
-		&lt;META http-equiv="Pragma" content="no-cache"&gt;
-		&lt;META http-equiv="Cache-Control" content="no-cache,no-store"&gt;
-	
+&lt;html&gt;
+	&lt;head&gt;
+		&lt;meta http-equiv="Pragma" content="no-cache"&gt;
+		&lt;meta http-equiv="Cache-Control" content="no-cache,no-store"&gt;
+		&lt;link rel="stylesheet" type="text/css" href="geonetwork.css"&gt;
 		&lt;script language="Javascript1.5" type="text/javascript"&gt;
-			window.location="/$SERVLET/srv/en/main.home"
+			var search = window.location.search;
+			window.location="/$SERVLET/srv/en/main.home" + search
 		&lt;/script&gt;
-	&lt;/HEAD&gt;
-	&lt;BODY BGCOLOR="#FFFFFF"&gt;
-		&lt;FONT size=-5&gt;&lt;A HREF="/$SERVLET/srv/en/main.home"&gt;GeoNetwork&lt;/A&gt;&lt;/FONT&gt;
-	&lt;/BODY&gt;
-&lt;/HTML&gt;
+	&lt;/head&gt;
+	&lt;body&gt;
+		&lt;h2&gt;JavaScript warning&lt;/h2&gt;
+		&lt;p&gt;To use GeoNetwork you need to enable JavaScript in your browser&lt;/p&gt;
+	&lt;/body&gt;
+&lt;/html&gt;
+

Modified: trunk/web/geonetwork/WEB-INF/config-export.xml
===================================================================
--- trunk/web/geonetwork/WEB-INF/config-export.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/WEB-INF/config-export.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -9,8 +9,8 @@
 		&lt;service name="dc.xml"&gt;
 			&lt;class name=".services.metadata.Show" /&gt;
 			&lt;output sheet="conversion/export/xml_dc.xsl" contentType="text/xml; charset=UTF-8"/&gt;
-			&lt;error id="access" sheet="error-form.xsl"&gt;
-				&lt;xml name="privError" file="xml/privileges-error.xml" /&gt;
+			&lt;error id="operation-not-allowed" sheet="error-embedded.xsl"&gt;
+				&lt;xml name="error" file="xml/privileges-error.xml" /&gt;
 			&lt;/error&gt;
 		&lt;/service&gt;
 		
@@ -19,8 +19,8 @@
 		&lt;service name="fgdc.xml"&gt;
 			&lt;class name=".services.metadata.Show" /&gt;
 			&lt;output sheet="conversion/export/xml_fgdc.xsl" contentType="text/xml; charset=UTF-8"/&gt;
-			&lt;error id="access" sheet="error-form.xsl"&gt;
-				&lt;xml name="privError" file="xml/privileges-error.xml" /&gt;
+			&lt;error id="operation-not-allowed" sheet="error-embedded.xsl"&gt;
+				&lt;xml name="error" file="xml/privileges-error.xml" /&gt;
 			&lt;/error&gt;
 		&lt;/service&gt;
 		
@@ -29,8 +29,8 @@
 		&lt;service name="iso19115to19139.xml"&gt;
 			&lt;class name=".services.metadata.Show" /&gt;
 			&lt;output sheet="conversion/export/xml_iso19115_to_19139.xsl" contentType="text/xml; charset=UTF-8"/&gt;
-			&lt;error id="access" sheet="error-form.xsl"&gt;
-				&lt;xml name="privError" file="xml/privileges-error.xml" /&gt;
+			&lt;error id="operation-not-allowed" sheet="error-embedded.xsl"&gt;
+				&lt;xml name="error" file="xml/privileges-error.xml" /&gt;
 			&lt;/error&gt;
 		&lt;/service&gt;
 		
@@ -39,8 +39,8 @@
 		&lt;service name="iso19139.xml"&gt;
 			&lt;class name=".services.metadata.Show" /&gt;
 			&lt;output sheet="conversion/export/xml_iso19139.xsl" contentType="text/xml; charset=UTF-8"/&gt;
-			&lt;error id="access" sheet="error-form.xsl"&gt;
-				&lt;xml name="privError" file="xml/privileges-error.xml" /&gt;
+			&lt;error id="operation-not-allowed" sheet="error-embedded.xsl"&gt;
+				&lt;xml name="error" file="xml/privileges-error.xml" /&gt;
 			&lt;/error&gt;
 		&lt;/service&gt;
 
@@ -49,8 +49,8 @@
 		&lt;service name="iso_arccatalog8.xml"&gt;
 			&lt;class name=".services.metadata.Show" /&gt;
 			&lt;output sheet="conversion/export/xml_iso19115arccatalog.xsl" contentType="text/xml; charset=UTF-8"/&gt;
-			&lt;error id="access" sheet="error-form.xsl"&gt;
-				&lt;xml name="privError" file="xml/privileges-error.xml" /&gt;
+			&lt;error id="operation-not-allowed" sheet="error-embedded.xsl"&gt;
+				&lt;xml name="error" file="xml/privileges-error.xml" /&gt;
 			&lt;/error&gt;
 		&lt;/service&gt;
 		

Modified: trunk/web/geonetwork/WEB-INF/config-metadata.xml
===================================================================
--- trunk/web/geonetwork/WEB-INF/config-metadata.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/WEB-INF/config-metadata.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -26,7 +26,7 @@
 			&lt;/output&gt;
 
 			&lt;error id="operation-not-allowed" sheet="error.xsl"&gt;
-				&lt;xml name="privError" file="xml/privileges-error.xml" /&gt;
+				&lt;xml name="error" file="xml/metadata-show-error.xml" /&gt;
 			&lt;/error&gt;
 		&lt;/service&gt;
 
@@ -42,8 +42,8 @@
 				&lt;call name="isoLang"  class=".guiservices.isolanguages.Get"/&gt;
 			&lt;/output&gt;
 
-			&lt;error id="operation-not-allowed" sheet="error.xsl"&gt;
-				&lt;xml name="privError" file="xml/privileges-error.xml" /&gt;
+			&lt;error id="operation-not-allowed" sheet="error-embedded.xsl"&gt;
+				&lt;xml name="error" file="xml/metadata-show-error.xml" /&gt;
 			&lt;/error&gt;
 		&lt;/service&gt;
 

Modified: trunk/web/geonetwork/WEB-INF/config.xml
===================================================================
--- trunk/web/geonetwork/WEB-INF/config.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/WEB-INF/config.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -590,7 +590,7 @@
 		&lt;service name="resources.get"&gt;
 			&lt;class name=".services.resources.Download" /&gt;
 
-			&lt;error id="file-not-found" sheet="error.xsl"&gt;
+			&lt;error id="file-not-found" sheet="error-embedded.xsl"&gt;
 				&lt;xml name="error" file="xml/file-not-found-error.xml" /&gt;
 			&lt;/error&gt;
 
@@ -742,8 +742,8 @@
 				&lt;call name="services" class="jeeves.guiservices.services.Get" /&gt;
 				&lt;xml name="sources" file="xml/sources.xml" localized="false" /&gt;
 			&lt;/output&gt;
-			&lt;error id="access" sheet="error-form.xsl"&gt;
-				&lt;xml name="privError" file="xml/privileges-error.xml" /&gt;
+			&lt;error id="operation-not-allowed" sheet="error.xsl"&gt;
+				&lt;xml name="error" file="xml/privileges-error.xml" /&gt;
 			&lt;/error&gt;
 		&lt;/service&gt;
 
@@ -775,16 +775,10 @@
 
 		&lt;service name="xml.relation.insert"&gt;
 			&lt;class name=".services.relations.Insert" /&gt;
-			&lt;error id="insert" sheet="error.xsl"&gt;
-				&lt;xml  name="error"   file="xml/error.xml" /&gt;
-			&lt;/error&gt;
 		&lt;/service&gt;
 		
 		&lt;service name="xml.relation.delete"&gt;
 			&lt;class name=".services.relations.Remove" /&gt;
-			&lt;error id="delete" sheet="error.xsl"&gt;
-				&lt;xml  name="error"   file="xml/error.xml" /&gt;
-			&lt;/error&gt;
 		&lt;/service&gt;
 		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;

Modified: trunk/web/geonetwork/geonetwork.css
===================================================================
--- trunk/web/geonetwork/geonetwork.css	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/geonetwork.css	2008-03-10 14:26:01 UTC (rev 1204)
@@ -646,3 +646,12 @@
     
     z-index: 20;    
 }
+
+div#error {
+	margin: 2em;
+}
+
+#stacktrace {
+	font-size: 0.75em;
+}
+

Added: trunk/web/geonetwork/images/bookmark.png
===================================================================
(Binary files differ)


Property changes on: trunk/web/geonetwork/images/bookmark.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/web/geonetwork/images/mail.png
===================================================================
(Binary files differ)


Property changes on: trunk/web/geonetwork/images/mail.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/web/geonetwork/index.html
===================================================================
--- trunk/web/geonetwork/index.html	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/index.html	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,14 +1,17 @@
-&lt;HTML&gt;
-	&lt;HEAD&gt;
-		&lt;META http-equiv="refresh" content="0; URL=/geonetwork/srv/en/main.home"&gt;
-		&lt;META http-equiv="Pragma" content="no-cache"&gt;
-		&lt;META http-equiv="Cache-Control" content="no-cache,no-store"&gt;
-	
+&lt;!-- This file will be substituted by the installer with the index.html template 
+     Located at gast\data\index.html --&gt;
+&lt;html&gt;
+	&lt;head&gt;
+		&lt;meta http-equiv="Pragma" content="no-cache"&gt;
+		&lt;meta http-equiv="Cache-Control" content="no-cache,no-store"&gt;
+		&lt;link rel="stylesheet" type="text/css" href="geonetwork.css"&gt;
 		&lt;script language="Javascript1.5" type="text/javascript"&gt;
-			window.location="/geonetwork/srv/en/main.home"
+			var search = window.location.search;
+			window.location="/geonetwork/srv/en/main.home" + search;
 		&lt;/script&gt;
-	&lt;/HEAD&gt;
-	&lt;BODY BGCOLOR="#FFFFFF"&gt;
-		&lt;FONT size=-5&gt;&lt;A HREF="/geonetwork/srv/en/main.home"&gt;GeoNetwork&lt;/A&gt;&lt;/FONT&gt;
-	&lt;/BODY&gt;
-&lt;/HTML&gt;
+	&lt;/head&gt;
+	&lt;body&gt;
+		&lt;h2&gt;JavaScript warning&lt;/h2&gt;
+		&lt;p&gt;To use GeoNetwork you need to enable JavaScript in your browser&lt;/p&gt;
+	&lt;/body&gt;
+&lt;/html&gt;

Added: trunk/web/geonetwork/loc/ar/xml/metadata-show-error.xml
===================================================================
--- trunk/web/geonetwork/loc/ar/xml/metadata-show-error.xml	                        (rev 0)
+++ trunk/web/geonetwork/loc/ar/xml/metadata-show-error.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -0,0 +1,6 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;strings&gt;
+	&lt;heading&gt;Error accessing the resource&lt;/heading&gt;
+	&lt;message&gt;The resource requested could not be found or accessed. It may have been removed or you may not have the privileges to access it.&lt;/message&gt;
+	&lt;button&gt;Back&lt;/button&gt;
+&lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/ar/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/ar/xml/strings.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/loc/ar/xml/strings.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -479,6 +479,7 @@
 	&lt;upload&gt;ØªØ­Ù…ÙŠÙ„&lt;/upload&gt;
 	&lt;user&gt;Ù…Ø³ØªØ®Ø¯Ù…&lt;/user&gt;
 	&lt;UserAdmin&gt;Ù…Ø³ØªØ¹Ù…Ù„ Ø£Ø¯Ø§Ø±Ø© Ù…ÙˆÙ‚Ø¹&lt;/UserAdmin&gt;
+	&lt;userDefined&gt;- User defined -&lt;/userDefined&gt;
 	&lt;userInfo&gt;Change user information&lt;/userInfo&gt;
 	&lt;userInfoDes&gt;Allow current user to change user information&lt;/userInfoDes&gt;
 	&lt;userManagement&gt;Ø£Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø¹Ø¶Ø§Ø¡&lt;/userManagement&gt;

Added: trunk/web/geonetwork/loc/cn/xml/metadata-show-error.xml
===================================================================
--- trunk/web/geonetwork/loc/cn/xml/metadata-show-error.xml	                        (rev 0)
+++ trunk/web/geonetwork/loc/cn/xml/metadata-show-error.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -0,0 +1,6 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;strings&gt;
+	&lt;heading&gt;Error accessing the resource&lt;/heading&gt;
+	&lt;message&gt;The resource requested could not be found or accessed. It may have been removed or you may not have the privileges to access it.&lt;/message&gt;
+	&lt;button&gt;Back&lt;/button&gt;
+&lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/cn/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/cn/xml/strings.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/loc/cn/xml/strings.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -468,6 +468,7 @@
 	&lt;upload&gt;ä¸Šè½½&lt;/upload&gt;
 	&lt;user&gt;ç”¨æˆ·&lt;/user&gt;
 	&lt;UserAdmin&gt;ç”¨æˆ·ç®¡ç?†å‘˜&lt;/UserAdmin&gt;
+	&lt;userDefined&gt;- User defined -&lt;/userDefined&gt;
 	&lt;userManagement&gt;ç”¨æˆ·ç®¡ç?†&lt;/userManagement&gt;
 	&lt;userManDes&gt;æ–°å¢ž/ä¿®æ”¹/åˆ é™¤ä»¥å?Šæ˜¾ç¤ºç”¨æˆ·&lt;/userManDes&gt;
 	&lt;username&gt;ç”¨æˆ·å??&lt;/username&gt;

Added: trunk/web/geonetwork/loc/en/xml/metadata-show-error.xml
===================================================================
--- trunk/web/geonetwork/loc/en/xml/metadata-show-error.xml	                        (rev 0)
+++ trunk/web/geonetwork/loc/en/xml/metadata-show-error.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -0,0 +1,6 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;strings&gt;
+	&lt;heading&gt;Error accessing the resource&lt;/heading&gt;
+	&lt;message&gt;The resource requested could not be found or accessed. It may have been removed or you may not have the privileges to access it.&lt;/message&gt;
+	&lt;button&gt;Back&lt;/button&gt;
+&lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/en/xml/privileges-error.xml
===================================================================
--- trunk/web/geonetwork/loc/en/xml/privileges-error.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/loc/en/xml/privileges-error.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,6 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;strings&gt;
 	&lt;heading&gt;Privileges Error&lt;/heading&gt;
-	&lt;message&gt;You don't have the privileges to do this.&lt;/message&gt;
+	&lt;message&gt;You may not have the privileges to do this operation.&lt;/message&gt;
 	&lt;button&gt;Back&lt;/button&gt;
 &lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/en/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/en/xml/strings.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/loc/en/xml/strings.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -460,6 +460,7 @@
 	&lt;upload&gt;Upload &lt;/upload&gt;
 	&lt;user&gt;User&lt;/user&gt;
 	&lt;UserAdmin&gt;User administrator&lt;/UserAdmin&gt;
+	&lt;userDefined&gt;- User defined -&lt;/userDefined&gt;
 	&lt;Reviewer&gt;Content reviewer&lt;/Reviewer&gt;
 	&lt;userManagement&gt;User management&lt;/userManagement&gt;
 	&lt;userManDes&gt;Add/modify/delete and show users&lt;/userManDes&gt;

Added: trunk/web/geonetwork/loc/es/xml/metadata-show-error.xml
===================================================================
--- trunk/web/geonetwork/loc/es/xml/metadata-show-error.xml	                        (rev 0)
+++ trunk/web/geonetwork/loc/es/xml/metadata-show-error.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -0,0 +1,6 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;strings&gt;
+	&lt;heading&gt;Error accessing the resource&lt;/heading&gt;
+	&lt;message&gt;The resource requested could not be found or accessed. It may have been removed or you may not have the privileges to access it.&lt;/message&gt;
+	&lt;button&gt;Back&lt;/button&gt;
+&lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/es/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/es/xml/strings.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/loc/es/xml/strings.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -487,6 +487,7 @@
 	&lt;upload&gt;ActualizaciÃ³n &lt;/upload&gt;
 	&lt;user&gt;Usuario &lt;/user&gt;
 	&lt;UserAdmin&gt;Usuario administrador&lt;/UserAdmin&gt;
+	&lt;userDefined&gt;- User defined -&lt;/userDefined&gt;
 	&lt;userManagement&gt;Gestionar Usuarios&lt;/userManagement&gt;
 	&lt;userManDes&gt;AÃ±adir/modificar/borrar y mostrar usuarios&lt;/userManDes&gt;
 	&lt;username&gt;Usuario&lt;/username&gt;

Added: trunk/web/geonetwork/loc/fr/xml/metadata-show-error.xml
===================================================================
--- trunk/web/geonetwork/loc/fr/xml/metadata-show-error.xml	                        (rev 0)
+++ trunk/web/geonetwork/loc/fr/xml/metadata-show-error.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -0,0 +1,6 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;strings&gt;
+	&lt;heading&gt;Error accessing the resource&lt;/heading&gt;
+	&lt;message&gt;The resource requested could not be found or accessed. It may have been removed or you may not have the privileges to access it.&lt;/message&gt;
+	&lt;button&gt;Back&lt;/button&gt;
+&lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/fr/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/fr/xml/strings.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/loc/fr/xml/strings.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -493,6 +493,7 @@
 	&lt;upload&gt;DÃ©chargement &lt;/upload&gt;
 	&lt;user&gt;Utilisateur&lt;/user&gt;
 	&lt;UserAdmin&gt;Administrateur d'utilisateur&lt;/UserAdmin&gt;
+	&lt;userDefined&gt;- User defined -&lt;/userDefined&gt;
 	&lt;userManagement&gt;Gestion des utilisateurs&lt;/userManagement&gt;
 	&lt;userManDes&gt;Ajouter/Modifier/Supprimer et visualiser les utilisateurs&lt;/userManDes&gt;
 	&lt;username&gt;Nom d'utilisateur&lt;/username&gt;

Modified: trunk/web/geonetwork/scripts/gn_search.js
===================================================================
--- trunk/web/geonetwork/scripts/gn_search.js	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/scripts/gn_search.js	2008-03-10 14:26:01 UTC (rev 1204)
@@ -44,8 +44,11 @@
 		pars += "&amp;"+im_mm_getURLselectedbbox();
 		pars += fetchParam('relation');
 		pars += "&amp;attrset=geo";
+		if(region!="userdefined")
+		{
 		pars += fetchParam('region');
 	}
+	}
 	pars += fetchParam('sortBy');
 	pars += fetchParam('hitsPerPage');
 	pars += fetchParam('output');
@@ -201,8 +204,11 @@
 		pars += "&amp;attrset=geo";
 		pars += "&amp;"+im_mm_getURLselectedbbox();
 		pars += fetchParam('relation');
+		if(region!="userdefined")
+		{
 		pars += fetchParam('region');
 	}
+	}
 
 	if($('radfrom1').checked)
 	{
@@ -257,10 +263,10 @@
 	setParam('group','');		
 	setParam('category','');		
 	setParam('siteId','');		
-	$('digital') .checked = true;		
+	$('digital') .checked = false;		
 	$('paper')   .checked = false;		
 	$('dynamic') .checked = false;
-	$('download').checked = true;		
+	$('download').checked = false;		
 	setParam('protocol',    '');
 	setParam('template',    'n');
  	setParam('sortBy',      'relevance');
@@ -398,8 +404,9 @@
         
         im_mm_redrawAoI();
         im_mm_zoomToAoI();        
-    }
-    else
+    }  else if (region=="userdefined") {
+		// Do nothing. AoI is set by the user
+    } else 
     {
         getRegion(region);
     }
@@ -463,10 +470,15 @@
 }
 
 function AoIrefresh() {
-  $('region').value="";
+  $('region').value="userdefined";
   $('updateBB').style.visibility="visible";
 }
 
+// Update the dropdown list
+function im_mm_aoiUpdated(bUpdate) {
+	$('region').value="userdefined";
+}
+
 /********************************************************************
 *** DO THE SEARCH!
 ********************************************************************/
@@ -521,10 +533,21 @@
 *  Show metadata content
 *
 ********************************************************************/
+function gn_showSingleMetadataUUID(uuid)
+{
+   var pars = 'uuid=' + uuid + '&amp;currTab=simple';
+   gn_showSingleMet(pars);
+}
+
 function gn_showSingleMetadata(id)
 {
    var pars = 'id=' + id + '&amp;currTab=simple';
+   gn_showSingleMet(pars);  
+}
 
+function gn_showSingleMet(pars)
+{
+
    var myAjax = new Ajax.Request(
         getGNServiceURL('metadata.show.embedded'), 
         {

Modified: trunk/web/geonetwork/xml/schemas/dublin-core/loc/ar/labels.xml
===================================================================
--- trunk/web/geonetwork/xml/schemas/dublin-core/loc/ar/labels.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xml/schemas/dublin-core/loc/ar/labels.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,6 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;labels xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"&gt;
+&lt;labels xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>" xmlns:dct = "<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
 	&lt;!-- ==================================================== --&gt;
 	&lt;element name="simpledc"&gt;
 		&lt;label&gt;Metadata&lt;/label&gt;
@@ -82,4 +82,54 @@
 		&lt;description/&gt;
 	&lt;/element&gt;
 	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:modified"&gt;
+		&lt;label&gt;Date Modified&lt;/label&gt;
+		&lt;description&gt;Data metadata was modified&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:abstract"&gt;
+		&lt;label&gt;Abstract&lt;/label&gt;
+		&lt;description&gt;A summary of the content of the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:spatial"&gt;
+		&lt;label&gt;Spatial&lt;/label&gt;
+		&lt;description&gt;Spatial characteristics of the intellectual content of the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:audience"&gt;
+		&lt;label&gt;Audience&lt;/label&gt;
+		&lt;description&gt;A class of entity for whom the resource is intended or useful.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualMethod"&gt;
+		&lt;label&gt;Accrual Method&lt;/label&gt;
+		&lt;description&gt;The method by which items are added to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualPeriodicity"&gt;
+		&lt;label&gt;Accrual Periodicity&lt;/label&gt;
+		&lt;description&gt;The frequency with which items are added to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualPolicy"&gt;
+		&lt;label&gt;Accrual Policy&lt;/label&gt;
+		&lt;description&gt;The policy governing the addition of items to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:instructionalMethod"&gt;
+		&lt;label&gt;Instructional Method&lt;/label&gt;
+		&lt;description&gt;A process, used to engender knowledge, attitudes and skills, that the resource is designed to support.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:provenance"&gt;
+		&lt;label&gt;Provenance&lt;/label&gt;
+		&lt;description&gt;A statement of any changes in ownership and custody of the resource since its creation that are significant for its authenticity, integrity and interpretation.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:rightsHolder"&gt;
+		&lt;label&gt;Rights Holder&lt;/label&gt;
+		&lt;description&gt;A person or organization owning or managing rights over the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
 &lt;/labels&gt;

Modified: trunk/web/geonetwork/xml/schemas/dublin-core/loc/cn/labels.xml
===================================================================
--- trunk/web/geonetwork/xml/schemas/dublin-core/loc/cn/labels.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xml/schemas/dublin-core/loc/cn/labels.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,6 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;labels xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"&gt;
+&lt;labels xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>" xmlns:dct = "<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
 	&lt;!-- ==================================================== --&gt;
 	&lt;element name="simpledc"&gt;
 		&lt;label&gt;å…ƒæ•°æ?®&lt;/label&gt;
@@ -82,4 +82,54 @@
 		&lt;description/&gt;
 	&lt;/element&gt;
 	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:modified"&gt;
+		&lt;label&gt;Date Modified&lt;/label&gt;
+		&lt;description&gt;Data metadata was modified&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:abstract"&gt;
+		&lt;label&gt;Abstract&lt;/label&gt;
+		&lt;description&gt;A summary of the content of the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:spatial"&gt;
+		&lt;label&gt;Spatial&lt;/label&gt;
+		&lt;description&gt;Spatial characteristics of the intellectual content of the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:audience"&gt;
+		&lt;label&gt;Audience&lt;/label&gt;
+		&lt;description&gt;A class of entity for whom the resource is intended or useful.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualMethod"&gt;
+		&lt;label&gt;Accrual Method&lt;/label&gt;
+		&lt;description&gt;The method by which items are added to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualPeriodicity"&gt;
+		&lt;label&gt;Accrual Periodicity&lt;/label&gt;
+		&lt;description&gt;The frequency with which items are added to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualPolicy"&gt;
+		&lt;label&gt;Accrual Policy&lt;/label&gt;
+		&lt;description&gt;The policy governing the addition of items to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:instructionalMethod"&gt;
+		&lt;label&gt;Instructional Method&lt;/label&gt;
+		&lt;description&gt;A process, used to engender knowledge, attitudes and skills, that the resource is designed to support.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:provenance"&gt;
+		&lt;label&gt;Provenance&lt;/label&gt;
+		&lt;description&gt;A statement of any changes in ownership and custody of the resource since its creation that are significant for its authenticity, integrity and interpretation.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:rightsHolder"&gt;
+		&lt;label&gt;Rights Holder&lt;/label&gt;
+		&lt;description&gt;A person or organization owning or managing rights over the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
 &lt;/labels&gt;

Modified: trunk/web/geonetwork/xml/schemas/dublin-core/loc/es/labels.xml
===================================================================
--- trunk/web/geonetwork/xml/schemas/dublin-core/loc/es/labels.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xml/schemas/dublin-core/loc/es/labels.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,6 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;labels xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"&gt;
+&lt;labels xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>" xmlns:dct = "<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
 	&lt;!-- ==================================================== --&gt;
 	&lt;element name="simpledc"&gt;
 		&lt;label&gt;Metadato&lt;/label&gt;
@@ -82,4 +82,54 @@
 		&lt;description/&gt;
 	&lt;/element&gt;
 	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:modified"&gt;
+		&lt;label&gt;Date Modified&lt;/label&gt;
+		&lt;description&gt;Data metadata was modified&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:abstract"&gt;
+		&lt;label&gt;Abstract&lt;/label&gt;
+		&lt;description&gt;A summary of the content of the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:spatial"&gt;
+		&lt;label&gt;Spatial&lt;/label&gt;
+		&lt;description&gt;Spatial characteristics of the intellectual content of the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:audience"&gt;
+		&lt;label&gt;Audience&lt;/label&gt;
+		&lt;description&gt;A class of entity for whom the resource is intended or useful.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualMethod"&gt;
+		&lt;label&gt;Accrual Method&lt;/label&gt;
+		&lt;description&gt;The method by which items are added to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualPeriodicity"&gt;
+		&lt;label&gt;Accrual Periodicity&lt;/label&gt;
+		&lt;description&gt;The frequency with which items are added to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualPolicy"&gt;
+		&lt;label&gt;Accrual Policy&lt;/label&gt;
+		&lt;description&gt;The policy governing the addition of items to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:instructionalMethod"&gt;
+		&lt;label&gt;Instructional Method&lt;/label&gt;
+		&lt;description&gt;A process, used to engender knowledge, attitudes and skills, that the resource is designed to support.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:provenance"&gt;
+		&lt;label&gt;Provenance&lt;/label&gt;
+		&lt;description&gt;A statement of any changes in ownership and custody of the resource since its creation that are significant for its authenticity, integrity and interpretation.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:rightsHolder"&gt;
+		&lt;label&gt;Rights Holder&lt;/label&gt;
+		&lt;description&gt;A person or organization owning or managing rights over the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
 &lt;/labels&gt;

Modified: trunk/web/geonetwork/xml/schemas/dublin-core/loc/fr/labels.xml
===================================================================
--- trunk/web/geonetwork/xml/schemas/dublin-core/loc/fr/labels.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xml/schemas/dublin-core/loc/fr/labels.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,6 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;labels xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"&gt;
+&lt;labels xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>" xmlns:dct = "<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
 	&lt;!-- ==================================================== --&gt;
 	&lt;element name="simpledc"&gt;
 		&lt;label&gt;MÃ©tadonnÃ©es&lt;/label&gt;
@@ -82,4 +82,54 @@
 		&lt;description/&gt;
 	&lt;/element&gt;
 	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:modified"&gt;
+		&lt;label&gt;Date Modified&lt;/label&gt;
+		&lt;description&gt;Data metadata was modified&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:abstract"&gt;
+		&lt;label&gt;Abstract&lt;/label&gt;
+		&lt;description&gt;A summary of the content of the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:spatial"&gt;
+		&lt;label&gt;Spatial&lt;/label&gt;
+		&lt;description&gt;Spatial characteristics of the intellectual content of the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:audience"&gt;
+		&lt;label&gt;Audience&lt;/label&gt;
+		&lt;description&gt;A class of entity for whom the resource is intended or useful.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualMethod"&gt;
+		&lt;label&gt;Accrual Method&lt;/label&gt;
+		&lt;description&gt;The method by which items are added to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualPeriodicity"&gt;
+		&lt;label&gt;Accrual Periodicity&lt;/label&gt;
+		&lt;description&gt;The frequency with which items are added to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:accrualPolicy"&gt;
+		&lt;label&gt;Accrual Policy&lt;/label&gt;
+		&lt;description&gt;The policy governing the addition of items to a collection.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:instructionalMethod"&gt;
+		&lt;label&gt;Instructional Method&lt;/label&gt;
+		&lt;description&gt;A process, used to engender knowledge, attitudes and skills, that the resource is designed to support.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:provenance"&gt;
+		&lt;label&gt;Provenance&lt;/label&gt;
+		&lt;description&gt;A statement of any changes in ownership and custody of the resource since its creation that are significant for its authenticity, integrity and interpretation.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
+	&lt;element name="dct:rightsHolder"&gt;
+		&lt;label&gt;Rights Holder&lt;/label&gt;
+		&lt;description&gt;A person or organization owning or managing rights over the resource.&lt;/description&gt;
+	&lt;/element&gt;
+	&lt;!-- ==================================================== --&gt;
 &lt;/labels&gt;

Modified: trunk/web/geonetwork/xml/schemas/iso19139/loc/ar/labels.xml
===================================================================
--- trunk/web/geonetwork/xml/schemas/iso19139/loc/ar/labels.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xml/schemas/iso19139/loc/ar/labels.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,10 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;labels xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"&gt;
+&lt;labels xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
+	xmlns:gts="<a href="http://www.isotc211.org/2005/gts" target="_new">http://www.isotc211.org/2005/gts</a>" 
+	xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"
+	xmlns:gml="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>"
+	xmlns:srv="<a href="http://www.isotc211.org/2005/srv" target="_new">http://www.isotc211.org/2005/srv</a>"&gt;
 	&lt;!-- ==================================================== --&gt;
 	&lt;element name="gmd:CI_OnlineResource"&gt;
 		&lt;label&gt;OnLine resource&lt;/label&gt;

Modified: trunk/web/geonetwork/xml/schemas/iso19139/loc/cn/labels.xml
===================================================================
--- trunk/web/geonetwork/xml/schemas/iso19139/loc/cn/labels.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xml/schemas/iso19139/loc/cn/labels.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,10 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;labels xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"&gt;
+&lt;labels xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
+	xmlns:gts="<a href="http://www.isotc211.org/2005/gts" target="_new">http://www.isotc211.org/2005/gts</a>" 
+	xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"
+	xmlns:gml="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>"
+	xmlns:srv="<a href="http://www.isotc211.org/2005/srv" target="_new">http://www.isotc211.org/2005/srv</a>"&gt;
 	&lt;!-- ==================================================== --&gt;
 	&lt;element name="gmd:CI_OnlineResource"&gt;
 		&lt;label&gt;OnLine resource&lt;/label&gt;

Modified: trunk/web/geonetwork/xml/schemas/iso19139/loc/es/labels.xml
===================================================================
--- trunk/web/geonetwork/xml/schemas/iso19139/loc/es/labels.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xml/schemas/iso19139/loc/es/labels.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,10 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;labels xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"&gt;
+&lt;labels xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
+	xmlns:gts="<a href="http://www.isotc211.org/2005/gts" target="_new">http://www.isotc211.org/2005/gts</a>" 
+	xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"
+	xmlns:gml="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>"
+	xmlns:srv="<a href="http://www.isotc211.org/2005/srv" target="_new">http://www.isotc211.org/2005/srv</a>"&gt;
 	&lt;!-- ==================================================== --&gt;
 	&lt;element name="gmd:CI_OnlineResource"&gt;
 		&lt;label&gt;OnLine resource&lt;/label&gt;

Modified: trunk/web/geonetwork/xml/schemas/iso19139/loc/fr/labels.xml
===================================================================
--- trunk/web/geonetwork/xml/schemas/iso19139/loc/fr/labels.xml	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xml/schemas/iso19139/loc/fr/labels.xml	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,10 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
-&lt;labels xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"&gt;
+&lt;labels xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
+	xmlns:gts="<a href="http://www.isotc211.org/2005/gts" target="_new">http://www.isotc211.org/2005/gts</a>" 
+	xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"
+	xmlns:gml="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>"
+	xmlns:srv="<a href="http://www.isotc211.org/2005/srv" target="_new">http://www.isotc211.org/2005/srv</a>"&gt;
 	&lt;!-- ==================================================== --&gt;
 	&lt;element name="gmd:CI_OnlineResource"&gt;
 		&lt;label&gt;AccÃ¨s en ligne&lt;/label&gt;

Added: trunk/web/geonetwork/xsl/error-embedded.xsl
===================================================================
--- trunk/web/geonetwork/xsl/error-embedded.xsl	                        (rev 0)
+++ trunk/web/geonetwork/xsl/error-embedded.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -0,0 +1,11 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"&gt;
+	&lt;xsl:template match="/"&gt;
+		&lt;div id="error"&gt;
+			&lt;h2&gt;&lt;xsl:value-of select="/root/gui/error/heading"/&gt;&lt;/h2&gt;
+			&lt;p id="error"&gt;&lt;xsl:value-of select="/root/gui/error/message"/&gt;&lt;/p&gt;
+			&lt;p id="stacktrace"&gt;&lt;xsl:value-of select="/root/error/class"/&gt; : &lt;xsl:value-of select="/root/error/message"/&gt;&lt;/p&gt;
+			&lt;p&gt;&lt;button class="content" onclick="JavaScript:goBack()"&gt;&lt;xsl:value-of select="/root/gui/strings/backToPreviousPage"/&gt;&lt;/button&gt;&lt;/p&gt;
+		&lt;/div&gt;
+	&lt;/xsl:template&gt;
+&lt;/xsl:stylesheet&gt;

Modified: trunk/web/geonetwork/xsl/error.xsl
===================================================================
--- trunk/web/geonetwork/xsl/error.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/error.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -7,17 +7,12 @@
 	page content
 	--&gt;
 	&lt;xsl:template name="content"&gt;
-		&lt;xsl:call-template name="formLayout"&gt;
-			&lt;xsl:with-param name="title" select="/root/gui/error/heading"/&gt;
-			&lt;xsl:with-param name="content"&gt;
-				&lt;font class="error"&gt;&lt;xsl:value-of select="/root/gui/error/message"/&gt;&lt;/font&gt;
-				&lt;p/&gt;
-				&lt;xsl:value-of select="/root/error/class"/&gt; : &lt;xsl:value-of select="/root/error/message"/&gt;
-			&lt;/xsl:with-param&gt;
-			&lt;xsl:with-param name="buttons"&gt;
-				&lt;button class="content" onclick="JavaScript:goBack()"&gt;&lt;xsl:value-of select="/root/gui/strings/backToPreviousPage"/&gt;&lt;/button&gt;
-			&lt;/xsl:with-param&gt;
-		&lt;/xsl:call-template&gt;
+		&lt;div id="error"&gt;
+			&lt;h2&gt;&lt;xsl:value-of select="/root/gui/error/heading"/&gt;&lt;/h2&gt;
+			&lt;p id="error"&gt;&lt;xsl:value-of select="/root/gui/error/message"/&gt;&lt;/p&gt;
+			&lt;p id="stacktrace"&gt;&lt;xsl:value-of select="/root/error/class"/&gt; : &lt;xsl:value-of select="/root/error/message"/&gt;&lt;/p&gt;
+			&lt;p&gt;&lt;button class="content" onclick="JavaScript:goBack()"&gt;&lt;xsl:value-of select="/root/gui/strings/backToPreviousPage"/&gt;&lt;/button&gt;&lt;/p&gt;
+		&lt;/div&gt;
 	&lt;/xsl:template&gt;
 	
 &lt;/xsl:stylesheet&gt;

Modified: trunk/web/geonetwork/xsl/main-page.xsl
===================================================================
--- trunk/web/geonetwork/xsl/main-page.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/main-page.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -46,6 +46,7 @@
 		&lt;link rel="stylesheet" type="text/css" href="/intermap/intermap-embedded.css?" /&gt;
 		
 		&lt;xsl:variable name="wmc"&gt;&lt;xsl:copy-of select="/root/request/wmc"/&gt;&lt;/xsl:variable&gt;
+		&lt;xsl:variable name="uuid"&gt;&lt;xsl:copy-of select="/root/request/uuid"/&gt;&lt;/xsl:variable&gt;
 		
 		&lt;script type="text/javascript" language="JavaScript1.2"&gt;
 
@@ -57,8 +58,14 @@
 				} else {
 					initSimpleSearch("&lt;xsl:value-of select="$wmc"/&gt;");
 				}
+				&lt;!-- If a UUID is passed, it will be opened within the AJAX page --&gt;
+				var uuid="&lt;xsl:value-of select="$uuid"/&gt;";
+				if (uuid!='') {
+					gn_showSingleMetadataUUID(uuid);
 			}
 			
+			}
+			
 			var getGNServiceURL = function(service)
 			{				
 				return Env.locService+"/"+service;
@@ -527,7 +534,7 @@
 	&lt;xsl:template name="latestUpdates"&gt;
 		&lt;h1 align="left"&gt;
 			&lt;xsl:value-of select="/root/gui/strings/recentAdditions"/&gt; &amp;#160;&amp;#160;&amp;#160; 
-			&lt;a href="{/root/gui/locService}/rss.latest?georss=gml" target="_blank"&gt;
+			&lt;a href="{/root/gui/locService}/rss.latest?georss=simplepoint" target="_blank"&gt;
 				&lt;img style="cursor:hand;cursor:pointer" src="{/root/gui/url}/images/georss.png"
 					alt="GeoRSS-GML" title="{/root/gui/strings/georss}" align="top"/&gt;
 			&lt;/a&gt;
@@ -537,7 +544,7 @@
 				&lt;xsl:apply-templates mode="brief" select="."/&gt;
 			&lt;/xsl:variable&gt;
 			&lt;xsl:variable name="metadata" select="xalan:nodeset($md)/*[1]"/&gt;
-			&lt;div class="arrow" onClick="gn_showSingleMetadata('{geonet:info/id}');" 
+			&lt;div class="arrow" onClick="gn_showSingleMetadataUUID('{geonet:info/uuid}');" 
 				style="cursor:hand;cursor:pointer"&gt;
 				&lt;xsl:value-of select="$metadata/title"/&gt;
 				&lt;br/&gt;

Modified: trunk/web/geonetwork/xsl/metadata-error.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-error.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/metadata-error.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -7,17 +7,16 @@
 	page content
 	--&gt;
 	&lt;xsl:template name="content"&gt;
-		&lt;xsl:call-template name="formLayout"&gt;
-			&lt;xsl:with-param name="title" select="/root/gui/strings/mdUpdateError"/&gt;
-			&lt;xsl:with-param name="content"&gt;
-				&lt;font class="error"&gt;&lt;xsl:value-of select="/root/gui/strings/messageMdUpdateError"/&gt;&lt;/font&gt;
-				&lt;p/&gt;
-				&lt;xsl:value-of select="/root/error/exception/message"/&gt;
-			&lt;/xsl:with-param&gt;
-			&lt;xsl:with-param name="buttons"&gt;
-				&lt;button class="content" onclick="load('{/root/gui/locService}/metadata.edit?id={/root/error/id}')"&gt;&lt;xsl:value-of select="/root/gui/strings/backToEditor"/&gt;&lt;/button&gt;
-			&lt;/xsl:with-param&gt;
-		&lt;/xsl:call-template&gt;
+		&lt;div id="error"&gt;
+			&lt;h2&gt;&lt;xsl:value-of select="/root/gui/strings/mdUpdateError"/&gt;&lt;/h2&gt;
+			&lt;p id="error"&gt;&lt;xsl:value-of select="/root/gui/strings/messageMdUpdateError"/&gt;&lt;/p&gt;
+			&lt;p id="stacktrace"&gt;&lt;xsl:value-of select="/root/error/class"/&gt; : &lt;xsl:value-of select="/root/error/exception/message"/&gt;&lt;/p&gt;
+			&lt;p&gt;
+				&lt;button class="content" onclick="load('{/root/gui/locService}/metadata.edit?id={/root/error/id}')"&gt;
+					&lt;xsl:value-of select="/root/gui/strings/backToEditor"/&gt;
+				&lt;/button&gt;
+			&lt;/p&gt;
+		&lt;/div&gt;
 	&lt;/xsl:template&gt;
 	
 &lt;/xsl:stylesheet&gt;

Modified: trunk/web/geonetwork/xsl/metadata-iso19115.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-iso19115.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/metadata-iso19115.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -983,7 +983,7 @@
 					&lt;xsl:with-param name="schema"  select="$schema"/&gt;
 					&lt;xsl:with-param name="title"  select="/root/gui/strings/viewInGE"/&gt;
 					&lt;xsl:with-param name="text"&gt;
-						&lt;a href="{/root/gui/locService}/google.kml?id={../../../geonet:info/id}&amp;amp;layers={$name}" title="{/root/strings/interactiveMap}"&gt;
+						&lt;a href="{/root/gui/locService}/google.kml?uuid={../../../geonet:info/uuid}&amp;amp;layers={$name}" title="{/root/strings/interactiveMap}"&gt;
 							&lt;xsl:choose&gt;
 								&lt;xsl:when test="string($description)!=''"&gt;
 									&lt;xsl:value-of select="$description"/&gt;
@@ -1739,6 +1739,7 @@
 		&lt;metadata&gt;
 			&lt;xsl:variable name="download_check"&gt;&lt;xsl:text&gt;&amp;amp;fname=&amp;amp;access&lt;/xsl:text&gt;&lt;/xsl:variable&gt;
 			&lt;xsl:variable name="id" select="geonet:info/id"/&gt;
+			&lt;xsl:variable name="uuid" select="geonet:info/uuid"/&gt;
 			
 			&lt;xsl:if test="dataIdInfo/idCitation/resTitle"&gt;
 				&lt;title&gt;&lt;xsl:value-of select="dataIdInfo/idCitation/resTitle"/&gt;&lt;/title&gt;
@@ -1818,7 +1819,7 @@
 					&lt;xsl:element name="link"&gt;
 						&lt;xsl:attribute name="title"&gt;&lt;xsl:value-of select="$desc"/&gt;&lt;/xsl:attribute&gt;
 						&lt;xsl:attribute name="href"&gt;
-							&lt;xsl:value-of select="concat('<a href="http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?id=',$id,'&amp;amp;layers=',$name)"/" target="_new">http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?id=',$id,'&amp;amp;layers=',$name)"/</a>&gt;
+							&lt;xsl:value-of select="concat('<a href="http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?uuid=',$uuid,'&amp;amp;layers=',$name)"/" target="_new">http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?uuid=',$uuid,'&amp;amp;layers=',$name)"/</a>&gt;
 						&lt;/xsl:attribute&gt;
 						&lt;xsl:attribute name="name"&gt;&lt;xsl:value-of select="$name"/&gt;&lt;/xsl:attribute&gt;
 						&lt;xsl:attribute name="type"&gt;application/vnd.google-earth.kml+xml&lt;/xsl:attribute&gt;
@@ -1843,7 +1844,7 @@
 							&lt;xsl:value-of select="concat('javascript:runIM_addService(&amp;#34;',$linkage,'&amp;#34;,&amp;#34;',$name,'&amp;#34;,2);')"/&gt;
 						&lt;/link&gt;
 						&lt;link type="googleearth"&gt;
-							&lt;xsl:value-of select="concat(/root/gui/locService,'/google.kml?id=',$id,'&amp;amp;layers=',$name)"/&gt;
+							&lt;xsl:value-of select="concat(/root/gui/locService,'/google.kml?uuid=',$uuid,'&amp;amp;layers=',$name)"/&gt;
 						&lt;/link&gt;
 					&lt;/xsl:when&gt;
 					&lt;xsl:when test="starts-with(./protocol,'OGC:WMS-') and contains(./protocol,'-get-capabilities') and string($linkage)!=''"&gt;

Modified: trunk/web/geonetwork/xsl/metadata-iso19139.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1622,7 +1622,7 @@
 					&lt;xsl:with-param name="schema"  select="$schema"/&gt;
 					&lt;xsl:with-param name="title"  select="/root/gui/strings/viewInGE"/&gt;
 					&lt;xsl:with-param name="text"&gt;
-						&lt;a href="{/root/gui/locService}/google.kml?id={//geonet:info/id}&amp;amp;layers={$name}" title="{/root/strings/interactiveMap}"&gt;
+						&lt;a href="{/root/gui/locService}/google.kml?uuid={//geonet:info/uuid}&amp;amp;layers={$name}" title="{/root/strings/interactiveMap}"&gt;
 							&lt;xsl:choose&gt;
 								&lt;xsl:when test="string($description)!=''"&gt;
 									&lt;xsl:value-of select="$description"/&gt;
@@ -1937,6 +1937,7 @@
 		&lt;metadata&gt;
 			&lt;xsl:variable name="download_check"&gt;&lt;xsl:text&gt;&amp;amp;fname=&amp;amp;access&lt;/xsl:text&gt;&lt;/xsl:variable&gt;
 			&lt;xsl:variable name="id" select="geonet:info/id"/&gt;
+			&lt;xsl:variable name="uuid" select="geonet:info/uuid"/&gt;
 			&lt;xsl:apply-templates mode="briefster" select="gmd:identificationInfo/gmd:MD_DataIdentification|gmd:identificationInfo/*[@gco:isoType='gmd:MD_DataIdentification']|gmd:identificationInfo/srv:SV_ServiceIdentification"&gt;
 				&lt;xsl:with-param name="id" select="$id"/&gt;
 			&lt;/xsl:apply-templates&gt;
@@ -2005,7 +2006,7 @@
 					&lt;xsl:element name="link"&gt;
 						&lt;xsl:attribute name="title"&gt;&lt;xsl:value-of select="$desc"/&gt;&lt;/xsl:attribute&gt;
 						&lt;xsl:attribute name="href"&gt;
-							&lt;xsl:value-of select="concat('<a href="http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?id=',$id,'&amp;amp;layers=',$name)"/" target="_new">http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?id=',$id,'&amp;amp;layers=',$name)"/</a>&gt;
+							&lt;xsl:value-of select="concat('<a href="http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?uuid=',$uuid,'&amp;amp;layers=',$name)"/" target="_new">http://',/root/gui/env/server/host,':',/root/gui/env/server/port,/root/gui/locService,'/google.kml?uuid=',$uuid,'&amp;amp;layers=',$name)"/</a>&gt;
 						&lt;/xsl:attribute&gt;
 						&lt;xsl:attribute name="name"&gt;&lt;xsl:value-of select="$name"/&gt;&lt;/xsl:attribute&gt;
 						&lt;xsl:attribute name="type"&gt;application/vnd.google-earth.kml+xml&lt;/xsl:attribute&gt;
@@ -2029,7 +2030,7 @@
 							&lt;xsl:value-of select="concat('javascript:runIM_addService(&amp;#34;'  ,  $linkage  ,  '&amp;#34;, &amp;#34;', $name  ,'&amp;#34;, 2)' )"/&gt;
 						&lt;/link&gt;
 						&lt;link type="googleearth"&gt;
-							&lt;xsl:value-of select="concat(/root/gui/locService,'/google.kml?id=',$id,'&amp;amp;layers=',$name)"/&gt;
+							&lt;xsl:value-of select="concat(/root/gui/locService,'/google.kml?uuid=',$uuid,'&amp;amp;layers=',$name)"/&gt;
 						&lt;/link&gt;
 					&lt;/xsl:when&gt;
 					&lt;xsl:when test="starts-with($protocol,'OGC:WMS-') and contains($protocol,'-get-capabilities') and string($linkage)!=''"&gt;

Modified: trunk/web/geonetwork/xsl/metadata-show-embedded.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-show-embedded.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/metadata-show-embedded.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
 	xmlns:geonet="<a href="http://www.fao.org/geonetwork" target="_new">http://www.fao.org/geonetwork</a>" 
+	xmlns:xalan= "<a href="http://xml.apache.org/xalan" target="_new">http://xml.apache.org/xalan</a>"
 	xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>" 
 	xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>" 
 	xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"&gt;
@@ -14,6 +15,7 @@
 	
 	&lt;xsl:variable name="host" select="/root/gui/env/server/host" /&gt;
 	&lt;xsl:variable name="port" select="/root/gui/env/server/port" /&gt;
+	&lt;xsl:variable name="baseURL" select="concat('<a href="http://',$host,':',$port,/root/gui/url" target="_new">http://',$host,':',$port,/root/gui/url</a>)" /&gt;
 	&lt;xsl:variable name="serverUrl" select="concat('<a href="http://',$host,':',$port,/root/gui/locService" target="_new">http://',$host,':',$port,/root/gui/locService</a>)" /&gt;
 	
 	&lt;xsl:template match="/"&gt;
@@ -45,33 +47,18 @@
 					&lt;/td&gt;--&gt;
 					&lt;td class="content" valign="top"&gt;
 						
-						&lt;xsl:variable name="mdURL" select="normalize-space(concat($serverUrl, '/metadata.show?id=', geonet:info/id))"/&gt;
-						&lt;xsl:variable name="mdTitle" select="geonet:info/title" /&gt; &lt;!-- FIXME info is not available by default --&gt;
+						&lt;xsl:variable name="md"&gt;
+							&lt;xsl:apply-templates mode="brief" select="."/&gt;
+						&lt;/xsl:variable&gt;
+						&lt;xsl:variable name="metadata" select="xalan:nodeset($md)/*[1]"/&gt;
+						&lt;xsl:variable name="mdURL" select="normalize-space(concat($baseURL, '?uuid=', geonet:info/uuid))"/&gt;
 						
-						&lt;xsl:if test="not(contains($mdURL,'localhost')) and not(contains($mdURL,'127.0.0.1'))"&gt;
-							&lt;p align="right"&gt;
-								&lt;a href="<a href="http://del.icio.us/post?url={$mdURL}&amp;amp;title={$mdTitle" target="_new">http://del.icio.us/post?url={$mdURL}&amp;amp;title={$mdTitle</a>}"&gt;
-									&lt;img src="{/root/gui/url}/images/delicious.gif" 
-										alt="Bookmark on Delicious" title="Bookmark on Delicious" 
-										style="border: 0px solid;padding:2px;"/&gt;
-								&lt;/a&gt;
-								&lt;a href="<a href="http://digg.com/submit?url={$mdURL}&amp;amp;title={$mdTitle" target="_new">http://digg.com/submit?url={$mdURL}&amp;amp;title={$mdTitle</a>}"&gt;
-									&lt;img src="{/root/gui/url}/images/digg.gif" 
-										alt="Bookmark on Digg" title="Bookmark on Digg" 
-										style="border: 0px solid;padding:2px;"/&gt;
-								&lt;/a&gt;
-								&lt;a href="<a href="http://www.facebook.com/sharer.php?u={$mdURL" target="_new">http://www.facebook.com/sharer.php?u={$mdURL</a>}"&gt;
-									&lt;img src="{/root/gui/url}/images/facebook.gif" 
-										alt="Bookmark on Facebook" title="Bookmark on Facebook" 
-										style="border: 0px solid;padding:2px;"/&gt;
-								&lt;/a&gt;
-								&lt;a href="<a href="http://www.stumbleupon.com/submit?url={$mdURL}&amp;amp;title={$mdTitle" target="_new">http://www.stumbleupon.com/submit?url={$mdURL}&amp;amp;title={$mdTitle</a>}"&gt;
-									&lt;img src="{/root/gui/url}/images/stumbleupon.gif" 
-										alt="Bookmark on StumbleUpon" title="Bookmark on StumbleUpon" 
-										style="border: 0px solid;padding:2px;"/&gt;
-								&lt;/a&gt; 
-							&lt;/p&gt;
-						&lt;/xsl:if&gt;
+						&lt;xsl:call-template name="socialBookmarks"&gt;
+							&lt;xsl:with-param name="baseURL" select="$baseURL" /&gt; &lt;!-- The base URL of the local GeoNetwork site --&gt;
+							&lt;xsl:with-param name="mdURL" select="$mdURL" /&gt; &lt;!-- The URL of the metadata using the UUID --&gt;
+							&lt;xsl:with-param name="title" select="$metadata/title" /&gt;
+							&lt;xsl:with-param name="abstract" select="$metadata/abstract" /&gt;
+						&lt;/xsl:call-template&gt;
 						
 						&lt;table width="100%"&gt;
 						

Modified: trunk/web/geonetwork/xsl/metadata-show.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-show.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/metadata-show.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -1,6 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
 	xmlns:geonet="<a href="http://www.fao.org/geonetwork" target="_new">http://www.fao.org/geonetwork</a>" 
+	xmlns:xalan= "<a href="http://xml.apache.org/xalan" target="_new">http://xml.apache.org/xalan</a>"
 	xmlns:dc = "<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>" 
 	xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>" 
 	xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"&gt;
@@ -14,6 +15,7 @@
 	
 	&lt;xsl:variable name="host" select="/root/gui/env/server/host" /&gt;
 	&lt;xsl:variable name="port" select="/root/gui/env/server/port" /&gt;
+	&lt;xsl:variable name="baseURL" select="concat('<a href="http://',$host,':',$port,/root/gui/url" target="_new">http://',$host,':',$port,/root/gui/url</a>)" /&gt;
 	&lt;xsl:variable name="serverUrl" select="concat('<a href="http://',$host,':',$port,/root/gui/locService" target="_new">http://',$host,':',$port,/root/gui/locService</a>)" /&gt;
 	
 	&lt;!--
@@ -58,34 +60,20 @@
 						&lt;/xsl:call-template&gt;
 					&lt;/td&gt;
 					&lt;td class="content" valign="top"&gt;
-						&lt;xsl:variable name="mdURL" select="normalize-space(concat($serverUrl, '/metadata.show?id=', geonet:info/id))"/&gt;
-						&lt;xsl:variable name="mdTitle" select="geonet:info/title" /&gt; &lt;!-- FIXME info is not available by default --&gt;
 						
-						&lt;xsl:if test="not(contains($mdURL,'localhost')) and not(contains($mdURL,'127.0.0.1'))"&gt;
-							&lt;p align="right"&gt;
-								&lt;a href="<a href="http://del.icio.us/post?url={$mdURL}&amp;amp;title={$mdTitle" target="_new">http://del.icio.us/post?url={$mdURL}&amp;amp;title={$mdTitle</a>}"&gt;
-									&lt;img src="{/root/gui/url}/images/delicious.gif" 
-										alt="Bookmark on Delicious" title="Bookmark on Delicious" 
-										style="border: 0px solid;padding:2px;"/&gt;
-								&lt;/a&gt;
-								&lt;a href="<a href="http://digg.com/submit?url={$mdURL}&amp;amp;title={$mdTitle" target="_new">http://digg.com/submit?url={$mdURL}&amp;amp;title={$mdTitle</a>}"&gt;
-									&lt;img src="{/root/gui/url}/images/digg.gif" 
-										alt="Bookmark on Digg" title="Bookmark on Digg" 
-										style="border: 0px solid;padding:2px;"/&gt;
-								&lt;/a&gt;
-								&lt;a href="<a href="http://www.facebook.com/sharer.php?u={$mdURL" target="_new">http://www.facebook.com/sharer.php?u={$mdURL</a>}"&gt;
-									&lt;img src="{/root/gui/url}/images/facebook.gif" 
-										alt="Bookmark on Facebook" title="Bookmark on Facebook" 
-										style="border: 0px solid;padding:2px;"/&gt;
-								&lt;/a&gt;
-								&lt;a href="<a href="http://www.stumbleupon.com/submit?url={$mdURL}&amp;amp;title={$mdTitle" target="_new">http://www.stumbleupon.com/submit?url={$mdURL}&amp;amp;title={$mdTitle</a>}"&gt;
-									&lt;img src="{/root/gui/url}/images/stumbleupon.gif" 
-										alt="Bookmark on StumbleUpon" title="Bookmark on StumbleUpon" 
-										style="border: 0px solid;padding:2px;"/&gt;
-								&lt;/a&gt; 
-							&lt;/p&gt;
-						&lt;/xsl:if&gt;
+						&lt;xsl:variable name="md"&gt;
+							&lt;xsl:apply-templates mode="brief" select="."/&gt;
+						&lt;/xsl:variable&gt;
+						&lt;xsl:variable name="metadata" select="xalan:nodeset($md)/*[1]"/&gt;
+						&lt;xsl:variable name="mdURL" select="normalize-space(concat($baseURL, '?uuid=', geonet:info/uuid))"/&gt;
 						
+						&lt;xsl:call-template name="socialBookmarks"&gt;
+							&lt;xsl:with-param name="baseURL" select="$baseURL" /&gt; &lt;!-- The base URL of the local GeoNetwork site --&gt;
+							&lt;xsl:with-param name="mdURL" select="$mdURL" /&gt; &lt;!-- The URL of the metadata using the UUID --&gt;
+							&lt;xsl:with-param name="title" select="$metadata/title" /&gt;
+							&lt;xsl:with-param name="abstract" select="$metadata/abstract" /&gt;
+						&lt;/xsl:call-template&gt;
+						
 						&lt;table width="100%"&gt;
 						
 							&lt;xsl:variable name="buttons"&gt;

Modified: trunk/web/geonetwork/xsl/rss-latest.xsl
===================================================================
--- trunk/web/geonetwork/xsl/rss-latest.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/rss-latest.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -14,6 +14,7 @@
 	&lt;xsl:include href="rss-utils.xsl"/&gt;
 	
 	&lt;xsl:variable name="siteURL" select="/root/gui/siteURL"/&gt;
+	&lt;xsl:variable name="baseURL" select="substring-before($siteURL,'/srv/')" /&gt;
 	
 	&lt;xsl:template match="/root"&gt;
 		
@@ -21,7 +22,7 @@
 			&lt;channel&gt;
 			
 				&lt;title&gt;&lt;xsl:value-of select="gui/strings/header_meta/meta[@name='DC.title']/@content"/&gt;&lt;/title&gt;
-				&lt;link&gt;&lt;xsl:value-of select="$siteURL"/&gt;/main.home&lt;/link&gt;
+				&lt;link&gt;&lt;xsl:value-of select="$baseURL"/&gt;&lt;/link&gt;
 				&lt;description&gt;&lt;xsl:value-of select="gui/strings/header_meta/meta[@name='DC.description']/@content"/&gt;&lt;/description&gt;
 				&lt;language&gt;&lt;xsl:value-of select="gui/language"/&gt;&lt;/language&gt;
 				&lt;copyright&gt;&lt;xsl:value-of select="gui/strings/copyright2"/&gt;&lt;/copyright&gt;

Modified: trunk/web/geonetwork/xsl/rss-search.xsl
===================================================================
--- trunk/web/geonetwork/xsl/rss-search.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/rss-search.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -14,6 +14,7 @@
 	&lt;xsl:include href="rss-utils.xsl"/&gt;
 
 	&lt;xsl:variable name="siteURL" select="/root/gui/siteURL"/&gt;
+	&lt;xsl:variable name="baseURL" select="substring-before($siteURL,'/srv/')" /&gt;
 	
 	&lt;xsl:template match="/root"&gt;
 		
@@ -21,7 +22,7 @@
 			&lt;channel&gt;
 			
 				&lt;title&gt;&lt;xsl:value-of select="gui/strings/header_meta/meta[@name='DC.title']/@content"/&gt;&lt;/title&gt;
-				&lt;link&gt;&lt;xsl:value-of select="$siteURL"/&gt;/main.home&lt;/link&gt;
+				&lt;link&gt;&lt;xsl:value-of select="$baseURL"/&gt;&lt;/link&gt;
 				&lt;description&gt;&lt;xsl:value-of select="gui/strings/header_meta/meta[@name='DC.description']/@content"/&gt;&lt;/description&gt;
 				&lt;language&gt;&lt;xsl:value-of select="gui/language"/&gt;&lt;/language&gt;
 				&lt;copyright&gt;&lt;xsl:value-of select="gui/strings/copyright2"/&gt;&lt;/copyright&gt;

Modified: trunk/web/geonetwork/xsl/rss-utils.xsl
===================================================================
--- trunk/web/geonetwork/xsl/rss-utils.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/rss-utils.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -13,12 +13,13 @@
 	&lt;!-- Template that generates an item for every metadata record --&gt;
 	&lt;xsl:template match="*" mode="item"&gt;
 		&lt;xsl:param name="siteURL" /&gt;
+		&lt;xsl:variable name="baseURL" select="substring-before($siteURL,'/srv/')" /&gt;
 		&lt;item&gt;
 			&lt;xsl:variable name="md"&gt;
 				&lt;xsl:apply-templates mode="brief" select="."/&gt;
 			&lt;/xsl:variable&gt;
 			&lt;xsl:variable name="metadata" select="xalan:nodeset($md)/*[1]"/&gt;
-			&lt;xsl:variable name="mdURL" select="normalize-space(concat($siteURL, '/metadata.show?id=', geonet:info/id))"/&gt;
+			&lt;xsl:variable name="mdURL" select="normalize-space(concat($baseURL, '?uuid=', geonet:info/uuid))"/&gt;
 			&lt;xsl:variable name="thumbnailLink" select="normalize-space($metadata/image[@type='thumbnail'])"/&gt;
 			&lt;xsl:variable name="bDynamic" select="geonet:info/dynamic" /&gt;
 			&lt;xsl:variable name="bDownload" select="geonet:info/download" /&gt;
@@ -40,39 +41,23 @@
 			
 			&lt;description&gt;
 				&lt;xsl:text disable-output-escaping="yes"&gt;&amp;lt;![CDATA[&lt;/xsl:text&gt;
+				
+				&lt;p&gt;
 				&lt;xsl:if test="string($thumbnailLink)!=''"&gt;
-					&lt;p&gt;
-						&lt;a href="{$mdURL}"&gt;&lt;img src="{$thumbnailLink}" align="left" alt="" border="0" width="100"/&gt;&lt;/a&gt;
-					&lt;/p&gt;
+						&lt;a href="{$mdURL}"&gt;&lt;img src="{$thumbnailLink}" align="left" alt="" border="0" width="100" style="padding:15px;"/&gt;&lt;/a&gt;
 				&lt;/xsl:if&gt;
-				&lt;p&gt;
 					&lt;xsl:value-of select="$metadata/abstract"/&gt;
 					&lt;br /&gt;
-					&lt;xsl:if test="not(contains($mdURL,'localhost')) and not(contains($mdURL,'127.0.0.1'))"&gt;
-						&lt;a href="<a href="http://del.icio.us/post?url={$mdURL}&amp;amp;title={$metadata/title" target="_new">http://del.icio.us/post?url={$mdURL}&amp;amp;title={$metadata/title</a>}"&gt;
-							&lt;img src="{/root/gui/url}/images/delicious.gif" 
-								alt="Bookmark on Delicious" title="Bookmark on Delicious" 
-								style="border: 0px solid;padding:2px;"/&gt;
-						&lt;/a&gt; 
-						&lt;a href="<a href="http://digg.com/submit?url={$mdURL}&amp;amp;title={$metadata/title" target="_new">http://digg.com/submit?url={$mdURL}&amp;amp;title={$metadata/title</a>}"&gt;
-							&lt;img src="{/root/gui/url}/images/digg.gif" 
-								alt="Bookmark on Digg" title="Bookmark on Digg" 
-								style="border: 0px solid;padding:2px;"/&gt;
-						&lt;/a&gt; 
-						&lt;a href="<a href="http://www.facebook.com/sharer.php?u={$mdURL" target="_new">http://www.facebook.com/sharer.php?u={$mdURL</a>}"&gt;
-							&lt;img src="{/root/gui/url}/images/facebook.gif" 
-								alt="Bookmark on Facebook" title="Bookmark on Facebook" 
-								style="border: 0px solid;padding:2px;"/&gt;
-						&lt;/a&gt; 
-						&lt;a href="<a href="http://www.stumbleupon.com/submit?url={$mdURL}&amp;amp;title={$metadata/title" target="_new">http://www.stumbleupon.com/submit?url={$mdURL}&amp;amp;title={$metadata/title</a>}"&gt;
-							&lt;img src="{/root/gui/url}/images/stumbleupon.gif" 
-								alt="Bookmark on StumbleUpon" title="Bookmark on StumbleUpon" 
-								style="border: 0px solid;padding:2px;"/&gt;
-						&lt;/a&gt; 
-					&lt;/xsl:if&gt;
+					&lt;xsl:call-template name="socialBookmarks"&gt;
+						&lt;xsl:with-param name="baseURL" select="$baseURL" /&gt; &lt;!-- The base URL of the local GeoNetwork site --&gt;
+						&lt;xsl:with-param name="mdURL" select="$mdURL" /&gt; &lt;!-- The URL of the metadata using the UUID --&gt;
+						&lt;xsl:with-param name="title" select="$metadata/title" /&gt;
+						&lt;xsl:with-param name="abstract" select="$metadata/abstract" /&gt;
+					&lt;/xsl:call-template&gt;
+
 					&lt;xsl:if test="$bDynamic"&gt;
 						&lt;xsl:apply-templates select="$metadata/link[contains(@type,'vnd.google-earth.km')][1]" mode="GoogleEarthWMS" &gt;
-							&lt;xsl:with-param name="url" select="/root/gui/url" /&gt;
+							&lt;xsl:with-param name="url" select="$baseURL" /&gt;
 							&lt;xsl:with-param name="viewInGE" select="/root/gui/strings/viewInGE" /&gt;
 						&lt;/xsl:apply-templates&gt;
 					&lt;/xsl:if&gt;
@@ -81,6 +66,8 @@
 				&lt;br clear="all"/&gt;
 				&lt;xsl:text disable-output-escaping="yes"&gt;]]&amp;gt;&lt;/xsl:text&gt;
 			&lt;/description&gt;
+			&lt;pubDate&gt;&lt;xsl:value-of select="geonet:info/changeDate"/&gt;&lt;/pubDate&gt;
+			&lt;guid&gt;&lt;xsl:value-of select="$mdURL"/&gt;&lt;/guid&gt;
 			&lt;xsl:if test="string($thumbnailLink)!=''"&gt;
 				&lt;media:content url="{$thumbnailLink}" type="image/gif" width="100"/&gt;
 			&lt;/xsl:if&gt;
@@ -110,7 +97,7 @@
 					&lt;/georss:box&gt;
 				&lt;/xsl:when&gt;
 				&lt;xsl:when test="string($rssFormat)='simplepoint'"&gt;
-					&lt;xsl:comment&gt;Bounding box in georss simplepoint format (<a href="http://georss.org)&lt;/xsl:comment" target="_new">http://georss.org)&lt;/xsl:comment</a>&gt;
+					&lt;xsl:comment&gt;Bounding box in georss simplepoint format (default) (<a href="http://georss.org)&lt;/xsl:comment" target="_new">http://georss.org)&lt;/xsl:comment</a>&gt;
 					&lt;georss:point&gt;
 						&lt;xsl:value-of select="((northBL)+(southBL))*.5"/&gt;
 						&lt;xsl:text&gt; &lt;/xsl:text&gt;
@@ -147,28 +134,30 @@
 		&lt;xsl:param name="bDynamic" /&gt;
 		&lt;xsl:param name="bDownload" /&gt;
 		
-		&lt;xsl:variable name="nameL" select="@name" /&gt;
+		&lt;xsl:variable name="nameL" select="normalize-space(@name)" /&gt;
 		
 		&lt;xsl:if test="string(@href)!=''"&gt;
 			&lt;xsl:choose&gt;
 				&lt;xsl:when test="@type='application/vnd.ogc.wms_xml' and $bDynamic"&gt;
 					&lt;xsl:choose&gt;
 						&lt;xsl:when test="number($west) and number($south) and number($east) 
-							and number($north) and string(normalize-space($nameL))!='' and not(contains(@href,'?'))"&gt;
-							&lt;!-- The following link is a web map service with variable parameters encoded following 
-								so-called URI Templates (<a href="http://bitworking.org/projects/URI-Templates/" target="_new">http://bitworking.org/projects/URI-Templates/</a>) 
-								also used in OpenSearch --&gt;
+							and number($north) and string($nameL)!='' and not(contains(@href,'?'))"&gt;
+							&lt;!-- The following link is a web map service. 
+								There's a hint providing the possible layers available in the service --&gt;
 							&lt;xsl:variable name="xyRatio" select="string(number($north - $south) div number($east - $west))" /&gt;
-							&lt;link href="{concat(@href,'?SERVICE=wms$amp;VERSION=1.1.1&amp;amp;REQUEST=GetMap&amp;amp;BBOX={geo:box='
-								,$west,',',$south,',',$east,',',$north
-								,'}&amp;amp;LAYERS={ogc:layer=',$nameL
-								,'}&amp;amp;SRS=EPSG:4326&amp;amp;WIDTH=200&amp;amp;HEIGHT='
+							&lt;!-- This is a full GetMap request resulting in a PNG image of 200px wide--&gt;
+							&lt;link href="{@href}" type="{@type}" rel="alternate" title="{@title}" geonet:layers="{$nameL}" /&gt;
+							&lt;link href="{concat(@href,'?SERVICE=wms$amp;VERSION=1.1.1&amp;amp;REQUEST=GetMap&amp;amp;BBOX=',
+								concat($west,',',$south,',',$east,',',$north),
+								'&amp;amp;LAYERS=',$nameL,
+								'&amp;amp;SRS=EPSG:4326&amp;amp;WIDTH=200&amp;amp;HEIGHT='
 								,string(round(200 * number($xyRatio)))
 								,'&amp;amp;FORMAT=image/png'
 								,'&amp;amp;TRANSPARENT=TRUE&amp;amp;STYLES=default')}"
-								type="{@type}" rel="alternate" title="{@title}"/&gt;
+								type="image/png" rel="alternate" title="{@title}"
+							/&gt;
 						&lt;/xsl:when&gt;
-						&lt;xsl:when test="string(normalize-space($nameL))!='' and not(contains(@href,'?'))"&gt;
+						&lt;xsl:when test="string($nameL)!='' and not(contains(@href,'?'))"&gt;
 							&lt;!-- The following link is a GetCapabilities request to an OGC Web Map Server 
 								(<a href="http://opengeospatial.org" target="_new">http://opengeospatial.org</a>) --&gt;
 							&lt;link href="{concat(@href,'?SERVICE=wms&amp;amp;VERSION=1.1.1&amp;amp;REQUEST=GetCapabilities')}"
@@ -195,10 +184,9 @@
 	&lt;xsl:template match="*" mode="GoogleEarthWMS"&gt;
 		&lt;xsl:param name="url" /&gt;
 		&lt;xsl:param name="viewInGE" /&gt;
-			Open with: 
 			&lt;a href="{@href}" title="{@title}"&gt;
 				&lt;img src="{$url}/images/google_earth_link_s.png" alt="{$viewInGE}" title="{$viewInGE}" 
-				style="border: 0px solid;"/&gt;
+					style="border: 0px solid;padding:2px;"/&gt;
 			&lt;/a&gt;
 	&lt;/xsl:template&gt;
 	

Modified: trunk/web/geonetwork/xsl/searchform_advanced.xsl
===================================================================
--- trunk/web/geonetwork/xsl/searchform_advanced.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/searchform_advanced.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -301,7 +301,6 @@
 								&lt;div id="im_mm_aoibox_e" style="left:0px;top:0px;width:0px;height:0px;position:absolute;border-right: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
 								&lt;div id="im_mm_aoibox_s" style="left:0px;top:0px;width:0px;height:0px;position:absolute;border-bottom: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
 								&lt;div id="im_mm_aoibox_w" style="left:0px;top:0px;width: 0px;height:0px;position:absolute;border-left: 1px dashed #f00;visibility: visible;overflow: hidden;z-index: 3000"&gt;.&lt;/div&gt;
-								&lt;!--&lt;div id="im_mm_aoibox" style="left:0px;top:0px;width:200px;height:100px;position:absolute;border: 1px dashed #f00;visibility: visible;overflow: hidden;"/&gt;--&gt;
 							&lt;/div&gt;
 							&lt;div id="im_mm_image_waitdiv" style="position: relative; z-index:999; left:59px; top:45px;"&gt;
 								&lt;img id="im_mm_waitimage" style="position: absolute; z-index:1000;" src="/intermap/images/waiting.gif" /&gt;
@@ -358,6 +357,12 @@
 						&lt;/xsl:if&gt;
 						&lt;xsl:value-of select="/root/gui/strings/any"/&gt;
 					&lt;/option&gt;
+					&lt;option value="userdefined"&gt;
+						&lt;xsl:if test="/root/gui/searchDefaults/theme='_userdefined_'"&gt;
+							&lt;xsl:attribute name="selected"/&gt;
+						&lt;/xsl:if&gt;
+						&lt;xsl:value-of select="/root/gui/strings/userDefined"/&gt;
+					&lt;/option&gt;
 					
 					&lt;xsl:for-each select="/root/gui/regions/record"&gt;
 						&lt;xsl:sort select="label/child::*[name() = $lang]" order="ascending"/&gt;

Modified: trunk/web/geonetwork/xsl/searchform_simple_template.xsl
===================================================================
--- trunk/web/geonetwork/xsl/searchform_simple_template.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/searchform_simple_template.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -104,6 +104,12 @@
 							&lt;/xsl:if&gt;
 							&lt;xsl:value-of select="/root/gui/strings/any"/&gt;
 						&lt;/option&gt;
+						&lt;option value="userdefined"&gt;
+							&lt;xsl:if test="/root/gui/searchDefaults/theme='_userdefined_'"&gt;
+								&lt;xsl:attribute name="selected"/&gt;
+							&lt;/xsl:if&gt;
+							&lt;xsl:value-of select="/root/gui/strings/userDefined"/&gt;
+						&lt;/option&gt;
 
 						&lt;xsl:for-each select="/root/gui/regions/record"&gt;
 							&lt;xsl:sort select="label/child::*[name() = $lang]" order="ascending"/&gt;

Modified: trunk/web/geonetwork/xsl/utils.xsl
===================================================================
--- trunk/web/geonetwork/xsl/utils.xsl	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/geonetwork/xsl/utils.xsl	2008-03-10 14:26:01 UTC (rev 1204)
@@ -73,4 +73,51 @@
 		&lt;/xsl:choose&gt;
 	&lt;/xsl:template&gt;
 
+	&lt;xsl:template name="socialBookmarks"&gt;
+		&lt;xsl:param name="baseURL" /&gt;
+		&lt;xsl:param name="mdURL" /&gt;
+		&lt;xsl:param name="title" /&gt;
+		&lt;xsl:param name="abstract" /&gt;
+		&lt;xsl:variable name="t" select="normalize-space($title)" /&gt;
+		&lt;xsl:variable name="a" select="normalize-space($abstract)" /&gt;
+		
+		&lt;xsl:if test="not(contains($mdURL,'localhost')) and not(contains($mdURL,'127.0.0.1'))"&gt;
+			&lt;a href="mailto:?subject={$t}&amp;amp;body=%0ALink:%0A{$mdURL}%0A%0AAbstract:%0A{$a}"&gt;
+				&lt;img src="{$baseURL}/images/mail.png" 
+					alt="Send to a friend" title="Send to a friend" 
+					style="border: 0px solid;padding:2px;padding-right:10px;"/&gt;
+			&lt;/a&gt;
+				
+				&lt;!-- Not browser independent, thus commented out --&gt;
+&lt;!--			&lt;a href="javascript:window.external.AddFavorite('{$mdURL}', '{$t}');"&gt;
+				&lt;img src="{$baseURL}/images/bookmark.png" 
+					alt="Bookmark" title="Bookmark" 
+					style="border: 0px solid;padding:2px;"/&gt;
+			&lt;/a&gt; --&gt;
+			
+			&lt;!-- add first sentence of abstract to the delicious notes --&gt;
+			&lt;a href="<a href="http://del.icio.us/post?url={$mdURL}&amp;amp;title={$t}&amp;amp;notes={substring-before($a" target="_new">http://del.icio.us/post?url={$mdURL}&amp;amp;title={$t}&amp;amp;notes={substring-before($a</a>,'. ')}. "&gt;
+				&lt;img src="{$baseURL}/images/delicious.gif" 
+					alt="Bookmark on Delicious" title="Bookmark on Delicious" 
+					style="border: 0px solid;padding:2px;"/&gt;
+			&lt;/a&gt; 
+			&lt;a href="<a href="http://digg.com/submit?url={$mdURL}&amp;amp;title={substring($t,0,75)}&amp;amp;bodytext={substring(substring-before($a" target="_new">http://digg.com/submit?url={$mdURL}&amp;amp;title={substring($t,0,75)}&amp;amp;bodytext={substring(substring-before($a</a>,'. '),0,350)}.&amp;amp;topic=environment"&gt;
+				&lt;img src="{$baseURL}/images/digg.gif" 
+					alt="Bookmark on Digg" title="Bookmark on Digg" 
+					style="border: 0px solid;padding:2px;"/&gt;
+			&lt;/a&gt; 
+			&lt;a href="<a href="http://www.facebook.com/sharer.php?u={$mdURL" target="_new">http://www.facebook.com/sharer.php?u={$mdURL</a>}"&gt;
+				&lt;img src="{$baseURL}/images/facebook.gif" 
+					alt="Bookmark on Facebook" title="Bookmark on Facebook" 
+					style="border: 0px solid;padding:2px;"/&gt;
+			&lt;/a&gt; 
+			&lt;a href="<a href="http://www.stumbleupon.com/submit?url={$mdURL}&amp;amp;title={$t" target="_new">http://www.stumbleupon.com/submit?url={$mdURL}&amp;amp;title={$t</a>}"&gt;
+				&lt;img src="{$baseURL}/images/stumbleupon.gif" 
+					alt="Bookmark on StumbleUpon" title="Bookmark on StumbleUpon" 
+					style="border: 0px solid;padding:2px;"/&gt;
+			&lt;/a&gt; 
+		&lt;/xsl:if&gt;
+		
+	&lt;/xsl:template&gt;
+
 &lt;/xsl:stylesheet&gt;

Modified: trunk/web/intermap/scripts/im_minimap.js
===================================================================
--- trunk/web/intermap/scripts/im_minimap.js	2008-03-10 14:18:58 UTC (rev 1203)
+++ trunk/web/intermap/scripts/im_minimap.js	2008-03-10 14:26:01 UTC (rev 1204)
@@ -153,15 +153,6 @@
 	pX = Math.min(pX, im_mm.width - 1);
 	pY = Math.min(pY, im_mm.height - 1);
 
-	// Setting this text here will slow down the system terribly.
-	// We don't want this to execute unless the bbox coords are displayed on screen
-//	im_mm_setTextLenght(
-//		Math.min(pY, im_mm_startY),  // top
-//		Math.max(pX, im_mm_startX),  // right
-//		Math.max(pY, im_mm_startY),  // bottom
-//		Math.min(pX, im_mm_startX) // left
-//	);
-            
 	// set the zoom box position and size
 	im_aoi.draw(Math.min(pX, im_mm_startX),  // left
 				Math.min(pY, im_mm_startY),  // top
@@ -199,6 +190,11 @@
 		Math.min(pX, im_mm_startX) // left
 	);
             	
+	var func = im_mm_aoiUpdated;
+	if(typeof func == 'function')
+	{
+		func();
+	}
 	// AoI has not an area (see drawFakeBox), so no need to redefine observers.	
 }
 


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18950415">[GeoNetwork-commit] SF.net SVN: geonetwork: [1222] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;bluenetdevteam@us...&gt; -	2008-03-27 14:56</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1222
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1222&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1222&amp;view=rev</a>
Author:   bluenetdevteam
Date:     2008-03-27 07:56:13 -0700 (Thu, 27 Mar 2008)

Log Message:
-----------
Bug fixes:

1. Advanced Search - restricted to Group - now works
2. Import from directory/Insert metadata with category now writes category to
   db before indexing in Lucene
3. Avoid writing nulls to database columns - causes ORACLE and Postgresql errors
   Note: Jeeves needs to be fixed to supply database column type so 
	 that nulls can be written. You'll need to rebuild your 2.2 database
	 because table columns that may have nulls need to be built with default null
4. Gast migration of 2.0.3 sites avoids constraint violations when using 
   ORACLE and probably others
5. In Jeeves: ORACLE uses isolation level READ_COMMITTED in place of 
   SERIALIZABLE to avoid ORA-xxxxx unable to serialize transaction 
	 READ_COMMITTED ensures that reads only ever get committed data and is good 
	 enough - SERIALIZABLE appears to be overkill for ORACLE.
6. Up maximum JRE version to 1.5.0_15 for Windowz .exe installer

These changes should be given more testing (especially 3-4 on postgresql) 
before final 2.2.0 release!

Oracle tested on 10g with latest ojdbc14.jar from Oracle Technology Network 
site.

Modified Paths:
--------------
    trunk/gast/setup/sql/create-db-mckoi.sql
    trunk/gast/setup/sql/create-db-mysql.sql
    trunk/gast/setup/sql/create-db-oracle.sql
    trunk/gast/setup/sql/create-db-postgres.sql
    trunk/installer/launch4j/launch4jConfig.xml
    trunk/src/org/fao/gast/gui/panels/migration/oldinst/Worker.java
    trunk/src/org/fao/gast/lib/DatabaseLib.java
    trunk/src/org/fao/geonet/kernel/DataManager.java
    trunk/src/org/fao/geonet/kernel/XmlSerializer.java
    trunk/src/org/fao/geonet/kernel/harvest/harvester/oaipmh/Harvester.java
    trunk/src/org/fao/geonet/kernel/search/LuceneSearcher.java
    trunk/src/org/fao/geonet/services/metadata/ImportFromDir.java
    trunk/src/org/fao/geonet/services/metadata/Insert.java

Modified: trunk/gast/setup/sql/create-db-mckoi.sql
===================================================================
--- trunk/gast/setup/sql/create-db-mckoi.sql	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/gast/setup/sql/create-db-mckoi.sql	2008-03-27 14:56:13 UTC (rev 1222)
@@ -229,10 +229,10 @@
     source       varchar(250)   not null,
     title        varchar(255),
     root         varchar(255),
-    harvestUuid  varchar(250),
+    harvestUuid  varchar(250)   default null,
     owner        int            not null,
-    groupOwner   int,
-    harvestUri   varchar(255),
+    groupOwner   int            default null,
+    harvestUri   varchar(255)   default null,
     rating       int            default 0 not null,
     popularity   int            default 0 not null,
 

Modified: trunk/gast/setup/sql/create-db-mysql.sql
===================================================================
--- trunk/gast/setup/sql/create-db-mysql.sql	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/gast/setup/sql/create-db-mysql.sql	2008-03-27 14:56:13 UTC (rev 1222)
@@ -229,10 +229,10 @@
     source       varchar(250)   not null,
     title        varchar(255),
     root         varchar(255),
-    harvestUuid  varchar(250),
+    harvestUuid  varchar(250)   default null,
     owner        int            not null,
-    groupOwner   int,
-    harvestUri   varchar(255),
+    groupOwner   int            default null,
+    harvestUri   varchar(255)   default null,
     rating       int            default 0 not null,
     popularity   int            default 0 not null,
 

Modified: trunk/gast/setup/sql/create-db-oracle.sql
===================================================================
--- trunk/gast/setup/sql/create-db-oracle.sql	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/gast/setup/sql/create-db-oracle.sql	2008-03-27 14:56:13 UTC (rev 1222)
@@ -205,10 +205,10 @@
     source       varchar(250)   not null,
     title        varchar(255),
     root         varchar(255),
-    harvestUuid  varchar(250),
+    harvestUuid  varchar(250)		default null,
     owner        int            not null,
-    groupOwner   int,
-    harvestUri   varchar(255),
+    groupOwner   int						default null,
+    harvestUri   varchar(255)		default null,
     rating       int            default 0 not null,
     popularity   int            default 0 not null,
     primary key(id),

Modified: trunk/gast/setup/sql/create-db-postgres.sql
===================================================================
--- trunk/gast/setup/sql/create-db-postgres.sql	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/gast/setup/sql/create-db-postgres.sql	2008-03-27 14:56:13 UTC (rev 1222)
@@ -229,10 +229,10 @@
     source       varchar(250)   not null,
     title        varchar(255),
     root         varchar(255),
-    harvestUuid  varchar(250),
+    harvestUuid  varchar(250)   default null,
     owner        int            not null,
-    groupOwner   int,
-    harvestUri   varchar(255),
+    groupOwner   int            default null,
+    harvestUri   varchar(255)   default null,
     rating       int            default 0 not null,
     popularity   int            default 0 not null,
 

Modified: trunk/installer/launch4j/launch4jConfig.xml
===================================================================
--- trunk/installer/launch4j/launch4jConfig.xml	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/installer/launch4j/launch4jConfig.xml	2008-03-27 14:56:13 UTC (rev 1222)
@@ -16,7 +16,7 @@
   &lt;jre&gt;
 &lt;!--    &lt;path&gt;jre1.5.0_12&lt;/path&gt; --&gt;
     &lt;minVersion&gt;1.5.0&lt;/minVersion&gt;
-    &lt;maxVersion&gt;1.5.0_12&lt;/maxVersion&gt;
+    &lt;maxVersion&gt;1.5.0_15&lt;/maxVersion&gt;
     &lt;initialHeapSize&gt;256&lt;/initialHeapSize&gt;
     &lt;maxHeapSize&gt;512&lt;/maxHeapSize&gt;
     &lt;args&gt;&lt;/args&gt;
@@ -39,4 +39,4 @@
     &lt;internalName&gt;geonetwork-install.jar&lt;/internalName&gt;
     &lt;originalFilename&gt;geonetwork-install.exe&lt;/originalFilename&gt;
   &lt;/versionInfo&gt;
-&lt;/launch4jConfig&gt;
\ No newline at end of file
+&lt;/launch4jConfig&gt;

Modified: trunk/src/org/fao/gast/gui/panels/migration/oldinst/Worker.java
===================================================================
--- trunk/src/org/fao/gast/gui/panels/migration/oldinst/Worker.java	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/src/org/fao/gast/gui/panels/migration/oldinst/Worker.java	2008-03-27 14:56:13 UTC (rev 1222)
@@ -87,7 +87,7 @@
 			oldRes = source.config.createResource();
 			newRes = Lib.config.createResource();
 
-			executeJob((Dbms) oldRes.open(), (Dbms) newRes.open());
+			executeJob(oldRes, newRes);
 		}
 		catch(Throwable t)
 		{
@@ -126,13 +126,21 @@
 
 	//---------------------------------------------------------------------------
 
-	private void executeJob(Dbms oldDbms, Dbms newDbms) throws Exception
+	private void executeJob(Resource oldRes, Resource newRes) throws Exception
 	{
+		Dbms newDbms = (Dbms) newRes.open();
+		Dbms oldDbms = (Dbms) oldRes.open();
+
 		dlg.reset(9);
-		dlg.advance("Removing data in new installation");
+		dlg.advance("Setting up new installation");
 
-		removeAll(newDbms);
+		String tables[] = { "OperationAllowed", "UserGroups", "MetadataCateg", "Users", "Metadata", "GroupsDes", "Groups", "Categories", "CategoriesDes" };
+		HashSet notTables = new HashSet();
+		for (int i = 0;i &lt; tables.length;i++)
+			notTables.add(tables[i]);
 
+		Lib.database.setupNoFill(newRes,notTables,callBack);
+
 		Set&lt;String&gt; langs = getLanguages(newDbms);
 
 		dlg.advance("Migrating users");
@@ -164,31 +172,6 @@
 
 	//---------------------------------------------------------------------------
 
-	private void removeAll(Dbms newDbms) throws SQLException
-	{
-		//--- we commit at each step because an old migration could have failed and
-		//--- we could have plenty of records
-
-		newDbms.execute("DELETE FROM OperationAllowed");
-		newDbms.commit();
-		newDbms.execute("DELETE FROM UserGroups");
-		newDbms.commit();
-		newDbms.execute("DELETE FROM MetadataCateg");
-		newDbms.commit();
-		newDbms.execute("DELETE FROM Users");
-		newDbms.commit();
-		newDbms.execute("DELETE FROM Metadata");
-		newDbms.commit();
-		newDbms.execute("DELETE FROM GroupsDes");
-		newDbms.execute("DELETE FROM Groups");
-		newDbms.commit();
-		newDbms.execute("DELETE FROM CategoriesDes");
-		newDbms.execute("DELETE FROM Categories");
-		newDbms.commit();
-	}
-
-	//---------------------------------------------------------------------------
-
 	private Set&lt;String&gt; getLanguages(Dbms newDbms) throws SQLException
 	{
 		List langs = newDbms.select("SELECT * FROM Languages").getChildren();
@@ -330,7 +313,7 @@
 			if (usrGrps.size() == 0)
 				throw new Exception("No editor for metadata --&gt; id:"+id);
 
-			String owner = ((Element) privil.get(0)).getChildText("id");
+			String owner = ((Element) usrGrps.get(0)).getChildText("id");
 
 			//--- no, ok we can store it
 
@@ -549,7 +532,27 @@
 	private ProgressDialog dlg;
 
 	//---------------------------------------------------------------------------
+	
+	private DatabaseLib.CallBack callBack = new DatabaseLib.CallBack () 
+	{
+		public void schemaObjects(int count) {} 
+		public void removed(String object, String type) {
+			System.out.println("Removing : "+ object);
+		}
+		public void cyclicRefs(List&lt;String&gt; objects) {
+			System.out.println("Cyclic reference found: "+objects);
+		}
+		public void creating(String object, String type) {
+			System.out.println("Creating : "+ object);
+		}
+		public void skipping(String table) {
+			System.out.println("Skipping : "+ table);
+		}
+		public void filling (String table, String file) {}
+	};
 
+	//---------------------------------------------------------------------------
+
 	private DatabaseLib.Mapper idMapper = new DatabaseLib.Mapper()
 	{
 		public Object map(String field, Object value)

Modified: trunk/src/org/fao/gast/lib/DatabaseLib.java
===================================================================
--- trunk/src/org/fao/gast/lib/DatabaseLib.java	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/src/org/fao/gast/lib/DatabaseLib.java	2008-03-27 14:56:13 UTC (rev 1222)
@@ -31,6 +31,7 @@
 import java.sql.SQLException;
 import java.util.ArrayList;
 import java.util.HashMap;
+import java.util.HashSet;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
@@ -125,6 +126,30 @@
 	}
 
 	//---------------------------------------------------------------------------
+	/** Transactional */
+
+	public void setupNoFill(Resource resource, HashSet notTables, CallBack cb) throws Exception
+	{
+	
+		Dbms dbms = (Dbms) resource.open();
+
+		try
+		{
+			removeObjects(dbms, cb);
+			createSchema (dbms, cb);
+			dbms.commit();
+			fillTables(dbms, notTables, cb);
+			setupSiteId  (dbms);
+			setupVersion (dbms);
+			dbms.commit();
+		} catch(Exception e) {
+			resource.abort();
+			throw e;
+		}
+
+	}
+
+	//---------------------------------------------------------------------------
 	/** NOT Transactional */
 
 	public String getSetting(Dbms dbms, String path) throws SQLException
@@ -399,6 +424,12 @@
 
 	public void fillTables(Dbms dbms, CallBack cb) throws Exception
 	{
+		HashSet notTables = new HashSet();
+		fillTables(dbms,notTables,cb);
+	}
+
+	public void fillTables(Dbms dbms, HashSet notTables, CallBack cb) throws Exception
+	{
 		Lib.log.info("Filling database tables");
 
 		List&lt;String&gt; schema = loadSchemaFile(dbms.getURL());
@@ -407,23 +438,27 @@
 			if (row.toUpperCase().startsWith("CREATE TABLE "))
 			{
 				String table = getObjectName(row);
-				String file  = appPath +SETUP_DIR+ "/db/"+ table +".ddf";
+				if (!notTables.contains(table)) {
+					String file  = appPath +SETUP_DIR+ "/db/"+ table +".ddf";
 
-				if (!new File(file).exists())
-				{
-					if (cb != null)
-						cb.skipping(table);
+					if (!new File(file).exists())
+					{
+						if (cb != null)
+							cb.skipping(table);
+					}
+					else
+					{
+						if (cb != null)
+							cb.filling(table, file);
+	
+						Lib.log.debug(" - Filling table : "+ table);
+	
+						Import.load(dbms.getConnection(), table, file);
+						dbms.commit();
+					}
+				} else {
+					cb.skipping(table);
 				}
-				else
-				{
-					if (cb != null)
-						cb.filling(table, file);
-
-					Lib.log.debug(" - Filling table : "+ table);
-
-					Import.load(dbms.getConnection(), table, file);
-					dbms.commit();
-				}
 			}
 	}
 

Modified: trunk/src/org/fao/geonet/kernel/DataManager.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/DataManager.java	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/src/org/fao/geonet/kernel/DataManager.java	2008-03-27 14:56:13 UTC (rev 1222)
@@ -581,9 +581,11 @@
 	public void setHarvested(Dbms dbms, int id, String harvestUuid) throws Exception
 	{
 		String value = (harvestUuid != null) ? "y" : "n";
-		String query = "UPDATE Metadata SET isHarvested=?, harvestUuid=? WHERE id=?";
-
-		dbms.execute(query, value, harvestUuid, id);
+		if (harvestUuid == null) {
+			dbms.execute("UPDATE Metadata SET isHarvested=? WHERE id=?", value,id );
+		} else {
+			dbms.execute("UPDATE Metadata SET isHarvested=?, harvestUuid=? WHERE id=?",value, harvestUuid, id);
+		}
 		indexMetadata(dbms, Integer.toString(id));
 	}
 
@@ -795,16 +797,19 @@
 	  * operations are set.
 	  */
 
-	public String insertMetadata(Dbms dbms, String schema, String groupId, Element xml,
-										  SerialFactory sf, String source, String uuid, int owner) throws Exception
+	public String insertMetadata(Dbms dbms, String schema, String category, 
+											String groupId, Element xml, SerialFactory sf, 
+											String source, String uuid, int owner) throws Exception
 	{
-		return insertMetadata(dbms, schema, groupId, xml, sf, source, uuid, "n", null, owner);
+		return insertMetadata(dbms, schema, category, groupId, xml, sf, source, 
+													uuid, "n", null, owner);
 	}
 
 	//--------------------------------------------------------------------------
 
-	public String insertMetadata(Dbms dbms, String schema, String groupOwner, Element xml,
-										  SerialFactory sf, String source, String uuid, String isTemplate,
+	public String insertMetadata(Dbms dbms, String schema, String category, 
+											String groupOwner, Element xml, SerialFactory sf, 
+											String source, String uuid, String isTemplate,
 										  String title, int owner) throws Exception
 	{
 		//--- generate a new metadata id
@@ -821,6 +826,8 @@
 		String id = XmlSerializer.insert(dbms, schema, xml, serial, source, uuid, isTemplate, title, owner, groupOwner);
 
 		copyDefaultPrivForGroup(dbms, id, groupOwner);
+		if (category != null)
+			setCategory(dbms, id, category);
 		indexMetadata(dbms, id);
 
 		return id;

Modified: trunk/src/org/fao/geonet/kernel/XmlSerializer.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/XmlSerializer.java	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/src/org/fao/geonet/kernel/XmlSerializer.java	2008-03-27 14:56:13 UTC (rev 1222)
@@ -106,8 +106,8 @@
 		fixCR(xml);
 
 		StringBuffer fields = new StringBuffer("id, schemaId, data, createDate, changeDate, source, "+
-															"uuid, isTemplate, isHarvested, root, owner, groupOwner");
-		StringBuffer values = new StringBuffer("?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?");
+															"uuid, isTemplate, isHarvested, root, owner");
+		StringBuffer values = new StringBuffer("?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?");
 
 		Vector args = new Vector();
 		args.add(new Integer(serial));
@@ -122,8 +122,11 @@
 		args.add(xml.getQualifiedName());
 		args.add(owner);
 
-		if (groupOwner != null) 	args.add(new Integer(groupOwner));
-			else							args.add(null);
+		if (groupOwner != null) {
+			fields.append(", groupOwner");
+			values.append(", ?");
+			args.add(new Integer(groupOwner));
+		}
 
 		if (title != null)
 		{

Modified: trunk/src/org/fao/geonet/kernel/harvest/harvester/oaipmh/Harvester.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/harvest/harvester/oaipmh/Harvester.java	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/src/org/fao/geonet/kernel/harvest/harvester/oaipmh/Harvester.java	2008-03-27 14:56:13 UTC (rev 1222)
@@ -249,7 +249,7 @@
 		int iId = Integer.parseInt(id);
 
 		dataMan.setTemplate(dbms, iId, "n", null);
-		dataMan.setHarvested(dbms, iId, params.uuid, null);
+		dataMan.setHarvested(dbms, iId, params.uuid);
 
 		addPrivileges(id);
 		addCategories(id);

Modified: trunk/src/org/fao/geonet/kernel/search/LuceneSearcher.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/search/LuceneSearcher.java	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/src/org/fao/geonet/kernel/search/LuceneSearcher.java	2008-03-27 14:56:13 UTC (rev 1222)
@@ -199,27 +199,31 @@
 		AccessManager am = gc.getAccessManager();
 
 		Dbms dbms = (Dbms) srvContext.getResourceManager().open(Geonet.Res.MAIN_DB);
-		Set&lt;String&gt; hs = gc.getAccessManager().getUserGroups(dbms, srvContext.getUserSession(), srvContext.getIpAddress());
 
-		for (String group : hs)
-			request.addContent(new Element("group").addContent(group));
+		// if 'restrict to' is set then don't add any other user/group info
+		if (request.getChild("group") == null) {
+			Set&lt;String&gt; hs = gc.getAccessManager().getUserGroups(dbms, srvContext.getUserSession(), srvContext.getIpAddress());
 
-		String owner = srvContext.getUserSession().getUserId();
+			for (String group : hs)
+				request.addContent(new Element("group").addContent(group));
 
-		if (owner != null)
-			request.addContent(new Element("owner").addContent(owner));
+			String owner = srvContext.getUserSession().getUserId();
 
+			if (owner != null)
+				request.addContent(new Element("owner").addContent(owner));
+
 		//--- in case of an admin we have to show all results
 
-		UserSession us = srvContext.getUserSession();
+			UserSession us = srvContext.getUserSession();
 
-		if (us.isAuthenticated())
-		{
-			if (us.getProfile().equals(Geonet.Profile.ADMINISTRATOR))
-				request.addContent(new Element("isAdmin").addContent("true"));
-
-			else if (us.getProfile().equals(Geonet.Profile.REVIEWER))
-				request.addContent(new Element("isReviewer").addContent("true"));
+			if (us.isAuthenticated())
+			{
+				if (us.getProfile().equals(Geonet.Profile.ADMINISTRATOR))
+					request.addContent(new Element("isAdmin").addContent("true"));
+	
+				else if (us.getProfile().equals(Geonet.Profile.REVIEWER))
+					request.addContent(new Element("isReviewer").addContent("true"));
+			}
 		}
 
 		//--- some other stuff

Modified: trunk/src/org/fao/geonet/services/metadata/ImportFromDir.java
===================================================================
--- trunk/src/org/fao/geonet/services/metadata/ImportFromDir.java	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/src/org/fao/geonet/services/metadata/ImportFromDir.java	2008-03-27 14:56:13 UTC (rev 1222)
@@ -269,16 +269,17 @@
 		if (uuid.length() == 0)
 			uuid = UUID.randomUUID().toString();
 
+
 		//-----------------------------------------------------------------------
 		//--- insert metadata into the system
 
+		if (category.equals("_none_")) category = null;
 		Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
 
-		String id = dm.insertMetadata(dbms, schema, group, xml, context.getSerialFactory(),
-												gc.getSiteId(), uuid, context.getUserSession().getUserIdAsInt());
+		String id = dm.insertMetadata(dbms, schema, category, group, xml, 
+								context.getSerialFactory(), gc.getSiteId(), uuid, 
+								context.getUserSession().getUserIdAsInt());
 
-		if (!"_none_".equals(category))
-			dm.setCategory(dbms, id, category);
 	}
 }
 

Modified: trunk/src/org/fao/geonet/services/metadata/Insert.java
===================================================================
--- trunk/src/org/fao/geonet/services/metadata/Insert.java	2008-03-26 23:58:05 UTC (rev 1221)
+++ trunk/src/org/fao/geonet/services/metadata/Insert.java	2008-03-27 14:56:13 UTC (rev 1222)
@@ -110,17 +110,14 @@
 		//-----------------------------------------------------------------------
 		//--- insert metadata into the system
 
+		if (category.equals("_none_")) category = null;
 		Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
 
-		String id = dataMan.insertMetadata(dbms, schema, group, xml,
+		String id = dataMan.insertMetadata(dbms, schema, category, group, xml,
 													  context.getSerialFactory(), gc.getSiteId(),
 													  uuid, isTemplate, title,
 													  context.getUserSession().getUserIdAsInt());
 
-        //--- Insert category if requested
-        if (!"_none_".equals(category))
-            dataMan.setCategory(dbms, id, category);
-
 		Element response = new Element(Jeeves.Elem.RESPONSE);
 		response.addContent(new Element(Params.ID).setText(id));
 


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="25"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=18978785">[GeoNetwork-commit] SF.net SVN: geonetwork: [1228] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;ticheler@us...&gt; -	2008-03-31 09:03</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1228
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1228&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1228&amp;view=rev</a>
Author:   ticheler
Date:     2008-03-31 02:03:11 -0700 (Mon, 31 Mar 2008)

Log Message:
-----------
- Improved JavaDoc
- Updated map server list

Modified Paths:
--------------
    trunk/docs/build.xml
    trunk/web/intermap/WEB-INF/mapServers.xml
    trunk/web/intermap/WEB-INF/mapServers.xml_with_geoserver

Modified: trunk/docs/build.xml
===================================================================
--- trunk/docs/build.xml	2008-03-31 09:01:03 UTC (rev 1227)
+++ trunk/docs/build.xml	2008-03-31 09:03:11 UTC (rev 1228)
@@ -92,22 +92,34 @@
 	&lt;target name="javadoc" depends="javadoc-gn, javadoc-im" /&gt;
 
 	&lt;!-- =============================================================== --&gt;
+	&lt;path id="gn.classpath"&gt;
+		&lt;fileset dir="../web/geonetwork/WEB-INF/lib"&gt;
+			&lt;include name="*.jar"/&gt;
+		&lt;/fileset&gt;
+	&lt;/path&gt;
 	
 	&lt;target name="javadoc-gn"&gt;
 		&lt;delete   dir="${dbf.basedir}/html/javadoc/geonetwork" /&gt;
 		&lt;mkdir    dir="${dbf.basedir}/html/javadoc/geonetwork" /&gt;
 		&lt;javadoc	sourcepath  ="../src" 
+				classpathref="gn.classpath"
 				destdir     ="${dbf.basedir}/html/javadoc/geonetwork" 
 				packagenames="org.fao.*"
 				windowtitle ="GeoNetwork class documentation"/&gt;
 	&lt;/target&gt;
 	
 	&lt;!-- =============================================================== --&gt;
+	&lt;path id="im.classpath"&gt;
+	  &lt;fileset dir="../web/intermap/WEB-INF/lib"&gt;
+	    &lt;include name="*.jar"/&gt;
+	  &lt;/fileset&gt;
+	&lt;/path&gt;
 	
 	&lt;target name="javadoc-im"&gt;
 		&lt;delete   dir="${dbf.basedir}/html/javadoc/intermap" /&gt;
 		&lt;mkdir    dir="${dbf.basedir}/html/javadoc/intermap" /&gt;
 		&lt;javadoc        sourcepath  ="../src"
+				classpathref="im.classpath"
 				destdir     ="${dbf.basedir}/html/javadoc/intermap"
 				packagenames="org.wfp.*"
 				windowtitle ="InterMap class documentation"/&gt;

Modified: trunk/web/intermap/WEB-INF/mapServers.xml
===================================================================
--- trunk/web/intermap/WEB-INF/mapServers.xml	2008-03-31 09:01:03 UTC (rev 1227)
+++ trunk/web/intermap/WEB-INF/mapServers.xml	2008-03-31 09:03:11 UTC (rev 1228)
@@ -26,13 +26,28 @@
     &lt;server type="2" name="NASA JPL OneEarth Web Mapping Server (WMS)"&gt;
             &lt;url&gt;<a href="http://wms.jpl.nasa.gov/wms.cgi&lt;/url" target="_new">http://wms.jpl.nasa.gov/wms.cgi&lt;/url</a>&gt;
     &lt;/server&gt;
-		
     &lt;server type="2" name="NASA Earth Observations (NEO) WMS"&gt;
         &lt;url&gt;<a href="http://neowms.sci.gsfc.nasa.gov/wms/wms&lt;/url" target="_new">http://neowms.sci.gsfc.nasa.gov/wms/wms&lt;/url</a>&gt;
     &lt;/server&gt;
-    &lt;server type="2" name="Landsat 7"&gt;
+	&lt;server type="2" name="Integrated CEOS European Data Server (ICEDS) WMS"&gt;
+		&lt;url&gt;<a href="http://iceds.ge.ucl.ac.uk/cgi-bin/icedswms&lt;/url" target="_new">http://iceds.ge.ucl.ac.uk/cgi-bin/icedswms&lt;/url</a>&gt;
+	&lt;/server&gt;
+	&lt;server type="2" name="SOil Map Internet Server (SOMIS) WMS"&gt;
+		&lt;url&gt;<a href="http://eusoils.jrc.it/wmsconnector/com.esri.wms.Esrimap/Eusoils_WMS&lt;/url" target="_new">http://eusoils.jrc.it/wmsconnector/com.esri.wms.Esrimap/Eusoils_WMS&lt;/url</a>&gt;
+	&lt;/server&gt;
+	&lt;server type="2" name="Global Learning and Observations to Benefit the Environment (GLOBE)"&gt;
+		&lt;url&gt;<a href="http://viz.globe.gov/viz-bin/wmt.cgi&lt;/url" target="_new">http://viz.globe.gov/viz-bin/wmt.cgi&lt;/url</a>&gt;
+	&lt;/server&gt;
+	&lt;server type="2" name="Nighttime Lights of the World (NOAA)"&gt;
+		&lt;url&gt;<a href="http://www.ngdc.noaa.gov/eog/maps/cgi-bin/public/ms/poster&lt;/url" target="_new">http://www.ngdc.noaa.gov/eog/maps/cgi-bin/public/ms/poster&lt;/url</a>&gt;
+	&lt;/server&gt;
+	&lt;server type="2" name="TerraServer USA (high resolution imagery)"&gt;
+		&lt;url&gt;<a href="http://terraserver-usa.com/ogccapabilities.ashx&lt;/url" target="_new">http://terraserver-usa.com/ogccapabilities.ashx&lt;/url</a>&gt;
+	&lt;/server&gt;
+			
+&lt;!--    &lt;server type="2" name="Landsat 7"&gt;
             &lt;url&gt;<a href="http://hypercube.telascience.org/cgi-bin/landsat7&lt;/url" target="_new">http://hypercube.telascience.org/cgi-bin/landsat7&lt;/url</a>&gt;
-    &lt;/server&gt;
+    &lt;/server&gt; --&gt;
 &lt;!--    &lt;server type="2" name="Elevation data (SRTM) - USGS CEOS - OGC WMS"&gt;
            &lt;url&gt;<a href="http://gisdata.usgs.net/servlet/com.esri.wms.Esrimap/USGS_EDC_Elev_STM&lt;/url" target="_new">http://gisdata.usgs.net/servlet/com.esri.wms.Esrimap/USGS_EDC_Elev_STM&lt;/url</a>&gt;
     &lt;/server&gt;

Modified: trunk/web/intermap/WEB-INF/mapServers.xml_with_geoserver
===================================================================
--- trunk/web/intermap/WEB-INF/mapServers.xml_with_geoserver	2008-03-31 09:01:03 UTC (rev 1227)
+++ trunk/web/intermap/WEB-INF/mapServers.xml_with_geoserver	2008-03-31 09:03:11 UTC (rev 1228)
@@ -1,45 +1,48 @@
 &lt;?xml version="1.0"?&gt;
 
 &lt;!-- Map servers 
-	You can add / change the list of avaialble Web Map Servers here
+	You can add / change the list of available Web Map Servers here
 	Add any OGC WMS or ESRI ArcIMS compliant server below using the same format as the provided examples below
 	OGC WMS servers are known as type 2
 	ESRI ArcIMS servers are known as type 1
 --&gt;
 &lt;config&gt;
 	&lt;mapServers&gt;
-    &lt;!--&lt;server type="2" name="FAO Geonetwork - World OpenGIS WMS"&gt;
-            &lt;url&gt;<a href="http://www.fao.org/geonetwork/wms/WMSServlet/world&lt;/url" target="_new">http://www.fao.org/geonetwork/wms/WMSServlet/world&lt;/url</a>&gt;
-    &lt;/server&gt;
-    &lt;server type="2" name="FAO Geonetwork - Africa OpenGIS WMS"&gt;
-            &lt;url&gt;<a href="http://www.fao.org/geonetwork/wms/WMSServlet/africa&lt;/url" target="_new">http://www.fao.org/geonetwork/wms/WMSServlet/africa&lt;/url</a>&gt;
-    &lt;/server&gt;
-    &lt;server type="2" name="FAO Geonetwork - South America OpenGIS WMS"&gt;
-            &lt;url&gt;<a href="http://www.fao.org/geonetwork/wms/WMSServlet/southamerica&lt;/url" target="_new">http://www.fao.org/geonetwork/wms/WMSServlet/southamerica&lt;/url</a>&gt;
-    &lt;/server&gt;
-    &lt;server type="2" name="FAO Geonetwork - Asia OpenGIS WMS"&gt;
-            &lt;url&gt;<a href="http://www.fao.org/geonetwork/wms/WMSServlet/asia&lt;/url" target="_new">http://www.fao.org/geonetwork/wms/WMSServlet/asia&lt;/url</a>&gt;
-    &lt;/server&gt;
-    &lt;server type="2" name="FAO GeoNetwork - Tsunami 2004 WMS"&gt;
-    	&lt;url&gt;<a href="http://tecproda01.fao.org/cgi-bin/tsunami&lt;/url" target="_new">http://tecproda01.fao.org/cgi-bin/tsunami&lt;/url</a>&gt;
-    &lt;/server&gt; --&gt;
-
     &lt;server type="2" name="Local GeoServer Web Mapping Server (WMS)"&gt;
             &lt;url&gt;<a href="http://localhost:8080/geoserver/wms&lt;/url" target="_new">http://localhost:8080/geoserver/wms&lt;/url</a>&gt;
     &lt;/server&gt;
-
     &lt;server type="2" name="NASA JPL OneEarth Web Mapping Server (WMS)"&gt;
-            &lt;url&gt;<a href="http://wms.jpl.nasa.gov/wms.cgi&lt;/url" target="_new">http://wms.jpl.nasa.gov/wms.cgi&lt;/url</a>&gt;
+      &lt;url&gt;<a href="http://wms.jpl.nasa.gov/wms.cgi&lt;/url" target="_new">http://wms.jpl.nasa.gov/wms.cgi&lt;/url</a>&gt;
     &lt;/server&gt;
-		
     &lt;server type="2" name="NASA Earth Observations (NEO) WMS"&gt;
-        &lt;url&gt;<a href="http://neowms.sci.gsfc.nasa.gov/wms/wms&lt;/url" target="_new">http://neowms.sci.gsfc.nasa.gov/wms/wms&lt;/url</a>&gt;
+      &lt;url&gt;<a href="http://neowms.sci.gsfc.nasa.gov/wms/wms&lt;/url" target="_new">http://neowms.sci.gsfc.nasa.gov/wms/wms&lt;/url</a>&gt;
     &lt;/server&gt;
+		&lt;server type="2" name="Integrated CEOS European Data Server (ICEDS) WMS"&gt;
+			&lt;url&gt;<a href="http://iceds.ge.ucl.ac.uk/cgi-bin/icedswms&lt;/url" target="_new">http://iceds.ge.ucl.ac.uk/cgi-bin/icedswms&lt;/url</a>&gt;
+		&lt;/server&gt;
+		&lt;server type="2" name="SOil Map Internet Server (SOMIS) WMS"&gt;
+			&lt;url&gt;<a href="http://eusoils.jrc.it/wmsconnector/com.esri.wms.Esrimap/Eusoils_WMS&lt;/url" target="_new">http://eusoils.jrc.it/wmsconnector/com.esri.wms.Esrimap/Eusoils_WMS&lt;/url</a>&gt;
+		&lt;/server&gt;
+    &lt;server type="2" name="Global Learning and Observations to Benefit the Environment (GLOBE)"&gt;
+            &lt;url&gt;<a href="http://viz.globe.gov/viz-bin/wmt.cgi&lt;/url" target="_new">http://viz.globe.gov/viz-bin/wmt.cgi&lt;/url</a>&gt;
+    &lt;/server&gt;
+    &lt;server type="2" name="Nighttime Lights of the World (NOAA)"&gt;
+        &lt;url&gt;<a href="http://www.ngdc.noaa.gov/eog/maps/cgi-bin/public/ms/poster&lt;/url" target="_new">http://www.ngdc.noaa.gov/eog/maps/cgi-bin/public/ms/poster&lt;/url</a>&gt;
+		&lt;/server&gt;
+		&lt;server type="2" name="TerraServer USA (high resolution images)"&gt;
+	 			&lt;url&gt;<a href="http://terraserver-usa.com/ogccapabilities.ashx&lt;/url" target="_new">http://terraserver-usa.com/ogccapabilities.ashx&lt;/url</a>&gt;
+		&lt;/server&gt;
+    &lt;server type="2" name="CCRS - Cubewerx"&gt;
+            &lt;url&gt;<a href="http://ceoware2.ccrs.nrcan.gc.ca/cubewerx/cubeserv/cubeserv.cgi&lt;/url" target="_new">http://ceoware2.ccrs.nrcan.gc.ca/cubewerx/cubeserv/cubeserv.cgi&lt;/url</a>&gt;
+    &lt;/server&gt;
+    &lt;server type="2" name="DEMIS World Map Server"&gt;
+            &lt;url&gt;<a href="http://www2.demis.nl/mapserver/request.asp&lt;/url" target="_new">http://www2.demis.nl/mapserver/request.asp&lt;/url</a>&gt;
+    &lt;/server&gt;
+    &lt;server type="2" name="Demo Cubewerx (WMS) - 2"&gt;
+            &lt;url&gt;<a href="http://demo.cubewerx.com/demo/cubeserv/cubeserv.cgi&lt;/url" target="_new">http://demo.cubewerx.com/demo/cubeserv/cubeserv.cgi&lt;/url</a>&gt;
+    &lt;/server&gt;
 		
 &lt;!-- 
-    &lt;server type="2" name="Digital Earth"&gt;
-            &lt;url&gt;<a href="http://globe.digitalearth.gov/viz-bin/wmt.cgi&lt;/url" target="_new">http://globe.digitalearth.gov/viz-bin/wmt.cgi&lt;/url</a>&gt;
-    &lt;/server&gt;
     &lt;server type="2" name="Elevation data (SRTM) - USGS CEOS - OGC WMS"&gt;
            &lt;url&gt;<a href="http://gisdata.usgs.net/servlet/com.esri.wms.Esrimap/USGS_EDC_Elev_STM&lt;/url" target="_new">http://gisdata.usgs.net/servlet/com.esri.wms.Esrimap/USGS_EDC_Elev_STM&lt;/url</a>&gt;
     &lt;/server&gt;
@@ -52,25 +55,6 @@
     &lt;server type="2" name="ER_TSUNAMI_INUNDATION_Z44 - USGS - OGC WMS"&gt;
             &lt;url&gt;<a href="http://edcw2ks51.cr.usgs.gov/servlet/com.esri.wms.Esrimap&lt;/url" target="_new">http://edcw2ks51.cr.usgs.gov/servlet/com.esri.wms.Esrimap&lt;/url</a>&gt;
     &lt;/server&gt;
---&gt;
-    &lt;server type="2" name="CCRS - Cubewerx"&gt;
-            &lt;url&gt;<a href="http://ceoware2.ccrs.nrcan.gc.ca/cubewerx/cubeserv/cubeserv.cgi&lt;/url" target="_new">http://ceoware2.ccrs.nrcan.gc.ca/cubewerx/cubeserv/cubeserv.cgi&lt;/url</a>&gt;
-    &lt;/server&gt;
-    &lt;server type="2" name="DEMIS World Map Server"&gt;
-            &lt;url&gt;<a href="http://www2.demis.nl/mapserver/request.asp&lt;/url" target="_new">http://www2.demis.nl/mapserver/request.asp&lt;/url</a>&gt;
-    &lt;/server&gt;
-&lt;!--
-    &lt;server type="2" name="MERIS data - ESRIN (WMS) - 1"&gt;
-            &lt;url&gt;<a href="http://mapserv2.esrin.esa.it/ionicweb/map/GAEL_WORLD_MARCH&lt;/url" target="_new">http://mapserv2.esrin.esa.it/ionicweb/map/GAEL_WORLD_MARCH&lt;/url</a>&gt;
-    &lt;/server&gt;
---&gt;
-    &lt;server type="2" name="Demo Cubewerx (WMS) - 2"&gt;
-            &lt;url&gt;<a href="http://demo.cubewerx.com/demo/cubeserv/cubeserv.cgi&lt;/url" target="_new">http://demo.cubewerx.com/demo/cubeserv/cubeserv.cgi&lt;/url</a>&gt;
-    &lt;/server&gt;
-    &lt;!--
-    &lt;server type="2" name="SETSAN"&gt;
-            &lt;url&gt;<a href="http://www.setsan.org.mz/ogcwms/servlet/com.esri.ogc.wms.WMSServlet?SERVICENAME=wms&lt;/url" target="_new">http://www.setsan.org.mz/ogcwms/servlet/com.esri.ogc.wms.WMSServlet?SERVICENAME=wms&lt;/url</a>&gt;
-    &lt;/server&gt;
     --&gt;
 	&lt;/mapServers&gt;
 	
@@ -90,21 +74,20 @@
 			&lt;/server&gt;
 			&lt;server url="<a href="http://www2.demis.nl/mapserver/request.asp" target="_new">http://www2.demis.nl/mapserver/request.asp</a>"  type="2" &gt;
 				&lt;layer name="Coastlines"&gt;&lt;/layer&gt;
-			&lt;/server&gt; --&gt;
-			
-			
-&lt;!--			&lt;server url="<a href="http://193.43.36.137/ows/12279" target="_new">http://193.43.36.137/ows/12279</a>" type="2"&gt;
+			&lt;/server&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/12279" target="_new">http://geonetwork3.fao.org/ows/12279</a>" type="2"&gt;
 				&lt;layer name="world_country_boundary" /&gt;
 			&lt;/server&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/1" target="_new">http://193.43.36.137/ows/1</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/1" target="_new">http://geonetwork3.fao.org/ows/1</a>" type="2"&gt;
 				&lt;layer name="national_boundaries_africa" /&gt;
 			&lt;/server&gt;			
---&gt;		&lt;/default&gt; 
+--&gt;
+		&lt;/default&gt; 
 		&lt;context name="World - Landsat 7 Global Mosaic (pan sharpened) with simplified national boundaries"&gt;
 			&lt;server url="<a href="http://onearth.jpl.nasa.gov/wms.cgi" target="_new">http://onearth.jpl.nasa.gov/wms.cgi</a>" type="2"&gt;
 				&lt;layer name="global_mosaic" /&gt;
 			&lt;/server&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/12279" target="_new">http://193.43.36.137/ows/12279</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/12279" target="_new">http://geonetwork3.fao.org/ows/12279</a>" type="2"&gt;
 				&lt;layer name="world_country_boundary" /&gt;
 			&lt;/server&gt;
 		&lt;/context&gt;
@@ -112,31 +95,31 @@
 			&lt;server url="<a href="http://onearth.jpl.nasa.gov/wms.cgi" target="_new">http://onearth.jpl.nasa.gov/wms.cgi</a>" type="2"&gt;
 				&lt;layer name="global_mosaic_base" /&gt;
 			&lt;/server&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/12279" target="_new">http://193.43.36.137/ows/12279</a> with simplified national boundaries" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/12279" target="_new">http://geonetwork3.fao.org/ows/12279</a> with simplified national boundaries" type="2"&gt;
 				&lt;layer name="world_country_boundary" /&gt;
 			&lt;/server&gt;
 		&lt;/context&gt;
 		&lt;context name="World - Soil Map of the World with simplified national boundaries"&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/6095" target="_new">http://193.43.36.137/ows/6095</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/6095" target="_new">http://geonetwork3.fao.org/ows/6095</a>" type="2"&gt;
 				&lt;layer name="world_soilmap" /&gt;
 			&lt;/server&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/12279" target="_new">http://193.43.36.137/ows/12279</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/12279" target="_new">http://geonetwork3.fao.org/ows/12279</a>" type="2"&gt;
 				&lt;layer name="world_country_boundary" /&gt;
 			&lt;/server&gt;
 		&lt;/context&gt;
 		&lt;context name="World - The Land Cover of the World in the Year 2000 with simplified national boundaries"&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/6531" target="_new">http://193.43.36.137/ows/6531</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/6531" target="_new">http://geonetwork3.fao.org/ows/6531</a>" type="2"&gt;
 				&lt;layer name="global_land_cover_2000" /&gt;
 			&lt;/server&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/12279" target="_new">http://193.43.36.137/ows/12279</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/12279" target="_new">http://geonetwork3.fao.org/ows/12279</a>" type="2"&gt;
 				&lt;layer name="world_country_boundary" /&gt;
 			&lt;/server&gt;
 		&lt;/context&gt;
 		&lt;context name="World - Global Map Irrigated Areas with simplified national boundaries"&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/5020" target="_new">http://193.43.36.137/ows/5020</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/5020" target="_new">http://geonetwork3.fao.org/ows/5020</a>" type="2"&gt;
 				&lt;layer name="irrigated_areas" /&gt;
 			&lt;/server&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/12279" target="_new">http://193.43.36.137/ows/12279</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/12279" target="_new">http://geonetwork3.fao.org/ows/12279</a>" type="2"&gt;
 				&lt;layer name="world_country_boundary" /&gt;
 			&lt;/server&gt;
 		&lt;/context&gt;
@@ -144,7 +127,7 @@
 			&lt;server url="<a href="http://onearth.jpl.nasa.gov/wms.cgi" target="_new">http://onearth.jpl.nasa.gov/wms.cgi</a>" type="2"&gt;
 				&lt;layer name="daily_terra" /&gt;
 			&lt;/server&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/12279" target="_new">http://193.43.36.137/ows/12279</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/12279" target="_new">http://geonetwork3.fao.org/ows/12279</a>" type="2"&gt;
 				&lt;layer name="world_country_boundary" /&gt;
 			&lt;/server&gt;
 		&lt;/context&gt;
@@ -152,7 +135,7 @@
 			&lt;server url="<a href="http://onearth.jpl.nasa.gov/wms.cgi" target="_new">http://onearth.jpl.nasa.gov/wms.cgi</a>" type="2"&gt;
 				&lt;layer name="daily_aqua" /&gt;
 			&lt;/server&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/12279" target="_new">http://193.43.36.137/ows/12279</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/12279" target="_new">http://geonetwork3.fao.org/ows/12279</a>" type="2"&gt;
 				&lt;layer name="world_country_boundary" /&gt;
 			&lt;/server&gt;
 		&lt;/context&gt;
@@ -160,7 +143,7 @@
 			&lt;server url="<a href="http://onearth.jpl.nasa.gov/wms.cgi" target="_new">http://onearth.jpl.nasa.gov/wms.cgi</a>" type="2"&gt;
 				&lt;layer name="srtmplus" /&gt;
 			&lt;/server&gt;
-			&lt;server url="<a href="http://193.43.36.137/ows/12279" target="_new">http://193.43.36.137/ows/12279</a>" type="2"&gt;
+			&lt;server url="<a href="http://geonetwork3.fao.org/ows/12279" target="_new">http://geonetwork3.fao.org/ows/12279</a>" type="2"&gt;
 				&lt;layer name="world_country_boundary" /&gt;
 			&lt;/server&gt;
 		&lt;/context&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=19053464">[GeoNetwork-commit] SF.net SVN: geonetwork: [1250] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;ticheler@us...&gt; -	2008-04-08 07:39</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1250
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1250&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1250&amp;view=rev</a>
Author:   ticheler
Date:     2008-04-08 00:39:33 -0700 (Tue, 08 Apr 2008)

Log Message:
-----------
- Aligning with branch 22x

Modified Paths:
--------------
    trunk/docs/changes.txt
    trunk/docs/docbook/gn_manual/qsg_installing.xml
    trunk/docs/known issues.txt
    trunk/docs/readme.html
    trunk/installer/installer-config-win-jre.xml
    trunk/installer/installer-config.xml
    trunk/installer/readme-install.txt
    trunk/src/org/fao/gast/cli/Cli.java
    trunk/src/org/fao/gast/cli/setup/Setup.java
    trunk/src/org/wfp/vam/intermap/kernel/map/images/ImageMerger.java
    trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/WmsService.java
    trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/schema/type/WMSFormat.java
    trunk/web/intermap/xsl/im_get-services-embedded.xsl
    trunk/web/intermap/xsl/im_get-services.xsl

Added Paths:
-----------
    trunk/docs/docbook/gn_manual/images/install_packages.png
    trunk/docs/docbook/gn_manual/images/install_script.png
    trunk/src/org/fao/gast/cli/sampledata/
    trunk/src/org/fao/gast/cli/sampledata/SampleData.java

Modified: trunk/docs/changes.txt
===================================================================
--- trunk/docs/changes.txt	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/docs/changes.txt	2008-04-08 07:39:33 UTC (rev 1250)
@@ -1,5 +1,60 @@
 ================================================================================
 ===
+=== GeoNetwork 2.2.0 Final: List of changes
+===
+================================================================================
+--------------------------------------------------------------------------------
+--- Known issues
+--------------------------------------------------------------------------------
+
+- On some Windows systems, installing in the default Program files folder causes
+  a stylesheet compilation error. The workaround is to install in a directory
+  without spaces in the folder names. E.g. in c:\geonetwork
+
+- In Postgresql an error occurs related to type casting while migrating from 
+  version 2.0.3. Using the older version of the jdbc driver version 7.4 seems 
+  to resolve this problem for Postgres v7 and v8.x. The old driver can be found 
+  at <a href="http://jdbc.postgresql.org/download.html#archived" target="_new">http://jdbc.postgresql.org/download.html#archived</a>
+
+--------------------------------------------------------------------------------
+--- Changes
+--------------------------------------------------------------------------------
+
+- Sample metadata is now an option in the package selection panel
+
+- The commandline installation using the install script generated by the
+  installer is working again.
+  
+- Upgraded IzPack version. Debug information using -DTRACE=true now available
+  (see documentation on "Commandline installation").
+  
+- Presentation updates for embedded metadata show.
+
+- Simplification of the presentation of the metadata using 'fieldset' instead of 
+  dotted lines to display metadata blocks
+
+- upgraded Jeeves and related commons-fileupload-1.2.1.jar
+
+- Label updates for French and English
+
+- Updated map services list
+
+- Start GeoNetwork headless (prevent pop-up Java windows)
+
+- Improved JavaDoc
+
+- GAST: Changed the delete table order to respect constraints
+
+--------------------------------------------------------------------------------
+--- Bug fixes
+--------------------------------------------------------------------------------
+
+- Fix for internet exploder upload problem
+
+- GAST: Fix the way the metadata owner is calculated during migration
+
+================================================================================
+===
 === GeoNetwork 2.2.0 RC2: List of changes
 ===
 ================================================================================

Added: trunk/docs/docbook/gn_manual/images/install_packages.png
===================================================================
(Binary files differ)


Property changes on: trunk/docs/docbook/gn_manual/images/install_packages.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/docs/docbook/gn_manual/images/install_script.png
===================================================================
(Binary files differ)


Property changes on: trunk/docs/docbook/gn_manual/images/install_script.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/docs/docbook/gn_manual/qsg_installing.xml
===================================================================
--- trunk/docs/docbook/gn_manual/qsg_installing.xml	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/docs/docbook/gn_manual/qsg_installing.xml	2008-04-08 07:39:33 UTC (rev 1250)
@@ -68,6 +68,8 @@
                 opensource Community website&lt;/ulink&gt;. The software is also distributed 
                 through the SourceForge.net Website at
                 &lt;ulink url="<a href="http://sourceforge.net/projects/geonetwork"/&gt;.&lt;/para" target="_new">http://sourceforge.net/projects/geonetwork"/&gt;.&lt;/para</a>&gt;
+            &lt;para&gt;Use the platform independent installer (.jar) if you need anything more 
+                than a plain Windows installation.&lt;/para&gt; 
         &lt;/section&gt;
 
         &lt;section&gt;
@@ -89,24 +91,24 @@
 
             &lt;para&gt;&lt;emphasis role="bold"&gt;Other Software requirements&lt;/emphasis&gt;: A Java Runtime
                 Environment (JRE 1.5.0). For server installations, Apache Tomcat and a dedicated
-                JDBC compliant DBMS (MySQL, Oracle) are also required.&lt;emphasis role="bold"/&gt;&lt;/para&gt;
+                JDBC compliant DBMS (MySQL, Postgresql, Oracle) can be used instead of Jetty and McKoiDB respectively.&lt;emphasis role="bold"/&gt;&lt;/para&gt;
 
             &lt;section&gt;
                 &lt;title&gt;Additional Software&lt;/title&gt;
-                &lt;para&gt;The software listed here is not required to install GeoNetwork, but can be used
+                &lt;para&gt;The software listed here is not required to run GeoNetwork, but can be used
                       for custom installations.&lt;/para&gt;
                 &lt;orderedlist&gt;
                     &lt;listitem&gt;
                         &lt;para&gt;MySQL DBMS v5.5+ (All)&lt;footnote id="all_os"&gt;&lt;para&gt;All = Windows, Linux and Mac OS X&lt;/para&gt;&lt;/footnote&gt;&lt;/para&gt;
                     &lt;/listitem&gt;
                     &lt;listitem&gt;
-                        &lt;para&gt;Apache Tomcat v5.5 (All)&lt;footnoteref linkend="all_os"/&gt;&lt;/para&gt;
+                        &lt;para&gt;Postgresql DBMS v7+ (All)&lt;footnoteref linkend="all_os"/&gt;&lt;/para&gt;
                     &lt;/listitem&gt;
                     &lt;listitem&gt;
-                        &lt;para&gt;Apache HTTP v2.0+ (Windows), optional&lt;/para&gt;
+                        &lt;para&gt;Apache Tomcat v5.5+ (All)&lt;footnoteref linkend="all_os"/&gt;&lt;/para&gt;
                     &lt;/listitem&gt;
                     &lt;listitem&gt;
-                        &lt;para&gt;Druid v3.8 (All)&lt;footnoteref linkend="all_os"/&gt;&lt;/para&gt;
+                        &lt;para&gt;Druid v3.8 (All)&lt;footnoteref linkend="all_os"/&gt; to inspect the database&lt;/para&gt;
                     &lt;/listitem&gt;
                 &lt;/orderedlist&gt;
              &lt;/section&gt;
@@ -135,19 +137,25 @@
             &lt;para&gt;Before running the GeoNetwork installer, make sure that all system requirements
                 are satisfied, and in particular that the Java Runtime Environment version 1.5.0 is
                 set up on your machine.&lt;/para&gt;
-
+						&lt;section id="win_install"&gt;
+							&lt;title&gt;On Windows&lt;/title&gt;
             &lt;para&gt;If you use Windows, the following steps will guide you to complete the
                 installation (other FOSS will follow):&lt;/para&gt;
 
             &lt;orderedlist&gt;
                 &lt;listitem&gt;
                     &lt;para&gt;Double click on &lt;emphasis role="bold"
-                        &gt;geonetwork-install-2.1.0.exe&lt;/emphasis&gt; to start the GeoNetwok opensource
+                        &gt;geonetwork-install-2.2.0.exe&lt;/emphasis&gt; to start the GeoNetwok opensource
                         desktop installer&lt;/para&gt;
                 &lt;/listitem&gt;
 
                 &lt;listitem&gt;
-                    &lt;para&gt;Follow the instructions on screen (&lt;xref linkend="installer"/&gt;)&lt;/para&gt;
+                    &lt;para&gt;Follow the instructions on screen (&lt;xref linkend="installer"/&gt;). You 
+                    can choose to install sample data, install the embedded map server (based on 
+                    &lt;ulink url="<a href="http://www.geoserver.org"&gt;GeoServer&lt;/ulink" target="_new">http://www.geoserver.org"&gt;GeoServer&lt;/ulink</a>&gt; and the CSW 2.0.1 
+                    test client. Developers may be interested in installing the source code
+                    and installer building tools. Full source code can be found in the 
+                    GeoNetwork SubVersion code repository.&lt;/para&gt;
                 &lt;/listitem&gt;
 
                 &lt;listitem&gt;
@@ -178,7 +186,55 @@
                     &lt;/imageobject&gt;
                 &lt;/mediaobject&gt;
             &lt;/figure&gt;
-
+            &lt;figure id="install_packages"&gt;
+                &lt;title&gt;Packages to be installed&lt;/title&gt;
+                &lt;mediaobject&gt;
+                    &lt;imageobject&gt;
+                        &lt;imagedata fileref="images/install_packages.png" width="11cm" align="center"/&gt;
+                    &lt;/imageobject&gt;
+                &lt;/mediaobject&gt;
+            &lt;/figure&gt;
+            &lt;/section&gt;
+            &lt;section&gt;
+            	&lt;title&gt;Installation using the platform independent installer&lt;/title&gt;
+            	&lt;para&gt;If you downloaded the platform independent installer (a .jar file), you can 
+            	in most cases start the installer by simply double clicking on it.&lt;/para&gt;
+            	&lt;para&gt;Follow the instructions on screen (see also &lt;xref linkend="win_install"/&gt;).&lt;/para&gt;
+            	&lt;para&gt;At the end of the installation process you can choose to save the installation
+            	script (&lt;xref linkend="install_script"/&gt;).&lt;/para&gt;
+            &lt;figure id="install_script"&gt;
+                &lt;title&gt;Save the installation script for commandline installations&lt;/title&gt;
+                &lt;mediaobject&gt;
+                    &lt;imageobject&gt;
+                        &lt;imagedata fileref="images/install_script.png" width="11cm" align="center"/&gt;
+                    &lt;/imageobject&gt;
+                &lt;/mediaobject&gt;
+            &lt;/figure&gt;
+            &lt;/section&gt;
+            &lt;section&gt;
+            	&lt;title&gt;Commandline installation&lt;/title&gt;
+            	&lt;para&gt;If you downloaded the platform independent installer (a .jar file), you can
+            	perform commandline installations on computers without a graphical interface. You first
+            	need to generate an install script (see &lt;xref linkend="install_script"/&gt;). This install 
+            	script can be edited in a text editor to change some installation parameters.&lt;/para&gt;
+            	&lt;para&gt;To run the installation from the commandline, issue the following command in a 
+            	terminal window and hit enter to start:&lt;/para&gt;
+            	&lt;programlisting&gt; 
+&lt;![CDATA[java -jar geonetwork-install-2.2.0-0.jar install.xml
+[ Starting automated installation ]
+[ Starting to unpack ]
+[ Processing package: Core (1/3) ]
+[ Processing package: Sample metadata (2/3) ]
+[ Processing package: GeoServer web map server (3/3) ]
+[ Unpacking finished ]
+[ Writing the uninstaller data ... ]
+[ Automated installation done ]
+]]&gt;
+							&lt;/programlisting&gt;
+							&lt;para&gt;You can also run the installation with lots of debug output. To do so run the 
+							installer with the flag &lt;literal&gt;-DTRACE=true&lt;/literal&gt;: &lt;/para&gt;
+                            &lt;programlisting&gt;java -DTRACE=true -jar geonetwork-install-2.2.0-0.jar&lt;/programlisting&gt;
+						&lt;/section&gt;
             &lt;para&gt;
                 &lt;guilabel/&gt;
             &lt;/para&gt;

Modified: trunk/docs/known issues.txt
===================================================================
--- trunk/docs/known issues.txt	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/docs/known issues.txt	2008-04-08 07:39:33 UTC (rev 1250)
@@ -4,15 +4,26 @@
 Bugs:
 ==================================================================
 
-- Some metadata element strings are not found in the editor
+- (mostly fixed for version 2.2.0) Some metadata element strings are not found 
+  in the editor.
 
 ==================================================================
 Issues:
 ==================================================================
 
-- (RESOLVED for version 2.1.0) A big issue is the backward compatibility of the harvesting. v2.1 does not harvest
-  nodes of v2.0. This can not be. Even if less optimal harvesting, this should remain 
-  possible when upgrading.
+- On some Windows systems, installing in the default Program files folder causes
+  a stylesheet compilation error. The workaround is to install in a directory
+  without spaces in the folder names. E.g. in c:\geonetwork
+
+- In Postgresql an error occurs related to type casting while 
+  migrating from version 2.0.3. Using the older version of the jdbc 
+  driver version 7.4 seems to resolve this problem for Postgres v7 
+  and v8.x. The old driver can be found at 
+  <a href="http://jdbc.postgresql.org/download.html#archived" target="_new">http://jdbc.postgresql.org/download.html#archived</a>
+
+- (RESOLVED for version 2.1.0) A big issue is the backward compatibility of the 
+  harvesting. v2.1 does not harvest nodes of v2.0. This can not be. Even if less 
+  optimal harvesting, this should remain possible when upgrading.
   
 - (RESOLVED for version 2.1.0) Sample metadata does not have:
 	- online resources (requires InterMap integration too)
@@ -22,13 +33,14 @@
 To do:
 ==================================================================
 
-- in metadata.show.xsl &amp; search-results.xsl the href does not point to baseURL yet of
-  the resource yet.
+- (Done for version 2.2.0) in metadata.show.xsl &amp; search-results.xsl the href 
+  does not point to baseURL yet of the resource yet.
   
-- Revisit the help.xml, links.xml and about.xml to verify and update (a.o. links &amp; 
-  some of the translations))
+- (Partially done) Revisit the help.xml, links.xml and about.xml to verify and 
+  update (a.o. links &amp; some of the translations))
  
-- (Done for version 2.1.0) Further improve help through the use of DHTML tooltips and AJAX request to server
+- (Done for version 2.1.0) Further improve help through the use of DHTML 
+  tooltips and AJAX request to server
  
 - (Done for version 2.1.0) Integrated version with InterMap opensource
 

Modified: trunk/docs/readme.html
===================================================================
--- trunk/docs/readme.html	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/docs/readme.html	2008-04-08 07:39:33 UTC (rev 1250)
@@ -26,6 +26,7 @@
 		You should use the username &lt;font color="#FF0000"&gt;&lt;code&gt;&lt;b&gt;admin&lt;/b&gt;&lt;/code&gt;&lt;/font&gt; and password &lt;font color="#FF0000"&gt;&lt;code&gt;&lt;b&gt;admin&lt;/b&gt;&lt;/code&gt;&lt;/font&gt;.
 		In the Administration section you can then &lt;strong&gt;modify your account&lt;/strong&gt;.
 	&lt;/p&gt;
+	&lt;p&gt;Online documentation is available from the GeoNetwork homepage. Select &lt;b&gt;&lt;a href="<a href="http://localhost:8080/geonetwork/docs/index.html"&gt;Help&lt;/a&gt;&lt;/b" target="_new">http://localhost:8080/geonetwork/docs/index.html"&gt;Help&lt;/a&gt;&lt;/b</a>&gt; from the menu bar. A link to the printable PDF version can be found at the bottom of the help page.&lt;/p&gt;
 
 	&lt;p&gt;You can also start the Jetty webserver of GeoNetwork using the scripts located into the $INSTALL_PATH/bin directory.&lt;/p&gt;
 

Modified: trunk/installer/installer-config-win-jre.xml
===================================================================
--- trunk/installer/installer-config-win-jre.xml	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/installer/installer-config-win-jre.xml	2008-04-08 07:39:33 UTC (rev 1250)
@@ -48,14 +48,14 @@
 	&lt;!-- =================================================================================== --&gt;
 	
 	&lt;panels&gt;
-		&lt;panel classname="HelloPanel"/&gt;
-		&lt;panel classname="HTMLLicencePanel"/&gt;
-		&lt;panel classname="TargetPanel"/&gt;
-		&lt;panel classname="PacksPanel"/&gt;
-		&lt;panel classname="InstallPanel"/&gt;
-		&lt;panel classname="ShortcutPanel"/&gt;
-		&lt;panel classname="HTMLInfoPanel"/&gt;
-		&lt;panel classname="FinishPanel"/&gt;
+		&lt;panel classname="HelloPanel" id="helloPanel"/&gt;
+		&lt;panel classname="HTMLLicencePanel" id="htmlLicensePanel"/&gt;
+		&lt;panel classname="TargetPanel" id="targetPanel"/&gt;
+		&lt;panel classname="PacksPanel" id="packsPanel"/&gt;
+		&lt;panel classname="InstallPanel" id="installPanel"/&gt;
+		&lt;panel classname="ShortcutPanel" id="shortcutPanel"/&gt;
+		&lt;panel classname="HTMLInfoPanel" id="htmlInfoPanel"/&gt;
+		&lt;panel classname="FinishPanel" id="finishPanel"/&gt;
 	&lt;/panels&gt;
 	
 	&lt;!-- =================================================================================== --&gt;
@@ -129,6 +129,20 @@
 		&lt;/pack&gt;
 		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+
+		&lt;pack name="Sample metadata" required="no" preselected="yes" id="idSampleM"&gt;
+			&lt;description&gt;Import sample metadata for testing&lt;/description&gt;
+			&lt;executable targetfile="$INSTALL_PATH/gast/gast.jar" 
+							type      ="jar" 
+							keep      ="true"
+							stage     ="postinstall"&gt;
+				&lt;args&gt;
+					&lt;arg value="-sampleData"/&gt;
+				&lt;/args&gt;
+			&lt;/executable&gt;
+		&lt;/pack&gt;		
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
 		
 		&lt;pack name="GeoServer web map server" required="no" preselected="yes"&gt;
 			&lt;description&gt;GeoServer is an Open Source server that connects your information 

Modified: trunk/installer/installer-config.xml
===================================================================
--- trunk/installer/installer-config.xml	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/installer/installer-config.xml	2008-04-08 07:39:33 UTC (rev 1250)
@@ -26,6 +26,7 @@
 			&lt;os family="windows"/&gt;
 			&lt;os family="mac"/&gt;
 		&lt;/laf&gt;
+		&lt;modifier value="true" key="showDebugWindow" /&gt;
 	&lt;/guiprefs&gt;
 	
 	&lt;!-- =================================================================================== --&gt;
@@ -48,14 +49,14 @@
 	&lt;!-- =================================================================================== --&gt;
 	
 	&lt;panels&gt;
-		&lt;panel classname="HelloPanel"/&gt;
-		&lt;panel classname="HTMLLicencePanel"/&gt;
-		&lt;panel classname="TargetPanel"/&gt;
-		&lt;panel classname="PacksPanel"/&gt;
-		&lt;panel classname="InstallPanel"/&gt;
-		&lt;panel classname="ShortcutPanel"/&gt;
-		&lt;panel classname="HTMLInfoPanel"/&gt;
-		&lt;panel classname="FinishPanel"/&gt;
+		&lt;panel classname="HelloPanel" id="helloPanel"/&gt;
+		&lt;panel classname="HTMLLicencePanel" id="htmlLicensePanel"/&gt;
+		&lt;panel classname="TargetPanel" id="targetPanel"/&gt;
+		&lt;panel classname="PacksPanel" id="packsPanel"/&gt;
+		&lt;panel classname="InstallPanel" id="installPanel"/&gt;
+		&lt;panel classname="ShortcutPanel" id="shortcutPanel"/&gt;
+		&lt;panel classname="HTMLInfoPanel" id="htmlInfoPanel"/&gt;
+		&lt;panel classname="FinishPanel" id="finishPanel"/&gt;
 	&lt;/panels&gt;
 	
 	&lt;!-- =================================================================================== --&gt;
@@ -128,6 +129,20 @@
 		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
 		
+		&lt;pack name="Sample metadata" required="no" preselected="yes" id="idSampleM"&gt;
+			&lt;description&gt;Import sample metadata for testing&lt;/description&gt;
+			&lt;executable targetfile="$INSTALL_PATH/gast/gast.jar" 
+							type      ="jar" 
+							keep      ="true"
+							stage     ="postinstall"&gt;
+				&lt;args&gt;
+					&lt;arg value="-sampleData"/&gt;
+				&lt;/args&gt;
+			&lt;/executable&gt;
+		&lt;/pack&gt;		
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+		
 		&lt;pack name="GeoServer web map server" required="no" preselected="yes"&gt;
 			&lt;description&gt;GeoServer is an Open Source server that connects your information 
 to the Geospatial Web. This embedded version is setup to provide the base layers 

Modified: trunk/installer/readme-install.txt
===================================================================
--- trunk/installer/readme-install.txt	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/installer/readme-install.txt	2008-04-08 07:39:33 UTC (rev 1250)
@@ -9,6 +9,10 @@
 
 <a href="http://java.sun.com/javase/downloads/index_jdk5.jsp" target="_new">http://java.sun.com/javase/downloads/index_jdk5.jsp</a>
 
+Please refer to the changes.txt file for a list of known issues.
+Refer to the online documentation or mailing-lists if you need 
+more help at <a href="http://geonetwork-opensource.org" target="_new">http://geonetwork-opensource.org</a>
+ 
 ==================================================================
 WINDOWS USERS
 ==================================================================

Modified: trunk/src/org/fao/gast/cli/Cli.java
===================================================================
--- trunk/src/org/fao/gast/cli/Cli.java	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/src/org/fao/gast/cli/Cli.java	2008-04-08 07:39:33 UTC (rev 1250)
@@ -28,6 +28,7 @@
 import org.fao.gast.boot.Starter;
 import org.fao.gast.cli.createdb.CreateDB;
 import org.fao.gast.cli.setup.Setup;
+import org.fao.gast.cli.sampledata.SampleData;
 import org.fao.gast.lib.Lib;
 
 //==============================================================================
@@ -51,13 +52,16 @@
 		if (command.equals("-setup"))
 			new Setup().exec(appPath, al);
 
-		if (command.equals("-setupdb"))
+		else if (command.equals("-sampleData"))
+            new SampleData().exec(appPath, al);
+
+        else if (command.equals("-setupdb"))
 			new CreateDB().exec(appPath, al);
 
-		else
+        else
 		{
-			System.out.println("Unknown command : "+ command);
-			System.out.println("Can be one of : -setup, -setupdb");
+			Lib.log.warning("Unknown command : "+ command);
+			Lib.log.warning("Can be one of : -setup, -setupdb, -sampleData");
 		}
 	}
 }

Added: trunk/src/org/fao/gast/cli/sampledata/SampleData.java
===================================================================
--- trunk/src/org/fao/gast/cli/sampledata/SampleData.java	                        (rev 0)
+++ trunk/src/org/fao/gast/cli/sampledata/SampleData.java	2008-04-08 07:39:33 UTC (rev 1250)
@@ -0,0 +1,94 @@
+//==============================================================================
+//===	Copyright (C) 2001-2007 Food and Agriculture Organization of the
+//===	United Nations (FAO-UN), United Nations World Food Programme (WFP)
+//===	and United Nations Environment Programme (UNEP)
+//===
+//===	This program is free software; you can redistribute it and/or modify
+//===	it under the terms of the GNU General Public License as published by
+//===	the Free Software Foundation; either version 2 of the License, or (at
+//===	your option) any later version.
+//===
+//===	This program is distributed in the hope that it will be useful, but
+//===	WITHOUT ANY WARRANTY; without even the implied warranty of
+//===	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+//===	General Public License for more details.
+//===
+//===	You should have received a copy of the GNU General Public License
+//===	along with this program; if not, write to the Free Software
+//===	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+//===
+//===	Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
+//===	Rome - Italy. email: geonetwork@...
+//==============================================================================
+
+package org.fao.gast.cli.sampledata;
+
+import java.io.File;
+import java.util.List;
+import jeeves.resources.dbms.Dbms;
+import org.fao.gast.lib.Lib;
+import org.fao.gast.lib.Resource;
+
+//==============================================================================
+
+public class SampleData
+{
+	public void exec(String appPath, List&lt;String&gt; args) throws Exception
+	{
+		//--- install sample data
+	    addSampleData(appPath);			
+	}
+
+	//---------------------------------------------------------------------------
+
+	private void addSampleData(String appPath) throws Exception
+	{
+		Lib.log.info("Adding sample metadata");
+
+		Resource resource = Lib.config.createResource();
+		Dbms     dbms     = (Dbms) resource.open();
+
+		try
+		{
+			int serial = Lib.database.getNextSerial(dbms, "Metadata");
+			dbms.commit();
+
+			File   sampleDir = new File(appPath, SAMPLE_PATH);
+			File[] samples   = sampleDir.listFiles();
+
+			if (samples == null)
+				Lib.log.warning("Cannot scan directory : "+ sampleDir.getAbsolutePath());
+			else
+			{
+				for (File sample : samples)
+					if (sample.getName().endsWith(".mef"))
+					{
+						Lib.mef.doImport(dbms, serial++, sample);
+						dbms.commit();
+					}
+			}
+
+			Lib.log.info("Synchronizing metadata");
+			Lib.metadata.sync(dbms);
+			resource.close();
+			Lib.log.info("Done");
+		}
+		catch(Exception e)
+		{
+			Lib.log.fatal("Raised exception : "+ e.getMessage());
+			resource.abort();
+			throw e;
+		}
+	}
+
+	//---------------------------------------------------------------------------
+	//---
+	//--- Variables
+	//---
+	//---------------------------------------------------------------------------
+
+	private static final String SAMPLE_PATH = "gast/setup/sample-data";
+}
+
+//==============================================================================
+

Modified: trunk/src/org/fao/gast/cli/setup/Setup.java
===================================================================
--- trunk/src/org/fao/gast/cli/setup/Setup.java	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/src/org/fao/gast/cli/setup/Setup.java	2008-04-08 07:39:33 UTC (rev 1250)
@@ -55,63 +55,9 @@
 
 		Resource resource  = Lib.config.createResource();
 		Lib.database.setup(resource, null);
-
-		//--- ask for and install sample metadata
-
-		if (Lib.gui.confirm(null, SAMPLE_MSG))
-			addSampleData(appPath);
+			
 	}
 
-	//---------------------------------------------------------------------------
-
-	private void addSampleData(String appPath) throws Exception
-	{
-		Lib.log.info("Adding sample metadata");
-
-		Resource resource = Lib.config.createResource();
-		Dbms     dbms     = (Dbms) resource.open();
-
-		try
-		{
-			int serial = Lib.database.getNextSerial(dbms, "Metadata");
-			dbms.commit();
-
-			File   sampleDir = new File(appPath, SAMPLE_PATH);
-			File[] samples   = sampleDir.listFiles();
-
-			if (samples == null)
-				Lib.log.warning("Cannot scan directory : "+ sampleDir.getAbsolutePath());
-			else
-			{
-				for (File sample : samples)
-					if (sample.getName().endsWith(".mef"))
-					{
-						Lib.mef.doImport(dbms, serial++, sample);
-						dbms.commit();
-					}
-			}
-
-			Lib.log.info("Synchronizing metadata");
-			Lib.metadata.sync(dbms);
-			resource.close();
-			Lib.log.info("Done");
-		}
-		catch(Exception e)
-		{
-			Lib.log.fatal("Raised exception : "+ e.getMessage());
-			resource.abort();
-			throw e;
-		}
-	}
-
-	//---------------------------------------------------------------------------
-	//---
-	//--- Variables
-	//---
-	//---------------------------------------------------------------------------
-
-	private static final String SAMPLE_MSG  = "Do you want to install sample metadata ?";
-	private static final String SAMPLE_PATH = "gast/setup/sample-data";
 }
 
 //==============================================================================

Modified: trunk/src/org/wfp/vam/intermap/kernel/map/images/ImageMerger.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/kernel/map/images/ImageMerger.java	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/src/org/wfp/vam/intermap/kernel/map/images/ImageMerger.java	2008-04-08 07:39:33 UTC (rev 1250)
@@ -49,6 +49,8 @@
 import java.util.List;
 import java.util.Vector;
 import javax.swing.ImageIcon;
+import org.wfp.vam.intermap.Constants;
+import jeeves.utils.Log;
 
 public class ImageMerger {
 	static public final int JPG = 0;
@@ -101,9 +103,9 @@
 					catch (IOException e)
 					{
 						if (e.getMessage() == "too many colors for a GIF")
-							System.out.println("too many colors for a GIF, will try to generate JPG");
+						    Log.debug(Constants.INTERMAP,"too many colors for a GIF, will try to generate JPG");
 						else
-							System.out.println("error in encoding GIF file: " + e.getMessage() + "; will try to generate a JPG");
+						    Log.debug(Constants.INTERMAP,"error in encoding GIF file: " + e.getMessage() + "; will try to generate a JPG");
 
 						encodeJPG(os, bi);
 					}
@@ -117,7 +119,7 @@
 					}
 					catch (IOException e)
 					{
-						System.out.println("error in encoding PNG file: " + e.getMessage() + "; will try to generate a JPG");
+					    Log.debug(Constants.INTERMAP,"error in encoding PNG file: " + e.getMessage() + "; will try to generate a JPG");
 						encodeJPG(os, bi);
 					}
 			}
@@ -294,7 +296,7 @@
 //				alpha = 1F;
 //			}
 
-//			System.out.println("i: " + i + "; alpha: " + alpha); // DEBUG
+//			Log.debug(Constants.INTERMAP,"i: " + i + "; alpha: " + alpha); // DEBUG
 			destG.setComposite(AlphaComposite.getInstance(rule, alpha));
 			destG.drawImage(image, 0, 0, null);
 		}
@@ -338,7 +340,7 @@
 		destG.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC, alpha));
 		destG.drawImage(base, 0, 0, null);
 
-		System.out.println("Compositing images ("+ow+","+oh+") over ("+bw+","+bh+") @"+x+"+"+y);
+		Log.debug(Constants.INTERMAP,"Compositing images ("+ow+","+oh+") over ("+bw+","+bh+") @"+x+"+"+y);
 
 		// negative position starts from lower right corner, with -1 being aligned to the border
 		if(x&lt;0)
@@ -347,7 +349,7 @@
 		if(y&lt;0)
 			y = bh - oh + y+1;
 
-		System.out.println("                   @"+x+"+"+y);
+		Log.debug(Constants.INTERMAP,"                   @"+x+"+"+y);
 		destG.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, alpha));
 		destG.drawImage(over, x, y, null);
 
@@ -389,7 +391,7 @@
 
 	public static void main(String args[]) {
 		if (args.length &lt; 2) {
-			System.out.println("Usage: ImageMerger destFile srcFile1 ...\n");
+		    Log.debug(Constants.INTERMAP,"Usage: ImageMerger destFile srcFile1 ...\n");
 			System.exit(1);
 		}
 

Modified: trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/WmsService.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/WmsService.java	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/WmsService.java	2008-04-08 07:39:33 UTC (rev 1250)
@@ -155,7 +155,7 @@
         else
             request += "&amp;STYLES=";
 
-        Log.debug(Constants.INTERMAP," - GetMap request : "+ request);
+        Log.debug(Constants.WMS," - GetMap request : "+ request);
 
 		return request;
 	}
@@ -202,7 +202,7 @@
 				+ "&amp;INFO_FORMAT=" + infoFormat
 				+ "&amp;STYLES=" + _styleName;
 		
-		Log.debug(Constants.INTERMAP," - GetFeatureInfo request : "+ url);
+		Log.debug(Constants.WMS," - GetFeatureInfo request : "+ url);
 		
 		lastResponse = new Element("url").setText(url);
 

Modified: trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/schema/type/WMSFormat.java
===================================================================
--- trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/schema/type/WMSFormat.java	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/src/org/wfp/vam/intermap/kernel/map/mapServices/wms/schema/type/WMSFormat.java	2008-04-08 07:39:33 UTC (rev 1250)
@@ -26,6 +26,8 @@
 import java.util.ArrayList;
 import java.util.List;
 import org.jdom.Element;
+import org.wfp.vam.intermap.Constants;
+import jeeves.utils.Log;
 
 /**
  * @author ETj
@@ -51,7 +53,6 @@
 	,APP_WMS("application/vnd.ogc.wms_xml")
 	,APP_WMSERR("application/vnd.ogc.se_xml")
 
-
 	,v100_GIF("GIF")
 	,v100_JPEG("JPEG")
 	,v100_PNG("PNG")
@@ -87,7 +88,7 @@
 		for(WMSFormat format: WMSFormat.values())
 			if(format.toString().equals(type))
 				return format;
-		System.out.println("WARNING: WMSFormat: type '"+type+"' is not defined internally. Please update the internal mimetype list.");
+		Log.debug(Constants.WMS,"WARNING: WMSFormat: type '"+type+"' is not defined internally. Please update the internal mimetype list.");
 		return null;
 	}
 

Modified: trunk/web/intermap/xsl/im_get-services-embedded.xsl
===================================================================
--- trunk/web/intermap/xsl/im_get-services-embedded.xsl	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/web/intermap/xsl/im_get-services-embedded.xsl	2008-04-08 07:39:33 UTC (rev 1250)
@@ -254,7 +254,15 @@
 					&lt;xsl:otherwise&gt;
 						&lt;!-- It's a layer group --&gt;
 						&lt;li class="layer_group"&gt;
-							&lt;b&gt;&lt;xsl:value-of select="Title" /&gt;&lt;/b&gt;
+							&lt;xsl:choose&gt;
+								&lt;xsl:when test="./Name"&gt;
+									&lt;b&gt;&lt;xsl:apply-templates select="." mode="title"/&gt;&lt;/b&gt;
+								&lt;/xsl:when&gt;
+								&lt;xsl:otherwise&gt;
+									&lt;b&gt;&lt;xsl:value-of select="Title" /&gt;&lt;/b&gt;
+								&lt;/xsl:otherwise&gt;
+							&lt;/xsl:choose&gt;
+							
 						&lt;/li&gt;
 						&lt;ul&gt;
 							&lt;xsl:apply-templates select="Layer"&gt;

Modified: trunk/web/intermap/xsl/im_get-services.xsl
===================================================================
--- trunk/web/intermap/xsl/im_get-services.xsl	2008-04-04 15:51:52 UTC (rev 1249)
+++ trunk/web/intermap/xsl/im_get-services.xsl	2008-04-08 07:39:33 UTC (rev 1250)
@@ -1,320 +1,327 @@
-&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-&lt;?xmlspysamplexml D:\temp\WMS_Capabilities.xml?&gt;
-&lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>" xmlns:xlink="<a href="http://www.w3.org/1999/xlink" target="_new">http://www.w3.org/1999/xlink</a>"&gt;
-	
-	&lt;xsl:include href="main.xsl"/&gt;
-	
-	&lt;!-- Main template --&gt;
-	&lt;xsl:template match="/"&gt;
-		&lt;html&gt;
-			&lt;head&gt;
-				&lt;title&gt;
-					&lt;xsl:value-of select="/root/gui/strings/title"/&gt;
-				&lt;/title&gt;
-				&lt;link rel="stylesheet" type="text/css" href="../../intermap.css"/&gt;
-				&lt;script language="JavaScript" src="../../scripts/intermap.js"/&gt;
-				&lt;script language="javascript"&gt;
-				function getWmsLayerInfo(name) {
-					window.open(('&lt;xsl:value-of select="/root/gui/locService" /&gt;/map.service.wmsLayerInfo?url=&lt;xsl:value-of select="/root/response/url"/&gt;&amp;amp;name=' + name).unescapeHTML(), 'dialog', 'HEIGHT=300,WIDTH=400,scrollbars=yes,toolbar=no,status=no,menubar=no,location=no,resizable=yes').focus();
-				}
-			&lt;/script&gt;
-			&lt;/head&gt;
-			&lt;body&gt;
-				&lt;xsl:call-template name="formLayout"&gt;
-					&lt;xsl:with-param name="title" select="/root/gui/strings/choosemapfromlist"/&gt;
-					&lt;xsl:with-param name="content"&gt;
-						&lt;xsl:copy-of select="/root/gui/strings/feedbackTopics"/&gt;
-						&lt;p/&gt;
-						&lt;form action="{/root/gui/locService}/map.addServices" method="post" name="form"&gt;
-							&lt;table&gt;
-								&lt;tr&gt;
-									&lt;td&gt;
-										&lt;xsl:apply-templates select="/root/response/ARCXML/RESPONSE/SERVICES"/&gt;
-										&lt;!-- ArcIMS --&gt;
-										&lt;xsl:apply-templates select="//WMT_MS_Capabilities/Service"/&gt;
-										&lt;!-- WMS --&gt;
-										&lt;xsl:apply-templates select="//Capability/Layer"&gt;
-											&lt;xsl:with-param name="first"&gt;true&lt;/xsl:with-param&gt;
-										&lt;/xsl:apply-templates&gt;
-									&lt;/td&gt;
-								&lt;/tr&gt;
-							&lt;/table&gt;
-							&lt;input type="hidden" name="url" value="{/root/response/url}"/&gt;
-							&lt;input type="hidden" name="type" value="{/root/response/type}"/&gt;
-						&lt;/form&gt;
-					&lt;/xsl:with-param&gt;
-					&lt;xsl:with-param name="buttons"&gt;
-						&lt;button class="content" onclick="document.form.action='{/root/gui/locService}/map.getMain';document.form.submit();"&gt;&lt;xsl:value-of select="/root/gui/strings/cancel"/&gt;&lt;/button&gt;
-						&amp;#160;
-						&lt;button class="content" onclick="document.form.submit();"&gt;&lt;xsl:value-of select="/root/gui/strings/ok"/&gt;&lt;/button&gt;
-					&lt;/xsl:with-param&gt;
-				&lt;/xsl:call-template&gt;
-			&lt;/body&gt;
-		&lt;/html&gt;
-	&lt;/xsl:template&gt;
-	
-	&lt;!-- ArcIMS Services --&gt;
-	&lt;xsl:template match="/root/response/ARCXML/RESPONSE/SERVICES"&gt;
-		&lt;tr&gt;
-			&lt;td&gt;
-				&lt;b&gt;
-					&lt;xsl:value-of select="count(SERVICE[@type='ImageServer'])"/&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="/root/gui/strings/mapsfound"/&gt;
-				&lt;/b&gt;
-			&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td&gt;
-				&lt;select name="service" multiple="multiple" size="20"&gt;
-					&lt;xsl:for-each select="SERVICE[@type='ImageServer']"&gt;
-						&lt;xsl:sort select="@name"/&gt;
-						&lt;option value="{@name}"&gt;
-							&lt;xsl:value-of select="@name"/&gt;
-						&lt;/option&gt;
-					&lt;/xsl:for-each&gt;
-				&lt;/select&gt;
-			&lt;/td&gt;
-		&lt;/tr&gt;
-	&lt;/xsl:template&gt;
-	
-	&lt;!-- WMS service informations --&gt;
-	&lt;xsl:template match="//WMT_MS_Capabilities/Service"&gt;
-		&lt;h2&gt;
-			&lt;xsl:value-of select="Title"/&gt;
-		&lt;/h2&gt;
-		&lt;!-- Abstract --&gt;
-		&lt;xsl:if test="Abstract"&gt;
-			&lt;p&gt;
-				&lt;b&gt;
-					&lt;xsl:value-of select="/root/gui/strings/abstract"/&gt;
-				&lt;/b&gt;
-				&lt;xsl:text&gt; &lt;/xsl:text&gt;
-				&lt;xsl:value-of select="Abstract"/&gt;
-			&lt;/p&gt;
-		&lt;/xsl:if&gt;
-		&lt;!-- Keywords --&gt;
-		&lt;xsl:if test="KeywordList"&gt;
-			&lt;p&gt;
-				&lt;b&gt;
-					&lt;xsl:value-of select="/root/gui/strings/keywords"/&gt;
-				&lt;/b&gt;
-				&lt;xsl:text&gt; &lt;/xsl:text&gt;
-				&lt;xsl:variable name="keywords"&gt;
-					&lt;xsl:for-each select="KeywordList/Keyword"&gt;
-						&lt;xsl:value-of select="."/&gt;
-						&lt;xsl:text&gt;, &lt;/xsl:text&gt;
-					&lt;/xsl:for-each&gt;
-				&lt;/xsl:variable&gt;
-				&lt;xsl:value-of select="substring($keywords, 1, string-length($keywords) - 2)"/&gt;
-			&lt;/p&gt;
-		&lt;/xsl:if&gt;
-
-		&lt;!-- Online resource --&gt;
-		&lt;p&gt;
-			&lt;b&gt;
-				&lt;xsl:value-of select="/root/gui/strings/homepage"/&gt;
-			&lt;/b&gt;
-			&lt;xsl:text&gt; &lt;/xsl:text&gt;
-			&lt;xsl:variable name="geonetwork" select="OnlineResource/@xlink:href"/&gt;
-			&lt;xsl:choose&gt;
-				&lt;xsl:when test="contains($geonetwork,'geonetwork')"&gt;
-					&lt;a href="javascript:openGeoNetwork('{OnlineResource/@xlink:href}');"&gt;
-						&lt;xsl:value-of select="OnlineResource/@xlink:href"/&gt;
-					&lt;/a&gt;
-				&lt;/xsl:when&gt;
-				&lt;xsl:otherwise&gt;
-					&lt;a href="javascript:openPage('{OnlineResource/@xlink:href}','Attribution');"&gt;
-						&lt;xsl:value-of select="OnlineResource/@xlink:href"/&gt;
-					&lt;/a&gt;
-				&lt;/xsl:otherwise&gt;
-			&lt;/xsl:choose&gt;
-		&lt;/p&gt;
-
-		&lt;!-- Contact information --&gt;
-		&lt;xsl:if test="ContactInformation"&gt;
-			&lt;p&gt;
-				&lt;b&gt;
-					&lt;xsl:value-of select="/root/gui/strings/contactInfo"/&gt;
-				&lt;/b&gt;
-				&lt;br/&gt;
-				&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
-				&lt;!-- Contact person --&gt;
-				&lt;xsl:if test="ContactInformation/ContactPersonPrimary/ContactPerson"&gt;
-					&lt;b&gt;
-						&lt;xsl:value-of select="/root/gui/strings/contactPerson"/&gt;
-					&lt;/b&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="ContactInformation/ContactPersonPrimary/ContactPerson"/&gt;
-				&lt;/xsl:if&gt;
-				&lt;!-- Contact organization --&gt;
-				&lt;xsl:if test="ContactInformation/ContactPersonPrimary/ContactOrganization"&gt;
-				(&lt;xsl:value-of select="ContactInformation/ContactPersonPrimary/ContactOrganization"/&gt;)
-			&lt;/xsl:if&gt;
-				&lt;!-- Contact position --&gt;
-				&lt;xsl:if test="ContactInformation/ContactPosition"&gt;
-					&lt;br/&gt;
-					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
-					&lt;b&gt;
-						&lt;xsl:value-of select="/root/gui/strings/position"/&gt;
-					&lt;/b&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="ContactInformation/ContactPosition"/&gt;
-				&lt;/xsl:if&gt;
-				&lt;!-- Contact address --&gt;
-				&lt;xsl:if test="ContactInformation/ContactAddress"&gt;
-					&lt;br/&gt;
-					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
-					&lt;b&gt;
-						&lt;xsl:value-of select="/root/gui/strings/address"/&gt;
-					&lt;/b&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="ContactInformation/ContactAddress/Address"/&gt;
-					&lt;xsl:text&gt;, &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="ContactInformation/ContactAddress/City"/&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="ContactInformation/ContactAddress/StateOrProvince"/&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="ContactInformation/ContactAddress/PostCode"/&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="ContactInformation/ContactAddress/Country"/&gt;
-				&lt;/xsl:if&gt;
-				&lt;!-- Contact telephone --&gt;
-				&lt;xsl:if test="ContactInformation/ContactVoiceTelephone"&gt;
-					&lt;br/&gt;
-					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
-					&lt;b&gt;
-						&lt;xsl:value-of select="/root/gui/strings/telephone"/&gt;
-					&lt;/b&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="ContactInformation/ContactVoiceTelephone"/&gt;
-				&lt;/xsl:if&gt;
-				&lt;!-- Contact fax --&gt;
-				&lt;xsl:if test="ContactInformation/ContactFacsimileTelephone"&gt;
-					&lt;br/&gt;
-					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
-					&lt;b&gt;Fax:&lt;/b&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;xsl:value-of select="ContactInformation/ContactFacsimileTelephone"/&gt;
-				&lt;/xsl:if&gt;
-				&lt;!-- Contact email --&gt;
-				&lt;xsl:if test="ContactInformation/ContactElectronicMailAddress"&gt;
-					&lt;br/&gt;
-					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
-					&lt;b&gt;
-						&lt;xsl:value-of select="/root/gui/strings/email"/&gt;
-					&lt;/b&gt;
-					&lt;xsl:text&gt; &lt;/xsl:text&gt;
-					&lt;a&gt;
-						&lt;xsl:attribute name="href"&gt;&lt;xsl:text&gt;mailto:&lt;/xsl:text&gt;&lt;xsl:value-of select="ContactInformation/ContactElectronicMailAddress"/&gt;&lt;/xsl:attribute&gt;
-						&lt;xsl:value-of select="ContactInformation/ContactElectronicMailAddress"/&gt;
-					&lt;/a&gt;
-				&lt;/xsl:if&gt;
-			&lt;/p&gt;
-		&lt;/xsl:if&gt;
-		&lt;hr width="90%"/&gt;
-	&lt;/xsl:template&gt;
-	
-	&lt;!-- WMS Services --&gt;
-	&lt;xsl:template match="Layer"&gt;
-		&lt;xsl:param name="first"/&gt;
-		&lt;xsl:choose&gt;
-			&lt;xsl:when test="$first='true'"&gt;
-				&lt;!-- First level --&gt;
-				&lt;xsl:choose&gt;
-					&lt;xsl:when test="not(Layer)"&gt;
-						&lt;!-- It's a layer --&gt;
-						&lt;xsl:apply-templates select="." mode="title"/&gt;
-					&lt;/xsl:when&gt;
-					&lt;xsl:otherwise&gt;
-						&lt;!-- It's a layer group --&gt;
-						&lt;b&gt;
-							&lt;xsl:value-of select="Title"/&gt;
-						&lt;/b&gt;
-						&lt;ul&gt;
-							&lt;xsl:apply-templates select="Layer"&gt;
-								&lt;!-- Recursively apply this template --&gt;
-								&lt;xsl:with-param name="first" select="false"/&gt;
-							&lt;/xsl:apply-templates&gt;
-						&lt;/ul&gt;
-					&lt;/xsl:otherwise&gt;
-				&lt;/xsl:choose&gt;
-			&lt;/xsl:when&gt;
-			&lt;xsl:otherwise&gt;
-				&lt;!-- Other levels --&gt;
-				&lt;xsl:choose&gt;
-					&lt;xsl:when test="not(Layer)"&gt;
-						&lt;!-- It's a layer --&gt;
-						&lt;li&gt;
-							&lt;xsl:apply-templates select="." mode="title"/&gt;
-						&lt;/li&gt;
-					&lt;/xsl:when&gt;
-					&lt;xsl:otherwise&gt;
-						&lt;!-- It's a layer group --&gt;
-						&lt;li class="layer_group"&gt;
-							&lt;b&gt;&lt;xsl:value-of select="Title" /&gt;&lt;/b&gt;
-						&lt;/li&gt;
-						&lt;ul&gt;
-							&lt;xsl:apply-templates select="Layer"&gt;
-								&lt;!-- Recursively apply this template --&gt;
-								&lt;xsl:with-param name="first" select="false"/&gt;
-							&lt;/xsl:apply-templates&gt;
-						&lt;/ul&gt;
-					&lt;/xsl:otherwise&gt;
-				&lt;/xsl:choose&gt;
-			&lt;/xsl:otherwise&gt;
-		&lt;/xsl:choose&gt;
-	&lt;/xsl:template&gt;
-	
-	&lt;!-- WMS layers title --&gt;
-	&lt;xsl:template match="Layer" mode="title"&gt;
-		&lt;input type="checkbox" name="service" value="{Name}"&gt;&lt;/input&gt;
-		&lt;xsl:value-of select="Title"/&gt;
-		&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&lt;/xsl:text&gt;
-		&lt;xsl:choose&gt;
-			&lt;xsl:when test="MetadataURL"&gt;
-			&lt;xsl:variable name="met" select="MetadataURL/OnlineResource/@xlink:href"/&gt;
-			&lt;xsl:choose&gt;
-				&lt;xsl:when test="contains($met,'geonetwork')"&gt;
-					&lt;a&gt;
-						&lt;xsl:attribute name="href"&gt;javascript:openGeoNetwork('&lt;xsl:value-of select="MetadataURL/OnlineResource/@xlink:href"/&gt;');&lt;/xsl:attribute&gt;
-						&lt;xsl:value-of select="/root/gui/strings/metadata"/&gt;
-					&lt;/a&gt;
-				&lt;/xsl:when&gt;
-				&lt;xsl:otherwise&gt;
-					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
-					&lt;a&gt;
-						&lt;xsl:attribute name="href"&gt;javascript:openPage('&lt;xsl:value-of select="MetadataURL/OnlineResource/@xlink:href"/&gt;','Metadata');&lt;/xsl:attribute&gt;
-						&lt;xsl:value-of select="/root/gui/strings/metadata"/&gt;
-					&lt;/a&gt;
-				&lt;/xsl:otherwise&gt;
-			&lt;/xsl:choose&gt;
-			&lt;/xsl:when&gt;
-			&lt;xsl:when test="Abstract"&gt;
-				&lt;a href="javascript:getWmsLayerInfo('{Name}')"&gt;
-					&lt;img id="info" src="{/root/gui/url}/images/im_info.gif" /&gt;
-				&lt;/a&gt;
-			&lt;/xsl:when&gt;
-		&lt;/xsl:choose&gt;
-		&lt;xsl:if test="Attribution"&gt;
-			&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&lt;/xsl:text&gt;
-			&lt;xsl:choose&gt;
-				&lt;xsl:when test="Attribution/OnlineResource | Attribution/LogoURL"&gt;
-					&lt;a&gt;
-						&lt;xsl:attribute name="href"&gt;javascript:openPage('&lt;xsl:value-of select="Attribution/OnlineResource/@xlink:href"/&gt;','Attribution');&lt;/xsl:attribute&gt;
-						&lt;img alt="{Attribution/Title}" src="{Attribution/LogoURL/OnlineResource/@xlink:href}" title="{Attribution/Title}"  border="0" align="middle" /&gt;
-					&lt;/a&gt;
-				&lt;/xsl:when&gt;
-				&lt;xsl:when test="Attribution/OnlineResource"&gt;
-					&lt;a&gt;
-						&lt;xsl:attribute name="href"&gt;
-							&lt;xsl:value-of select="Attribution/OnlineResource/@xlink:href"/&gt;
-						&lt;/xsl:attribute&gt;
-						&lt;xsl:value-of select="Attribution/Title"/&gt;
-					&lt;/a&gt;
-				&lt;/xsl:when&gt;
-			&lt;/xsl:choose&gt;
-		&lt;/xsl:if&gt;
-
-	&lt;/xsl:template&gt;
-&lt;/xsl:stylesheet&gt;
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;?xmlspysamplexml D:\temp\WMS_Capabilities.xml?&gt;
+&lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>" xmlns:xlink="<a href="http://www.w3.org/1999/xlink" target="_new">http://www.w3.org/1999/xlink</a>"&gt;
+	
+	&lt;xsl:include href="main.xsl"/&gt;
+	
+	&lt;!-- Main template --&gt;
+	&lt;xsl:template match="/"&gt;
+		&lt;html&gt;
+			&lt;head&gt;
+				&lt;title&gt;
+					&lt;xsl:value-of select="/root/gui/strings/title"/&gt;
+				&lt;/title&gt;
+				&lt;link rel="stylesheet" type="text/css" href="../../intermap.css"/&gt;
+				&lt;script language="JavaScript" src="../../scripts/intermap.js"/&gt;
+				&lt;script language="javascript"&gt;
+				function getWmsLayerInfo(name) {
+					window.open(('&lt;xsl:value-of select="/root/gui/locService" /&gt;/map.service.wmsLayerInfo?url=&lt;xsl:value-of select="/root/response/url"/&gt;&amp;amp;name=' + name).unescapeHTML(), 'dialog', 'HEIGHT=300,WIDTH=400,scrollbars=yes,toolbar=no,status=no,menubar=no,location=no,resizable=yes').focus();
+				}
+			&lt;/script&gt;
+			&lt;/head&gt;
+			&lt;body&gt;
+				&lt;xsl:call-template name="formLayout"&gt;
+					&lt;xsl:with-param name="title" select="/root/gui/strings/choosemapfromlist"/&gt;
+					&lt;xsl:with-param name="content"&gt;
+						&lt;xsl:copy-of select="/root/gui/strings/feedbackTopics"/&gt;
+						&lt;p/&gt;
+						&lt;form action="{/root/gui/locService}/map.addServices" method="post" name="form"&gt;
+							&lt;table&gt;
+								&lt;tr&gt;
+									&lt;td&gt;
+										&lt;xsl:apply-templates select="/root/response/ARCXML/RESPONSE/SERVICES"/&gt;
+										&lt;!-- ArcIMS --&gt;
+										&lt;xsl:apply-templates select="//WMT_MS_Capabilities/Service"/&gt;
+										&lt;!-- WMS --&gt;
+										&lt;xsl:apply-templates select="//Capability/Layer"&gt;
+											&lt;xsl:with-param name="first"&gt;true&lt;/xsl:with-param&gt;
+										&lt;/xsl:apply-templates&gt;
+									&lt;/td&gt;
+								&lt;/tr&gt;
+							&lt;/table&gt;
+							&lt;input type="hidden" name="url" value="{/root/response/url}"/&gt;
+							&lt;input type="hidden" name="type" value="{/root/response/type}"/&gt;
+						&lt;/form&gt;
+					&lt;/xsl:with-param&gt;
+					&lt;xsl:with-param name="buttons"&gt;
+						&lt;button class="content" onclick="document.form.action='{/root/gui/locService}/map.getMain';document.form.submit();"&gt;&lt;xsl:value-of select="/root/gui/strings/cancel"/&gt;&lt;/button&gt;
+						&amp;#160;
+						&lt;button class="content" onclick="document.form.submit();"&gt;&lt;xsl:value-of select="/root/gui/strings/ok"/&gt;&lt;/button&gt;
+					&lt;/xsl:with-param&gt;
+				&lt;/xsl:call-template&gt;
+			&lt;/body&gt;
+		&lt;/html&gt;
+	&lt;/xsl:template&gt;
+	
+	&lt;!-- ArcIMS Services --&gt;
+	&lt;xsl:template match="/root/response/ARCXML/RESPONSE/SERVICES"&gt;
+		&lt;tr&gt;
+			&lt;td&gt;
+				&lt;b&gt;
+					&lt;xsl:value-of select="count(SERVICE[@type='ImageServer'])"/&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="/root/gui/strings/mapsfound"/&gt;
+				&lt;/b&gt;
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td&gt;
+				&lt;select name="service" multiple="multiple" size="20"&gt;
+					&lt;xsl:for-each select="SERVICE[@type='ImageServer']"&gt;
+						&lt;xsl:sort select="@name"/&gt;
+						&lt;option value="{@name}"&gt;
+							&lt;xsl:value-of select="@name"/&gt;
+						&lt;/option&gt;
+					&lt;/xsl:for-each&gt;
+				&lt;/select&gt;
+			&lt;/td&gt;
+		&lt;/tr&gt;
+	&lt;/xsl:template&gt;
+	
+	&lt;!-- WMS service informations --&gt;
+	&lt;xsl:template match="//WMT_MS_Capabilities/Service"&gt;
+		&lt;h2&gt;
+			&lt;xsl:value-of select="Title"/&gt;
+		&lt;/h2&gt;
+		&lt;!-- Abstract --&gt;
+		&lt;xsl:if test="Abstract"&gt;
+			&lt;p&gt;
+				&lt;b&gt;
+					&lt;xsl:value-of select="/root/gui/strings/abstract"/&gt;
+				&lt;/b&gt;
+				&lt;xsl:text&gt; &lt;/xsl:text&gt;
+				&lt;xsl:value-of select="Abstract"/&gt;
+			&lt;/p&gt;
+		&lt;/xsl:if&gt;
+		&lt;!-- Keywords --&gt;
+		&lt;xsl:if test="KeywordList"&gt;
+			&lt;p&gt;
+				&lt;b&gt;
+					&lt;xsl:value-of select="/root/gui/strings/keywords"/&gt;
+				&lt;/b&gt;
+				&lt;xsl:text&gt; &lt;/xsl:text&gt;
+				&lt;xsl:variable name="keywords"&gt;
+					&lt;xsl:for-each select="KeywordList/Keyword"&gt;
+						&lt;xsl:value-of select="."/&gt;
+						&lt;xsl:text&gt;, &lt;/xsl:text&gt;
+					&lt;/xsl:for-each&gt;
+				&lt;/xsl:variable&gt;
+				&lt;xsl:value-of select="substring($keywords, 1, string-length($keywords) - 2)"/&gt;
+			&lt;/p&gt;
+		&lt;/xsl:if&gt;
+
+		&lt;!-- Online resource --&gt;
+		&lt;p&gt;
+			&lt;b&gt;
+				&lt;xsl:value-of select="/root/gui/strings/homepage"/&gt;
+			&lt;/b&gt;
+			&lt;xsl:text&gt; &lt;/xsl:text&gt;
+			&lt;xsl:variable name="geonetwork" select="OnlineResource/@xlink:href"/&gt;
+			&lt;xsl:choose&gt;
+				&lt;xsl:when test="contains($geonetwork,'geonetwork')"&gt;
+					&lt;a href="javascript:openGeoNetwork('{OnlineResource/@xlink:href}');"&gt;
+						&lt;xsl:value-of select="OnlineResource/@xlink:href"/&gt;
+					&lt;/a&gt;
+				&lt;/xsl:when&gt;
+				&lt;xsl:otherwise&gt;
+					&lt;a href="javascript:openPage('{OnlineResource/@xlink:href}','Attribution');"&gt;
+						&lt;xsl:value-of select="OnlineResource/@xlink:href"/&gt;
+					&lt;/a&gt;
+				&lt;/xsl:otherwise&gt;
+			&lt;/xsl:choose&gt;
+		&lt;/p&gt;
+
+		&lt;!-- Contact information --&gt;
+		&lt;xsl:if test="ContactInformation"&gt;
+			&lt;p&gt;
+				&lt;b&gt;
+					&lt;xsl:value-of select="/root/gui/strings/contactInfo"/&gt;
+				&lt;/b&gt;
+				&lt;br/&gt;
+				&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
+				&lt;!-- Contact person --&gt;
+				&lt;xsl:if test="ContactInformation/ContactPersonPrimary/ContactPerson"&gt;
+					&lt;b&gt;
+						&lt;xsl:value-of select="/root/gui/strings/contactPerson"/&gt;
+					&lt;/b&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="ContactInformation/ContactPersonPrimary/ContactPerson"/&gt;
+				&lt;/xsl:if&gt;
+				&lt;!-- Contact organization --&gt;
+				&lt;xsl:if test="ContactInformation/ContactPersonPrimary/ContactOrganization"&gt;
+				(&lt;xsl:value-of select="ContactInformation/ContactPersonPrimary/ContactOrganization"/&gt;)
+			&lt;/xsl:if&gt;
+				&lt;!-- Contact position --&gt;
+				&lt;xsl:if test="ContactInformation/ContactPosition"&gt;
+					&lt;br/&gt;
+					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
+					&lt;b&gt;
+						&lt;xsl:value-of select="/root/gui/strings/position"/&gt;
+					&lt;/b&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="ContactInformation/ContactPosition"/&gt;
+				&lt;/xsl:if&gt;
+				&lt;!-- Contact address --&gt;
+				&lt;xsl:if test="ContactInformation/ContactAddress"&gt;
+					&lt;br/&gt;
+					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
+					&lt;b&gt;
+						&lt;xsl:value-of select="/root/gui/strings/address"/&gt;
+					&lt;/b&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="ContactInformation/ContactAddress/Address"/&gt;
+					&lt;xsl:text&gt;, &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="ContactInformation/ContactAddress/City"/&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="ContactInformation/ContactAddress/StateOrProvince"/&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="ContactInformation/ContactAddress/PostCode"/&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="ContactInformation/ContactAddress/Country"/&gt;
+				&lt;/xsl:if&gt;
+				&lt;!-- Contact telephone --&gt;
+				&lt;xsl:if test="ContactInformation/ContactVoiceTelephone"&gt;
+					&lt;br/&gt;
+					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
+					&lt;b&gt;
+						&lt;xsl:value-of select="/root/gui/strings/telephone"/&gt;
+					&lt;/b&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="ContactInformation/ContactVoiceTelephone"/&gt;
+				&lt;/xsl:if&gt;
+				&lt;!-- Contact fax --&gt;
+				&lt;xsl:if test="ContactInformation/ContactFacsimileTelephone"&gt;
+					&lt;br/&gt;
+					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
+					&lt;b&gt;Fax:&lt;/b&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;xsl:value-of select="ContactInformation/ContactFacsimileTelephone"/&gt;
+				&lt;/xsl:if&gt;
+				&lt;!-- Contact email --&gt;
+				&lt;xsl:if test="ContactInformation/ContactElectronicMailAddress"&gt;
+					&lt;br/&gt;
+					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
+					&lt;b&gt;
+						&lt;xsl:value-of select="/root/gui/strings/email"/&gt;
+					&lt;/b&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;
+					&lt;a&gt;
+						&lt;xsl:attribute name="href"&gt;&lt;xsl:text&gt;mailto:&lt;/xsl:text&gt;&lt;xsl:value-of select="ContactInformation/ContactElectronicMailAddress"/&gt;&lt;/xsl:attribute&gt;
+						&lt;xsl:value-of select="ContactInformation/ContactElectronicMailAddress"/&gt;
+					&lt;/a&gt;
+				&lt;/xsl:if&gt;
+			&lt;/p&gt;
+		&lt;/xsl:if&gt;
+		&lt;hr width="90%"/&gt;
+	&lt;/xsl:template&gt;
+	
+	&lt;!-- WMS Services --&gt;
+	&lt;xsl:template match="Layer"&gt;
+		&lt;xsl:param name="first"/&gt;
+		&lt;xsl:choose&gt;
+			&lt;xsl:when test="$first='true'"&gt;
+				&lt;!-- First level --&gt;
+				&lt;xsl:choose&gt;
+					&lt;xsl:when test="not(Layer)"&gt;
+						&lt;!-- It's a layer --&gt;
+						&lt;xsl:apply-templates select="." mode="title"/&gt;
+					&lt;/xsl:when&gt;
+					&lt;xsl:otherwise&gt;
+						&lt;!-- It's a layer group --&gt;
+						&lt;b&gt;
+							&lt;xsl:value-of select="Title"/&gt;
+						&lt;/b&gt;
+						&lt;ul&gt;
+							&lt;xsl:apply-templates select="Layer"&gt;
+								&lt;!-- Recursively apply this template --&gt;
+								&lt;xsl:with-param name="first" select="false"/&gt;
+							&lt;/xsl:apply-templates&gt;
+						&lt;/ul&gt;
+					&lt;/xsl:otherwise&gt;
+				&lt;/xsl:choose&gt;
+			&lt;/xsl:when&gt;
+			&lt;xsl:otherwise&gt;
+				&lt;!-- Other levels --&gt;
+				&lt;xsl:choose&gt;
+					&lt;xsl:when test="not(Layer)"&gt;
+						&lt;!-- It's a layer --&gt;
+						&lt;li&gt;
+							&lt;xsl:apply-templates select="." mode="title"/&gt;
+						&lt;/li&gt;
+					&lt;/xsl:when&gt;
+					&lt;xsl:otherwise&gt;
+						&lt;!-- It's a layer group --&gt;
+						&lt;li class="layer_group"&gt;
+							&lt;xsl:choose&gt;
+								&lt;xsl:when test="./Name"&gt;
+									&lt;b&gt;&lt;xsl:apply-templates select="." mode="title"/&gt;&lt;/b&gt;
+								&lt;/xsl:when&gt;
+								&lt;xsl:otherwise&gt;
+									&lt;b&gt;&lt;xsl:value-of select="Title"/&gt;&lt;/b&gt;
+								&lt;/xsl:otherwise&gt;
+							&lt;/xsl:choose&gt;
+						&lt;/li&gt;
+						&lt;ul&gt;
+							&lt;xsl:apply-templates select="Layer"&gt;
+								&lt;!-- Recursively apply this template --&gt;
+								&lt;xsl:with-param name="first" select="false"/&gt;
+							&lt;/xsl:apply-templates&gt;
+						&lt;/ul&gt;
+					&lt;/xsl:otherwise&gt;
+				&lt;/xsl:choose&gt;
+			&lt;/xsl:otherwise&gt;
+		&lt;/xsl:choose&gt;
+	&lt;/xsl:template&gt;
+	
+	&lt;!-- WMS layers title --&gt;
+	&lt;xsl:template match="Layer" mode="title"&gt;
+		&lt;input type="checkbox" name="service" value="{Name}"&gt;&lt;/input&gt;
+		&lt;xsl:value-of select="Title"/&gt;
+		&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&lt;/xsl:text&gt;
+		&lt;xsl:choose&gt;
+			&lt;xsl:when test="MetadataURL"&gt;
+			&lt;xsl:variable name="met" select="MetadataURL/OnlineResource/@xlink:href"/&gt;
+			&lt;xsl:choose&gt;
+				&lt;xsl:when test="contains($met,'geonetwork')"&gt;
+					&lt;a&gt;
+						&lt;xsl:attribute name="href"&gt;javascript:openGeoNetwork('&lt;xsl:value-of select="MetadataURL/OnlineResource/@xlink:href"/&gt;');&lt;/xsl:attribute&gt;
+						&lt;xsl:value-of select="/root/gui/strings/metadata"/&gt;
+					&lt;/a&gt;
+				&lt;/xsl:when&gt;
+				&lt;xsl:otherwise&gt;
+					&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&amp;amp;nbsp;&lt;/xsl:text&gt;
+					&lt;a&gt;
+						&lt;xsl:attribute name="href"&gt;javascript:openPage('&lt;xsl:value-of select="MetadataURL/OnlineResource/@xlink:href"/&gt;','Metadata');&lt;/xsl:attribute&gt;
+						&lt;xsl:value-of select="/root/gui/strings/metadata"/&gt;
+					&lt;/a&gt;
+				&lt;/xsl:otherwise&gt;
+			&lt;/xsl:choose&gt;
+			&lt;/xsl:when&gt;
+			&lt;xsl:when test="Abstract"&gt;
+				&lt;a href="javascript:getWmsLayerInfo('{Name}')"&gt;
+					&lt;img id="info" src="{/root/gui/url}/images/im_info.gif" /&gt;
+				&lt;/a&gt;
+			&lt;/xsl:when&gt;
+		&lt;/xsl:choose&gt;
+		&lt;xsl:if test="Attribution"&gt;
+			&lt;xsl:text disable-output-escaping="yes"&gt;&amp;amp;nbsp;&lt;/xsl:text&gt;
+			&lt;xsl:choose&gt;
+				&lt;xsl:when test="Attribution/OnlineResource | Attribution/LogoURL"&gt;
+					&lt;a&gt;
+						&lt;xsl:attribute name="href"&gt;javascript:openPage('&lt;xsl:value-of select="Attribution/OnlineResource/@xlink:href"/&gt;','Attribution');&lt;/xsl:attribute&gt;
+						&lt;img alt="{Attribution/Title}" src="{Attribution/LogoURL/OnlineResource/@xlink:href}" title="{Attribution/Title}"  border="0" align="middle" /&gt;
+					&lt;/a&gt;
+				&lt;/xsl:when&gt;
+				&lt;xsl:when test="Attribution/OnlineResource"&gt;
+					&lt;a&gt;
+						&lt;xsl:attribute name="href"&gt;
+							&lt;xsl:value-of select="Attribution/OnlineResource/@xlink:href"/&gt;
+						&lt;/xsl:attribute&gt;
+						&lt;xsl:value-of select="Attribution/Title"/&gt;
+					&lt;/a&gt;
+				&lt;/xsl:when&gt;
+			&lt;/xsl:choose&gt;
+		&lt;/xsl:if&gt;
+
+	&lt;/xsl:template&gt;
+&lt;/xsl:stylesheet&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=19122065">[GeoNetwork-commit] SF.net SVN: geonetwork: [1276] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;bluenetdevteam@us...&gt; -	2008-04-15 12:22</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1276
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1276&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1276&amp;view=rev</a>
Author:   bluenetdevteam
Date:     2008-04-15 05:22:27 -0700 (Tue, 15 Apr 2008)

Log Message:
-----------

Accurate positioning after form submit and rebuild in editor

On + form is positioned with added element at top of page
   x form is positioned so that top of page is where element was deleted
	 ^ and v form is positioned so that top of page is above the swapped elements

On file upload/remove in iso, form is positioned at top of onlineResource 
element 

Adjust date and time handling in 19139 and disable broken subtemplates

Modified Paths:
--------------
    trunk/src/org/fao/geonet/constants/Geonet.java
    trunk/src/org/fao/geonet/constants/Params.java
    trunk/src/org/fao/geonet/services/metadata/EditUtils.java
    trunk/web/geonetwork/WEB-INF/config-metadata.xml
    trunk/web/geonetwork/xsl/metadata-edit.xsl
    trunk/web/geonetwork/xsl/metadata-iso19115.xsl
    trunk/web/geonetwork/xsl/metadata-iso19139.xsl
    trunk/web/geonetwork/xsl/metadata.xsl

Added Paths:
-----------
    trunk/src/org/fao/geonet/guiservices/util/GetPositionMD.java

Modified: trunk/src/org/fao/geonet/constants/Geonet.java
===================================================================
--- trunk/src/org/fao/geonet/constants/Geonet.java	2008-04-09 08:11:05 UTC (rev 1275)
+++ trunk/src/org/fao/geonet/constants/Geonet.java	2008-04-15 12:22:27 UTC (rev 1276)
@@ -112,6 +112,7 @@
 		public static final String MAIN_SEARCH				= "main.search";
 		public static final String SEARCH_RESULT			= "search.result";
 		public static final String METADATA_SHOW			= "metadata.show";
+		public static final String METADATA_POSITION  = "metadata.position";
 		public static final String SEARCH_KEYWORDS_RESULT	= "search.keywords.result";
 	}
 

Modified: trunk/src/org/fao/geonet/constants/Params.java
===================================================================
--- trunk/src/org/fao/geonet/constants/Params.java	2008-04-09 08:11:05 UTC (rev 1275)
+++ trunk/src/org/fao/geonet/constants/Params.java	2008-04-15 12:22:27 UTC (rev 1276)
@@ -51,6 +51,7 @@
 	public static final String NAME         = "name";
 	public static final String ORG          = "org";
 	public static final String PASSWORD     = "password";
+	public static final String POSITION     = "position";
 	public static final String NEW_PASSWORD = "newPassword";
 	public static final String PROFILE      = "profile";
 	public static final String REF          = "ref";

Added: trunk/src/org/fao/geonet/guiservices/util/GetPositionMD.java
===================================================================
--- trunk/src/org/fao/geonet/guiservices/util/GetPositionMD.java	                        (rev 0)
+++ trunk/src/org/fao/geonet/guiservices/util/GetPositionMD.java	2008-04-15 12:22:27 UTC (rev 1276)
@@ -0,0 +1,67 @@
+//=============================================================================
+//===	Copyright (C) 2001-2007 Food and Agriculture Organization of the
+//===	United Nations (FAO-UN), United Nations World Food Programme (WFP)
+//===	and United Nations Environment Programme (UNEP)
+//===
+//===	This program is free software; you can redistribute it and/or modify
+//===	it under the terms of the GNU General Public License as published by
+//===	the Free Software Foundation; either version 2 of the License, or (at
+//===	your option) any later version.
+//===
+//===	This program is distributed in the hope that it will be useful, but
+//===	WITHOUT ANY WARRANTY; without even the implied warranty of
+//===	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+//===	General Public License for more details.
+//===
+//===	You should have received a copy of the GNU General Public License
+//===	along with this program; if not, write to the Free Software
+//===	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+//===
+//===	Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
+//===	Rome - Italy. email: geonetwork@...
+//==============================================================================
+
+package org.fao.geonet.guiservices.util;
+
+import org.jdom.*;
+
+import jeeves.interfaces.*;
+import jeeves.server.*;
+import jeeves.server.context.*;
+
+import org.fao.geonet.constants.*;
+
+//=============================================================================
+
+/** This service is used by metadata.show/edit to retrieve the current
+  * position in the metadata page before it is refreshed
+  */
+
+public class GetPositionMD implements Service
+{
+	public void init(String appPath, ServiceConfig params) throws Exception {}
+
+	//--------------------------------------------------------------------------
+	//---
+	//--- Service
+	//---
+	//--------------------------------------------------------------------------
+
+	public Element exec(Element params, ServiceContext context) throws Exception
+	{
+		UserSession session = context.getUserSession();
+
+		String data = (String) session.getProperty(Geonet.Session.METADATA_POSITION);
+
+		if (data == null || data.equals(""))
+		{
+			context.info("Creating default metadata position");
+			data = "0";
+			session.setProperty(Geonet.Session.METADATA_POSITION, data);
+		}
+		return new Element("a").setText(data);
+	}
+}
+
+//=============================================================================
+

Modified: trunk/src/org/fao/geonet/services/metadata/EditUtils.java
===================================================================
--- trunk/src/org/fao/geonet/services/metadata/EditUtils.java	2008-04-09 08:11:05 UTC (rev 1275)
+++ trunk/src/org/fao/geonet/services/metadata/EditUtils.java	2008-04-15 12:22:27 UTC (rev 1276)
@@ -69,9 +69,12 @@
 		//--- handle current tab
 
 		Element elCurrTab = params.getChild(Params.CURRTAB);
+		Element elCurrPos = params.getChild(Params.POSITION);
 
 		if (elCurrTab != null)
 			session.setProperty(Geonet.Session.METADATA_SHOW, elCurrTab.getText());
+		if (elCurrPos != null)
+			session.setProperty(Geonet.Session.METADATA_POSITION, elCurrPos.getText());
 
 		//-----------------------------------------------------------------------
 		//--- check access

Modified: trunk/web/geonetwork/WEB-INF/config-metadata.xml
===================================================================
--- trunk/web/geonetwork/WEB-INF/config-metadata.xml	2008-04-09 08:11:05 UTC (rev 1275)
+++ trunk/web/geonetwork/WEB-INF/config-metadata.xml	2008-04-15 12:22:27 UTC (rev 1276)
@@ -21,6 +21,7 @@
 			&lt;output sheet="metadata-show.xsl"&gt;
 				&lt;call name="services" class="jeeves.guiservices.services.Get"/&gt;
 				&lt;call name="currTab"  class=".guiservices.util.GetCurrentMDTab"/&gt;
+				&lt;call name="position" class=".guiservices.util.GetPositionMD"/&gt;
 				&lt;call name="sources"  class=".guiservices.util.Sources"/&gt;
 				&lt;call name="isoLang"  class=".guiservices.isolanguages.Get"/&gt;
 			&lt;/output&gt;
@@ -38,6 +39,7 @@
 			&lt;output sheet="metadata-show-embedded.xsl"&gt;
 				&lt;call name="services" class="jeeves.guiservices.services.Get"/&gt;
 				&lt;call name="currTab"  class=".guiservices.util.GetCurrentMDTab"/&gt;
+				&lt;call name="position" class=".guiservices.util.GetPositionMD"/&gt;
 				&lt;call name="sources"  class=".guiservices.util.Sources"/&gt;
 				&lt;call name="isoLang"  class=".guiservices.isolanguages.Get"/&gt;
 			&lt;/output&gt;
@@ -54,6 +56,7 @@
 
 			&lt;output sheet="metadata-edit.xsl"&gt;
 				&lt;call name="currTab"       class =".guiservices.util.GetCurrentMDTab"/&gt;
+				&lt;call name="position"      class =".guiservices.util.GetPositionMD"/&gt;
 				&lt;call name="groups"        class =".guiservices.groups.GetMine"/&gt;
 				&lt;call name="regions"       class =".guiservices.regions.Get"/&gt;
 				&lt;call name="sources"       class =".guiservices.util.Sources"/&gt;

Modified: trunk/web/geonetwork/xsl/metadata-edit.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-edit.xsl	2008-04-09 08:11:05 UTC (rev 1275)
+++ trunk/web/geonetwork/xsl/metadata-edit.xsl	2008-04-15 12:22:27 UTC (rev 1276)
@@ -13,8 +13,20 @@
 	--&gt;
 	&lt;xsl:template mode="script" match="/"&gt;
 		&lt;script type="text/javascript" src="{/root/gui/url}/scripts/scriptaculous/scriptaculous.js?load=control,slider,effects,controls"/&gt;
+		&lt;script type="text/javascript" src="{/root/gui/url}/scripts/prototype.js"&gt;&lt;/script&gt;
 		&lt;script language="JavaScript1.2" type="text/javascript"&gt;
 
+			// prototype 1.6 will make findPos redundant
+			function findPos(obj) {
+				var curtop = 0;
+				if (obj.offsetParent) {
+					do {
+								curtop += obj.offsetTop;
+					} while (obj = obj.offsetParent);
+				}
+				return curtop;
+			}
+
 			function doActionInWindow(action)
 			{
 				// alert("In doAction(" + action + ")"); // DEBUG
@@ -40,25 +52,51 @@
 				doAction(action);
 			}
 
-			function doElementAction(action, ref)
+			function doElementAction(action, ref, id, offset)
 			{
-				// alert("In doElementAction(" + action + ", " + ref + ")"); // DEBUG
+				var top = findPos($(id));	
+				//alert("In doElementAction(" + action + ", " + ref + ", " + offset + ")"); // DEBUG
 				document.mainForm.ref.value = ref;
-				doAction(action + '#_' + ref);
+				document.mainForm.position.value = top + offset;
+				doAction(action);
 			}
 
-			function doNewElementAction(action, ref, name)
+			function doMoveElementAction(action, ref, id)
 			{
-				// alert("In doNewElementAction(" + action + ", " + ref + ", " + name + ")"); // DEBUG
+				var top = findPos($(id));	
+				// position at top of both elements -
+				// ie. if up then subtract height of previous sibling - if down then
+				// do nothing 
+				if (action.include('elem.up')) { 
+					var prev = $(id).previous();
+					top = top - prev.getHeight();
+					// alert("in doMoveElementAction " + prev.inspect() + ")");
+				} 
+				document.mainForm.ref.value = ref;
+				document.mainForm.position.value = top;
+				doAction(action);
+			}
+
+			function doNewElementAction(action, ref, name, id)
+			{
 				document.mainForm.name.value = name;
-				doElementAction(action, ref);
+				var offset = 0;
+				var buttons = $(id).getElementsBySelector('a#button'+id);
+				var blocks = $(id).getElementsBySelector('fieldset');
+				// calculate offset to scroll screen down so added element is at top
+				if (buttons.length &gt; 1 || blocks.length &gt; 0) {
+					offset = $(id).getHeight();
+				}
+				//alert("In doNewElementAction ( " + $(id).inspect() + ", " + buttons.inspect() + ", " + blocks.inspect() + ", " + offset + ")");
+				doElementAction(action, ref, id, offset);
 			}
 
-			function doNewORElementAction(action, ref, name, child)
+			function doNewORElementAction(action, ref, name, child, id)
 			{
-				// alert("In doNewORElementAction(" + action + ", " + ref + ", " + name + ", " + child + ")"); // DEBUG
+				// alert("In doNewORElementAction(" + action + ", " + ref + ", " + name + ", " + child + ", " + id + ")"); // DEBUG
 				document.mainForm.child.value = child;
-				doNewElementAction(action, ref, name);
+				document.mainForm.name.value = name;
+				doElementAction(action, ref, id, 0);
 			}
 
 			function doConfirm(action, message)
@@ -72,8 +110,9 @@
 				return false;
 			}
 
-			function doFileUploadAction(action, ref, fname, access)
+			function doFileUploadAction(action, ref, fname, access, id)
 			{
+				var top = findPos($(id));	
 				// alert("In doFileUploadAction(" + action + ", " + ref + ", " + fname + ")"); // DEBUG
 
 				if (fname.indexOf('/') &gt; -1)
@@ -84,17 +123,18 @@
 				document.mainForm.fname .value = fname;
 				document.mainForm.access.value = access;
 				document.mainForm.ref   .value = ref;
+				document.mainForm.position.value = top;
 				document.mainForm.action = action;
 				document.mainForm.enctype="multipart/form-data";
 				document.mainForm.encoding="multipart/form-data";
 				goSubmit('mainForm');
 			}
 			
-			function doFileRemoveAction(action, ref, access)
+			function doFileRemoveAction(action, ref, access, id)
 			{
 				// alert("In doFileRemoveAction(" + action + ", " + ref + ")"); // DEBUG
 				document.mainForm.access.value = access;
-				doElementAction(action, ref);
+				doElementAction(action, ref, id, 0);
 			}
 
 			function setRegion(westField, eastField, southField, northField, choice)
@@ -103,7 +143,7 @@
 				
 				if (choice != "")
 				{
-					coords = choice.split(";")
+					coords = choice.split(";");
 					westField.value  = coords[0];
 					eastField.value  = coords[1];
 					southField.value = coords[2];
@@ -117,7 +157,20 @@
 					northField.value = "";
 				}
 			}
-			
+
+			function scrollIt()
+			{
+				window.scroll(0,&lt;xsl:value-of select="/root/gui/position"/&gt;);
+			}
+
+			// override the body onLoad init() function in geonetwork.js
+			function onloadinit()
+			{
+				timeId = setTimeout('scrollIt()',1000);
+				&lt;!-- &lt;xsl:message&gt;POSITION: &lt;xsl:value-of select="/root/gui/position"/&gt;&lt;/xsl:message&gt; --&gt;
+			}
+		
+			Event.observe(window,'load',onloadinit);
 		&lt;/script&gt;
 		&lt;style type="text/css"&gt;@import url(&lt;xsl:value-of select="/root/gui/url"/&gt;/scripts/calendar/calendar-blue2.css);&lt;/style&gt;
 		&lt;script type="text/javascript" src="{/root/gui/url}/scripts/calendar/calendar.js"&gt;&lt;/script&gt;
@@ -149,6 +202,7 @@
 							&lt;input type="hidden" name="child"/&gt;
 							&lt;input type="hidden" name="fname"/&gt;
 							&lt;input type="hidden" name="access"/&gt;
+							&lt;input type="hidden" name="position"/&gt;
 							&lt;input type="hidden" name="currTab" value="{/root/gui/currTab}"/&gt;
 
 							&lt;table width="100%"&gt;
@@ -210,7 +264,7 @@
 		&lt;/button&gt;
 		
 		&lt;!-- thumbnails --&gt;
-		&lt;xsl:if test="string(geonet:info/schema)='iso19115' or string(geonet:info/schema)='iso19139'"&gt; &lt;!-- FIXME: should be more general --&gt;
+		&lt;xsl:if test="string(geonet:info/schema)='iso19115' or starts-with(string(geonet:info/schema),'iso19139')"&gt; &lt;!-- FIXME: should be more general --&gt;
 			&amp;#160;
 			&lt;button class="content" onclick="doAction('{/root/gui/locService}/metadata.thumbnail.form')"&gt;
 				&lt;xsl:value-of select="/root/gui/strings/thumbnails"/&gt;

Modified: trunk/web/geonetwork/xsl/metadata-iso19115.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-iso19115.xsl	2008-04-09 08:11:05 UTC (rev 1275)
+++ trunk/web/geonetwork/xsl/metadata-iso19115.xsl	2008-04-15 12:22:27 UTC (rev 1276)
@@ -902,7 +902,9 @@
 
 	&lt;xsl:template mode="iso19115EditOnlineRes" match="*"&gt;
 		&lt;xsl:param name="schema"/&gt;
-		
+	
+		&lt;xsl:variable name="id" select="generate-id(.)"/&gt;
+		&lt;div id="{$id}"/&gt;
 		&lt;xsl:apply-templates mode="complexElement" select="."&gt;
 			&lt;xsl:with-param name="schema" select="$schema"/&gt;
 			&lt;xsl:with-param name="edit"   select="true()"/&gt;
@@ -927,11 +929,13 @@
 					&lt;xsl:when test="protocol='WWW:DOWNLOAD-1.0-http--download' and string(orName)!=''"&gt;
 						&lt;xsl:apply-templates mode="iso19115FileRemove" select="orName"&gt;
 							&lt;xsl:with-param name="access" select="'private'"/&gt;
+							&lt;xsl:with-param name="id" select="$id"/&gt;
 						&lt;/xsl:apply-templates&gt;
 					&lt;/xsl:when&gt;
 					&lt;xsl:when test="protocol='WWW:DOWNLOAD-1.0-http--download' and orName"&gt;
 						&lt;xsl:apply-templates mode="iso19115FileUpload" select="orName"&gt;
 							&lt;xsl:with-param name="access" select="'private'"/&gt;
+							&lt;xsl:with-param name="id" select="$id"/&gt;
 						&lt;/xsl:apply-templates&gt;
 					&lt;/xsl:when&gt;
 					&lt;xsl:when test="protocol='WWW:LINK-1.0-http--link'"/&gt; &lt;!-- hide orName for www links --&gt;
@@ -1187,18 +1191,24 @@
 	
 	&lt;xsl:template mode="iso19115EditGraphOver" match="*"&gt;
 		&lt;xsl:param name="schema"/&gt;
-		
+	
+		&lt;xsl:variable name="id" select="generate-id(.)"/&gt;
+		&lt;div id="{$id}"/&gt;
 		&lt;xsl:apply-templates mode="complexElement" select="."&gt;
 			&lt;xsl:with-param name="schema" select="$schema"/&gt;
 			&lt;xsl:with-param name="edit"   select="true()"/&gt;
 			&lt;xsl:with-param name="content"&gt;
-				
+			
 				&lt;xsl:choose&gt;
 					&lt;xsl:when test="(string(bgFileDesc)='thumbnail' or string(bgFileDesc)='large_thumbnail') and string(bgFileName)!=''"&gt;
-						&lt;xsl:apply-templates mode="iso19115FileRemove" select="bgFileName"/&gt;
+						&lt;xsl:apply-templates mode="iso19115FileRemove" select="bgFileName"&gt;
+							&lt;xsl:with-param name="id" select="$id"/&gt;
+						&lt;/xsl:apply-templates&gt;
 					&lt;/xsl:when&gt;
 					&lt;xsl:when test="string(bgFileDesc)='thumbnail' or string(bgFileDesc)='large_thumbnail'"&gt;
-						&lt;xsl:apply-templates mode="iso19115FileUpload" select="bgFileName"/&gt;
+						&lt;xsl:apply-templates mode="iso19115FileUpload" select="bgFileName"&gt;
+							&lt;xsl:with-param name="id" select="$id"/&gt;
+						&lt;/xsl:apply-templates&gt;
 					&lt;/xsl:when&gt;
 					&lt;xsl:otherwise&gt;
 						&lt;xsl:apply-templates mode="elementEP" select="bgFileName|geonet:child[string(@name)='bgFileName']"&gt;
@@ -1716,6 +1726,7 @@
 	
 	&lt;xsl:template mode="iso19115FileUpload" match="*"&gt;
 		&lt;xsl:param name="access" select="'public'"/&gt;
+		&lt;xsl:param name="id"/&gt;
 	
 		&lt;xsl:call-template name="simpleElementGui"&gt;
 			&lt;xsl:with-param name="title" select="/root/gui/strings/file"/&gt;
@@ -1723,7 +1734,7 @@
 				&lt;table width="100%"&gt;&lt;tr&gt;
 					&lt;xsl:variable name="ref" select="geonet:element/@ref"/&gt;
 					&lt;td width="70%"&gt;&lt;input type="file" class="content" name="f_{$ref}" value="{string(.)}"/&gt;&amp;#160;&lt;/td&gt;
-					&lt;td align="right"&gt;&lt;button class="content" onclick="javascript:doFileUploadAction('{/root/gui/locService}/resources.upload','{$ref}',document.mainForm.f_{$ref}.value,'{$access}')"&gt;&lt;xsl:value-of select="/root/gui/strings/upload"/&gt;&lt;/button&gt;&lt;/td&gt;
+					&lt;td align="right"&gt;&lt;button class="content" onclick="javascript:doFileUploadAction('{/root/gui/locService}/resources.upload','{$ref}',document.mainForm.f_{$ref}.value,'{$access}','{$id}')"&gt;&lt;xsl:value-of select="/root/gui/strings/upload"/&gt;&lt;/button&gt;&lt;/td&gt;
 				&lt;/tr&gt;&lt;/table&gt;
 			&lt;/xsl:with-param&gt;
 			&lt;xsl:with-param name="schema"/&gt;
@@ -1732,6 +1743,7 @@
 	
 	&lt;xsl:template mode="iso19115FileRemove" match="*"&gt;
 		&lt;xsl:param name="access" select="'public'"/&gt;
+		&lt;xsl:param name="id"/&gt;
 	
 		&lt;xsl:call-template name="simpleElementGui"&gt;
 			&lt;xsl:with-param name="title" select="/root/gui/strings/file"/&gt;
@@ -1739,7 +1751,7 @@
 				&lt;table width="100%"&gt;&lt;tr&gt;
 					&lt;xsl:variable name="ref" select="geonet:element/@ref"/&gt;
 					&lt;td width="70%"&gt;&lt;xsl:value-of select="string(.)"/&gt;&lt;/td&gt;
-					&lt;td align="right"&gt;&lt;button class="content" onclick="javascript:doFileRemoveAction('{/root/gui/locService}/resources.del','{$ref}','{$access}')"&gt;&lt;xsl:value-of select="/root/gui/strings/remove"/&gt;&lt;/button&gt;&lt;/td&gt;
+					&lt;td align="right"&gt;&lt;button class="content" onclick="javascript:doFileRemoveAction('{/root/gui/locService}/resources.del','{$ref}','{$access}','{$id}')"&gt;&lt;xsl:value-of select="/root/gui/strings/remove"/&gt;&lt;/button&gt;&lt;/td&gt;
 				&lt;/tr&gt;&lt;/table&gt;
 			&lt;/xsl:with-param&gt;
 			&lt;xsl:with-param name="schema"/&gt;

Modified: trunk/web/geonetwork/xsl/metadata-iso19139.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-04-09 08:11:05 UTC (rev 1275)
+++ trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-04-15 12:22:27 UTC (rev 1276)
@@ -666,11 +666,18 @@
 					&lt;xsl:with-param name="schema"  select="$schema"/&gt;
 					&lt;xsl:with-param name="edit"   select="$edit"/&gt;
 					&lt;xsl:with-param name="text"&gt;
-						&lt;xsl:variable name="ref" select="gco:DateTime/geonet:element/@ref"/&gt;
+						&lt;xsl:variable name="ref" select="gco:Date/geonet:element/@ref|gco:DateTime/geonet:element/@ref"/&gt;
 						
 						&lt;table width="100%"&gt;&lt;tr&gt;
 							&lt;td&gt;
-								&lt;input class="md" type="text" name="_{$ref}" id="_{$ref}_cal" value="{gco:DateTime/text()}" size="30" readonly="1"/&gt;
+								&lt;xsl:choose&gt;
+									&lt;xsl:when test="gco:DateTime"&gt;
+										&lt;input class="md" type="text" name="_{$ref}" id="_{$ref}_cal" value="{gco:DateTime/text()}" size="30" readonly="1"/&gt;
+									&lt;/xsl:when&gt;
+									&lt;xsl:otherwise&gt;
+										&lt;input class="md" type="text" name="_{$ref}" id="_{$ref}_cal" value="{gco:Date/text()}" size="30" readonly="1"/&gt;
+									&lt;/xsl:otherwise&gt;
+								&lt;/xsl:choose&gt;
 							&lt;/td&gt;
 							&lt;td align="center" width="30" valign="middle"&gt;
 								&lt;img src="{/root/gui/url}/scripts/calendar/img.gif"
@@ -683,16 +690,32 @@
 									Calendar.setup(
 										{
 											inputField  : &amp;quot;_&lt;xsl:value-of select="$ref"/&gt;_cal&amp;quot;,         // ID of the input field
-											ifFormat    : "%Y-%m-%dT%H:%M:00",                                // the date format
-											showsTime   : true, // Show the time
+											&lt;xsl:choose&gt;
+												&lt;xsl:when test="gco:Date"&gt;
+											ifFormat    : "%Y-%m-%d",
+											showsTime   : false,
+												&lt;/xsl:when&gt;
+												&lt;xsl:otherwise&gt;
+											ifFormat    : "%Y-%m-%dT%H:%M:00",   // the date format
+											showsTime   : true,                  // show the time
+												&lt;/xsl:otherwise&gt;
+											&lt;/xsl:choose&gt;
 											button      : &amp;quot;_&lt;xsl:value-of select="$ref"/&gt;_trigger&amp;quot;  // ID of the button
 										}
 									);
 									Calendar.setup(
 										{
 											inputField  : &amp;quot;_&lt;xsl:value-of select="$ref"/&gt;_cal&amp;quot;,         // ID of the input field
-											ifFormat    : "%Y-%m-%dT%H:%M:00",                                // the date format
-											showsTime   : true, // Show the time
+											&lt;xsl:choose&gt;
+												&lt;xsl:when test="gco:Date"&gt;
+											ifFormat    : "%Y-%m-%d",
+											showsTime   : false,
+												&lt;/xsl:when&gt;
+												&lt;xsl:otherwise&gt;
+											ifFormat    : "%Y-%m-%dT%H:%M:00",  // the date format
+											showsTime   : true,                 // show the time
+												&lt;/xsl:otherwise&gt;
+											&lt;/xsl:choose&gt;
 											button      : &amp;quot;_&lt;xsl:value-of select="$ref"/&gt;_cal&amp;quot;  // ID of the button
 										}
 									);
@@ -766,7 +789,7 @@
 								&lt;xsl:choose&gt;
                   &lt;xsl:when test="gco:DateTime"&gt;
                       ifFormat    : "%Y-%m-%dT%H:%M:00", // the date format
-                      showsTime : false, // Do not show the time
+                      showsTime : true, // Show the time
                   &lt;/xsl:when&gt;
                   &lt;xsl:otherwise&gt;
                       ifFormat    : "%Y-%m-%d", // the date format
@@ -782,7 +805,7 @@
 								&lt;xsl:choose&gt;
                   &lt;xsl:when test="gco:DateTime"&gt;
                       ifFormat    : "%Y-%m-%dT%H:%M:00", // the date format
-                      showsTime : false, // Do not show the time
+                      showsTime : true, // Show the time
                   &lt;/xsl:when&gt;
                   &lt;xsl:otherwise&gt;
                       ifFormat    : "%Y-%m-%d",  // the date format
@@ -847,7 +870,7 @@
 										{
 											inputField  : &amp;quot;_&lt;xsl:value-of select="$ref"/&gt;_cal&amp;quot;,         // ID of the input field
 						                    ifFormat    : "%Y-%m-%dT%H:%M:00", // the date format
-                    						showsTime : false, // Do not show the time
+                    						showsTime : true, // Do not show the time
 											button      : &amp;quot;_&lt;xsl:value-of select="$ref"/&gt;_trigger&amp;quot;  // ID of the button
 										}
 									);
@@ -1574,7 +1597,9 @@
 
 	&lt;xsl:template mode="iso19139EditOnlineRes" match="*"&gt;
 		&lt;xsl:param name="schema"/&gt;
-		
+	
+		&lt;xsl:variable name="id" select="generate-id(.)"/&gt;
+		&lt;div id="{$id}"/&gt;
 		&lt;xsl:apply-templates mode="complexElement" select="."&gt;
 			&lt;xsl:with-param name="schema" select="$schema"/&gt;
 			&lt;xsl:with-param name="edit"   select="true()"/&gt;
@@ -1599,11 +1624,13 @@
 					&lt;xsl:when test="string(gmd:protocol/gco:CharacterString)='WWW:DOWNLOAD-1.0-http--download' and string(gmd:name/gco:CharacterString)!=''"&gt;
 						&lt;xsl:apply-templates mode="iso19139FileRemove" select="gmd:name/gco:CharacterString"&gt;
 							&lt;xsl:with-param name="access" select="'private'"/&gt;
+							&lt;xsl:with-param name="id" select="$id"/&gt;
 						&lt;/xsl:apply-templates&gt;
 					&lt;/xsl:when&gt;
 					&lt;xsl:when test="string(gmd:protocol/gco:CharacterString)='WWW:DOWNLOAD-1.0-http--download' and gmd:name"&gt;
 						&lt;xsl:apply-templates mode="iso19139FileUpload" select="gmd:name/gco:CharacterString"&gt;
 							&lt;xsl:with-param name="access" select="'private'"/&gt;
+							&lt;xsl:with-param name="id" select="$id"/&gt;
 						&lt;/xsl:apply-templates&gt;
 					&lt;/xsl:when&gt;
 					&lt;xsl:when test="string(gmd:protocol/gco:CharacterString)='WWW:LINK-1.0-http--link'"/&gt; &lt;!-- hide orName for www links --&gt;
@@ -1946,6 +1973,7 @@
 
 	&lt;xsl:template mode="iso19139FileUpload" match="*"&gt;
 		&lt;xsl:param name="access" select="'public'"/&gt;
+		&lt;xsl:param name="id"/&gt;
 	
 		&lt;xsl:call-template name="simpleElementGui"&gt;
 			&lt;xsl:with-param name="title" select="/root/gui/strings/file"/&gt;
@@ -1953,7 +1981,7 @@
 				&lt;table width="100%"&gt;&lt;tr&gt;
 					&lt;xsl:variable name="ref" select="geonet:element/@ref"/&gt;
 					&lt;td width="70%"&gt;&lt;input type="file" class="content" name="f_{$ref}" value="{string(.)}"/&gt;&amp;#160;&lt;/td&gt;
-					&lt;td align="right"&gt;&lt;button class="content" onclick="javascript:doFileUploadAction('{/root/gui/locService}/resources.upload','{$ref}',document.mainForm.f_{$ref}.value,'{$access}')"&gt;&lt;xsl:value-of select="/root/gui/strings/upload"/&gt;&lt;/button&gt;&lt;/td&gt;
+					&lt;td align="right"&gt;&lt;button class="content" onclick="javascript:doFileUploadAction('{/root/gui/locService}/resources.upload','{$ref}',document.mainForm.f_{$ref}.value,'{$access}','{$id}')"&gt;&lt;xsl:value-of select="/root/gui/strings/upload"/&gt;&lt;/button&gt;&lt;/td&gt;
 				&lt;/tr&gt;&lt;/table&gt;
 			&lt;/xsl:with-param&gt;
 			&lt;xsl:with-param name="schema"/&gt;
@@ -1964,6 +1992,7 @@
 
 	&lt;xsl:template mode="iso19139FileRemove" match="*"&gt;
 		&lt;xsl:param name="access" select="'public'"/&gt;
+		&lt;xsl:param name="id"/&gt;
 	
 		&lt;xsl:call-template name="simpleElementGui"&gt;
 			&lt;xsl:with-param name="title" select="/root/gui/strings/file"/&gt;
@@ -1971,7 +2000,7 @@
 				&lt;table width="100%"&gt;&lt;tr&gt;
 					&lt;xsl:variable name="ref" select="geonet:element/@ref"/&gt;
 					&lt;td width="70%"&gt;&lt;xsl:value-of select="string(.)"/&gt;&lt;/td&gt;
-					&lt;td align="right"&gt;&lt;button class="content" onclick="javascript:doFileRemoveAction('{/root/gui/locService}/resources.del','{$ref}','{$access}')"&gt;&lt;xsl:value-of select="/root/gui/strings/remove"/&gt;&lt;/button&gt;&lt;/td&gt;
+					&lt;td align="right"&gt;&lt;button class="content" onclick="javascript:doFileRemoveAction('{/root/gui/locService}/resources.del','{$ref}','{$access}',{$id})"&gt;&lt;xsl:value-of select="/root/gui/strings/remove"/&gt;&lt;/button&gt;&lt;/td&gt;
 				&lt;/tr&gt;&lt;/table&gt;
 			&lt;/xsl:with-param&gt;
 			&lt;xsl:with-param name="schema"/&gt;

Modified: trunk/web/geonetwork/xsl/metadata.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata.xsl	2008-04-09 08:11:05 UTC (rev 1275)
+++ trunk/web/geonetwork/xsl/metadata.xsl	2008-04-15 12:22:27 UTC (rev 1276)
@@ -89,8 +89,9 @@
 		&lt;/xsl:variable&gt;
 		&lt;xsl:variable name="parentName" select="../geonet:element/@ref"/&gt;
 		&lt;xsl:variable name="prevBrother" select="preceding-sibling::*[1]"/&gt;
-		&lt;xsl:variable name="subtemplates" select="/root/gui/subtemplates/record[string(root)=$name]"/&gt;
-		&lt;xsl:if test="$currTab!='simple' and (geonet:choose or name($prevBrother)!=$name) or $subtemplates"&gt; &lt;!-- RGFIX --&gt;
+		&lt;!-- &lt;xsl:variable name="subtemplates" select="/root/gui/subtemplates/record[string(root)=$name]"/&gt; --&gt;
+		&lt;xsl:variable name="subtemplates" select="/root/gui/subtemplates/record[string(root)='']"/&gt; 
+		&lt;xsl:if test="$currTab!='simple' and (geonet:choose or name($prevBrother)!=$name) or $subtemplates"&gt;
 			&lt;xsl:variable name="text"&gt;
 				&lt;xsl:if test="geonet:choose or $subtemplates"&gt;
 					&lt;select class="md" name="_{$parentName}_{@name}" size="1"&gt;
@@ -110,13 +111,14 @@
 					&lt;/select&gt;
 				&lt;/xsl:if&gt;
 			&lt;/xsl:variable&gt;
+			&lt;xsl:variable name="id" select="generate-id(.)"/&gt;
 			&lt;xsl:variable name="addLink"&gt;
 				&lt;xsl:choose&gt;
 					&lt;xsl:when test="geonet:choose or $subtemplates"&gt;
-						&lt;xsl:value-of select="concat('javascript:doNewORElementAction(',$apos,/root/gui/locService,'/metadata.elem.add',$apos,',',$parentName,',',$apos,$name,$apos,',document.mainForm._',$parentName,'_',@name,'.value);')"/&gt;
+						&lt;xsl:value-of select="concat('javascript:doNewORElementAction(',$apos,/root/gui/locService,'/metadata.elem.add',$apos,',',$parentName,',',$apos,$name,$apos,',document.mainForm._',$parentName,'_',@name,'.value,',$apos,$id,$apos,');')"/&gt;
 					&lt;/xsl:when&gt;
 					&lt;xsl:otherwise&gt;
-						&lt;xsl:value-of select="concat('javascript:doNewElementAction(',$apos,/root/gui/locService,'/metadata.elem.add',$apos,',',$parentName,',',$apos,$name,$apos,');')"/&gt;
+						&lt;xsl:value-of select="concat('javascript:doNewElementAction(',$apos,/root/gui/locService,'/metadata.elem.add',$apos,',',$parentName,',',$apos,$name,$apos,',',$apos,$id,$apos,');')"/&gt;
 					&lt;/xsl:otherwise&gt;
 				&lt;/xsl:choose&gt;
 			&lt;/xsl:variable&gt;
@@ -137,6 +139,7 @@
 				&lt;xsl:with-param name="addLink"  select="$addLink"/&gt;
 				&lt;xsl:with-param name="helpLink" select="$helpLink"/&gt;
 				&lt;xsl:with-param name="edit"     select="$edit"/&gt;
+				&lt;xsl:with-param name="id"     	select="$id"/&gt;
 			&lt;/xsl:call-template&gt;
 		&lt;/xsl:if&gt;
 	&lt;/xsl:template&gt;
@@ -394,33 +397,35 @@
 		&lt;xsl:param name="helpLink"/&gt;
 		
 		&lt;!-- if it's the last brother of it's type and there is a new brother make addLink --&gt;
+
+		&lt;xsl:variable name="id" select="generate-id(.)"/&gt;
 		&lt;xsl:variable name="addLink"&gt;
-			&lt;xsl:call-template name="addLink"/&gt;
+			&lt;xsl:call-template name="addLink"&gt;
+				&lt;xsl:with-param name="id" select="$id"/&gt;
+			&lt;/xsl:call-template&gt;
 		&lt;/xsl:variable&gt;
 		&lt;xsl:variable name="removeLink"&gt;
 			&lt;xsl:if test="geonet:element/@del='true'"&gt;
-				&lt;xsl:value-of select="concat('javascript:doElementAction(',$apos,/root/gui/locService,'/metadata.elem.delete',$apos,',',geonet:element/@ref,');')"/&gt;
+				&lt;xsl:value-of select="concat('javascript:doElementAction(',$apos,/root/gui/locService,'/metadata.elem.delete',$apos,',',geonet:element/@ref,',',$apos,$id,$apos,',0);')"/&gt;
 			&lt;/xsl:if&gt;
 		&lt;/xsl:variable&gt;
 		&lt;xsl:variable name="upLink"&gt;
 			&lt;xsl:if test="geonet:element/@up='true'"&gt;
-				&lt;xsl:value-of select="concat('javascript:doElementAction(',$apos,/root/gui/locService,'/metadata.elem.up',$apos,',',geonet:element/@ref,');')"/&gt;
+				&lt;xsl:value-of select="concat('javascript:doMoveElementAction(',$apos,/root/gui/locService,'/metadata.elem.up',$apos,',',geonet:element/@ref,',',$apos,$id,$apos,');')"/&gt;
 			&lt;/xsl:if&gt;
 		&lt;/xsl:variable&gt;
 		&lt;xsl:variable name="downLink"&gt;
 			&lt;xsl:if test="geonet:element/@down='true'"&gt;
-				&lt;xsl:value-of select="concat('javascript:doElementAction(',$apos,/root/gui/locService,'/metadata.elem.down',$apos,',',geonet:element/@ref,');')"/&gt;
+				&lt;xsl:value-of select="concat('javascript:doMoveElementAction(',$apos,/root/gui/locService,'/metadata.elem.down',$apos,',',geonet:element/@ref,',',$apos,$id,$apos,');')"/&gt;
 			&lt;/xsl:if&gt;
 		&lt;/xsl:variable&gt;
 &lt;!-- schematron info if in advanced mode (all elements) --&gt;
 		&lt;xsl:variable name="schematronLink"&gt;
-			&lt;xsl:if test="$currTab!='simple'"&gt;
-				&lt;xsl:variable name="ref" select="concat('#_',geonet:element/@ref)"/&gt;
-				&lt;xsl:if test="//geonet:errorFound[@ref=$ref]"&gt;
-					&lt;xsl:for-each select="//geonet:errorFound[@ref=$ref]"&gt;
-						&lt;xsl:text&gt; &lt;/xsl:text&gt;&lt;xsl:value-of select="geonet:diagnostics"/&gt;
-					&lt;/xsl:for-each&gt;
-				&lt;/xsl:if&gt;
+			&lt;xsl:variable name="ref" select="concat('#_',geonet:element/@ref)"/&gt;
+			&lt;xsl:if test="//geonet:errorFound[@ref=$ref]"&gt;
+				&lt;xsl:for-each select="//geonet:errorFound[@ref=$ref]"&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;&lt;xsl:value-of select="geonet:diagnostics"/&gt;
+				&lt;/xsl:for-each&gt;
 			&lt;/xsl:if&gt;
 		&lt;/xsl:variable&gt;
 
@@ -434,12 +439,16 @@
 			&lt;xsl:with-param name="helpLink"   select="$helpLink"/&gt;
 			&lt;xsl:with-param name="schematronLink" select="$schematronLink"/&gt;
 			&lt;xsl:with-param name="edit"       select="true()"/&gt;
+			&lt;xsl:with-param name="id" select="$id"/&gt;
 		&lt;/xsl:call-template&gt;
 	&lt;/xsl:template&gt;
 	
 	&lt;xsl:template name="addLink"&gt;
+		&lt;xsl:param name="id"/&gt;
+
 		&lt;xsl:variable name="name" select="name(.)"/&gt;
-		&lt;xsl:variable name="subtemplates" select="/root/gui/subtemplates/record[string(root)=$name]"/&gt;
+		&lt;!-- &lt;xsl:variable name="subtemplates" select="/root/gui/subtemplates/record[string(root)=$name]"/&gt; --&gt;
+		&lt;xsl:variable name="subtemplates" select="/root/gui/subtemplates/record[string(root)='']"/&gt;
 		&lt;xsl:variable name="nextBrother" select="following-sibling::*[1]"/&gt;
 		&lt;xsl:variable name="nb"&gt;
 			&lt;xsl:if test="name($nextBrother)='geonet:child'"&gt;
@@ -460,10 +469,10 @@
 		&lt;xsl:if test="$newBrother/* and not($newBrother/*/geonet:choose or $subtemplates)"&gt;
 			&lt;xsl:choose&gt;
 				&lt;xsl:when test="$nextBrother/@prefix=''"&gt;
-					&lt;xsl:value-of select="concat('javascript:doNewElementAction(',$apos,/root/gui/locService,'/metadata.elem.add',$apos,',',../geonet:element/@ref,',',$apos,$nextBrother/@name,$apos,');')"/&gt;
+					&lt;xsl:value-of select="concat('javascript:doNewElementAction(',$apos,/root/gui/locService,'/metadata.elem.add',$apos,',',../geonet:element/@ref,',',$apos,$nextBrother/@name,$apos,',',$apos,$id,$apos,');')"/&gt;
 				&lt;/xsl:when&gt;
 				&lt;xsl:otherwise&gt;
-					&lt;xsl:value-of select="concat('javascript:doNewElementAction(',$apos,/root/gui/locService,'/metadata.elem.add',$apos,',',../geonet:element/@ref,',',$apos,$nextBrother/@prefix,':',$nextBrother/@name,$apos,');')"/&gt;
+					&lt;xsl:value-of select="concat('javascript:doNewElementAction(',$apos,/root/gui/locService,'/metadata.elem.add',$apos,',',../geonet:element/@ref,',',$apos,$nextBrother/@prefix,':',$nextBrother/@name,$apos,',',$apos,$id,$apos,');')"/&gt;
 				&lt;/xsl:otherwise&gt;
 			&lt;/xsl:choose&gt;
 		&lt;/xsl:if&gt;
@@ -499,33 +508,35 @@
 		&lt;xsl:param name="helpLink"/&gt;
 		
 		&lt;!-- if it's the last brother of it's type and there is a new brother make addLink --&gt;
+
+		&lt;xsl:variable name="id" select="generate-id(.)"/&gt;
 		&lt;xsl:variable name="addLink"&gt;
-			&lt;xsl:call-template name="addLink"/&gt;
+			&lt;xsl:call-template name="addLink"&gt;
+				&lt;xsl:with-param name="id" select="$id"/&gt;
+			&lt;/xsl:call-template&gt;
 		&lt;/xsl:variable&gt;
 		&lt;xsl:variable name="removeLink"&gt;
 			&lt;xsl:if test="geonet:element/@del='true'"&gt;
-				&lt;xsl:value-of select="concat('javascript:doElementAction(',$apos,/root/gui/locService,'/metadata.elem.delete',$apos,',',geonet:element/@ref,');')"/&gt;
+				&lt;xsl:value-of select="concat('javascript:doElementAction(',$apos,/root/gui/locService,'/metadata.elem.delete',$apos,',',geonet:element/@ref,',',$apos,$id,$apos,',0);')"/&gt;
 			&lt;/xsl:if&gt;
 		&lt;/xsl:variable&gt;
 		&lt;xsl:variable name="upLink"&gt;
 			&lt;xsl:if test="geonet:element/@up='true'"&gt;
-				&lt;xsl:value-of select="concat('javascript:doElementAction(',$apos,/root/gui/locService,'/metadata.elem.up',$apos,',',geonet:element/@ref,');')"/&gt;
+				&lt;xsl:value-of select="concat('javascript:doMoveElementAction(',$apos,/root/gui/locService,'/metadata.elem.up',$apos,',',geonet:element/@ref,',',$apos,$id,$apos,');')"/&gt;
 			&lt;/xsl:if&gt;
 		&lt;/xsl:variable&gt;
 		&lt;xsl:variable name="downLink"&gt;
 			&lt;xsl:if test="geonet:element/@down='true'"&gt;
-				&lt;xsl:value-of select="concat('javascript:doElementAction(',$apos,/root/gui/locService,'/metadata.elem.down',$apos,',',geonet:element/@ref,');')"/&gt;
+				&lt;xsl:value-of select="concat('javascript:doMoveElementAction(',$apos,/root/gui/locService,'/metadata.elem.down',$apos,',',geonet:element/@ref,',',$apos,$id,$apos,');')"/&gt;
 			&lt;/xsl:if&gt;
 		&lt;/xsl:variable&gt;
 &lt;!-- schematron info --&gt;
 		&lt;xsl:variable name="schematronLink"&gt;
-			&lt;xsl:if test="$currTab!='simple'"&gt;
-				&lt;xsl:variable name="ref" select="concat('#_',geonet:element/@ref)"/&gt;
-				&lt;xsl:if test="//geonet:errorFound[@ref=$ref]"&gt;
-					&lt;xsl:for-each select="//geonet:errorFound[@ref=$ref]"&gt;
-						&lt;xsl:text&gt; &lt;/xsl:text&gt;&lt;xsl:value-of select="geonet:diagnostics"/&gt;
-					&lt;/xsl:for-each&gt;
-				&lt;/xsl:if&gt;
+			&lt;xsl:variable name="ref" select="concat('#_',geonet:element/@ref)"/&gt;
+			&lt;xsl:if test="//geonet:errorFound[@ref=$ref]"&gt;
+				&lt;xsl:for-each select="//geonet:errorFound[@ref=$ref]"&gt;
+					&lt;xsl:text&gt; &lt;/xsl:text&gt;&lt;xsl:value-of select="geonet:diagnostics"/&gt;
+				&lt;/xsl:for-each&gt;
 			&lt;/xsl:if&gt;
 		&lt;/xsl:variable&gt;
 		
@@ -541,6 +552,7 @@
 			&lt;xsl:with-param name="schematronLink" select="$schematronLink"/&gt;
 			&lt;xsl:with-param name="schema" select="$schema"/&gt;
 			&lt;xsl:with-param name="edit"   select="true()"/&gt;			
+			&lt;xsl:with-param name="id" select="$id"/&gt;
 		&lt;/xsl:call-template&gt;
 	&lt;/xsl:template&gt;
 	
@@ -562,28 +574,16 @@
 		&lt;xsl:param name="schematronLink"/&gt;
 		&lt;xsl:param name="schema"/&gt;
 		&lt;xsl:param name="edit" select="false()"/&gt;
-		&lt;!-- used as do*ElementAction url anchor to go back to the same position after editing operations --&gt;
-		&lt;xsl:param name="anchor"&gt;
-			&lt;xsl:choose&gt;
-				
-				&lt;!-- current node is an element --&gt;
-				&lt;xsl:when test="geonet:element/@ref"&gt;_&lt;xsl:value-of select="geonet:element/@ref"/&gt;&lt;/xsl:when&gt;
-				
-				&lt;!-- current node is an attribute or a new child: create anchor to parent --&gt;
-				&lt;xsl:when test="../geonet:element/@ref"&gt;_&lt;xsl:value-of select="../geonet:element/@ref"/&gt;&lt;/xsl:when&gt;
-				
-			&lt;/xsl:choose&gt;
-		&lt;/xsl:param&gt;
-		
-		&lt;tr&gt;
+		&lt;xsl:param name="id"/&gt;
+
+		&lt;tr id="{$id}"&gt;
 			&lt;th class="md" width="20%" valign="top"&gt;
-				&lt;a name="{$anchor}"/&gt;
 				&lt;xsl:choose&gt;
 					&lt;xsl:when test="$helpLink!=''"&gt;
 						&lt;span id="tip.{$helpLink}" style="cursor:help;"&gt;&lt;xsl:value-of select="$title"/&gt;
 							&lt;xsl:call-template name="asterisk"&gt;
 								&lt;xsl:with-param name="link" select="$helpLink"/&gt;
-								&lt;xsl:with-param name="edit" select="$edit"/&gt;													
+								&lt;xsl:with-param name="edit" select="$edit"/&gt;
 							&lt;/xsl:call-template&gt;
 						&lt;/span&gt;
 					&lt;/xsl:when&gt;
@@ -600,6 +600,7 @@
 					&lt;xsl:with-param name="upLink" select="$upLink"/&gt;
 					&lt;xsl:with-param name="downLink" select="$downLink"/&gt;
 					&lt;xsl:with-param name="schematronLink" select="$schematronLink"/&gt;
+					&lt;xsl:with-param name="id" select="$id"/&gt;
 				&lt;/xsl:call-template&gt;
 			&lt;/th&gt;
 			&lt;td class="padded" valign="top"&gt;&lt;xsl:copy-of select="$text"/&gt;&lt;/td&gt;
@@ -645,31 +646,18 @@
 		&lt;xsl:param name="schematronLink"/&gt;
 		&lt;xsl:param name="schema"/&gt;
 		&lt;xsl:param name="edit" select="false()"/&gt;
+		&lt;xsl:param name="id"/&gt;
 		
-		&lt;!-- used as do*ElementAction url anchor to go back to the same position after editing operations --&gt;
-		&lt;xsl:param name="anchor"&gt;
-			&lt;xsl:choose&gt;
-				
-				&lt;!-- current node is an element --&gt;
-				&lt;xsl:when test="geonet:element/@ref"&gt;_&lt;xsl:value-of select="geonet:element/@ref"/&gt;&lt;/xsl:when&gt;
-				
-				&lt;!-- current node is a new child: create anchor to parent --&gt;
-				&lt;xsl:when test="../geonet:element/@ref"&gt;_&lt;xsl:value-of select="../geonet:element/@ref"/&gt;&lt;/xsl:when&gt;
-				
-			&lt;/xsl:choose&gt;
-		&lt;/xsl:param&gt;
-		
-		&lt;tr&gt;
+		&lt;tr id="{$id}"&gt;
 			&lt;td class="padded-content" width="100%" colspan="2"&gt;
 				&lt;fieldset class="metadata-block"&gt;
 					&lt;legend class="block-legend"&gt;
-						&lt;a name="{$anchor}"/&gt;
 						&lt;xsl:choose&gt;
 							&lt;xsl:when test="$helpLink!=''"&gt;
 								&lt;span id="tip.{$helpLink}" class="help-content" style="cursor:help;"&gt;&lt;xsl:value-of select="$title"/&gt;
 									&lt;xsl:call-template name="asterisk"&gt;
 										&lt;xsl:with-param name="link" select="$helpLink"/&gt;
-										&lt;xsl:with-param name="edit" select="$edit"/&gt;													
+										&lt;xsl:with-param name="edit" select="$edit"/&gt;
 									&lt;/xsl:call-template&gt;
 								&lt;/span&gt;
 							&lt;/xsl:when&gt;
@@ -686,6 +674,7 @@
 							&lt;xsl:with-param name="upLink" select="$upLink"/&gt;
 							&lt;xsl:with-param name="downLink" select="$downLink"/&gt;
 							&lt;xsl:with-param name="schematronLink" select="$schematronLink"/&gt;
+							&lt;xsl:with-param name="id" select="$id"/&gt;
 						&lt;/xsl:call-template&gt;
 					&lt;/legend&gt;
 					&lt;table width="100%"&gt;
@@ -707,9 +696,34 @@
 		&lt;xsl:param name="name"/&gt;
 		&lt;xsl:param name="schema"/&gt;
 		
-		&lt;xsl:variable name="title" select="string(/root/gui/*[name(.)=$schema]/element[@name = $name]/label)"/&gt;
+		&lt;xsl:variable name="title"&gt;
+			&lt;xsl:choose&gt;
+
+&lt;!-- if the schema is a profile of iso19139 then search the profile help first
+     and if not found search the iso19139 main help --&gt;
+
+				&lt;xsl:when test="starts-with($schema,'iso19139')"&gt;
+					&lt;xsl:variable name="schematitle" select="string(/root/gui/*[name(.)=$schema]/element[@name=$name]/label)"/&gt;
+					&lt;xsl:choose&gt;
+						&lt;xsl:when test="normalize-space($schematitle)=''"&gt;
+							&lt;xsl:value-of select="string(/root/gui/iso19139/element[@name=$name]/label)"/&gt;
+						&lt;/xsl:when&gt;
+						&lt;xsl:otherwise&gt;
+							&lt;xsl:value-of select="$schematitle"/&gt;
+						&lt;/xsl:otherwise&gt;
+					&lt;/xsl:choose&gt;
+				&lt;/xsl:when&gt;
+
+&lt;!-- otherwise just get the title out of the approriate schema help file --&gt;
+
+				&lt;xsl:otherwise&gt;
+					&lt;xsl:value-of select="string(/root/gui/*[name(.)=$schema]/element[@name=$name]/label)"/&gt;
+				&lt;/xsl:otherwise&gt;
+			&lt;/xsl:choose&gt;
+		&lt;/xsl:variable&gt;
+	
 		&lt;xsl:choose&gt;
-			&lt;xsl:when test="$title"&gt;
+			&lt;xsl:when test="normalize-space($title)!=''"&gt;
 				&lt;xsl:value-of select="$title"/&gt;
 			&lt;/xsl:when&gt;
 			&lt;xsl:otherwise&gt;
@@ -717,7 +731,7 @@
 			&lt;/xsl:otherwise&gt;
 		&lt;/xsl:choose&gt;
 	&lt;/xsl:template&gt;
-	
+
 	&lt;!--
 	returns the text of an element
 	--&gt;
@@ -910,7 +924,7 @@
 	&lt;xsl:template name="getHelpLink"&gt;
 		&lt;xsl:param name="name"/&gt;
 		&lt;xsl:param name="schema"/&gt;
-	
+
 		&lt;xsl:choose&gt;
 			&lt;xsl:when test="contains($name,'_ELEMENT')"&gt;
 				&lt;xsl:value-of select="''"/&gt;
@@ -926,10 +940,10 @@
 	&lt;xsl:template name="asterisk"&gt;
 		&lt;xsl:param name="link"/&gt;
 		&lt;xsl:param name="edit"/&gt;
-		
+
 		&lt;xsl:variable name="schema" select="substring-before($link, '|')"/&gt;
 		&lt;xsl:variable name="name"   select="substring-after($link, '|')"/&gt;
-		
+
 		&lt;xsl:if test="$edit"&gt;
 			&lt;xsl:if test="/root/gui/*[name() = $schema]/element[@name=$name]/condition"&gt;
 				&lt;sup&gt;&lt;font size="-1" color="#FF0000"&gt;&amp;#xA0;*&lt;/font&gt;&lt;/sup&gt;
@@ -945,26 +959,27 @@
 		&lt;xsl:param name="upLink"/&gt;
 		&lt;xsl:param name="downLink"/&gt;
 		&lt;xsl:param name="schematronLink"/&gt;
-		
+		&lt;xsl:param name="id"/&gt;
+	
 		&lt;!-- add button --&gt;
 		&lt;xsl:if test="normalize-space($addLink)"&gt;
 			&lt;xsl:text&gt; &lt;/xsl:text&gt;
-			&lt;a href="{$addLink}"&gt;&lt;img src="{/root/gui/url}/images/plus.gif" alt="{/root/gui/strings/add}"/&gt;&lt;/a&gt;
+			&lt;a id="button{$id}" onclick="setBunload(false);" href="{$addLink}"&gt;&lt;img src="{/root/gui/url}/images/plus.gif" alt="{/root/gui/strings/add}"/&gt;&lt;/a&gt;
 		&lt;/xsl:if&gt;
 		&lt;!-- remove button --&gt;
 		&lt;xsl:if test="normalize-space($removeLink)"&gt;
 			&lt;xsl:text&gt; &lt;/xsl:text&gt;
-			&lt;a href="{$removeLink}"&gt;&lt;img src="{/root/gui/url}/images/del.gif" alt="{/root/gui/strings/del}"/&gt;&lt;/a&gt;
+			&lt;a id="button{$id}" onclick="setBunload(false);" href="{$removeLink}"&gt;&lt;img src="{/root/gui/url}/images/del.gif" alt="{/root/gui/strings/del}"/&gt;&lt;/a&gt;
 		&lt;/xsl:if&gt;
 		&lt;!-- up button --&gt;
 		&lt;xsl:if test="normalize-space($upLink)"&gt;
 			&lt;xsl:text&gt; &lt;/xsl:text&gt;
-			&lt;a href="{$upLink}"&gt;&lt;img src="{/root/gui/url}/images/up.gif" alt="{/root/gui/strings/up}"/&gt;&lt;/a&gt;
+			&lt;a id="button{$id}" onclick="setBunload(false);" href="{$upLink}"&gt;&lt;img src="{/root/gui/url}/images/up.gif" alt="{/root/gui/strings/up}"/&gt;&lt;/a&gt;
 		&lt;/xsl:if&gt;
 		&lt;!-- down button --&gt;
 		&lt;xsl:if test="normalize-space($downLink)"&gt;
 			&lt;xsl:text&gt; &lt;/xsl:text&gt;
-			&lt;a href="{$downLink}"&gt;&lt;img src="{/root/gui/url}/images/down.gif" alt="{/root/gui/strings/down}"/&gt;&lt;/a&gt;
+			&lt;a id="button{$id}" onclick="setBunload(false);" href="{$downLink}"&gt;&lt;img src="{/root/gui/url}/images/down.gif" alt="{/root/gui/strings/down}"/&gt;&lt;/a&gt;
 		&lt;/xsl:if&gt;
 		&lt;!-- schematron button --&gt;
 		&lt;xsl:if test="normalize-space($schematronLink)"&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=19234591">[GeoNetwork-commit] SF.net SVN: geonetwork: [1282] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;fxprunayre@us...&gt; -	2008-04-27 19:34</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1282
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1282&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1282&amp;view=rev</a>
Author:   fxprunayre
Date:     2008-04-27 12:33:57 -0700 (Sun, 27 Apr 2008)

Log Message:
-----------
Added template for WMS services using ISO19139/119 in installer
Added boxed element for srv:containsOperation in metadata view
Fixed missing namespace prefix for srv:operatesOn when OGCWxS harvesting

Modified Paths:
--------------
    trunk/src/org/fao/geonet/kernel/harvest/harvester/ogcwxs/Harvester.java
    trunk/web/geonetwork/xsl/metadata-iso19139.xsl

Added Paths:
-----------
    trunk/gast/setup/templates/iso19139/service.xml

Added: trunk/gast/setup/templates/iso19139/service.xml
===================================================================
--- trunk/gast/setup/templates/iso19139/service.xml	                        (rev 0)
+++ trunk/gast/setup/templates/iso19139/service.xml	2008-04-27 19:33:57 UTC (rev 1282)
@@ -0,0 +1,638 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;gmd:MD_Metadata xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>" xmlns:xlink="<a href="http://www.w3.org/1999/xlink" target="_new">http://www.w3.org/1999/xlink</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_new">http://www.w3.org/2001/XMLSchema-instance</a>" xmlns:gml="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>" xmlns:gts="<a href="http://www.isotc211.org/2005/gts" target="_new">http://www.isotc211.org/2005/gts</a>" xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>" xmlns:srv="<a href="http://www.isotc211.org/2005/srv" target="_new">http://www.isotc211.org/2005/srv</a>" xmlns:geonet="<a href="http://www.fao.org/geonetwork" target="_new">http://www.fao.org/geonetwork</a>"&gt;
+  &lt;gmd:fileIdentifier&gt;
+    &lt;gco:CharacterString&gt;44ffcb13-30cc-48bf-b02d-cd1cb467e495&lt;/gco:CharacterString&gt;
+  &lt;/gmd:fileIdentifier&gt;
+  &lt;gmd:language&gt;
+    &lt;gco:CharacterString&gt;eng&lt;/gco:CharacterString&gt;
+  &lt;/gmd:language&gt;
+  &lt;gmd:characterSet&gt;
+    &lt;gmd:MD_CharacterSetCode codeListValue="utf8" codeList="./resources/codeList.xml#MD_CharacterSetCode"/&gt;
+  &lt;/gmd:characterSet&gt;
+  &lt;gmd:contact&gt;
+    &lt;gmd:CI_ResponsibleParty&gt;
+      &lt;gmd:individualName&gt;
+        &lt;gco:CharacterString&gt;The administrator of the service&lt;/gco:CharacterString&gt;
+      &lt;/gmd:individualName&gt;
+      &lt;gmd:organisationName&gt;
+        &lt;gco:CharacterString/&gt;
+      &lt;/gmd:organisationName&gt;
+      &lt;gmd:positionName&gt;
+        &lt;gco:CharacterString/&gt;
+      &lt;/gmd:positionName&gt;
+      &lt;gmd:contactInfo&gt;
+        &lt;gmd:CI_Contact&gt;
+          &lt;gmd:phone&gt;
+            &lt;gmd:CI_Telephone&gt;
+              &lt;gmd:voice&gt;
+                &lt;gco:CharacterString/&gt;
+              &lt;/gmd:voice&gt;
+              &lt;gmd:facsimile&gt;
+                &lt;gco:CharacterString/&gt;
+              &lt;/gmd:facsimile&gt;
+            &lt;/gmd:CI_Telephone&gt;
+          &lt;/gmd:phone&gt;
+          &lt;gmd:address&gt;
+            &lt;gmd:CI_Address&gt;
+              &lt;gmd:deliveryPoint&gt;
+                &lt;gco:CharacterString/&gt;
+              &lt;/gmd:deliveryPoint&gt;
+              &lt;gmd:city&gt;
+                &lt;gco:CharacterString/&gt;
+              &lt;/gmd:city&gt;
+              &lt;gmd:administrativeArea&gt;
+                &lt;gco:CharacterString/&gt;
+              &lt;/gmd:administrativeArea&gt;
+              &lt;gmd:postalCode&gt;
+                &lt;gco:CharacterString/&gt;
+              &lt;/gmd:postalCode&gt;
+              &lt;gmd:country&gt;
+                &lt;gco:CharacterString/&gt;
+              &lt;/gmd:country&gt;
+            &lt;/gmd:CI_Address&gt;
+          &lt;/gmd:address&gt;
+          &lt;gmd:onlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://geonetwork-opensource.org/&lt;/gmd:URL" target="_new">http://geonetwork-opensource.org/&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+          &lt;/gmd:onlineResource&gt;
+        &lt;/gmd:CI_Contact&gt;
+      &lt;/gmd:contactInfo&gt;
+      &lt;gmd:role&gt;
+        &lt;gmd:CI_RoleCode codeListValue="pointOfContact" codeList="./resources/codeList.xml#CI_RoleCode"/&gt;
+      &lt;/gmd:role&gt;
+    &lt;/gmd:CI_ResponsibleParty&gt;
+  &lt;/gmd:contact&gt;
+  &lt;gmd:dateStamp&gt;
+    &lt;gco:DateTime&gt;2008-04-25T20:51:27&lt;/gco:DateTime&gt;
+  &lt;/gmd:dateStamp&gt;
+  &lt;gmd:metadataStandardName&gt;
+    &lt;gco:CharacterString&gt;ISO 19115:2003/19139&lt;/gco:CharacterString&gt;
+  &lt;/gmd:metadataStandardName&gt;
+  &lt;gmd:metadataStandardVersion&gt;
+    &lt;gco:CharacterString&gt;1.0&lt;/gco:CharacterString&gt;
+  &lt;/gmd:metadataStandardVersion&gt;
+  &lt;gmd:identificationInfo&gt;
+    &lt;srv:SV_ServiceIdentification&gt;
+      &lt;gmd:citation&gt;
+        &lt;gmd:CI_Citation&gt;
+          &lt;gmd:title&gt;
+            &lt;gco:CharacterString&gt;Template for WMS service in ISO19139/119&lt;/gco:CharacterString&gt;
+          &lt;/gmd:title&gt;
+        &lt;/gmd:CI_Citation&gt;
+      &lt;/gmd:citation&gt;
+      &lt;gmd:abstract&gt;
+        &lt;gco:CharacterString&gt;The ISO19139/119 metadata standard is the preferred metadata standard to use for services (WMS, WFS, WCS).&lt;/gco:CharacterString&gt;
+      &lt;/gmd:abstract&gt;
+      &lt;gmd:status&gt;
+        &lt;gmd:MD_ProgressCode codeListValue="completed" codeList="./resources/codeList.xml#MD_ProgressCode"/&gt;
+      &lt;/gmd:status&gt;
+      &lt;gmd:pointOfContact&gt;
+        &lt;gmd:CI_ResponsibleParty&gt;
+          &lt;gmd:individualName&gt;
+            &lt;gco:CharacterString/&gt;
+          &lt;/gmd:individualName&gt;
+          &lt;gmd:organisationName&gt;
+            &lt;gco:CharacterString/&gt;
+          &lt;/gmd:organisationName&gt;
+          &lt;gmd:positionName&gt;
+            &lt;gco:CharacterString/&gt;
+          &lt;/gmd:positionName&gt;
+          &lt;gmd:contactInfo&gt;
+            &lt;gmd:CI_Contact&gt;
+              &lt;gmd:phone&gt;
+                &lt;gmd:CI_Telephone&gt;
+                  &lt;gmd:voice&gt;
+                    &lt;gco:CharacterString/&gt;
+                  &lt;/gmd:voice&gt;
+                  &lt;gmd:facsimile&gt;
+                    &lt;gco:CharacterString/&gt;
+                  &lt;/gmd:facsimile&gt;
+                &lt;/gmd:CI_Telephone&gt;
+              &lt;/gmd:phone&gt;
+              &lt;gmd:address&gt;
+                &lt;gmd:CI_Address&gt;
+                  &lt;gmd:deliveryPoint&gt;
+                    &lt;gco:CharacterString/&gt;
+                  &lt;/gmd:deliveryPoint&gt;
+                  &lt;gmd:city&gt;
+                    &lt;gco:CharacterString/&gt;
+                  &lt;/gmd:city&gt;
+                  &lt;gmd:administrativeArea&gt;
+                    &lt;gco:CharacterString/&gt;
+                  &lt;/gmd:administrativeArea&gt;
+                  &lt;gmd:postalCode&gt;
+                    &lt;gco:CharacterString/&gt;
+                  &lt;/gmd:postalCode&gt;
+                  &lt;gmd:country&gt;
+                    &lt;gco:CharacterString/&gt;
+                  &lt;/gmd:country&gt;
+                &lt;/gmd:CI_Address&gt;
+              &lt;/gmd:address&gt;
+              &lt;gmd:onlineResource&gt;
+                &lt;gmd:CI_OnlineResource&gt;
+                  &lt;gmd:linkage&gt;
+                    &lt;gmd:URL&gt;<a href="http://geonetwork-opensource.org/&lt;/gmd:URL" target="_new">http://geonetwork-opensource.org/&lt;/gmd:URL</a>&gt;
+                  &lt;/gmd:linkage&gt;
+                &lt;/gmd:CI_OnlineResource&gt;
+              &lt;/gmd:onlineResource&gt;
+            &lt;/gmd:CI_Contact&gt;
+          &lt;/gmd:contactInfo&gt;
+          &lt;gmd:role&gt;
+            &lt;gmd:CI_RoleCode codeListValue="pointOfContact" codeList="./resources/codeList.xml#CI_RoleCode"/&gt;
+          &lt;/gmd:role&gt;
+        &lt;/gmd:CI_ResponsibleParty&gt;
+      &lt;/gmd:pointOfContact&gt;
+      &lt;gmd:descriptiveKeywords&gt;
+        &lt;gmd:MD_Keywords&gt;
+          &lt;gmd:keyword&gt;
+            &lt;gco:CharacterString&gt;WFS&lt;/gco:CharacterString&gt;
+          &lt;/gmd:keyword&gt;
+          &lt;gmd:keyword&gt;
+            &lt;gco:CharacterString&gt;WMS&lt;/gco:CharacterString&gt;
+          &lt;/gmd:keyword&gt;
+          &lt;gmd:keyword&gt;
+            &lt;gco:CharacterString&gt;GEOSERVER&lt;/gco:CharacterString&gt;
+          &lt;/gmd:keyword&gt;
+          &lt;gmd:keyword&gt;
+            &lt;gco:CharacterString&gt;GEONETWORK&lt;/gco:CharacterString&gt;
+          &lt;/gmd:keyword&gt;
+          &lt;gmd:keyword&gt;
+            &lt;gco:CharacterString&gt;OSGeo&lt;/gco:CharacterString&gt;
+          &lt;/gmd:keyword&gt;
+          &lt;gmd:type&gt;
+            &lt;gmd:MD_KeywordTypeCode codeListValue="theme" codeList="./resources/codeList.xml#MD_KeywordTypeCode"/&gt;
+          &lt;/gmd:type&gt;
+        &lt;/gmd:MD_Keywords&gt;
+      &lt;/gmd:descriptiveKeywords&gt;
+      &lt;srv:serviceType&gt;
+        &lt;gco:LocalName codeSpace="www.w3c.org"&gt;OGC:WMS&lt;/gco:LocalName&gt;
+      &lt;/srv:serviceType&gt;
+      &lt;srv:serviceTypeVersion&gt;
+        &lt;gco:CharacterString&gt;1.1.1&lt;/gco:CharacterString&gt;
+      &lt;/srv:serviceTypeVersion&gt;
+      &lt;srv:accessProperties&gt;
+        &lt;gmd:MD_StandardOrderProcess&gt;
+          &lt;gmd:fees&gt;
+            &lt;gco:CharacterString&gt;NONE&lt;/gco:CharacterString&gt;
+          &lt;/gmd:fees&gt;
+        &lt;/gmd:MD_StandardOrderProcess&gt;
+      &lt;/srv:accessProperties&gt;
+      &lt;srv:extent&gt;
+        &lt;gmd:EX_Extent&gt;
+          &lt;gmd:geographicElement&gt;
+            &lt;gmd:EX_GeographicBoundingBox&gt;
+              &lt;gmd:westBoundLongitude&gt;
+                &lt;gco:Decimal&gt;-180&lt;/gco:Decimal&gt;
+              &lt;/gmd:westBoundLongitude&gt;
+              &lt;gmd:eastBoundLongitude&gt;
+                &lt;gco:Decimal&gt;180&lt;/gco:Decimal&gt;
+              &lt;/gmd:eastBoundLongitude&gt;
+              &lt;gmd:southBoundLatitude&gt;
+                &lt;gco:Decimal&gt;-90&lt;/gco:Decimal&gt;
+              &lt;/gmd:southBoundLatitude&gt;
+              &lt;gmd:northBoundLatitude&gt;
+                &lt;gco:Decimal&gt;90&lt;/gco:Decimal&gt;
+              &lt;/gmd:northBoundLatitude&gt;
+            &lt;/gmd:EX_GeographicBoundingBox&gt;
+          &lt;/gmd:geographicElement&gt;
+        &lt;/gmd:EX_Extent&gt;
+      &lt;/srv:extent&gt;
+      &lt;srv:couplingType&gt;
+        &lt;srv:SV_CouplingType codeListValue="tight" codeList="#SV_CouplingType"&gt;tight&lt;/srv:SV_CouplingType&gt;
+      &lt;/srv:couplingType&gt;
+      &lt;srv:containsOperations&gt;
+        &lt;srv:SV_OperationMetadata&gt;
+          &lt;srv:operationName&gt;
+            &lt;gco:CharacterString&gt;GetCapabilities&lt;/gco:CharacterString&gt;
+          &lt;/srv:operationName&gt;
+          &lt;srv:DCP&gt;
+            &lt;srv:DCPList codeList="#DCPList" codeListValue=""/&gt;
+          &lt;/srv:DCP&gt;
+          &lt;srv:DCP&gt;
+            &lt;srv:DCPList codeList="#DCPList" codeListValue=""/&gt;
+          &lt;/srv:DCP&gt;
+          &lt;srv:connectPoint&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : application/vnd.ogc.wms_xml&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+          &lt;/srv:connectPoint&gt;
+        &lt;/srv:SV_OperationMetadata&gt;
+      &lt;/srv:containsOperations&gt;
+      &lt;srv:containsOperations&gt;
+        &lt;srv:SV_OperationMetadata&gt;
+          &lt;srv:operationName&gt;
+            &lt;gco:CharacterString&gt;GetMap&lt;/gco:CharacterString&gt;
+          &lt;/srv:operationName&gt;
+          &lt;srv:DCP&gt;
+            &lt;srv:DCPList codeList="#DCPList" codeListValue=""/&gt;
+          &lt;/srv:DCP&gt;
+          &lt;srv:connectPoint&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/png&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : application/atom+xml&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : application/openlayers&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : application/pdf&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : application/rss+xml&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : application/vnd.google-earth.kml+xml&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : application/vnd.google-earth.kmz&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/geotiff&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/geotiff8&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/gif&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/jpeg&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/png8&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/svg+xml&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/tiff&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/tiff8&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+          &lt;/srv:connectPoint&gt;
+        &lt;/srv:SV_OperationMetadata&gt;
+      &lt;/srv:containsOperations&gt;
+      &lt;srv:containsOperations&gt;
+        &lt;srv:SV_OperationMetadata&gt;
+          &lt;srv:operationName&gt;
+            &lt;gco:CharacterString&gt;GetFeatureInfo&lt;/gco:CharacterString&gt;
+          &lt;/srv:operationName&gt;
+          &lt;srv:DCP&gt;
+            &lt;srv:DCPList codeList="#DCPList" codeListValue=""/&gt;
+          &lt;/srv:DCP&gt;
+          &lt;srv:DCP&gt;
+            &lt;srv:DCPList codeList="#DCPList" codeListValue=""/&gt;
+          &lt;/srv:DCP&gt;
+          &lt;srv:connectPoint&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : text/plain&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : text/html&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : application/vnd.ogc.gml&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+          &lt;/srv:connectPoint&gt;
+        &lt;/srv:SV_OperationMetadata&gt;
+      &lt;/srv:containsOperations&gt;
+      &lt;srv:containsOperations&gt;
+        &lt;srv:SV_OperationMetadata&gt;
+          &lt;srv:operationName&gt;
+            &lt;gco:CharacterString&gt;DescribeLayer&lt;/gco:CharacterString&gt;
+          &lt;/srv:operationName&gt;
+          &lt;srv:DCP&gt;
+            &lt;srv:DCPList codeList="#DCPList" codeListValue=""/&gt;
+          &lt;/srv:DCP&gt;
+          &lt;srv:connectPoint&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : application/vnd.ogc.wms_xml&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+          &lt;/srv:connectPoint&gt;
+        &lt;/srv:SV_OperationMetadata&gt;
+      &lt;/srv:containsOperations&gt;
+      &lt;srv:containsOperations&gt;
+        &lt;srv:SV_OperationMetadata&gt;
+          &lt;srv:operationName&gt;
+            &lt;gco:CharacterString&gt;GetLegendGraphic&lt;/gco:CharacterString&gt;
+          &lt;/srv:operationName&gt;
+          &lt;srv:DCP&gt;
+            &lt;srv:DCPList codeList="#DCPList" codeListValue=""/&gt;
+          &lt;/srv:DCP&gt;
+          &lt;srv:connectPoint&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/png&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/jpeg&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&amp;amp;&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;WWW:LINK-1.0-http--link&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Format : image/gif&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+              &lt;gmd:function&gt;
+                &lt;gmd:CI_OnLineFunctionCode codeListValue="information" codeList="./resources/codeList.xml#CI_OnLineFunctionCode"/&gt;
+              &lt;/gmd:function&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+          &lt;/srv:connectPoint&gt;
+        &lt;/srv:SV_OperationMetadata&gt;
+      &lt;/srv:containsOperations&gt;
+    &lt;/srv:SV_ServiceIdentification&gt;
+  &lt;/gmd:identificationInfo&gt;
+  &lt;gmd:distributionInfo&gt;
+    &lt;gmd:MD_Distribution&gt;
+      &lt;gmd:transferOptions&gt;
+        &lt;gmd:MD_DigitalTransferOptions&gt;
+          &lt;gmd:onLine&gt;
+            &lt;gmd:CI_OnlineResource&gt;
+              &lt;gmd:linkage&gt;
+                &lt;gmd:URL&gt;<a href="http://localhost:8080/geoserver/wms?SERVICE=WMS&lt;/gmd:URL" target="_new">http://localhost:8080/geoserver/wms?SERVICE=WMS&lt;/gmd:URL</a>&gt;
+              &lt;/gmd:linkage&gt;
+              &lt;gmd:protocol&gt;
+                &lt;gco:CharacterString&gt;OGC:WMS-1.1.1-http-get-map&lt;/gco:CharacterString&gt;
+              &lt;/gmd:protocol&gt;
+              &lt;gmd:name&gt;
+                &lt;gco:CharacterString&gt;gn:gboundaries&lt;/gco:CharacterString&gt;
+              &lt;/gmd:name&gt;
+              &lt;gmd:description&gt;
+                &lt;gco:CharacterString&gt;Country boundaries&lt;/gco:CharacterString&gt;
+              &lt;/gmd:description&gt;
+            &lt;/gmd:CI_OnlineResource&gt;
+          &lt;/gmd:onLine&gt;
+        &lt;/gmd:MD_DigitalTransferOptions&gt;
+      &lt;/gmd:transferOptions&gt;
+    &lt;/gmd:MD_Distribution&gt;
+  &lt;/gmd:distributionInfo&gt;
+  &lt;gmd:dataQualityInfo&gt;
+    &lt;gmd:DQ_DataQuality&gt;
+      &lt;gmd:scope&gt;
+        &lt;gmd:DQ_Scope&gt;
+          &lt;gmd:level&gt;
+            &lt;gmd:MD_ScopeCode codeList="./resources/codeList.xml#MD_ScopeCode" codeListValue="service"/&gt;
+          &lt;/gmd:level&gt;
+        &lt;/gmd:DQ_Scope&gt;
+      &lt;/gmd:scope&gt;
+      &lt;gmd:lineage&gt;
+        &lt;gmd:LI_Lineage&gt;
+          &lt;gmd:statement&gt;
+            &lt;gco:CharacterString/&gt;
+          &lt;/gmd:statement&gt;
+        &lt;/gmd:LI_Lineage&gt;
+      &lt;/gmd:lineage&gt;
+    &lt;/gmd:DQ_DataQuality&gt;
+  &lt;/gmd:dataQualityInfo&gt;
+&lt;/gmd:MD_Metadata&gt;
\ No newline at end of file


Property changes on: trunk/gast/setup/templates/iso19139/service.xml
___________________________________________________________________
Name: svn:mime-type
   + text/plain

Modified: trunk/src/org/fao/geonet/kernel/harvest/harvester/ogcwxs/Harvester.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/harvest/harvester/ogcwxs/Harvester.java	2008-04-16 15:18:40 UTC (rev 1281)
+++ trunk/src/org/fao/geonet/kernel/harvest/harvester/ogcwxs/Harvester.java	2008-04-27 19:33:57 UTC (rev 1282)
@@ -351,9 +351,9 @@
      */
 	 private Element addOperatesOnUuid (Element md, List&lt;WxSLayerRegistry&gt; layersRegistry) {
 				
-		Namespace gmd 	= Namespace.getNamespace("<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>");
-		Namespace gco 	= Namespace.getNamespace("<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>");
-		Namespace srv 	= Namespace.getNamespace("<a href="http://www.isotc211.org/2005/srv" target="_new">http://www.isotc211.org/2005/srv</a>");
+		Namespace gmd 	= Namespace.getNamespace("gmd", "<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>");
+		Namespace gco 	= Namespace.getNamespace("gco", "<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>");
+		Namespace srv 	= Namespace.getNamespace("srv", "<a href="http://www.isotc211.org/2005/srv" target="_new">http://www.isotc211.org/2005/srv</a>");
 		Namespace xlink = Namespace.getNamespace("xlink", "<a href="http://www.w3.org/1999/xlink" target="_new">http://www.w3.org/1999/xlink</a>");
 		
 		

Modified: trunk/web/geonetwork/xsl/metadata-iso19139.xsl
===================================================================
--- trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-04-16 15:18:40 UTC (rev 1281)
+++ trunk/web/geonetwork/xsl/metadata-iso19139.xsl	2008-04-27 19:33:57 UTC (rev 1282)
@@ -50,7 +50,7 @@
 	&lt;!-- ===================================================================== --&gt;
 
 	&lt;xsl:template mode="iso19139" match="gmd:graphicOverview"/&gt;
-	&lt;xsl:template mode="iso19139" match="gmd:contact|gmd:identificationInfo|gmd:distributionInfo|gmd:descriptiveKeywords|gmd:spatialRepresentationInfo|gmd:pointOfContact|gmd:dataQualityInfo|gmd:referenceSystemInfo|gmd:equivalentScale|gmd:projection|gmd:ellipsoid|gmd:extent[name(..)!='gmd:EX_TemporalExtent']|gmd:geographicBox|gmd:EX_TemporalExtent|gmd:MD_Distributor"&gt;
+	&lt;xsl:template mode="iso19139" match="gmd:contact|gmd:identificationInfo|gmd:distributionInfo|gmd:descriptiveKeywords|gmd:spatialRepresentationInfo|gmd:pointOfContact|gmd:dataQualityInfo|gmd:referenceSystemInfo|gmd:equivalentScale|gmd:projection|gmd:ellipsoid|gmd:extent[name(..)!='gmd:EX_TemporalExtent']|gmd:geographicBox|gmd:EX_TemporalExtent|gmd:MD_Distributor|srv:containsOperations"&gt;
 		&lt;xsl:param name="schema"/&gt;
 		&lt;xsl:param name="edit"/&gt;
 		


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=19234592">[GeoNetwork-commit] SF.net SVN: geonetwork: [1283] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;awarnock@us...&gt; -	2008-04-27 20:55</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1283
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1283&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1283&amp;view=rev</a>
Author:   awarnock
Date:     2008-04-27 13:54:39 -0700 (Sun, 27 Apr 2008)

Log Message:
-----------
Changes to support CSW 2.0.2

Modified Paths:
--------------
    trunk/src/org/fao/geonet/csw/client/MainFrame.java
    trunk/src/org/fao/geonet/csw/common/Csw.java
    trunk/src/org/fao/geonet/kernel/csw/CatalogDispatcher.java
    trunk/src/org/fao/geonet/kernel/csw/services/DescribeRecord.java
    trunk/src/org/fao/geonet/kernel/csw/services/GetRecordById.java
    trunk/src/org/fao/geonet/kernel/csw/services/GetRecords.java
    trunk/src/org/fao/geonet/kernel/csw/services/getrecords/CatalogSearcher.java
    trunk/src/org/fao/geonet/kernel/csw/services/getrecords/FieldMapper.java
    trunk/src/org/fao/geonet/kernel/csw/services/getrecords/SearchController.java
    trunk/web/geonetwork/xml/csw/capabilities.xml
    trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-brief.xsl
    trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-full.xsl
    trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-summary.xsl
    trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-brief.xsl
    trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-full.xsl
    trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-summary.xsl
    trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-brief.xsl
    trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-full.xsl
    trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-summary.xsl
    trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-brief.xsl
    trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-full.xsl
    trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-summary.xsl
    trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-brief.xsl
    trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-full.xsl
    trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-summary.xsl
    trunk/web/geonetwork/xml/schemas/dublin-core/dc.xsd
    trunk/web/geonetwork/xml/schemas/dublin-core/index-fields.xsl
    trunk/web/geonetwork/xsl/conversion/import/Convert_CSW-CITE_test_metadata.xsl

Added Paths:
-----------
    trunk/web/geonetwork/xml/validation/csw/2.0.2/
    trunk/web/geonetwork/xml/validation/csw/2.0.2/csw-2.0.2.xsd
    trunk/web/geonetwork/xml/validation/csw/2.0.2/rec-dcmes.xsd
    trunk/web/geonetwork/xml/validation/csw/2.0.2/rec-dcterms.xsd

Removed Paths:
-------------
    trunk/web/geonetwork/xml/validation/csw/2.0.1/

Modified: trunk/src/org/fao/geonet/csw/client/MainFrame.java
===================================================================
--- trunk/src/org/fao/geonet/csw/client/MainFrame.java	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/src/org/fao/geonet/csw/client/MainFrame.java	2008-04-27 20:54:39 UTC (rev 1283)
@@ -88,7 +88,7 @@
 	public MainFrame()
 	{
 		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
-		setTitle("GeoNetwork CSW 2.0.1 test application");
+		setTitle("GeoNetwork CSW 2.0.2 test application");
 
 		//------------------------------------------------------------------------
 

Modified: trunk/src/org/fao/geonet/csw/common/Csw.java
===================================================================
--- trunk/src/org/fao/geonet/csw/common/Csw.java	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/src/org/fao/geonet/csw/common/Csw.java	2008-04-27 20:54:39 UTC (rev 1283)
@@ -40,7 +40,7 @@
 	//---
 	//---------------------------------------------------------------------------
 
-	public static final Namespace NAMESPACE_CSW = Namespace.getNamespace("csw", "<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>");
+	public static final Namespace NAMESPACE_CSW = Namespace.getNamespace("csw", "<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>");
 	public static final Namespace NAMESPACE_OGC = Namespace.getNamespace("ogc", "<a href="http://www.opengis.net/ogc" target="_new">http://www.opengis.net/ogc</a>");
 	public static final Namespace NAMESPACE_OWS = Namespace.getNamespace("ows", "<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>");
 	public static final Namespace NAMESPACE_ENV = Namespace.getNamespace("env", "<a href="http://www.w3.org/2003/05/soap-envelope" target="_new">http://www.w3.org/2003/05/soap-envelope</a>");
@@ -54,7 +54,7 @@
 	public static final String SCHEMA_LANGUAGE = "<a href="http://www.w3.org/XML/Schema" target="_new">http://www.w3.org/XML/Schema</a>";
 	public static final String SERVICE         = "CSW";
 
-	public static final String CSW_VERSION    = "2.0.1";
+	public static final String CSW_VERSION    = "2.0.2";
 	public static final String OWS_VERSION    = "1.0.0";
 	public static final String FILTER_VERSION = "1.1.0";
 
@@ -110,8 +110,14 @@
 					else if (typeName.equals(APPLICATION.toString()))
 						hs.add(APPLICATION);
 
-					//--- avoid exception because the typeName is too ambiguous and not used now
-//FIXME			else throw new InvalidParameterValueEx("typeName", typeName);
+			    // These two are explicitly not allowed as search targets in CSW 2.0.2,
+			    // so we throw an exception if the client asks for them
+			    else if (typeName.equals("csw:BriefRecord"))
+				throw new InvalidParameterValueEx("typeName", typeName);
+
+			    else if (typeName.equals("csw:SummaryRecord"))
+				throw new InvalidParameterValueEx("typeName", typeName);
+
 				}
 			}
 
@@ -145,7 +151,8 @@
 
 		public static ElementSetName parse(String setName) throws InvalidParameterValueEx
 		{
-			if (setName == null)								return FULL;
+			if (setName == null)
+			    return SUMMARY; // required by CSW 2.0.2
 			if (setName.equals(BRIEF  .toString()))	return BRIEF;
 			if (setName.equals(SUMMARY.toString())) 	return SUMMARY;
 			if (setName.equals(FULL   .toString()))	return FULL;

Modified: trunk/src/org/fao/geonet/kernel/csw/CatalogDispatcher.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/csw/CatalogDispatcher.java	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/src/org/fao/geonet/kernel/csw/CatalogDispatcher.java	2008-04-27 20:54:39 UTC (rev 1283)
@@ -253,7 +253,7 @@
 
 	//---------------------------------------------------------------------------
 
-	private final static String VALIDATE_PATH = "web/xml/validation/csw/2.0.1/CSW-discovery.xsd";
+	private final static String VALIDATE_PATH = "web/xml/validation/csw/2.0.2/CSW-discovery.xsd";
 }
 
 //=============================================================================

Modified: trunk/src/org/fao/geonet/kernel/csw/services/DescribeRecord.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/csw/services/DescribeRecord.java	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/src/org/fao/geonet/kernel/csw/services/DescribeRecord.java	2008-04-27 20:54:39 UTC (rev 1283)
@@ -43,205 +43,218 @@
 
 public class DescribeRecord extends AbstractOperation implements CatalogService
 {
-	//---------------------------------------------------------------------------
-	//---
-	//--- Constructor
-	//---
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
+    //---
+    //--- Constructor
+    //---
+    //---------------------------------------------------------------------------
 
-	public DescribeRecord() {}
+    public DescribeRecord() {}
 
-	//---------------------------------------------------------------------------
-	//---
-	//--- API methods
-	//---
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
+    //---
+    //--- API methods
+    //---
+    //---------------------------------------------------------------------------
 
-	public String getName() { return "DescribeRecord"; }
+    public String getName() { return "DescribeRecord"; }
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	public Element execute(Element request, ServiceContext context) throws CatalogException
-	{
-		checkService(request);
-		checkVersion(request);
+    public Element execute(Element request, ServiceContext context) throws CatalogException
+    {
+	checkService(request);
+	checkVersion(request);
 
-		String outputFormat   = request.getAttributeValue("outputFormat");
-		String schemaLanguage = request.getAttributeValue("schemaLanguage");
+	String outputFormat   = request.getAttributeValue("outputFormat");
+	String schemaLanguage = request.getAttributeValue("schemaLanguage");
 
-		if (outputFormat != null &amp;&amp; !outputFormat.equals("application/xml"))
-			throw new InvalidParameterValueEx("outputFormat", outputFormat);
+	if (outputFormat != null &amp;&amp; !outputFormat.equals("application/xml"))
+	    throw new InvalidParameterValueEx("outputFormat", outputFormat);
 
-		if (schemaLanguage != null &amp;&amp; !schemaLanguage.equals(Csw.SCHEMA_LANGUAGE))
-			throw new InvalidParameterValueEx("schemaLanguage", schemaLanguage);
+	if (schemaLanguage != null &amp;&amp; !schemaLanguage.equals(Csw.SCHEMA_LANGUAGE))
+	    throw new InvalidParameterValueEx("schemaLanguage", schemaLanguage);
 
-		//--- build output
+	//--- build output
 
-		Element response = new Element(getName() +"Response", Csw.NAMESPACE_CSW);
+	Element response = new Element(getName() +"Response", Csw.NAMESPACE_CSW);
 
-		Iterator i = request.getChildren("TypeName", Csw.NAMESPACE_CSW).iterator();
+	Iterator i = request.getChildren("TypeName", Csw.NAMESPACE_CSW).iterator();
 
-		if (!i.hasNext())
-		{
-//			response.addContent(getSchemaComponent(context, "dataset"));
-//			response.addContent(getSchemaComponent(context, "service"));
-			response.addContent(getSchemaComponent(context, null));
-		}
-		else while(i.hasNext())
-		{
-			Element elem = (Element) i.next();
-			String  typeNS   = elem.getAttributeValue("targetNamespace");
-			String  typeName = elem.getText();
-			Element schema   = getSchemaComponent(context, typeName);
+	if (!i.hasNext())
+	    {
+		//	response.addContent(getSchemaComponent(context, "dataset"));
+		//	response.addContent(getSchemaComponent(context, "service"));
+		response.addContent(getSchemaComponent(context, null));
+	    }
+	else while(i.hasNext())
+		 {
+		     Element elem = (Element) i.next();
+		     String  typeNS   = elem.getAttributeValue("targetNamespace");
+		     String  typeName = elem.getText();
 
-			if (typeNS == null)
-				throw new MissingParameterValueEx("targetNamespace");
+		     // The value of TypeName has to be qualified by a namespace
+		     int colon = typeName.indexOf(':');
+		     if (colon &gt; 0)
+			 {
+			     String[] typeParam = typeName.split(":");
+			     String ns = typeParam[0]; // namespace part
+			     String thisType = typeParam[1]; // the value, without the namespace
 
-			if (schema != null)
-				response.addContent(schema);
-		}
+			     // go fetch the fragment from the schema
+			     Element schema   = getSchemaComponent(context, thisType);
 
-		return response;
-	}
+			     if (schema != null)
+				 response.addContent(schema);
+			 }
+		     else // throw an exception if the request didn't include a namespace
+			 throw new InvalidParameterValueEx("TypeName", typeName);
 
-	//---------------------------------------------------------------------------
+		     //if (typeNS == null)
+		     //throw new MissingParameterValueEx("targetNamespace");
+		 }
 
-	public Element adaptGetRequest(Map&lt;String, String&gt; params) throws CatalogException
-	{
-		String service      = params.get("service");
-		String version      = params.get("version");
-		String outputFormat = params.get("outputformat");
-		String schemaLang   = params.get("schemalanguage");
-		String typeNames    = params.get("typename");
-		String namespace    = params.get("namespace");
+	return response;
+    }
 
-		Element request = new Element(getName(), Csw.NAMESPACE_CSW);
+    //---------------------------------------------------------------------------
 
-		setAttrib(request, "service",        service);
-		setAttrib(request, "version",        version);
-		setAttrib(request, "outputFormat",   outputFormat);
-		setAttrib(request, "schemaLanguage", schemaLang);
+    public Element adaptGetRequest(Map&lt;String, String&gt; params) throws CatalogException
+    {
+	String service      = params.get("service");
+	String version      = params.get("version");
+	String outputFormat = params.get("outputformat");
+	String schemaLang   = params.get("schemalanguage");
+	String typeNames    = params.get("typename");
+	String namespace    = params.get("namespace");
 
-		//--- setup type names
+	Element request = new Element(getName(), Csw.NAMESPACE_CSW);
 
-		Map&lt;String, String&gt; hmTypeNames = retrieveTypeNames(typeNames, namespace);
+	setAttrib(request, "service",        service);
+	setAttrib(request, "version",        version);
+	setAttrib(request, "outputFormat",   outputFormat);
+	setAttrib(request, "schemaLanguage", schemaLang);
 
-		for(Map.Entry&lt;String, String&gt; entry : hmTypeNames.entrySet())
-		{
-			Element el = new Element("TypeName", Csw.NAMESPACE_CSW);
-			el.setText(entry.getKey());
-			el.setAttribute("targetNamespace", entry.getValue());
+	//--- setup type names
+	Map&lt;String, String&gt; hmTypeNames = retrieveTypeNames(typeNames, namespace);
 
-			request.addContent(el);
-		}
+	for(Map.Entry&lt;String, String&gt; entry : hmTypeNames.entrySet())
+	    {
+		Element el = new Element("TypeName", Csw.NAMESPACE_CSW);
+		el.setText(entry.getKey());
+		el.setAttribute("targetNamespace", entry.getValue());
 
-		return request;
-	}
+		request.addContent(el);
+	    }
 
-	//---------------------------------------------------------------------------
-	//---
-	//--- Private methods
-	//---
-	//---------------------------------------------------------------------------
+	return request;
+    }
 
-	private Element getSchemaComponent(ServiceContext context, String typeName)
-													throws NoApplicableCodeEx
-	{
-		String dir = context.getAppPath() + Geonet.Path.VALIDATION + "csw/2.0.1/csw-2.0.1.xsd";
+    //---------------------------------------------------------------------------
+    //---
+    //--- Private methods
+    //---
+    //---------------------------------------------------------------------------
 
-		try
-		{
-			Element schema = Xml.loadFile(dir);
+    private Element getSchemaComponent(ServiceContext context, String typeName)
+	throws NoApplicableCodeEx
+    {
+	String dir = context.getAppPath() + Geonet.Path.VALIDATION + "csw/2.0.2/csw-2.0.2.xsd";
 
-			Element sc = new Element("SchemaComponent", Csw.NAMESPACE_CSW);
+	try
+	    {
+		Element schema = Xml.loadFile(dir);
 
-			sc.setAttribute("targetNamespace", Csw.NAMESPACE_CSW.getURI());
-//			sc.setAttribute("parentSchema",    "?");
-			sc.setAttribute("schemaLanguage",  Csw.SCHEMA_LANGUAGE);
+		Element sc = new Element("SchemaComponent", Csw.NAMESPACE_CSW);
 
-			if (typeName == null)
-			{
-				sc.addContent(schema);
-				return sc;
-			}
-			else
-			{
-				Element typeElem = findElement(schema, typeName);
+		sc.setAttribute("targetNamespace", Csw.NAMESPACE_CSW.getURI());
+		//			sc.setAttribute("parentSchema",    "?");
+		sc.setAttribute("schemaLanguage",  Csw.SCHEMA_LANGUAGE);
 
-				if (typeElem == null)
-					return null;
+		if (typeName == null)
+		    {
+			sc.addContent(schema);
+			return sc;
+		    }
+		else
+		    {
+			Element typeElem = findElement(schema, typeName);
 
-				sc.addContent(typeElem);
+			if (typeElem == null)
+			    return null;
 
-				return sc;
-			}
-		}
-		catch (IOException e)
-		{
-			context.error("Cannot get schema file : "+ dir);
-			context.error("  (C) StackTrace\n"+ Util.getStackTrace(e));
+			sc.addContent(typeElem);
 
-			throw new NoApplicableCodeEx("Cannot get schema file for : "+ typeName);
-		}
-		catch (JDOMException e)
-		{
-			context.error("Schema file is not well formed : "+ dir);
-			context.error("  (C) StackTrace\n"+ Util.getStackTrace(e));
+			return sc;
+		    }
+	    }
+	catch (IOException e)
+	    {
+		context.error("Cannot get schema file : "+ dir);
+		context.error("  (C) StackTrace\n"+ Util.getStackTrace(e));
 
-			throw new NoApplicableCodeEx("Schema file not well formed : "+ typeName);
-		}
-	}
+		throw new NoApplicableCodeEx("Cannot get schema file for : "+ typeName);
+	    }
+	catch (JDOMException e)
+	    {
+		context.error("Schema file is not well formed : "+ dir);
+		context.error("  (C) StackTrace\n"+ Util.getStackTrace(e));
 
-	//---------------------------------------------------------------------------
+		throw new NoApplicableCodeEx("Schema file not well formed : "+ typeName);
+	    }
+    }
 
-	private Element findElement(Element schema, String typeName)
-	{
-		Iterator i = schema.getChildren().iterator();
+    //---------------------------------------------------------------------------
 
-		while (i.hasNext())
-		{
-			Element elem = (Element) i.next();
+    private Element findElement(Element schema, String typeName)
+    {
+	Iterator i = schema.getChildren().iterator();
 
-			String name = elem.getAttributeValue("name");
+	while (i.hasNext())
+	    {
+		Element elem = (Element) i.next();
 
-			if (elem.getName().equals("element"))
-				if (name.equals(typeName))
-					return (Element) elem.detach();
-		}
+		String name = elem.getAttributeValue("name");
 
-		return null;
-	}
+		if (elem.getName().equals("element"))
+		    if (name.equals(typeName))
+			return (Element) elem.detach();
 
-	//---------------------------------------------------------------------------
+	    }
 
-//	private Element getSchemaComponent(ServiceContext context, String typeName)
-//													throws NoApplicableCodeEx
-//	{
-//		String file = typeName.equals("service") ? "services.xsd" : "identification.xsd";
-//		String dir  = context.getAppPath() + Geonet.Path.CSW + file;
-//
-//		try
-//		{
-//			Element schema = Xml.loadFile(dir);
-//
-//			Element sc = new Element("SchemaComponent", Csw.NAMESPACE_CSW);
-//
-//			sc.setAttribute("targetNamespace", Csw.NAMESPACE_CSW.getURI());
-////			sc.setAttribute("parentSchema",    "?");
-//			sc.setAttribute("schemaLanguage",  Csw.SCHEMA_LANGUAGE);
-//
-//			sc.addContent(schema);
-//
-//			return sc;
-//		}
-//		catch (Exception e)
-//		{
-//			context.error("Cannot get schema file : "+ dir);
-//			context.error("  (C) StackTrace\n"+ Util.getStackTrace(e));
-//
-//			throw new NoApplicableCodeEx("Cannot get schema file for : "+ typeName);
-//		}
-//	}
+	return null;
+    }
+
+    //---------------------------------------------------------------------------
+
+    //	private Element getSchemaComponent(ServiceContext context, String typeName)
+    //													throws NoApplicableCodeEx
+    //	{
+    //		String file = typeName.equals("service") ? "services.xsd" : "identification.xsd";
+    //		String dir  = context.getAppPath() + Geonet.Path.CSW + file;
+    //
+    //		try
+    //		{
+    //			Element schema = Xml.loadFile(dir);
+    //
+    //			Element sc = new Element("SchemaComponent", Csw.NAMESPACE_CSW);
+    //
+    //			sc.setAttribute("targetNamespace", Csw.NAMESPACE_CSW.getURI());
+    ////			sc.setAttribute("parentSchema",    "?");
+    //			sc.setAttribute("schemaLanguage",  Csw.SCHEMA_LANGUAGE);
+    //
+    //			sc.addContent(schema);
+    //
+    //			return sc;
+    //		}
+    //		catch (Exception e)
+    //		{
+    //			context.error("Cannot get schema file : "+ dir);
+    //			context.error("  (C) StackTrace\n"+ Util.getStackTrace(e));
+    //
+    //			throw new NoApplicableCodeEx("Cannot get schema file for : "+ typeName);
+    //		}
+    //	}
 }
 
 //=============================================================================

Modified: trunk/src/org/fao/geonet/kernel/csw/services/GetRecordById.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/csw/services/GetRecordById.java	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/src/org/fao/geonet/kernel/csw/services/GetRecordById.java	2008-04-27 20:54:39 UTC (rev 1283)
@@ -33,7 +33,9 @@
 import org.fao.geonet.constants.Geonet;
 import org.fao.geonet.csw.common.Csw;
 import org.fao.geonet.csw.common.Csw.ElementSetName;
+import org.fao.geonet.csw.common.Csw.OutputSchema;
 import org.fao.geonet.csw.common.exceptions.CatalogException;
+import org.fao.geonet.csw.common.exceptions.InvalidParameterValueEx;
 import org.fao.geonet.csw.common.exceptions.MissingParameterValueEx;
 import org.fao.geonet.csw.common.exceptions.NoApplicableCodeEx;
 import org.fao.geonet.kernel.csw.CatalogService;
@@ -65,6 +67,10 @@
 	{
 		checkService(request);
 		checkVersion(request);
+		//-- Added for CSW 2.0.2 compliance by warnock@...
+		checkOutputFormat(request);
+		OutputSchema    outSchema   = OutputSchema.parse(request.getAttributeValue("outputSchema"));
+		//--------------------------------------------------------
 
 		ElementSetName setName = getElementSetName(request, ElementSetName.SUMMARY);
 
@@ -96,11 +102,21 @@
 		String elemSetName = params.get("elementsetname");
 		String ids         = params.get("id");
 
+		//-- Added for CSW 2.0.2 compliance by warnock@...
+		String outputFormat = params.get("outputformat");
+		String outputSchema = params.get("outputschema");
+		//--------------------------------------------------------
+
 		Element request = new Element(getName(), Csw.NAMESPACE_CSW);
 
 		setAttrib(request, "service", service);
 		setAttrib(request, "version", version);
 
+		//-- Added for CSW 2.0.2 compliance by warnock@...
+		setAttrib(request, "outputFormat",  outputFormat);
+		setAttrib(request, "outputSchema",  outputSchema);
+		//--------------------------------------------------------
+
 		fill(request, "Id", ids);
 
 		addElement(request, "ElementSetName", elemSetName);
@@ -114,6 +130,20 @@
 	//---
 	//---------------------------------------------------------------------------
 
+    //-- Added for CSW 2.0.2 compliance by warnock@...
+	private void checkOutputFormat(Element request) throws InvalidParameterValueEx
+	{
+		String format = request.getAttributeValue("outputFormat");
+
+		if (format == null)
+			return;
+
+		if (!format.equals("application/xml"))
+			throw new InvalidParameterValueEx("outputFormat", format);
+	}
+
+
+	//---------------------------------------------------------------------------
 	private Element retrieveMetadata(ServiceContext context, String uuid,
 												ElementSetName setName) throws CatalogException
 	{
@@ -133,7 +163,7 @@
 
 			Element record = (Element) i.next();
 
-//			String schema = record.getChildText("schemaid");
+			String schema = record.getChildText("schemaid");
 			String data   = record.getChildText("data");
 
 			Element md = Xml.loadString(data, false);
@@ -144,12 +174,15 @@
 			//--- should do an XSL transformation but the transformation would be profile
 			//--- specific and we don't have profiles for fgdc and dublin-core metadata
 
-//			String FS         = File.separator;
-//			String schemaDir  = context.getAppPath() +"xml"+ FS +"csw"+ FS +"schemas"+ FS +schema+ FS;
-//			String styleSheet = schemaDir + "ogc-"+setName+".xsl";
-//
-//			md = Xml.transform(md, styleSheet);
+			String FS         = File.separator;
+			String schemaDir  = context.getAppPath() +"xml"+ FS +"csw"+ FS +"schemas"+ FS +schema+ FS;
+			String styleSheet = schemaDir + "ogc-"+setName+".xsl";
+			//			System.out.println("CSW::GetRecordById::RetrieveMetadata - Using stylesheet: "+ styleSheet);
 
+			//			System.out.println("CSW::GetRecordById::RetrieveMetadata - Stored metadata: "+ md.getText());
+			md = Xml.transform(md, styleSheet);
+			//			System.out.println("CSW::GetRecordById::RetrieveMetadata - Transformed metadata: "+ md.getText());
+
 			//--- needed to detach md from the document
 			md.detach();
 

Modified: trunk/src/org/fao/geonet/kernel/csw/services/GetRecords.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/csw/services/GetRecords.java	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/src/org/fao/geonet/kernel/csw/services/GetRecords.java	2008-04-27 20:54:39 UTC (rev 1283)
@@ -47,6 +47,7 @@
 import org.fao.geonet.kernel.csw.CatalogService;
 import org.fao.geonet.kernel.csw.services.getrecords.SearchController;
 import org.fao.geonet.kernel.csw.services.getrecords.SortField;
+import org.fao.geonet.util.ISODate;
 import org.jdom.Element;
 import org.z3950.zing.cql.CQLNode;
 import org.z3950.zing.cql.CQLParser;
@@ -55,422 +56,458 @@
 
 public class GetRecords extends AbstractOperation implements CatalogService
 {
-	//---------------------------------------------------------------------------
-	//---
-	//--- Constructor
-	//---
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
+    //---
+    //--- Constructor
+    //---
+    //---------------------------------------------------------------------------
 
-	public GetRecords() {}
+    public GetRecords() {}
 
-	//---------------------------------------------------------------------------
-	//---
-	//--- API methods
-	//---
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
+    //---
+    //--- API methods
+    //---
+    //---------------------------------------------------------------------------
 
-	public String getName() { return "GetRecords"; }
+    public String getName() { return "GetRecords"; }
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	public Element execute(Element request, ServiceContext context) throws CatalogException
-	{
-		checkService(request);
-		checkVersion(request);
-		checkOutputFormat(request);
+    public Element execute(Element request, ServiceContext context) throws CatalogException
+    {
+	checkService(request);
+	checkVersion(request);
+	checkOutputFormat(request);
 
-		int startPos   = getStartPosition(request);
-		int maxRecords = getMaxRecords(request);
-		int hopCount   = getHopCount(request);
+	String timeStamp = new ISODate().toString();
 
-		Element query = request.getChild("Query", Csw.NAMESPACE_CSW);
+	int startPos   = getStartPosition(request);
+	int maxRecords = getMaxRecords(request);
+	int hopCount   = getHopCount(request);
 
-		ResultType      resultType  = ResultType  .parse(request.getAttributeValue("resultType"));;
-		OutputSchema    outSchema   = OutputSchema.parse(request.getAttributeValue("outputSchema"));
-		ElementSetName  setName     = getElementSetName(query , ElementSetName.FULL);
-		Set&lt;String&gt;     elemNames   = getElementNames(query);
-		Set&lt;TypeName&gt;   typeNames   = getTypeNames(request);
-		Element         filterExpr  = getFilterExpression(request, context);
-		List&lt;SortField&gt; sortFields  = getSortFields(request);
+	Element query = request.getChild("Query", Csw.NAMESPACE_CSW);
 
-		if (resultType == ResultType.VALIDATE)
-			throw new InvalidParameterValueEx("resultType", resultType.toString());
+	ResultType      resultType  = ResultType  .parse(request.getAttributeValue("resultType"));;
+	OutputSchema    outSchema   = OutputSchema.parse(request.getAttributeValue("outputSchema"));
+	Set&lt;String&gt;     elemNames   = getElementNames(query);
+	ElementSetName  setName = ElementSetName.FULL;
 
-		Element response = new Element(getName() +"Response", Csw.NAMESPACE_CSW);
+	// If any element names are specified, it's an ad hoc query and overrides the
+	// element set name default.  In that case, we set setName to FULL instead of
+	// SUMMARY so that we can retrieve a CSW:Record and trim out the elements that
+	// aren't in the elemNames set.
+	if ((elemNames == null) || (elemNames.size() == 0))
+	    setName = getElementSetName(query , ElementSetName.SUMMARY);
 
-		Element status = new Element("SearchStatus", Csw.NAMESPACE_CSW);
-		status.setAttribute("status", "complete");
+	Set&lt;TypeName&gt;   typeNames   = getTypeNames(request);
+	Element         filterExpr  = getFilterExpression(request, context);
+	List&lt;SortField&gt; sortFields  = getSortFields(request);
 
+	Element response;
+
+	if (resultType == ResultType.VALIDATE)
+	    {
+		String schema = context.getAppPath() + Geonet.Path.VALIDATION + "csw/2.0.2/csw-2.0.2.xsd";
+		System.out.println("Validating against " + schema);
+
+		try
+		    {
+			Xml.validate(schema, request);
+		    }
+
+		catch (Exception e)
+		    {
+			System.out.println("Request validation failed");
+			throw new NoApplicableCodeEx("Request failed validation:" + e.toString());
+		    }
+
+		response = new Element("Acknowledgement", Csw.NAMESPACE_CSW);
+		response.setAttribute("timeStamp",timeStamp);
+
+		Element echoedRequest = new Element("EchoedRequest", Csw.NAMESPACE_CSW);
+		echoedRequest.addContent(request);
+
+		response.addContent(echoedRequest);
+	    }
+	else
+	    {
+
 		SearchController sc = new SearchController();
+		
+		response = new Element(getName() +"Response", Csw.NAMESPACE_CSW);
 
+		Element status = new Element("SearchStatus", Csw.NAMESPACE_CSW);
+		status.setAttribute("timestamp",timeStamp);
+
 		response.addContent(status);
 		response.addContent(sc.search(context, startPos, maxRecords, hopCount, resultType,
-												outSchema, setName, typeNames, filterExpr, sortFields, elemNames));
+					      outSchema, setName, typeNames, filterExpr, sortFields,
+					      elemNames));
+	    }
 
-		return response;
-	}
+	return response;
+    }
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	public Element adaptGetRequest(Map&lt;String, String&gt; params) throws CatalogException
-	{
-		String service      = params.get("service");
-		String version      = params.get("version");
-		String resultType   = params.get("resulttype");
-		String outputFormat = params.get("outputformat");
-		String outputSchema = params.get("outputschema");
-		String startPosition= params.get("startposition");
-		String maxRecords   = params.get("maxrecords");
-		String hopCount     = params.get("hopcount");
-		String distribSearch= params.get("distributedsearch");
-		String typeNames    = params.get("typenames");
-		String elemSetName  = params.get("elementsetname");
-		String elemName     = params.get("elementname");
-		String constraint   = params.get("constraint");
-		String constrLang   = params.get("constraintlanguage");
-		String constrLangVer= params.get("constraint_language_version");
-		String sortby       = params.get("sortby");
+    public Element adaptGetRequest(Map&lt;String, String&gt; params) throws CatalogException
+    {
+	String service      = params.get("service");
+	String version      = params.get("version");
+	String resultType   = params.get("resulttype");
+	String outputFormat = params.get("outputformat");
+	String outputSchema = params.get("outputschema");
+	String startPosition= params.get("startposition");
+	String maxRecords   = params.get("maxrecords");
+	String hopCount     = params.get("hopcount");
+	String distribSearch= params.get("distributedsearch");
+	String typeNames    = params.get("typenames");
+	String elemSetName  = params.get("elementsetname");
+	String elemName     = params.get("elementname");
+	String constraint   = params.get("constraint");
+	String constrLang   = params.get("constraintlanguage");
+	String constrLangVer= params.get("constraint_language_version");
+	String sortby       = params.get("sortby");
 
-		//--- build POST request
+	//--- build POST request
 
-		Element request = new Element(getName(), Csw.NAMESPACE_CSW);
+	Element request = new Element(getName(), Csw.NAMESPACE_CSW);
 
-		setAttrib(request, "service",       service);
-		setAttrib(request, "version",       version);
-		setAttrib(request, "resultType",    resultType);
-		setAttrib(request, "outputFormat",  outputFormat);
-		setAttrib(request, "outputSchema",  outputSchema);
-		setAttrib(request, "startPosition", startPosition);
-		setAttrib(request, "maxRecords",    maxRecords);
+	setAttrib(request, "service",       service);
+	setAttrib(request, "version",       version);
+	setAttrib(request, "resultType",    resultType);
+	setAttrib(request, "outputFormat",  outputFormat);
+	setAttrib(request, "outputSchema",  outputSchema);
+	setAttrib(request, "startPosition", startPosition);
+	setAttrib(request, "maxRecords",    maxRecords);
 
-		if (distribSearch != null &amp;&amp; distribSearch.equals("true"))
-		{
-			Element ds = new Element("DistributedSearch", Csw.NAMESPACE_CSW);
-			ds.setText("TRUE");
+	if (distribSearch != null &amp;&amp; distribSearch.equals("true"))
+	    {
+		Element ds = new Element("DistributedSearch", Csw.NAMESPACE_CSW);
+		ds.setText("TRUE");
 
-			if (hopCount != null)
-				ds.setAttribute("hopCount", hopCount);
+		if (hopCount != null)
+		    ds.setAttribute("hopCount", hopCount);
 
-			request.addContent(ds);
-		}
+		request.addContent(ds);
+	    }
 
-		//------------------------------------------------------------------------
-		//--- build query element
+	//------------------------------------------------------------------------
+	//--- build query element
 
-		Element query = new Element("Query", Csw.NAMESPACE_CSW);
-		request.addContent(query);
+	Element query = new Element("Query", Csw.NAMESPACE_CSW);
+	request.addContent(query);
 
-		if (typeNames != null)
-			setAttrib(query, "typeNames", typeNames.replace(',',' '));
+	if (typeNames != null)
+	    setAttrib(query, "typeNames", typeNames.replace(',',' '));
 
-		//--- these 2 are in mutual exclusion
+	//--- these 2 are in mutual exclusion
 
-		addElement(query, "ElementSetName", elemSetName);
-		fill(query, "ElementName", elemName);
+	addElement(query, "ElementSetName", elemSetName);
+	fill(query, "ElementName", elemName);
 
-		//------------------------------------------------------------------------
-		//--- handle constraint
+	//------------------------------------------------------------------------
+	//--- handle constraint
 
-		ConstraintLanguage language = ConstraintLanguage.parse(constrLang);
+	ConstraintLanguage language = ConstraintLanguage.parse(constrLang);
 
-		if (constraint != null)
-		{
-			Element constr = new Element("Constraint", Csw.NAMESPACE_CSW);
-			query.addContent(constr);
+	if (constraint != null)
+	    {
+		Element constr = new Element("Constraint", Csw.NAMESPACE_CSW);
+		query.addContent(constr);
 
-			if (language == ConstraintLanguage.CQL)
-				addElement(constr, "CqlText", constraint);
-			else
-				try
-				{
-					constr.addContent(Xml.loadString(constraint, false));
-				}
-				catch (Exception e)
-				{
-					e.printStackTrace();
-					throw new NoApplicableCodeEx("Constraint is not a valid xml");
-				}
+		if (language == ConstraintLanguage.CQL)
+		    addElement(constr, "CqlText", constraint);
+		else
+		    try
+			{
+			    constr.addContent(Xml.loadString(constraint, false));
+			}
+		    catch (Exception e)
+			{
+			    e.printStackTrace();
+			    throw new NoApplicableCodeEx("Constraint is not a valid xml");
+			}
 
-			setAttrib(constr, "version", constrLangVer);
-		}
+		setAttrib(constr, "version", constrLangVer);
+	    }
 
-		//------------------------------------------------------------------------
-		//--- handle sortby
+	//------------------------------------------------------------------------
+	//--- handle sortby
 
-		if (sortby != null)
-		{
-			Element sortBy = new Element("SortBy", Csw.NAMESPACE_OGC);
-			query.addContent(sortBy);
+	if (sortby != null)
+	    {
+		Element sortBy = new Element("SortBy", Csw.NAMESPACE_OGC);
+		query.addContent(sortBy);
 
-			StringTokenizer st = new StringTokenizer(sortby, ",");
+		StringTokenizer st = new StringTokenizer(sortby, ",");
 
-			while (st.hasMoreTokens())
-			{
-				String  sortInfo = st.nextToken();
-				String  field    = sortInfo.substring(0, sortInfo.length() -2);
-				boolean ascen    = sortInfo.endsWith(":A");
+		while (st.hasMoreTokens())
+		    {
+			String  sortInfo = st.nextToken();
+			String  field    = sortInfo.substring(0, sortInfo.length() -2);
+			boolean ascen    = sortInfo.endsWith(":A");
 
-				Element sortProp = new Element("SortProperty", Csw.NAMESPACE_OGC);
-				sortBy.addContent(sortProp);
+			Element sortProp = new Element("SortProperty", Csw.NAMESPACE_OGC);
+			sortBy.addContent(sortProp);
 
-				Element propName  = new Element("PropertyName", Csw.NAMESPACE_OGC).setText(field);
-				Element sortOrder = new Element("SortOrder",    Csw.NAMESPACE_OGC).setText(ascen ? "ASC" : "DESC");
+			Element propName  = new Element("PropertyName", Csw.NAMESPACE_OGC).setText(field);
+			Element sortOrder = new Element("SortOrder",    Csw.NAMESPACE_OGC).setText(ascen ? "ASC" : "DESC");
 
-				sortProp.addContent(propName);
-				sortProp.addContent(sortOrder);
-			}
-		}
+			sortProp.addContent(propName);
+			sortProp.addContent(sortOrder);
+		    }
+	    }
 
-		return request;
-	}
+	return request;
+    }
 
-	//---------------------------------------------------------------------------
-	//---
-	//--- Private methods
-	//---
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
+    //---
+    //--- Private methods
+    //---
+    //---------------------------------------------------------------------------
 
-	private void checkOutputFormat(Element request) throws InvalidParameterValueEx
-	{
-		String format = request.getAttributeValue("outputFormat");
+    private void checkOutputFormat(Element request) throws InvalidParameterValueEx
+    {
+	String format = request.getAttributeValue("outputFormat");
 
-		if (format == null)
-			return;
+	if (format == null)
+	    return;
 
-		if (!format.equals("application/xml"))
-			throw new InvalidParameterValueEx("outputFormat", format);
-	}
+	if (!format.equals("application/xml"))
+	    throw new InvalidParameterValueEx("outputFormat", format);
+    }
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	private int getStartPosition(Element request) throws InvalidParameterValueEx
-	{
-		String start = request.getAttributeValue("startPosition");
+    private int getStartPosition(Element request) throws InvalidParameterValueEx
+    {
+	String start = request.getAttributeValue("startPosition");
 
-		if (start == null)
-			return 1;
+	if (start == null)
+	    return 1;
 
-		try
-		{
-			int value = Integer.parseInt(start);
+	try
+	    {
+		int value = Integer.parseInt(start);
 
-			if (value &gt;= 1)
-				return value;
-		}
-		catch (NumberFormatException e) {}
+		if (value &gt;= 1)
+		    return value;
+	    }
+	catch (NumberFormatException e) {}
 
-		throw new InvalidParameterValueEx("startPosition", start);
-	}
+	throw new InvalidParameterValueEx("startPosition", start);
+    }
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	private int getMaxRecords(Element request) throws InvalidParameterValueEx
-	{
-		String max = request.getAttributeValue("maxRecords");
+    private int getMaxRecords(Element request) throws InvalidParameterValueEx
+    {
+	String max = request.getAttributeValue("maxRecords");
 
-		if (max == null)
-			return 10;
+	if (max == null)
+	    return 10;
 
-		try
-		{
-			int value = Integer.parseInt(max);
+	try
+	    {
+		int value = Integer.parseInt(max);
 
-			if (value &gt;= 1)
-				return value;
-		}
-		catch (NumberFormatException e) {}
+		if (value &gt;= 1)
+		    return value;
+	    }
+	catch (NumberFormatException e) {}
 
-		throw new InvalidParameterValueEx("maxRecords", max);
-	}
+	throw new InvalidParameterValueEx("maxRecords", max);
+    }
 
-	//---------------------------------------------------------------------------
-	//--- a return value &gt;= 0 means that a distributed search was requested
-	//--- otherwise the method returns -1
+    //---------------------------------------------------------------------------
+    //--- a return value &gt;= 0 means that a distributed search was requested
+    //--- otherwise the method returns -1
 
-	private int getHopCount(Element request) throws InvalidParameterValueEx
-	{
-		Element ds = request.getChild("DistributedSearch", Csw.NAMESPACE_CSW);
+    private int getHopCount(Element request) throws InvalidParameterValueEx
+    {
+	Element ds = request.getChild("DistributedSearch", Csw.NAMESPACE_CSW);
 
-		if (ds == null)
-			return -1;
+	if (ds == null)
+	    return -1;
 
-		String hopCount = ds.getAttributeValue("hopCount");
+	String hopCount = ds.getAttributeValue("hopCount");
 
-		if (hopCount == null)
-			return 2;
+	if (hopCount == null)
+	    return 2;
 
-		try
-		{
-			int value = Integer.parseInt(hopCount);
+	try
+	    {
+		int value = Integer.parseInt(hopCount);
 
-			if (value &gt;= 0)
-				return value;
-		}
-		catch (NumberFormatException e) {}
+		if (value &gt;= 0)
+		    return value;
+	    }
+	catch (NumberFormatException e) {}
 
-		throw new InvalidParameterValueEx("hopCount", hopCount);
-	}
+	throw new InvalidParameterValueEx("hopCount", hopCount);
+    }
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	private Set&lt;TypeName&gt; getTypeNames(Element request) throws CatalogException
-	{
-		Element query = request.getChild("Query", Csw.NAMESPACE_CSW);
+    private Set&lt;TypeName&gt; getTypeNames(Element request) throws CatalogException
+    {
+	Element query = request.getChild("Query", Csw.NAMESPACE_CSW);
+	return TypeName.parse(query.getAttributeValue("typeNames"));
+    }
 
-		return TypeName.parse(query.getAttributeValue("typeNames"));
-	}
+    //---------------------------------------------------------------------------
 
-	//---------------------------------------------------------------------------
+    private Element getFilterExpression(Element request, ServiceContext context) throws CatalogException
+    {
+	Element query  = request.getChild("Query",      Csw.NAMESPACE_CSW);
+	Element constr = query  .getChild("Constraint", Csw.NAMESPACE_CSW);
 
-	private Element getFilterExpression(Element request, ServiceContext context) throws CatalogException
-	{
-		Element query  = request.getChild("Query",      Csw.NAMESPACE_CSW);
-		Element constr = query  .getChild("Constraint", Csw.NAMESPACE_CSW);
+	if (constr == null)
+	    return null;
+	Element filter = constr.getChild("Filter",  Csw.NAMESPACE_OGC);
+	Element cql    = constr.getChild("CqlText", Csw.NAMESPACE_CSW);
 
-		if (constr == null)
-			return null;
+	if (filter == null &amp;&amp; cql == null)
+	    throw new NoApplicableCodeEx("Missing filter expression or cql query");
 
-		Element filter = constr.getChild("Filter",  Csw.NAMESPACE_OGC);
-		Element cql    = constr.getChild("CqlText", Csw.NAMESPACE_CSW);
+	String version = constr.getAttributeValue("version");
 
-		if (filter == null &amp;&amp; cql == null)
-			throw new NoApplicableCodeEx("Missing filter expression or cql query");
+	if (version == null)
+	    throw new MissingParameterValueEx("version");
 
-		String version = constr.getAttributeValue("version");
+	if (filter != null &amp;&amp; !version.equals(Csw.FILTER_VERSION))
+	    throw new InvalidParameterValueEx("version", version);
 
-		if (version == null)
-			throw new MissingParameterValueEx("version");
+	return (filter != null) ? filter : convertCQL(cql.getText(), context);
+    }
 
-		if (filter != null &amp;&amp; !version.equals(Csw.FILTER_VERSION))
-			throw new InvalidParameterValueEx("version", version);
+    //---------------------------------------------------------------------------
 
-		return (filter != null) ? filter : convertCQL(cql.getText(), context);
-	}
+    private List&lt;SortField&gt; getSortFields(Element request)
+    {
+	ArrayList&lt;SortField&gt; al = new ArrayList&lt;SortField&gt;();
 
-	//---------------------------------------------------------------------------
+	Element query = request.getChild("Query", Csw.NAMESPACE_CSW);
 
-	private List&lt;SortField&gt; getSortFields(Element request)
-	{
-		ArrayList&lt;SortField&gt; al = new ArrayList&lt;SortField&gt;();
+	if (query == null)
+	    return al;
 
-		Element query = request.getChild("Query", Csw.NAMESPACE_CSW);
+	Element sortBy = query.getChild("SortBy", Csw.NAMESPACE_OGC);
 
-		if (query == null)
-			return al;
+	if (sortBy == null)
+	    return al;
 
-		Element sortBy = query.getChild("SortBy", Csw.NAMESPACE_OGC);
+	List list = sortBy.getChildren();
 
-		if (sortBy == null)
-			return al;
+	for(int i=0; i&lt;list.size(); i++)
+	    {
+		Element el = (Element) list.get(i);
 
-		List list = sortBy.getChildren();
+		String field = el.getChildText("PropertyName", Csw.NAMESPACE_OGC);
+		String order = el.getChildText("SortOrder",    Csw.NAMESPACE_OGC);
 
-		for(int i=0; i&lt;list.size(); i++)
-		{
-			Element el = (Element) list.get(i);
+		al.add(new SortField(field, "DESC".equals(order)));
+	    }
 
-			String field = el.getChildText("PropertyName", Csw.NAMESPACE_OGC);
-			String order = el.getChildText("SortOrder",    Csw.NAMESPACE_OGC);
+	return al;
+    }
 
-			al.add(new SortField(field, "DESC".equals(order)));
-		}
+    //---------------------------------------------------------------------------
 
-		return al;
-	}
+    private Element convertCQL(String cql, ServiceContext context) throws CatalogException
+    {
+	String xmlCql = getCqlXmlString(cql, context);
+	context.debug("Received CQL:\n"+ xmlCql);
 
-	//---------------------------------------------------------------------------
+	Element xml        = getCqlXmlElement(xmlCql, context);
+	String  styleSheet = context.getAppPath() + Geonet.Path.CSW + Geonet.File.CQL_TO_FILTER;
 
-	private Element convertCQL(String cql, ServiceContext context) throws CatalogException
-	{
-		String xmlCql = getCqlXmlString(cql, context);
-		context.debug("Received CQL:\n"+ xmlCql);
+	Element filter = getFilter(xml, styleSheet, context);
+	context.debug("Transformed CQL gives the following filter:\n"+Xml.getString(filter));
 
-		Element xml        = getCqlXmlElement(xmlCql, context);
-		String  styleSheet = context.getAppPath() + Geonet.Path.CSW + Geonet.File.CQL_TO_FILTER;
+	return filter;
+    }
 
-		Element filter = getFilter(xml, styleSheet, context);
-		context.debug("Transformed CQL gives the following filter:\n"+Xml.getString(filter));
+    //---------------------------------------------------------------------------
 
-		return filter;
-	}
+    private String getCqlXmlString(String cql, ServiceContext context) throws InvalidParameterValueEx
+    {
+	try
+	    {
+		CQLParser parser = new CQLParser();
+		CQLNode   root   = parser.parse(cql);
 
-	//---------------------------------------------------------------------------
+		return root.toXCQL(0);
+	    }
+	catch (Exception e)
+	    {
+		context.error("Error parsing CQL : "+ e);
+		context.error("  (C) CQL is :\n"+ cql);
 
-	private String getCqlXmlString(String cql, ServiceContext context) throws InvalidParameterValueEx
-	{
-		try
-		{
-			CQLParser parser = new CQLParser();
-			CQLNode   root   = parser.parse(cql);
+		throw new InvalidParameterValueEx("CqlText", cql);
+	    }
+    }
 
-			return root.toXCQL(0);
-		}
-		catch (Exception e)
-		{
-			context.error("Error parsing CQL : "+ e);
-			context.error("  (C) CQL is :\n"+ cql);
+    //---------------------------------------------------------------------------
 
-			throw new InvalidParameterValueEx("CqlText", cql);
-		}
-	}
+    private Element getCqlXmlElement(String cqlXml, ServiceContext context) throws NoApplicableCodeEx
+    {
+	try
+	    {
+		return Xml.loadString(cqlXml, false);
+	    }
+	catch (Exception e)
+	    {
+		context.error("Bad CQL XML : "+ e);
+		context.error("  (C) CQL XML is :\n"+ cqlXml);
 
-	//---------------------------------------------------------------------------
+		throw new NoApplicableCodeEx("Bad CQL XML : "+ cqlXml);
+	    }
+    }
 
-	private Element getCqlXmlElement(String cqlXml, ServiceContext context) throws NoApplicableCodeEx
-	{
-		try
-		{
-			return Xml.loadString(cqlXml, false);
-		}
-		catch (Exception e)
-		{
-			context.error("Bad CQL XML : "+ e);
-			context.error("  (C) CQL XML is :\n"+ cqlXml);
+    //---------------------------------------------------------------------------
 
-			throw new NoApplicableCodeEx("Bad CQL XML : "+ cqlXml);
-		}
-	}
+    private Element getFilter(Element cql, String styleSheet, ServiceContext context) throws NoApplicableCodeEx
+    {
+	try
+	    {
+		return Xml.transform(cql, styleSheet);
+	    }
+	catch (Exception e)
+	    {
+		context.error("Error during CQL to Filter conversion : "+ e);
+		context.error("  (C) StackTrace\n"+ Util.getStackTrace(e));
 
-	//---------------------------------------------------------------------------
+		throw new NoApplicableCodeEx("Error during CQL to Filter conversion : "+ e);
+	    }
+    }
 
-	private Element getFilter(Element cql, String styleSheet, ServiceContext context) throws NoApplicableCodeEx
-	{
-		try
-		{
-			return Xml.transform(cql, styleSheet);
-		}
-		catch (Exception e)
-		{
-			context.error("Error during CQL to Filter conversion : "+ e);
-			context.error("  (C) StackTrace\n"+ Util.getStackTrace(e));
+    //---------------------------------------------------------------------------
 
-			throw new NoApplicableCodeEx("Error during CQL to Filter conversion : "+ e);
-		}
-	}
+    private Set&lt;String&gt; getElementNames(Element query)
+    {
+	if (query == null)
+	    return null;
 
-	//---------------------------------------------------------------------------
+	Iterator i = query.getChildren("ElementName", query.getNamespace()).iterator();
 
-	private Set&lt;String&gt; getElementNames(Element query)
-	{
-		if (query == null)
-			return null;
+	if (!i.hasNext())
+	    return null;
 
-		Iterator i = query.getChildren("ElementName", query.getNamespace()).iterator();
+	HashSet&lt;String&gt; hs = new HashSet&lt;String&gt;();
 
-		if (!i.hasNext())
-			return null;
+	while (i.hasNext())
+	    {
+		Element elem = (Element) i.next();
 
-		HashSet&lt;String&gt; hs = new HashSet&lt;String&gt;();
+		hs.add(elem.getText());
+	    }
 
-		while (i.hasNext())
-		{
-			Element elem = (Element) i.next();
-
-			hs.add(elem.getText());
-		}
-
-		return hs;
-	}
+	return hs;
+    }
 }
 
 //=============================================================================

Modified: trunk/src/org/fao/geonet/kernel/csw/services/getrecords/CatalogSearcher.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/csw/services/getrecords/CatalogSearcher.java	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/src/org/fao/geonet/kernel/csw/services/getrecords/CatalogSearcher.java	2008-04-27 20:54:39 UTC (rev 1283)
@@ -95,7 +95,7 @@
 			context.error("Error while searching metadata ");
 			context.error("  (C) StackTrace:\n"+ Util.getStackTrace(e));
 
-			throw new NoApplicableCodeEx("Rised exception while searching metadata : "+ e);
+			throw new NoApplicableCodeEx("Raised exception while searching metadata : "+ e);
 		}
 	}
 

Modified: trunk/src/org/fao/geonet/kernel/csw/services/getrecords/FieldMapper.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/csw/services/getrecords/FieldMapper.java	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/src/org/fao/geonet/kernel/csw/services/getrecords/FieldMapper.java	2008-04-27 20:54:39 UTC (rev 1283)
@@ -32,115 +32,117 @@
 
 class FieldMapper
 {
-	//---------------------------------------------------------------------------
-	//---
-	//--- API methods
-	//---
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
+    //---
+    //--- API methods
+    //---
+    //---------------------------------------------------------------------------
 
-	public static String map(String field)
-	{
-		return hmMapping.get(getAbsolute(field));
-	}
+    public static String map(String field)
+    {
+	return hmMapping.get(getAbsolute(field));
+    }
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	public static Iterable&lt;String&gt; getMappedFields()
-	{
-		ArrayList&lt;String&gt; al = new ArrayList&lt;String&gt;();
+    public static Iterable&lt;String&gt; getMappedFields()
+    {
+	ArrayList&lt;String&gt; al = new ArrayList&lt;String&gt;();
 
-		for(String[] couple : mapping)
-			al.add(couple[1]);
+	for(String[] couple : mapping)
+	    al.add(couple[1]);
 
-		return al;
-	}
+	return al;
+    }
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	public static boolean match(Element elem, Set&lt;String&gt; elemNames)
-	{
-		String name = elem.getQualifiedName();
+    public static boolean match(Element elem, Set&lt;String&gt; elemNames)
+    {
+	String name = elem.getQualifiedName();
 
-		for (String field : elemNames)
-			if (getAbsolute(field).equals(name))
-				return true;
+	for (String field : elemNames)
+	    if (getAbsolute(field).equals(name))
+		return true;
 
-		return false;
-	}
+	return false;
+    }
 
-	//---------------------------------------------------------------------------
-	//---
-	//--- Private methods
-	//---
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
+    //---
+    //--- Private methods
+    //---
+    //---------------------------------------------------------------------------
 
-	private static String getAbsolute(String field)
-	{
-		if (field.startsWith("./"))
-			return field.substring(2);
+    private static String getAbsolute(String field)
+    {
+	if (field.startsWith("./"))
+	    return field.substring(2);
 
-		return field;
-	}
+	return field;
+    }
 
-	//---------------------------------------------------------------------------
-	//---
-	//--- Variables
-	//---
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
+    //---
+    //--- Variables
+    //---
+    //---------------------------------------------------------------------------
 
-	private static String[][] mapping =
-	{
-		{ "dc:identifier", "identifier" },
-		{ "dc:title",      "title"      },
-		{ "dct:abstract",  "abstract"   },
-		{ "dct:modified",  "changeDate" },
-		{ "dc:subject",    "keyword"    },
-		{ "dc:type",       "type"       },
-		{ "dct:spatial",   "crs"        },
-		{ "any",           "any"        },
-		{ "dc:format",     "format"     },
-		{ "dc:relation",   "relation"   },
-		{ "dct:spatial",   "spatial"    },
+    private static String[][] mapping =
+    {
+	{ "dc:identifier", "identifier" },
+	{ "dc:title",      "title"      },
+	{ "dct:abstract",  "abstract"   },
+	{ "dct:modified",  "changeDate" },
+	{ "dc:subject",    "keyword"    },
+	{ "dc:type",       "type"       },
+	{ "dct:spatial",   "crs"        },
+	{ "csw:AnyText",   "any"        },
+	{ "any",           "any"        },
+	{ "dc:format",     "format"     },
+	{ "dc:relation",   "relation"   },
+	{ "dct:spatial",   "spatial"    },
+	{ "dc:date",       "createDate" },
 
-		{ "FileIdentifier",        "fileId"      },
-		{ "Language",              "language"    },
-		{ "AlternateTitle",        "altTitle"    },
-		{ "CreationDate",          "createDate"  },
-		{ "OrganisationName",      "orgName"     },
-		{ "HasSecurityConstraints","secConstr"   },
-		{ "HierarchyLevelName",    "levelName"   },
-		{ "ParentIdentifier",      "parentId"    },
-		{ "KeywordType",           "keywordType" },
+	{ "FileIdentifier",        "fileId"      },
+	{ "Language",              "language"    },
+	{ "AlternateTitle",        "altTitle"    },
+	{ "CreationDate",          "createDate"  },
+	{ "OrganisationName",      "orgName"     },
+	{ "HasSecurityConstraints","secConstr"   },
+	{ "HierarchyLevelName",    "levelName"   },
+	{ "ParentIdentifier",      "parentId"    },
+	{ "KeywordType",           "keywordType" },
 
-		{ "TopicCategory",            "topicCat"        },
-		{ "DatasetLanguage",          "datasetLang"     },
-		{ "GeographicDescriptionCode","geoDescCode"     },
-		{ "TempExtent_begin",         "tempExtentBegin" },
-		{ "TempExtent_end",           "tempExtentEnd"   },
-		{ "Denominator",              "denominator"     },
-		{ "DistanceValue",            "distanceVal"     },
-		{ "DistanceUOM",              "distanceUom"     },
+	{ "TopicCategory",            "topicCat"        },
+	{ "DatasetLanguage",          "datasetLang"     },
+	{ "GeographicDescriptionCode","geoDescCode"     },
+	{ "TempExtent_begin",         "tempExtentBegin" },
+	{ "TempExtent_end",           "tempExtentEnd"   },
+	{ "Denominator",              "denominator"     },
+	{ "DistanceValue",            "distanceVal"     },
+	{ "DistanceUOM",              "distanceUom"     },
 
-		//--- these are needed just to avoid a warning when converting field names
-		//--- from CSW names -&gt; lucene names
+	//--- these are needed just to avoid a warning when converting field names
+	//--- from CSW names -&gt; lucene names
 
-		{ "northBL", "northBL" },
-		{ "southBL", "southBL" },
-		{ "eastBL",  "eastBL"  },
-		{ "westBL",  "westBL"  }
-	};
+	{ "northBL", "northBL" },
+	{ "southBL", "southBL" },
+	{ "eastBL",  "eastBL"  },
+	{ "westBL",  "westBL"  }
+    };
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	private static HashMap&lt;String, String&gt; hmMapping = new HashMap&lt;String, String&gt;();
+    private static HashMap&lt;String, String&gt; hmMapping = new HashMap&lt;String, String&gt;();
 
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
 
-	static
-	{
-		for(String[] couple : mapping)
-			hmMapping.put(couple[0], couple[1]);
-	}
+    static
+    {
+	for(String[] couple : mapping)
+	    hmMapping.put(couple[0], couple[1]);
+    }
 }
 
 //==============================================================================

Modified: trunk/src/org/fao/geonet/kernel/csw/services/getrecords/SearchController.java
===================================================================
--- trunk/src/org/fao/geonet/kernel/csw/services/getrecords/SearchController.java	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/src/org/fao/geonet/kernel/csw/services/getrecords/SearchController.java	2008-04-27 20:54:39 UTC (rev 1283)
@@ -45,121 +45,131 @@
 
 public class SearchController
 {
-	//---------------------------------------------------------------------------
-	//---
-	//--- Single public method to perform the general search tasks
-	//---
-	//---------------------------------------------------------------------------
+    //---------------------------------------------------------------------------
+    //---
+    //--- Single public method to perform the general search tasks
+    //---
+    //---------------------------------------------------------------------------
 
-	public Element search(ServiceContext context, int startPos, int maxRecords, int hopCount,
-								 ResultType resultType, OutputSchema outSchema, ElementSetName setName,
-								 Set&lt;TypeName&gt; typeNames, Element filterExpr, List&lt;SortField&gt; sortFields,
-								 Set&lt;String&gt; elemNames) throws CatalogException
-	{
-		Element results = new Element("SearchResults", Csw.NAMESPACE_CSW);
+    public Element search(ServiceContext context, int startPos, int maxRecords, int hopCount,
+			  ResultType resultType, OutputSchema outSchema, ElementSetName setName,
+			  Set&lt;TypeName&gt; typeNames, Element filterExpr, List&lt;SortField&gt; sortFields,
+			  Set&lt;String&gt; elemNames) throws CatalogException
+    {
+	Element results = new Element("SearchResults", Csw.NAMESPACE_CSW);
 
-		CatalogSearcher searcher = new CatalogSearcher();
+	CatalogSearcher searcher = new CatalogSearcher();
 
-		List&lt;ResultItem&gt; searchResults = searcher.search(context, filterExpr, typeNames, sortFields);
+	List&lt;ResultItem&gt; searchResults = searcher.search(context, filterExpr, typeNames, sortFields);
 
-		int counter = 0;
+	int counter = 0;
 
-		if (resultType == ResultType.RESULTS)
-			for (int i=startPos; (i&lt;startPos+maxRecords) &amp;&amp; (i&lt;=searchResults.size()); i++)
-			{
-				counter++;
+	if (resultType == ResultType.RESULTS)
+	    for (int i=startPos; (i&lt;startPos+maxRecords) &amp;&amp; (i&lt;=searchResults.size()); i++)
+		{
+		    counter++;
 
-				String  id = searchResults.get(i -1).getID();
-				Element md = retrieveMetadata(context, id, setName, outSchema, elemNames);
+		    String  id = searchResults.get(i -1).getID();
+		    Element md = retrieveMetadata(context, id, setName, outSchema, elemNames);
 
-				if (md == null)
-					context.warning("SearchController : Metadata not found or invalid schema : "+ id);
-				else
-					results.addContent(md);
-			}
+		    if (md == null)
+			context.warning("SearchController : Metadata not found or invalid schema : "+ id);
+		    else
+			results.addContent(md);
+		}
 
-		results.setAttribute("numberOfRecordsMatched",  searchResults.size() +"");
-		results.setAttribute("numberOfRecordsReturned", counter +"");
-		results.setAttribute("elementSet",              setName.toString());
+	results.setAttribute("numberOfRecordsMatched",  searchResults.size() +"");
+	results.setAttribute("numberOfRecordsReturned", counter +"");
+	results.setAttribute("elementSet",              setName.toString());
 
-		return results;
-	}
+	if (searchResults.size() &gt; counter)
+	    {
+		results.setAttribute("nextRecord", counter + startPos + "");
+	    } 
+	else 
+	    {
+		results.setAttribute("nextRecord","0");
+	    }
 
-	//---------------------------------------------------------------------------
+	return results;
+    }
 
-	private Element retrieveMetadata(ServiceContext context, String id, ElementSetName setName,
-												OutputSchema outSchema, Set&lt;String&gt; elemNames) throws CatalogException
-	{
-		try
-		{
-			Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
+    //---------------------------------------------------------------------------
 
-			//--- get metadata from DB
+    private Element retrieveMetadata(ServiceContext context, String id,  ElementSetName setName,
+				     OutputSchema outSchema, Set&lt;String&gt; elemNames)
+	throws CatalogException
+    {
+	try
+	    {
+		Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
 
-			Element  res = dbms.select("SELECT schemaId, data FROM Metadata WHERE id="+id);
-			Iterator i   = res.getChildren().iterator();
+		//--- get metadata from DB
 
-			dbms.commit();
+		Element  res = dbms.select("SELECT schemaId, data FROM Metadata WHERE id="+id);
+		Iterator i   = res.getChildren().iterator();
 
-			if (!i.hasNext())
-				return null;
+		dbms.commit();
 
-			Element record = (Element) i.next();
+		if (!i.hasNext())
+		    return null;
 
-			String schema = record.getChildText("schemaid");
-			String data   = record.getChildText("data");
+		Element record = (Element) i.next();
 
-			//--- skip metadata with wrong schemas
+		String schema = record.getChildText("schemaid");
+		String data   = record.getChildText("data");
 
-			if (schema.equals("fgdc-std") || schema.equals("dublin-core") || schema.equals("iso19115"))
-				if (outSchema != OutputSchema.OGC_CORE)
-					return null;
+		//--- skip metadata with wrong schemas
 
-			Element md = Xml.loadString(data, false);
+		if (schema.equals("fgdc-std") || schema.equals("dublin-core") || schema.equals("iso19115"))
+		    if (outSchema != OutputSchema.OGC_CORE)
+			return null;
 
-			//--- apply stylesheet according to setName and schema
+		Element md = Xml.loadString(data, false);
 
-			String FS         = File.separator;
-			String schemaDir  = context.getAppPath() +"xml"+ FS +"csw"+ FS +"schemas"+ FS +schema+ FS;
-			String prefix     = (outSchema == OutputSchema.OGC_CORE) ? "ogc" : "iso";
-			String styleSheet = schemaDir + prefix +"-"+ setName +".xsl";
+		//--- apply stylesheet according to setName and schema
 
-			md = Xml.transform(md, styleSheet);
+		String FS         = File.separator;
+		String schemaDir  = context.getAppPath() +"xml"+ FS +"csw"+ FS +"schemas"+ FS +schema+ FS;
+		String prefix     = (outSchema == OutputSchema.OGC_CORE) ? "ogc" : "iso";
+		String styleSheet = schemaDir + prefix +"-"+ setName +".xsl";
 
-			//--- needed to detach md from the document
+		md = Xml.transform(md, styleSheet);
 
-			md.detach();
+		//--- needed to detach md from the document
 
-			//--- if the client has specified some ElementNames, then we remove the unwanted children
+		md.detach();
 
-			if (elemNames != null)
-				removeElements(md, elemNames);
+		//--- if the client has specified some ElementNames, then we remove the unwanted children
 
-			return md;
-		}
-		catch (Exception e)
-		{
-			context.error("Error while getting metadata with id : "+ id);
-			context.error("  (C) StackTrace:\n"+ Util.getStackTrace(e));
+		if (elemNames != null)
+		    removeElements(md, elemNames);
 
-			throw new NoApplicableCodeEx("Rised exception while getting metadata :"+ e);
-		}
-	}
+		return md;
+	    }
+	catch (Exception e)
+	    {
+		context.error("Error while getting metadata with id : "+ id);
+		context.error("  (C) StackTrace:\n"+ Util.getStackTrace(e));
 
-	//---------------------------------------------------------------------------
+		throw new NoApplicableCodeEx("Raised exception while getting metadata :"+ e);
+	    }
+    }
 
-	private void removeElements(Element md, Set&lt;String&gt; elemNames)
-	{
-		Iterator i=md.getChildren().iterator();
+    //---------------------------------------------------------------------------
 
-		while (i.hasNext())
-		{
-			Element elem = (Element) i.next();
+    private void removeElements(Element md, Set&lt;String&gt; elemNames)
+    {
+	Iterator i=md.getChildren().iterator();
 
-			if (!FieldMapper.match(elem, elemNames))
-				i.remove();
-		}
-	}
+	while (i.hasNext())
+	    {
+		Element elem = (Element) i.next();
+
+		if (!FieldMapper.match(elem, elemNames))
+		    i.remove();
+	    }
+    }
 }
 
 //=============================================================================

Modified: trunk/web/geonetwork/xml/csw/capabilities.xml
===================================================================
--- trunk/web/geonetwork/xml/csw/capabilities.xml	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/capabilities.xml	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,9 +1,9 @@
 &lt;?xml version="1.0" encoding="UTF-8" ?&gt;
 
-&lt;csw:Capabilities version="2.0.1"
+&lt;csw:Capabilities version="2.0.2"
 						xmlns:ows  ="<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>"
 						xmlns:ogc  ="<a href="http://www.opengis.net/ogc" target="_new">http://www.opengis.net/ogc</a>"
-						xmlns:csw  ="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+						xmlns:csw  ="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 						xmlns:gml  ="<a href="http://www.opengis.net/gml" target="_new">http://www.opengis.net/gml</a>"
 						xmlns:xlink="<a href="http://www.w3.org/1999/xlink" target="_new">http://www.w3.org/1999/xlink</a>"&gt;
 
@@ -16,7 +16,7 @@
 		
 		&lt;ows:Abstract&gt;
 			GeoNetwork catalog service conform to the HTTP protocol binding 
- of the OpenGIS Catalogue Service specification version 2.0.1
+ of the OpenGIS Catalogue Service specification version 2.0.2
 		&lt;/ows:Abstract&gt;
 	
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - -  --&gt;	
@@ -33,7 +33,7 @@
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - -  --&gt;	
 		
 		&lt;ows:ServiceType&gt;CSW&lt;/ows:ServiceType&gt;
-		&lt;ows:ServiceTypeVersion&gt;2.0.1&lt;/ows:ServiceTypeVersion&gt;
+		&lt;ows:ServiceTypeVersion&gt;2.0.2&lt;/ows:ServiceTypeVersion&gt;
 		&lt;ows:Fees&gt;NONE&lt;/ows:Fees&gt;
 		&lt;ows:AccessConstraints&gt;NONE&lt;/ows:AccessConstraints&gt;
 	&lt;/ows:ServiceIdentification&gt;
@@ -92,6 +92,10 @@
 				&lt;ows:Value&gt;Filter_Capabilities&lt;/ows:Value&gt;
 			&lt;/ows:Parameter&gt;
 			
+			&lt;ows:Constraint name="PostEncoding"&gt;
+				&lt;ows:Value&gt;XML&lt;/ows:Value&gt;
+			&lt;/ows:Constraint&gt;
+			
 		&lt;/ows:Operation&gt;
 		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - -  --&gt;	
@@ -104,20 +108,27 @@
 				&lt;/ows:HTTP&gt;
 			&lt;/ows:DCP&gt;
 						
-			&lt;ows:Parameter name="typeName"&gt;
+			&lt;ows:Parameter name="TypeName"&gt;
+				&lt;ows:Value&gt;csw:Record&lt;/ows:Value&gt;
 				&lt;ows:Value&gt;csw:application&lt;/ows:Value&gt;
 				&lt;ows:Value&gt;csw:service&lt;/ows:Value&gt;
 				&lt;ows:Value&gt;csw:dataset&lt;/ows:Value&gt;
 				&lt;ows:Value&gt;csw:datasetcollection&lt;/ows:Value&gt;
 			&lt;/ows:Parameter&gt;
 			
-			&lt;ows:Parameter name="outputFormat"&gt;
+			&lt;ows:Parameter name="OutputFormat"&gt;
 				&lt;ows:Value&gt;application/xml&lt;/ows:Value&gt;
 			&lt;/ows:Parameter&gt;
 			
-			&lt;ows:Parameter name="schemaLanguage"&gt;
-				&lt;ows:Value&gt;<a href="http://www.w3.org/XML/Schema&lt;/ows:Value" target="_new">http://www.w3.org/XML/Schema&lt;/ows:Value</a>&gt;
+			&lt;ows:Parameter name="SchemaLanguage"&gt;
+				&lt;ows:Value&gt;<a href="http://www.w3.org/TR/xmlschema-1/&lt;/ows:Value" target="_new">http://www.w3.org/TR/xmlschema-1/&lt;/ows:Value</a>&gt;
+			&lt;!--
+				&lt;ows:Value&gt;<a href="http://www.w3.org/XML/Schema&lt;/ows:Value" target="_new">http://www.w3.org/XML/Schema&lt;/ows:Value</a>&gt;--&gt;
 			&lt;/ows:Parameter&gt;
+			
+			&lt;ows:Constraint name="PostEncoding"&gt;
+				&lt;ows:Value&gt;XML&lt;/ows:Value&gt;
+			&lt;/ows:Constraint&gt;
 		&lt;/ows:Operation&gt;
 
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - -  --&gt;	
@@ -140,6 +151,28 @@
 					&lt;ows:Post xlink:href="<a href="http://$HOST:$PORT$SERVLET/srv/en/csw" target="_new">http://$HOST:$PORT$SERVLET/srv/en/csw</a>"  /&gt;
 				&lt;/ows:HTTP&gt;
 			&lt;/ows:DCP&gt;
+			
+			&lt;ows:Parameter name="ResultType"&gt;
+				 &lt;ows:Value&gt;hits&lt;/ows:Value&gt;
+				 &lt;ows:Value&gt;results&lt;/ows:Value&gt;
+				 &lt;ows:Value&gt;validate&lt;/ows:Value&gt;
+			&lt;/ows:Parameter&gt;
+
+			&lt;ows:Parameter name="OutputFormat"&gt;
+			        &lt;ows:Value&gt;application/xml&lt;/ows:Value&gt;
+			&lt;/ows:Parameter&gt;
+
+			&lt;ows:Parameter name="OutputSchema"&gt;
+				&lt;ows:Value&gt;<a href="http://www.opengis.net/cat/csw/2.0.2&lt;/ows:Value" target="_new">http://www.opengis.net/cat/csw/2.0.2&lt;/ows:Value</a>&gt;
+			&lt;/ows:Parameter&gt;
+
+			&lt;ows:Parameter name="TypeNames"&gt;
+				&lt;ows:Value&gt;csw:Record&lt;/ows:Value&gt;
+			&lt;/ows:Parameter&gt;
+
+			&lt;ows:Constraint name="PostEncoding"&gt;
+				&lt;ows:Value&gt;XML&lt;/ows:Value&gt;
+			&lt;/ows:Constraint&gt;
 		&lt;/ows:Operation&gt;
 	
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - -  --&gt;	
@@ -151,6 +184,30 @@
 					&lt;ows:Post xlink:href="<a href="http://$HOST:$PORT$SERVLET/srv/en/csw" target="_new">http://$HOST:$PORT$SERVLET/srv/en/csw</a>"  /&gt;
 				&lt;/ows:HTTP&gt;
 			&lt;/ows:DCP&gt;
+			
+			&lt;ows:Parameter name="OutputSchema"&gt;
+				&lt;ows:Value&gt;<a href="http://www.opengis.net/cat/csw/2.0.2&lt;/ows:Value" target="_new">http://www.opengis.net/cat/csw/2.0.2&lt;/ows:Value</a>&gt;
+			&lt;/ows:Parameter&gt;
+
+			&lt;ows:Parameter name="OutputFormat"&gt;
+				&lt;ows:Value&gt;application/xml&lt;/ows:Value&gt;
+			&lt;/ows:Parameter&gt;
+
+			&lt;ows:Parameter name="ResultType"&gt;
+				 &lt;ows:Value&gt;hits&lt;/ows:Value&gt;
+				 &lt;ows:Value&gt;results&lt;/ows:Value&gt;
+				 &lt;ows:Value&gt;validate&lt;/ows:Value&gt;
+			&lt;/ows:Parameter&gt;
+
+			&lt;ows:Parameter name="ElementSetName"&gt;
+				 &lt;ows:Value&gt;brief&lt;/ows:Value&gt;
+				 &lt;ows:Value&gt;summary&lt;/ows:Value&gt;
+				 &lt;ows:Value&gt;full&lt;/ows:Value&gt;
+			&lt;/ows:Parameter&gt;
+
+			&lt;ows:Constraint name="PostEncoding"&gt;
+				&lt;ows:Value&gt;XML&lt;/ows:Value&gt;
+			&lt;/ows:Constraint&gt;
 		&lt;/ows:Operation&gt;
 	
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - -  --&gt;	
@@ -180,13 +237,13 @@
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - -  --&gt;	
 		
 		&lt;ows:Parameter name="service"&gt;
-			&lt;ows:Value&gt;<a href="http://www.opengis.net/cat/csw&lt;/ows:Value" target="_new">http://www.opengis.net/cat/csw&lt;/ows:Value</a>&gt;
+			&lt;ows:Value&gt;<a href="http://www.opengis.net/cat/csw/2.0.2&lt;/ows:Value" target="_new">http://www.opengis.net/cat/csw/2.0.2&lt;/ows:Value</a>&gt;
 		&lt;/ows:Parameter&gt;
 		
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - -  --&gt;	
 		
 		&lt;ows:Parameter name="version"&gt;
-			&lt;ows:Value&gt;2.0.1&lt;/ows:Value&gt;
+			&lt;ows:Value&gt;2.0.2&lt;/ows:Value&gt;
 		&lt;/ows:Parameter&gt;		
 	&lt;/ows:OperationsMetadata&gt;
 

Modified: trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-brief.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-brief.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-brief.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,8 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
-
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
-										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"&gt;
+		xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
+		xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"&gt;
 
 	&lt;xsl:template match="simpledc"&gt;
 		&lt;csw:BriefRecord&gt;
@@ -10,10 +9,16 @@
 				&lt;dc:identifier&gt;&lt;xsl:value-of select="."/&gt;&lt;/dc:identifier&gt;
 			&lt;/xsl:for-each&gt;
 
+&lt;!-- Change for CSW 2.0.2 - title is mandatory --&gt;
+			&lt;dc:title&gt;
+			&lt;xsl:for-each select="dc:title"&gt;
+				&lt;xsl:value-of select="."/&gt;
+			&lt;/xsl:for-each&gt;
+			&lt;/dc:title&gt;
+
 			&lt;xsl:for-each select="dc:type"&gt;
 				&lt;dc:type&gt;&lt;xsl:value-of select="."/&gt;&lt;/dc:type&gt;
 			&lt;/xsl:for-each&gt;
 		&lt;/csw:BriefRecord&gt;
 	&lt;/xsl:template&gt;
-
 &lt;/xsl:stylesheet&gt;

Modified: trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-full.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-full.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-full.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,9 +1,9 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
-										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
-										xmlns:ows="<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>" &gt;
+		xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
+		xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
+		xmlns:ows="<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>" &gt;
 
 	&lt;xsl:template match="simpledc"&gt;
 		&lt;csw:Record&gt;

Modified: trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-summary.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-summary.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/dublin-core/ogc-summary.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,9 +1,8 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
-
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
-										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
-   									xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
+		xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
+		xmlns:dc="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
+		xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
 
 	&lt;!-- ================================================================= --&gt;
 
@@ -14,14 +13,17 @@
 				&lt;dc:identifier&gt;&lt;xsl:value-of select="."/&gt;&lt;/dc:identifier&gt;
 			&lt;/xsl:for-each&gt;
 
+&lt;!-- Change for CSW 2.0.2 - title is mandatory --&gt;
+			&lt;dc:title&gt;
+			&lt;xsl:for-each select="dc:title"&gt;
+				&lt;xsl:value-of select="."/&gt;
+			&lt;/xsl:for-each&gt;
+			&lt;/dc:title&gt;
+
 			&lt;xsl:for-each select="dc:type"&gt;
 				&lt;dc:type&gt;&lt;xsl:value-of select="."/&gt;&lt;/dc:type&gt;
 			&lt;/xsl:for-each&gt;
 
-			&lt;xsl:for-each select="dc:title"&gt;
-				&lt;dc:title&gt;&lt;xsl:value-of select="."/&gt;&lt;/dc:title&gt;
-			&lt;/xsl:for-each&gt;
-
 			&lt;xsl:for-each select="dc:subject"&gt;
 				&lt;dc:subject&gt;&lt;xsl:value-of select="."/&gt;&lt;/dc:subject&gt;
 			&lt;/xsl:for-each&gt;
@@ -35,9 +37,14 @@
 			&lt;/xsl:for-each&gt;
 
 			&lt;xsl:for-each select="dct:modified"&gt;
+				&lt;dct:modified&gt;&lt;xsl:value-of select="substring-before(.,'T')"/&gt;&lt;/dct:modified&gt;
+			&lt;/xsl:for-each&gt;
+
+&lt;!--
+			&lt;xsl:for-each select="dct:modified"&gt;
 				&lt;dct:modified&gt;&lt;xsl:value-of select="."/&gt;&lt;/dct:modified&gt;
 			&lt;/xsl:for-each&gt;
-
+--&gt;
 			&lt;xsl:for-each select="dct:abstract"&gt;
 				&lt;dct:abstract&gt;&lt;xsl:value-of select="."/&gt;&lt;/dct:abstract&gt;
 			&lt;/xsl:for-each&gt;

Modified: trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-brief.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-brief.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-brief.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
 										xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
 

Modified: trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-full.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-full.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-full.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
 										xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"
 										xmlns:ows="<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>"&gt;

Modified: trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-summary.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-summary.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/fgdc-std/ogc-summary.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
 										xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
 

Modified: trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-brief.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-brief.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-brief.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
 										xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
 

Modified: trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-full.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-full.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-full.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>" 
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>" 
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>" 
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>" 
 										xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>" 
 										xmlns:ows="<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>"&gt;

Modified: trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-summary.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-summary.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/iso19115/ogc-summary.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
 										xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"&gt;
 

Modified: trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-brief.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-brief.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-brief.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
 										xmlns:ows="<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>"&gt;
 

Modified: trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-full.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-full.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-full.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
 										xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"
 										xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"

Modified: trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-summary.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-summary.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/iso19139/iso-summary.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"
 										xmlns:ows="<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>"&gt;
 

Modified: trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-brief.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-brief.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-brief.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
 										xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"
 										xmlns:gmd="<a href="http://www.isotc211.org/2005/gmd" target="_new">http://www.isotc211.org/2005/gmd</a>"&gt;

Modified: trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-full.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-full.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-full.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
 										xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"
 										xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"

Modified: trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-summary.xsl
===================================================================
--- trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-summary.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/csw/schemas/iso19139/ogc-summary.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -1,7 +1,7 @@
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
 &lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" target="_new">http://www.w3.org/1999/XSL/Transform</a>"
-										xmlns:csw="<a href="http://www.opengis.net/cat/csw" target="_new">http://www.opengis.net/cat/csw</a>"
+										xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
 										xmlns:dc ="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>"
 										xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"
 										xmlns:gco="<a href="http://www.isotc211.org/2005/gco" target="_new">http://www.isotc211.org/2005/gco</a>"

Modified: trunk/web/geonetwork/xml/schemas/dublin-core/dc.xsd
===================================================================
--- trunk/web/geonetwork/xml/schemas/dublin-core/dc.xsd	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/schemas/dublin-core/dc.xsd	2008-04-27 20:54:39 UTC (rev 1283)
@@ -41,8 +41,8 @@
   &lt;xs:import namespace="<a href="http://www.w3.org/XML/1998/namespace" target="_new">http://www.w3.org/XML/1998/namespace</a>"
              schemaLocation="xml.xsd"/&gt;
 
-  &lt;xs:import namespace="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"
-              schemaLocation="dcterms.xsd"/&gt;
+  &lt;!--xs:import namespace="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>"
+              schemaLocation="dcterms.xsd"/--&gt;
 
 
   &lt;xs:complexType name="SimpleLiteral"&gt;

Modified: trunk/web/geonetwork/xml/schemas/dublin-core/index-fields.xsl
===================================================================
--- trunk/web/geonetwork/xml/schemas/dublin-core/index-fields.xsl	2008-04-27 19:33:57 UTC (rev 1282)
+++ trunk/web/geonetwork/xml/schemas/dublin-core/index-fields.xsl	2008-04-27 20:54:39 UTC (rev 1283)
@@ -42,6 +42,11 @@
 			&lt;xsl:for-each select="/simpledc/dct:abstract"&gt;
 				&lt;Field name="abstract" string="{string(.)}" store="true" index="true" token="true"/&gt;
 			&lt;/xsl:for-each&gt;
+
+			&lt;xsl:for-each select="/simpledc/dc:date"&gt;
+			  &lt;Field name="createDate" string="{string(.)}" store="true" index="true" token="false"/&gt;
+			&lt;/xsl:for-each&gt;
+
 			
 			&lt;xsl:for-each select="/simpledc/dct:modified"&gt;
 				&lt;Field name="changeDate" string="{string(.)}" store="true" index="true" token="false"/&gt;

Added: trunk/web/geonetwork/xml/validation/csw/2.0.2/csw-2.0.2.xsd
===================================================================
--- trunk/web/geonetwork/xml/validation/csw/2.0.2/csw-2.0.2.xsd	                        (rev 0)
+++ trunk/web/geonetwork/xml/validation/csw/2.0.2/csw-2.0.2.xsd	2008-04-27 20:54:39 UTC (rev 1283)
@@ -0,0 +1,820 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;xsd:schema id="csw-2.0.2"
+   targetNamespace="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
+   xmlns:csw="<a href="http://www.opengis.net/cat/csw/2.0.2" target="_new">http://www.opengis.net/cat/csw/2.0.2</a>"
+   xmlns:ogc="<a href="http://www.opengis.net/ogc" target="_new">http://www.opengis.net/ogc</a>" 
+   xmlns:ows="<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>" 
+   xmlns:dc="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>" 
+   xmlns:dct="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>" 
+   xmlns:xsd="<a href="http://www.w3.org/2001/XMLSchema" target="_new">http://www.w3.org/2001/XMLSchema</a>" 
+   elementFormDefault="qualified"
+   version="2.0.2"&gt;
+
+   &lt;xsd:annotation&gt;
+      &lt;xsd:documentation xml:lang="en"&gt;
+      This schema defines the request and response messages for the CSW 
+      operations specified in Clause 10 of OGC-07-006.
+      &lt;/xsd:documentation&gt;
+   &lt;/xsd:annotation&gt;
+   
+  &lt;xsd:import namespace="<a href="http://purl.org/dc/terms/" target="_new">http://purl.org/dc/terms/</a>" 
+    schemaLocation="./rec-dcterms.xsd" /&gt;
+  &lt;xsd:import namespace="<a href="http://purl.org/dc/elements/1.1/" target="_new">http://purl.org/dc/elements/1.1/</a>" 
+    schemaLocation="./rec-dcmes.xsd" /&gt;
+  &lt;xsd:import namespace="<a href="http://www.opengis.net/ows" target="_new">http://www.opengis.net/ows</a>" 
+    schemaLocation="../../ows/1.0.0/ows-1.0.0.xsd" /&gt;
+  &lt;xsd:import namespace="<a href="http://www.opengis.net/ogc" target="_new">http://www.opengis.net/ogc</a>"
+     schemaLocation="../../filter/1.1.0/filter-1.1.0.xsd"/&gt;
+
+   &lt;xsd:element name="AbstractRecord" id="AbstractRecord"
+                type="csw:AbstractRecordType" abstract="true" /&gt;
+   &lt;xsd:complexType name="AbstractRecordType" id="AbstractRecordType"
+                    abstract="true"/&gt;
+
+   &lt;xsd:element name="DCMIRecord" type="csw:DCMIRecordType"
+                substitutionGroup="csw:AbstractRecord"/&gt;
+   &lt;xsd:complexType name="DCMIRecordType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;
+            This type encapsulates all of the standard DCMI metadata terms,
+            including the Dublin Core refinements; these terms may be mapped
+            to the profile-specific information model.
+         &lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:complexContent&gt;
+         &lt;xsd:extension base="csw:AbstractRecordType"&gt;
+            &lt;xsd:sequence&gt;
+               &lt;xsd:group ref="dct:DCMI-terms"/&gt;
+            &lt;/xsd:sequence&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:complexContent&gt;
+   &lt;/xsd:complexType&gt;
+
+   &lt;xsd:element name="BriefRecord" type="csw:BriefRecordType"
+                substitutionGroup="csw:AbstractRecord"/&gt;
+   &lt;xsd:complexType name="BriefRecordType" final="#all"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;
+            This type defines a brief representation of the common record
+            format.  It extends AbstractRecordType to include only the
+             dc:identifier and dc:type properties.
+         &lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:complexContent&gt;
+         &lt;xsd:extension base="csw:AbstractRecordType"&gt;
+            &lt;xsd:sequence&gt;
+               &lt;xsd:element ref="dc:identifier"
+                            minOccurs="1" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="dc:title"
+                            minOccurs="1" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="dc:type"
+                            minOccurs="0"/&gt;
+               &lt;xsd:element ref="ows:BoundingBox"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+            &lt;/xsd:sequence&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:complexContent&gt;
+   &lt;/xsd:complexType&gt;
+
+   &lt;xsd:element name="SummaryRecord" type="csw:SummaryRecordType"
+                substitutionGroup="csw:AbstractRecord"/&gt;
+   &lt;xsd:complexType name="SummaryRecordType" final="#all"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;
+            This type defines a summary representation of the common record
+            format.  It extends AbstractRecordType to include the core
+            properties.
+         &lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:complexContent&gt;
+         &lt;xsd:extension base="csw:AbstractRecordType"&gt;
+            &lt;xsd:sequence&gt;
+               &lt;xsd:element ref="dc:identifier"
+                            minOccurs="1" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="dc:title"
+                            minOccurs="1" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="dc:type"
+                            minOccurs="0"/&gt;
+               &lt;xsd:element ref="dc:subject"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="dc:format"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="dc:relation"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="dct:modified"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="dct:abstract"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="dct:spatial"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="ows:BoundingBox"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+            &lt;/xsd:sequence&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:complexContent&gt;
+   &lt;/xsd:complexType&gt;
+
+   &lt;xsd:element name="Record" type="csw:RecordType"
+                substitutionGroup="csw:AbstractRecord"/&gt;
+   &lt;xsd:complexType name="RecordType" final="#all"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;
+            This type extends DCMIRecordType to add ows:BoundingBox;
+            it may be used to specify a spatial envelope for the
+            catalogued resource.
+         &lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:complexContent&gt;
+         &lt;xsd:extension base="csw:DCMIRecordType"&gt;
+            &lt;xsd:sequence&gt;
+               &lt;xsd:element name="AnyText" type="csw:EmptyType"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+               &lt;xsd:element ref="ows:BoundingBox"
+                            minOccurs="0" maxOccurs="unbounded"/&gt;
+            &lt;/xsd:sequence&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:complexContent&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:complexType name="EmptyType" /&gt;
+   
+   &lt;xsd:complexType name="RequestBaseType" id="RequestBaseType" abstract="true"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation&gt;
+            Base type for all request messages except GetCapabilities. The 
+            attributes identify the relevant service type and version.
+         &lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:attribute name="service" type="ows:ServiceType"
+                     use="required" fixed="CSW"/&gt;
+      &lt;xsd:attribute name="version" type="ows:VersionType"
+                     use="required" fixed="2.0.2"/&gt;
+   &lt;/xsd:complexType&gt;
+
+   &lt;xsd:element name="GetCapabilities" id="GetCapabilities"
+                type="csw:GetCapabilitiesType"/&gt;
+   &lt;xsd:complexType name="GetCapabilitiesType" id="GetCapabilitiesType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation&gt;
+            Request for a description of service capabilities. See OGC 05-008 
+            for more information.
+         &lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:complexContent&gt;
+         &lt;xsd:extension base="ows:GetCapabilitiesType"&gt;
+            &lt;xsd:attribute name="service" type="ows:ServiceType" use="optional"
+               default="<a href="http://www.opengis.net/cat/csw"/" target="_new">http://www.opengis.net/cat/csw"/</a>&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:complexContent&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:element name="Capabilities" id="Capabilities"
+      type="csw:CapabilitiesType"/&gt;
+   &lt;xsd:complexType name="CapabilitiesType" id="CapabilitiesType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation&gt;This type extends ows:CapabilitiesBaseType defined in OGC-05-008 
+         to include information about supported OGC filter components. A 
+         profile may extend this type to describe additional capabilities.&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:complexContent&gt;
+         &lt;xsd:extension base="ows:CapabilitiesBaseType"&gt;
+            &lt;xsd:sequence&gt;
+               &lt;xsd:element ref="ogc:Filter_Capabilities"/&gt;
+            &lt;/xsd:sequence&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:complexContent&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:element name="DescribeRecord" type="csw:DescribeRecordType"
+      id="DescribeRecord"/&gt;
+   &lt;xsd:complexType name="DescribeRecordType" id="DescribeRecordType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;This request allows a user to discover elements of the
+         information model supported by the catalogue. If no TypeName 
+         elements are included, then all of the schemas for the 
+         information model must be returned.
+      
+         schemaLanguage - preferred schema language
+                          (W3C XML Schema by default)
+         outputFormat - preferred output format (application/xml by default)&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:complexContent&gt;
+         &lt;xsd:extension base="csw:RequestBaseType"&gt;
+            &lt;xsd:sequence&gt;
+               &lt;xsd:element name="TypeName" type="xsd:QName" minOccurs="0"
+                  maxOccurs="unbounded"/&gt;
+            &lt;/xsd:sequence&gt;
+            &lt;xsd:attribute name="outputFormat" type="xsd:string" use="optional"
+               default="application/xml"/&gt;
+            &lt;xsd:attribute name="schemaLanguage" type="xsd:anyURI"
+               use="optional" default="<a href="http://www.w3.org/XML/Schema"/" target="_new">http://www.w3.org/XML/Schema"/</a>&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:complexContent&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:element name="DescribeRecordResponse" id="DescribeRecordResponse"
+      type="csw:DescribeRecordResponseType"/&gt;
+   &lt;xsd:complexType name="DescribeRecordResponseType"
+      id="DescribeRecordResponseType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;The response contains a list of matching schema components
+         in the requested schema language.&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:sequence&gt;
+         &lt;xsd:element name="SchemaComponent" type="csw:SchemaComponentType"
+            minOccurs="0" maxOccurs="unbounded"/&gt;
+      &lt;/xsd:sequence&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:complexType name="SchemaComponentType" mixed="true"
+      id="SchemaComponentType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;A schema component includes a schema fragment (type
+         definition) or an entire schema from some target namespace;
+         the schema language is identified by URI. If the component
+         is a schema fragment its parent MUST be referenced (parentSchema).&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:sequence&gt;
+         &lt;xsd:any namespace="##any" processContents="lax"/&gt;
+      &lt;/xsd:sequence&gt;
+      &lt;xsd:attribute name="targetNamespace" type="xsd:anyURI" use="required"/&gt;
+      &lt;xsd:attribute name="parentSchema" type="xsd:anyURI" use="optional"/&gt;
+      &lt;xsd:attribute name="schemaLanguage" type="xsd:anyURI" use="required"/&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:element name="GetRecords" type="csw:GetRecordsType" id="GetRecords"/&gt;
+   &lt;xsd:complexType name="GetRecordsType" id="GetRecordsType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;
+         The principal means of searching the catalogue. The matching 
+         catalogue entries may be included with the response. The client 
+         may assign a requestId (absolute URI). A distributed search is 
+         performed if the DistributedSearch element is present and the 
+         catalogue is a member of a federation. Profiles may allow 
+         alternative query expressions.&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:complexContent&gt;
+         &lt;xsd:extension base="csw:RequestBaseType"&gt;
+            &lt;xsd:sequence&gt;
+               &lt;xsd:element name="DistributedSearch"
+                  type="csw:DistributedSearchType" minOccurs="0"/&gt;
+               &lt;xsd:element name="ResponseHandler" type="xsd:anyURI"
+                  minOccurs="0" maxOccurs="unbounded"/&gt;
+               &lt;xsd:choice&gt;
+                  &lt;xsd:element ref="csw:AbstractQuery"/&gt;
+                  &lt;xsd:any processContents="strict" namespace="##other"/&gt;
+               &lt;/xsd:choice&gt;
+            &lt;/xsd:sequence&gt;
+            &lt;xsd:attribute name="requestId" type="xsd:anyURI" use="optional"/&gt;
+            &lt;xsd:attribute name="resultType" type="csw:ResultType"
+               use="optional" default="hits"/&gt;
+            &lt;xsd:attributeGroup ref="csw:BasicRetrievalOptions"/&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:complexContent&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:attributeGroup name="BasicRetrievalOptions" id="BasicRetrievalOptions"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;Various attributes that specify basic retrieval options:
+
+            outputFormat   - the media type of the response message
+            outputSchema   - the preferred schema for records in the result set
+            startPosition  - requests a slice of the result set, starting
+                             at this position
+            maxRecords     - the maximum number of records to return. No
+                             records are  returned if maxRecords=0.&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:attribute name="outputFormat" type="xsd:string" use="optional"
+         default="application/xml"/&gt;
+      &lt;xsd:attribute name="outputSchema" type="xsd:anyURI" use="optional"/&gt;
+      &lt;xsd:attribute name="startPosition" type="xsd:positiveInteger"
+         use="optional" default="1"/&gt;
+      &lt;xsd:attribute name="maxRecords" type="xsd:nonNegativeInteger"
+         use="optional" default="10"/&gt;
+   &lt;/xsd:attributeGroup&gt;
+   &lt;xsd:simpleType name="ResultType" id="ResultType"&gt;
+      &lt;xsd:restriction base="xsd:string"&gt;
+         &lt;xsd:enumeration value="results"&gt;
+            &lt;xsd:annotation&gt;
+               &lt;xsd:documentation&gt;Include results in the response.&lt;/xsd:documentation&gt;
+            &lt;/xsd:annotation&gt;
+         &lt;/xsd:enumeration&gt;
+         &lt;xsd:enumeration value="hits"&gt;
+            &lt;xsd:annotation&gt;
+               &lt;xsd:documentation&gt;Provide a result set summary, but no results.&lt;/xsd:documentation&gt;
+            &lt;/xsd:annotation&gt;
+         &lt;/xsd:enumeration&gt;
+         &lt;xsd:enumeration value="validate"&gt;
+            &lt;xsd:annotation&gt;
+               &lt;xsd:documentation&gt;Validate the request and return an Acknowledgement message if it 
+	      is valid. Continue processing the request asynchronously.&lt;/xsd:documentation&gt;
+            &lt;/xsd:annotation&gt;
+         &lt;/xsd:enumeration&gt;
+      &lt;/xsd:restriction&gt;
+   &lt;/xsd:simpleType&gt;
+   &lt;xsd:complexType name="DistributedSearchType" id="DistributedSearchType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;Governs the behaviour of a distributed search.
+         hopCount     - the maximum number of message hops before
+                        the search is terminated. Each catalogue node 
+                        decrements this value when the request is received, 
+                        and must not forward the request if hopCount=0.&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:attribute name="hopCount" type="xsd:positiveInteger" use="optional"
+         default="2"/&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:element name="AbstractQuery" type="csw:AbstractQueryType"
+      id="AbstractQuery" abstract="true"/&gt;
+   &lt;xsd:complexType name="AbstractQueryType" id="AbstractQueryType"
+      abstract="true"/&gt;
+   &lt;xsd:element name="Query" type="csw:QueryType" id="Query"
+      substitutionGroup="csw:AbstractQuery"/&gt;
+   &lt;xsd:complexType name="QueryType" id="QueryType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;Specifies a query to execute against instances of one or
+         more object types. A set of ElementName elements may be included 
+         to specify an adhoc view of the csw:Record instances in the result 
+         set. Otherwise, use ElementSetName to specify a predefined view. 
+         The Constraint element contains a query filter expressed in a 
+         supported query language. A sorting criterion that specifies a 
+         property to sort by may be included.
+
+         typeNames - a list of object types to query.&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:complexContent&gt;
+         &lt;xsd:extension base="csw:AbstractQueryType"&gt;
+            &lt;xsd:sequence&gt;
+               &lt;xsd:choice&gt;
+                  &lt;xsd:element ref="csw:ElementSetName"/&gt;
+                  &lt;xsd:element name="ElementName"
+                               type="xsd:QName"
+                               minOccurs="1" maxOccurs="unbounded"/&gt;
+               &lt;/xsd:choice&gt;
+               &lt;xsd:element ref="csw:Constraint" minOccurs="0" maxOccurs="1"/&gt;
+               &lt;xsd:element ref="ogc:SortBy" minOccurs="0" maxOccurs="1"/&gt;
+            &lt;/xsd:sequence&gt;
+            &lt;xsd:attribute name="typeNames" type="csw:TypeNameListType"
+               use="required"/&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:complexContent&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:simpleType name="TypeNameListType" id="TypeNameListType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;The exact syntax is defined in an application profile. If querying 
+       against the common record properties, only a single type may be 
+       specified (Record).&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:list itemType="xsd:QName"/&gt;
+   &lt;/xsd:simpleType&gt;
+   &lt;xsd:element name="Constraint" type="csw:QueryConstraintType" id="Constraint"/&gt;
+   &lt;xsd:complexType name="QueryConstraintType" id="QueryConstraintType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation xml:lang="en"&gt;A search constraint that adheres to one of the following syntaxes:
+         Filter   - OGC filter expression
+         CqlText  - OGC CQL predicate&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:choice&gt;
+         &lt;xsd:element ref="ogc:Filter"/&gt;
+         &lt;xsd:element name="CqlText" type="xsd:string"/&gt;
+      &lt;/xsd:choice&gt;
+      &lt;xsd:attribute name="version" type="xsd:string" use="required"&gt;
+         &lt;xsd:annotation&gt;
+            &lt;xsd:documentation&gt;Query language version&lt;/xsd:documentation&gt;
+         &lt;/xsd:annotation&gt;
+      &lt;/xsd:attribute&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:element name="ElementSetName" type="csw:ElementSetNameType"
+      id="ElementSetName" default="summary"/&gt;
+   &lt;xsd:complexType name="ElementSetNameType" id="ElementSetNameType"&gt;
+      &lt;xsd:simpleContent&gt;
+         &lt;xsd:extension base="csw:ElementSetType"&gt;
+            &lt;xsd:attribute name="typeNames" type="csw:TypeNameListType"
+               use="optional"/&gt;
+         &lt;/xsd:extension&gt;
+      &lt;/xsd:simpleContent&gt;
+   &lt;/xsd:complexType&gt;
+   &lt;xsd:simpleType name="ElementSetType" id="ElementSetType"&gt;
+      &lt;xsd:annotation&gt;
+         &lt;xsd:documentation&gt;Named subsets of catalogue object properties; these
+         views are mapped to a specific information model and
+         are defined in an application profile.&lt;/xsd:documentation&gt;
+      &lt;/xsd:annotation&gt;
+      &lt;xsd:restriction base="xsd:string"&gt;
+         &lt;xsd:enumeration value="brief"/&gt;
+         &lt;xsd:enumeration value="summary"/&gt;
+         &lt;xsd:enumeration value="full"/&gt;
+      &lt;/xsd:restriction&gt;
+   &lt;/xsd:simpleType&gt;

@@ Diff output truncated at 100000 characters. @@

This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=19452921">[GeoNetwork-commit] SF.net SVN: geonetwork: [1296] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;acarboni@us...&gt; -	2008-05-26 07:36</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1296
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1296&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1296&amp;view=rev</a>
Author:   acarboni
Date:     2008-05-26 00:36:41 -0700 (Mon, 26 May 2008)

Log Message:
-----------
GAST: Added possibility to change siteId, added possibility to specify siteId and group owner during MEF export

Modified Paths:
--------------
    trunk/gast/data/gui.xml
    trunk/src/org/fao/gast/gui/panels/config/siteid/MainPanel.java
    trunk/src/org/fao/gast/gui/panels/manag/mefexport/SearchPanel.java
    trunk/src/org/fao/gast/lib/SiteLib.java

Modified: trunk/gast/data/gui.xml
===================================================================
--- trunk/gast/data/gui.xml	2008-05-22 11:29:03 UTC (rev 1295)
+++ trunk/gast/data/gui.xml	2008-05-26 07:36:41 UTC (rev 1296)
@@ -26,7 +26,7 @@
 		&lt;image&gt;22x22/configure.png&lt;/image&gt;
 		&lt;label&gt;Configuration&lt;/label&gt;
 		
-		&lt;!-- Site ID - - - - - - - - - - - - - - - - - - - - - - - - 
+		&lt;!-- Site ID - - - - - - - - - - - - - - - - - - - - - - - --&gt; 
 		
 		&lt;form&gt;
 			&lt;id&gt;siteid&lt;/id&gt;
@@ -35,24 +35,22 @@
 			&lt;title&gt;Site ID change&lt;/title&gt;
 			&lt;class&gt;config.siteid.MainPanel&lt;/class&gt;
 			&lt;description&gt;
-				Here you can change your installation's site ID. Because a site ID
-				must be unique, you are not allowed to enter a value but it will be
-				automatically generated.
+				*** WARNING *** Here you can change your installation's site ID
+				but you should not do this by hand, unless you are migrating
+				from a previous installation
 			&lt;/description&gt;
 			
 			&lt;button&gt;
-				&lt;image&gt;16x16/reload.png&lt;/image&gt;
-				&lt;label&gt;Generate&lt;/label&gt;
-				&lt;action&gt;generate&lt;/action&gt;
+				&lt;image&gt;16x16/filesave.png&lt;/image&gt;
+				&lt;label&gt;Change&lt;/label&gt;
+				&lt;action&gt;change&lt;/action&gt;
 			&lt;/button&gt;
 			
 			&lt;precon type="stopped"&gt;
-				GeoNetwork must be stopped because the SettingManager caches data.
-				There are also some other operations that it is better to do with
-				GeoNetwork stopped.
+				GeoNetwork must be stopped
 			&lt;/precon&gt;
 		&lt;/form&gt;
-		--&gt;
+		
 		&lt;!-- Jetty - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
 		
 		&lt;form&gt;

Modified: trunk/src/org/fao/gast/gui/panels/config/siteid/MainPanel.java
===================================================================
--- trunk/src/org/fao/gast/gui/panels/config/siteid/MainPanel.java	2008-05-22 11:29:03 UTC (rev 1295)
+++ trunk/src/org/fao/gast/gui/panels/config/siteid/MainPanel.java	2008-05-26 07:36:41 UTC (rev 1296)
@@ -23,12 +23,16 @@
 
 package org.fao.gast.gui.panels.config.siteid;
 
+import java.awt.event.ActionEvent;
 import javax.swing.JComponent;
 import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.JTextField;
+import jeeves.resources.dbms.Dbms;
 import org.dlib.gui.FlexLayout;
 import org.fao.gast.gui.panels.FormPanel;
+import org.fao.gast.lib.Lib;
+import org.fao.gast.lib.Resource;
 
 //==============================================================================
 
@@ -48,7 +52,7 @@
 		fl.setColProp(1, FlexLayout.EXPAND);
 		p.setLayout(fl);
 
-		p.add("0,0",   new JLabel("Current"));
+		p.add("0,0",   new JLabel("Site ID"));
 		p.add("1,0,x", txtSiteID);
 
 		return p;
@@ -56,12 +60,39 @@
 
 	//---------------------------------------------------------------------------
 	//---
-	//--- API methods
+	//--- ActionListener
 	//---
 	//---------------------------------------------------------------------------
 
-	public void refresh()
+	public void actionPerformed(ActionEvent ae)
 	{
+		String siteId = txtSiteID.getText().trim();
+
+		Resource resource = null;
+		Dbms     dbms     = null;
+
+		try
+		{
+			resource = Lib.config.createResource();
+			dbms     = (Dbms) resource.open();
+
+			Lib.site.setSiteId(dbms, siteId);
+			dbms.commit();
+
+			Lib.gui.showInfo(this, "Site ID changed");
+		}
+		catch (Exception e)
+		{
+			Lib.gui.showError(this, e);
+
+			if (dbms != null)
+				dbms.abort();
+		}
+		finally
+		{
+			if (resource != null)
+				resource.close();
+		}
 	}
 
 	//---------------------------------------------------------------------------

Modified: trunk/src/org/fao/gast/gui/panels/manag/mefexport/SearchPanel.java
===================================================================
--- trunk/src/org/fao/gast/gui/panels/manag/mefexport/SearchPanel.java	2008-05-22 11:29:03 UTC (rev 1295)
+++ trunk/src/org/fao/gast/gui/panels/manag/mefexport/SearchPanel.java	2008-05-26 07:36:41 UTC (rev 1296)
@@ -23,17 +23,26 @@
 
 package org.fao.gast.gui.panels.manag.mefexport;
 
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+import java.util.List;
+import javax.swing.JButton;
 import javax.swing.JCheckBox;
+import javax.swing.JComboBox;
 import javax.swing.JLabel;
 import javax.swing.JTextField;
+import jeeves.utils.XmlRequest;
 import org.dlib.gui.FlexLayout;
 import org.dlib.gui.TPanel;
-import org.fao.geonet.lib.Lib;
+import org.fao.gast.app.App;
+import org.fao.gast.app.Configuration;
+import org.fao.gast.lib.Lib;
+import org.fao.geonet.constants.Geonet;
 import org.jdom.Element;
 
 //==============================================================================
 
-public class SearchPanel extends TPanel
+public class SearchPanel extends TPanel implements ActionListener
 {
 	//---------------------------------------------------------------------------
 	//---
@@ -45,15 +54,27 @@
 	{
 		super("Search");
 
-		FlexLayout fl = new FlexLayout(2,2);
+		FlexLayout fl = new FlexLayout(3,4);
 		fl.setColProp(1, FlexLayout.EXPAND);
 		setLayout(fl);
 
 		add("0,0",   new JLabel("Free text"));
 		add("1,0,x", txtAny);
 
-		add("0,1", new JLabel("Templates"));
-		add("1,1", chbTemp);
+		add("0,1",   new JLabel("Site ID"));
+		add("1,1,x", cmbSiteId);
+		add("2,1",   btnRetrieve);
+
+		add("0,2",   new JLabel("Group owner"));
+		add("1,2,x", cmbGroup);
+
+		add("0,3", new JLabel("Templates"));
+		add("1,3", chbTemp);
+
+		btnRetrieve.addActionListener(this);
+
+		cmbSiteId.addItem(new ComboInfo());
+		cmbGroup .addItem(new ComboInfo());
 	}
 
 	//---------------------------------------------------------------------------
@@ -64,23 +85,142 @@
 
 	public Element createRequest()
 	{
-		Element req = new Element("request");
+		Element req = new Element("request")
+							.addContent(new Element("any").setText(txtAny.getText()))
+							.addContent(new Element("template").setText(chbTemp.isSelected() ? "y" : "n"));
 
-		Lib.element.add(req, "any",      txtAny.getText());
-		Lib.element.add(req, "template", chbTemp.isSelected() ? "y" : "n");
+		ComboInfo site  = (ComboInfo) cmbSiteId.getSelectedItem();
+		ComboInfo group = (ComboInfo) cmbGroup .getSelectedItem();
 
+		if (site.id != null)
+			req.addContent(new Element("siteId").setText(site.id));
+
+		if (group.id != null)
+			req.addContent(new Element("group").setText(group.id));
+
 		return req;
 	}
 
 	//---------------------------------------------------------------------------
+
+	public void actionPerformed(ActionEvent ae)
+	{
+		try
+		{
+			Configuration cfg = App.config;
+
+			XmlRequest req = new XmlRequest(cfg.getHost(), cfg.getPort());
+
+			//--- login
+
+			if (cfg.useAccount())
+				Lib.service.login(req);
+
+			//--- search
+
+			req.setAddress("/"+ cfg.getServlet() +"/srv/en/"+ Geonet.Service.XML_INFO);
+
+			Element params = new Element("request")
+										.addContent(new Element("type").setText("groups"))
+										.addContent(new Element("type").setText("sources"));
+
+			handleInfo(req.execute(params));
+
+
+			//--- logout
+
+			if (cfg.useAccount())
+				Lib.service.logout(req);
+		}
+		catch(Exception e)
+		{
+			Lib.gui.showError(this, e);
+		}
+	}
+
+	//---------------------------------------------------------------------------
 	//---
+	//--- Private
+	//---
+	//---------------------------------------------------------------------------
+
+	private void handleInfo(Element info)
+	{
+		cmbSiteId.removeAllItems();
+		cmbGroup .removeAllItems();
+
+		//--- handle sources
+
+		for (Object o : info.getChild("sources").getChildren())
+		{
+			Element source = (Element) o;
+
+			String uuid = source.getChildText("uuid");
+			String name = source.getChildText("name");
+
+			cmbSiteId.addItem(new ComboInfo(uuid, name));
+		}
+
+		//--- handle groups
+
+		for (Object o : info.getChild("groups").getChildren())
+		{
+			Element group = (Element) o;
+
+			String id   = group.getAttributeValue("id");
+			String name = null;
+
+			for (Object o2 : group.getChild("label").getChildren())
+			{
+				Element grpLabel = (Element) o2;
+
+				if (grpLabel.getName().equals("en") || name == null)
+					name = grpLabel.getText();
+			}
+
+			cmbGroup.addItem(new ComboInfo(id, name));
+		}
+
+		cmbSiteId.addItem(new ComboInfo());
+		cmbGroup .addItem(new ComboInfo());
+	}
+
+	//---------------------------------------------------------------------------
+	//---
 	//--- Variables
 	//---
 	//---------------------------------------------------------------------------
 
-	private JTextField txtAny  = new JTextField(20);
-	private JCheckBox  chbTemp = new JCheckBox();
+	private JTextField txtAny     = new JTextField(20);
+	private JComboBox  cmbSiteId  = new JComboBox();
+	private JComboBox  cmbGroup   = new JComboBox();
+	private JCheckBox  chbTemp    = new JCheckBox();
+	private JButton    btnRetrieve= new JButton("Retrieve");
 }
 
 //==============================================================================
 
+class ComboInfo
+{
+	public String id;
+	public String name;
+
+	//---------------------------------------------------------------------------
+
+	public ComboInfo() {}
+
+	//---------------------------------------------------------------------------
+
+	public ComboInfo(String id, String name)
+	{
+		this.id   = id;
+		this.name = name;
+	}
+
+	//---------------------------------------------------------------------------
+
+	public String toString() { return name; }
+}
+
+//==============================================================================
+

Modified: trunk/src/org/fao/gast/lib/SiteLib.java
===================================================================
--- trunk/src/org/fao/gast/lib/SiteLib.java	2008-05-22 11:29:03 UTC (rev 1295)
+++ trunk/src/org/fao/gast/lib/SiteLib.java	2008-05-26 07:36:41 UTC (rev 1296)
@@ -23,6 +23,7 @@
 
 package org.fao.gast.lib;
 
+import java.io.File;
 import java.sql.SQLException;
 import jeeves.constants.Jeeves;
 import jeeves.resources.dbms.Dbms;
@@ -64,6 +65,23 @@
 	}
 
 	//---------------------------------------------------------------------------
+
+	public void setSiteId(Dbms dbms, String uuid) throws SQLException
+	{
+		String oldUuid = getSiteId(dbms);
+		String appPath = Lib.server.getAppPath();
+
+		dbms.execute("UPDATE Metadata SET source=? WHERE isHarvested='n'", uuid);
+		dbms.execute("UPDATE Settings SET value=?  WHERE name='siteId'",   uuid);
+		dbms.execute("UPDATE Sources  SET uuid=?   WHERE uuid=?",          uuid, oldUuid);
+
+		File srcImg = new File(appPath +"/web/geonetwork/images/logos/"+ oldUuid +".gif");
+		File desImg = new File(appPath +"/web/geonetwork/images/logos/"+ uuid    +".gif");
+
+		srcImg.renameTo(desImg);
+	}
+
+	//---------------------------------------------------------------------------
 	//---
 	//--- Variables
 	//---


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

<p>
<!--
/mailarchive/nested_messages.html - Copyright 1999-2006 (c) Open Source Technology Group
@version $Id$
-->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="0"> </td>
        <td>
            <table width="100%" border="0">
                <tr>
	<td bgcolor="#DDDDDD" nowrap><div class='forum'>
		<div><b><!-- google_ad_section_start --><a href="/mailarchive/message.php?msg_id=19516593">[GeoNetwork-commit] SF.net SVN: geonetwork: [1313] trunk</a><!-- google_ad_section_end --></b></div>		<small>From: &lt;acarboni@us...&gt; -	2008-06-03 07:28</small><br>
			</div></td>
</tr>


                <tr>
                    <td class="email_body">
                        <!-- google_ad_section_start --><pre>Revision: 1313
          <a href="http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1313&amp;view=rev" target="_new">http://geonetwork.svn.sourceforge.net/geonetwork/?rev=1313&amp;view=rev</a>
Author:   acarboni
Date:     2008-06-03 00:28:23 -0700 (Tue, 03 Jun 2008)

Log Message:
-----------
Added massive metadata deletion

Modified Paths:
--------------
    trunk/web/geonetwork/WEB-INF/config-metadata.xml
    trunk/web/geonetwork/loc/en/xml/strings.xml
    trunk/web/geonetwork/scripts/geonetwork.js
    trunk/web/geonetwork/xml/user-profiles.xml
    trunk/web/geonetwork/xsl/search-results-xhtml.xsl

Added Paths:
-----------
    trunk/src/org/fao/geonet/services/metadata/MassiveDelete.java
    trunk/web/geonetwork/loc/en/xml/metadata-massiveDelete.xml

Added: trunk/src/org/fao/geonet/services/metadata/MassiveDelete.java
===================================================================
--- trunk/src/org/fao/geonet/services/metadata/MassiveDelete.java	                        (rev 0)
+++ trunk/src/org/fao/geonet/services/metadata/MassiveDelete.java	2008-06-03 07:28:23 UTC (rev 1313)
@@ -0,0 +1,144 @@
+//=============================================================================
+//===	Copyright (C) 2001-2007 Food and Agriculture Organization of the
+//===	United Nations (FAO-UN), United Nations World Food Programme (WFP)
+//===	and United Nations Environment Programme (UNEP)
+//===
+//===	This program is free software; you can redistribute it and/or modify
+//===	it under the terms of the GNU General Public License as published by
+//===	the Free Software Foundation; either version 2 of the License, or (at
+//===	your option) any later version.
+//===
+//===	This program is distributed in the hope that it will be useful, but
+//===	WITHOUT ANY WARRANTY; without even the implied warranty of
+//===	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+//===	General Public License for more details.
+//===
+//===	You should have received a copy of the GNU General Public License
+//===	along with this program; if not, write to the Free Software
+//===	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+//===
+//===	Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
+//===	Rome - Italy. email: geonetwork@...
+//==============================================================================
+
+package org.fao.geonet.services.metadata;
+
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileOutputStream;
+import java.util.HashSet;
+import java.util.Set;
+import jeeves.constants.Jeeves;
+import jeeves.exceptions.OperationNotAllowedEx;
+import jeeves.interfaces.Service;
+import jeeves.resources.dbms.Dbms;
+import jeeves.server.ServiceConfig;
+import jeeves.server.UserSession;
+import jeeves.server.context.ServiceContext;
+import jeeves.utils.BinaryFile;
+import jeeves.utils.Util;
+import org.fao.geonet.GeonetContext;
+import org.fao.geonet.constants.Geonet;
+import org.fao.geonet.constants.Params;
+import org.fao.geonet.kernel.AccessManager;
+import org.fao.geonet.kernel.DataManager;
+import org.fao.geonet.kernel.MdInfo;
+import org.fao.geonet.kernel.mef.MEFLib;
+import org.fao.geonet.kernel.search.MetaSearcher;
+import org.fao.geonet.lib.Lib;
+import org.jdom.Element;
+
+//=============================================================================
+
+/** Removes a metadata from the system
+  */
+
+public class MassiveDelete implements Service
+{
+	public void init(String appPath, ServiceConfig params) throws Exception {}
+
+	//--------------------------------------------------------------------------
+	//---
+	//--- Service
+	//---
+	//--------------------------------------------------------------------------
+
+	public Element exec(Element params, ServiceContext context) throws Exception
+	{
+		GeonetContext gc = (GeonetContext) context.getHandlerContext(Geonet.CONTEXT_NAME);
+		DataManager   dataMan   = gc.getDataManager();
+		AccessManager accessMan = gc.getAccessManager();
+		UserSession   session   = context.getUserSession();
+
+		Dbms dbms = (Dbms) context.getResourceManager().open(Geonet.Res.MAIN_DB);
+
+		for (Object o : params.getChildren("id"))
+		{
+			String id = ((Element) o).getText();
+
+			context.info("Deleting metadata with id:"+ id);
+
+			//-----------------------------------------------------------------------
+			//--- check access
+
+			MdInfo info = dataMan.getMetadataInfo(dbms, id);
+
+			if (info == null)
+				throw new IllegalArgumentException("Metadata not found --&gt; " + id);
+
+			if (!accessMan.canEdit(context, id))
+				throw new OperationNotAllowedEx();
+
+			//-----------------------------------------------------------------------
+			//--- backup metadata in 'removed' folder
+
+			if (info.template != MdInfo.Template.SUBTEMPLATE)
+				backupFile(context, id, info.uuid, MEFLib.doExport(context, info.uuid, "full", false));
+
+			//-----------------------------------------------------------------------
+			//--- delete metadata and return status
+
+			dataMan.deleteMetadata(dbms, id);
+		}
+
+		// invalidate current result set set
+		MetaSearcher searcher = (MetaSearcher)context.getUserSession().getProperty(Geonet.Session.SEARCH_RESULT);
+
+		if (searcher != null)
+			searcher.setValid(false);
+
+		return new Element(Jeeves.Elem.RESPONSE);
+	}
+
+	//--------------------------------------------------------------------------
+	//---
+	//--- Private methods
+	//---
+	//--------------------------------------------------------------------------
+
+	private void backupFile(ServiceContext context, String id, String uuid, String file)
+	{
+		String outDir = Lib.resource.getRemovedDir(context, id);
+		String outFile= outDir + uuid +".mef";
+
+		new File(outDir).mkdirs();
+
+		try
+		{
+			FileInputStream  is = new FileInputStream(file);
+			FileOutputStream os = new FileOutputStream(outFile);
+
+			BinaryFile.copy(is, os, true, true);
+		}
+		catch(Exception e)
+		{
+			context.warning("Cannot backup mef file : "+e.getMessage());
+			e.printStackTrace();
+		}
+
+		new File(file).delete();
+	}
+}
+
+//=============================================================================
+

Modified: trunk/web/geonetwork/WEB-INF/config-metadata.xml
===================================================================
--- trunk/web/geonetwork/WEB-INF/config-metadata.xml	2008-05-30 15:11:35 UTC (rev 1312)
+++ trunk/web/geonetwork/WEB-INF/config-metadata.xml	2008-06-03 07:28:23 UTC (rev 1313)
@@ -182,6 +182,16 @@
 
 		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
 
+		&lt;service name="metadata.massiveDelete"&gt;
+			&lt;class name=".services.metadata.MassiveDelete"/&gt;
+
+			&lt;output sheet="info.xsl"&gt;
+				&lt;xml name="info" file="xml/metadata-massiveDelete.xml" /&gt;
+			&lt;/output&gt;
+		&lt;/service&gt;
+
+		&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --&gt;
+
 		&lt;service name="metadata.create.form"&gt;
 			&lt;output sheet="metadata-create.xsl"&gt;
 				&lt;call name="groups"    class=".guiservices.groups.GetMine"/&gt;

Added: trunk/web/geonetwork/loc/en/xml/metadata-massiveDelete.xml
===================================================================
--- trunk/web/geonetwork/loc/en/xml/metadata-massiveDelete.xml	                        (rev 0)
+++ trunk/web/geonetwork/loc/en/xml/metadata-massiveDelete.xml	2008-06-03 07:28:23 UTC (rev 1313)
@@ -0,0 +1,5 @@
+&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+&lt;strings&gt;
+	&lt;heading&gt;Metadata Delete Confirmation&lt;/heading&gt;
+	&lt;message&gt;All selected metadata have been deleted&lt;/message&gt;
+&lt;/strings&gt;

Modified: trunk/web/geonetwork/loc/en/xml/strings.xml
===================================================================
--- trunk/web/geonetwork/loc/en/xml/strings.xml	2008-05-30 15:11:35 UTC (rev 1312)
+++ trunk/web/geonetwork/loc/en/xml/strings.xml	2008-06-03 07:28:23 UTC (rev 1313)
@@ -45,7 +45,8 @@
 	&lt;keyword&gt;keyword&lt;/keyword&gt;
 	&lt;res&gt;results&lt;/res&gt;
 	&lt;ress&gt;result&lt;/ress&gt;
-
+	&lt;massiveActions&gt;Massive actions : &lt;/massiveActions&gt;
+	
 	&lt;thesaurus&gt;
 		&lt;category&gt;Thesaurus category&lt;/category&gt;
 		&lt;management&gt;Manage thesauri&lt;/management&gt;
@@ -127,6 +128,7 @@
 	&lt;completeTab&gt;Advanced view&lt;/completeTab&gt;
 	&lt;completeTabEditor&gt;Advanced editor&lt;/completeTabEditor&gt;
 	&lt;confirmDelete&gt;Are you sure you want to Delete the Metadata from the Database?&lt;/confirmDelete&gt;
+	&lt;confirmMassiveDelete&gt;Are you sure you want to Delete all selected Metadata from the Database?&lt;/confirmMassiveDelete&gt;
 	&lt;confirmPassword&gt;Confirm password&lt;/confirmPassword&gt;
 	&lt;confirmNewPassword&gt;Confirm new password&lt;/confirmNewPassword&gt;
 	&lt;constraintsTab&gt;Constraints&lt;/constraintsTab&gt;

Modified: trunk/web/geonetwork/scripts/geonetwork.js
===================================================================
--- trunk/web/geonetwork/scripts/geonetwork.js	2008-05-30 15:11:35 UTC (rev 1312)
+++ trunk/web/geonetwork/scripts/geonetwork.js	2008-06-03 07:28:23 UTC (rev 1313)
@@ -86,3 +86,26 @@
 		return false;
 	}
 
+	function massiveDelete(message)
+	{
+		var list = $('search-results-content').getElementsByTagName('INPUT');
+		var ids  = '';
+
+		for (var i=0; i&lt;list.length; i++)
+		{
+			if (list[i].getAttribute('id') == 'selId')
+				if (list[i].checked)
+				{
+					var name = list[i].getAttribute('name');
+					ids = ids +'&amp;id='+name;
+				}
+		}
+
+		if (ids == '')
+			return;
+			
+		if(!confirm(message))
+			return;
+
+		document.location.href = Env.locService +'/metadata.massiveDelete?'+ids.substring(1);
+	}

Modified: trunk/web/geonetwork/xml/user-profiles.xml
===================================================================
--- trunk/web/geonetwork/xml/user-profiles.xml	2008-05-30 15:11:35 UTC (rev 1312)
+++ trunk/web/geonetwork/xml/user-profiles.xml	2008-06-03 07:28:23 UTC (rev 1313)
@@ -115,6 +115,7 @@
 
 		&lt;!-- Allow to delete a metadata record --&gt;
 		&lt;allow service="metadata.delete"/&gt;
+		&lt;allow service="metadata.massiveDelete"/&gt;
 
 		&lt;allow service="metadata.duplicate.form"/&gt;
 		&lt;allow service="metadata.create.form"/&gt;

Modified: trunk/web/geonetwork/xsl/search-results-xhtml.xsl
===================================================================
--- trunk/web/geonetwork/xsl/search-results-xhtml.xsl	2008-05-30 15:11:35 UTC (rev 1312)
+++ trunk/web/geonetwork/xsl/search-results-xhtml.xsl	2008-06-03 07:28:23 UTC (rev 1313)
@@ -24,11 +24,11 @@
 		&lt;table  width="100%" height="100%" id="search-results-content"&gt;
 
 			&lt;xsl:variable name="count" 	select="/root/response/summary/@count"/&gt;
-			&lt;xsl:variable name="from" 	select="/root/response/@from"/&gt;
-			&lt;xsl:variable name="to" 	select="/root/response/@to"/&gt;			
+			&lt;xsl:variable name="from" 		select="/root/response/@from"/&gt;
+			&lt;xsl:variable name="to" 		select="/root/response/@to"/&gt;
 			&lt;xsl:variable name="currPage" select="floor(($from - 1) div $hitsPerPage + 1)"/&gt;
 			&lt;xsl:variable name="pages" 	select="floor(($count - 1) div $hitsPerPage + 1)"/&gt;
-			
+
 			&lt;!-- title --&gt;
 			&lt;xsl:call-template name="formTitle"&gt;
 				&lt;xsl:with-param name="title"&gt;
@@ -44,7 +44,7 @@
 
 			&lt;!-- list of metadata --&gt;
 			&lt;xsl:call-template name="hits"/&gt;
-			
+
 			&lt;!-- page list --&gt;
 			&lt;!--			&lt;xsl:call-template name="formSeparator"/&gt; --&gt;
 			&lt;xsl:call-template name="formContent"&gt;
@@ -53,8 +53,10 @@
 				&lt;/xsl:with-param&gt;
 				&lt;xsl:with-param name="indent" select="50"/&gt;
 			&lt;/xsl:call-template&gt;
-			
-			
+
+			&lt;!-- massive actions --&gt;
+			&lt;xsl:call-template name="massiveActions"/&gt;
+
 			&lt;tr&gt;&lt;td class="blue-content" colspan="3"/&gt;&lt;/tr&gt;
 		&lt;/table&gt;
 	&lt;/xsl:template&gt;
@@ -220,6 +222,7 @@
 										&lt;!-- Title --&gt;
 										&lt;td class="padded" width="90%"&gt;
 											&lt;h1 align="left"&gt;
+												&lt;input id="selId" name="{$metadata/geonet:info/id}" type="checkbox" /&gt;
 												&lt;xsl:value-of select="$metadata/title"/&gt;
 											&lt;/h1&gt;
 										&lt;/td&gt;
@@ -593,5 +596,22 @@
 	&lt;/xsl:template&gt;
 		
 	&lt;!-- ================================================================================== --&gt;
+	&lt;!-- massive actions --&gt;
+	&lt;!-- ================================================================================== --&gt;
 
+	&lt;xsl:template name="massiveActions"&gt;
+		&lt;xsl:if test="/root/gui/services/service/@name='metadata.massiveDelete'"&gt;
+			&lt;tr&gt;
+				&lt;td align="center" colspan="3" style="padding-bottom:4px;"&gt;
+					&lt;xsl:value-of select="/root/gui/strings/massiveActions"/&gt;
+					&lt;button class="content" onclick="massiveDelete('{/root/gui/strings/confirmMassiveDelete}')"&gt;
+						&lt;xsl:value-of select="/root/gui/strings/delete"/&gt;
+					&lt;/button&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/xsl:if&gt;
+	&lt;/xsl:template&gt;
+	
+	&lt;!-- ================================================================================== --&gt;
+
 &lt;/xsl:stylesheet&gt;


This was sent by the SourceForge.net collaborative development platform, the world's largest Open Source development site.

</pre><!-- google_ad_section_end -->
                        <br />
                        <br />
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</p>

</ul>






<table width="100%" border="0">
    <tr bgcolor="#eeeeee">
        <td width="50%">
                    &nbsp;
                </td>
        <td>&nbsp;</td>
        <td align="right" width="50%">
                                <a href="forum.php?max_rows=25&style=nested&offset=1&forum_name=geonetwork-commit">
                        <strong>Next Messages</strong></a><a href="forum.php?max_rows=25&style=nested&offset=1&forum_name=geonetwork-commit"><img src="http://a.fsdn.com/sf/images/images/t.gif" alt="" width="15" height="15" /></a>
                </td>
    </tr>
</table>

</form>

            </div>
        </div>
      </div>
    
    <footer id="site-footer">
        <div class="wrapper">
            <nav>
                <h5>SourceForge</h5>
                <a href="/about">About</a>
                <a href="/blog/category/sitestatus/">Site Status</a>
                <a href="http://twitter.com/sfnet_ops">@sfnet_ops</a>
            </nav>
            <nav>
                <h5>Find and Develop Software</h5>
                <a href="/create/">Create a Project</a>
                <a href="/directory/">Software Directory</a>
                <a href="/top">Top Downloaded Projects</a>
            </nav>
            <nav>
                <h5>Community</h5>
                <a href="/blog/">Blog</a>
                <a href="http://twitter.com/sourceforge">@sourceforge</a>
                <a href="/jobs?source=footer">Job Board</a>
                <a href="http://library.slashdotmedia.com/?source=sfnet_footer">Resources</a>
            </nav>
            <nav>
                <h5>Help</h5>
                <a href="http://p.sf.net/sourceforge/docs">Site Documentation</a>
                <a href="/support">Support Request</a>
                <a href="http://p.sf.net/sourceforge/irc">Real-Time Support</a>
            </nav>
        </div>
    </footer>
    <footer id="site-copyright-footer">
        <div class="wrapper">
            <div id="copyright">
                Copyright &copy; 2013 SourceForge. All Rights Reserved.<br />
                SourceForge is a <a href="http://www.diceholdingsinc.com/phoenix.zhtml?c=211152&amp;p=irol-landing">Dice Holdings, Inc.</a> company.
            </div>
            <nav>
                <a href="http://slashdotmedia.com/terms-of-use">Terms</a>
                <a href="http://slashdotmedia.com/privacy-statement/">Privacy</a>
                <a href="http://slashdotmedia.com/opt-out-choices">Cookies/Opt Out</a>
                <a href="http://slashdotmedia.com">Advertise</a>
                <a href="http://sourceforge.jp/">SourceForge.JP</a>
            </nav>
        </div>
    </footer>
        <!--[if lt IE 7 ]>
    <script type="text/javascript" src="http://static.sourceforge.net/include/js/sftheme/dd_belatedpng.js"></script>
    <script> DD_belatedPNG.fix('img, .png_bg'); //fix any <img> or .png_bg background-images </script>
    <![endif]-->
<!--[if IE]></div><![endif]-->
<!--[if IE 6]></div><![endif]-->
<!--[if IE 7]></div><![endif]-->

    
    <!-- Begin comScore Tag -->
    <script>
        document.write(unescape("%3Cscript src='" + (document.location.protocol == "https:" ? "https://sb" : "http://b") + ".scorecardresearch.com/beacon.js' %3E%3C/script%3E"));
    </script>
    <script>
        COMSCORE.beacon({
            c1:2,
            c2:6035546,
            c3:"",
            c4:"",
            c5:"",
            c6:"",
            c15:""
        });
    </script>
    <noscript>
        <img src="http://b.scorecardresearch.com/p?c1=2&amp;c2=6035546&amp;c3=&amp;c4=&amp;c5=&amp;c6=&amp;c15=&amp;cj=1" />
    </noscript>
    <!-- End comScore Tag -->
    




        </div>
    </body>
</html>
