<html lang="en-us" xmlns:htmldb="http://htmldb.oracle.com">
<head>
<title>Ask Tom &quot;Separating comma separated words &quot;</title>
  <link rel="shortcut icon" href="/asktom_i/asktom/ask_tom4.ico" />
  <link rel="alternate" type="application/rss+xml" title="Just Updated" 
    href="asktom.newest.rss" />
  <link rel="alternate" type="application/rss+xml" title="Hot Articles" 
    href="asktom.hot.rss" />
  <link rel="alternate" type="application/rss+xml" title="Most Popular" 
    href="asktom.popular.rss" />
<link rel="stylesheet" href="/asktom_i/themes/theme_18/theme_V22.css" type="text/css" />
<!--[if IE]><link rel="stylesheet" href="/asktom_i/themes/theme_18/ie.css" type="text/css" /><![endif]-->
<link rel="stylesheet" href="/asktom_i/asktom/askexpert2.css" type="text/css" />
<script src="/asktom_i/asktom/askexpert.js" type="text/javascript"></script>

<script src="/asktom_i/javascript/htmldb_html_elements.js" type="text/javascript"></script>
<script src="/asktom_i/javascript/htmldb_get.js" type="text/javascript"></script>
<script type="text/javascript">
<!--
/*Global JS Variables*/
var htmldb_Img_Dir = "/asktom_i/";
//-->
</script>
<link rel="stylesheet" href="/asktom_i/css/core_V22.css" type="text/css" />
<!--[if IE]><link rel="stylesheet" href="/asktom_i/css/core_ie_V22.css" type="text/css" /><![endif]-->
<script type="text/javascript">
    function latestFollowup(){
        theID = $x('P11_LATEST_FOLLOWUP_ID');
        window.location = '#tom'+theID.value;
    }
</script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body ><div style="position:relative;width:728px;height: 120px; top:0px; left:50%;margin-left: -310px;z-index:2147483646;color: blue;text-align:center;">&nbsp;
<a href="http://www.150m.com">Free Web Space</a> | 
<a href="http://www.150m.com/bluehost-review-bluehost-coupon.html">BlueHost Review</a>
&nbsp;
</div>
<br>
<center>
<DIV STYLE="position:absolute;width:728; top:34px; left:50%;margin-left: -310px;z-index:2147483647;">

<script type="text/javascript" charset="utf-8">
  var redvase_ad = { version: 1.5 };
  redvase_ad.publisher = 'stormpages';
  redvase_ad.kind      = 'leaderboard';
  redvase_ad.content   = 'creative'
  </script>
<script src="http://redvase.bravenet.com/javascripts/redvase.js" type="text/javascript" charset="utf-8"></script>
</DIV>
</center><form action="wwv_flow.accept" method="post" name="wwv_flow" id="wwvFlowForm" >
  <input type="hidden" name="p_flow_id" value="100" id="pFlowId" />  <input type="hidden" name="p_flow_step_id" value="11" id="pFlowStepId" />  <input type="hidden" name="p_instance" value="948275997032168" id="pInstance" />  <input type="hidden" name="p_page_submission_id" value="1811605" id="pPageSubmissionId" />  <input type="hidden" name="p_request" value="" id="pRequest" />
<a name="PAGETOP"></a><a name="PAGETOP" /><table border="0" cellpadding="0" cellspacing="0" summary="" width="100%">
<tr>
<td id="t18Logo" valign="top"><a href="f?p=100:1:948275997032168:::RP,APP" style="text-decoration:none;"><img src="/asktom_i/asktom4.gif" alt="Ask Tom Logo" /></a><br /></td>
<td valign="bottom" width="100%"><div id="t18Tabs"><a href="javascript:doSubmit('T_RECENT');" class="t18CurrentTab">Questions</a><a href="javascript:doSubmit('T_OTHERRESOURCES');" class="t18Tab">Resources</a><a href="javascript:doSubmit('T_ARCHIVES');" class="t18Tab">Archives</a><a href="javascript:doSubmit('T_LINKSILIKE');" class="t18Tab">Links</a><a href="javascript:doSubmit('T_POPULAR');" class="t18Tab">Popular</a><a href="javascript:doSubmit('T_HOT');" class="t18Tab">Hot</a><a href="javascript:doSubmit('T_FILES');" class="t18Tab">Files</a></div></td>
<td id="t18HeaderMiddle"  valign="top" width="100%"><br /></td>
<td id="t18NavBar" valign="top"><br /></td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" summary="" id="t18PageBody"  width="80%" height="70%" align="center">
<tr>
<td valign="top" height="3"><img src="/asktom_i/themes/theme_18/page_tl.gif" alt="" /></td>
<td class="t18TopMiddleFill"><img src="/asktom_i/themes/theme_18/page_tm.gif" alt="" /></td>
<td valign="top" height="3"><img src="/asktom_i/themes/theme_18/page_tr.gif" alt="" /></td>
</tr>
<tr>
<td class="t18PageLeft"><br /></td>
<td valign="top"><div class="t18Breadcrumbs"><a href="f?p=100:1:0::NO:::" class="t18Bread">Home</a><b>&gt;</b><span style="font-weight:normal;">Question Details</span><br /></div></td>
<td class="t18PageRight"><br /></td>
</tr>
<tr>
<td valign="bottom" height="3"><img src="/asktom_i/themes/theme_18/page_bl.gif" alt="" /></td>
<td class="t18BottomMiddleFill"><img src="/asktom_i/themes/theme_18/page_bm.gif" alt="" /></td>
<td valign="bottom" height="3"><img src="/asktom_i/themes/theme_18/page_br.gif" alt="" /></td>
</tr>
<tr>
<td valign="bottom" height="3" colspan="3" class="bigbar"><br /></td>
</tr>
<tr>
<td valign="top" height="3"><img src="/asktom_i/themes/theme_18/page_tl.gif" alt="" /></td>
<td class="t18TopMiddleFill"><img src="/asktom_i/themes/theme_18/page_tm.gif" alt="" /></td>
<td valign="top" height="3"><img src="/asktom_i/themes/theme_18/page_tr.gif" alt="" /></td>
</tr>
<tr>
<td class="t18PageLeft"><br /></td>
<td valign="top" id="t18ContentBody" height="100%" width="100%">
<table width="100%">
<tr>
<td valign="top" width="100%"><table width="100%">
<tr>
<td valign="top" colspan="2" width="100%"><div id="t18Messages"></div>
<div id="t18ContentMiddle"><div style="display:hidden"><table class="formlayout" summary="" ><tr><td></td><td  colspan="1" rowspan="1" align="left"><input type="hidden" name="p_arg_names" value="82565985563358351" /><input type="hidden" name="p_t01" value="2189860818012" id="P11_QUESTION_ID"  /><input type="hidden" name="p_arg_names" value="135806576419782464" /><input type="hidden" name="p_t02" value="Ask Tom &quot;Separating comma separated words &quot;" id="P11_SUBJECT_TEXT"  /><input type="hidden" name="p_arg_names" value="246471181092262439" /><input type="hidden" name="p_t03" value="115024000346942855" id="P11_LATEST_FOLLOWUP_ID"  /></td></tr>
</table>
</div><h1>Pradeep -- Thanks for the question regarding "Separating comma separated words ", version 8.0.5</h1> 
<div class="ri" >
<div class="tl">Submitted on 11-Dec-2001 9:24 Eastern US time</div> 
<div class="tr"><a href="javascript:latestFollowup();">Tom's latest followup</a> | <a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a></div> 
<div class="tb">Last updated 15-Feb-2007 9:51</div> 
</div> 
<h2 style="font-style:italic;">You Asked </h2>
<pre>In my database table, there is one field for the employee name in the order of ( 
First_name,Last_name,Middle_initial).
Example (Brian,Robbin,D).
I want to separate each of these words and put it into a new table 
with three fields (First_name, Last_name, Middle_name).

I want to write a PL/SQL , so for all the employees, it would be done at a time. </pre> <br />
<h2 style="font-style:italic;">and we said...</h2>
<pre>

instr and substr is all you need.  don't use PLSQL:

variable x varchar2(25)

exec :x := 'Brian,Robbin,D'
select substr( :x||',', 1, instr(:x,',')-1 ) first_name,
       substr( :x||',,', instr( :x||',,', ',') +1, 
                         instr( :x||',,', ',', 1, 2 )-instr(:x||',,',',')-1 ) last_name,
       rtrim(substr( :x||',,', instr( :x||',,',',',1,2)+1),',') middle_init
 from dual
/



 </pre> <br />
<table class="t18Region" id="R6544425240409845" border="0" cellpadding="0" cellspacing="0" summary="" width="98%" style="border:none;">
<tbody class="ReportsRegion">
<tr>
<th class="t18RegionHeader">Reviews</th>
<th class="t18ButtonHolderHeader" width="100%">&nbsp;&nbsp;&nbsp;</th>
</tr>
<tr>
<td class="t18RegionBody" colspan="2"><div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>||',' ??</b>
&nbsp;&nbsp;December  11, 2001
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#2197130995911">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="2197130995911">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Jim</b>&nbsp;</div>
</div>
<pre>Tom,
    I'm not sure why you are concatenating ',' and in some cases ',,' to :x?
I'll keep testing but at the moment it works without
them
Regards
Jim </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom2197130995911"></a>
<pre>It is for strings that are malformed (that don't have 2 commas in them)

and I just noticed I missed one case!  see below in bold, we need that extra comma as well


ops$tkyte@ORA817DEV.US.ORACLE.COM&gt; create table t ( x varchar2(15) );
Table created.

ops$tkyte@ORA817DEV.US.ORACLE.COM&gt; insert into t values ( 'tom' );

1 row created.

ops$tkyte@ORA817DEV.US.ORACLE.COM&gt; insert into t values ( 'tom,kyte' );

1 row created.

ops$tkyte@ORA817DEV.US.ORACLE.COM&gt; insert into t values ( 'tom,kyte,j' );

1 row created.

ops$tkyte@ORA817DEV.US.ORACLE.COM&gt; 
ops$tkyte@ORA817DEV.US.ORACLE.COM&gt; select substr( x||',', 1, <b>instr(x||',',',')</b>-1 ) first_name,
  2         substr( x||',,', instr( x||',,', ',') +1,
  3                           instr( x||',,', ',', 1, 2 )-instr(x||',,',',')-1 )
  4  last_name,
  5         rtrim(substr( x||',,', instr( x||',,',',',1,2)+1),',') middle_init
  6   from t
  7  /

FIRST_NAME       LAST_NAME         MIDDLE_INIT
---------------- ----------------- -----------------
tom
tom              kyte
tom              kyte              j


<b>without the extra commas, we parse wrong</b>

ops$tkyte@ORA817DEV.US.ORACLE.COM&gt; 
ops$tkyte@ORA817DEV.US.ORACLE.COM&gt; 
ops$tkyte@ORA817DEV.US.ORACLE.COM&gt; select substr( x, 1, instr(x,',')-1 ) first_name,
  2         substr( x, instr( x, ',') +1,
  3                           instr( x, ',', 1, 2 )-instr(x,',')-1 )
  4  last_name,
  5         rtrim(substr( x, instr( x,',',1,2)+1),',') middle_init
  6   from t
  7  /

FIRST_NAME      LAST_NAME       MIDDLE_INIT
--------------- --------------- ---------------
                                tom
tom                             tom,kyte
tom             kyte            j


 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>INSTR a whole word</b>
&nbsp;&nbsp;May       14, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#9794085147040">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="9794085147040">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Sachin</b>&nbsp;from Germany</div>
</div>
<pre>Database Version: 8.1.7.4
Tom,
I want to search a comma delimited string for a whole word..instead of parts of word..

Example:
Vstring varchar2(50) := 'THISTHAT,THIS'

IF INSTR(Vstring, 'THISTHAT') &lt;&gt; 0 AND INSTR(Vstring, 'THIS') &lt;&gt; 0 THEN
.......

Now above statement will be true also for
Vstring = 'THISTHAT'...
so, Is there a way that we can look for whole words...

Thanks a bunch... </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom9794085147040"></a>
<pre>if instr( ','||vstring||',', ',THISTHAT,') &lt;&gt; 0 .....

put a leading/trailing , and look for that as part of the keyword as well </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>split names</b>
&nbsp;&nbsp;May       15, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#9803121696956">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="9803121696956">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Lakshmi</b>&nbsp;from Bangalore India</div>
</div>
<pre>Excellent  </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Simply superb</b>
&nbsp;&nbsp;May       15, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#9807239698148">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="9807239698148">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Sachin</b>&nbsp;from Germany</div>
</div>
<pre>Thanks Thanks Thanks.... </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>INSTR LIMIT</b>
&nbsp;&nbsp;May       15, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#9810969451549">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="9810969451549">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>What is the character limit on string that is being searched...can it be more than 4000...
Looked in docs..couldn't find it there... </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom9810969451549"></a>
<pre>4000 in SQL

32767 in PLSQL

4gig in DBMS_LOB

4gig if you use contains instead of instr (and it'll be faster to boot probably) </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
&nbsp;&nbsp;July      02, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#10832807992852">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="10832807992852">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Vasukh</b>&nbsp;from Richmond, VA</div>
</div>
<pre>Tom,
Thanks for your help!

Oracle8.1.7
I have a varchar2(1500) field with 45 tab-delimited elements that I want to split and insert into a 
45 column table. 

Will the above approach give me the best performance for about 200,000 rows?

Is there a way to identify the 45 positions once, in a before-insert trigger and substr() each 
element in an after-insert trigger for faster performance? Are any other mehods available?

Thanks !!


 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom10832807992852"></a>
<pre>I would dump it to a file and use sqlldr to load the delimited file.

it should take all of a minute or two.

see
</pre> <pre><a href="http://asktom.oracle.com/~tkyte/flat/index.html">http://asktom.oracle.com/~tkyte/flat/index.html</a></pre> <pre>
you can use &quot;flat&quot; to unload the table with a big string.

you can use sqlldr_exp on the 45 column table to have a ctl file built for you easily -- then 
sqlldr it. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Separating Tab-delimited String</b>
&nbsp;&nbsp;July      02, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#10837584144317">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="10837584144317">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Vasukh</b>&nbsp;from Richmond, VA</div>
</div>
<pre>Tom,

The process (to separate the Tab-delimited string) needs to be executed from a stored-procedure. 

Sorry, I did not fully understand the solution. Should sqlldr be called as an external procedure?

thanks,

Vasukh
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom10837584144317"></a>
<pre>you asked:

Will the above approach give me the best performance for about 200,000 rows?



A stored procedure would not be part of my answer on that.  sqlldr cannot really be called as an 
extproc (you could run a host command).

You'll have to parse the string.  However, calling that plsql function 45 * 200,000 times will not 
fall into my definition of &quot;fast&quot;.


so, a single insert into modelled after this:

ops$tkyte@ORA817DEV&gt;
ops$tkyte@ORA817DEV&gt; select x data,
  2             substr( x, 1, x1-1 ) data,
  3         substr( x, x1+1, x2-x1-1 ) data,
  4         substr( x, x2+1, x3-x2-1 ) data,
  5         substr( x, x3+1, x4-x3-1 ) data,
  6         substr( x, x4+1 ) data
  7    from (select x,
  8                decode( x1, 0, to_number(null), x1 ) x1,
  9                decode( x2, 0, to_number(null), x2 ) x2,
 10                decode( x3, 0, to_number(null), x3 ) x3,
 11                decode( x4, 0, to_number(null), x4 ) x4
 12    from (select x,
 13                 instr(x||',',',',1,1) x1,
 14                 instr(x||',',',',1,2) x2,
 15                 instr(x||',',',',1,3) x3,
 16                 instr(x||',',',',1,4) x4
 17            from t1
 18          )
 19          );

DATA       DATA       DATA       DATA       DATA       DATA
---------- ---------- ---------- ---------- ---------- ----------
1,2,3,4,5  1          2          3          4          5
1,2,3,4    1          2          3          4
1,2,3      1          2          3
1,2        1          2
1          1

just add x5..x44
use chr(9) instead of ','
use insert /*+ append */ into .... select .....;


 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Separating Tab-delimited String  </b>
&nbsp;&nbsp;July      02, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#10838027273259">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="10838027273259">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Vasukh</b>&nbsp;from Richmond, VA</div>
</div>
<pre>Thanks! </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>parsing a string</b>
&nbsp;&nbsp;October   16, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#13077563130136">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="13077563130136">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Anita</b>&nbsp;</div>
</div>
<pre>Tom,
Can you please help me with this....

Availabe Input (comma separted values in a table):
Two columns are:
data_points: 1,1,1,1,2,2,3,3,3,1,1,4,4
data_dates:07/08,07/15,07/22,07/29,08/05,08/12,08/19,08/26,09/02,09/09,09/16,09/23,09/30  

Required Output:( Group by consecutive dates and data.)

new_data_points , start_date, end_date
1               ,   07/08,    07/29
2               ,   08/05,    08/12
3               ,   08/19,    09/02
1               ,   09/09,    09/16
4               ,   09/23,    09/30  

The date is always a week apart.
Grouping by the data_point to get the new_data_point and get the start and end dates using the 
data_dates.



Can you please give me a solution for this.

Thanks,
Anita.
  </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom13077563130136"></a>
<pre>got a particular version in mind? </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;October   16, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#13080808648035">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="13080808648035">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>peddua@yahoo.com</b>&nbsp;</div>
</div>
<pre>Not particular with the version 
But we are using 9i.

Thanks,
Anita. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom13080808648035"></a>
<pre>well, I can get you this far:

ops$tkyte@ORA920&gt; create type myScalarType as object
  2  ( dp int, dd date )
  3  /
 
Type created.
 
ops$tkyte@ORA920&gt; create type myTableType as table of myScalarType
  2  /
 
Type created.
 
ops$tkyte@ORA920&gt;
ops$tkyte@ORA920&gt; create or replace function parse( p_dp in varchar2, p_dd in varchar2 )
  2  return myTAbleType
  3  PIPELINED
  4  as
  5          l_dp long := p_dp || ',';
  6          l_dd long := p_dd || ',';
  7      n  number;
  8          l_rec myScalarType := myScalarType(null,null);
  9  begin
 10          loop
 11                  n := instr( l_dp, ',' );
 12                  if ( nvl(n,0) &gt; 0 )
 13                  then
 14                          l_rec.dp := substr( l_dp, 1, n-1 );
 15                          l_dp := substr( l_dp, n+1 );
 16                  else
 17                          l_rec.dp := null;
 18                  end if;
 19                  n := instr( l_dd, ',' );
 20                  if ( nvl(n,0) &gt; 0 )
 21                  then
 22                          l_rec.dd := to_date( substr( l_dd, 1, n-1 ), 'mm/dd' );
 23                          l_dd := substr( l_dd, n+1 );
 24                  else
 25                          l_rec.dd := null;
 26                  end if;
 27                  exit when l_rec.dd is null and l_rec.dp is null;
 28
 29                  pipe row( l_rec );
 30          end loop;
 31          return;
 32  end;
 33  /
 
Function created.
 
ops$tkyte@ORA920&gt;
ops$tkyte@ORA920&gt;
ops$tkyte@ORA920&gt; select *
  2    from TABLE( parse('1,1,1,1,2,2,3,3,3,1,1,4,4',
  3                      
'07/08,07/15,07/22,07/29,08/05,08/12,08/19,08/26,09/02,09/09,09/16,09/23,09/30' ) )
  4   order by dd
  5  /
 
        DP DD
---------- ---------
         1 08-JUL-03
         1 15-JUL-03
         1 22-JUL-03
         1 29-JUL-03
         2 05-AUG-03
         2 12-AUG-03
         3 19-AUG-03
         3 26-AUG-03
         3 02-SEP-03
         1 09-SEP-03
         1 16-SEP-03
         4 23-SEP-03
         4 30-SEP-03
 
13 rows selected.
  

but I don't see how to turn that into your result -- i don't see how you got the numbers/dates you 
did? </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>In some contects varchar2 variable limit is 32512 characters...</b>
&nbsp;&nbsp;October   16, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#13081650774203">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="13081650774203">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Piotr Jarmuz</b>&nbsp;from Poznan, Poland</div>
</div>
<pre>Interesting to note is the fact that varchar2 variables as parameters to stored procedures (in 
in/out out) may be &quot;only&quot; 32512 bytes long.

I've checked this in Java and Perl. 32512 is the last value that works, for any bigger it throws:

Exception in thread &quot;main&quot; java.sql.SQLException: ORA-01460: unimplemented or unreasonable 
conversion requested

But in PL/SQL as you said 32767

Regards,
Piotr </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>It is even stranger...</b>
&nbsp;&nbsp;October   16, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#13082105840406">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="13082105840406">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Piotr Jarmuz</b>&nbsp;from Poznan, Poland</div>
</div>
<pre>create or replace procedure print_length(a varchar2) is
begin
    dbms_output.put_line(length(a));
end;
/

declare
x varchar2(32767);
begin
     for i in 1..32767 loop
          x:=x || 'a';
     end loop;
     one(x || x || 'a');
end;

will give 65535 and this is the ultimate limit...
strange indeed.

Tom, can you explain that?

Regards. </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>RE: In Some Contexts</b>
&nbsp;&nbsp;October   16, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#13084090220139">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="13084090220139">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Mark A. Williams</b>&nbsp;from Indianapolis, IN USA</div>
</div>
<pre>A synopsis of this from MetaLink:

Although in PL/SQL a VARCHAR2 has a maximum size of 32767 characters, some overhead is needed when 
the PL/SQL value is bound to a host variable.  Thus, if you are binding PL/SQL values to a host 
variable, the maximum allowance of a VARCHAR2 variable is 32512 characters.

- Mark </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>I thoght so...</b>
&nbsp;&nbsp;October   16, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#13084813399538">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="13084813399538">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Piotr Jarmuz</b>&nbsp;from Poznan, Poland</div>
</div>
<pre>Mark,

Thanks for your explanation... I thought so but now I am sure.

Yet another test I have done:

In an OCI external procedure you can create a C string with OCIExtProcAllocCallMemory (which I 
guess &lt;this may be wrong&gt; corresponds to varchar2 string in PL/SQL) as big as you like (I have 
created successfully ~ 100 MB string) but when the value is returned to SQL layer it throws the 
exception:

ORA-06502: PL/SQL: numeric or value error: character string buffer too small
ORA-06512: at &quot;P_JARMUZ.RUN_PROGRAM3&quot;, line 7
ORA-06512: at line 2

Regards </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Hi Piotr</b>
&nbsp;&nbsp;October   16, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#13085710636570">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="13085710636570">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Mark A. Williams</b>&nbsp;from Indianapolis, IN USA</div>
</div>
<pre>Hi Piotr,

I am intrigued by your 65536 case and am looking at a trace of the execution of that right now... 
very interesting indeed.  If I find anything worthwhile in that I will post it here.  I don't do 
much OCI programming, but that sounds interesting as well.

Thanks!

- Mark

 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Anita</b>
&nbsp;&nbsp;October   16, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#13090851804313">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="13090851804313">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Thanks Tom. </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Comma Delimited Data</b>
&nbsp;&nbsp;November  26, 2003
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#13971294593381">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="13971294593381">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Anuj</b>&nbsp;from USA</div>
</div>
<pre>Hi!!! Tom

I want to extract data from table which has comma delimited data 123,456,789....it could be from 1 
to N.It could be same or different for each row and now i want to extract this data and insert it 
into table with different rows ,ofcourse other columns will have same data. ex : Tab1 is Source 
table and Tab2 is Target table

Tab1
col1      col2         col3
1          123,456,78    abc
2          902,87,123    xyz
3          12,13         uvw
 
-------------------


Tab2

col1    col2        col3

1         123         abc
1         456         abc
1          78         abc
2         902         xyz
2          87         xyz 
2         123         xyz 
3          12         uvw 
3          13         uvw  
Thanks! </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom13971294593381"></a>
 <pre><a href="http://asktom.oracle.com/pls/asktom/f?p=100:11:::::P11_QUESTION_ID:2460648511591#13951062520752">http://asktom.oracle.com/pls/asktom/f?p=100:11:::::P11_QUESTION_ID:2460648511591#13951062520752</a></pre>  <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>split function</b>
&nbsp;&nbsp;March     05, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16176437832653">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16176437832653">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>dxl</b>&nbsp;</div>
</div>
<pre>Is there not an equivalent function to the SQLSERVER SPLIT function for character strings somewhere 
out there for ORACLE?
Someone must've written one by now?
I keep meaning to do it but haven't found the time yet! </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom16176437832653"></a>
<pre>search this site for str2table </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Pluck only first, second, seventh, and eighth  columns only</b>
&nbsp;&nbsp;March     15, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16450234997622">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16450234997622">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom

I have a string which has 10 values delimited by commas. I have to pluck only first, second, 
seventh, and eighth  columns. 

Actually I have to loop though hundred such rows and insert into table t. If there are duplicate 
rows ( based on the values of first and second columns), then I will be doing the dup_val_on_index 
error condition and updating the rest of the columns.

What is the simplest way of doing it, how can I pluck just those columns from the string. Your 
generic solution does not work for us, as I have been asked not to create the bad_log table.

If the string is 

'once,43434,third,fourth,fifth,sixth,234,66'
'once,43434,third,fourth,fifth,sixth,234,33'

Further I have to ignore rows with 33 value for the last column and pick up the other ones.

Please help. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom16450234997622"></a>
<pre>well, i certainly hope you don't have to &quot;loop&quot; over anything.  If these are in a flat file -- use 
an external table (9i) or sqlldr (8i and before) so you can query this data.

so, assuming you loaded this into t1, or have an external table t1, all you need to do is &quot;substr&quot;


ops$tkyte@ORA9IR2&gt; create table t1 ( data varchar2(100) );
 
Table created.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; insert into t1 values ( 'once,43434,third,fourth,fifth,sixth,234,66' );
 
1 row created.
 
ops$tkyte@ORA9IR2&gt; insert into t1 values ( 'once,43434,third,fourth,fifth,sixth,234,33' );
 
1 row created.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; create table t2 ( c1 varchar2(10), c2 varchar2(10), c3 varchar2(10), c4 
varchar2(10) );
 
Table created.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; insert into t2
  2  select substr( data, 1, comma1-1 ) c1,
  3         substr( data, comma1+1, comma2-comma1-1 ) c2,
  4         substr( data, comma6+1, comma7-comma6-1 ) c3,
  5         substr( data, comma7+1, comma8-comma7-1 ) c4
  6    from (
  7  select instr(data,',',1,1) comma1,
  8         instr(data,',',1,2) comma2,
  9         instr(data,',',1,3) comma3,
 10         instr(data,',',1,4) comma4,
 11         instr(data,',',1,5) comma5,
 12         instr(data,',',1,6) comma6,
 13         instr(data,',',1,7) comma7,
 14         length(data)+1 comma8,
 15         data
 16    from t1
 17   where data NOT LIKE '%,33'
 18         )
 19  /
 
1 row created.
 
ops$tkyte@ORA9IR2&gt; select * from t2;
 
C1         C2         C3         C4
---------- ---------- ---------- ----------
once       43434      234        66
 
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
&nbsp;&nbsp;March     16, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16470046454426">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16470046454426">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Well, that is the only option left, we are using forms9i, the flat file will on user desktop
and we cannot use utl_file, external tables as they require the file to be on the database server,
and we cannot use sqlloader as this functionality needs to be triggered of by the user from the
application whose access is through a web browser.

You have anything to comment on this. What I'm saying is what you have opined else where on your
web site </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars1.gif" alt="1 stars" />
<b>you missed the point</b>
&nbsp;&nbsp;March     16, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16470149464882">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16470149464882">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom, the data is in the csv file and not in a table, you solution will work when it is in the 
table. Can you please demo the case where it is in the flat file and we have to get it into the 
table i.e. the first, second, seventh and eight columns. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom16470149464882"></a>
<pre>you missed my main points:

&lt;quote&gt;
well, i certainly hope you don't have to &quot;loop&quot; over anything.  If these are in 
a flat file -- use an external table (9i) or sqlldr (8i and before) so you can 
query this data.

&lt;/quote&gt;

else, use whatever programming language you like to &quot;loop&quot; over the data, parse it and insert it.  
it becomes a simple &quot;programming 101&quot; problem at that point.


Heck, just read the file and insert each row into a table with a trigger, let the trigger do the 
substring (just as coded above) and insert into the real table if you like.

 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Interesting scenario</b>
&nbsp;&nbsp;March     17, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16529972491591">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16529972491591">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>'once,43434,third,fourth,fifth,sixth,2344,66'

The 234 above sometimes can also be like 2,344. Now I should not consider that comma, as the data's 
intent is that it is 2,344 and not 2 and 344 separately.

How can I disregard the commas within the column values, I have to do that before I pluck the 
columns apart. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom16529972491591"></a>
<pre>good luck with that!  have fun (someone has &quot;messed up&quot; big time here)

Tell me, given:

1,200,100,300,2,1,3,2,1


is that

1
200,100
300
2
1
3
2
1

or

1
200
100,300
.....


hmmm.... you cannot get there from here as far as I'm concerned unless you want garbage in...
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>tab delimited</b>
&nbsp;&nbsp;March     17, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16530966735364">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16530966735364">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom , if I'm using a tab delimited file, then how should I represent a tab in my code, will a ' ' 
represent the tab. I have to capture the tab positions. 

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom16530966735364"></a>
<pre>chr(9) is a tab </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>next best option</b>
&nbsp;&nbsp;March     17, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16532775570848">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16532775570848">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom I guess the next best option would be to request for a tab separated file, and then translate, 
replace all the commas with ''.

What is your opinion.

Further, I see that when I save a xls file as tab delimited some of the values are within &quot;    &quot;, 
what does that signify? </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom16532775570848"></a>
<pre>if you have a tab delimited file, you are back in business.

you would just use to_number(substr(....),'999,999,999,999')


if you have things in quotes that means they (the strings) contain the delimiter.

See

</pre> <pre><a href="http://asktom.oracle.com/~tkyte/SkipCols/index.html">http://asktom.oracle.com/~tkyte/SkipCols/index.html</a></pre> <pre>
the delimited package might be of interest. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>to_number(substr(....),'999,999,999,999')</b>
&nbsp;&nbsp;March     17, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16534452359682">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16534452359682">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Why use to_number(substr(....),'999,999,999,999')

why cant I just do the substr and do replace, translate and remove the commas, and insert into my 
loading table.

Further..

SQL&gt; select to_number( '42,4324', '999,999,999,999') from dual;
select to_number( '42,4324', '999,999,999,999') from dual
                  *
ERROR at line 1:
ORA-01722: invalid number </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom16534452359682"></a>
<pre>you just gave the perfect reason for using to_number.


what the HECK is 42,4324

I call it &quot;garbage&quot; if it is supposed to be a number.  I'd really like it to fail so I can get the 
correct data.

If you just do a replace -- you would turn that garbage, an obvious data error, into 424,324 
silently.  


garbage in, garbage out... </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
&nbsp;&nbsp;March     18, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16569941244392">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16569941244392">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom

when I substr my string the seventh column happens to be mapping to a number column in my table 
into which I need to load the data.

When I substr it I get something like &quot;1,992&quot; ( with the quotes), I then do a replace, translate 
and load the data into the table.

My flat file is a tab delimited file.

I tried doing a replace, translate on the new line as soon as I get it( i'm using text_io), but 
that somehow messes up my data when I do the substr I'm not aboble to pluck the 1,992.

What else can be the approach.

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom16569941244392"></a>
<pre>ops$tkyte@ORA9IR2&gt; select to_number( trim( '&quot;' from '&quot;1,999&quot;' ), '999,999,999' ) from dual;
 
TO_NUMBER(TRIM('&quot;'FROM'&quot;1,999&quot;'),'999,999,999')
-----------------------------------------------
                                           1999
 
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
&nbsp;&nbsp;March     19, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#16590273785393">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="16590273785393">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>why trim, why not replace and translate, why cant I just remove the comma and insert into my number 
database column.

can you please discuss the basics behind your insistence on your converting it into a number. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom16590273785393"></a>
<pre>you asked me and i answered.

replace and translate would accept garbage and give you garbage but silently give it to you.

trim removes only leading and trailing &quot;'s (only place you expect them)
to_number accepts only numbers


&quot;11111111,111111111111&quot;

is not a number, you would accept it, i would not. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>check for the occurance of a value in a string</b>
&nbsp;&nbsp;March     31, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#17007318850985">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="17007318850985">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom 

in sql I need to check if a database column value contains 'zz' at any place, or at the end of the 
string i.e. the last 2.

what is the best way to do this validation  </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom17007318850985"></a>
<pre>create table t 
( ...
  x   varchar2(50) check ( x like '%zz%' ),
  ...
)

 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
<b>String Parsing - Use Java API (i.e. StringTokenizer)</b>
&nbsp;&nbsp;March     31, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#17011294269369">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="17011294269369">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>PLSQL does not have many built-in packages for String parsing.

On the other hands, you can use Java APIs for very power string parsing.  For example, you can 
write a Java Stored Procedure that using Java's StringTokenizer to parsing your string.

I haven't seen any existing PLSQL packages that have the same features of StringTokenizer.

People should use Java APIs.  You can't beat a proven and robust Java classes. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom17011294269369"></a>
<pre>well, there is regexp in 10g and i have personally never seen anything done in java with strings 
that I cannot do as easily in plsql 


so -- show me, prove me wrong.  give us some java that does something really cool, in a compact 
fashion.  make sure to provide the specs in english (like you would in a production piece of code) 
and we'll see!
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>RE: Java API</b>
&nbsp;&nbsp;April     01, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#17013038925770">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="17013038925770">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Frank</b>&nbsp;from NL</div>
</div>
<pre>&lt;quote&gt;People should use Java APIs.  You can't beat a proven and 
robust Java classes.
&lt;/quote&gt;

Sure, we'll go out and hire a Java programmer immediately, 'cause we SHOULD use Java APIs.
Or as someone put it: 
Java is just a language
Java is just a language
...
(repeat this)
;) </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom17013038925770"></a>
<pre>you know, one of my favorite C functions of all times is 'strtok' (the printf family of functions 
is not too far behind)
 
therefore, we should all be writing code in C


Wait, COBOL makes doing reporting pretty easy.
....... </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
<b>Here Is the An Example of Java StringTokenizer Vs. PLSQL</b>
&nbsp;&nbsp;April     01, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#17049230881824">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="17049230881824">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Hi Tom,

Here is my example of how Java StringTokenizer class vs. PLSQL.  It will show that implementing 
with Java is easier, faster, and more robust than writing your own PLSQL package.  I have not seen 
any Oracle built-in PLSQL packages (maybe except 10g RegEx) have the same features as 
StringTokenizer.

Propose: 
Parse the string into multiple tokens, delimited by space, semicolon, comma, colon, etc.

Package Specs:
PACKAGE cms_util is
    function get_token (in_str in varchar2)
        return varchar2array;

    function get_tokens (p_str in varchar2)
        return varchar2array as
        language java
        name 'com.han.cms.utilities.StringUtilities.getTokens(java.lang.String)
         return com.han.cms.plsql.Varchar2Array';

    function get_tokens (p_str in varchar2, p_delims in varchar2)
        return varchar2array as
        language java
        name 'com.han.cms.utilities.StringUtilities.getTokens(java.lang.String,
        java.lang.String) return com.han.cms.plsql.Varchar2Array';
end;

PLSLQ Implementation In Body (See how long the code):
PACKAGE BODY cms_util is
    /**
        Disclaimer: Taken this function from some web site.  
                    Sorry, I forget the original author 
     */
    function get_token (in_str in varchar2)
        return varchar2array is
        str_left                    varchar2 (32767);
        str_end                     pls_integer;
        sp1                         pls_integer;          /* For space      */
        sc1                         pls_integer;          /* For semi-colon */
        st1                         pls_integer;          /* For stop       */
        cm1                         pls_integer;          /* For comma      */
        cn1                         pls_integer;          /* For colon      */
        c_greatest_value   constant pls_integer      := 2147483647;
        v_tokens                    varchar2array    := varchar2array ();
        v_count                     integer          := 1;
    begin
        /* Use this if tabs are to be treated as tabs */
        str_left := in_str;
        /* Use this if tabs are to be treated as spaces */
        str_left := replace (in_str, chr (9), ' ');

        loop
            /* Finding first occurence of respective characters */
            sp1 := instr (str_left, ' ', 1);
            sc1 := instr (str_left, ';', 1);
            cm1 := instr (str_left, ',', 1);
            st1 := instr (str_left, '.', 1);
            cn1 := instr (str_left, ':', 1);

            /* If the character doesn't occur set first_occurence to max value */
            if sp1 = 0 then
                sp1 := c_greatest_value;
            end if;

            if sc1 = 0 then
                sc1 := c_greatest_value;
            end if;

            if cm1 = 0 then
                cm1 := c_greatest_value;
            end if;

            if st1 = 0 then
                st1 := c_greatest_value;
            end if;

            if cn1 = 0 then
                cn1 := c_greatest_value;
            end if;

            str_end := least (sp1, sc1, cm1, st1, cn1);

            if str_end = c_greatest_value then
                if str_left is not null then
                    dbms_output.put_line (str_left);
                    v_tokens.extend;
                    v_tokens (v_count) := str_left;
                    v_count := v_count + 1;
                end if;

                exit;
            end if;

            if str_end = sp1 then
                /* We don't want to print out spaces. Spaces appear
                   in dbms_outputif we
                   &quot;set serveroutput on size 1000000 FORMAT WORD_WRAPPED&quot;
                 */
                if (substr (str_left, 1, str_end - 1) != ' ') then
                    dbms_output.put_line (substr (str_left, 1, str_end - 1) );
                end if;

                str_left := substr (str_left, str_end + 1);
                v_tokens.extend;
                v_tokens (v_count) := str_left;
                v_count := v_count + 1;
            else
                /* We don't want to print out spaces. Spaces appear in
                   dbms_outputif we
                   &quot;set serveroutput on size 1000000 FORMAT WORD_WRAPPED&quot; */
                if (substr (str_left, 1, str_end - 1) != ' ') then
                    dbms_output.put_line (substr (str_left, 1, str_end - 1) );
                end if;

                str_left := substr (str_left, str_end);
                dbms_output.put_line (substr (str_left, 1, 1) );
                str_left := substr (str_left, 2);
                v_tokens.extend;
                v_tokens (v_count) := str_left;
                v_count := v_count + 1;
            end if;

            if str_left is null then
                exit;
            end if;
        end loop;

        return v_tokens;
    end;
end;

Java Class Inside The Database:
public class StringUtilities {
public static Varchar2Array getTokens(String values, String delimiters,
                                          boolean returnDelims) {
        StringTokenizer strTokenizer = new StringTokenizer(values, delimiters,
                                                           returnDelims);
        String[] tokens = null;
        int count = strTokenizer.countTokens();

        if (count &gt; 0) {
            tokens = new String[count];

            for (int i = 0; i &lt; count; i++) {
                tokens[i] = strTokenizer.nextToken();
            }
        }

        //return tokens;
        return new Varchar2Array(tokens);
    }
}

Note: Varchar2Array is a wrapper class generated by JPublisher based on the varchar2array nested 
table.

CREATE OR REPLACE 
type varchar2array is table of varchar2(32676);

Conclusion:
1. PLSQL lacks some basic built-in libraries, e.g. String Tokenizer
2. Use Java J2SE to supplement PLSQL when PLSQL lacks the features (i.e. NOT code some long PLSQL 
to do things that are already done by Java; I would even argue that it is more robust to use Java 
proven APIs than newly written code).

Please let me know if you need more prove.  

Disclaimer: I have not reviewed 10g RegEx.  Will 10g RegEx be available in previous Oracle 
versions?  If not, what is your recommendation to existing customers who want to use RegEx?  I 
would recommend they use Java Stored Procedure that call Java RegEx (either the JDK 1.4 RegEx or 
other RegEx libraries, like Apache).

Thanks. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom17049230881824"></a>
<pre>now, benchmark it in SQL using it like people use substr

Let us know how that goes.... </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
<b>.. and here a PL/SQL example</b>
&nbsp;&nbsp;April     02, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#17062701903718">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="17062701903718">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>eugene</b>&nbsp;</div>
</div>
<pre>This PL/SQL code was run with Oracle 8.0, 8i, 9iR2.


BANNER
----------------------------------------------------------------
Oracle8i Enterprise Edition Release 8.1.7.4.0 - Production

SQL&gt; create or replace procedure strToken(line IN varchar2, tokenChar IN varchar2 default ';')
  2  is
  3    TYPE  tokenTableType is TABLE of varchar2(4000)   -- table for Stringtoken
  4      index by binary_integer;
  5    --
  6    tokens    tokenTableType;
  7    vCnt      integer := 1;
  8    myLine    varchar2(4000) := null;
  9    vPos      integer := 1;
 10    --
 11  begin
 12    while (vPos &lt;= length(line))
 13    loop
 14      if (length(replace(tokenChar,substr(line, vPos, 1), '')) = length(tokenChar)) then
 15        myLine := myLine || substr(line, vPos, 1);
 16      elsif (myLine is not NULL) then
 17        tokens(vCnt) := myLine;
 18        myLine := null;
 19        vCnt := vCnt + 1;
 20      end if;
 21      vPos := vPos + 1;
 22    end loop;
 23    --
 24    if (myLine is not NULL) then
 25      tokens(vCnt) := myLine;
 26    end if;
 27    --
 28    vCnt := 1;
 29    for vCnt in 1..tokens.count()
 30    loop
 31      dbms_output.put_line(vCnt||'  '||tokens(vCnt));
 32    end loop;
 33    --
 34  end;
 35  /

Procedure created.

SQL&gt;
SQL&gt; set serveroutput on
SQL&gt;
SQL&gt; set timing on
SQL&gt; exec strToken('ADBC;ERFG.khjf,hjkfhsd POt',';. ');
1  ADBC
2  ERFG
3  khjf,hjkfhsd
4  POt

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.46
SQL&gt; exec strToken('ADBC;ERFG.khjf,hjkfhsd POt',';, ');
1  ADBC
2  ERFG.khjf
3  hjkfhsd
4  POt

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.47
SQL&gt; exec strToken('ADBC;ERFG.khjf,hjkfhsd POt',';,.');
1  ADBC
2  ERFG
3  khjf
4  hjkfhsd POt

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.47
SQL&gt;
SQL&gt; </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
<b>RE: Here Is the An Example of Java StringTokenizer Vs. PLSQL  </b>
&nbsp;&nbsp;April     02, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#17088075063394">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="17088075063394">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>&lt;quote&gt;
now, benchmark it in SQL using it like people use substr

Let us know how that goes.... 
&lt;/quote&gt;

I think you are missing these points:

1.  Oracle lacks some built-in PLSQL package (e.g. String Tokenizenier).

2.  If there is NO existing built-in PLSQL package, one should try to use other existing proven 
library, like Java, NOT trying to spend hours of coding and testing when you can use Java inside 
the database.

yes, PLSQL probably can be coded to solve many problems.  However, do people want to reinvent the 
wheel?  If yes, why people use Oralce built-in package?  They should just code everything on their 
own.  

Or, is the wheel only implied as Oracle?  Do people think that they need to invent when Oracle does 
not have certain features in its built-in packages?  If yes, they are NOT living in the real world. 
 The wheel is bigger than Oracle.  So, learn more than PLSQL please.  Java is NOT difficult.

Tom, isn't Oracle using use Java inside its database?  Some built-in PLSQL packages just call Java.

Isn't Oracle want people to use Java inside the database?

Isn't Oracle still the ONLY database that can run Java?  I don't think DB2 or SQL Server even have 
any plan to run Java.  I remember maybe only Postgres plans to Java JVM inside its database.  
Anyway, Postgres isn't a database to many of us.

Thanks.
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom17088075063394"></a>
<pre>1) i've never really missed it -- instr, substr, et.al really do seem to cover it.

2) i don't spend hours.  it literally takes seconds to instr/substr.

do you see me writing a string tokenizer?  no.  do you see me using the builtins that exist to get 
the answer I need in a second (efficiently)?  yes.

so, there you go.

No, I don't want you to call plsql or even less java from SQL - that'll only slow it down.  you 
call plsql from sql if and when there is quite simply *no other way*.


Now, if you had a couple documents AND you needed to parse them THEN java would be a good idea.

If you have a couple of simple strings AND they are columns in a table AND you needed to extract 
data from them THEN substr/instr et.al. are a good idea


So, it is not that java is evil, or to be avoided - just that the heinous overheads of calling 
plsql or java (specially the latter) from SQL far outweighs the keystrokes you may or may not save.

 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>RE: Here Is the An Example of Java StringTokenizer Vs. PLSQL</b>
&nbsp;&nbsp;April     02, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#17096284210758">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="17096284210758">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom,

Thank you for your reply.

&lt;quote&gt;
1) i've never really missed it -- instr, substr, et.al really do seem to cover 
it.
&lt;quote&gt;

Agree.  Use built-in functions if they cover your problem.       
  
&lt;quote&gt;
2) i don't spend hours.  it literally takes seconds to instr/substr.
&lt;/quote&gt;

Yes, I have no doubt that you probably spend seconds.  However, I see many other PLSQL programmers 
write many lines of code trying to do things that are already done by some APIs.

&lt;quote&gt;
No, I don't want you to call plsql or even less java from SQL - that'll only 
slow it down.  you call plsql from sql if and when there is quite simply *no 
other way*.
&lt;/quote&gt;

Sorry, I wasn't thinking about calling PLSQL from SQL.  I was thinking about other applications 
calling the PLSQL package that execute some logics (include select) and do DML statements.  You do 
recommend the use of PLSQL package in this scenarios, right?  I see too many Java programmers don't 
use package, resulting in many DB connection calls.

&lt;quote&gt;
Now, if you had a couple documents AND you needed to parse them THEN java would 
be a good idea.

If you have a couple of simple strings AND they are columns in a table AND you 
needed to extract data from them THEN substr/instr et.al. are a good idea


So, it is not that java is evil, or to be avoided - just that the heinous 
overheads of calling plsql or java (specially the latter) from SQL far outweighs 
the keystrokes you may or may not save.
&lt;/quote&gt;

I totally agree with you on this point.

Thank you. </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>alphanumeric validation</b>
&nbsp;&nbsp;May       17, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#18532699913413">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="18532699913413">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom

I need to verify if the first 4 charaters of a varchar2 column is alphanumeric.

SQL&gt; var lv_alphanumeric varchar2(30);
SQL&gt; 
SQL&gt; 
SQL&gt; exec :lv_alphanumeric := '123a' ;

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; select substr(:lv_alphanumeric, 1,4) from dual;

SUBS
----
123a

I have to select only those values from a database table column whose first 4 characters are 
alpha-numeric.

Please guide me as to how I can accomplish this.

Thanks in advance
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom18532699913413"></a>
<pre>replace ... with the alphabet.

  1  select :x from dual
  2* where translate( upper(substr(:x,1,4)), '0123456789ABC...XYZ', rpad('X',36,'X')) = 'XXXX'
ops$tkyte@ORA9IR2&gt; /
 
:X
--------------------------------
123a!
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
&nbsp;&nbsp;May       17, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#18543180394096">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="18543180394096">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>SQL&gt; EXEC :X := 'AAAA' ;

PL/SQL procedure successfully completed.

SQL&gt;    select :x from dual
  2     where translate( upper(substr(:x,1,4)), '0123456789ABC...XYZ',
  3   rpad('X',36,'X')) = 'XXXX' ;

:X
--------------------------------
AAAA

Well, my objective is to filter out those values whose first 4 charaters are not alpha-numeric. As 
you see above it returns a value even when I passed 'AAAA' as the value.

Please help.
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom18543180394096"></a>
<pre>AAAA is alpha numeric?  not sure what you mean. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars1.gif" alt="1 stars" />
&nbsp;&nbsp;May       17, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#18549635435324">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="18549635435324">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>If we pass a value like 'AAAA' it should not return a value, if we pass something like '1AAA', then 
it should return that value.
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom18549635435324"></a>
<pre>and so what about AA1A etc etc etc.  or 1111...

you gotta give ALL of the rules (and you may well discover that once you list them out in a list, 
you'll be able to use the above technique -- extend it a tad -- and do it yourself)........

so, what are all of the rules -- is is really &quot;single digit number followed by 3 letters or 
numbers&quot; or what exactly....

alpha-numeric generally includes AAAA as well as 1111 as well as 1AAA.  be more specific. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars1.gif" alt="1 stars" />
&nbsp;&nbsp;May       18, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#18568948278133">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="18568948278133">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>The database column is a varchar2 columns.

It contains values like 'AAAABCDEFTGF', 'AA23FGDSGS', 'AAAAAAA'

Now I need to select values which are like 'AA23FGDSGSD' i.e. whose first 4 charactes have a 
number(s) in it. For example 'AA23FGDSGS' - here the first four characters have numbers 'AA23'.



create table tom_test( x varchar2(10));
insert into tom_test values ('AAAABCDEF');
insert into tom_test values ('AA23FGDSGS');
insert into tom_test values ('AAAAAAA');
commit;

Thanks
 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars1.gif" alt="1 stars" />
&nbsp;&nbsp;May       18, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#18569132303779">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="18569132303779">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom

Mind you, the values can also be like '12345', '45678'. But I want only values which have alphabets 
and numbers in the string, and that too in the first 4 characters of the string.

create table tom_test( x varchar2(10));
insert into tom_test values ('AAAABCDEF');
insert into tom_test values ('AA23FGDSGS');
insert into tom_test values ('AAAAAAA');
insert into tom_test values ('12345');
insert into tom_test values ('45678');

commit;
 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Sql has a way</b>
&nbsp;&nbsp;May       18, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#18576356985765">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="18576356985765">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>John Spencer</b>&nbsp;from Toronto, Ontario Canada</div>
</div>
<pre>Tom:

Great discussion on parsing.  Regarding the Alpha numeric problem, I think that A Reader is looking 
for something like

SELECT * 
FROM tom_test
WHERE LENGTH(REPLACE(TRANSLATE(UPPER(SUBSTR(x,1,4)),
                              'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
                              RPAD('X',26,'X')),'X',NULL)) BETWEEN 1 and 3
 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;May       18, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#18579242242614">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="18579242242614">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Gabe</b>&nbsp;</div>
</div>
<pre>To &quot;A reader&quot; ... what's up with the 1 and 2 star ratings? ... you've got your answer(s) ... you 
should be able to take it from there if it doesn't satisfy you (and that is only because you are so 
sloppy in the way you use the word alphanumeric).

The letters of the alphabet: a, A, b, B,  z, Z are referred as Alpha Characters.
The digits: 0,1,2,  9 are referred as Numeric Characters.
An Alphanumeric Character is any of the Alpha or Numeric Characters.

So all of these strings, ABcD, z2X3, 0234, contain exactly 4 alphanumeric characters.

After all your follow-ups my reading of what you want is: get all the strings having only 
alphanumeric chars in the first 4 positions but not all of them alpha chars and not all of them 
numeric chars. That is, z2X3 is OK but ABcD and 0234 are not.

BTW, you should also clarify for yourself:
1.    what to do about null values
2.    what to do if the string has less than 4 chars
3.    is the whole thing case-sensitive or not

FYI as well  when Tom wrote '0123456789ABC...XYZ' he meant for you to fill up the rest of the alfa 
chars between C and X  it looks like you just used it as is.

create table tt( x varchar2(10));
insert into tt values ('MAAABCDEF');
insert into tt values ('MA23FGDSGS');    &lt;== only this one satisfies your requirement
insert into tt values ('AA');
insert into tt values ('12345');
insert into tt values (null);

Here is what a quick and dirty query would be:

select t.x_original, t.x4
from   (
select x x_original
      ,translate( upper(substr(x,1,4))
                 ,'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'
                 ,rpad('0',10,'0')||rpad('X',26,'X')
                ) x4
from  tt
) t
where instr(t.x4,'0') &gt; 0
and   instr(t.x4,'X') &gt; 0
;

You get 0 stars for your due diligence  and give Tom a 5, will you?

John ... your length based solution would bring back a string like '12' ... my reading of the 
requirement is that he/she wants both alphas and digits ... but then again, which exactly is the 
requirement was the only real problem here.
 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;May       18, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#18590376816526">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="18590376816526">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Holy Sparrow, I cannot imagine that Tom will get upset with the rating, and not follow up on this 
thread </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom18590376816526"></a>
<pre>i didn't need to followup :) someone else did. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>the best way to do this</b>
&nbsp;&nbsp;June      11, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19612862174588">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19612862174588">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Jamba</b>&nbsp;</div>
</div>
<pre>LoanCode                LAmt Time  Total
15938,    yestica,Jocklin, F480,769,0.991,762, 24,   10,386



My flat file which save from a .xls file as  a txt comma delimited file(the columns names as shown 
below are available in the .txt file when copied form .xls) looks like the above. The four columns 
with labels are the ones I need to pluck out, and load it into a table.

It sounds simple untill now.

But now it gets interesting...


The number of columns and the order of columns can change i.e. the above can also look like 



          LoanCode    Lamt            time Total
yestica ,15938, Jocklin, 762,F480,769,0.991, 24, 10,386


In order to pluck the values I need, it is apparent that I have to first loop through the first row 
containing labels and capture the comma positions for those labels, and then capture the data 
depending on the comman positions capture for each respective value.


can you please show the smartest and best way to do the above i.e loop through the header row and 
capture the comman before and after even column which has a label.

Thanks

Jamba </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19612862174588"></a>
<pre>am i allowed to use a shell script?  i ask, because what I would do is

head the file, get line one
pipe that to sed to make it be a comma separated list of names
create a control file with the names in that order
run sqlldr.

on unixland, simple things like this are simple.  on windows, this gets to be a tad harder. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
&nbsp;&nbsp;June      11, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19614588459770">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19614588459770">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Jamba</b>&nbsp;</div>
</div>
<pre>NO shell script is not an option. The existing code is in PL/SQL.

The solution needs to be in PL/SQL.

Please suggest.

jamba </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19614588459770"></a>
<pre>ok, so you are reading the file like this:

LoanCode                LAmt Time  Total
15938,    yestica,Jocklin, F480,769,0.991,762, 24,   10,386

and you parse a line into an array (i'm assuming, it is what I would do)

so, line2 would be read into an array:

array(1) = 15938
array(2) = yestica
and so on.

your insert looks like:

  insert into t(loanCode,lAmt,Time,total) values (array(1), array(2), ... );

since the columns could get mixed up -- i would read line 1 into an array and then have variable 
loadCode_idx, lAmt_idx, .....

after reading the first line, i would search the array to discover that loadCode is the n'th 
element in there, that lAmt was the m'th element and so on..

then you 


  insert into t(loanCode,lAmt,Time,total) values (array(loanCode_idx), array(lAmt_idx), ... );


 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
<b>pseudo code</b>
&nbsp;&nbsp;June      11, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19615129605008">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19615129605008">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Jamba</b>&nbsp;</div>
</div>
<pre>What I want to do is

1.Capture the total number of commas in the given line( the first line which contains the column 
names)

2.Loop through the line so many times, pluck each value and see what it is , for example if it is 
LOANCODe,  then I would set the two variables comma_1, and comm_2 for that columna name etc

Does it sound o.k.

can you display the code for me

Thx
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19615129605008"></a>
<pre>sounds like you have the algorithm you want to use in mind -- you display the code for us...  
straight forward procedural coding 101 here.

You just described exactly what I described I think -- process first line and figure out that 
loancode is the nth column.  very straight forward &quot;instr/substr&quot; code. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Code </b>
&nbsp;&nbsp;June      12, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19628294868019">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19628294868019">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Jamba</b>&nbsp;</div>
</div>
<pre>First step:

Get the total number of commas in the header line

 V_delimiter_CnT :=  (  LENGTH(LINE_feed) - LENGTH( REPLACE(LINE_feed, ',',''))    );

for the count of delimiter loop..

For i in 1 .. V_delimiter_CnT  LOOP

For each iteration look at the commas, starting from 0 ( just as the iteration count)

IF I = 0 THEN 

V_COL_HEAD    :=  SUBSTR(LINE_feed, INSTR(LINE_feed,',',0,1) +1, ( INSTR(LINE_feed,',',1,1));

ELSE

V_COL_HEAD    :=  SUBSTR(LINE_feed, INSTR(LINE_feed,',',I,I) +1, ( INSTR(LINE_feed,',',1,I + 1) - 
INSTR(LINE_BUFFER,',',I,I) -1));

END IF;    

IF UPPER(LTRIM(RTRIM(V_COL_HEAD)))) = 'LOANCODE'  THEN 

V_LCODE_POS1 = I;
V_LCODE_POS2 =I +1;

-- do the same for other column headers

END IF;

END LOOP;

--AFTER WE ITERATE THROUGH THE ENTIRE HEADER ROW, NOW MOVE ON TO THE NEXT ROW, WHICH CONTAINS THE 
DATA. LOAN CODE IS AVAILABLE BETWEEN COMMAS I AND I +1. NOW TO PLUCK THE VALUE DO THE BELOW


BEGIN

V_LCODE  := LTRIM(RTRIM(SUBSTR(LINE_BUFFER, V_LCODE_POS1 +1,V_LCODE_POS2 -  V_LCODE_POS1 -1)));   
-- SAME FOR OTHER COLUMNS
END;

NOW insert into the table..

BEGIN

INSERT INTO TABLE T VALUES(V_LCODE , OTHER VALUES);

END;



Tom, please sugges if the above code can be written in a better and more efficient way.

Thanks



     </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19628294868019"></a>
<pre>ops$tkyte@ORA9IR2&gt; declare
  2      l_text varchar2(200) := 'loancode,    loanamt,        foobar';
  3      l_tmp  varchar2(200);
  4      l_loancode_idx number;
  5      l_loanamt_idx  number;
  6      l_foobar_idx   number;
  7  begin
  8      l_text := ',' || upper(replace(l_text,' ','')) || ',';
  9
 10      l_tmp := substr( l_text, 1, instr( l_text, ',LOANCODE,' ) );
 11      l_loancode_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 12
 13      l_tmp := substr( l_text, 1, instr( l_text, ',LOANAMT,' ) );
 14      l_loanamt_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 15
 16      l_tmp := substr( l_text, 1, instr( l_text, ',FOOBAR,' ) );
 17      l_foobar_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 18
 19      dbms_output.put_line
 20      ( l_loancode_idx || ', ' ||
 21        l_loanamt_idx  || ', ' ||
 22        l_foobar_idx );
 23  end;
 24  /
1, 2, 3
 
PL/SQL procedure successfully completed.
 
ops$tkyte@ORA9IR2&gt; declare
  2      l_text varchar2(200) := 'foobar, loanamt, loancode';
  3      l_tmp  varchar2(200);
  4      l_loancode_idx number;
  5      l_loanamt_idx  number;
  6      l_foobar_idx   number;
  7  begin
  8      l_text := ',' || upper(replace(l_text,' ','')) || ',';
  9
 10      l_tmp := substr( l_text, 1, instr( l_text, ',LOANCODE,' ) );
 11      l_loancode_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 12
 13      l_tmp := substr( l_text, 1, instr( l_text, ',LOANAMT,' ) );
 14      l_loanamt_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 15
 16      l_tmp := substr( l_text, 1, instr( l_text, ',FOOBAR,' ) );
 17      l_foobar_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 18
 19      dbms_output.put_line
 20      ( l_loancode_idx || ', ' ||
 21        l_loanamt_idx  || ', ' ||
 22        l_foobar_idx );
 23  end;
 24  /
3, 2, 1
 
PL/SQL procedure successfully completed.


<b>would be a way to setup the indices rather easily (you might check that the nvl(indices,0) != 0 
to make sure you are getting the columns you want)

and as I said, I would be parsing a line into an array:</b>

 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; declare
  2      type array is table of varchar2(4000) index by binary_integer;
  3      l_data array;
  4      l_txt  long := 'how,now,browish,looking,cow';
  5
  6      procedure parse( p_str in varchar2 )
  7      is
  8          l_str long := p_str || ',';
  9          l_n   number;
 10      begin
 11          l_data.delete;
 12          loop
 13              l_n := instr( l_str, ',' );
 14              exit when nvl(l_n,0) = 0;
 15
 16              l_data( l_data.count+1 ) := substr( l_str, 1, l_n-1 );
 17              l_str := substr( l_str, l_n+1 );
 18          end loop;
 19      end;
 20
 21  begin
 22      parse( l_txt );
 23      for i in 1 .. l_data.count
 24      loop
 25          dbms_output.put_line( l_data(i) );
 26      end loop;
 27  end;
 28  /
how
now
browish
looking
cow
 
PL/SQL procedure successfully completed.
 


<b>and then 

   insert into t ( loanamt, loancode, foobar ) 
   values ( l_data( l_loanamt_idx ), l_data( l_loancode_idx ), l_data( l_foobar_idx ) );

</b>

putting it all together:

ops$tkyte@ORA9IR2&gt; create table t ( loancode int, loanamt int, foobar int );
 
Table created.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; declare
  2      l_text varchar2(200) := 'loancode,    loanamt,        foobar';
  3      l_tmp  varchar2(200);
  4      l_loancode_idx number;
  5      l_loanamt_idx  number;
  6      l_foobar_idx   number;
  7
  8
  9      type array is table of varchar2(4000) index by binary_integer;
 10      l_data array;
 11      l_txt  long := '111, 222, 333';
 12
 13      procedure parse( p_str in varchar2 )
 14      is
 15          l_str long := p_str || ',';
 16          l_n   number;
 17      begin
 18          l_data.delete;
 19          loop
 20              l_n := instr( l_str, ',' );
 21              exit when nvl(l_n,0) = 0;
 22
 23              l_data( l_data.count+1 ) := substr( l_str, 1, l_n-1 );
 24              l_str := substr( l_str, l_n+1 );
 25          end loop;
 26      end;
 27  begin
 28      l_text := ',' || upper(replace(l_text,' ','')) || ',';
 29
 30      l_tmp := substr( l_text, 1, instr( l_text, ',LOANCODE,' ) );
 31      l_loancode_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 32
 33      l_tmp := substr( l_text, 1, instr( l_text, ',LOANAMT,' ) );
 34      l_loanamt_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 35
 36      l_tmp := substr( l_text, 1, instr( l_text, ',FOOBAR,' ) );
 37      l_foobar_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 38
 39      parse( l_txt );
 40
 41      insert into t ( loancode, loanamt, foobar )
 42      values ( l_data( l_loancode_idx ), l_data( l_loanamt_idx ), l_data( l_foobar_idx ) );
 43  end;
 44  /
 
PL/SQL procedure successfully completed.
 
ops$tkyte@ORA9IR2&gt; select * from t;
 
  LOANCODE    LOANAMT     FOOBAR
---------- ---------- ----------
       111        222        333



<b>as an exercise for you -- make it even more efficient -- use array processing and bulk load the 
table (as an exercise for you...)</b>
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>How about my solution</b>
&nbsp;&nbsp;June      12, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19628965321705">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19628965321705">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Jamba</b>&nbsp;</div>
</div>
<pre>Tom 

How about my solution , is it correct. Will it work according to you.

Your solutio is great. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19628965321705"></a>
<pre>no clue.  I don't really debug others code (that's for you to do).  When asked &quot;how would you do 
this&quot;, I'll show you (as i did).

write you code, and then debug it.

or, use mine as a template.  Your's is more psuedo code than anything compilable.  I would use an 
array, use nice compact, easy to understand subroutines - lots of modular easy to debug code. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;June      12, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19631483905033">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19631483905033">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom

The actual file contains more than 100 rows. The first row is the header row. The below should be 
done only for the header row.

28      l_text := ',' || upper(replace(l_text,' ','')) || ',';
 29
 30      l_tmp := substr( l_text, 1, instr( l_text, ',LOANCODE,' ) );
 31      l_loancode_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 32
 33      l_tmp := substr( l_text, 1, instr( l_text, ',LOANAMT,' ) );
 34      l_loanamt_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 35
 36      l_tmp := substr( l_text, 1, instr( l_text, ',FOOBAR,' ) );
 37      l_foobar_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 38


From the next row onwards we have to the the below


 39      parse( l_txt );

 41      insert into t ( loancode, loanamt, foobar )
 42      values ( l_data( l_loancode_idx ), l_data( l_loanamt_idx ), l_data( 
l_foobar_idx ) );
 43  end;
 44  /


In your example you have conveniently names two variables l_txt and l_text , one for header row, 
and the other for the data.

I dont have that luxury. I will be reading the file, when I read the first row, I have to find out 
the positions of the columns we require, and from the second row onwards I have to insert data into 
the table.

How should I verify for the first row in your solution? </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19631483905033"></a>
<pre>yes, because I have an EXAMPLE OF HOW I WOULD PARSE

a) line 1
b) line 2 and on

you of course will be using utl_file to read line 1
and then lines 2, .......


You open file
you read a line
you parse it to get column headings
you then process each subsequent line </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;June      12, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19631755120337">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19631755120337">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Jamba</b>&nbsp;</div>
</div>
<pre>&quot;as an exercise for you -- make it even more efficient -- use array processing 
and bulk load the table (as an exercise for you...)
&quot;

I would love to use bulk inserts here, but my business logic does not allow me to do so

in the flat file, loancode might repete, in that case I have to add up the loanamount and then 
insert one summary row. I do thi susing a when dup val on index excception , and I update the given 
loadcode with the second loan amount.

If I use bulk inserts I dont this this will be possible. Please advise.
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19631755120337"></a>
<pre>search this site for

&quot;save exceptions&quot; </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Searched your site for &quot;Save Exceptions&quot;</b>
&nbsp;&nbsp;June      13, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19648354567249">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19648354567249">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>I found the below

----------
12      loop
 13          fetch c BULK COLLECT INTO data LIMIT 100;
 14          begin
 15             FORALL i IN 1 .. data.count SAVE EXCEPTIONS
 16                insert into t2 values data(i);
 17          EXCEPTION
 18              WHEN dml_errors THEN
 19                   errors := SQL%BULK_EXCEPTIONS.COUNT;
 20                   l_cnt := l_cnt + errors;
 21                   FOR i IN 1..errors LOOP
 22                       dbms_output.put_line
 23                       ('Error occurred during iteration ' ||
 24                         SQL%BULK_EXCEPTIONS(i).ERROR_INDEX ||
 25                        ' Oracle error is ' ||
 26                         SQL%BULK_EXCEPTIONS(i).ERROR_CODE );
 27                   end loop;
 28          end;

On line 24 I am printing out the SUBSCRIPT into DATA of the offending record.

therefore:

 data( SQL%BULK_EXCEPTIONS(i).ERROR_INDEX )

contains the primary key - et.al. - of the &quot;bad record&quot; to do with what you 
like.

-----------------


I guess for my case I should use FORLLL. I dont think I can use BULKCOLLECT, as at every place use 
used BULKCOLLECT there is a cursor declaration. 

Thanks </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19648354567249"></a>
<pre>i was trying to point you to save execeptions, yes.  that is a feature of the forall.  </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;June      13, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19648513625962">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19648513625962">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom I plugged in the 

----
You open file
you read a line
you parse it to get column headings
you then process each subsequent line 
------

into your code as pseudo code. Do you think use of a counter variable to determine the first row is 
essential, is there any other way to determine the first row of the file ?






ops$tkyte@ORA9IR2&gt; declare
  2      l_text varchar2(200) := 'loancode,    loanamt,        foobar';
  3      l_tmp  varchar2(200);
  4      l_loancode_idx number;
  5      l_loanamt_idx  number;
  6      l_foobar_idx   number;
  7
  8
  9      type array is table of varchar2(4000) index by binary_integer;
 10      l_data array;
 11      l_txt  long := '111, 222, 333';
 12
 13      procedure parse( p_str in varchar2 )
 14      is
 15          l_str long := p_str || ',';
 16          l_n   number;
 17      begin
 18          l_data.delete;
 19          loop
 20              l_n := instr( l_str, ',' );
 21              exit when nvl(l_n,0) = 0;
 22
 23              l_data( l_data.count+1 ) := substr( l_str, 1, l_n-1 );
 24              l_str := substr( l_str, l_n+1 );
 25          end loop;
 26      end;
 27  begin

-- OPEN THE FILE using UTL_FILE

LOOP

GET THE ROWS FROM THE FILE

GET THE FIRST ROW( USE A counter variable to determine the first row)

 28      l_text := ',' || upper(replace(l_text,' ','')) || ',';
 29
 30      l_tmp := substr( l_text, 1, instr( l_text, ',LOANCODE,' ) );
 31      l_loancode_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 32
 33      l_tmp := substr( l_text, 1, instr( l_text, ',LOANAMT,' ) );
 34      l_loanamt_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 35
 36      l_tmp := substr( l_text, 1, instr( l_text, ',FOOBAR,' ) );
 37      l_foobar_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 38

FROM SECOND ROW ONWARDS COME DIRECTLY TO LINE 39 

 39      parse( l_txt );
 40
 41      insert into t ( loancode, loanamt, foobar )
 42      values ( l_data( l_loancode_idx ), l_data( l_loanamt_idx ), l_data( 
l_foobar_idx ) );

INCREMENT THE COUNTER ROW

END THE LOOP

CLOSE THE FILE

 43  end;
 44  /
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19648513625962"></a>
<pre>you open a file

you read a line

you sort of KNOW it is the first line, no?


   fopen
   read
   set up headers
   loop
      read exiting when no more data
      process row
   end loop
   fclose

no counters needed anywhere as far as I can see.

 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
&nbsp;&nbsp;June      13, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19648945856641">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19648945856641">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>----------
you open a file

you read a line

you sort of KNOW it is the first line, no?


   fopen
   read
   set up headers
   loop
      read exiting when no more data
      process row
   end loop
   fclose

no counters needed anywhere as far as I can see.
----
1.
You open the file and start getting the lines in a loop. How can you get just the first line set up 
the headers , and then start the loop. THE HEADER LINE IS ALSO A PART OF THE SOURCE FILE i.e. the 
file you are reading.


fopen

LOOP
   read 
 
  --  I was referring to use of a counter here
   set up headers if it is the first line
  --
   
      read exiting when no more data
  -- process the row from the second line onwards
      process row
  --
   end loop
   fclose


2.Dont we have to read once for each row.




 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19648945856641"></a>
<pre>get_line

it is the first &quot;record&quot; in the file.

this is &quot;file processing 101&quot; stuff here.  pretty basic &quot;read a record, process a record&quot;.

you fopen
you get_line &lt;&lt;== this must be your headers
you loop
    getting more lines to process &lt;&lt;&lt;== this must be your data. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
&nbsp;&nbsp;June      13, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19649053909159">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19649053909159">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>&quot;you sort of KNOW it is the first line, no?&quot;

Done your way, I will be looking to set up headers for each row I read, and headers happen to be 
only the first line of the source file, from the second line onwards I have the data.

If we do it your way, when I loop to the second line. I will try to set up the headers, for a row 
which doesnt have the headers but the data. Hence the headers which have been setup while reading 
the first line, now will get disturbed, and will result in no data being inserted.

I'm a little bit confused here.
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19649053909159"></a>
<pre>no no no.

you 

open file
you read a row, these are your headers
you set up the variables that tell you &quot;column 1 is foobar&quot;, &quot;column 2 is barfoo&quot;
you then loop
    reading more data, which you process, using the variables you set up outside
    the loop



this is pretty basic &quot;file processing stuff&quot;.  

Do not over analyze this, it really is &quot;as easy as it sounds&quot;.

sigh.  here is the completed thought I was trying to nudge you towards:

ops$tkyte@ORA9IR2&gt; create or replace package demo_pkg
  2  as
  3      procedure LoadFile( p_dir in varchar2, p_fname in varchar2 );
  4  end;
  5  /
 
Package created.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; create or replace package body demo_pkg
  2  as
  3
  4  type array is table of varchar2(4000) index by binary_integer;
  5
  6
  7  procedure parse( p_str in varchar2, p_data in out array )
  8  is
  9      l_str long := p_str || ',';
 10      l_n   number;
 11  begin
 12      p_data.delete;
 13      loop
 14          l_n := instr( l_str, ',' );
 15          exit when nvl(l_n,0) = 0;
 16          p_data( p_data.count+1 ) := substr( l_str, 1, l_n-1 );
 17          l_str := substr( l_str, l_n+1 );
 18      end loop;
 19  end;
 20
 21  procedure process_header( p_str in varchar2,
 22                            p_loancode_idx out number,
 23                            p_loanamt_idx  out number,
 24                            p_foobar_idx   out number )
 25  is
 26      l_text long := ',' || upper(replace(p_str,' ','')) || ',';
 27      l_tmp  long;
 28  begin
 29      l_tmp := substr( l_text, 1, instr( l_text, ',LOANCODE,' ) );
 30      p_loancode_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 31
 32      l_tmp := substr( l_text, 1, instr( l_text, ',LOANAMT,' ) );
 33      p_loanamt_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 34
 35      l_tmp := substr( l_text, 1, instr( l_text, ',FOOBAR,' ) );
 36      p_foobar_idx := length(l_tmp)-nvl(length(replace(l_tmp,',','')),0);
 37  end;
 38
 39
 40  procedure LoadFile( p_dir in varchar2, p_fname in varchar2 )
 41  is
 42      l_input    utl_file.file_type;
 43      l_buffer   long;
 44      l_data         array;
 45      l_loancode_idx number;
 46      l_loanamt_idx  number;
 47      l_foobar_idx   number;
 48  begin
 49      l_input := utl_file.fopen( p_dir, p_fname, 'r', 32000 );
 50
 51      utl_file.get_line( l_input, l_buffer );
 52      process_header( l_buffer, l_loancode_idx, l_loanamt_idx, l_foobar_idx );
 53
 54      loop
 55          begin
 56              utl_file.get_line( l_input, l_buffer );
 57          exception
 58              when no_data_found then
 59                  exit;
 60          end;
 61
 62          parse( l_buffer, l_data );
 63
 64          insert into t ( loancode, loanamt, foobar )
 65          values ( l_data( l_loancode_idx ), l_data( l_loanamt_idx ), l_data( l_foobar_idx ) );
 66      end loop;
 67      utl_file.fclose( l_input );
 68      commit;
 69  end;
 70
 71
 72  end;
 73  /
 
Package body created.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; !echo &quot;loancode, loanamt, foobar&quot; &gt; /tmp/test1.dat
 
ops$tkyte@ORA9IR2&gt; !echo &quot;1, 2, 3&quot; &gt;&gt; /tmp/test1.dat
 
ops$tkyte@ORA9IR2&gt; !echo &quot;11, 22, 33&quot; &gt;&gt; /tmp/test1.dat
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; !echo &quot;foobar, loanamt, loancode&quot; &gt; /tmp/test2.dat
 
ops$tkyte@ORA9IR2&gt; !echo &quot;333, 222, 111&quot; &gt;&gt; /tmp/test2.dat
 
ops$tkyte@ORA9IR2&gt; !echo &quot;3333, 2222, 1111&quot; &gt;&gt; /tmp/test2.dat
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; delete from t;
 
4 rows deleted.
 
ops$tkyte@ORA9IR2&gt; exec demo_pkg.loadFile( '/tmp', 'test1.dat' );
 
PL/SQL procedure successfully completed.
 
ops$tkyte@ORA9IR2&gt; exec demo_pkg.loadFile( '/tmp', 'test2.dat' );
 
PL/SQL procedure successfully completed.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; select * from t;
 
  LOANCODE    LOANAMT     FOOBAR
---------- ---------- ----------
         1          2          3
        11         22         33
       111        222        333
      1111       2222       3333
 
ops$tkyte@ORA9IR2&gt;



<b>It will be left as as exercise for you to add proper amounts of error handling to this 
functioning code</b>


 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
&nbsp;&nbsp;June      13, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19649145969843">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19649145969843">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>you fopen
you get_line &lt;&lt;== this must be your headers
you loop
    getting more lines to process &lt;&lt;&lt;== this must be your data. 

--------

I think I'm getting your point



you are saying

fopen

get_line for headers

loop

get_line for processing data

end loop



I'm saying


fopen

loop

get_line

if first line set up headers

if second line process the row for data

end loop


Well yes, your method is convenient and needs no counters at all.

One question though

fopen

get_line for headers   -- here I get the first line

loop

get_line for processing data  -- dont I start getting from first line again here ?

end loop

fclose

Thanks </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19649145969843"></a>
<pre>see above.

answer to question is &quot;no, of course not.  you are just reading line by line by line.  to you and 
to you alone the first row is special.  to utl_file, it is just bytes terminated by a newline.  the 
header is not &quot;meaningful&quot;&quot; </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;June      13, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19651395144943">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19651395144943">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>12      loop
 13          fetch c BULK COLLECT INTO data LIMIT 100;
 14          begin
 15             FORALL i IN 1 .. data.count SAVE EXCEPTIONS
 16                insert into t2 values data(i);
 17          EXCEPTION
 18              WHEN dml_errors THEN
 19                   errors := SQL%BULK_EXCEPTIONS.COUNT;
 20                   l_cnt := l_cnt + errors;
 21                   FOR i IN 1..errors LOOP
 22                       dbms_output.put_line
 23                       ('Error occurred during iteration ' ||
 24                         SQL%BULK_EXCEPTIONS(i).ERROR_INDEX ||
 25                        ' Oracle error is ' ||
 26                         SQL%BULK_EXCEPTIONS(i).ERROR_CODE );
 27                   end loop;
 28          end;




Tom

When we use a cursor and BULK COLLECT we can set the limite for each insert like the below

BULK COLLECT INTO data LIMIT 100

But when I just use FOR ALL , how many rows get inserted at a given time.

Can I control the number of rows I insert when I use just the FOR ALL.

Thanks


 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19651395144943"></a>
<pre>forall i in 1 .. data.count &lt;&lt;=== ?

you tell us that i runs from 1 to whatever. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
&nbsp;&nbsp;June      13, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19651467216261">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19651467216261">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Well in the below given example, you have been able to use FOR ALL  because you have a total record 
cound before hand, see i in 1 .. data.count.

But in the above case using utl_file, at given time we would get to to see one and only one row, in 
this scenario how can we use FOR ALL.

for all example:
-----------------
loop
 13          fetch c BULK COLLECT INTO data LIMIT 100;
 14          begin
 15             FORALL i IN 1 .. data.count SAVE EXCEPTIONS
 16                insert into t2 values data(i);
 17          EXCEPTION
 18              WHEN dml_errors THEN
 19                   errors := SQL%BULK_EXCEPTIONS.COUNT;
 20                   l_cnt := l_cnt + errors;
 21                   FOR i IN 1..errors LOOP
 22                       dbms_output.put_line
 23                       ('Error occurred during iteration ' ||
 24                         SQL%BULK_EXCEPTIONS(i).ERROR_INDEX ||
 25                        ' Oracle error is ' ||
 26                         SQL%BULK_EXCEPTIONS(i).ERROR_CODE );
 27                   end loop;
 28          end;


our current case:
-----------------

loop
 55          begin
 56              utl_file.get_line( l_input, l_buffer );
 57          exception
 58              when no_data_found then
 59                  exit;
 60          end;
 61
 62          parse( l_buffer, l_data );
 63
 64          insert into t ( loancode, loanamt, foobar )
 65          values ( l_data( l_loancode_idx ), l_data( l_loanamt_idx ), l_data( 
l_foobar_idx ) );
 66      end loop;

As you see at a given time we get only one row.

Even on your website, for examples on loading from file to table, you have not used bulk loading 
anywhere.

Please illustrate bulk insert in our given case.

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19651467216261"></a>
<pre>i just used bulk loading in that example.

You would need to read in an array the elements here.  as I said, left as an exercise (yes, I could 
do it but I'm choosing not to at this juncture).  


I wrote the entire thing so far.  Your turn. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
&nbsp;&nbsp;June      13, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19651998765602">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19651998765602">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Well, what I'm stating here is 

If I have a cursor , I can use bulk collect , collect 100 or 200 at a time and then bulk inser it 
using forall in 1 .. 200.

But in our case, YES we use an array , but the array at a given has only one row at a given time, 
because we are getting one line at a time from the source file( in the cursor and bulk collect 
example we are getting 100 at a time from the table).

So in our case even if I say

For FOR ALL IN 1 .. l_data.COUNT

it will have only data enough for only one row in it because I'm getting one line at a time from 
source file and parsing it. Note again, I parse one row at a time and load the array with its 
column.

Did I make myself clear. Please exaplain if I'm missing something. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19651998765602"></a>
<pre>I'm saying &quot;as a programmer, you know about arrays, you know how to fill up arrays, you are paid to 
write code&quot;.

this is just procedural coding stuff here.  ok:

 40  procedure LoadFile( p_dir in varchar2, p_fname in varchar2 )
 41  is
 42      l_input    utl_file.file_type;
 43      l_buffer   long;
 44      l_data         array;
 45      l_loancode_idx number;
 46      l_loanamt_idx  number;
 47      l_foobar_idx   number;
 48<b>
 49      l_loancodes    array;
 50      l_loanamts     array;
 51      l_foobars      array;</b>
 52  begin
 53      l_input := utl_file.fopen( p_dir, p_fname, 'r', 32000 );
 54
 55      utl_file.get_line( l_input, l_buffer );
 56      process_header( l_buffer, l_loancode_idx, l_loanamt_idx, l_foobar_idx );
 57
 58      loop
 59          begin
 60              utl_file.get_line( l_input, l_buffer );
 61          exception
 62              when no_data_found then
 63                  exit;
 64          end;
 65
 66          parse( l_buffer, l_data );<b>
 67          l_loancodes( l_loancodes.count+1 ) := l_data( l_loancode_idx );
 68          l_loanamts ( l_loanamts.count+1  ) := l_data( l_loanamt_idx );
 69          l_foobars  ( l_foobars.count+1   ) := l_data( l_foobar_idx );</b>
 70      end loop;
 71      utl_file.fclose( l_input );
 72<b>
 73      forall i in 1 .. l_loancodes.count
 74          insert into t ( loancode, loanamt, foobar )
 75          values ( l_loancodes(i), l_loanamts(i), l_foobars(i) );</b>
 76      commit;
 77  end;
 78
 79
 80  end;
 81  /
 
Package body created.
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>parameterize delimiter in the parse routine</b>
&nbsp;&nbsp;June      14, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#19656365319834">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="19656365319834">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom, really surprised that you hardcoded delimiter in the parse procedure to ','. In my opinion it 
should be parameterized so that one can send any delimiter they like , it may be a ',' or a chr(9) 
or a |.

Is there a reason why you did not parameterize it? 
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom19656365319834"></a>
<pre>because it is an example.

because it has no error handling either.

because it is a &quot;demo&quot;, proof of concept, how to do this.

because it is NOT production code.

 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>CSV specs</b>
&nbsp;&nbsp;June      22, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#20071656485357">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="20071656485357">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Duke Ganote</b>&nbsp;from Warsaw, Indiana USA (aka &quot;Lake City&quot; and &quot;Orthopaedic Capitol of the World&quot;)</div>
</div>
<pre>A more interesting challenge would be full CSV specs (see </pre> <pre><a href="http://en.wikipedia.org/wiki/Csv">http://en.wikipedia.org/wiki/Csv</a></pre> <pre> where the fields may be delimited by double-quotes as well as commas (and MUST be if the field 
contains double quotes).

As for the previous reviewer, parameterization is simple enough, adds some clarity, but is 
unnecessary for demo code:

SQL&gt; 
  1  select x, instr(x||&amp;&amp;delimiter,&amp;&amp;delimiter,1)
  2*   from ( select 'asdfasdf,12344|123' X from dual )
SQL&gt; /
Enter value for delimiter: ','
old   1: select x, instr(x||&amp;&amp;delimiter,&amp;&amp;delimiter,1)
new   1: select x, instr(x||',',',',1)

X                  INSTR(X||',',',',1)
------------------ -------------------
asdfasdf,12344|123                   9
 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>array as a parameter</b>
&nbsp;&nbsp;June      27, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#20273705061457">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="20273705061457">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom, is it possible for a database procedure to accept arrays as a parameter and inser the same 
into a table, i.e. can we convert the above procedure you provided to be a procedure which accepts 
respective arrays for each column, and call this procedure from the client side and bulk insert 
into a table.

We have observed that oracle forms at least in 9i does not allow bulk binds.

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom20273705061457"></a>
<pre>yes, you can use plsql table types.


create package my_pkg
as
  type array is table of &lt;datatype&gt; index by binary_integer;
  .... </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>MAX SIZE OF line in UTL_FILE.get_LINE</b>
&nbsp;&nbsp;July      16, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#21055364983605">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="21055364983605">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>HI Tom,

I'm reading a file with UTL_FILE.get_LINE as
UTL_FILE.get_LINE (file_handle,cur_line.line);
But this is throwing me an error when it finds a line with 2000 characters. How can I handle this?

please advise as usual.

Thanks, </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom21055364983605"></a>
<pre>what does your fopen look like?  by default, max line size is 1022 characters.

you might have to specify the linesize in the fopen call. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Worked Fine ..Thanks !!</b>
&nbsp;&nbsp;July      16, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#21065541176306">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="21065541176306">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>I'd not mentioned anything in FOPEN. ANd now I've put 32000 there. And my procedure is working 
fine.
Thanks very much for your time.

Reading this site alone is simply a treat &amp; A GREAT learning experience.

Thanks </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>generic loader</b>
&nbsp;&nbsp;August    20, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#22493659662156">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="22493659662156">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>dxl</b>&nbsp;from uk</div>
</div>
<pre>Tom

I would like to write a generic data loader that takes a text file from a client pc uploads it onto 
an appserver and loads the data from the app server running java via jdbc to a table in oracle. (I 
know that we should ftp the file onto the db server and use sql loader but we are restricted from 
doing this for now.)

I have had to do this a few times already for various applications so i thought i'd have a go at 
writing a generic loader to get the data into a table ready for validation.

So far in my experience having tried different methods eg varrays of object types, table types or 
varchars containing delimited strings etc.. i have found the quickest way is to use oracle batch 
updates from jdbc into gtt tables.
Therefore what i propose to do is to get the app server to extract the delimited data strings from 
the file and batch insert the whole strings into a gtt which is made up of large varchar2 fields.  
Then a stored procedure can be used to take each delimited string and split the string into an 
application specific staging table eg one containing all columns of varchars ready for validation 
or even the real table with all the correct datatypes etc.

Do you think this is the best way, given the restrictions i have??  (we are on 8.1.7.4 at the 
moment but will be on 9i in the near future)


My problem that i am having is how best to convert a unknown number of delimited elements in a 
string into real table made up of eg varchar2(4000) fields?

ie 

GTT table is something like:

App_id    Batch_id   DATA_STRING
------    --------   -----------------------------
     3           4   abc,def,ghi,j,klm,n,
     3           4   op,q,rstu,vxw,y,z,

and insert it into an app table eg

Field1   Field2   Field3   Field4   Field5   Field6
------   ------   ------   ------   ------   ------
abc      def      ghi      j        klm      n
op       q        rstu     vxw      y        z


the data strings will have the same number of elements for each app or at least the same number of 
delimiters maybe some elements are null.

So the data_string needs to be queried in order to first determine how many elements each data line 
should have.

Then I need to dynamically create a table made up of varchar2 fields to hold this data ie:

desc STAGE_TABLE


FIELD1    VARCHAR2(4000) NULL,
FIELD2    VARCHAR2(4000) NULL,
..
FIELD10    VARCHAR2(4000) NULL

1)
Maybe each application could build this table prior to running a load so that the stored procedure 
can then take the delimited string dynamically and load it into this table? So in this case how 
should i best convert the data_strings into separated fields?

I could dynamically create an object to hold the separated data using str2tbl, but then i need to 
load it into the STAGE_TABLE, how can i do this efficiently without using procedural code? please 
can you give an example of how to do this?? I know about str2tbl and using  
TABLE(CAST(str2tbl('abc,def,h,ij')))  etc but i can't quite work out a good non-procedural way to 
achieve this??

2) instead i could query the data string to dynamically create a staging table of varchar2 fields 
and then somehow load the data in? same problem as i 1) to get the strings into this dynamically 
build table but time because the table was build dynamically would the stored procedure be able to 
reference it at compile time or would you use dbms_sql to do this??  I'm not too familiar with 
dbms_sql so an example would be helpful here.




Please can you help with this approach or suggest a better way! My main problem is in taking the 
delimited string, parsing it and inserting the separted fields into a staging table in bulk without 
writing procedural code.

Many thanks
(if you need more information i can provide it)
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom22493659662156"></a>
<pre>one word for you:

sqlldr </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>ok but</b>
&nbsp;&nbsp;August    20, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#22510116317622">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="22510116317622">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>dxl</b>&nbsp;from uk</div>
</div>
<pre>i understand what you're saying but given that i cannot get the text file onto the database machine 
and i HAVE to go through the app server via jdbc:

what would your answer be now?!

is it some sort of pivot type query? </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom22510116317622"></a>
<pre>you are writing code, no &quot;pivot queries&quot; you are just inserting into a table.

if you want to do this efficiently, using the least resources in the most maintainable fashion you 
will use sqlldr -- you don't need to be on the server, sqlldr goes over the network

otherwise you are writing code, code to parse, bind, execute simple inserts with. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>ok</b>
&nbsp;&nbsp;August    23, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#22568268607840">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="22568268607840">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>dxl</b>&nbsp;from uk</div>
</div>
<pre>Yes i've accepted the fact that i have to write code to do this and i'm ok with that!

All i was asking (maybe not very clearly) was how best (using code) to convert a table of data 
looking like:


App_id    Batch_id   DATA_STRING
------    --------   -----------------------------
     3           4   abc,def,ghi,j,klm,n,
     3           4   op,q,rstu,vxw,y,z,



and get it into a table so that it looks like :



ID   APP_ID   BATCHID    Field1   Field2   Field3   Field4   Field5   Field6
--   ------   -------    ------   ------   ------   ------   ------   ------
 1        3         4    abc      def      ghi      j        klm      n
 2        3         4    op       q        rstu     vxw      y        z


What would be the most efficient techniques to achieve this transformation in sql when i don't know 
before hand how many delimited elements make up the data string?? </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom22568268607840"></a>
<pre>you will write java code to do this?  not sure what you are asking for here.  seems in the java 
code you have 3, 4, abc, def, ..... and you would 

a) prepare an insert statement
b) read a string, parse it, bind it, execute a)
c) goto b until eof

 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>.</b>
&nbsp;&nbsp;August    23, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#22580683374730">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="22580683374730">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>dxl</b>&nbsp;from uk</div>
</div>
<pre>Well i was trying to write a generic data loader so wanted to do it using plsql not from the java 
front end.

Ok so how about just this question (forget java, sql loader i am asking about sql or plsql):

I just want to know if it is possible to write any sql that could take this table looking like:

App_id    Batch_id   DATA_STRING
------    --------   -----------------------------
     3           4   abc,def,ghi,j,klm,n,
     3           4   op,q,rstu,vxw,y,z,


and insert it into a table that looks like:

ID   APP_ID   BATCHID    Field1   Field2   Field3   Field4   Field5   Field6
--   ------   -------    ------   ------   ------   ------   ------   ------
 1        3         4    abc      def      ghi      j        klm      n
 2        3         4    op       q        rstu     vxw      y        z


without doing it procedurally and also what if the number of elements in the data string were 
unknown until runtime, ie each data_string has the same number of elements but we don't know what 
that is until runtime.  Assume that the second table has been prebuilt with the correct number of 
elements (or maybe we could build it dynamically?).

I don't know how to ask this anymore clearly.  I just want to know if this is possible or does the 
unknown number of elements of the data_string make it impossible??

Thanks </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom22580683374730"></a>
<pre>in order to build an insert into statement -- you NEED to know the number of columns (eg: you 
cannot parse the insert into statement in the first place if you didn't know the number of columns)

ops$tkyte@ORA9IR2&gt; select length(data_string)-length(replace(data_string,',','')) from t where 
rownum = 1;
 
LENGTH(DATA_STRING)-LENGTH(REPLACE(DATA_STRING,',',''))
-------------------------------------------------------
                                                      6
 
<b>that query tells you how many columns you have...</b>


ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; select id, app_id, batch_id,
  2         substr( f1, 1, instr(f1,',')-1 ) f1,
  3         substr( f2, 1, instr(f2,',')-1 ) f2,
  4         substr( f3, 1, instr(f3,',')-1 ) f3,
  5         substr( f4, 1, instr(f4,',')-1 ) f4,
  6         substr( f5, 1, instr(f5,',')-1 ) f5,
  7         substr( f6, 1, instr(f6,',')-1 ) f6
  8    from (
  9  select rownum id, app_id, batch_id,
 10         substr( data_string, instr(data_string, ',', 1, 1 ) + 1 ) f1,
 11         substr( data_string, instr(data_string, ',', 1, 2 ) + 1 ) f2,
 12         substr( data_string, instr(data_string, ',', 1, 3 ) + 1 ) f3,
 13         substr( data_string, instr(data_string, ',', 1, 4 ) + 1 ) f4,
 14         substr( data_string, instr(data_string, ',', 1, 5 ) + 1 ) f5,
 15         substr( data_string, instr(data_string, ',', 1, 6 ) + 1 ) f6
 16    from (select app_id, batch_id, ','||data_string data_string from t)
 17         )
 18  /
 
        ID     APP_ID   BATCH_ID F1   F2   F3   F4   F5   F6
---------- ---------- ---------- ---- ---- ---- ---- ---- ----
         1          3          4 abc  def  ghi  j    klm  n
         2          3          4 op   q    rstu vxw  y    z

<b>
then it is a simple matter of substring/instring to parse</b>
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Excelent</b>
&nbsp;&nbsp;August    29, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#22881702493119">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="22881702493119">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Senthil Kumar</b>&nbsp;from INDIA</div>
</div>
<pre>Helped Me a Lot </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>What about Lengthy Parameters</b>
&nbsp;&nbsp;August    29, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#22881876616354">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="22881876616354">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>R.Senthil Kumar</b>&nbsp;from India , Coimbatore</div>
</div>
<pre>Hi,

One of my Parameter Looks Like 
84, 50249, 2, 1, 2, , , 1100000005, 50250, , , , , INR, N, 2, 1, 2, 2, 2, 2, 2, 2, 2, , 
Y,J,66666,888,RAM_MATERIAL,RM001RG2003,TAX,1

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom22881876616354"></a>
<pre>what about them?  you have 4000 bytes to play with.

You know the max field lengths of your data.

otherwise, you have the object type. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
&nbsp;&nbsp;November  05, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#27312080044963">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="27312080044963">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>anto</b>&nbsp;</div>
</div>
<pre>Hi Tom,

What is the easiest way to check whether there is any tab character in any of the field values in a 
table ? </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom27312080044963"></a>
<pre>instr on all of the fields

where instr( c1, chr(9) ) &gt; 0 or instr( c2, chr(9) ) &gt; 0 ... </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;November  08, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#27577510848375">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="27577510848375">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>anto</b>&nbsp;</div>
</div>
<pre>Thanks, Tom </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Slightly different seperators</b>
&nbsp;&nbsp;November  17, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#28663142350503">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="28663142350503">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Aaron Rouse</b>&nbsp;from Houston, Tx USA</div>
</div>
<pre>Hello,

I have the need to parse through some data in a very similar fashion only it has one level above 
the example.  The table I am accessing stores user's computer information and users can have any 
number of computers though normally it is no more than one or two computers per user.  Each 
computer record has three values and is seperated by a / and then if more than one record those are 
seperated by commas.  Here is an example of the table I would be pulling from and the table I want 
to put the data in.

-- Table to pull data from
CREATE TABLE TABLEONE
(
  USER_ID INT,
  COMPUTER_RCD VARCHAR2(1000)
);
-- Two Computers
INSERT INTO TABLEONE
VALUES
(27137529, 'AMEHRABIAN-OFS/DELL_ITSTDV45C1K/8NBDC1S, MEHRABIAN-OFS/DELL_ITSTDV45C1K/GRX3601');
-- One Computer
INSERT INTO TABLEONE
VALUES
(27137531, 'AHYAR11-OFS/DELL_ITSTDV40C0K/1WWF61S');
-- Three Computers
INSERT INTO TABLEONE
VALUES
(27137578, 'ADELUNG1-L-OFS/DELL_ITSTDV31W2K-STD/8W5P701, ADELUNG-L1-OFS/DELL_ITSTDV45C0K/56KMP31, 
ARNOLD1/DELL_ITSTDV40C1K/6XJ0D01');

-- Table to insert into 
CREATE TABLE TABLETWO
(
 USER_ID INT, 
 COMPUTER_NAME VARCHAR2(25),
 COMPUTER_ID   VARCHAR(40),
 COMPUTER_SERIAL VARCHAR(20)
);
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom28663142350503"></a>
<pre>select user_id,
       substr( rcd, comma_1+1, comma_2-comma_1-1 ) r1,
       substr( rcd, comma_2+1, comma_3-comma_2-1 ) r2,
       substr( rcd, comma_3+1, comma_4-comma_3-1 ) r3
  from (
select user_id,
       instr(rcd,',',1,1) comma_1,
       instr(rcd,',',1,2) comma_2,
       instr(rcd,',',1,3) comma_3,
       instr(rcd,',',1,4) comma_4,
       rcd
  from (
select user_id, ','||computer_rcd||',' rcd
  from tableone
       )
       )
/


gets you started, apply same technique to parse the resulting r1,r2,r3 components and a multi-table 
insert to insert the resulting data. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Thanks ...</b>
&nbsp;&nbsp;November  17, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#28667254837962">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="28667254837962">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Aaron Rouse</b>&nbsp;from Houston, TX USA</div>
</div>
<pre>Thanks, definately gets me down the right path.  I just realized some people actually have up to 26 
machines so going to re-evaluate the steps and goals on this.  Since really the only limiting 
factor in their system is the varchar2(1000) on how many machines can be tracked per user.
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom28667254837962"></a>
<pre>would then be tempted to pipeline it (test this, just off the top of my head, not fully debugged)




ops$tkyte@ORA9IR2&gt; create or replace type myTabletype as table of myScalarType
  2  /
 
Type created.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; create or replace function parse_it( p_cursor in sys_refcursor ) return 
myTableType
  2  pipelined
  3  as
  4      l_row myScalarType := myScalarType( null, null, null, null );
  5      l_comma number;
  6      l_piece long;
  7      l_rcd   long;
  8      l_slash number;
  9      l_user_id number;
 10  begin
 11      loop
 12          fetch p_cursor into l_user_id, l_rcd;
 13          exit when p_cursor%notfound;
 14          l_row.user_id := l_user_id;
 15          l_rcd := l_rcd || ',';
 16          loop
 17              l_comma := instr( l_rcd, ',' );
 18              exit when nvl(l_comma,0) = 0;
 19              l_piece := substr( l_rcd, 1, l_comma-1 );
 20              l_rcd := substr( l_rcd, l_comma+1 );
 21              l_slash := instr( l_piece, '/' );
 22              l_row.computer_name := substr( l_piece, 1, l_slash-1 );
 23              l_piece := substr( l_piece, l_slash+1 );
 24              l_slash := instr( l_piece, '/' );
 25              l_row.computer_id := substr( l_piece, 1, l_slash-1 );
 26              l_row.computer_serial := substr( l_piece, l_slash+1 );
 27
 28              pipe row (l_row);
 29          end loop;
 30      end loop;
 31      close p_cursor;
 32      return;
 33  end;
 34  /
 
Function created.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; select * from table( parse_it( cursor( select * from tableone ) ) );
 
   USER_ID COMPUTER_NAME             COMPUTER_ID          COMPUTER_SERIAL
---------- ------------------------- -------------------- --------------------
  27137529 AMEHRABIAN-OFS            DELL_ITSTDV45C1K     8NBDC1S
  27137529 MEHRABIAN-OFS             DELL_ITSTDV45C1K     GRX3601
  27137531 AHYAR11-OFS               DELL_ITSTDV40C0K     1WWF61S
  27137578 ADELUNG1-L-OFS            DELL_ITSTDV31W2K-STD 8W5P701
  27137578 ADELUNG-L1-OFS            DELL_ITSTDV45C0K     56KMP31
  27137578 ARNOLD1                   DELL_ITSTDV40C1K     6XJ0D01
 
6 rows selected.
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;November  23, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#28936705670722">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="28936705670722">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>I have a huge string

lv_string := 'adfsfsdfscdndfasdfdfsdfusddsdfasffsdgjsdfsfsdffsdfmmbtu'

I need to to convert the usd,cdn,mmbtu, gj to upper case where ever they occur. 

I can do the replace function but using that I can take care of either only the usd or gj or cdn or 
mmbtu. How can I take care of all  of them. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom28936705670722"></a>
<pre>multiple replaces

replace( replace( replace( str, 'usd', 'USD' ), 'cdn', 'CDN' ), 'mmbtu', 'MMBUT')

 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>multiple replaces</b>
&nbsp;&nbsp;November  23, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#28942942266664">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="28942942266664">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Gabe</b>&nbsp;</div>
</div>
<pre>To &quot;A reader&quot; ...

The only thing left for you to clarify (and code accordingly) is what to do in cases like ... 

flip@FLOP&gt; select str, replace( replace( replace( str, 'usd', 'USD' )
  2   , 'cdn', 'CDN' ), 'mmbtu','MMBTU') processed_str
  3  from (select 'mmbtusd' str from dual);

STR     PROCESSED_STR
------- ------------------------------
mmbtusd mmbtUSD
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom28942942266664"></a>
<pre>good point -- you have excellent eyes, you catch lots of these nuances :) </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Replace part of a string</b>
&nbsp;&nbsp;November  23, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#28961032408520">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="28961032408520">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>I have a varchar2(100) string. 

I need to replace characters 10 thru 15 with another string. 

Is 

str := substr(str,1,10-1)||new_str||substr(str,15+1)

the best way do do this?

Thanks

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom28961032408520"></a>
<pre>well, 10-1 and 15+1 could be written differently but otherwise -- yes....


PL/I, one of my favorite languages would have allowed for


   substr( str, 10, 6 ) = new_str;

how cool is that :) 

(no, that is not PL/SQL -- but PL/I -- pl-one...) </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Multiple replaces</b>
&nbsp;&nbsp;November  23, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#28961078422404">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="28961078422404">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>For the case Gabe pointed out, regexp_replace in 10g will really come in handy. 

s/\(pat1\|pat2\|pat3\)/\U&amp;/g

Regexps are really terrific for complex search/replace. </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;November  23, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#28963550238361">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="28963550238361">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>substr( str, 10, 6 ) = new_str;

That is cool! But very few languages out there allow an expression as the &quot;lvalue&quot; of an 
assignment, wonder why! IIRC, even the most hybrid of languages out there, Perl, doesnt allow this! </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>Perl does allow</b>
&nbsp;&nbsp;November  24, 2004
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#28973354967700">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="28973354967700">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Ralf</b>&nbsp;from Dresden, Germany</div>
</div>
<pre>In Perl you can write:

$a=&quot;abcdefg&quot;;
substr($a,2,1)=&quot;xy&quot;;
print $a; # this prints axycdefg

hth </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom28973354967700"></a>
<pre>(still won't make me think about using perl :) </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Ideas about parsing this</b>
&nbsp;&nbsp;February  02, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#33419530335630">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="33419530335630">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Chenna</b>&nbsp;</div>
</div>
<pre>Tom

I have the following string

From 0 ZY to 300 ZY @ 6.10ABC per ZY From 301 ZY to 600 ZY @ 5.50ABC per ZY From 601 ZY to 

the rest @ INDIAN OIL TRADE REPORT D ZY CADABC per ZY

I need to parse it like the below

300 ZY @ 6.10ABC per ZY 
300 ZY @ 5.50ABC per ZY
rest @ INDIAN OIL TRADE REPORT D ZY CADABC per ZY

Note:

The numbers will differe but the From  and to will always be in the same place, and the last 'to 
the rest @ INDIAN OIL TRADE REPORT D ZY CADABC per ZY' might be or might not be there'

Can you please guide me to a good solutions, our database is 9i release 2 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom33419530335630"></a>
<pre>guess i would loop through looking for &quot;From&quot; to break the string into 

From 0 ZY to 300 ZY @ 6.10ABC per ZY 
From 301 ZY to 600 ZY @ 5.50ABC per ZY 
From 601 ZY to the rest @ INDIAN OIL TRADE REPORT D ZY CADABC per ZY


and go from there.  It looks like a procedure to me. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Clob parse</b>
&nbsp;&nbsp;February  03, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#33433382728570">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="33433382728570">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Phil</b>&nbsp;</div>
</div>
<pre>Hi Tom,


I am trying to parse a value seperate clob. I do not want an inlist just rows.

I am trying to &quot;extend&quot; str2tbl to read a clob and return me some rows, and I think I should be 
using another technique.

I have a clob which is on the lines of

:20:HHH
:21:YYY
:99:This is row 1
:99:This is row 2
:99:This is row 3
:99:This is row 4

where there are a 1000 or so of :99: values in the clob

I am trying to get a result of

:20:HHH   :21:YYY   :99:This is row 1
:20:HHH   :21:YYY   :99:This is row 2
:20:HHH   :21:YYY   :99:This is row 3
:20:HHH   :21:YYY   :99:This is row 4

The values of any element ie :99 , will not exceed 4000k so I will always be returning a varchar2 
for all columns

if I have a string then str2tbl is just the thing for it, however for a clob I am strugling.

I would like to do this as part of an SQL statement similar to str2tbl as the final outcome will be 
an insert .. select 

I would appreciate your thoughts/examples

Version 9ir2

kind regards
phil




 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom33433382728570"></a>
<pre>why are you struggling with a clob?  there are substr, instr, etc for clobs?


if you can do it to a string...

Maybe this will help:

</pre> <pre><a href="http://asktom.oracle.com/pls/asktom/f?p=100:11:::::P11_QUESTION_ID:1352202934074">http://asktom.oracle.com/pls/asktom/f?p=100:11:::::P11_QUESTION_ID:1352202934074</a></pre> <pre>
in there I treat the alert log as a bfile and read it a line at a time.  You have it easy since the 
clob won't need utl_raw.  

Use that same logic and you can go line by line through the clob. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>thanks</b>
&nbsp;&nbsp;February  03, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#33729777100970">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="33729777100970">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>phil</b>&nbsp;</div>
</div>
<pre>Thanks Tom,

You must feel like you are leading donkeys to water and forcing them to drink sometimes !!

kind regards
phil </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
&nbsp;&nbsp;February  04, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#34007895082793">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="34007895082793">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Vin</b>&nbsp;from NY-USA</div>
</div>
<pre>SQL&gt; Create table t ( x number, y varchar2(30) );
SQL&gt; Insert into t values ( 1,'aa' );
SQL&gt; Insert into t values ( 2,'aa,bb');
SQL&gt; Insert into t values ( 3, 'aa,bb,cc');

SQL&gt; Create table t1 ( x number, y varchar2(30) );
SQL&gt; Insert into t1 values ( 1,'aa' );
SQL&gt; Insert into t1 values ( 2,'bb');
SQL&gt; Insert into t1 values ( 3, 'cc');
SQL&gt; Insert into t1 values ( 3, 'a,b,c');
SQL&gt; commit;

SQL&gt; Select * from t;
         X Y
---------- ------------------------------
         1 aa
         2 aa,bb
         3 aa,bb,cc

SQL&gt; Select * from t1;
         X Y
---------- ------------------------------
         1 aa
         2 bb
         3 cc
         3 a,b,c

SQL&gt; Select y from t Where x=3;
Y
------------------------------
aa,bb,cc

SQL&gt; Select * from t1 Where y in (Select y from t Where x=3);

no rows selected

Is there any way to find the matching pattern in the subquery to the main. The resultset from 
subquery should be 
like ('aa','bb','cc') which when passed to the main query Select * from t1 Where y in 
('aa','bb','cc'); will fetch
         X Y
---------- ------------------------------
         1 aa
         2 bb
         3 cc 

There could be N number of comma seperated strings for y
Oracle Version is 8174
Thanks </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom34007895082793"></a>
<pre>read
</pre> <pre><a href="http://asktom.oracle.com/pls/asktom/f?p=100:11:::::P11_QUESTION_ID:110612348061">http://asktom.oracle.com/pls/asktom/f?p=100:11:::::P11_QUESTION_ID:110612348061</a></pre>  <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>As Always To The Point. Many Thanks</b>
&nbsp;&nbsp;February  04, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#34019519125869">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="34019519125869">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Vin</b>&nbsp;from NY-USA</div>
</div>
 <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>How to use the above list of values in a single Insert Statement</b>
&nbsp;&nbsp;February  07, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#34356932046590">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="34356932046590">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Vin</b>&nbsp;from NY-USA</div>
</div>
<pre>SQL&gt; Select * from t;
         X Y
---------- ------------------------------
         1 aa
         2 aa,bb
         3 aa,bb,cc

Select * From the (Select cast(str2tbl(Y) as mytableType) From t Where X=3;

COLUMN_VALUE
-------------
aa
bb
cc

How to use these COLUMN_VALUE in a Insert Statement so that the output would be

SQL&gt; Select * from t;
         X Y
---------- ------------------------------
         1 aa
         2 aa
         2 bb
         3 aa
         3 bb
         3 cc

Thanks

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom34356932046590"></a>
<pre>ops$tkyte@ORA9IR2&gt; select * from t, table(str2tbl(t.x));
 
X                         COLUMN_VALUE
------------------------- ------------------------------
1,2                       1
1,2                       2
3,4                       3
3,4                       4


column value is what you are looking for there.... 1,2,3,4....


 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Tried this, but in vain, any insight</b>
&nbsp;&nbsp;February  07, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#34369771283036">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="34369771283036">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Vin</b>&nbsp;from NY-USA</div>
</div>
<pre>SQL&gt; Begin
  2  For x in (Select x From t Where instr(y,',') &gt;=1)
  3   Loop
  4     For y in (Select * From the (Select cast(vstr(Y) as vString_List )
  5                                    From t Where X = x.X))
  6     Loop
  7       Insert into t(X,Y) Select X,y.column_value from t;
  8      End Loop;
  9   End Loop;
 10  End;
 11  /
Begin
*
ERROR at line 1:
ORA-01427: single-row subquery returns more than one row
ORA-06512: at line 4 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Please correct me if Iam wrong</b>
&nbsp;&nbsp;February  07, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#34375856044821">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="34375856044821">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Vin</b>&nbsp;from NY-USA</div>
</div>
<pre>Oracle version is 8174, so pipelined function not supported, so the solution given may not work.

select * from t, table(str2tbl(t.x));

and so I used the below solution, but still error, any help would be appreciated.

SQL&gt; Begin
  2  For x in (Select x From t Where instr(y,',') &gt;=1)
  3   Loop
  4     For y in (Select * From the (Select cast(vstr(Y) as vString_List )
  5                                    From t Where X = x.X))
  6     Loop
  7       Insert into t(X,Y) Select X,y.column_value from t;
  8      End Loop;
  9   End Loop;
 10  End;
 11  /
Begin
*
ERROR at line 1:
ORA-01427: single-row subquery returns more than one row
ORA-06512: at line 4 


 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom34375856044821"></a>
<pre>8i

ops$tkyte@ORA817DEV&gt; create or replace type myTableType as table of number;
  2  /
 
Type created.
 
ops$tkyte@ORA817DEV&gt;
ops$tkyte@ORA817DEV&gt; create or replace function str2tbl( p_str in varchar2 ) return myTableType
  2  as
  3      l_str   long default p_str || ',';
  4      l_n        number;
  5      l_data    myTableType := myTabletype();
  6  begin
  7      loop
  8          l_n := instr( l_str, ',' );
  9          exit when (nvl(l_n,0) = 0);
 10          l_data.extend;
 11          l_data( l_data.count ) := ltrim(rtrim(substr(l_str,1,l_n-1)));
 12          l_str := substr( l_str, l_n+1 );
 13      end loop;
 14      return l_data;
 15  end;
 16  /
 
Function created.
 
ops$tkyte@ORA817DEV&gt;
ops$tkyte@ORA817DEV&gt; drop table t;
 
Table dropped.
 
ops$tkyte@ORA817DEV&gt; create table t ( x varchar2(20) );
 
Table created.
 
ops$tkyte@ORA817DEV&gt; insert into t values ( '1,2');
 
1 row created.
 
ops$tkyte@ORA817DEV&gt; insert into t values ( '3,4');
 
1 row created.
 
ops$tkyte@ORA817DEV&gt; select * from t, table(cast( str2tbl(t.x) as myTableType) );
 
X                    COLUMN_VALUE
-------------------- ------------
1,2                             1
1,2                             2
3,4                             3
3,4                             4
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>I understood what you meant, Solved my problem: Many Thanks</b>
&nbsp;&nbsp;February  07, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#34402735828797">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="34402735828797">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Vin</b>&nbsp;from NY-USA</div>
</div>
<pre>Still is it possible to do using the FOR LOOP for the above situation. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom34402735828797"></a>
<pre>  4     For y in (Select * From the (Select cast(vstr(Y) as vString_List )
  5                                    From t Where X = x.X))


you would have to use &quot;where PRIMARY_KEY = x.PRIMARY_KEY&quot; -- in order to get at most one and at 
least one row in the &quot;from t where&quot; part -- if you get too many rows, you get too many rows.

 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>How to do this susbstr</b>
&nbsp;&nbsp;February  21, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#35277839529698">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="35277839529698">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>SQL&gt; var lv_var varchar2(3);
SQL&gt; 
SQL&gt; exec :lv_var := ' bc';

PL/SQL procedure successfully completed.


I.

SQL&gt; 
SQL&gt; SELECT      UPPER(SUBSTR(:lv_var, -2, 2) ) 
  2  FROM dual;

UP
--
BC


II.
SQL&gt; ed
Wrote file afiedt.buf

  1  SELECT      UPPER(SUBSTR(:lv_var, -3, 3) )
  2* FROM dual
SQL&gt; /

UPP
---
 BC

SQL&gt;  exec :lv_var :='bc';

PL/SQL procedure successfully completed.



I.

SQL&gt; SELECT      UPPER(SUBSTR(:lv_var, -2,2))
  2  from dual;

UP
--
BC

II.

SQL&gt; SELECT      UPPER(SUBSTR(:lv_var, -3, 3) )
  2  FROM dual
  3  /

UPP
---



when the length of the :lv_var is 3  then both I and II work , but the length of :lv_var is 2 only 
II works.
I need to return BC even  when the length of :lv_var is 2. I have to have -3,3 for my substr as I 
have to verify the last 3 words of the string.

Please help. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom35277839529698"></a>
<pre>do you want the last 3 characters of a string?  

ops$tkyte@ORA9IR2&gt; create table t
  2  as
  3  select substr( '12345', 1, rownum ) x
  4    from all_users
  5   where rownum &lt;= 5;
 
Table created.
 
ops$tkyte@ORA9IR2&gt;
ops$tkyte@ORA9IR2&gt; select x, substr( x, greatest(length(x)-2,1) ) from t;
 
X     SUBST
----- -----
1     1
12    12
123   123
1234  234
12345 345
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Coalesce</b>
&nbsp;&nbsp;February  22, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#35361089982751">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="35361089982751">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Venkat</b>&nbsp;from Detroit, USA</div>
</div>
<pre>select coalesce(substr(:val,-3),:val) from dual will do the same thing. My question is, does 
coalesce always evaluate all the expressions in the list (coalesce(expr1, expr2, ...)) or does it 
stop at the first not null expression?

Thanks! </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom35361089982751"></a>
<pre>ops$tkyte@ORA10GR1&gt; select coalesce( null, 1, 1/0 ) from dual;
 
COALESCE(NULL,1,1/0)
--------------------
                   1
 
ops$tkyte@ORA10GR1&gt; select coalesce( null, null, 1/0 ) from dual;
select coalesce( null, null, 1/0 ) from dual
                              *
ERROR at line 1:
ORA-01476: divisor is equal to zero
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>I should have done that before asking!</b>
&nbsp;&nbsp;February  22, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#35366409498164">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="35366409498164">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Venkat</b>&nbsp;</div>
</div>
<pre>Thanks for taking the time to illustrate the point! </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Selecting from a PL/SQL table</b>
&nbsp;&nbsp;April     21, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#39344502630401">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="39344502630401">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>If I have a PL/SQL table (index by binary integer or a real object-type table), how can I select 
from it?

where id in (select id from plsql_table) doesnt quite seem to work

Thanks </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom39344502630401"></a>
<pre>you cannot -- you need to use a SQL type (a collection), not an index by table. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;April     22, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#39395108452046">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="39395108452046">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>So, in the context of the HTML DB g_fXX arrays which are index by tables, I need to use the 
htmldb_util.table_to_string() to convert the table into a string and then your str2tbl to convert 
it back into a &quot;select-able&quot; table!

This table-to-string-to-table seemed a little redundant to me, but I guess there is no way around 
it.

Thanks </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;June      14, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#42669044287720">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="42669044287720">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Hi Tom,

I have a situation like this:

Comma seperated list of jobs will be sent to a procedure; and procedure has to return all the 
employees matching with those jobs. 

How can I use that IN parameter (with comma seperated values) in the WHERE clause?


eg:

PROCEDURE P1(str varchar2)
IS
TYPE C1 IS REF CURSOR ;
BEGIN
OPEN C1 FOR
  SELECT ENAME,SAL 
  FROM EMP WHERE JOB IN (str);
END;

SQL/&gt;  EXEC P1('MANAGER,ANALYST,CLERK')

Please Help!

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom42669044287720"></a>
<pre>search this site for 

varying in list


 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Parsit function fails when trying to bind predicate</b>
&nbsp;&nbsp;October   14, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#49691610511752">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="49691610511752">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Aaron Valdes</b>&nbsp;from San Diego, Ca</div>
</div>
<pre>Hi Tom,

Your pipelined function parseit works great but for some reason im getting an ora-01008 when using 
it in a package (the select is the source query for a merge statement).

For example your query:

select * from table( parse_it( cursor( select * from tableone 
) ) );

Works great but if I try to parameterize it then in fails in the fetch part of the parsit function:

select * from table( parse_it( cursor( select * from tableone where user_id = p_user_id; 
) ) );

Error: ORA-01008 not all variables bound. But hardcoding the value in the package does work:

select * from table( parse_it( cursor( select * from tableone where user_id = 126545 
) ) );

I just cant grasp why this can not be parameterized. It only likes hardcoded values.

Any thoughts?

Thanks a bunch

P.S. Any ideas when your going to be in Sunny California? </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom49691610511752"></a>
<pre>need an example, like this showing it works:


ops$tkyte@ORA10G&gt; create or replace package pkg
  2  as
  3      procedure p( p_id in number );
  4  end;
  5  /
 
Package created.
 
ops$tkyte@ORA10G&gt; create or replace package body pkg
  2  as
  3
  4  procedure p( p_id in number )
  5  is
  6  begin
  7      for x in ( select *
  8                   from table( parse_it( cursor( select * from tableone where user_id = p_id ) ) 
)
  9               )
 10      loop
 11          dbms_output.put_line( x.computer_name || ', ' || x.computer_id || ', ' || 
x.computer_serial );
 12      end loop;
 13  end;
 14
 15  end;
 16  /
 
Package body created.
 
ops$tkyte@ORA10G&gt;
ops$tkyte@ORA10G&gt; exec pkg.p( 27137529 )
AMEHRABIAN-OFS, DELL_ITSTDV45C1K, 8NBDC1S
MEHRABIAN-OFS, DELL_ITSTDV45C1K, GRX3601
 
PL/SQL procedure successfully completed.


but showing how you are getting it to not work ;)

see the asktom home page - I'll be at NoCOUG in November. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>RE: Parsit function fails when trying to bind predicate</b>
&nbsp;&nbsp;October   14, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#49740119825627">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="49740119825627">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Aaron Valdes</b>&nbsp;from San Diego, Ca</div>
</div>
<pre>Thanks for the quick response. Here is the example. Seems to be the merge:

   -- Create table
   create table TABLETWO
   (
     USER_ID         INTEGER,
     COMPUTER_NAME   VARCHAR2(25),
     COMPUTER_ID     VARCHAR2(40),
     COMPUTER_SERIAL VARCHAR2(20)
   );
   
   create or replace package pkg
   as
       procedure p( p_id in number );
       procedure merge_p (p_id in number);
   end;
   /
   
   create or replace package body pkg
    as
   
    procedure p( p_id in number )
     is
     begin
         for x in ( select *
                     from table( parse_it( cursor( select * from tableone where 
   user_id = p_id ) ) )
                 )
         loop
             dbms_output.put_line( x.computer_name || ', ' || x.computer_id || 
   ', ' || x.computer_serial );
        end loop;
     end;
     --
     --
     --
     procedure merge_p (p_id in number)
     is
     begin
       merge into tabletwo a
       using (select *
              from table( parse_it( cursor( select * from tableone 
                                            where user_id = p_id ) ) ) ) b
       on (a.user_id = b.user_id)
       when matched then
       update
       set a.computer_name = b.computer_name,
           a.computer_id = b.computer_id,
           a.computer_serial = b.computer_serial
       when not matched then
       insert (a.user_id, a.computer_name, a.computer_id, a.computer_serial)
       values (b.user_id, b.computer_name, b.computer_id, b.computer_serial);
     end merge_p;
    end;
    /
    
 SQL&gt; exec pkg.merge_p ( 27137531 );
 
 begin pkg.merge_p ( 27137531 ); end;
 
 ORA-01008: not all variables bound
 ORA-06512: at &quot;AVALDES.PARSE_IT&quot;, line 13
 ORA-06512: at &quot;AVALDES.PKG&quot;, line 22
 ORA-06512: at line 1
 
    
 Yet hardcoding p_id in the merge works. Again thanks for your help.


 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom49740119825627"></a>
<pre>I reproduced in 9ir2 but not 10gr1....

Please contact support with the test case and they might be able to find the related bug and there 
may be a patch. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>RE: Parsit function fails when trying to bind predicate</b>
&nbsp;&nbsp;October   15, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#49761194330797">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="49761194330797">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Aaron Valdes</b>&nbsp;from San Diego, Ca</div>
</div>
<pre>Thanks Tom, I will get with support. Another reason to move to 10g. I can't believe how excited I 
am for LOG ERRORS.

Your new book is great. The searchable PDF of One on One is very handy, since my hard copy is 
looking a little worn from the constant index scanning. ;)

Looking forward to part 2. 

Aaron </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>What is the best way to parse this string </b>
&nbsp;&nbsp;October   27, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#50576748083950">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="50576748083950">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>
'{ABC|CEF|INDIA} SOME TEXT AND CALUCULATIONS HERE {CDE|DDD|AUSTRALIA} SOME TEXT AND CALUCULATIONS 
HERE {TTT|BBB|CHINA}'

I have a string like the below. I looking to write a function which can pluck out the parts of 
string which are country names, and see if they are the same country. If they are different they my 
function will return 'N' else it will return 'Y'.
Note that I can have any number of combinations like {CDE|DDD|AUSTRALIA}, and not limited to 3 as 
shown in the above string.

What is the best way to do it?

Thanks </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom50576748083950"></a>
<pre>give me the logic, in just text - like a specification, that says how to find &quot;countries&quot; in the 
string


the algorithm will just &quot;fall out&quot; from that spec.


1) Is a country ALWAYS between | and }?
2) if so, is a country the ONLY THING between | and }?
if 1) is true and 2) is false - how do you tell then? </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
&nbsp;&nbsp;October   27, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#50587892351853">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="50587892351853">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>1.True
2.True </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom50587892351853"></a>
<pre>could be something like this

ops$tkyte@ORA10GR2&gt; create or replace type str2tblType as table of varchar2(30)
  2  /

Type created.

ops$tkyte@ORA10GR2&gt;
ops$tkyte@ORA10GR2&gt; create or replace function str2tbl( p_str in varchar2 ) return str2tblType
  2  PIPELINED
  3  as
  4      l_str      long default p_str;
  5          l_piece    long;
  6      l_n        number;
  7  begin
  8      loop
  9          l_n := instr( l_str, '}' );
 10          exit when (nvl(l_n,0) = 0);
 11                  l_piece := substr( l_str, 1, l_n-1 );
 12          l_str := substr( l_str, l_n+1 );
 13                  l_n := instr( l_piece, '|', -1 );
 14          exit when (nvl(l_n,0) = 0);
 15          pipe row( ltrim(rtrim(substr(l_piece,l_n+1))) );
 16      end loop;
 17      return;
 18  end;
 19  /

Function created.

ops$tkyte@ORA10GR2&gt;
ops$tkyte@ORA10GR2&gt; select *
  2    from table( str2tbl( '{ABC|CEF|INDIA} SOME TEXT AND CALUCULATIONS HERE {CDE|DDD|AUSTRALIA} 
SOME TEXT AND CALUCULATIONS HERE {TTT|BBB|CHINA}' ) );

COLUMN_VALUE
------------------------------
INDIA
AUSTRALIA
CHINA
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>another ...</b>
&nbsp;&nbsp;October   28, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#50636003696715">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="50636003696715">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Gabe</b>&nbsp;</div>
</div>
<pre>Assuming they are only interested if the countries in the string are different or not [and } is 
only used as an end-of-country delimiter] 

flip@FLOP&gt; select v orig, case
  2                   when fc is null then '!'
  3                   when instr(replace(v,fc),'}') = 0 then 'Y'
  4                   else 'N'
  5                 end &quot;Same?&quot;
  6  from ( select v
  7               ,case
  8                  when nvl(instr(v,'|',1,2),0) &gt; 0 and
  9                       nvl(instr(v,'}',1,1),0) &gt; 0 then
 10         substr(v,instr(v,'|',1,2),instr(v,'}',1,1)-instr(v,'|',1,2)+1)
 11                end fc
 12         from   str
 13       )
 14  ;

ORIG                                                                        S
--------------------------------------------------------------------------- -
{ABC|CEF|INDIA} some text {CDE|DDD|AUSTRALIA} some more {TTT|BBB|CHINA}     N
{x|y|UK} abc {z|w|FRANCE} asd {TTT|BBB|UK}                                  N
{x|y|CANADA} abc {z|w|CANADA} asd {TTT|BBB|CANADA}                          Y
abc {x|y|JAPAN} abc                                                         Y
xyz                                                                         !
{x|y|USA}                                                                   Y

6 rows selected.
 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>SQL Tokenizer + connect by</b>
&nbsp;&nbsp;October   30, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#50703914895102">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="50703914895102">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Alberto Dell'Era</b>&nbsp;from Milan, Italy</div>
</div>
<pre>Just had this crazy idea:

create table t (line int, x varchar2(4000));
insert into t (line,x) values (1, 'a,bb,c,d');
insert into t (line,x) values (2, 'x,yy,z,k');

Version using regexp_substr:

select line, regexp_substr (x, '[^,]+', 1, level) as token
  from t
connect by prior line = line 
       and regexp_instr (x, '[^,]+', 1, level) &gt; 0 
       and prior dbms_random.string ('p', 10) is not null 
;

      LINE TOKEN
---------- -----------
         1 a
         1 bb
         1 c
         1 d
         2 x
         2 yy
         2 z
         2 k

Version using plain substr (less elagant but more performant) :

select line, substr (x, 
                     instr (x, ',', 1, level  ) + 1, 
                     instr (x, ',', 1, level+1) - instr (x, ',', 1, level) -1 ) 
         as token
  from (select line, ','||x||',' as x from t)
connect by prior line = line 
       and instr (x, ',', 1, level+1) &gt; 0 
       and prior dbms_random.string ('p', 10) is not null
;

      LINE TOKEN
---------- -----------
         1 a
         1 bb
         1 c
         1 d
         2 x
         2 yy
         2 z
         2 k

The &quot;prior dbms_random.string ('p', 10) is not null&quot; trick (that I borrowed here from a post by 
Mikito Harakiri) is needed to avoid the error &quot;ORA-01436: CONNECT BY loop in user data&quot;. Wish I 
could avoid it but I've found no way so far.

Both don't scale well with the number of tokens, but anyway, an optimized version of the substr 
variant was able to parse 100,000 rows with 10 tokens of 10 chars each in 39 seconds on my lowly 
laptop (9.2.0.1) - no too bad ;) </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Hitting Error ORA-00942 ...</b>
&nbsp;&nbsp;December  07, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#52934970504162">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="52934970504162">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>VKOUL</b>&nbsp;from WA, USA</div>
</div>
<pre>Hi Tom,

I am hitting ORA-00942 table or view does not exist when using WITH clause, here is the sql

SQL&gt; WITH emps
  2  AS
  3  (
  4   SELECT CAST(column_value AS INTEGER) AS EmpId
  5   FROM   TABLE(CAST(str2tbl('1,2,3') AS COMMA_LIST))
  6   UNION  ALL
  7   SELECT EmpFK AS EmpId
  8   FROM   TBL_TMX_RegBatchUsers t1
  9   WHERE  RegBatchFK =  1
 10   AND    EmpAdded   =  1
 11  )
 12  SELECT 1,
 13         conflicts.EmpId,
 14         times.ActId,
 15         4,
 16         1,
 17         1,
 18         conflicts.ConflictName,
 19         conflicts.BusyId
 20  FROM   (SELECT att.EmpFK AS EmpId,
 21                 act.Activity_PK AS BusyId,
 22                 act.ActivityName AS ConflictName,
 23                 act.StartDt AS StartTm,
 24                 act.EndDt AS EndTm
 25          FROM   Emps
 26          INNER  JOIN TBL_TMX_Attempt att  ON att.EmpFK = Emps.EmpID
 27                                           AND att.EndDt IS NULL
 28          INNER  JOIN TBL_TMX_Activity act ON act.Activity_PK = att.ActivityFK
 29                                           AND act.UseForConflictCheck =  1
 30                                           AND act.Cancelled =  0
 31          WHERE  NOT EXISTS (SELECT NULL
 32                             FROM   TBL_TMX_Activity xAct
 33                             WHERE  xAct.PrntActFK = act.Activity_PK
 34                            )
 35          UNION  ALL
 36          SELECT inst.Inst_EmpFK AS EmpId,
 37                 act.Activity_PK AS BusyId,
 38                 act.ActivityName AS ConflictName,
 39                 act.StartDt AS StartTm,
 40                 act.EndDt AS EndTm
 41          FROM   Emps
 42          INNER  JOIN inst                    ON inst.Inst_EmpFK = Emps.EmpID
 43          INNER  JOIN TBL_TMX_ActInst actinst ON actinst.InstFK = inst.Inst_PK
 44                                              AND actinst.Confirmed =  1
 45          INNER  JOIN TBL_TMX_Activity act    ON act.Activity_PK = actinst.ActivityFK
 46                                              AND act.UseForConflictCheck =  1
 47                                              AND act.Cancelled =  0
 48          WHERE  NOT EXISTS (SELECT NULL
 49                             FROM   TBL_TMX_Activity xAct
 50                             WHERE  xAct.PrntActFK = act.Activity_PK
 51                            )
 52          UNION  ALL
 53          SELECT EmpBusy.EmpBusy_EmpFK AS EmpId,
 54                 NULL AS BusyId,
 55                 EmpBusy.EmpBusy_Subject AS ConflictName,
 56                 EmpBusy.EmpBusy_StartDt AS StartTm,
 57                 EmpBusy.EmpBusy_EndDt   AS EndTm
 58          FROM   Emps
 59          INNER  JOIN tblEmpBusy EmpBusy ON EmpBusy.EmpBusy_EmpFK = Emps.EmpID
 60         ) conflicts,
 61         (SELECT act.Activity_PK AS ActId, act.StartDt AS StartTm, act.EndDt AS EndTm
 62          FROM   TBL_TMX_RegBatchActivities rba
 63          INNER  JOIN TBL_TMX_Activity act ON act.Activity_PK = rba.ActivityFK
 64                                           AND act.UseForConflictCheck =  1
 65                                           AND act.Cancelled =  0
 66          WHERE  rba.RegBatchFK = 1
 67          AND    rba.Validated =  0
 68         ) times
 69  WHERE  times.EndTm   &gt; conflicts.StartTm
 70  AND    times.StartTm &lt; conflicts.EndTm;
 AND    EmpAdded   =  1
               *
ERROR at line 10:
ORA-00942: table or view does not exist


SQL&gt; 
SQL&gt; -- if I remove last 2 lines from the SQL, the Query Runs
SQL&gt; 
SQL&gt; del 69 70
SQL&gt; l
  1  WITH emps
  2  AS
  3  (
  4   SELECT CAST(column_value AS INTEGER) AS EmpId
  5   FROM   TABLE(CAST(str2tbl('1,2,3') AS COMMA_LIST))
  6   UNION  ALL
  7   SELECT EmpFK AS EmpId
  8   FROM   TBL_TMX_RegBatchUsers t1
  9   WHERE  RegBatchFK =  1
 10   AND    EmpAdded   =  1
 11  )
 12  SELECT 1,
 13         conflicts.EmpId,
 14         times.ActId,
 15         4,
 16         1,
 17         1,
 18         conflicts.ConflictName,
 19         conflicts.BusyId
 20  FROM   (SELECT att.EmpFK AS EmpId,
 21                 act.Activity_PK AS BusyId,
 22                 act.ActivityName AS ConflictName,
 23                 act.StartDt AS StartTm,
 24                 act.EndDt AS EndTm
 25          FROM   Emps
 26          INNER  JOIN TBL_TMX_Attempt att  ON att.EmpFK = Emps.EmpID
 27                                           AND att.EndDt IS NULL
 28          INNER  JOIN TBL_TMX_Activity act ON act.Activity_PK = att.ActivityFK
 29                                           AND act.UseForConflictCheck =  1
 30                                           AND act.Cancelled =  0
 31          WHERE  NOT EXISTS (SELECT NULL
 32                             FROM   TBL_TMX_Activity xAct
 33                             WHERE  xAct.PrntActFK = act.Activity_PK
 34                            )
 35          UNION  ALL
 36          SELECT inst.Inst_EmpFK AS EmpId,
 37                 act.Activity_PK AS BusyId,
 38                 act.ActivityName AS ConflictName,
 39                 act.StartDt AS StartTm,
 40                 act.EndDt AS EndTm
 41          FROM   Emps
 42          INNER  JOIN inst                    ON inst.Inst_EmpFK = Emps.EmpID
 43          INNER  JOIN TBL_TMX_ActInst actinst ON actinst.InstFK = inst.Inst_PK
 44                                              AND actinst.Confirmed =  1
 45          INNER  JOIN TBL_TMX_Activity act    ON act.Activity_PK = actinst.ActivityFK
 46                                              AND act.UseForConflictCheck =  1
 47                                              AND act.Cancelled =  0
 48          WHERE  NOT EXISTS (SELECT NULL
 49                             FROM   TBL_TMX_Activity xAct
 50                             WHERE  xAct.PrntActFK = act.Activity_PK
 51                            )
 52          UNION  ALL
 53          SELECT EmpBusy.EmpBusy_EmpFK AS EmpId,
 54                 NULL AS BusyId,
 55                 EmpBusy.EmpBusy_Subject AS ConflictName,
 56                 EmpBusy.EmpBusy_StartDt AS StartTm,
 57                 EmpBusy.EmpBusy_EndDt   AS EndTm
 58          FROM   Emps
 59          INNER  JOIN tblEmpBusy EmpBusy ON EmpBusy.EmpBusy_EmpFK = Emps.EmpID
 60         ) conflicts,
 61         (SELECT act.Activity_PK AS ActId, act.StartDt AS StartTm, act.EndDt AS EndTm
 62          FROM   TBL_TMX_RegBatchActivities rba
 63          INNER  JOIN TBL_TMX_Activity act ON act.Activity_PK = rba.ActivityFK
 64                                           AND act.UseForConflictCheck =  1
 65                                           AND act.Cancelled =  0
 66          WHERE  rba.RegBatchFK = 1
 67          AND    rba.Validated =  0
 68*        ) times
SQL&gt; /

no rows selected

SQL&gt; l
  1  WITH emps
  2  AS
  3  (
  4   SELECT CAST(column_value AS INTEGER) AS EmpId
  5   FROM   TABLE(CAST(str2tbl('1,2,3') AS COMMA_LIST))
  6   UNION  ALL
  7   SELECT EmpFK AS EmpId
  8   FROM   TBL_TMX_RegBatchUsers t1
  9   WHERE  RegBatchFK =  1
 10   AND    EmpAdded   =  1
 11  )
 12  SELECT 1,
 13         conflicts.EmpId,
 14         times.ActId,
 15         4,
 16         1,
 17         1,
 18         conflicts.ConflictName,
 19         conflicts.BusyId
 20  FROM   (SELECT att.EmpFK AS EmpId,
 21                 act.Activity_PK AS BusyId,
 22                 act.ActivityName AS ConflictName,
 23                 act.StartDt AS StartTm,
 24                 act.EndDt AS EndTm
 25          FROM   Emps
 26          INNER  JOIN TBL_TMX_Attempt att  ON att.EmpFK = Emps.EmpID
 27                                           AND att.EndDt IS NULL
 28          INNER  JOIN TBL_TMX_Activity act ON act.Activity_PK = att.ActivityFK
 29                                           AND act.UseForConflictCheck =  1
 30                                           AND act.Cancelled =  0
 31          WHERE  NOT EXISTS (SELECT NULL
 32                             FROM   TBL_TMX_Activity xAct
 33                             WHERE  xAct.PrntActFK = act.Activity_PK
 34                            )
 35          UNION  ALL
 36          SELECT inst.Inst_EmpFK AS EmpId,
 37                 act.Activity_PK AS BusyId,
 38                 act.ActivityName AS ConflictName,
 39                 act.StartDt AS StartTm,
 40                 act.EndDt AS EndTm
 41          FROM   Emps
 42          INNER  JOIN inst                    ON inst.Inst_EmpFK = Emps.EmpID
 43          INNER  JOIN TBL_TMX_ActInst actinst ON actinst.InstFK = inst.Inst_PK
 44                                              AND actinst.Confirmed =  1
 45          INNER  JOIN TBL_TMX_Activity act    ON act.Activity_PK = actinst.ActivityFK
 46                                              AND act.UseForConflictCheck =  1
 47                                              AND act.Cancelled =  0
 48          WHERE  NOT EXISTS (SELECT NULL
 49                             FROM   TBL_TMX_Activity xAct
 50                             WHERE  xAct.PrntActFK = act.Activity_PK
 51                            )
 52          UNION  ALL
 53          SELECT EmpBusy.EmpBusy_EmpFK AS EmpId,
 54                 NULL AS BusyId,
 55                 EmpBusy.EmpBusy_Subject AS ConflictName,
 56                 EmpBusy.EmpBusy_StartDt AS StartTm,
 57                 EmpBusy.EmpBusy_EndDt   AS EndTm
 58          FROM   Emps
 59          INNER  JOIN tblEmpBusy EmpBusy ON EmpBusy.EmpBusy_EmpFK = Emps.EmpID
 60         ) conflicts,
 61         (SELECT act.Activity_PK AS ActId, act.StartDt AS StartTm, act.EndDt AS EndTm
 62          FROM   TBL_TMX_RegBatchActivities rba
 63          INNER  JOIN TBL_TMX_Activity act ON act.Activity_PK = rba.ActivityFK
 64                                           AND act.UseForConflictCheck =  1
 65                                           AND act.Cancelled =  0
 66          WHERE  rba.RegBatchFK = 1
 67          AND    rba.Validated =  0
 68         ) times
 69* WHERE  times.EndTm   &gt; sysdate
SQL&gt; 
SQL&gt; 
SQL&gt; /

no rows selected

SQL&gt; disc
Disconnected from Oracle9i Enterprise Edition Release 9.2.0.7.0 - Production
With the Partitioning, OLAP and Oracle Data Mining options
JServer Release 9.2.0.7.0 - Production
SQL&gt; 
SQL&gt; 
SQL&gt;

The query works as long as I put conditions which does not involve both in-line views at the same 
time.

I am at a loss to know what is going on ...

Is there a known bug or something which I am missing ?

Thanks
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom52934970504162"></a>
<pre>you give me absolutely no way to reproduce this :( 

 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Way to reproduce above</b>
&nbsp;&nbsp;December  08, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#52964143077554">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="52964143077554">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Bob B</b>&nbsp;from Mechanicsburg, PA</div>
</div>
<pre>I think I've run into a similar situation to above a few months back.  I no longer have access to a 
10g box to replicate, but here's a small template query that may help you see what's going on.

WITH INFO AS (
  SELECT COLUMN_VALUE NUM
  FROM TABLE( STR2TBL( '0,1,2,3,4,5,6,7,8,9' ) )
), INFO2 AS (
  SELECT i1.NUM, i2.NUM
  FROM INFO i1, INFO i2
)
SELECT *
FROM INFO2

I don't know if its exactly the same, but I believe the issue has to do with the optimizer 
rewriting the query as if TABLE( STR2TBL( &lt;info&gt; ) ) is an actual table.  Out of curiosity, what 
indexes are on place on the EmpBusy table?
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom52964143077554"></a>
<pre>ops$tkyte@ORA10GR2&gt; create table info( num number );

Table created.

ops$tkyte@ORA10GR2&gt;
ops$tkyte@ORA10GR2&gt;
ops$tkyte@ORA10GR2&gt; WITH INFO AS (
  2    SELECT COLUMN_VALUE NUM
  3    FROM TABLE( STR2TBL( '0,1,2,3,4,5,6,7,8,9' ) )
  4  ), INFO2 AS (
  5    SELECT i1.NUM i1_num, i2.NUM i2_num
  6    FROM INFO i1, INFO i2
  7  )
  8  SELECT *
  9  FROM INFO2
 10  /

I1_NUM                         I2_NUM
------------------------------ ------------------------------
0                              0
...

nope - works (had ambigous column names, I fixed that) </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>Hitting Error ORA-00942 </b>
&nbsp;&nbsp;December  08, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#52983488911832">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="52983488911832">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>VKOUL</b>&nbsp;from WA, USA</div>
</div>
<pre>I can reproduce it in another user, is there an email where I can send you an import file of 9i 
database without data involving 7 tables ? The file is just 131,072 bytes.

The funny thing is, there are two non-unique indexes on table TBLEMPBUSY, dropping both of which, 
the query gives no syntax error. But I do not want this query to be implmented without these 
dropped indexes.
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom52983488911832"></a>
<pre>no, make it smaller, you can chop out all but the relevant columns, no tablespaces, probably even 
get rid of some of the tables.

Or, since you have a test case - you could use support, which is where this will end up if it is a 
bug anyway ;) </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>Hitting Error ORA-00942</b>
&nbsp;&nbsp;December  09, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#53011320595779">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="53011320595779">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>VKOUL</b>&nbsp;from WA, USA</div>
</div>
<pre>Hi Tom,

I'll contact support for this.

Thanks for your time.
 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>Hitting ORA-00942 Error ...</b>
&nbsp;&nbsp;December  09, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#53046821884868">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="53046821884868">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>VKOUL</b>&nbsp;from WA, USA</div>
</div>
<pre>Hi Tom,

For support I have created a script, I do not want to chop pther columns as it might have some 
effect on the cause of failure of the query, so below is the complete script with tablespace 
information stripped.

- This error is even coming on Oracle 10g on windows
- Earlier, I said dropping two indexes makes the query run, but I noticed dropping only one index 
makes the query go and that index is IDX_TBLEMPBUSY_4LOSH813 of table TBLEMPBUSY.

- I have done installation in a fresh schema
- I am not able to publish the whole script, so I am doing it in parts

********************************************************
PART 1
********************************************************
PROMPT &quot;Type COMMA_LIST Start&quot;

CREATE OR REPLACE TYPE comma_list AS TABLE OF VARCHAR2(1024)
/

PROMPT &quot;Type COMMA_LIST  End &quot;

PROMPT &quot;Function STR2TBL Start&quot;

CREATE OR REPLACE FUNCTION Str2Tbl(p_str_in VARCHAR2, p_delim varchar2 := ',')
RETURN comma_list IS
    l_str   VARCHAR2(32767);
    l_n     NUMBER;
    l_s     number;
    l_pln   number;
    l_data  comma_list := comma_list();
    l_temp  VARCHAR2(1024);
    p_str   VARCHAR2(4096) := p_str_in;
BEGIN
    -- Check for no delimiter, list contains a single item
    l_s   := length( p_str );
    l_pln := length( p_delim );
    IF substr(p_str,l_s-l_pln+1 ) = p_delim THEN
       l_str := p_str;
    ELSE
       l_str := p_str || p_delim;
    END IF;
    l_n   := instr( l_str, p_delim );
    IF nvl(l_n,0) = 0 THEN
      l_data.EXTEND;
      l_data( l_data.COUNT ) := ltrim(rtrim(l_str));
    ELSE
      -- one or more items in the list, parse away.
      LOOP
          l_n := instr( l_str, p_delim );
          EXIT WHEN (nvl(l_n,0) = 0);
          l_data.EXTEND;
          l_temp := ltrim(rtrim(substr(l_str,1,l_n-1)));
          IF l_temp IS NOT NULL THEN
             l_data( l_data.COUNT ) := l_temp;
          END IF;
          l_str := substr( l_str, l_n+l_pln );
      END LOOP;
    END IF;
   RETURN l_data;
END Str2Tbl;
/

PROMPT &quot;Function STR2TBL  End &quot;

PROMPT &quot;Table TBL_TMX_REGBATCHUSERS Start&quot;

CREATE TABLE TBL_TMX_REGBATCHUSERS
(
  REGBATCHFK   NUMBER(10)                       NOT NULL,
  EMPFK        NUMBER(10)                       NOT NULL,
  EMPSELECTED  NUMBER(10)                       NOT NULL,
  TARGET       NUMBER(10),
  REGSTATUS    NUMBER(10),
  BILLTOORGFK  NUMBER(10),
  EMPADDED     NUMBER(10),
  LSTUPD       DATE                             NOT NULL,
  USRNAME      VARCHAR2(90 BYTE)                NOT NULL,
  LCK          NUMBER(10)                       NOT NULL
);


CREATE UNIQUE INDEX PK_TBL_TMX_REGBATCHUSERS ON TBL_TMX_REGBATCHUSERS
(REGBATCHFK, EMPFK);


CREATE INDEX IDX_TMX_REGBATCHUSERS_WWUD2S1O ON TBL_TMX_REGBATCHUSERS
(EMPFK);


CREATE INDEX IDX_TMX_REGBATCHUSERS_WWUD2S1P ON TBL_TMX_REGBATCHUSERS
(BILLTOORGFK);


CREATE OR REPLACE TRIGGER TR_BI_TBL_TMX_REGBATCHUSERS
before insert on TBL_TMX_RegBatchUsers
for each row
begin
    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

    if :new.Lck is null then
        :new.Lck := 0;
    end if;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER TR_BU_TBL_TMX_REGBATCHUSERS
before update on TBL_TMX_RegBatchUsers
for each row
begin
    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

end;
/
SHOW ERRORS;



ALTER TABLE TBL_TMX_REGBATCHUSERS ADD (
  CONSTRAINT PK_TBL_TMX_REGBATCHUSERS
 PRIMARY KEY
 (REGBATCHFK, EMPFK)
    USING INDEX);


ALTER TABLE TBL_TMX_REGBATCHUSERS ADD (
  CONSTRAINT FK_EMPFK_GVRRF10L 
 FOREIGN KEY (EMPFK) 
 REFERENCES TBLEMP (EMP_PK)
    ON DELETE CASCADE);

ALTER TABLE TBL_TMX_REGBATCHUSERS ADD (
  CONSTRAINT FK_REGBATCHFK_GVRRF10K 
 FOREIGN KEY (REGBATCHFK) 
 REFERENCES TBL_TMX_REGBATCH (REGBATCH_PK)
    ON DELETE CASCADE);

PROMPT &quot;Table TBL_TMX_REGBATCHUSERS  End &quot;

PROMPT &quot;Table TBL_TMX_ATTEMPT Start&quot;

CREATE TABLE TBL_TMX_ATTEMPT
(
  ATTEMPT_PK           NUMBER(10)               NOT NULL,
  EMPFK                NUMBER(10)               NOT NULL,
  ACTIVITYFK           NUMBER(10)               NOT NULL,
  AUTHREGFK            NUMBER(10),
  STARTDT              DATE,
  ENDDT                DATE,
  WAIVEIND             NUMBER(10)               NOT NULL,
  COMPLETIONSTATUS     NUMBER(10),
  SUCCESS              NUMBER(10),
  SCORE                NUMBER(20,4),
  ATTNDSTATUSFK        NUMBER(10),
  GRDFK                NUMBER(10),
  NOTE                 CLOB,
  ELAPSEDSECONDS       NUMBER(10),
  LAUNCHCOURSEVERSION  CHAR(38 BYTE),
  MERGEDSKL            NUMBER(10),
  CURRENTATTEMPTIND    NUMBER(10),
  LAUNCHCOUNT          NUMBER(10)               NOT NULL,
  LINKFK               NUMBER(10),
  SOURCE               NUMBER(10),
  SESSIONID            VARCHAR2(90 BYTE),
  EXPIRATIONDATE       DATE,
  REPLANDATE           DATE,
  EXPIRATIONTYPE       NUMBER(10),
  MODIFIERFK           NUMBER(10),
  CERTNOTES            CLOB,
  WASACTIVATION        NUMBER(1),
  ORIGINALEVTFK        NUMBER(10),
  OFFLINEIND           NUMBER(10),
  LASTSYNCDT           DATE,
  LSTUPD               DATE                     NOT NULL,
  USRNAME              VARCHAR2(90 BYTE)        NOT NULL,
  LCK                  NUMBER(10)               NOT NULL,
  WEBEXATTENDEEID      NUMBER(10),
  WEBEXREGISTERID      NUMBER(10)
);

CREATE INDEX IDX_TMX_ATTEMPT_Z2NRX31W ON TBL_TMX_ATTEMPT
(EMPFK, ACTIVITYFK, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S19 ON TBL_TMX_ATTEMPT
(ACTIVITYFK, EMPFK, CURRENTATTEMPTIND, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1B ON TBL_TMX_ATTEMPT
(ENDDT, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1E ON TBL_TMX_ATTEMPT
(GRDFK, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1H ON TBL_TMX_ATTEMPT
(LAUNCHCOURSEVERSION, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1K ON TBL_TMX_ATTEMPT
(ACTIVITYFK, EMPFK, AUTHREGFK);


CREATE UNIQUE INDEX PK_TBL_TMX_ATTEMPT ON TBL_TMX_ATTEMPT
(ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S17 ON TBL_TMX_ATTEMPT
(EMPFK, ACTIVITYFK, CURRENTATTEMPTIND, COMPLETIONSTATUS, ENDDT, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S18 ON TBL_TMX_ATTEMPT
(ACTIVITYFK, EMPFK, ENDDT);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1A ON TBL_TMX_ATTEMPT
(STARTDT, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1C ON TBL_TMX_ATTEMPT
(AUTHREGFK, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1D ON TBL_TMX_ATTEMPT
(ATTNDSTATUSFK, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1F ON TBL_TMX_ATTEMPT
(LINKFK, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1G ON TBL_TMX_ATTEMPT
(CURRENTATTEMPTIND, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1I ON TBL_TMX_ATTEMPT
(ORIGINALEVTFK, EMPFK, ATTEMPT_PK);


CREATE INDEX IDX_TMX_ATTEMPT_WWUD2S1J ON TBL_TMX_ATTEMPT
(ATTEMPT_PK, STARTDT, ENDDT);


CREATE INDEX IDX_TMX_ATTEMPT_Z2NRX31V ON TBL_TMX_ATTEMPT
(MODIFIERFK);


CREATE OR REPLACE TRIGGER TR_BI_TBL_TMX_ATTEMPT
before insert on TBL_TMX_Attempt
for each row
begin
    if :new.WaiveInd is null then
        :new.WaiveInd := 0;
    end if;

    if :new.LaunchCount is null then
        :new.LaunchCount := 0;
    end if;

    if :new.wasActivation is null then
        :new.wasActivation := 0;
    end if;

    if :new.OfflineInd is null then
        :new.OfflineInd := 0;
    end if;

    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

    if :new.Lck is null then
        :new.Lck := 0;
    end if;

    if :new.wasActivation is not null and :new.wasActivation != 0 then
        :new.wasActivation := 1;
    end if;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER TR_BU_TBL_TMX_ATTEMPT
before update on TBL_TMX_Attempt
for each row
begin
    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

    if :new.wasActivation is not null and :new.wasActivation != 0 then
        :new.wasActivation := 1;
    end if;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tu_attempt_1
BEFORE UPDATE OF EndDt ON TBL_TMX_Attempt
BEGIN
   Core_Trigger.attemptupd_clear;
END tu_attempt_1;
/
SHOW ERRORS;

ALTER TRIGGER TU_ATTEMPT_1 DISABLE;



CREATE OR REPLACE TRIGGER tu_attempt_2
BEFORE UPDATE OF EndDt ON TBL_TMX_Attempt
FOR EACH ROW
Declare
    dt_ExpirationDate date;
    dt_ReplanDate   date;
    i_ExpirationRule  integer;
    i_ExpirationParamValue integer;
    i_ExpirationParamDate date;
BEGIN
    -- if the old completion date is null and the new completion
    -- date is not null, then we need to send an activity
    -- completion notification
--Update expiration Date
    if (:NEW.CompletionStatus= 1) then
        begin
            select  expirationdate,  expirationdate-replandays
                  into   dt_ExpirationDate, dt_ReplanDate
                  FROM tbl_tmx_UserRequiredAct  userReq
                  INNER JOIN tbl_tmx_requiredActivity Req on userReq.activityFK = Req.activityFK
                  WHERE userReq.activityfk= :NEW.ActivityFK and empfk= :NEW.EmpFK;
        exception
            when no_data_found then
                begin
            dt_ExpirationDate    :=  NULL;
            dt_ReplanDate        :=  NULL;
                end;
        end;

--Select the Expiration Rule ...
--select the ExpirationParamValue ....
--select ExpirationParamDate
begin
    select ExpirationRule, ExpirationParamValue,ExpirationParamDate
        into  i_ExpirationRule  , i_ExpirationParamValue, i_ExpirationParamDate
        from   TBL_TMX_RequiredActivity where ActivityFK =  :NEW.ActivityFK ;
    exception
        when no_data_found then
        begin
            i_ExpirationRule :=NULL;
            i_ExpirationParamValue :=NULL ;
            i_ExpirationParamDate := NULL;
        end;
end;


    if( i_ExpirationRule = 3 ) then
        begin
            if( ( TO_CHAR(i_ExpirationParamDate,'MM') &gt; TO_CHAR(:NEW.EndDt,'MM') ) or ( 
(TO_CHAR(:NEW.EndDt,'MM') = TO_CHAR(i_ExpirationParamDate,'MM')) AND ( 
TO_CHAR(i_ExpirationParamDate,'DD') &gt;TO_CHAR(:NEW.EndDt,'DD') )   ) ) then
            begin

            --this is to populate the Expiration date when the expirationdate is falling as future 
date
            --need to add the param value to the enddt by subtracting 1 ..

            i_ExpirationParamValue := i_ExpirationParamValue -1;
            end;
                    end if;
        end;
        end if;



        if (:NEW.EndDt &gt;= dt_ReplanDate and :NEW.EndDt &lt;= dt_ExpirationDate ) then
            begin
                select  CASE ExpirationRule
                     WHEN 0 THEN NULL
                     WHEN 1 THEN dt_ExpirationDate+coalesce(ExpirationParamValue,0)
                     WHEN 2 THEN ExpirationParamDate
                     WHEN 3 THEN  TO_DATE(TO_CHAR(dt_ExpirationDate,'YYYY')+ExpirationParamValue  
||  '/'  ||  TO_CHAR(ExpirationParamDate,'MM')  ||  '/'  ||  TO_CHAR(ExpirationParamDate,'DD') 
,'YYYY/MM/DD')
                     END
                      into   dt_ExpirationDate
                      from TBL_TMX_RequiredActivity where ActivityFK = :NEW.ActivityFK ;
            exception
                when no_data_found then
                    begin
            dt_ExpirationDate    :=  NULL;
                    end;
            end;

        else
            begin
                select  CASE ExpirationRule
                     WHEN 0 THEN NULL
                     WHEN 1 THEN :NEW.EndDt+coalesce(ExpirationParamValue,0)
                     WHEN 2 THEN ExpirationParamDate
                     WHEN 3 THEN TO_DATE(TO_CHAR(:NEW.EndDt,'YYYY')+i_ExpirationParamValue  ||  '/' 
 ||  TO_CHAR(i_ExpirationParamDate,'MM')  ||  '/'  ||  TO_CHAR(i_ExpirationParamDate,'DD') 
,'YYYY/MM/DD')
                     END
                      into   dt_ExpirationDate
                      from TBL_TMX_RequiredActivity where ActivityFK = :NEW.ActivityFK ;
            exception
                when no_data_found then
                    begin
            dt_ExpirationDate    :=  NULL;
                    end;
            end;

        end if;

        begin
            select dt_ExpirationDate-ReplanDays
                  into   dt_ReplanDate
                  from TBL_TMX_RequiredActivity where ActivityFK = :NEW.ActivityFK;
        exception
            when no_data_found then
                begin
            dt_ReplanDate        :=  NULL;
                end;
        end;
        if(:OLD.source=2) then
        begin
            dt_ExpirationDate := 
coalesce(least(:OLD.ExpirationDate,dt_ExpirationDate),:OLD.ExpirationDate,dt_ExpirationDate);
        end;
        end if;
    else

        dt_ExpirationDate    :=  NULL;
        dt_ReplanDate        :=  NULL;
    end if;

 if(:NEW.LinkFk is null) then
    :NEW.ExpirationDate := dt_ExpirationDate;
    :NEW.ReplanDate     := dt_ReplanDate;
 end if;
--end of updation
   IF ( :OLD.CompletionStatus = 0 OR :OLD.CompletionStatus is NULL ) AND :NEW.CompletionStatus = 1 
THEN
      Core_Trigger.attemptupd_add(:NEW.Attempt_PK, :NEW.ActivityFK, :NEW.EmpFK);
   END IF;
END tu_attempt_2;
/
SHOW ERRORS;

ALTER TRIGGER TU_ATTEMPT_2 DISABLE;



CREATE OR REPLACE TRIGGER tu_attempt_3
AFTER UPDATE OF EndDt ON TBL_TMX_Attempt
BEGIN
   Core_Trigger.attemptupd_process;
END tu_attempt_3;
/
SHOW ERRORS;

ALTER TRIGGER TU_ATTEMPT_3 DISABLE;



ALTER TABLE TBL_TMX_ATTEMPT ADD (
  CONSTRAINT PK_TBL_TMX_ATTEMPT
 PRIMARY KEY
 (ATTEMPT_PK)
    USING INDEX 
    TABLESPACE SUMTOTAL_INDEX
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                MINEXTENTS       1
                MAXEXTENTS       2147483645
                PCTINCREASE      0
               ));


ALTER TABLE TBL_TMX_ATTEMPT ADD (
  CONSTRAINT FK_ACTIVITYFK_GVRRF10G 
 FOREIGN KEY (ACTIVITYFK) 
 REFERENCES TBL_TMX_ACTIVITY (ACTIVITY_PK)
    ON DELETE CASCADE);

ALTER TABLE TBL_TMX_ATTEMPT ADD (
  CONSTRAINT FK_EMPFK_GVRRF10F 
 FOREIGN KEY (EMPFK) 
 REFERENCES TBLEMP (EMP_PK)
    ON DELETE CASCADE);

ALTER TABLE TBL_TMX_ATTEMPT ADD (
  CONSTRAINT FK_MODIFIERFK_GVRRF10H 
 FOREIGN KEY (MODIFIERFK) 
 REFERENCES TBLEMP (EMP_PK)
    ON DELETE SET NULL);

PROMPT &quot;Table TBL_TMX_ATTEMPT  End &quot;

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom53046821884868"></a>
<pre>you should chop out everything, every single thing, that is not relevant.  I had to hit page down 
many times to see this - SMALLER is BETTER.


lose all storage clauses, tablespaces - that sort of stuff.  you want something that anyone can run 
on any system.  


no triggers, the code can even go away - you are hitting this on parse.  make it easy for someone 
looking at this to see what it wrong.  

I won't even consider a 3 part problem where part I makes me scroll over and over with lots of 
unnecessary stuff (triggers???  cannot see how they are relevant - but as you reduce the problem 
you might be able to say &quot;hey, take away the trigger and it works??!?  you know how much faster 
you'll get from problem to solution that way.  The fine art of debugging involves reducing the 
problem to its very essence)


SMALL
yet 100% complete
but CONCISE

that is the description of a good test case. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>Hitting ORA-00942 ...</b>
&nbsp;&nbsp;December  09, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#53046901895943">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="53046901895943">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>VKOUL</b>&nbsp;from WA, USA</div>
</div>
<pre>********************************************************
PART 2
********************************************************
PROMPT &quot;Table TBL_TMX_ACTIVITY Start&quot;

CREATE TABLE TBL_TMX_ACTIVITY
(
  ACTIVITY_PK           NUMBER(10)              NOT NULL,
  ACTIVITYNAME          VARCHAR2(900 BYTE)      NOT NULL,
  ACTIVITYSEARCH        VARCHAR2(1665 BYTE),
  ACTIVITYLABELFK       NUMBER(10),
  PRNTACTFK             NUMBER(10),
  CODE                  VARCHAR2(765 BYTE),
  CCENTER               NUMBER(10),
  ACTIVITYDESC          CLOB,
  ACTIVITYDESCFMT       CLOB,
  URL                   VARCHAR2(3072 BYTE),
  ACTIVE                NUMBER(10)              NOT NULL,
  OPENFORREG            NUMBER(10)              NOT NULL,
  NOREGREQD             NUMBER(10),
  MAXATTEMPTS           NUMBER(10),
  MAXATTEMPTSPERPARENT  NUMBER(10),
  CANCELLED             NUMBER(10)              NOT NULL,
  HIDDEN                NUMBER(10)              NOT NULL,
  PRIVATE               NUMBER(10)              NOT NULL,
  EMPNOTES              CLOB,
  EMPNOTESFMT           CLOB,
  INSTRNOTES            CLOB,
  INSTRNOTESFMT         CLOB,
  ISDELETED             NUMBER(10)              NOT NULL,
  COSTBASE              NUMBER(17,2),
  COSTCNCL              NUMBER(17,2),
  COSTLATECNCL          NUMBER(17,2),
  COSTNOSHOW            NUMBER(17,2),
  CURRENCYFK            NUMBER(10),
  PAYTERMFK             NUMBER(10),
  ECOMREQD              NUMBER(10),
  STARTDT               DATE,
  ENDDT                 DATE,
  REGDEADLINEDT         DATE,
  REGCNCLDEADLINEDT     DATE,
  TIMEZONEFK            NUMBER(10),
  USEFORCONFLICTCHECK   NUMBER(10),
  REQAPPR               NUMBER(10),
  DEFAPPREMPFK          NUMBER(10),
  OWNEREMPFK            NUMBER(10),
  REQPERSONNEL          CLOB,
  CBTLAUNCHMTDFK        NUMBER(10),
  CANBECOPIED           NUMBER(10),
  CANBESUBSCR           NUMBER(10),
  CANBEFUL              NUMBER(10),
  ROLLUPFROMFUL         NUMBER(10),
  STICKYAUDIENCEIND     NUMBER(10),
  COPYORIGINALACTIVITY  NUMBER(10),
  MINCAPACITY           NUMBER(10),
  MAXCAPACITY           NUMBER(10),
  RECORDSESSION         NUMBER(10),
  REQUIREDIND           NUMBER(10)              NOT NULL,
  PICKRULE              NUMBER(10),
  PICKRULETYPE          NUMBER(10)              NOT NULL,
  USETYPE               NUMBER(10)              NOT NULL,
  RESTRICTED            NUMBER(10)              NOT NULL,
  ACTTOCOMPLETE         NUMBER(10),
  CONTRIBUTEROLLUPIND   NUMBER(10),
  MINPCTGRD             NUMBER(10),
  ESTDUR                FLOAT(126),
  SENDACTCOMPLETENTF    NUMBER(10),
  SENDACTREMINDERNTF    NUMBER(10),
  SENDACTREGNTF         NUMBER(10),
  ORDINAL               NUMBER(10),
  LEVELVAL              NUMBER(10),
  ROOTACTIVITYFK        NUMBER(10),
  REFERENCEACTFK        NUMBER(10),
  ORIGINALPK            NUMBER(10),
  DEFFACFK              NUMBER(10),
  HDNFRMTRANSCRIPT      NUMBER(10)              NOT NULL,
  TOSTAGINGDT           DATE,
  LSTUPD                DATE                    NOT NULL,
  USRNAME               VARCHAR2(90 BYTE)       NOT NULL,
  LCK                   NUMBER(10)              NOT NULL,
  TIMESTAMP             NUMBER(10),
  CONTACT               VARCHAR2(1024 BYTE),
  ESTCRDHRS             FLOAT(126)
);

CREATE INDEX IDX_TMX_ACTIVITY_GVOF9C0W ON TBL_TMX_ACTIVITY
(UPPER(&quot;ACTIVITYNAME&quot;), ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_GVOF9C1E ON TBL_TMX_ACTIVITY
(ACTIVITY_PK, PRNTACTFK, ACTIVE, HIDDEN, CANCELLED, NOREGREQD, REFERENCEACTFK, ENDDT);


CREATE INDEX IDX_TMX_ACTIVITY_GVOF9C1J ON TBL_TMX_ACTIVITY
(LEVELVAL, ORDINAL);


CREATE INDEX FT_TABLE_U7NBNT0K ON TBL_TMX_ACTIVITY
(ACTIVITYNAME)
INDEXTYPE IS CTXSYS.CONTEXT
PARAMETERS('lexer aspen_lexer storage aspen_storage stoplist aspen_stoplist');


CREATE INDEX FT_TABLE_U7NBNT0L ON TBL_TMX_ACTIVITY
(ACTIVITYSEARCH)
INDEXTYPE IS CTXSYS.CONTEXT
PARAMETERS('lexer aspen_lexer storage aspen_storage stoplist aspen_stoplist');


CREATE INDEX FT_TABLE_U7NBNT0M ON TBL_TMX_ACTIVITY
(CODE)
INDEXTYPE IS CTXSYS.CONTEXT
PARAMETERS('lexer aspen_lexer storage aspen_storage stoplist aspen_stoplist');


CREATE INDEX FT_TABLE_U7NBNT0N ON TBL_TMX_ACTIVITY
(ACTIVITYDESC)
INDEXTYPE IS CTXSYS.CONTEXT
PARAMETERS('lexer aspen_lexer storage aspen_storage stoplist aspen_stoplist');


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW17 ON TBL_TMX_ACTIVITY
(ENDDT, STARTDT, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW19 ON TBL_TMX_ACTIVITY
(REFERENCEACTFK, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW1A ON TBL_TMX_ACTIVITY
(CANBECOPIED, ACTIVE, CANCELLED, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW1B ON TBL_TMX_ACTIVITY
(CANBEFUL, ACTIVE, CANCELLED, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW1C ON TBL_TMX_ACTIVITY
(CANBESUBSCR, ACTIVE, CANCELLED, ACTIVITY_PK);


CREATE UNIQUE INDEX PK_TBL_TMX_ACTIVITY ON TBL_TMX_ACTIVITY
(ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW0R ON TBL_TMX_ACTIVITY
(CODE, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW0S ON TBL_TMX_ACTIVITY
(ACTIVE, ACTIVITY_PK, PRNTACTFK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW0T ON TBL_TMX_ACTIVITY
(CANCELLED, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW0U ON TBL_TMX_ACTIVITY
(ACTIVITYLABELFK, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW0V ON TBL_TMX_ACTIVITY
(PRNTACTFK, ACTIVITY_PK, ROOTACTIVITYFK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW0W ON TBL_TMX_ACTIVITY
(ACTIVITY_PK, ROOTACTIVITYFK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW0X ON TBL_TMX_ACTIVITY
(ROOTACTIVITYFK, ACTIVITY_PK, PRNTACTFK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW0Y ON TBL_TMX_ACTIVITY
(DEFAPPREMPFK, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW0Z ON TBL_TMX_ACTIVITY
(OWNEREMPFK, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW10 ON TBL_TMX_ACTIVITY
(CBTLAUNCHMTDFK, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW11 ON TBL_TMX_ACTIVITY
(ORDINAL, ACTIVITY_PK);


CREATE UNIQUE INDEX IDX_TMX_ACTIVITY_AB8CHW12 ON TBL_TMX_ACTIVITY
(ROOTACTIVITYFK, ACTIVITY_PK, ACTIVITYLABELFK, ACTIVE, PRNTACTFK, ISDELETED, CANCELLED);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW13 ON TBL_TMX_ACTIVITY
(ORIGINALPK, ACTIVITYLABELFK, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW14 ON TBL_TMX_ACTIVITY
(DEFFACFK, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW15 ON TBL_TMX_ACTIVITY
(USEFORCONFLICTCHECK, ACTIVE, CANCELLED, ACTIVITY_PK);


CREATE INDEX IDX_TMX_ACTIVITY_AB8CHW16 ON TBL_TMX_ACTIVITY
(STARTDT, ENDDT, ACTIVITY_PK);


CREATE OR REPLACE TRIGGER actafterrowtrg
    after delete on tbl_tmx_activity
    for each row
begin
        if ( pkg_status.statusflag )
        then
        pkg_status.modifiedtab(pkg_status.ncount):= :old.activity_pk;
        pkg_status.ncount := pkg_status.ncount + 1;

       end if;
   end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER actafterstatetrg
  after delete on tbl_tmx_activity
begin

       if ( pkg_status.statusflag )

       then

           pkg_status.statusflag := FALSE;

       For i in 1.. pkg_status.modifiedtab.count
       Loop

        Delete from Tbl_TAX_Item
         Where extintid = pkg_status.modifiedtab(i) and ConTypeId_FK = -6;

           end loop;

           pkg_status.statusflag := TRUE;
       pkg_status.ncount := 1;

       end if;

   exception

       when others then

           pkg_status.statusflag := TRUE;
       pkg_status.ncount := 1;

       raise;

   end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER actbeforetrg
    before delete on tbl_tmx_activity
begin
        if ( pkg_status.statusflag )
        then
            pkg_status.ncount := 1;
            pkg_status.modifiedtab := pkg_status.cleartab;

        end if;
    end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tI_Activity_1
BEFORE INSERT ON TBL_TMX_Activity
BEGIN
   IF NOT Core_Trigger.trig_activityins_running THEN
      Core_Trigger.activityins_clear;
   END IF;
END tI_Activity_1;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tI_Activity_2
BEFORE INSERT ON TBL_TMX_Activity
FOR EACH ROW
BEGIN
   IF NOT Core_Trigger.trig_activityins_running THEN
      Core_Trigger.activityins_add(:NEW.Activity_PK, :NEW.PrntActFK);
   END IF;
END tI_Activity_2;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tI_Activity_3
AFTER Insert ON TBL_TMX_Activity
BEGIN
   IF NOT Core_Trigger.trig_activityins_running THEN
      Core_Trigger.activityins_process;
   END IF;
END tI_Activity_3;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tr_activity_search
  BEFORE INSERT OR UPDATE OF ActivityName, Code ON TBL_TMX_Activity
  FOR EACH ROW
BEGIN
   :NEW.ActivitySearch := SUBSTR(TRIM(TRIM(:NEW.ActivityName)||' '||TRIM(:NEW.Code)),1,1665);
END tr_activity_search;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER TR_BI_TBL_TMX_ACTIVITY
before insert on TBL_TMX_Activity
for each row
begin
    if :new.CCenter is null then
        :new.CCenter := 0;
    end if;

    if :new.Active is null then
        :new.Active := 1;
    end if;

    if :new.OpenForReg is null then
        :new.OpenForReg := 1;
    end if;

    if :new.NoRegReqd is null then
        :new.NoRegReqd := 0;
    end if;

    if :new.Cancelled is null then
        :new.Cancelled := 0;
    end if;

    if :new.Hidden is null then
        :new.Hidden := 0;
    end if;

    if :new.Private is null then
        :new.Private := 0;
    end if;

    if :new.IsDeleted is null then
        :new.IsDeleted := 0;
    end if;

    if :new.UseForConflictCheck is null then
        :new.UseForConflictCheck := 1;
    end if;

    if :new.OwnerEmpFK is null then
        :new.OwnerEmpFK := -1;
    end if;

    if :new.CanBeCopied is null then
        :new.CanBeCopied := 0;
    end if;

    if :new.CanBeSubscr is null then
        :new.CanBeSubscr := 0;
    end if;

    if :new.CanBeFul is null then
        :new.CanBeFul := 0;
    end if;

    if :new.RequiredInd is null then
        :new.RequiredInd := 0;
    end if;

    if :new.PickRuleType is null then
        :new.PickRuleType := 3;
    end if;

    if :new.UseType is null then
        :new.UseType := 0;
    end if;

    if :new.Restricted is null then
        :new.Restricted := 0;
    end if;

    if :new.ContributeRollupInd is null then
        :new.ContributeRollupInd := 1;
    end if;

    if :new.SendActCompleteNTF is null then
        :new.SendActCompleteNTF := 1;
    end if;

    if :new.SendActReminderNTF is null then
        :new.SendActReminderNTF := 1;
    end if;

    if :new.SendActRegNTF is null then
        :new.SendActRegNTF := 1;
    end if;

    if :new.HdnFrmTranscript is null then
        :new.HdnFrmTranscript := 0;
    end if;

    if :new.ToStagingDt is null then
        :new.ToStagingDt := getutcdate();
    end if;

    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

    if :new.Lck is null then
        :new.Lck := 0;
    end if;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER TR_BU_TBL_TMX_ACTIVITY
before update on TBL_TMX_Activity
for each row
begin
    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tU_Activity_1
BEFORE UPDATE OF PrntActFK, Ordinal ON TBL_TMX_Activity
BEGIN
   IF NOT Core_Trigger.trig_activityupd_running AND NOT Core_Trigger.trig_activityins_running THEN
      Core_Trigger.activityupd_clear;
   END IF;
END tU_Activity_1;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tU_Activity_2
BEFORE UPDATE OF PrntActFK, Ordinal ON TBL_TMX_Activity
FOR EACH ROW
BEGIN
   IF NOT Core_Trigger.trig_activityupd_running AND NOT Core_Trigger.trig_activityins_running THEN
      Core_Trigger.activityupd_add(:OLD.Activity_PK, :OLD.PrntActFK, :OLD.Ordinal, :OLD.LevelVal, 
:OLD.RootActivityFK,
                                   :NEW.Activity_PK, :NEW.PrntActFK, :NEW.Ordinal, :NEW.LevelVal, 
:NEW.RootActivityFK);
   END IF;
END tU_Activity_2;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tU_Activity_3
AFTER UPDATE OF PrntActFK, Ordinal ON TBL_TMX_Activity
BEGIN
   IF NOT Core_Trigger.trig_activityupd_running AND NOT Core_Trigger.trig_activityins_running THEN
      Core_Trigger.activityupd_process;
   END IF;
END tU_Activity_3;
/
SHOW ERRORS;



ALTER TABLE TBL_TMX_ACTIVITY ADD (
  CONSTRAINT PK_TBL_TMX_ACTIVITY
 PRIMARY KEY
 (ACTIVITY_PK)
    USING INDEX);


ALTER TABLE TBL_TMX_ACTIVITY ADD (
  CONSTRAINT FK_ACTIVITYLABELFK_5REEVH0A 
 FOREIGN KEY (ACTIVITYLABELFK) 
 REFERENCES ACTLABEL (ACTLABEL_PK)
    ON DELETE SET NULL);

ALTER TABLE TBL_TMX_ACTIVITY ADD (
  CONSTRAINT FK_DEFAPPREMPFK_5REEVH0C 
 FOREIGN KEY (DEFAPPREMPFK) 
 REFERENCES TBLEMP (EMP_PK)
    ON DELETE SET NULL);

ALTER TABLE TBL_TMX_ACTIVITY ADD (
  CONSTRAINT FK_OWNEREMPFK_5REEVH0B 
 FOREIGN KEY (OWNEREMPFK) 
 REFERENCES TBLEMP (EMP_PK)
    ON DELETE SET NULL);

PROMPT &quot;Table TBL_TMX_ACTIVITY  End &quot;

PROMPT &quot;Table INST Start&quot;

CREATE TABLE INST
(
  INST_PK           NUMBER(10)                  NOT NULL,
  INST_VENFK        NUMBER(10),
  INST_NO           VARCHAR2(75 BYTE),
  INST_TTL          VARCHAR2(150 BYTE),
  INST_LNAME        VARCHAR2(105 BYTE)          NOT NULL,
  INST_FNAME        VARCHAR2(105 BYTE)          NOT NULL,
  INST_TITLE        VARCHAR2(105 BYTE),
  INST_MI           VARCHAR2(105 BYTE),
  INST_SUFFIX       VARCHAR2(15 BYTE),
  INST_STARTDT      DATE,
  INST_FULLNAME     VARCHAR2(1536 BYTE),
  INST_ADD1         VARCHAR2(150 BYTE),
  INST_ADD2         VARCHAR2(150 BYTE),
  INST_INTERNALIND  NUMBER(1)                   NOT NULL,
  INST_CITY         VARCHAR2(90 BYTE),
  INST_STATE        VARCHAR2(105 BYTE),
  INST_CNTRY        VARCHAR2(105 BYTE),
  INST_ZIP          VARCHAR2(60 BYTE),
  INST_EMAIL        VARCHAR2(768 BYTE),
  INST_PHN1         VARCHAR2(90 BYTE),
  INST_PHN2         VARCHAR2(90 BYTE),
  INST_FAX          VARCHAR2(90 BYTE),
  INST_URL          VARCHAR2(765 BYTE),
  INST_NOTE         CLOB,
  INST_LSTUPD       DATE                        NOT NULL,
  INST_USRNAME      VARCHAR2(90 BYTE)           NOT NULL,
  INST_LCK          NUMBER(10)                  NOT NULL,
  INST_EMPFK        NUMBER(10),
  INST_TIMESTAMP    NUMBER(10),
  INST_TIMEZONEFK   NUMBER(10)
);

CREATE INDEX FT_TABLE_GVRRF12M ON INST
(INST_NO)
INDEXTYPE IS CTXSYS.CONTEXT
PARAMETERS('lexer aspen_lexer storage aspen_storage stoplist aspen_stoplist');


CREATE INDEX FT_TABLE_GVRRF12N ON INST
(INST_LNAME)
INDEXTYPE IS CTXSYS.CONTEXT
PARAMETERS('lexer aspen_lexer storage aspen_storage stoplist aspen_stoplist');


CREATE INDEX FT_TABLE_GVRRF12O ON INST
(INST_FNAME)
INDEXTYPE IS CTXSYS.CONTEXT
PARAMETERS('lexer aspen_lexer storage aspen_storage stoplist aspen_stoplist');


CREATE INDEX FT_TABLE_GVRRF12P ON INST
(INST_FULLNAME)
INDEXTYPE IS CTXSYS.CONTEXT
PARAMETERS('lexer aspen_lexer storage aspen_storage stoplist aspen_stoplist');


CREATE UNIQUE INDEX PK_INST ON INST
(INST_PK);


CREATE INDEX IDX_INST_3W0DYX1Z ON INST
(INST_LNAME);


CREATE INDEX IDX_INST_3W0DYX20 ON INST
(INST_FNAME);


CREATE INDEX IDX_INST_3W0DYX21 ON INST
(INST_EMPFK, INST_PK);


CREATE OR REPLACE TRIGGER tD_Inst_1
BEFORE DELETE ON inst
BEGIN
     Core_Trigger.Inst_clear;
END tD_Inst_1;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tD_Inst_2
BEFORE DELETE ON inst
FOR EACH ROW
BEGIN
  core_trigger.Inst_Add(:OLD.Inst_EmpFK);
END tD_inst_2;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tD_Inst_3
  AFTER DELETE ON Inst
BEGIN
    -- Delete Instructors from VCS tables

   Core_Trigger.Inst_process;

END tD_Inst_3;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER TR_BI_INST
before insert on Inst
for each row
begin
    if :new.Inst_InternalInd is null then
        :new.Inst_InternalInd := 0;
    end if;

    :new.Inst_LstUpd := GetUTCDate;

    :new.Inst_UsrName := Core_AUD.current_user;

    if :new.Inst_Lck is null then
        :new.Inst_Lck := 0;
    end if;

    if :new.Inst_EmpFK is null then
        :new.Inst_EmpFK := null;
    end if;

    if :new.Inst_InternalInd is null then
        :new.Inst_InternalInd := 0;
    elsif :new.Inst_InternalInd != 0 then
        :new.Inst_InternalInd := 1;
    end if;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER TR_BU_INST
before update on Inst
for each row
begin
    :new.Inst_LstUpd := GetUTCDate;

    :new.Inst_UsrName := Core_AUD.current_user;

    if :new.Inst_InternalInd is null then
        :new.Inst_InternalInd := 0;
    elsif :new.Inst_InternalInd != 0 then
        :new.Inst_InternalInd := 1;
    end if;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER tr_inst_search
  BEFORE INSERT OR UPDATE OF inst_fname, inst_mi, inst_lname, inst_no, inst_email ON inst
  FOR EACH ROW
BEGIN

   -- This is used for searching on multiple columns at once.
   -- We're using this method instead of a multi_column_datastore so that
   -- the method is the same in both Oracle and SQL Server

   -- This concatenates each field, if it exists, with a blank

   :NEW.Inst_FullName := SUBSTR(TRIM(TRIM(TRIM(TRIM(:NEW.Inst_FName||' '||:NEW.Inst_MI)||' 
'||:NEW.Inst_LName)||' '||:NEW.Inst_No)||' '||:NEW.Inst_EMail),1,1536);
END tr_inst_search;
/
SHOW ERRORS;



ALTER TABLE INST ADD (
  CONSTRAINT PK_INST
 PRIMARY KEY
 (INST_PK)
    USING INDEX);


ALTER TABLE INST ADD (
  CONSTRAINT FK_INST_EMPFK_1BUPEN23 
 FOREIGN KEY (INST_EMPFK) 
 REFERENCES TBLEMP (EMP_PK)
    ON DELETE CASCADE);

ALTER TABLE INST ADD (
  CONSTRAINT FK_INST_TIMEZONEFK_1BUPEN21 
 FOREIGN KEY (INST_TIMEZONEFK) 
 REFERENCES TBL_LMS_TIMEZONE (TIMEZONE_PK)
    ON DELETE SET NULL);

ALTER TABLE INST ADD (
  CONSTRAINT FK_INST_VENFK_1BUPEN22 
 FOREIGN KEY (INST_VENFK) 
 REFERENCES VEN (VEN_PK)
    ON DELETE SET NULL);

PROMPT &quot;Table INST  End &quot;
 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>Hitting ORA-00942 ...</b>
&nbsp;&nbsp;December  09, 2005
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#53046988907850">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="53046988907850">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>VKOUL</b>&nbsp;from WA, USA</div>
</div>
<pre>********************************************************
PART 3
********************************************************

PROMPT &quot;Table TBL_TMX_ACTINST Start&quot;

CREATE TABLE TBL_TMX_ACTINST
(
  ACTIVITYFK     NUMBER(10)                     NOT NULL,
  INSTFK         NUMBER(10)                     NOT NULL,
  PRIMARYIND     NUMBER(10)                     NOT NULL,
  INSTTYPE       NUMBER(10)                     NOT NULL,
  ISQUALIFIED    NUMBER(10)                     NOT NULL,
  ISRESPONSIBLE  NUMBER(10)                     NOT NULL,
  CONFIRMED      NUMBER(10)                     NOT NULL,
  INHERITED      NUMBER(10)                     NOT NULL,
  APPRNOTES      CLOB,
  APPRTIME       DATE,
  APPROVERFK     NUMBER(10),
  LSTUPD         DATE                           NOT NULL,
  USRNAME        VARCHAR2(90 BYTE)              NOT NULL,
  LCK            NUMBER(10)                     NOT NULL
);

CREATE UNIQUE INDEX PK_TBL_TMX_ACTINST ON TBL_TMX_ACTINST
(ACTIVITYFK, INSTFK);


CREATE INDEX IDX_TMX_ACTINST_AB8CHW29 ON TBL_TMX_ACTINST
(INSTFK, ACTIVITYFK);


CREATE OR REPLACE TRIGGER TR_BI_TBL_TMX_ACTINST
before insert on TBL_TMX_ActInst
for each row
begin
    if :new.InstFK is null then
        :new.InstFK := -1;
    end if;

    if :new.PrimaryInd is null then
        :new.PrimaryInd := 0;
    end if;

    if :new.InstType is null then
        :new.InstType := 1;
    end if;

    if :new.IsQualified is null then
        :new.IsQualified := 1;
    end if;

    if :new.IsResponsible is null then
        :new.IsResponsible := 1;
    end if;

    if :new.Confirmed is null then
        :new.Confirmed := 0;
    end if;

    if :new.Inherited is null then
        :new.Inherited := 0;
    end if;

    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

    if :new.Lck is null then
        :new.Lck := 0;
    end if;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER TR_BU_TBL_TMX_ACTINST
before update on TBL_TMX_ActInst
for each row
begin
    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

end;
/
SHOW ERRORS;

ALTER TABLE TBL_TMX_ACTINST ADD (
  CONSTRAINT PK_TBL_TMX_ACTINST
 PRIMARY KEY
 (ACTIVITYFK, INSTFK)
    USING INDEX);

ALTER TABLE TBL_TMX_ACTINST ADD (
  CONSTRAINT FK_ACTIVITYFK_5REEVH1E 
 FOREIGN KEY (ACTIVITYFK) 
 REFERENCES TBL_TMX_ACTIVITY (ACTIVITY_PK)
    ON DELETE CASCADE);

ALTER TABLE TBL_TMX_ACTINST ADD (
  CONSTRAINT FK_APPROVERFK_5REEVH1G 
 FOREIGN KEY (APPROVERFK) 
 REFERENCES TBLEMP (EMP_PK)
    ON DELETE SET NULL);

ALTER TABLE TBL_TMX_ACTINST ADD (
  CONSTRAINT FK_INSTFK_5REEVH1F 
 FOREIGN KEY (INSTFK) 
 REFERENCES INST (INST_PK)
    ON DELETE CASCADE);

PROMPT &quot;Table TBL_TMX_ACTINST  End &quot;

PROMPT &quot;Table TBLEMPBUSY Start&quot;

CREATE TABLE TBLEMPBUSY
(
  EMPBUSY_PK            NUMBER(10)              NOT NULL,
  EMPBUSY_EMPFK         NUMBER(10)              NOT NULL,
  EMPBUSY_STARTDT       DATE                    NOT NULL,
  EMPBUSY_STARTTM       DATE                    NOT NULL,
  EMPBUSY_ENDDT         DATE                    NOT NULL,
  EMPBUSY_ENDTM         DATE                    NOT NULL,
  EMPBUSY_DESC          CLOB,
  EMPBUSY_SUBJECT       VARCHAR2(150 BYTE),
  EMPBUSY_LSTUPD        DATE                    NOT NULL,
  EMPBUSY_USRNAME       VARCHAR2(90 BYTE)       NOT NULL,
  EMPBUSY_LCK           NUMBER(10)              NOT NULL,
  EMPBUSY_TIMEZONEFK    NUMBER(10),
  TBLEMPBUSY_TIMESTAMP  NUMBER(10)
);

CREATE INDEX FT_TABLE_U7NBNT0A ON TBLEMPBUSY
(EMPBUSY_SUBJECT)
INDEXTYPE IS CTXSYS.CONTEXT
PARAMETERS('lexer aspen_lexer storage aspen_storage stoplist aspen_stoplist');


CREATE UNIQUE INDEX PK_TBLEMPBUSY ON TBLEMPBUSY
(EMPBUSY_PK);


CREATE INDEX IDX_TBLEMPBUSY_4LOSH813 ON TBLEMPBUSY
(EMPBUSY_STARTDT);


CREATE INDEX IDX_TBLEMPBUSY_4LOSH814 ON TBLEMPBUSY
(EMPBUSY_EMPFK);


CREATE OR REPLACE TRIGGER TR_BI_TBLEMPBUSY
before insert on tblEmpBusy
for each row
begin
    :new.EmpBusy_LstUpd := GetUTCDate;

    :new.EmpBusy_UsrName := Core_AUD.current_user;

    if :new.EmpBusy_Lck is null then
        :new.EmpBusy_Lck := 0;
    end if;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER TR_BU_TBLEMPBUSY
before update on tblEmpBusy
for each row
begin
    :new.EmpBusy_LstUpd := GetUTCDate;

    :new.EmpBusy_UsrName := Core_AUD.current_user;

end;
/
SHOW ERRORS;



ALTER TABLE TBLEMPBUSY ADD (
  CONSTRAINT PK_TBLEMPBUSY
 PRIMARY KEY
 (EMPBUSY_PK)
    USING INDEX);


ALTER TABLE TBLEMPBUSY ADD (
  CONSTRAINT FK_EMPBUSY_EMPFK_F99PXX02 
 FOREIGN KEY (EMPBUSY_EMPFK) 
 REFERENCES TBLEMP (EMP_PK)
    ON DELETE CASCADE);

ALTER TABLE TBLEMPBUSY ADD (
  CONSTRAINT FK_EMPBUSY_TIMEZONEFK_F99PXX03 
 FOREIGN KEY (EMPBUSY_TIMEZONEFK) 
 REFERENCES TBL_LMS_TIMEZONE (TIMEZONE_PK)
    ON DELETE SET NULL);

PROMPT &quot;Table TBLEMPBUSY  End &quot;

PROMPT &quot;Table TBL_TMX_REGBATCHACTIVITIES Start&quot;

CREATE TABLE TBL_TMX_REGBATCHACTIVITIES
(
  REGBATCHFK        NUMBER(10)                  NOT NULL,
  ACTIVITYFK        NUMBER(10)                  NOT NULL,
  TRACKFK           NUMBER(10)                  NOT NULL,
  SELECTED          NUMBER(10)                  NOT NULL,
  VALIDATED         NUMBER(10)                  NOT NULL,
  REGISTERED        NUMBER(10)                  NOT NULL,
  CREDITCARDNEEDED  NUMBER(10)                  NOT NULL,
  LSTUPD            DATE                        NOT NULL,
  USRNAME           VARCHAR2(90 BYTE)           NOT NULL,
  LCK               NUMBER(10)                  NOT NULL
);


CREATE INDEX IDX_TMX_REGBATCHACTIV_Z2NRX328 ON TBL_TMX_REGBATCHACTIVITIES
(REGBATCHFK, ACTIVITYFK, VALIDATED);


CREATE UNIQUE INDEX PK_TBL_TMX_REGBATCHACTIVITIES ON TBL_TMX_REGBATCHACTIVITIES
(REGBATCHFK, ACTIVITYFK, TRACKFK);


CREATE INDEX IDX_TMX_REGBATCHACTIV_WWUD2S1U ON TBL_TMX_REGBATCHACTIVITIES
(REGBATCHFK);


CREATE INDEX IDX_TMX_REGBATCHACTIV_WWUD2S1V ON TBL_TMX_REGBATCHACTIVITIES
(ACTIVITYFK);


CREATE INDEX IDX_TMX_REGBATCHACTIV_WWUD2S1W ON TBL_TMX_REGBATCHACTIVITIES
(TRACKFK);


CREATE OR REPLACE TRIGGER TR_BI_TBL_TMX_REGBATC_K92F6J22
before insert on TBL_TMX_RegBatchActivities
for each row
begin
    if :new.Selected is null then
        :new.Selected := 0;
    end if;

    if :new.Validated is null then
        :new.Validated := 0;
    end if;

    if :new.Registered is null then
        :new.Registered := 0;
    end if;

    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

    if :new.Lck is null then
        :new.Lck := 0;
    end if;

end;
/
SHOW ERRORS;



CREATE OR REPLACE TRIGGER TR_BU_TBL_TMX_REGBATC_K92F6J22
before update on TBL_TMX_RegBatchActivities
for each row
begin
    :new.LstUpd := GetUTCDate;

    :new.UsrName := Core_AUD.current_user;

end;
/
SHOW ERRORS;



ALTER TABLE TBL_TMX_REGBATCHACTIVITIES ADD (
  CONSTRAINT PK_TBL_TMX_REGBATCHACTIVITIES
 PRIMARY KEY
 (REGBATCHFK, ACTIVITYFK, TRACKFK)
    USING INDEX);


ALTER TABLE TBL_TMX_REGBATCHACTIVITIES ADD (
  CONSTRAINT FK_ACTIVITYFK_GVRRF10T 
 FOREIGN KEY (ACTIVITYFK) 
 REFERENCES TBL_TMX_ACTIVITY (ACTIVITY_PK)
    ON DELETE CASCADE);

ALTER TABLE TBL_TMX_REGBATCHACTIVITIES ADD (
  CONSTRAINT FK_REGBATCHFK_GVRRF10S 
 FOREIGN KEY (REGBATCHFK) 
 REFERENCES TBL_TMX_REGBATCH (REGBATCH_PK)
    ON DELETE CASCADE);

ALTER TABLE TBL_TMX_REGBATCHACTIVITIES ADD (
  CONSTRAINT FK_TRACKFK_GVRRF10U 
 FOREIGN KEY (TRACKFK) 
 REFERENCES TBL_TMX_REGTRACK (TRACK_PK)
    ON DELETE CASCADE);

PROMPT &quot;Table TBL_TMX_REGBATCHACTIVITIES  End &quot;

SELECT object_type, COUNT(*)
FROM   user_objects
GROUP  BY object_type;

/*
The Output Should Match
OBJECT_TYPE          COUNT(*)
------------------ ----------
FUNCTION                    1
INDEX                      68
LOB                        12
TABLE                       7
TRIGGER                    31
TYPE                        1

6 rows selected.
*/
********************************************************

Now the Query

WITH emps
AS
(
 SELECT CAST(column_value AS INTEGER) AS EmpId
 FROM   TABLE(CAST(str2tbl('1,2,3') AS COMMA_LIST))
 UNION  ALL
 SELECT EmpFK AS EmpId
 FROM   TBL_TMX_RegBatchUsers t1
 WHERE  RegBatchFK =  1
 AND    EmpAdded   =  1
)
SELECT 1,
       conflicts.EmpId,
       times.ActId,
       4,
       1,
       1,
       conflicts.ConflictName,
       conflicts.BusyId
FROM   (SELECT att.EmpFK AS EmpId,
               act.Activity_PK AS BusyId,
               act.ActivityName AS ConflictName,
               act.StartDt AS StartTm,
               act.EndDt AS EndTm
        FROM   Emps
        INNER  JOIN TBL_TMX_Attempt att  ON att.EmpFK = Emps.EmpID
                                         AND att.EndDt IS NULL
        INNER  JOIN TBL_TMX_Activity act ON act.Activity_PK = att.ActivityFK
                                         AND act.UseForConflictCheck =  1
                                         AND act.Cancelled =  0
        WHERE  NOT EXISTS (SELECT NULL
                           FROM   TBL_TMX_Activity xAct
                           WHERE  xAct.PrntActFK = act.Activity_PK
                          )
        UNION  ALL
        SELECT inst.Inst_EmpFK AS EmpId,
               act.Activity_PK AS BusyId,
               act.ActivityName AS ConflictName,
               act.StartDt AS StartTm,
               act.EndDt AS EndTm
        FROM   Emps
        INNER  JOIN inst                    ON inst.Inst_EmpFK = Emps.EmpID
        INNER  JOIN TBL_TMX_ActInst actinst ON actinst.InstFK = inst.Inst_PK
                                            AND actinst.Confirmed =  1
        INNER  JOIN TBL_TMX_Activity act    ON act.Activity_PK = actinst.ActivityFK
                                            AND act.UseForConflictCheck =  1
                                            AND act.Cancelled =  0
        WHERE  NOT EXISTS (SELECT NULL
                           FROM   TBL_TMX_Activity xAct
                           WHERE  xAct.PrntActFK = act.Activity_PK
                          )
        UNION  ALL
        SELECT EmpBusy.EmpBusy_EmpFK   AS EmpId,
               NULL                    AS BusyId,
               EmpBusy.EmpBusy_Subject AS ConflictName,
               EmpBusy.EmpBusy_StartDt AS StartTm,
               EmpBusy.EmpBusy_EndDt   AS EndTm
        FROM   Emps
        INNER  JOIN tblEmpBusy EmpBusy ON EmpBusy.EmpBusy_EmpFK = Emps.EmpID
       ) conflicts
INNER  JOIN (SELECT act.Activity_PK AS ActId, act.StartDt AS StartTm, act.EndDt AS EndTm
             FROM   TBL_TMX_RegBatchActivities rba
             INNER  JOIN TBL_TMX_Activity act ON act.Activity_PK = rba.ActivityFK AND 
act.UseForConflictCheck =  1 AND act.Cancelled =  0
             WHERE  rba.RegBatchFK = 1 AND rba.Validated =  0
            ) times
ON     times.EndTm   &gt; conflicts.StartTm
AND    times.StartTm &lt; conflicts.EndTm
/
 </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>REGEXP_INSTR</b>
&nbsp;&nbsp;January   11, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#54797294961799">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="54797294961799">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Hi Tom

I wanted to extract one character from a string preceded and followed by space 

like from Tom H kyte

I want to separate H into middle name 
tom into first name and kyte into last name 

using REGEXP_INSTR function as I cant use ' ' for space inside ' '

This eg will not do
select regexp_instr('Tom H kyte','^(' '+[A-Z]+' ')',1,1)  from dual;

so what should i do for finding space.
Thanks 
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom54797294961799"></a>
<pre>why not just use instr?  to find a space would be very easy with just instr </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
<b>regexp_instr</b>
&nbsp;&nbsp;January   11, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#54801851336947">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="54801851336947">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Hi 

I am able to that with :blank

Thanks </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>whu not just instr</b>
&nbsp;&nbsp;January   12, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#54877547558186">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="54877547558186">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>jasdeep</b>&nbsp;</div>
</div>
<pre>Hi Tom 

I was not able to solve how could I write Sql to find 
space -- one charater -- then space.

Then I came to know about this new function in 10g and was able to write the sql.

It will appreciative of you if you can give insight writing it with only instr. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom54877547558186"></a>
<pre>you asked &quot;so what should i do for finding space.&quot; - my response: instr

instr will find a space, that was the question I was addressing.  </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>String dissection into columns</b>
&nbsp;&nbsp;January   24, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#55693929628700">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="55693929628700">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Praveen</b>&nbsp;from Bangalore</div>
</div>
<pre>Hi Tom

In a table column, variable length strings of the format

A:1,B:2,C:3,... Z:26. --26 is the maximum.

Need the output in the form

col1    col2
------------
A     1
B    2
C    3
.......
Z    26

I was using a pipelined function but take very long time.

The number of records is about 4million.

Any work around without calling any function, but only using a single SQL query.

Thanks
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom55693929628700"></a>
<pre>well, if you have 4million input records and each has upto 26 &quot;rows&quot; embedded in them, it could 
take &quot;a while&quot;

how long is &quot;long&quot; and what do you actually DO with this output and how efficient is the plsql you 
have written? </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Re:String dissection into columns</b>
&nbsp;&nbsp;February  01, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#56222129143977">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="56222129143977">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Praveen</b>&nbsp;from Bangalore</div>
</div>
<pre>The function is 'cutting' out substrings of length 14 each from the input string (whose length is a 
multiple of 14) and 'pipes' it out as a 'record' to the calling SQL statement. The function is 
doing the same thing as the below written query is doing.

SELECT * FROM (
SELECT SUBSTR(str,1,14) ITEM, A.* FROM Table1 A 
UNION ALL 
SELECT SUBSTR(str,15,14) ITEM, A.* FROM Table1 A 
UNION ALL 
SELECT SUBSTR(str,29,14) ITEM, A.* FROM Table1 A 
UNION ALL 
SELECT SUBSTR(str,43,14) ITEM, A.* FROM Table1 A 
UNION ALL 
SELECT SUBSTR(str,57,14) ITEM, A.* FROM Table1 A 
UNION ALL 
SELECT SUBSTR(str,71,14) ITEM, A.* FROM Table1 A 
......upto 26 times
) WHERE ITEM IS NOT NULL;


But inside the function, I use a few condition checks to filter out certain records, while 
determining the values of a few other columns, which will be difficult to handled in the above 
query.

The output from this pipelined table function is then joined with another table of size 2.5 million 
and the resulting data are /*+APPEND NOLOGGING*/ into a temporary table.

The total number of records that the temporary table will finally contain is about 26 million.

The whole loading process with the pipelined function will take about 5 hours. Our expected time is 
less than 1 hour. </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Sorry,  *Question*  for the above follow-up.</b>
&nbsp;&nbsp;February  01, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#56222698237981">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="56222698237981">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Praveen</b>&nbsp;from Bangalore</div>
</div>
<pre>Do you think that, in the above scenario, since the function is not doing too much of processing 
within it, shouldn't it execute in nearly the same time as a single query? Well, if i use the query 
given above, instead of the function (less all the additional computations), it will take me only 
less than half an hour to load 26 million records. And the function (less all the additional 
computations) is going beyond 5 hours!

Thanks &amp; Regards </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom56222698237981"></a>
<pre>you yourself said you are doing more in the procedure than you are in the sql query we are looking 
at.

hard to say - don't know what all you are doing in the function.

But I've always said, if you can do it in SQL - do it in SQL, only use PLSQL or any procedural 
language when you cannot do it in SQL straight.


I cannot imagine any &quot;filter&quot; that plsql would be able to do better than SQL? </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>reader</b>
&nbsp;&nbsp;February  23, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#57731651863002">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="57731651863002">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Is there a way to search two strings, for a match of
2 adjacent characters from one string to an another
I like to use it in a SQL statement (not PL/SQL)

Example:
abcdefghij
1234cd5678

Here we are trying to match 
ab cd ef gh ij
with any of
12 34 cd 56 78

Thanks </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom57731651863002"></a>
<pre>I don't get it. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>reader</b>
&nbsp;&nbsp;February  23, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#57737452357066">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="57737452357066">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Within the SQL statement , I like to concatenate
6 columns from one table and concatenate 6 columns from
another table. In the where clause, I try to check if
any one of the column in one table match anyone of the 
column in another table ( I did not create this table or
its semantic logic) Each column is 2 characters long
 
Is there a way to search two concatenated strings, for a match of 2 adjacent characters from one 
string to an another
I like to use this method within SQL statement (not PL/SQL)

Example:
abcdefghij
1234cd5678

Here we are trying to match any 2 chars from one string to any 2 chars from another string

ab cd ef gh ij &lt;=== match any of this
with any of
12 34 cd 56 78 &lt;=== with any of this

In this particilar case there is a match, because
&quot;cd&quot; occurs in both strings

Hope this explanation is clearer

Thanks 

 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom57737452357066"></a>
<pre>you'll have to substr out the bits that are the real columns and compare them.

where c1 like '%'||substr(c2,1,2)||'%'
   or c1 like '%'||substr(c2,3,2)||'%'
   ......
   or c1 like '%'||substr(c2,9,2)||'%';



 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>A solution to A reader</b>
&nbsp;&nbsp;February  23, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#57769340706197">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="57769340706197">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Michel Cadot</b>&nbsp;from France</div>
</div>
<pre>SQL&gt; select * from t;
        ID C1         C2
---------- ---------- ----------
         1 abcdefghij 1234cd5678
         2 klmnopqrst 1234567890

2 rows selected.

SQL&gt; with 
  2    a as ( select id, c2,
  3                  substr(c1, 1+rn*2, 2) ch
  4           from t, (select rownum-1 rn from dual connect by level &lt;= 10/2)
  5           where substr(c1, 1+rn*2, 2) is not null )
  6  select id, 
  7         max(decode(instr(c2,ch),0,'No','Yes')) match
  8  from a
  9  group by id
 10  order by id
 11  /
        ID MAT
---------- ---
         1 Yes
         2 No

2 rows selected.

(10 is c1 max length)

Regards
Michel </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom57769340706197"></a>
<pre>I like my where clause better personally.  This is a tad obscure and will not perform as well for 
larger sets (since it makes them even larger) </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Followup</b>
&nbsp;&nbsp;February  24, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#57796257338221">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="57796257338221">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Michel Cadot</b>&nbsp;from France</div>
</div>
<pre>You're fully right Tom but your where clause only works if all C1 values have a fixed known length.
If you imagine one C1 value smaller then the last condition &quot;c1 like '%'||substr(c2,9,2)||'%'&quot; 
becomes &quot;c1 like '%%'&quot; which will always return TRUE.
This thought leads me to my query (and the desire to write a generic query that does not need to 
know the value max length; and generic query is one of the best way to get a bad performance 
query).

Oh yes, you can add &quot;and substr(c2,?,2) is not null&quot; to each condition in your query... :)

Regards
Michel
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom57796257338221"></a>
<pre>I read:

I like to concatenate 6 columns from one table and concatenate 6 columns


and sort of figured &quot;6&quot;. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>LOL</b>
&nbsp;&nbsp;February  24, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#57842574819763">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="57842574819763">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Michel Cadot</b>&nbsp;from France</div>
</div>
<pre>You're right Tom, you perfectly read 6 columns and you perfectly saw his example contains only 10 
characters as you stopped your conditions to substr(c2,9,2) (why not 11?). ;)

Well, I should begin my post with &quot;to extend the case to an unknow number of characters...&quot;.

And once again, you're right my query can be a performance nightmare with millions of rows as it 
multiplies them by half c1 max length.

Best regards
Michel </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom57842574819763"></a>
<pre>Michel -

thanks for all of the really interesting SQL solutions though.  Some of your examples have been 
outstanding.

I'm almost afraid to say &quot;I don't see a clear way to do that in SQL&quot; anymore :) Knowing you'll come 
along with something.... (thanks) </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Thanks!</b>
&nbsp;&nbsp;February  24, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#57851440687631">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="57851440687631">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Michel Cadot</b>&nbsp;from France</div>
</div>
<pre>Thanks for the compliment and above all thanks to you not only for this site but also for your 
articles in Oracle Magazine as i started to understand the analytic functions and their power in 
one of them 2 years ago.

</pre> <pre><a href="http://www.oracle.com/technology/oramag/oracle/04-mar/o24asktom.html">http://www.oracle.com/technology/oramag/oracle/04-mar/o24asktom.html</a></pre> <pre>
Regards
Michel </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>column matching ?!?!</b>
&nbsp;&nbsp;February  24, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#57865956292094">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="57865956292094">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Gabe</b>&nbsp;</div>
</div>
<pre>Well, both your solution and Michels do report this entry ('cdcdcdcdcd','dcdcdcdcdc') as a hit.

&lt;quote&gt;In the where clause, I try to check if any one of the column in one table match anyone of 
the column in another table&lt;/quote&gt;

So that would be a false positive.

decode(mod(instr(c2,ch),2),0,'No','Yes') in Michels query would fix that; or 

select * from t
where mod(instr(c1,substr(c2,1,2)),2) = 1
   or mod(instr(c1,substr(c2,3,2)),2) = 1
   or mod(instr(c1,substr(c2,5,2)),2) = 1
   or mod(instr(c1,substr(c2,7,2)),2) = 1
   or mod(instr(c1,substr(c2,9,2)),2) = 1
;
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom57865956292094"></a>
<pre>indeed, thanks! </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>column matching ?!?!  </b>
&nbsp;&nbsp;February  25, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#57869840199949">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="57869840199949">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Michel Cadot</b>&nbsp;from France</div>
</div>
<pre>
You're right.
Thanks for the correction.

Regards
Michel </pre> <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>parsing multiple lines</b>
&nbsp;&nbsp;April     17, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#61901374837502">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="61901374837502">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>karma</b>&nbsp;from TX</div>
</div>
<pre>we have millions of addresses that needs to be standardized. For example we have 3 columns addr_1, 
addr_2 and addr_3. sometime addr_1 could have P.O.BOX or Post office Box etc. and any variations of 
this. How to efficiently parse and standardised ? Also, how to clean when they span on multiple 
addr lines? </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom61901374837502"></a>
<pre>in OWB (Oracle Warehouse Builder) such a bit of rather complex functionality exists.

In many ETL (extract/transform/load) tools - such complex functionality (normalization of 
addresses) exists.

In fact,  you are best off getting a 3rd party list of valid addresses (many sources) and using a 
tool to do this.

if you google about for

&quot;address cleansing&quot;

you'll find an entire industry built around address cleansing. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>counting  comma separated words</b>
&nbsp;&nbsp;June      14, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#66066092423797">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="66066092423797">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Rima</b>&nbsp;from MN usa</div>
</div>
<pre>We have a field that stores strings like so : '01,02,03,04,05,99'. The number of elements in the 
comma separated list is variable. 

What is the best way to count the elements using SQL?

We tried something like this which doesnt seem to work for the above example :

SELECT NVL(LENGTH(TRANSLATE(text, ',' || text, ',')),0) + 1 
                INTO n_code_qty 
                FROM dual;

Thanks,
Rima. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom66066092423797"></a>
<pre>ops$tkyte@ORA10GR2&gt; select length(s)-length(replace(s,',',''))
  2  from (select '01,02,03,04,05,99' s from dual);

LENGTH(S)-LENGTH(REPLACE(S,',',''))
-----------------------------------
                                  5
 </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Hello Tom, I am stuck and was hoping that you can help me out.</b>
&nbsp;&nbsp;July      20, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#68465796559216">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="68465796559216">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Evan Song</b>&nbsp;from Seattle, WA USA</div>
</div>
<pre>Hi,

I am newbie to Oracle and I am really confused about this problem.
Well, I read through this forum and copied out StrToTable function and tried from SQL+ and works 
fine; however, when I added the function to the package... it gives me a wierd error.
Here's what I did.

Package name = M_Pkg
In Spec:
 TYPE myTableType IS TABLE OF M_Box.BOXNO%Type;

 FUNCTION StrToTable(boxes IN VARCHAR2) RETURN myTableType;

 PROCEDURE CheckAllTheBoxes_Proc(allTheBoxes IN VARCHAR2,
     boxesFound OUT INTEGER);


In Body:
FUNCTION StrToTable(boxes in varchar2) RETURN myTableType
AS
l_str long default boxes || ',';
l_data myTableType := myTableType();
l_n number;
begin
 loop
  exit when l_str is null;
  l_n := instr(l_str, ',');
  l_data.extend;
  l_data(l_data.count) := ltrim(rtrim(substr(l_str,1,l_n-1)));
  l_str := substr(l_str, l_n+1);
 end loop;
 return l_data;
end StrToTable;


PROCEDURE CheckAllTheBoxes_Proc(allTheBoxes IN VARCHAR2,
     boxesFound OUT INTEGER)
IS
testTable myTableType;
BEGIN
  testTable := StrToTable(allTheBoxes);
  SELECT COUNT(a.ID) INTO boxesFound FROM BT_Box a WHERE a.BOXNO IN (select * from THE testTable);
END CheckAllTheBoxes_Proc;

And when I compiled this package, it gave me PL/SQL: ORA-00942: table or view does not exist for 
&quot;testTable&quot;.
So, I've tried using the pipelined as follow.

In Spec:
 FUNCTION StrToTable(boxes IN VARCHAR2)
        RETURN myTableType pipelined;

In Body:
FUNCTION StrToTable(boxes in varchar2) RETURN myTableType pipelined
AS
l_str long default boxes || ',';
l_n number;
begin
 loop
  exit when l_str is null;
  l_n := instr(l_str, ',');
  pipe row(ltrim(rtrim(substr(l_str,1,l_n-1))));
  l_str := substr(l_str, l_n+1);
 end loop;
 return;
end StrToTable;

And now, I am getting PLS-00653: aggregate/table functions are not allowed in PL/SQL scope.
What can I do so that my CheckAllTheBoxes_Proc to work?
allTheBoxes would have value such as 'KO_KOMAC0003, KO_MWRW0102.....' and boxesFound should come 
out to be total number found for the box listed in allTheBoxes.

I tried and I guess I reached my limitation.  I really appreciate if you can help me out on this 
problem.
Thank you. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom68465796559216"></a>
<pre>use sql types - create type - OUTSIDE the package, that is the way it is designed to work.

you can put the function in a package if you like, but keep the type at the sql level. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>I got it working... but I still curious how it got to work.</b>
&nbsp;&nbsp;July      20, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#68526159443255">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="68526159443255">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Evan</b>&nbsp;from Seattle, WA USA</div>
</div>
<pre>Can you explain this Tom?
I've replaced this,
SELECT COUNT(a.ID) INTO boxesFound FROM BT_Box a WHERE a.BOXNO IN (select * 
from THE StrToTable(allTheBoxes));

to,
SELECT COUNT(a.ID) INTO boxesFound FROM BoxTrack_Box a WHERE a.BOXNO IN (select * from THE (select 
cast(StrToTable(allTheBoxes) as myTableType) from dual) b);

What exactly is &quot;select * from THE (select cast(StrToTable(allTheBoxes) as myTableType) from dual) 
b&quot; means?

Anyhow, thank you so much TOM!  I would never got this solution without your feedbacks. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom68526159443255"></a>
<pre>you don't need the &quot;the&quot;, but that CAST may have been necessary.  The bind can lose the &quot;type&quot; 
information as far as sql is concerned. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
<b>Comma Seperated string</b>
&nbsp;&nbsp;August    11, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#69868634077657">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="69868634077657">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>DM</b>&nbsp;from India</div>
</div>
<pre>Hi tom
We have a string that will have comma seperated valuesin a text box (varchar2 type)from UI(.NET).
and we have create a dynamic sql that will return the records on basis of that like select * from 
table_name where name in (text_box values )?
Thanks in advance </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom69868634077657"></a>
 <pre><a href="http://tkyte.blogspot.com/2006/06/varying-in-lists.html">http://tkyte.blogspot.com/2006/06/varying-in-lists.html</a></pre>  <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars4.gif" alt="4 stars" />
<b>Converting SQL file to csv file </b>
&nbsp;&nbsp;August    22, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#70534336612498">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="70534336612498">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Soni Kumari</b>&nbsp;from India</div>
</div>
<pre>Hi Tom,
I have created a sql report file. Its working if run from sql prompt as @c:\order_relationships.sql

But I need to convert the output in csv file. So I need to change the some of the statement.
This is first time I am going to convert report file in csv.
So not really sure as how to convert this. When I run the file its giving the output based on only 
the last statement 
&quot;SELECT anchor_ord||','||
SLCT||','||
wo_nbr||','||
rel_wo_nbr||','||
wostatus||','||
opstatus||','||
loc||','||
Item||','||
qty||','
FROM siviews.si_cancel_workorder
ORDER BY anchor_ord;&quot;

But this is not taking care of the previous formattings.


/******************************************************************************
SQL Script

Filename: order_relationships.sql

Purpose:  Generates Report Data for Order Relationships

Usage:    While in SQLPlus ...

             SQL&gt; @order_relationships.sql &amp;1 &amp;2

             Where &amp;1 = Extract file name used in SPOOL command
                   &amp;2 = Report Identifier
******************************************************************************/
WHENEVER OSERROR EXIT SQL.OSCODE ROLLBACK
WHENEVER SQLERROR EXIT SQL.SQLCODE ROLLBACK
SET ECHO OFF
SET ESCAPE ON
SET SERVEROUTPUT ON
SET DOCUMENT OFF
SET VERIFY OFF
SET HEADING OFF
SET RECSEP OFF
SET NEWPAGE 0
SET VERIFY OFF
SET CONCAT ON

CLEAR COLUMNS
CLEAR BREAKS
CLEAR COMPUTES
/******************************************************************************
Author: Soni Kumari                                   
Date:   18-Aug-2006

Edit
History:

  18-Aug-2006 Soni Kumari Issue #RHEY-6RWLVU
        o Initial version.
******************************************************************************/
DEFINE csvfile =  &amp;1
DEFINE rptid = &amp;2

PROMPT
PROMPT Beginning data extraction.

SET FEEDBACK OFF
SET PAGESIZE 0
SET LINESIZE 500
SET TRIMSPOOL ON
SET TERMOUT OFF
COLUMN current_date NEW_VALUE report_date
SELECT TO_CHAR(SYSDATE,'MM/DD/YYYY') current_date FROM DUAL;
COLUMN current_date NEW_VALUE report_time
SELECT TO_CHAR(SYSDATE,'HH:MI:SS AM') current_date FROM DUAL;

SELECT SYSDATE FROM DUAL;

SET TERMOUT ON

--Setup page headings and footings
TTITLE CENTER 'Order Relationships' RIGHT report_date SKIP 1 RIGHT report_time SKIP 3 'Anchor 
Order:  '  FORMAT A10 anc_ord_var SKIP 1 FORMAT A10 slct_var SKIP 2

BTITLE LEFT 'No Related WorkOrder' RIGHT 'Page ' FORMAT 999 SQL.PNO

--Format the columns
COLUMN anchor_ord NEW_VALUE anc_ord_var NOPRINT
COLUMN slct NEW_VALUE slct_var NOPRINT
COLUMN wo_nbr           HEADING 'Dependent|Work Order' FORMAT A10 WORD_WRAPPED 
COLUMN rel_wo_nbr       HEADING 'Related|Work Order'   FORMAT A10 WORD_WRAPPED 
COLUMN wostatus         HEADING 'Wostatus'    FORMAT A10 WORD_WRAPPED 
COLUMN opstatus         HEADING 'OpStatus' FORMAT A10 WORD_WRAPPED 
COLUMN loc              HEADING 'Location' FORMAT A10 WORD_WRAPPED 
COLUMN item             HEADING 'Item' FORMAT A10 WORD_WRAPPED 
COLUMN qty              HEADING 'Qty' FORMAT 9999 


BREAK ON anchor_ord SKIP PAGE 1 NODUPLICATES ON slct NODUPLICATES

SET TERMOUT OFF

SPOOL &amp;csvfile

--
--Column Headings
--

--
-- Write out Report Indentifier
--
SELECT '&amp;rptid'||','
  FROM DUAL;

--
-- Column Headings
--
--
-- Detail Information
--
SELECT anchor_ord||','||
       SLCT||','||
       wo_nbr||','||
       rel_wo_nbr||','||
       wostatus||','||
       opstatus||','||
       loc||','||
       Item||','||
       qty||','
  FROM siviews.si_cancel_workorder
 ORDER BY anchor_ord;

SPOOL OFF
SET TERMOUT ON
SET FEEDBACK ON
SET PAGESIZE 0
SET HEADING OFF
SET VERIFY OFF
SET FEEDBACK OFF
CLEAR COLUMNS
CLEAR BREAKS
TTITLE OFF
BTITLE OFF

PROMPT Data extraction complete.
PROMPT

Please advice as what changes I need to do to export the formatting also in the csv file.

Thanks,
Soni  </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom70534336612498"></a>
<pre>I do not know what you mean.  If you want just a script to output csv based on a table, I've got 
those.

but I don't know what you mean by &quot;it ignores the previous settings&quot; </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>To store value in a variable</b>
&nbsp;&nbsp;September 04, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#71426872240523">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="71426872240523">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Soni Kumari</b>&nbsp;from India</div>
</div>
<pre>Hi Tom,
  I have to get a CSV file form the below script. In the select statement, I have to use a DECODE 
statement.
SELECT DECODE(TO_CHAR(SYSDATE,'d'),1,TO_CHAR(SYSDATE,'dd-mon-yy'),
                                2,TO_CHAR(SYSDATE-1,'dd-mon-yy'),
                                3,TO_CHAR(SYSDATE-2,'dd-mon-yy'),
                                4,TO_CHAR(SYSDATE-3,'dd-mon-yy'),
                                5,TO_CHAR(SYSDATE-4,'dd-mon-yy'),
                                6,TO_CHAR(SYSDATE-5,'dd-mon-yy'),
                            TO_CHAR(SYSDATE-7,'dd-mon-yy')) FROM DUAL

The result from the DECODE statement needs to be displayed along with the SELECT statemetn and that 
will get stored in CSV file. I can't use the DECODE with the SELECT statement as there will be 
various combinations of DECODE and will be used around 14 times in the SELECT statement:
SELECT 'LEADTIME,Item,SUBORD,NONEWSUPPLYDATE,AVG_FCST,OH,' v_date.......   FROM DUAL;
So I have to store ythe value of v_date in a variable. But if I use PL/SQL tags in this file the 
spooling doesn't work.
Please advice.


SET ECHO OFF
SET ESCAPE ON
SET SERVEROUTPUT ON
SET DOCUMENT OFF
SET VERIFY OFF

DEFINE csvfile = &amp;1

PROMPT
PROMPT Beginning data extraction.

SET FEEDBACK OFF
SET PAGESIZE 0
SET LINESIZE 500

v_date DATE   := TRUNC(SYSDATE,'dd-mon-yy');

SELECT DECODE(TO_CHAR(SYSDATE,'d'),1,TO_CHAR(SYSDATE,'dd-mon-yy'),
                                2,TO_CHAR(SYSDATE-1,'dd-mon-yy'),
                                3,TO_CHAR(SYSDATE-2,'dd-mon-yy'),
                                4,TO_CHAR(SYSDATE-3,'dd-mon-yy'),
                                5,TO_CHAR(SYSDATE-4,'dd-mon-yy'),
                                6,TO_CHAR(SYSDATE-5,'dd-mon-yy'),
                            TO_CHAR(SYSDATE-7,'dd-mon-yy')) INTO v_date FROM DUAL;

SET TRIMSPOOL ON
SET TERMOUT OFF

SPOOL &amp;csvfile
-- Column Headings
SELECT 'LEADTIME,Item,SUBORD,NONEWSUPPLYDATE,AVG_FCST,OH,'    FROM DUAL;
SPOOL OFF
SET TERMOUT ON

PROMPT Data extraction complete.
PROMPT
END;
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom71426872240523"></a>
<pre>well, that date computation is interesting - couldn't really figure out what it was (was not the 
beginning of the week which was my first guess)

I'm not really sure WHAT you are trying to do here - since &quot;into&quot; is a plsql thing  (doesn't mean 
anything in SQLPlus).

the line:

v_date date := trunc(...)

is not meaningful either, it is a line of plsql code, but there are not any plsql blocks in there.

You seem to have morphed sqlplus and plsql into a &quot;single thing&quot;, they are very much separate and 
distinct.

Do you have anyone on your site that can &quot;mentor you&quot; through this one - you are starting at ground 
zero here. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars2.gif" alt="2 stars" />
<b>'D'</b>
&nbsp;&nbsp;September 04, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#71446508361762">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="71446508361762">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Matthias Rogel</b>&nbsp;</div>
</div>
<pre>&quot;was not the beginning of the week which was my first guess&quot;

caveat: 'D' strongly depends on your setting of NLS_TERRITORY:

SQL&gt; alter session set nls_territory='AMERICA';

Session altered.

SQL&gt; select TO_CHAR(SYSDATE,'d') from dual;

T
-
2

1 row selected.

SQL&gt; alter session set nls_territory='FRANCE';

Session altered.

SQL&gt; select TO_CHAR(SYSDATE,'d') from dual;

T
-
1

1 row selected.


 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom71446508361762"></a>
<pre>I know, that is why I said &quot;first guess&quot;, looked at it further and just found it &quot;a strange day&quot; 
being returned.  Could not really guess what the point was. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;November  10, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#76373862222373">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="76373862222373">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Tom,

I have a table which stores string value from multi rows text feild, the following is the output 
from the columns

SELECT changes FROM adpds_impact.change_log
WHERE table_name = 'ACTIVITYENTITY'
AND table_key_value = 272501;


CHANGES
--------------------------------------------------------------------------------
UPDATED RECORD|PROJECTID : 0|SUBPROJECTID : 0|CONTACTID : 0|NEEDEDBY : 12:00:0|0 AM|TIMESCHEDULED : 
|CONFERENCECALLPHONENUMBER : |CONFERENCECALLPASSCODE : |CON
FERENCECALLLOCATION : |ESTIMATEDDATE : 3/1/2006 : CHANGED TO : 3/31/2006|ACTUALDATE : 12:00:00 
|M|SCHEDULEDAFTERHOURSWORK : |COMPLETER : |LASTUPDATEBY : |CONTAC|TMETHODID : 0|SEQUENCE : 
0|PHASEID : 0|GROUPID : 0

How can i search for a Text in this record and display only that text, the requirment is

if the above text has a date(passed through parameter) say 3/1/2006 for ESTIMATEDDATE then the 
query needs to display only value &quot;ESTIMATEDATE : 3/1/2006: CHANGED TO : 3/31/2006&quot; from the above 
record value.

Thanks in advance i dont have intemedia text enabled. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom76373862222373"></a>
<pre>can we fix your data model and make this data useful instead?   </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
&nbsp;&nbsp;November  10, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#76387886365662">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="76387886365662">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>Yeah, i know it in a Soup right now but this is urgent 

can you atleast tell me how to get just the date value from the following string

&quot;ACTUALDATE :  -&gt; 8/31/2006 12:00:00 AM&quot;

i just want to pick the date value &quot;8/31/2006&quot; irrespetive of whats in the stirng last portion 
:xx:xx:xx XX would be constant. </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom76387886365662"></a>
<pre>easy answer:


you already have the date, it was the input to the query see....  You know what it is. </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>URGENT</b>
&nbsp;&nbsp;November  10, 2006
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#76390232535456">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="76390232535456">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
<pre>I think it can be done using regexp_replace, i am in 10g 
but i miss to pick only the date occurance some times.
 </pre> <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom76390232535456"></a>
<pre>(pssst:  you already have the date!

select a.*, :dt from table a where string like '%'||:dt||'%';

you were searching for it... there you go) </pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
&nbsp;&nbsp;January   29, 2007
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#79710600346247148">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="79710600346247148">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;from Columbus</div>
</div>
i have a string like these
<br />'1111-1112-1113-1114-1115'
<br />it can be like these too
<br />'1111-1112-1113-1114-1115-1116'
<br />
<br />how to get the secong last value
<br />
<br />like in first case 1114
<br />
<br />in the second case 1115
<br />
<br />Thanks,
<br />Raul <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom79710600346247148"></a>
<pre>ops$tkyte%ORA10GR2&gt; select x,
  2         instr( x, '-', -1 ),
  3         instr( x, '-', -1, 2 ),
  4             substr( x, instr( x, '-', -1, 2 )+1, instr( x, '-', -1 )-instr( x, '-', -1, 2 )-1 ) 
y
  5    from t
  6  /

X                              INSTR(X,'-',-1) INSTR(X,'-',-1,2) Y
------------------------------ --------------- ----------------- ------------------------------
1111-1112-1113-1114-1115                    20                15 1114
1111-1112-1113-1114-1115-1116               25                20 1115
123-1115-1116                                9                 4 1115
1115-1116                                    5                 0 1115
1116                                         0                 0

</pre> <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars3.gif" alt="3 stars" />
<b>Pluck out the leading alphabets</b>
&nbsp;&nbsp;February  14, 2007
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#115024000346942855">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="115024000346942855">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>A reader</b>&nbsp;</div>
</div>
1. I have a string like ABC123, or it can be ABC1234556, or ZZZZZ2344. I need to pluck out the leading alphabets and return only the number part of it.
<br />
<br />2. I also need to ensure that in string like ABC12345AB12, first after weeding out the leading alphabets, I have to check and see that the remaining part of the string does not have any alphabets.
<br />
<br />In this example after weeding out the alphabets what is left will be 12345AB12, now that is invalid because after removing the leading alphapets the string should fail validation if it still has ALPHABETS in it.
<br />
<br />What can be the correct and quicket solution for this requirement. <br />
<br />
<div class="followup"><h2 style="font-style:italic">Followup:</h2><a name="tom115024000346942855"></a>
you have regular expressions at your disposal
<br />
<br />you have instr and substring at your disposal
<br />
<br />simple little functions to be written using those functions. <br />
</div>
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Re: Pluck out the leading alphabets   </b>
&nbsp;&nbsp;February  15, 2007
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#116889900346236595">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="116889900346236595">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Frank Zhou</b>&nbsp;from Braintree, MA </div>
</div>
Here is a sql solution.
<br />
<br />Frank 
<br />
<br />SQL&gt; select old_str, new_str,
<br />  2  CASE WHEN  REGEXP_instr(new_str, '[^[:digit:]]', 1 ) &gt; 0
<br />  3&nbsp; &nbsp;  THEN 'INVALID'
<br />  4&nbsp;  END As Flag
<br />  5  from 
<br />  6  (
<br />  7&nbsp;  select str as old_str,
<br />  8&nbsp; &nbsp; &nbsp;   ltrim( upper(str), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') as new_str  
<br />  9&nbsp; &nbsp; from
<br /> 10&nbsp; &nbsp; &nbsp; (select 'ABC12345AB12' str from dual
<br /> 11&nbsp; &nbsp; &nbsp;  union all
<br /> 12&nbsp; &nbsp; &nbsp;  select 'ZZZZZ2344' str from dual
<br /> 13&nbsp; &nbsp;   )
<br /> 14  );
<br />
<br />OLD_STR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   NEW_STR&nbsp; &nbsp; &nbsp;   FLAG
<br />------------&nbsp; &nbsp; &nbsp; &nbsp; ------------&nbsp; &nbsp; -------
<br />ABC12345AB12&nbsp; &nbsp;   12345AB12&nbsp; &nbsp; &nbsp; INVALID
<br />ZZZZZ2344&nbsp; &nbsp; &nbsp;   2344
<br />
<br />SQL&gt;  <br />
<br />
<div class="ri" >
<div class="tl"><img src="/asktom_i/stars5.gif" alt="5 stars" />
<b>Refined Query</b>
&nbsp;&nbsp;February  16, 2007
</div><div class="tr"><a href="f?p=100:11:0::::P11_QUESTION_ID:2189860818012#119450800346238730">Bookmark</a> | <a href="#PAGEBOTTOM">Bottom</a> |
<a href="#PAGETOP" name="119450800346238730">Top</a></div>
<div class="tb">Reviewer:&nbsp;<b>Tom Admirer</b>&nbsp;from WA</div>
</div>
Tom, For the original question, Here is the refined query...without appened commas...
<br />
<br />Would this be any better in your perspective?
<br />
<br />scott @ MYDB&gt;variable x varchar2(30)
<br />scott @ MYDB&gt;exec :x:='William,Clinton,J'
<br />
<br />PL/SQL procedure successfully completed.
<br />
<br />scott @ MYDB&gt;select substr(:x,1,instr(:x,',',1)-1) FIRST_NAME,
<br />2 substr(:x,instr(:x,',',1)+1,(instr(:x,',',-1)-instr(:x,',',1))-1) LAST_NAME,
<br />3 substr(:x,instr(:x,',',-1)+1) MIDDLE_INIT
<br />4 from dual;
<br />
<br />FIRST_NAME&nbsp; &nbsp; &nbsp; &nbsp;   LAST_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  MIDDLE_INIT
<br />-------------------------------- javascript:doSubmit('SUBMIT_REVIEW')
<br />Submit Review-------------------------------- --------------------------------
<br />William&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  Clinton&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; J  <br />
<br />
</td>
</tr>
</tbody>
</table><hr />
<center>
<table class="formlayout" summary="" ><tr><td  align="right"></td>
<td  colspan="1" rowspan="1" align="left"><table class="t18ButtonAlternative2" cellspacing="0" cellpadding="0" border="0"  summary="">
<tr>
<td class="t18L"><img src="/asktom_i/button_alt2_l.gif" alt="" /></td>
<td class="t18C"><a href="javascript:doSubmit('WRITE_REVIEW');">Write a Review</a></td>
<td class="t18R"><img src="/asktom_i/button_alt2_r.gif" alt="" /></td>
</tr>
</table>&nbsp;</td></table>
</center></div></td>
</tr>
<tr>
<td valign="top"></td>
<td valign="top"></td>
</tr>
</table>
</td>
</tr>
</table>
</td>
<td class="t18PageRight"><br /></td>
</tr>
<tr>
<td valign="bottom" height="3"><img src="/asktom_i/themes/theme_18/page_bl.gif" alt="" /></td>
<td class="t18BottomMiddleFill"><img src="/asktom_i/themes/theme_18/page_bm.gif" alt="" /></td>
<td valign="bottom" height="3"><img src="/asktom_i/themes/theme_18/page_br.gif" alt="" /></td>
</tr>
</table><br class="t18Break"/>
<a name="PAGEBOTTOM"></a>
<input type="hidden" name="p_md5_checksum" value=""  /></form>
<center class="copy">
<a href="http://www.oracle.com/corporate/index.html">About Oracle</a> 
|
<a href="http://www.oracle.com/html/copyright.html">Legal Notices and Terms of Use</a>
|
<a href="http://www.oracle.com/html/privacy.html">Privacy Statement</a>
</center><br />
<script type="text/javascript">
<!-- 

//-->
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-379628-7");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}</script></body>
</html>
