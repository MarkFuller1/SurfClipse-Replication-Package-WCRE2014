<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="X-UA-Compatible" content="IE=8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>java &raquo;  randomnoun</title>

<link rel="stylesheet" href="http://www.randomnoun.com/wp/wp-content/themes/randomnoun/style.css" type="text/css" media="all" />
<!--[if IE 6]>
<link rel="stylesheet" href="http://www.randomnoun.com/wp/wp-content/themes/randomnoun/ie6.css" type="text/css" />
<![endif]-->

<meta name="robots" content="index,follow" />
<link rel="alternate" type="application/rss+xml" title="randomnoun RSS Feed" href="http://www.randomnoun.com/wp/feed/" />
<link rel="alternate" type="application/atom+xml" title="randomnoun Atom Feed" href="http://www.randomnoun.com/wp/feed/atom/" />
<link rel="pingback" href="http://www.randomnoun.com/wp/xmlrpc.php" />
<link rel="shortcut icon" href="http://www.randomnoun.com/wp/wp-content/themes/randomnoun/favicon.ico" type="image/x-icon" />



<!-- BEGIN Metadata added by Add-Meta-Tags WordPress plugin
Get the plugin at: http://www.g-loaded.eu/2006/01/05/add-meta-tags-wordpress-plugin/ -->
<meta name="keywords" content="java" />
<!-- END Metadata added by Add-Meta-Tags WordPress plugin -->

<link rel="alternate" type="application/rss+xml" title="randomnoun &raquo; java Tag Feed" href="http://www.randomnoun.com/wp/tag/java/feed/" />
<link rel='stylesheet' id='rn-sourcecode-style-css'  href='http://www.randomnoun.com/wp/wp-content/plugins/rn-sourcecode/css/rn-sourcecode.css?ver=3.6' type='text/css' media='all' />
<link rel='stylesheet' id='toggler-style-css'  href='http://www.randomnoun.com/wp/wp-content/plugins/toggler/css/toggler.css?ver=3.6' type='text/css' media='all' />
<link rel='stylesheet' id='wpsr-socialbuttons-css'  href='http://www.randomnoun.com/wp/wp-content/plugins/wp-socializer/public/css/wp-socializer-buttons-css.css?ver=2.4.9.5' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-widgets-css'  href='http://www.randomnoun.com/wp/wp-content/plugins/jetpack/modules/widgets/widgets.css?ver=20121003' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.randomnoun.com/wp/wp-content/plugins/wp-syntax/wp-syntax.css?ver=3.6' type='text/css' media='all' />
<script type='text/javascript' src='//ajax.googleapis.com/ajax/libs/prototype/1.7.1.0/prototype.js?ver=1.7.1'></script>
<script type='text/javascript' src='http://www.randomnoun.com/wp/wp-content/plugins/rn-sourcecode/js/tabs.js'></script>
<script type='text/javascript' src='http://www.randomnoun.com/wp/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='http://www.randomnoun.com/wp/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://www.randomnoun.com/wp/wp-content/plugins/toggler/js/toggler.min.js?ver=3.6'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.randomnoun.com/wp/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.randomnoun.com/wp/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.6" />
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>

<!--WP Socializer v2.4.9.5 - Scripts Loader-->
<script type="text/javascript">
var wu=["https://platform.twitter.com/widgets.js","https://connect.facebook.net/en_US/all.js#xfbml=1","https://apis.google.com/js/plusone.js"],wc=3;
function wpsrload(){ for(var i=0;i<wc;i++){wpsrasync(wu[i]);} }
function wpsrasync(u){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=u;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(a,s);} wpsrload();
</script>
<!--End WP Socializer - Scripts Loader-->
</head>
<body id="home">

<div id="header" class="clearfix">

	<ul id="accessibility">
		<li><a href="/" title="Go to homepage">Home</a></li>
						<li class="last-item"><a href="/login.html">Log in</a></li>
	</ul>

	<div id="branding">
		<h1 id="logo"><a href="http://www.randomnoun.com/wp/" title="randomnoun">randomnoun</a></h1>
		<div class="description">
		  Just another WordPress site    </div>
	</div>
	
	<div id="nav" class="clearfix">
		<div id="nav-search">
			<form role="search" method="get" id="searchform" class="searchform" action="http://www.randomnoun.com/wp/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>		</div>

<!--
		<ul id="menu">
  		<li class="page-item-home "><a href="http://www.randomnoun.com/wp/">Home</a></li>
  		<li class="page_item page-item-82"><a href="http://www.randomnoun.com/wp/version/">version</a></li>		</ul>
-->

<ul id="menu">
  		<li class="page-item-home"><a href="/index.html">Home</a></li>
  		<li class="page_item page-item-2"><a href="/about-rn.html" title="About randomnoun">About RN</a></li>
  		<li class="page_item page-item-2 current_page_item"><a href="/wp" title="Blog">Blog</a></li>
  		<li class="page_item page-item-2"><a href="/products.html" title="Products">Products</a></li>
  		<li class="page_item page-item-2"><a href="/support.html" title="Support">Support</a></li>
  		<li class="page_item page-item-2"><a href="/contacts.html" title="Contacts">Contacts</a></li>
  	</ul>

    <div id="submenu-bg">    
          </div>
	</div>

</div>


<div id="main" class="clearfix">
	<div id="container">
		<div id="content">

		
 	   	  		  <h1 class="pagetitle">Posts Tagged &#8216;java&#8217;</h1>
 	  

		<div class="navigation clearfix">
			<div class="alignleft"><a href="http://www.randomnoun.com/wp/tag/java/page/2/" >&laquo; Older Entries</a></div>
			<div class="alignright"></div>
		</div>

				<div class="post-1609 post type-post status-publish format-standard hentry category-uncategorized tag-java tag-songkick tag-songkick-api-client">
			<h2 id="post-1609"><a href="http://www.randomnoun.com/wp/2013/10/08/a-java-client-for-the-songkick-api/" rel="bookmark" title="Permanent Link to A Java client for the Songkick API">A Java client for the Songkick API</a></h2>
			<small class="meta">October 8th, 2013 </small>

			<div class="entry">
				<p>So a while back I posted up a <a href="http://www.randomnoun.com/wp/2013/09/11/getting-an-artifact-into-the-maven-central-repository/">Java Bandcamp API client</a>, and I thought I&#8217;d also post up a similar API client for Songkick, who do a similar thing but in a slightly different, <a href="https://www.songkick.com/developer/">not very well documented</a>, but <a href="http://techcrunch.com/2012/03/08/songkick-secures-sequoias-first-ever-uk-investment-with-a-10m-b-round/">yet somehow worth $17million</a> way. </p>
<p>The reason behind creating these API clients was that they were going to be part of a mobile app that myself and a couple of mates were thinking of building about a year or two ago (that we didn&#8217;t end up completing due to a combination of lack of interest and actual work commitments). At the time we noticed that the only thing people seemed to do with their fancy smartphones was to hold them up during concerts to take clips of bands at gigs and concerts, and that seemed like a possible audience to sell shiny things to. Using these APIs seemed like a relatively simple way of associating vaguely relevant metadata to those photos and video clips. </p>
<p>At any rate, that never happened, but I&#8217;ve got the code sitting here so might as well package it up and see if someone else can find it useful.</p>
<p>There are other Java songkick clients out there, <a href="http://code.google.com/p/songkick-java-api/">such as this one</a> which looks as if it&#8217;s been kept up-to-date with the changes to the API that have occurred over the last two years. So give that one a try first, and if it doesn&#8217;t work for you for whatever reason, then you could try this one instead. </p>
<p>So anyway, here it is. Knock yourself out. </p>
<p>The artifact has the groupId:artifactId of <tt><b>com.randomnoun.songkick:songkick-api-client</b></tt> artifact, and can be sourced in your <code>pom.xml</code> from the maven central repository. </p>
<p>Seeing as the API isn&#8217;t complete, I&#8217;ve kept the version number at <tt>0.0.2</tt>; I&#8217;ll bump this to <tt>1.0.0</tt> if I fill out the rest of the API.</p>
<p>
<div class="maven-button"><a href="http://code.randomnoun.com/songkick-api-client"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/09/maven-ball-42.png" width="42" height="42" style="margin: 5px; float:left;"/></a><a href="http://code.randomnoun.com/songkick-api-client">
<div class="big">songkick-api-client</div>
<div class="small">com.randomnoun.songkick:songkick-api-client</div>
<p></a></div>
<div style="height:50px;">&nbsp;</div>
<p>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2013/10/08/a-java-client-for-the-songkick-api/#respond" title="Comment on A Java client for the Songkick API">No comments</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a> <a href="http://www.randomnoun.com/wp/tag/songkick/" rel="tag">songkick</a> <a href="http://www.randomnoun.com/wp/tag/songkick-api-client/" rel="tag">songkick-api-client</a></p>      </div>
		</div>

				<div class="post-414 post type-post status-publish format-standard hentry category-uncategorized tag-common tag-java">
			<h2 id="post-414"><a href="http://www.randomnoun.com/wp/2013/09/24/webapp-versions-v1-0/" rel="bookmark" title="Permanent Link to Webapp versions v1.0">Webapp versions v1.0</a></h2>
			<small class="meta">September 24th, 2013 </small>

			<div class="entry">
				<p>You should be able to determine which version of your program is running. </p>
<p>I think this can be illustrated by giving an example of two versions of a program:</p>
<div class="download-button"><a href="/wpf/versions/1/mystery-application.exe"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/02/download-arrow.png" width="41" height="40" style="margin: 5px; float:left;"/></a><a href="/wpf/versions/1/mystery-application.exe">
<div class="big">Lucky dip prize #1</div>
<div class="small">Run it! I dare you!</div>
<p></a></div>
<p><br/></p>
<div class="download-button"><a href="/wpf/versions/2/mystery-application.exe"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/02/download-arrow.png" width="41" height="40" style="margin: 5px; float:left;"/></a><a href="/wpf/versions/2/mystery-application.exe">
<div class="big">Lucky dip prize #2</div>
<div class="small">Run it! I dare you!</div>
<p></a></div>
<p><br/></p>
<p>One of these downloads is a multi-megabyte OpenGL-based warfare simulation in which theories of warfare can be tested and refined without the need for actual hostilities, including not only military but also political and social factors, seen as inextricably entwined in a realistic warfare model <a name="fn1back" href="#fn1" class="footnoteref">[1]</a>.</p>
<p>The other is a multi-megabyte package that will display the following dialog box:</p>
<div id="attachment_1414" class="wp-caption aligncenter" style="width: 324px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/mystery-application.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/mystery-application.png" alt="mystery-application.exe is not a valid Win32 application. OR IS IT?" width="314" height="101" class="size-full wp-image-1414" /></a><p class="wp-caption-text">mystery-application.exe is not a valid Win32 application. OR IS IT?</p></div>
<p>These are, of course, two versions of the exact same piece of software; the only difference between them is that in one I&#8217;ve converted the <a href="http://en.wikibooks.org/wiki/X86_Disassembly/Windows_Executable_Files">PE COFF machine identifier</a> to be a 7.</p>
<p>What I&#8217;m attempting to illustrate here is how extraordinarily brittle software is as a whole, and how knowing which version of an application an end-user is running is fairly significant when attempting to determine what the problem is at any particular point in time <a name="fn2back" href="#fn2" class="footnoteref">[2]</a> <a name="fn3back" href="#fn3" class="footnoteref">[3]</a>. </p>
<p>Software artifacts are different from physical artifacts. In nature, you can usually break a twig without killing the tree, but this isn&#8217;t true of software, most instances of which will fall into a heap if you breathe on them the wrong way. Some developers attempt to minimise these &#8216;single points of failure&#8217; by creating hideously complex design patterns, but I should probably leave that rant for another time.</p>
<p>Anyway, where was I.</p>
<p>You should be able to determine which version of your program is running. </p>
<div id="attachment_427" class="wp-caption alignright" style="width: 202px"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/02/72virgins.jpg" width="192" height="108" class="size-full wp-image-427" /><p class="wp-caption-text">Some people believe that you will receive 72 versions after you go jihadding. They should work in IT. Ahahaha.</p></div>
<p>It&#8217;s usually the first question that any IT support person will ask, because if you don&#8217;t know what version you&#8217;re running, then you don&#8217;t have a baseline from which to work out what to change to fix whatever problem you&#8217;re having <a name="fn3back" href="#fn3" class="footnoteref">[3]</a>. </p>
<p>If you were the sort of person who over-dramatises things, you can think of it as being similar to the fire brigade asking what building you&#8217;re in when you ring them up complaining that the air is a bit thick today. Just before they enter your address into some kind of computer system. <a href="http://catless.ncl.ac.uk/Risks/20.75.html#subj5">Which is definitely working.</a></p>
<p>Microsoft desktop applications normally shove this under the Help &rarr; About dialog, command-line programs normally have a <code>-v</code> or <code>-?</code> switch, but webapps don&#8217;t have a standard for it. </p>
<div class="stripey-sidebox">
Microsoft also believes that you should store version numbers in <a href="http://blogs.msdn.com/b/askie/archive/2009/03/23/understanding-compatibility-modes-in-internet-explorer-8.aspx">content type headers</a>, <a href="http://msdn.microsoft.com/en-us/library/dd565650%28v=vs.85%29.aspx">meta tags</a>, <a href="http://msdn.microsoft.com/en-au/library/ie/ms535242%28v=vs.85%29.aspx">document type declarations</a>, and <a href="http://blogs.msdn.com/b/ie/archive/2008/03/18/webbrowser-control-rendering-modes-in-ie8.aspx">four or five places</a> <a href="http://blogs.msdn.com/b/ie/archive/2009/03/10/more-ie8-extensibility-improvements.aspx">in the registry</a>, <a href="http://social.msdn.microsoft.com/Forums/en-US/iewebdevelopment/thread/26bf7ab3-4ee2-4e10-be16-21c5ffd8c8f6/">but let&#8217;s ignore that</a> for <a href="http://blogs.msdn.com/b/ie/archive/2008/09/02/ie8-security-part-vi-beta-2-update.aspx">the time being</a>.
</div>
<p>&#8220;Yes&#8221;, you may say, &#8220;but everyone using a webapp is by definition using the same version of the webapp&#8221;, and well you might, you handsome devil you, but you haven&#8217;t considered internally-deployed webapps, or worked in a overly-bureaucratic or security-conscious organisation that considers that kind of information too difficult to retrieve or confidential, and you don&#8217;t have hundreds of the bloody things scattered over the net.</p>
<p>I normally allow the version information to be retrieved from <code><a href="http://docs.oracle.com/javaee/5/tutorial/doc/bnadx.html#bnaeb"><i>/context-root</i></a>/version</code> (where <i>context-root</i> is usually just &#8220;/&#8221; under the root domain), which returns a JSON map with the following keys:</p>
<ul>
<li><code>bamboo.buildKey</code>
<li><code>bamboo.buildNumber</code>
<li><code>bamboo.buildPlanName</code>
<li><code>bamboo.buildTimeStamp</code>
<li><code>bamboo.buildForceCleanCheckout</code>
<li><code>bamboo.custom.cvs.last.update.time</code>
<li><code>bamboo.custom.cvs.last.update.time.label</code>
<li><code>maven.pom.name</code>
<li><code>maven.pom.version</code>
<li><code>maven.pom.groupId</code>
<li><code>maven.pom.artifactId</code>
</ul>
<p>where the <code>bamboo.<i>xxxx</i></code> keys return their equivalent <a href="https://confluence.atlassian.com/display/BAMBOO030/Using+Global+or+Build-specific+Variables">Bamboo global variable values</a>, and the <code>maven.<i>xxxx</i></code> keys return their equivalent <a href="http://www.sonatype.com/books/mvnref-book/reference/resource-filtering-sect-properties.html">maven implicit property values</a>.</p>
<p>You can, for example, see what happens when you click on <a href="http://www.randomnoun.com/version">www.randomnoun.com/version</a>, which will tell you which version this site is currently running. </p>
<p>The bamboo version data is useful for <code>DEV</code> and <code>TST</code> environments, where I normally run <a href="http://stackoverflow.com/questions/5901378/what-exactly-is-a-maven-snapshot-and-why-do-we-need-it">snapshot</a> artifacts, and the maven version data is useful for <code>XPT</code> and <code>PRD</code> environments, where I normally run full releases.</p>
<p>Having this information available online means that <a href="http://www.vmaint.com/">vmaint</a> can draw the following pretty diagrams, and I can be fairly confident that it&#8217;s up-to-date:</p>
<div id="attachment_1421" class="wp-caption aligncenter" style="width: 586px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/vmaint-apps2.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/vmaint-apps2.png" alt="Current state of the eomail-web and dmx-web webapps in various environments" width="576" height="126" class="size-full wp-image-1421" /></a><p class="wp-caption-text">Current state of the eomail-web and dmx-web webapps in various environments</p></div>
<p>which also provides sufficient information to query source control and provide a list of changes that will be brought in when you move one version of the webapp into a new environment:</p>
<div id="attachment_1422" class="wp-caption aligncenter" style="width: 517px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/vmaint-apps-diff2.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/vmaint-apps-diff2.png" alt="Cropped representation of the differences between dmx-web in TST (build 93) and dmx-web in XPT (build 47)" width="507" height="339" class="size-full wp-image-1422" /></a><p class="wp-caption-text">Cropped representation of the differences between dmx-web in <code>TST</code> (build 93) and dmx-web in <code>XPT</code>  (build 47). These are the changes that will be migrated if the <code>TST</code> build is migrated to <code>XPT</code>.<br/>Each bullet point represents a checkin into CVS, the green ticks represent successful bamboo builds and the red exclamation mark represents a failed bamboo build.</p></div>
<p>The versioning process is part of the maven build process, and has the following moving parts:</p>
<ul>
<li><code>/src/main/resoures/build.properties</code>
<li><code>com.randomnoun.common.servlet.VersionServlet</code>
<li><code>/pom.xml</code> fragment to <a href="http://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html">filter</a> the <code>build.properties</code> file
<li><code>/src/main/webapp/WEB-INF/web.xml</code> to configure the servlet
</ul>
<p>Here is the contents of the <code>build.properties</code> file, which should should be placed in the <code>/src/main/resources</code> folder relative to the project base directory. When the project is built by maven, the expressions in <code>${var}</code> form are replaced with placeholders supplied by bamboo and maven:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-build-properties"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>build.properties</div><div class="toggler-target toggle-block toggler-class-build-properties"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre class="text" style="font-family:monospace;"># property file containing keys passed in from bamboo
#   see http://confluence.atlassian.com/display/BAMBOO/Using+Global+or+Build-specific+Variables
# some of the properties below require Bamboo 2.6
# you will need this in the bamboo maven goal specification:
#
# clean deploy 
# &quot;-DbambooBuildKey=${bamboo.buildKey}&quot; 
# &quot;-DbambooBuildNumber=${bamboo.buildNumber}&quot; 
# &quot;-DbambooBuildPlanName=${bamboo.buildPlanName}&quot; 
# &quot;-DbambooBuildTimeStamp=${bamboo.buildTimeStamp}&quot; 
# &quot;-DbambooBuildForceCleanCheckout=${bamboo.buildForceCleanCheckout}&quot; 
# &quot;-DbambooCustomCvsLastUpdateTime=${bamboo.custom.cvs.last.update.time}&quot; 
# &quot;-DbambooCustomCvsLastUpdateTimeLabel=${bamboo.custom.cvs.last.update.time.label}&quot; 
# -DuniqueVersion=false
&nbsp;
bamboo.buildKey=${bambooBuildKey}
bamboo.buildNumber=${bambooBuildNumber}
bamboo.buildPlanName=${bambooBuildPlanName}
bamboo.buildTimeStamp=${bambooBuildTimeStamp}
bamboo.buildForceCleanCheckout=${bambooForceCleanCheckout}
bamboo.custom.cvs.last.update.time=${bambooCustomCvsLastUpdateTime}
bamboo.custom.cvs.last.update.time.label=${bambooCustomCvsLastUpdateTimeLabel}
&nbsp;
maven.pom.name=${pom.name}
maven.pom.version=${pom.version}
maven.pom.groupId=${pom.groupId}
maven.pom.artifactId=${pom.artifactId}</pre></td></tr></table></div>


</div></div>
<p>And this is the <code>VersionServlet</code> source, which reads the filtered form of this file and reports the values in a JSON format:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-versionservlet-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>VersionServlet.java</div><div class="toggler-target toggle-block toggler-class-versionservlet-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common.servlet</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.IOException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.InputStream</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Properties</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.ServletException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.http.HttpServlet</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.http.HttpServletRequest</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.http.HttpServletResponse</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.Logger</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.json.JSONObject</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/**
 * Reads the contents of the build.properties file in the 
 * current application and sends it to the browser in a 
 * variety of forms. Probably JSON for starters.
 *
 * &lt;p&gt;The properties file must be located on the classpath at the
 * location &quot;/build.properties&quot;.
 * 
 * &lt;p&gt;For this to work, the application needs to have been built
 * through maven (and possibly bamboo), and there should be a 
 * &lt;tt&gt;build.properties&lt;/tt&gt; file in the application being created, 
 * with the contents:
 * 
 * &lt;pre&gt;
 *  bamboo.buildKey=${bambooBuildKey}
	bamboo.buildNumber=${bambooBuildNumber}
	bamboo.buildPlanName=${bambooBuildPlanName}
	bamboo.buildTimeStamp=${bambooBuildTimeStamp}
	bamboo.buildForceCleanCheckout=${bambooForceCleanCheckout}
	bamboo.custom.cvs.last.update.time=${bambooCustomCvsLastUpdateTime}
	bamboo.custom.cvs.last.update.time.label=${bambooCustomCvsLastUpdateTimeLabel}
&nbsp;
	maven.pom.name=${pom.name}
    maven.pom.version=${pom.version}
    maven.pom.groupId=${pom.groupId}
    maven.pom.artifactId=${pom.artifactId}
   &lt;/pre&gt;
 *
 * and the bamboo plan should have the following in the bamboo plan's
 * stage's job's task's maven goal specification:
 * 
 * &lt;pre&gt;
 *  &quot;-DbambooBuildKey=${bamboo.buildKey}&quot; 
    &quot;-DbambooBuildNumber=${bamboo.buildNumber}&quot; 
    &quot;-DbambooBuildPlanName=${bamboo.buildPlanName}&quot; 
    &quot;-DbambooBuildTimeStamp=${bamboo.buildTimeStamp}&quot; 
    &quot;-DbambooBuildForceCleanCheckout=${bamboo.buildForceCleanCheckout}&quot; 
    &quot;-DbambooCustomCvsLastUpdateTime=${bamboo.custom.cvs.last.update.time}&quot; 
    &quot;-DbambooCustomCvsLastUpdateTimeLabel=${bamboo.custom.cvs.last.update.time.label}&quot; 
    -DuniqueVersion=false 
 * &lt;/pre&gt;
 * 
 * @author knoxg
 * @blog http://www.randomnoun.com/wp/2013/09/24/webapp-versions-v1-0/
 * @version $Id: VersionServlet.java,v 1.1 2013-09-24 02:37:00 knoxg Exp $
 */</span>
@SuppressWarnings<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;serial&quot;</span><span style="color: #009900;">&#41;</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> VersionServlet <span style="color: #000000; font-weight: bold;">extends</span> HttpServlet <span style="color: #009900;">&#123;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: VersionServlet.java,v 1.1 2013-09-24 02:37:00 knoxg Exp $&quot;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Logger for this class */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span>VersionServlet.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Post method; just defers to get
	 * 
	 * @see javax.servlet.http.HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */</span>
	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">void</span> doPost<span style="color: #009900;">&#40;</span>HttpServletRequest request, HttpServletResponse response<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> ServletException, <span style="color: #003399;">IOException</span> <span style="color: #009900;">&#123;</span>
		doGet<span style="color: #009900;">&#40;</span>request, response<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** If a property has not been populated through the maven resource filter
	 * mechanism, then remove it from the Properties object.
	 *   
	 * @param props Properties object
	 * @param key key to check
	 * @param value default value
	 */</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">void</span> removeDefaultProperty<span style="color: #009900;">&#40;</span><span style="color: #003399;">Properties</span> props, <span style="color: #003399;">String</span> key, <span style="color: #003399;">String</span> value<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;${&quot;</span> <span style="color: #339933;">+</span> value <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;}&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span>props.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>key<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			props.<span style="color: #006633;">remove</span><span style="color: #009900;">&#40;</span>key<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** See class documentation
	 * 
	 * @see javax.servlet.http.HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */</span>
    <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">void</span> doGet<span style="color: #009900;">&#40;</span>HttpServletRequest request, HttpServletResponse response<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> ServletException, <span style="color: #003399;">IOException</span> 
    <span style="color: #009900;">&#123;</span>
    	<span style="color: #003399;">InputStream</span> is <span style="color: #339933;">=</span> VersionServlet.<span style="color: #000000; font-weight: bold;">class</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/build.properties&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #003399;">Properties</span> props <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Properties</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>is<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		props.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;error&quot;</span>, <span style="color: #0000ff;">&quot;Missing build.properties&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
	    	props.<span style="color: #006633;">load</span><span style="color: #009900;">&#40;</span>is<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	    	is.<span style="color: #006633;">close</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
&nbsp;
    	removeDefaultProperty<span style="color: #009900;">&#40;</span>props, <span style="color: #0000ff;">&quot;bamboo.buildKey&quot;</span>, <span style="color: #0000ff;">&quot;bambooBuildKey&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	removeDefaultProperty<span style="color: #009900;">&#40;</span>props, <span style="color: #0000ff;">&quot;bamboo.buildNumber&quot;</span>, <span style="color: #0000ff;">&quot;bambooBuildNumber&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	removeDefaultProperty<span style="color: #009900;">&#40;</span>props, <span style="color: #0000ff;">&quot;bamboo.buildPlanName&quot;</span>, <span style="color: #0000ff;">&quot;bambooBuildPlanName&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	removeDefaultProperty<span style="color: #009900;">&#40;</span>props, <span style="color: #0000ff;">&quot;bamboo.buildTimeStamp&quot;</span>, <span style="color: #0000ff;">&quot;bambooBuildTimeStamp&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	removeDefaultProperty<span style="color: #009900;">&#40;</span>props, <span style="color: #0000ff;">&quot;bamboo.buildForceCleanCheckout&quot;</span>, <span style="color: #0000ff;">&quot;bambooForceCleanCheckout&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	removeDefaultProperty<span style="color: #009900;">&#40;</span>props, <span style="color: #0000ff;">&quot;bamboo.custom.cvs.last.update.time&quot;</span>, <span style="color: #0000ff;">&quot;bambooCustomCvsLastUpdateTime&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	removeDefaultProperty<span style="color: #009900;">&#40;</span>props, <span style="color: #0000ff;">&quot;bamboo.custom.cvs.last.update.time.label&quot;</span>, <span style="color: #0000ff;">&quot;bambooCustomCvsLastUpdateTimeLabel&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    	response.<span style="color: #006633;">setHeader</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Content-Type&quot;</span>, <span style="color: #0000ff;">&quot;application/json&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	response.<span style="color: #006633;">setStatus</span><span style="color: #009900;">&#40;</span>HttpServletResponse.<span style="color: #006633;">SC_OK</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	response.<span style="color: #006633;">getWriter</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> JSONObject<span style="color: #009900;">&#40;</span>props<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<h3>pom.xml fragment</h3>
<p>In order to transform the <code>build.properties</code> into it&#8217;s filtered form, you will need this in your <code>pom.xml</code>:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;project<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  ... 
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;build<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    ...
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resources<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;filtering<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>true<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/filtering<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;directory<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>src/main/resources<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/directory<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;includes<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;include<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>build.properties<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/include<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/includes<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;filtering<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>false<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/filtering<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;directory<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>src/main/resources<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/directory<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;excludes<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;exclude<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>build.properties<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/exclude<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/excludes<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resource<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/resources<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    ...
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/build<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  ...
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/project<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div>

<h3>web.xml fragment</h3>
<p>And in order for the VersionServlet to respond to the &#8220;/version&#8221; URI, you will need this in your <code>/src/main/webapp/WEB-INF/web.xml</code> file:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.0&quot;</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">&quot;UTF-8&quot;</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;web-app</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;2.4&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  ...
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;servlet<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;servlet-name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>versionServlet<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/servlet-name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;servlet-class<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.randomnoun.common.servlet.VersionServlet<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/servlet-class<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/servlet<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  ...
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;servlet-mapping<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;servlet-name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>versionServlet<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/servlet-name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;url-pattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>/version<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/url-pattern<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/servlet-mapping<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  ...
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/web-app<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div>

<p>So everyone start doing that, and then you&#8217;ll be able to more easily turn back time, which is what you&#8217;ll need to be able to do once Sam in accounts discovers how to modify his own payroll or something.</p>
<div class="stripey-sidebox">
<p>This class is now part of the <tt><b>com.randomnoun.common:common-public</b></tt> artifact, which can be directly referenced in your <code>pom.xml</code> from the maven central repository. </p>
<p>
<div class="maven-button"><a href="http://code.randomnoun.com/common-public"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/09/maven-ball-42.png" width="42" height="42" style="margin: 5px; float:left;"/></a><a href="http://code.randomnoun.com/common-public">
<div class="big">common-public</div>
<div class="small">com.randomnoun.common:common-public</div>
<p></a></div>
</div>
<p><b>Update 25/9/2013: </b> It&#8217;s in central now</p>
<div class="footnoteline"></div>
<div class="footnotes">
<a name="fn1" href="#fn1back">[1]</a> a.k.a. <a href="http://www.dreamchess.org/">DreamChess 0.2.0</a><br />
<a name="fn2" href="#fn2back">[2]</a> Also, hopefully, how easy it is to get people to run programs they&#8217;ve downloaded off the internet, thereby negating the efforts of the entire software security industry. Bonus points: stop your computer from thinking about elephants.<br />
<a name="fn3" href="#fn3back">[3]</a> I&#8217;m assuming for the moment here that you have a problem with the software that you&#8217;re using / writing.
</div>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2013/09/24/webapp-versions-v1-0/#respond" title="Comment on Webapp versions v1.0">No comments</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/common/" rel="tag">common</a> <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a></p>      </div>
		</div>

				<div class="post-883 post type-post status-publish format-standard hentry category-uncategorized tag-java tag-maven">
			<h2 id="post-883"><a href="http://www.randomnoun.com/wp/2013/09/15/bitrot/" rel="bookmark" title="Permanent Link to Bitrot">Bitrot</a></h2>
			<small class="meta">September 15th, 2013 </small>

			<div class="entry">
				<p>So from hardware failure back to software failure. </p>
<p>Bitrot is defined in <a href="http://www.catb.org/jargon/">The Jargon File</a> as</p>
<style>
.yellow { border: solid 1px #E6DB55; background-color: #FFFFE0; border-radius: 3px; padding: 5px; margin: 3px; }
.dict-word, .dict-definition, .dict-type, .dict-pronunciation {
  font-family: arial;
  font-size: 22px;
  color: #212121;
  font-weight: 100;
}
.dict-pronunciation { font-size: 12px; }
.dict-type { font-size: 16px; color: #878787; }
.dict-definition { font-size: 13px; }
</style>
<div class="yellow">
<div class="dict-word">bit·rot</div>
<div class="dict-pronunciation">Pronunciation: /bɪt rɒt/</div>
</div>
<div class="yellow">
<div class="dict-type">Noun [common]</div>
<div class="dict-definition">Also bit decay. Hypothetical disease the existence of which has been deduced from the observation that unused programs or features will often stop working after sufficient time has passed, even if ‘nothing has changed’. The theory explains that bits decay as if they were radioactive. As time passes, the contents of a file or the code in a program will become increasingly garbled.</div>
</div>
<p><!-- TODO: fix margins on floating captioned imgs --></p>
<div style="clear:left"></div>
<p><div id="attachment_1336" class="wp-caption alignleft" style="width: 74px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/bitrot.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/bitrot.png" alt="A bad case of bitrot" width="64" height="120" class="size-full wp-image-1336" /></a><p class="wp-caption-text">A bad case of bitrot</p></div> I would measure bitrot by the amount of effort required to get a formerly perfectly functioning piece of software that used to work three years ago to do the same thing in, say, Windows 8, or your new cloudy environment thats going to save you money by making you rebuild everything again, whilst locking your data into a third-party vendor&#8217;s environment that will be extraordinarily difficult to extricate yourself from at a later point in time when they decide to charge per individual CPU opcode.</p>
<p><br style="clear:left;"/>Assuming you&#8217;ve got maven running (and therefore bamboo, nexus or something similar), I think it would be interesting to make charts of the following things over time:</p>
<style>.alpha-list ol li { list-style-type:lower-alpha; }</style>
<div class="alpha-list">
<ol type="a">
<li>number of inconsistent artifacts within an environment (i.e. same artifact at different version levels)
<li>same classes/resources in multiple JARs/in different locations in classpath (and/or different precedent levels)
<li>artifacts that don&#8217;t match their md5/sha1 hashes in your repository (probably local builds, patched builds, or multiple branches/directories building to the same version number)
<li>number of dead branches in your source control system
<li>number of active branches in your source control system (i.e. old branches still in production or the number of active maven builds)
<li>number of undocumented classes / packages
<li>number of untested classes / packages
<li>number of active APIs
<li>some measurement of maven dependency complexity (e.g. number of dependent packages per artifact or the total number of JARs within a WAR/EAR )
<li>time since last update of each maven artifact (may indicate no owner/maintainer of code)
<li>code size / file size
<li>changes to release branches that have not been integrated into HEAD in source control
<li>changes to old branches that have not been integrated into HEAD
<li>changes to HEAD that have not been integrated into branches being actively developed
<li>maven groupIds/artifact names that bear no relation to their java package structure
<li>maven groupIds/artifact names that bear no relation to their position relative to HEAD in source control
<li>xml namespace inconsistencies
<li>any use of AOP
<li>the number of levels of configuration before you hit something that isn&#8217;t a dereferenced property
<li>projects that aren&#8217;t in bamboo
<li>projects that aren&#8217;t in nexus
<li>inconsistent version numbers across a branch
<li>groupIds/artifactIds that are not consistent between maven1/maven2 files in the same folder
<li>inconsistent bamboo build config (e.g. java versions)
<li>maven build plan descriptions that bear no relation to their locations in source control
<li>inconsistent bamboo config for plans within a project (java versions, clover-enabled&#8230;)
<li>project dependency artifact versions that override parent dependency versions (mvn2) or vice versa (mvn3)
<li>SNAPSHOT project dependency artifact versions that are in a parent pom xml
<li>inconsistent parent pom version numbers between projects
</ol>
</div>
<p>I wrote most of this list a few years ago when I was working in a much, much larger company but I still think it&#8217;s relevant today, so if anyone wants to go and write up some anthropological software that generates some metrics out of, say, <a href="http://search.maven.org/">everything that&#8217;s currently sitting on central</a>, then I would find that sort of thing fascinating.</p>
<p>So someone go and do that.</p>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2013/09/15/bitrot/#respond" title="Comment on Bitrot">No comments</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a> <a href="http://www.randomnoun.com/wp/tag/maven/" rel="tag">maven</a></p>      </div>
		</div>

				<div class="post-1127 post type-post status-publish format-standard hentry category-uncategorized tag-bandcamp-api-client tag-java tag-maven">
			<h2 id="post-1127"><a href="http://www.randomnoun.com/wp/2013/09/11/getting-an-artifact-into-the-maven-central-repository/" rel="bookmark" title="Permanent Link to Getting an artifact into the maven central repository">Getting an artifact into the maven central repository</a></h2>
			<small class="meta">September 11th, 2013 </small>

			<div class="entry">
				<style>
.footnoteref { vertical-align: super; font-size: 80%; }
.footnoteline { width:50%; height:2px; border-top: solid 1px gray; "/>
</style>
<p>So I&#8217;m going to try to get something into the <a href="http://search.maven.org/">maven central repository</a>.</p>
<p>There&#8217;s a description on how to do this <a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide">on the sonatype.org site</a>, but it doesn&#8217;t go into enough detail for me, so I&#8217;m going to write up some notes on it here.</p>
<p>The project I&#8217;m opting to upload is a fairly trivial <a href="http://bandcamp.com/developer"><b>Bandcamp API</b></a> client. </p>
<p>The <a href="http://bandcamp.com/developer">Bandcamp API</a> (which is fairly unrelated to the topic of this blog post) allows you to get song lyrics and graphics from the <a href="http://bandcamp.com">Bandcamp site</a>, which is a bit like <a href="http://musicbrainz.org/">MusicBrainz</a>, but shinier, not as complete, and monetised.</p>
<p>The maven artifact that holds the Java binding for the Bandcamp API will live in the <a href="https://docs.sonatype.org/display/Repository/Choosing+your+Coordinates"><tt>groupId:artifactId</tt> co-ordinates</a> of <code><b>com.randomnoun.bandcamp</b>:<b>bandcamp-api-client</b></code>. </p>
<p>Since I&#8217;m going to have slightly higher standards for testing/documentation for these projects it probably helps that the project isn&#8217;t that big (about 10 Java classes in total, most of which are <a href="http://c2.com/cgi/wiki?TransferObject">transfer objects</a> or <a href="http://en.wikipedia.org/wiki/Plain_Old_Java_Object">POJOs</a> ).</p>
<p>So, in no particular order:</p>
<h3>Choose a license</h3>
<p>I&#8217;m going to use the <a href="http://en.wikipedia.org/wiki/BSD_licenses#2-clause_license_.28.22Simplified_BSD_License.22_or_.22FreeBSD_License.22.29">BSD simplified license</a>, since it just seems like less hassle in the long term.</p>
<p>The content of the maven license URL appears be dumped directly into the <a href="http://code.randomnoun.com/bandcamp-api-client/license.html">generated site documentation</a>, so for me this involved creating another page (<a href="http://www.randomnoun.com/bsd-simplified.txt">text</a> / <a href="http://www.randomnoun.com/bsd-simplified.html">html</a>) out on the web somewhere with the contents of the license (since the standard <a href="http://opensource.org/licenses/BSD-2-Clause">OSI page</a> has a fair amount of extraneous header/footer/sidebar guff that didn&#8217;t transfer cleanly).</p>
<p>Use of the Bandcamp API is governed by the <a href="http://bandcamp.com/developer/api_terms_of_use">Bandcamp API Terms of Use Agreement</a>.<br />
This agreement also requires compliance with the Website&#8217;s <a href="http://bandcamp.com/terms_of_use">Terms of Use</a> and<br />
<a href="http://bandcamp.com/privacy">Privacy Policy</a>, so I&#8217;ve added all of those into the <code>project/licenses</code> section of the project&#8217;s <a href="http://cvs.randomnoun.com/cvsweb/cvsweb.cgi/bandcamp-api-client/pom.xml?rev=1.53;content-type=text%2Fx-cvsweb-markup"><code>pom.xml</code></a>.</p>
<h3>Create a <a href="http://code.randomnoun.com/bandcamp-api-client/">public-facing project site</a></h3>
<p>The standard maven <code>site:site</code> <a href="http://maven.apache.org/plugins/maven-site-plugin/plugin-info.html">goal</a> / <a href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference">lifecycle</a> / <a href="http://maven.apache.org/plugin-developers/index.html">mojo</a> / <a href="http://maven.apache.org/plugins/maven-site-plugin/">plugin</a> looks fairly hideous from the vantagepoint of the year 2013, so I&#8217;ve used the <a href="http://andriusvelykis.github.io/reflow-maven-skin/skin/">reflow maven site skin</a>, which gives a more modern, <a href="http://getbootstrap.com/2.3.2/">bootstrap</a>-based site. </p>
<div id="attachment_1155" class="wp-caption aligncenter" style="width: 537px"><a href="http://code.randomnoun.com/bandcamp-api-client/"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/maven-skins.png" alt="The standard maven skin (lhs) versus the reflow maven skin (rhs)" width="527" height="216" class="size-full wp-image-1155" /></a><p class="wp-caption-text">The standard maven skin (lhs) versus the reflow maven skin (rhs)</p></div>
<p>I notice bootstrap itself got <a href="http://blog.getbootstrap.com/2013/08/19/bootstrap-3-released/">bumped from 2.3.2 to 3.0.0</a> a couple of weeks ago so I&#8217;m looking forward to finding out how that&#8217;s going to break everything I&#8217;ve written up until this point, which is one of the perks of writing software that constantly changes whilst you&#8217;re attempting to use it.</p>
<p>Turns out that maven has this thing called <a href="http://maven.apache.org/doxia/">Doxia</a> which it uses to prevent you from writing HTML to document the thing, instead preferring you to use <a href="http://maven.apache.org/doxia/references/apt-format.html">APT</a>, or <a href="http://maven.apache.org/doxia/references/fml-format.html">FML</a>, or <a href="http://maven.apache.org/doxia/references/index.html">10 other flavours</a> of <strike>home-grown shit</strike> text markup which is apparently going to stop everyone from using HTML because (in the humble opinion of the Maven steering committee) these are easier to use than the language that everyone else has been using up until this time.</p>
<p>It creates its own document event model (called the <a href="http://maven.apache.org/doxia/doxia/doxia-sink-api/">Doxia Sink</a> <a href="http://maven.apache.org/doxia/doxia/doxia-sink-api/apidocs/org/apache/maven/doxia/sink/Sink.html">API</a>) which is Apache&#8217;s attempt to reinvent the wheel again, causing me to write a doxia module that kind-of-almost allows me to use HTML instead. <a name="fn2back" href="#fn2" class="footnoteref">[2]</a></p>
<p>Seeing as I&#8217;m going to all this trouble of generating a site, I enabled a few maven report modules (code coverage, test/main javadocs, test/main source xref, surefire) and to keep things looking consistent, created a custom javadoc stylesheet which I had to write twice because <a href="http://stackoverflow.com/questions/13111512/javadoc-formatting-broken-since-upgrading-to-java-7">Oracle decided to completely change the javadoc element structure in Java 1.7 for no reason whatsoever</a>.</p>
<div id="attachment_1207" class="wp-caption aligncenter" style="width: 537px"><a href="http://code.randomnoun.com/bandcamp-api-client/apidocs/index.html"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/maven-skins2.png" alt="The standard javadoc stylesheet these days (lhs) versus the modified stylesheet (rhs)" width="527" height="205" class="size-full wp-image-1207" /></a><p class="wp-caption-text">The standard javadoc stylesheet these days (lhs) versus the modified stylesheet (rhs)</p></div>
<p>The site is hosted at <tt>http://code.randomnoun.com/<i>(module-name)</i></tt>, which in this case will be <a href="http://code.randomnoun.com/bandcamp-api-client">http://code.randomnoun.com/bandcamp-api-client</a>, and is updated automatically during release by the<br />
<code>scp://code.randomnoun.com/var/www/code.randomnoun.com/<i>(module-name)</i></code> reference in the<br />
<tt>project/distributionManagemenet/site/url</tt> element in the <a href="http://cvs.randomnoun.com/cvsweb/cvsweb.cgi/bandcamp-api-client/pom.xml?rev=1.53;content-type=text%2Fx-cvsweb-markup"><code>pom.xml</code></a>, which required a bit of <a href="http://stackoverflow.com/questions/4227119/maven-site-deploy-fails-with-scp-connection-refused-windows">stuffing</a> <a href="http://jira.codehaus.org/browse/MSITE-588">around</a> with <code>~/.m2/settings.xml</code> <a href="http://blog.sonatype.com/people/2009/11/nexus-tips-and-tricks-publishing-maven-sites-to-nexus-14/">server credentials</a> and buggerising up the SSH <code>known_hosts</code> and <code>authorized_keys</code> files between the build server and the web server holding the site, then <a href="http://leonard.io/blog/2011/04/configuring-the-maven-site-plugin-to-accept-scp-urls-for-sitedeploy/">re-adding support for the scp protcol</a> which was dropped by default in mvn 3.</p>
<h3>Create a public CVS repository</b> (accessible by both http and pserver protocols)</h3>
<h4>The way things used to be</h4>
<p>So this is how I normally access CVS, using a tube map metaphor, because I think it&#8217;s more entertaining than a <a href="http://en.wikipedia.org/wiki/Sequence_diagram">UML sequence diagram</a>, and it&#8217;s the only way I&#8217;m going to get remotely near a high speed train now that <a href="http://www.independentaustralia.net/Wordpress/wp-content/uploads/2013/04/FTTH.jpg">Tony Abbott is in power</a>. </p>
<div id="attachment_1168" class="wp-caption aligncenter" style="width: 580px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/internal-cvs-50-dev.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/internal-cvs-50-dev.png" alt="Access to CVS from machines within the randomnoun corporate firewall" width="570" height="110" class="size-full wp-image-1168" /></a><p class="wp-caption-text">Access to CVS from machines within the randomnoun corporate firewall</p></div>
<p>I, dear reader, am on the left hand side of this diagram, and wish to retrieve things from the CVS repository, on the right hand side. To do this I fire up my CVS client, point it at  <code>cvs.dev.randomnoun</code>, which is an <a href="http://en.wikipedia.org/wiki/Private_network">internal DNS record</a> resolving to 192.168.0.13, which connects to the <a href="http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.txt">standard port 2401</a>, which then serves up files from the <code>/var/lib/cvsd</code> folder of <code>bnedev03</code>, which is the VM that holds my sourcecode. </p>
<p>Notice the <code>.randomnoun</code> TLD, which is a measure I use to prevent internal URLs from leaking onto the internet (which usually end with, say, <code>.com</code> or <code>.au</code>).</p>
<h4>The way things are going to look from here on</h4>
<p>Because the SCM links in the <a href="http://cvs.randomnoun.com/cvsweb/cvsweb.cgi/bandcamp-api-client/pom.xml?rev=1.53;content-type=text%2Fx-cvsweb-markup"><code>pom.xml</code></a> are now public, I opted for creating a <i>separate read-only</i> CVS repository for things I&#8217;m making publicly available. </p>
<p>This allows me to avoid the horrible latency of cloud-based version control systems, whilst hopefully minimising any data leakage I&#8217;d otherwise suffer by hosting it inside the same cvs repository as <strike>the rest of my crap</strike> other modules of varying code quality. </p>
<p>I&#8217;ve created a new internal DNS entry (<code>cvs.randomnoun.com</code>) which resolves to the same IP address as above (192.168.0.13), and an external DNS entry of the same name (<code>cvs.randomnoun.com</code>) which resolves to my externally accessible IP (123.243.191.198). </p>
<p>The public CVS server sits on the same internal VM, but listens on a non-standard port (2402). External connection requests on port <code>123.243.191.198:2401</code> are routed to port <code>192.168.0.13:2402</code>. The read-only cvsd daemon has it&#8217;s repository refreshed periodically from the read/write cvsd by a cronjob on the cvs machine (from <code>/var/lib/cvsd</code> to <code>/var/lib/cvsd-public</code>):</p>
<div id="attachment_1169" class="wp-caption aligncenter" style="width: 570px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/external-cvs-50.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/external-cvs-50.png" alt="Access to CVS from machines outside the randomnoun corporate firewall" width="560" height="110" class="size-full wp-image-1169" /></a><p class="wp-caption-text">Access to CVS from machines outside the randomnoun corporate firewall. <br/>The fluffy cloud image above represents the <a href="http://www.zdnet.com/polaris-datacentre-traced-to-piller-1339310645/">smoke</a> and <a href="http://en.wikipedia.org/wiki/Fibre_Channel">mirrors</a> that constitute The Internet.</p></div>
<p>This has the advantage that:</p>
<ul>
<li>internal updates go to the read/write cvs repository, whereas
<li>external access use the same SCM URL, but is directed to the read-only cvs repository subset, where hopefully things are less likely to go pear-shaped.
</ul>
<p>Feel free to complain that I use the same tube station icons for processes, machines and file systems above, but let me point out that these are mostly virtual machines and virtual file systems, so it&#8217;s more similar under the hood than you might at first think <a name="fn1back" href="#fn1" class="footnoteref">[1]</a>.</p>
<p><!-- useless information that I might want later<br />
root@awssinprd01:/etc/init.d# socat TCP-LISTEN:2401,fork TCP:123.243.191.198:2401<br />
2013/08/26 21:15:08 socat[15961] E connect(3, AF=2 123.243.191.198:2401, 16): Connection refused<br />
--></p>
<p>You should be able to grab the source using the following anonymous checkout:</p>
<style>
.rn-bash {
  width:550px; overflow:scroll; border: dotted 1px black; padding: 5px; color:#3E5867; background-color: #F7F7F7; font-size: 8pt; font-family: Lucida Console, monospace; line-height: 1.2;
}
</style>
<pre class="rn-bash">
$ <b>cvs -d:pserver:anonymous@cvs.randomnoun.com:/randomnoun login</b>
Logging in to :pserver:anonymous@cvs.randomnoun.com:2401/randomnoun
CVS password:
cvs login: CVS password file /home/user/.cvspass does not exist - creating a new file
$ <b>cvs -d:pserver:anonymous@cvs.randomnoun.com:/randomnoun checkout bandcamp-api-client</b>
cvs checkout: Updating bandcamp-api-client
U bandcamp-api-client/.classpath
U bandcamp-api-client/.project
U bandcamp-api-client/pom.xml
cvs checkout: Updating bandcamp-api-client/.settings
...
$
</pre>
<p>There&#8217;s also a publicly visible <a href="http://www.freebsd.org/projects/cvsweb.html">cvsweb</a> installation running on the virtual host which I&#8217;ve set up at <a href="http://cvs.randomnoun.com/cvsweb/cvsweb.cgi/bandcamp-api-client/">http://cvs.randomnoun.com/cvsweb/cvsweb.cgi/bandcamp-api-client/</a>.</p>
<h3>Create some <a href="http://code.randomnoun.com/bandcamp-api-client/mail-lists.html">mailing lists</a></h3>
<p>Which is all a bit pointless in this day and age, but the apache maven modules have them so I thought I&#8217;d try to keep up with the Joneses. The mailing lists are run by <a href="http://www.gnu.org/software/mailman/">GNU Mailman</a> (<a href="https://help.ubuntu.com/community/Mailman">some instructions</a>, <a href="https://help.ubuntu.com/10.04/serverguide/mailman.html">some slightly different instructions</a> ), which involved setting it up and configuring a postfix virtual MX host out in The Cloud somewhere (<a href="http://www.gnu.org/software/mailman/mailman-install/postfix-virtual.html">part 1</a>, <a href="http://www.postfix.org/VIRTUAL_README.html#canonical">part 2</a>, <a href="http://www.howtoforge.com/how-to-install-and-configure-mailman-with-postfix-on-debian-squeeze-p2">part 3</a>).</p>
<p>The web interface to the bandcamp-api-client mailing list is <a href="http://lists.randomnoun.com/listinfo/bandcamp-api-client">hosted here</a>.</p>
<h3>Ignore the ciManagement bits</h3>
<p>Note that I&#8217;ve still got links to internal (<code>.dev.randomnoun</code>) JIRA/BAMBOO systems in the <a href="http://cvs.randomnoun.com/cvsweb/cvsweb.cgi/bandcamp-api-client/pom.xml?rev=1.53;content-type=text%2Fx-cvsweb-markup"><code>pom.xml</code></a>, but seeing as that metadata isn&#8217;t used in the build, I&#8217;m going to leave it for now.</p>
<h3>Create an account and raise a ticket on the <a href="https://issues.sonatype.org/browse/OSSRH">OSSRH JIRA</a>  (<a href="https://issues.sonatype.org/browse/OSSRH-7150">my ticket</a>)</h3>
<p>The steps to raise this ticket are listed at <a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide">https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide</a> .</p>
<p>I&#8217;m using the following settings:</p>
<style>
.left TR TH, .left TR TD { text-align: left; }
</style>
<table class="left">
<tr>
<th>summary:</th>
<td>bandcamp-api-client &#8211; Java bindings for the Bandcamp API</td>
</tr>
<tr>
<th>groupId:</th>
<td> com.randomnoun.bandcamp</td>
</tr>
<tr>
<th>project URL:</th>
<td> http://code.randomnoun.com/bandcamp-api-client</td>
</tr>
<tr>
<th>scm URL:</th>
<td>http://cvs.randomnoun.com/cvsweb/cvsweb.cgi/bandcamp-api-client</td>
</tr>
<tr>
<th>nexus username:</th>
<td>knoxg</td>
</tr>
<tr>
<th>already sync to central:</th>
<td>no</td>
</tr>
</table>
<p>The sonatype guys were pretty quick in creating access, which was nice. They also changed the applied groupId from &#8216;com.randomnoun.bandcamp&#8217; to &#8216;com.randomnoun&#8217;, which allows me to create new subgroups automatically; so the applied groupId appears should be the top-level writable groupId for an organisation, rather than the groupId used for an actual maven artifact.</p>
<h3>Create a PGP signing key.</h3>
<p>Using the instructions at <a href="http://maven.apache.org/developers/release/pmc-gpg-keys.html">http://maven.apache.org/developers/release/pmc-gpg-keys.html</a> , and <a href="https://docs.sonatype.org/display/Repository/How+To+Generate+PGP+Signatures+With+Maven">https://docs.sonatype.org/display/Repository/How+To+Generate+PGP+Signatures+With+Maven</a> , and being somewhat frustrated at the <a href="http://stackoverflow.com/questions/11708334/pgp-asymmetric-not-enough-random-bytes-available-please-do-some-other-work-to">mucking about required to generate the minimum levels of randomness required</a>. </p>
<p>I&#8217;ve decided to publish by keys into the <a href="https://bitbucket.org/skskeyserver/sks-keyserver/wiki/Home">SKS keyserver</a>, which is one of the servers checked by the OSSHP verification process.</p>
<pre class="rn-bash" style="height: 300px;">
knoxg@bnestg01:~$ <b>gpg --version</b>
gpg (GnuPG) 1.4.9
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Home: ~/.gnupg
Supported algorithms:
Pubkey: RSA, RSA-E, RSA-S, ELG-E, DSA
Cipher: 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH
Hash: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB, BZIP2
knoxg@bnestg01:~$
knoxg@bnestg01:~$ <b>gpg --list-keys</b>
gpg: directory `/home/knoxg/.gnupg' created
gpg: new configuration file `/home/knoxg/.gnupg/gpg.conf' created
gpg: WARNING: options in `/home/knoxg/.gnupg/gpg.conf' are not yet active during                                   this run
gpg: keyring `/home/knoxg/.gnupg/pubring.gpg' created
gpg: /home/knoxg/.gnupg/trustdb.gpg: trustdb created
knoxg@bnestg01:~$
knoxg@bnestg01:~$
knoxg@bnestg01:~$ <b>gpg --list-keys</b>
knoxg@bnestg01:~$ <b>gpg --gen-key --no-use-agent</b>
gpg (GnuPG) 1.4.9; Copyright (C) 2008 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Please select what kind of key you want:
   (1) DSA and Elgamal (default)
   (2) DSA (sign only)
   (5) RSA (sign only)
Your selection? <b>1</b>
DSA keypair will have 1024 bits.
ELG-E keys may be between 1024 and 4096 bits long.
What keysize do you want? (2048)
Requested keysize is 2048 bits
Please specify how long the key should be valid.
         0 = key does not expire
      <n>  = key expires in n days
      <n>w = key expires in n weeks
      <n>m = key expires in n months
      <n>y = key expires in n years
Key is valid for? (0) <b>0</b>
Key does not expire at all
Is this correct? (y/N) <b>y</b>

You need a user ID to identify your key; the software constructs the user ID
from the Real Name, Comment and Email Address in this form:
    "Heinrich Heine (Der Dichter) <heinrichh@duesseldorf.de>"

Real name: <b>Greg Knox</b>
Email address: <b>knoxg@randomnoun.com</b>
Comment:
You selected this USER-ID:
    "Greg Knox <knoxg@randomnoun.com>"

Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? <b>O</b>
You need a Passphrase to protect your secret key.

You don't want a passphrase - this is probably a *bad* idea!
I will do it anyway.  You can change your passphrase at any time,
using this program with the option "--edit-key".

We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
+++++++++++++++++++++++++..++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++.+++++++++++++++++++++++++++++++++++.++++++++++>++++++++++.............+++++

Not enough random bytes available.  Please do some other work to give
the OS a chance to collect more entropy! (Need 300 more bytes)
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
+++++..+++++.+++++.+++++..+++++.+++++.+++++.+++++++++++++++...+++++.+++++..+++++..+++++++++++++++.+++++++++++++++.+++++..+++++++++++++++.++++++++++.+++++.++++++++++.+++++>++++++++++......................................................................+++++^^^
gpg: key A21A1486 marked as ultimately trusted
public and secret key created and signed.

gpg: checking the trustdb
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
pub   1024D/A21A1486 2013-08-26
      Key fingerprint = A411 49F8 40FD A387 DF86  94F1 443D 95BD A21A 1486
uid                  Greg Knox <knoxg@randomnoun.com>
sub   2048g/9A7FC682 2013-08-26

knoxg@bnestg01:~$ <b>gpg --list-keys</b>
/home/knoxg/.gnupg/pubring.gpg
------------------------------
pub   1024D/A21A1486 2013-08-26
uid                  Greg Knox <knoxg@randomnoun.com>
sub   2048g/9A7FC682 2013-08-26

knoxg@bnestg01:~$ <b>gpg --list-secret-keys</b>
/home/knoxg/.gnupg/secring.gpg
------------------------------
sec   1024D/A21A1486 2013-08-26
uid                  Greg Knox <knoxg@randomnoun.com>
ssb   2048g/9A7FC682 2013-08-26

knoxg@bnestg01:~$
knoxg@bnestg01:~$ <b>gpg --edit-key A21A1486</b>
gpg (GnuPG) 1.4.9; Copyright (C) 2008 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Secret key is available.

pub  1024D/A21A1486  created: 2013-08-26  expires: never       usage: SC
                     trust: ultimate      validity: ultimate
sub  2048g/9A7FC682  created: 2013-08-26  expires: never       usage: E
[ultimate] (1). Greg Knox <knoxg@randomnoun.com>

Command> <b>quit</b>

knoxg@bnestg01:~$ <b>gpg --keyserver hkp://pool.sks-keyservers.net --send-keys A21A1486</b>
gpg: sending key A21A1486 to hkp server pool.sks-keyservers.net
knoxg@bnestg01:~$

</pre>
<p>Once you&#8217;ve got a PGP signature, add it to your build using the <a href="https://docs.sonatype.org/display/Repository/How+To+Generate+PGP+Signatures+With+Maven#HowToGeneratePGPSignaturesWithMaven-MavenGPGPlugin">instructions here</a>. </p>
<div class="stripey-sidebox">
If you&#8217;re anything like me, then you&#8217;ll find that you&#8217;ll need to completely rebuild your staging server with new versions of Java and Maven, but that&#8217;s OK since it was running an old, unsupported version of <a href="http://www.debian.org/releases/lenny/">Debian Lenny</a>, so you probably needed to get round to doing that anyway.
</div>
<p>You&#8217;ll probably also find yourself trying a few dozen ways of getting that plugin to work, before realising that you need to add some <a href="http://stackoverflow.com/questions/14114528/avoid-gpg-signing-prompt-when-using-maven-release-plugin">undocumented elements</a> to your <code>~/.m2/settings.xml</code> file. </p>
<h3>Copy into the OSSRH staging repository</h3>
<p>Since you&#8217;re using maven, you&#8217;ve probably already got some horribly complex build process surrounding it just to make it more manageable. I use vmaint. It&#8217;s tops.</p>
<p>The steps you want to add to your release process should be something similar to the following:</p>
<ul>
<li>Copy all the artifacts you&#8217;ve built into a temporary directory (because <a href="http://stackoverflow.com/questions/9343192/unable-to-install-a-local-maven-artefact-to-remote-repository-google-android-ma">maven doesn&#8217;t let you deploy from your local repository</a>)
<li>Run these commands:
<pre class="rn-bash">knoxg@bnestg01:~$ <b>/usr/bin/mvn --batch-mode -Durl=https://oss.sonatype.org/service/local/staging/deploy/maven2/ -DrepositoryId=sonatype-nexus-staging -DpomFile=/tmp/bandcamp-api-client-0.0.14.pom -Dfile=/tmp/bandcamp-api-client-0.0.14.jar gpg:sign-and-deploy-file</b>
knoxg@bnestg01:~$ <b>/usr/bin/mvn --batch-mode -Durl=https://oss.sonatype.org/service/local/staging/deploy/maven2/ -DrepositoryId=sonatype-nexus-staging -DpomFile=/tmp/bandcamp-api-client-0.0.14.pom -Dfile=/tmp/bandcamp-api-client-0.0.14-sources.jar -Dclassifier=sources gpg:sign-and-deploy-file</b>
knoxg@bnestg01:~$ <b>/usr/bin/mvn --batch-mode -Durl=https://oss.sonatype.org/service/local/staging/deploy/maven2/ -DrepositoryId=sonatype-nexus-staging -DpomFile=/tmp/bandcamp-api-client-0.0.14.pom -Dfile=/tmp/bandcamp-api-client-0.0.14-javadoc.jar -Dclassifier=javadoc gpg:sign-and-deploy-file</b>
</pre>
</ul>
<p>Alternatively, you can use the <a href="https://oss.sonatype.org/index.html#staging-upload">web interface</a> to manually upload the artifacts to the staging repository. <a href="http://books.sonatype.com/nexus-book/reference/staging-sect-intro.html">Here&#8217;s some background information</a> on staging repositories if you&#8217;re interested.</p>
<h3>Close and release the OSSRH staging repository</h3>
<ul>
<li>log into the <a href="https://oss.sonatype.org">OSSRH Nexus repository</a>
<li>check that the staging repository exists and has the files you uploaded (in this case, the pom, client jar, the sources jar and the javadoc jar)
<li>select your staging repository and click the &#8216;Close&#8217; button on the toolbar
<li>type a message into the &#8216;Close Confirmation&#8217; box
<li>check that the Central Sync Requirement Rules have passed
<li>click the &#8216;Refresh&#8217; button on the toolbar, which should then allow you to
<li>select your staging repository and click the &#8216;Release&#8217; button on the toolbar
<li>type a message into the &#8216;Release Confirmation&#8217; box. If the &#8216;Automatically drop&#8217; checkbox is selected (which it is by default), then your staging repository will be removed from the list after it has been released (it will still get synced to central though).
</ul>
<p>These steps are shown in the screenshots below (click each screenshot for a closer look):</p>
<div>
<div id="attachment_1226" class="wp-caption alignleft" style="width: 231px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-1.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-1.png" alt="1) Check files for release" width="221" height="167" class="size-full wp-image-1226" /></a><p class="wp-caption-text">1) Check files for release</p></div><div id="attachment_1227" class="wp-caption alignleft" style="width: 231px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-2.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-2.png" alt="2) Close confirmation" width="221" height="167" class="size-full wp-image-1227" /></a><p class="wp-caption-text">2) Close confirmation</p></div><div id="attachment_1228" class="wp-caption alignleft" style="width: 231px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-3.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-3.png" alt="3) Closed repository activity tab" width="221" height="167" class="size-full wp-image-1228" /></a><p class="wp-caption-text">3) Closed repository activity tab</p></div><div id="attachment_1229" class="wp-caption alignleft" style="width: 231px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-4.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-4.png" alt="4) Release confirmation" width="221" height="167" class="size-full wp-image-1229" /></a><p class="wp-caption-text">4) Release confirmation</p></div><div id="attachment_1230" class="wp-caption alignleft" style="width: 231px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-5.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/09/ossrh-release-5.png" alt="5) Released repository activity tab (in-progress)" width="221" height="167" class="size-full wp-image-1230" /></a><p class="wp-caption-text">5) Released repository activity tab (in-progress)</p></div>
</div>
<p><br style="clear:left;"/><br />
If everything doesn&#8217;t go hunkydory (say you&#8217;ve forgotten to document a class, include all the required licenses, or you&#8217;ve inadvertently left an API key in the sourcecode), just click the &#8216;Drop&#8217; button on the toolbar, fix the problem, re-release and deploy it to the staging repository, and repeat until everything&#8217;s looking better than average.</p>
<p>Once you&#8217;ve gone through that, all thats left is to <a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide#SonatypeOSSMavenRepositoryUsageGuide-8a.ReleaseIt">wait two hours</a>, and see if it&#8217;s appeared in the central repository. (If you like, you can use that two hours to construct a list of verbs that convey the concept of copying a file).</p>
<p>For what it&#8217;s worth, the <a href="http://central.maven.org/maven2/com/randomnoun/bandcamp/bandcamp-api-client/0.0.15">nginx index page</a> at central appears to come up pretty quickly, but the <a href="http://repo1.maven.org/maven2/com/randomnoun/bandcamp/bandcamp-api-client/0.0.15/bandcamp-api-client-0.0.15.jar">artifact itself</a> takes a little longer to become available.</p>
<h3>Update the <a href="https://issues.sonatype.org/browse/OSSRH-7150">OSSRH JIRA ticket</a></h3>
<p>I believe this only needs to be done after the first artifact, not for subsequent artifacts. </p>
<h3>That&#8217;s it</h3>
<p>So there you go. Including the  <code><b>com.randomnoun.bandcamp</b>:<b>bandcamp-api-client</b></code> dependency from any old <code>pom.xml</code> file should now cause maven to automatically download the artifact for you. </p>
<p>The release I&#8217;ve put up there (<code>0.0.15</code>) is reasonably complete, and should work, but will probably get a few more small changes as I come to grips with this whole central repository release process before I bump it to <code>1.0.0</code>.</p>
<p>You&#8217;d be surprised how long that took to complete.</p>
<div class="stripey-sidebox">
<p>The bandcamp artifact mentioned above is now part of the <tt><b>com.randomnoun.bandcamp:bandcamp-api-client</b></tt> artifact, which can be directly referenced in your <code>pom.xml</code> from the maven central repository. </p>
<p>
<div class="maven-button"><a href="http://code.randomnoun.com/bandcamp-api-client"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/09/maven-ball-42.png" width="42" height="42" style="margin: 5px; float:left;"/></a><a href="http://code.randomnoun.com/bandcamp-api-client">
<div class="big">bandcamp-api-client</div>
<div class="small">com.randomnoun.bandcamp:bandcamp-api-client</div>
<p></a></div>
</div>
<div class="stripey-sidebox">
<p>The Doxia HTML module mentioned above is now available via the <tt><b>com.randomnoun.maven.doxia:doxia-module-html</b></tt> artifact, which can also be directly referenced in your <code>pom.xml</code> from the maven central repository. </p>
<p>
<div class="maven-button"><a href="http://code.randomnoun.com/doxia-module-html"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/09/maven-ball-42.png" width="42" height="42" style="margin: 5px; float:left;"/></a><a href="http://code.randomnoun.com/doxia-module-html">
<div class="big">doxia-module-html</div>
<div class="small">com.randomnoun.maven.doxia:doxia-module-html</div>
<p></a></div>
</div>
<p><b>Update 25/9/2013</b>: It&#8217;s in central now</p>
<div class="footnoteline"></div>
<p><a name="fn1" href="#fn1back">[1]</a> If I&#8217;d thought about this a fraction of a second more, I would have made bnedev03 appear on the tube map as &#8216;zone 1&#8242; and external access out in the wilderness of &#8216;zone 2&#8242; somewhere.</p>
<p><a name="fn2" href="#fn2back">[2]</a> I still needed to learn <a href="http://velocity.apache.org/">Apache Velocity</a> though, which is possibly the worst templating language that has ever been devised. The Doxia Sink doesn&#8217;t allow advanced HTML usage, like, say, a DIV element contained within another DIV element, so you get to do all sorts of creative things with the <a href="http://maven.apache.org/doxia/doxia/doxia-core/apidocs/org/apache/maven/doxia/parser/XhtmlBaseParser.html">handful of HTML elements it does recognise</a>, which is the sort of constructive back-bending effort that will be familiar to anyone who has ever tried to write a page that renders correctly in more than two types of browser.</p>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2013/09/11/getting-an-artifact-into-the-maven-central-repository/#comments" title="Comment on Getting an artifact into the maven central repository">2 comments</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/bandcamp-api-client/" rel="tag">bandcamp-api-client</a> <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a> <a href="http://www.randomnoun.com/wp/tag/maven/" rel="tag">maven</a></p>      </div>
		</div>

				<div class="post-103 post type-post status-publish format-standard hentry category-uncategorized tag-java tag-maven">
			<h2 id="post-103"><a href="http://www.randomnoun.com/wp/2013/06/30/maven/" rel="bookmark" title="Permanent Link to Maven">Maven</a></h2>
			<small class="meta">June 30th, 2013 </small>

			<div class="entry">
				<p>God I hate maven. </p>
<p><a href="http://www.jillesvangurp.com/2009/10/16/maven-good-ideas-gone-wrong/">I&#8217;m not</a> <a href="http://japgolly.blogspot.com.au/2012/11/rant-stupid-maven.html">the only</a> <a href="http://amplicate.com/hate/maven">one who</a> <a href="http://stackoverflow.com/questions/861382/why-does-maven-have-such-a-bad-rep">feels</a> <a href="http://kent.spillner.org/blog/work/2009/11/14/java-build-tools.html">this way</a>, either.</p>
<p>Let me count the ways.</p>
<ol>
<li>The syntax is verbose, obfuscated and generally horrible.</li>
<li>It&#8217;s incredibly <a href="http://zeroturnaround.com/rebellabs/the-build-tool-report-turnaround-times-using-ant-maven-eclipse-intellij-and-netbeans/">slow and inefficient</a></li>
<li>The <a href="http://www.sonatype.org/m2eclipse">IDE integration</a> is incredibly slow and inefficient</li>
<li>The maven release process</li>
<li>There appears to be no minimum standard for artifacts uploaded to the central repository</li>
<li>Naming conventions are stuffed</li>
<li>Dependency tracking is stuffed</li>
<li>Reinvention of URLs (and I&#8217;m thinking of the scm element here), &#8216;wagons&#8217;, &#8216;mojos&#8217;, &#8216;goals&#8217; and any other concept that they feel deserves new terminology.
<li>The 50 or so mvn component JARs it downloads the first time you run it.</li>
</ol>
<p>The only thing it&#8217;s got going for it is the central repository, and the possibility of storing project metadata is a standardised way. The rest of it is pure unadulterated poo.</p>
<p>At any rate, this is just a short entry to make up for the fact that I haven&#8217;t updated this blog since April.</p>
<p>Later on I might write a stanza on each of the points above, but I was just doing a bit of hacking and rediscovered my loathing of this thing and needed to vent.</p>
<p>It does work, I suppose. Eventually. </p>
<p>It could be worse. I could be trying to <a href="http://www.gnu.org/software/autoconf/">GNU autoconf</a> this thing.</p>
<p>Anyway I promise I&#8217;ll write something vaguely constructive the next time I update this site.</p>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2013/06/30/maven/#comments" title="Comment on Maven">1 comment</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a> <a href="http://www.randomnoun.com/wp/tag/maven/" rel="tag">maven</a></p>      </div>
		</div>

				<div class="post-108 post type-post status-publish format-standard hentry category-uncategorized tag-java tag-xml">
			<h2 id="post-108"><a href="http://www.randomnoun.com/wp/2013/01/25/exciting-things-with-xml/" rel="bookmark" title="Permanent Link to Exciting things with XML">Exciting things with XML</a></h2>
			<small class="meta">January 25th, 2013 </small>

			<div class="entry">
				<p>So <a href="http://www.w3.org/TR/REC-xml/">XML</a> exists, and you probably have to deal with it occasionally.</p>
<p>It&#8217;s a bit more complex than a CSV or a fixed-width file, so an enormous number of people have created an even greater number of toolkits to help you read and write the things. </p>
<div id="attachment_259" class="wp-caption alignright" style="width: 210px"><a href="http://www.randomnoun.com/wp/wp-content/uploads/2013/01/LG-P930-xml-profile.png"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/01/LG-P930-xml-profile.png" alt="Some chunk of XML" width="200" class="size-full wp-image-259" /></a><p class="wp-caption-text">Some generic chunk of XML</p></div>
<p>What the industry standard appears to be is to create a toolkit that implements half of the XML standard, and then drop that and start another which has a different, but overlapping subset of supported features.</p>
<p>If you&#8217;re a member of the W3C consortium, you probably want to have several different XML implementations, with a whole raft of <a href="http://docs.oracle.com/javase/1.4.2/docs/api/javax/xml/transform/sax/SAXTransformerFactory.html">SAXTransformerFactory</a>&#8216;s and <a href="http://docs.oracle.com/javase/1.5.0/docs/api/org/w3c/dom/bootstrap/DOMImplementationRegistry.html">DOMImplementationRegistry</a>&#8216;s just to work out which implementation to use, none of which really work, but that&#8217;s the sort of thing that keeps committees busy. </p>
<p>Why not use XmlUtil ? I know I certainly do. Especially in <a href="http://www.randomnoun.com/wp/2012/12/26/automating-windows-from-java-and-windowtreedom/">that example from a few weeks ago</a>.</p>
<p>It has the following methods, which I will explain briefly in the bit below this bit.</p>
<ul>
<li><code>getCleanXml</code></li>
<li><code>getText</code></li>
<li><code>getTextPreserveElements</code></li>
<li><code>getTextNonRecursive</code></li>
<li><code>getXmlString</code></li>
<li><code>toDocument</code></li>
<li><code>compact</code></li>
<li><code>processContentHandler</code></li>
<li><code>static inner class SimpleTableContentHandler</code></li>
<li><code>static inner class AbstractStackContentHandler</code></li>
<li><code>static inner class NodeListIterator</code></li>
</ul>
<h3>getCleanXml</h3>
<p>This method runs a document through <a href="http://ccil.org/~cowan/XML/tagsoup/">tagsoup</a> to get an &#8216;XML-clean&#8217; document. </p>
<p>A fairly common use-case for me is having some a fairly horrible looking bit of HTML taken from the wastelands of the internet, and wanting to extract some data from it. </p>
<p>The <a href="http://ccil.org/~cowan/XML/tagsoup/">tagsoup library</a> does a fairly decent job of cleaning up things that look like HTML so that it starts to approach something that more closely resembles XML.</p>
<p>It&#8217;s a useful first step before performing XPath-style data extraction, or before attempting to modify a webpage to pass the <a href="http://validator.w3.org/">W3C validator</a>. Which is the sort of thing that <a href="http://en.wikipedia.org/wiki/Search_engine_optimization">SEO companies</a> think gives you google brownie points.</p>
<div class="stripey-sidebox">
Incidentally, if you search for &#8220;SEO company&#8221; on google, you get about 93,900,000 results. What I want to know is why aren&#8217;t they all on the first page of results ?</p>
<p>I have my own views on search-engine optimisation, which are that:</p>
<ul>
<li> google knows what you&#8217;re searching for
<li> google knows when you stop searching for it
<li> google probably knows therefore whether a website is a good result for a particular search query or not
</ul>
<p>which, you&#8217;ll notice, doesn&#8217;t involve the phrase &#8216;meta tags&#8217; anywhere in it. </p>
<p>You can send my $20,000 fee to the usual account.</p>
<p>On a slightly more conspiratorial note,</p>
<ul>
<li> google is aware of your IP address
<li> google is therefore more likely to show you your own &#8216;ads&#8217; that you&#8217;ve purchased on it&#8217;s network
<li> which is therefore more likely to get you to throw more money at google seeing as it&#8217;s doing such a good job getting your extra-specially-important site at the top of those search results
</ul>
<p>That was a bit of a longer side-rant than I thought it would be. I might move this bit into a separate blog entry. Maybe. Later.
</p></div>
<p>So anyway, this is how you&#8217;d use this <code>getCleanXml</code> thing:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// uses the Scanner trick from http://weblogs.java.net/blog/pat/archive/2004/10/stupid_scanner.html</span>
<span style="color: #003399;">String</span> rubbishHtml <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Scanner<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">URL</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;http://www.microsoft.com&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">openStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, 
  <span style="color: #0000ff;">&quot;UTF-8&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">useDelimiter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>A&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">next</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="display:block;background-color: #ffc;"><span style="color: #003399;">String</span> cleanXml <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>rubbishHtml, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></span><span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>cleanXml<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Element</span> titleEl <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> XPathAPI.<span style="color: #006633;">selectSingleNode</span><span style="color: #009900;">&#40;</span>d, <span style="color: #0000ff;">&quot;/html/head/title&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<h3>getText</h3>
<p><code>getText()</code> returns the text between an opening and closing element in an XML document.</p>
<p>So extending the example above:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// uses the Scanner trick from http://weblogs.java.net/blog/pat/archive/2004/10/stupid_scanner.html</span>
<span style="color: #003399;">String</span> rubbishHtml <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Scanner<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">URL</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;http://www.microsoft.com&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">openStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, 
  <span style="color: #0000ff;">&quot;UTF-8&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">useDelimiter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>A&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">next</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">String</span> cleanXml <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>rubbishHtml, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>cleanXml<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Element</span> titleEl <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> XPathAPI.<span style="color: #006633;">selectSingleNode</span><span style="color: #009900;">&#40;</span>d, <span style="color: #0000ff;">&quot;/html/head/title&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="display:block;background-color: #ffc;"><span style="color: #003399;">String</span> title <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getText</span><span style="color: #009900;">&#40;</span>titleEl<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></span><span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>title<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>currently generates</p>
<pre>
Microsoft Australia | Devices and Services
</pre>
<p><br/>with <a href="http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454">nary a regex</a> in sight.</p>
<h3>getTextPreserveElements</h3>
<p>Same as <code>getText()</code>, but allows a predefined list of tags to be returned as well.</p>
<p>This is useful when processing formatted text in which you might want to keep certain tags (B, I, IMG etc)</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #003399;">String</span> input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;p&gt;Here is some formatted text &lt;b&gt;in bold&lt;/b&gt;, &lt;i&gt;in italics&lt;/i&gt;,&quot;</span> <span style="color: #339933;">+</span>
  <span style="color: #0000ff;">&quot; &lt;blink&gt;blinking&lt;/blink&gt;, and with an image at the end &lt;img src=<span style="color: #000099; font-weight: bold;">\&quot;</span>frog.png<span style="color: #000099; font-weight: bold;">\&quot;</span>/&gt;&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Element</span> paraEl <span style="color: #339933;">=</span> d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getText</span><span style="color: #009900;">&#40;</span>paraEl<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="display:block;background-color: #ffc;"><span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getTextPreserveElements</span><span style="color: #009900;">&#40;</span>paraEl, </span>  <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">&quot;b&quot;</span>, <span style="color: #0000ff;">&quot;i&quot;</span>, <span style="color: #0000ff;">&quot;img&quot;</span> <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>which would give you something like</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="txt" style="font-family:monospace;">Here is some formatted text in bold, in italics, blinking, and with an image at the end 
Here is some formatted text &lt;b&gt;in bold&lt;/b&gt;, &lt;i&gt;in italics&lt;/i&gt;, blinking, and with an image at the end &lt;img src=&quot;frog.png&quot;&gt;&lt;/img&gt;</pre></td></tr></table></div>

<h3>getTextNonRecursive</h3>
<p>Same as getText(), but doesn&#8217;t attempt to recurse into child elements within the parent XML element</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #003399;">String</span> input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;p&gt;This is the bit we're interested in &lt;span&gt;but not this bit&lt;/span&gt;&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Element</span> paraEl <span style="color: #339933;">=</span> d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getText</span><span style="color: #009900;">&#40;</span>paraEl<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="display:block;background-color: #ffc;"><span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getTextNonRecursive</span><span style="color: #009900;">&#40;</span>paraEl<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></span></pre></td></tr></table></div>


<div class="wp_syntax"><table><tr><td class="code"><pre class="txt" style="font-family:monospace;">This is the bit we're interested in but not this bit
This is the bit we're interested in</pre></td></tr></table></div>

<h3>getXmlString</h3>
<p>Converts a Document into a String. As in the following example, which attempts to extract the &#8216;keywords&#8217; and &#8216;description&#8217; meta tag elements from google&#8217;s home page, and send them to stdout.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #003399;">String</span> rubbishHtml <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Scanner<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">URL</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;http://www.google.com&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">openStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, 
  <span style="color: #0000ff;">&quot;UTF-8&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">useDelimiter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>A&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">next</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">String</span> cleanXml <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>rubbishHtml, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>cleanXml<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
NodeList nodes <span style="color: #339933;">=</span> XPathAPI.<span style="color: #006633;">selectNodeList</span><span style="color: #009900;">&#40;</span>d, <span style="color: #0000ff;">&quot;/html/head/meta&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>nodes.<span style="color: #006633;">getLength</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>i <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;: &quot;</span> <span style="color: #339933;">+</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>nodes.<span style="color: #006633;">item</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span>,  <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>

<p>which currently, and not too surprisingly, generates:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="txt" style="font-family:monospace;">0: &lt;meta content=&quot;/images/google_favicon_128.png&quot; itemprop=&quot;image&quot;/&gt;</pre></td></tr></table></div>

<p>It&#8217;s amazing that anyone can find them, really.</p>
<h3>toDocument</h3>
<p>Converts a String into a W3C Document object</p>
<p>Most of the examples above use this method, so hopefully you get the idea</p>
<h3>compact</h3>
<p>Removes whitespace surrounding text nodes contained within an Element</p>
<p>Such as this attempt to generate the <a href="http://www.cliffsnotes.com/">Cliff&#8217;s notes</a> for <a href="http://en.wikipedia.org/wiki/All%27s_Well_That_Ends_Well">All&#8217;s Well That End&#8217;s Well</a>:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// from http://www.ibiblio.org/xml/examples/shakespeare/all_well.xml</span>
<span style="color: #003399;">String</span> input <span style="color: #339933;">=</span> 
	<span style="color: #0000ff;">&quot;&lt;PERSONAE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;TITLE&gt;Dramatis Personae&lt;/TITLE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;KING OF FRANCE&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;DUKE OF FLORENCE&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;BERTRAM, Count of Rousillon.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;LAFEU, an old lord.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;PAROLLES, a follower of Bertram.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PGROUP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;        &lt;PERSONA&gt;Steward&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;        &lt;PERSONA&gt;Clown&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;        &lt;GRPDESCR&gt;servants to the Countess of Rousillon.&lt;/GRPDESCR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;/PGROUP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;A Page. &lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;COUNTESS OF ROUSILLON, mother to Bertram. &lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;HELENA, a gentlewoman protected by the Countess.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;An old Widow of Florence. &lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;DIANA, daughter to the Widow.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PGROUP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;        &lt;PERSONA&gt;VIOLENTA&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;        &lt;PERSONA&gt;MARIANA&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;        &lt;GRPDESCR&gt;neighbours and friends to the Widow.&lt;/GRPDESCR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;/PGROUP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;Lords, Officers, Soldiers, &amp;amp;c., French and Florentine.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
	<span style="color: #0000ff;">&quot;&lt;/PERSONAE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Before compact():&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>d, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="display:block;background-color: #ffc;">XmlUtil.<span style="color: #006633;">compact</span><span style="color: #009900;">&#40;</span>d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></span><span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;And after compact(), the much more readable:&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>d, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>which generates:</p>
<pre style="font-size: 9pt;">
Before compact():
&lt;PERSONAE>
    &lt;TITLE>Dramatis Personae&lt;/TITLE>
    
    &lt;PERSONA>KING OF FRANCE&lt;/PERSONA>
    &lt;PERSONA>DUKE OF FLORENCE&lt;/PERSONA>
    &lt;PERSONA>BERTRAM, Count of Rousillon.&lt;/PERSONA>
    &lt;PERSONA>LAFEU, an old lord.&lt;/PERSONA>
    &lt;PERSONA>PAROLLES, a follower of Bertram.&lt;/PERSONA>
    
    &lt;PGROUP>
        &lt;PERSONA>Steward&lt;/PERSONA>
        &lt;PERSONA>Clown&lt;/PERSONA>
        &lt;GRPDESCR>servants to the Countess of Rousillon.&lt;/GRPDESCR>
    &lt;/PGROUP>
    
    &lt;PERSONA>A Page. &lt;/PERSONA>
    &lt;PERSONA>COUNTESS OF ROUSILLON, mother to Bertram. &lt;/PERSONA>
    &lt;PERSONA>HELENA, a gentlewoman protected by the Countess.&lt;/PERSONA>
    &lt;PERSONA>An old Widow of Florence. &lt;/PERSONA>
    &lt;PERSONA>DIANA, daughter to the Widow.&lt;/PERSONA>
    
    &lt;PGROUP>
        &lt;PERSONA>VIOLENTA&lt;/PERSONA>
        &lt;PERSONA>MARIANA&lt;/PERSONA>
        &lt;GRPDESCR>neighbours and friends to the Widow.&lt;/GRPDESCR>
    &lt;/PGROUP>
    
    &lt;PERSONA>Lords, Officers, Soldiers, &amp;c., French and Florentine.&lt;/PERSONA>
&lt;/PERSONAE>

And after compact(), the much more readable:
<span class="wrapped">
&lt;PERSONAE>&lt;TITLE>Dramatis Personae&lt;/TITLE>&lt;PERSONA>KING OF FRANCE&lt;/PERSONA>&lt;PERSONA>DUKE OF FLORENCE&lt;/PERSONA>&lt;PERSONA>BERTRAM, Count of Rousillon.&lt;/PERSONA>&lt;PERSONA>LAFEU, an old lord.&lt;/PERSONA>&lt;PERSONA>PAROLLES, a follower of Bertram.&lt;/PERSONA>&lt;PGROUP>&lt;PERSONA>Steward&lt;/PERSONA>&lt;PERSONA>Clown&lt;/PERSONA>&lt;GRPDESCR>servants to the Countess of Rousillon.&lt;/GRPDESCR>&lt;/PGROUP>&lt;PERSONA>A Page.&lt;/PERSONA>&lt;PERSONA>COUNTESS OF ROUSILLON, mother to Bertram.&lt;/PERSONA>&lt;PERSONA>HELENA, a gentlewoman protected by the Countess.&lt;/PERSONA>&lt;PERSONA>An old Widow of Florence.&lt;/PERSONA>&lt;PERSONA>DIANA, daughter to the Widow.&lt;/PERSONA>&lt;PGROUP>&lt;PERSONA>VIOLENTA&lt;/PERSONA>&lt;PERSONA>MARIANA&lt;/PERSONA>&lt;GRPDESCR>neighbours and friends to the Widow.&lt;/GRPDESCR>&lt;/PGROUP>&lt;PERSONA>Lords, Officers, Soldiers, &amp;c., French and Florentine.&lt;/PERSONA>&lt;/PERSONAE>
</span>
</pre>
<h3>processContentHandler</h3>
<p>Runs a SAX ContentHandler over a Document</p>
<p>You need a ContentHandler in order to process it, so why not keep reading to see an example of one of those.</p>
<h3>Class SimpleTableContentHandler</h3>
<p>A simple ContentHandler that parses data from a HTML table (into a List of Lists).</p>
<p>The example here parses the currency exchange tables from <a href="http://www.xe.com/currencytables/?from=AUD&#038;date=2012-01-01">xe.com</a>, and selects a currency using <i>polar method</i> of G. E. P. Box, M. E. Muller, and G. Marsaglia, as described by Donald E. Knuth in <a href="http://booko.com.au/works/20512"><i>The Art of Computer Programming</i>, Volume 3: <i>Seminumerical Algorithms</i></a>, section 3.4.1, subsection C, algorithm P.</p>
<p>It then goes on tell you whether you&#8217;d have made a profit or loss by selling that currency 12 months later.</p>
<p><br/></p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> getCurrencyRates<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> date<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">MalformedURLException</span>, <span style="color: #003399;">IOException</span>, SAXException, TransformerException <span style="color: #009900;">&#123;</span>
	<span style="color: #666666; font-style: italic;">// this doesn't actually work due to http://www.xe.com/errors/noautoextract.htm</span>
	<span style="color: #666666; font-style: italic;">// but I'm sure you enterprising types can get around that</span>
	<span style="color: #003399;">String</span> url <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;http://www.xe.com/currencytables/?from=AUD&amp;date=&quot;</span> <span style="color: #339933;">+</span> date<span style="color: #339933;">;</span>
	<span style="color: #003399;">String</span> rubbishHtml <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Scanner<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">URL</span><span style="color: #009900;">&#40;</span>url<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">openStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, 
	  <span style="color: #0000ff;">&quot;UTF-8&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">useDelimiter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>A&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">next</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">// hint:</span>
	<span style="color: #666666; font-style: italic;">// String rubbishHtml = Text.getFileContents(date.equals(&quot;2012-01-01&quot;) ? &quot;c:\\rate1.txt&quot; : &quot;c:\\rate2.txt&quot;);</span>
	<span style="color: #003399;">String</span> cleanXml <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>rubbishHtml, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>cleanXml<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #003399;">Element</span> tableEl <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> XPathAPI.<span style="color: #006633;">selectSingleNode</span><span style="color: #009900;">&#40;</span>d, <span style="color: #0000ff;">&quot;.//table[@id=<span style="color: #000099; font-weight: bold;">\&quot;</span>historicalRateTbl<span style="color: #000099; font-weight: bold;">\&quot;</span>]&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="display:block;background-color: #ffc;">	XmlUtil.<span style="color: #006633;">SimpleTableContentHandler</span> stch <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> XmlUtil.<span style="color: #006633;">SimpleTableContentHandler</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></span>	XmlUtil.<span style="color: #006633;">processContentHandler</span><span style="color: #009900;">&#40;</span>stch, XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>tableEl, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> table <span style="color: #339933;">=</span> stch.<span style="color: #006633;">getTable</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">return</span> table<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// see what amount of abstract currency units you can get in exchange for</span>
<span style="color: #666666; font-style: italic;">// the shiny Australian cylinder with a kangaroo on it.</span>
List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> startTable <span style="color: #339933;">=</span> getCurrencyRates<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;2012-01-01&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> endTable <span style="color: #339933;">=</span> getCurrencyRates<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;2013-01-01&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// pick an investment strategy</span>
<span style="color: #000066; font-weight: bold;">int</span> tradingOption <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Math</span>.<span style="color: #006633;">random</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">nextGaussian</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">*</span> startTable.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// sanity check that the row with the same index in each table contains the same currency</span>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>startTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span>endTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">RuntimeException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Rate tables don't line up&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;You're investing in the &quot;</span> <span style="color: #339933;">+</span> startTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Of which you could pick up &quot;</span> <span style="color: #339933;">+</span> startTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; for a measly AUD$1 way back in 2012&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;and then sell for AUD$&quot;</span> <span style="color: #339933;">+</span> endTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; each barely a year later&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// and then let's pretend that xe.com is accurate, and that rounding, </span>
<span style="color: #666666; font-style: italic;">// buy/sell prices and transaction costs don't exist</span>
<span style="color: #003399;">BigDecimal</span> bd <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">BigDecimal</span><span style="color: #009900;">&#40;</span>startTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">BigDecimal</span> bd2 <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">BigDecimal</span><span style="color: #009900;">&#40;</span>endTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">BigDecimal</span> val <span style="color: #339933;">=</span> bd.<span style="color: #006633;">multiply</span><span style="color: #009900;">&#40;</span>bd2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;landing you AUD$&quot;</span> <span style="color: #339933;">+</span> val<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>val.<span style="color: #006633;">compareTo</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">BigDecimal</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span> <span style="color: #339933;">?</span> <span style="color: #0000ff;">&quot;Winner!&quot;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&quot;You lose!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>which generates:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="txt" style="font-family:monospace;">You're investing in the Belizean Dollar
Of which you could pick up 2.0266687920 for a measly AUD$1 way back in 2012
and then sell for AUD$0.4810598095 each barely a year later
landing you AUD$0.97494890299911512400
You lose!</pre></td></tr></table></div>

<h3>Class AbstractStackContentHandler</h3>
<p>Similar to the <a href="http://commons.apache.org/digester/commons-digester-2.1/core.html">Apache Digester</a>, but much much smaller, this ContentHandler creates a &#8216;stack&#8217; of elements separated by a slash, which it passes through to the concrete implementation.</p>
<p>This example parses a device.xml file (as used in <a href="www.dmx-web.com">DMX-web</a>, an example of which is attached to the foot of this blog entry), and lists the name of all the devices contained within.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> DeviceContentHandler 
<span style="display:block;background-color: #ffc;">  <span style="color: #000000; font-weight: bold;">extends</span> XmlUtil.<span style="color: #006633;">AbstractStackContentHandler</span> <span style="color: #009900;">&#123;</span></span>	List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> names <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">// process the start of an XML element</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> element<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> path<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">// process the text of an XML element </span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> elementText<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> path, <span style="color: #003399;">String</span> content<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> 
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>path.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;devices/device/name&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			names.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>content<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">// return the names of all devices</span>
	<span style="color: #000000; font-weight: bold;">public</span> List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> getNames<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #000000; font-weight: bold;">return</span> names<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
DeviceContentHandler dch <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> DeviceContentHandler<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
XmlUtil.<span style="color: #006633;">processContentHandler</span><span style="color: #009900;">&#40;</span>dch, Text.<span style="color: #006633;">getFileContents</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;c:<span style="color: #000099; font-weight: bold;">\\</span>device.xml&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> names <span style="color: #339933;">=</span> dch.<span style="color: #006633;">getNames</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>names.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>i <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;: &quot;</span> <span style="color: #339933;">+</span> names.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>

<p>which generates:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="txt" style="font-family:monospace;">0: DMXKing USB
1: Art-Net
2: WinAMP Controller
3: Ye olde dmxy plugigne</pre></td></tr></table></div>

<h3>Class NodeListIterator</h3>
<p>A wrapper for a NodeList that makes it Iterable</p>
<p>Here&#8217;s an example using the <a href="http://www.randomnoun.com/wp/2012/12/26/automating-windows-from-java-and-windowtreedom/">WindowTreeDom object</a> from a couple of weeks back</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">// get the Windows window tree in an XML object and attempt to find the Outlook windows in there</span>
WindowTreeDom wtd <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> WindowTreeDom<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Document</span> windows <span style="color: #339933;">=</span> wtd.<span style="color: #006633;">getDom</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
NodeList outlookWindows <span style="color: #339933;">=</span> XPathAPI.<span style="color: #006633;">selectNodeList</span><span style="color: #009900;">&#40;</span>windows, 
  <span style="color: #0000ff;">&quot;.//window[@class='rctrl_renwnd32']/window[@class='AfxWndW']/window[@class='#32770']&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>   
&nbsp;
<span style="display:block;background-color: #ffc;"><span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span>Node n <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">new</span> XmlUtil.<span style="color: #006633;">NodeListIterator</span><span style="color: #009900;">&#40;</span>outlookWindows<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></span>    <span style="color: #003399;">Element</span> e <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> n<span style="color: #339933;">;</span>
    logger.<span style="color: #006633;">debug</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Found possible window &quot;</span> <span style="color: #339933;">+</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>n, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>

<p>Which could come in handy to prove that your commercialised electronic marketing campaigns look readable in all three types of email client that exist.</p>
</hr>
<p>So anyhoo, here&#8217;s the code already.</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-xmlutil-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>XmlUtil.java</div><div class="toggler-target toggle-block toggler-class-xmlutil-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.*</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.ArrayList</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Arrays</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.HashSet</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Iterator</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.List</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Set</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.DocumentBuilder</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.DocumentBuilderFactory</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.ParserConfigurationException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.SAXParser</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.SAXParserFactory</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.OutputKeys</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.Transformer</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.TransformerConfigurationException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.TransformerException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.TransformerFactory</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.dom.DOMSource</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.stream.StreamResult</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.ccil.cowan.tagsoup.*</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.ccil.cowan.tagsoup.Parser</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.*</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.Element</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.xml.sax.*</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.Logger</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** XML utility functions
 *
 * @author knoxg
 * @blog http://www.randomnoun.com/wp/2013/01/25/exciting-things-with-xml/
 * @version $Id: XmlUtil.java,v 1.5 2013-09-24 02:37:09 knoxg Exp $
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> XmlUtil <span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: XmlUtil.java,v 1.5 2013-09-24 02:37:09 knoxg Exp $&quot;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Clean some HTML text through the tagsoup filter. The returned string is guaranteed to be 
	 * well-formed XML (and can therefore be used by other tools that expect valid XML). 
	 * 
	 * @param inputXml input XML document
	 * @param isHtml if true, uses the HTML schema, omits the XML declaration, and uses the html method
	 * 
	 * @throws SAXException if the tagsoup library could not parse the input string
	 * @throws IllegalStateException if an error occurred reading from a string (should never occur)
	 */</span> 
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getCleanXml<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> inputXml, <span style="color: #000066; font-weight: bold;">boolean</span> isHtml<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">return</span> getCleanXml<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayInputStream</span><span style="color: #009900;">&#40;</span>inputXml.<span style="color: #006633;">getBytes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>, isHtml<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Clean a HTML inputStream through the tagsoup filter. The returned string is guaranteed to be 
	 * well-formed XML (and can therefore be used by other tools that expect valid XML). 
	 * 
	 * @param is input XML stream
	 * @param isHtml if true, uses the HTML schema, omits the XML declaration, and uses the html method
	 * 
	 * @throws SAXException if the tagsoup library could not parse the input string
	 * @throws IllegalStateException if an error occurred reading from a string (should never occur)
	 */</span> 
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getCleanXml<span style="color: #009900;">&#40;</span><span style="color: #003399;">InputStream</span> inputStream, <span style="color: #000066; font-weight: bold;">boolean</span> isHtml<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #003399;">ByteArrayOutputStream</span> baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			InputSource is <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> InputSource<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			is.<span style="color: #006633;">setByteStream</span><span style="color: #009900;">&#40;</span>inputStream<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// could use raw inputstream here later</span>
&nbsp;
			XMLReader xmlReader <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Parser</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #003399;">Writer</span> w <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">OutputStreamWriter</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			XMLWriter tagsoupXMLWriter <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> XMLWriter<span style="color: #009900;">&#40;</span>w<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			tagsoupXMLWriter.<span style="color: #006633;">setOutputProperty</span><span style="color: #009900;">&#40;</span>XMLWriter.<span style="color: #006633;">OMIT_XML_DECLARATION</span>, <span style="color: #0000ff;">&quot;yes&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>isHtml<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				HTMLSchema theSchema <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> HTMLSchema<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				xmlReader.<span style="color: #006633;">setProperty</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">Parser</span>.<span style="color: #006633;">schemaProperty</span>, theSchema<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
				tagsoupXMLWriter.<span style="color: #006633;">setOutputProperty</span><span style="color: #009900;">&#40;</span>XMLWriter.<span style="color: #006633;">METHOD</span>, <span style="color: #0000ff;">&quot;html&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				tagsoupXMLWriter.<span style="color: #006633;">setPrefix</span><span style="color: #009900;">&#40;</span>theSchema.<span style="color: #006633;">getURI</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
&nbsp;
			xmlReader.<span style="color: #006633;">setContentHandler</span><span style="color: #009900;">&#40;</span>tagsoupXMLWriter<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			xmlReader.<span style="color: #006633;">parse</span><span style="color: #009900;">&#40;</span>is<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">return</span> baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IOException</span> ioe<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;IO Exception reading from string&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">initCause</span><span style="color: #009900;">&#40;</span>ioe<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * Iterates through the child nodes of the specified element, and returns the contents
	 * of all Text and CDATA elements among those nodes, concatenated into a string.
	 *
	 * &lt;p&gt;Elements are recursed into.
	 *
	 * @param element the element that contains, as child nodes, the text to be returned.
	 * @return the contents of all the CDATA children of the specified element.
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getText<span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span> element<span style="color: #009900;">&#41;</span>
	<span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>element <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">NullPointerException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;null element&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #003399;">StringBuffer</span> buf <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">StringBuffer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		NodeList children <span style="color: #339933;">=</span> element.<span style="color: #006633;">getChildNodes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> children.<span style="color: #006633;">getLength</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span>i<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span> child <span style="color: #339933;">=</span> children.<span style="color: #006633;">item</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">short</span> nodeType <span style="color: #339933;">=</span> child.<span style="color: #006633;">getNodeType</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeType <span style="color: #339933;">==</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span>.<span style="color: #006633;">CDATA_SECTION_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Text</span><span style="color: #009900;">&#41;</span> child<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>			
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeType <span style="color: #339933;">==</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span>.<span style="color: #006633;">TEXT_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Text</span><span style="color: #009900;">&#41;</span> child<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeType <span style="color: #339933;">==</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span>.<span style="color: #006633;">ELEMENT_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>getText<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> child<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">return</span> buf.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * Iterates through the child nodes of the specified element, and returns the contents
	 * of all Text and CDATA elements among those nodes, concatenated into a string. 
	 * Any elements with tagNames that are included in the tagNames parameter of this
	 * method are also included. 
	 * 
	 * &lt;p&gt;Attributes of these tags are also included in the result, but may be reordered.
	 * 
	 * &lt;p&gt;Self-closing elements (e.g. &lt;code&gt;&amp;lt;br/&amp;gt;&lt;/code&gt;)
	 * are expanded into opening and closing elements (e.g. &lt;code&gt;&amp;lt;br&amp;gt;&amp;lt;/br&amp;gt;&lt;/code&gt;)
	 *
	 * &lt;p&gt;Elements are recursed into.
	 *
	 * @param element the element that contains, as child nodes, the text to be returned.
	 * @return the contents of all the CDATA children of the specified element.
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getTextPreserveElements<span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span> element, <span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> tagNames<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>element <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">NullPointerException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;null element&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
		Set<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> tagNamesSet <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> HashSet<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">Arrays</span>.<span style="color: #006633;">asList</span><span style="color: #009900;">&#40;</span>tagNames<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">StringBuffer</span> buf <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">StringBuffer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		NodeList children <span style="color: #339933;">=</span> element.<span style="color: #006633;">getChildNodes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> children.<span style="color: #006633;">getLength</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span>i<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span> child <span style="color: #339933;">=</span> children.<span style="color: #006633;">item</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">short</span> nodeType <span style="color: #339933;">=</span> child.<span style="color: #006633;">getNodeType</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeType <span style="color: #339933;">==</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span>.<span style="color: #006633;">CDATA_SECTION_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Text</span><span style="color: #009900;">&#41;</span> child<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>			
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeType <span style="color: #339933;">==</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span>.<span style="color: #006633;">TEXT_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Text</span><span style="color: #009900;">&#41;</span> child<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeType <span style="color: #339933;">==</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span>.<span style="color: #006633;">ELEMENT_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #003399;">String</span> tagName <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> child<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getTagName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #000066; font-weight: bold;">boolean</span> includeEl <span style="color: #339933;">=</span> tagNamesSet.<span style="color: #006633;">contains</span><span style="color: #009900;">&#40;</span>tagName<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>includeEl<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&lt;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>tagName<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					NamedNodeMap nnm <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> child<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getAttributes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> j <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> j <span style="color: #339933;">&lt;</span> nnm.<span style="color: #006633;">getLength</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> j<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						Attr attr <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>Attr<span style="color: #009900;">&#41;</span> nnm.<span style="color: #006633;">item</span><span style="color: #009900;">&#40;</span>j<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
						buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot; &quot;</span> <span style="color: #339933;">+</span> attr.<span style="color: #006633;">getName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
						<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>attr.<span style="color: #006633;">getValue</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
							buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;=<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span> <span style="color: #339933;">+</span> attr.<span style="color: #006633;">getValue</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
						<span style="color: #009900;">&#125;</span>
					<span style="color: #009900;">&#125;</span>
					buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'&gt;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
				buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>getTextPreserveElements<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> child, tagNames<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>includeEl<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;/&quot;</span> <span style="color: #339933;">+</span> tagName <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;&gt;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">return</span> buf.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>	
&nbsp;
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * Iterates through the child nodes of the specified element, and returns the contents
	 * of all Text and CDATA elements among those nodes, concatenated into a string.
	 * 
	 * &lt;p&gt;Elements are not recursed into.
	 *
	 * @param element the element that contains, as child nodes, the text to be returned.
	 * @return the contents of all the CDATA children of the specified element.
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getTextNonRecursive<span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span> element<span style="color: #009900;">&#41;</span>
	<span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>element <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">NullPointerException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;null element&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #003399;">StringBuffer</span> buf <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">StringBuffer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		NodeList children <span style="color: #339933;">=</span> element.<span style="color: #006633;">getChildNodes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> children.<span style="color: #006633;">getLength</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #339933;">++</span>i<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span> child <span style="color: #339933;">=</span> children.<span style="color: #006633;">item</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">short</span> nodeType <span style="color: #339933;">=</span> child.<span style="color: #006633;">getNodeType</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeType <span style="color: #339933;">==</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span>.<span style="color: #006633;">CDATA_SECTION_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Text</span><span style="color: #009900;">&#41;</span> child<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>			
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeType <span style="color: #339933;">==</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span>.<span style="color: #006633;">TEXT_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				buf.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Text</span><span style="color: #009900;">&#41;</span> child<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeType <span style="color: #339933;">==</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span>.<span style="color: #006633;">ELEMENT_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #666666; font-style: italic;">// ignore child elements</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">return</span> buf.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Return a DOM document object from an XML string
	 * 
	 * @param text the string representation of the XML to parse 
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">Document</span> toDocument<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> text<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">return</span> toDocument<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayInputStream</span><span style="color: #009900;">&#40;</span>text.<span style="color: #006633;">getBytes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Return a DOM document object from an InputStream
	 * 
	 * @param is the InputStream containing the XML to parse 
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">Document</span> toDocument<span style="color: #009900;">&#40;</span><span style="color: #003399;">InputStream</span> is<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
			DocumentBuilderFactory docBuilderFactory <span style="color: #339933;">=</span> DocumentBuilderFactory.<span style="color: #006633;">newInstance</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			DocumentBuilder docBuilder <span style="color: #339933;">=</span> docBuilderFactory.<span style="color: #006633;">newDocumentBuilder</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #003399;">Document</span> doc <span style="color: #339933;">=</span> docBuilder.<span style="color: #006633;">parse</span><span style="color: #009900;">&#40;</span>is<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			doc.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">normalize</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// Collapses adjacent text nodes into one node.</span>
			<span style="color: #000000; font-weight: bold;">return</span> doc<span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span>ParserConfigurationException pce<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// this can never happen </span>
			<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error creating DOM parser&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">initCause</span><span style="color: #009900;">&#40;</span>pce<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IOException</span> ioe<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// this can also never happen</span>
			<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Error retrieving information&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">initCause</span><span style="color: #009900;">&#40;</span>ioe<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> 
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Converts a document node subtree back into an XML string 
	 * 
	 * @param node a DOM node 
	 * @param omitXmlDeclaration if true, omits the XML declaration from the returned result
	 * 
	 * @return the XML for this node
	 * 
	 * @throws TransformerException if the transformation to XML failed
	 * @throws IllegalStateException if the transformer could not be initialised 
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getXmlString<span style="color: #009900;">&#40;</span>Node node, <span style="color: #000066; font-weight: bold;">boolean</span> omitXmlDeclaration<span style="color: #009900;">&#41;</span> 
		<span style="color: #000000; font-weight: bold;">throws</span> TransformerException 
	<span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #003399;">ByteArrayOutputStream</span> baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			TransformerFactory transformerFactory <span style="color: #339933;">=</span> TransformerFactory.<span style="color: #006633;">newInstance</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			Transformer transformer <span style="color: #339933;">=</span> transformerFactory.<span style="color: #006633;">newTransformer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			DOMSource source <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> DOMSource<span style="color: #009900;">&#40;</span>node<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			StreamResult result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> StreamResult<span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			transformer.<span style="color: #006633;">setOutputProperty</span><span style="color: #009900;">&#40;</span>OutputKeys.<span style="color: #006633;">OMIT_XML_DECLARATION</span>, omitXmlDeclaration <span style="color: #339933;">?</span> <span style="color: #0000ff;">&quot;yes&quot;</span><span style="color: #339933;">:</span> <span style="color: #0000ff;">&quot;no&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			transformer.<span style="color: #006633;">transform</span><span style="color: #009900;">&#40;</span>source, result<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">return</span> baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span>TransformerConfigurationException tce<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Could not initialise transfoermer&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">initCause</span><span style="color: #009900;">&#40;</span>tce<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Remove leading/trailing whitespace from all text nodes in this nodeList.
	 * Will iterate through subnodes recursively.
	 * 
	 * @param nodeList
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> compact<span style="color: #009900;">&#40;</span>Node node<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>node.<span style="color: #006633;">getNodeType</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span>Node.<span style="color: #006633;">TEXT_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Text</span> el <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Text</span><span style="color: #009900;">&#41;</span> node<span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>el.<span style="color: #006633;">getNodeValue</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				el.<span style="color: #006633;">setNodeValue</span><span style="color: #009900;">&#40;</span>el.<span style="color: #006633;">getNodeValue</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">trim</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>node.<span style="color: #006633;">getNodeType</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span>Node.<span style="color: #006633;">ELEMENT_NODE</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			NodeList childNodes <span style="color: #339933;">=</span> node.<span style="color: #006633;">getChildNodes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>childNodes <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">&amp;&amp;</span> childNodes.<span style="color: #006633;">getLength</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000066; font-weight: bold;">int</span> len <span style="color: #339933;">=</span> childNodes.<span style="color: #006633;">getLength</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>len<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					Node childNode <span style="color: #339933;">=</span> childNodes.<span style="color: #006633;">item</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				    compact<span style="color: #009900;">&#40;</span>childNode<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Parse a string of XML text using a SAX contentHandler. Nothing is returned by this method - it 
	 * is assumed that the contentHandler supplied maintains it's own state as it parses the XML supplied,
	 * and that this state can be extracted from this object afterwards.
	 * 
	 * @param contentHandler a SAX content handler 
	 * @param xmlText an XML document (or part thereof)
	 * 
	 * @throws SAXException if the document could not be parsed
	 * @throws IllegalException if the parser could not be initialised, or an I/O error occurred 
	 *   (should not happen since we're just dealing with strings)
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> processContentHandler<span style="color: #009900;">&#40;</span><span style="color: #003399;">ContentHandler</span> contentHandler, <span style="color: #003399;">String</span> xmlText<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		 SAXParserFactory factory <span style="color: #339933;">=</span> SAXParserFactory.<span style="color: #006633;">newInstance</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		 <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
			 <span style="color: #666666; font-style: italic;">// Parse the input</span>
			 SAXParser saxParser <span style="color: #339933;">=</span> factory.<span style="color: #006633;">newSAXParser</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			 XMLReader xmlReader <span style="color: #339933;">=</span> saxParser.<span style="color: #006633;">getXMLReader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			 xmlReader.<span style="color: #006633;">setContentHandler</span><span style="color: #009900;">&#40;</span>contentHandler<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			 xmlReader.<span style="color: #006633;">parse</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> InputSource<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayInputStream</span><span style="color: #009900;">&#40;</span>xmlText.<span style="color: #006633;">getBytes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		 <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IOException</span> ioe<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		 	<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;IO Exception reading from string&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">initCause</span><span style="color: #009900;">&#40;</span>ioe<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		 <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span>ParserConfigurationException pce<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Could not initialise parser&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">initCause</span><span style="color: #009900;">&#40;</span>pce<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		 		
		 <span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Convert a table into a List of Lists (each top-level list represents a table row,
	 * each second-level list represents a table cell). Only contents are returned; attributes
	 * and formatting are ignored.
	 * 
	 * &lt;p&gt;This class will probably not work when tables are embedded within other tables
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> SimpleTableContentHandler
		<span style="color: #000000; font-weight: bold;">implements</span> <span style="color: #003399;">ContentHandler</span> 
	<span style="color: #009900;">&#123;</span>
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** Logger instance for this class */</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span>SimpleTableContentHandler.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** Current table */</span>
		List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> thisTable <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** Current row in table */</span>
		List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> thisRow <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** Current cell in row */</span>
		<span style="color: #003399;">String</span> thisCell <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** The state of this parser */</span>
		<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">enum</span> State <span style="color: #009900;">&#123;</span>
			<span style="color: #008000; font-style: italic; font-weight: bold;">/** start of doc, expecting 'table' */</span>
			START,
			<span style="color: #008000; font-style: italic; font-weight: bold;">/** in table element, expecting 'tr' */</span>
			IN_TABLE,
			<span style="color: #008000; font-style: italic; font-weight: bold;">/** in tr element, expecting 'td' (or other ignored elements) */</span>
			IN_TR,
			<span style="color: #008000; font-style: italic; font-weight: bold;">/** in td element, capturing to closing tag */</span>
			IN_TD
		<span style="color: #009900;">&#125;</span>
&nbsp;
		State state <span style="color: #339933;">=</span> State.<span style="color: #006633;">START</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// unused interface methods</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setDocumentLocator<span style="color: #009900;">&#40;</span>Locator locator<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> startDocument<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> endDocument<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> startPrefixMapping<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> prefix, <span style="color: #003399;">String</span> uri<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> endPrefixMapping<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> prefix<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> ignorableWhitespace<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> ch, <span style="color: #000066; font-weight: bold;">int</span> start, <span style="color: #000066; font-weight: bold;">int</span> length<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> processingInstruction<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> target, <span style="color: #003399;">String</span> data<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> skippedEntity<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> name<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> startElement<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> uri, <span style="color: #003399;">String</span> localName, <span style="color: #003399;">String</span> qName, <span style="color: #003399;">Attributes</span> atts<span style="color: #009900;">&#41;</span>
			<span style="color: #000000; font-weight: bold;">throws</span> SAXException 
		<span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">switch</span> <span style="color: #009900;">&#40;</span>state<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000000; font-weight: bold;">case</span> START<span style="color: #339933;">:</span> 
					<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>qName.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;table&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						thisTable <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
						state <span style="color: #339933;">=</span> State.<span style="color: #006633;">IN_TABLE</span><span style="color: #339933;">;</span> 
					<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
						logger.<span style="color: #006633;">warn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Warning: top-level element '&quot;</span> <span style="color: #339933;">+</span> qName <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;' found (expected 'table')&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span>
					<span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
&nbsp;
				<span style="color: #000000; font-weight: bold;">case</span> IN_TABLE<span style="color: #339933;">:</span>
					<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>qName.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;tr&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						thisRow <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
						thisTable.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>thisRow<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
						state <span style="color: #339933;">=</span> State.<span style="color: #006633;">IN_TR</span><span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span>
					<span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
&nbsp;
				<span style="color: #000000; font-weight: bold;">case</span> IN_TR<span style="color: #339933;">:</span> 
					<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>qName.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;td&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						thisCell <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
						state <span style="color: #339933;">=</span> State.<span style="color: #006633;">IN_TD</span><span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span>
					<span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
&nbsp;
				<span style="color: #000000; font-weight: bold;">case</span> IN_TD<span style="color: #339933;">:</span>
					<span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
&nbsp;
				<span style="color: #000000; font-weight: bold;">default</span><span style="color: #339933;">:</span>
					<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Illegal state &quot;</span> <span style="color: #339933;">+</span> state <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; in SimpleTableContentHandler&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> characters<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> ch, <span style="color: #000066; font-weight: bold;">int</span> start, <span style="color: #000066; font-weight: bold;">int</span> length<span style="color: #009900;">&#41;</span>
			<span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>state<span style="color: #339933;">==</span>State.<span style="color: #006633;">IN_TD</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				thisCell <span style="color: #339933;">+=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">String</span><span style="color: #009900;">&#40;</span>ch, start, length<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> endElement<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> uri, <span style="color: #003399;">String</span> localName, <span style="color: #003399;">String</span> qName<span style="color: #009900;">&#41;</span>
			<span style="color: #000000; font-weight: bold;">throws</span> SAXException 
		<span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>state <span style="color: #339933;">==</span> State.<span style="color: #006633;">IN_TD</span> <span style="color: #339933;">&amp;&amp;</span> qName.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;td&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				thisRow.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>thisCell<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				state <span style="color: #339933;">=</span> State.<span style="color: #006633;">IN_TR</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>state <span style="color: #339933;">==</span> State.<span style="color: #006633;">IN_TR</span> <span style="color: #339933;">&amp;&amp;</span> qName.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;tr&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				state <span style="color: #339933;">=</span> State.<span style="color: #006633;">IN_TABLE</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">public</span> List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> getTable<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">return</span> thisTable<span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** An abstract stack-based XML parser. Similar to the apache digester, but without
	 * the dozen or so dependent JARs.
	 * 
	 * &lt;p&gt;Only element text is captured 
	 * &lt;p&gt;Element attributes are not parsed by this class.
	 * &lt;p&gt;Mixed text/element nodes are not parsed by this class.
	 * 
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">abstract</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> AbstractStackContentHandler <span style="color: #000000; font-weight: bold;">implements</span> <span style="color: #003399;">ContentHandler</span> 
	<span style="color: #009900;">&#123;</span>
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** Logger instance for this class */</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span>AbstractStackContentHandler.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** Location in stack */</span>
		<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">String</span> stack <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">String</span> text <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>     <span style="color: #666666; font-style: italic;">// text captured so far</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// unused interface methods</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setDocumentLocator<span style="color: #009900;">&#40;</span>Locator locator<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> startDocument<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> endDocument<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> startPrefixMapping<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> prefix, <span style="color: #003399;">String</span> uri<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> endPrefixMapping<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> prefix<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> ignorableWhitespace<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> ch, <span style="color: #000066; font-weight: bold;">int</span> start, <span style="color: #000066; font-weight: bold;">int</span> length<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> processingInstruction<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> target, <span style="color: #003399;">String</span> data<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> skippedEntity<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> name<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> startElement<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> uri, <span style="color: #003399;">String</span> localName, <span style="color: #003399;">String</span> qName, <span style="color: #003399;">Attributes</span> atts<span style="color: #009900;">&#41;</span>
			<span style="color: #000000; font-weight: bold;">throws</span> SAXException 
		<span style="color: #009900;">&#123;</span>
			stack <span style="color: #339933;">=</span> stack.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> qName <span style="color: #339933;">:</span> stack <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;/&quot;</span> <span style="color: #339933;">+</span> qName<span style="color: #339933;">;</span>
			text <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
			element<span style="color: #009900;">&#40;</span>stack<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> characters<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> ch, <span style="color: #000066; font-weight: bold;">int</span> start, <span style="color: #000066; font-weight: bold;">int</span> length<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
			text <span style="color: #339933;">+=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">String</span><span style="color: #009900;">&#40;</span>ch, start, length<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> endElement<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> uri, <span style="color: #003399;">String</span> localName, <span style="color: #003399;">String</span> qName<span style="color: #009900;">&#41;</span>
			<span style="color: #000000; font-weight: bold;">throws</span> SAXException 
		<span style="color: #009900;">&#123;</span>
			elementText<span style="color: #009900;">&#40;</span>stack, text<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			text <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// probably not necessary</span>
			stack <span style="color: #339933;">=</span> stack.<span style="color: #006633;">contains</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> stack.<span style="color: #006633;">substring</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span>, stack.<span style="color: #006633;">lastIndexOf</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">abstract</span> <span style="color: #000066; font-weight: bold;">void</span> element<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> path<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException<span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">abstract</span> <span style="color: #000066; font-weight: bold;">void</span> elementText<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> path, <span style="color: #003399;">String</span> content<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException<span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Convert a NodeList into something that Java1.5 can treat as Iterable,
	 * so that it can be used in &lt;tt&gt;for (Node node : nodeList) { ... }&lt;/tt&gt; style
	 * constructs.
	 * 
	 * &lt;p&gt;(org.w3c.dom.traversal.NodeListIterator doesn't currently implement Iterable)
	 * 
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> NodeListIterator <span style="color: #000000; font-weight: bold;">implements</span> Iterable<span style="color: #339933;">&lt;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span><span style="color: #339933;">&gt;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">final</span> NodeList nodeList<span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">public</span> NodeListIterator<span style="color: #009900;">&#40;</span>NodeList nodeList<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">nodeList</span> <span style="color: #339933;">=</span> nodeList<span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">public</span> Iterator<span style="color: #339933;">&lt;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span><span style="color: #339933;">&gt;</span> iterator<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">new</span> Iterator<span style="color: #339933;">&lt;</span>org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span><span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">int</span> index <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">boolean</span> hasNext<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #000000; font-weight: bold;">return</span> index <span style="color: #339933;">&lt;</span> nodeList.<span style="color: #006633;">getLength</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
				<span style="color: #000000; font-weight: bold;">public</span> org.<span style="color: #006633;">w3c</span>.<span style="color: #006633;">dom</span>.<span style="color: #006633;">Node</span> next<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #000000; font-weight: bold;">return</span> nodeList.<span style="color: #006633;">item</span><span style="color: #009900;">&#40;</span>index<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
				<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> remove<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">UnsupportedOperationException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;remove() not allowed in NodeList&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
			<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<p>and the medley of contrived examples above:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-xmlutilexample-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>XmlUtilExample.java</div><div class="toggler-target toggle-block toggler-class-xmlutilexample-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.example.contrived.cli</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.File</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.FileInputStream</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.IOException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.math.BigDecimal</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.net.MalformedURLException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.net.URL</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.ArrayList</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.List</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Scanner</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.TransformerException</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.xpath.XPathAPI</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.Document</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.Element</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.NodeList</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.xml.sax.SAXException</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.randomnoun.common.XmlUtil</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> XmlUtilExample <span style="color: #009900;">&#123;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">// utility method</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getFileContents<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> filename<span style="color: #009900;">&#41;</span>
        <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">IOException</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #003399;">File</span> file <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">File</span><span style="color: #009900;">&#40;</span>filename<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #003399;">FileInputStream</span> fis <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">FileInputStream</span><span style="color: #009900;">&#40;</span>file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000066; font-weight: bold;">byte</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> data <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #000066; font-weight: bold;">byte</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span><span style="color: #009900;">&#41;</span> file.<span style="color: #006633;">length</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
        <span style="color: #000066; font-weight: bold;">int</span> len <span style="color: #339933;">=</span> fis.<span style="color: #006633;">read</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        fis.<span style="color: #006633;">close</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>len <span style="color: #339933;">&lt;</span> file.<span style="color: #006633;">length</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IOException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Buffer read != size of file&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">String</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> getTextExample<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> TransformerException, 
	  SAXException, <span style="color: #003399;">MalformedURLException</span>, <span style="color: #003399;">IOException</span> 
	<span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// uses the Scanner trick from http://weblogs.java.net/blog/pat/archive/2004/10/stupid_scanner.html</span>
		<span style="color: #003399;">String</span> rubbishHtml <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Scanner<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">URL</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;http://www.microsoft.com&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">openStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, 
		  <span style="color: #0000ff;">&quot;UTF-8&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">useDelimiter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>A&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">next</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> cleanXml <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>rubbishHtml, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>cleanXml<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> titleEl <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> XPathAPI.<span style="color: #006633;">selectSingleNode</span><span style="color: #009900;">&#40;</span>d, <span style="color: #0000ff;">&quot;/html/head/title&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> title <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getText</span><span style="color: #009900;">&#40;</span>titleEl<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>title<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> getTextPreserveElementsExample<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;p&gt;Here is some formatted text &lt;b&gt;in bold&lt;/b&gt;, &lt;i&gt;in italics&lt;/i&gt;,&quot;</span> <span style="color: #339933;">+</span>
		  <span style="color: #0000ff;">&quot; &lt;blink&gt;blinking&lt;/blink&gt;, and with an image at the end &lt;img src=<span style="color: #000099; font-weight: bold;">\&quot;</span>frog.png<span style="color: #000099; font-weight: bold;">\&quot;</span>/&gt;&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> paraEl <span style="color: #339933;">=</span> d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getText</span><span style="color: #009900;">&#40;</span>paraEl<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getTextPreserveElements</span><span style="color: #009900;">&#40;</span>paraEl, 
		  <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">&quot;b&quot;</span>, <span style="color: #0000ff;">&quot;i&quot;</span>, <span style="color: #0000ff;">&quot;img&quot;</span> <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> getTextNonRecursiveExample<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;p&gt;This is the bit we're interested in &lt;span&gt;but not this bit&lt;/span&gt;&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> paraEl <span style="color: #339933;">=</span> d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getText</span><span style="color: #009900;">&#40;</span>paraEl<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getTextNonRecursive</span><span style="color: #009900;">&#40;</span>paraEl<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> getXmlStringExample<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">MalformedURLException</span>, 
	  <span style="color: #003399;">IOException</span>, SAXException, TransformerException 
	<span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// how to determine what 'keywords' and 'description' meta tags google has</span>
		<span style="color: #003399;">String</span> rubbishHtml <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Scanner<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">URL</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;http://www.google.com&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">openStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, 
		  <span style="color: #0000ff;">&quot;UTF-8&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">useDelimiter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>A&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">next</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> cleanXml <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>rubbishHtml, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>cleanXml<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		NodeList nodes <span style="color: #339933;">=</span> XPathAPI.<span style="color: #006633;">selectNodeList</span><span style="color: #009900;">&#40;</span>d, <span style="color: #0000ff;">&quot;/html/head/meta&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>nodes.<span style="color: #006633;">getLength</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>i <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;: &quot;</span> <span style="color: #339933;">+</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>nodes.<span style="color: #006633;">item</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span>,  <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> compactExample<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException, TransformerException <span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// from http://www.ibiblio.org/xml/examples/shakespeare/all_well.xml</span>
		<span style="color: #003399;">String</span> input <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;&lt;PERSONAE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;TITLE&gt;Dramatis Personae&lt;/TITLE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;KING OF FRANCE&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;DUKE OF FLORENCE&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;BERTRAM, Count of Rousillon.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;LAFEU, an old lord.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;PAROLLES, a follower of Bertram.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PGROUP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;        &lt;PERSONA&gt;Steward&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;        &lt;PERSONA&gt;Clown&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;        &lt;GRPDESCR&gt;servants to the Countess of Rousillon.&lt;/GRPDESCR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;/PGROUP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;A Page. &lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;COUNTESS OF ROUSILLON, mother to Bertram. &lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;HELENA, a gentlewoman protected by the Countess.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;An old Widow of Florence. &lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;DIANA, daughter to the Widow.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PGROUP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;        &lt;PERSONA&gt;VIOLENTA&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;        &lt;PERSONA&gt;MARIANA&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;        &lt;GRPDESCR&gt;neighbours and friends to the Widow.&lt;/GRPDESCR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;/PGROUP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;PERSONA&gt;Lords, Officers, Soldiers, &amp;amp;c., French and Florentine.&lt;/PERSONA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;&lt;/PERSONAE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Before compact():&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>d, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		XmlUtil.<span style="color: #006633;">compact</span><span style="color: #009900;">&#40;</span>d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;And after compact(), the much more readable:&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>d, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** @see #simpleTableContentHandlerExample() */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> getCurrencyRates<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> date<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">MalformedURLException</span>, 
	  <span style="color: #003399;">IOException</span>, SAXException, TransformerException 
	<span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// this doesn't actually work due to http://www.xe.com/errors/noautoextract.htm</span>
		<span style="color: #666666; font-style: italic;">// but I'm sure you enterprising types can get around that</span>
		<span style="color: #666666; font-style: italic;">//String url = &quot;http://www.xe.com/currencytables/?from=AUD&amp;date=&quot; + date;</span>
		<span style="color: #666666; font-style: italic;">//String rubbishHtml = new Scanner(new URL(url).openStream(), </span>
		<span style="color: #666666; font-style: italic;">//  &quot;UTF-8&quot;).useDelimiter(&quot;\\A&quot;).next();</span>
&nbsp;
		<span style="color: #003399;">String</span> rubbishHtml <span style="color: #339933;">=</span> getFileContents<span style="color: #009900;">&#40;</span>date.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;2012-01-01&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> <span style="color: #0000ff;">&quot;c:<span style="color: #000099; font-weight: bold;">\\</span>rate1.txt&quot;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&quot;c:<span style="color: #000099; font-weight: bold;">\\</span>rate2.txt&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> cleanXml <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>rubbishHtml, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>cleanXml<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> tableEl <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> XPathAPI.<span style="color: #006633;">selectSingleNode</span><span style="color: #009900;">&#40;</span>d, <span style="color: #0000ff;">&quot;.//table[@id=<span style="color: #000099; font-weight: bold;">\&quot;</span>historicalRateTbl<span style="color: #000099; font-weight: bold;">\&quot;</span>]&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		XmlUtil.<span style="color: #006633;">SimpleTableContentHandler</span> stch <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> XmlUtil.<span style="color: #006633;">SimpleTableContentHandler</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		XmlUtil.<span style="color: #006633;">processContentHandler</span><span style="color: #009900;">&#40;</span>stch, XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>tableEl, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> table <span style="color: #339933;">=</span> stch.<span style="color: #006633;">getTable</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">return</span> table<span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** @throws TransformerException 
	 * @throws SAXException 
	 * @throws IOException 
	 * @throws MalformedURLException 
	 * @see #getCurrencyRates(String) */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> simpleTableContentHandlerExample<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">MalformedURLException</span>, <span style="color: #003399;">IOException</span>, 
	  SAXException, TransformerException 
	<span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// see what amount of abstract currency units you can get in exchange for</span>
		<span style="color: #666666; font-style: italic;">// the shiny Australian cylinder with a kangaroo on it.</span>
		List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> startTable <span style="color: #339933;">=</span> getCurrencyRates<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;2012-01-01&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> endTable <span style="color: #339933;">=</span> getCurrencyRates<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;2013-01-01&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// pick an investment strategy</span>
		<span style="color: #000066; font-weight: bold;">int</span> tradingOption <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Math</span>.<span style="color: #006633;">random</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">*</span> startTable.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>startTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span>endTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">RuntimeException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Rate tables don't line up&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;You're investing in the &quot;</span> <span style="color: #339933;">+</span> startTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Of which you could pick up &quot;</span> <span style="color: #339933;">+</span> startTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; for a measly AUD$1 way back in 2012&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;and then sell for AUD$&quot;</span> <span style="color: #339933;">+</span> endTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; each barely a year later&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// and then let's pretend that rounding, buy/sell prices and transaction costs don't exist</span>
		<span style="color: #003399;">BigDecimal</span> bd <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">BigDecimal</span><span style="color: #009900;">&#40;</span>startTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">BigDecimal</span> bd2 <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">BigDecimal</span><span style="color: #009900;">&#40;</span>endTable.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>tradingOption<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">BigDecimal</span> val <span style="color: #339933;">=</span> bd.<span style="color: #006633;">multiply</span><span style="color: #009900;">&#40;</span>bd2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// which should be $1 exactly, but xe.com can't put an infinite number of decimal points </span>
		<span style="color: #666666; font-style: italic;">// on their tables</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;landing you AUD$&quot;</span> <span style="color: #339933;">+</span> val<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>val.<span style="color: #006633;">compareTo</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">BigDecimal</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span> <span style="color: #339933;">?</span> <span style="color: #0000ff;">&quot;Winner!&quot;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&quot;You lose!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** @see #abstractStackContentHandlerExample() */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> DeviceContentHandler <span style="color: #000000; font-weight: bold;">extends</span> XmlUtil.<span style="color: #006633;">AbstractStackContentHandler</span> <span style="color: #009900;">&#123;</span>
		List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> names <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// process the start of an XML element</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> element<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> path<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> <span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// process the text of an XML element </span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> elementText<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> path, <span style="color: #003399;">String</span> content<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span> 
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>path.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;devices/device/name&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				names.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>content<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// return the names of all devices</span>
		<span style="color: #000000; font-weight: bold;">public</span> List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> getNames<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #000000; font-weight: bold;">return</span> names<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** @throws IOException 
	 * @throws SAXException 
	 * @see XmlUtilExample.DeviceContentHandler */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> abstractStackContentHandlerExample<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException, <span style="color: #003399;">IOException</span> <span style="color: #009900;">&#123;</span>
		DeviceContentHandler dch <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> DeviceContentHandler<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		XmlUtil.<span style="color: #006633;">processContentHandler</span><span style="color: #009900;">&#40;</span>dch, getFileContents<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;c:<span style="color: #000099; font-weight: bold;">\\</span>device.xml&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> names <span style="color: #339933;">=</span> dch.<span style="color: #006633;">getNames</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>names.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>i <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;: &quot;</span> <span style="color: #339933;">+</span> names.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * @param args
	 * @throws SAXException 
	 * @throws IOException 
	 * @throws TransformerException 
	 * @throws MalformedURLException 
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> main<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> args<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException, <span style="color: #003399;">MalformedURLException</span>, 
	  TransformerException, <span style="color: #003399;">IOException</span> 
	<span style="color: #009900;">&#123;</span>
		XmlUtilExample xue <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> XmlUtilExample<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		xue.<span style="color: #006633;">getTextExample</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		xue.<span style="color: #006633;">getTextPreserveElementsExample</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		xue.<span style="color: #006633;">getTextNonRecursiveExample</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		xue.<span style="color: #006633;">getXmlStringExample</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		xue.<span style="color: #006633;">compactExample</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		xue.<span style="color: #006633;">simpleTableContentHandlerExample</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		xue.<span style="color: #006633;">abstractStackContentHandlerExample</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<p>and the unit tests and associated resources</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-xmlutiltest-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>XmlUtilTest.java</div><div class="toggler-target toggle-block toggler-class-xmlutiltest-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.ByteArrayInputStream</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.ByteArrayOutputStream</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.IOException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.InputStream</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.ArrayList</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.HashMap</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.List</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Map</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.regex.Matcher</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.regex.Pattern</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.ParserConfigurationException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.TransformerException</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.Document</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.Element</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.xml.sax.SAXException</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.randomnoun.common.XmlUtil.SimpleTableContentHandler</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">junit.framework.TestCase</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** Test the XmlUtil class.
 * 
 * @author knoxg
 * @blog http://www.randomnoun.com/wp/2013/01/25/exciting-things-with-xml/
 * @version $Id: XmlUtilTest.java,v 1.9 2013-09-24 02:37:09 knoxg Exp $
 *
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> XmlUtilTest <span style="color: #000000; font-weight: bold;">extends</span> TestCase <span style="color: #009900;">&#123;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">String</span> getResourceAsString<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> name<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">IOException</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">ByteArrayOutputStream</span> baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">InputStream</span> is <span style="color: #339933;">=</span> XmlUtilTest.<span style="color: #000000; font-weight: bold;">class</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;./&quot;</span> <span style="color: #339933;">+</span> name<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>is<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
			is <span style="color: #339933;">=</span> XmlUtilTest.<span style="color: #000000; font-weight: bold;">class</span>.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">&#40;</span>name<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>is<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Missing resource&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000066; font-weight: bold;">int</span> ch <span style="color: #339933;">=</span> is.<span style="color: #006633;">read</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #009900;">&#40;</span>ch<span style="color: #339933;">!=-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> baos.<span style="color: #006633;">write</span><span style="color: #009900;">&#40;</span>ch<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> ch<span style="color: #339933;">=</span>is.<span style="color: #006633;">read</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
		is.<span style="color: #006633;">close</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">return</span> baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetCleanXml<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">IOException</span>, SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input, output<span style="color: #339933;">;</span>		
		input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;html&gt;So here's &lt;br&gt;some HTML with&lt;p&gt;some &lt;b&gt;unclosed &lt;i&gt;formatting&lt;/p&gt;tags.&quot;</span><span style="color: #339933;">;</span>
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>input, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// apply HTML rules</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;html xmlns=<span style="color: #000099; font-weight: bold;">\&quot;</span>http://www.w3.org/1999/xhtml<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&lt;body&gt;So here's &lt;br clear=<span style="color: #000099; font-weight: bold;">\&quot;</span>none<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&lt;/br&gt;some HTML with&lt;p&gt;some &lt;b&gt;unclosed &lt;i&gt;formatting&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;b&gt;&lt;i&gt;tags.&lt;/i&gt;&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>, output.<span style="color: #006633;">trim</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>input, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// apply XML rules</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;html xmlns=<span style="color: #000099; font-weight: bold;">\&quot;</span>http://www.w3.org/1999/xhtml<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&lt;body&gt;So here's &lt;br clear=<span style="color: #000099; font-weight: bold;">\&quot;</span>none<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;some HTML with&lt;p&gt;some &lt;b&gt;unclosed &lt;i&gt;formatting&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;b&gt;&lt;i&gt;tags.&lt;/i&gt;&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>, output.<span style="color: #006633;">trim</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// clean the 'extreme' HTML from http://ccil.org/~cowan/XML/tagsoup/extreme.html</span>
		input <span style="color: #339933;">=</span> getResourceAsString<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/tagsoupInput.txt&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getCleanXml</span><span style="color: #009900;">&#40;</span>input, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> expected <span style="color: #339933;">=</span> getResourceAsString<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/tagsoupOutput.txt&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> expected<span style="color: #339933;">=</span>expected.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>expected, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetText<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input, output<span style="color: #339933;">;</span>
&nbsp;
		input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;p&gt;Here is some &lt;b&gt;bold text&lt;/b&gt; and &lt;i&gt;some &lt;u&gt;underlined&lt;/u&gt; italics&lt;/i&gt; text&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> paraEl <span style="color: #339933;">=</span> d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// top-level element is a paragraph element</span>
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getText</span><span style="color: #009900;">&#40;</span>paraEl<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Here is some bold text and some underlined italics text&quot;</span>, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetTextPreserveElements<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input, output<span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d<span style="color: #339933;">;</span>
&nbsp;
		input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;p&gt;Here is some &lt;b&gt;bold text&lt;/b&gt; and &lt;i&gt;some &lt;u&gt;underlined&lt;/u&gt; italics&lt;/i&gt; text&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
		d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> paraEl <span style="color: #339933;">=</span> d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// top-level element is a paragraph element</span>
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getTextPreserveElements</span><span style="color: #009900;">&#40;</span>paraEl, <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">&quot;b&quot;</span>, <span style="color: #0000ff;">&quot;i&quot;</span>, <span style="color: #0000ff;">&quot;u&quot;</span> <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Here is some &lt;b&gt;bold text&lt;/b&gt; and &lt;i&gt;some &lt;u&gt;underlined&lt;/u&gt; italics&lt;/i&gt; text&quot;</span>, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getTextPreserveElements</span><span style="color: #009900;">&#40;</span>paraEl, <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">&quot;b&quot;</span>, <span style="color: #0000ff;">&quot;i&quot;</span> <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Here is some &lt;b&gt;bold text&lt;/b&gt; and &lt;i&gt;some underlined italics&lt;/i&gt; text&quot;</span>, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getTextPreserveElements</span><span style="color: #009900;">&#40;</span>paraEl, <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">&quot;i&quot;</span> <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Here is some bold text and &lt;i&gt;some underlined italics&lt;/i&gt; text&quot;</span>, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// attributes are preserved, but may be reordered</span>
		<span style="color: #666666; font-style: italic;">// self-closing elements are expanded to an opening and closing element</span>
		input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;p&gt;And this would be a paragraph with two images in it: &lt;img src=<span style="color: #000099; font-weight: bold;">\&quot;</span>src1.png<span style="color: #000099; font-weight: bold;">\&quot;</span> /&gt; and &lt;img src=<span style="color: #000099; font-weight: bold;">\&quot;</span>src2.png<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&lt;/img&gt;&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
		d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		paraEl <span style="color: #339933;">=</span> d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// top-level element is a paragraph element</span>
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getTextPreserveElements</span><span style="color: #009900;">&#40;</span>paraEl, <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">&quot;img&quot;</span> <span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;And this would be a paragraph with two images in it: &lt;img src=<span style="color: #000099; font-weight: bold;">\&quot;</span>src1.png<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&lt;/img&gt; and &lt;img src=<span style="color: #000099; font-weight: bold;">\&quot;</span>src2.png<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&lt;/img&gt;&quot;</span>, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetTextNonRecursive<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input, output<span style="color: #339933;">;</span>
&nbsp;
		input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;p&gt;Here is some &lt;b&gt;bold text&lt;/b&gt; and &lt;i&gt;some &lt;u&gt;underlined&lt;/u&gt; italics&lt;/i&gt; text&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> paraEl <span style="color: #339933;">=</span> d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// top-level element is a paragraph element</span>
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getTextNonRecursive</span><span style="color: #009900;">&#40;</span>paraEl<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Here is some  and  text&quot;</span>, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testToDocumentString<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// should have been tested above, but maybe do some more samples here</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testToDocumentInputStream<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException, TransformerException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input, output<span style="color: #339933;">;</span>
		<span style="color: #003399;">InputStream</span> is<span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d<span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// DOCTYPEs are discarded</span>
		input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;!DOCTYPE something&gt;&lt;p&gt;XML with a DOCTYPE&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
		is <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayInputStream</span><span style="color: #009900;">&#40;</span>input.<span style="color: #006633;">getBytes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>is<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;?xml version=<span style="color: #000099; font-weight: bold;">\&quot;</span>1.0<span style="color: #000099; font-weight: bold;">\&quot;</span> encoding=<span style="color: #000099; font-weight: bold;">\&quot;</span>UTF-8<span style="color: #000099; font-weight: bold;">\&quot;</span>?&gt;&lt;p&gt;XML with a DOCTYPE&lt;/p&gt;&quot;</span>, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// XML with namespaces</span>
		input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;root xmlns:dc=<span style="color: #000099; font-weight: bold;">\&quot;</span>http://purl.org/dc/terms/<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span> <span style="color: #339933;">+</span>
          <span style="color: #0000ff;">&quot; xmlns:html=<span style="color: #000099; font-weight: bold;">\&quot;</span>http://www.w3.org/1999/xhtml<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span> <span style="color: #339933;">+</span>
		  <span style="color: #0000ff;">&quot;&lt;html:p&gt;&lt;dc:something&gt;dublin core dublin core&lt;/dc:something&gt;&quot;</span> <span style="color: #339933;">+</span>
		  <span style="color: #0000ff;">&quot;Well this should be aware of namespaces then&lt;/html:p&gt;&lt;/root&gt;&quot;</span><span style="color: #339933;">;</span>
		is <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayInputStream</span><span style="color: #009900;">&#40;</span>input.<span style="color: #006633;">getBytes</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>is<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;?xml version=<span style="color: #000099; font-weight: bold;">\&quot;</span>1.0<span style="color: #000099; font-weight: bold;">\&quot;</span> encoding=<span style="color: #000099; font-weight: bold;">\&quot;</span>UTF-8<span style="color: #000099; font-weight: bold;">\&quot;</span>?&gt;&quot;</span> <span style="color: #339933;">+</span> input, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetXmlString<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException, TransformerException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input, output<span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d<span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> paraEl<span style="color: #339933;">;</span>
&nbsp;
		input <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;p&gt;Here is some &lt;b&gt;bold text&lt;/b&gt; and &lt;i&gt;some &lt;u&gt;underlined&lt;/u&gt; italics&lt;/i&gt; text&lt;/p&gt;&quot;</span><span style="color: #339933;">;</span>
		d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		paraEl <span style="color: #339933;">=</span> d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>paraEl, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>input, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// output should match input</span>
&nbsp;
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>paraEl, <span style="color: #000066; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// output should match input with XML declaration</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;?xml version=<span style="color: #000099; font-weight: bold;">\&quot;</span>1.0<span style="color: #000099; font-weight: bold;">\&quot;</span> encoding=<span style="color: #000099; font-weight: bold;">\&quot;</span>UTF-8<span style="color: #000099; font-weight: bold;">\&quot;</span>?&gt;&quot;</span> <span style="color: #339933;">+</span> input, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testCompact<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> ParserConfigurationException, SAXException, TransformerException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input <span style="color: #339933;">=</span>
			<span style="color: #0000ff;">&quot;&lt;body&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
		    <span style="color: #0000ff;">&quot;  &lt;el&gt;  This is an element<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    &lt;el2&gt; This is another one&lt;/el2&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
		    <span style="color: #0000ff;">&quot;    &lt;el3&gt;and another &lt;!-- with some comments --&gt;&lt;/el3&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;  &lt;/el&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
		    <span style="color: #0000ff;">&quot;&lt;/body&gt;&quot;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">toDocument</span><span style="color: #009900;">&#40;</span>input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>input.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>, <span style="color: #003399;">System</span>.<span style="color: #006633;">getProperty</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;line.separator&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		XmlUtil.<span style="color: #006633;">compact</span><span style="color: #009900;">&#40;</span>d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		output <span style="color: #339933;">=</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>d.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;body&gt;&lt;el&gt;This is an element&lt;el2&gt;This is another one&lt;/el2&gt;&quot;</span> <span style="color: #339933;">+</span>
		  <span style="color: #0000ff;">&quot;&lt;el3&gt;and another&lt;!-- with some comments --&gt;&lt;/el3&gt;&lt;/el&gt;&lt;/body&gt;&quot;</span>, output<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testProcessContentHandler_SimpleTable<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;&lt;table&gt;&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;&lt;tr&gt;&lt;td&gt;A1&lt;/td&gt;&lt;td&gt;B1&lt;/td&gt;&lt;td&gt;C1&lt;/td&gt;&lt;/tr&gt;&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;&lt;tr&gt;&lt;td&gt;A2&lt;/td&gt;&lt;td&gt;B2&lt;/td&gt;&lt;/tr&gt;&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;&lt;tr&gt;&lt;td&gt;A3&lt;/td&gt;&lt;td&gt;B3&lt;/td&gt;&lt;td&gt;C3&lt;/td&gt;&lt;/tr&gt;&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;&lt;/table&gt;&quot;</span><span style="color: #339933;">;</span>
&nbsp;
		SimpleTableContentHandler stch <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SimpleTableContentHandler<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		XmlUtil.<span style="color: #006633;">processContentHandler</span><span style="color: #009900;">&#40;</span>stch, input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		List<span style="color: #339933;">&lt;</span>List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;&gt;</span> table <span style="color: #339933;">=</span> stch.<span style="color: #006633;">getTable</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span>, table.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// 3 rows</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">3</span>, table.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// 3 columns in first row</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span>, table.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// 2 columns in second row</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;C1&quot;</span>, table.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// contents of row 1, cell 3</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** A test class that extends XmlUtil.AbstractStackContentHandler.
	 * The &quot;real&quot; DeviceContentHandler populates DeviceTO and DevicePropertyTO objects here, 
	 * but for the purposes of this unit test, I'm just storing the result in 
	 * structured Lists of Maps.   
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> DeviceContentHandler <span style="color: #000000; font-weight: bold;">extends</span> XmlUtil.<span style="color: #006633;">AbstractStackContentHandler</span> <span style="color: #009900;">&#123;</span>
		List<span style="color: #339933;">&lt;</span>Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, Object<span style="color: #339933;">&gt;&gt;</span> result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, Object<span style="color: #339933;">&gt;&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, Object<span style="color: #339933;">&gt;</span> d <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">// current device</span>
		Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, String<span style="color: #339933;">&gt;</span> prop <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">// current property</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// the 'path' variable is maintained by the AbstractStackContentHandler as a </span>
		<span style="color: #666666; font-style: italic;">// slash-delimited path of the current element within the XML document. </span>
&nbsp;
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** paths that match this pattern define attributes of a device */</span>
		Pattern p1 <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;^devices/device/(name|className|type|active|universeNumber)$&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** stacks that match this pattern define attributes of a deviceProperty */</span>
		Pattern p2 <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;^devices/device/deviceProperties/deviceProperty/(key|value)$&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** process the start of an XML element */</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> element<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> path<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>path.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;devices/device&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				d <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> HashMap<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, Object<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				d.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;deviceProperties&quot;</span>, <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, String<span style="color: #339933;">&gt;&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;;</span>
				result.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>d<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>path.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;devices/device/deviceProperties&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #666666; font-style: italic;">// </span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>path.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;devices/device/deviceProperties/deviceProperty&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				prop <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> HashMap<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">List</span><span style="color: #009900;">&#41;</span> d.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;deviceProperties&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>prop<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** process the text of an XML element */</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> elementText<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> path, <span style="color: #003399;">String</span> content<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException <span style="color: #009900;">&#123;</span>
			Matcher m1 <span style="color: #339933;">=</span> p1.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>path<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>m1.<span style="color: #006633;">matches</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				d.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>m1.<span style="color: #006633;">group</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>, content<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
				Matcher m2 <span style="color: #339933;">=</span> p2.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>path<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>m2.<span style="color: #006633;">matches</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					prop.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>m2.<span style="color: #006633;">group</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>, content<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testProcessContentHandler_AbstractStack<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> SAXException, <span style="color: #003399;">IOException</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">String</span> input <span style="color: #339933;">=</span> getResourceAsString<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/device.xml&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	DeviceContentHandler dch <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> DeviceContentHandler<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	XmlUtil.<span style="color: #006633;">processContentHandler</span><span style="color: #009900;">&#40;</span>dch, input<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    	List<span style="color: #339933;">&lt;</span>Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, Object<span style="color: #339933;">&gt;&gt;</span> devices <span style="color: #339933;">=</span> dch.<span style="color: #006633;">result</span><span style="color: #339933;">;</span>
    	assertEquals<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">4</span>, devices.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    	Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, Object<span style="color: #339933;">&gt;</span> device <span style="color: #339933;">=</span> devices.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// second device</span>
    	assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Art-Net&quot;</span>, device.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;name&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;com.randomnoun.dmx.dmxDevice.artNet.ArtNet&quot;</span>, device.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;className&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    	List<span style="color: #339933;">&lt;</span>Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, String<span style="color: #339933;">&gt;&gt;</span> properties <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">List</span><span style="color: #009900;">&#41;</span> device.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;deviceProperties&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	assertEquals<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">6</span>, properties.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// seven properties</span>
&nbsp;
    	Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, String<span style="color: #339933;">&gt;</span> property <span style="color: #339933;">=</span> properties.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;artNetSubnetId&quot;</span>, property.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;key&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;0&quot;</span>, property.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;value&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-tagsoupinput-txt"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>tagsoupInput.txt</div><div class="toggler-target toggle-block toggler-class-tagsoupinput-txt"><div class="toggler-hide-ghost"><pre lang="" line="1" escaped="true">&lt;META-START&gt;
John Cowan
&lt;TABLE&gt;
&lt;ROW&gt;
&lt;CELL&gt;SOUPE&lt;/CELL&gt;
&lt;CELL&gt;BE EVIL!&lt;/CELL&gt;&lt;/ROW&gt;
DE BALISES&lt;/TABLE&gt;
&lt;CORR NEW=&quot;U&quot; LOC=&quot;PI&quot;/&gt;
&lt;G ID=&quot;P1&quot;&gt;
Ecritez une balise ouvrante (sans attributs)
&lt;/G&gt;
ou fermante HTML ici, s.v.p.&lt;/META-START&gt;
&lt;FONT&gt;X Y &lt;p&gt; ABC &lt;/FONT&gt; xyz
QRS&lt;sup&gt;TUV&lt;sub&gt;WXY&lt;/sup&gt;Z&lt;/sub&gt;
&lt;script language=&quot;javascript&quot;&gt;&lt;p&gt;&lt;/script&gt;
&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th&gt;ABC
&lt;/table&gt;&lt;nr/&gt;
&lt;meta&gt;&lt;meta&gt;&lt;meta&gt;&lt;meta&gt;
&lt;pre xml:space=&quot;default&quot;&gt;test&lt;/pre&gt;
&lt;test xmlns:xml=&quot;http://www.example.org/&gt;
&lt;/test&gt;&lt;hr/&gt;
(add a random HTML tag above)
&lt;r:r:r:test/&gt;
&lt;b&gt;&lt;i&gt;&lt;/B&gt;&lt;/I&gt;
&lt;b&gt;
  &lt;p&gt;bbb&lt;/b&gt;&lt;/p&gt;
  &lt;p&gt;bbb&lt;/b&gt;&lt;/p&gt;
  &lt;p&gt;bbb&lt;/b&gt;&lt;/p&gt;
&lt;blink&gt;&amp;grec;
&lt;p xmlns:xqp=&quot;http://www.w3.org/1998/XML&quot;&gt;
 &lt;span xqp:space=&quot;preserve&quot;&gt;~~~&lt;/span&gt;
&lt;/p&gt;&lt;/blink&gt;
&lt;html:p xmlns:html=&quot;http://....&quot;&gt;&lt;/p&gt;
&lt;@/&gt;&lt;!--Apple logo in PUA--&gt;
&lt;!--comment--comment--&gt;
&lt;!--comment--comment&gt;
&lt;P&gt;]]&gt;
&lt;P id=&quot;7&quot; id=&quot;8&quot;&gt;M&lt;/p&gt;
&lt;p xmlns:a=&quot;urn&quot; xmlns:b=&quot;urn&quot;
   a:id=&quot;7&quot; b:id=&quot;9&quot;&gt;~~~&lt;/p&gt;
&lt;p id=&quot;a&quot; idref=&quot;a&quot;/&gt;  BE EVIL!
&lt;extreme sID=&quot;a&quot; mood=&quot;happy&quot;/&gt;
&lt;extreme eID=&quot;a&quot; mood=&quot;sad&quot;/&gt;
&lt;math&gt;&lt;mi&gt;2&lt;/mi&gt;&lt;msup&gt;3
  &lt;/msup&gt;&lt;/math&gt;  &lt;title&gt;
&lt;verse&gt;&lt;seg&gt;When,&lt;/seg&gt;&lt;seg&gt;in&lt;/line&gt;
&lt;line&gt;the beginning&lt;/line&gt;&lt;line&gt;God created
the heaven and the earth.&lt;/line&gt;&lt;/verse&gt;
&lt;How/&gt;&lt;To/&gt;&lt;Markup/&gt;&lt;Legibly/&gt;
&lt;Name Name=&quot;Name&quot;&gt;Name&lt;/Name&gt;
&lt;list 4 text &lt;/p&gt;
&lt;marquee&gt;foo!&lt;/marquee&gt;</pre></div></div>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-tagsoupoutput-txt"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>tagsoupOutput.txt</div><div class="toggler-target toggle-block toggler-class-tagsoupoutput-txt"><div class="toggler-hide-ghost"><pre lang="" line="1" escaped="true">&lt;META-START xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
John Cowan
&lt;table&gt;&lt;ROW&gt;
&lt;CELL&gt;SOUPE&lt;/CELL&gt;
&lt;CELL&gt;BE EVIL!&lt;/CELL&gt;&lt;/ROW&gt;&lt;/table&gt;
DE BALISES
&lt;CORR new=&quot;U&quot; loc=&quot;PI&quot;&gt;&lt;/CORR&gt;
&lt;G id=&quot;P1&quot;&gt;
Ecritez une balise ouvrante (sans attributs)
&lt;/G&gt;
ou fermante HTML ici, s.v.p.
&lt;font&gt;X Y &lt;/font&gt;&lt;p&gt; ABC  xyz
QRS&lt;sup&gt;TUV&lt;sub&gt;WXY&lt;/sub&gt;&lt;/sup&gt;&lt;sub&gt;Z&lt;/sub&gt;
&lt;script language=&quot;javascript&quot;&gt;&lt;p&gt;&lt;/script&gt;
&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th colspan=&quot;1&quot; rowspan=&quot;1&quot;&gt;ABC
&lt;/th&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;nr&gt;&lt;/nr&gt;
&lt;/p&gt;&lt;meta&gt;&lt;meta&gt;&lt;meta&gt;&lt;meta&gt;
&lt;pre xml:space=&quot;default&quot;&gt;test&lt;/pre&gt;
&lt;test http:_=&quot;http:_&quot; www.w3.org=&quot;www.w3.org&quot; _1998=&quot;_1998&quot; xml=&quot;xml&quot; xmlns:http=&quot;urn:x-prefix:http&quot;&gt;
 &lt;span xqp:space=&quot;preserve&quot; xmlns:xqp=&quot;urn:x-prefix:xqp&quot;&gt;~~~&lt;/span&gt;

&lt;html:p xmlns:html=&quot;urn:x-prefix:html&quot;&gt;
&lt;_&gt;&lt;/_&gt;

&lt;/html:p&gt;&lt;/test&gt;&lt;/META-START&gt;

</pre></div></div>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-device-xml"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>device.xml</div><div class="toggler-target toggle-block toggler-class-device-xml"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
</pre></td><td class="code"><pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;devices<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;device<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>DMXKing USB<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;className<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.randomnoun.dmx.dmxDevice.usbPro.UsbProWidget<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/className<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;type<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>D<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/type<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;active<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Y<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/active<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;universeNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/universeNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>portName<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>COM8<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/device<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;device<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Art-Net<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;className<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.randomnoun.dmx.dmxDevice.artNet.ArtNet<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/className<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;type<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>D<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/type<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;active<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;/active<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;universeNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/universeNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>artNetSubnetId<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>0<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>artNetUniverseId<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>0<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>broadcastAddress<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>192.168.0.62<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>udpRecvPort<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>6454<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>udpSendPort<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>6454<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>unicastAddress<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>192.168.0.62<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/device<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;device<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>WinAMP Controller<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;className<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.randomnoun.dmx.audioController.winampNg.WinampAudioController<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/className<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;type<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>C<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/type<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;active<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;/active<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;universeNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>null<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/universeNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>defaultPath<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>C:\DCB\audio<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>host<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>localhost<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>password<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>abc123<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>port<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>18443<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>timeout<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>3000<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/device<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;device<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Ye olde dmxy plugigne<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/name<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;className<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>com.randomnoun.dmx.audioSource.winamp.WinampAudioSource<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/className<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;type<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>S<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/type<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;active<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Y<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/active<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;universeNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>null<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/universeNumber<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>host<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>localhost<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>port<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>58273<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>timeout<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/key<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1000<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperty<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/deviceProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/device<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/devices<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div>


</div></div>
<div class="stripey-sidebox">
<p>This class is now part of the <tt><b>com.randomnoun.common:common-public</b></tt> artifact, which can be directly referenced in your <code>pom.xml</code> from the maven central repository. </p>
<p>
<div class="maven-button"><a href="http://code.randomnoun.com/common-public"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/09/maven-ball-42.png" width="42" height="42" style="margin: 5px; float:left;"/></a><a href="http://code.randomnoun.com/common-public">
<div class="big">common-public</div>
<div class="small">com.randomnoun.common:common-public</div>
<p></a></div>
</div>
<p><b>Update 25/9/2013: </b> It&#8217;s in central now</p>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2013/01/25/exciting-things-with-xml/#respond" title="Comment on Exciting things with XML">No comments</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a> <a href="http://www.randomnoun.com/wp/tag/xml/" rel="tag">xml</a></p>      </div>
		</div>

				<div class="post-112 post type-post status-publish format-standard hentry category-uncategorized tag-java tag-sdlc tag-vmaint">
			<h2 id="post-112"><a href="http://www.randomnoun.com/wp/2013/01/20/the-randomnoun-sdlc/" rel="bookmark" title="Permanent Link to The randomnoun SDLC">The randomnoun SDLC</a></h2>
			<small class="meta">January 20th, 2013 </small>

			<div class="entry">
				<style>
.li-spaced LI { margin-top: 15px; }
.footnoteref { vertical-align: super; font-size: 80%; }
.footnoteline { width:50%; height:2px; border-top: solid 1px gray; "/>
</style>
<p>The <b>SDLC</b> is the <b>Software Development Lifecycle</b>. It defines the various states that a piece of software goes through before you, the end user, get your grubby mitts on it.</p>
<p>Every software company has one, and everyone does it slightly differently. </p>
<p><center><br />
<div id="attachment_167" class="wp-caption alignnone" style="width: 410px"><a href="http://www.randomnoun.com/wp/2013/01/20/the-randomnoun-sdlc/sdlc/" rel="attachment wp-att-167"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2013/01/sdlc.png" alt="The results you get when you put &quot;software lifecycle&quot; into google image search" width="400" height="231" class="size-full wp-image-167" /></a><p class="wp-caption-text">The results you get when you enter &#8220;software lifecycle&#8221; into <a href="https://www.google.com/search?num=10&#038;hl=en&#038;site=&#038;tbm=isch&#038;source=hp&#038;biw=1256&#038;bih=717&#038;q=software+lifecycle">google image search</a></p></div><br />
</center></p>
<p>Here&#8217;s mine, which I&#8217;ve taken the liberty of <a href="http://en.wikipedia.org/wiki/Hyperlink">hyperlinking</a> when I start using strange words.</p>
<ul class="li-spaced">
<li>There are four <i>regions</i>, or <i>environments</i> <a name="fn1back" href="#fn1" class="footnoteref">[1]</a>. These are:
<ul class="li-spaced">
<li><b>Development</b> (<code><b>DEV</b></code>): an internal region where the software developer writes, tests and debugs new code, typically in <a href="http://www.eclipse.org/">Eclipse</a>.
<li><b>Test</b> (<code><b>TST</b></code>): an internal region used to aggregate all changes made by developers (if there&#8217;s more than one), to perform internal QA and integration tests before anything is seen by clients (where a &#8216;client&#8217; here is the person or organisation who&#8217;s paying for the code to be developed).
<li><b>Acceptance</b> (<code><b>XPT</b></code>): a public region where changes to the application can be viewed by client management without being seen by the rest of the world. Clients perform their own QA in this region before approving the site to go live.
<li><b>Production</b> (<code><b>PRD</b></code>): the publicly-visible, &#8220;live&#8221; application
</ul>
<li>All randomnoun projects <b>start out</b> in <code>DEV</code>.
<li>Application <b>code</b> is migrated in the order <code>DEV</code> &#8594;  <code>TST</code> &#8594; <code>XPT</code> &#8594; <code>PRD</code>
<li>Application <b>data</b> is initially <b>migrated</b> in the order <code>DEV</code> &#8594; <code>TST</code> &#8594; <code>XPT</code> &#8594; <code>PRD</code>, but is occasionally <b>anonymised</b> and <b>regressed</b> from <code>PRD</code> back to <code>XPT</code> back to <code>TST</code> back to <code>DEV</code>.
<li>All projects are <b>source controlled</b> (usually in <a href="http://en.wikipedia.org/wiki/Concurrent_Versions_System">CVS</a>), and dependency managed by <a href="http://maven.apache.org/what-is-maven.html">Maven</a>
<li>All projects are <b>continually integrated</b> (in <a href="http://www.atlassian.com/software/bamboo/overview">bamboo</a>)
<li>All projects have <b>build artifacts</b> stored in a <b>repository</b> (<a href="http://www.sonatype.org/nexus/">nexus</a>)
<li>Some projects have <b>issue trackers</b> (in <a href="http://www.atlassian.com/software/jira/overview">jira</a>)
<li>All projects are <b>deployed/migrated</b> from region to region by <a href="http://www.vmaint.com/">vmaint</a>
<li>All project <b>servers</b> have <b>environments</b> managed by <a href="http://www.vmaint.com/">vmaint</a>
<li><b><code>DEV</code> &#8594; <code>TST</code> transitions</b> are performed by copying the latest &#8220;<a href="http://www.sonatype.com/books/mvnref-book/reference/pom-relationships-sect-pom-syntax.html"><b>snapshot</b></a>&#8221; build artifact from nexus onto the <code>TST</code> server, and performing any environment / database updates.
<li><b><code>TST</code> &#8594; <code>XPT</code> transitions</b> are performed by performing a <b><a href="http://www.sonatype.com/people/2011/01/using-the-maven-release-plugin-things-to-know/">maven release</a></b>, then copying the release build artifact from nexus onto the <code>XPT</code> server (+ environment/database updates)
<li><b><code>XPT</code> &#8594; <code>PRD</code> transitions</b> are performed by copying the release build artifact from nexus onto the <code>PRD</code> server (+ environment/database updates)
<li>All projects have <a href="http://en.wikipedia.org/wiki/Domain_Name_System"><b>DNS</b></a> assigned by randomnoun for internal (<code>DEV</code>, <code>TST</code>) regions, and by <a href="http://signup.namingwords.com/">namingwords</a> for external (<code>XPT</code>, <code>PRD</code>) regions
<li>All project servers are <b>hosted</b> by randomnoun for internal (<code>DEV</code>, <code>TST</code>) regions, and by <a href="http://aws.amazon.com/ec2/">AWS EC2</a> for external (<code>XPT</code>, <code>PRD</code>) regions
<li>All deployed applications are capable of <b>reporting</b> their <b>maven release numbers</b> (and <b>bamboo build numbers</b>, if applicable)
<li>All project servers are <b>monitored</b> by <a href="www.vmaint.com">vmaint</a>, <a href="http://www.nagios.org/">nagios</a>, <a href="http://munin-monitoring.org/">munin</a> and <a href="http://oss.oetiker.ch/mrtg/">MRTG</a>
<li>The user interfaces of all web-facing projects are <b>HTTP monitored</b> by <a href="www.vmaint.com">vmaint</a>, <a href="http://www.nagios.org/">nagios</a>, and some by <a href="https://www.pingdom.com/">pingdom</a>
</ul>
<p>So anyway, that&#8217;ll probably do for now. I&#8217;ll probably write up some more enthralling text on the individual bullet points above at a later stage.</p>
<p>Stay tuned.</p>
<div class="footnoteline"></div>
<p><a name="fn1" href="#fn1back">[1]</a> much like the <a href="http://en.wikipedia.org/wiki/All_the_world%27s_a_stage">7 stages of man</a>, or, probably more accurately, the <a href="http://en.wikipedia.org/wiki/5_Stages_of_Grief">5 stages of grief</a>, which at least has acceptance in there somewhere.</p>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2013/01/20/the-randomnoun-sdlc/#respond" title="Comment on The randomnoun SDLC">No comments</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a> <a href="http://www.randomnoun.com/wp/tag/sdlc/" rel="tag">sdlc</a> <a href="http://www.randomnoun.com/wp/tag/vmaint/" rel="tag">vmaint</a></p>      </div>
		</div>

				<div class="post-84 post type-post status-publish format-standard hentry category-uncategorized tag-common tag-java tag-logging">
			<h2 id="post-84"><a href="http://www.randomnoun.com/wp/2013/01/13/logging/" rel="bookmark" title="Permanent Link to Logging">Logging</a></h2>
			<small class="meta">January 13th, 2013 </small>

			<div class="entry">
				<style>
.yellow { border: solid 1px #E6DB55; background-color: #FFFFE0; border-radius: 3px; padding: 5px; width: 225px; margin: 3px; }
.dict-word, .dict-definition, .dict-type, .dict-pronunciation {
  font-family: arial;
  font-size: 22px;
  color: #212121;
  font-weight: 100;
}
.dict-pronunciation { font-size: 12px; }
.dict-type { font-size: 16px; color: #878787; }
.dict-definition { font-size: 13px; }
</style>
<p>I have a bit of time to burn, so lets talk about logging.</p>
<div style="float:right; margin-left: 10px;">
<div id="attachment_167" class="wp-caption alignleft" style="width: 310px"><a href="http://www.youtube.com/watch?v=8L6Dpq5kY_A"><img class="size-medium wp-image-167" alt="log" src="http://www.randomnoun.com/wp/wp-content/uploads/2013/01/log-300x240.jpg" width="300" height="240" /></a><p class="wp-caption-text"><a href="http://www.youtube.com/watch?v=8L6Dpq5kY_A">Log ! (from BLAMMO!)</a> You must click this link.</p></div>
</div>
<div class="yellow">
<div class="dict-word">log·ging</div>
<div class="dict-pronunciation">Pronunciation: /ˈlôgiNG/</div>
</div>
<p>And because this is a nerd blog, that&#8217;d be </p>
<div class="yellow">
<div class="dict-type">Noun</div>
<div class="dict-definition">The creation of a register of the operation of a machine.</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&#8230; and not</p>
<div class="yellow">
<div class="dict-type">Noun</div>
<div class="dict-definition">The activity or business of felling trees and cutting and preparing the timber..</div>
</div>
<p><!-- TODO: fix margins on floating captioned imgs --></p>
<div style="clear:left"></div>
<p><b>Logging</b> is great, you should do more of it, especially just before your application crashes and people expect you to be able to recreate your database from the contents of it.</p>
<p>What&#8217;s that ? You didn&#8217;t log every non-password input field that people type into your site ? </p>
<p>Good luck explaining to your unhappy boss / customer that the reason they can&#8217;t create an account on your travel / entertainment / fishing / adventure / finance / social / cheese-making website is because they can&#8217;t type an email address in properly. </p>
<p>If you didn&#8217;t log it, it didn&#8217;t happen.</p>
<p>Log files also have the nice property that they&#8217;re usually just composed of line-delimited unstructured data, which makes it perfect for people to put them into <a href="http://nosql-database.org/">NoSQL</a> datastores and fail to do <a href="http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt">JOIN</a>s on them.</p>
<p>I use <a href="http://logging.apache.org/log4j/2.x/"><b>log4j</b></a>, which is what everyone else in the world uses, except for those people who use <a href="http://docs.oracle.com/javase/1.4.2/docs/guide/util/logging/overview.html">java.util.logging (jul)</a>, and/or those people who use <a href="http://commons.apache.org/logging/">apache commons logging</a> or <a href="http://www.slf4j.org/">slf4j</a>. </p>
<p>But they just end up <a href="http://commons.apache.org/logging/apidocs/org/apache/commons/logging/impl/Log4JLogger.html">wrapping</a> <a href="http://people.apache.org/~psmith/logging.apache.org/sandbox/jul-log4j-bridge/examples.html">log4j</a> <a href="http://www.slf4j.org/legacy.html">anyway</a>, so let&#8217;s just ignore those weirdos.</p>
<div class="stripey-sidebox">
Logging has possibly the simplest API that you&#8217;re likely to come across (usually along the lines of <code>logger.debug("Contented burbling")</code>), so everyone thinks they can do it slightly better. </p>
<p>What if you had finer levels of logging granularity, allowing even <i>more</i> contented burbling ? </p>
<p>What if you removed the log4j dependency ? </p>
<p>What if you create yet another API wrapping all the other APIs that everyone else has wrapped around log4j ? </p>
<p>What if you introduced heretofore unprecedented levels of indirection in your configuration files ?</p>
<p>and so on.
</p></div>
<p>Some useful classes that aren&#8217;t included in the standard log4j distribution that I end up using regularly are:</p>
<ul>
<li><b>Log4jCliConfiguration</b> which I use in <a href="http://www.cryptonomicon.com/beginning.html">command-line interface</a> (CLI) programs to initialise log4j relatively sanely. See the source code below for the defaults I use. They can be overridden by supplying a Properties object conforming to the <a href="http://logging.apache.org/log4j/1.2/manual.html">standard log4j properties format</a>.
<li><b>MemoryAppender</b> which I use to create an in-memory list of recent logging events (usually to allow dumping to a webpage for debugging), saving you the hassle of actually logging onto the machine to view the logs.
</ul>
<p>and so, through the goodness and altruism that comes with releasing yet more code into the world, I give you the surprisingly unit-tested <b>Log4jCliConfiguration</b> class:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-log4jcliconfiguration-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>Log4jCliConfiguration.java</div><div class="toggler-target toggle-block toggler-class-log4jcliconfiguration-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common.log4j</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Properties</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.PropertyConfigurator</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** Configures log4j for command-line interface programs.
 * 
 * &lt;p&gt;By default, everything's sent to stdout, using the following log4j initilisation properties:
 * 
 * &lt;pre&gt;
log4j.rootCategory=DEBUG, CONSOLE
log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender
log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout
log4j.appender.CONSOLE.layout.ConversionPattern=%d{ABSOLUTE} %-5p %c - %m %n
&nbsp;
log4j.logger.org.springframework=INFO
&nbsp;
# log4j.appender.FILE=com.randomnoun.common.log4j.CustomRollingFileAppender
# log4j.appender.FILE.File=c:\\eomail.log
# log4j.appender.FILE.MaxBackupIndex=100
# log4j.appender.FILE.layout=org.apache.log4j.PatternLayout
# log4j.appender.FILE.layout.ConversionPattern=%d{dd/MM/yy HH:mm:ss.SSS} %-5p %c - %m %n
   &lt;/pre&gt;
 * 
 * &lt;p&gt;with an optional line prefix before the &lt;code&gt;%d{ABSOLUTE}&lt;/code&gt; in the ConversionPattern.
 * 
 * @see http://logging.apache.org/log4j/1.2/manual.html
 * 
 * &lt;p&gt;TODO: Support XML-based configurators
 * 
 * @blog http://www.randomnoun.com/wp/2013/01/13/logging/
 * @author knoxg
 * @version $Id: Log4jCliConfiguration.java,v 1.3 2013-09-24 02:37:09 knoxg Exp $
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Log4jCliConfiguration <span style="color: #009900;">&#123;</span>
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: Log4jCliConfiguration.java,v 1.3 2013-09-24 02:37:09 knoxg Exp $&quot;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Create a new Log4jCliConfiguration instance */</span>
	<span style="color: #000000; font-weight: bold;">public</span> Log4jCliConfiguration<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Initialise log4j.
	 * 
	 * @param logFormatPrefix a string prefixed to each log. Useful for program identifiers;
	 *   e.g. &quot;[programName] &quot;
	 * @param override if non-null, additional log4j properties. Any properties contained in 
	 *   this object will override the defaults.
	 * 
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> init<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> logFormatPrefix, <span style="color: #003399;">Properties</span> override<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>logFormatPrefix<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
			logFormatPrefix <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span> 
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
			logFormatPrefix <span style="color: #339933;">+=</span> <span style="color: #0000ff;">&quot; &quot;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #003399;">Properties</span> lp <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Properties</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		lp.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.rootCategory&quot;</span>, <span style="color: #0000ff;">&quot;DEBUG, CONSOLE&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		lp.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.appender.CONSOLE&quot;</span>, <span style="color: #0000ff;">&quot;org.apache.log4j.ConsoleAppender&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		lp.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.appender.CONSOLE.layout&quot;</span>, <span style="color: #0000ff;">&quot;org.apache.log4j.PatternLayout&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		lp.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.appender.CONSOLE.layout.ConversionPattern&quot;</span>, logFormatPrefix <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;%d{ABSOLUTE} %-5p %c - %m%n&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		lp.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.logger.org.springframework&quot;</span>, <span style="color: #0000ff;">&quot;INFO&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// since Spring is a bit too verbose for my liking at DEBUG level</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">/*
		lp.put(&quot;log4j.appender.FILE&quot;, &quot;com.randomnoun.common.log4j.CustomRollingFileAppender&quot;);
		lp.put(&quot;log4j.appender.FILE.File&quot;, &quot;c:\\eomail.log&quot;);
		lp.put(&quot;log4j.appender.FILE.MaxBackupIndex&quot;, &quot;100&quot;);
		lp.put(&quot;log4j.appender.FILE.layout&quot;, &quot;org.apache.log4j.PatternLayout&quot;);
		lp.put(&quot;log4j.appender.FILE.layout.ConversionPattern&quot;, &quot;%d{dd/MM/yy HH:mm:ss.SSS} %-5p %c - %m %n&quot;);
		*/</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>override<span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> lp.<span style="color: #006633;">putAll</span><span style="color: #009900;">&#40;</span>override<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
		PropertyConfigurator.<span style="color: #006633;">configure</span><span style="color: #009900;">&#40;</span>lp<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-log4jcliconfigurationtest-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>Log4jCliConfigurationTest.java</div><div class="toggler-target toggle-block toggler-class-log4jcliconfigurationtest-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common.log4j</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.ByteArrayOutputStream</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.PrintStream</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Properties</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.Logger</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.randomnoun.common.log4j.Log4jCliConfigurationTest</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">junit.framework.TestCase</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/**
 * Unit test for Log4jCliConfigurationTest
 *
 * @blog http://www.randomnoun.com/wp/2013/01/13/logging/
 * @version $Id: Log4jCliConfigurationTest.java,v 1.3 2013-09-24 02:37:09 knoxg Exp $
 * @author knoxg
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Log4jCliConfigurationTest
	<span style="color: #000000; font-weight: bold;">extends</span> TestCase
<span style="color: #009900;">&#123;</span>
&nbsp;
	<span style="color: #003399;">ByteArrayOutputStream</span> baos<span style="color: #339933;">;</span>
	<span style="color: #003399;">PrintStream</span> stdout<span style="color: #339933;">;</span> 
	<span style="color: #003399;">PrintStream</span> out<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Redirect System.out to something we can inspect
	 */</span>
	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		out <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		stdout <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">out</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">setOut</span><span style="color: #009900;">&#40;</span>out<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 */</span>
	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">void</span> tearDown<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
	<span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// reset System.out back to stdout</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">setOut</span><span style="color: #009900;">&#40;</span>stdout<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testNoLogPrefix<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// CRLFs on windows</span>
		<span style="color: #003399;">String</span> lineSeparator <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">getProperty</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;line.separator&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		
		<span style="color: #003399;">String</span> regex, line<span style="color: #339933;">;</span>
&nbsp;
		Log4jCliConfiguration lcc <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Log4jCliConfiguration<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		lcc.<span style="color: #006633;">init</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span>, <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;testLogger&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		regex <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;^[0-9]{2}:[0-9]{2}:[0-9]{2},[0-9]{3} INFO  testLogger - info message$&quot;</span><span style="color: #339933;">;</span>
		line <span style="color: #339933;">=</span> baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">split</span><span style="color: #009900;">&#40;</span>lineSeparator<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// should look something like &quot;06:52:08,156 INFO  testLogger - info message&quot;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;String '&quot;</span> <span style="color: #339933;">+</span> line <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;' does not match regex '&quot;</span> <span style="color: #339933;">+</span> regex <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;'&quot;</span>, line.<span style="color: #006633;">matches</span><span style="color: #009900;">&#40;</span>regex<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		logger.<span style="color: #006633;">debug</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;debug message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		regex <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;^[0-9]{2}:[0-9]{2}:[0-9]{2},[0-9]{3} DEBUG testLogger - debug message$&quot;</span><span style="color: #339933;">;</span>
		line <span style="color: #339933;">=</span> baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">split</span><span style="color: #009900;">&#40;</span>lineSeparator<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;String '&quot;</span> <span style="color: #339933;">+</span> line <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;' does not match regex '&quot;</span> <span style="color: #339933;">+</span> regex <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;'&quot;</span>, line.<span style="color: #006633;">matches</span><span style="color: #009900;">&#40;</span>regex<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testWithPrefix<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// CRLFs on windows</span>
		<span style="color: #003399;">String</span> lineSeparator <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">getProperty</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;line.separator&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		
		<span style="color: #003399;">String</span> regex, line<span style="color: #339933;">;</span>
&nbsp;
		Log4jCliConfiguration lcc <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Log4jCliConfiguration<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		lcc.<span style="color: #006633;">init</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;[Log4jCliConfigurationTest]&quot;</span>, <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;testLogger&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		regex <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;^<span style="color: #000099; font-weight: bold;">\\</span>[Log4jCliConfigurationTest<span style="color: #000099; font-weight: bold;">\\</span>] [0-9]{2}:[0-9]{2}:[0-9]{2},[0-9]{3} INFO  testLogger - info message$&quot;</span><span style="color: #339933;">;</span>
		line <span style="color: #339933;">=</span> baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">split</span><span style="color: #009900;">&#40;</span>lineSeparator<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// should look something like &quot;06:52:08,156 INFO  testLogger - info message&quot;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;String '&quot;</span> <span style="color: #339933;">+</span> line <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;' does not match regex '&quot;</span> <span style="color: #339933;">+</span> regex <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;'&quot;</span>, line.<span style="color: #006633;">matches</span><span style="color: #009900;">&#40;</span>regex<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		logger.<span style="color: #006633;">debug</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;debug message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		regex <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;^<span style="color: #000099; font-weight: bold;">\\</span>[Log4jCliConfigurationTest<span style="color: #000099; font-weight: bold;">\\</span>] [0-9]{2}:[0-9]{2}:[0-9]{2},[0-9]{3} DEBUG testLogger - debug message$&quot;</span><span style="color: #339933;">;</span>
		line <span style="color: #339933;">=</span> baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">split</span><span style="color: #009900;">&#40;</span>lineSeparator<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;String '&quot;</span> <span style="color: #339933;">+</span> line <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;' does not match regex '&quot;</span> <span style="color: #339933;">+</span> regex <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;'&quot;</span>, line.<span style="color: #006633;">matches</span><span style="color: #009900;">&#40;</span>regex<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testPropertiesOverride<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// CRLFs on windows</span>
		<span style="color: #003399;">String</span> lineSeparator <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">getProperty</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;line.separator&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		
		<span style="color: #003399;">String</span> regex, line<span style="color: #339933;">;</span>
&nbsp;
		Log4jCliConfiguration lcc <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Log4jCliConfiguration<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Properties</span> props <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Properties</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		props.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.rootCategory&quot;</span>, <span style="color: #0000ff;">&quot;INFO, CONSOLE&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">// set default threshold to 'INFO' level</span>
		lcc.<span style="color: #006633;">init</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;[Log4jCliConfigurationTest]&quot;</span>, props<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;testLogger&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		regex <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;^<span style="color: #000099; font-weight: bold;">\\</span>[Log4jCliConfigurationTest<span style="color: #000099; font-weight: bold;">\\</span>] [0-9]{2}:[0-9]{2}:[0-9]{2},[0-9]{3} INFO  testLogger - info message$&quot;</span><span style="color: #339933;">;</span>
		line <span style="color: #339933;">=</span> baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">split</span><span style="color: #009900;">&#40;</span>lineSeparator<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// should look something like &quot;06:52:08,156 INFO  testLogger - info message&quot;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;String '&quot;</span> <span style="color: #339933;">+</span> line <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;' does not match regex '&quot;</span> <span style="color: #339933;">+</span> regex <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;'&quot;</span>, line.<span style="color: #006633;">matches</span><span style="color: #009900;">&#40;</span>regex<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		logger.<span style="color: #006633;">debug</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;debug message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;debug message should have been suppressed&quot;</span>, 
			baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">split</span><span style="color: #009900;">&#40;</span>lineSeparator<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">length</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<p>with which you can do things like this:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-log4jcliexample-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>Log4jCliExample.java</div><div class="toggler-target toggle-block toggler-class-log4jcliexample-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.example.contrived.cli</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a 
 * &lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by/3.0/&quot;&gt;Creative Commons Attribution 3.0 Unported License&lt;/a&gt;.
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.text.SimpleDateFormat</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Date</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.TimeZone</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.Logger</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.randomnoun.common.log4j.Log4jCliConfiguration</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** This program tells you what time it is in Antarctica.
 * 
 * &lt;p&gt;It will return with an exit-code of zero if successful, 1 otherwise.
 *
 * @blog http://www.randomnoun.com/wp/2012/12/26/something
 * @version $Id: Log4jCliExample.java,v 1.3 2013-01-13 12:28:03 knoxg Exp $
 * @author knoxg
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Log4jCliExample <span style="color: #009900;">&#123;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Logger instance for this class */</span>
	<span style="color: #000000; font-weight: bold;">static</span> Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span>Log4jCliExample.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Command-line interface.
	 * 
	 * @param args command-line arguments
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> main<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> args<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
			Log4jCliConfiguration lcc <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Log4jCliConfiguration<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			lcc.<span style="color: #006633;">init</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;[Log4jCliExample]&quot;</span>, <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
			<span style="color: #003399;">Date</span> now <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Date</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #003399;">SimpleDateFormat</span> sdf <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">SimpleDateFormat</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;EEE dd/MMM/yyyy HH:mm:ss Z&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
			sdf.<span style="color: #006633;">setTimeZone</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">TimeZone</span>.<span style="color: #006633;">getTimeZone</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Antarctica/Mawson&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Taking into consideration the change in timezone in 2009,&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;The time at the Australian Mawson Station in &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Antarctica is currently &quot;</span> <span style="color: #339933;">+</span> sdf.<span style="color: #006633;">format</span><span style="color: #009900;">&#40;</span>now<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
			sdf.<span style="color: #006633;">setTimeZone</span><span style="color: #009900;">&#40;</span><span style="color: #003399;">TimeZone</span>.<span style="color: #006633;">getTimeZone</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Antarctica/Palmer&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Whereas on the other side of the planet in Palmer Station,&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Antarctica, they keep the same time as Punta Arenas, Chile,&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;because, that's the other end of their supply line.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Prior to that, before the Falklands War in May 1982,&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Palmer used to be supplied from Argentina.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;The time at Palmer Station is currently &quot;</span> <span style="color: #339933;">+</span> sdf.<span style="color: #006633;">format</span><span style="color: #009900;">&#40;</span>now<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Exception</span> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			logger.<span style="color: #006633;">error</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Exception in main&quot;</span>, e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #003399;">System</span>.<span style="color: #006633;">exit</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #003399;">System</span>.<span style="color: #006633;">exit</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<p>which generates this (there&#8217;s a scrollbar there which you can click and drag to see more words magically appear):</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="text" style="font-family:monospace;">[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample - Taking into consideration the change in timezone in 2009, 
[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample - The time at the Australian Mawson Station in  
[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample - Antarctica is currently Sat 12/Jan/2013 02:07:32 +0500 
[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample -  
[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample - Whereas on the other side of the planet in Palmer Station, 
[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample - Antarctica, they keep the same time as Punta Arenas, Chile, 
[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample - because, that's the other end of their supply line. 
[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample - Prior to that, before the Falklands War in May 1982, 
[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample - Palmer used to be supplied from Argentina. 
[Log4jCliExample] 07:07:32,359 INFO  com.example.contrived.cli.Log4jCliExample - The time at Palmer Station is currently Fri 11/Jan/2013 18:07:32 -0300</pre></td></tr></table></div>

<p>which you&#8217;ll note has a </p>
<ul>
<li>a <b>standard line prefix</b> (&#8220;<tt>[Log4jCliExample]</tt>&#8221; and the current time), followed by
<li>the <b>logging level</b> (usually one of <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>, <code>FATAL</code>),
<li>the name of the <b>java class</b> doing the logging,
<li>and the <b>log message</b>.
</ul>
<p>You probably want to add <b>thread ids</b>, <b>usernames</b> and other markers to your logging in order to more accurately <b>allocate blame</b> for when you need to read these logs. (I use a <a href="http://tomcat.apache.org/tomcat-5.5-doc/servletapi/javax/servlet/Filter.html">servlet filter</a> to set a <a href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/MDC.html">log4j MDC variable</a> with the current username, but you can use whatever you have lying around the home).</p>
<p>The timestamps in the standard prefix are all in the <b>local server time</b>, which, if you have a bit of forethought, you might want to <a href="http://en.wikipedia.org/wiki/Coordinated_Universal_Time"><b>set to UTC</b></a>. </p>
<p>This will make co-ordinating your <a href="http://www.roflcat.com/facebook-cat">geographically</a> <a href="http://www.reddit.com/r/cats">dispersed</a> <a href="http://www.flickr.com/photos/tags/cats/">automated</a> <a href="https://picasaweb.google.com/103058650558056611610/CatsInIslamicCultures">system</a> <a href="https://www.google.com.au/search?q=cats">for</a> <a href="http://www.corbisimages.com/Search#p=1&#038;q=cats">collecting</a> <a href="http://www.bing.com/images/search?q=cats">pictures</a> <a href="http://www.picsearch.com/index.cgi?cols=&#038;width=1146&#038;q=cats">of</a> <a href="http://articles.businessinsider.com/2012-01-14/tech/30626733_1_google-project-google-decline-businesses">cats</a> that much easier.</p>
<p>So. Where was I ? Ah yes. Here&#8217;s the <b>MemoryAppender</b> code and unit test:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-memoryappender-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>MemoryAppender.java</div><div class="toggler-target toggle-block toggler-class-memoryappender-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common.log4j</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.*</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.*</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.spi.LoggingEvent</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/**
 * Log4j appender to capture logging events in an in-memory List. I'm amazed
 * this isn't in the log4j package.
 *
 * &lt;p&gt;The code in this class is roughly based on the WriterAppender class
 * in the log4j source code.
 * 
 * &lt;p&gt;This appender can be configured using the property &quot;maximumLogSize&quot; 
 * which limits the number of logging events captured by this class (old events
 * are popped off the list when the list becomes full).
 * 
 * &lt;p&gt;Use the {@link #getLoggingEvents()} to return the List of events written
 * to this class. This list is a *copy* of the list contained within this class,
 * so it can safely be iterated over even if logging events are still
 * occurring in an application.
 * 
 * &lt;p&gt;Example log4j configuration:
 * &lt;pre class=&quot;code&quot;&gt;
 * log4j.rootLogger=DEBUG, MEMORY
 * 
 * log4j.appender.MEMORY=com.randomnoun.common.log4j.MemoryAppender
 * log4j.appender.MEMORY.MaximumLogSize=1000
 * &lt;/pre&gt;
 * 
 * You can then obtain the list of events via the code:
 * &lt;pre&gt;
 * MemoryAppender memoryAppender = (MemoryAppender) Logger.getRootLogger().getAppender(&quot;MEMORY&quot;);
 * List events = memoryAppender.getEvents();
 * &lt;/pre&gt;
 *
 * @blog http://www.randomnoun.com/wp/2013/01/13/logging/
 * @version $Id: MemoryAppender.java,v 1.3 2013-09-24 02:37:09 knoxg Exp $
 * @author knoxg
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MemoryAppender
    <span style="color: #000000; font-weight: bold;">extends</span> AppenderSkeleton
<span style="color: #009900;">&#123;</span>
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: MemoryAppender.java,v 1.3 2013-09-24 02:37:09 knoxg Exp $&quot;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">long</span> DEFAULT_LOG_SIZE <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1000</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000066; font-weight: bold;">long</span> maximumLogSize <span style="color: #339933;">=</span> DEFAULT_LOG_SIZE<span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">private</span> LinkedList<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span> loggingEvents<span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Create a new MemoryAppender object */</span>
    <span style="color: #000000; font-weight: bold;">public</span> MemoryAppender<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #666666; font-style: italic;">// this should be a LinkList since we use this data structure as a queue</span>
        loggingEvents <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> LinkedList<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Create a new MemoryAppender with the specified log size
     * 
     * @param logSize The maximum number of logging events to store in this class 
     */</span> 
    <span style="color: #000000; font-weight: bold;">public</span> MemoryAppender<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> logSize<span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">maximumLogSize</span> <span style="color: #339933;">=</span> logSize<span style="color: #339933;">;</span>
        <span style="color: #666666; font-style: italic;">// this should be a LinkList since we use this data structure as a queue</span>
        loggingEvents <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> LinkedList<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Immediate flush is always set to true, regardless of how
     *  this logger is configured. 
     *
     * @param value ignored
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setImmediateFlush<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">boolean</span> value<span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #666666; font-style: italic;">// this method does nothing</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Returns value of the &lt;b&gt;ImmediateFlush&lt;/b&gt; option. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">boolean</span> getImmediateFlush<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Set the maximum log size */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setMaximumLogSize<span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">long</span> logSize<span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">maximumLogSize</span> <span style="color: #339933;">=</span> logSize<span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Return the maximum log size */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">long</span> getMaximumLogSize<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">return</span> maximumLogSize<span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** This method does nothing. 
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> activateOptions<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
       This method is called by the {@link AppenderSkeleton#doAppend}
       method.
       &lt;p&gt;If the output stream exists and is writable then write a log
       statement to the output stream. Otherwise, write a single warning
       message to &lt;code&gt;System.err&lt;/code&gt;.
       &lt;p&gt;The format of the output will depend on this appender's
       layout.
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> append<span style="color: #009900;">&#40;</span>LoggingEvent event<span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #666666; font-style: italic;">// Reminder: the nesting of calls is:</span>
        <span style="color: #666666; font-style: italic;">//</span>
        <span style="color: #666666; font-style: italic;">//    doAppend()</span>
        <span style="color: #666666; font-style: italic;">//      - check threshold</span>
        <span style="color: #666666; font-style: italic;">//      - filter</span>
        <span style="color: #666666; font-style: italic;">//      - append();</span>
        <span style="color: #666666; font-style: italic;">//        - checkEntryConditions();</span>
        <span style="color: #666666; font-style: italic;">//        - subAppend();</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>checkEntryConditions<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
        <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">return</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
&nbsp;
        subAppend<span style="color: #009900;">&#40;</span>event<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
       This method determines if there is a sense in attempting to append.
       &lt;p&gt;It checks whether there is a set output target and also if
       there is a set layout. If these checks fail, then the boolean
       value &lt;code&gt;false&lt;/code&gt; is returned. 
&nbsp;
       &lt;p&gt;This method always returns true; which I guess means we can't have
       thresholds set on our MemoryAppender.
     */</span>
    <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">boolean</span> checkEntryConditions<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #666666; font-style: italic;">/*
           if (this.layout == null)
           {
               errorHandler.error(&quot;No layout set for the appender named [&quot; + name + &quot;].&quot;);
               return false;
           } */</span>
        <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Close this appender instance. The event log list is cleared by this method. 
     * This method is identical to calling clear()
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">synchronized</span> <span style="color: #000066; font-weight: bold;">void</span> close<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        loggingEvents.<span style="color: #006633;">clear</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Clear all events from this appender. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">synchronized</span> <span style="color: #000066; font-weight: bold;">void</span> clear<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> 
    <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">synchronized</span><span style="color: #009900;">&#40;</span>loggingEvents<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			loggingEvents.<span style="color: #006633;">clear</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Actual appending occurs here. */</span>
    <span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">void</span> subAppend<span style="color: #009900;">&#40;</span>LoggingEvent event<span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #666666; font-style: italic;">// this.qw.write(this.layout.format(event));</span>
        <span style="color: #000000; font-weight: bold;">synchronized</span><span style="color: #009900;">&#40;</span>loggingEvents<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>loggingEvents.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;=</span> maximumLogSize<span style="color: #009900;">&#41;</span>
	        <span style="color: #009900;">&#123;</span>
	            loggingEvents.<span style="color: #006633;">removeLast</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	        <span style="color: #009900;">&#125;</span>
&nbsp;
	        loggingEvents.<span style="color: #006633;">addFirst</span><span style="color: #009900;">&#40;</span>event<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
       The MemoryAppender does not require a layout. Hence, this method returns
       &lt;code&gt;false&lt;/code&gt;.
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">boolean</span> requiresLayout<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">false</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Returns a list of logging events captured by this appender. (This list 
     *  is cloned in order to prevent ConcurrentModificationExceptions occuring
     *  whilst iterating through it) */</span>
    <span style="color: #000000; font-weight: bold;">public</span> List<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span> getLoggingEvents<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span>loggingEvents<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-memoryappendertest-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>MemoryAppenderTest.java</div><div class="toggler-target toggle-block toggler-class-memoryappendertest-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common.log4j</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.List</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Properties</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.Level</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.LogManager</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.Logger</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.PropertyConfigurator</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.spi.LoggingEvent</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.randomnoun.common.log4j.MemoryAppenderTest</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">junit.framework.TestCase</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/**
 * Unit test for Log4jCliConfigurationTest
 * 
 * @blog http://www.randomnoun.com/wp/2013/01/13/logging/
 * @version $Id: MemoryAppenderTest.java,v 1.3 2013-09-24 02:37:09 knoxg Exp $
 * @author knoxg
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MemoryAppenderTest
	<span style="color: #000000; font-weight: bold;">extends</span> TestCase
<span style="color: #009900;">&#123;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Reset log4j before each test
	 */</span>
	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		LogManager.<span style="color: #006633;">resetConfiguration</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 */</span>
	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">void</span> tearDown<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
	<span style="color: #009900;">&#123;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testMemoryAppenderViaProperties<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
		<span style="color: #003399;">Properties</span> props <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Properties</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		props.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.rootCategory&quot;</span>, <span style="color: #0000ff;">&quot;INFO, MEMORY&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		props.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.appender.MEMORY&quot;</span>, <span style="color: #0000ff;">&quot;com.randomnoun.common.log4j.MemoryAppender&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// layouts have no effect on MemoryAppenders</span>
		<span style="color: #666666; font-style: italic;">//props.put(&quot;log4j.appender.MEMORY.layout&quot;, &quot;org.apache.log4j.PatternLayout&quot;);</span>
		<span style="color: #666666; font-style: italic;">//props.put(&quot;log4j.appender.MEMORY.layout.ConversionPattern&quot;, &quot;%d{dd/MM/yy HH:mm:ss.SSS} %-5p %c - %m%n&quot;);</span>
		props.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.appender.MEMORY.MaximumLogSize&quot;</span>, <span style="color: #cc66cc;">100</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		PropertyConfigurator.<span style="color: #006633;">configure</span><span style="color: #009900;">&#40;</span>props<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;testLogger&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		MemoryAppender memoryAppender <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>MemoryAppender<span style="color: #009900;">&#41;</span> Logger.<span style="color: #006633;">getRootLogger</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getAppender</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;MEMORY&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		List<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span> loggingEvents<span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000066; font-weight: bold;">long</span> start <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">currentTimeMillis</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">long</span> end <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">currentTimeMillis</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		loggingEvents <span style="color: #339933;">=</span> memoryAppender.<span style="color: #006633;">getLoggingEvents</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message in memoryAppender&quot;</span>, loggingEvents.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message&quot;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message&quot;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getRenderedMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertNotNull<span style="color: #009900;">&#40;</span>loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getLoggerName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>Level.<span style="color: #006633;">INFO</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getLevel</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// NB: timestamp field requires log4j 1.2.15</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;timestamp of loggingEvent &gt;= start&quot;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getTimeStamp</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;=</span> start<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;timestamp of loggingEvent &lt;= end&quot;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getTimeStamp</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&lt;=</span> end<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		logger.<span style="color: #006633;">debug</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;debug message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		loggingEvents <span style="color: #339933;">=</span> memoryAppender.<span style="color: #006633;">getLoggingEvents</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;debug message suppressed from memoryAppender&quot;</span>, loggingEvents.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testMemoryAppenderViaObjectModel<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;testLogger&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		Logger.<span style="color: #006633;">getRootLogger</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">setLevel</span><span style="color: #009900;">&#40;</span>Level.<span style="color: #006633;">INFO</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		MemoryAppender memoryAppender <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MemoryAppender<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		logger.<span style="color: #006633;">removeAllAppenders</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		logger.<span style="color: #006633;">addAppender</span><span style="color: #009900;">&#40;</span>memoryAppender<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		List<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span> loggingEvents<span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000066; font-weight: bold;">long</span> start <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">currentTimeMillis</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">long</span> end <span style="color: #339933;">=</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">currentTimeMillis</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		loggingEvents <span style="color: #339933;">=</span> memoryAppender.<span style="color: #006633;">getLoggingEvents</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message in memoryAppender&quot;</span>, loggingEvents.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message&quot;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;info message&quot;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getRenderedMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertNotNull<span style="color: #009900;">&#40;</span>loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getLoggerName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>Level.<span style="color: #006633;">INFO</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getLevel</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// NB: timestamp field requires log4j 1.2.15</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;timestamp of loggingEvent &gt;= start&quot;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getTimeStamp</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;=</span> start<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;timestamp of loggingEvent &lt;= end&quot;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getTimeStamp</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&lt;=</span> end<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		logger.<span style="color: #006633;">debug</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;debug message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		loggingEvents <span style="color: #339933;">=</span> memoryAppender.<span style="color: #006633;">getLoggingEvents</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;debug message suppressed from memoryAppender&quot;</span>, loggingEvents.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testLogWindowSize<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// create a MemoryLogger capable of holding 10 entries</span>
&nbsp;
		<span style="color: #003399;">Properties</span> props <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Properties</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		props.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.rootCategory&quot;</span>, <span style="color: #0000ff;">&quot;INFO, MEMORY&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		props.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.appender.MEMORY&quot;</span>, <span style="color: #0000ff;">&quot;com.randomnoun.common.log4j.MemoryAppender&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		props.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;log4j.appender.MEMORY.MaximumLogSize&quot;</span>, <span style="color: #0000ff;">&quot;10&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		PropertyConfigurator.<span style="color: #006633;">configure</span><span style="color: #009900;">&#40;</span>props<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;testLogger&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		MemoryAppender memoryAppender <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>MemoryAppender<span style="color: #009900;">&#41;</span> Logger.<span style="color: #006633;">getRootLogger</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getAppender</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;MEMORY&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		List<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span> loggingEvents<span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// write five messages. </span>
		<span style="color: #666666; font-style: italic;">// the 0th message in MemoryAppender should be the most recent (i.e. message #5)</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;=</span><span style="color: #cc66cc;">5</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;message number &quot;</span> <span style="color: #339933;">+</span> i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		loggingEvents <span style="color: #339933;">=</span> memoryAppender.<span style="color: #006633;">getLoggingEvents</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;5 info messages in memoryAppender&quot;</span>, loggingEvents.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">5</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;message number &quot;</span> <span style="color: #339933;">+</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">5</span> <span style="color: #339933;">-</span> i<span style="color: #009900;">&#41;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getRenderedMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// write another five messages</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">6</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;=</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;message number &quot;</span> <span style="color: #339933;">+</span> i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		loggingEvents <span style="color: #339933;">=</span> memoryAppender.<span style="color: #006633;">getLoggingEvents</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;10 info messages in memoryAppender&quot;</span>, loggingEvents.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">10</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;message number &quot;</span> <span style="color: #339933;">+</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">10</span> <span style="color: #339933;">-</span> i<span style="color: #009900;">&#41;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getRenderedMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// write another five messages (memoryAppender should just contain messages 6-15)</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">11</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;=</span><span style="color: #cc66cc;">15</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;message number &quot;</span> <span style="color: #339933;">+</span> i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		loggingEvents <span style="color: #339933;">=</span> memoryAppender.<span style="color: #006633;">getLoggingEvents</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">System</span>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>loggingEvents.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;10 info messages in memoryAppender&quot;</span>, loggingEvents.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">10</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			assertEquals<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;message number &quot;</span> <span style="color: #339933;">+</span> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">15</span> <span style="color: #339933;">-</span> i<span style="color: #009900;">&#41;</span>, loggingEvents.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getRenderedMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<p>The example servlet here will start a Timer that logs a message every second, every once in a while throwing an Exception just to keep things interesting. </p>
<p>It forwards to the JSP, which is responsible for displaying every <a href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/spi/LoggingEvent.html">LoggingEvent</a> contained within the MemoryAppender, and contains links to reset the MemoryAppender. </p>
<p>In a real debug page, you probably want the ability to increase/decrease logging levels for various <A href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/Logger.html">Logger</a> objects, as well as tweak other log4j settings.</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-memoryappenderexampleservlet-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>MemoryAppenderExampleServlet.java</div><div class="toggler-target toggle-block toggler-class-memoryappenderexampleservlet-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.example.contrived.web.servlet</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a 
 * &lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by/3.0/&quot;&gt;Creative Commons Attribution 3.0 Unported License&lt;/a&gt;.
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.IOException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.List</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Timer</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.TimerTask</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.RequestDispatcher</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.ServletConfig</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.ServletException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.http.HttpServlet</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.http.HttpServletRequest</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.servlet.http.HttpServletResponse</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.Logger</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.spi.LoggingEvent</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.example.contrived.web.config.AppConfig</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.randomnoun.common.log4j.MemoryAppender</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** A servlet which just displays all messages from the MemoryAppender.
 * 
 * &lt;p&gt;When the servlet is initialised (usually the first time it is invoked), it will
 * start a Timer which generates a log message every second.
 * 
 * &lt;p&gt;This servlet will always forward to the memoryAppenderExample.jsp, which 
 * simply displays all the collected LoggingEvents in a table.
 * 
 * &lt;p&gt;HTTP request parameters:
 * &lt;attributes&gt;
 * clear - if present, will clear all events from the MemoryAppender
 * &lt;/attributes&gt;
 *
 * &lt;p&gt;Note it's usually considered Bad Form to run Timers within Servlets, but this is
 * just an example.
 * 
 * @blog http://www.randomnoun.com/wp/2013/01/13/logging/
 * @version $Id: MemoryAppenderExampleServlet.java,v 1.3 2013-01-13 13:18:02 knoxg Exp $
 * @author knoxg
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MemoryAppenderExampleServlet <span style="color: #000000; font-weight: bold;">extends</span> HttpServlet <span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: MemoryAppenderExampleServlet.java,v 1.3 2013-01-13 13:18:02 knoxg Exp $&quot;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Logger instance for this class */</span>
	Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span>MemoryAppenderExampleServlet.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** This timer is used to generate log messages every second or so */</span>
	<span style="color: #003399;">Timer</span> timer<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** This task generates the log messages */</span>
	<span style="color: #003399;">TimerTask</span> timerTask<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Start the timer when the servlet is initialised */</span>
	@Override
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> init<span style="color: #009900;">&#40;</span>ServletConfig config<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> ServletException <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">super</span>.<span style="color: #006633;">init</span><span style="color: #009900;">&#40;</span>config<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		timer <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> java.<span style="color: #006633;">util</span>.<span style="color: #003399;">Timer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		timerTask <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">TimerTask</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066; font-weight: bold;">long</span> i <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
			@Override
			<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> run<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Math</span>.<span style="color: #006633;">random</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0.9</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #003399;">Exception</span> e <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">RuntimeException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Test exception&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;This is log message number &quot;</span> <span style="color: #339933;">+</span> i <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; with an exception&quot;</span>, e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
					logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;This is log message number &quot;</span> <span style="color: #339933;">+</span> i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
				i<span style="color: #339933;">++;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
		timer.<span style="color: #006633;">schedule</span><span style="color: #009900;">&#40;</span>timerTask, <span style="color: #cc66cc;">1000</span>, <span style="color: #cc66cc;">1000</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;MemoryAppenderExample Timer started&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Stop the timer when the app is destroyed */</span>
	@Override
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> destroy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">super</span>.<span style="color: #006633;">destroy</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		timerTask.<span style="color: #006633;">cancel</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		timer.<span style="color: #006633;">purge</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;MemoryAppenderExample Timer stopped&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Display a list of all logging messages from the MemoryAppender */</span>
	@Override
	<span style="color: #000000; font-weight: bold;">protected</span> <span style="color: #000066; font-weight: bold;">void</span> doGet<span style="color: #009900;">&#40;</span>HttpServletRequest request, HttpServletResponse response<span style="color: #009900;">&#41;</span>
		<span style="color: #000000; font-weight: bold;">throws</span> ServletException, <span style="color: #003399;">IOException</span> 
	<span style="color: #009900;">&#123;</span>
		AppConfig appConfig <span style="color: #339933;">=</span> AppConfig.<span style="color: #006633;">getAppConfig</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// this will initialise log4j</span>
		MemoryAppender appender <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>MemoryAppender<span style="color: #009900;">&#41;</span> Logger.<span style="color: #006633;">getRootLogger</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getAppender</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;MEMORY&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">// reset the appender if a clear parameter is present</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>request.<span style="color: #006633;">getParameter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;clear&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			appender.<span style="color: #006633;">clear</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		List<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span> events <span style="color: #339933;">=</span> appender.<span style="color: #006633;">getLoggingEvents</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		request.<span style="color: #006633;">setAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;events&quot;</span>, events<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		RequestDispatcher rd <span style="color: #339933;">=</span> request.<span style="color: #006633;">getRequestDispatcher</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/memoryAppenderExample.jsp&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		rd.<span style="color: #006633;">forward</span><span style="color: #009900;">&#40;</span>request, response<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-memoryappenderexample-jsp"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>memoryAppenderExample.jsp</div><div class="toggler-target toggle-block toggler-class-memoryappenderexample-jsp"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #339933;">&lt;%</span>@ page 
  language<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;java&quot;</span>
  contentType<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;text/html; charset=ISO-8859-1&quot;</span>
  pageEncoding<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;ISO-8859-1&quot;</span>
  errorPage<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;misc/errorPage.jsp&quot;</span>
  <span style="color: #000000; font-weight: bold;">import</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;java.util.*,java.text.*,org.apache.log4j.spi.LoggingEvent,com.randomnoun.common.ExceptionUtils&quot;</span>
<span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;%!</span>
	<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a 
 	 * &lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by/3.0/&quot;&gt;Creative Commons Attribution 3.0 Unported License&lt;/a&gt;.
 	 */</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Revision marker for use in stack traces */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: memoryAppenderExample.jsp,v 1.3 2013-01-11 20:03:22 knoxg Exp $&quot;</span><span style="color: #339933;">;</span> 
<span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;</span>html<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>head<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;!--</span> $Id<span style="color: #339933;">:</span> memoryAppenderExample.<span style="color: #006633;">jsp</span>,v <span style="color: #cc66cc;">1.3</span> <span style="color: #cc66cc;">2013</span><span style="color: #339933;">-</span>01<span style="color: #339933;">-</span><span style="color: #cc66cc;">11</span> <span style="color: #cc66cc;">20</span><span style="color: #339933;">:</span>03<span style="color: #339933;">:</span><span style="color: #cc66cc;">22</span> knoxg Exp $ <span style="color: #339933;">--&gt;</span>
<span style="color: #339933;">&lt;</span>title<span style="color: #339933;">&gt;</span>Logging messages<span style="color: #339933;">&lt;/</span>title<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>style<span style="color: #339933;">&gt;</span>
BODY <span style="color: #009900;">&#123;</span> font<span style="color: #339933;">-</span>family<span style="color: #339933;">:</span> Arial<span style="color: #339933;">;</span> font<span style="color: #339933;">-</span>size<span style="color: #339933;">:</span> 10pt<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
H1 <span style="color: #009900;">&#123;</span> font<span style="color: #339933;">-</span>family<span style="color: #339933;">:</span> Arial<span style="color: #339933;">;</span> font<span style="color: #339933;">-</span>size<span style="color: #339933;">:</span> 14pt<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
TABLE <span style="color: #009900;">&#123;</span> margin<span style="color: #339933;">-</span>top<span style="color: #339933;">:</span> 10px<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
TD <span style="color: #009900;">&#123;</span> font<span style="color: #339933;">-</span>family<span style="color: #339933;">:</span> Verdana<span style="color: #339933;">;</span> font<span style="color: #339933;">-</span>size<span style="color: #339933;">:</span> 8pt<span style="color: #339933;">;</span> vertical<span style="color: #339933;">-</span>align<span style="color: #339933;">:</span> top<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
<span style="color: #339933;">&lt;/</span>style<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;/</span>head<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>body<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>h1<span style="color: #339933;">&gt;</span>Here ye, here ye. <span style="color: #006633;">Here</span> is a list of all known proclamations by <span style="color: #000000; font-weight: bold;">this</span> application.<span style="color: #339933;">&lt;/</span>h1<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>p<span style="color: #339933;">&gt;&lt;</span>a href<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;memoryAppenderExample&quot;</span><span style="color: #339933;">&gt;</span>Click here to refresh<span style="color: #339933;">&lt;/</span>a<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>p<span style="color: #339933;">&gt;&lt;</span>a href<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;memoryAppenderExample?clear=Y&quot;</span><span style="color: #339933;">&gt;</span>Click here to clear messages<span style="color: #339933;">&lt;/</span>a<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>table<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;%</span>
    <span style="color: #003399;">SimpleDateFormat</span> sdf <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">SimpleDateFormat</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;dd/MMM/yyyy HH:mm:ss&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// server timezone</span>
    List<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span> events <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>List<span style="color: #339933;">&lt;</span>LoggingEvent<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#41;</span> request.<span style="color: #006633;">getAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;events&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>events<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">||</span> events.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<span style="color: #339933;">%&gt;</span>
	<span style="color: #339933;">&lt;</span>tr<span style="color: #339933;">&gt;</span>
		<span style="color: #339933;">&lt;</span>td colspan<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;3&quot;</span><span style="color: #339933;">&gt;</span>No events recorded<span style="color: #339933;">&lt;/</span>td<span style="color: #339933;">&gt;</span>
	<span style="color: #339933;">&lt;/</span>tr<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;%</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>events.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	    	LoggingEvent event <span style="color: #339933;">=</span> events.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #339933;">%&gt;</span>
    <span style="color: #339933;">&lt;</span>tr<span style="color: #339933;">&gt;</span>
    	<span style="color: #339933;">&lt;</span>td<span style="color: #339933;">&gt;&lt;%=</span> i <span style="color: #339933;">%&gt;&lt;/</span>td<span style="color: #339933;">&gt;</span>
    	<span style="color: #339933;">&lt;</span>td<span style="color: #339933;">&gt;&lt;%=</span> sdf.<span style="color: #006633;">format</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Date</span><span style="color: #009900;">&#40;</span>event.<span style="color: #006633;">getTimeStamp</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%&gt;&lt;/</span>td<span style="color: #339933;">&gt;</span>
    	<span style="color: #339933;">&lt;</span>td<span style="color: #339933;">&gt;&lt;%=</span> event.<span style="color: #006633;">getLevel</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%&gt;</span>
        <span style="color: #339933;">&lt;</span>td<span style="color: #339933;">&gt;&lt;%=</span> event.<span style="color: #006633;">getRenderedMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;%</span>
	        <span style="color: #003399;">Throwable</span> exception <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>event.<span style="color: #006633;">getThrowableInformation</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				exception <span style="color: #339933;">=</span> event.<span style="color: #006633;">getThrowableInformation</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getThrowable</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
	        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>exception<span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	    	    <span style="color: #003399;">String</span> exceptionText <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;&lt;br/&gt;&lt;pre&gt;&quot;</span> <span style="color: #339933;">+</span>  
	      	      ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>exception, <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>,
	    		    ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_HTML</span>, <span style="color: #0000ff;">&quot;com.randomnoun.,com.example.contrived.,org.apache.jsp.&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> 
	    		  <span style="color: #0000ff;">&quot;&lt;/pre&gt;&quot;</span><span style="color: #339933;">;</span>
	    		out.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span>exceptionText<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	        <span style="color: #009900;">&#125;</span>
<span style="color: #339933;">%&gt;</span>
        <span style="color: #339933;">&lt;/</span>td<span style="color: #339933;">&gt;</span>
    <span style="color: #339933;">&lt;/</span>tr<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;%</span>
	    <span style="color: #009900;">&#125;</span>
<span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;/</span>table<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;%</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;/</span>body<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;/</span>html<span style="color: #339933;">&gt;</span></pre></td></tr></table></div>


</div></div>
<p>which will look a little bit like this in your web browser:</p>
<div class="wp-caption">
<div style="width:570px; height:348px; overflow:scroll;"><a href="http://tst.randomnoun.com/wp/wp-content/uploads/2013/01/memoryAppenderExample.png"><img style="max-width:inherit;" src="http://www.randomnoun.com/wp/wp-content/uploads/2013/01/memoryAppenderExample.png" alt="Output from running the example servlet" width="1096" height="467" class="size-full wp-image-247" /></a></div>
<p class="wp-caption-text">Output from running the example servlet</p>
</div>
<p><br/>Which you&#8217;ll notice also uses <a href="http://www.randomnoun.com/wp/2012/12/17/marginally-better-stack-traces/">marginally better stack traces</a>.</p>
<p>So hopefully that all makes sense.</p>
<p>No need to thank me.</p>
<div class="stripey-sidebox">
<p>This class is now part of the <tt><b>com.randomnoun.common:common-public</b></tt> artifact, which can be directly referenced in your <code>pom.xml</code> from the maven central repository. </p>
<p>
<div class="maven-button"><a href="http://code.randomnoun.com/common-public"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/09/maven-ball-42.png" width="42" height="42" style="margin: 5px; float:left;"/></a><a href="http://code.randomnoun.com/common-public">
<div class="big">common-public</div>
<div class="small">com.randomnoun.common:common-public</div>
<p></a></div>
</div>
<p><b>Update 25/9/2013: </b> It&#8217;s in central now</p>
<p><b>Update 24/1/2013</b>: Added the bit about NoSQL</p>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2013/01/13/logging/#comments" title="Comment on Logging">1 comment</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/common/" rel="tag">common</a> <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a> <a href="http://www.randomnoun.com/wp/tag/logging/" rel="tag">logging</a></p>      </div>
		</div>

				<div class="post-60 post type-post status-publish format-standard hentry category-uncategorized tag-common tag-java tag-jna">
			<h2 id="post-60"><a href="http://www.randomnoun.com/wp/2012/12/26/automating-windows-from-java-and-windowtreedom/" rel="bookmark" title="Permanent Link to Automating Windows&trade; from Java&reg; and WindowTreeDom☂">Automating Windows&trade; from Java&reg; and WindowTreeDom<sup><sup>☂</sup></sup></a></h2>
			<small class="meta">December 26th, 2012 </small>

			<div class="entry">
				<style>
.wtd-pre {
  font-size: 8pt;
  line-height: 8pt;
}
</style>
<p><i>(So anyway there used to be a page on <a href="http://www.codeproject.com/">codeproject</a> to some of these ideas implemented in C#, but I can&#8217;t find it any more. I&#8217;m sure it exists.)</i></p>
<p>So let&#8217;s say you&#8217;re writing your <a href="http://en.wikipedia.org/wiki/Software_as_a_service">everything-is-a-service</a> web application and you&#8217;ve got <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">REST</a>ful and/or <a href="http://www.w3.org/TR/soap/">SOAP</a>y calls to your middle tier and everything&#8217;s going swimmingly until you discover you need to integrate your app with some 80&#8242;s-era <a href="http://en.wikipedia.org/wiki/Rapid_application_development">RAD</a> Windows application that no-one has the sourcecode to and embodies some vital bit of <a href="http://www.gartner.com/technology/research/hype-cycles/">business intelligence</a> that you need. </p>
<p>This application was written by IBM on the hard drive platters of angels so isn&#8217;t going anyway any time soon, but for the purposes of this blog post, let&#8217;s call that application &#8220;Notepad&#8221; [*]</p>
<div class="stripey-sidebox">
[*]: (For those on <a href="http://en.wikipedia.org/wiki/Windows_8">Windows Metro</a>, notepad is this application that allows you to write words into a white square on your computer screen and gives you the ability to recall those words later on if you give it what we in the tech industry call a &#8220;file name&#8221;. This is a bit like a URL, except it doesn&#8217;t run on <a href="https://mozillalabs.com/en-US/raindrop/">raindrops</a> and <a href="http://www.android.com/about/ice-cream-sandwich/">icecream</a>).
</div>
<p>Wouldn&#8217;t it be nice if your software could automatically interact with that application, wrap it up in a <a href="http://en.wikipedia.org/wiki/Service-oriented_architecture">service-oriented</a> bow and then deliver it&#8217;s results to you in a method that some would consider slightly more standardised ?</p>
<p>Of course it would.</p>
<p>So lets have a look at the frontend to Notepad&#8217;s data layer, the &#8216;Save As&#8217; dialog box:</p>
<div id="attachment_65" class="wp-caption alignnone" style="width: 460px"><a href="http://www.randomnoun.com/wp/2012/12/26/automating-windows-from-java-and-windowtreedom/spy-saveas2/" rel="attachment wp-att-65"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/12/spy-saveas2.png" alt="A &#039;Save As&#039; dialog box" width="450" height="364" class="size-full wp-image-65" /></a><p class="wp-caption-text">A &#8216;Save As&#8217; dialog box in Windows XP</p></div>
<p><br/><br />
The dialog box is made up of windows and controls, which are visible in the Windows&trade; window hierarchy. </p>
<p>If you fire up the venerable <a href="http://msdn.microsoft.com/en-us/library/aa264396%28v=vs.60%29.aspx">Spy++</a> from MSDN, you&#8217;ll notice that all the objects on your desktop, including the dialog box, are arranged in a treelike structure.<br />
<br/></p>
<div id="attachment_63" class="wp-caption alignnone" style="width: 442px"><a href="http://www.randomnoun.com/wp/2012/12/26/automating-windows-from-java-and-windowtreedom/spy-saveas/" rel="attachment wp-att-63"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/12/spy-saveas.png" alt="A &#039;Save As&#039; dialog box in Spy++"  width="432" height="469" class="aligncenter size-full wp-image-63" /></a><p class="wp-caption-text">A &#8216;Save As&#8217; dialog box in Spy++</p></div>
<p><br/><br />
The Document Object Model (<a href="http://www.w3.org/DOM/">DOM</a>) is also a treelike structure, and has a whole arsenal of utilities that operate on it (<a href="http://www.w3.org/TR/xslt">XSLT</a>, <a href="http://www.w3.org/TR/xpath/">XPath</a>, that sort of thing).</p>
<p>So let&#8217;s represent the window tree as a DOM tree, with each element of the XML tree representing a window in the Windows&trade; window tree:</p>
<p><br/></p>
<pre class="wtd-pre">
...
<b>&lt;window class="Notepad" hwnd="native@0x761476" title="Untitled - Notepad"&gt;</b>
  <b>&lt;window class="#32770" hwnd="native@0x2e1528"
    owner="native@0x761476" title="Save As"&gt;</b>
    &lt;window class="tooltips_class32" hwnd="native@0x4158a"
      owner="native@0x2e1528" title=""/&gt;
    &lt;window class="tooltips_class32" hwnd="native@0x3159c"
      owner="native@0x2e1528" title=""/&gt;
    &lt;window class="Static" hwnd="native@0x681474" title="Save &amp;amp;in:"/&gt;
    &lt;window class="ComboBox" hwnd="native@0x84141c" title=""/&gt;
    &lt;window class="Static" hwnd="native@0x121534" title=""/&gt;
    &lt;window class="ToolbarWindow32" hwnd="native@0x41580" title=""/&gt;
    &lt;window class="ToolbarWindow32" hwnd="native@0x19154e" title=""/&gt;
    &lt;window class="ListBox" hwnd="native@0x3157c" title=""/&gt;
    &lt;window class="SHELLDLL_DefView" hwnd="native@0x3159a" title=""&gt;
      &lt;window class="SysListView32" hwnd="native@0x31596" title="FolderView"/&gt;
    &lt;/window&gt;
    &lt;window class="Static" hwnd="native@0x31566" title="File &amp;amp;name:"/&gt;
    &lt;window class="ComboBoxEx32" hwnd="native@0x31574" title=""&gt;
      &lt;window class="ComboBox" hwnd="native@0x31578" title=""&gt;
        &lt;window class="Edit" hwnd="native@0x31570" title=""/&gt;
      &lt;/window&gt;
    &lt;/window&gt;
    &lt;window class="Static" hwnd="native@0x3157a" title="Save as &amp;amp;type:"/&gt;
    &lt;window class="ComboBox" hwnd="native@0x31582" title=""/&gt;
    &lt;window class="Button" hwnd="native@0x21568" title="Open as &amp;amp;read-only"/&gt;
    <b>&lt;window class="Button" hwnd="native@0x2156a" title="&amp;amp;Save"/&gt;</b>
    &lt;window class="Button" hwnd="native@0x21564" title="Cancel"/&gt;
    &lt;window class="Button" hwnd="native@0x21562" title="&amp;amp;Help"/&gt;
    &lt;window class="ScrollBar" hwnd="native@0x2155a" title=""/&gt;
    &lt;window class="#32770" hwnd="native@0x2155c" title=""&gt;
      &lt;window class="Static" hwnd="native@0x21586" title="&amp;amp;Encoding:"/&gt;
      &lt;window class="ComboBox" hwnd="native@0x2155e" title=""/&gt;
    &lt;/window&gt;
    &lt;window class="IME" hwnd="native@0xd1554" owner="native@0x2e1528" title="Default IME"&gt;
      &lt;window class="MSCTFIME UI" hwnd="native@0x7b1478"
        owner="native@0xd1554" title="M"/&gt;
    &lt;/window&gt;
  &lt;/window&gt;
  &lt;window class="Edit" hwnd="native@0x11152c" title=""/&gt;
  &lt;window class="msctls_statusbar32" hwnd="native@0xbe1422" title=""/&gt;
&lt;/window&gt;
...
</pre>
<p><br/><br />
Then to find a particular window, we could code up something similar to the following:<br />
<br/></p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;">WindowTreeDom wtd <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> WindowTreeDom<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Document</span> dom <span style="color: #339933;">=</span> wtd.<span style="color: #006633;">getDom</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #003399;">Element</span> okButtonEl <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span><span style="color: #009900;">&#41;</span> XPathAPI.<span style="color: #006633;">getSingleNode</span><span style="color: #009900;">&#40;</span>dom, 
    <span style="color: #0000ff;">&quot;.//window[@class='Notepad']/window[@title=<span style="color: #000099; font-weight: bold;">\&quot;</span>Save As<span style="color: #000099; font-weight: bold;">\&quot;</span>]/window[@title=<span style="color: #000099; font-weight: bold;">\&quot;</span>&amp;amp;Save<span style="color: #000099; font-weight: bold;">\&quot;</span>]&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
User32.<span style="color: #006633;">SendMessage</span><span style="color: #009900;">&#40;</span>WindowTreeDom.<span style="color: #006633;">getHwnd</span><span style="color: #009900;">&#40;</span>okButtonEl<span style="color: #009900;">&#41;</span>, WM_CLICK<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>which grabs a handle to the Save button on a Save As dialog for a notepad window, and sends a WM_CLICK message to the control&#8217;s <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms644928%28v=vs.85%29.aspx">message loop</a>.</p>
<p>Which is useful if you want to automatically press the Save button on a Save As dialog on a notepad window without paying <a href="http://loadstorm.com/2010/price-right-loadrunner">half a million dollars</a> for HP LoadRunner.</p>
<p>So here&#8217;s the code already:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-windowtreedom-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>WindowTreeDom.java</div><div class="toggler-target toggle-block toggler-class-windowtreedom-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common.jna</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.HashMap</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.Map</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.DocumentBuilder</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.DocumentBuilderFactory</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.ParserConfigurationException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.TransformerException</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.Logger</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.Document</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.Element</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.sun.jna.Native</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.sun.jna.Pointer</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.sun.jna.platform.win32.WinUser</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.sun.jna.platform.win32.WinDef.DWORD</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.sun.jna.platform.win32.WinDef.HWND</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.sun.jna.platform.win32.WinUser.WNDENUMPROC</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.sun.jna.win32.StdCallLibrary</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.sun.jna.win32.W32APIOptions</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.randomnoun.common.XmlUtil</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** A class to convert the Win32 windows tree into a DOM object
 * 
 * @blog http://www.randomnoun.com/wp/2012/12/26/automating-windows-from-java-and-windowtreedom/
 * @author knoxg
 * @version $Id: WindowTreeDom.java,v 1.4 2013-09-24 02:37:09 knoxg Exp $
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> WindowTreeDom <span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: WindowTreeDom.java,v 1.4 2013-09-24 02:37:09 knoxg Exp $&quot;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">// the User32 functions we invoke from this class</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">interface</span> User32 <span style="color: #000000; font-weight: bold;">extends</span> StdCallLibrary <span style="color: #009900;">&#123;</span>
      User32 INSTANCE <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>User32<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">Native</span>.<span style="color: #006633;">loadLibrary</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;user32&quot;</span>, User32.<span style="color: #000000; font-weight: bold;">class</span>, 
        W32APIOptions.<span style="color: #006633;">DEFAULT_OPTIONS</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
      <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> DWORD GW_OWNER <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> DWORD<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000066; font-weight: bold;">boolean</span> EnumWindows<span style="color: #009900;">&#40;</span>WinUser.<span style="color: #006633;">WNDENUMPROC</span> lpEnumFunc, Pointer arg<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000066; font-weight: bold;">boolean</span> EnumChildWindows<span style="color: #009900;">&#40;</span>HWND hWnd, WNDENUMPROC lpEnumFunc, Pointer data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000066; font-weight: bold;">int</span> GetWindowText<span style="color: #009900;">&#40;</span>HWND hWnd, <span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> lpString, <span style="color: #000066; font-weight: bold;">int</span> nMaxCount<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000066; font-weight: bold;">int</span> GetClassName<span style="color: #009900;">&#40;</span>HWND hWnd, <span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> lpClassName, <span style="color: #000066; font-weight: bold;">int</span> nMaxCount<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000000; font-weight: bold;">public</span> HWND GetWindow<span style="color: #009900;">&#40;</span>HWND hWnd, DWORD cmd<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      HWND GetParent<span style="color: #009900;">&#40;</span>HWND hWnd<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** JNA interface to USER32.DLL */</span>
	<span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000000; font-weight: bold;">static</span> User32 lib <span style="color: #339933;">=</span> User32.<span style="color: #006633;">INSTANCE</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Logger instance for this class */</span>
	<span style="color: #000000; font-weight: bold;">static</span> Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span>WindowTreeDom.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** WindowTreeDom constructor.
	 * 
	 * @see #getDom()
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> WindowTreeDom<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** This callback is invoked for each window found. It generates XML 
	 * {#link org.w3c.Element}s for each window, and attaches them to the supplied 
	 * {#link org.w3c.Document}.
	 * 
	 */</span>
	<span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> WindowCallback <span style="color: #000000; font-weight: bold;">implements</span> WinUser.<span style="color: #006633;">WNDENUMPROC</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">Document</span> doc<span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> documentElement<span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> topLevelWindow<span style="color: #339933;">;</span> 
		Map<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, Element<span style="color: #339933;">&gt;</span> hwndMap <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> HashMap<span style="color: #339933;">&lt;</span><span style="color: #003399;">String</span>, Element<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** Creates a new window callback
		 * 
		 * @param doc The XML document populated by this callback.
		 * @param topLevelHWND If non-null, the windows being returned should all be
		 *   child windows of this HWND (via EnumChildWindows), otherwise it is
		 *   assumed toplevel windows are returned (via EnumWindows)
		 * @param topLevelWindow If non-null, the document Element within &lt;tt&gt;doc&lt;/tt&gt;
		 *   which will contain new child elements.
		 */</span>
		<span style="color: #000000; font-weight: bold;">public</span> WindowCallback<span style="color: #009900;">&#40;</span><span style="color: #003399;">Document</span> doc, HWND topLevelHWND, <span style="color: #003399;">Element</span> topLevelWindow<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">doc</span> <span style="color: #339933;">=</span> doc<span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">topLevelWindow</span> <span style="color: #339933;">=</span> topLevelWindow<span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>topLevelWindow <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				hwndMap.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>topLevelHWND.<span style="color: #006633;">getPointer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, topLevelWindow<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
			documentElement <span style="color: #339933;">=</span> doc.<span style="color: #006633;">getDocumentElement</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">boolean</span> callback<span style="color: #009900;">&#40;</span>HWND hWnd, Pointer data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
			<span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> buffer <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">512</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
			User32.<span style="color: #006633;">INSTANCE</span>.<span style="color: #006633;">GetWindowText</span><span style="color: #009900;">&#40;</span>hWnd, buffer, <span style="color: #cc66cc;">512</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
			<span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> buffer2 <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #000066; font-weight: bold;">char</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1026</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
			<span style="color: #000066; font-weight: bold;">int</span> classLen <span style="color: #339933;">=</span> User32.<span style="color: #006633;">INSTANCE</span>.<span style="color: #006633;">GetClassName</span><span style="color: #009900;">&#40;</span>hWnd, buffer2, <span style="color: #cc66cc;">1026</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
			<span style="color: #003399;">String</span> windowTitle <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">Native</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span>buffer<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #003399;">String</span> className <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">Native</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span>buffer2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
			HWND parent <span style="color: #339933;">=</span> User32.<span style="color: #006633;">INSTANCE</span>.<span style="color: #006633;">GetParent</span><span style="color: #009900;">&#40;</span>hWnd<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			HWND owner <span style="color: #339933;">=</span> User32.<span style="color: #006633;">INSTANCE</span>.<span style="color: #006633;">GetWindow</span><span style="color: #009900;">&#40;</span>hWnd, User32.<span style="color: #006633;">GW_OWNER</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		    <span style="color: #666666; font-style: italic;">// check if this has already been created in the DOM</span>
			<span style="color: #003399;">Element</span> el <span style="color: #339933;">=</span> hwndMap.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>hWnd.<span style="color: #006633;">getPointer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>el<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				el <span style="color: #339933;">=</span> doc.<span style="color: #006633;">createElement</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;window&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
				el.<span style="color: #006633;">removeAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;pwindow&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
			el.<span style="color: #006633;">setAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;hwnd&quot;</span>, hWnd.<span style="color: #006633;">getPointer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>owner<span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				el.<span style="color: #006633;">setAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;owner&quot;</span>, owner.<span style="color: #006633;">getPointer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
			el.<span style="color: #006633;">setAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;title&quot;</span>, windowTitle<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			el.<span style="color: #006633;">setAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;class&quot;</span>, className<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
			hwndMap.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>hWnd.<span style="color: #006633;">getPointer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, el<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>topLevelWindow<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
				<span style="color: #666666; font-style: italic;">// this is a real top level element, so enumerate its children</span>
				WindowCallback childDommer <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> WindowCallback<span style="color: #009900;">&#40;</span>doc, hWnd, el<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #666666; font-style: italic;">// this code relies on being able to enum child windows whilst enumming toplevel windows</span>
				lib.<span style="color: #006633;">EnumChildWindows</span> <span style="color: #009900;">&#40;</span>hWnd, childDommer, <span style="color: #000000; font-weight: bold;">new</span> Pointer<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
					childDommer.<span style="color: #006633;">checkForOrphanedWindows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span>TransformerException e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					logger.<span style="color: #006633;">error</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Problem serialising orphaned windows to XML&quot;</span>, e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
			<span style="color: #009900;">&#125;</span>
&nbsp;
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>parent<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				documentElement.<span style="color: #006633;">appendChild</span><span style="color: #009900;">&#40;</span>el<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>topLevelWindow<span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #666666; font-style: italic;">// have seen VMDragDetectWndClass'es here, presumably a vmware thing</span>
					<span style="color: #666666; font-style: italic;">// (note that this window won't be in the parent callback's hwndMap)</span>
					<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
						logger.<span style="color: #006633;">warn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Toplevel child window found: &quot;</span> <span style="color: #339933;">+</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>el, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span>TransformerException e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						logger.<span style="color: #006633;">error</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Toplevel child window found, problem serialising toplevel windows to XML&quot;</span>, e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span>
				<span style="color: #009900;">&#125;</span>
&nbsp;
			<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #003399;">Element</span> parentEl <span style="color: #339933;">=</span> hwndMap.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>parent.<span style="color: #006633;">getPointer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>parentEl<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #666666; font-style: italic;">// throw new IllegalStateException(&quot;Unknown parent window '&quot; + parent.getPointer().toString() + &quot;'&quot;);</span>
					<span style="color: #666666; font-style: italic;">// it appears that we can get IME child windows being returned </span>
					<span style="color: #666666; font-style: italic;">// by EnumWindows, even though they're not top-level</span>
					parentEl <span style="color: #339933;">=</span> doc.<span style="color: #006633;">createElement</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;window&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					parentEl.<span style="color: #006633;">setAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;pwindow&quot;</span>, <span style="color: #0000ff;">&quot;true&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					parentEl.<span style="color: #006633;">setAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;hwnd&quot;</span>, parent.<span style="color: #006633;">getPointer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					hwndMap.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>parent.<span style="color: #006633;">getPointer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, parentEl<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
				<span style="color: #009900;">&#125;</span>
				parentEl.<span style="color: #006633;">appendChild</span><span style="color: #009900;">&#40;</span>el<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
&nbsp;
			<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">true</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
		<span style="color: #008000; font-style: italic; font-weight: bold;">/** Lists any window nodes that were generated via enumeration, whose 
		 * parent nodes were not generated.
		 * 
		 * @throws TransformerException
		 */</span>
		<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> checkForOrphanedWindows<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> TransformerException <span style="color: #009900;">&#123;</span>
			<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span> e <span style="color: #339933;">:</span> hwndMap.<span style="color: #006633;">values</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>e.<span style="color: #006633;">getAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;pwindow&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #666666; font-style: italic;">// the desktop window isn't in the enumeration</span>
					logger.<span style="color: #006633;">warn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Parent window found that was not in enumeration: &quot;</span> <span style="color: #339933;">+</span> XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>e, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #666666; font-style: italic;">// throw new IllegalStateException(&quot;Window found without parent window&quot;);</span>
				<span style="color: #009900;">&#125;</span>
			<span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Generate an XML document from the Win32 window tree */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">Document</span> getDom<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> ParserConfigurationException, TransformerException <span style="color: #009900;">&#123;</span>
		DocumentBuilderFactory docBuilderFactory <span style="color: #339933;">=</span> DocumentBuilderFactory.<span style="color: #006633;">newInstance</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		DocumentBuilder docBuilder <span style="color: #339933;">=</span> docBuilderFactory.<span style="color: #006633;">newDocumentBuilder</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Document</span> doc <span style="color: #339933;">=</span> docBuilder.<span style="color: #006633;">newDocument</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Element</span> topElement <span style="color: #339933;">=</span> doc.<span style="color: #006633;">createElement</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;windows&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		doc.<span style="color: #006633;">appendChild</span><span style="color: #009900;">&#40;</span>topElement<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		WindowCallback dommer <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> WindowCallback<span style="color: #009900;">&#40;</span>doc, <span style="color: #000066; font-weight: bold;">null</span>, <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		lib.<span style="color: #006633;">EnumWindows</span> <span style="color: #009900;">&#40;</span>dommer, <span style="color: #000000; font-weight: bold;">new</span> Pointer<span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		dommer.<span style="color: #006633;">checkForOrphanedWindows</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">return</span> doc<span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #008000; font-style: italic; font-weight: bold;">/** Return the hwnd of an element, as a pointer represented as a long 
	 * 
	 * @param windowEl a window element returned from getDom()
	 * 
	 * @return the hwnd of the element.
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> HWND getHwnd<span style="color: #009900;">&#40;</span><span style="color: #003399;">Element</span> windowEl<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #003399;">String</span> hwndString <span style="color: #339933;">=</span> windowEl.<span style="color: #006633;">getAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;hwnd&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>hwndString.<span style="color: #006633;">startsWith</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;native@0x&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        	<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">new</span> HWND<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> Pointer<span style="color: #009900;">&#40;</span><span style="color: #003399;">Long</span>.<span style="color: #006633;">parseLong</span><span style="color: #009900;">&#40;</span>hwndString.<span style="color: #006633;">substring</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">9</span><span style="color: #009900;">&#41;</span>, <span style="color: #cc66cc;">16</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
        	<span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalStateException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Could not determine HWND of window element: found '&quot;</span> <span style="color: #339933;">+</span> hwndString <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<p>and here&#8217;s a unit test:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-windowtreedomtest-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>WindowTreeDomTest.java</div><div class="toggler-target toggle-block toggler-class-windowtreedomtest-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common.jna</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.IOException</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.parsers.ParserConfigurationException</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">javax.xml.transform.TransformerException</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">junit.framework.TestCase</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.apache.log4j.Logger</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.w3c.dom.Document</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.randomnoun.common.XmlUtil</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">com.randomnoun.common.log4j.Log4jCliConfiguration</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** Unit test for WindowTreeDom 
 *
 * @blog http://www.randomnoun.com/wp/2012/12/26/automating-windows-from-java-and-windowtreedom/
 **/</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> WindowTreeDomTest <span style="color: #000000; font-weight: bold;">extends</span> TestCase <span style="color: #009900;">&#123;</span>
&nbsp;
	Logger logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span>WindowTreeDomTest.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testWindowTreeDom<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> ParserConfigurationException, TransformerException, <span style="color: #003399;">IOException</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">System</span>.<span style="color: #006633;">getProperty</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;os.name&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">startsWith</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Windows&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			WindowTreeDom wtd <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> WindowTreeDom<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #003399;">Document</span> d <span style="color: #339933;">=</span> wtd.<span style="color: #006633;">getDom</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span>XmlUtil.<span style="color: #006633;">getXmlString</span><span style="color: #009900;">&#40;</span>d, <span style="color: #000066; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
			logger.<span style="color: #006633;">info</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Not running tests on operating sytem '&quot;</span> <span style="color: #339933;">+</span> <span style="color: #003399;">System</span>.<span style="color: #006633;">getProperty</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;os.name&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;'&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> main<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> args<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> ParserConfigurationException, <span style="color: #003399;">IOException</span>, TransformerException <span style="color: #009900;">&#123;</span>
		Log4jCliConfiguration lcc <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Log4jCliConfiguration<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		lcc.<span style="color: #006633;">init</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&quot;</span>, <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		WindowTreeDomTest wtdt <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> WindowTreeDomTest<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		wtdt.<span style="color: #006633;">testWindowTreeDom</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<p>You&#8217;ll need to add <a href="https://github.com/twall/jna#readme">JNA</a> and whatever XML toolkit you&#8217;re using to your project&#8217;s dependencies, which in my pom.xml looks like the following pom.xml fragment:</p>
<p><br/></p>
<pre class="rn_pre">
&lt;dependency>
   &lt;groupId>net.java.dev.jna&lt;/groupId>
   &lt;artifactId>jna&lt;/artifactId>
   &lt;version>3.2.4&lt;/version>
   &lt;type>jar&lt;/type>
   &lt;scope>compile&lt;/scope>
&lt;/dependency>
</pre>
<p><br/><br />
Hooray. Next week I&#8217;ll use this thing to extract some values from a list box.</p>
<div class="stripey-sidebox">
<p>This class is now part of the <tt><b>com.randomnoun.common:common-public</b></tt> artifact, which can be directly referenced in your <code>pom.xml</code> from the maven central repository. </p>
<p>
<div class="maven-button"><a href="http://code.randomnoun.com/common-public"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/09/maven-ball-42.png" width="42" height="42" style="margin: 5px; float:left;"/></a><a href="http://code.randomnoun.com/common-public">
<div class="big">common-public</div>
<div class="small">com.randomnoun.common:common-public</div>
<p></a></div>
</div>
<p><b>Update 25/9/2013: </b> It&#8217;s in central now</p>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2012/12/26/automating-windows-from-java-and-windowtreedom/#comments" title="Comment on Automating Windows&trade; from Java&reg; and WindowTreeDom☂">4 comments</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/common/" rel="tag">common</a> <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a> <a href="http://www.randomnoun.com/wp/tag/jna/" rel="tag">jna</a></p>      </div>
		</div>

				<div class="post-41 post type-post status-publish format-standard hentry category-uncategorized tag-common tag-java">
			<h2 id="post-41"><a href="http://www.randomnoun.com/wp/2012/12/17/marginally-better-stack-traces/" rel="bookmark" title="Permanent Link to Marginally better stack traces">Marginally better stack traces</a></h2>
			<small class="meta">December 17th, 2012 </small>

			<div class="entry">
				<style>
.stacktrace, .stacktrace2, .stackelement { 
  font-family: Courier New;
  font-size: 8pt;
  line-height: 8pt;
  padding: 5px;
}
.stacktrace, .stacktrace2 {
  width: 580px;
  border: dotted #888888 1px;
  overflow-x: scroll;
  margin-bottom: 10px;
}
.stacktrace2 { color: #555555; }
.stacktrace2 B { color: black; }
.wrapped {
white-space: pre-wrap;       /* css-3 */
 white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
 white-space: -pre-wrap;      /* Opera 4-6 */
 white-space: -o-pre-wrap;    /* Opera 7 */
 word-wrap: break-word;       /* Internet Explorer 5.5+ */
}
pre {
    -moz-tab-size: 4;
    -o-tab-size: 4;
}
.wp_syntax {
}
.rn_pre {
  width:576px; 
  overflow: scroll; 
  color:#3E5667; 
  background-color: #F9F9F9; 
  border: 1px solid silver; 
  font-size: 12px; 
  font-family: monospace;
}
.codeToggle {
   width: 80px; height: 30px;
    line-height: 28px;
    padding: 0 12px 2px;
  background-color: #21759B;
    background-image: linear-gradient(to bottom, #2A95C5, #21759B);
    border-color: #21759B #21759B #1E6A8D;
    box-shadow: 0 1px 0 rgba(120, 200, 230, 0.5) inset;
    color: #FFFFFF;
    text-decoration: none;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
  -moz-box-sizing: border-box;
    border-radius: 3px 3px 3px 3px;
    border-style: solid;
    border-width: 1px;
    cursor: pointer;
    display: inline-block;
    font-size: 12px;
  white-space: nowrap;
  text-align: center;
margin-right: 10px;
    margin-top: 5px;
}
.codeToggle {
  float: left;
  border-radius: 3px;
}</p>
</style>
<p>So as a developer you get to spend a few hours a day trawling through log files and deciphering stack traces to find out why Bob in accounting saw two paypal payments instead of one or something. Your task, if you choose to accept it, is to try to stop your eyes glazing over whilst poring over megabytes of irrelevant crap.</p>
<p>My typical stack trace looks a bit like this:</p>
<h2>A Contrived Example</h2>
<pre class="stacktrace">
<span class="wrapped">org.springframework.jdbc.BadSqlGrammarException: StatementCallback; bad SQL grammar [SELECT flarge FROM tableOfFlonges]; nested exception is com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Unknown column 'flarge' in 'field list'</span>
  at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:220)
  at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:72)
  at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:407)
  at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:458)
  at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:466)
  at org.springframework.jdbc.core.JdbcTemplate.queryForList(JdbcTemplate.java:497)
  at com.contrived.web.action.MainAction.execute(MainAction.java:33)
  at org.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:425)
  at com.randomnoun.common.webapp.struts.CustomRequestProcessor.processActionPerform(CustomRequestProcessor.java:606)
  at org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:228)
  at com.randomnoun.common.webapp.struts.CustomRequestProcessor.process(CustomRequestProcessor.java:723)
  at org.apache.struts.action.ActionServlet.process(ActionServlet.java:1913)
  at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:449)
  at com.randomnoun.common.webapp.struts.CustomActionServlet.doGet(CustomActionServlet.java:55)
  at javax.servlet.http.HttpServlet.service(HttpServlet.java:621)
  at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)
  at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)
  at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
  at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:224)
  at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)
  at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472)
  at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)
  at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)
  at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:927)
  at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)
  at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)
  at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:987)
  at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:579)
  at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:309)
  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
  at java.lang.Thread.run(Thread.java:722)
<span class="wrapped">Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Unknown column 'flarge' in 'field list'</span>
  at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
  at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
  at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
  at java.lang.reflect.Constructor.newInstance(Constructor.java:525)
  at com.mysql.jdbc.Util.handleNewInstance(Util.java:406)
  at com.mysql.jdbc.Util.getInstance(Util.java:381)
  at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1051)
  at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3563)
  at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3495)
  at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1959)
  at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2113)
  at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2687)
  at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2616)
  at com.mysql.jdbc.StatementImpl.executeQuery(StatementImpl.java:1464)
  at org.springframework.jdbc.core.JdbcTemplate$1QueryStatementCallback.doInStatement(JdbcTemplate.java:443)
  at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:396)
  ... 29 more
</pre>
<p><br/><br />
Which you will immediately notice from the first line is because the SQL statement </p>
<div style="margin: 10px;"><code>SELECT flarge FROM tableOfFlonges</code></div>
<p>is grammatically incorrect. </p>
<p>All you have to do now is find out <b>which bit of code</b> you need to modify in order to fix the bug. </p>
<p>One of the nice, yet underrated things about Java, is that you determine fairly quickly <b>whose</b> code is running, due to the use of packages in the class names. In this example, there&#8217;s code from:</p>
<ul>
<li>the particular client I&#8217;m working for (<code>com.contrived</code>),
<li>my own code and libraries (<code>com.randomnoun</code>),
<li>the <a href="http://tomcat.apache.org/">Apache Tomcat</a> application server (<code>com.apache.tomcat</code>)
<li>the <a href="http://www.mysql.com/">MySQL</a> JDBC library (<code>com.mysql</code>)
<li>a <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/jdbc.html">JDBC abstraction</a> mechanism (<code>com.springframework.jdbc</code>)
<li>the <a href="http://struts.apache.org/">struts</a> MVC framework (<code>com.apache.struts</code>)
<li><i>etc</i>
</ul>
<p>What I would like though is something more like the following, in which I assume for the time being that the fault in the code more often than not lies with something that I&#8217;ve written.</p>
<h2>A Contrived Example with Special Sauce</h2>
<pre class="stacktrace2" style="height: 230px; overflow-y: scroll;">
<span class="wrapped">org.springframework.jdbc.BadSqlGrammarException: StatementCallback; bad SQL grammar [SELECT flarge FROM tableOfFlonges]; nested exception is com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Unknown column 'flarge' in 'field list'</span>
  at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:220)
  at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:72)
  at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:407)
  at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:458)
  at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:466)
  at org.springframework.jdbc.core.JdbcTemplate.queryForList(JdbcTemplate.java:497)
  at <b>com.contrived.web.action.MainAction.execute(MainAction.java:33, ver 1.7)</b>
  at org.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:425)
  at <b>com.randomnoun.common.webapp.struts.CustomRequestProcessor.processActionPerform(CustomRequestProcessor.java:606, ver 1.23)</b>
  at org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:228)
  at <b>com.randomnoun.common.webapp.struts.CustomRequestProcessor.process(CustomRequestProcessor.java:723, ver 1.23)</b>
  at org.apache.struts.action.ActionServlet.process(ActionServlet.java:1913)
  at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:449)
  at <b>com.randomnoun.common.webapp.struts.CustomActionServlet.doGet(CustomActionServlet.java:55, ver 1.3)</b>
  at javax.servlet.http.HttpServlet.service(HttpServlet.java:621)
  at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)
  at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)
  at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
  at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:224)
  at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)
  at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472)
  at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)
  at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)
  at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:927)
  at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)
  at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)
  at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:987)
  at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:579)
  at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:307)
  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
  at java.lang.Thread.run(Thread.java:722)
<span class="wrapped">Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Unknown column 'flarge' in 'field list'</span>
  at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
  at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
  at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
  at java.lang.reflect.Constructor.newInstance(Constructor.java:525)
  at com.mysql.jdbc.Util.handleNewInstance(Util.java:406)
  at com.mysql.jdbc.Util.getInstance(Util.java:381)
  at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1051)
  at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3563)
  at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3495)
  at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1959)
  at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2113)
  at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2687)
  at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2616)
  at com.mysql.jdbc.StatementImpl.executeQuery(StatementImpl.java:1464)
  at org.springframework.jdbc.core.JdbcTemplate$1QueryStatementCallback.doInStatement(JdbcTemplate.java:443)
  at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:396)
	... 29 more
</pre>
<p>So what you&#8217;re getting here is:</p>
<ul>
<li>Something that still <b>looks like a stack trace</b>, unlike some other <a href="http://groovy.codehaus.org/jsr/spec/">spectacularly undocumented</a> time-saving toolkits.
<li>Classes within <b>specified packages</b> (and their sub-packages) are <b>highlighted</b> in the stack trace (in the example above, the packages &#8216;<code>com.contrived</code>&#8216;, &#8216;<code>com.randomnoun</code>&#8216;, and &#8216;<code>jsp</code>&#8216;)
<li>Each class under developer control contains a <b>version identifier</b>:
<div class="stackelement">com.contrived.web.action.MainAction.execute(MainAction.java:33<span style="font-weight: bold; background-color: #EAEAEA">, ver 1.7</span>)</div>
<p> so you can more easily determine exactly what code is running (which is useful for clients which don&#8217;t give you access to production machines, yet expect you to be able to fix problems in production). </p>
<p><br/>In the example stacktrace above, I use <a href="http://www.cs.utah.edu/dept/old/texinfo/cvs/cvs_16.html#SEC52">CVS revision <b>$Id$</b>s</a>, but you could use CI build numbers, maven version numbers, debian package IDs, those meaningless git strings, or whatever you use to track your source code.</p>
<p><br/>My implementation relies on having the following boilerplate code in every class that I have any control over.</p>

<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
</pre></td><td class="code"><pre class="java" style="font-family:monospace;">    <span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id$&quot;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>which gets expanded out to this when checked into source control:</p>

<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
</pre></td><td class="code"><pre class="java" style="font-family:monospace;">    <span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: ExceptionUtils.java,v 1.8 2012-09-10 21:43:01 knoxg Exp $&quot;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p><br/>If you decide to use a different identification scheme, then update the <code>getClassRevision()</code> method as appropriate. (Or refactor the class to use a ClassRevisionAnnotationFactory, if that&#8217;s the sort of thing that keeps you entertained).
</ul>
<p>I bet you&#8217;re just gagging for the code at this stage, so here it is:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-exceptionutils-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>ExceptionUtils.java</div><div class="toggler-target toggle-block toggler-class-exceptionutils-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.*</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.lang.reflect.*</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.ArrayList</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.List</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/**
 * Exception utilities class.
 *
 * &lt;p&gt;This class contains static utility methods for handling and manipulating exceptions;
 * the only one you're likely to call being 
 * {@link #getStackTraceWithRevisions(Throwable, ClassLoader, int, String)},
 * which extracts CVS revision information from classes to produce an annotated (and highlighted)
 * stack trace.
 * 
 * &lt;p&gt;When passing in {@link java.lang.ClassLoader}s to these methods, you may want to try one of 
 * &lt;ul&gt;
 * &lt;li&gt;this.getClass().getClassLoader()
 * &lt;li&gt;Thread.currentThread().getContextClassLoader()
 * &lt;/ul&gt;
 * 
 * @blog http://www.randomnoun.com/wp/2012/12/17/marginally-better-stack-traces/
 * @version $Id: ExceptionUtils.java,v 1.2 2013-09-24 02:37:09 knoxg Exp $
 * @author knoxg
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> ExceptionUtils <span style="color: #009900;">&#123;</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: ExceptionUtils.java,v 1.2 2013-09-24 02:37:09 knoxg Exp $&quot;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Perform no stack trace element highlighting */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000066; font-weight: bold;">int</span> HIGHLIGHT_NONE <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Allow stack trace elements to be highlighted, as text */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000066; font-weight: bold;">int</span> HIGHLIGHT_TEXT <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Allow stack trace elements to be highlighted, as bold HTML */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #000066; font-weight: bold;">int</span> HIGHLIGHT_HTML <span style="color: #339933;">=</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Private constructor to prevent instantiation of this class
     */</span>
    <span style="color: #000000; font-weight: bold;">private</span> ExceptionUtils<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Converts an exception's stack trace to a string. If the exception passed
     * to this function is null, returns the empty string.
     *
     * @param e exception
     * 
     * @return string representation of the exception's stack trace
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getStackTrace<span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>e <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #003399;">StringWriter</span> writer <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">StringWriter</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintWriter</span><span style="color: #009900;">&#40;</span>writer<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">return</span> writer.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Converts an exception's stack trace to a string. Each stack trace element
     * is annotated to include the CVS revision Id, if it contains a public static
     * String element containing this information. 
     * 
     * &lt;p&gt;Stack trace elements whose classes begin with the specified highlightPrefix
     * are also marked, to allow easier debugging. Highlights used can be text
     * (which will insert the string &quot;=&gt;&quot; before relevent stack trace elements), or 
     * HTML (which will render the stack trace element between &amp;lt;b&amp;gt; and &amp;lt;/b&amp;gt; tags.
     * 
     * &lt;p&gt;If HTML highlighting is enabled, then the exception message is also HTML-escaped.
     *
     * @param e exception
     * @param loader ClassLoader used to read stack trace element revision information
     * @param highlight One of the HIGHLIGHT_* constants in this class
     * @param highlightPrefix A prefix used to determine which stack trace elements are
     *   rendered as being 'important'. (e.g. &quot;&lt;tt&gt;com.randomnoun.common.&lt;/tt&gt;&quot;). Multiple
     *   prefixes can be specified, if separated by commas.   
     * 
     * @return string representation of the exception's stack trace
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getStackTraceWithRevisions<span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span> e, <span style="color: #003399;">ClassLoader</span> loader, <span style="color: #000066; font-weight: bold;">int</span> highlight, <span style="color: #003399;">String</span> highlightPrefix<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>e <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #0000ff;">&quot;(null)&quot;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #003399;">StringBuffer</span> sb <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">StringBuffer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #666666; font-style: italic;">// using reflection to remove runtime dependency on beanshell package</span>
<span style="color: #006699;">        try</span> <span style="color: #009900;">&#123;</span>
	        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>e.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;bsh.TargetError&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	        	<span style="color: #003399;">Method</span> m<span style="color: #339933;">;</span>
				m <span style="color: #339933;">=</span> e.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getMethod</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;getTarget&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				e <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span><span style="color: #009900;">&#41;</span> m.<span style="color: #006633;">invoke</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	        <span style="color: #009900;">&#125;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">SecurityException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">NoSuchMethodException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalArgumentException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalAccessException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">InvocationTargetException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
		<span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #666666; font-style: italic;">/*
        if (e instanceof bsh.TargetError) {
        	e = ((bsh.TargetError)e).getTarget();
        }
        */</span>
&nbsp;
        <span style="color: #003399;">String</span> s <span style="color: #339933;">=</span> e.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #003399;">String</span> message <span style="color: #339933;">=</span> e.<span style="color: #006633;">getLocalizedMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>highlight<span style="color: #339933;">==</span>HIGHLIGHT_HTML<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        	sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>escapeHtml<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>message <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> <span style="color: #009900;">&#40;</span>s <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;: &quot;</span> <span style="color: #339933;">+</span> message<span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> s <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
        	sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>message <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> <span style="color: #009900;">&#40;</span>s <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;: &quot;</span> <span style="color: #339933;">+</span> message<span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> s <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #666666; font-style: italic;">// dump the stack trace for the top-level exception</span>
        StackTraceElement<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> trace <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
        trace <span style="color: #339933;">=</span> e.<span style="color: #006633;">getStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> trace.<span style="color: #006633;">length</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>getStackTraceElementWithRevision<span style="color: #009900;">&#40;</span>trace<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>, loader, highlight, highlightPrefix<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #003399;">Throwable</span> cause <span style="color: #339933;">=</span> getCause<span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>cause <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>getStackTraceWithRevisionsAsCause<span style="color: #009900;">&#40;</span>cause, trace, loader, highlight, highlightPrefix<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">return</span> sb.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Returns the 'Caused by...' exception text for a chained exception, performing the
     * same stack trace element reduction as performed by the built-in {@link java.lang.Throwable#printStackTrace()}
     * class.
     * 
     * &lt;p&gt;Note that the notion of 'Suppressed' exceptions introduced in Java 7 is not 
     * supported by this implementation.
     *  
     * @param e the cause of the original exception
     * @param causedTrace the original exception trace
     * @param loader ClassLoader used to read stack trace element revision information
     * @param highlight One of the HIGHLIGHT_* constants in this class
     * @param highlightPrefix A prefix used to determine which stack trace elements are
     *   rendered as being 'important'. (e.g. &quot;&lt;tt&gt;com.randomnoun.common.&lt;/tt&gt;&quot;). Multiple
     *   prefixes can be specified, if separated by commas.
     *   
     * @return the 'caused by' component of a stack trace
     */</span>
    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getStackTraceWithRevisionsAsCause<span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span> e, StackTraceElement<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> causedTrace, <span style="color: #003399;">ClassLoader</span> loader, <span style="color: #000066; font-weight: bold;">int</span> highlight, <span style="color: #003399;">String</span> highlightPrefix<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
        <span style="color: #003399;">StringBuffer</span> sb <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">StringBuffer</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #666666; font-style: italic;">// Compute number of frames in common between this and caused</span>
        StackTraceElement<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> trace <span style="color: #339933;">=</span> e.<span style="color: #006633;">getStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000066; font-weight: bold;">int</span> m <span style="color: #339933;">=</span> trace.<span style="color: #006633;">length</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
        <span style="color: #000066; font-weight: bold;">int</span> n <span style="color: #339933;">=</span> causedTrace.<span style="color: #006633;">length</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #009900;">&#40;</span>m <span style="color: #339933;">&gt;=</span> <span style="color: #cc66cc;">0</span> <span style="color: #339933;">&amp;&amp;</span> n <span style="color: #339933;">&gt;=</span><span style="color: #cc66cc;">0</span> <span style="color: #339933;">&amp;&amp;</span> trace<span style="color: #009900;">&#91;</span>m<span style="color: #009900;">&#93;</span>.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span>causedTrace<span style="color: #009900;">&#91;</span>n<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            m<span style="color: #339933;">--;</span> n<span style="color: #339933;">--;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #000066; font-weight: bold;">int</span> framesInCommon <span style="color: #339933;">=</span> trace.<span style="color: #006633;">length</span> <span style="color: #339933;">-</span> <span style="color: #cc66cc;">1</span> <span style="color: #339933;">-</span> m<span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #003399;">String</span> s <span style="color: #339933;">=</span> e.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #003399;">String</span> message <span style="color: #339933;">=</span> e.<span style="color: #006633;">getLocalizedMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Caused by: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>highlight<span style="color: #339933;">==</span>HIGHLIGHT_HTML<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        	sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>escapeHtml<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>message <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> <span style="color: #009900;">&#40;</span>s <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;: &quot;</span> <span style="color: #339933;">+</span> message<span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> s <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
        	sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>message <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> <span style="color: #009900;">&#40;</span>s <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;: &quot;</span> <span style="color: #339933;">+</span> message<span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> s <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;=</span> m<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>getStackTraceElementWithRevision<span style="color: #009900;">&#40;</span>trace<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>, loader, highlight, highlightPrefix<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>framesInCommon <span style="color: #339933;">!=</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span>
            sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... &quot;</span> <span style="color: #339933;">+</span> framesInCommon <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #666666; font-style: italic;">// Recurse if we have a cause</span>
        <span style="color: #003399;">Throwable</span> ourCause <span style="color: #339933;">=</span> getCause<span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>ourCause <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>getStackTraceWithRevisionsAsCause<span style="color: #009900;">&#40;</span>ourCause, trace, loader, highlight, highlightPrefix<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">return</span> sb.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Returns a single stack trace element as a String, with highlighting
     * 
     * @param ste the StackTraceElement
     * @param loader ClassLoader used to read stack trace element revision information
     * @param highlight One of the HIGHLIGHT_* constants in this class
     * @param highlightPrefix A prefix used to determine which stack trace elements are
     *   rendered as being 'important'. (e.g. &quot;&lt;tt&gt;com.randomnoun.common.&lt;/tt&gt;&quot;). Multiple
     *   prefixes can be specified, if separated by commas.
     *   
     * @return the stack trace element as a String, with highlighting
     */</span>
    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getStackTraceElementWithRevision<span style="color: #009900;">&#40;</span>StackTraceElement ste, <span style="color: #003399;">ClassLoader</span> loader,
        <span style="color: #000066; font-weight: bold;">int</span> highlight, <span style="color: #003399;">String</span> highlightPrefix<span style="color: #009900;">&#41;</span> 
    <span style="color: #009900;">&#123;</span>
        <span style="color: #666666; font-style: italic;">// s should be something like:</span>
        <span style="color: #666666; font-style: italic;">// javax.servlet.http.HttpServlet.service(HttpServlet.java:740)</span>
        <span style="color: #003399;">String</span> s<span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>highlightPrefix<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">||</span> highlight<span style="color: #339933;">==</span>HIGHLIGHT_NONE<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        	s <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;    at &quot;</span> <span style="color: #339933;">+</span> ste.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
	        <span style="color: #000066; font-weight: bold;">boolean</span> isHighlighted <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>highlight<span style="color: #339933;">!=</span>HIGHLIGHT_NONE <span style="color: #339933;">&amp;&amp;</span> isHighlighted<span style="color: #009900;">&#40;</span>ste.<span style="color: #006633;">getClassName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, highlightPrefix<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>isHighlighted <span style="color: #339933;">&amp;&amp;</span> highlight<span style="color: #339933;">==</span>HIGHLIGHT_HTML<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	            s <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;    at &lt;b&gt;&quot;</span> <span style="color: #339933;">+</span> ste.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;&lt;/b&gt;&quot;</span><span style="color: #339933;">;</span>
	        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>isHighlighted <span style="color: #339933;">&amp;&amp;</span> highlight<span style="color: #339933;">==</span>HIGHLIGHT_TEXT<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	            s <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot; =&gt; at &quot;</span> <span style="color: #339933;">+</span> ste.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>isHighlighted<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	        	s <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;    at &quot;</span> <span style="color: #339933;">+</span> ste.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span> 
	            <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">IllegalArgumentException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Unknown highlight &quot;</span> <span style="color: #339933;">+</span> highlight<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	        <span style="color: #009900;">&#125;</span>
        <span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #000066; font-weight: bold;">int</span> endLocation <span style="color: #339933;">=</span> s.<span style="color: #006633;">lastIndexOf</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>endLocation<span style="color: #339933;">!=-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
                <span style="color: #666666; font-style: italic;">// remove inner class info</span>
                <span style="color: #003399;">String</span> className <span style="color: #339933;">=</span> ste.<span style="color: #006633;">getClassName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                <span style="color: #003399;">String</span> revision <span style="color: #339933;">=</span> getClassRevision<span style="color: #009900;">&#40;</span>loader, className<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
                <span style="color: #666666; font-style: italic;">//System.out.println(&quot;Class=&quot; + className + &quot;, revision='&quot; + revision + &quot;'&quot;);</span>
                s <span style="color: #339933;">=</span> s.<span style="color: #006633;">substring</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span>, endLocation<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;, &quot;</span> <span style="color: #339933;">+</span> revision <span style="color: #339933;">+</span> s.<span style="color: #006633;">substring</span><span style="color: #009900;">&#40;</span>endLocation<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
            <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Exception</span> e2<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">NoClassDefFoundError</span> ncdfe<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #009900;">&#125;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">return</span> s<span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Returns true if the provided className matches the highlightPrefix pattern supplied, 
     * false otherwise
     *  
     * @param className The name of a class (i.e. the class contained in a stack trace element)
     * @param highlightPrefix A prefix used to determine which stack trace elements are
     *   rendered as being 'important'. (e.g. &quot;&lt;tt&gt;com.randomnoun.common.&lt;/tt&gt;&quot;). Multiple
     *   prefixes can be specified, if separated by commas.
     *   
     * @return true if the provided className matches the highlightPrefix pattern supplied, 
     *   false otherwise
     */</span>
    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">boolean</span> isHighlighted<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> className, <span style="color: #003399;">String</span> highlightPrefix<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>highlightPrefix.<span style="color: #006633;">contains</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #003399;">String</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> prefixes <span style="color: #339933;">=</span> highlightPrefix.<span style="color: #006633;">split</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #000066; font-weight: bold;">boolean</span> highlighted <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">false</span><span style="color: #339933;">;</span> 
    		<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i<span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>prefixes.<span style="color: #006633;">length</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">!</span>highlighted<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			highlighted <span style="color: #339933;">=</span> className.<span style="color: #006633;">startsWith</span><span style="color: #009900;">&#40;</span>prefixes<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #009900;">&#125;</span>
    		<span style="color: #000000; font-weight: bold;">return</span> highlighted<span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
    		<span style="color: #000000; font-weight: bold;">return</span> className.<span style="color: #006633;">startsWith</span><span style="color: #009900;">&#40;</span>highlightPrefix<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Return the number of elements in the current thread's stack trace (i.e. the height
     * of the call stack). 
     * 
     * @return the height of the call stack 
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">int</span> getStackDepth<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #003399;">Throwable</span> t <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Throwable</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">return</span> t.<span style="color: #006633;">getStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">length</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Returns a string describing the CVS revision number of a class. The class
     * is initialised as part of this process, which may cause a number of 
     * exceptions to be thrown. 
     * 
     * @param loader The classLoader to use
     * @param className The class we wish to retrieve
     * 
     * @return The CVS revision string, in the form &quot;ver 1.234&quot;.
     * 
     * @throws ClassNotFoundException
     * @throws SecurityException
     * @throws NoSuchFieldException
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getClassRevision<span style="color: #009900;">&#40;</span><span style="color: #003399;">ClassLoader</span> loader, <span style="color: #003399;">String</span> className<span style="color: #009900;">&#41;</span> 
    	<span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">ClassNotFoundException</span>, <span style="color: #003399;">SecurityException</span>, <span style="color: #003399;">NoSuchFieldException</span>, 
    	<span style="color: #003399;">IllegalArgumentException</span>, <span style="color: #003399;">IllegalAccessException</span> 
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>className.<span style="color: #006633;">indexOf</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'$'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">!=-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            className <span style="color: #339933;">=</span> className.<span style="color: #006633;">substring</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span>, className.<span style="color: #006633;">indexOf</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'$'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">Class</span> clazz <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">Class</span>.<span style="color: #006633;">forName</span><span style="color: #009900;">&#40;</span>className, <span style="color: #000066; font-weight: bold;">true</span>, loader<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #003399;">Field</span> field <span style="color: #339933;">=</span> clazz.<span style="color: #006633;">getField</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;_revision&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #003399;">String</span> revision <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span><span style="color: #009900;">&#41;</span> field.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #666666; font-style: italic;">// remove rest of $Id: ExceptionUtils.java,v 1.2 2013-09-24 02:37:09 knoxg Exp $ text </span>
        <span style="color: #000066; font-weight: bold;">int</span> pos <span style="color: #339933;">=</span> revision.<span style="color: #006633;">indexOf</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;,v &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>pos <span style="color: #339933;">!=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            revision <span style="color: #339933;">=</span> revision.<span style="color: #006633;">substring</span><span style="color: #009900;">&#40;</span>pos <span style="color: #339933;">+</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            pos <span style="color: #339933;">=</span> revision.<span style="color: #006633;">indexOf</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">' '</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;ver &quot;</span> <span style="color: #339933;">+</span> revision.<span style="color: #006633;">substring</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span>, pos<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #000000; font-weight: bold;">return</span> revision<span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** An alternate implementation of {@link #getClassRevision(ClassLoader, String)},
     * which searches the raw bytecode of the class, rather than using Java reflection.
     * May be a bit more robust.
     * 
     * @TODO implement this
     * 
     * @param loader Classloader to use
     * @param className Class to load
     * 
     * @return The CVS revision string, in the form &quot;ver 1.234&quot;.
     * 
     * @throws ClassNotFoundException
     * @throws SecurityException
     * @throws NoSuchFieldException
     * @throws IllegalArgumentException
     * @throws IllegalAccessException
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">String</span> getClassRevision2<span style="color: #009900;">&#40;</span><span style="color: #003399;">ClassLoader</span> loader, <span style="color: #003399;">String</span> className<span style="color: #009900;">&#41;</span> 
    	<span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">ClassNotFoundException</span>, <span style="color: #003399;">SecurityException</span>, <span style="color: #003399;">NoSuchFieldException</span>, 
    	<span style="color: #003399;">IllegalArgumentException</span>, <span style="color: #003399;">IllegalAccessException</span> 
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>className.<span style="color: #006633;">indexOf</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'$'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">!=-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            className <span style="color: #339933;">=</span> className.<span style="color: #006633;">substring</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span>, className.<span style="color: #006633;">indexOf</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'$'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
        <span style="color: #003399;">String</span> file <span style="color: #339933;">=</span> className.<span style="color: #006633;">replace</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'.'</span>,  <span style="color: #0000ff;">'/'</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;.class&quot;</span><span style="color: #339933;">;</span>
        <span style="color: #003399;">InputStream</span> is <span style="color: #339933;">=</span> loader.<span style="color: #006633;">getResourceAsStream</span><span style="color: #009900;">&#40;</span>file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #666666; font-style: italic;">// read up to '$Id:' text</span>
&nbsp;
        <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">UnsupportedOperationException</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Not implemented&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Returns a list of all the messages contained within a exception (following the causal
     * chain of the supplied exception). This may be more useful to and end-user, since it
     * should not contain any references to Java class names.
     * 
     * @param throwable an exception
     * 
     * @return a List of Strings
     */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> getStackTraceSummary<span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span> throwable<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> result <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">while</span> <span style="color: #009900;">&#40;</span>throwable<span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    		result.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span>throwable.<span style="color: #006633;">getMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		throwable <span style="color: #339933;">=</span> getCause<span style="color: #009900;">&#40;</span>throwable<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    		<span style="color: #666666; font-style: italic;">// I think some RemoteExceptions have non-standard caused-by chains as well...</span>
    		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>throwable<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>throwable <span style="color: #000000; font-weight: bold;">instanceof</span> java.<span style="color: #006633;">sql</span>.<span style="color: #003399;">SQLException</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    				throwable <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>java.<span style="color: #006633;">sql</span>.<span style="color: #003399;">SQLException</span><span style="color: #009900;">&#41;</span> throwable<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getNextException</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    			<span style="color: #009900;">&#125;</span> 
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">return</span> result<span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** Returns the cause of an exception, or null if not known.
     * If the exception is a a &lt;code&gt;bsh.TargetError&lt;/code&gt;, then the cause is determined
     * by calling the &lt;code&gt;getTarget()&lt;/code&gt; method, otherwise this method will
     * return the same value returned by the standard Exception 
     * &lt;code&gt;getCause()&lt;/code&gt; method.
     * 
     * @param e the cause of an exception, or null if not known.
     * 
     * @return the cause of an exception, or null if not known.
     */</span>
    <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #003399;">Throwable</span> getCause<span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	<span style="color: #003399;">Throwable</span> cause <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
    	<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>e.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;bsh.TargetError&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
    	        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>e.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;bsh.TargetError&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    	        	<span style="color: #003399;">Method</span> m<span style="color: #339933;">;</span>
    				m <span style="color: #339933;">=</span> e.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getMethod</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;getTarget&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    				cause <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span><span style="color: #009900;">&#41;</span> m.<span style="color: #006633;">invoke</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	        <span style="color: #009900;">&#125;</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">SecurityException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">NoSuchMethodException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalArgumentException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">IllegalAccessException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
    		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">InvocationTargetException</span> e1<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    			<span style="color: #666666; font-style: italic;">// ignore - just use original exception</span>
    		<span style="color: #009900;">&#125;</span>
    	<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
    		cause <span style="color: #339933;">=</span> e.<span style="color: #006633;">getCause</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    	<span style="color: #009900;">&#125;</span>
    	<span style="color: #000000; font-weight: bold;">return</span> cause<span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #008000; font-style: italic; font-weight: bold;">/**
     * Returns the HTML-escaped form of a string. Any &lt;tt&gt;&amp;amp;&lt;/tt&gt;,
     * &lt;tt&gt;&amp;lt;&lt;/tt&gt;, &lt;tt&gt;&amp;gt;&lt;/tt&gt;, and &lt;tt&gt;&quot;&lt;/tt&gt; characters are converted to
     * &lt;tt&gt;&amp;amp;amp;&lt;/tt&gt;, &lt;tt&gt;&amp;amp;lt;&lt;tt&gt;, &lt;tt&gt;&amp;amp;gt;&lt;tt&gt;, and
     * &lt;tt&gt;&amp;amp;quot;&lt;/tt&gt; respectively.
     *
     * @param string the string to convert
     *
     * @return the HTML-escaped form of the string
     */</span>
    <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> escapeHtml<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> string<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>string <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #0000ff;">&quot;&quot;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #000066; font-weight: bold;">char</span> c<span style="color: #339933;">;</span>
        <span style="color: #003399;">StringBuffer</span> sb <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">StringBuffer</span><span style="color: #009900;">&#40;</span>string.<span style="color: #006633;">length</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">int</span> i <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> string.<span style="color: #006633;">length</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            c <span style="color: #339933;">=</span> string.<span style="color: #006633;">charAt</span><span style="color: #009900;">&#40;</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
            <span style="color: #000000; font-weight: bold;">switch</span> <span style="color: #009900;">&#40;</span>c<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
                <span style="color: #000000; font-weight: bold;">case</span> <span style="color: #0000ff;">'&amp;'</span><span style="color: #339933;">:</span>
                    sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&amp;amp;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
                <span style="color: #000000; font-weight: bold;">case</span> <span style="color: #0000ff;">'&lt;'</span><span style="color: #339933;">:</span>
                    sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&amp;lt;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
                <span style="color: #000000; font-weight: bold;">case</span> <span style="color: #0000ff;">'&gt;'</span><span style="color: #339933;">:</span>
                    sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&amp;gt;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
                <span style="color: #000000; font-weight: bold;">case</span> <span style="color: #0000ff;">'<span style="color: #000099; font-weight: bold;">\&quot;</span>'</span><span style="color: #339933;">:</span>
                    sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&amp;quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
                <span style="color: #000000; font-weight: bold;">default</span><span style="color: #339933;">:</span>
                    sb.<span style="color: #006633;">append</span><span style="color: #009900;">&#40;</span>c<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
        <span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #000000; font-weight: bold;">return</span> sb.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<p>and some unit test classes that you&#8217;ll never look at:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-junk-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>Junk.java</div><div class="toggler-target toggle-block toggler-class-junk-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** Throwaway class used in ExceptionUtilsTest.
 *
 * @see java.lang.Throwable#getStackTrace()
 * 
 * @author knoxg
 * @blog http://www.randomnoun.com/wp/2012/12/17/marginally-better-stack-traces/
 * @version $Id: Junk.java,v 1.2 2013-09-24 02:37:09 knoxg Exp $
 * 
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> Junk <span style="color: #009900;">&#123;</span>
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: Junk.java,v 1.2 2013-09-24 02:37:09 knoxg Exp $&quot;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> a<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> HighLevelException <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            b<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>MidLevelException e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> HighLevelException<span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> b<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> MidLevelException <span style="color: #009900;">&#123;</span>
        c<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> c<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> MidLevelException <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            d<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> MidLevelException<span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> d<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> LowLevelException <span style="color: #009900;">&#123;</span>
       e<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> e<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> LowLevelException <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> LowLevelException<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> InnerClassB1 <span style="color: #009900;">&#123;</span>
    	<span style="color: #666666; font-style: italic;">// we normally wouldn't revision inner classes</span>
        <span style="color: #666666; font-style: italic;">// public static String _revision = &quot;Test revision B1&quot;;</span>
&nbsp;
        <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> f<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> LowLevelException <span style="color: #009900;">&#123;</span>
            InnerClassB2.<span style="color: #006633;">g</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">class</span> InnerClassB2 <span style="color: #009900;">&#123;</span>
        	<span style="color: #666666; font-style: italic;">// we normally wouldn't revision inner classes</span>
            <span style="color: #666666; font-style: italic;">// public static String _revision = &quot;Test revision B2&quot;;</span>
&nbsp;
            <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000066; font-weight: bold;">void</span> g<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> LowLevelException <span style="color: #009900;">&#123;</span>
                <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> LowLevelException<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
            <span style="color: #009900;">&#125;</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** Utility exception class */</span>
<span style="color: #000000; font-weight: bold;">class</span> HighLevelException <span style="color: #000000; font-weight: bold;">extends</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span>
    HighLevelException<span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span> cause<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #000000; font-weight: bold;">super</span><span style="color: #009900;">&#40;</span>cause<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** Utility exception class */</span>
<span style="color: #000000; font-weight: bold;">class</span> MidLevelException <span style="color: #000000; font-weight: bold;">extends</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span>
    MidLevelException<span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span> cause<span style="color: #009900;">&#41;</span>  <span style="color: #009900;">&#123;</span> <span style="color: #000000; font-weight: bold;">super</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;middle&gt;&quot;</span>, cause<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** Utility exception class */</span>
<span style="color: #000000; font-weight: bold;">class</span> LowLevelException <span style="color: #000000; font-weight: bold;">extends</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-exceptionutilstest-java"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>ExceptionUtilsTest.java</div><div class="toggler-target toggle-block toggler-class-exceptionutilstest-java"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">com.randomnoun.common</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a
 * BSD Simplified License. (http://www.randomnoun.com/bsd-simplified.html)
 */</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.ByteArrayOutputStream</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.io.PrintStream</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.ArrayList</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.List</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.regex.Pattern</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">junit.framework.TestCase</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #008000; font-style: italic; font-weight: bold;">/** Test class for Exception Utils
 * 
 * @author knoxg
 * @blog http://www.randomnoun.com/wp/2012/12/17/marginally-better-stack-traces/
 * @version $Id: ExceptionUtilsTest.java,v 1.2 2013-09-24 02:37:09 knoxg Exp $
 */</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> ExceptionUtilsTest <span style="color: #000000; font-weight: bold;">extends</span> TestCase <span style="color: #009900;">&#123;</span>
    <span style="color: #008000; font-style: italic; font-weight: bold;">/** A revision marker to be used in exception stack traces. */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> _revision <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;$Id: ExceptionUtilsTest.java,v 1.2 2013-09-24 02:37:09 knoxg Exp $&quot;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetStackTrace<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">ByteArrayOutputStream</span> baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Exception</span> e <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">a</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>HighLevelException hle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> hle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// check that our getStackTrace() method matches java's printStackTrace() method</span>
		assertEquals<span style="color: #009900;">&#40;</span>baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">getStackTrace</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">b</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>MidLevelException mle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> mle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">getStackTrace</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">d</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">getStackTrace</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">e</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">getStackTrace</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetStackTraceWithRevisionsNoHighlight<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">ByteArrayOutputStream</span> baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Exception</span> e <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> highlightedStackTrace <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> expectedRegex <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		Pattern expectedPattern <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">a</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>HighLevelException hle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> hle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
			<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_NONE</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// check that our getStackTrace() method matches java's printStackTrace() method</span>
&nbsp;
		<span style="color: #666666; font-style: italic;">/* 
&nbsp;
		This is what we expect when run in the Eclipse UI
&nbsp;
		We need to generalise this a bit to take into consideration different test runners,
		changes in line numbers and changes in version numbers. 
&nbsp;
		String expected = 
			&quot;com.randomnoun.common.HighLevelException: com.randomnoun.common.MidLevelException: &lt;middle&gt;\n&quot; + 
			&quot;    at com.randomnoun.common.Junk.a(Junk.java:24, ver 1.12)\n&quot; + 
			&quot;    at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsNoHighlight(ExceptionUtilsTest.java:55, ver 1.12)\n&quot; + 
			&quot;    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n&quot; + 
			&quot;    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n&quot; + 
			&quot;    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n&quot; + 
			&quot;    at java.lang.reflect.Method.invoke(Method.java:601)\n&quot; + 
			&quot;    at junit.framework.TestCase.runTest(TestCase.java:154)\n&quot; + 
			&quot;    at junit.framework.TestCase.runBare(TestCase.java:127)\n&quot; + 
			&quot;    at junit.framework.TestResult$1.protect(TestResult.java:106)\n&quot; + 
			&quot;    at junit.framework.TestResult.runProtected(TestResult.java:124)\n&quot; + 
			&quot;    at junit.framework.TestResult.run(TestResult.java:109)\n&quot; + 
			&quot;    at junit.framework.TestCase.run(TestCase.java:118)\n&quot; + 
			&quot;    at junit.framework.TestSuite.runTest(TestSuite.java:208)\n&quot; + 
			&quot;    at junit.framework.TestSuite.run(TestSuite.java:203)\n&quot; + 
			&quot;    at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)\n&quot; + 
			&quot;    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\n&quot; + 
			&quot;    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)\n&quot; + 
			&quot;    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)\n&quot; + 
			&quot;    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)\n&quot; + 
			&quot;    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)\n&quot; + 
			&quot;Caused by: com.randomnoun.common.MidLevelException: &lt;middle&gt;\n&quot; + 
			&quot;    at com.randomnoun.common.Junk.c(Junk.java:36, ver 1.12)\n&quot; + 
			&quot;    at com.randomnoun.common.Junk.b(Junk.java:29, ver 1.12)\n&quot; + 
			&quot;    at com.randomnoun.common.Junk.a(Junk.java:22, ver 1.12)\n&quot; + 
			&quot;    ... 19 more\n&quot; + 
			&quot;Caused by: com.randomnoun.common.LowLevelException\n&quot; + 
			&quot;    at com.randomnoun.common.Junk.e(Junk.java:45, ver 1.12)\n&quot; + 
			&quot;    at com.randomnoun.common.Junk.d(Junk.java:41, ver 1.12)\n&quot; + 
			&quot;    at com.randomnoun.common.Junk.c(Junk.java:34, ver 1.12)\n&quot; + 
			&quot;    ... 21 more&quot;;				
		*/</span>
&nbsp;
		expectedRegex <span style="color: #339933;">=</span>  
			<span style="color: #0000ff;">&quot;com.randomnoun.common.HighLevelException: com.randomnoun.common.MidLevelException: &lt;middle&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.a(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsNoHighlight(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    at junit.framework.TestCase.run(TestCase.java:[0-9]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;Caused by: com.randomnoun.common.MidLevelException: &lt;middle&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>  
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.b(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.a(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... [0-9]+ more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;Caused by: com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.d(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... [0-9]+ more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">b</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>MidLevelException mle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> mle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
				<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_NONE</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.MidLevelException: &lt;middle&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.b(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsNoHighlight(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    at junit.framework.TestCase.run(TestCase.java:118)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;Caused by: com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.d(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... [0-9]+ more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">d</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
				<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_NONE</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.d(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsNoHighlight(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">e</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
				<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_NONE</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsNoHighlight(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetStackTraceWithRevisionsText<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">ByteArrayOutputStream</span> baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Exception</span> e <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> highlightedStackTrace <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> expectedRegex <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		Pattern expectedPattern <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">a</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>HighLevelException hle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> hle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
			<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_TEXT</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		expectedRegex <span style="color: #339933;">=</span>  
			<span style="color: #0000ff;">&quot;com.randomnoun.common.HighLevelException: com.randomnoun.common.MidLevelException: &lt;middle&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.a(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsText(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    at junit.framework.TestCase.run(TestCase.java:[0-9]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;Caused by: com.randomnoun.common.MidLevelException: &lt;middle&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>  
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.b(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.a(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... [0-9]+ more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;Caused by: com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.d(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... [0-9]+ more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">b</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>MidLevelException mle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> mle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
				<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_TEXT</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.MidLevelException: &lt;middle&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.b(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsText(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    at junit.framework.TestCase.run(TestCase.java:118)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;Caused by: com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.d(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... [0-9]+ more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">d</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
				<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_TEXT</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.d(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsText(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">e</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
			<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_TEXT</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsText(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetStackTraceWithRevisionsHtml<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">ByteArrayOutputStream</span> baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Exception</span> e <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> highlightedStackTrace <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> expectedRegex <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		Pattern expectedPattern <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">a</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>HighLevelException hle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> hle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
			<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_HTML</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		expectedRegex <span style="color: #339933;">=</span>  
			<span style="color: #0000ff;">&quot;com.randomnoun.common.HighLevelException: com.randomnoun.common.MidLevelException: &amp;lt;middle&amp;gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.a(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsHtml(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    at junit.framework.TestCase.run(TestCase.java:[0-9]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;Caused by: com.randomnoun.common.MidLevelException: &amp;lt;middle&amp;gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>  
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.b(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.a(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... [0-9]+ more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;Caused by: com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.d(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... [0-9]+ more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">b</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>MidLevelException mle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> mle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
				<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_HTML</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.MidLevelException: &amp;lt;middle&amp;gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.b(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsHtml(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    at junit.framework.TestCase.run(TestCase.java:118)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;Caused by: com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.d(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.c(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>... [0-9]+ more<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">d</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
				<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_HTML</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.d(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsHtml(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">e</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
			<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_HTML</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.Junk.e(Junk.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;    at &lt;b&gt;com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsHtml(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)&lt;/b&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetStackTraceWithRevisionsTextInnerClass<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">ByteArrayOutputStream</span> baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Exception</span> e <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> highlightedStackTrace <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">String</span> expectedRegex <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		Pattern expectedPattern <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">InnerClassB1</span>.<span style="color: #006633;">f</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException mle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> mle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>baos.<span style="color: #006633;">toString</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">getStackTrace</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
				<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_TEXT</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
			<span style="color: #0000ff;">&quot;com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk<span style="color: #000099; font-weight: bold;">\\</span>$InnerClassB1<span style="color: #000099; font-weight: bold;">\\</span>$InnerClassB2.g(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk<span style="color: #000099; font-weight: bold;">\\</span>$InnerClassB1.f(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsTextInnerClass(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
			<span style="color: #0000ff;">&quot;    at junit.framework.TestCase.run(TestCase.java:118)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
			<span style="color: #0000ff;">&quot;.*&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">InnerClassB1</span>.<span style="color: #006633;">InnerClassB2</span>.<span style="color: #006633;">g</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException mle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> mle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		highlightedStackTrace <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>e, 
				<span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_TEXT</span>, <span style="color: #0000ff;">&quot;com.randomnoun.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> 
				<span style="color: #0000ff;">&quot;com.randomnoun.common.LowLevelException<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
				<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.Junk<span style="color: #000099; font-weight: bold;">\\</span>$InnerClassB1<span style="color: #000099; font-weight: bold;">\\</span>$InnerClassB2.g(Junk.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
				<span style="color: #0000ff;">&quot; =&gt; at com.randomnoun.common.ExceptionUtilsTest.testGetStackTraceWithRevisionsTextInnerClass(ExceptionUtilsTest.java:[0-9]+, ver [0-9.]+)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
				<span style="color: #0000ff;">&quot;.*&quot;</span> <span style="color: #339933;">+</span>
				<span style="color: #0000ff;">&quot;    at junit.framework.TestCase.run(TestCase.java:118)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> 
				<span style="color: #0000ff;">&quot;.*&quot;</span><span style="color: #339933;">;</span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>(&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// regex-escape grouping operators </span>
		expectedRegex <span style="color: #339933;">=</span> expectedRegex.<span style="color: #006633;">replaceAll</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span>,  <span style="color: #0000ff;">&quot;<span style="color: #000099; font-weight: bold;">\\</span><span style="color: #000099; font-weight: bold;">\\</span>)&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedPattern <span style="color: #339933;">=</span> Pattern.<span style="color: #006633;">compile</span><span style="color: #009900;">&#40;</span>expectedRegex, Pattern.<span style="color: #006633;">DOTALL</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertTrue<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Incorrect stacktrace:<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">+</span> highlightedStackTrace, expectedPattern.<span style="color: #006633;">matcher</span><span style="color: #009900;">&#40;</span>highlightedStackTrace<span style="color: #009900;">&#41;</span>.<span style="color: #006633;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetStackDepth<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// not the sort of thing you can test, really</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testGetStackTraceSummary<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #003399;">ByteArrayOutputStream</span> baos <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">ByteArrayOutputStream</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #003399;">Exception</span> e <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> summary <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
		List<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span> expectedSummary <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">a</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>HighLevelException hle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> hle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		summary <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceSummary</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;com.randomnoun.common.MidLevelException: &lt;middle&gt;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
		expectedSummary.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;middle&gt;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>expectedSummary, summary<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">b</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>MidLevelException mle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> mle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		summary <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceSummary</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&lt;middle&gt;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>expectedSummary, summary<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">d</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		summary <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceSummary</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>expectedSummary, summary<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
            Junk.<span style="color: #006633;">e</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span><span style="color: #009900;">&#40;</span>LowLevelException lle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            e <span style="color: #339933;">=</span> lle<span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
		baos.<span style="color: #006633;">reset</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> e.<span style="color: #006633;">printStackTrace</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">PrintStream</span><span style="color: #009900;">&#40;</span>baos<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		summary <span style="color: #339933;">=</span> ExceptionUtils.<span style="color: #006633;">getStackTraceSummary</span><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>String<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		expectedSummary.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		assertEquals<span style="color: #009900;">&#40;</span>expectedSummary, summary<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>


</div></div>
<p>And a JSP errorPage handler which uses it:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-errorpage-jsp"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>errorPage.jsp</div><div class="toggler-target toggle-block toggler-class-errorpage-jsp"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #339933;">&lt;?</span>xml version<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;1.0&quot;</span> encoding<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;ISO-8859-1&quot;</span> <span style="color: #339933;">?&gt;</span>
<span style="color: #339933;">&lt;!</span>DOCTYPE html <span style="color: #000000; font-weight: bold;">PUBLIC</span> <span style="color: #0000ff;">&quot;-//W3C//DTD XHTML 1.1//EN&quot;</span> <span style="color: #0000ff;">&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;</span><span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;%</span>@ page 
  language<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;java&quot;</span>
  contentType<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;text/html; charset=ISO-8859-1&quot;</span>
  pageEncoding<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;ISO-8859-1&quot;</span>
  <span style="color: #000000; font-weight: bold;">import</span><span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;java.util.*,java.text.*,com.randomnoun.common.ExceptionUtils&quot;</span>
<span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;%--</span>
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a 
 * &lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by/3.0/&quot;&gt;Creative Commons Attribution 3.0 Unported License&lt;/a&gt;.
 */</span>
<span style="color: #339933;">--%&gt;</span>
<span style="color: #339933;">&lt;%</span> response.<span style="color: #006633;">setStatus</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">500</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;</span>html xmlns<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;http://www.w3.org/1999/xhtml&quot;</span><span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;!--</span> $Id<span style="color: #339933;">:</span> errorPage.<span style="color: #006633;">jsp</span>,v <span style="color: #cc66cc;">1.2</span> <span style="color: #cc66cc;">2013</span><span style="color: #339933;">-</span>01<span style="color: #339933;">-</span>08 <span style="color: #cc66cc;">19</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">28</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">23</span> knoxg Exp $ <span style="color: #339933;">--&gt;</span>
<span style="color: #339933;">&lt;</span>head<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>title<span style="color: #339933;">&gt;</span>Error<span style="color: #339933;">&lt;/</span>title<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;/</span>head<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>body style<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;font-family: Arial;&quot;</span><span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;%</span>
  <span style="color: #003399;">Throwable</span> exception <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span><span style="color: #009900;">&#41;</span> request.<span style="color: #006633;">getAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;javax.servlet.error.exception&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #003399;">String</span> message <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span><span style="color: #009900;">&#41;</span> request.<span style="color: #006633;">getAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;javax.servlet.error.message&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>exception<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    exception <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Throwable</span><span style="color: #009900;">&#41;</span> request.<span style="color: #006633;">getAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;javax.servlet.jsp.jspException&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>exception<span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      message <span style="color: #339933;">=</span> exception.<span style="color: #006633;">getMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
  <span style="color: #009900;">&#125;</span>
  <span style="color: #003399;">SimpleDateFormat</span> sdf <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">SimpleDateFormat</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;yyyy-MM-dd HH:mm:ss zzzz&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #003399;">String</span> timeString <span style="color: #339933;">=</span> sdf.<span style="color: #006633;">format</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Date</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #666666; font-style: italic;">/* if (exception instanceof RemoteException) {
    exception = ((RemoteException) exception).detail;
  } */</span>
<span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;</span>table style<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;border: red solid 1px; background-color: #FFFEBB; margin:10px; font-size: 8pt&quot;</span><span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>tr<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>td valign<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;top&quot;</span><span style="color: #339933;">&gt;&lt;</span>img align<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;left&quot;</span> src<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;image/information.gif&quot;</span> <span style="color: #339933;">/&gt;&lt;/</span>td<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>td valign<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;top&quot;</span><span style="color: #339933;">&gt;</span>
  <span style="color: #339933;">&lt;</span>b<span style="color: #339933;">&gt;</span>An error has occurred in the application<span style="color: #339933;">&lt;/</span>b<span style="color: #339933;">&gt;</span>
  <span style="color: #339933;">&lt;</span>br<span style="color: #339933;">/&gt;&lt;</span>br<span style="color: #339933;">/&gt;</span>
  <span style="color: #339933;">&lt;</span>b<span style="color: #339933;">&gt;</span>Message<span style="color: #339933;">:&lt;/</span>b<span style="color: #339933;">&gt;</span> <span style="color: #339933;">&lt;%=</span> message <span style="color: #339933;">%&gt;</span>
  <span style="color: #339933;">&lt;</span>br<span style="color: #339933;">/&gt;&lt;</span>br<span style="color: #339933;">/&gt;</span>
  <span style="color: #339933;">&lt;</span>b<span style="color: #339933;">&gt;</span><span style="color: #003399;">Request</span> URI<span style="color: #339933;">:&lt;/</span>b<span style="color: #339933;">&gt;</span> <span style="color: #339933;">&lt;%=</span> request.<span style="color: #006633;">getAttribute</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;javax.servlet.error.request_uri&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%&gt;</span> 
  <span style="color: #339933;">&lt;</span>br<span style="color: #339933;">/&gt;&lt;</span>b<span style="color: #339933;">&gt;</span><span style="color: #003399;">Request</span> <span style="color: #003399;">Time</span><span style="color: #339933;">:&lt;/</span>b<span style="color: #339933;">&gt;</span> <span style="color: #339933;">&lt;%=</span> timeString <span style="color: #339933;">%&gt;</span>
  <span style="color: #339933;">&lt;%--</span> should only display <span style="color: #000000; font-weight: bold;">this</span> in development mode, otherwise log or email it <span style="color: #339933;">--%&gt;</span>
  <span style="color: #339933;">&lt;</span>br<span style="color: #339933;">/&gt;&lt;</span>br<span style="color: #339933;">/&gt;</span>
  <span style="color: #339933;">&lt;%</span> <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>exception<span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #339933;">%&gt;</span>
  <span style="color: #339933;">&lt;</span>b<span style="color: #339933;">&gt;</span><span style="color: #003399;">Stack</span> trace<span style="color: #339933;">:&lt;/</span>b<span style="color: #339933;">&gt;</span> <span style="color: #339933;">&lt;</span>a href<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;javascript:void();&quot;</span> onclick<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;x = document.getElementById('stackTrace').style; x.display = (x.display=='block' ? 'none' : 'block');&quot;</span><span style="color: #339933;">&gt;</span>Click to display<span style="color: #339933;">&lt;/</span>a<span style="color: #339933;">&gt;</span>
  <span style="color: #339933;">&lt;</span>div id<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;stackTrace&quot;</span> style<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;display:none&quot;</span><span style="color: #339933;">&gt;&lt;</span>pre<span style="color: #339933;">&gt;&lt;%=</span> 
    ExceptionUtils.<span style="color: #006633;">getStackTraceWithRevisions</span><span style="color: #009900;">&#40;</span>exception, <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">getClass</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">getClassLoader</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>,
    ExceptionUtils.<span style="color: #006633;">HIGHLIGHT_HTML</span>, <span style="color: #0000ff;">&quot;com.randomnoun.,com.example.contrived.,org.apache.jsp.&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%&gt;&lt;/</span>pre<span style="color: #339933;">&gt;&lt;/</span>div<span style="color: #339933;">&gt;</span>
  <span style="color: #339933;">&lt;%</span> <span style="color: #009900;">&#125;</span> <span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;/</span>td<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;/</span>tr<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;/</span>table<span style="color: #339933;">&gt;</span>  
<span style="color: #339933;">&lt;/</span>body<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;/</span>html<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;%</span>
    out.<span style="color: #006633;">flush</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #666666; font-style: italic;">/*
    if (request.getAttribute(&quot;sentAlarm&quot;)==null) {
      	ExceptionHandler.sendApplicationAlarm(request, exception, &quot;JSP&quot;);
    }
	*/</span>
<span style="color: #339933;">%&gt;</span></pre></td></tr></table></div>


</div></div>
<p>And an example broken JSP:</p>
<div class="codeHeader"><div class="codeToggle"><div class="toggler-link toggler-click toggle-block toggler-class-thiscodeisalmostcompletelybugfree-jsp"><span class="toggler-replace-show toggler-icon-show ">Show code</span><span class="toggler-replace-hide toggler-icon-hide ">Hide code</span></div></div>thisCodeIsAlmostCompletelyBugFree.jsp</div><div class="toggler-target toggle-block toggler-class-thiscodeisalmostcompletelybugfree-jsp"><div class="toggler-hide-ghost">


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre class="java" style="font-family:monospace;"><span style="color: #339933;">&lt;%</span>@ page 
  language<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;java&quot;</span>
  contentType<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;text/html; charset=ISO-8859-1&quot;</span>
  pageEncoding<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;ISO-8859-1&quot;</span>
  errorPage<span style="color: #339933;">=</span><span style="color: #0000ff;">&quot;misc/errorPage.jsp&quot;</span>
<span style="color: #339933;">%&gt;</span>
<span style="color: #339933;">&lt;%--</span>
<span style="color: #666666; font-style: italic;">/* (c) 2013 randomnoun. All Rights Reserved. This work is licensed under a 
 * &lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by/3.0/&quot;&gt;Creative Commons Attribution 3.0 Unported License&lt;/a&gt;.
 */</span>
<span style="color: #339933;">--%&gt;</span>
<span style="color: #339933;">&lt;</span>html<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>head<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>title<span style="color: #339933;">&gt;</span>A contrived web application<span style="color: #339933;">&lt;/</span>title<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;/</span>head<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>body<span style="color: #339933;">&gt;</span>
<span style="color: #339933;">&lt;</span>h2<span style="color: #339933;">&gt;</span>Hello from contrived<span style="color: #339933;">-</span>web <span style="color: #339933;">!&lt;/</span>h2<span style="color: #339933;">&gt;</span>
&nbsp;
<span style="color: #339933;">&lt;</span>p<span style="color: #339933;">&gt;</span>And now <span style="color: #000000; font-weight: bold;">for</span> your <span style="color: #003399;">ClassCastException</span>.
&nbsp;
<span style="color: #339933;">&lt;%</span>
  <span style="color: #003399;">Comparable</span> thee <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Juliet&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #003399;">Comparable</span> aSummersDay <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> <span style="color: #003399;">Long</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">38</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">// degrees celsius</span>
<span style="color: #339933;">%&gt;</span>
thee are
<span style="color: #339933;">&lt;%=</span> thee.<span style="color: #006633;">compareTo</span><span style="color: #009900;">&#40;</span>aSummersDay<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span> <span style="color: #339933;">?</span> <span style="color: #0000ff;">&quot;greater&quot;</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&quot;less than or equal to&quot;</span> <span style="color: #339933;">%&gt;</span>
a Summer<span style="color: #0000ff;">'s Day
&lt;/body&gt;
&lt;/html&gt;</span></pre></td></tr></table></div>


</div></div>
<p>which looks <a href="/contrived-web/thisCodeIsAlmostCompletelyBugFree.jsp">like this</a> when you try to view it in your application server of choice (click the image below to see the actual page).</p>
<div id="attachment_42" class="wp-caption aligncenter" style="width: 433px"><a href="/contrived-web/thisCodeIsAlmostCompletelyBugFree.jsp" rel="attachment wp-att-42"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/12/errorPage.png" alt="Click through to view page" width="423" height="137" class="size-full wp-image-42" /></a><p class="wp-caption-text">errorPage.jsp in action</p></div>
<p>What you could also do if you were really keen would be to generate hrefs in the generated HTML stacktrace to <i>(your favourite web-based source control system)</i>, but that&#8217;s probably not that useful since</p>
<ul>
<li>on a production system you probably shouldn&#8217;t be showing stack traces since this may lead your end-users to believe that the website/application isn&#8217;t being run by a glistening ball of energy in The Cloud somewhere
<li>the end-user won&#8217;t have permissions to your source control system
<li>on a development system you probably haven&#8217;t checked in the code you&#8217;re currently debugging anyway
</ul>
<p>So there you go. If you find the above code useful then more power to you.</p>
<div class="stripey-sidebox">
<p>This class is now part of the <tt><b>com.randomnoun.common:common-public</b></tt> artifact, which can be directly referenced in your <code>pom.xml</code> from the maven central repository. </p>
<p>
<div class="maven-button"><a href="http://code.randomnoun.com/common-public"><img src="http://www.randomnoun.com/wp/wp-content/uploads/2012/09/maven-ball-42.png" width="42" height="42" style="margin: 5px; float:left;"/></a><a href="http://code.randomnoun.com/common-public">
<div class="big">common-public</div>
<div class="small">com.randomnoun.common:common-public</div>
<p></a></div>
</div>
<p><b>Update 25/9/2013: </b> It&#8217;s in central now</p>
			</div>

			<div class="postmetadata clearfix">
        <p class="commentslink alignright">
          <a href="http://www.randomnoun.com/wp/2012/12/17/marginally-better-stack-traces/#respond" title="Comment on Marginally better stack traces">No comments</a> &#187;
        </p>
			  <p class="categories">
          Posted in <a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>        </p>
			  <p class="tags">Tags: <a href="http://www.randomnoun.com/wp/tag/common/" rel="tag">common</a> <a href="http://www.randomnoun.com/wp/tag/java/" rel="tag">java</a></p>      </div>
		</div>

		
		<div class="pagination navigation clearfix">
		    		  <div class="alignleft"><a href="http://www.randomnoun.com/wp/tag/java/page/2/" >&laquo; Older Entries</a></div>
  			<div class="alignright"></div>
		  		</div>		
		
	
		</div><!-- #content -->
	</div><!-- #container -->

<div id="sidebar">
	<ul class="sb-list clearfix">
<li id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action="http://www.randomnoun.com/wp/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></li><li id="wp_socializer-2" class="widget widget_wp_socializer"><div class="sb-title widgettitle">randomnoun on facebook</div>

<!-- Begin WP Socializer Widget v2.4.9.5-->
<iframe src="//www.facebook.com/plugins/likebox.php?href=http%3A%2F%2Fwww.facebook.com%2Fpageofnouns&amp;width=300&amp;height=60&amp;colorscheme=light&amp;show_faces=&amp;border_color=&amp;stream=&amp;header=" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:300px; height:60px;" allowTransparency="true"></iframe>
<!-- End WP Socializer Widget v2.4.9.5-->

</li><li id="blog_subscription-2" class="widget jetpack_subscription_widget"><div class="sb-title widgettitle"><label for="subscribe-field">GET UPDATES BY EMAIL</label></div>
		<form action="" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-2">
			<p>Enter your email address here to receive notifications of new posts by email.</p>
			<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" value="Email Address" id="subscribe-field" onclick="if ( this.value == 'Email Address' ) { this.value = ''; }" onblur="if ( this.value == '' ) { this.value = 'Email Address'; }" /></p>

			<p>
				<input type="hidden" name="action" value="subscribe" />
				<input type="hidden" name="source" value="http://www.randomnoun.com/wp/tag/java/" />
				<input type="hidden" name="sub-type" value="widget" />
				<input type="hidden" name="redirect_fragment" value="" />
								<input type="submit" value="Subscribe" name="jetpack_subscriptions_widget" />
			</p>
		</form>

		
</li>		<li id="recent-posts-2" class="widget widget_recent_entries">		<div class="sb-title widgettitle">Recent Posts</div>		<ul>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/10/31/progress-bars/" title="Progress Bars">Progress Bars</a>
						</li>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/10/27/windows-shell32-animations/" title="Windows shell32 animations">Windows shell32 animations</a>
						</li>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/10/08/a-java-client-for-the-songkick-api/" title="A Java client for the Songkick API">A Java client for the Songkick API</a>
						</li>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/10/08/its-all-made-out-of-pipes/" title="It&#8217;s all made out of pipes">It&#8217;s all made out of pipes</a>
						</li>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/10/02/boxes-and-lines/" title="Boxes and Lines">Boxes and Lines</a>
						</li>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/09/24/webapp-versions-v1-0/" title="Webapp versions v1.0">Webapp versions v1.0</a>
						</li>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/09/19/what-is-randomnoun/" title="What is randomnoun ?">What is randomnoun ?</a>
						</li>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/09/18/fisher-price-application-design/" title="Fisher Price Application Design">Fisher Price Application Design</a>
						</li>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/09/15/bitrot/" title="Bitrot">Bitrot</a>
						</li>
					<li>
				<a href="http://www.randomnoun.com/wp/2013/09/14/determining-the-file-at-a-specific-vmdk-offset-again/" title="Determining the file at a specific VMDK offset again">Determining the file at a specific VMDK offset again</a>
						</li>
				</ul>
		</li><li id="recent-comments-2" class="widget widget_recent_comments"><div class="sb-title widgettitle">Recent Comments</div><ul id="recentcomments"><li class="recentcomments"><a href='http://www.randomnoun.com/wp/2013/10/31/progress-bars/' rel='external nofollow' class='url'>Progress Bars &raquo; randomnoun</a> on <a href="http://www.randomnoun.com/wp/2013/10/08/its-all-made-out-of-pipes/#comment-8156">It&#8217;s all made out of pipes</a></li><li class="recentcomments"><a href='http://www.randomnoun.com/wp/2012/11/07/putting-a-maven-version-label-on-a-bamboo-build/' rel='external nofollow' class='url'>Putting a maven version label on a bamboo build &raquo; randomnoun</a> on <a href="http://www.randomnoun.com/wp/2013/06/30/maven/#comment-7277">Maven</a></li><li class="recentcomments"><a href='http://www.randomnoun.com/wp/2013/10/08/a-java-client-for-the-songkick-api/' rel='external nofollow' class='url'>A Java client for the Songkick API &raquo; randomnoun</a> on <a href="http://www.randomnoun.com/wp/2013/09/11/getting-an-artifact-into-the-maven-central-repository/#comment-7242">Getting an artifact into the maven central repository</a></li><li class="recentcomments"><a href='http://www.facebook.com/profile.php?id=100003444031571' rel='external nofollow' class='url'>Natalia</a> on <a href="http://www.randomnoun.com/wp/2012/12/26/automating-windows-from-java-and-windowtreedom/#comment-6650">Automating Windows&trade; from Java&reg; and WindowTreeDom<sup><sup>☂</sup></sup></a></li><li class="recentcomments"><a href='http://www.randomnoun.com/wp/2013/09/12/determining-the-file-at-a-specific-vmdk-offset/' rel='external nofollow' class='url'>Determining the file at a specific VMDK offset &raquo; randomnoun</a> on <a href="http://www.randomnoun.com/wp/2013/09/14/determining-the-file-at-a-specific-vmdk-offset-again/#comment-6622">Determining the file at a specific VMDK offset again</a></li></ul></li><li id="archives-2" class="widget widget_archive"><div class="sb-title widgettitle">Archives</div>		<ul>
			<li><a href='http://www.randomnoun.com/wp/2013/10/' title='October 2013'>October 2013</a></li>
	<li><a href='http://www.randomnoun.com/wp/2013/09/' title='September 2013'>September 2013</a></li>
	<li><a href='http://www.randomnoun.com/wp/2013/08/' title='August 2013'>August 2013</a></li>
	<li><a href='http://www.randomnoun.com/wp/2013/07/' title='July 2013'>July 2013</a></li>
	<li><a href='http://www.randomnoun.com/wp/2013/06/' title='June 2013'>June 2013</a></li>
	<li><a href='http://www.randomnoun.com/wp/2013/04/' title='April 2013'>April 2013</a></li>
	<li><a href='http://www.randomnoun.com/wp/2013/03/' title='March 2013'>March 2013</a></li>
	<li><a href='http://www.randomnoun.com/wp/2013/02/' title='February 2013'>February 2013</a></li>
	<li><a href='http://www.randomnoun.com/wp/2013/01/' title='January 2013'>January 2013</a></li>
	<li><a href='http://www.randomnoun.com/wp/2012/12/' title='December 2012'>December 2012</a></li>
	<li><a href='http://www.randomnoun.com/wp/2012/11/' title='November 2012'>November 2012</a></li>
	<li><a href='http://www.randomnoun.com/wp/2012/09/' title='September 2012'>September 2012</a></li>
		</ul>
</li><li id="categories-2" class="widget widget_categories"><div class="sb-title widgettitle">Categories</div>		<ul>
	<li class="cat-item cat-item-1"><a href="http://www.randomnoun.com/wp/category/uncategorized/" title="View all posts filed under Uncategorized">Uncategorized</a>
</li>
		</ul>
</li><li id="meta-2" class="widget widget_meta"><div class="sb-title widgettitle">Meta</div>			<ul>
						<li><a href="http://www.randomnoun.com/wp/wp-login.php">Log in</a></li>
			<li><a href="http://www.randomnoun.com/wp/feed/" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://www.randomnoun.com/wp/comments/feed/" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>						</ul>
</li>



<li id="about" class="clearfix">
  <div class="sb-title">About</div>
  <ul>
  	<li>
  		randomnoun is everything that want it to be, plus a whole bag of things that you don't		</li>
	</ul>
</li>



	
</ul>

<ul class="group">
  
    
    
  
</ul>


<ul class="group">

    
  
</ul>

</div> <!-- #sidebar --></div> <!-- #main -->

	<div style="display:none">
	</div>

<div id="footer" class="clearfix">
<p class="alignright">
  <a href="#home" class="top-link">Back to Top</a>
</p>

<p>
	&copy; 2013 randomnoun  &middot; Proudly powered by  <a href="http://wordpress.org/" title="Blogsoftware by Wordpress">WordPress</a>
	<span class="amp">&amp;</span>
  <a href="http://cordobo.com/green-park-2/" title="Cordobo Green Park 2 Beta 5">Green Park 2</a>
  by  <a href="http://cordobo.com/" title="Webdesign by Cordobo">Cordobo</a>.
</p>

<p class="signet">
  Valid XHTML 1.0 Transitional | Valid CSS 3  <br /><br />
	<img src="http://www.randomnoun.com/wp/wp-content/themes/randomnoun/img/logo-cgp2.png" alt="Cordobo Green Park 2 logo" title="Cordobo Green Park 2" width="75" height="12" />
</p>

</div>

<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201350'></script>
<script type='text/javascript' src='http://www.randomnoun.com/wp/wp-content/plugins/wp-socializer/public/js/wp-socializer-bookmark-js.js?ver=2.4.9.5'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2013Decaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.randomnoun.com/wp/wp-content/plugins/jetpack/modules/wpgroho.js?ver=3.6'></script>

	<script src="http://stats.wordpress.com/e-201350.js" type="text/javascript"></script>
	<script type="text/javascript">
	st_go({v:'ext',j:'1:2.4',blog:'47261782',post:'0',tz:'0'});
	var load_cmc = function(){linktracker_init(47261782,0,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script>


</body>
</html>
