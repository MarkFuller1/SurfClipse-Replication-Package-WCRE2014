<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="MSSmartTagsPreventParsing" content="TRUE" />
  <meta name="ROBOTS" content="INDEX, FOLLOW" />
  
  <title>Java Quiz #40 - The Coder's Breakfast</title>
  <meta name="description" lang="en" content="To please your Project Manager, a former developer (yeaaars ago), you sometimes let him help you develop some &quot;very important&quot; parts of your application. Today, he's in" />
  <meta name="copyright" content="Creative Common BY-NC-ND" />
  <meta name="author" content="Olivier Croisier" />
  <meta name="date" scheme="W3CDTF" content="2010-07-28T10:00:00+02:00" />
  
  <link rel="schema.dc" href="http://purl.org/dc/elements/1.1/" />
  <meta name="dc.title" content="Java Quiz #40" />
  <meta name="dc.description" lang="en" content="To please your Project Manager, a former developer (yeaaars ago), you sometimes let him help you develop some &quot;very important&quot; parts of your application. Today, he's in" />
  <meta name="dc.creator" content="Olivier Croisier" />
  <meta name="dc.language" content="en" />
  <meta name="dc.publisher" content="Olivier Croisier" />
  <meta name="dc.rights" content="Creative Common BY-NC-ND" />
  <meta name="dc.date" scheme="W3CDTF" content="2010-07-28T10:00:00+02:00" />
  <meta name="dc.type" content="text" />
  <meta name="dc.format" content="text/html" />
  
  <link rel="top" href="http://thecodersbreakfast.net/index.php?" title="Accueil" />
  <link rel="contents" href="http://thecodersbreakfast.net/index.php?archive" title="Archives" />
  
  <link rel="next" href="http://thecodersbreakfast.net/index.php?post/2010/08/01/The-Coders-Breakfast-language-poll"
  title="The Coder's Breakfast : quel langage / what language ?" />
  
  <link rel="previous" href="http://thecodersbreakfast.net/index.php?post/2010/07/06/Paris-JUG-Java-EE-6-par-Adam-Bien"
  title="Paris JUG &quot;Java EE 6&quot; par Adam Bien" />
  
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="http://thecodersbreakfast.net/index.php?feed/atom" />
  
  <style type="text/css" media="screen">
@import url(/themes/TheCodersBreakfast2/style.css);
</style>
<style type="text/css" media="print">
@import url(/themes/TheCodersBreakfast2/../default/print.css);
</style>

<script type="text/javascript" src="/themes/TheCodersBreakfast2/../default/js/jquery.js"></script>
<script type="text/javascript" src="/themes/TheCodersBreakfast2/../default/js/jquery.cookie.js"></script>

<link rel="apple-touch-icon" href="http://thecodersbreakfast.net/index.php?favicon.png" />
<link rel="icon" type="image/png" href="http://thecodersbreakfast.net/index.php?favicon.png" />
  
  <script type="text/javascript" src="/themes/TheCodersBreakfast2/../default/js/post.js"></script>
  <script type="text/javascript">
	  //<![CDATA[
	  var post_remember_str = 'Se souvenir de moi sur ce blog';
	  //]]>
  </script>
</head>

<body>
<div id="body">
<div id="page">


	<!-- 
	================================================================================
									PAGE HEADER
	================================================================================
	-->
	<div id="page_header">
		<a href="http://thecodersbreakfast.net/index.php?"><img id="header_bandeau" src="/themes/TheCodersBreakfast2/img/bandeau.png"/></a>
	
	</div>
		

	<div id="page_body">

		<!-- 
		================================================================================
										PAGE CONTENT
		================================================================================
		-->
		<div id="page_content">
			<div id="p261" class="post">		
				<div class="post-date">
	<span class="post-date-day">28</span><br/>
	<span class="post-date-month">juil.</span><br/>
	<span class="post-date-year">2010</span>
</div>
		
				<div class="post-header">

	<!-- Titre -->
	<h2 class="post-title">						
		<a href="http://thecodersbreakfast.net/index.php?post/2010/07/28/Java-Quiz-40">Java Quiz #40</a>
	</h2>
	
	<!-- Méta-infos -->
	<div class="post-infos-header">
		<span class="post-infos-categorisation">
			<!-- Catégorie -->
												<a href="http://thecodersbreakfast.net/index.php?category/Java-JEE">Java / JEE</a> › 
								<a href="http://thecodersbreakfast.net/index.php?category/Java/Quiz">Java Quiz</a>
						<!-- Tags -->|
							Tags : 						
				<a href="http://thecodersbreakfast.net/index.php?tag/java">java</a>		
					</span>
		<!-- Auteur -->
		Par Olivier Croisier 
	</div>		
	
</div>
				<!-- Contenu -->
	<div class="post-content"><p>To please your Project Manager, a former developer (yeaaars ago), you
sometimes let him help you develop some "very important" parts of your
application.</p>


<p>Today, he's in charge of displaying "Hello World" by iterating on a list
containing those words. Alas, distracted by his going on vacation this
very afternoon, he forgets to add "World" to the list before starting
the iteration. Trying to correct his mistake, he adds it a few lines
later, but now his code unexpectedly breaks down at runtime ("this must
be a JVM bug !").</p>


<p>A few minutes before leaving, he asks you to find a solution in his
absence, with the following instructions :</p>
<ul>
<li>Do not modify his existing code, it's Perfect (of course).</li>
<li>The <code>FIXME</code> tag shows where you're allowed to insert your corrective code</li>
<li>He must be able to understand your solution when he comes back (so</li>
</ul>
<p>using Reflection is not an option).</p>


<p>Are you worth the trust of your beloved Manager ?</p>

<pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">final</span> List<span style="color: #000000;">&lt;</span>String<span style="color: #000000;">&gt;</span> list = <span style="color: #7F0055; font-weight: bold;">new</span> ArrayList<span style="color: #000000;">&lt;</span>String<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span><span style="color: #000000;">&#123;</span> add<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Hello&quot;</span><span style="color: #000000;">&#41;</span>; <span style="color: #000000;">&#125;</span><span style="color: #000000;">&#125;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">final</span> Iterator<span style="color: #000000;">&lt;</span>String<span style="color: #000000;">&gt;</span> iterator = list.<span style="color: #000000;">iterator</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span>iterator.<span style="color: #000000;">next</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">list.<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;World&quot;</span><span style="color: #000000;">&#41;</span>; </div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #808080; font-style: italic;">// FIXME : work here while I'm sunbathing</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span>iterator.<span style="color: #000000;">next</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li></ol></pre>


<p>Hints - Keep in mind that :</p>
<ul>
<li>the iterator is declared final</li>
<li>this is only a code fragment, so you cannot use System.exit(0) or return; you wouldn't like your application to terminate prematurely, would you ?</li>
<li>since you cannot modify the existing code, you cannot delete or ignore the last line, which must print "World"</li>
</ul>

<p>Note : I must thank Romain Revol for helping me to write this quiz. Romain successfully attended the "<a href="http://www.javaspecialists.eu/courses/master.jsp">Heinz Kabutz's Java Specialist Master Course</a>" training session <a href="http://www.zenika.com/formation_java_specialiste.php" hreflang="fr">I presented in France in June at Zenika's office</a>.</p></div>
    
<div class="post-content"><p><br />
<br /></p>


<p><strong><ins>Answer :</ins></strong><br />
Well, this is unusual. Since Steen gave the most detailed (and correct) answer I've ever seen on this blog (see <a href="/index.php?post/2010/07/28/Java-Quiz-40#c547">comment 45</a> below), I will simply paste it here as the official answer. <br />
Congratulations, Steen :)</p>


<p>When running:</p>
<pre>
java -cp . ManagersHello
</pre>


<p>We get :</p>
<pre>
Hello
Exception in thread &quot;main&quot; java.util.ConcurrentModificationException
  at java.util.AbstractList$Itr.checkForComodification(AbstractList.java:372)
  at java.util.AbstractList$Itr.next(AbstractList.java:343)
  at ManagersHello.main(ManagersHello.java:146)
</pre>


<p>The javadoc for ConcurrentModificationException says:</p>


<blockquote><p>If a single thread issues a sequence of method invocations that violates the contract of an object, the object may throw this exception.
For example, if a thread modifies a collection directly while it is iterating over the collection with a fail-fast iterator, the iterator will throw this exception.</p></blockquote>


<p>The <code>AbstractList</code> class provides the Iterator that is used in the <code>ArrayList</code>, and this class has an internal class <code>Itr</code> that uses two field to detect whether there has been made 'structural modifications' to the subject of the iteration.</p>


<p>The field "<code>int expectedModCount</code>" is initiated to be equal to the field "<code>protected transient int modCount = 0;</code>", and <code>modCount</code> keeps track of the structural modifications. If <code>modCount</code> at some points in the iteration does not equal <code>expectedModCount</code>, a <code>ConcurrentModificationException</code> is thrown.<br />
Such a check is made on most calls on the Iterator, which is implemented using the <code>Itr</code> inner class.</p>


<p>In the code below, the assertation holds until the second call to <code>iterator.next()</code> is made, because at that time, the <code>expectedModCount</code> is 0, while the <code>modCount</code> of the list is 1.</p>


<p>The call "<code>list.add("World");</code>" will increment the <code>modCount</code> <em>after</em> the list has been structurally changed. This means that the first call to the check method after this statement will throw a <code>ConcurrentModificationException</code>.</p>


<p>This window can be used to try to modify the <code>modCount</code> of the list instance so that it will again be equal to <code>expectedModCount</code> <em>before</em> the <code>iterator.next()</code> method is called. Since <code>modCount</code> is an <code>int</code>, an overflow will wrap the value from <code>Integet.MAX_VALUE</code> to <code>Integer.MIN_VALUE</code> and therefore it will be possible to reach the value of <code>expectedModCount</code> through an integer overflow.</p>


<p>In the <code>ArrayList</code> implementation, which is the instantiated type of the field <code>list</code> in the code, 4 methods change the variable <code>modCount</code> upon invocation :</p>
<ul>
<li><code>public void trimToSize()</code></li>
<li><code>public void ensureCapacity(int minCapacity)</code></li>
<li><code>public E remove(int index)</code></li>
<li><code>public void clear()</code></li>
</ul>

<p><code>trimToSize</code> will increase the modification count by one and then check to see if the number of elements in an internal array buffer is smaller the number of elements specified in the construction of the <code>ArrayList</code>. If this is the case, an invokation of <code>Arrays.copyOf(T<a href=""></a> original, int newLength)</code> is made.</p>


<p><code>ensureCapacity</code> will likewise increase the modification count and the perform a check on whether the specified minimum capacity is larger than the number of elements currently in the <code>ArrayList</code>.</p>


<p><code>remove</code> will do a range check, increase the modification count and remove the element E at the specified index.</p>


<p><code>clear</code> will increase the modification count and then remove (nullify) all elements in the <code>ArrayList</code></p>


<p>Starting from the bottom, neither the <code>clear()</code> nor the <code>remove()</code> methods will work in this scenario, since their structural modification will be to remove the very element we wish to print. Using <code>clear()</code> will make the second call to <code>iterator.next()</code> fail with a <code>NoSuchElementException</code>. Using <code>remove(int)</code> will make the second call to <code>((ArrayList)list).remove(0)</code> fail with an <code>IndexOutOfBoundsException</code>, since there is no more elements to remove and hence none at index 0.</p>


<p>Of course, calling <code>remove(0)</code> for uneven numbers (except <code>Integer.MIN_VALUE</code>) and <code>subsequently add("World")</code> (for even numbers) will work, as the list will end up on the correct modification count <em>and</em> the correct number of elements ("World") at the end of the for loop.</p>


<p>This leaves us with <code>ensureCapacity(int)</code> and <code>trimToSize()</code>, both of which will work, because they preserve the elements in the list.</p>

<pre class="java code java" style="font-family:inherit"><ol><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">class</span> Quiz40 <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #7F0055; font-weight: bold;">public</span> <span style="color: #7F0055; font-weight: bold;">static</span> <span style="color: #7F0055; font-weight: bold;">void</span> main<span style="color: #000000;">&#40;</span><span style="color: #000000;">String</span><span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> args<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">final</span> List<span style="color: #000000;">&lt;</span>String<span style="color: #000000;">&gt;</span> list = <span style="color: #7F0055; font-weight: bold;">new</span> ArrayList<span style="color: #000000;">&lt;</span>String<span style="color: #000000;">&gt;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span><span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            add<span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;Hello&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span><span style="color: #000000;">&#125;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055; font-weight: bold;">final</span> Iterator<span style="color: #000000;">&lt;</span>String<span style="color: #000000;">&gt;</span> iterator = list.<span style="color: #000000;">iterator</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span>iterator.<span style="color: #000000;">next</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        list.<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;World&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #808080; font-style: italic;">// FIXME : work here while I'm sunbathing</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #7F0055;font-weight: bold;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #7F0055; font-weight: bold;">int</span> i = <span style="color: #000000;">Integer</span>.<span style="color: #000000;">MIN_VALUE</span>; i <span style="color: #000000;">&lt;</span> <span style="color: #000000;">Integer</span>.<span style="color: #000000;">MAX_VALUE</span>; i++<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #808080; font-style: italic;">//solution_one              </span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">ArrayList</span><span style="color: #000000;">&#41;</span> list<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">ensureCapacity</span><span style="color: #000000;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #808080; font-style: italic;">//solution_two</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">ArrayList</span><span style="color: #000000;">&#41;</span> list<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">trimToSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #808080; font-style: italic;">//solution_three</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">!</span><span style="color: #000000;">&#40;</span>i == <span style="color: #000000;">Integer</span>.<span style="color: #000000;">MIN_VALUE</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&amp;&amp;</span> <span style="color: #000000;">!</span><span style="color: #000000;">&#40;</span>i <span style="color: #000000;">%</span> <span style="color: #cc66cc;">2</span> == 0<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">ArrayList</span><span style="color: #000000;">&#41;</span> list<span style="color: #000000;">&#41;</span>.<span style="color: #000000;">remove</span><span style="color: #000000;">&#40;</span>0<span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #7F0055;font-weight: bold;">if</span> <span style="color: #000000;">&#40;</span>i <span style="color: #000000;">%</span> <span style="color: #cc66cc;">2</span> == 0<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">                list.<span style="color: #000000;">add</span><span style="color: #000000;">&#40;</span><span style="color: #888888;">&quot;World&quot;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">            <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">        <span style="color: #000000;">System</span>.<span style="color: #000000;">out</span>.<span style="color: #000000;">println</span><span style="color: #000000;">&#40;</span>iterator.<span style="color: #000000;">next</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">    <span style="color: #000000;">&#125;</span></div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;">&nbsp;</div></li><li style="font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;"><span style="color: #000000;">&#125;</span></div></li></ol></pre></div>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="vertical" data-via="OlivierCroisier" data-lang="fr">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>

<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script><g:plusone size="tall"></g:plusone>
	
			</div> 
			
			<div class="post-comments">
<hr/>

			<div id="comments">
			<h3>Commentaires</h3>
			<dl>
				<dt id="c500" class=" odd first">
			<a href="#c500" class="comment-number">1.</a>
			Le jeudi 29 juillet 2010, 02:57			par <a href="http://blog.mycila.com/" rel="nofollow">Mathieu</a>		</dt>      
		<dd class=" odd first">
			<p>Le but est de faire un overflow sur modCount. La méthode trimToSize est a priori la plus rapide car ne fait presque aucune opération quand la liste ne change pas, sauf augmenter modCount</p>


<p>ArrayList al = (ArrayList) list;<br />
for (int n = Integer.MIN_VALUE; n &lt; Integer.MAX_VALUE; n++) al.trimToSize();</p>


<p>Et si vous voulez formaté tel que demandé, lancer le code suivant avec "java -Dline.separator= Main"</p>


<p>System.out.print(" ");<br />
ArrayList al = (ArrayList) list;<br />
for (int n = Integer.MIN_VALUE; n &lt; Integer.MAX_VALUE; n++) al.trimToSize();</p>		</dd>
							<dt id="c501" class="  ">
			<a href="#c501" class="comment-number">2.</a>
			Le jeudi 29 juillet 2010, 09:20			par <a href="http://www.diakogiannis.com" rel="nofollow">Alexius Diakogiannis</a>		</dt>      
		<dd class="  ">
			<p>Ok I thing I got it<br />
@@<br />
//First of all lets put stuff in a new Iterator so we can work with<br />
Iterator newIter  = list.iterator();<br />
//Take the Hello String and remove it<br />
newIter.next();<br />
newIter.remove();<br />
//Print the world String<br />
System.out.println(newIter.next().toString());<br />
//Stop the iterator from continuing<br />
while(iterator.hasNext())<br />
@@</p>		</dd>
							<dt id="c502" class=" odd ">
			<a href="#c502" class="comment-number">3.</a>
			Le jeudi 29 juillet 2010, 09:47			par <a href="http://thecodersbreakfast.net" rel="nofollow">Olivier Croisier</a>		</dt>      
		<dd class=" odd ">
			<p>@Alexius : Interesting solution, though not the one I expected.<br />
Now try again, but using only the existing iterator.</p>		</dd>
							<dt id="c503" class="  ">
			<a href="#c503" class="comment-number">4.</a>
			Le jeudi 29 juillet 2010, 10:52			par <a href="http://jnegre.org/" rel="nofollow">Jérôme</a>		</dt>      
		<dd class="  ">
			<p>Bon, je suis sûr que ce n'est pas ce que tu as en tête, je n'utilise ni la liste ni l'iterator, mais même le chef de projet qui a codé pour la dernière fois en VB 1.0 devrait comprendre :</p>



<p><em><code>System.out.println("World"); if(false)</code></em></p>



<p>En plus, les perfs sont bonnes :)</p>		</dd>
							<dt id="c504" class=" odd ">
			<a href="#c504" class="comment-number">5.</a>
			Le jeudi 29 juillet 2010, 11:00			par <a href="http://www.diakogiannis.com" rel="nofollow">Alexius Diakogiannis</a>		</dt>      
		<dd class=" odd ">
			<p>@Jerome LoL I love it!!!!!<br />
@Olivier<br />
How about this?</p>


<p>list.remove("Hello");<br />
System.out.println(list.get(0));<br />
while(iterator.hasNext())</p>		</dd>
							<dt id="c505" class="  ">
			<a href="#c505" class="comment-number">6.</a>
			Le jeudi 29 juillet 2010, 12:04			par <a href="http://www.hikage.be" rel="nofollow">Hikage</a>		</dt>      
		<dd class="  ">
			<p>Bon, vu que notre CP n'est surement pas adapte de l'optimisation, ce code lui permet de faire le travail et de prendre un bon café  :</p>



<p>final Iterator&lt;String&gt; iterator = list.iterator();</p>

<pre></pre>

<p>System.out.println(iterator.next());<br />
list.add("World");</p>


<p>/* FIX */<br />
((ArrayList)list).trimToSize();</p>

<pre></pre>

<p>for( int j = 0 ;j&lt; Integer.MAX_VALUE   ; j++){<br />
((ArrayList)list).trimToSize();<br />
((ArrayList)list).trimToSize();<br />
}<br />
/* END FIX */</p>


<p>System.out.println(iterator.next());</p>		</dd>
							<dt id="c506" class=" odd ">
			<a href="#c506" class="comment-number">7.</a>
			Le jeudi 29 juillet 2010, 12:05			par <a href="http://jnegre.org/" rel="nofollow">Jérôme</a>		</dt>      
		<dd class=" odd ">
			<p>Another solution, highly dependent on the internals of ArrayList. An integer overflow is used to "reset" the internal modification counter.</p>


<p><em><code>for(int i=0;i!=-1;i++) ((ArrayList)list).ensureCapacity(0);</code></em></p>


<p>It takes around 30 seconds on my computer to run, I hope this code is not called too often.</p>		</dd>
							<dt id="c507" class="  ">
			<a href="#c507" class="comment-number">8.</a>
			Le jeudi 29 juillet 2010, 12:06			par Ptitourson		</dt>      
		<dd class="  ">
			<p>Je fais faire un ptit tour au modCount interne de l'array list histoire qu'il revienne à sa valeur attendue :)</p>


<p>L'exception survient lorsque le modCount de la liste (nombre de modifications de la liste) est différent de l'expectedModCount de l'itérateur (nombre de modifications de la liste à la création de l'itérateur).</p>


<p>Dans notre cas : expectedModCount = 1 et le modCount = 2 (apres l'ajout de "World").</p>


<p>Chaque modification de la liste incrémente le modCount, je l'incrémente donc jusqu'à ce qu'il revienne sur sa valeur initiale (=1) en appelant la méthode trimToSize(), qui ne consomme presque rien en CPU, autant de fois que nécessaire :</p>


<p>// FIXME : insert some magic code here<br />
ArrayList&lt;String&gt; list2 = (ArrayList&lt;String&gt;) list;<br />
for (int i = Integer.MIN_VALUE; i &lt; Integer.MAX_VALUE; i++) {</p>

<pre> list2.trimToSize(); // modCount incremented</pre>

<p>}<br />
// modCount back to 1!</p>		</dd>
							<dt id="c508" class=" odd ">
			<a href="#c508" class="comment-number">9.</a>
			Le jeudi 29 juillet 2010, 12:10			par <a href="http://jnegre.org/" rel="nofollow">Jérôme</a>		</dt>      
		<dd class=" odd ">
			<p>Wahou, 3 fois la même solution en 3 minutes...</p>		</dd>
							<dt id="c509" class="  ">
			<a href="#c509" class="comment-number">10.</a>
			Le jeudi 29 juillet 2010, 12:47			par <a href="http://thecodersbreakfast.net" rel="nofollow">Olivier Croisier</a>		</dt>      
		<dd class="  ">
			<p>Bon les gars, ça va pas du tout, vous êtes trop forts, les quizz tiennent de moins en moins longtemps !<br />
(Mention spéciale pour Mathieu qui a répondu à 3h du mat' :)</p>		</dd>
							<dt id="c510" class=" odd ">
			<a href="#c510" class="comment-number">11.</a>
			Le jeudi 29 juillet 2010, 12:54			par <a href="http://jnegre.org/" rel="nofollow">Jérôme</a>		</dt>      
		<dd class=" odd ">
			<p>Ça, en postant tes quiz à 1 heure du matin aussi, ça favorise pas les masses laborieuses qui se lèvent tôt pour aller travailler en France ;)</p>		</dd>
							<dt id="c511" class="  ">
			<a href="#c511" class="comment-number">12.</a>
			Le jeudi 29 juillet 2010, 23:38			par <a href="http://blog.mycila.com/" rel="nofollow">Mathieu</a>		</dt>      
		<dd class="  ">
			<p>Non ca favorise ceux qui sont à Montréal (Canada) ;-)</p>		</dd>
							<dt id="c512" class=" odd ">
			<a href="#c512" class="comment-number">13.</a>
			Le vendredi 30 juillet 2010, 08:15			par <a href="http://www.zenika.gr" rel="nofollow">Alexius Diakogiannis</a>		</dt>      
		<dd class=" odd ">
			<p>Hi mate,<br />
I think you blog has a bug regarding the timestamp!<br />
I was the fisrt to answer (and as a metter of fact twice) but suddenly I have the seccond entry! :P</p>


<p>Maybe next time you should think of making a Blog in JAVA and not in php! :)</p>


<p>Would you like your Greek affiliates to host it for you?</p>


<p>ps When you will be visiting Greece to stop by from Zenika Hellas offices?</p>


<p>cheers!</p>		</dd>
							<dt id="c513" class="  ">
			<a href="#c513" class="comment-number">14.</a>
			Le vendredi 30 juillet 2010, 10:48			par <a href="http://thecodersbreakfast.net" rel="nofollow">Olivier Croisier</a>		</dt>      
		<dd class="  ">
			<p>@Alexius : this is not a bug :)<br />
Mathieu answered just a couple hours after I published the quiz, so I hid it to keep you guys searching by yourselves. When I saw everyone got it right, I just displayed Mathieu's comment again.</p>		</dd>
							<dt id="c514" class=" odd ">
			<a href="#c514" class="comment-number">15.</a>
			Le vendredi 30 juillet 2010, 16:43			par Yogesh Sinha		</dt>      
		<dd class=" odd ">
			<p>long tt = 2147483647L + 2147483647L + 1;<br />
for(long i=0; i&lt;tt; i++) {</p>

<pre> list.add("");</pre>

<p>}</p>


<p>This would make the modCount variable in AbstractList equal to 1. calling iterator.next() would not satisfy the condition for checkForComodification() function and "World" would be printed.<br />
I could not test it as I don't have enough memory to allocate to JVM.</p>		</dd>
							<dt id="c515" class="  ">
			<a href="#c515" class="comment-number">16.</a>
			Le vendredi 30 juillet 2010, 17:34			par da.futt		</dt>      
		<dd class="  ">
			<p>The trouble with all the solutions involving the modCount field is that they violate the third requirement, to wit, that the bugger is supposed to understand it. How on earth would he be able to, if doesn't know the contract of java.util.Iterator and thinks a ConcurrentModificationException is a JVM bug?</p>


<p>Jérôme's first solution (#4) is the only correct one posted so far, per requirements.</p>		</dd>
							<dt id="c516" class=" odd ">
			<a href="#c516" class="comment-number">17.</a>
			Le vendredi 30 juillet 2010, 17:39			par finnw		</dt>      
		<dd class=" odd ">
			<p>@Alexius, I think your version can still throw a ConcurrentModificationException from iterator.hasNext() (it might be implementation-dependent)</p>		</dd>
							<dt id="c517" class="  ">
			<a href="#c517" class="comment-number">18.</a>
			Le vendredi 30 juillet 2010, 17:40			par dd		</dt>      
		<dd class="  ">
			<p>// FIXME : work here while I'm sunbathing<br />
iterator = list.iterator();<br />
iterator.next();<br />
System.err.println(iterator.next());</p>		</dd>
							<dt id="c518" class=" odd ">
			<a href="#c518" class="comment-number">19.</a>
			Le vendredi 30 juillet 2010, 18:28			par lapsus63		</dt>      
		<dd class=" odd ">
			<p>Pareil que dd, j'aurais simplement dit :<br />
(iterator = list.iterator()).next();</p>		</dd>
							<dt id="c519" class="  ">
			<a href="#c519" class="comment-number">20.</a>
			Le vendredi 30 juillet 2010, 18:44			par tori		</dt>      
		<dd class="  ">
			<p>Hi,<br />
very nice riddle - but which answer does the author meant?</p>		</dd>
							<dt id="c520" class=" odd ">
			<a href="#c520" class="comment-number">21.</a>
			Le vendredi 30 juillet 2010, 19:00			par <a href="http://thecodersbreakfast.net" rel="nofollow">Olivier Croisier</a>		</dt>      
		<dd class=" odd ">
			<p>@dd &amp; @lapsus63 : the iterator variable is declared "final", so your code wouldn't compile.<br />
@Yogesh Sinha : you could alternatively add and remove items in the list, instead of keeping adding only ; this would eliminate the memory consumption issue, and still increment the modcount.</p>		</dd>
							<dt id="c521" class="  ">
			<a href="#c521" class="comment-number">22.</a>
			Le vendredi 30 juillet 2010, 19:21			par vimil		</dt>      
		<dd class="  ">
			<p>final List&lt;String&gt; list = new ArrayList() <q> add("Hello"); </q>;<br />
final Iterator&lt;String&gt; iterator = list.iterator();<br />
System.out.println(iterator.next());<br />
list.add("World");<br />
System.out.println(list.get(1));<br />
if(lis.size(0 ==0)<br />
System.out.println(iterator.next());</p>		</dd>
							<dt id="c522" class=" odd ">
			<a href="#c522" class="comment-number">23.</a>
			Le vendredi 30 juillet 2010, 20:45			par Brad		</dt>      
		<dd class=" odd ">
			<p>Can someone explain why this works.  Is the modCount value changing?  Also I was playing with the loop and noticed:<br />
for (int n = Integer.MIN_VALUE; n &lt; Integer.MAX_VALUE-1; n++) al.trimToSize();<br />
doesn't work but<br />
for (int n = Integer.MIN_VALUE; n &lt; Integer.MAX_VALUE; n++) al.trimToSize();<br />
does.  What is the trick to looping through the complete range of Integer?</p>		</dd>
							<dt id="c523" class="  ">
			<a href="#c523" class="comment-number">24.</a>
			Le vendredi 30 juillet 2010, 21:02			par szafir		</dt>      
		<dd class="  ">
			<p>// Run with -Dline.separator=" " to avoid the line break, but you get an extra space at the end.<br />
// FIXME BEGIN<br />
for (int i = Integer.MIN_VALUE; i &lt; Integer.MAX_VALUE; i++) {<br />
((ArrayList&lt;String&gt;) list).trimToSize();<br />
}<br />
// FIXME END</p>		</dd>
							<dt id="c524" class=" odd ">
			<a href="#c524" class="comment-number">25.</a>
			Le vendredi 30 juillet 2010, 22:14			par Sebastian		</dt>      
		<dd class=" odd ">
			<p>// FIXME : work here while I'm sunbathing<br />
Thread.setDefaultUncaughtExceptionHandler(new UncaughtExceptionHandler(){<br />
<br />
@Override<br />
public void uncaughtException(Thread t, Throwable e) {<br />
}<br />
});<br />
System.out.println("World");</p>		</dd>
							<dt id="c525" class="  ">
			<a href="#c525" class="comment-number">26.</a>
			Le vendredi 30 juillet 2010, 23:35			par Mike		</dt>      
		<dd class="  ">
			<p>System.out.println("World");<br />
System.exit(0);</p>		</dd>
							<dt id="c526" class=" odd ">
			<a href="#c526" class="comment-number">27.</a>
			Le samedi 31 juillet 2010, 11:50			par <a href="http://www.zenika.gr" rel="nofollow">Alexius Diakogiannis</a>		</dt>      
		<dd class=" odd ">
			<p>@finnw<br />
No it will not mate because it does not actually move the pointer but just checks if it can be moved :)<br />
@Brad<br />
Yes I would like to know why too! :)</p>		</dd>
							<dt id="c527" class="  ">
			<a href="#c527" class="comment-number">28.</a>
			Le samedi 31 juillet 2010, 19:25			par <a href="http://vizierspalace.blogspot.com" rel="nofollow">vizier</a>		</dt>      
		<dd class="  ">
			<p>The trick is to overflow the modCount variable, so that ConcurrentModificationException is not thrown.</p>


<p>modCount is incremented in each modifying method of ArrayList (add, addAll, clear, etc.), and checked in the methods of the Iterator implementations ( next(), etc.). So by overflowing and in a sense restarting the modCount, we can make sure that modCount is the same as before even after we call add() on the list.</p>


<p>@Brad<br />
In adition to the above explanation, let me give another example. If we need to add two strings to the list (instead of one), we would loop one less, in order to satisfy the equality in that case. I guess this clarifies the case.</p>		</dd>
							<dt id="c528" class=" odd ">
			<a href="#c528" class="comment-number">29.</a>
			Le samedi 31 juillet 2010, 23:19			par Gary		</dt>      
		<dd class=" odd ">
			<p>Interesting problem.   I had a go, and came up with this - it's very hacky, but takes less time to complete!</p>


<p>// FIXME : work here while I'm sunbathing<br />
try {<br />
System.out.println(iterator.next());<br />
} catch (ConcurrentModificationException cme) {<br />
System.out.println(list.get(1));<br />
}</p>		</dd>
							<dt id="c529" class="  ">
			<a href="#c529" class="comment-number">30.</a>
			Le samedi 31 juillet 2010, 23:50			par Gary		</dt>      
		<dd class="  ">
			<p>Interesting problem.   I had a go, and came up with this - it's very hacky, but takes less time to complete!</p>


<p>try {<br />
System.out.println(iterator.next());<br />
} catch (ConcurrentModificationException cme) {<br />
System.out.println(list.get(1));<br />
}</p>		</dd>
							<dt id="c530" class=" odd ">
			<a href="#c530" class="comment-number">31.</a>
			Le dimanche  1 août 2010, 05:33			par Bala		</dt>      
		<dd class=" odd ">
			<p>// FIXME : work here while I'm sunbathing</p>


<p>System.out.println(list.listIterator(1).next());</p>		</dd>
							<dt id="c531" class="  ">
			<a href="#c531" class="comment-number">32.</a>
			Le dimanche  1 août 2010, 06:14			par Kishore Senji		</dt>      
		<dd class="  ">
			<p>I know the following is not the correct answer. However just for fun.</p>


<p>// FIXME : insert some magic code here<br />
Thread.currentThread().setUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {<br />
public void uncaughtException(Thread t, Throwable e) {<br />
if(e instanceof ConcurrentModificationException) {<br />
System.out.println(list.get(1));<br />
}<br />
}<br />
});</p>		</dd>
							<dt id="c532" class=" odd ">
			<a href="#c532" class="comment-number">33.</a>
			Le dimanche  1 août 2010, 20:20			par Al		</dt>      
		<dd class=" odd ">
			<p>System.out.println(list.get(1));<br />
<br />
if (1 == 0)</p>		</dd>
							<dt id="c533" class="  ">
			<a href="#c533" class="comment-number">34.</a>
			Le lundi  2 août 2010, 01:00			par Planet Coke		</dt>      
		<dd class="  ">
			<p>Try these lines:</p>


<p>@@</p>

<pre>       Iterator&lt;String&gt; iterator2 = list.iterator();
       iterator2.next();
       _invoke(iterator2);
   }
   private static void _invoke(Iterator iterator ) {</pre>

<p>@@</p>		</dd>
							<dt id="c534" class=" odd ">
			<a href="#c534" class="comment-number">35.</a>
			Le lundi  2 août 2010, 22:12			par Pavlov		</dt>      
		<dd class=" odd ">
			<p>Interesting ideas! Maybe the easiest way is simply:</p>


<p>iterator = list.listIterator(1);</p>		</dd>
							<dt id="c535" class="  ">
			<a href="#c535" class="comment-number">36.</a>
			Le lundi  2 août 2010, 23:28			par Planet Coke		</dt>      
		<dd class="  ">
			<p>keep in mind, that the iterator reference was declared final.</p>		</dd>
							<dt id="c536" class=" odd ">
			<a href="#c536" class="comment-number">37.</a>
			Le mardi  3 août 2010, 07:18			par Raveesha Joshi		</dt>      
		<dd class=" odd ">
			<p>// FIXME : work here while I'm sunbathing<br />
list.remove(0);<br />
System.out.println(list.iterator().next());</p>		</dd>
							<dt id="c537" class="  ">
			<a href="#c537" class="comment-number">38.</a>
			Le mardi  3 août 2010, 09:54			par <a href="http://thecodersbreakfast.net" rel="nofollow">Olivier Croisier</a>		</dt>      
		<dd class="  ">
			<p>Many interesting ideas here, but also many wrong answers.<br />
Keep in mind that :<br />
- the iterator is declared final, so you cannot do <code>iterator = list.iterator();</code><br />
- this is only a code fragment, so you cannot use <code>System.exit(0)</code> or return; you wouldn't like your application to terminate prematurely.<br />
- since you cannot modify the existing code, you cannot delete or ignore the last line, which performs <code>iterator.next()</code> and therefore triggers a <code>ConcurrentModificationException</code></p>


<p>Have fun :)</p>		</dd>
							<dt id="c538" class=" odd ">
			<a href="#c538" class="comment-number">39.</a>
			Le mardi  3 août 2010, 10:24			par Abbas		</dt>      
		<dd class=" odd ">
			<p>public static void main(String<a href="" rel="nofollow"></a> args) {<br />
final List&lt;String&gt; list = new ArrayList&lt;String&gt;() <q> add("Hello"); </q>;</p>


<p>final Iterator&lt;String&gt; iterator = list.iterator();<br />
System.out.println(iterator.next());<br />
list.add("World");<br />
System.out.println(list.get(list.size()-1));}} class TheLinesFollowsThisCalssIsNotUsed{{Iterator iterator = null;<br />
System.out.println(iterator.next());</p>


<p>}</p>		</dd>
							<dt id="c539" class="  ">
			<a href="#c539" class="comment-number">40.</a>
			Le mardi  3 août 2010, 10:26			par Abbas		</dt>      
		<dd class="  ">
			<p><code></code><br />
final List&lt;String&gt; list = new ArrayList&lt;String&gt;() <q> add("Hello"); </q>;</p>


<p>final Iterator&lt;String&gt; iterator = list.iterator();<br />
System.out.println(iterator.next());<br />
list.add("World");<br />
System.out.println(list.get(list.size()-1));}} class TheLinesFollowsThisCalssIsNotUsed{{Iterator iterator = null;<br />
System.out.println(iterator.next());<br />
<code></code></p>		</dd>
							<dt id="c540" class=" odd ">
			<a href="#c540" class="comment-number">41.</a>
			Le mardi  3 août 2010, 10:31			par zazzo		</dt>      
		<dd class=" odd ">
			<p>...</p>


<p>// FIXME : work here while I'm sunbathing</p>


<p>new Runnable(){<br />
public void run(){<br />
try {<br />
Field f = iterator.getClass().getDeclaredField("expectedModCount");<br />
f.setAccessible(true);<br />
f.setInt(iterator, 2);<br />
} catch (Exception e) {<br />
// TODO Auto-generated catch block<br />
e.printStackTrace();<br />
}<br />
}<br />
}.run();</p>


<p>// FIXME : work here while I'm sunbathing<br />
System.out.println(iterator.next());</p>		</dd>
							<dt id="c541" class="  ">
			<a href="#c541" class="comment-number">42.</a>
			Le mardi  3 août 2010, 11:10			par <a href="http://techblog.bozho.net" rel="nofollow">Bozho</a>		</dt>      
		<dd class="  ">
			<p>ArrayList&lt;String&gt; list2 = (ArrayList&lt;String&gt;) list;<br />
for (long i = 0; i &lt; Integer.MAX_VALUE * 2l + 1; i ++) {</p>

<pre>      list2.trimToSize();</pre>

<p>}</p>		</dd>
							<dt id="c542" class=" odd ">
			<a href="#c542" class="comment-number">43.</a>
			Le mardi  3 août 2010, 13:20			par zazzo		</dt>      
		<dd class=" odd ">
			<p>ehm... sorry... i haven't read the third condition line :-(</p>		</dd>
							<dt id="c543" class="  ">
			<a href="#c543" class="comment-number">44.</a>
			Le mardi  3 août 2010, 16:25			par Michael		</dt>      
		<dd class="  ">
			<p>Easy and simple:</p>


<p>final List&lt;String&gt; list = new ArrayList() <q> add("Hello"); </q>;<br />
final Iterator&lt;String&gt; iterator = list.iterator();<br />
System.out.println(iterator.next());<br />
list.add("World");<br />
System.out.println("World");<br />
if (0)<br />
System.out.println(iterator.next());</p>		</dd>
							<dt id="c544" class=" odd ">
			<a href="#c544" class="comment-number">45.</a>
			Le mardi  3 août 2010, 21:22			par Steen		</dt>      
		<dd class=" odd ">
			<p>Sorry for the verbosity. Please delete this post if it is deemed unsuitably long:<br />
&lt;code&gt;<br />
import java.util.List;<br />
import java.util.ArrayList;<br />
import java.util.Iterator;</p>


<p>/*</p>

<pre>* 
* Warnings produced when compiling this class
*
* ManagersHello.java:116: warning: [unchecked] unchecked call to add(E) as a member of the raw type java.util.ArrayList
*       final List&lt;String&gt; list = new ArrayList() {{ add("Hello"); }};
*                                                       ^
* ManagersHello.java:116: warning: [unchecked] unchecked conversion
* found   : &lt;anonymous java.util.ArrayList&gt;
* required: java.util.List&lt;java.lang.String&gt;
*       final List&lt;String&gt; list = new ArrayList() {{ add("Hello"); }};
*                                 ^
*
* When running:
*
* java -cp . ManagersHello
* Hello
* Exception in thread "main" java.util.ConcurrentModificationException
*  at java.util.AbstractList$Itr.checkForComodification(AbstractList.java:372)
*  at java.util.AbstractList$Itr.next(AbstractList.java:343)
*  at ManagersHello.main(ManagersHello.java:146)
* 
* The javadoc for ConcurrentModificationException says:
*
* If a single thread issues a sequence of method invocations that
* violates the contract of an object, the object may throw this
* exception. For example, if a thread modifies a collection directly
* while it is iterating over the collection with a fail-fast iterator,
* the iterator will throw this exception.
*
* The AbstractList class provides the Iterator that is used in the
* ArrayList, and this class has an internal class Itr that uses two
* field to detect whether there has been made 'structural
* modifications' to the subject of the iteration.
*
* The field `int expectedModCount` is initiated to be equal to the
* field `protected transient int modCount = 0;` and modCount keeps
* track of the structural modifications. If modCount at some points
* in the iteration does not equal expectedModCount, a
* ConcurrentModificationException is thrown.
* 
* Such a check is made on most calls on the Iterator, which is
* implemented using the Itr inner class
*
* In the code below, the assertation holds until the second call to
* `iterator.next()` is made, because at that time, the
* expectedModCount is 0, while the modCount of the List is 1.
*
* the call `list.add("World");` will increment the modCount _after_
* the list has been structurally changed. This means that the first
* call to the check method after this statement will throw a
* ConcurrentModificationException.
*
* This window can be used to try to modify the modCount of the list
* instance so that it will again be equal to expectedModCount
* _before_ the iterator.next() method is called. Since modCount is an
* int, an overflow will wrap the value from Integet.MAX_VALUE to
* Integer.MIN_VALUE and therefore it will be possible to reach the
* value of expectedModCount through an integer overflow.
*
* In the ArrayList implementation, which is the instantiated type of
* the field `list` in the code below, xx methods change the variable
* modCount upon invocation:
*
* - public void trimToSize()
* - public void ensureCapacity(int minCapacity)
* - public E remove(int index)
* - public void clear()
*
* trimToSize will increase the modification count by one and then
* check to see if the number of elements in an internal array buffer
* is smaller the number of elements specified in the construction of
* the ArrayList. If this is the case, an invokation of
* `Arrays.copyOf(T[] original, int newLength)` is made.
*
* ensureCapacity will likewise increase the modification count and
* the perform a check on whether the specified minimum capacity is
* larger than the number of elements currently in the ArrayList.
*
* remove will do a range check, increase the modification count and
* remove the element E at the specified index
*
* clear will increase the modification count and then remove
* (nullify) all elements in the ArrayList
*
* Starting from the bottom, neither the clear nor the remove methods
* will work in this scenario, since their structural modification
* will be to remove the very element we wish to print. Using clear()
* will make the second call to iterator.next() fail with a
* NoSuchElementException. Using remove(int) will make the second call
* to ((ArrayList)list).remove(0) fail with an
* IndexOutOfBoundsException, since there is no more elements to
* remove and hence none at index 0.  
* 
* Of course, calling remove(0) for uneven numbers (except
* Integer.MIN_VALUE) and subsequently add( "World" ) (for even
* numbers) will work, as the list will end up on the correct
* modification count _and_ the correct number of elements ( "World" )
* at the end of the for loop.
*
*
* This leaves us with ensureCapacity(int) and trimToSize(), both of
* which will work, because they preserve the elements in the list
*
*/</pre>



<p>public class ManagersHello<br />
{</p>

<pre>   public static void main( String[] args )
   {
       final List&lt;String&gt; list = new ArrayList() {{ add("Hello"); }};
       final Iterator&lt;String&gt; iterator = list.iterator();
       System.out.println(iterator.next());
       list.add("World");
       // FIXME : work here while I'm sunbathing
       newly_inserted_code:
       {
           for( int i=Integer.MIN_VALUE;i&lt;Integer.MAX_VALUE;i++)
           {
               solution_one:
               {
                   // ((ArrayList)list).ensureCapacity(1);
               }
               solution_two:
               {
                   // ((ArrayList)list).trimToSize();
               }
               solution_three:
               {
                   if( ! ( i == Integer.MIN_VALUE ) &amp;&amp; ! ( i%2 == 0 ) )
                   {
                       ((ArrayList)list).remove(0);
                   }
                   if( i%2 == 0 )
                   {
                       ((ArrayList)list).add("World");
                   }
               }
           }
       }
       System.out.println(iterator.next());
   }</pre>

<p>}<br />
&lt;/code&gt;</p>		</dd>
							<dt id="c545" class="  ">
			<a href="#c545" class="comment-number">46.</a>
			Le mardi  3 août 2010, 21:31			par <a href="http://thecodersbreakfast.net" rel="nofollow">Olivier Croisier</a>		</dt>      
		<dd class="  ">
			<p>This must be the most complete solution to one of my quizzes I've ever seen O_O<br />
And it works !<br />
Nice job !</p>		</dd>
							<dt id="c546" class=" odd ">
			<a href="#c546" class="comment-number">47.</a>
			Le mercredi  4 août 2010, 08:23			par <a href="http://www.routelogix.com" rel="nofollow">Fanie Deysel</a>		</dt>      
		<dd class=" odd ">
			<p>@@<br />
// FIXME : work here while I'm sunbathing<br />
try {<br />
Field f = iterator.getClass().getDeclaredField("expectedModCount");<br />
f.setAccessible(true);<br />
f.setInt(iterator, 2);<br />
} catch (Exception e) {}<br />
// FIXME : work here while I'm sunbathing<br />
@@</p>		</dd>
							<dt id="c547" class="  ">
			<a href="#c547" class="comment-number">48.</a>
			Le mercredi  4 août 2010, 08:27			par <a href="http://www.routelogix.com" rel="nofollow">Fanie Deysel</a>		</dt>      
		<dd class="  ">
			<p>@@</p>


<p>// FIXME : work here while I'm sunbathing<br />
try {<br />
Field f = iterator.getClass().getDeclaredField("expectedModCount");<br />
f.setAccessible(true);<br />
f.setInt(iterator, list.size());<br />
} catch (Exception e) {}<br />
// FIXME : work here while I'm sunbathing</p>


<p>@@</p>		</dd>
							<dt id="c548" class=" odd ">
			<a href="#c548" class="comment-number">49.</a>
			Le samedi  4 septembre 2010, 11:50			par Roshan		</dt>      
		<dd class=" odd ">
			<p>Please elaborate more on this statment :<br />
"Since modCount is an int, an overflow will wrap the value from Integet.MAX_VALUE to Integer.MIN_VALUE and therefore it will be possible to reach the value of expectedModCount through an integer overflow. "<br />
How it is working ?</p>		</dd>
					</dl>
			</div>
				

    
	
	
	
	
	<form action="http://thecodersbreakfast.net/index.php?post/2010/07/28/Java-Quiz-40#pr" method="post" id="comment-form">
				  
		<h3>Ajouter un commentaire</h3>
		<fieldset>

			
			<p class="field"><label for="c_name">Nom ou pseudo&nbsp;:</label>
			<input name="c_name" id="c_name" type="text" size="30" maxlength="255"
			value="" />
			</p>

			<p class="field"><label for="c_mail">Adresse email&nbsp;:</label>
			<input name="c_mail" id="c_mail" type="text" size="30" maxlength="255"
			value="" />
			</p>

			<p class="field"><label for="c_site">Site web			(facultatif)&nbsp;:</label>
			<input name="c_site" id="c_site" type="text" size="30" maxlength="255"
			value="" />
			</p>

			<p style="display:none"><input name="f_mail" type="text" size="30"
			maxlength="255" value="" /></p>

			<p class="field"><label for="c_content">Commentaire&nbsp;:</label>
			<textarea name="c_content" id="c_content" cols="35"
			rows="7"></textarea>
			</p>
			<p class="form-help">Le code HTML est affiché comme du texte et les adresses web sont automatiquement transformées.</p>

			<p class='field'><label for='c_answer'>Java, c&#039;est une tasse de... ?</label>
        <input name='c_answer' id='c_answer' type='text' size='30' maxlength='255' value='' />
        <input name='c_question_hash' id='c_question_hash' type='hidden' value='bc23a34a426ade0ca4ded3b43f299ca88fc82726' />
        </p>		</fieldset>
		  
		<fieldset>
			<p class="buttons"><input type="submit" class="preview" name="preview" value="prévisualiser" />
			</p>
		</fieldset>
		
	</form>				
</div>
  			
  		</div>
		<!-- End of page_content -->
 	
 		<!-- 
		================================================================================
										PAGE SIDEBAR
		================================================================================
		-->
 		<div id="page_sidebar">
			<div id="blognav">
	<div id="bigRSS" style="position:relative;">
		<a href="http://feeds2.feedburner.com/TheCodersBreakfast?format=xml">
			<img src="/themes/TheCodersBreakfast2/img/rss.png" alt="S'abonner au flux RSS" title="S'abonner au flux RSS"/>
		</a>
		<a href="http://twitter.com/OlivierCroisier">
			<img src="/themes/TheCodersBreakfast2/img/twitter.png" alt="Suivre OlivierCroisier sur Twitter" title="Suivre Olivier Croisier sur Twitter"/>
		</a>
		<div style="position: relative; top: 5px; margin:0px; padding:0px;">
			<a href="http://feeds2.feedburner.com/TheCodersBreakfast?format=xml"><img src="http://feeds.feedburner.com/~fc/TheCodersBreakfast.net?bg=ff8844&fg=000000"/></a>
			<a href="http://twitter.com/OlivierCroisier"><img alt="Suivre OlivierCroisier sur Twitter" src="http://srv2.twittercounter.com/counter/ani/OlivierCroisier/000000/02ABEE"></a>
		</div>
		<br/>
		<a href="http://twitter.com/OlivierCroisier" class="twitter-follow-button" data-show-count="false">Follow @OlivierCroisier</a><script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
		<br/>
		<a href="http://feedburner.google.com/fb/a/mailverify?uri=TheCodersBreakfast&amp;loc=fr_FR" id="newsletter">+ S'abonner à la newsletter</a>
	</div>
	<div id="search"><h2><label for="q">Rechercher</label></h2><form action="http://thecodersbreakfast.net/index.php?" method="get"><fieldset><p><input type="text" size="10" maxlength="255" id="q" name="q" value="" /> <input type="submit" class="submit" value="ok" /></p></fieldset></form></div><div id="topnav"><ul><li class="topnav-home"><a href="http://thecodersbreakfast.net/index.php?">Accueil</a><span> - </span></li><li class="topnav-arch"><a href="http://thecodersbreakfast.net/index.php?archive">Archives</a></li></ul></div><div class="categories"><h2>Catégories</h2><ul><li><a href="http://thecodersbreakfast.net/index.php?category/Java-JEE">Java / JEE</a><ul><li><a href="http://thecodersbreakfast.net/index.php?category/Java/Articles">Articles</a></li><li class="category-current"><a href="http://thecodersbreakfast.net/index.php?category/Java/Quiz">Java Quiz</a></li><li><a href="http://thecodersbreakfast.net/index.php?category/Java/Communaute">Communauté</a></li><li><a href="http://thecodersbreakfast.net/index.php?category/Liens-Externes">Liens externes</a></li></ul></li><li><a href="http://thecodersbreakfast.net/index.php?category/Ergonomie-Webdesign">Ergonomie &amp; Webdesign</a></li><li><a href="http://thecodersbreakfast.net/index.php?category/Autres-langages">Autres langages</a></li><li><a href="http://thecodersbreakfast.net/index.php?category/Divers">Divers</a></li><li><a href="http://thecodersbreakfast.net/index.php?category/Vie-du-blog">Vie du blog</a></li></ul></div><div class="tags"><h2>Tags (top 10)</h2><ul><li><a href="http://thecodersbreakfast.net/index.php?tag/java" class="tag100" rel="tag">java</a> </li><li><a href="http://thecodersbreakfast.net/index.php?tag/communaut%C3%A9" class="tag30" rel="tag">communauté</a> </li><li><a href="http://thecodersbreakfast.net/index.php?tag/spring" class="tag10" rel="tag">spring</a> </li><li><a href="http://thecodersbreakfast.net/index.php?tag/google" class="tag10" rel="tag">google</a> </li><li><a href="http://thecodersbreakfast.net/index.php?tag/internet" class="tag10" rel="tag">internet</a> </li><li><a href="http://thecodersbreakfast.net/index.php?tag/javascript" class="tag10" rel="tag">javascript</a> </li><li><a href="http://thecodersbreakfast.net/index.php?tag/m%C3%A9thodologie" class="tag0" rel="tag">méthodologie</a> </li><li><a href="http://thecodersbreakfast.net/index.php?tag/entreprise" class="tag0" rel="tag">entreprise</a> </li><li><a href="http://thecodersbreakfast.net/index.php?tag/html-css" class="tag0" rel="tag">html-css</a> </li><li><a href="http://thecodersbreakfast.net/index.php?tag/wicket" class="tag0" rel="tag">wicket</a> </li></ul><p><strong><a href="http://thecodersbreakfast.net/index.php?tags">Tous les tags</a></strong></p></div></div>		  
<div id="blogextra">
	<div class="syndicate"><h2>S'abonner</h2><ul><li><a type="application/atom+xml" href="http://thecodersbreakfast.net/index.php?feed/atom" title="Fil Atom des billets de ce blog" class="feed">Fil des billets</a></li><li><a type="application/atom+xml" href="http://thecodersbreakfast.net/index.php?feed/atom/comments" title="Fil Atom des commentaires de ce blog" class="feed">Fil des commentaires</a></li></ul></div><div id="arlequin">
<ul><li><a href="http://thecodersbreakfast.net/index.php?post/2010/07/28/Java-Quiz-40&amp;theme=default">Blowup</a></li><li><a href="http://thecodersbreakfast.net/index.php?post/2010/07/28/Java-Quiz-40&amp;theme=blueSilence">Blue Silence</a></li><li><a href="http://thecodersbreakfast.net/index.php?post/2010/07/28/Java-Quiz-40&amp;theme=ductile">Ductile</a></li><li><strong>TheCodersBreakfast</strong></li></ul></div>
</div>
		</div>
 		<!-- End of page_sidebar -->
 		
 	</div>
 	<!-- End of page_body -->

 	<!-- 
	================================================================================
									PAGE FOOTER
	================================================================================
	-->
	<div id="page_footer">
		Propulsé par <a href="http://dotclear.org/">Dotclear</a> | Icônes <a href="http://www.famfamfam.com/lab/icons/silk/">FamFamFam</a>
<br/><br/>	
<div id="licence">
	<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.
</div>
<br/>
	
	</div>

</div> <!-- End of page -->
</div> <!-- End body -->
<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
	var pageTracker = _gat._getTracker("UA-6716294-1");
	pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>
