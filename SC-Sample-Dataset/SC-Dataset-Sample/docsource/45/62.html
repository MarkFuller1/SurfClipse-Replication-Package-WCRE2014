














<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">














<html>
<head>
    <title>[#GLASSFISH-15421] javax.net.ssl.SSLHandshakeException seen while loading Console after enable-secure-admin in windows. - Java.net JIRA </title>

    <meta content="issuesummary" name="decorator" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    <link rel="shortcut icon" href="/jira/s/472/1/_/favicon.ico">
    <link rel="icon" type="image/png" href="/jira/s/472/1/_/images/icons/favicon.png">
    


	




<link rel="stylesheet" type="text/css" media="print" href="/jira/s/472/1/_/styles/combined-printable.css">
<link type="text/css" rel="StyleSheet" media="all" href="/jira/s/472/1/_/styles/combined.css"/>
<link type="text/css" rel="StyleSheet" media="all" href="/jira/s/472/1/0/_/styles/global.css"/>

    
    <script type="text/javascript">var contextPath = '/jira';</script>
<link type="text/css" rel="stylesheet" href="/jira/s/472/1/1.2.4/_/download/batch/com.atlassian.auiplugin:ajs/com.atlassian.auiplugin:ajs.css" media="all">
<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/jira/s/472/1/1.2.4/_/download/batch/com.atlassian.auiplugin:ajs/com.atlassian.auiplugin:ajs.css?ieonly=true" media="all">
<![endif]-->
<script type="text/javascript" src="/jira/s/472/1/1.2.4/_/download/batch/com.atlassian.auiplugin:ajs/com.atlassian.auiplugin:ajs.js" ></script>
<script type="text/javascript" src="/jira/s/472/1/1.0/_/download/batch/jira.webresources:jira-global/jira.webresources:jira-global.js" ></script>
<link type="text/css" rel="stylesheet" href="/jira/s/472/1/1.0/_/download/batch/jira.webresources:jira-global/jira.webresources:jira-global.css" media="all">
<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/jira/s/472/1/1.0/_/download/batch/jira.webresources:jira-global/jira.webresources:jira-global.css?ieonly=true" media="all">
<![endif]-->
<script type="text/javascript" src="/jira/s/472/1/1.0/_/download/batch/jira.webresources:autocomplete/jira.webresources:autocomplete.js" ></script>
<link type="text/css" rel="stylesheet" href="/jira/s/472/1/1.0/_/download/batch/jira.webresources:autocomplete/jira.webresources:autocomplete.css" media="all">
<link type="text/css" rel="stylesheet" href="/jira/s/472/1/2.3.1/_/download/batch/com.atlassian.jira.plugin.labels:labels-files/com.atlassian.jira.plugin.labels:labels-files.css" media="all">
<script type="text/javascript" src="/jira/s/472/1/2.3.1/_/download/batch/com.atlassian.jira.plugin.labels:labels-files/com.atlassian.jira.plugin.labels:labels-files.js" ></script>
<script type="text/javascript" src="/jira/s/472/1/1.0/_/download/batch/jira.webresources:header/jira.webresources:header.js" ></script>

</head>





















<body id="jira"  >


<div id="header">
    <div id="header-top">
        <a id="logo" href="/jira/secure/Dashboard.jspa">
                        <img class="logo" src="/jira/s/472/1/_/images/jira111x30.png" width="111" height="30" border="0" alt="Java.net JIRA">
                    </a>
                <form id="quicksearch" action="/jira/secure/QuickSearch.jspa" method="post">
            <label for="quickSearchInput" class="overlabel">Quick Search
                <span id="quicksearchhelp" class="informationBox">
                                                 Learn more about <a href='http://docs.atlassian.com/jira/docs-040/Using+Quick+Search?clicked=jirahelp' target='_jirahelp'>Quick Search</a>
                </span>
            </label>
            <input id="quickSearchInput" class="quickSearchInput" title="Go directly to an issue by typing a valid issue key, or run a free-text search." type="text" size="25" name="searchString" accessKey="q"  valign="absmiddle" />
        </form>
                
        <div id="header-details-user" class="aui-dd-parent header-link-container">
         <a class="lnk" rel="nofollow" href="https://java.net/people/login?original_uri=https%3A%2F%2Fjava.net%2Fjira%2Fbrowse%2FGLASSFISH-15421">Log In</a>
        <span class="drop-wrap">
        <a class="drop aui-dd-link"
                        href="#"><span>Access more options</span>
        </a>
    </span>
    <div class="aui-dropdown standard hidden">
                                                                <ul id="jira-help" class="  first     last  ">
                                            <li><a  id="view_help"   class=""  title="Goto the online documentation for JIRA" href="http://docs.atlassian.com/jira/docs-040/Home?clicked=jirahelp">Online Help</a></li>
                                            <li><a  id="user_history"   class=""  title="Get more information about JIRA" href="http://www.atlassian.com/software/jira">About JIRA</a></li>
                                    </ul>
                        </div>
</div>
        
    </div>
    <div id="header-bottom">
                <div id="menu">
            
            
<ul id="main-nav" class="menu-bar">
                        <li class="aui-dd-parent lazy  ">
                    <a class="lnk"
                href="/jira/secure/Dashboard.jspa"
                 id="home_link"                 accessKey="h"                 title="View your current Dashboard"                >Dashboards</a>

                    <span class="drop-wrap">
            <a class="drop aui-dd-link"
                                    id="home_link_drop"
                    rel="home_link"
                    accessKey="d"
                    title="Access more options (Alt+D)"
                                href="#"><span>Access more options (Alt+D)</span></a></span>
            <div class="aui-dropdown standard hidden"></div>
                </li>
                        <li class="aui-dd-parent lazy  ">
                    <a class="lnk"
                href="/jira/browse/GLASSFISH"
                 id="browse_link"                 accessKey="b"                 title="Browse currently active project 'glassfish'"                >Projects</a>

                    <span class="drop-wrap">
            <a class="drop aui-dd-link"
                                    id="browse_link_drop"
                    rel="browse_link"
                    accessKey="p"
                    title="Access more options (Alt+P)"
                                href="#"><span>Access more options (Alt+P)</span></a></span>
            <div class="aui-dropdown standard hidden"></div>
                </li>
                        <li class="aui-dd-parent lazy  selected  ">
                    <a class="lnk"
                href="/jira/secure/IssueNavigator.jspa"
                 id="find_link"                 accessKey="f"                 title="View your current filter"                >Issues</a>

                    <span class="drop-wrap">
            <a class="drop aui-dd-link"
                                    id="find_link_drop"
                    rel="find_link"
                    accessKey="i"
                    title="Access more options (Alt+I)"
                                href="#"><span>Access more options (Alt+I)</span></a></span>
            <div class="aui-dropdown standard hidden"></div>
                </li>
                        <li class="aui-dd-parent nonlazy  ">
                    <a class="lnk"
                href="/jira/secure/GreenHopper.jspa"
                 id="greenhopper_menu"                                 title="Manage your project with GreenHopper"                >Agile</a>

                                                                                                            <span class="drop-wrap">
                            <a class="drop aui-dd-link"
                                                                    id="greenhopper_menu_drop"
                                    accessKey="g"
                                    rel="greenhopper_menu"
                                    title="Access more options (Alt+G)"
                                                                href="#"><span>Access more options</span></a></span>
                            <div class="aui-dropdown standard hidden"><div>
                                                                        <ul id="greenhopper_menu_dropdown" class=" first   last  ">
                                                            <li class="dropdown-item"><a
                                     id="planningboard-mlink"                                     class="    "
                                                                                                            href="/jira/secure/VersionBoard.jspa">Planning Board</a></li>
                                                            <li class="dropdown-item"><a
                                     id="taskboard-mlink"                                     class="    "
                                                                                                            href="/jira/secure/TaskBoard.jspa">Task Board</a></li>
                                                            <li class="dropdown-item"><a
                                     id="chartboard-mlink"                                     class="    "
                                                                                                            href="/jira/secure/ChartBoard.jspa">Chart Board</a></li>
                                                            <li class="dropdown-item"><a
                                     id="releasedboard-mlink"                                     class="    "
                                                                                                            href="/jira/secure/ArchiveChartBoard.jspa">Released Board</a></li>
                                                    </ul>
                                                                        </div></div>
                                            </li>
    </ul>

            
        </div>

    </div>
</div>



<fieldset class="hidden parameters">
    <input type="hidden" id="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost.">
</fieldset>

<!--This should always be included as it is not part of a themable plugin, instead it is core functionality-->






<table cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td width="200" bgcolor="#f0f0f0" valign="top" style="border-right:1px solid #bbb">
            <table cellpadding="0" cellspacing="0" border="0" width="200">
<tr><td>
        <table cellpadding="3" cellspacing="0" border="0" width="100%">
    <tr><td bgcolor="#dddddd">
        <span style="float:left"><b>Issue Details</b></span>
        <span class="small" style="float:right">
                                        (<a rel="nofollow" class="small" href="/jira/si/jira.issueviews:issue-xml/GLASSFISH-15421/GLASSFISH-15421.xml">XML</a> | <a rel="nofollow" class="small" href="/jira/si/jira.issueviews:issue-word/GLASSFISH-15421/GLASSFISH-15421.doc">Word</a> | <a rel="nofollow" class="small" href="/jira/si/jira.issueviews:issue-html/GLASSFISH-15421/GLASSFISH-15421.html">Printable</a>)
                    </span>
    </td></tr>
    </table>
                        <img src="/jira/images/bluepixel.gif" width="100%" height="1" border="0" alt=""><br>
                <table id="issuedetails" cellpadding="3" cellspacing="0" border="0">
            <tr>
                <td valign="top"><b>Key:</b></td>
                <td valign="top">
                    <b><a id="issue_key_GLASSFISH-15421" href="/jira/browse/GLASSFISH-15421">GLASSFISH-15421</a></b>
                </td>
            </tr>

            <tr>
                <td valign="top"><b>Type:</b></td>
                <td valign="top">
                                                                <img src="/jira/images/icons/bug.gif" height="16" width="16" border="0" align="absmiddle" alt="Bug" title="Bug - A problem which impairs or prevents the functions of the product.">
             Bug
                </td>
            </tr>

            <tr>
                <td valign="top"><b>Status:</b></td>
                <td valign="top">
                                                                <img src="/jira/images/icons/status_closed.gif" height="16" width="16" border="0" align="absmiddle" alt="Closed" title="Closed - The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">
             Closed
                </td>
            </tr>

                        <tr>
                <td valign="top"><b>Resolution:</b></td>
                <td valign="top">
                                             Fixed
                </td>
            </tr>
            
                        <tr>
                <td valign="top"><b>Priority:</b></td>
                <td valign="top">
                                                                <img src="/jira/images/icons/priority_critical.gif" height="16" width="16" border="0" align="absmiddle" alt="Critical" title="Critical - Crashes, loss of data, severe memory leak.">
             Critical
                </td>
            </tr>
            

                        <tr>
                <td valign="top"><b>Assignee:</b></td>
                <td valign="top">
                            <a id="issue_summary_assignee_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a>
                </td>
            </tr>
            
                        <tr>
                <td valign="top"><b>Reporter:</b></td>
                <td valign="top">
                            <a id="issue_summary_reporter_shaline" href="/jira/secure/ViewProfile.jspa?name=shaline">shaline</a>
                </td>
            </tr>
            
                        <tr>
                <td valign="top"><b>Votes:</b></td>
                <td valign="top">
                                                                        0
                                                            </td>
            </tr>
            
                        <tr>
                <td valign="top"><b>Watchers:</b></td>
                <td valign="top">
                                                                                    0
                                    </td>
            </tr>
                    </table>
        
        
                <div class="operations">
        <table cellpadding="3" cellspacing="0" border="0" width="100%">
        <tr><td bgcolor="#dddddd">
            <b>Operations</b>
        </td></tr>
        </table>
        <img src="/jira/images/bluepixel.gif" width="100%" height="1" border="0" alt=""><br>
        <table cellpadding="3" cellspacing="0" border="0" id="operationsSection">
                    <tr><td class="issueOperation lazyOperation">
                If you were <a class="lnk" rel="nofollow" href="https://java.net/people/login?original_uri=https%3A%2F%2Fjava.net%2Fjira%2Fbrowse%2FGLASSFISH-15421">logged in</a> you would be able to see more operations.
            </td></tr>
                </table>
        </div>
            </td></tr>
</table>
        </td>
        <td bgcolor="#ffffff" valign="top">
            <div style="padding:1em" id="issueContent">
                <style type="text/css">
<!--
.fieldArea .fieldLabelArea { width: 10%; }
.fieldArea .fieldValueArea { width: 90%; }
#pinCommentContainer { float: right; font-size: 10px; }
#pinCommentContainer a { margin: 0 0.2em; }
-->
</style>














<table cellpadding="1" cellspacing="0" border="0" bgcolor="#bbbbbb" width="100%" align="center">
<tr><td width="100%" colspan="2" valign="top">
<table id="issue_header" cellpadding="4" cellspacing="0" border="0" width="100%" bgcolor="#ffffff">
<tr>
    <td bgcolor="#f0f0f0" width="100%" colspan="2" valign="top">
    <table id="issue_header_summary" width="100%" cellpadding="0" cellspacing="0">
        <tr><td bgcolor="#f0f0f0" width="80%" valign="top">
            <b><a href="/jira/browse/GLASSFISH">
                glassfish</a></b><br>

            

            <h3 class="formtitle"><img src="/jira/images/icons/link_out_bot.gif" width="16" height="16"
                              border="0" alt="" /> javax.net.ssl.SSLHandshakeException seen while loading Console after enable-secure-admin in windows.</h3>
            <font size="1">
                Created: <span class="date">03/Jan/11 07:47 PM</span> &nbsp;
                Updated: <span class="date">21/Feb/11 03:47 PM</span>

                
                    
                
                
                    &nbsp; Resolved: <span class="date">11/Jan/11 09:37 PM</span>
                
            </font>
        </td>
            
            
        </tr></table>
</tr>


    
        <tr>
            <td width="20%"><b>Component/s:</b></td>
            <td width="80%">
                
                    


    
        <a href="/jira/browse/GLASSFISH/component/10588" title="admin_gui Management console">admin_gui</a>
    



                
            </td>
        </tr>
    

    
        <tr>
            <td width="20%"><b>Affects Version/s:</b></td>
            <td width="80%">
                
                    


    
        3.1_b33
    



                
            </td>
        </tr>
    

    
        <tr>
            <td width="20%"><b>Fix Version/s:</b></td>
            <td width="80%">
                
                    


    
        <a href="/jira/browse/GLASSFISH/fixforversion/12251" title="3.1_b38 SVN Rev: 44543">3.1_b38</a>
    



                
            </td>
        </tr>
    
    
        
        
            
        
    

</table>
</td></tr></table>




    
        


<br/>
<table width="100%" cellpadding="0" cellspacing="0">
    <tr>
        <td>
            <table cellpadding="4" cellspacing="1" class="tt_outer">
                <tr>
                    <td id="tt_heading" class="tt_heading" style="line-height:150%;">
                        Time Tracking:
                        
                    </td>
                    <td class="tt_infoarea">
                        
                        
                            


<table id="tt_single_table_info" class="tt_inner">
    
        <tr>
            <td>
                Not Specified
            </td>
        </tr>
    
    
</table>


                        
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>



    
    
        <br>
        <table cellpadding="0" cellspacing="0" border="0" bgcolor="#bbbbbb" WIDTH="100%" align="center"><tr><td>
        <table cellpadding="4" cellspacing="1" border="0" width="100%" bgcolor="#bbbbbb" id="issueDetailsTable">

        






	<tr>
		<td bgcolor="#f0f0f0" width="20%" valign="top">
            
            
                <b>File Attachments:</b>
            
        </td>
		<td id="file_attachments" bgcolor="#ffffff" valign="top">
			
                
                
                    
                    
                    1.
    					<a href="/jira/secure/attachment/27507/AdminConsoleAuthModule.java"><img src="/jira/images/icons/attach/java.gif" height=16 width=16 border=0 vspace=1 align=absmiddle alt="Java Source File">
</a>
	    				<a href="/jira/secure/attachment/27507/AdminConsoleAuthModule.java" title="Latest 07/Jan/11 04:36 PM - Anissa Lam">AdminConsoleAuthModule.java</a> <font size="-2">(12 kB) <span style="color:#999999"> 07/Jan/11 04:36 PM - Anissa Lam</span></font><br/>
                    
				
                    
                    
                    2.
    					<a href="/jira/secure/attachment/27508/RestUtil.java"><img src="/jira/images/icons/attach/java.gif" height=16 width=16 border=0 vspace=1 align=absmiddle alt="Java Source File">
</a>
	    				<a href="/jira/secure/attachment/27508/RestUtil.java" title="Latest 07/Jan/11 04:36 PM - Anissa Lam">RestUtil.java</a> <font size="-2">(32 kB) <span style="color:#999999"> 07/Jan/11 04:36 PM - Anissa Lam</span></font><br/>
                    
				
                    
                    
                    3.
    					<a href="/jira/secure/attachment/26115/server.log"><img src="/jira/images/icons/attach/text.gif" height=16 width=16 border=0 vspace=1 align=absmiddle alt="Text File">
</a>
	    				<a href="/jira/secure/attachment/26115/server.log" title="Latest 03/Jan/11 07:49 PM - shaline">server.log</a> <font size="-2">(34 kB) <span style="color:#999999"> 03/Jan/11 07:49 PM - shaline</span></font><br/>
                    
				
				<br/>
			
			

		</td>
	</tr>

    

    



        
            <tr>

                <td bgcolor="#f0f0f0" width="20%" valign="top">
                    <b>Environment:</b>
                </td>
                <td id="environment_field" bgcolor="#ffffff" valign="top">
                                  <div id="environment-open">
            <div style="float:right;">
                <a id="environment-hide" href="" onClick="toggleDivsWithCookie('environment-closed', 'environment-open'); return false;" class="smallgrey">&laquo; Hide</a>
            </div>
            <div>
                <p>OS: windows XP, and Windows 2008.<br/>
Browsers : IE 7, and firefox 3.6</p>
            </div>
        </div>
        <div id="environment-closed" style="display: none;">
            <div style="float:right;">
                <a id="environment-show" href="" onClick="toggleDivsWithCookie('environment-open', 'environment-closed'); return false;" class="smallgrey">Show &raquo;</a>
            </div>
            <div style="height: 1.2em; overflow: hidden;">
                                    OS: windows XP, and Windows 2008.
Browsers : IE 7, and firefox 3.6
                            </div>
        </div>
        <script language="JavaScript" type="text/javascript">
        <!--
            restoreDivFromCookie('environment-open', 'jira.viewissue.cong.cookie', '1');
            restoreDivFromCookie('environment-closed', 'jira.viewissue.cong.cookie', '0');
        //-->
        </script>
      
                </td>
            </tr>
        

        



        




        </table>
        </td></tr></table>
    


<br>







<table id="tab1" class="gridTabBox" cellpadding="3" cellspacing="1" align="center" width="100%">
    
    
        
             
            
                <tr id="rowForcustomfield_10002">
                    <td bgcolor="#f0f0f0" width="20%" valign="top"><b>Tags:</b></td>
                    <td bgcolor="#ffffff" width="80%">
                            <!-- This is separated out here so I can quickly change between debuging where I want scripts and css loaded from the file system
      and runtime when I want it all laoded from the class loaded via jira methos. -->
<!-- Load Via JIRA -->

    <span class="suggestedlabels plugin_label_labels_57944_customfield_10002">  <a href='/jira/secure/IssueNavigator.jspa?reset=true&amp;customfield_10002=3_1-approved'>3_1-approved</a>
  <a href='/jira/secure/IssueNavigator.jspa?reset=true&amp;customfield_10002=3_1-verified'>3_1-verified</a>
</span>
    
                    </td>
                </tr>
            
        
    
        
             
            
                <tr id="rowForcustomfield_10010">
                    <td bgcolor="#f0f0f0" width="20%" valign="top"><b>Participants:</b></td>
                    <td bgcolor="#ffffff" width="80%">
                                    <a class="nowrap" title="Find all issues Anissa Lam participated in" href="/jira/secure/IssueNavigator.jspa?reset=true&customfield_10010=anilam">Anissa Lam</a>,             <a class="nowrap" title="Find all issues kumara participated in" href="/jira/secure/IssueNavigator.jspa?reset=true&customfield_10010=kumara">kumara</a>,             <a class="nowrap" title="Find all issues kumarjayanti participated in" href="/jira/secure/IssueNavigator.jspa?reset=true&customfield_10010=kumarjayanti">kumarjayanti</a>,             <a class="nowrap" title="Find all issues Mitesh Meswani participated in" href="/jira/secure/IssueNavigator.jspa?reset=true&customfield_10010=mm110999">Mitesh Meswani</a>,             <a class="nowrap" title="Find all issues Nazrul participated in" href="/jira/secure/IssueNavigator.jspa?reset=true&customfield_10010=ai109478">Nazrul</a>,             <a class="nowrap" title="Find all issues shaline participated in" href="/jira/secure/IssueNavigator.jspa?reset=true&customfield_10010=shaline">shaline</a> and             <a class="nowrap" title="Find all issues Tim Quinn participated in" href="/jira/secure/IssueNavigator.jspa?reset=true&customfield_10010=tjquinn">Tim Quinn</a>    
                    </td>
                </tr>
            
        
    
</table>



<br>




























<br>

<div id="description-open">
<table cellpadding="2" cellspacing="0" border="0" width="100%" align="center">
<tr>
	<td bgcolor="#bbbbbb" width="1%" nowrap align="center">
			&nbsp;<font color="#ffffff"><b>Description</b></font>&nbsp;
	</td>
    <td align="right"><a id="description-hide" href="" onClick="toggleDivsWithCookie('description-closed', 'description-open'); return false;" class="smallgrey">&laquo; Hide</a></td>
</tr>
</table>

<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
	<td id="descriptionArea">
        <div id="description_full">
            <p>Installed the latest GF nightly build dated b36-01-03-2011 and used the installer bundles latest-ogs-windows.exe on Windows machines. JDK used is : jdk 1.6.0_23</p>

<p>Trying to access Console after enabling secure-admin. After accepting certificates, the Console takes a while to load, and in the meantime the server.log has the below Exceptions.<br/>
This is seen only in windows OS. I could reproduce on both XP and 2008 server using nightly build b36-01-03-2011</p>

<p>steps:</p>

<p>start domain1,<br/>
asadmin enable-secure-admin<br/>
restart domain1.</p>

<p>Access Console : <span class="nobr"><a href="http://localhost:4848">http://localhost:4848<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span><br/>
redirection happens to <span class="nobr"><a href="https://localhost:4848">https://localhost:4848<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span><br/>
Accept certificates.<br/>
Then console takes forever to load...</p>

<p>server.log has below Exception:</p>

<p>[#|2011-01-03T19:38:51.414-0800|INFO|oracle-glassfish3.1|javax.enterprise.system<br/>
.core.com.sun.enterprise.v3.admin.adapter|_ThreadID=95;_ThreadName=Thread-1;|The<br/>
 Admin Console application is loaded.|#]</p>

<p>[#|2011-01-03T19:38:54.304-0800|WARNING|oracle-glassfish3.1|javax.enterprise.sys<br/>
tem.container.web.com.sun.enterprise.web|_ThreadID=81;_ThreadName=Thread-1;|Appl<br/>
icationDispatcher[] PWC1231: Servlet.service() for servlet FacesServlet threw ex<br/>
ception<br/>
java.lang.RuntimeException: java.lang.reflect.InvocationTargetException while at<br/>
tempting to process a 'beforeCreate' event for 'event1'.<br/>
        at com.sun.jsftemplating.layout.descriptors.LayoutElementBase.dispatchHa<br/>
ndlers(LayoutElementBase.java:422)<br/>
        at com.sun.jsftemplating.layout.descriptors.LayoutElementBase.dispatchHa<br/>
ndlers(LayoutElementBase.java:394)<br/>
        at com.sun.jsftemplating.layout.descriptors.LayoutComponent.beforeCreate<br/>
(LayoutComponent.java:348)<br/>
        at com.sun.jsftemplating.layout.descriptors.LayoutComponent.getChild(Lay<br/>
outComponent.java:288)<br/>
        at com.sun.jsftemplating.layout.LayoutViewHandler.buildUIComponentTree(L<br/>
ayoutViewHandler.java:556)<br/>
        at com.sun.jsftemplating.layout.LayoutViewHandler.createView(LayoutViewH<br/>
andler.java:255)<br/>
        at com.sun.faces.lifecycle.RestoreViewPhase.execute(RestoreViewPhase.jav<br/>
a:244)<br/>
        at com.sun.faces.lifecycle.Phase.doPhase(Phase.java:101)<br/>
        at com.sun.faces.lifecycle.RestoreViewPhase.doPhase(RestoreViewPhase.jav<br/>
a:113)<br/>
        at com.sun.faces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:118)</p>

<p>        at javax.faces.webapp.FacesServlet.service(FacesServlet.java:395)<br/>
        at org.apache.catalina.core.StandardWrapper.service(StandardWrapper.java<br/>
:1534)<br/>
        at org.apache.catalina.core.ApplicationDispatcher.doInvoke(ApplicationDi<br/>
spatcher.java:787)<br/>
        at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDisp<br/>
atcher.java:649)<br/>
        at org.apache.catalina.core.ApplicationDispatcher.processRequest(Applica<br/>
tionDispatcher.java:483)<br/>
        at org.apache.catalina.core.ApplicationDispatcher.doDispatch(Application<br/>
Dispatcher.java:454)<br/>
        at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDi<br/>
spatcher.java:350)<br/>
        at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDis<br/>
patcher.java:300)<br/>
        at org.glassfish.admingui.common.security.AdminConsoleAuthModule.validat<br/>
eRequest(AdminConsoleAuthModule.java:195)<br/>
        at com.sun.enterprise.security.jmac.config.GFServerConfigProvider$GFServ<br/>
erAuthContext.validateRequest(GFServerConfigProvider.java:1171)<br/>
        at com.sun.web.security.RealmAdapter.validate(RealmAdapter.java:1312)<br/>
        at com.sun.web.security.RealmAdapter.invokeAuthenticateDelegate(RealmAda<br/>
pter.java:1190)<br/>
        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(Authentica<br/>
torBase.java:551)<br/>
        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.j<br/>
ava:623)<br/>
        at org.apache.catalina.core.StandardPipeline.doChainInvoke(StandardPipel<br/>
ine.java:600)<br/>
        at com.sun.enterprise.web.WebPipeline.invoke(WebPipeline.java:96)<br/>
        at com.sun.enterprise.web.PESessionLockingStandardPipeline.invoke(PESess<br/>
ionLockingStandardPipeline.java:91)<br/>
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j<br/>
ava:162)<br/>
        at org.apache.catalina.connector.CoyoteAdapter.doService(CoyoteAdapter.j<br/>
ava:326)<br/>
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.jav<br/>
a:227)<br/>
        at com.sun.enterprise.v3.services.impl.ContainerMapper.service(Container<br/>
Mapper.java:228)<br/>
        at com.sun.grizzly.http.ProcessorTask.invokeAdapter(ProcessorTask.java:8<br/>
18)<br/>
        at com.sun.grizzly.http.ProcessorTask.doProcess(ProcessorTask.java:719)<br/>
        at com.sun.grizzly.http.ProcessorTask.process(ProcessorTask.java:1008)<br/>
        at com.sun.grizzly.http.DefaultProtocolFilter.execute(DefaultProtocolFil<br/>
ter.java:225)<br/>
        at com.sun.grizzly.DefaultProtocolChain.executeProtocolFilter(DefaultPro<br/>
tocolChain.java:137)<br/>
        at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.jav<br/>
a:104)<br/>
        at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.jav<br/>
a:90)<br/>
        at com.sun.grizzly.http.HttpProtocolChain.execute(HttpProtocolChain.java<br/>
:79)<br/>
        at com.sun.grizzly.ProtocolChainContextTask.doCall(ProtocolChainContextT<br/>
ask.java:54)<br/>
        at com.sun.grizzly.SelectionKeyContextTask.call(SelectionKeyContextTask.<br/>
java:59)<br/>
        at com.sun.grizzly.ContextTask.run(ContextTask.java:71)<br/>
        at com.sun.grizzly.util.AbstractThreadPool$Worker.doWork(AbstractThreadP<br/>
ool.java:532)<br/>
        at com.sun.grizzly.util.AbstractThreadPool$Worker.run(AbstractThreadPool<br/>
.java:513)<br/>
        at java.lang.Thread.run(Thread.java:662)<br/>
Caused by: java.lang.reflect.InvocationTargetException<br/>
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br/>
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.<br/>
java:39)<br/>
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces<br/>
sorImpl.java:25)<br/>
        at java.lang.reflect.Method.invoke(Method.java:597)<br/>
        at com.sun.jsftemplating.layout.descriptors.handler.Handler.invoke(Handl<br/>
er.java:442)<br/>
        at com.sun.jsftemplating.layout.descriptors.LayoutElementBase.dispatchHa<br/>
ndlers(LayoutElementBase.java:420)<br/>
        ... 44 more<br/>
Caused by: com.sun.jersey.api.client.ClientHandlerException: javax.net.ssl.SSLHa<br/>
ndshakeException: java.security.cert.CertificateException: No name matching loca<br/>
lhost found<br/>
        at com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle<br/>
(URLConnectionClientHandler.java:131)<br/>
        at com.sun.jersey.api.client.Client.handle(Client.java:629)<br/>
        at com.sun.jersey.api.client.WebResource.handle(WebResource.java:601)<br/>
        at com.sun.jersey.api.client.WebResource.access$200(WebResource.java:74)</p>

<p>        at com.sun.jersey.api.client.WebResource$Builder.get(WebResource.java:45<br/>
9)<br/>
        at org.glassfish.admingui.common.util.RestUtil.get(RestUtil.java:642)<br/>
        at org.glassfish.admingui.common.util.RestUtil.restRequest(RestUtil.java<br/>
:176)<br/>
        at org.glassfish.admingui.common.handlers.RestApiHandlers.restRequest(Re<br/>
stApiHandlers.java:210)<br/>
        ... 50 more<br/>
Caused by: javax.net.ssl.SSLHandshakeException: java.security.cert.CertificateEx<br/>
ception: No name matching localhost found<br/>
        at com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Alerts.java:174)<br/>
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1<br/>
649)<br/>
        at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:241)<br/>
        at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:235)<br/>
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(Clien<br/>
tHandshaker.java:1206)<br/>
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.processMessage(ClientHa<br/>
ndshaker.java:136)<br/>
        at com.sun.net.ssl.internal.ssl.Handshaker.processLoop(Handshaker.java:5<br/>
93)<br/>
        at com.sun.net.ssl.internal.ssl.Handshaker.process_record(Handshaker.jav<br/>
a:529)<br/>
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.j<br/>
ava:893)<br/>
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(SS<br/>
LSocketImpl.java:1138)<br/>
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketIm<br/>
pl.java:1165)<br/>
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketIm<br/>
pl.java:1149)<br/>
        at sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:<br/>
434)<br/>
        at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect<br/>
(AbstractDelegateHttpsURLConnection.java:166)<br/>
        at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLCon<br/>
nection.java:1177)<br/>
        at java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:379<br/>
)<br/>
        at sun.net.www.protocol.https.HttpsURLConnectionImpl.getResponseCode(Htt<br/>
psURLConnectionImpl.java:318)<br/>
        at com.sun.jersey.client.urlconnection.URLConnectionClientHandler._invok<br/>
e(URLConnectionClientHandler.java:217)<br/>
        at com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle<br/>
(URLConnectionClientHandler.java:129)<br/>
        ... 57 more<br/>
Caused by: java.security.cert.CertificateException: No name matching localhost f<br/>
ound<br/>
        at sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:210)<br/>
        at sun.security.util.HostnameChecker.match(HostnameChecker.java:77)<br/>
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkIdentity(X509T<br/>
rustManagerImpl.java:264)<br/>
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(<br/>
X509TrustManagerImpl.java:250)<br/>
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(Clien<br/>
tHandshaker.java:1185)<br/>
        ... 71 more</p>
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'>#]</td>
</tr>
</tbody></table><br />
        </div>
    </td>
</tr>
</table>
</div>

<div id="description-closed" style="display:none;">
<table cellpadding="2" cellspacing="0" border="0" width="100%" align="center" class="table-layout: fixed;">
<tr>
	<td bgcolor="#bbbbbb" width="1%" nowrap align="center">
			&nbsp;<font color="#ffffff"><b>Description</b></font>&nbsp;
	</td>
    <td style="padding: 1px; margin: 0px; border-bottom: #bbb 1px solid;"><div style="height: 1.2em; overflow: hidden; text-overflow: ellipsis;">&nbsp; &nbsp;Installed the latest GF nightly build dated b36-01-03-2011 and used the installer bundles latest-ogs-windows.exe on Windows machines. JDK used is : jdk 1.6.0_23

Trying to access Console after enabling secure-admin. After accepting certificates, the Console takes a while to load, and in the meantime the server.log has the below Exceptions.
This is seen only in windows OS. I could reproduce on both XP and 2008 server using nightly build b36-01-03-2011

steps:

start domain1,
asadmin enable-secure-admin
restart domain1.

Access Console : <span class="nobr"><a href="http://localhost:4848">http://localhost:4848<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>
redirection happens to <span class="nobr"><a href="https://localhost:4848">https://localhost:4848<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>
Accept certificates.
Then console takes forever to load...

server.log has below Exception:

[#|2011-01-03T19:38:51.414-0800|INFO|oracle-glassfish3.1|javax.enterprise.system
.core.com.sun.enterprise.v3.admin.adapter|_ThreadID=95;_ThreadName=Thread-1;|The
 Admin Console application is loaded.|#]

[#|2011-01-03T19:38:54.304-0800|WARNING|oracle-glassfish3.1|javax.enterprise.sys
tem.container.web.com.sun.enterprise.web|_ThreadID=81;_ThreadName=Thread-1;|Appl
icationDispatcher[] PWC1231: Servlet.service() for servlet FacesServlet threw ex
ception
java.lang.RuntimeException: java.lang.reflect.InvocationTargetException while at
tempting to process a 'beforeCreate' event for 'event1'.
        at com.sun.jsftemplating.layout.descriptors.LayoutElementBase.dispatchHa
ndlers(LayoutElementBase.java:422)
        at com.sun.jsftemplating.layout.descriptors.LayoutElementBase.dispatchHa
ndlers(LayoutElementBase.java:394)
        at com.sun.jsftemplating.layout.descriptors.LayoutComponent.beforeCreate
(LayoutComponent.java:348)
        at com.sun.jsftemplating.layout.descriptors.LayoutComponent.getChild(Lay
outComponent.java:288)
        at com.sun.jsftemplating.layout.LayoutViewHandler.buildUIComponentTree(L
ayoutViewHandler.java:556)
        at com.sun.jsftemplating.layout.LayoutViewHandler.createView(LayoutViewH
andler.java:255)
        at com.sun.faces.lifecycle.RestoreViewPhase.execute(RestoreViewPhase.jav
a:244)
        at com.sun.faces.lifecycle.Phase.doPhase(Phase.java:101)
        at com.sun.faces.lifecycle.RestoreViewPhase.doPhase(RestoreViewPhase.jav
a:113)
        at com.sun.faces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:118)

        at javax.faces.webapp.FacesServlet.service(FacesServlet.java:395)
        at org.apache.catalina.core.StandardWrapper.service(StandardWrapper.java
:1534)
        at org.apache.catalina.core.ApplicationDispatcher.doInvoke(ApplicationDi
spatcher.java:787)
        at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDisp
atcher.java:649)
        at org.apache.catalina.core.ApplicationDispatcher.processRequest(Applica
tionDispatcher.java:483)
        at org.apache.catalina.core.ApplicationDispatcher.doDispatch(Application
Dispatcher.java:454)
        at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDi
spatcher.java:350)
        at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDis
patcher.java:300)
        at org.glassfish.admingui.common.security.AdminConsoleAuthModule.validat
eRequest(AdminConsoleAuthModule.java:195)
        at com.sun.enterprise.security.jmac.config.GFServerConfigProvider$GFServ
erAuthContext.validateRequest(GFServerConfigProvider.java:1171)
        at com.sun.web.security.RealmAdapter.validate(RealmAdapter.java:1312)
        at com.sun.web.security.RealmAdapter.invokeAuthenticateDelegate(RealmAda
pter.java:1190)
        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(Authentica
torBase.java:551)
        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.j
ava:623)
        at org.apache.catalina.core.StandardPipeline.doChainInvoke(StandardPipel
ine.java:600)
        at com.sun.enterprise.web.WebPipeline.invoke(WebPipeline.java:96)
        at com.sun.enterprise.web.PESessionLockingStandardPipeline.invoke(PESess
ionLockingStandardPipeline.java:91)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j
ava:162)
        at org.apache.catalina.connector.CoyoteAdapter.doService(CoyoteAdapter.j
ava:326)
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.jav
a:227)
        at com.sun.enterprise.v3.services.impl.ContainerMapper.service(Container
Mapper.java:228)
        at com.sun.grizzly.http.ProcessorTask.invokeAdapter(ProcessorTask.java:8
18)
        at com.sun.grizzly.http.ProcessorTask.doProcess(ProcessorTask.java:719)
        at com.sun.grizzly.http.ProcessorTask.process(ProcessorTask.java:1008)
        at com.sun.grizzly.http.DefaultProtocolFilter.execute(DefaultProtocolFil
ter.java:225)
        at com.sun.grizzly.DefaultProtocolChain.executeProtocolFilter(DefaultPro
tocolChain.java:137)
        at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.jav
a:104)
        at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.jav
a:90)
        at com.sun.grizzly.http.HttpProtocolChain.execute(HttpProtocolChain.java
:79)
        at com.sun.grizzly.ProtocolChainContextTask.doCall(ProtocolChainContextT
ask.java:54)
        at com.sun.grizzly.SelectionKeyContextTask.call(SelectionKeyContextTask.
java:59)
        at com.sun.grizzly.ContextTask.run(ContextTask.java:71)
        at com.sun.grizzly.util.AbstractThreadPool$Worker.doWork(AbstractThreadP
ool.java:532)
        at com.sun.grizzly.util.AbstractThreadPool$Worker.run(AbstractThreadPool
.java:513)
        at java.lang.Thread.run(Thread.java:662)
Caused by: java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at com.sun.jsftemplating.layout.descriptors.handler.Handler.invoke(Handl
er.java:442)
        at com.sun.jsftemplating.layout.descriptors.LayoutElementBase.dispatchHa
ndlers(LayoutElementBase.java:420)
        ... 44 more
Caused by: com.sun.jersey.api.client.ClientHandlerException: javax.net.ssl.SSLHa
ndshakeException: java.security.cert.CertificateException: No name matching loca
lhost found
        at com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle
(URLConnectionClientHandler.java:131)
        at com.sun.jersey.api.client.Client.handle(Client.java:629)
        at com.sun.jersey.api.client.WebResource.handle(WebResource.java:601)
        at com.sun.jersey.api.client.WebResource.access$200(WebResource.java:74)

        at com.sun.jersey.api.client.WebResource$Builder.get(WebResource.java:45
9)
        at org.glassfish.admingui.common.util.RestUtil.get(RestUtil.java:642)
        at org.glassfish.admingui.common.util.RestUtil.restRequest(RestUtil.java
:176)
        at org.glassfish.admingui.common.handlers.RestApiHandlers.restRequest(Re
stApiHandlers.java:210)
        ... 50 more
Caused by: javax.net.ssl.SSLHandshakeException: java.security.cert.CertificateEx
ception: No name matching localhost found
        at com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Alerts.java:174)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1
649)
        at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:241)
        at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:235)
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(Clien
tHandshaker.java:1206)
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.processMessage(ClientHa
ndshaker.java:136)
        at com.sun.net.ssl.internal.ssl.Handshaker.processLoop(Handshaker.java:5
93)
        at com.sun.net.ssl.internal.ssl.Handshaker.process_record(Handshaker.jav
a:529)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.j
ava:893)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(SS
LSocketImpl.java:1138)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketIm
pl.java:1165)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketIm
pl.java:1149)
        at sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:
434)
        at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect
(AbstractDelegateHttpsURLConnection.java:166)
        at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLCon
nection.java:1177)
        at java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:379
)
        at sun.net.www.protocol.https.HttpsURLConnectionImpl.getResponseCode(Htt
psURLConnectionImpl.java:318)
        at com.sun.jersey.client.urlconnection.URLConnectionClientHandler._invok
e(URLConnectionClientHandler.java:217)
        at com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle
(URLConnectionClientHandler.java:129)
        ... 57 more
Caused by: java.security.cert.CertificateException: No name matching localhost f
ound
        at sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:210)
        at sun.security.util.HostnameChecker.match(HostnameChecker.java:77)
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkIdentity(X509T
rustManagerImpl.java:264)
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(
X509TrustManagerImpl.java:250)
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(Clien
tHandshaker.java:1185)
        ... 71 more
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'>#]</td>
</tr>
</tbody></table></div></td>
    <td width="1%" align="right" nowrap style="padding: 1px; margin: 0px; border-bottom: #bbb 1px solid;"><a id="description-show" href="" onClick="toggleDivsWithCookie('description-open', 'description-closed'); return false;" class="smallgrey">Show &raquo;</a></td>
</tr>
</table>
</div>

<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('description-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('description-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>














<br>




    <div class="tabwrap">
        
            <div class="sortwrap">
                Sort Order:
                
                    <a rel="nofollow" href="/jira/browse/GLASSFISH-15421?actionOrder=desc"><img src="/jira/images/icons/arrow_down_blue_small.gif" class="sortArrow" alt="Ascending order - Click to sort in descending order" title="Ascending order - Click to sort in descending order" border="0" /></a>
                
                
            </div>
        
        <ul class="tabs horizontal">
        
            
            
                <li><a href="/jira/browse/GLASSFISH-15421?page=com.atlassian.jira.plugin.system.issuetabpanels%3Aall-tabpanel"><strong>All</strong></a></li>
            
        
            
                <li class="active"><strong>Comments</strong></li>
            
            
        
            
            
                <li><a href="/jira/browse/GLASSFISH-15421?page=com.atlassian.jira.plugin.system.issuetabpanels%3Aworklog-tabpanel"><strong>Work Log</strong></a></li>
            
        
            
            
                <li><a href="/jira/browse/GLASSFISH-15421?page=com.atlassian.jira.plugin.system.issuetabpanels%3Achangehistory-tabpanel"><strong>Change History</strong></a></li>
            
        
            
            
                <li><a href="/jira/browse/GLASSFISH-15421?page=com.atlassian.streams.streams-jira-plugin%3Aactivity-stream-issue-tab"><strong>Activity Stream</strong></a></li>
            
        
        </ul>
    </div>

    
        <div class="issuePanelContainer" id="issue_actions_container">
        
            
                
                <div id="comment-174545-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=174545&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_174545" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-174545-hide" href="" onClick="toggleDivsWithCookie('comment-174545-closed', 'comment-174545-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_174545" />
    
    
    
                <a id="comment_174545_header_shaline" href="/jira/secure/ViewProfile.jspa?name=shaline">shaline</a> added a comment  - <span class=subText><span class=date>03/Jan/11 07:49 PM</span></span>  </div>
    <div class="action-body"><p>Attached Sever.log</p> </div>
</div>
</div>


<div id="comment-174545-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-174545-show" href="" onClick="toggleDivsWithCookie('comment-174545-open', 'comment-174545-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_174545" />
    
    
    
                <a id="comment_174545_header_shaline" href="/jira/secure/ViewProfile.jspa?name=shaline">shaline</a> added a comment  - <span class=subText><span class=date>03/Jan/11 07:49 PM</span></span>               Attached Sever.log     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-174545-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-174545-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-174595-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=174595&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_174595" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-174595-hide" href="" onClick="toggleDivsWithCookie('comment-174595-closed', 'comment-174595-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_174595" />
    
    
    
                <a id="comment_174595_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>04/Jan/11 08:42 AM</span></span>  </div>
    <div class="action-body"><p>Requesting help from Ludo.<br/>
According to Shaline, this only occurs on Window.  If you need access to her machine, she can made that available.</p> </div>
</div>
</div>


<div id="comment-174595-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-174595-show" href="" onClick="toggleDivsWithCookie('comment-174595-open', 'comment-174595-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_174595" />
    
    
    
                <a id="comment_174595_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>04/Jan/11 08:42 AM</span></span>               Requesting help from Ludo.
According to Shaline, this only occurs on Window.  If you need access to her machine, she can made that available.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-174595-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-174595-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-174620-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=174620&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_174620" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-174620-hide" href="" onClick="toggleDivsWithCookie('comment-174620-closed', 'comment-174620-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_174620" />
    
    
    
                <a id="comment_174620_header_shaline" href="/jira/secure/ViewProfile.jspa?name=shaline">shaline</a> added a comment  - <span class=subText><span class=date>04/Jan/11 11:45 AM</span></span>  </div>
    <div class="action-body"><p>I tried the nightly dated 01/04-2011 on windows 7 and see the same issues as seen on XP, and windows 2008.</p> </div>
</div>
</div>


<div id="comment-174620-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-174620-show" href="" onClick="toggleDivsWithCookie('comment-174620-open', 'comment-174620-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_174620" />
    
    
    
                <a id="comment_174620_header_shaline" href="/jira/secure/ViewProfile.jspa?name=shaline">shaline</a> added a comment  - <span class=subText><span class=date>04/Jan/11 11:45 AM</span></span>               I tried the nightly dated 01/04-2011 on windows 7 and see the same issues as seen on XP, and windows 2008.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-174620-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-174620-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-183040-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=183040&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_183040" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-183040-hide" href="" onClick="toggleDivsWithCookie('comment-183040-closed', 'comment-183040-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_183040" />
    
    
    
                <a id="comment_183040_header_mm110999" href="/jira/secure/ViewProfile.jspa?name=mm110999">Mitesh Meswani</a> added a comment  - <span class=subText><span class=date>05/Jan/11 05:46 PM</span></span>  </div>
    <div class="action-body"><p>The difference indeed is with using installer  (ogs-windows.exe) vs. zip bundle.   The installer creates domain using "asadmin create-domain" that results in different content for keystore.jks.  The CN for certificates in keystore when using installer contains actual host name  and it is "localhost" for certificate in keystore from zip bundle.</p>

<p>Here are shortened steps to reproduce the issue.</p>

<p>install glassfish (any way you want it, any OS you want it)<br/>
asadmin create-domain domainfoo<br/>
asadmin start-domain domainfoo<br/>
asadmin enable-secure-admin  <br/>
asadmin stop-domain domainfoo<br/>
asadmin start-domain domainfoo</p>

<p>access admin console of domainfoo and the error manifests.</p> </div>
</div>
</div>


<div id="comment-183040-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-183040-show" href="" onClick="toggleDivsWithCookie('comment-183040-open', 'comment-183040-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_183040" />
    
    
    
                <a id="comment_183040_header_mm110999" href="/jira/secure/ViewProfile.jspa?name=mm110999">Mitesh Meswani</a> added a comment  - <span class=subText><span class=date>05/Jan/11 05:46 PM</span></span>               The difference indeed is with using installer  (ogs-windows.exe) vs. zip bundle.   The installer creates domain using "asadmin create-domain" that results in different content for keystore.jks.  The CN for certificates in keystore when using installer contains actual host name  and it is "localhost" for certificate in keystore from zip bundle.

Here are shortened steps to reproduce the issue.

install glassfish (any way you want it, any OS you want it)
asadmin create-domain domainfoo
asadmin start-domain domainfoo
asadmin enable-secure-admin  
asadmin stop-domain domainfoo
asadmin start-domain domainfoo

access admin console of domainfoo and the error manifests.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-183040-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-183040-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189408-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189408&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189408" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189408-hide" href="" onClick="toggleDivsWithCookie('comment-189408-closed', 'comment-189408-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189408" />
    
    
    
                <a id="comment_189408_header_tjquinn" href="/jira/secure/ViewProfile.jspa?name=tjquinn">Tim Quinn</a> added a comment  - <span class=subText><span class=date>07/Jan/11 10:11 AM</span></span>  </div>
    <div class="action-body"><p>There has been considerable e-mail traffic about this. </p>

<p>The current thinking (from Kumar) is that the admin console might have to specify the actual host name (rather than localhost) when it connect to the DAS for REST requests.  That, or use a slightly different host name verifier. </p>

<p>As a result, I am transferring this back to Anissa.</p> </div>
</div>
</div>


<div id="comment-189408-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189408-show" href="" onClick="toggleDivsWithCookie('comment-189408-open', 'comment-189408-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189408" />
    
    
    
                <a id="comment_189408_header_tjquinn" href="/jira/secure/ViewProfile.jspa?name=tjquinn">Tim Quinn</a> added a comment  - <span class=subText><span class=date>07/Jan/11 10:11 AM</span></span>               There has been considerable e-mail traffic about this. 

The current thinking (from Kumar) is that the admin console might have to specify the actual host name (rather than localhost) when it connect to the DAS for REST requests.  That, or use a slightly different host name verifier. 

As a result, I am transferring this back to Anissa.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189408-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189408-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189411-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189411&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189411" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189411-hide" href="" onClick="toggleDivsWithCookie('comment-189411-closed', 'comment-189411-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189411" />
    
    
    
                <a id="comment_189411_header_ai109478" href="/jira/secure/ViewProfile.jspa?name=ai109478">Nazrul</a> added a comment  - <span class=subText><span class=date>07/Jan/11 10:26 AM</span></span>  </div>
    <div class="action-body"><p>Getting help from Kumar. We need more specific instructions for console/REST teams. </p> </div>
</div>
</div>


<div id="comment-189411-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189411-show" href="" onClick="toggleDivsWithCookie('comment-189411-open', 'comment-189411-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189411" />
    
    
    
                <a id="comment_189411_header_ai109478" href="/jira/secure/ViewProfile.jspa?name=ai109478">Nazrul</a> added a comment  - <span class=subText><span class=date>07/Jan/11 10:26 AM</span></span>               Getting help from Kumar. We need more specific instructions for console/REST teams.      </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189411-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189411-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189413-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189413&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189413" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189413-hide" href="" onClick="toggleDivsWithCookie('comment-189413-closed', 'comment-189413-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189413" />
    
    
    
                <a id="comment_189413_header_kumara" href="/jira/secure/ViewProfile.jspa?name=kumara">kumara</a> added a comment  - <span class=subText><span class=date>07/Jan/11 10:33 AM</span></span>  </div>
    <div class="action-body"><p>It looks like we are making REST calls over the wire even when we are coming back to same VM. Assuming that is the way it will be, shouldn't REST URL be formed by using the host obtained from request.getHost() from admin console. It is still possible that the certificate might have a different host name, so a more forgiving HostName Verifier for REST admin interface client (which will be admin GUI) is the best fix for this issue. </p> </div>
</div>
</div>


<div id="comment-189413-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189413-show" href="" onClick="toggleDivsWithCookie('comment-189413-open', 'comment-189413-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189413" />
    
    
    
                <a id="comment_189413_header_kumara" href="/jira/secure/ViewProfile.jspa?name=kumara">kumara</a> added a comment  - <span class=subText><span class=date>07/Jan/11 10:33 AM</span></span>               It looks like we are making REST calls over the wire even when we are coming back to same VM. Assuming that is the way it will be, shouldn't REST URL be formed by using the host obtained from request.getHost() from admin console. It is still possible that the certificate might have a different host name, so a more forgiving HostName Verifier for REST admin interface client (which will be admin GUI) is the best fix for this issue.      </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189413-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189413-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189415-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189415&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189415" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189415-hide" href="" onClick="toggleDivsWithCookie('comment-189415-closed', 'comment-189415-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189415" />
    
    
    
                <a id="comment_189415_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>07/Jan/11 11:29 AM</span></span>  </div>
    <div class="action-body"><p>I have been working on this for the last 2 days, trying out different scenario and experimenting with how to use the HostName Verifier.  All in vein.<br/>
Basically,  for the rest endpoint that GUI uses, it has to match EXACTLY the CN of the certificate.  Otherwise, there will be the CertificateException.   According to Kumar,   HostName Verifier is the solution.  I have tried using that,  result in some other exception.</p>

<p>Here is the latest email i sent.  That kind of summarize the situation.  <br/>
I have also tried this with the latest code that Kumar mentioned he has checked in, without specifying SSLContext.getInstance(), in the HTTPSProperties,  still the same exception.</p>


<p>On 1/6/11 11:00 PM, Kumar.Jayanti wrote:</p>

<p>&gt; On 07/01/11 12:17 PM, Anissa Lam wrote: <br/>
&gt; Hi Kumar,<br/>
&gt;<br/>
&gt; Thanks for looking into this and give input.   The code and the stack trace that i showed you was NOT in any of the checkin code.   It is just some experiment that Mitesh and I tried.<br/>
&gt; I spent entire day today working on this, experimenting on different scenario.  Mitesh gave more suggestion but at the end,  I am back to square one.   Since i have never worked on codes related to security before,  I have a hard time understanding what needs to be done,  including the suggestion you gave below.<br/>
&gt; Let me summarize what I did today, and see if  it makes sense to you.<br/>
&gt;<br/>
&gt; - Without adding any code relating for HostName Verifier,  I see the CertificateException if the endpoint we use for REST doesn't match the CN of the certificate.<br/>
&gt; case 1:   default domain,  CN=localhost,   using this endpoint  "https://dhcp-whq-twvpn-1-vpnpool-10-159-247-97:4848/management/domain/anonymous-user-enabled"  will get the following exception<br/>
&gt;         Caused by: java.security.cert.CertificateException: No name matching dhcp-whq-twvpn-1-vpnpool-10-159-247-97.vpn.oracle.com found<br/>
&gt;         at sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:210)<br/>
&gt;         at sun.security.util.HostnameChecker.match(HostnameChecker.java:77)<br/>
&gt;         at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkIdentity(X509TrustManagerImpl.java:264)<br/>
&gt;         at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:250)<br/>
&gt;         at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1185)</p>

<p>yes,  when using HTTPS the hostname in the URL used to request the endpoint should match the CN of the certificate in glassfish server keystore's s1as alias.  Otherwise you would see this exception.</p>

<p>&gt;<br/>
&gt; case 2:  new domain created,  certificate CN=dhcp-whq-twvpn-1-vpnpool-10-159-247-97    using this endpoint:  <span class="nobr"><a href="http://localhost:4848/management/domain/anonymous-user-enabled">http://localhost:4848/management/domain/anonymous-user-enabled<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>  will get the following exception<br/>
&gt;           Caused by: java.security.cert.CertificateException: No name matching localhost found<br/>
&gt;           at sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:210)<br/>
&gt;           at sun.security.util.HostnameChecker.match(HostnameChecker.java:77)<br/>
&gt;           at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkIdentity(X509TrustManagerImpl.java:264)<br/>
&gt;           at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:250)<br/>
&gt;           at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1185)<br/>
&gt;             ... 71 more<br/>
&gt;<br/>
&gt; So, even if i put in the logic to find the hostname and use that as the endpoint instead of hard coding "localhost", there will be case that it will not work.  Sounds like the endpoint HAS to match the CN of the cert.<br/>
&gt;</p>

<p>That's correct. You somehow need to know what is the CN of the server cert and use exactly that. Which sounds like a difficult problem.</p>

<p>But then setting a HostNameVerifier is the solution to this problem.</p>

<p>&gt; I then call the following code:<br/>
&gt; public static void initialize(Client client, String serverName){<br/>
&gt;         if (client == null){
&gt;             client = JERSEY_CLIENT;
&gt;         }<br/>
&gt;         try{
&gt;             HTTPSProperties httpsProperties = new HTTPSProperties(new BasicHostnameVerifier( serverName) , SSLContext.getInstance("TLS"));    &lt;======== I have tried SSLContext.getInstance("SSL");  SAME exception as below.
&gt;             client.getProperties().put(HTTPSProperties.PROPERTY_HTTPS_PROPERTIES, httpsProperties);
&gt;         }catch(Exception ex){
&gt;              ex.printStackTrace();
&gt;          }<br/>
&gt;     }<br/>
&gt;<br/>
you may not need the SSLContext.getInstance() call above.  Have you tried setting this hostnameverifier as you have done and  try with the very latest builds of GlassFish. I have checked in code yesterday night. ?</p>

<p>regards,<br/>
kumar</p>

<p>&gt;     private static class BasicHostnameVerifier implements HostnameVerifier {<br/>
&gt;         private final String host;<br/>
&gt;         public BasicHostnameVerifier(String host) {
&gt;             if (host == null)
&gt;                 throw new IllegalArgumentException("null host");
&gt;             this.host = host;
&gt;         }<br/>
&gt;         public boolean verify(String s, SSLSession sslSession) {
&gt;             return host.equals(s);
&gt;         }<br/>
&gt;     }<br/>
&gt;<br/>
&gt; This executed without issue, but then the next request GUI sent to REST will result in the following:<br/>
&gt;<br/>
&gt; Caused by: java.lang.IllegalStateException: SSLContextImpl is not initialized<br/>
&gt;     at com.sun.net.ssl.internal.ssl.SSLContextImpl.engineGetSocketFactory(SSLContextImpl.java:145)<br/>
&gt;     at javax.net.ssl.SSLContext.getSocketFactory(SSLContext.java:260)<br/>
&gt;     at com.sun.jersey.client.urlconnection.HTTPSProperties.setConnection(HTTPSProperties.java:140)<br/>
&gt;     at com.sun.jersey.client.urlconnection.URLConnectionClientHandler._invoke(URLConnectionClientHandler.java:166)<br/>
&gt;     at com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle(URLConnectionClientHandler.java:129)<br/>
&gt;     ... 32 more<br/>
&gt;<br/>
&gt;<br/>
I am not sure what you mean by<br/>
&gt;&gt;<br/>
&gt;&gt; However the SSLContext that we initialize uses a KeyManager initialized using the "alias" specified by<br/>
&gt;&gt; -Dcom.sun.enterprise.security.httpsOutboundKeyAlias=YOUR_ALIAS</p>

<p>&gt; As I have no experience with this area of code,  something that seems trivial to you will not be for me.<br/>
&gt; If you can help me modify the above code fragment to do what you think needs to be done,  I really appreciate that.   I do not know how to move forward now.<br/>
&gt;<br/>
&gt; thanks<br/>
&gt; Anissa.</p> </div>
</div>
</div>


<div id="comment-189415-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189415-show" href="" onClick="toggleDivsWithCookie('comment-189415-open', 'comment-189415-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189415" />
    
    
    
                <a id="comment_189415_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>07/Jan/11 11:29 AM</span></span>               I have been working on this for the last 2 days, trying out different scenario and experimenting with how to use the HostName Verifier.  All in vein.
Basically,  for the rest endpoint that GUI uses, it has to match EXACTLY the CN of the certificate.  Otherwise, there will be the CertificateException.   According to Kumar,   HostName Verifier is the solution.  I have tried using that,  result in some other exception.

Here is the latest email i sent.  That kind of summarize the situation.  
I have also tried this with the latest code that Kumar mentioned he has checked in, without specifying SSLContext.getInstance(), in the HTTPSProperties,  still the same exception.


On 1/6/11 11:00 PM, Kumar.Jayanti wrote:

&gt; On 07/01/11 12:17 PM, Anissa Lam wrote: 
&gt; Hi Kumar,
&gt;
&gt; Thanks for looking into this and give input.   The code and the stack trace that i showed you was NOT in any of the checkin code.   It is just some experiment that Mitesh and I tried.
&gt; I spent entire day today working on this, experimenting on different scenario.  Mitesh gave more suggestion but at the end,  I am back to square one.   Since i have never worked on codes related to security before,  I have a hard time understanding what needs to be done,  including the suggestion you gave below.
&gt; Let me summarize what I did today, and see if  it makes sense to you.
&gt;
&gt; - Without adding any code relating for HostName Verifier,  I see the CertificateException if the endpoint we use for REST doesn't match the CN of the certificate.
&gt; case 1:   default domain,  CN=localhost,   using this endpoint  "https://dhcp-whq-twvpn-1-vpnpool-10-159-247-97:4848/management/domain/anonymous-user-enabled"  will get the following exception
&gt;         Caused by: java.security.cert.CertificateException: No name matching dhcp-whq-twvpn-1-vpnpool-10-159-247-97.vpn.oracle.com found
&gt;         at sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:210)
&gt;         at sun.security.util.HostnameChecker.match(HostnameChecker.java:77)
&gt;         at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkIdentity(X509TrustManagerImpl.java:264)
&gt;         at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:250)
&gt;         at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1185)

yes,  when using HTTPS the hostname in the URL used to request the endpoint should match the CN of the certificate in glassfish server keystore's s1as alias.  Otherwise you would see this exception.

&gt;
&gt; case 2:  new domain created,  certificate CN=dhcp-whq-twvpn-1-vpnpool-10-159-247-97    using this endpoint:  <span class="nobr"><a href="http://localhost:4848/management/domain/anonymous-user-enabled">http://localhost:4848/management/domain/anonymous-user-enabled<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>  will get the following exception
&gt;           Caused by: java.security.cert.CertificateException: No name matching localhost found
&gt;           at sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:210)
&gt;           at sun.security.util.HostnameChecker.match(HostnameChecker.java:77)
&gt;           at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkIdentity(X509TrustManagerImpl.java:264)
&gt;           at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:250)
&gt;           at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1185)
&gt;             ... 71 more
&gt;
&gt; So, even if i put in the logic to find the hostname and use that as the endpoint instead of hard coding "localhost", there will be case that it will not work.  Sounds like the endpoint HAS to match the CN of the cert.
&gt;

That's correct. You somehow need to know what is the CN of the server cert and use exactly that. Which sounds like a difficult problem.

But then setting a HostNameVerifier is the solution to this problem.

&gt; I then call the following code:
&gt; public static void initialize(Client client, String serverName){
&gt;         if (client == null){
&gt;             client = JERSEY_CLIENT;
&gt;         }
&gt;         try{
&gt;             HTTPSProperties httpsProperties = new HTTPSProperties(new BasicHostnameVerifier( serverName) , SSLContext.getInstance("TLS"));    &lt;======== I have tried SSLContext.getInstance("SSL");  SAME exception as below.
&gt;             client.getProperties().put(HTTPSProperties.PROPERTY_HTTPS_PROPERTIES, httpsProperties);
&gt;         }catch(Exception ex){
&gt;              ex.printStackTrace();
&gt;          }
&gt;     }
&gt;
you may not need the SSLContext.getInstance() call above.  Have you tried setting this hostnameverifier as you have done and  try with the very latest builds of GlassFish. I have checked in code yesterday night. ?

regards,
kumar

&gt;     private static class BasicHostnameVerifier implements HostnameVerifier {
&gt;         private final String host;
&gt;         public BasicHostnameVerifier(String host) {
&gt;             if (host == null)
&gt;                 throw new IllegalArgumentException("null host");
&gt;             this.host = host;
&gt;         }
&gt;         public boolean verify(String s, SSLSession sslSession) {
&gt;             return host.equals(s);
&gt;         }
&gt;     }
&gt;
&gt; This executed without issue, but then the next request GUI sent to REST will result in the following:
&gt;
&gt; Caused by: java.lang.IllegalStateException: SSLContextImpl is not initialized
&gt;     at com.sun.net.ssl.internal.ssl.SSLContextImpl.engineGetSocketFactory(SSLContextImpl.java:145)
&gt;     at javax.net.ssl.SSLContext.getSocketFactory(SSLContext.java:260)
&gt;     at com.sun.jersey.client.urlconnection.HTTPSProperties.setConnection(HTTPSProperties.java:140)
&gt;     at com.sun.jersey.client.urlconnection.URLConnectionClientHandler._invoke(URLConnectionClientHandler.java:166)
&gt;     at com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle(URLConnectionClientHandler.java:129)
&gt;     ... 32 more
&gt;
&gt;
I am not sure what you mean by
&gt;&gt;
&gt;&gt; However the SSLContext that we initialize uses a KeyManager initialized using the "alias" specified by
&gt;&gt; -Dcom.sun.enterprise.security.httpsOutboundKeyAlias=YOUR_ALIAS

&gt; As I have no experience with this area of code,  something that seems trivial to you will not be for me.
&gt; If you can help me modify the above code fragment to do what you think needs to be done,  I really appreciate that.   I do not know how to move forward now.
&gt;
&gt; thanks
&gt; Anissa.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189415-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189415-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189448-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189448&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189448" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189448-hide" href="" onClick="toggleDivsWithCookie('comment-189448-closed', 'comment-189448-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189448" />
    
    
    
                <a id="comment_189448_header_tjquinn" href="/jira/secure/ViewProfile.jspa?name=tjquinn">Tim Quinn</a> added a comment  - <span class=subText><span class=date>07/Jan/11 03:12 PM</span></span>  </div>
    <div class="action-body"><p>Anissa,</p>

<p>I've spent time looking at the code that creates the domain to see exactly how it computes the CN for the certificate to see if there is an easy way to resolve this.  There might not be an easy way that covers 100% of the cases, but there might be one for the vast majority of the cases.</p>

<p>During domain creation, KeystoreManager computes the CN this way:</p>

<p>1. If, on the create-domain command, the user specifies --keytooloptions CN=someValue, then use the specified value.</p>

<p>2. Otherwise, use the value returned from NetUtils.getCanonicalHostName().  </p>

<p>I suspect very few users specify the CN on the create-domain command, so a simple fix for most cases would be for the admin console's host name verifier to accept either localhost or the value from NetUtils.getCanonicalHostName.  </p>

<p>A complete fix now could be for the admin console to retrieve the cert for alias s1as from the keystore, get the X500 principal for the cert, get the DN from the X500 principal, and then parse the DN to get the CN <img class="emoticon" src="/jira/images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/>.  </p>

<p>A better fix - probably for a later release - is for create-domain to persist the user-specified keytooloptions value in domain.xml so the console can use them (if present) to compute the correct host name.  </p> </div>
</div>
</div>


<div id="comment-189448-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189448-show" href="" onClick="toggleDivsWithCookie('comment-189448-open', 'comment-189448-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189448" />
    
    
    
                <a id="comment_189448_header_tjquinn" href="/jira/secure/ViewProfile.jspa?name=tjquinn">Tim Quinn</a> added a comment  - <span class=subText><span class=date>07/Jan/11 03:12 PM</span></span>               Anissa,

I've spent time looking at the code that creates the domain to see exactly how it computes the CN for the certificate to see if there is an easy way to resolve this.  There might not be an easy way that covers 100% of the cases, but there might be one for the vast majority of the cases.

During domain creation, KeystoreManager computes the CN this way:

1. If, on the create-domain command, the user specifies --keytooloptions CN=someValue, then use the specified value.

2. Otherwise, use the value returned from NetUtils.getCanonicalHostName().  

I suspect very few users specify the CN on the create-domain command, so a simple fix for most cases would be for the admin console's host name verifier to accept either localhost or the value from NetUtils.getCanonicalHostName.  

A complete fix now could be for the admin console to retrieve the cert for alias s1as from the keystore, get the X500 principal for the cert, get the DN from the X500 principal, and then parse the DN to get the CN <img class="emoticon" src="/jira/images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/>.  

A better fix - probably for a later release - is for create-domain to persist the user-specified keytooloptions value in domain.xml so the console can use them (if present) to compute the correct host name.       </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189448-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189448-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189454-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189454&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189454" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189454-hide" href="" onClick="toggleDivsWithCookie('comment-189454-closed', 'comment-189454-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189454" />
    
    
    
                <a id="comment_189454_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>07/Jan/11 04:13 PM</span></span>  </div>
    <div class="action-body"><p>Hi Tim,<br/>
Thanks for your time again.<br/>
The exception occurs before it ever called the verify() method in HostnameVerifier.</p>

<p>Once these 2 lines is executed:<br/>
           HTTPSProperties httpsProperties = new HTTPSProperties(new BasicHostnameVerifier( serverName) );<br/>
            client.getProperties().put(HTTPSProperties.PROPERTY_HTTPS_PROPERTIES, httpsProperties);</p>

<p>the next request will get an exception. </p>

<p>Caused by: java.lang.IllegalStateException: SSLContextImpl is not initialized <br/>
at com.sun.net.ssl.internal.ssl.SSLContextImpl.engineGetSocketFactory(SSLContextImpl.java:145) <br/>
at javax.net.ssl.SSLContext.getSocketFactory(SSLContext.java:260) <br/>
at com.sun.jersey.client.urlconnection.HTTPSProperties.setConnection(HTTPSProperties.java:140) <br/>
at com.sun.jersey.client.urlconnection.URLConnectionClientHandler._invoke(URLConnectionClientHandler.java:166) <br/>
at com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle(URLConnectionClientHandler.java:129) <br/>
... 32 more </p>
 </div>
</div>
</div>


<div id="comment-189454-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189454-show" href="" onClick="toggleDivsWithCookie('comment-189454-open', 'comment-189454-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189454" />
    
    
    
                <a id="comment_189454_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>07/Jan/11 04:13 PM</span></span>               Hi Tim,
Thanks for your time again.
The exception occurs before it ever called the verify() method in HostnameVerifier.

Once these 2 lines is executed:
           HTTPSProperties httpsProperties = new HTTPSProperties(new BasicHostnameVerifier( serverName) );
            client.getProperties().put(HTTPSProperties.PROPERTY_HTTPS_PROPERTIES, httpsProperties);

the next request will get an exception. 

Caused by: java.lang.IllegalStateException: SSLContextImpl is not initialized 
at com.sun.net.ssl.internal.ssl.SSLContextImpl.engineGetSocketFactory(SSLContextImpl.java:145) 
at javax.net.ssl.SSLContext.getSocketFactory(SSLContext.java:260) 
at com.sun.jersey.client.urlconnection.HTTPSProperties.setConnection(HTTPSProperties.java:140) 
at com.sun.jersey.client.urlconnection.URLConnectionClientHandler._invoke(URLConnectionClientHandler.java:166) 
at com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle(URLConnectionClientHandler.java:129) 
... 32 more 
     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189454-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189454-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189457-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189457&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189457" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189457-hide" href="" onClick="toggleDivsWithCookie('comment-189457-closed', 'comment-189457-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189457" />
    
    
    
                <a id="comment_189457_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>07/Jan/11 04:36 PM</span></span>  </div>
    <div class="action-body"><p>One more hurdle that needs to jump through is that,  I don't even have the 'client' to set the HTTPSPproperties.</p>

<p>The work flow in the AdminConsoleAuthModule is:</p>

<p>1.  when first launching GUI, ensure authentication, which means show the login page.<br/>
2.  Before loading the login page,  we have code to call  REST-endpoint/anonymous-login-enabled <br/>
3.  if authenticated  (with or without password)<br/>
4.  Login succeed,   create a client.</p>

<p>so, before step 2, we should have the hostname verifier setup,  since we need to call REST to see if anonymous login is enabled.  But the client hasn't created yet.</p>

<p>The code that i have been trying is using a debugger to force the REST-endpoint/anonymous-login-enabled to match the CN so i can go pass it. </p>

<p>I am attaching the 2 files AdminConsoleAuthModule and RestUtil that has my experimental code.</p>

<p>For AdminConsoleAuthModule,  at line #196, <br/>
		rd.forward(request, response);<br/>
is the line that will try to load the login page.</p>

<p>line# 218<br/>
   	ClientResponse resp = webResource.accept(RESPONSE_TYPE).post(ClientResponse.class);</p>

<p>is when the above exception occurs.</p>

<p>The hostname Verifier code can be found at the end of RestUtil.java</p>

 </div>
</div>
</div>


<div id="comment-189457-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189457-show" href="" onClick="toggleDivsWithCookie('comment-189457-open', 'comment-189457-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189457" />
    
    
    
                <a id="comment_189457_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>07/Jan/11 04:36 PM</span></span>               One more hurdle that needs to jump through is that,  I don't even have the 'client' to set the HTTPSPproperties.

The work flow in the AdminConsoleAuthModule is:

1.  when first launching GUI, ensure authentication, which means show the login page.
2.  Before loading the login page,  we have code to call  REST-endpoint/anonymous-login-enabled 
3.  if authenticated  (with or without password)
4.  Login succeed,   create a client.

so, before step 2, we should have the hostname verifier setup,  since we need to call REST to see if anonymous login is enabled.  But the client hasn't created yet.

The code that i have been trying is using a debugger to force the REST-endpoint/anonymous-login-enabled to match the CN so i can go pass it. 

I am attaching the 2 files AdminConsoleAuthModule and RestUtil that has my experimental code.

For AdminConsoleAuthModule,  at line #196, 
		rd.forward(request, response);
is the line that will try to load the login page.

line# 218
   	ClientResponse resp = webResource.accept(RESPONSE_TYPE).post(ClientResponse.class);

is when the above exception occurs.

The hostname Verifier code can be found at the end of RestUtil.java

     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189457-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189457-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189462-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189462&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189462" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189462-hide" href="" onClick="toggleDivsWithCookie('comment-189462-closed', 'comment-189462-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189462" />
    
    
    
                <a id="comment_189462_header_tjquinn" href="/jira/secure/ViewProfile.jspa?name=tjquinn">Tim Quinn</a> added a comment  - <span class=subText><span class=date>07/Jan/11 06:57 PM</span></span>  </div>
    <div class="action-body"><p>Earlier in the separate e-mail thread I suggested that the console might need to initialize the HTTPSProperties object differently.  I've pasted part of that message next.</p>

<p>When the caller does not specify an SSLContext on the HTTPSProperties constructor, Jersey (according to its JavaDoc) tries to get a normal default one.  Judging from the last part of the stack trace, the SSLContext it gets is not set up.</p>

<p>A possible quick solution worth trying is to instantiate HTTPProperties this way:</p>

<p>@Inject<br/>
private SSLUtils sslUtils;  // from the security/core module, I think</p>

<p>@Inject<br/>
private Habitat habitat;</p>


<p>SecureAdmin secureAdmin = habitat.getComponent(SecureAdmin.class);<br/>
String dasAlias = SecureAdmin.Util.getDasAlias(secureAdmin);</p>

<p>new HTTPProperties(new BasicHostnameVerifier(serverName), sslUtils.getAdminSSLContext(dasAlias, null));</p> </div>
</div>
</div>


<div id="comment-189462-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189462-show" href="" onClick="toggleDivsWithCookie('comment-189462-open', 'comment-189462-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189462" />
    
    
    
                <a id="comment_189462_header_tjquinn" href="/jira/secure/ViewProfile.jspa?name=tjquinn">Tim Quinn</a> added a comment  - <span class=subText><span class=date>07/Jan/11 06:57 PM</span></span>               Earlier in the separate e-mail thread I suggested that the console might need to initialize the HTTPSProperties object differently.  I've pasted part of that message next.

When the caller does not specify an SSLContext on the HTTPSProperties constructor, Jersey (according to its JavaDoc) tries to get a normal default one.  Judging from the last part of the stack trace, the SSLContext it gets is not set up.

A possible quick solution worth trying is to instantiate HTTPProperties this way:

@Inject
private SSLUtils sslUtils;  // from the security/core module, I think

@Inject
private Habitat habitat;


SecureAdmin secureAdmin = habitat.getComponent(SecureAdmin.class);
String dasAlias = SecureAdmin.Util.getDasAlias(secureAdmin);

new HTTPProperties(new BasicHostnameVerifier(serverName), sslUtils.getAdminSSLContext(dasAlias, null));     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189462-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189462-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189514-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189514&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189514" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189514-hide" href="" onClick="toggleDivsWithCookie('comment-189514-closed', 'comment-189514-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189514" />
    
    
    
                <a id="comment_189514_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>09/Jan/11 11:26 PM</span></span>  </div>
    <div class="action-body"><p>I followed the steps on my MAC,  if i test with Jan-7th workspace I am seeing the following in GUI after accepting the Certificates in the Browser :</p>

<p>URL : <span class="nobr"><a href="https://localhost:4848/common/index.jsf">https://localhost:4848/common/index.jsf<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span></p>

<p>Internal Server Error - Read</p>

<p>The server encountered an internal error or misconfiguration and was unable to complete your request.<br/>
Reference #3.4fe2fc7d.1294643868.ddbf42</p>

<p>And there is nothing at all in the logs.  the last message in admin GUI is :</p>


<p><span class="error">&#91;#|2011-01-10T12:44:44.799+0530|WARNING|glassfish3.1|org.glassfish.admingui|_ThreadID=25;_ThreadName=Thread-1;|Cannot create update center Image for /Users/vbkumarjayanti/Documents/workspace/glassfish/glassfish3; Update Center functionality will not be available in Admin Console|#&#93;</span></p>



<p>I do not have a windows system and i am wondering in what way i can help this issue.</p>
 </div>
</div>
</div>


<div id="comment-189514-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189514-show" href="" onClick="toggleDivsWithCookie('comment-189514-open', 'comment-189514-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189514" />
    
    
    
                <a id="comment_189514_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>09/Jan/11 11:26 PM</span></span>               I followed the steps on my MAC,  if i test with Jan-7th workspace I am seeing the following in GUI after accepting the Certificates in the Browser :

URL : <span class="nobr"><a href="https://localhost:4848/common/index.jsf">https://localhost:4848/common/index.jsf<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>

Internal Server Error - Read

The server encountered an internal error or misconfiguration and was unable to complete your request.
Reference #3.4fe2fc7d.1294643868.ddbf42

And there is nothing at all in the logs.  the last message in admin GUI is :


<span class="error">&#91;#|2011-01-10T12:44:44.799+0530|WARNING|glassfish3.1|org.glassfish.admingui|_ThreadID=25;_ThreadName=Thread-1;|Cannot create update center Image for /Users/vbkumarjayanti/Documents/workspace/glassfish/glassfish3; Update Center functionality will not be available in Admin Console|#&#93;</span>



I do not have a windows system and i am wondering in what way i can help this issue.
     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189514-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189514-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189517-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189517&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189517" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189517-hide" href="" onClick="toggleDivsWithCookie('comment-189517-closed', 'comment-189517-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189517" />
    
    
    
                <a id="comment_189517_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 01:03 AM</span></span>  </div>
    <div class="action-body"><p>With latest builds on my MAC everything works fine. The exception being reported in the issue relates to hostname verification and it cannot be Windows specific right ?</p>

<p>Caused by: java.security.cert.CertificateException: No name matching localhost f <br/>
ound <br/>
        at sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:210) </p>

<p>So has this issue been fixed ?. Can i close the issue. </p>

<p>Please add a description of how this has been fixed.</p> </div>
</div>
</div>


<div id="comment-189517-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189517-show" href="" onClick="toggleDivsWithCookie('comment-189517-open', 'comment-189517-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189517" />
    
    
    
                <a id="comment_189517_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 01:03 AM</span></span>               With latest builds on my MAC everything works fine. The exception being reported in the issue relates to hostname verification and it cannot be Windows specific right ?

Caused by: java.security.cert.CertificateException: No name matching localhost f 
ound 
        at sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:210) 

So has this issue been fixed ?. Can i close the issue. 

Please add a description of how this has been fixed.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189517-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189517-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189518-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189518&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189518" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189518-hide" href="" onClick="toggleDivsWithCookie('comment-189518-closed', 'comment-189518-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189518" />
    
    
    
                <a id="comment_189518_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 01:07 AM</span></span>  </div>
    <div class="action-body"><p>ignore my last two comments, i realized that the issue only comes when a Domain is created with CN=FQDN and not with default domain in  the zip installed glassfish.</p> </div>
</div>
</div>


<div id="comment-189518-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189518-show" href="" onClick="toggleDivsWithCookie('comment-189518-open', 'comment-189518-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189518" />
    
    
    
                <a id="comment_189518_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 01:07 AM</span></span>               ignore my last two comments, i realized that the issue only comes when a Domain is created with CN=FQDN and not with default domain in  the zip installed glassfish.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189518-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189518-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189522-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189522&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189522" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189522-hide" href="" onClick="toggleDivsWithCookie('comment-189522-closed', 'comment-189522-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189522" />
    
    
    
                <a id="comment_189522_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 02:06 AM</span></span>  </div>
    <div class="action-body"><p>I added the following code to admingui/common/..../RestUtil.java</p>


<p>Index: src/main/java/org/glassfish/admingui/common/util/RestUtil.java<br/>
===================================================================<br/>
&#8212; src/main/java/org/glassfish/admingui/common/util/RestUtil.java	(revision 44351)<br/>
+++ src/main/java/org/glassfish/admingui/common/util/RestUtil.java	(working copy)<br/>
@@ -45,6 +45,8 @@</p>

<p> package org.glassfish.admingui.common.util;</p>

<p>+import javax.net.ssl.HostnameVerifier;<br/>
+import javax.net.ssl.SSLSession;<br/>
 import com.sun.jersey.api.client.Client;<br/>
 import com.sun.jersey.api.client.ClientResponse;<br/>
 import com.sun.jersey.api.client.WebResource;<br/>
@@ -93,6 +95,21 @@<br/>
     private static final String REST_TOKEN_COOKIE = "gfresttoken";</p>


<p>+    static {<br/>
+<br/>
+      javax.net.ssl.HttpsURLConnection.setDefaultHostnameVerifier(<br/>
+          new HostnameVerifier() {<br/>
+        public boolean verify(String host, SSLSession sslSession) {<br/>
+            if (host.equals("localhost")) {
+                return true;
+            }<br/>
+            return host.equals(sslSession.getPeerHost());<br/>
+        }<br/>
+<br/>
+      });<br/>
+    }<br/>
+<br/>
+<br/>
     public static String getPropValue(String endpoint, String propName, HandlerContext handlerCtx){</p>

<p>    }</p>

<p>This fixes the problem, the AdminGUI loads up fine . Like i said before with the latest builds you should not see the SSLContext not initialized problem.</p>

<p>Now on my MAC when i tried to print the Certificate of domain1 it shows :</p>

<p>CN=dhcp-cblr03-213-110.india.sun.com</p>


<p>But within the verify method i put a System.out  of the following form  :<br/>
 System.out.println("host=" + host + " sslSession.getPeerHost()=" + sslSession.getPeerHost());</p>

<p>I see the following in server.log :<br/>
<span class="error">&#91;#|2011-01-10T15:28:21.244+0530|INFO|glassfish3.1|javax.enterprise.system.std.com.sun.enterprise.server.logging|_ThreadID=90;_ThreadName=Thread-1;|host=localhost sslSession.getPeerHost()=localhost|#&#93;</span></p>

<p>IOW commenting the following code :</p>

<p>+  if (host.equals("localhost")) {
+                return true;
+   }</p>

<p>from the hostnameverifier still makes it work.</p>

<p>I would request you guys to just carefully experiment what the code in the verify method should be and make the final fix.</p>

<p>reassigning the Bug to Anissa, so she can reassign it to appropriate person.</p>

 </div>
</div>
</div>


<div id="comment-189522-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189522-show" href="" onClick="toggleDivsWithCookie('comment-189522-open', 'comment-189522-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189522" />
    
    
    
                <a id="comment_189522_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 02:06 AM</span></span>               I added the following code to admingui/common/..../RestUtil.java


Index: src/main/java/org/glassfish/admingui/common/util/RestUtil.java
===================================================================
&#8212; src/main/java/org/glassfish/admingui/common/util/RestUtil.java	(revision 44351)
+++ src/main/java/org/glassfish/admingui/common/util/RestUtil.java	(working copy)
@@ -45,6 +45,8 @@

 package org.glassfish.admingui.common.util;

+import javax.net.ssl.HostnameVerifier;
+import javax.net.ssl.SSLSession;
 import com.sun.jersey.api.client.Client;
 import com.sun.jersey.api.client.ClientResponse;
 import com.sun.jersey.api.client.WebResource;
@@ -93,6 +95,21 @@
     private static final String REST_TOKEN_COOKIE = "gfresttoken";


+    static {
+
+      javax.net.ssl.HttpsURLConnection.setDefaultHostnameVerifier(
+          new HostnameVerifier() {
+        public boolean verify(String host, SSLSession sslSession) {
+            if (host.equals("localhost")) {
+                return true;
+            }
+            return host.equals(sslSession.getPeerHost());
+        }
+
+      });
+    }
+
+
     public static String getPropValue(String endpoint, String propName, HandlerContext handlerCtx){

    }

This fixes the problem, the AdminGUI loads up fine . Like i said before with the latest builds you should not see the SSLContext not initialized problem.

Now on my MAC when i tried to print the Certificate of domain1 it shows :

CN=dhcp-cblr03-213-110.india.sun.com


But within the verify method i put a System.out  of the following form  :
 System.out.println("host=" + host + " sslSession.getPeerHost()=" + sslSession.getPeerHost());

I see the following in server.log :
<span class="error">&#91;#|2011-01-10T15:28:21.244+0530|INFO|glassfish3.1|javax.enterprise.system.std.com.sun.enterprise.server.logging|_ThreadID=90;_ThreadName=Thread-1;|host=localhost sslSession.getPeerHost()=localhost|#&#93;</span>

IOW commenting the following code :

+  if (host.equals("localhost")) {
+                return true;
+   }

from the hostnameverifier still makes it work.

I would request you guys to just carefully experiment what the code in the verify method should be and make the final fix.

reassigning the Bug to Anissa, so she can reassign it to appropriate person.

     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189522-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189522-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189552-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189552&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189552" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189552-hide" href="" onClick="toggleDivsWithCookie('comment-189552-closed', 'comment-189552-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189552" />
    
    
    
                <a id="comment_189552_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 08:20 AM</span></span>  </div>
    <div class="action-body"><p>Thanks Kumar for helping out.<br/>
I have tried your suggestion and tested it for different scenario and it is working fine.<br/>
I will do more testing and request for approval for fixing this.</p> </div>
</div>
</div>


<div id="comment-189552-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189552-show" href="" onClick="toggleDivsWithCookie('comment-189552-open', 'comment-189552-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189552" />
    
    
    
                <a id="comment_189552_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 08:20 AM</span></span>               Thanks Kumar for helping out.
I have tried your suggestion and tested it for different scenario and it is working fine.
I will do more testing and request for approval for fixing this.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189552-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189552-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189571-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189571&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189571" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189571-hide" href="" onClick="toggleDivsWithCookie('comment-189571-closed', 'comment-189571-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189571" />
    
    
    
                <a id="comment_189571_header_tjquinn" href="/jira/secure/ViewProfile.jspa?name=tjquinn">Tim Quinn</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:06 AM</span></span>  </div>
    <div class="action-body"><p>Are we sure we want to set the default hostname verifier?  This will affect the hostname verifier for all URL connections?</p>

<p>There should be a way for this part of the GUI code to set the hostname verifier and the SSL socket factory if needed for just its connection, not as the default, right?</p> </div>
</div>
</div>


<div id="comment-189571-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189571-show" href="" onClick="toggleDivsWithCookie('comment-189571-open', 'comment-189571-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189571" />
    
    
    
                <a id="comment_189571_header_tjquinn" href="/jira/secure/ViewProfile.jspa?name=tjquinn">Tim Quinn</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:06 AM</span></span>               Are we sure we want to set the default hostname verifier?  This will affect the hostname verifier for all URL connections?

There should be a way for this part of the GUI code to set the hostname verifier and the SSL socket factory if needed for just its connection, not as the default, right?     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189571-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189571-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189651-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189651&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189651" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189651-hide" href="" onClick="toggleDivsWithCookie('comment-189651-closed', 'comment-189651-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189651" />
    
    
    
                <a id="comment_189651_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 06:07 PM</span></span>  </div>
    <div class="action-body"><p>Tim is right.</p>

<p>What i did was just experimental to prove that setting a hostnameverifier is the final solution to this problem.</p>

<p>If Rest API's provides a way to set it for the connection we should continue to use that. I believe Anissa was already doing that, i don't want it to be changed to this form.</p>

<p>The first thing the hostnameverifier should do is check if host == CN of the server certificate (this can be retrieved from SSLSession object passed).  If that check returns false then we can try to relax it by the check i put above host.equals(sslSession.getPeerHost()). You could get the base code from JDK's default HostnameVerifier and then add these additional checks to relax the constraints.</p>

 </div>
</div>
</div>


<div id="comment-189651-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189651-show" href="" onClick="toggleDivsWithCookie('comment-189651-open', 'comment-189651-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189651" />
    
    
    
                <a id="comment_189651_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 06:07 PM</span></span>               Tim is right.

What i did was just experimental to prove that setting a hostnameverifier is the final solution to this problem.

If Rest API's provides a way to set it for the connection we should continue to use that. I believe Anissa was already doing that, i don't want it to be changed to this form.

The first thing the hostnameverifier should do is check if host == CN of the server certificate (this can be retrieved from SSLSession object passed).  If that check returns false then we can try to relax it by the check i put above host.equals(sslSession.getPeerHost()). You could get the base code from JDK's default HostnameVerifier and then add these additional checks to relax the constraints.

     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189651-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189651-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189654-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189654&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189654" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189654-hide" href="" onClick="toggleDivsWithCookie('comment-189654-closed', 'comment-189654-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189654" />
    
    
    
                <a id="comment_189654_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 06:24 PM</span></span>  </div>
    <div class="action-body"><p>Thats true, the hostname verifier is able to resolve the problem.<br/>
Based on everyone's input including Tim, Abhijit, Mitesh and Kumar,  I have the following code and tested that it seems to be working fine in all different scenario.   I have given the patch to Shaline to test out as well.   Once she confirms that it is working as expected,  I will send the approval request and formal review.</p>

<p>Here is my latest code, and seems to be working.</p>

<p> public static void initialize(Client client){<br/>
            if (client == null){
                client = JERSEY_CLIENT;
            }<br/>
            try{
                Habitat habitat = SecurityServicesUtil.getInstance().getHabitat();
                SecureAdmin secureAdmin = habitat.getComponent(SecureAdmin.class);
                HTTPSProperties httpsProperties = new HTTPSProperties(new BasicHostnameVerifier(),
                    habitat.getComponent(SSLUtils.class).getAdminSSLContext(SecureAdmin.Util.DASAlias(secureAdmin), null )); 
                client.getProperties().put(HTTPSProperties.PROPERTY_HTTPS_PROPERTIES, httpsProperties);
            }catch(Exception ex){
                 ex.printStackTrace();
            }<br/>
    }</p>

<p>    private static class BasicHostnameVerifier implements HostnameVerifier {<br/>
        public BasicHostnameVerifier() {<br/>
        }<br/>
        public boolean verify(String s, SSLSession sslSession) {
            return true;
        }<br/>
        public boolean verify(String s) {
            return true;
        } }<br/>
    }</p> </div>
</div>
</div>


<div id="comment-189654-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189654-show" href="" onClick="toggleDivsWithCookie('comment-189654-open', 'comment-189654-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189654" />
    
    
    
                <a id="comment_189654_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 06:24 PM</span></span>               Thats true, the hostname verifier is able to resolve the problem.
Based on everyone's input including Tim, Abhijit, Mitesh and Kumar,  I have the following code and tested that it seems to be working fine in all different scenario.   I have given the patch to Shaline to test out as well.   Once she confirms that it is working as expected,  I will send the approval request and formal review.

Here is my latest code, and seems to be working.

 public static void initialize(Client client){
            if (client == null){
                client = JERSEY_CLIENT;
            }
            try{
                Habitat habitat = SecurityServicesUtil.getInstance().getHabitat();
                SecureAdmin secureAdmin = habitat.getComponent(SecureAdmin.class);
                HTTPSProperties httpsProperties = new HTTPSProperties(new BasicHostnameVerifier(),
                    habitat.getComponent(SSLUtils.class).getAdminSSLContext(SecureAdmin.Util.DASAlias(secureAdmin), null )); 
                client.getProperties().put(HTTPSProperties.PROPERTY_HTTPS_PROPERTIES, httpsProperties);
            }catch(Exception ex){
                 ex.printStackTrace();
            }
    }

    private static class BasicHostnameVerifier implements HostnameVerifier {
        public BasicHostnameVerifier() {
        }
        public boolean verify(String s, SSLSession sslSession) {
            return true;
        }
        public boolean verify(String s) {
            return true;
        } }
    }     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189654-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189654-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189655-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189655&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189655" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189655-hide" href="" onClick="toggleDivsWithCookie('comment-189655-closed', 'comment-189655-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189655" />
    
    
    
                <a id="comment_189655_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 06:33 PM</span></span>  </div>
    <div class="action-body"><p>One more thing, I see that the REST code test if secure admin is enabled before adding the hostname verifier.   I am going to do the same.   But even if i set that up,  it won't be called if secure admin is not enabled,  is that correct ?</p>
 </div>
</div>
</div>


<div id="comment-189655-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189655-show" href="" onClick="toggleDivsWithCookie('comment-189655-open', 'comment-189655-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189655" />
    
    
    
                <a id="comment_189655_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 06:33 PM</span></span>               One more thing, I see that the REST code test if secure admin is enabled before adding the hostname verifier.   I am going to do the same.   But even if i set that up,  it won't be called if secure admin is not enabled,  is that correct ?
     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189655-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189655-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189656-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189656&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189656" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189656-hide" href="" onClick="toggleDivsWithCookie('comment-189656-closed', 'comment-189656-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189656" />
    
                                                
    
                <a id="comment_189656_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 06:50 PM</span></span>   - <span class="redText subText" title="kumarjayanti - 10/Jan/11 06:51 PM">edited</span> </div>
    <div class="action-body"><p>hostnameverifier won't be invoked unless https is used for accessing admin.</p>

<p>The code for verify methods does not seem appropriate. Please consider using the following :</p>

<p>final HostnameVerifier defaultVerifier =<br/>
                javax.net.ssl.HttpsURLConnection.getDefaultHostnameVerifier();</p>

<p> public boolean verify(String host, SSLSession sslSession) {</p>

<p>                        boolean result = defaultVerifier.verify(host, sslSession);<br/>
                        if (!result) {
                            result = host.equals(sslSession.getPeerHost());
                        }<br/>
                        if (!result) {<br/>
                            if (host.equals("localhost")) {
                                result = true;
                            }<br/>
                        }<br/>
                        return result;</p>

<p>                    }</p>


<p>Also the javax.net.ssl.HostnameVerifier has a single method :</p>

<p>boolean verify(String hostname,  SSLSession session)</p>

<p>So why do you need the second method verify(String s) there ?.</p>


 </div>
</div>
</div>


<div id="comment-189656-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189656-show" href="" onClick="toggleDivsWithCookie('comment-189656-open', 'comment-189656-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189656" />
    
                                                
    
                <a id="comment_189656_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 06:50 PM</span></span>   - <span class="redText subText" title="kumarjayanti - 10/Jan/11 06:51 PM">edited</span>              hostnameverifier won't be invoked unless https is used for accessing admin.

The code for verify methods does not seem appropriate. Please consider using the following :

final HostnameVerifier defaultVerifier =
                javax.net.ssl.HttpsURLConnection.getDefaultHostnameVerifier();

 public boolean verify(String host, SSLSession sslSession) {

                        boolean result = defaultVerifier.verify(host, sslSession);
                        if (!result) {
                            result = host.equals(sslSession.getPeerHost());
                        }
                        if (!result) {
                            if (host.equals("localhost")) {
                                result = true;
                            }
                        }
                        return result;

                    }


Also the javax.net.ssl.HostnameVerifier has a single method :

boolean verify(String hostname,  SSLSession session)

So why do you need the second method verify(String s) there ?.


     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189656-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189656-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189666-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189666&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189666" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189666-hide" href="" onClick="toggleDivsWithCookie('comment-189666-closed', 'comment-189666-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189666" />
    
    
    
                <a id="comment_189666_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 08:06 PM</span></span>  </div>
    <div class="action-body"><p>I tried changing to what you suggested above.   GUI works fine too.</p>

<p>I just notice one issue.   Although GUI works fine,   if i go to <br/>
<span class="nobr"><a href="http://localhost:4848/management/domain">http://localhost:4848/management/domain<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span> in the browser,  <br/>
I will get this exception.   This happens both before and after changing to what u suggest for verify().</p>

<p>[#|2011-01-10T19:58:22.412-0800|WARNING|glassfish3.1|com.sun.grizzly.config.GrizzlyServiceListener|_ThreadID=27;_ThreadName=admin-thread-pool-4848(27);|processorTask.exceptionSSLcert<br/>
javax.net.ssl.SSLHandshakeException: Insecure renegotiation is not allowed<br/>
	at com.sun.net.ssl.internal.ssl.SSLEngineImpl.kickstartHandshake(SSLEngineImpl.java:635)<br/>
	at com.sun.net.ssl.internal.ssl.SSLEngineImpl.beginHandshake(SSLEngineImpl.java:689)<br/>
	at com.sun.grizzly.util.SSLUtils.doPeerCertificateChain(SSLUtils.java:559)<br/>
	at com.sun.grizzly.filter.SSLReadFilter.doPeerCertificateChain(SSLReadFilter.java:340)<br/>
	at com.sun.grizzly.ssl.SSLProcessorTask.action(SSLProcessorTask.java:153)<br/>
	at com.sun.grizzly.tcp.Request.action(Request.java:430)<br/>
	at com.sun.grizzly.tcp.http11.GrizzlyRequest.getAttribute(GrizzlyRequest.java:835)<br/>
	at com.sun.grizzly.tcp.http11.GrizzlyRequest.getUserPrincipal(GrizzlyRequest.java:1834)<br/>
	at org.glassfish.admin.rest.adapter.RestAdapter.authenticateViaAdminRealm(RestAdapter.java:304)<br/>
	at org.glassfish.admin.rest.adapter.RestAdapter.authenticate(RestAdapter.java:227)<br/>
	at org.glassfish.admin.rest.adapter.RestAdapter.service(RestAdapter.java:163)<br/>
	at com.sun.grizzly.tcp.http11.GrizzlyAdapter.service(GrizzlyAdapter.java:168)<br/>
	at com.sun.enterprise.v3.server.HK2Dispatcher.dispath(HK2Dispatcher.java:117)<br/>
	at com.sun.enterprise.v3.services.impl.ContainerMapper.service(ContainerMapper.java:234)<br/>
	at com.sun.grizzly.http.ProcessorTask.invokeAdapter(ProcessorTask.java:818)<br/>
	at com.sun.grizzly.http.ProcessorTask.doProcess(ProcessorTask.java:719)<br/>
	at com.sun.grizzly.http.ProcessorTask.process(ProcessorTask.java:1008)<br/>
	at com.sun.grizzly.http.DefaultProtocolFilter.execute(DefaultProtocolFilter.java:225)<br/>
	at com.sun.grizzly.DefaultProtocolChain.executeProtocolFilter(DefaultProtocolChain.java:137)<br/>
	at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.java:104)<br/>
	at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.java:90)<br/>
	at com.sun.grizzly.http.HttpProtocolChain.execute(HttpProtocolChain.java:79)<br/>
	at com.sun.grizzly.ProtocolChainContextTask.doCall(ProtocolChainContextTask.java:54)<br/>
	at com.sun.grizzly.SelectionKeyContextTask.call(SelectionKeyContextTask.java:59)<br/>
	at com.sun.grizzly.ContextTask.run(ContextTask.java:71)<br/>
	at com.sun.grizzly.util.AbstractThreadPool$Worker.doWork(AbstractThreadPool.java:532)<br/>
	at com.sun.grizzly.util.AbstractThreadPool$Worker.run(AbstractThreadPool.java:513)<br/>
	at java.lang.Thread.run(Thread.java:680)</p>
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'>#]</td>
</tr>
</tbody></table> </div>
</div>
</div>


<div id="comment-189666-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189666-show" href="" onClick="toggleDivsWithCookie('comment-189666-open', 'comment-189666-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189666" />
    
    
    
                <a id="comment_189666_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 08:06 PM</span></span>               I tried changing to what you suggested above.   GUI works fine too.

I just notice one issue.   Although GUI works fine,   if i go to 
<span class="nobr"><a href="http://localhost:4848/management/domain">http://localhost:4848/management/domain<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span> in the browser,  
I will get this exception.   This happens both before and after changing to what u suggest for verify().

[#|2011-01-10T19:58:22.412-0800|WARNING|glassfish3.1|com.sun.grizzly.config.GrizzlyServiceListener|_ThreadID=27;_ThreadName=admin-thread-pool-4848(27);|processorTask.exceptionSSLcert
javax.net.ssl.SSLHandshakeException: Insecure renegotiation is not allowed
	at com.sun.net.ssl.internal.ssl.SSLEngineImpl.kickstartHandshake(SSLEngineImpl.java:635)
	at com.sun.net.ssl.internal.ssl.SSLEngineImpl.beginHandshake(SSLEngineImpl.java:689)
	at com.sun.grizzly.util.SSLUtils.doPeerCertificateChain(SSLUtils.java:559)
	at com.sun.grizzly.filter.SSLReadFilter.doPeerCertificateChain(SSLReadFilter.java:340)
	at com.sun.grizzly.ssl.SSLProcessorTask.action(SSLProcessorTask.java:153)
	at com.sun.grizzly.tcp.Request.action(Request.java:430)
	at com.sun.grizzly.tcp.http11.GrizzlyRequest.getAttribute(GrizzlyRequest.java:835)
	at com.sun.grizzly.tcp.http11.GrizzlyRequest.getUserPrincipal(GrizzlyRequest.java:1834)
	at org.glassfish.admin.rest.adapter.RestAdapter.authenticateViaAdminRealm(RestAdapter.java:304)
	at org.glassfish.admin.rest.adapter.RestAdapter.authenticate(RestAdapter.java:227)
	at org.glassfish.admin.rest.adapter.RestAdapter.service(RestAdapter.java:163)
	at com.sun.grizzly.tcp.http11.GrizzlyAdapter.service(GrizzlyAdapter.java:168)
	at com.sun.enterprise.v3.server.HK2Dispatcher.dispath(HK2Dispatcher.java:117)
	at com.sun.enterprise.v3.services.impl.ContainerMapper.service(ContainerMapper.java:234)
	at com.sun.grizzly.http.ProcessorTask.invokeAdapter(ProcessorTask.java:818)
	at com.sun.grizzly.http.ProcessorTask.doProcess(ProcessorTask.java:719)
	at com.sun.grizzly.http.ProcessorTask.process(ProcessorTask.java:1008)
	at com.sun.grizzly.http.DefaultProtocolFilter.execute(DefaultProtocolFilter.java:225)
	at com.sun.grizzly.DefaultProtocolChain.executeProtocolFilter(DefaultProtocolChain.java:137)
	at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.java:104)
	at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.java:90)
	at com.sun.grizzly.http.HttpProtocolChain.execute(HttpProtocolChain.java:79)
	at com.sun.grizzly.ProtocolChainContextTask.doCall(ProtocolChainContextTask.java:54)
	at com.sun.grizzly.SelectionKeyContextTask.call(SelectionKeyContextTask.java:59)
	at com.sun.grizzly.ContextTask.run(ContextTask.java:71)
	at com.sun.grizzly.util.AbstractThreadPool$Worker.doWork(AbstractThreadPool.java:532)
	at com.sun.grizzly.util.AbstractThreadPool$Worker.run(AbstractThreadPool.java:513)
	at java.lang.Thread.run(Thread.java:680)
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'>#]</td>
</tr>
</tbody></table>     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189666-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189666-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189668-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189668&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189668" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189668-hide" href="" onClick="toggleDivsWithCookie('comment-189668-closed', 'comment-189668-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189668" />
    
    
    
                <a id="comment_189668_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 08:37 PM</span></span>  </div>
    <div class="action-body"><p>I also see this exception once or twice when i try to deploy an application.<br/>
During all my testing,  i saw this only 2 times out of over 30 times.</p>

<p>[#|2011-01-10T20:32:40.794-0800|SEVERE|glassfish3.1|com.sun.grizzly.config.GrizzlyServiceListener|_ThreadID=25;_ThreadName=admin-thread-pool-4848(43);|GRIZZLY0040: Request header is too large.<br/>
java.nio.BufferOverflowException<br/>
	at com.sun.grizzly.tcp.http11.InternalInputBuffer.fill(InternalInputBuffer.java:765)<br/>
	at com.sun.grizzly.tcp.http11.InternalInputBuffer.parseHeader(InternalInputBuffer.java:615)<br/>
	at com.sun.grizzly.tcp.http11.InternalInputBuffer.parseHeaders(InternalInputBuffer.java:555)<br/>
	at com.sun.grizzly.http.ProcessorTask.parseRequest(ProcessorTask.java:871)<br/>
	at com.sun.grizzly.http.ProcessorTask.doProcess(ProcessorTask.java:692)<br/>
	at com.sun.grizzly.http.ProcessorTask.process(ProcessorTask.java:1008)<br/>
	at com.sun.grizzly.http.DefaultProtocolFilter.execute(DefaultProtocolFilter.java:225)<br/>
	at com.sun.grizzly.DefaultProtocolChain.executeProtocolFilter(DefaultProtocolChain.java:137)<br/>
	at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.java:104)<br/>
	at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.java:90)<br/>
	at com.sun.grizzly.http.HttpProtocolChain.execute(HttpProtocolChain.java:79)<br/>
	at com.sun.grizzly.ProtocolChainContextTask.doCall(ProtocolChainContextTask.java:54)<br/>
	at com.sun.grizzly.SelectionKeyContextTask.call(SelectionKeyContextTask.java:59)<br/>
	at com.sun.grizzly.ContextTask.run(ContextTask.java:71)<br/>
	at com.sun.grizzly.util.AbstractThreadPool$Worker.doWork(AbstractThreadPool.java:532)<br/>
	at com.sun.grizzly.util.AbstractThreadPool$Worker.run(AbstractThreadPool.java:513)<br/>
	at java.lang.Thread.run(Thread.java:680)</p>
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'>#]</td>
</tr>
</tbody></table>

<p>and the browser will show:<br/>
Secure Connection Failed</p>

<p>An error occurred during a connection to localhost:4848.</p>

<p>SSL received a record that exceeded the maximum permissible length.</p>

<p>(Error code: ssl_error_rx_record_too_long)</p>

<ul>
	<li>The page you are trying to view can not be shown because the authenticity of the received data could not be verified.</li>
</ul>


<ul>
	<li>Please contact the web site owners to inform them of this problem. Alternatively, use the command found in the help menu to report this broken site.</li>
</ul>

 </div>
</div>
</div>


<div id="comment-189668-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189668-show" href="" onClick="toggleDivsWithCookie('comment-189668-open', 'comment-189668-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189668" />
    
    
    
                <a id="comment_189668_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 08:37 PM</span></span>               I also see this exception once or twice when i try to deploy an application.
During all my testing,  i saw this only 2 times out of over 30 times.

[#|2011-01-10T20:32:40.794-0800|SEVERE|glassfish3.1|com.sun.grizzly.config.GrizzlyServiceListener|_ThreadID=25;_ThreadName=admin-thread-pool-4848(43);|GRIZZLY0040: Request header is too large.
java.nio.BufferOverflowException
	at com.sun.grizzly.tcp.http11.InternalInputBuffer.fill(InternalInputBuffer.java:765)
	at com.sun.grizzly.tcp.http11.InternalInputBuffer.parseHeader(InternalInputBuffer.java:615)
	at com.sun.grizzly.tcp.http11.InternalInputBuffer.parseHeaders(InternalInputBuffer.java:555)
	at com.sun.grizzly.http.ProcessorTask.parseRequest(ProcessorTask.java:871)
	at com.sun.grizzly.http.ProcessorTask.doProcess(ProcessorTask.java:692)
	at com.sun.grizzly.http.ProcessorTask.process(ProcessorTask.java:1008)
	at com.sun.grizzly.http.DefaultProtocolFilter.execute(DefaultProtocolFilter.java:225)
	at com.sun.grizzly.DefaultProtocolChain.executeProtocolFilter(DefaultProtocolChain.java:137)
	at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.java:104)
	at com.sun.grizzly.DefaultProtocolChain.execute(DefaultProtocolChain.java:90)
	at com.sun.grizzly.http.HttpProtocolChain.execute(HttpProtocolChain.java:79)
	at com.sun.grizzly.ProtocolChainContextTask.doCall(ProtocolChainContextTask.java:54)
	at com.sun.grizzly.SelectionKeyContextTask.call(SelectionKeyContextTask.java:59)
	at com.sun.grizzly.ContextTask.run(ContextTask.java:71)
	at com.sun.grizzly.util.AbstractThreadPool$Worker.doWork(AbstractThreadPool.java:532)
	at com.sun.grizzly.util.AbstractThreadPool$Worker.run(AbstractThreadPool.java:513)
	at java.lang.Thread.run(Thread.java:680)
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'>#]</td>
</tr>
</tbody></table>

and the browser will show:
Secure Connection Failed

An error occurred during a connection to localhost:4848.

SSL received a record that exceeded the maximum permissible length.

(Error code: ssl_error_rx_record_too_long)

<ul>
	<li>The page you are trying to view can not be shown because the authenticity of the received data could not be verified.</li>
</ul>


<ul>
	<li>Please contact the web site owners to inform them of this problem. Alternatively, use the command found in the help menu to report this broken site.</li>
</ul>

     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189668-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189668-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189676-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189676&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189676" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189676-hide" href="" onClick="toggleDivsWithCookie('comment-189676-closed', 'comment-189676-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189676" />
    
    
    
                <a id="comment_189676_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:14 PM</span></span>  </div>
    <div class="action-body"><p>---------</p>

<p>I just notice one issue. Although GUI works fine, if i go to <br/>
<span class="nobr"><a href="http://localhost:4848/management/domain">http://localhost:4848/management/domain<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span> in the browser, <br/>
I will get this exception. This happens both before and after changing to what u suggest for verify(). </p>

<p>[#|2011-01-10T19:58:22.412-0800|WARNING|glassfish3.1|com.sun.grizzly.config.GrizzlyServiceListener|_ThreadID=27;_ThreadName=admin-thread-pool-4848(27);|processorTask.exceptionSSLcert <br/>
javax.net.ssl.SSLHandshakeException: Insecure renegotiation is not allowed <br/>
at com.sun.net.ssl.internal.ssl.SSLEngineImpl.kickstartHandshake(SSLEngineImpl.java:635) <br/>
at com.sun.net.ssl.internal.ssl.SSLEngineImpl.beginHandshake(SSLEngineImpl.java:689) <br/>
at com.sun.grizzly.util.SSLUtils.doPeerCertificateChain(SSLUtils.java:559) <br/>
--------</p>


<p>So which version of JDK are you using for the testing. Make sure you use JDK 1.6.0_22 or later.</p>

<p><span class="nobr"><a href="http://www.java.net/blog/kumarjayanti/archive/2010/11/18/ssl-renegotiation-issue-fixed-jdk16022">http://www.java.net/blog/kumarjayanti/archive/2010/11/18/ssl-renegotiation-issue-fixed-jdk16022<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span></p>
 </div>
</div>
</div>


<div id="comment-189676-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189676-show" href="" onClick="toggleDivsWithCookie('comment-189676-open', 'comment-189676-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189676" />
    
    
    
                <a id="comment_189676_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:14 PM</span></span>               ---------

I just notice one issue. Although GUI works fine, if i go to 
<span class="nobr"><a href="http://localhost:4848/management/domain">http://localhost:4848/management/domain<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span> in the browser, 
I will get this exception. This happens both before and after changing to what u suggest for verify(). 

[#|2011-01-10T19:58:22.412-0800|WARNING|glassfish3.1|com.sun.grizzly.config.GrizzlyServiceListener|_ThreadID=27;_ThreadName=admin-thread-pool-4848(27);|processorTask.exceptionSSLcert 
javax.net.ssl.SSLHandshakeException: Insecure renegotiation is not allowed 
at com.sun.net.ssl.internal.ssl.SSLEngineImpl.kickstartHandshake(SSLEngineImpl.java:635) 
at com.sun.net.ssl.internal.ssl.SSLEngineImpl.beginHandshake(SSLEngineImpl.java:689) 
at com.sun.grizzly.util.SSLUtils.doPeerCertificateChain(SSLUtils.java:559) 
--------


So which version of JDK are you using for the testing. Make sure you use JDK 1.6.0_22 or later.

<span class="nobr"><a href="http://www.java.net/blog/kumarjayanti/archive/2010/11/18/ssl-renegotiation-issue-fixed-jdk16022">http://www.java.net/blog/kumarjayanti/archive/2010/11/18/ssl-renegotiation-issue-fixed-jdk16022<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>
     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189676-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189676-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189677-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189677&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189677" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189677-hide" href="" onClick="toggleDivsWithCookie('comment-189677-closed', 'comment-189677-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189677" />
    
    
    
                <a id="comment_189677_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:17 PM</span></span>  </div>
    <div class="action-body"><p>Link to grizzly issue which suggests using _22.</p>

<p><span class="nobr"><a href="http://java.net/jira/browse/GRIZZLY-915">http://java.net/jira/browse/GRIZZLY-915<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span></p> </div>
</div>
</div>


<div id="comment-189677-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189677-show" href="" onClick="toggleDivsWithCookie('comment-189677-open', 'comment-189677-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189677" />
    
    
    
                <a id="comment_189677_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:17 PM</span></span>               Link to grizzly issue which suggests using _22.

<span class="nobr"><a href="http://java.net/jira/browse/GRIZZLY-915">http://java.net/jira/browse/GRIZZLY-915<sup><img class="rendericon" src="/jira/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189677-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189677-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189678-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189678&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189678" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189678-hide" href="" onClick="toggleDivsWithCookie('comment-189678-closed', 'comment-189678-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189678" />
    
    
    
                <a id="comment_189678_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:19 PM</span></span>  </div>
    <div class="action-body"><p>-------------<br/>
 also see this exception once or twice when i try to deploy an application. <br/>
During all my testing, i saw this only 2 times out of over 30 times. </p>

<p>[#|2011-01-10T20:32:40.794-0800|SEVERE|glassfish3.1|com.sun.grizzly.config.GrizzlyServiceListener|_ThreadID=25;_ThreadName=admin-thread-pool-4848(43);|GRIZZLY0040: Request header is too large. <br/>
java.nio.BufferOverflowException <br/>
at com.sun.grizzly.tcp.http11.InternalInputBuffer.fill(InternalInputBuffer.java:765) <br/>
at com.sun.grizzly.tcp.http11.InternalInputBuffer.parseHeader(InternalInputBuffer.java:615) <br/>
at com.sun.grizzly.tcp.http11.InternalInputBuffer.parseHeaders(InternalInputBuffer.java:555) <br/>
--------------</p>

<p>First upgrade to JDK _22 and after that if you still see this error, then file a bug on grizzly with steps to reproduce it.</p> </div>
</div>
</div>


<div id="comment-189678-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189678-show" href="" onClick="toggleDivsWithCookie('comment-189678-open', 'comment-189678-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189678" />
    
    
    
                <a id="comment_189678_header_kumarjayanti" href="/jira/secure/ViewProfile.jspa?name=kumarjayanti">kumarjayanti</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:19 PM</span></span>               -------------
 also see this exception once or twice when i try to deploy an application. 
During all my testing, i saw this only 2 times out of over 30 times. 

[#|2011-01-10T20:32:40.794-0800|SEVERE|glassfish3.1|com.sun.grizzly.config.GrizzlyServiceListener|_ThreadID=25;_ThreadName=admin-thread-pool-4848(43);|GRIZZLY0040: Request header is too large. 
java.nio.BufferOverflowException 
at com.sun.grizzly.tcp.http11.InternalInputBuffer.fill(InternalInputBuffer.java:765) 
at com.sun.grizzly.tcp.http11.InternalInputBuffer.parseHeader(InternalInputBuffer.java:615) 
at com.sun.grizzly.tcp.http11.InternalInputBuffer.parseHeaders(InternalInputBuffer.java:555) 
--------------

First upgrade to JDK _22 and after that if you still see this error, then file a bug on grizzly with steps to reproduce it.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189678-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189678-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189679-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189679&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189679" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189679-hide" href="" onClick="toggleDivsWithCookie('comment-189679-closed', 'comment-189679-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189679" />
    
                                                
    
                <a id="comment_189679_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:20 PM</span></span>   - <span class="redText subText" title="Anissa Lam - 11/Jan/11 08:34 AM">edited</span> </div>
    <div class="action-body"><p>I am using jdk 22.   I don't think you can run secure admin if you have version less than that.<br/>
I am using Mac, and here is my jdk.</p>

<p>116)  java -version<br/>
java version "1.6.0_22"<br/>
Java(TM) SE Runtime Environment (build 1.6.0_22-b04-307-9M3263)<br/>
Java HotSpot(TM) 64-Bit Server VM (build 17.1-b03-307, mixed mode)</p> </div>
</div>
</div>


<div id="comment-189679-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189679-show" href="" onClick="toggleDivsWithCookie('comment-189679-open', 'comment-189679-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189679" />
    
                                                
    
                <a id="comment_189679_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>10/Jan/11 11:20 PM</span></span>   - <span class="redText subText" title="Anissa Lam - 11/Jan/11 08:34 AM">edited</span>              I am using jdk 22.   I don't think you can run secure admin if you have version less than that.
I am using Mac, and here is my jdk.

116)  java -version
java version "1.6.0_22"
Java(TM) SE Runtime Environment (build 1.6.0_22-b04-307-9M3263)
Java HotSpot(TM) 64-Bit Server VM (build 17.1-b03-307, mixed mode)     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189679-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189679-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189773-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189773&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189773" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189773-hide" href="" onClick="toggleDivsWithCookie('comment-189773-closed', 'comment-189773-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189773" />
    
    
    
                <a id="comment_189773_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>11/Jan/11 04:38 PM</span></span>  </div>
    <div class="action-body">
<p>How bad is its impact? (Severity) <br/>
Very Severe.   </p>

<p>How often does it happen? (Frequency) <br/>
Everytime when a new domain is created or using the domain that the installer create,  GUI is not accessible if secure-admin is turned on.</p>

<p>How much effort is required to fix it? (Cost) <br/>
Several days for me,  mainly because i am not familiar in the security area.</p>

<p>What is the risk of fixing it? (Risk) <br/>
The risk should should be minor, it won't hurt the non-secure admin case.   And if secure-admin is turned on, it was mostly broken anyway.</p>

<p>Does a work around for the issue exist? Can the workaround be reasonably employed by the end user? <br/>
No workaround.</p>

<p>If the issue is not fixed should the issue and its workaround (if applicable) be described in the Release Notes? <br/>
We have to fix this.  Release Note is not good enough.</p>


<p>Here is the svn diff.   The patch created with this code change has been tested extensively by me,  and given to Shalini to tested out.   Basic sanity check from Shalini for different scenario  worked without issue.<br/>
This code is reviewed by Tim.   I will request review from Mitesh as well.</p>


<p>~/Awork/V3/v3 25)  svn diff admingui<br/>
Index: admingui/common/src/main/java/org/glassfish/admingui/common/security/AdminConsoleAuthModule.java<br/>
===================================================================<br/>
&#8212; admingui/common/src/main/java/org/glassfish/admingui/common/security/AdminConsoleAuthModule.java	(revision 44400)<br/>
+++ admingui/common/src/main/java/org/glassfish/admingui/common/security/AdminConsoleAuthModule.java	(working copy)<br/>
@@ -68,6 +68,7 @@<br/>
 import org.jvnet.hk2.component.Habitat;<br/>
 import com.sun.enterprise.config.serverbeans.Domain;<br/>
 import com.sun.enterprise.security.SecurityServicesUtil;<br/>
+import org.glassfish.admingui.common.util.RestUtil;</p>

<p> /**</p>
<ul>
	<li>&lt;p&gt;	This class is responsible for providing the Authentication support<br/>
@@ -192,7 +193,8 @@<br/>
 	    // Not passed in, show the login page...<br/>
 	    RequestDispatcher rd = request.getRequestDispatcher(loginPage);<br/>
 	    try {
-		rd.forward(request, response);
+                 RestUtil.initialize(null);
+		 rd.forward(request, response);
 	    } catch (Exception ex) {<br/>
 		AuthException ae = new AuthException();<br/>
 		ae.initCause(ex);<br/>
@@ -208,7 +210,10 @@<br/>
 //	    new PasswordValidationCallback(clientSubject, username, pwd);</li>
</ul>


<p> 	// Make REST Request</p>
<ul class="alternate" type="square">
	<li>WebResource webResource = Client.create().resource(restURL);<br/>
+<br/>
+        Client client2 = Client.create();<br/>
+        RestUtil.initialize(client2);<br/>
+	WebResource webResource = client2.resource(restURL);<br/>
 	webResource.addFilter(new HTTPBasicAuthFilter(username, password));<br/>
 	ClientResponse resp = webResource.accept(RESPONSE_TYPE).post(ClientResponse.class);<br/>
 	RestResponse restResp = RestResponse.getRestResponse(resp);<br/>
Index: admingui/common/src/main/java/org/glassfish/admingui/common/util/RestUtil.java<br/>
===================================================================
	<ul class="alternate" type="square">
		<li>
		<ul class="alternate" type="square">
			<li>admingui/common/src/main/java/org/glassfish/admingui/common/util/RestUtil.java	(revision 44400)<br/>
+++ admingui/common/src/main/java/org/glassfish/admingui/common/util/RestUtil.java	(working copy)<br/>
@@ -72,6 +72,14 @@</li>
		</ul>
		</li>
	</ul>
	</li>
</ul>


<p> import org.glassfish.admingui.common.security.AdminConsoleAuthModule;</p>

<p>+import javax.net.ssl.HostnameVerifier;<br/>
+import javax.net.ssl.SSLSession;<br/>
+import com.sun.enterprise.security.SecurityServicesUtil;<br/>
+import com.sun.enterprise.config.serverbeans.SecureAdmin;<br/>
+import com.sun.enterprise.security.ssl.SSLUtils;<br/>
+import com.sun.jersey.client.urlconnection.HTTPSProperties;<br/>
+import org.jvnet.hk2.component.Habitat;<br/>
+<br/>
 import org.w3c.dom.Document;<br/>
 import org.w3c.dom.Element;<br/>
 import org.w3c.dom.Node;<br/>
@@ -710,4 +718,35 @@<br/>
     //******************************************************************************************************************<br/>
     // Jersey client methods<br/>
     //******************************************************************************************************************<br/>
+     public static void initialize(Client client){<br/>
+        if (client == null){
+            client = JERSEY_CLIENT;
+        }<br/>
+        try{
+            Habitat habitat = SecurityServicesUtil.getInstance().getHabitat();
+            SecureAdmin secureAdmin = habitat.getComponent(SecureAdmin.class);
+            HTTPSProperties httpsProperties = new HTTPSProperties(new BasicHostnameVerifier(),
+                habitat.getComponent(SSLUtils.class).getAdminSSLContext(SecureAdmin.Util.DASAlias(secureAdmin), null ));
+            client.getProperties().put(HTTPSProperties.PROPERTY_HTTPS_PROPERTIES, httpsProperties);
+        }catch(Exception ex){<br/>
+            GuiUtil.getLogger().warning("RestUtil.initialize() failed");<br/>
+            if (GuiUtil.getLogger().isLoggable(Level.FINE)){
+                ex.printStackTrace();
+            }<br/>
+        }<br/>
+    }<br/>
+<br/>
+    private static class BasicHostnameVerifier implements HostnameVerifier {<br/>
+        final HostnameVerifier defaultVerifier = javax.net.ssl.HttpsURLConnection.getDefaultHostnameVerifier();<br/>
+        public BasicHostnameVerifier(){
+        }<br/>
+        <br/>
+        public boolean verify(String host, SSLSession sslSession) {<br/>
+            if (host.equals("localhost")){
+                return true;
+            }<br/>
+            boolean result = defaultVerifier.verify(host, sslSession);<br/>
+            return (result) ? true :  host.equals(sslSession.getPeerHost());<br/>
+        }<br/>
+    }<br/>
 }</p>
 </div>
</div>
</div>


<div id="comment-189773-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189773-show" href="" onClick="toggleDivsWithCookie('comment-189773-open', 'comment-189773-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189773" />
    
    
    
                <a id="comment_189773_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>11/Jan/11 04:38 PM</span></span>               
How bad is its impact? (Severity) 
Very Severe.   

How often does it happen? (Frequency) 
Everytime when a new domain is created or using the domain that the installer create,  GUI is not accessible if secure-admin is turned on.

How much effort is required to fix it? (Cost) 
Several days for me,  mainly because i am not familiar in the security area.

What is the risk of fixing it? (Risk) 
The risk should should be minor, it won't hurt the non-secure admin case.   And if secure-admin is turned on, it was mostly broken anyway.

Does a work around for the issue exist? Can the workaround be reasonably employed by the end user? 
No workaround.

If the issue is not fixed should the issue and its workaround (if applicable) be described in the Release Notes? 
We have to fix this.  Release Note is not good enough.


Here is the svn diff.   The patch created with this code change has been tested extensively by me,  and given to Shalini to tested out.   Basic sanity check from Shalini for different scenario  worked without issue.
This code is reviewed by Tim.   I will request review from Mitesh as well.


~/Awork/V3/v3 25)  svn diff admingui
Index: admingui/common/src/main/java/org/glassfish/admingui/common/security/AdminConsoleAuthModule.java
===================================================================
&#8212; admingui/common/src/main/java/org/glassfish/admingui/common/security/AdminConsoleAuthModule.java	(revision 44400)
+++ admingui/common/src/main/java/org/glassfish/admingui/common/security/AdminConsoleAuthModule.java	(working copy)
@@ -68,6 +68,7 @@
 import org.jvnet.hk2.component.Habitat;
 import com.sun.enterprise.config.serverbeans.Domain;
 import com.sun.enterprise.security.SecurityServicesUtil;
+import org.glassfish.admingui.common.util.RestUtil;

 /**
<ul>
	<li>&lt;p&gt;	This class is responsible for providing the Authentication support
@@ -192,7 +193,8 @@
 	    // Not passed in, show the login page...
 	    RequestDispatcher rd = request.getRequestDispatcher(loginPage);
 	    try {
-		rd.forward(request, response);
+                 RestUtil.initialize(null);
+		 rd.forward(request, response);
 	    } catch (Exception ex) {
 		AuthException ae = new AuthException();
 		ae.initCause(ex);
@@ -208,7 +210,10 @@
 //	    new PasswordValidationCallback(clientSubject, username, pwd);</li>
</ul>


 	// Make REST Request
<ul class="alternate" type="square">
	<li>WebResource webResource = Client.create().resource(restURL);
+
+        Client client2 = Client.create();
+        RestUtil.initialize(client2);
+	WebResource webResource = client2.resource(restURL);
 	webResource.addFilter(new HTTPBasicAuthFilter(username, password));
 	ClientResponse resp = webResource.accept(RESPONSE_TYPE).post(ClientResponse.class);
 	RestResponse restResp = RestResponse.getRestResponse(resp);
Index: admingui/common/src/main/java/org/glassfish/admingui/common/util/RestUtil.java
===================================================================
	<ul class="alternate" type="square">
		<li>
		<ul class="alternate" type="square">
			<li>admingui/common/src/main/java/org/glassfish/admingui/common/util/RestUtil.java	(revision 44400)
+++ admingui/common/src/main/java/org/glassfish/admingui/common/util/RestUtil.java	(working copy)
@@ -72,6 +72,14 @@</li>
		</ul>
		</li>
	</ul>
	</li>
</ul>


 import org.glassfish.admingui.common.security.AdminConsoleAuthModule;

+import javax.net.ssl.HostnameVerifier;
+import javax.net.ssl.SSLSession;
+import com.sun.enterprise.security.SecurityServicesUtil;
+import com.sun.enterprise.config.serverbeans.SecureAdmin;
+import com.sun.enterprise.security.ssl.SSLUtils;
+import com.sun.jersey.client.urlconnection.HTTPSProperties;
+import org.jvnet.hk2.component.Habitat;
+
 import org.w3c.dom.Document;
 import org.w3c.dom.Element;
 import org.w3c.dom.Node;
@@ -710,4 +718,35 @@
     //******************************************************************************************************************
     // Jersey client methods
     //******************************************************************************************************************
+     public static void initialize(Client client){
+        if (client == null){
+            client = JERSEY_CLIENT;
+        }
+        try{
+            Habitat habitat = SecurityServicesUtil.getInstance().getHabitat();
+            SecureAdmin secureAdmin = habitat.getComponent(SecureAdmin.class);
+            HTTPSProperties httpsProperties = new HTTPSProperties(new BasicHostnameVerifier(),
+                habitat.getComponent(SSLUtils.class).getAdminSSLContext(SecureAdmin.Util.DASAlias(secureAdmin), null ));
+            client.getProperties().put(HTTPSProperties.PROPERTY_HTTPS_PROPERTIES, httpsProperties);
+        }catch(Exception ex){
+            GuiUtil.getLogger().warning("RestUtil.initialize() failed");
+            if (GuiUtil.getLogger().isLoggable(Level.FINE)){
+                ex.printStackTrace();
+            }
+        }
+    }
+
+    private static class BasicHostnameVerifier implements HostnameVerifier {
+        final HostnameVerifier defaultVerifier = javax.net.ssl.HttpsURLConnection.getDefaultHostnameVerifier();
+        public BasicHostnameVerifier(){
+        }
+        
+        public boolean verify(String host, SSLSession sslSession) {
+            if (host.equals("localhost")){
+                return true;
+            }
+            boolean result = defaultVerifier.verify(host, sslSession);
+            return (result) ? true :  host.equals(sslSession.getPeerHost());
+        }
+    }
 }
     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189773-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189773-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-189792-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=189792&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_189792" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-189792-hide" href="" onClick="toggleDivsWithCookie('comment-189792-closed', 'comment-189792-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_189792" />
    
    
    
                <a id="comment_189792_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>11/Jan/11 09:37 PM</span></span>  </div>
    <div class="action-body"><p>The change in the hostname verifier was based on the last comment from Kumar.<br/>
Tim and Mitesh has reviewed the code, and a patch thats created based on this change has been confirmed by QA that this fixed the issue.   So i checked in the fix.</p>

<p>Project:    glassfish<br/>
Repository: svn<br/>
Revision:   44412<br/>
Author:     anilam<br/>
Date:       2011-01-12 05:34:09 UTC<br/>
Link:       </p>

<p>Log Message:<br/>
------------<br/>
Fix <a href="/jira/browse/GLASSFISH-15421" title="javax.net.ssl.SSLHandshakeException seen while loading Console after enable-secure-admin in windows."><del>GLASSFISH-15421</del></a>.  add hostname verifier so that GUI is accessible when secure-admin is on, regardless what the CN of the cert is set to.<br/>
A patch based on this code change was created for QA to verify the fix and QA confirmed this fixed the issue.</p>

<p>Approved:  self-approve<br/>
Reviewer:  Tim Quinn, Mitesh</p>


<p>Revisions:<br/>
----------<br/>
44412</p>


<p>Modified Paths:<br/>
---------------<br/>
trunk/v3/admingui/common/src/main/java/org/glassfish/admingui/common/security/AdminConsoleAuthModule.java<br/>
trunk/v3/admingui/common/src/main/java/org/glassfish/admingui/common/util/RestUtil.java</p>

 </div>
</div>
</div>


<div id="comment-189792-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-189792-show" href="" onClick="toggleDivsWithCookie('comment-189792-open', 'comment-189792-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_189792" />
    
    
    
                <a id="comment_189792_header_anilam" href="/jira/secure/ViewProfile.jspa?name=anilam">Anissa Lam</a> added a comment  - <span class=subText><span class=date>11/Jan/11 09:37 PM</span></span>               The change in the hostname verifier was based on the last comment from Kumar.
Tim and Mitesh has reviewed the code, and a patch thats created based on this change has been confirmed by QA that this fixed the issue.   So i checked in the fix.

Project:    glassfish
Repository: svn
Revision:   44412
Author:     anilam
Date:       2011-01-12 05:34:09 UTC
Link:       

Log Message:
------------
Fix <a href="/jira/browse/GLASSFISH-15421" title="javax.net.ssl.SSLHandshakeException seen while loading Console after enable-secure-admin in windows."><del>GLASSFISH-15421</del></a>.  add hostname verifier so that GUI is accessible when secure-admin is on, regardless what the CN of the cert is set to.
A patch based on this code change was created for QA to verify the fix and QA confirmed this fixed the issue.

Approved:  self-approve
Reviewer:  Tim Quinn, Mitesh


Revisions:
----------
44412


Modified Paths:
---------------
trunk/v3/admingui/common/src/main/java/org/glassfish/admingui/common/security/AdminConsoleAuthModule.java
trunk/v3/admingui/common/src/main/java/org/glassfish/admingui/common/util/RestUtil.java

     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-189792-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-189792-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
                
                <div id="comment-191009-open">
<div class="actionContainer">
    <div class="action-links subText smallgrey">
    [
        <a href="/jira/browse/GLASSFISH-15421?focusedCommentId=191009&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_191009" title="A permanent link to this comment." class="smallgrey">Permalink</a>
                      | <a id="comment-191009-hide" href="" onClick="toggleDivsWithCookie('comment-191009-closed', 'comment-191009-open'); return false;" class="smallgrey">&laquo; Hide</a>
    ]
    </div>
    <div class="action-details">    <a name="action_191009" />
    
    
    
                <a id="comment_191009_header_shaline" href="/jira/secure/ViewProfile.jspa?name=shaline">shaline</a> added a comment  - <span class=subText><span class=date>25/Jan/11 11:54 AM</span></span>  </div>
    <div class="action-body"><p>Verified in promoted b38.</p> </div>
</div>
</div>


<div id="comment-191009-closed" style="display: none;">
<div class="actionContainer" style="background-color:#f0f0f0;">
    <div class="action-links subText smallgrey">
    [ <a id="comment-191009-show" href="" onClick="toggleDivsWithCookie('comment-191009-open', 'comment-191009-closed'); return false;" class="smallgrey">Show &raquo;</a> ]
    </div>
    <div class="action-details" style="overflow: hidden; height: 1em;">
                <a name="action_191009" />
    
    
    
                <a id="comment_191009_header_shaline" href="/jira/secure/ViewProfile.jspa?name=shaline">shaline</a> added a comment  - <span class=subText><span class=date>25/Jan/11 11:54 AM</span></span>               Verified in promoted b38.     </div>
</div>
</div>
<br clear="all" />
<script language="JavaScript" type="text/javascript">
<!--
    restoreDivFromCookie('comment-191009-open', 'jira.viewissue.cong.cookie', '1');
    restoreDivFromCookie('comment-191009-closed', 'jira.viewissue.cong.cookie', '0');
//-->
</script>

                
            
        
        
        </div>
            </div>
        </td>
    </tr>
</table>











<div class="footer">
<div  class="poweredbymessage" >
        <a class="seo-link" href="http://www.atlassian.com/software/jira/bug-tracking.jsp">Bug tracking</a>, <a class="seo-link" href="http://www.atlassian.com/software/jira/issue-tracking.jsp">issue tracking</a> and <a class="seo-link" href="http://www.atlassian.com/software/jira/tour/project-management.jsp">project management software</a> powered by <a href="http://www.atlassian.com/software/jira" class="smalltext">Atlassian JIRA</a>
        <span id="footer-build-information"  style="color: #666666;" >(v4.0.2#472)</span>        | <a href="http://support.atlassian.com/secure/CreateIssue.jspa?issuetype=1&pid=10000">Report a problem</a>
        | <a href="http://jira.atlassian.com/secure/CreateIssue.jspa?pid=10240&issuetype=2">Request a feature</a>
        | <a href="/jira/secure/Administrators.jspa">Contact administrators</a>
    </div>
                
    

    



    
</div>



<!--
	                 REQUEST ID : 1198x3203222x1
	          REQUEST TIMESTAMP : [14/Dec/2013:00:19:58 +0000]
	               REQUEST TIME : 0.3560
	                 ASESSIONID : 6ljczv
-->

</body>
</html>



