<HTML><HEAD><title> A generic framework for a flexible, multi-threaded server : Server&nbsp;&laquo;&nbsp;Network Protocol&nbsp;&laquo;&nbsp;Java </title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta http-equiv="content-style-type" content="text/css"/><meta name="author" content="Demo Source and Support Ltd."/><meta name="copyright" content="2006 Demo Source and Support Ltd."/><meta name="description" CONTENT=" A generic framework for a flexible, multi-threaded server : Server&nbsp;&laquo;&nbsp;Network Protocol&nbsp;&laquo;&nbsp;Java "/><meta name="keywords" CONTENT=" A generic framework for a flexible, multi-threaded server : Server&nbsp;&laquo;&nbsp;Network Protocol&nbsp;&laquo;&nbsp;Java "/><LINK href="http://www.java2s.com/style/java2s.css" type=text/css rel=stylesheet><link rel="shortcut icon" href="http://www.java2s.com/style/favicon.ico"></HEAD><body><H1>A generic framework for a flexible, multi-threaded server : Server&nbsp;&laquo;&nbsp;Network Protocol&nbsp;&laquo;&nbsp;Java</H1><table width=1024 border=0><tr align=left><td width=140 valign=top align=left><table cellpadding=0 cellspacing=0 class=leftBarTable><tr><td class=leftLangCell><A href="http://www.java2s.com">Home</A></td></tr><tr><td><A href="/Code/Java/CatalogJava.htm">Java</a></td></tr><tr><td><table class=leftBarFolderTable><tr><td valign=top>1.</td><td><A href="/Code/Java/2D-Graphics-GUI/Catalog2D-Graphics-GUI.htm">2D Graphics GUI</a></td></tr><tr><td valign=top>2.</td><td><A href="/Code/Java/3D/Catalog3D.htm">3D</a></td></tr><tr><td valign=top>3.</td><td><A href="/Code/Java/Advanced-Graphics/CatalogAdvanced-Graphics.htm">Advanced Graphics</a></td></tr><tr><td valign=top>4.</td><td><A href="/Code/Java/Ant/CatalogAnt.htm">Ant</a></td></tr><tr><td valign=top>5.</td><td><A href="/Code/Java/Apache-Common/CatalogApache-Common.htm">Apache Common</a></td></tr><tr><td valign=top>6.</td><td><A href="/Code/Java/Chart/CatalogChart.htm">Chart</a></td></tr><tr><td valign=top>7.</td><td><A href="/Code/Java/Class/CatalogClass.htm">Class</a></td></tr><tr><td valign=top>8.</td><td><A href="/Code/Java/Collections-Data-Structure/CatalogCollections-Data-Structure.htm">Collections Data Structure</a></td></tr><tr><td valign=top>9.</td><td><A href="/Code/Java/Data-Type/CatalogData-Type.htm">Data Type</a></td></tr><tr><td valign=top>10.</td><td><A href="/Code/Java/Database-SQL-JDBC/CatalogDatabase-SQL-JDBC.htm">Database SQL JDBC</a></td></tr><tr><td valign=top>11.</td><td><A href="/Code/Java/Design-Pattern/CatalogDesign-Pattern.htm">Design Pattern</a></td></tr><tr><td valign=top>12.</td><td><A href="/Code/Java/Development-Class/CatalogDevelopment-Class.htm">Development Class</a></td></tr><tr><td valign=top>13.</td><td><A href="/Code/Java/EJB3/CatalogEJB3.htm">EJB3</a></td></tr><tr><td valign=top>14.</td><td><A href="/Code/Java/Email/CatalogEmail.htm">Email</a></td></tr><tr><td valign=top>15.</td><td><A href="/Code/Java/Event/CatalogEvent.htm">Event</a></td></tr><tr><td valign=top>16.</td><td><A href="/Code/Java/File-Input-Output/CatalogFile-Input-Output.htm">File Input Output</a></td></tr><tr><td valign=top>17.</td><td><A href="/Code/Java/Game/CatalogGame.htm">Game</a></td></tr><tr><td valign=top>18.</td><td><A href="/Code/Java/Generics/CatalogGenerics.htm">Generics</a></td></tr><tr><td valign=top>19.</td><td><A href="/Code/Java/GWT/CatalogGWT.htm">GWT</a></td></tr><tr><td valign=top>20.</td><td><A href="/Code/Java/Hibernate/CatalogHibernate.htm">Hibernate</a></td></tr><tr><td valign=top>21.</td><td><A href="/Code/Java/I18N/CatalogI18N.htm">I18N</a></td></tr><tr><td valign=top>22.</td><td><A href="/Code/Java/J2EE/CatalogJ2EE.htm">J2EE</a></td></tr><tr><td valign=top>23.</td><td><A href="/Code/Java/J2ME/CatalogJ2ME.htm">J2ME</a></td></tr><tr><td valign=top>24.</td><td><A href="/Code/Java/JDK-6/CatalogJDK-6.htm">JDK 6</a></td></tr><tr><td valign=top>25.</td><td><A href="/Code/Java/JNDI-LDAP/CatalogJNDI-LDAP.htm">JNDI LDAP</a></td></tr><tr><td valign=top>26.</td><td><A href="/Code/Java/JPA/CatalogJPA.htm">JPA</a></td></tr><tr><td valign=top>27.</td><td><A href="/Code/Java/JSP/CatalogJSP.htm">JSP</a></td></tr><tr><td valign=top>28.</td><td><A href="/Code/Java/JSTL/CatalogJSTL.htm">JSTL</a></td></tr><tr><td valign=top>29.</td><td><A href="/Code/Java/Language-Basics/CatalogLanguage-Basics.htm">Language Basics</a></td></tr><tr><td valign=top>30.</td><td><B>Network Protocol</B></td></tr><tr><td valign=top>31.</td><td><A href="/Code/Java/PDF-RTF/CatalogPDF-RTF.htm">PDF RTF</a></td></tr><tr><td valign=top>32.</td><td><A href="/Code/Java/Reflection/CatalogReflection.htm">Reflection</a></td></tr><tr><td valign=top>33.</td><td><A href="/Code/Java/Regular-Expressions/CatalogRegular-Expressions.htm">Regular Expressions</a></td></tr><tr><td valign=top>34.</td><td><A href="/Code/Java/Scripting/CatalogScripting.htm">Scripting</a></td></tr><tr><td valign=top>35.</td><td><A href="/Code/Java/Security/CatalogSecurity.htm">Security</a></td></tr><tr><td valign=top>36.</td><td><A href="/Code/Java/Servlets/CatalogServlets.htm">Servlets</a></td></tr><tr><td valign=top>37.</td><td><A href="/Code/Java/Spring/CatalogSpring.htm">Spring</a></td></tr><tr><td valign=top>38.</td><td><A href="/Code/Java/Swing-Components/CatalogSwing-Components.htm">Swing Components</a></td></tr><tr><td valign=top>39.</td><td><A href="/Code/Java/Swing-JFC/CatalogSwing-JFC.htm">Swing JFC</a></td></tr><tr><td valign=top>40.</td><td><A href="/Code/Java/SWT-JFace-Eclipse/CatalogSWT-JFace-Eclipse.htm">SWT JFace Eclipse</a></td></tr><tr><td valign=top>41.</td><td><A href="/Code/Java/Threads/CatalogThreads.htm">Threads</a></td></tr><tr><td valign=top>42.</td><td><A href="/Code/Java/Tiny-Application/CatalogTiny-Application.htm">Tiny Application</a></td></tr><tr><td valign=top>43.</td><td><A href="/Code/Java/Velocity/CatalogVelocity.htm">Velocity</a></td></tr><tr><td valign=top>44.</td><td><A href="/Code/Java/Web-Services-SOA/CatalogWeb-Services-SOA.htm">Web Services SOA</a></td></tr><tr><td valign=top>45.</td><td><A href="/Code/Java/XML/CatalogXML.htm">XML</a></td></tr></table></td></tr></table></td><td width=2px></td><td valign=top><TABLE class=googleBar width=800 cellSpacing=0 cellPadding=0 border=0><TBODY><TR><TD width=60%><A href="/Code/Java/CatalogJava.htm">Java</a>&nbsp;&raquo;&nbsp;<A href="/Code/Java/Network-Protocol/CatalogNetwork-Protocol.htm">Network Protocol</a>&nbsp;&raquo;&nbsp;<A href="/Code/Java/Network-Protocol/Server.htm">Server</a></TD><TD align=right width=10%><A href="/Code/Java/2D-Graphics-GUI1.htm">Screenshots</a>&nbsp;</TD><TD align=right height=80% width=30%><form action="http://www.google.com/cse" id="cse-search-box"><div><input type="hidden" name="cx" value="partner-pub-1130008796007602:iri8be-v211" /><input type="hidden" name="ie" value="ISO-8859-1" /><input type="text" name="q" size="15" /><input type="submit" name="sa" value="Search" /></div></form><script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script></TD></FORM> </TD></TR></TBODY></TABLE><script type="text/javascript"><!--
google_ad_client="pub-1130008796007602";google_ad_width=728;google_ad_height=90;google_ad_format="728x90_as";google_ad_type="text_image";google_ad_channel="";google_color_border="ffffff";google_color_bg="ffffff";google_color_link="003399";google_color_text="000000";google_color_url="75a3ed";
//--></script><script type="text/javascript"src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script><table width=800 border=0><tr><td class=codeTitle>A generic framework for a flexible, multi-threaded server</td></tr>
<tr><td><TABLE border=0><TR><TD height=20></TD></TR></TABLE>
</td></tr>
<tr><td><table border="0" cellpadding="3" cellspacing="0" bgcolor="#ffffff">
   <tr>
<td nowrap="nowrap" valign="top" align="left"><div class="codeShade"><code><font color="#ffffff">&nbsp;&nbsp;</font><br/>
<font color="#3f7f5f">/*</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f7f5f">*&nbsp;Copyright&nbsp;(c)&nbsp;2000&nbsp;David&nbsp;Flanagan.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f7f5f">*&nbsp;This&nbsp;code&nbsp;is&nbsp;from&nbsp;the&nbsp;book&nbsp;Java&nbsp;Examples&nbsp;in&nbsp;a&nbsp;Nutshell,&nbsp;2nd&nbsp;Edition.</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f7f5f">*&nbsp;It&nbsp;is&nbsp;provided&nbsp;AS-IS,&nbsp;WITHOUT&nbsp;ANY&nbsp;WARRANTY&nbsp;either&nbsp;expressed&nbsp;or&nbsp;implied.</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f7f5f">*&nbsp;You&nbsp;may&nbsp;study,&nbsp;use,&nbsp;and&nbsp;modify&nbsp;it&nbsp;for&nbsp;any&nbsp;non-commercial&nbsp;purpose.</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f7f5f">*&nbsp;You&nbsp;may&nbsp;distribute&nbsp;it&nbsp;non-commercially&nbsp;as&nbsp;long&nbsp;as&nbsp;you&nbsp;retain&nbsp;this&nbsp;notice.</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f7f5f">*&nbsp;For&nbsp;a&nbsp;commercial&nbsp;use&nbsp;license,&nbsp;or&nbsp;to&nbsp;purchase&nbsp;the&nbsp;book&nbsp;(recommended),</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f7f5f">*&nbsp;visit&nbsp;http://www.davidflanagan.com/javaexamples2.</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f7f5f">*/</font><br/>
<font color="#ffffff"></font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.io.BufferedReader;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.io.BufferedWriter;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.io.IOException;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.io.InputStream;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.io.InputStreamReader;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.io.InterruptedIOException;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.io.OutputStream;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.io.OutputStreamWriter;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.io.PrintWriter;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.net.ServerSocket;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.net.Socket;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.util.Date;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.util.HashMap;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.util.HashSet;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.util.Iterator;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.util.Map;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.util.Set;</font><br/>
<font color="#7f0055"><b>import&nbsp;</b></font><font color="#000000">java.util.StringTokenizer;</font><br/>
<font color="#ffffff"></font><br/>
<font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;class&nbsp;is&nbsp;a&nbsp;generic&nbsp;framework&nbsp;for&nbsp;a&nbsp;flexible,&nbsp;multi-threaded&nbsp;server.&nbsp;It</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f5fbf">*&nbsp;listens&nbsp;on&nbsp;any&nbsp;number&nbsp;of&nbsp;specified&nbsp;ports,&nbsp;and,&nbsp;when&nbsp;it&nbsp;receives&nbsp;a&nbsp;connection</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f5fbf">*&nbsp;on&nbsp;a&nbsp;port,&nbsp;passes&nbsp;input&nbsp;and&nbsp;output&nbsp;streams&nbsp;to&nbsp;a&nbsp;specified&nbsp;Service&nbsp;object</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f5fbf">*&nbsp;which&nbsp;provides&nbsp;the&nbsp;actual&nbsp;service.&nbsp;It&nbsp;can&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;concurrent</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f5fbf">*&nbsp;connections,&nbsp;and&nbsp;logs&nbsp;activity&nbsp;to&nbsp;a&nbsp;specified&nbsp;stream.</font><br/>
<font color="#ffffff">&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#7f0055"><b>public&nbsp;class&nbsp;</b></font><font color="#000000">Server&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;A&nbsp;main()&nbsp;method&nbsp;for&nbsp;running&nbsp;the&nbsp;server&nbsp;as&nbsp;a&nbsp;standalone&nbsp;program.&nbsp;The</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;command-line&nbsp;arguments&nbsp;to&nbsp;the&nbsp;program&nbsp;should&nbsp;be&nbsp;pairs&nbsp;of&nbsp;servicenames&nbsp;and</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;port&nbsp;numbers.&nbsp;For&nbsp;each&nbsp;pair,&nbsp;the&nbsp;program&nbsp;will&nbsp;dynamically&nbsp;load&nbsp;the&nbsp;named</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;Service&nbsp;class,&nbsp;instantiate&nbsp;it,&nbsp;and&nbsp;tell&nbsp;the&nbsp;server&nbsp;to&nbsp;provide&nbsp;that</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;Service&nbsp;on&nbsp;the&nbsp;specified&nbsp;port.&nbsp;The&nbsp;special&nbsp;-control&nbsp;argument&nbsp;should&nbsp;be</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;followed&nbsp;by&nbsp;a&nbsp;password&nbsp;and&nbsp;port,&nbsp;and&nbsp;will&nbsp;start&nbsp;special&nbsp;server&nbsp;control</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;service&nbsp;running&nbsp;on&nbsp;the&nbsp;specified&nbsp;port,&nbsp;protected&nbsp;by&nbsp;the&nbsp;specified</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;password.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;static&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">main</font><font color="#000000">(</font><font color="#000000">String</font><font color="#000000">[]&nbsp;</font><font color="#000000">args</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>try&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">args.length&nbsp;&lt;&nbsp;</font><font color="#990000">2</font><font color="#000000">)&nbsp;</font><font color="#3f7f5f">//&nbsp;Check&nbsp;number&nbsp;of&nbsp;arguments</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>throw&nbsp;new&nbsp;</b></font><font color="#000000">IllegalArgumentException</font><font color="#000000">(</font><font color="#2a00ff">&#34;Must&nbsp;specify&nbsp;a&nbsp;service&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Create&nbsp;a&nbsp;Server&nbsp;object&nbsp;that&nbsp;uses&nbsp;standard&nbsp;out&nbsp;as&nbsp;its&nbsp;log&nbsp;and</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;has&nbsp;a&nbsp;limit&nbsp;of&nbsp;ten&nbsp;concurrent&nbsp;connections&nbsp;at&nbsp;once.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Server&nbsp;s&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Server</font><font color="#000000">(</font><font color="#000000">System.out,&nbsp;</font><font color="#990000">10</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Parse&nbsp;the&nbsp;argument&nbsp;list</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">i&nbsp;=&nbsp;</font><font color="#990000">0</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>while&nbsp;</b></font><font color="#000000">(</font><font color="#000000">i&nbsp;&lt;&nbsp;args.length</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">args</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#000000">.equals</font><font color="#000000">(</font><font color="#2a00ff">&#34;-control&#34;</font><font color="#000000">))&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;Handle&nbsp;the&nbsp;-control&nbsp;arg</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">i++;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;password&nbsp;=&nbsp;args</font><font color="#000000">[</font><font color="#000000">i++</font><font color="#000000">]</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">port&nbsp;=&nbsp;Integer.parseInt</font><font color="#000000">(</font><font color="#000000">args</font><font color="#000000">[</font><font color="#000000">i++</font><font color="#000000">])</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;add&nbsp;control&nbsp;service</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">s.addService</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Control</font><font color="#000000">(</font><font color="#000000">s,&nbsp;password</font><font color="#000000">)</font><font color="#000000">,&nbsp;port</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Otherwise&nbsp;start&nbsp;a&nbsp;named&nbsp;service&nbsp;on&nbsp;the&nbsp;specified&nbsp;port.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Dynamically&nbsp;load&nbsp;and&nbsp;instantiate&nbsp;a&nbsp;Service&nbsp;class</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;serviceName&nbsp;=&nbsp;args</font><font color="#000000">[</font><font color="#000000">i++</font><font color="#000000">]</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>Class&nbsp;</b></font><font color="#000000">serviceClass&nbsp;=&nbsp;</font><font color="#7f0055"><b>Class</b></font><font color="#000000">.forName</font><font color="#000000">(</font><font color="#000000">serviceName</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Service&nbsp;service&nbsp;=&nbsp;</font><font color="#000000">(</font><font color="#000000">Service</font><font color="#000000">)&nbsp;</font><font color="#000000">serviceClass.newInstance</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">port&nbsp;=&nbsp;Integer.parseInt</font><font color="#000000">(</font><font color="#000000">args</font><font color="#000000">[</font><font color="#000000">i++</font><font color="#000000">])</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">s.addService</font><font color="#000000">(</font><font color="#000000">service,&nbsp;port</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>catch&nbsp;</b></font><font color="#000000">(</font><font color="#000000">Exception&nbsp;e</font><font color="#000000">)&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;Display&nbsp;a&nbsp;message&nbsp;if&nbsp;anything&nbsp;goes&nbsp;wrong</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">System.err.println</font><font color="#000000">(</font><font color="#2a00ff">&#34;Server:&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;e</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">System.err.println</font><font color="#000000">(</font><font color="#2a00ff">&#34;Usage:&nbsp;java&nbsp;Server&nbsp;&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;[-control&nbsp;&lt;password&gt;&nbsp;&lt;port&gt;]&nbsp;&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;[&lt;servicename&gt;&nbsp;&lt;port&gt;&nbsp;...&nbsp;]&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">System.exit</font><font color="#000000">(</font><font color="#990000">1</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;This&nbsp;is&nbsp;the&nbsp;state&nbsp;for&nbsp;the&nbsp;server</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">Map&nbsp;services;&nbsp;</font><font color="#3f7f5f">//&nbsp;Hashtable&nbsp;mapping&nbsp;ports&nbsp;to&nbsp;Listeners</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">Set&nbsp;connections;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;set&nbsp;of&nbsp;current&nbsp;connections</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">maxConnections;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;concurrent&nbsp;connection&nbsp;limit</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">ThreadGroup&nbsp;threadGroup;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;threadgroup&nbsp;for&nbsp;all&nbsp;our&nbsp;threads</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">PrintWriter&nbsp;logStream;&nbsp;</font><font color="#3f7f5f">//&nbsp;Where&nbsp;we&nbsp;send&nbsp;our&nbsp;logging&nbsp;output&nbsp;to</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;is&nbsp;the&nbsp;Server()&nbsp;constructor.&nbsp;It&nbsp;must&nbsp;be&nbsp;passed&nbsp;a&nbsp;stream&nbsp;to&nbsp;send&nbsp;log</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;output&nbsp;to&nbsp;(may&nbsp;be&nbsp;null),&nbsp;and&nbsp;the&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;concurrent</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;connections.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#000000">Server</font><font color="#000000">(</font><font color="#000000">OutputStream&nbsp;logStream,&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">maxConnections</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">setLogStream</font><font color="#000000">(</font><font color="#000000">logStream</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#2a00ff">&#34;Starting&nbsp;server&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">threadGroup&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">ThreadGroup</font><font color="#000000">(</font><font color="#000000">Server.</font><font color="#7f0055"><b>class</b></font><font color="#000000">.getName</font><font color="#000000">())</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>this</b></font><font color="#000000">.maxConnections&nbsp;=&nbsp;maxConnections;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">services&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">HashMap</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">connections&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">HashSet</font><font color="#000000">(</font><font color="#000000">maxConnections</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;A&nbsp;public&nbsp;method&nbsp;to&nbsp;set&nbsp;the&nbsp;current&nbsp;logging&nbsp;stream.&nbsp;Pass&nbsp;null&nbsp;to&nbsp;turn</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;logging&nbsp;off</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;synchronized&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">setLogStream</font><font color="#000000">(</font><font color="#000000">OutputStream&nbsp;out</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">out&nbsp;!=&nbsp;</font><font color="#7f0055"><b>null</b></font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">logStream&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">PrintWriter</font><font color="#000000">(</font><font color="#000000">out</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>else</b></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">logStream&nbsp;=&nbsp;</font><font color="#7f0055"><b>null</b></font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**&nbsp;Write&nbsp;the&nbsp;specified&nbsp;string&nbsp;to&nbsp;the&nbsp;log&nbsp;*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>protected&nbsp;synchronized&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">log</font><font color="#000000">(</font><font color="#000000">String&nbsp;s</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">logStream&nbsp;!=&nbsp;</font><font color="#7f0055"><b>null</b></font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">logStream.println</font><font color="#000000">(</font><font color="#2a00ff">&#34;[&#34;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Date</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;]&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;s</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">logStream.flush</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**&nbsp;Write&nbsp;the&nbsp;specified&nbsp;object&nbsp;to&nbsp;the&nbsp;log&nbsp;*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>protected&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">log</font><font color="#000000">(</font><font color="#000000">Object&nbsp;o</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#000000">o.toString</font><font color="#000000">())</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;method&nbsp;makes&nbsp;the&nbsp;server&nbsp;start&nbsp;providing&nbsp;a&nbsp;new&nbsp;service.&nbsp;It&nbsp;runs&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;specified&nbsp;Service&nbsp;object&nbsp;on&nbsp;the&nbsp;specified&nbsp;port.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;synchronized&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">addService</font><font color="#000000">(</font><font color="#000000">Service&nbsp;service,&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">port</font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>throws&nbsp;</b></font><font color="#000000">IOException&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Integer&nbsp;key&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Integer</font><font color="#000000">(</font><font color="#000000">port</font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;the&nbsp;hashtable&nbsp;key</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Check&nbsp;whether&nbsp;a&nbsp;service&nbsp;is&nbsp;already&nbsp;on&nbsp;that&nbsp;port</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">services.get</font><font color="#000000">(</font><font color="#000000">key</font><font color="#000000">)&nbsp;</font><font color="#000000">!=&nbsp;</font><font color="#7f0055"><b>null</b></font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>throw&nbsp;new&nbsp;</b></font><font color="#000000">IllegalArgumentException</font><font color="#000000">(</font><font color="#2a00ff">&#34;Port&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;port</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;&nbsp;already&nbsp;in&nbsp;use.&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Create&nbsp;a&nbsp;Listener&nbsp;object&nbsp;to&nbsp;listen&nbsp;for&nbsp;connections&nbsp;on&nbsp;the&nbsp;port</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Listener&nbsp;listener&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Listener</font><font color="#000000">(</font><font color="#000000">threadGroup,&nbsp;port,&nbsp;service</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Store&nbsp;it&nbsp;in&nbsp;the&nbsp;hashtable</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">services.put</font><font color="#000000">(</font><font color="#000000">key,&nbsp;listener</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Log&nbsp;it</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#2a00ff">&#34;Starting&nbsp;service&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;service.getClass</font><font color="#000000">()</font><font color="#000000">.getName</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;&nbsp;on&nbsp;port&nbsp;&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;port</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Start&nbsp;the&nbsp;listener&nbsp;running.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">listener.start</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;method&nbsp;makes&nbsp;the&nbsp;server&nbsp;stop&nbsp;providing&nbsp;a&nbsp;service&nbsp;on&nbsp;a&nbsp;port.&nbsp;It&nbsp;does</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;not&nbsp;terminate&nbsp;any&nbsp;pending&nbsp;connections&nbsp;to&nbsp;that&nbsp;service,&nbsp;merely&nbsp;causes&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;server&nbsp;to&nbsp;stop&nbsp;accepting&nbsp;new&nbsp;connections</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;synchronized&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">removeService</font><font color="#000000">(</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">port</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Integer&nbsp;key&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Integer</font><font color="#000000">(</font><font color="#000000">port</font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;hashtable&nbsp;key</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Look&nbsp;up&nbsp;the&nbsp;Listener&nbsp;object&nbsp;for&nbsp;the&nbsp;port&nbsp;in&nbsp;the&nbsp;hashtable</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>final&nbsp;</b></font><font color="#000000">Listener&nbsp;listener&nbsp;=&nbsp;</font><font color="#000000">(</font><font color="#000000">Listener</font><font color="#000000">)&nbsp;</font><font color="#000000">services.get</font><font color="#000000">(</font><font color="#000000">key</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">listener&nbsp;==&nbsp;</font><font color="#7f0055"><b>null</b></font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>return</b></font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Ask&nbsp;the&nbsp;listener&nbsp;to&nbsp;stop</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">listener.pleaseStop</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Remove&nbsp;it&nbsp;from&nbsp;the&nbsp;hashtable</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">services.remove</font><font color="#000000">(</font><font color="#000000">key</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;And&nbsp;log&nbsp;it.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#2a00ff">&#34;Stopping&nbsp;service&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;listener.service.getClass</font><font color="#000000">()</font><font color="#000000">.getName</font><font color="#000000">()</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;&nbsp;on&nbsp;port&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;port</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;nested&nbsp;Thread&nbsp;subclass&nbsp;is&nbsp;a&nbsp;&#34;listener&#34;.&nbsp;It&nbsp;listens&nbsp;for&nbsp;connections</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;on&nbsp;a&nbsp;specified&nbsp;port&nbsp;(using&nbsp;a&nbsp;ServerSocket)&nbsp;and&nbsp;when&nbsp;it&nbsp;gets&nbsp;a&nbsp;connection</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;request,&nbsp;it&nbsp;calls&nbsp;the&nbsp;servers&nbsp;addConnection()&nbsp;method&nbsp;to&nbsp;accept&nbsp;(or</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;reject)&nbsp;the&nbsp;connection.&nbsp;There&nbsp;is&nbsp;one&nbsp;Listener&nbsp;for&nbsp;each&nbsp;Service&nbsp;being</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;provided&nbsp;by&nbsp;the&nbsp;Server.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;class&nbsp;</b></font><font color="#000000">Listener&nbsp;</font><font color="#7f0055"><b>extends&nbsp;</b></font><font color="#000000">Thread&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">ServerSocket&nbsp;listen_socket;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;socket&nbsp;to&nbsp;listen&nbsp;for&nbsp;connections</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">port;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;port&nbsp;we're&nbsp;listening&nbsp;on</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Service&nbsp;service;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;service&nbsp;to&nbsp;provide&nbsp;on&nbsp;that&nbsp;port</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>volatile&nbsp;</b></font><font color="#7f0055"><b>boolean&nbsp;</b></font><font color="#000000">stop&nbsp;=&nbsp;</font><font color="#7f0055"><b>false</b></font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Whether&nbsp;we've&nbsp;been&nbsp;asked&nbsp;to&nbsp;stop</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;The&nbsp;Listener&nbsp;constructor&nbsp;creates&nbsp;a&nbsp;thread&nbsp;for&nbsp;itself&nbsp;in&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;threadgroup.&nbsp;It&nbsp;creates&nbsp;a&nbsp;ServerSocket&nbsp;to&nbsp;listen&nbsp;for&nbsp;connections&nbsp;on</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;the&nbsp;specified&nbsp;port.&nbsp;It&nbsp;arranges&nbsp;for&nbsp;the&nbsp;ServerSocket&nbsp;to&nbsp;be</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;interruptible,&nbsp;so&nbsp;that&nbsp;services&nbsp;can&nbsp;be&nbsp;removed&nbsp;from&nbsp;the&nbsp;server.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#000000">Listener</font><font color="#000000">(</font><font color="#000000">ThreadGroup&nbsp;group,&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">port,&nbsp;Service&nbsp;service</font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>throws&nbsp;</b></font><font color="#000000">IOException&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>super</b></font><font color="#000000">(</font><font color="#000000">group,&nbsp;</font><font color="#2a00ff">&#34;Listener:&#34;&nbsp;</font><font color="#000000">+&nbsp;port</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">listen_socket&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">ServerSocket</font><font color="#000000">(</font><font color="#000000">port</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;give&nbsp;it&nbsp;a&nbsp;non-zero&nbsp;timeout&nbsp;so&nbsp;accept()&nbsp;can&nbsp;be&nbsp;interrupted</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">listen_socket.setSoTimeout</font><font color="#000000">(</font><font color="#990000">600000</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>this</b></font><font color="#000000">.port&nbsp;=&nbsp;port;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>this</b></font><font color="#000000">.service&nbsp;=&nbsp;service;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">/***********************************************************************</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;is&nbsp;the&nbsp;polite&nbsp;way&nbsp;to&nbsp;get&nbsp;a&nbsp;Listener&nbsp;to&nbsp;stop&nbsp;accepting</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;connections</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">**********************************************************************/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">pleaseStop</font><font color="#000000">()&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>this</b></font><font color="#000000">.stop&nbsp;=&nbsp;</font><font color="#7f0055"><b>true</b></font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Set&nbsp;the&nbsp;stop&nbsp;flag</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>this</b></font><font color="#000000">.interrupt</font><font color="#000000">()</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Stop&nbsp;blocking&nbsp;in&nbsp;accept()</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>try&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">listen_socket.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#3f7f5f">//&nbsp;Stop&nbsp;listening.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>catch&nbsp;</b></font><font color="#000000">(</font><font color="#000000">IOException&nbsp;e</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;A&nbsp;Listener&nbsp;is&nbsp;a&nbsp;Thread,&nbsp;and&nbsp;this&nbsp;is&nbsp;its&nbsp;body.&nbsp;Wait&nbsp;for&nbsp;connection</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;requests,&nbsp;accept&nbsp;them,&nbsp;and&nbsp;pass&nbsp;the&nbsp;socket&nbsp;on&nbsp;to&nbsp;the&nbsp;addConnection</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;method&nbsp;of&nbsp;the&nbsp;server.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">run</font><font color="#000000">()&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>while&nbsp;</b></font><font color="#000000">(</font><font color="#000000">!stop</font><font color="#000000">)&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;loop&nbsp;until&nbsp;we're&nbsp;asked&nbsp;to&nbsp;stop.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>try&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Socket&nbsp;client&nbsp;=&nbsp;listen_socket.accept</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">addConnection</font><font color="#000000">(</font><font color="#000000">client,&nbsp;service</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>catch&nbsp;</b></font><font color="#000000">(</font><font color="#000000">InterruptedIOException&nbsp;e</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>catch&nbsp;</b></font><font color="#000000">(</font><font color="#000000">IOException&nbsp;e</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#000000">e</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;is&nbsp;the&nbsp;method&nbsp;that&nbsp;Listener&nbsp;objects&nbsp;call&nbsp;when&nbsp;they&nbsp;accept&nbsp;a</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;connection&nbsp;from&nbsp;a&nbsp;client.&nbsp;It&nbsp;either&nbsp;creates&nbsp;a&nbsp;Connection&nbsp;object&nbsp;for&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;connection&nbsp;and&nbsp;adds&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;current&nbsp;connections,&nbsp;or,&nbsp;if&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;limit&nbsp;on&nbsp;connections&nbsp;has&nbsp;been&nbsp;reached,&nbsp;it&nbsp;closes&nbsp;the&nbsp;connection.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>protected&nbsp;synchronized&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">addConnection</font><font color="#000000">(</font><font color="#000000">Socket&nbsp;s,&nbsp;Service&nbsp;service</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;If&nbsp;the&nbsp;connection&nbsp;limit&nbsp;has&nbsp;been&nbsp;reached</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">connections.size</font><font color="#000000">()&nbsp;</font><font color="#000000">&gt;=&nbsp;maxConnections</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>try&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Then&nbsp;tell&nbsp;the&nbsp;client&nbsp;it&nbsp;is&nbsp;being&nbsp;rejected.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">PrintWriter&nbsp;out&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">PrintWriter</font><font color="#000000">(</font><font color="#000000">s.getOutputStream</font><font color="#000000">())</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;Connection&nbsp;refused;&nbsp;&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;the&nbsp;server&nbsp;is&nbsp;busy;&nbsp;please&nbsp;try&nbsp;again&nbsp;later.\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.flush</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;And&nbsp;close&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;rejected&nbsp;client.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">s.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;And&nbsp;log&nbsp;it,&nbsp;of&nbsp;course</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#2a00ff">&#34;Connection&nbsp;refused&nbsp;to&nbsp;&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;s.getInetAddress</font><font color="#000000">()</font><font color="#000000">.getHostAddress</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;:&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;s.getPort</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;:&nbsp;max&nbsp;connections&nbsp;reached.&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>catch&nbsp;</b></font><font color="#000000">(</font><font color="#000000">IOException&nbsp;e</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#000000">e</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else&nbsp;</b></font><font color="#000000">{&nbsp;</font><font color="#3f7f5f">//&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;limit&nbsp;has&nbsp;not&nbsp;been&nbsp;reached</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Create&nbsp;a&nbsp;Connection&nbsp;thread&nbsp;to&nbsp;handle&nbsp;this&nbsp;connection</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Connection&nbsp;c&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Connection</font><font color="#000000">(</font><font color="#000000">s,&nbsp;service</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Add&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;current&nbsp;connections</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">connections.add</font><font color="#000000">(</font><font color="#000000">c</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Log&nbsp;this&nbsp;new&nbsp;connection</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#2a00ff">&#34;Connected&nbsp;to&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;s.getInetAddress</font><font color="#000000">()</font><font color="#000000">.getHostAddress</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;:&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;s.getPort</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;&nbsp;on&nbsp;port&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;s.getLocalPort</font><font color="#000000">()</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;&nbsp;for&nbsp;service&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;service.getClass</font><font color="#000000">()</font><font color="#000000">.getName</font><font color="#000000">())</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;And&nbsp;start&nbsp;the&nbsp;Connection&nbsp;thread&nbsp;to&nbsp;provide&nbsp;the&nbsp;service</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">c.start</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;A&nbsp;Connection&nbsp;thread&nbsp;calls&nbsp;this&nbsp;method&nbsp;just&nbsp;before&nbsp;it&nbsp;exits.&nbsp;It&nbsp;removes</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;the&nbsp;specified&nbsp;Connection&nbsp;from&nbsp;the&nbsp;set&nbsp;of&nbsp;connections.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>protected&nbsp;synchronized&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">endConnection</font><font color="#000000">(</font><font color="#000000">Connection&nbsp;c</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">connections.remove</font><font color="#000000">(</font><font color="#000000">c</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#2a00ff">&#34;Connection&nbsp;to&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;c.client.getInetAddress</font><font color="#000000">()</font><font color="#000000">.getHostAddress</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;:&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;c.client.getPort</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;&nbsp;closed.&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**&nbsp;Change&nbsp;the&nbsp;current&nbsp;connection&nbsp;limit&nbsp;*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;synchronized&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">setMaxConnections</font><font color="#000000">(</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">max</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">maxConnections&nbsp;=&nbsp;max;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;method&nbsp;displays&nbsp;status&nbsp;information&nbsp;about&nbsp;the&nbsp;server&nbsp;on&nbsp;the&nbsp;specified</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;stream.&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;debugging,&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;the&nbsp;Control&nbsp;service</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;later&nbsp;in&nbsp;this&nbsp;example.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;synchronized&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">displayStatus</font><font color="#000000">(</font><font color="#000000">PrintWriter&nbsp;out</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Display&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;Services&nbsp;that&nbsp;are&nbsp;being&nbsp;provided</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Iterator&nbsp;keys&nbsp;=&nbsp;services.keySet</font><font color="#000000">()</font><font color="#000000">.iterator</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>while&nbsp;</b></font><font color="#000000">(</font><font color="#000000">keys.hasNext</font><font color="#000000">())&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Integer&nbsp;port&nbsp;=&nbsp;</font><font color="#000000">(</font><font color="#000000">Integer</font><font color="#000000">)&nbsp;</font><font color="#000000">keys.next</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Listener&nbsp;listener&nbsp;=&nbsp;</font><font color="#000000">(</font><font color="#000000">Listener</font><font color="#000000">)&nbsp;</font><font color="#000000">services.get</font><font color="#000000">(</font><font color="#000000">port</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;SERVICE&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;listener.service.getClass</font><font color="#000000">()</font><font color="#000000">.getName</font><font color="#000000">()</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;&nbsp;ON&nbsp;PORT&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;port&nbsp;+&nbsp;</font><font color="#2a00ff">&#34;\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Display&nbsp;the&nbsp;current&nbsp;connection&nbsp;limit</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;MAX&nbsp;CONNECTIONS:&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;maxConnections&nbsp;+&nbsp;</font><font color="#2a00ff">&#34;\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Display&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;current&nbsp;connections</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Iterator&nbsp;conns&nbsp;=&nbsp;connections.iterator</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>while&nbsp;</b></font><font color="#000000">(</font><font color="#000000">conns.hasNext</font><font color="#000000">())&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Connection&nbsp;c&nbsp;=&nbsp;</font><font color="#000000">(</font><font color="#000000">Connection</font><font color="#000000">)&nbsp;</font><font color="#000000">conns.next</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;CONNECTED&nbsp;TO&nbsp;&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;c.client.getInetAddress</font><font color="#000000">()</font><font color="#000000">.getHostAddress</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;:&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;c.client.getPort</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;&nbsp;ON&nbsp;PORT&nbsp;&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;c.client.getLocalPort</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;&nbsp;FOR&nbsp;SERVICE&nbsp;&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;c.service.getClass</font><font color="#000000">()</font><font color="#000000">.getName</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;class&nbsp;is&nbsp;a&nbsp;subclass&nbsp;of&nbsp;Thread&nbsp;that&nbsp;handles&nbsp;an&nbsp;individual&nbsp;connection</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;between&nbsp;a&nbsp;client&nbsp;and&nbsp;a&nbsp;Service&nbsp;provided&nbsp;by&nbsp;this&nbsp;server.&nbsp;Because&nbsp;each&nbsp;such</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;connection&nbsp;has&nbsp;a&nbsp;thread&nbsp;of&nbsp;its&nbsp;own,&nbsp;each&nbsp;Service&nbsp;can&nbsp;have&nbsp;multiple</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;connections&nbsp;pending&nbsp;at&nbsp;once.&nbsp;Despite&nbsp;all&nbsp;the&nbsp;other&nbsp;threads&nbsp;in&nbsp;use,&nbsp;this</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;is&nbsp;the&nbsp;key&nbsp;feature&nbsp;that&nbsp;makes&nbsp;this&nbsp;a&nbsp;multi-threaded&nbsp;server</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;implementation.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;class&nbsp;</b></font><font color="#000000">Connection&nbsp;</font><font color="#7f0055"><b>extends&nbsp;</b></font><font color="#000000">Thread&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Socket&nbsp;client;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;socket&nbsp;to&nbsp;talk&nbsp;to&nbsp;the&nbsp;client&nbsp;through</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Service&nbsp;service;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;service&nbsp;being&nbsp;provided&nbsp;to&nbsp;that&nbsp;client</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;constructor&nbsp;just&nbsp;saves&nbsp;some&nbsp;state&nbsp;and&nbsp;calls&nbsp;the&nbsp;superclass</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;constructor&nbsp;to&nbsp;create&nbsp;a&nbsp;thread&nbsp;to&nbsp;handle&nbsp;the&nbsp;connection.&nbsp;Connection</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;objects&nbsp;are&nbsp;created&nbsp;by&nbsp;Listener&nbsp;threads.&nbsp;These&nbsp;threads&nbsp;are&nbsp;part&nbsp;of</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;the&nbsp;server's&nbsp;ThreadGroup,&nbsp;so&nbsp;all&nbsp;Connection&nbsp;threads&nbsp;are&nbsp;part&nbsp;of&nbsp;that</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;group,&nbsp;too.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#000000">Connection</font><font color="#000000">(</font><font color="#000000">Socket&nbsp;client,&nbsp;Service&nbsp;service</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>super</b></font><font color="#000000">(</font><font color="#2a00ff">&#34;Server.Connection:&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;client.getInetAddress</font><font color="#000000">()</font><font color="#000000">.getHostAddress</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;:&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;client.getPort</font><font color="#000000">())</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>this</b></font><font color="#000000">.client&nbsp;=&nbsp;client;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>this</b></font><font color="#000000">.service&nbsp;=&nbsp;service;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;each&nbsp;and&nbsp;every&nbsp;Connection&nbsp;thread.&nbsp;All&nbsp;it&nbsp;does&nbsp;is</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;pass&nbsp;the&nbsp;client&nbsp;input&nbsp;and&nbsp;output&nbsp;streams&nbsp;to&nbsp;the&nbsp;serve()&nbsp;method&nbsp;of&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;specified&nbsp;Service&nbsp;object.&nbsp;That&nbsp;method&nbsp;is&nbsp;responsible&nbsp;for&nbsp;reading&nbsp;from</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;and&nbsp;writing&nbsp;to&nbsp;those&nbsp;streams&nbsp;to&nbsp;provide&nbsp;the&nbsp;actual&nbsp;service.&nbsp;Recall</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;that&nbsp;the&nbsp;Service&nbsp;object&nbsp;has&nbsp;been&nbsp;passed&nbsp;from&nbsp;the&nbsp;Server.addService()</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;method&nbsp;to&nbsp;a&nbsp;Listener&nbsp;object&nbsp;to&nbsp;the&nbsp;addConnection()&nbsp;method&nbsp;to&nbsp;this</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;Connection&nbsp;object,&nbsp;and&nbsp;is&nbsp;now&nbsp;finally&nbsp;being&nbsp;used&nbsp;to&nbsp;provide&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;service.&nbsp;Note&nbsp;that&nbsp;just&nbsp;before&nbsp;this&nbsp;thread&nbsp;exits&nbsp;it&nbsp;always&nbsp;calls&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;endConnection()&nbsp;method&nbsp;to&nbsp;remove&nbsp;itself&nbsp;from&nbsp;the&nbsp;set&nbsp;of&nbsp;connections</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">run</font><font color="#000000">()&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>try&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">InputStream&nbsp;in&nbsp;=&nbsp;client.getInputStream</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">OutputStream&nbsp;out&nbsp;=&nbsp;client.getOutputStream</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">service.serve</font><font color="#000000">(</font><font color="#000000">in,&nbsp;out</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>catch&nbsp;</b></font><font color="#000000">(</font><font color="#000000">IOException&nbsp;e</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">log</font><font color="#000000">(</font><font color="#000000">e</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>finally&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">endConnection</font><font color="#000000">(</font><font color="#7f0055"><b>this</b></font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;Here&nbsp;is&nbsp;the&nbsp;Service&nbsp;interface&nbsp;that&nbsp;we&nbsp;have&nbsp;seen&nbsp;so&nbsp;much&nbsp;of.&nbsp;It&nbsp;defines</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;only&nbsp;a&nbsp;single&nbsp;method&nbsp;which&nbsp;is&nbsp;invoked&nbsp;to&nbsp;provide&nbsp;the&nbsp;service.&nbsp;serve()</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;will&nbsp;be&nbsp;passed&nbsp;an&nbsp;input&nbsp;stream&nbsp;and&nbsp;an&nbsp;output&nbsp;stream&nbsp;to&nbsp;the&nbsp;client.&nbsp;It</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;should&nbsp;do&nbsp;whatever&nbsp;it&nbsp;wants&nbsp;with&nbsp;them,&nbsp;and&nbsp;should&nbsp;close&nbsp;them&nbsp;before</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;returning.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;All&nbsp;connections&nbsp;through&nbsp;the&nbsp;same&nbsp;port&nbsp;to&nbsp;this&nbsp;service&nbsp;share&nbsp;a&nbsp;single</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;Service&nbsp;object.&nbsp;Thus,&nbsp;any&nbsp;state&nbsp;local&nbsp;to&nbsp;an&nbsp;individual&nbsp;connection&nbsp;must&nbsp;be</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;stored&nbsp;in&nbsp;local&nbsp;variables&nbsp;within&nbsp;the&nbsp;serve()&nbsp;method.&nbsp;State&nbsp;that&nbsp;should&nbsp;be</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;global&nbsp;to&nbsp;all&nbsp;connections&nbsp;on&nbsp;the&nbsp;same&nbsp;port&nbsp;should&nbsp;be&nbsp;stored&nbsp;in&nbsp;instance</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;variables&nbsp;of&nbsp;the&nbsp;Service&nbsp;class.&nbsp;If&nbsp;the&nbsp;same&nbsp;Service&nbsp;is&nbsp;running&nbsp;on&nbsp;more</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;than&nbsp;one&nbsp;port,&nbsp;there&nbsp;will&nbsp;typically&nbsp;be&nbsp;different&nbsp;Service&nbsp;instances&nbsp;for</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;each&nbsp;port.&nbsp;Data&nbsp;that&nbsp;should&nbsp;be&nbsp;global&nbsp;to&nbsp;all&nbsp;connections&nbsp;on&nbsp;any&nbsp;port</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;should&nbsp;be&nbsp;stored&nbsp;in&nbsp;static&nbsp;variables.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;Note&nbsp;that&nbsp;implementations&nbsp;of&nbsp;this&nbsp;interface&nbsp;must&nbsp;have&nbsp;a&nbsp;no-argument</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;constructor&nbsp;if&nbsp;they&nbsp;are&nbsp;to&nbsp;be&nbsp;dynamically&nbsp;instantiated&nbsp;by&nbsp;the&nbsp;main()</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;method&nbsp;of&nbsp;the&nbsp;Server&nbsp;class.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;interface&nbsp;</b></font><font color="#000000">Service&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">serve</font><font color="#000000">(</font><font color="#000000">InputStream&nbsp;in,&nbsp;OutputStream&nbsp;out</font><font color="#000000">)&nbsp;</font><font color="#7f0055"><b>throws&nbsp;</b></font><font color="#000000">IOException;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;A&nbsp;very&nbsp;simple&nbsp;service.&nbsp;It&nbsp;displays&nbsp;the&nbsp;current&nbsp;time&nbsp;on&nbsp;the&nbsp;server&nbsp;to&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;client,&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;static&nbsp;class&nbsp;</b></font><font color="#000000">Time&nbsp;</font><font color="#7f0055"><b>implements&nbsp;</b></font><font color="#000000">Service&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">serve</font><font color="#000000">(</font><font color="#000000">InputStream&nbsp;i,&nbsp;OutputStream&nbsp;o</font><font color="#000000">)&nbsp;</font><font color="#7f0055"><b>throws&nbsp;</b></font><font color="#000000">IOException&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">PrintWriter&nbsp;out&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">PrintWriter</font><font color="#000000">(</font><font color="#000000">o</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Date</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">i.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;is&nbsp;another&nbsp;example&nbsp;service.&nbsp;It&nbsp;reads&nbsp;lines&nbsp;of&nbsp;input&nbsp;from&nbsp;the&nbsp;client,</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;and&nbsp;sends&nbsp;them&nbsp;back,&nbsp;reversed.&nbsp;It&nbsp;also&nbsp;displays&nbsp;a&nbsp;welcome&nbsp;message&nbsp;and</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;instructions,&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;when&nbsp;the&nbsp;user&nbsp;enters&nbsp;a&nbsp;'.'&nbsp;on&nbsp;a</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;line&nbsp;by&nbsp;itself.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;static&nbsp;class&nbsp;</b></font><font color="#000000">Reverse&nbsp;</font><font color="#7f0055"><b>implements&nbsp;</b></font><font color="#000000">Service&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">serve</font><font color="#000000">(</font><font color="#000000">InputStream&nbsp;i,&nbsp;OutputStream&nbsp;o</font><font color="#000000">)&nbsp;</font><font color="#7f0055"><b>throws&nbsp;</b></font><font color="#000000">IOException&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">BufferedReader&nbsp;in&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">BufferedReader</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">InputStreamReader</font><font color="#000000">(</font><font color="#000000">i</font><font color="#000000">))</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">PrintWriter&nbsp;out&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">PrintWriter</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">BufferedWriter</font><font color="#000000">(</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">OutputStreamWriter</font><font color="#000000">(</font><font color="#000000">o</font><font color="#000000">)))</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;Welcome&nbsp;to&nbsp;the&nbsp;line&nbsp;reversal&nbsp;server.\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;Enter&nbsp;lines.&nbsp;&nbsp;End&nbsp;with&nbsp;a&nbsp;'.'&nbsp;on&nbsp;a&nbsp;line&nbsp;by&nbsp;itself.\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>for&nbsp;</b></font><font color="#000000">(</font><font color="#000000">;;</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;&gt;&nbsp;&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.flush</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;line&nbsp;=&nbsp;in.readLine</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">((</font><font color="#000000">line&nbsp;==&nbsp;</font><font color="#7f0055"><b>null</b></font><font color="#000000">)&nbsp;</font><font color="#000000">||&nbsp;line.equals</font><font color="#000000">(</font><font color="#2a00ff">&#34;.&#34;</font><font color="#000000">))</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>break</b></font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>for&nbsp;</b></font><font color="#000000">(</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">j&nbsp;=&nbsp;line.length</font><font color="#000000">()&nbsp;</font><font color="#000000">-&nbsp;</font><font color="#990000">1</font><font color="#000000">;&nbsp;j&nbsp;&gt;=&nbsp;</font><font color="#990000">0</font><font color="#000000">;&nbsp;j--</font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#000000">line.charAt</font><font color="#000000">(</font><font color="#000000">j</font><font color="#000000">))</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">in.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;service&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;mirror,&nbsp;just&nbsp;like&nbsp;the&nbsp;HttpMirror&nbsp;class</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;implemented&nbsp;earlier&nbsp;in&nbsp;this&nbsp;chapter.&nbsp;It&nbsp;echos&nbsp;back&nbsp;the&nbsp;client's&nbsp;HTTP</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;request</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;static&nbsp;class&nbsp;</b></font><font color="#000000">HTTPMirror&nbsp;</font><font color="#7f0055"><b>implements&nbsp;</b></font><font color="#000000">Service&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">serve</font><font color="#000000">(</font><font color="#000000">InputStream&nbsp;i,&nbsp;OutputStream&nbsp;o</font><font color="#000000">)&nbsp;</font><font color="#7f0055"><b>throws&nbsp;</b></font><font color="#000000">IOException&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">BufferedReader&nbsp;in&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">BufferedReader</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">InputStreamReader</font><font color="#000000">(</font><font color="#000000">i</font><font color="#000000">))</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">PrintWriter&nbsp;out&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">PrintWriter</font><font color="#000000">(</font><font color="#000000">o</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;HTTP/1.0&nbsp;200&nbsp;\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;Content-Type:&nbsp;text/plain\n\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;line;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>while&nbsp;</b></font><font color="#000000">((</font><font color="#000000">line&nbsp;=&nbsp;in.readLine</font><font color="#000000">())&nbsp;</font><font color="#000000">!=&nbsp;</font><font color="#7f0055"><b>null</b></font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">line.length</font><font color="#000000">()&nbsp;</font><font color="#000000">==&nbsp;</font><font color="#990000">0</font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>break</b></font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#000000">line&nbsp;+&nbsp;</font><font color="#2a00ff">&#34;\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">in.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;service&nbsp;demonstrates&nbsp;how&nbsp;to&nbsp;maintain&nbsp;state&nbsp;across&nbsp;connections&nbsp;by</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;saving&nbsp;it&nbsp;in&nbsp;instance&nbsp;variables&nbsp;and&nbsp;using&nbsp;synchronized&nbsp;access&nbsp;to&nbsp;those</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;variables.&nbsp;It&nbsp;maintains&nbsp;a&nbsp;count&nbsp;of&nbsp;how&nbsp;many&nbsp;clients&nbsp;have&nbsp;connected&nbsp;and</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;tells&nbsp;each&nbsp;client&nbsp;what&nbsp;number&nbsp;it&nbsp;is</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;static&nbsp;class&nbsp;</b></font><font color="#000000">UniqueID&nbsp;</font><font color="#7f0055"><b>implements&nbsp;</b></font><font color="#000000">Service&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">id&nbsp;=&nbsp;</font><font color="#990000">0</font><font color="#000000">;</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;synchronized&nbsp;</b></font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">nextId</font><font color="#000000">()&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>return&nbsp;</b></font><font color="#000000">id++;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">serve</font><font color="#000000">(</font><font color="#000000">InputStream&nbsp;i,&nbsp;OutputStream&nbsp;o</font><font color="#000000">)&nbsp;</font><font color="#7f0055"><b>throws&nbsp;</b></font><font color="#000000">IOException&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">PrintWriter&nbsp;out&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">PrintWriter</font><font color="#000000">(</font><font color="#000000">o</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;You&nbsp;are&nbsp;client&nbsp;#:&nbsp;&#34;&nbsp;</font><font color="#000000">+&nbsp;nextId</font><font color="#000000">()&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">i.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;is&nbsp;a&nbsp;non-trivial&nbsp;service.&nbsp;It&nbsp;implements&nbsp;a&nbsp;command-based&nbsp;protocol</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;that&nbsp;gives&nbsp;password-protected&nbsp;runtime&nbsp;control&nbsp;over&nbsp;the&nbsp;operation&nbsp;of&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;server.&nbsp;See&nbsp;the&nbsp;main()&nbsp;method&nbsp;of&nbsp;the&nbsp;Server&nbsp;class&nbsp;to&nbsp;see&nbsp;how&nbsp;this&nbsp;service</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;is&nbsp;started.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;The&nbsp;recognized&nbsp;commands&nbsp;are:&nbsp;password:&nbsp;give&nbsp;password;&nbsp;authorization&nbsp;is</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;required&nbsp;for&nbsp;most&nbsp;commands&nbsp;add:&nbsp;dynamically&nbsp;add&nbsp;a&nbsp;named&nbsp;service&nbsp;on&nbsp;a</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;specified&nbsp;port&nbsp;remove:&nbsp;dynamically&nbsp;remove&nbsp;the&nbsp;service&nbsp;running&nbsp;on&nbsp;a</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;specified&nbsp;port&nbsp;max:&nbsp;change&nbsp;the&nbsp;current&nbsp;maximum&nbsp;connection&nbsp;limit.&nbsp;status:</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;display&nbsp;current&nbsp;services,&nbsp;connections,&nbsp;and&nbsp;connection&nbsp;limit&nbsp;help:&nbsp;display</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;a&nbsp;help&nbsp;message&nbsp;quit:&nbsp;disconnect</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;service&nbsp;displays&nbsp;a&nbsp;prompt,&nbsp;and&nbsp;sends&nbsp;all&nbsp;of&nbsp;its&nbsp;output&nbsp;to&nbsp;the&nbsp;user</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;in&nbsp;capital&nbsp;letters.&nbsp;Only&nbsp;one&nbsp;client&nbsp;is&nbsp;allowed&nbsp;to&nbsp;connect&nbsp;to&nbsp;this&nbsp;service</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;at&nbsp;a&nbsp;time.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;static&nbsp;class&nbsp;</b></font><font color="#000000">Control&nbsp;</font><font color="#7f0055"><b>implements&nbsp;</b></font><font color="#000000">Service&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Server&nbsp;server;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;server&nbsp;we&nbsp;control</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;password;&nbsp;</font><font color="#3f7f5f">//&nbsp;The&nbsp;password&nbsp;we&nbsp;require</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>boolean&nbsp;</b></font><font color="#000000">connected&nbsp;=&nbsp;</font><font color="#7f0055"><b>false</b></font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Whether&nbsp;a&nbsp;client&nbsp;is&nbsp;already&nbsp;connected</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;Create&nbsp;a&nbsp;new&nbsp;Control&nbsp;service.&nbsp;It&nbsp;will&nbsp;control&nbsp;the&nbsp;specified&nbsp;Server</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;object,&nbsp;and&nbsp;will&nbsp;require&nbsp;the&nbsp;specified&nbsp;password&nbsp;for&nbsp;authorization</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;Note&nbsp;that&nbsp;this&nbsp;Service&nbsp;does&nbsp;not&nbsp;have&nbsp;a&nbsp;no&nbsp;argument&nbsp;constructor,&nbsp;which</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;means&nbsp;that&nbsp;it&nbsp;cannot&nbsp;be&nbsp;dynamically&nbsp;instantiated&nbsp;and&nbsp;added&nbsp;as&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;other,&nbsp;generic&nbsp;services&nbsp;above&nbsp;can&nbsp;be.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#000000">Control</font><font color="#000000">(</font><font color="#000000">Server&nbsp;server,&nbsp;String&nbsp;password</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>this</b></font><font color="#000000">.server&nbsp;=&nbsp;server;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>this</b></font><font color="#000000">.password&nbsp;=&nbsp;password;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">/**</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;This&nbsp;is&nbsp;the&nbsp;serve&nbsp;method&nbsp;that&nbsp;provides&nbsp;the&nbsp;service.&nbsp;It&nbsp;reads&nbsp;a&nbsp;line</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;the&nbsp;client,&nbsp;and&nbsp;uses&nbsp;java.util.StringTokenizer&nbsp;to&nbsp;parse&nbsp;it&nbsp;into</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;commands&nbsp;and&nbsp;arguments.&nbsp;It&nbsp;does&nbsp;various&nbsp;things&nbsp;depending&nbsp;on&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*&nbsp;command.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f5fbf">*/</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">serve</font><font color="#000000">(</font><font color="#000000">InputStream&nbsp;i,&nbsp;OutputStream&nbsp;o</font><font color="#000000">)&nbsp;</font><font color="#7f0055"><b>throws&nbsp;</b></font><font color="#000000">IOException&nbsp;</font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Setup&nbsp;the&nbsp;streams</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">BufferedReader&nbsp;in&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">BufferedReader</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">InputStreamReader</font><font color="#000000">(</font><font color="#000000">i</font><font color="#000000">))</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">PrintWriter&nbsp;out&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">PrintWriter</font><font color="#000000">(</font><font color="#000000">o</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;line;&nbsp;</font><font color="#3f7f5f">//&nbsp;For&nbsp;reading&nbsp;client&nbsp;input&nbsp;lines</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Has&nbsp;the&nbsp;user&nbsp;has&nbsp;given&nbsp;the&nbsp;password&nbsp;yet?</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>boolean&nbsp;</b></font><font color="#000000">authorized&nbsp;=&nbsp;</font><font color="#7f0055"><b>false</b></font><font color="#000000">;</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;If&nbsp;there&nbsp;is&nbsp;already&nbsp;a&nbsp;client&nbsp;connected&nbsp;to&nbsp;this&nbsp;service,&nbsp;display</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;a&nbsp;message&nbsp;to&nbsp;this&nbsp;client&nbsp;and&nbsp;close&nbsp;the&nbsp;connection.&nbsp;We&nbsp;use&nbsp;a</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;synchronized&nbsp;block&nbsp;to&nbsp;prevent&nbsp;a&nbsp;race&nbsp;condition.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>synchronized&nbsp;</b></font><font color="#000000">(</font><font color="#7f0055"><b>this</b></font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">connected</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;ONLY&nbsp;ONE&nbsp;CONTROL&nbsp;CONNECTION&nbsp;ALLOWED.\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>return</b></font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else</b></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">connected&nbsp;=&nbsp;</font><font color="#7f0055"><b>true</b></font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;This&nbsp;is&nbsp;the&nbsp;main&nbsp;loop:&nbsp;read&nbsp;a&nbsp;command,&nbsp;parse&nbsp;it,&nbsp;and&nbsp;handle&nbsp;it</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>for&nbsp;</b></font><font color="#000000">(</font><font color="#000000">;;</font><font color="#000000">)&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;infinite&nbsp;loop</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;&gt;&nbsp;&#34;</font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Display&nbsp;a&nbsp;prompt</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.flush</font><font color="#000000">()</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Make&nbsp;it&nbsp;appear&nbsp;right&nbsp;away</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">line&nbsp;=&nbsp;in.readLine</font><font color="#000000">()</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Get&nbsp;the&nbsp;user's&nbsp;input</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">line&nbsp;==&nbsp;</font><font color="#7f0055"><b>null</b></font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>break</b></font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Quit&nbsp;if&nbsp;we&nbsp;get&nbsp;EOF.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>try&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Use&nbsp;a&nbsp;StringTokenizer&nbsp;to&nbsp;parse&nbsp;the&nbsp;user's&nbsp;command</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">StringTokenizer&nbsp;t&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">StringTokenizer</font><font color="#000000">(</font><font color="#000000">line</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">!t.hasMoreTokens</font><font color="#000000">())</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>continue</b></font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;if&nbsp;input&nbsp;was&nbsp;empty</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Get&nbsp;first&nbsp;word&nbsp;of&nbsp;the&nbsp;input&nbsp;and&nbsp;convert&nbsp;to&nbsp;lower&nbsp;case</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;command&nbsp;=&nbsp;t.nextToken</font><font color="#000000">()</font><font color="#000000">.toLowerCase</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Now&nbsp;compare&nbsp;to&nbsp;each&nbsp;of&nbsp;the&nbsp;possible&nbsp;commands,&nbsp;doing&nbsp;the</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;appropriate&nbsp;thing&nbsp;for&nbsp;each&nbsp;command</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">command.equals</font><font color="#000000">(</font><font color="#2a00ff">&#34;password&#34;</font><font color="#000000">))&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;Password&nbsp;command</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;p&nbsp;=&nbsp;t.nextToken</font><font color="#000000">()</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Get&nbsp;the&nbsp;next&nbsp;word</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">p.equals</font><font color="#000000">(</font><font color="#7f0055"><b>this</b></font><font color="#000000">.password</font><font color="#000000">))&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;Is&nbsp;it&nbsp;the&nbsp;password?</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;OK\n&#34;</font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Say&nbsp;so</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">authorized&nbsp;=&nbsp;</font><font color="#7f0055"><b>true</b></font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Grant&nbsp;authorization</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else</b></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;INVALID&nbsp;PASSWORD\n&#34;</font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Otherwise&nbsp;fail</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else&nbsp;if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">command.equals</font><font color="#000000">(</font><font color="#2a00ff">&#34;add&#34;</font><font color="#000000">))&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;Add&nbsp;Service&nbsp;command</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Check&nbsp;whether&nbsp;password&nbsp;has&nbsp;been&nbsp;given</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">!authorized</font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;PASSWORD&nbsp;REQUIRED\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>else&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Get&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;try&nbsp;to</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;dynamically&nbsp;load&nbsp;and&nbsp;instantiate&nbsp;it.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Exceptions&nbsp;will&nbsp;be&nbsp;handled&nbsp;below</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;serviceName&nbsp;=&nbsp;t.nextToken</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>Class&nbsp;</b></font><font color="#000000">serviceClass&nbsp;=&nbsp;</font><font color="#7f0055"><b>Class</b></font><font color="#000000">.forName</font><font color="#000000">(</font><font color="#000000">serviceName</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">Service&nbsp;service;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>try&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">service&nbsp;=&nbsp;</font><font color="#000000">(</font><font color="#000000">Service</font><font color="#000000">)&nbsp;</font><font color="#000000">serviceClass.newInstance</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>catch&nbsp;</b></font><font color="#000000">(</font><font color="#000000">NoSuchMethodError&nbsp;e</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>throw&nbsp;new&nbsp;</b></font><font color="#000000">IllegalArgumentException</font><font color="#000000">(</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#2a00ff">&#34;Service&nbsp;must&nbsp;have&nbsp;a&nbsp;&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;no-argument&nbsp;constructor&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">port&nbsp;=&nbsp;Integer.parseInt</font><font color="#000000">(</font><font color="#000000">t.nextToken</font><font color="#000000">())</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;If&nbsp;no&nbsp;exceptions&nbsp;occurred,&nbsp;add&nbsp;the&nbsp;service</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">server.addService</font><font color="#000000">(</font><font color="#000000">service,&nbsp;port</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;SERVICE&nbsp;ADDED\n&#34;</font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;acknowledge</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else&nbsp;if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">command.equals</font><font color="#000000">(</font><font color="#2a00ff">&#34;remove&#34;</font><font color="#000000">))&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;Remove&nbsp;service</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">!authorized</font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;PASSWORD&nbsp;REQUIRED\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>else&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">port&nbsp;=&nbsp;Integer.parseInt</font><font color="#000000">(</font><font color="#000000">t.nextToken</font><font color="#000000">())</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">server.removeService</font><font color="#000000">(</font><font color="#000000">port</font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;remove&nbsp;the&nbsp;service</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;SERVICE&nbsp;REMOVED\n&#34;</font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;acknowledge</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else&nbsp;if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">command.equals</font><font color="#000000">(</font><font color="#2a00ff">&#34;max&#34;</font><font color="#000000">))&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;Set&nbsp;connection&nbsp;limit</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">!authorized</font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;PASSWORD&nbsp;REQUIRED\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>else&nbsp;</b></font><font color="#000000">{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">max&nbsp;=&nbsp;Integer.parseInt</font><font color="#000000">(</font><font color="#000000">t.nextToken</font><font color="#000000">())</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">server.setMaxConnections</font><font color="#000000">(</font><font color="#000000">max</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;MAX&nbsp;CONNECTIONS&nbsp;CHANGED\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else&nbsp;if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">command.equals</font><font color="#000000">(</font><font color="#2a00ff">&#34;status&#34;</font><font color="#000000">))&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;Status&nbsp;Display</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">!authorized</font><font color="#000000">)</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;PASSWORD&nbsp;REQUIRED\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>else</b></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">server.displayStatus</font><font color="#000000">(</font><font color="#000000">out</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else&nbsp;if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">command.equals</font><font color="#000000">(</font><font color="#2a00ff">&#34;help&#34;</font><font color="#000000">))&nbsp;{&nbsp;</font><font color="#3f7f5f">//&nbsp;Help&nbsp;command</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#3f7f5f">//&nbsp;Display&nbsp;command&nbsp;syntax.&nbsp;Password&nbsp;not&nbsp;required</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;COMMANDS:\n&#34;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\tpassword&nbsp;&lt;password&gt;\n&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\tadd&nbsp;&lt;service&gt;&nbsp;&lt;port&gt;\n&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\tremove&nbsp;&lt;port&gt;\n&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\tmax&nbsp;&lt;max-connections&gt;\n&#34;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\tstatus\n&#34;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\thelp\n&#34;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\tquit\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>else&nbsp;if&nbsp;</b></font><font color="#000000">(</font><font color="#000000">command.equals</font><font color="#000000">(</font><font color="#2a00ff">&#34;quit&#34;</font><font color="#000000">))</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>break</b></font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Quit&nbsp;command.</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>else</b></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;UNRECOGNIZED&nbsp;COMMAND\n&#34;</font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;Error</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}&nbsp;</font><font color="#7f0055"><b>catch&nbsp;</b></font><font color="#000000">(</font><font color="#000000">Exception&nbsp;e</font><font color="#000000">)&nbsp;{</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.print</font><font color="#000000">(</font><font color="#2a00ff">&#34;ERROR&nbsp;WHILE&nbsp;PARSING&nbsp;OR&nbsp;EXECUTING&nbsp;COMMAND:\n&#34;&nbsp;</font><font color="#000000">+&nbsp;e</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;\n&#34;</font><font color="#000000">)</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">connected&nbsp;=&nbsp;</font><font color="#7f0055"><b>false</b></font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">out.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">in.close</font><font color="#000000">()</font><font color="#000000">;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font><font color="#000000">}</font><br/>
<font color="#000000">}</font><br/>
<font color="#ffffff"></font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;</font><br/>
<font color="#ffffff">&nbsp;&nbsp;</font></code></div></td>   </tr>
</table>
</td></tr>
<tr><td><TABLE width="650"  border=0 cellSpacing=0 cellPadding=0 border=0><TBODY>
<TR><TD align=left><script type="text/javascript"><!--
google_ad_client="pub-1130008796007602";google_ad_width=300;google_ad_height=250;google_ad_format="300x250_as";google_ad_type="text_image";google_ad_channel="";google_color_border="ffffff";google_color_bg="FFFFFF";google_color_link="003399";google_color_url="75a3ed";google_color_text="000000";
//--></script><script type="text/javascript"src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script></TD>
<td align=right><script type="text/javascript"><!--
google_ad_client="pub-1130008796007602";google_ad_width=300;google_ad_height=250;google_ad_format="300x250_as";google_ad_type="text_image";google_ad_channel="";google_color_border="ffffff";google_color_bg="FFFFFF";google_color_link="003399";google_color_url="75a3ed";google_color_text="000000";
//--></script><script type="text/javascript"src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script></td></TR></TBODY>
</TABLE></td></tr>
<tr><td></td></tr>
<tr><td class=relatedExample>Related examples in the same category</td></tr></table><table cellpadding=0 cellspacing=0 width=800 border=0><tr class=even><td>1.</td><td align=left><A href="/Code/Java/Network-Protocol/Serverallowsconnectionsonsocket6123.htm">Server allows connections on socket 6123</a></td><td width=32></td><td width=200 align=right><A href="/Code/Java/Network-Protocol/Serverallowsconnectionsonsocket6123.htm"><IMG border=0 alt="Server allows connections on socket 6123" src="http://www.java2s.com/Code/JavaImages/SocketDemo.PNG" width=200 height=40></a></td></tr><tr class=odd><td>2.</td><td align=left><A href="/Code/Java/Network-Protocol/Thisserverdisplaysmessagestoasingleclient.htm">This server displays messages to a single client</a></td><td width=32></td><td width=200 align=right><A href="/Code/Java/Network-Protocol/Thisserverdisplaysmessagestoasingleclient.htm"><IMG border=0 alt="This server displays messages to a single client" src="http://www.java2s.com/Code/JavaImages/BeerServer.PNG" width=200 height=40></a></td></tr><tr class=even><td>3.</td><td align=left><A href="/Code/Java/Network-Protocol/Theclientcanspecifyinformationtocontroltheoutputofaserver.htm">The client can specify information to control the output of a server</a></td><td width=32></td><td width=200 align=right><A href="/Code/Java/Network-Protocol/Theclientcanspecifyinformationtocontroltheoutputofaserver.htm"><IMG border=0 alt="The client can specify information to control the output of a server" src="http://www.java2s.com/Code/JavaImages/AnotherBeerServer.PNG" width=200 height=40></a></td></tr><tr class=odd><td>4.</td><td align=left><A href="/Code/Java/Network-Protocol/Aservercanusespecializedstreamstodelivertypeddata.htm">A server can use specialized streams to deliver typed data</a></td><td width=32></td><td width=200 align=right><A href="/Code/Java/Network-Protocol/Aservercanusespecializedstreamstodelivertypeddata.htm"><IMG border=0 alt="A server can use specialized streams to deliver typed data" src="http://www.java2s.com/Code/JavaImages/DataServer.PNG" width=200 height=40></a></td></tr><tr class=even><td>5.</td><td align=left><A href="/Code/Java/Network-Protocol/ServeentireobjectsusingObjectOutputStream.htm">Serve entire objects using ObjectOutputStream</a></td><td width=32></td><td width=200 align=right><A href="/Code/Java/Network-Protocol/ServeentireobjectsusingObjectOutputStream.htm"><IMG border=0 alt="Serve entire objects using ObjectOutputStream" src="http://www.java2s.com/Code/JavaImages/ObjServer.PNG" width=200 height=40></a></td></tr><tr class=odd><td>6.</td><td align=left><A href="/Code/Java/Network-Protocol/Amultithreadedserver.htm">A multithreaded server</a></td><td width=32></td><td width=200 align=right><A href="/Code/Java/Network-Protocol/Amultithreadedserver.htm"><IMG border=0 alt="A multithreaded server" src="http://www.java2s.com/Code/JavaImages/MultiThreadServer.PNG" width=200 height=40></a></td></tr><tr class=even><td>7.</td><td align=left><A href="/Code/Java/Network-Protocol/Baseclasstobuildmultithreadedserverseasily.htm">Base class to build multithreaded servers easily</a></td><td width=32></td><td width=200 align=right></td></tr><tr class=odd><td>8.</td><td align=left><A href="/Code/Java/Network-Protocol/Manageapoolofthreadsforclients.htm">Manage a pool of threads for clients</a></td><td width=32></td><td width=200 align=right></td></tr><tr class=even><td>9.</td><td align=left><A href="/Code/Java/Network-Protocol/Clientestimatesthespeedofthenetworkconnectiontotheserver.htm">Client estimates the speed of the network connection to the server</a></td><td width=32></td><td width=200 align=right></td></tr><tr class=odd><td>10.</td><td align=left><A href="/Code/Java/Network-Protocol/ThisserverretrievesthetimeusingtheRFC867protocol.htm">This server retrieves the time using the RFC867 protocol.</a></td><td width=32></td><td width=200 align=right><A href="/Code/Java/Network-Protocol/ThisserverretrievesthetimeusingtheRFC867protocol.htm"><IMG border=0 alt="This server retrieves the time using the RFC867 protocol." src="http://www.java2s.com/Code/JavaImages/Time867.PNG" width=200 height=40></a></td></tr><tr class=even><td>11.</td><td align=left><A href="/Code/Java/Network-Protocol/QuoteServer.htm">Quote Server</a></td><td width=32></td><td width=200 align=right></td></tr><tr class=odd><td>12.</td><td align=left><A href="/Code/Java/Network-Protocol/LoggingServerbasedonSocketServer.htm">Logging Server based on SocketServer</a></td><td width=32></td><td width=200 align=right></td></tr><tr class=even><td>13.</td><td align=left><A href="/Code/Java/Network-Protocol/ClientandServerDemo.htm">Client and Server Demo</a></td><td width=32></td><td width=200 align=right></td></tr><tr class=odd><td>14.</td><td align=left><A href="/Code/Java/Network-Protocol/Reflector.htm">Reflector</a></td><td width=32></td><td width=200 align=right></td></tr><tr class=even><td>15.</td><td align=left><A href="/Code/Java/Network-Protocol/SimpleHttpServer.htm">Simple Http Server</a></td><td width=32></td><td width=200 align=right></td></tr></table><TABLE border=0><TR><TD height=10></TD></TR></TABLE>
</td></tr></table></td></tr></table><center><TABLE border=0><TR align=left><TD><A href="http://www.java2s.com">java2s.com</A>  &nbsp;|&nbsp;<A href=http://www.java2s.com/html/contact.htm>Contact Us</A>&nbsp;|&nbsp;<A href=http://www.java2s.com/html/ad.htm>Privacy Policy</A></Td></TR><TR align=left><TD class=Templatetext>Copyright 2009 - 12 Demo Source and Support. All rights reserved.</TD></TR><TR align=left><TD>All other trademarks are property of their respective owners.</TD></TR></TABLE></center></BODY></HTML>
