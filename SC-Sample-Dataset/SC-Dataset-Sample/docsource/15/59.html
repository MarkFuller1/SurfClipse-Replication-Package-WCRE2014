<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<TITLE>Hadoop HBase user's  mailing list ()</TITLE>
<BASE href="http://comments.gmane.org">
<META http-equiv=Content-Type content="text/html; charset=utf-8">
<link rel="SHORTCUT ICON" href="http://gmane.org/favicon.ico">
<link rel="Up" href="/gmane.comp.java.hadoop.hbase.user>">
<LINK href="http://gmane.org/img/leftmenu.css" type="text/css" rel="stylesheet">
<LINK href="http://gmane.org/img/blog.css" type="text/css" rel="stylesheet">
<style type="text/css" media="screen">
h1.name {
  background-image:  url(http://gmane.org/paint-blog-id.php?group=gmane.comp.java.hadoop.hbase.user);
}
</style>
</HEAD>
<BODY>
<div id=banner>
<h1 class=name>&nbsp;</h1>
<span class=description>Hadoop HBase user's  mailing list ()</span>
</div>
<script src="http://gmane.org/img/jsblog.js" type="text/javascript"></script>

<DIV id=content>
<DIV class=blog>
<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o1');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Eran+Kutner&amp;sort=date" rel=nofollow>Eran Kutner</a>
 | </span>
<SPAN class=day>10 May 2012 10:17</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26069-favicon.png">
<br>
</div>
<H2 class=title>Occasional regionserver crashes following socket errors writing to HDFS</h2><div id="o1" class="hidden">Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt;<br>
2012-05-10 08:17:04 GMT<br>
</div>
<pre>
Hi,
We're seeing occasional regionserver crashes during heavy write operations
to Hbase (at the reduce phase of large M/R jobs). I have increased the file
descriptors, HDFS xceivers, HDFS threads to the recommended settings and
actually way above.

Here is an example of the HBase log (showing only errors):

2012-05-10 03:34:54,291 WARN org.apache.hadoop.hdfs.DFSClient:
DFSOutputStream ResponseProcessor exception  for block
blk_-8928911185099340956_5189425java.io.IOException: Bad response 1 for
block blk_-8928911185099340956_5189425 from datanode 10.1.104.6:50010
        at
org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$ResponseProcessor.run(DFSClient.java:2986)

2012-05-10 03:34:54,494 WARN org.apache.hadoop.hdfs.DFSClient: DataStreamer
Exception: java.io.InterruptedIOException: Interruped while waiting for IO
on channel java.nio.channels.SocketChannel[connected
local=/10.1.104.9:59642remote=/
10.1.104.9:50010]. 0 millis timeout left.
        at
org.apache.hadoop.net.SocketIOWithTimeout$SelectorPool.select(SocketIOWithTimeout.java:349)
        at
org.apache.hadoop.net.SocketIOWithTimeout.doIO(SocketIOWithTimeout.java:157)
        at
org.apache.hadoop.net.SocketOutputStream.write(SocketOutputStream.java:146)
        at
org.apache.hadoop.net.SocketOutputStream.write(SocketOutputStream.java:107)
        at java.io.BufferedOutputStream.write(BufferedOutputStream.java:105)
        at java.io.DataOutputStream.write(DataOutputStream.java:90)
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26069">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26069:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26069">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26069" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o2');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Igal+Shilman&amp;sort=date" rel=nofollow>Igal Shilman</a>
 | </span>
<SPAN class=day>10 May 2012 11:25</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26070-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o2" class="hidden">Igal Shilman &lt;<a target="_top" href="http://gmane.org/get-address.php?address=igals%2dDalhDdJIUCY%40public.gmane.org" rel="nofollow">igals@...</a>&gt;<br>
2012-05-10 09:25:45 GMT<br>
</div>
<pre>
Hi Eran,
Do you have: dfs.datanode.socket.write.timeout set in hdfs-site.xml ?
(We have set this to zero in our cluster, which means waiting as long as
necessary for the write to complete)

Igal.

On Thu, May 10, 2012 at 11:17 AM, Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt; wrote:

&gt; Hi,
&gt; We're seeing occasional regionserver crashes during heavy write operations
&gt; to Hbase (at the reduce phase of large M/R jobs). I have increased the file
&gt; descriptors, HDFS xceivers, HDFS threads to the recommended settings and
&gt; actually way above.
&gt;
&gt; Here is an example of the HBase log (showing only errors):
&gt;
&gt; 2012-05-10 03:34:54,291 WARN org.apache.hadoop.hdfs.DFSClient:
&gt; DFSOutputStream ResponseProcessor exception  for block
&gt; blk_-8928911185099340956_5189425java.io.IOException: Bad response 1 for
&gt; block blk_-8928911185099340956_5189425 from datanode 10.1.104.6:50010
&gt;        at
&gt;
&gt; org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$ResponseProcessor.run(DFSClient.java:
&gt; 2986)
&gt;
&gt; 2012-05-10 03:34:54,494 WARN org.apache.hadoop.hdfs.DFSClient: DataStreamer
&gt; Exception: java.io.InterruptedIOException: Interruped while waiting for IO
&gt; on channel java.nio.channels.SocketChannel[connected
&gt; local=/10.1.104.9:59642remote=/
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26070">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26070:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26070">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26070" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o3');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Eran+Kutner&amp;sort=date" rel=nofollow>Eran Kutner</a>
 | </span>
<SPAN class=day>10 May 2012 13:33</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26076-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o3" class="hidden">Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt;<br>
2012-05-10 11:33:43 GMT<br>
</div>
<pre>
Thanks Igal, but we already have that setting. These are the relevant
setting from hdfs-site.xml :
  &lt;property&gt;
    &lt;name&gt;dfs.datanode.max.xcievers&lt;/name&gt;
    &lt;value&gt;65536&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dfs.datanode.handler.count&lt;/name&gt;
    &lt;value&gt;10&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dfs.datanode.socket.write.timeout&lt;/name&gt;
    &lt;value&gt;0&lt;/value&gt;
  &lt;/property&gt;

Other ideas?

-eran

On Thu, May 10, 2012 at 12:25 PM, Igal Shilman &lt;<a target="_top" href="http://gmane.org/get-address.php?address=igals%2dDalhDdJIUCY%40public.gmane.org" rel="nofollow">igals@...</a>&gt; wrote:

&gt; Hi Eran,
&gt; Do you have: dfs.datanode.socket.write.timeout set in hdfs-site.xml ?
&gt; (We have set this to zero in our cluster, which means waiting as long as
&gt; necessary for the write to complete)
&gt;
&gt; Igal.
&gt;
&gt; On Thu, May 10, 2012 at 11:17 AM, Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt; wrote:
&gt;
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26076">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26076:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26076">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26076" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o4');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Michel+Segel&amp;sort=date" rel=nofollow>Michel Segel</a>
 | </span>
<SPAN class=day>10 May 2012 13:53</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/26078-picon-001.gif"></a>
<br><img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26078-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o4" class="hidden">Michel Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;<br>
2012-05-10 11:53:39 GMT<br>
</div>
<pre>
Silly question...
Why are you using a reducer when working w HBase?

Second silly question... What is the max file size of your table that you are writing to?

Third silly question... How many regions are on each of your region servers

Fourth silly question ... There is this bandwidth setting... Default is 10MB...  Did you modify it?

Sent from a remote device. Please excuse any typos...

Mike Segel

On May 10, 2012, at 6:33 AM, Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt; wrote:

&gt; Thanks Igal, but we already have that setting. These are the relevant
&gt; setting from hdfs-site.xml :
&gt;  &lt;property&gt;
&gt;    &lt;name&gt;dfs.datanode.max.xcievers&lt;/name&gt;
&gt;    &lt;value&gt;65536&lt;/value&gt;
&gt;  &lt;/property&gt;
&gt;  &lt;property&gt;
&gt;    &lt;name&gt;dfs.datanode.handler.count&lt;/name&gt;
&gt;    &lt;value&gt;10&lt;/value&gt;
&gt;  &lt;/property&gt;
&gt;  &lt;property&gt;
&gt;    &lt;name&gt;dfs.datanode.socket.write.timeout&lt;/name&gt;
&gt;    &lt;value&gt;0&lt;/value&gt;
&gt;  &lt;/property&gt;
&gt; 
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26078">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26078:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26078">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26078" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o5');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Eran+Kutner&amp;sort=date" rel=nofollow>Eran Kutner</a>
 | </span>
<SPAN class=day>10 May 2012 14:22</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26079-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o5" class="hidden">Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt;<br>
2012-05-10 12:22:39 GMT<br>
</div>
<pre>
Hi Mike,
Not sure I understand the question about the reducer. I'm using a reducer
because my M/R jobs require one and I want to write the result to Hbase.
I have two tables I'm writing two, one is using the default file size
(256MB if I remember correctly) the other one is 512MB.
There are ~700 regions on each server.
Didn't know there is a bandwidth limit, is it on HDFS or HBase? How can it
be configured?

-eran

On Thu, May 10, 2012 at 2:53 PM, Michel Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;wrote:

&gt; Silly question...
&gt; Why are you using a reducer when working w HBase?
&gt;
&gt; Second silly question... What is the max file size of your table that you
&gt; are writing to?
&gt;
&gt; Third silly question... How many regions are on each of your region servers
&gt;
&gt; Fourth silly question ... There is this bandwidth setting... Default is
&gt; 10MB...  Did you modify it?
&gt;
&gt;
&gt;
&gt; Sent from a remote device. Please excuse any typos...
&gt;
&gt; Mike Segel
&gt;
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26079">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26079:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26079">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26079" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o6');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Michael+Segel&amp;sort=date" rel=nofollow>Michael Segel</a>
 | </span>
<SPAN class=day>10 May 2012 15:26</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/26082-picon-001.gif"></a>
<br><img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26082-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o6" class="hidden">Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;<br>
2012-05-10 13:26:53 GMT<br>
</div>
<pre>
Ok...

So the issue is that you have a lot of regions on a region server, where the max file size is the default. 
On your input to HBase, you have a couple of issues. 

1) Your data is most likely sorted. (Not good on inserts)
2) You will want to increase your region size from default (256MB) to something like 1-2GB.
3) You probably don't have MSLABS set up or GC tuned. 
4) google dfs.balance.bandwidthPerSec  I believe its also used by HBase when they need to move regions.
Speaking of which what happens when HBase decides to move a region? Does it make a copy on the new RS and then
after its there, point to the new RS and then remove the old region?

I'm assuming you're writing out of your reducer straight to HBase.
Are you writing your job to 1 reducer or did you set up multiple reducers?  You may want to play with having
multiple reducers ... 

Again, here's the issue. You don't need a reducer when writing to HBase. You would be better served by
refactoring your job to have the mapper write to Hbase directly. 
Think about it. (Really, think about it. If you really don't see it, face a white wall, with a 6 pack of beer and
start drinking and focus on the question of why would I say you don't need a reducer on a map job. ) <img alt=";-)" src="http://news.gmane.org/img/smilies/blink.png"> Note if
you don't drink, go to the gym and get on a treadmill and run at a good pace. Put your body in to a zone and then
work through the problem

HTH

-Mike

On May 10, 2012, at 7:22 AM, Eran Kutner wrote:

&gt; Hi Mike,
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26082">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26082:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26082">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26082" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o7');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Dave+Revell&amp;sort=date" rel=nofollow>Dave Revell</a>
 | </span>
<SPAN class=day>10 May 2012 19:31</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26098-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o7" class="hidden">Dave Revell &lt;<a target="_top" href="http://gmane.org/get-address.php?address=dave%2dVlrUTGN3UO5AS1ZseseUUQ%40public.gmane.org" rel="nofollow">dave@...</a>&gt;<br>
2012-05-10 17:31:07 GMT<br>
</div>
<pre>
This "you don't need a reducer" conversation is distracting from the real
problem and is false.

Many mapreduce algorithms require a reduce phase (e.g. sorting). The fact
that the output is written to HBase or somewhere else is irrelevant.

-Dave

On Thu, May 10, 2012 at 6:26 AM, Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;wrote:

&gt; Ok...
&gt;
&gt; So the issue is that you have a lot of regions on a region server, where
&gt; the max file size is the default.
&gt; On your input to HBase, you have a couple of issues.
&gt;
&gt; 1) Your data is most likely sorted. (Not good on inserts)
&gt; 2) You will want to increase your region size from default (256MB) to
&gt; something like 1-2GB.
&gt; 3) You probably don't have MSLABS set up or GC tuned.
&gt; 4) google dfs.balance.bandwidthPerSec  I believe its also used by HBase
&gt; when they need to move regions.
&gt; Speaking of which what happens when HBase decides to move a region? Does
&gt; it make a copy on the new RS and then after its there, point to the new RS
&gt; and then remove the old region?
&gt;
&gt;
&gt; I'm assuming you're writing out of your reducer straight to HBase.
&gt; Are you writing your job to 1 reducer or did you set up multiple reducers?
&gt;  You may want to play with having multiple reducers ...
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26098">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26098:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26098">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26098" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o8');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Michael+Segel&amp;sort=date" rel=nofollow>Michael Segel</a>
 | </span>
<SPAN class=day>10 May 2012 20:30</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/26099-picon-001.gif"></a>
<br><img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26099-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o8" class="hidden">Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;<br>
2012-05-10 18:30:18 GMT<br>
</div>
<pre>
Dave, do you really want to go there?

OP has a couple of issues and he was going down a rabbit hole. 
(You can choose if that's a reference to 'the Matrix, Jefferson Starship, Alice in Wonderland... or all of
the above)

So to put him on the correct path, I recommended the following, not in any order...

1) Increase his region size for this table only.
2) Look to decreasing the number of regions managed by a RS (which is why you increase region size) 
3) Up the dfs.balance.bandwidthPerSec. (How often does HBase move regions and how exactly do they move
regions ?)
4) Look at implementing MSLABS and GC tuning. This cuts down on the overhead. 
5) Refactoring his job....

Oops. 
Ok I didn't put that in the list. 
But that was the last thing I wrote as a separate statement. 
Clearly you didn't take my advice and think about the problem.... 

To prove a point.... you wrote:
'Many mapreduce algorithms require a reduce phase (e.g. sorting)'

Ok. So tell me why you would want to sort your input in to HBase and if that's really a good thing?
Oops!... <img alt=":-)" src="http://news.gmane.org/img/smilies/smile.png">

On May 10, 2012, at 12:31 PM, Dave Revell wrote:
&gt; This "you don't need a reducer" conversation is distracting from the real
&gt; problem and is false.
&gt; 
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26099">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26099:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26099">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26099" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o9');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Dave+Revell&amp;sort=date" rel=nofollow>Dave Revell</a>
 | </span>
<SPAN class=day>10 May 2012 20:41</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26100-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o9" class="hidden">Dave Revell &lt;<a target="_top" href="http://gmane.org/get-address.php?address=dave%2dVlrUTGN3UO5AS1ZseseUUQ%40public.gmane.org" rel="nofollow">dave@...</a>&gt;<br>
2012-05-10 18:41:17 GMT<br>
</div>
<pre>
Some examples of when you'd want a reducer:
<a rel="nofollow" href="http://static.usenix.org/event/osdi04/tech/full_papers/dean/dean.pdf" target="_top">http://static.usenix.org/event/osdi04/tech/full_papers/dean/dean.pdf</a>

On Thu, May 10, 2012 at 11:30 AM, Michael Segel
&lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;wrote:

&gt; Dave, do you really want to go there?
&gt;
&gt; OP has a couple of issues and he was going down a rabbit hole.
&gt; (You can choose if that's a reference to 'the Matrix, Jefferson Starship,
&gt; Alice in Wonderland... or all of the above)
&gt;
&gt; So to put him on the correct path, I recommended the following, not in any
&gt; order...
&gt;
&gt; 1) Increase his region size for this table only.
&gt; 2) Look to decreasing the number of regions managed by a RS (which is why
&gt; you increase region size)
&gt; 3) Up the dfs.balance.bandwidthPerSec. (How often does HBase move regions
&gt; and how exactly do they move regions ?)
&gt; 4) Look at implementing MSLABS and GC tuning. This cuts down on the
&gt; overhead.
&gt; 5) Refactoring his job....
&gt;
&gt; Oops.
&gt; Ok I didn't put that in the list.
&gt; But that was the last thing I wrote as a separate statement.
&gt; Clearly you didn't take my advice and think about the problem....
&gt;
&gt; To prove a point.... you wrote:
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26100">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26100:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26100">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26100" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o10');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Michael+Segel&amp;sort=date" rel=nofollow>Michael Segel</a>
 | </span>
<SPAN class=day>10 May 2012 20:59</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/26101-picon-001.gif"></a>
<br><img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26101-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o10" class="hidden">Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;<br>
2012-05-10 18:59:13 GMT<br>
</div>
<pre>
Sigh.

Dave,
I really think you need to think more about the problem.

Think about what a reduce does and then think about what happens in side of HBase.

Then think about which runs faster... a job with two mappers writing the intermediate and final results in
HBase, 
or a M/R job that writes its output to HBase.

If you really truly think about the problem, you will start to understand why I say you really don't want to
use a reducer when you're working w HBase. 

On May 10, 2012, at 1:41 PM, Dave Revell wrote:

&gt; Some examples of when you'd want a reducer:
&gt; <a rel="nofollow" href="http://static.usenix.org/event/osdi04/tech/full_papers/dean/dean.pdf" target="_top">http://static.usenix.org/event/osdi04/tech/full_papers/dean/dean.pdf</a>
&gt; 
&gt; On Thu, May 10, 2012 at 11:30 AM, Michael Segel
&gt; &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;wrote:
&gt; 
&gt;&gt; Dave, do you really want to go there?
&gt;&gt; 
&gt;&gt; OP has a couple of issues and he was going down a rabbit hole.
&gt;&gt; (You can choose if that's a reference to 'the Matrix, Jefferson Starship,
&gt;&gt; Alice in Wonderland... or all of the above)
&gt;&gt; 
&gt;&gt; So to put him on the correct path, I recommended the following, not in any
&gt;&gt; order...
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26101">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26101:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26101">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26101" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o11');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Eran+Kutner&amp;sort=date" rel=nofollow>Eran Kutner</a>
 | </span>
<SPAN class=day>10 May 2012 21:17</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26102-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o11" class="hidden">Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt;<br>
2012-05-10 19:17:05 GMT<br>
</div>
<pre>
Michale I appreciate the feedback but I'd have to disagree.
In my case for example, I need to look at a complete set of data produced
by the map phase in order to make a decision and write it to Hbase. So sure
I could write all the mappers output to hbase then have another map only
job to scan the output of the previous one do the calculation then write
the output to another table. I don't really see why would that be better
than using a reducer.

As for the other tips, I agree the files are too large, so I increased the
file size, but I don't really see why is that relevant to the error we're
talking about. Why having many regions cause timeouts on HDFS?
I do have mslabs configured and GC tuneups.
I do run multiple reducers, I suspect that's aggravating the problem not
helping it.
As far as I can tell dfs.balance.bandwidthPerSec is relevant only for
balancing done with the balancer, not for the initial replication.

-eran

On Thu, May 10, 2012 at 9:59 PM, Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;wrote:

&gt; Sigh.
&gt;
&gt; Dave,
&gt; I really think you need to think more about the problem.
&gt;
&gt; Think about what a reduce does and then think about what happens in side
&gt; of HBase.
&gt;
&gt; Then think about which runs faster... a job with two mappers writing the
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26102">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26102:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26102">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26102" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o12');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Michael+Segel&amp;sort=date" rel=nofollow>Michael Segel</a>
 | </span>
<SPAN class=day>10 May 2012 21:50</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/26104-picon-001.gif"></a>
<br><img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26104-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o12" class="hidden">Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;<br>
2012-05-10 19:50:43 GMT<br>
</div>
<pre>
Eran,

see my response inline...

On May 10, 2012, at 2:17 PM, Eran Kutner wrote:

&gt; Michale I appreciate the feedback but I'd have to disagree.
&gt; In my case for example, I need to look at a complete set of data produced
&gt; by the map phase in order to make a decision and write it to Hbase. So sure
&gt; I could write all the mappers output to hbase then have another map only
&gt; job to scan the output of the previous one do the calculation then write
&gt; the output to another table. I don't really see why would that be better
&gt; than using a reducer.

You disagree without actually benchmarking the two? 
That's pretty bold. <img alt=":-)" src="http://news.gmane.org/img/smilies/smile.png"> 

2 things. 
First Reducers are expensive.
Second, writing sorted records in to HBase is also more expensive than if you're writing records in random
order. 

Here's a caveat. I don't know what you're attempting to do, so I can only say in general, I've found it faster
to write 2 mappers and avoid using reducers.

&gt; As for the other tips, I agree the files are too large, so I increased the
&gt; file size, but I don't really see why is that relevant to the error we're
&gt; talking about. Why having many regions cause timeouts on HDFS?
&gt; I do have mslabs configured and GC tuneups.
&gt; I do run multiple reducers, I suspect that's aggravating the problem not
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26104">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26104:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26104">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26104" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

</div>
</div>
<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o13');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Stack&amp;sort=date" rel=nofollow>Stack</a>
 | </span>
<SPAN class=day>10 May 2012 23:57</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o13" class="hidden">Stack &lt;<a target="_top" href="http://gmane.org/get-address.php?address=stack%2d%2bc050i%2b%2bPmesTnJN9%2bBGXg%40public.gmane.org" rel="nofollow">stack@...</a>&gt;<br>
2012-05-10 21:57:20 GMT<br>
</div>
<pre>
On Thu, May 10, 2012 at 11:59 AM, Michael Segel
&lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt; wrote:
&gt; Sigh.
&gt;
&gt; Dave,
&gt; I really think you need to think more about the problem.
&gt;
&gt; Think about what a reduce does and then think about what happens in side of HBase.
&gt;
&gt; Then think about which runs faster... a job with two mappers writing the intermediate and final results in HBase,
&gt; or a M/R job that writes its output to HBase.
&gt;
&gt; If you really truly think about the problem, you will start to understand why I say you really don't want to
use a reducer when you're working w HBase.
&gt;

We have a bit of doc that usually you might want to forego reduce
phase, <a rel="nofollow" href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/mapreduce/package-summary.html#sink" target="_top">http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/mapreduce/package-summary.html#sink</a>.
 Do we need to add to it?  That said, you can't make an hard and fast
rule that the reduce is to be avoided absolutely.  There will be cases
where it makes sense (MR sort orthogonal to HBase's or a fat
aggregating reduce, etc.)

St.Ack
P.S. Hey Michael.  Go easy on the 'sighs'.  The participants in this
thread have a clue.  I can testify to that.  Also, I know you don't
mean it, but on occasion, both in this thread and in others I've seen
you on, your tone can come across as condescending (and there is
nothing like condescension for raising the rankles).  We all have our
style's but you might want to review with this in mind before you hit
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26105">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26105:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26105">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26105" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o14');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Michael+Segel&amp;sort=date" rel=nofollow>Michael Segel</a>
 | </span>
<SPAN class=day>11 May 2012 03:28</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/26106-picon-001.gif"></a>
<br><img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26106-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o14" class="hidden">Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;<br>
2012-05-11 01:28:01 GMT<br>
</div>
<pre>
Stack,

That section was written by Doug after he and I had the same debate man moons ago. 
While I can't say with absolute certainty that you shouldn't use a reducer, I can say is that every situation
where I have seen a M/R where you are writing to HBase, you end up not wanting to use a reducer. If you want a
clear and concise statement you can say that the rule of thumb is that you don't want to use a reducer and that
cases where you would need to first use a reducer are the rare exception. 

The reason I ask people to think about this topic is that unless you have a really good foundation in
databases, not relying on a reducer is a bit counter intuitive. (Which is why I said that you really need to
clear your mind and focus on this issue. )

-Mike

PS. If you care to read the thread, I didn't become condescending until a certain individual piped up about
how refactoring the M/R was a 'distraction' to the issue at hand. 
Not to mention his flip response w the Google paper? 

On May 10, 2012, at 4:57 PM, Stack wrote:

&gt; On Thu, May 10, 2012 at 11:59 AM, Michael Segel
&gt; &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt; wrote:
&gt;&gt; Sigh.
&gt;&gt; 
&gt;&gt; Dave,
&gt;&gt; I really think you need to think more about the problem.
&gt;&gt; 
&gt;&gt; Think about what a reduce does and then think about what happens in side of HBase.
&gt;&gt; 
&gt;&gt; Then think about which runs faster... a job with two mappers writing the intermediate and final results
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26106">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26106:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26106">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26106" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o15');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Stack&amp;sort=date" rel=nofollow>Stack</a>
 | </span>
<SPAN class=day>11 May 2012 05:28</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o15" class="hidden">Stack &lt;<a target="_top" href="http://gmane.org/get-address.php?address=stack%2d%2bc050i%2b%2bPmesTnJN9%2bBGXg%40public.gmane.org" rel="nofollow">stack@...</a>&gt;<br>
2012-05-11 03:28:08 GMT<br>
</div>
<pre>
On Thu, May 10, 2012 at 6:28 PM, Michael Segel
&lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt; wrote:
&gt; That section was written by Doug after he and I had the same debate man moons ago.

I'm not sure that is correct.  If you git blame that section, you'll
see that stack and andrew are the authors and that the edits were made
in 2009 and 2010.

There is this section in the book but it doesn't seem to have the
benefit of your input:
<a rel="nofollow" href="http://hbase.apache.org/book.html#mapreduce.example.summary.noreducer" target="_top">http://hbase.apache.org/book.html#mapreduce.example.summary.noreducer</a>

&gt; While I can't say with absolute certainty that you shouldn't use a reducer, I can say is that every
situation where I have seen a M/R where you are writing to HBase, you end up not wanting to use a reducer. If
you want a clear and concise statement you can say that the rule of thumb is that you don't want to use a
reducer and that cases where you would need to first use a reducer are the rare exception.
&gt;

Please file an issue w/ a patch.  It'd be good to get your experience
into the doc.

&gt; The reason I ask people to think about this topic is that unless you have a really good foundation in
databases, not relying on a reducer is a bit counter intuitive. (Which is why I said that you really need to
clear your mind and focus on this issue. )
&gt;

Lets make it so that if you don't have a foundation in dbs, if you
read the doc., you won't need such a background to get the best of
hbase.

</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26113">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26113:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26113">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26113" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

</div>
</div>
<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o16');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Michael+Segel&amp;sort=date" rel=nofollow>Michael Segel</a>
 | </span>
<SPAN class=day>11 May 2012 04:46</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/26108-picon-001.gif"></a>
<br><img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26108-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o16" class="hidden">Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;<br>
2012-05-11 02:46:33 GMT<br>
</div>
<pre>
Stack, 

Since you brought it up...
&gt; <a rel="nofollow" href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/mapreduce/package-summary.html#sink" target="_top">http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/mapreduce/package-summary.html#sink</a>.

"Writing, it may make sense to avoid the reduce step and write yourself back into HBase from inside your map.
You'd do this when your job does not need the sort and collation that mapreduce does on the map emitted data;
on insert, HBase 'sorts' so there is no point double-sorting (and shuffling data around your mapreduce
cluster) unless you need to. If you do not need the reduce, you might just have your map emit counts of
records processed just so the framework's report at the end of your job has meaning or set the number of
reduces to zero and use TableOutputFormat. See example code below. If running the reduce step makes sense
in your case, its usually better to have lots of reducers so load is spread across the HBase cluster."

This isn't 100% true. 

I'd lose the quotes around 'sorts' because the data is sorted on key values. period.

I'd ask that you reconsider the following phrase...
"You'd do this when your job does not need the sort and collation that mapreduce does on the map emitted
data;" 

I realize I went to this little midwestern school (tOSU), where ENG meant you were in the college of
engineering and not an English Major, so I'm not sure if I am parsing that statement correctly. 

If you refactor your M/R , HBase can be used for the 'collation' .  (If you make your Mapper a null writable and
manually write the output to HBase within Mapper.map(), you can write to N tables without a problem. So you
can write the record out, update a table where you are keeping counters, stats, etc ... )  So I am still at a
loss to find an example of where you would need a reducer. 

Don't get me wrong. I do believe that there are cases where you may need a reducer, just as I believe that there
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26108">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26108:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26108">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26108" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o17');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Stack&amp;sort=date" rel=nofollow>Stack</a>
 | </span>
<SPAN class=day>11 May 2012 05:34</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o17" class="hidden">Stack &lt;<a target="_top" href="http://gmane.org/get-address.php?address=stack%2d%2bc050i%2b%2bPmesTnJN9%2bBGXg%40public.gmane.org" rel="nofollow">stack@...</a>&gt;<br>
2012-05-11 03:34:03 GMT<br>
</div>
<pre>
On Thu, May 10, 2012 at 7:46 PM, Michael Segel
&lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt; wrote:
&gt; "Writing, it may make sense to avoid the reduce step and write yourself back into HBase from inside your
map. You'd do this when your job does not need the sort and collation that mapreduce does on the map emitted
data; on insert, HBase 'sorts' so there is no point double-sorting (and shuffling data around your
mapreduce cluster) unless you need to. If you do not need the reduce, you might just have your map emit
counts of records processed just so the framework's report at the end of your job has meaning or set the
number of reduces to zero and use TableOutputFormat. See example code below. If running the reduce step
makes sense in your case, its usually better to have lots of reducers so load is spread across the HBase cluster."
&gt;
&gt; This isn't 100% true.
&gt;
&gt; I'd lose the quotes around 'sorts' because the data is sorted on key values. period.
&gt;

Sounds good.

&gt; I'd ask that you reconsider the following phrase...
&gt; "You'd do this when your job does not need the sort and collation that mapreduce does on the map emitted data;"
&gt;

What would you suggest instead.

&gt; I realize I went to this little midwestern school (tOSU), where ENG meant you were in the college of
engineering and not an English Major, so I'm not sure if I am parsing that statement correctly.
&gt;

ditto

The above phrase is mine.  I'm bad at writing so need help.
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26114">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26114:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26114">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26114" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o18');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Stack&amp;sort=date" rel=nofollow>Stack</a>
 | </span>
<SPAN class=day>11 May 2012 07:12</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o18" class="hidden">Stack &lt;<a target="_top" href="http://gmane.org/get-address.php?address=stack%2d%2bc050i%2b%2bPmesTnJN9%2bBGXg%40public.gmane.org" rel="nofollow">stack@...</a>&gt;<br>
2012-05-11 05:12:54 GMT<br>
</div>
<pre>
On Thu, May 10, 2012 at 6:26 AM, Michael Segel
&lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt; wrote:.
&gt; 4) google dfs.balance.bandwidthPerSec  I believe its also used by HBase when they need to move regions.

Nah.  This is an hdfs setting.  HBase don't use it directly.

&gt; Speaking of which what happens when HBase decides to move a region? Does it make a copy on the new RS and then
after its there, point to the new RS and then remove the old region?
&gt;

When one RS closes the region and another opens it, there is no copy
to be done since the region data is in the HDFS they both share.

St.Ack

</pre>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26119:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26119">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26119" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o19');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Michael+Segel&amp;sort=date" rel=nofollow>Michael Segel</a>
 | </span>
<SPAN class=day>11 May 2012 13:36</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/26122-picon-001.gif"></a>
<br><img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26122-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o19" class="hidden">Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;<br>
2012-05-11 11:36:36 GMT<br>
</div>
<pre>
So I see you're looking at Eran's problem.... <img alt=";-)" src="http://news.gmane.org/img/smilies/blink.png">

Since you say he's fairly capable, I'm assuming when he said he had GC and MSLABS set up, he did it right, so a GC
pause wouldn't cause the error.

Bad node? possible.  It could easily be a networking/hardware issue which are pain in the ass problems to
track down and solve. 

With respect to the dfs.bandwidthPerSec... yes its an HDFS setting.  As you point out, its an indirect
issue. However that doesn't mean it wouldn't have an impact on performance. 

OP states that this occurs under heavy writes. What happens to the writes when a table is splitting? 

On May 11, 2012, at 12:12 AM, Stack wrote:

&gt; On Thu, May 10, 2012 at 6:26 AM, Michael Segel
&gt; &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt; wrote:.
&gt;&gt; 4) google dfs.balance.bandwidthPerSec  I believe its also used by HBase when they need to move regions.
&gt; 
&gt; Nah.  This is an hdfs setting.  HBase don't use it directly.
&gt; 
&gt;&gt; Speaking of which what happens when HBase decides to move a region? Does it make a copy on the new RS and then
after its there, point to the new RS and then remove the old region?
&gt;&gt; 
&gt; 
&gt; When one RS closes the region and another opens it, there is no copy
&gt; to be done since the region data is in the HDFS they both share.
&gt; 
&gt; St.Ack
&gt; 
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26122">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26122:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26122">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26122" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o20');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Eran+Kutner&amp;sort=date" rel=nofollow>Eran Kutner</a>
 | </span>
<SPAN class=day>24 May 2012 13:15</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26417-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o20" class="hidden">Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt;<br>
2012-05-24 11:15:02 GMT<br>
</div>
<pre>
Thanks Stack for noticing the ZooKeeper timeout, don't know how could I
have missed that.

After analyzing this for a while it is definitely unrelated to GC. In fact
during the last 4 days no GC operation took more than 2 seconds, and those
that got close were all concurrent mark sweeps, so they should not be
stopping other threads.

These are the interesting log lines:
2012-05-22 01:25:11,502 INFO org.apache.zookeeper.ClientCnxn: Client
session timed out, have not heard from server in 23706ms for sessionid
0x1372aa57bee0308, closing socket connection and attempting reconnect
2012-05-22 01:25:11,502 INFO org.apache.zookeeper.ClientCnxn: Client
session timed out, have not heard from server in 24638ms for sessionid
0x3372bf3891304bf, closing socket connection and attempting reconnect
2012-05-22 01:25:12,047 INFO org.apache.zookeeper.ClientCnxn: Opening
socket connection to server hadoop1-zk1/10.1.104.201:2181
2012-05-22 01:25:12,048 INFO org.apache.zookeeper.ClientCnxn: Socket
connection established to hadoop1-zk1/10.1.104.201:2181, initiating session
2012-05-22 01:25:12,080 INFO org.apache.zookeeper.ClientCnxn: Unable to
reconnect to ZooKeeper service, session 0x3372bf3891304bf has expired,
closing socket connection
2012-05-22 01:25:12,081 FATAL
org.apache.hadoop.hbase.regionserver.HRegionServer: ABORTING region server
serverName=hadoop1-s05.farm-ny.gigya.com,60020,1336990798475,
load=(requests=4015, regions=708, usedHeap=2342, maxHeap=7983):
regionserver:60020-0x3372bf3891304bf regionserver:60020-0x3372bf3891304bf
received expired from ZooKeeper, aborting
org.apache.zookeeper.KeeperException$SessionExpiredException:
KeeperErrorCode = Session expired
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26417">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26417:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26417">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26417" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o21');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Michael+Segel&amp;sort=date" rel=nofollow>Michael Segel</a>
 | </span>
<SPAN class=day>24 May 2012 14:13</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/26419-picon-001.gif"></a>
<br><img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26419-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o21" class="hidden">Michael Segel &lt;<a target="_top" href="http://gmane.org/get-address.php?address=michael%5fsegel%2dPkbjNfxxIARBDgjK7y7TUQ%40public.gmane.org" rel="nofollow">michael_segel@...</a>&gt;<br>
2012-05-24 12:13:22 GMT<br>
</div>
<pre>
<a rel="nofollow" href="http://wiki.apache.org/hadoop/Hbase/Troubleshooting#A8" target="_top">http://wiki.apache.org/hadoop/Hbase/Troubleshooting#A8</a>
&lt;property&gt;
    &lt;name&gt;zookeeper.session.timeout&lt;/name&gt;
    &lt;value&gt;1200000&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;hbase.zookeeper.property.tickTime&lt;/name&gt;
    &lt;value&gt;6000&lt;/value&gt;
  &lt;/property&gt;
The default is 60 seconds which you reduced to 20.  (Assuming this is the right parameter)

As you said you were doing a major compaction at the time. 

On May 24, 2012, at 6:15 AM, Eran Kutner wrote:

&gt; Thanks Stack for noticing the ZooKeeper timeout, don't know how could I
&gt; have missed that.
&gt; 
&gt; After analyzing this for a while it is definitely unrelated to GC. In fact
&gt; during the last 4 days no GC operation took more than 2 seconds, and those
&gt; that got close were all concurrent mark sweeps, so they should not be
&gt; stopping other threads.
&gt; 
&gt; These are the interesting log lines:
&gt; 2012-05-22 01:25:11,502 INFO org.apache.zookeeper.ClientCnxn: Client
&gt; session timed out, have not heard from server in 23706ms for sessionid
&gt; 0x1372aa57bee0308, closing socket connection and attempting reconnect
&gt; 2012-05-22 01:25:11,502 INFO org.apache.zookeeper.ClientCnxn: Client
&gt; session timed out, have not heard from server in 24638ms for sessionid
&gt; 0x3372bf3891304bf, closing socket connection and attempting reconnect
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26419">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26419:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26419">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26419" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

</div>
<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o22');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Stack&amp;sort=date" rel=nofollow>Stack</a>
 | </span>
<SPAN class=day>25 May 2012 01:39</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o22" class="hidden">Stack &lt;<a target="_top" href="http://gmane.org/get-address.php?address=stack%2d%2bc050i%2b%2bPmesTnJN9%2bBGXg%40public.gmane.org" rel="nofollow">stack@...</a>&gt;<br>
2012-05-24 23:39:09 GMT<br>
</div>
<pre>
On Thu, May 24, 2012 at 4:15 AM, Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt; wrote:
&gt; Any idea why it would not respond in 20 seconds? Seems like quite a lot of
&gt; time.

The only explaination I have is long GC.  If you are not having these,
I'm not sure what it is.  Pastebin log and .out from around a zk
timeout.  We might see something.

St.Ack

</pre>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26450:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26450">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26450" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o23');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Dave+Revell&amp;sort=date" rel=nofollow>Dave Revell</a>
 | </span>
<SPAN class=day>25 May 2012 21:52</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<img border=0 alt="Favicon" src="http://cache.gmane.org/gmane/comp/java/hadoop/hbase/user/26489-favicon.png">
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o23" class="hidden">Dave Revell &lt;<a target="_top" href="http://gmane.org/get-address.php?address=dave%2dVlrUTGN3UO5AS1ZseseUUQ%40public.gmane.org" rel="nofollow">dave@...</a>&gt;<br>
2012-05-25 19:52:08 GMT<br>
</div>
<pre>
Have you verified that your nodes are not swapping? This has caused serious
issues for many people, including me.

Swapping can occur even if you have lots of available memory, for
complicated reasons.

Best,
Dave

On Thu, May 24, 2012 at 4:39 PM, Stack &lt;<a target="_top" href="http://gmane.org/get-address.php?address=stack%2d%2bc050i%2b%2bPmesTnJN9%2bBGXg%40public.gmane.org" rel="nofollow">stack@...</a>&gt; wrote:

&gt; On Thu, May 24, 2012 at 4:15 AM, Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt; wrote:
&gt; &gt; Any idea why it would not respond in 20 seconds? Seems like quite a lot
&gt; of
&gt; &gt; time.
&gt;
&gt; The only explaination I have is long GC.  If you are not having these,
&gt; I'm not sure what it is.  Pastebin log and .out from around a zk
&gt; timeout.  We might see something.
&gt;
&gt; St.Ack
&gt;
</pre>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26489:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26489">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26489" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o24');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Stack&amp;sort=date" rel=nofollow>Stack</a>
 | </span>
<SPAN class=day>11 May 2012 07:08</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o24" class="hidden">Stack &lt;<a target="_top" href="http://gmane.org/get-address.php?address=stack%2d%2bc050i%2b%2bPmesTnJN9%2bBGXg%40public.gmane.org" rel="nofollow">stack@...</a>&gt;<br>
2012-05-11 05:08:47 GMT<br>
</div>
<pre>
On Thu, May 10, 2012 at 4:33 AM, Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt; wrote:
&gt;  &lt;property&gt;
&gt;    &lt;name&gt;dfs.datanode.socket.write.timeout&lt;/name&gt;
&gt;    &lt;value&gt;0&lt;/value&gt;
&gt;  &lt;/property&gt;
&gt;

Not timing out is probably not what you want.  On problem, you want
the client to give up rather than hang till the end of time (There are
multiple replicas, hopefully you don't timeout on all).

St.Ack

</pre>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26118:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26118">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26118" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

</div>
</div>
</div>
<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o25');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Stack&amp;sort=date" rel=nofollow>Stack</a>
 | </span>
<SPAN class=day>11 May 2012 07:07</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o25" class="hidden">Stack &lt;<a target="_top" href="http://gmane.org/get-address.php?address=stack%2d%2bc050i%2b%2bPmesTnJN9%2bBGXg%40public.gmane.org" rel="nofollow">stack@...</a>&gt;<br>
2012-05-11 05:07:05 GMT<br>
</div>
<pre>
On Thu, May 10, 2012 at 1:17 AM, Eran Kutner &lt;<a target="_top" href="http://gmane.org/get-address.php?address=eran%2d0wlDYECJQSoAvxtiuMwx3w%40public.gmane.org" rel="nofollow">eran@...</a>&gt; wrote:
&gt; Here is an example of the HBase log (showing only errors):
&gt;
&gt; 2012-05-10 03:34:54,291 WARN org.apache.hadoop.hdfs.DFSClient:
&gt; DFSOutputStream ResponseProcessor exception  for block
&gt; blk_-8928911185099340956_5189425java.io.IOException: Bad response 1 for
&gt; block blk_-8928911185099340956_5189425 from datanode 10.1.104.6:50010
&gt;        at
&gt; org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$ResponseProcessor.run(DFSClient.java:2986)
&gt;
&gt; 2012-05-10 03:34:54,494 WARN org.apache.hadoop.hdfs.DFSClient: DataStreamer
&gt; Exception: java.io.InterruptedIOException: Interruped while waiting for IO
&gt; on channel java.nio.channels.SocketChannel[connected
&gt; local=/10.1.104.9:59642remote=/
&gt; 10.1.104.9:50010]. 0 millis timeout left.
&gt;        at
&gt; org.apache.hadoop.net.SocketIOWithTimeout$SelectorPool.select(SocketIOWithTimeout.java:349)
&gt;        at
&gt; org.apache.hadoop.net.SocketIOWithTimeout.doIO(SocketIOWithTimeout.java:157)
&gt;        at
&gt; org.apache.hadoop.net.SocketOutputStream.write(SocketOutputStream.java:146)
&gt;        at
&gt; org.apache.hadoop.net.SocketOutputStream.write(SocketOutputStream.java:107)
&gt;        at java.io.BufferedOutputStream.write(BufferedOutputStream.java:105)
&gt;        at java.io.DataOutputStream.write(DataOutputStream.java:90)
&gt;        at
&gt; org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2848)
&gt;
&gt; 2012-05-10 03:34:54,531 WARN org.apache.hadoop.hdfs.DFSClient: Error
&gt; Recovery for block blk_-8928911185099340956_5189425 bad datanode[2]
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26117">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:26117:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/26117">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=26117" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

</div>
<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o26');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=dva&amp;sort=date" rel=nofollow>dva</a>
 | </span>
<SPAN class=day>30 Aug 2012 08:26</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/28793-picon-001.gif"></a>
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o26" class="hidden">dva &lt;<a target="_top" href="http://gmane.org/get-address.php?address=dva891%2dRe5JQEeQqe8AvxtiuMwx3w%40public.gmane.org" rel="nofollow">dva891@...</a>&gt;<br>
2012-08-30 06:26:51 GMT<br>
</div>
<pre>

Eran Kutner wrote:
&gt; 
&gt; Hi,
&gt; We're seeing occasional regionserver crashes during heavy write operations
&gt; to Hbase (at the reduce phase of large M/R jobs). I have increased the
&gt; file
&gt; descriptors, HDFS xceivers, HDFS threads to the recommended settings and
&gt; actually way above.
&gt; 
&gt; Here is an example of the HBase log (showing only errors):
&gt; 
&gt; 2012-05-10 03:34:54,291 WARN org.apache.hadoop.hdfs.DFSClient:
&gt; DFSOutputStream ResponseProcessor exception  for block
&gt; blk_-8928911185099340956_5189425java.io.IOException: Bad response 1 for
&gt; block blk_-8928911185099340956_5189425 from datanode 10.1.104.6:50010
&gt;         at
&gt; org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$ResponseProcessor.run(DFSClient.java:2986)
&gt; 
&gt; 2012-05-10 03:34:54,494 WARN org.apache.hadoop.hdfs.DFSClient:
&gt; DataStreamer
&gt; Exception: java.io.InterruptedIOException: Interruped while waiting for IO
&gt; on channel java.nio.channels.SocketChannel[connected
&gt; local=/10.1.104.9:59642remote=/
&gt; 10.1.104.9:50010]. 0 millis timeout left.
&gt;         at
&gt; org.apache.hadoop.net.SocketIOWithTimeout$SelectorPool.select(SocketIOWithTimeout.java:349)
&gt;         at
&gt; org.apache.hadoop.net.SocketIOWithTimeout.doIO(SocketIOWithTimeout.java:157)
&gt;         at
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/28793">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:28793:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/28793">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=28793" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

</div>
<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o27');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=dva&amp;sort=date" rel=nofollow>dva</a>
 | </span>
<SPAN class=day>30 Aug 2012 08:26</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<div class=face>
<a target="_top" href="http://ftp.cs.indiana.edu/pub/faces/picons/"><img border=0 alt="Picon" src="http://cache.gmane.org//gmane/comp/java/hadoop/hbase/user/28794-picon-001.gif"></a>
<br>
</div>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o27" class="hidden">dva &lt;<a target="_top" href="http://gmane.org/get-address.php?address=dva891%2dRe5JQEeQqe8AvxtiuMwx3w%40public.gmane.org" rel="nofollow">dva891@...</a>&gt;<br>
2012-08-30 06:26:48 GMT<br>
</div>
<pre>

Eran Kutner wrote:
&gt; 
&gt; Hi,
&gt; We're seeing occasional regionserver crashes during heavy write operations
&gt; to Hbase (at the reduce phase of large M/R jobs). I have increased the
&gt; file
&gt; descriptors, HDFS xceivers, HDFS threads to the recommended settings and
&gt; actually way above.
&gt; 
&gt; Here is an example of the HBase log (showing only errors):
&gt; 
&gt; 2012-05-10 03:34:54,291 WARN org.apache.hadoop.hdfs.DFSClient:
&gt; DFSOutputStream ResponseProcessor exception  for block
&gt; blk_-8928911185099340956_5189425java.io.IOException: Bad response 1 for
&gt; block blk_-8928911185099340956_5189425 from datanode 10.1.104.6:50010
&gt;         at
&gt; org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$ResponseProcessor.run(DFSClient.java:2986)
&gt; 
&gt; 2012-05-10 03:34:54,494 WARN org.apache.hadoop.hdfs.DFSClient:
&gt; DataStreamer
&gt; Exception: java.io.InterruptedIOException: Interruped while waiting for IO
&gt; on channel java.nio.channels.SocketChannel[connected
&gt; local=/10.1.104.9:59642remote=/
&gt; 10.1.104.9:50010]. 0 millis timeout left.
&gt;         at
&gt; org.apache.hadoop.net.SocketIOWithTimeout$SelectorPool.select(SocketIOWithTimeout.java:349)
&gt;         at
&gt; org.apache.hadoop.net.SocketIOWithTimeout.doIO(SocketIOWithTimeout.java:157)
&gt;         at
</pre><a href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/28794">(Continue reading)</a><br><br>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:28794:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/28794">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=28794" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

<div class=posting>
<DIV class=entry>
<DIV class=date>
<div class=options><a rel=nofollow href="#" onclick="return toggle('o28');">headers</a></div>
<span class=author>
<a href="http://search.gmane.org/?author=Stack&amp;sort=date" rel=nofollow>Stack</a>
 | </span>
<SPAN class=day>31 Aug 2012 00:36</SPAN>
</DIV>
<DIV class=blogbody><A name=5></A>
<H3 class=title>Re: Occasional regionserver crashes following socket errors writing to HDFS</h3><div id="o28" class="hidden">Stack &lt;<a target="_top" href="http://gmane.org/get-address.php?address=stack%2d%2bc050i%2b%2bPmesTnJN9%2bBGXg%40public.gmane.org" rel="nofollow">stack@...</a>&gt;<br>
2012-08-30 22:36:31 GMT<br>
</div>
<pre>
On Wed, Aug 29, 2012 at 11:26 PM, dva &lt;<a target="_top" href="http://gmane.org/get-address.php?address=dva891%2dRe5JQEeQqe8AvxtiuMwx3w%40public.gmane.org" rel="nofollow">dva891@...</a>&gt; wrote:
&gt; 12/08/29 08:02:10 ERROR security.UserGroupInformation:
&gt; PriviledgedActionException   as:root
&gt; cause:org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory
&gt; file:/export/hadoop-1.0.1/bin/out.txt already exists

Your message is hard to read.  Your problem seems pretty basic.  See
the above.   Fix that (move aside te file) and retry?
St.Ack

</pre>
<DIV class=posted>
<form class="spam" method="post" action="http://spam.gmane.org/gmane.comp.java.hadoop.hbase.user:28816:unconfirmed" onsubmit="openSpamFrame(this); return false;">
<A href="http://permalink.gmane.org/gmane.comp.java.hadoop.hbase.user/28816">Permalink</A>
| <a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user&amp;followup=28816" rel=nofollow>Reply</a>
| <input class="spam" type="submit" value="Report this as spam">
</form>
</DIV>  

</DIV>  
</DIV>  

</div>
</div>
</div>
</div>
</DIV>  

</div>

<div id="sidebox">

<div class="sidetitle">Return</div>
<div class="side">
Return to <a href="http://blog.gmane.org/gmane.comp.java.hadoop.hbase.user">gmane.comp.java.hadoop.hbase.user</a>.
</div>


<div class="sidetitle">Advertisement</div>
<div class="side" align="center">
<script type="text/javascript"><!--
amazon_ad_tag = "gmane-20"; amazon_ad_width = "300"; amazon_ad_height = "250";//--></script>
<script type="text/javascript" src="http://www.assoc-amazon.com/s/ads.js"></script>
</div>

<div class="sidetitle">Project Web Page</div>
<div class="side">
   <a href="http://wiki.apache.org/hadoop/Hbase
">Hadoop HBase user's  mailing list ()</a>
</div>

<div class="sidetitle">Search Archive</div>
<div class="side">
<div align="center">
<br/>
<form action="http://search.gmane.org" method="get">
<input name="query" value="" title="search_text"/><input type="submit" title="SUBMIT" value="Search"/>
<input type=hidden name="group" value="gmane.comp.java.hadoop.hbase.user">
</form>
</div>
</div>





<div class="sidetitle">Language</div>
<div class="side">
   <a rel=nofollow href="http://gmane.org/language.php">Change language</a>
</div>


<div class="sidetitle">Options</div>
<div class="side">
Current view: 
Threads only / Showing 
 only 20 lines /
 Not hiding cited text.<br/>
    Change to 
<a rel=nofollow href="/gmane.comp.java.hadoop.hbase.user?set_blog_all=yes">All messages, </a><a rel=nofollow href="/gmane.comp.java.hadoop.hbase.user?set_lines=100000">whole messages</a>, or 
<a rel=nofollow href="/gmane.comp.java.hadoop.hbase.user?set_cite=hide">hide cited text</a>.<br /><br />

<a href="http://post.gmane.org/post.php?group=gmane.comp.java.hadoop.hbase.user" rel=nofollow>Post a message</a><br/>
<a href="nntp://news.gmane.org/gmane.comp.java.hadoop.hbase.user">NNTP Newsgroup</a><br/>
<a rel=nofollow href="http://news.gmane.org/find-root.php?message_id=%3cCADcMMgFdjoNSimz6Nfw9wArJTgpx3hQk0E%5f%2boRMT8We5Zo6GiA%40mail.gmail.com%3e">Classic Gmane web interface</a><br/>

<a href="http://rss.gmane.org/gmane.comp.java.hadoop.hbase.user"><img src="http://gmane.org/img/xml.gif" alt="XML" border=0>&nbsp;RSS Feed</a><br/>
<a href="http://dir.gmane.org/gmane.comp.java.hadoop.hbase.user">List Information</a><br/><br/>
<a href="http://gmane.org/faq.php">About Gmane</a><br/>
</div>

</div>

    <br clear="all" />

<div class="bottombox"><p class="bottomtext"><a href="http://gmane.org/">Gmane</a></p></div>
  </body>
</html>


