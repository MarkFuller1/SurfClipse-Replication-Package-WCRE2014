



<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
 
 <meta name="ROBOTS" content="NOARCHIVE">
 
 <link rel="icon" type="image/vnd.microsoft.icon" href="http://www.gstatic.com/codesite/ph/images/phosting.ico">
 
 
 <script type="text/javascript">
 
 
 
 
 var codesite_token = null;
 
 
 var CS_env = {"assetHostPath": "http://www.gstatic.com/codesite/ph", "token": null, "domainName": null, "assetVersionPath": "http://www.gstatic.com/codesite/ph/3076573747170053082", "relativeBaseUrl": "", "profileUrl": null, "projectHomeUrl": "/p/google-gson", "loggedInUserEmail": null, "projectName": "google-gson"};
 var _gaq = _gaq || [];
 _gaq.push(
 ['siteTracker._setAccount', 'UA-18071-1'],
 ['siteTracker._trackPageview']);
 
 _gaq.push(
 ['projectTracker._setAccount', 'UA-4247088-1'],
 ['projectTracker._trackPageview']);
 
 (function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
 
 </script>
 
 
 <title>Issue 45 - 
 google-gson -
 
 Serializing/Deserializing simple maps should be better supported - 
 A Java library to convert JSON to Java objects and vice-versa - Google Project Hosting
 </title>
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/3076573747170053082/css/core.css">
 
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/3076573747170053082/css/ph_detail.css" >
 
 
 
 
<!--[if IE]>
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/3076573747170053082/css/d_ie.css" >
<![endif]-->
 <style type="text/css">
 .menuIcon.off { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -42px }
 .menuIcon.on { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -28px }
 .menuIcon.down { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 0; }
 
 
 .attachments { width:33%; border-top:2px solid #999; padding-top: 3px; margin-left: .7em;}
 .attachments table { margin-bottom: 0.75em; }
 .attachments table tr td { padding: 0; margin: 0; font-size: 95%; }
 .preview { border: 2px solid #c3d9ff; padding: 1px; }
 .preview:hover { border: 2px solid blue; }
 .label { white-space: nowrap; }
 .derived { font-style:italic }
 .cursor_on .author {
 background: url(http://www.gstatic.com/codesite/ph/images/show-arrow.gif) no-repeat 2px;
 }
 .hiddenform {
 display: none;
 }

 
 </style>
</head>
<body class="t3">
<script type="text/javascript">
 window.___gcfg = {lang: 'en'};
 (function() 
 {var po = document.createElement("script");
 po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";
 var s = document.getElementsByTagName("script")[0];
 s.parentNode.insertBefore(po, s);
 })();
</script>
<div class="headbg">

 <div id="gaia">
 

 <span>
 
 
 <a href="#" id="projects-dropdown" onclick="return false;"><u>My favorites</u> <small>&#9660;</small></a>
 | <a href="https://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogle-gson%2Fissues%2Fdetail%3Fid%3D45&amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogle-gson%2Fissues%2Fdetail%3Fid%3D45" onclick="_CS_click('/gb/ph/signin');"><u>Sign in</u></a>
 
 </span>

 </div>

 <div class="gbh" style="left: 0pt;"></div>
 <div class="gbh" style="right: 0pt;"></div>
 
 
 <div style="height: 1px"></div>
<!--[if lte IE 7]>
<div style="text-align:center;">
Your version of Internet Explorer is not supported. Try a browser that
contributes to open source, such as <a href="http://www.firefox.com">Firefox</a>,
<a href="http://www.google.com/chrome">Google Chrome</a>, or
<a href="http://code.google.com/chrome/chromeframe/">Google Chrome Frame</a>.
</div>
<![endif]-->



 <table style="padding:0px; margin: 0px 0px 10px 0px; width:100%" cellpadding="0" cellspacing="0"
 itemscope itemtype="http://schema.org/CreativeWork">
 <tr style="height: 58px;">
 
 
 
 <td id="plogo">
 <link itemprop="url" href="/p/google-gson">
 <a href="/p/google-gson/">
 
 <img src="http://www.gstatic.com/codesite/ph/images/search-48.gif" alt="Logo" itemprop="image">
 
 </a>
 </td>
 
 <td style="padding-left: 0.5em">
 
 <div id="pname">
 <a href="/p/google-gson/"><span itemprop="name">google-gson</span></a>
 </div>
 
 <div id="psum">
 <a id="project_summary_link"
 href="/p/google-gson/"><span itemprop="description">A Java library to convert JSON to Java objects and vice-versa</span></a>
 
 </div>
 
 
 </td>
 <td style="white-space:nowrap;text-align:right; vertical-align:bottom;">
 
 <form action="/hosting/search">
 <input size="30" name="q" value="" type="text">
 
 <input type="submit" name="projectsearch" value="Search projects" >
 </form>
 
 </tr>
 </table>

</div>

 
<div id="mt" class="gtb"> 
 <a href="/p/google-gson/" class="tab ">Project&nbsp;Home</a>
 
 
 
 
 <a href="/p/google-gson/downloads/list" class="tab ">Downloads</a>
 
 
 
 
 
 
 
 <a href="/p/google-gson/issues/list"
 class="tab active">Issues</a>
 
 
 
 
 
 <a href="/p/google-gson/source/checkout"
 class="tab ">Source</a>
 
 
 
 
 
 
 
 
 <div class=gtbc></div>
</div>
<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0" class="st">
 <tr>
 
 
 
 
 
 <td class="subt">
 <div class="issueDetail">
<div class="isf">
 
 
 <span class="inIssueEntry">
 <a class="buttonify" href="entry" onclick="return _newIssuePrompt();">New issue</a>
 </span> &nbsp;
 
 <span class="inIssueList">
 <span>Search</span>
 <form action="list" method="GET" style="display:inline">
 <select id="can" name="can">
 
<option disabled="disabled">Search within:</option>
<option value="1" >&nbsp;All issues</option>
<option value="2" selected=selected>&nbsp;Open issues</option>

<option value="6" >&nbsp;New issues</option>
<option value="7" >&nbsp;Issues to verify</option>

 </select>
 <span>for</span>
 <span id="qq"><input type="text" size="38" id="searchq" name="q"
 value="" autocomplete="off"
 
 onkeydown="_blurOnEsc(event)"></span>
 
 
 <span id="search_colspec"><input type="hidden" name="colspec" value="ID Type Status Priority Milestone Owner Summary" ></span>
 
 
 
 <input type="hidden" name="cells" value="tiles" >
 <input type="submit" value="Search">
 </form>
 </span> &nbsp;
 <span class="inIssueAdvSearch">
 <a href="advsearch">Advanced search</a>
 </span> &nbsp;
 <span class="inIssueSearchTips">
 <a href="searchtips">Search tips</a>
 </span> &nbsp;
 <span class="inIssueSubscriptions">
 <a href="/p/google-gson/issues/subscriptions">Subscriptions</a>
 </span>
</div>
</div>
 </td>
 
 
 
 
 <td align="right" valign="top" class="bevel-right"></td>
 </tr>
</table>


<script type="text/javascript">
 var cancelBubble = false;
 function _go(url) { document.location = url; }
</script>
<div id="maincol"
 
>

 






 

 

 

 

 

 

 

 

 

 

 

 


 

<div id="color_control" class="closed_colors">
<div id="issueheader">
<table cellpadding="0" cellspacing="0" width="100%"><tbody>
 <tr>
 <td class="vt h3" nowrap="nowrap" style="padding:0 5px">
 
 
 Issue <a href="detail?id=45">45</a>:
 </td>
 <td width="90%" class="vt">
 <span class="h3" >Serializing/Deserializing simple maps should be better supported</span>
 </td>
 <td>
 
 </td>
 </tr>
 <tr>
 <td></td>
 <td nowrap="nowrap">
 
 
 5 people starred this issue and may be notified of changes.
 
 
 
 </td>
 <td align="center" nowrap="nowrap">
 
 <a href="http://code.google.com/p/google-gson/issues/list?cursor=google-gson%3A45">Back to list</a>
 
 </td>
 </tr>
 
</tbody></table>
</div>
<table width="100%" cellpadding="0" cellspacing="0" border="0" class="issuepage" id="meta-container">
<tbody class="collapse"> 
 <tr>
 <td id="issuemeta">
 <div id="meta-float">
 
<table cellspacing="0" cellpadding="0">
 <tr><th align="left">Status:&nbsp;</th>
 <td width="100%">
 
 <span title="Developer made source code changes, QA should verify">Fixed</span>
 
 </td>
 </tr>
 
 
 
 
 <tr><th align="left">Owner:&nbsp;</th><td>
 
 

 <a class="userlink"
 href="/u/joel.leitch@gmail.com/">joel.leitch@gmail.com</a
>
 
 </td>
 </tr>
 
 
 <tr><th align="left" valign="top">Closed:&nbsp;</th>
 <td align="left" valign="top" width="100%">
 Sep 2008
 </td>
 </tr>
 
 
 <tr><td colspan="2">
 
 
 
 <div style="padding-top:2px">
 
 <a href="list?q=label:Type-Defect"
 title="Report of a software defect"
 class="label"><b>Type-</b>Defect</a>
 
 </div>
 
 
 
 
 <div style="padding-top:2px">
 
 <a href="list?q=label:Priority-Medium"
 title="Normal priority"
 class="label"><b>Priority-</b>Medium</a>
 
 </div>
 
 
 </td></tr>
 
</table>
<div class="rel_issues">
 
 
 
</div>


 <br><br>
 
 
 <div style="white-space:nowrap"><a href="https://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogle-gson%2Fissues%2Fdetail%3Fid%3D45&amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogle-gson%2Fissues%2Fdetail%3Fid%3D45">Sign in</a> to add a comment</div>
 
 


 
 </div>&nbsp;
 </td>
 <td class="vt issuedescription" width="100%" id="cursorarea" >
 
<div class="cursor_off vt issuedescription" id="hc0">
 
 
 <div class="author">
 
 Reported by
 

 <a class="userlink"
 href="/u/azeckoski/">azeckoski</a
>,
 <span class="date" title="Mon Sep 15 04:00:55 2008">Sep 15, 2008</span>
 
 </div>
<pre>
Attempting to simply serialize a map results in fairly useless output:

// dead simple map
Map&lt;String, Object&gt; m = new ArrayOrderedMap&lt;String, Object&gt;();
m.put(&quot;id&quot;, 123);
m.put(&quot;thing&quot;, &quot;AZ&quot;);

// serialize (annoyingly requires the typetoken thing)
String encoded = gson.toJson(data, new TypeToken&lt;Map&lt;String, Object&gt;&gt;()
{}.getType());

encoded = {&quot;id&quot;:{},&quot;thing&quot;:{}}

It should have been:
encoded = {&quot;id&quot;:123,&quot;thing&quot;:&quot;AZ&quot;}

This should really be able to handle the simple example of a map of
primitive/simple objects much better. The same type of thing happens when
attempting to read back in the data.

With a more realistic example it is even worse because another map placed
inside the first map results in an exception like so:
com.google.gson.JsonParseException: The JsonSerializer
com.google.gson.DefaultTypeAdapters$MapTypeAdapter@b27bb5 failed to
serialized object {name=aaron, date=Mon Sep 15 11:58:33 BST 2008, num=456,
array=[Ljava.lang.String;@fe3238} given the type class java.lang.Object
	at
com.google.gson.JsonSerializerExceptionWrapper.serialize(JsonSerializerExceptionWrapper.java:61)
	at
com.google.gson.JsonSerializationVisitor.visitUsingCustomHandler(JsonSerializationVisitor.java:177)
	at com.google.gson.ObjectNavigator.accept(ObjectNavigator.java:144)
	at
com.google.gson.JsonSerializationContextDefault.serialize(JsonSerializationContextDefault.java:47)
	at
com.google.gson.DefaultTypeAdapters$MapTypeAdapter.serialize(DefaultTypeAdapters.java:301)
	at
com.google.gson.DefaultTypeAdapters$MapTypeAdapter.serialize(DefaultTypeAdapters.java:293)
	at
com.google.gson.JsonSerializerExceptionWrapper.serialize(JsonSerializerExceptionWrapper.java:48)
	at
com.google.gson.JsonSerializationVisitor.visitUsingCustomHandler(JsonSerializationVisitor.java:177)
	at com.google.gson.ObjectNavigator.accept(ObjectNavigator.java:144)
	at
com.google.gson.JsonSerializationContextDefault.serialize(JsonSerializationContextDefault.java:47)
	at com.google.gson.Gson.toJson(Gson.java:272)
	at com.google.gson.Gson.toJson(Gson.java:228)
	at
org.sakaiproject.entitybroker.impl.EntityEncodingManager.encodeData(EntityEncodingManager.java:586)
	at
org.sakaiproject.entitybroker.impl.EntityEncodingManagerTest.testEncode(EntityEncodingManagerTest.java:243)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:585)
	at junit.framework.TestCase.runTest(TestCase.java:154)
	at junit.framework.TestCase.runBare(TestCase.java:127)
	at junit.framework.TestResult$1.protect(TestResult.java:106)
	at junit.framework.TestResult.runProtected(TestResult.java:124)
	at junit.framework.TestResult.run(TestResult.java:109)
	at junit.framework.TestCase.run(TestCase.java:118)
	at junit.framework.TestSuite.runTest(TestSuite.java:208)
	at junit.framework.TestSuite.run(TestSuite.java:203)
	at
org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)
	at
org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)
Caused by: java.lang.IllegalArgumentException: Map objects need to be
parameterized unless you use a custom serializer. Use the
com.google.gson.reflect.TypeToken to extract the ParameterizedType.
	at com.google.gson.TypeInfoMap.&lt;init&gt;(TypeInfoMap.java:34)
	at
com.google.gson.DefaultTypeAdapters$MapTypeAdapter.serialize(DefaultTypeAdapters.java:298)
	at
com.google.gson.DefaultTypeAdapters$MapTypeAdapter.serialize(DefaultTypeAdapters.java:293)
	at
com.google.gson.JsonSerializerExceptionWrapper.serialize(JsonSerializerExceptionWrapper.java:48)
	... 31 more



</pre>

</div>

 


 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc1">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Mon Sep 15 06:29:08 2008">
 Sep 15, 2008
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c1" href="/p/google-gson/issues/detail?id=45#c1">#1</a>
 

 <a class="userlink"
 href="/u/azeckoski/">azeckoski</a
></span>
 
<pre>
Extra info on the deserializing:
json = {&quot;id&quot;:123,&quot;thing&quot;:&quot;AZ&quot;}

Map&lt;String, Object&gt; decoded = gson.fromJson(data, new TypeToken&lt;Map&lt;String,
Object&gt;&gt;() {}.getType());

produces a map with: {id=java.lang.Object@e6612c, thing=java.lang.Object@d704f0}
(seems to be instances of Object with no data)

</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc2">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Sep 16 13:57:32 2008">
 Sep 16, 2008
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c2" href="/p/google-gson/issues/detail?id=45#c2">#2</a>
 

 <a class="userlink"
 href="/u/joel.leitch@gmail.com/">joel.leitch@gmail.com</a
></span>
 
<pre>
First off, I'd like to start with some background information.  When you are defining
types (or local variables) that have type parameters, the JVM drops the actual type
parameters and associates everything as &quot;Object&quot;.  This is known as &quot;type erasure&quot;. 
In order for a Java Program to retrieve the actual type parameters at run-time, you
need to leverage the TypeToken object (this methodology was established by GUICE ---
see
<a href="http://google-guice.googlecode.com/svn/trunk/javadoc/com/google/inject/TypeLiteral.html" rel="nofollow">http://google-guice.googlecode.com/svn/trunk/javadoc/com/google/inject/TypeLiteral.html</a>).

Originally, we implemented Gson so that it could &quot;serialize&quot; these kinds of objects
without requiring the use of TypeToken; however, deserializing it back into the real
object requires it since the JSON output has no type information in it.  As well,
with this approach, it meant you were serializing the &quot;real&quot; object which meant that
some fields on the real object would be added to the JSON output.  Therefore, if you
had a List&lt;A&gt; and added both A and B objects (i.e. B extends A) some objects would
expose extra fields in the output.  We decided to take the more explicit route and
force the client to provide us the type parameters of the top-level object that is
being serialized.

The common use of a Map or List is that you populate the List with the same object
types.  Passing in Object means that you can add any instance of a class that you
desire to the data structure.  I know there are exceptions to this best practice, but
we do not want to implement this corner case scenario.  Instead, if you really do
want to use a list of Objects, then do as the exception message says and write a
&quot;custom&quot; (de)serializer (you can bind it specifically to a Map&lt;String, Object&gt; and
have the default Gson map serializer handle everything else).

As for a Map of Maps (i.e. Map&lt;String, Map&lt;String, Integer&gt;&gt;) this is already
supported and works well as long as you pass in the actual type object (i.e. new
TypeToken&lt;Map&lt;String, Map&lt;String, Integer&gt;&gt;&gt;() {}.getType())

Here's an example:
public static void main(String[] args) {
  Type mapType = new TypeToken&lt;Map&lt;String, Map&lt;String, Integer&gt;&gt;&gt;() {}.getType();
  Map&lt;String, Map&lt;String, Integer&gt;&gt; map = new HashMap&lt;String, Map&lt;String, Integer&gt;&gt;();
  Map&lt;String, Integer&gt; value1 = new HashMap&lt;String, Integer&gt;();
  value1.put(&quot;lalala&quot;, 78);
  value1.put(&quot;haha&quot;, 9999);
  map.put(&quot;id&quot;, value1);
    
  Map&lt;String, Integer&gt; value2 = new HashMap&lt;String, Integer&gt;();
  value2.put(&quot;nahhd&quot;, 121112);
  value2.put(&quot;uuywss&quot;, 19987);
  map.put(&quot;thing&quot;, value2);
    
  Map&lt;String, Integer&gt; value3 = new HashMap&lt;String, Integer&gt;();
  map.put(&quot;other&quot;, value3);

  Gson gson = new Gson();
  String json = gson.toJson(map, mapType);
  System.out.println(json);
    
  Map&lt;String, Map&lt;String, Integer&gt;&gt; deserializedMap = gson.fromJson(json, mapType);
  System.out.println(deserializedMap);
}

=========== OUTPUT ===========
{&quot;thing&quot;:456,&quot;id&quot;:123}
{&quot;other&quot;:{},&quot;thing&quot;:{&quot;nahhd&quot;:121112,&quot;uuywss&quot;:19987},&quot;id&quot;:{&quot;lalala&quot;:78,&quot;haha&quot;:9999}}
{other={}, thing={nahhd=121112, uuywss=19987}, id={lalala=78, haha=9999}}


For now, I am closing this off as &quot;Working as Designed&quot;.  Maybe I am not completely
following your issue and if that is the case, please start up a new discussion in our
Gson discussion group.

Thanks,
Joel
</pre>
 
 
 <div class="updates">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 
 <b>Status:</b>
 Invalid
 
 <br>
 
 <b>Owner:</b>
 joel.leitch
 
 <br>
 
 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc3">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Sep 18 02:01:04 2008">
 Sep 18, 2008
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c3" href="/p/google-gson/issues/detail?id=45#c3">#3</a>
 

 <a class="userlink"
 href="/u/azeckoski/">azeckoski</a
></span>
 
<pre>
We solved our problem by using a different library but I wanted to put a comment here
anyway.

So what happens if I want to do this?
Map&lt;String, Number&gt;
or
Map&lt;String, Serializable&gt;

(it seems to fail)

It seems that this is designed to only work for the basic case where I have really
simple and non-nested structures where all the beans are easily instantiable and not
superclasses. It is a shame that this is considered working as designed.

</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc4">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Sat Sep 27 13:32:06 2008">
 Sep 27, 2008
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c4" href="/p/google-gson/issues/detail?id=45#c4">#4</a>
 

 <a class="userlink"
 href="/u/joel.leitch@gmail.com/">joel.leitch@gmail.com</a
></span>
 
<pre>
I am glad to hear that you found something that works for you, but it's too bad you
are unable to use Gson.  I'd still like to follow up on this issue because it is
user's like yourself that will help to advance this library.

First off, are you serializing and deserializing an object of type Map&lt;String,
Number&gt;?  If it is serialization only, than that is a much &quot;easier&quot; problem to solve
because we have the runtime types.  As for &quot;deserializing&quot; this kind of object, we
have provided our clients with the concept of a custom &quot;Type Adapter&quot;.  You should be
able to write a type as follows to get it to work with &quot;Number&quot;:

  public static class NumberTypeAdapter 
      implements JsonSerializer&lt;Number&gt;, JsonDeserializer&lt;Number&gt;,
InstanceCreator&lt;Number&gt; {

    public JsonElement serialize(Number src, Type typeOfSrc, JsonSerializationContext
context) {
      return new JsonPrimitive(src);
    }

    public Number deserialize(JsonElement json, Type typeOfT,
JsonDeserializationContext context)
        throws JsonParseException {
      JsonPrimitive jsonPrimitive = json.getAsJsonPrimitive();
      if (jsonPrimitive.isNumber()) {
        return jsonPrimitive.getAsNumber();
      } else {
        throw new IllegalStateException(&quot;Expected a number field, but was &quot; + json);
      }
    }

    public Number createInstance(Type type) {
      return 1L;
    }
  }

  public static void main(String[] args) {
    Map&lt;String, Number&gt; map = new HashMap&lt;String, Number&gt;();    
    map.put(&quot;int&quot;, 123);
    map.put(&quot;long&quot;, 1234567890123456789L);
    map.put(&quot;double&quot;, 1234.5678D);
    map.put(&quot;float&quot;, 1.2345F);
    Type mapType = new TypeToken&lt;Map&lt;String, Number&gt;&gt;() {}.getType();

    Gson gson = new GsonBuilder().registerTypeAdapter(Number.class, new
NumberTypeAdapter()).create();
    String json = gson.toJson(map, mapType);
    System.out.println(json);
    
    Map&lt;String, Number&gt; deserializedMap = gson.fromJson(json, mapType);
    System.out.println(deserializedMap);
  }

========== OUTPUT ==========
{&quot;double&quot;:1234.5678,&quot;float&quot;:1.2345,&quot;int&quot;:123,&quot;long&quot;:1234567890123456789}
{double=1234.5678, float=1.2345, int=123, long=1234567890123456789}


We should probably just include the above type adapter as a default in Gson and I
will discuss this with Inderjeet.  There is a bug, however, since you actually have
to specify a &quot;instance creator&quot; for this type of object (i.e. primitive), but I will
have that fixed by the next release.  You should be able to write something similar
as above for &quot;Serializable&quot;.

I hope this information is helpful and thanks for the all the feedback on this library.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc5">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Oct 21 02:53:38 2008">
 Oct 21, 2008
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c5" href="/p/google-gson/issues/detail?id=45#c5">#5</a>
 

 <a class="userlink"
 href="/u/106838710141082543559/">zhaojinz...@gmail.com</a
></span>
 
<pre>
I modify the MapTypeAdapter to match the jdk14's Map
======================================================
public JsonElement serialize(Map src, Type typeOfSrc, JsonSerializationContext context) {
      JsonObject map = new JsonObject();
      //Type childType = new TypeInfoMap(typeOfSrc).getValueType();
      for (Iterator iterator = src.entrySet().iterator(); iterator.hasNext(); ) {
        Map.Entry entry = (Map.Entry) iterator.next();
		Object obj = entry.getValue();
        JsonElement valueElement = context.serialize(obj, obj.getClass());
        ---------------------------------------------------------------------modified
        map.add(entry.getKey().toString(), valueElement);
      }
      return map;
    }
--------------------------------------------------------------------------------

and then the map class can be used like this:
  HashMap aaaa = new HashMap();
  aaaa.put(&quot;aa&quot;, 1212);
  aaaa.put(&quot;bb&quot;, &quot;fasdfa&quot;);
  System.out.println(gson.toJson(aaaa));
==========output=================
{&quot;bb&quot;:&quot;fasdfa&quot;,&quot;aa&quot;:1212}
=================================

It can run, good or bad? because there are lot's of  jdk14's source code in many
project's.

</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc6">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Oct 21 08:32:28 2008">
 Oct 21, 2008
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c6" href="/p/google-gson/issues/detail?id=45#c6">#6</a>
 

 <a class="userlink"
 href="/u/inder123/">inder123</a
></span>
 
<pre>
Thanks for providing the code snippet. This will not work properly in case of 
genericized maps since in those cases it is important to use the type specified in 
the field declaration instead of the actual type. I have made similar fixes for <a title="Serialization of Object fields ignores their types" class=closed_ref href="/p/google-gson/issues/detail?id=54"> Issue 
54 </a> and 58 that I will apply in this case as well. 
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc7">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Tue Oct 21 15:41:48 2008">
 Oct 21, 2008
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 <span class="role_label">Project Member</span>
 <a name="c7" href="/p/google-gson/issues/detail?id=45#c7">#7</a>
 

 <a class="userlink"
 href="/u/inder123/">inder123</a
></span>
 
<pre>
I have fixed this issue in <a href="/p/google-gson/source/detail?r=277">r277</a> 

Now, you should be able to serialize raw maps. The deserialization continues to 
require parameterized type. 
</pre>
 
 
 <div class="updates">
 <div class="round4"></div>
 <div class="round2"></div>
 <div class="round1"></div>
 <div class="box-inner">
 
 <b>Status:</b>
 Fixed
 
 <br>
 
 </div>
 <div class="round1"></div>
 <div class="round2"></div>
 <div class="round4"></div>
 </div>
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc8">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Jan 22 13:43:24 2010">
 Jan 22, 2010
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c8" href="/p/google-gson/issues/detail?id=45#c8">#8</a>
 

 <a class="userlink"
 href="/u/117527641334914382442/">SystemIn...@gmail.com</a
></span>
 
<pre>
Thank you for fixing this issue: 
In java land, you really shouldn't be instantiating Map&lt;String, Object&gt; but since
we're dealing with JSON world, it actually makes a lot of sense. 
Consider Map&lt;String, Object&gt; map;
map.put(&quot;field1&quot;, 123);
map.put(&quot;field2&quot;, &quot;myfield2&quot;);

What is gson.toJson(map)???
It's a javascript object o where o.field1 is the number 123 and o.field2 is the
string myfield2!
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc9">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Mar  5 22:43:02 2010">
 Mar 5, 2010
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c9" href="/p/google-gson/issues/detail?id=45#c9">#9</a>
 

 <a class="userlink"
 href="/u/100355137843966263748/">demog...@gmail.com</a
></span>
 
<pre>
json convert to map&lt;Integer,MyClass&gt; it have problem !
how to  do ?

</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc10">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Jun 25 11:12:30 2010">
 Jun 25, 2010
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c10" href="/p/google-gson/issues/detail?id=45#c10">#10</a>
 

 <a class="userlink"
 href="/u/111709461606360943085/">mani.dor...@gtempaccount.com</a
></span>
 
<pre>
If you do json eval() in javascript or python, you get a dictionary. Inside the dictionary, it has String/Number or nested dictionaries. eval doesnt expect these type declarations.
I would expect the same on static language as well - Maps with default Number (lossless datatype like Double) datatype for deserialization.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc11">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Fri Aug  6 07:45:14 2010">
 Aug 6, 2010
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c11" href="/p/google-gson/issues/detail?id=45#c11">#11</a>
 

 <a class="userlink"
 href="/u/118071133918451035667/">kstruil...@gmail.com</a
></span>
 
<pre>
Hi demograp,

Did you forget to implement a default constructor for MyClass ?
It was my case, and I solved it doing this.

Hope it helps.
</pre>
 
 
 </div>
 

 
 
 
 
 <div class="cursor_off vt issuecomment"
 id="hc12">
 <div style="float:right; margin-right:.3em; text-align:right">
 <span class="date" title="Thu Sep  1 05:23:41 2011">
 Sep 1, 2011
 </span>
 
 
 
 </div>
 
 
 
 
 
 
 
 
 
 
 <span class="author">
 
 <a name="c12" href="/p/google-gson/issues/detail?id=45#c12">#12</a>
 

 <a class="userlink"
 href="/u/111132535514394817634/">dska...@gmail.com</a
></span>
 
<pre>
I faced similar problems. Easiest solution for me was wrapping the desired map in a wrapper object and passing that to gson. I guess in the end that just boils down to be the same as providing the TypeToken, but it is a much more straightforward solution for those who want a quick fix.
</pre>
 
 
 </div>
 


 


 </td>
 </tr>

 
 <tr>
 <td></td>
 <td class="vt issuecomment">
 <span class="indicator">&#9658;</span> <a href="https://www.google.com/accounts/ServiceLogin?service=code&ltmpl=phosting&continue=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogle-gson%2Fissues%2Fdetail%3Fid%3D45&amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fgoogle-gson%2Fissues%2Fdetail%3Fid%3D45"
 >Sign in</a> to add a comment
 </td>
 </tr>
 

</tbody>
</table>
<br>
<script type="text/javascript" src="http://www.gstatic.com/codesite/ph/3076573747170053082/js/dit_scripts.js"></script>



 

</div> 
<form name="delcom" action="delComment.do?q=&amp;can=2&amp;groupby=&amp;sort=&amp;colspec=ID+Type+Status+Priority+Milestone+Owner+Summary" method="POST">
 <input type="hidden" name="sequence_num" value="">
 <input type="hidden" name="mode" value="">
 <input type="hidden" name="id" value="45">
 <input type="hidden" name="token" value="">
</form>

<div id="helparea"></div>
<script type="text/javascript">
 _onload();
 function delComment(sequence_num, delete_mode) {
 var f = document.forms["delcom"];
 f.sequence_num.value = sequence_num;
 f.mode.value = delete_mode;
 
 f.submit();
 return false;
 }
 
 _floatMetadata();
</script>
<script type="text/javascript" src="http://www.gstatic.com/codesite/ph/3076573747170053082/js/kibbles.js"></script>
<script type="text/javascript">
 _setupKibblesOnDetailPage(
 'http://code.google.com/p/google-gson/issues/list?cursor\x3dgoogle-gson%3A45',
 '/p/google-gson/issues/entry',
 '',
 '',
 '', 'google-gson', 45,
 false, false, codesite_token);
</script>
 
 
 
 <script type="text/javascript" src="http://www.gstatic.com/codesite/ph/3076573747170053082/js/ph_core.js"></script>
 
 
 
 
</div> 

<div id="footer" dir="ltr">
 <div class="text">
 <a href="/projecthosting/terms.html">Terms</a> -
 <a href="http://www.google.com/privacy.html">Privacy</a> -
 <a href="/p/support/">Project Hosting Help</a>
 </div>
</div>
 <div class="hostedBy" style="margin-top: -20px;">
 <span style="vertical-align: top;">Powered by <a href="http://code.google.com/projecthosting/">Google Project Hosting</a></span>
 </div>

 
 


 
 </body>
</html>

