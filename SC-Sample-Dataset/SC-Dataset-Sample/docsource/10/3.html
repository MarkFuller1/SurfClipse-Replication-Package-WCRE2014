
  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=7" />
    <meta http-equiv="content-type" content="text/html;charset=gbk"/>
    <meta http-equiv="content-style-type" content="text/css"/>
    <meta http-equiv="content-script-type" content="text/javascript"/>
    <meta name="version" content="neblog-1.0"/>
    <script type="text/javascript">
      
      
      document.uniqueID!=document.uniqueID&&!!location.hash&&(location.hash=location.hash); 
      document.domain = location.hostname.replace(/^.*\.([\w]+\.[\w]+)$/,'$1');
      window.focus();
      window.getMusicTimeStamp=function(){return 'b10f1d70b21797402128a069d754b192';};
    </script>
<title>Spring to Java EE C A Migration Experience(收藏) - yyq2007aa的日志 - 网易博客</title>
<meta name="author" content="yyq2007aa,yyq2007aa"/>
<meta name="keywords" content="Spring to Java EE C A Migration Experience(收藏),日志,yyq2007aa,流星永恒的博客,网易博客,网易,blog"/>
<meta name="description" content="Spring to Java EE C A Migration Experience(收藏),yyq2007aa的网易博客,JSF,Facelets,Rich(Prime)Faces,和java的笔记,"/>
  <script type="text/javascript">
    (function(){
     var R=24,C=11,a=[];
     for(var i=0;i<C;i++)for(var j=0;j<R;a.push('.icn0-'+i+j+'{background-position:'+(i>0?('-'+i*40+'px'):'0')+' '+(j>0?('-'+j*20+'px'):'0')+';}'),j++);
          document.write('<style type="text/css">'+a.join('')+'</st'+'yle>');
    })();
  </script>
    <link type="text/css" rel="stylesheet" href="http://b2.bst.126.net/newpage/r/c/c.css?v=1386211381284"/>
    <link type="text/css" rel="stylesheet" href="http://b.bst.126.net/newpage/style/nblog/4040/nb.css" id="blog-163-com-theme"/>
  <!--[if lte IE 6]>
  <style type="text/css">
    html,body,#blog-163-com-ie6body{height:100%;width:100%;overflow:hidden;}
    #blog-163-com-ie6body{overflow:auto;overflow-y:scroll;}
    #blog-163-com{background:none;}
  </style>
  <![endif]-->
  
  
  <style type="text/css">.m-3 .nbw-ryt .left .mcnt{padding-left:10px;}.m-3 .nbw-ryt .right .acts{position:relative;margin:0 0 12px 0;line-height:20px;}.m-3 .nbw-ryt .right .more{margin-top:-15px;height:24px;line-height:24px;}#blog-163-com .m-3 .phide{display:none;}.m-3 .nbw-ryt .left .nbw-bitm{margin:0;padding:0 10px 0 10px;position:relative;}.m-3 .nbw-ryt .left .nbw-bitm .title{margin:30px 0 20px;line-height:32px;}.m-3 .nbw-ryt .left .nbw-bitm .title .tcnt{font-size:26px;font-weight:bold;font-family:"Hiragino Sans GB W3","Hiragino Sans GB","Microsoft YaHei","\5FAE\8F6F\96C5\9ED1",Arial,Helvetica,simsun,"\5B8B\4F53";}.m-3 .nbw-ryt .left .nbw-bitm .tdep{margin-bottom:20px;}.m-3 .nbw-ryt .left .nbw-bitm .tbar{margin:5px 0;padding:10px 0 10px 0;line-height:20px;text-align:right;}.m-3 .nbw-ryt .left .nbw-bitm .bct{font-size:16px;padding-left:0}.m-3 .nbw-ryt .left .nbw-bitm .muava{float:left;margin:5px 7px 0 0;border-width:0 1px 0 0;height:40px;}.m-3 .nbw-ryt .left .snl .pnb div{line-height:20px;text-align:left;}.m-3 .nbw-ryt .cite{margin:20px 0 0 50px;line-height:24px;text-align:left;}.m-3 .nbw-ryt .cite .close{float:right;margin:0;text-align:right;}.m-3 .nbw-ryt .cite span{cursor:pointer;}.m-3 .nbw-ryt .cite .nbw-act{text-align:center;}.m-3 .nbw-ryt .cite .ads{margin-left:20px;width:400px;}.m-3 .nbw-ryt .cite .tbac{margin-left:60px;padding:0;border:0;list-style:none;line-height:24px;}.m-3 .nbw-ryt .cite .tbl{width:150px;overflow:hidden;}.m-3 .nbw-ryt .cite .tbr{margin-left:20px;overflow:hidden;}.m-3 .nbw-act-share{position:relative;}.m-3 .nbw-act-share .nas-wrap{visibility:hidden;}.m-3 .nbw-act-share:hover .nas-wrap,.m-3 .js-share-hover .nas-wrap{visibility:visible;}.m-3 .nas-wrap,.nas-itm,.nas-wb{background:url(/newpage/images/blog/icn-share.png?0011) no-repeat 9999px 9999px;}.m-3 .nas-wrap{margin-top:5px;}.nas-itm,.nas-wb{text-decoration:none;}.nas-itm,.nas-wb:hover{text-decoration:underline;}.m-3 .nas-itm{float:left;width:16px;height:16px;margin:0 1px 0 6px;overflow:hidden;cursor:pointer;}.m-3 .nas-itm0{background-position:0 -173px;}.m-3 .nas-itm1{background-position:0 -56px;}.m-3 .nas-itm2{background-position:0 -85px;}.m-3 .nas-itm3{background-position:0 -227px;}.m-3 .nas-itm4{background-position:0 -143px;}.m-3 .nas-itm5{background-position:0 -201px;}.m-3 .nas-itm6{background-position:0 -249px;}.m-3 .nas-itm7{background-position:0 -283px;}.m-3 .nas-itm8{background-position:0 -313px;}.m-3 .nas-itm9{background-position:0 -342px;}.nas-wb{padding-left:20px;cursor:pointer;line-height:normal;background-position:0 -173px;}.nas-icn0fix{margin-top:4px;}.nas-tofix{margin-top:0;*margin-top:2px;line-height:25px;}.m-3 .ptc{position:absolute;cursor:pointer;}.m-3 .ptc .ptcp .bcmimg{float:left;background-image:url("http://b.bst.126.net/newpage/images/blogcmtimg.png");background-position:0 0;background-repeat:no-repeat;height:22px;line-height:22px;width:22px;padding:0 6px 0 0;}.m-3 .ptc .ptcp{cursor:pointer;position:absolute;left:5px;bottom:5px;clear:both;width:94px;}.m-3 .ptc .ptcp .ptcmi{float:left;width:16px;height:16px;padding:3px 6px 3px 5px;_padding:2px 6px 0 3px;margin:0;}.m-3 .ptc .ptcp .ptcmt{background-position:-418px -50px;float:left;width:67px;height:22px;overflow:hidden;margin:0px 0 0 -3px;line-height:22px;*line-height:23px;text-align:left;color:#444444;}.m-3 .ptc .ptcp .ptcmt-2{width:61px;padding-left:6px;background-position:-424px -50px;}.m-3 .relateblog{text-align:left;}.m-3 .relateblog h4{margin:0;padding:0 0 0 10px;line-height:30px;}.m-3 .relateblog .cnt{padding-left:8px;margin:10px 0 10px 0px;}.m-3 .relateblog .cnt ul{margin:0;padding:0;list-style:none;}.m-3 .relateblog .cnt ul li{height:24px;margin-right:20px;line-height:24px;}.m-3 .relateblog .cnt ul li span{margin:0 8px;}.m-3 .author, .m-3 .comment{text-align:left;}.m-3 .author .nlogif{width:150px;line-height:20px;margin-left:5px;_margin-left:3px;}.m-3 .author .nlogif .nbw-fce{margin:0 3px 0 10px;_margin-left:5px}.m-3 .author .nlogif .pright{width:85px;margin:0;padding:5px 0;_padding-top:10px}.m-3 .nbw-ryt .right h4{margin:0;padding:0;line-height:30px;}.m-3 .author h4, .m-3 .comment h4{margin:0;padding:0 0 0 10px;line-height:30px;}.m-3 .author .cwd{border:0;text-align:left;}.m-3 .author .vname{width:50px;text-align:center;}.m-3 .author .cnt{margin:10px 0 10px -5px;}.m-3 .author .nbw-fce{margin:0 11px;}.m-3 .author .nbw-f50{width:50px}.m-3 .nbw-ryt .left .top{position:relative;padding-bottom:5px;line-height:20px;}.m-3 .nbw-ryt .left .top .ilft{position:absolute;left:0;top:0;}.m-3 .nbw-ryt .left .top .irgt{position:absolute;right:-10px;top:0;}.m-3 .nbw-ryt .left .top .pleft{margin-left:20px;_margin-left:10px;overflow:hidden;width:40%;height:20px;text-align:left}.m-3 .nbw-ryt .left .top .pright{margin-right:10px;_margin-right:5px;overflow:hidden;width:40%;height:20px;text-align:right}.m-3 .nbw-ryt .left .snl .top{position:relative;padding:5px 0 15px 0;line-height:20px;}.m-3 .nbw-ryt .left .snl .top .ilft{position:absolute;left:-10px;top:5px;}.m-3 .nbw-ryt .left .snl .top .irgt{position:absolute;right:-10px;top:5px;}.m-3 .nbw-ryt .left .snl .top .pleft{margin-left:10px;_margin-left:5px;overflow:hidden;width:40%;height:20px;text-align:left}.m-3 .nbw-ryt .left .snl .top .pright{margin-right:10px;_margin-left:5px;overflow:hidden;width:40%;height:20px;text-align:right}.m-3 .nbw-ryt .left .snl .pnb{padding:5px 0 10px 10px;overflow:hidden;_width:100%}.m-3 .comment h4{padding:0 0 0 10px}.m-3 .comment .publish{margin:10px 0;padding:0 0 10px 5px;text-align:left;}.m-3 .comment .publish .nbw-fce{padding-top:0;}.m-3 .comment .publish .nbw-fce .cwd{border:0;}.m-3 .comment .publish .redt{margin-left:65px;}.m-3 .comment .nolog{border:1px solid #000;background-color:#FFFFE1;height:40px;line-height:40px;text-align:center;padding:0;_padding:10px 0;_height:20px;}.m-3 .comment .case{padding-left:5px;padding-bottom:10px;}.m-3 .comment .vgl{margin:8px;width:75%;text-align:center;}#blog-163-com .m-3 .comment .nbw-cmt .cnt{width:488px;}#blog-163-com .m-3 .comment .nbw-cmt .nbw-cmt .cnt{width:444px;}.m-3 .edt-cmt{width:444px;}.m-3 .comment .publish .edt-cmt{width:488px;}.m-3 .comment .publish .edt-cmt .zbcc{display:none;}.m-3 .nbw-ryt .left .nbw-bitm .js-fs0{font-size:150%;}.m-3 .nbw-ryt .left .nbw-bitm .js-fs1, .m-3 .nbw-ryt .left .nbw-bitm .js-fs1 *{font-size:20px;}.m-3 .nbw-ryt .left .nbw-bitm .js-fs2{}.m-3 .nbw-ryt .left .nbw-bitm .js-fs3, .m-3 .nbw-ryt .left .nbw-bitm .js-fs3 *{font-size:12px;}.m-3 .js-fcurrent{font-color:#000;font-weight:bold;text-decoration:none;}.m-3 .nbw-bitm .dream{margin-top:-10px;clear:both}.m-3 .nbw-bitm .cited{margin-top:-15px;}.m-3 .nbw-bitm .rdif{line-height:24px;height:24px;}.m-3 .nbw-bitm .rdif .pnt{line-height:24px;height:24px;margin-right:10px;}.m-3 .nbw-bitm .rdif .pclass{vertical-align:middle;width:57px;height:22px;}.m-3 .nbw-bitm .rdif .rdct{display:inline-block;}.m-3 .snl .rdcnt{padding:5px;text-align:left}.m-3 .snl .rdcnt .nbw-fce{margin:0 5px}.m-3 .snl .rdcnt p{margin:10px 0}.m-3 .snl .rdcnt .rrb{list-style:none;height:22px;line-height:22px;}.m-3 .acts .iblock{width:18px;}.m-3 .ns{margin:0 0 0 2px;}.m-3 .cancel{display:none;}.m-3 .js-hover .cancel, .m-3 .follow:hover .cancel, .m-3 .frd:hover .cancel{display:inline;}.m-3 .follow{*margin-left:2px;}.m-3 .flw{padding:7px 8px;color:#000;background:#fefce4;border:1px solid #b7b7b7;}.m-3 .acts .flw .iblock{width:20px;}.m-3 .sntesctf{width:15px;margin-left:3px;}.dr-warm{width:420px;padding:12px 18px;margin:18px 0;line-height:20px;border:1px solid #aaa;color:#666;background:#ffffdc;}.dr-warm a,.dr-warm a:hover{text-decoration:underline;color:#02a;}.dr-warm .codeinput{width:70px;text-align:center;}.dr-warm .codediv{margin:10px 0 0;}.dr-warm .ml{margin:0px 10px;vertical-align:middle;}.dr-warm .button{background-color:#77716F;width:42px;height:20px;border:0 none;color:#fff;cursor:pointer;}.m-3 .commentcntwrap{position:relative;zoom:1;}.m-3 .cmtMultiUserRole{position:absolute;left:62px;bottom:5px;width:300px;overflow-x;hidden;}.m-3 .cmtMultiUserRole .selectRole{float:right;padding:1px 1px 0 1px;border:none;}.m-3 .cmtMultiUserRole .selectRole .ztxt{float:left;width:auto;overflow:hidden;}.m-3 .cmtMultiUserRole .selectRole .zdwn{float:left;background:url("/newpage/images/icon.png") -240px -420px no-repeat;text-indent:-9999px;}.m-3 .cmtMultiUserRole .selectRole .zlst .zitm{}.m-3 .cmtMultiUserRole .selectRole .zlst .zitm:hover, .m-3 .cmtMultiUserRole .selectRole .slst .item.js-zhvr-910{color:#333;background-color:#ececec;}.m-3 .nbw-cmt{position:static;}.m-3 .nbw-cmt .thde{position:relative;zoom:1;}.m-3 .publish .redt{position:relative;zoom:1;}.m-3 .publish .redt .cmtMultiUserRole{left:135px;_left:132px;}.m-3 .cmtMultiUserRole .js-showlist{padding:0;margin:0;border-style:solid;border-width:1px 1px 0 1px;border-color:#aaa;}.m-3 .cmtMultiUserRole .js-showlist .zlst{border-style:solid;border-width:0 1px 1px 1px;border-color:#aaa;}.m-3 .multiuserItem{}.m-3 .multiuserItem .author{margin-right:-50px;}.m-3 .multiuserItem .multicntwrap{padding:30px 0 20px 0;}.m-3 .multiuserItem .multicnt{_padding-top:2px;margin-left:50px;}.m-3 .nbw-ryt .left .multiuserItem .multicnt .title{width:95%;margin-top:0;margin-bottom:0;}.m-3 .nbw-ryt .left .multiuserItem .multicnt .tdep{margin-bottom:0;}.m-3 .attachment{margin-bottom:20px;}.m-3 .awidth{width:40px;}.m-3 .view{margin-right:10px;}.m-3 .nbw-cmt .op{height:18px;line-height:18px;}.m-3 .suggestedreading{overflow:hidden;position:relative;zoom:1;}.m-3 .suggestedreading .m-list{margin-left:0;padding-left:15px;overflow:hidden;font-size:14px;}.m-3 .suggestedreading .m-list .gap{margin-left:8px;color:#ADADAD;}.m-3 .suggestedreading .m-list li{height:20px;padding:3px 0 2px;vertical-align:middle;}.m-3 .suggestedreading .wrap li{float:left;width:118px;height:146px;}.m-3 .suggestedreading .suggesteditem1{line-height:24px;margin:5px 0;font-size:12px;margin-right:10px;}.m-3 .suggestedreading .suggesteditem2{margin:5px 0;font-size:12px;}.m-3 .suggestedreading .suggesteditem2 .imgwrap1{position:relative;overflow:hidden;width:90px;height:90px;zoom:1;}.m-3 .suggestedreading .suggesteditem2 .imgwrap2{z-index:2;position:absolute;left:0;top:0;}.m-3 .suggestedreading .suggesteditem2 .btitle{width:96px;height:148px;overflow:hidden;text-decoration:none;}.m-3 .suggestedreading .suggesteditem2 .sep{padding:5px 10px 0 10px;}.m-3 .suggestedreading .suggesteditem2 a{cursor:pointer;}.m-3 .suggestedreading .suggesteditem2 a:hover{text-decoration:none;}.m-3 .suggestedreading .suggesteditem2 img{border-width:0;}.m-3 .suggestedreading .color1{background-color:#B3786B;}.m-3 .suggestedreading .color2{background-color:#D2C1A8;}.m-3 .suggestedreading .color3{background-color:#D46646;}.m-3 .suggestedreading .color4{background-color:#D28FA8;}.m-3 .suggestedreading .color5{background-color:#C84F54;}.m-3 .suggestedreading .white{color:white;}.m-3 .suggestedreading .imgtip{margin:2px;font-weight:bold;color:white;font-size:13px;}.m-3 .suggestedreading .borderwrap{padding:2px;background-color:#fff;}.m-3 .suggestedreading .time{position:absolute;bottom:0;right:0;}.m-3 .suggestedreading .hidsep{margin-left:-1px;}.m-3 .suggestedreading .srtitle{font-size:14px;font-weight:bold;margin-bottom:10px;}.m-3 #yodaoad{padding-left:5px;}.m-3 #yodaoad_3{padding:20px 0 25px 0;}.m-3 .relategroup{width:45%}.m-3 .blogvote{padding-left:35px;position:relative;zoom:1;}.m-3 .blogvote .sep{margin:0 5px;}.m-3 .blogvote .vtitle{margin:15px 0 15px -30px;}.m-3 .blogvote .vtitle span{padding-right:8px;}.m-3 .blogvote .vtitle .close{width:60px;height:24px;vertical-align:middle;}.m-3 .blogvote .roleview{padding-right:10px}.m-3 .blogvote .roleview .iblock{width:10px}.m-3 .blogvote .options{clear:both;margin-right:10px}.m-3 .blogvote .options ul{margin:0;padding:0;list-style:none;}.m-3 .blogvote .options ul li{padding:10px 0;line-height:16px;}.m-3 .blogvote .options .role{margin-bottom:15px;}.m-3 .blogvote .options .acts{margin-bottom:15px;height:24px;line-height:26px;}.m-3 .blogvote .options .acts .leftpt{height:24px;line-height:26px;}.m-3 .blogvote .options .acts .leftpt button{height:24px;line-height:18px;}.m-3 .blogvote .options .acts .leftpt span{}.m-3 .blogvote .options .acts .view{margin-left:5px;}.m-3 .blogvote .fvote{padding-top:10px;}.m-3 .blogvote .fvote ul{list-style:none;margin:10px 0;padding:0;}.m-3 .blogvote .fvote ul li{line-height:20px;margin:5px 0;}.m-3 .blogvote .options ul .col0{width:230px;margin-right:10px;margin-top:-3px;_margin-top:-5px;line-height:20px}.m-3 .blogvote .options ul .col0 input{_position:relative;_top:3px}.m-3 .blogvote .options ul .col0 label{width:200px;_position:relative;_top:4px}.m-3 .blogvote .options ul .col1{width:190px;height:14px;line-height:14px;;background:none repeat scroll 0 0 #EAEAEA;}.m-3 .blogvote .options ul .col1 .iblock{width:100%;height:16px;vertical-align:middle;}.qing001{margin:0;border:none;}.qing001 .nb-mc{background:none;}.qing001 .nb-mc .cc{width:942px;padding:0;margin:0 auto;}.qing001 .nb-mc .cl{display:none;}.qing001 .nb-mc .cr{display:none;}.qing001 .bh{display:none;}.qing001 .nbw-ryt{background:url(/newpage/images/qingtheme/qing001/blogdetail_cntbg.png) 0 0 repeat-y;}.qing001 .nbw-ryt .left{background:url(/newpage/images/qingtheme/qing001/blogdetail_ftbg.png) bottom left no-repeat;}.qing001 .nbw-ryt .left .lcnt{width:100%;padding:0;margin:0;background:url(/newpage/images/qingtheme/qing001/blogdetail_ttlbg.png) 0 0 no-repeat;}.qing001 .nbw-ryt .left .mcnt{padding:0 30px;}.qing001 .nbw-ryt .left .nbw-bitm{padding:0;}.qing001 .nb-mt{display:none;}.qing001 .nbw-ryt .left .top{display:none;}.qing001 .nbw-ryt .left .nbw-bitm .title{height:31px;padding:30px 0 46px 3px;margin:0;}.qing001 .nbw-ryt .left .nbw-bitm .title .tcnt{color:#fffadc;font-size:24px;}.qing001 .nbw-ryt .left .nbw-bitm .tdep{padding-top:6px;}.qing001 .comment .case{padding-bottom:40px;}.m-3 .article .douban{float:left;width:200px;margin:0 10px 10px 0;font-size:12px;}.m-3 .article .douban .field{padding-top:5px;}.m-3 .article .douban .field .dbyinyue{width:10px;height:8px;border-width:0;}.m-3 .article .douban img{max-width:100%;width:100%;border-color:#e9e9e9;display:inline-block;border-width:1px;border-style:solid;}.m-3 .article-1 .douban{float:right;width:200px;margin:0 3px 10px 10px;}.m-3 .article-2 .douban{float:left;width:250px;margin:0 -250px 0 0;}.m-3 .article-2 .blog{margin-left:270px;}.m-3 .article-2 .blogc{width:99%;overflow:hidden;}.m-3 .article-3 .douban{float:right;width:250px;margin:0 3px 0 -250px;}.m-3 .article-3 .blog{margin-right:270px;}.m-3 .article-3 .blogc{width:99%;overflow:hidden;}.m-3 .vote_star{overflow:visible;}.m-3 .rateword{display:none;left:88px;width:37px;top:-2px;position:absolute;line-height:23px;}.m-3 .star_d0 .rateword0{display:inline;}.m-3 .star_d1 .rateword1{display:inline;}.m-3 .star_d2 .rateword2{display:inline;}.m-3 .star_d3 .rateword3{display:inline;}.m-3 .star_d4 .rateword4{display:inline;}.m-3 .star_d5 .rateword5{display:inline;}.m-3 .nbw-act .blogsep{margin:0 2px}.m-3 .zihao{position:relative;cursor:default;}.m-3 .zihaoshow{position:absolute;width:26px;top:-57px;left:-3px;padding:0 0 3px;line-height:18px;}.m-3 .zihaoshow span{display:block;text-align:center;cursor:pointer;}.m-3 .zihaoc{border-style:solid;border-width:1px;}.m-3 .mbga{margin-bottom:12px;position:relative;}.m-3 .mbga a{margin-left:20px;}.m-3 .mbgai{position:absolute;top:-1px;width:17px;background:url(/newpage/images/microblog.png?1) no-repeat;_background:none transparent;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://b2.bst.126.net/newpage/images/microblog.png');_zoom:1;}.m-3 .mingxing{width:18px;background-position:-43px -80px;}.m-3 .xinxing{width:18px;background-position:-81px -80px;}.m-3 .darendesc{padding:7px 15px;margin-top:10px;line-height:18px;background:#efeae7;vertical-align:middle;}.m-3 .js-cmt-noavatar .nbw-cmt .nbw-fce{display:none;}.m-3 .js-cmt-noavatar .nbw-cmt .thde{padding-left:8px;margin-left:0;}.m-3 .js-cmt-noavatar .nbw-cmt .reps .thde{margin-left:55px;}.m-3 .toLofter{cursor:pointer;position:absolute;bottom:5px;width:112px;height:22px;background:url(/newpage/images/publishtolofter/tolofter.png?v=20130909) 0 0 no-repeat;text-indent:-9999px;}.m-3 .nbw-ryt .left .lcnt{padding-right:20px;}.m-3 .edt-cmt{width:auto;}.m-3 .comment .publish .edt-cmt{width:auto;}#blog-163-com .m-3 .comment .nbw-cmt .cnt{width:auto;}#blog-163-com .m-3 .comment .nbw-cmt .nbw-cmt .cnt{width:auto;}.m-3 .nbw-cmt .nbw-cmt{padding:20px 5px 1px 0;}.m-3 .nbw-cmt .op{height:18px;line-height:18px;margin-bottom:18px;}.m-3 .nbw-ryt .left .nbw-bitm .title{margin:34px 0 10px;line-height:normal;}.m-3 .nbw-ryt .left .nbw-bitm .title .tcnt{line-height:38px;}.m-3 .nbw-ryt .left .nbw-bitm .tdep{margin-bottom:25px;}.m-3 .comment .publish{padding:0 5px 10px 0;margin:20px 0 0 0;}.m-3 .nbw-sdt .miniBlogArea{bottom:12px;}.m-3 .nbw-sdt .edt .zbtn{height:40px;line-height:40px;}.m-3 .nbw-sdt .edt .zbtn .zfce{top:10px;} </style>
  
  <link href="/newpage/prettycode/prettify.css" type="text/css" rel="stylesheet" />
  </head>
<body onload="prettyPrint()" id="blog-163-com" class="nb-body nb-inr nb-prv">
  <!--[if lte IE 6]><div id="blog-163-com-ie6bodywrap" class=""><![endif]-->
    <!--[if lte IE 6]><div id="blog-163-com-ie6body" class="nb-body"><![endif]-->

<div class="nb-nbar clearfix" id="blog-163-com-topbar">
  <div class="pl fl clearfix">
  <div id="" class="nbw-im fl im im0">
    <a  rel="nofollow"  class="lbl bd ia noul " href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.163.com/" target="_blank" hidefocus="true"><span class="tx">网易</span><span class="iblock icn0 icn0-421">&nbsp;</span></a><div class="nbw-tcd box-shadow bd">
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://news.163.com/" >
            新闻
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://t.163.com/" >
            微博
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://email.163.com/" >
            邮箱
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/" >
            相册
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yuedu.163.com/" >
            阅读
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.youdao.com/" >
            有道
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/pp/square/" >
            摄影
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://aipai.163.com?from=163blog" >
            爱拍
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://quan.163.com/?from=blogdh" >
            优惠券
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://note.youdao.com/?vendor=163blog" >
            云笔记
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://fm.163.com/?fmblogzx0628" >
            闪电邮
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://m.123.163.com/?frombkcp" >
            手机邮
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yxp.163.com/" >
            印像派
          </a>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://61.163.com/?from=blogxiala" >
            网易识字
          </a>
        <div class="sep bd space">&nbsp;</div>
          <a  rel="nofollow"   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://sitemap.163.com/" >
            更多
          </a>
        
    </div>
  </div>

    <span style="display:none;margin-left:0;" class="fl iblock space icn1 icn1-4">&nbsp;</span>

  <div id="" class="nbw-im fl im im10">
    <a  class="lbl bd ia noul " href="http://blog.163.com/?frompersonalbloghome" target="_blank" hidefocus="true"><span class="tx">博客</span><span class="iblock icn0 icn0-421">&nbsp;</span></a><div class="nbw-tcd box-shadow bd">
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/services/wapblog.html?frompersonalbloghome" >
            手机博客
          </a>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/clone/clone.html?frompersonalbloghome" >
            博客搬家
          </a>
          <a   target="_blank"  class="itm noul youcai " hidefocus="true" href="http://blog.163.com/vip.do?frompersonalbloghome" >
            博客VIP服务
          </a>
        <div class="sep bd space">&nbsp;</div>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/blog_admin/blog/static/721279201082863728829/?frompersonalbloghome" >
            LiveWriter写博
          </a>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/blog_admin/blog/static/721279201092713253500/?frompersonalbloghome" >
            word写博
          </a>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/services/mailblog.html?frompersonalbloghome" >
            邮件写博
          </a>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/services/emsblog.html?frompersonalbloghome" >
            短信写博
          </a>
        <div class="sep bd space">&nbsp;</div>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/showMultiUser.do?frompersonalbloghome" >
            群博客
          </a>
          <a   target="_blank"  class="itm noul youcai " hidefocus="true" href="http://blog.163.com/BLOG_YOUCAI/" >
            博客油菜地
          </a>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/ht/?frompersonalbloghome" >
            博客话题
          </a>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/hot/history/?frompersonalbloghome" >
            博客热点
          </a>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://q.163.com/#home?frompersonalbloghome" >
            博客圈子
          </a>
          <a   target="_blank"  class="itm noul  " hidefocus="true" href="http://blog.163.com/findFriend.do?type=5?frompersonalbloghome" >
            找朋友
          </a>
        
    </div>
  </div>


    <div class="nbw-im fl im1 im explore"><a class="lbl bd ima spy" href="http://blog.163.com/public/explore/?frompersonalbloghome">发现</a></div>
    <div class="nbw-im fl im1 im bloggroup"><a class="lbl bd ima spy" href="http://blog.163.com/g/?frompersonalbloghome">小组</a></div>
    <div class="nbw-im fl im1 im customtheme"><a class="lbl bd ima spy" href="http://blog.163.com/public/theme/?frompersonalbloghome">风格</a></div>
    <div class="nbw-im fl im1 im seebyway"><a rel="nofollow" title="随便看看" class="lbl bd ima spy" href="http://blog.163.com/randomUser.do"><span>&nbsp;</span></a></div>

    <span style="display:none;" class="fl iblock space icn1 icn1-4">&nbsp;</span>
    <div id="topbar_randShowArea" class="fl">
      <div class="nbw-im fl im1 im randtag phide"><a target="_blank" class="bd ima moveblog randshow" href="http://istyle.163.com" onclick="window.open('http://istyle.163.com/?act=idpistyle_20120604_01');return false;">网易真人搭配社区iStyle</a></div>
<div class="nbw-im fl im1 im randtag phide"><a target="_blank" class="bd ima moveblog randshow" href="http://www.lofter.com/app">下载最文艺的手机博客APP&gt;</a></div>
<div class="nbw-im fl im1 im randtag phide"><a target="_blank" class="bd ima moveblog randshow" href="http://www.lofter.com/app">下载最文艺的手机博客APP&gt;</a></div>
<div class="nbw-im fl im1 im randtag phide"><a target="_blank" class="bd ima moveblog randshow" href="http://www.lofter.com/app">下载最文艺的手机博客APP&gt;</a></div>
    </div>
  </div>
  <div class="fr pr clearfix">
    <div id="topbar_loginAndReg" class="fr">
      <a rel="nofollow" style="margin-left:10px;color:#ff7700;" class="iblock fr ima" href="http://reg.163.com/reg/reg.jsp?product=blog&url=http://blog.163.com/ntesRegBlank.html&loginurl=http://blog.163.com/" target="_blank">创建博客</a>
      <a rel="nofollow" class="iblock fr ima ztag" href="#">登录</a>
      <span class="fr iblock space icn1 icn1-4 spx">&nbsp;</span>
      <div id="topbar_followArea" class="nbw-im fr"><span class="lbl bd ima followit fl ztag"><span class="fl addicon">&nbsp;</span><span class="fl">加关注</span></span></div>
    </div>
  </div>
</div>
<script type="text/javascript">
  (function(){
      var e = document.getElementById('blog-163-com-main');
      if(!!e) e.parentNode.insertBefore(document.getElementById('blog-163-com-topbar'),e);
      e = document.getElementById('blog-notice-email');
      if(!!e) window.setTimeout(function(){e.style.display='';},50);
  })()
</script>
<div class="blogtoptips phide" id="blog-163-com-toptips">
 <div class="blogtoptipswrap">
    <div id="newbulletinstip" class="newbulletinstip phide">
    <a class="lnknews fc03 m2a tiptag phide" href="" target="_blank"></a><span class="txtnews tiptag phide"></span>&nbsp;&nbsp;&nbsp;<a class="fc03 ul nextorprevnews tiptag phide" href="" hidefocus="true">显示下一条</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a class="fc03 ul close tiptag" href="" hidefocus="true">关闭</a>
  </div>
 </div>
 	<div id="sinaoauthtip" class="sinaoauthtip phide">
    	<span style="">温馨提示！由于新浪微博认证机制调整，您的新浪微博帐号绑定已过期，请重新绑定！</span><a rel="nofollow" class="fc03 noul iblock" href="http://yyq2007aa.blog.163.com/settings/?fromnewcenter#m=6">立即重新绑定新浪微博》</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a class="fc03 iblock close" href="">关闭</a>
  	</div>
    <div id="$_faxiantip" class="faxiantip phide">
      <div>
	    <a class="m2a iblock" href="http://blog.163.com/public/explore/?fromblogbanner" target="_blank"></a>
	    <span class="faxiantag m2a"></span>
      </div>
    </div>
    <div id="$_guanggaotip" class="guanggaotip phide">
      <div>
	    
	    <span class="guanggaotag m2a"></span>
      </div>
    </div>
    <div id="$_lofterInviteTip" class="lofterInviteTip phide">
      <div>
	    <a class="m2a iblock" href="http://www.lofter.com/invite/163blog/?email=" target="_blank"></a>
	    <span class="lofterInviteTag m2a"></span>
      </div>
    </div>
</div>  <div class="nb-wrap wsy" id="blog-163-com-main"><div class="nb-are nb-top">
  <div class="wkg h" id="blog-163-com-banner">
    
    <div class="t">
      <h1 class="n c"><span class="ztag pre">流星永恒的博客</span></h1>
      <p class="d c"><span class="ztag pre">JSF,Facelets,Rich(Prime)Faces,和java的笔记</span></p>
    </div>
    <div class="f h ztag"></div>
    <a class="x" hidefocus="true" target="_blank" href="#"><span class="xx ztag"></span></a>
  </div>
</div><div class="nb-are nb-nav">
  <div class="wkg">
    <div class="c h">
      <h2>导航</h2>
      <ul class="noul clearfix">
                
	        <li class="w w0">
	          <a class="i i0 fc01 h" hidefocus="true" href="http://yyq2007aa.blog.163.com/">首页</a>
	        </li>
	        <li class="w w1 selected">
	          <a class="i i1 fc01 h" hidefocus="true" href="http://yyq2007aa.blog.163.com/blog/">日志</a>
	        </li>
	        <li class="w w2">
	          <a class="i i2 fc01 h" hidefocus="true" href="http://yyq2007aa.blog.163.com/album/">相册</a>
	        </li>
	        <li class="w w3">
	          <a class="i i3 fc01 h" hidefocus="true" href="http://yyq2007aa.blog.163.com/music/">音乐</a>
	        </li>
	        <li class="w w4">
	          <a class="i i4 fc01 h" hidefocus="true" href="http://yyq2007aa.blog.163.com/collection/">收藏</a>
	        </li>
	        <li class="w w5">
	          <a class="i i5 fc01 h" hidefocus="true" href="http://yyq2007aa.blog.163.com/friends/">博友</a>
	        </li>
	        <li class="w w6">
	          <a class="i i6 fc01 h" hidefocus="true" href="http://yyq2007aa.blog.163.com/profile/">关于我</a>
	        </li>
      </ul><!--
 --></div>
    <div class="l h">&nbsp;</div>
    <div class="r h">&nbsp;</div>
  </div>
</div>  <div class="nb-are nb-smt"><div class="wkg h space"><div class="l h">&nbsp;</div><div class="r h">&nbsp;</div><div class="c h">&nbsp;</div></div></div>
  <div class="nb-are nb-cnt">
    <div class="wkg">
      <div class="c wc h clearfix " id="blog-163-com-container">
  <div class="nb-mdl lcr m-3 " id="-3">
  <div class="nb-mt lcr th fc02">
    <div class="c tc th lcr"><h2 class="thide nb-jsc mdl_t_t">日志</h2></div>
    <div class="r tm th nb-jsc"></div>
    <div class="l tl th">&nbsp;</div>
    <div class="r tr th">&nbsp;</div>
  </div>
    <div class="nb-mc lcr">
      <div class="c cc lcr nb-jsc"><script>
function g_onSuggestedReadingImgLoad(_img){
    var image = new Image();
    image.src = _img.src;
    var _width = 90;
    var _height = 90;
    if(image.width > image.height){
    	_img.style.marginLeft = -Math.floor((image.width*(_height/image.height)-_width)/2)+'px';
    	_img.style.height = _height+'px';
    }else {
    	_img.style.width = _width+'px';
    	_img.style.marginTop = -Math.floor((image.height*(_width/image.width)-_height)/2)+'px';
    }
    _img.style.display = 'block';
}
</script>
<div class="nbw-ryt ztag clearfix js-auto-098">
  <div class="right bdwl bds0 bdc0"><div class="cnt ztag"></div></div>
  <div class="left">
     <div class="lcnt bdwr bds0 bdc0 ">
      <div id="$_newOldBlogLinkTopDiv" class='top fc03 bdwb bdc0 bds2 clearfix'>
     </div>
     <div class="mcnt ztag">
      <div class="nbw-bitm bdwb bds2 bdc0 ">
        <div class="multicntwrap">
	      <div class="multicnt">
	      	<div>
		      <h3 class="title pre fs1"><span class="tcnt">Spring to Java EE C A Migration Experience(收藏)</span>&nbsp;&nbsp;<span class="bgc0 fc07 fw0 fs0"></span></h3>
		      <p class="tdep clearfix nbw-act fc06" style="line-height:20px;">
		        <span class="pleft">
		          
		          <span class="blogsep">2012-05-29 21:18:43</span><span class="blogsep">|&nbsp;&nbsp;分类：</span>
		          <a class="fc03 m2a" href="http://yyq2007aa.blog.163.com/blog/#m=0&t=1&c=fks_084071093083080069087080095095080082080075085080086074" title="javaEE">javaEE</a>
		          <span class="blogsep phide" id="$_blogTagTitle">|&nbsp;&nbsp;标签：</span><span class="fc03 phide" id="$_blogTagInfo"></span>
		        </span>
		        <span class="pright fc07 ztag"><span class="blogsep">|</span><span class="zihao fc03" id="$_fontswitch">字号<span class="zihaoshow  phide" id="$_fontsTypes"><span class="zihaoc bdc0"><span class="stag"></span><span class="fc04 stag">大</span><span  class="fc04 stag" >中</span><span  class="fc04 stag">小</span></span></span></span></span><span class="pright pnt fc03" id="$_blog_subscribe"><span class="iblock icn0 icn0-919">&nbsp;</span><a class="m2a">订阅</a></span>
		      </p>
		    </div>
	      </div>
        </div>

        <div>
        
        </div>

        <div class="nbw-blog-start"></div>
        <div class="bct fc05 fc11 nbw-blog ztag">  <P>该文是PrettyFaces的Leader，让我们看看牛人对Java EE的理解，看了后忍不住收藏了。</P>  <P>网易的编辑器太垃圾了，建议大家看原文。</P>  <P>&nbsp;</P>  <P>原文地址：<A rel="nofollow" href="http://ocpsoft.org/java/spring-to-java-ee-a-migration-guide-cdi-jsf-jpa-jta-ejb/" >http://ocpsoft.org/java/spring-to-java-ee-a-migration-guide-cdi-jsf-jpa-jta-ejb/</A></P>  <P>So Java EE 6 is out, and you’ve decided to give it a go. You’re trying to port an existing application over to the new stack (or are trying to create a new one for the first time,) but exceptions are bursting through the seams and you just can’t seem to get things to work. If you’re familiar with Spring and Hibernate (with all the joy that is <A rel="nofollow" href="http://www.google.com/search?q=OpenSessionInView" >OpenSessionInView</A> or <CODE><FONT face="NSimsun" >OpenSessionInConversation</FONT></CODE>,) more than likely the problems you’re having are related to the Java Persistence API (<CODE><FONT face="NSimsun" >JPA</FONT></CODE>), combined with Enterprise Java Beans (<CODE><FONT face="NSimsun" >EJB</FONT></CODE>). Contexts and Dependency Injection (<CODE><FONT face="NSimsun" >CDI</FONT></CODE>) should be a familiar face if coming from Spring, but things are subtly different in the world of Java EE.<SPAN id="more-1589" ></SPAN><BR></P>  <P>The trouble you’re having, however, is most likely due to the fact that you’re actually trying to solve problems that don’t need to be solved. When I first made the switch to Java EE 6 from Spring C for <A rel="nofollow" href="http://scrumshark.com/" >my own personal project</A> C Spring’s dozens of extensions, and using Hibernate Object Relational Mapping (<CODE><FONT face="NSimsun" >ORM</FONT></CODE>) directly, managing transactions myself, I was trying to do things “the Spring way,” in other words C configuring everything up the wazoo, but let me try to explain some things for you that should help clear the fuzz of attempting to migrate to Java EE; they are things I ran in to, and would likely happen to others as well.</P>  <DIV>  <DIV>Before you start, go ahead and download your application server of choice, which at this point should probably be one of either: <A rel="nofollow" href="http://www.jboss.org/jbossas/downloads/" >JBoss AS 7</A>, or GlassFish 3.x. (I recommend AS7 not because I have to, but because I believe it is currently the top of the line app-server.)</DIV></DIV>  <H2><A name="section-0" rel="nofollow" ></A><SPAN id="section-0" >The biggest difference</SPAN> you’ll find is, “Java EE already does that for you.”</H2>  <P>Nearly every application requires the same set of basic features: persistence, transactionality, (dependency injection is typically assumed at this point,) and a web-tier view-layer or web-services. The first thing I have to say is: “Don’t freak out when I say Enterprise Java Beans (EJB)” C they’ve truly become a system worthy of attention, and if you’re going to take advantage of the Java EE stack, you’re going to want them around; EJB 3.1 today is miles apart from what it once was, can be used standalone in WARs, and requires just one annotation to configure C soon, with JBoss AS 7, Enterprise Java Beans may simply be an extension built on CDI, like everything else.</P>  <P>To start, I’ll review some of the problems I encountered and solved during my first transition between the Spring and Java EE 6 technologies; most C if not all C of these were due to my lack of technical understanding, the mindsets are truly very different; the results are striking.</P>  <H3><A name="section-1" rel="nofollow" ></A><SPAN id="section-1" >Configuring the System</SPAN> C “It’s all just XML in the end.”</H3>  <P>This one is simple. Where Spring has <CODE><FONT face="NSimsun" >/WEB-INF/applicationContext.xml</FONT></CODE> files of various types, Java EE has various distinct configuration files for each API in the framework WAR. Some of these files are required to activate the API, but some are not. The following chart overviews the most common of these configuration files C there is more to Java EE, but chances are these are all you’ll need to get started. Be careful! If these files are in the wrong place, you will <EM>not</EM> have a working system!</P>  <P>  <TABLE border="1" width="100%"  >  <THEAD>  <TR>  <TH width="33%"  ><A name="config" rel="nofollow" ></A>Java EE API</TH>  <TH width="33%"  >Config File Location</TH>  <TH width="33%"  >Required to Enable</TH></TR></THEAD>  <TBODY>  <TR vAlign="top" >  <TD width="33%"  >Java Persistence API</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/META-INF/persistence.xml</FONT></CODE></TD>  <TD width="33%"  >Yes</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >Enterprise Java Beans WAR</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/WEB-INF/ejb-jar.xml</FONT></CODE></TD>  <TD width="33%"  >No</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >Java Server Faces</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/WEB-INF/faces-config.xml</FONT></CODE></TD>  <TD width="33%"  >No</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >Contexts &amp; Dependency Injection</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/WEB-INF/beans.xml</FONT></CODE></TD>  <TD width="33%"  >Yes</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >Web Configuration</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/WEB-INF/web.xml</FONT></CODE></TD>  <TD width="33%"  >No</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >JAX-RS (REST Web Services)</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/WEB-INF/web.xml</FONT></CODE></TD>  <TD width="33%"  >No</TD></TR></TABLE></P>  <P>You should also know that most of these files require some sort of schema, or “XML header” that tells the Application Server (JBoss Application Server, GlassFish, Etc…) which version of the technology to use, since most APIs attempt some level of backwards compatibility. This is similar to including new schemas in Spring’s <CODE><FONT face="NSimsun" >applicationContext.xml</FONT></CODE>.</P>  <P>EJBs can be defined via annotations alone, and require no configuration file in order to enable them. JAX-RS is similar, since no configuration file is required when using a Java EE 6 certified Application Server such as JBoss Application Server, everything can be specified through annotations once it is enabled.</P>  <H4>Configuration of modules in JAR files:</H4>  <P>One of the greatest features of Java EE APIs is the ability to break application code into separate reusable JAR files C where each individual JAR contributes configuration and code to the system they are included in; for instance, you might run multiple applications for your business, but each one must have the same data access providers. You’d create a shared domain-model JAR file and include it in each application. All the configuration would be contained in that JAR, and would be done using the same set of configuration files, placed in the JAR’s <CODE><FONT face="NSimsun" >META-INF</FONT></CODE> directory:</P>  <P>  <TABLE border="1" width="100%"  >  <THEAD>  <TR>  <TH width="33%"  ><A name="config.modular" rel="nofollow" ></A>Java EE API</TH>  <TH width="33%"  >Config File Location</TH>  <TH width="33%"  >Required to Enable</TH></TR></THEAD>  <TBODY>  <TR vAlign="top" >  <TD width="33%"  >Java Persistence API</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/META-INF/persistence.xml</FONT></CODE></TD>  <TD width="33%"  >Main app must include own config file.</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >Enterprise Java Beans WAR</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/META-INF/ejb-jar.xml</FONT></CODE></TD>  <TD width="33%"  >No</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >Java Server Faces</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/META-INF/faces-config.xml</FONT></CODE></TD>  <TD width="33%"  >No</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >Contexts &amp; Dependency Injection</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/META-INF/beans.xml</FONT></CODE></TD>  <TD width="33%"  >Yes</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >Web Configuration</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/META-INF/web-fragment.xml</FONT></CODE></TD>  <TD width="33%"  >No</TD></TR>  <TR vAlign="top" >  <TD width="33%"  >JAX-RS (REST Web Services)</TD>  <TD width="33%"  ><CODE><FONT size="3" face="NSimsun" >/META-INF/web-fragment.xml</FONT></CODE></TD>  <TD width="33%"  >No</TD></TR></TABLE></P>  <P>Note that some of the file names are different from those that are used in the main application itself.</P>  <H4>The Application Server Configuration</H4>  <P>In addition to the application configuration, one of the most notable differences between Spring and Java EE is that you actually need to know how to use the application <EM>server </EM>itself. Spring replaces application server configuration with application configuration (sometimes more convenient, sometimes less convenient, but the same result in the end.) In order to use JPA and transactions (covered later,) you will want to know how to use the transactional data-source feature of the Java Enterprise Application Server, since it makes setting up transactions as simple as writing a plain Java class with an annotation.</P>  <P>Keep in mind that each of these configuration files may have a different syntax and format, since they are produced by different companies. These files should be used to configure settings that must exist in order for the application to run, and should be considered a natural extension to the Java EE module configuration files.</P>  <DIV>  <DIV>JBoss Application Server Documentation can be found <A rel="nofollow" href="https://docs.jboss.org/author/display/AS7/Documentation" >here, online</A>.</DIV></DIV>  <P>considered a natural extension to the Java EE module configuration files.</P>  <P>  <TABLE border="1" width="100%"  >  <THEAD>  <TR>  <TH width="50%"  >Container</TH>  <TH width="50%"  >Configuration File</TH></TR></THEAD>  <TBODY>  <TR vAlign="top" >  <TD width="50%"  >JBoss AS 6 C General Config</TD>  <TD width="50%"  ><CODE><FONT size="3" face="NSimsun" >/WEB-INF/jboss-web.xml</FONT></CODE></TD></TR>  <TR vAlign="top" >  <TD width="50%"  >JBoss AS 6 C Data Source Config</TD>  <TD width="50%"  ><FONT size="3" ><CODE><FONT face="NSimsun" >${JBOSS_HOME}/server/default/deploy/*-ds.xml</FONT></CODE> (must be placed in the actual JBoss server deploy directory, more info can be found </FONT><A rel="nofollow" href="http://docs.jboss.org/jbossas/docs/Installation_And_Getting_Started_Guide/5/html/Using_other_Databases.html#Using_other_Databases-DataSource_Configuration_Files" ><U><FONT color="#0066cc" >here</FONT></U></A>.)</TD></TR>  <TR vAlign="top" >  <TD width="50%"  >Sun GlassFish v3 AS C General Config</TD>  <TD width="50%"  ><CODE><FONT size="3" face="NSimsun" >/WEB-INF/sun-web.xml</FONT></CODE></TD></TR>  <TR vAlign="top" >  <TD width="50%"  >Sun GlassFish v3 AS C Data Source Config</TD>  <TD width="50%"  >You must use the <FONT size="3" ><CODE><FONT face="NSimsun" >asadmin</FONT></CODE> command to process a sun-resources.xml, use <CODE><FONT face="NSimsun" >asadmin</FONT></CODE> to explicitly define a data source, or create a data source in the web-admin console.</FONT></TD></TR></TABLE></P>  <P>If your application depends on a transactional data source, this is the place to define it C preventing manual configuration of the application server, which can be a very repetitive, monotonous task. This configuration usually only needs to happen once per-server, and allows you to keep database passwords secret, data sources controlled and separate, and JMS queues centralized; though, if you want a standalone application/data-source configuration, then you should think about using these custom configuration files.</P><A name="section-2" rel="nofollow" ></A>  <H2 id="section-2" >Contexts &amp; Dependency Injection for Java C aka Beans</H2>  <P>Where spring has <CODE><FONT face="NSimsun" >@Autowired</FONT></CODE>, Java EE (CDI to be more specific) has <CODE><FONT face="NSimsun" >@Inject</FONT></CODE>. The parallel is really quite straight-forward, since every class in a WAR or JAR file (that has a beans.xml file!) is automatically a bean in CDI, any class can be provided or scoped using dependency injection, just like a bean that would be defined in <CODE><FONT face="NSimsun" >applicationContext.xml</FONT></CODE> in a Spring application.</P>  <P><EM>Before we get started, though C remember that you need to create an empty <CODE><FONT face="NSimsun" >/WEB-INF/beans.xml</FONT></CODE> file, or your system will not start the CDI container.</EM> Technically, you can only inject beans that are themselves in a bean archive (not just any class). However, you can use a producer method to pull in a class from a non-bean archive and make it a bean (or you can use <A rel="nofollow" href="http://docs.jboss.org/seam/3/xml-config/latest/reference/en-US/html_single/" >Seam XML</A> to add beans that aren’t in an archive that has a <CODE><FONT face="NSimsun" >beans.xml</FONT></CODE> file.)</P>  <DIV>A simple CDI bean</DIV><PRE id="code_snippit_1_total_" ><CODE><SPAN><SPAN>public</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>class</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>UserCredentialsBean</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>{</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>}</SPAN></SPAN></CODE></PRE>  <P>Wait, that’s it? Well, you have a few more options when it comes to managing these beans and deciding how long they will “live,” or how long each bean instance will remain active.</P>  <P>Every bean can be assigned to a “scope,” which is really defining the context in which the bean is relevant. For example, it doesn’t make sense for a logged-in user’s authentication credentials (username/password) to be retained longer than that user’s session, so you would place the bean containing that information in the Session Scope (which is just a nice, clean way of saying that we are storing that information in the <CODE><FONT face="NSimsun" >HttpSession</FONT></CODE> object, and when the <CODE><FONT face="NSimsun" >HttpSession</FONT></CODE> object dies, so does everything in Session Scope for that user.) This is done using the <CODE><FONT face="NSimsun" >@SessionScoped</FONT></CODE> annotation.</P>  <DIV>A session scoped bean</DIV><PRE id="code_snippit_2_total_" ><CODE><SPAN><SPAN>@SessionScoped</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>public</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>class</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>UserCredentialsBean</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>{</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>}</SPAN></SPAN></CODE></PRE>  <P>In reality we would probably leave the details of authenticating users up to a framework like <A rel="nofollow" href="http://seamframework.org/Seam3" >Seam Security</A>, but just consider this as an example.</P>  <P>There are also several more built-in scopes:</P>  <P>  <TABLE border="1" width="100%"  >  <THEAD>  <TR>  <TH width="25%"  >Annotation</TH>  <TH width="55%"  >Lifespan</TH>  <TH width="20%"  >Contextual Object</TH></TR></THEAD>  <TBODY>  <TR vAlign="top" >  <TD width="25%"  ><CODE><FONT size="3" face="NSimsun" >@RequestScoped</FONT></CODE></TD>  <TD width="55%"  >From the beginning to the end of each individual HTTP request.</TD>  <TD width="20%"  ><CODE><FONT size="3" face="NSimsun" >HttpServletRequest</FONT></CODE></TD></TR>  <TR vAlign="top" >  <TD width="25%"  ><CODE><FONT size="3" face="NSimsun" >@ConversationScoped</FONT></CODE></TD>  <TD width="55%"  >Begins when the request begins and ends when the request ends and the conversation is not in a long-running state. Calling <FONT size="3" ><CODE><FONT face="NSimsun" >conversation.begin()</FONT></CODE> states intent for the scope to perpetuate to additional requests. Calling <CODE><FONT face="NSimsun" >conversation.end()</FONT></CODE> marks the conversation to end on the when the current request ends C but note that if the session is terminated, all active conversations will also be terminated.</FONT></TD>  <TD width="20%"  ><CODE><FONT size="3" face="NSimsun" >HttpSession</FONT></CODE></TD></TR>  <TR vAlign="top" >  <TD width="25%"  ><CODE><FONT size="3" face="NSimsun" >@SessionScoped</FONT></CODE></TD>  <TD width="55%"  >From the first request starting when <FONT size="3" ><CODE><FONT face="NSimsun" >httpServletRequest.getSession()</FONT></CODE> method is called, to the last request when <CODE><FONT face="NSimsun" >httpSession.invalidate()</FONT></CODE> is called.</FONT></TD>  <TD width="20%"  ><CODE><FONT size="3" face="NSimsun" >HttpSession</FONT></CODE></TD></TR>  <TR vAlign="top" >  <TD width="25%"  ><CODE><FONT size="3" face="NSimsun" >@ApplicationScoped</FONT></CODE></TD>  <TD width="55%"  >For the entire duration of the running application; from post-server startup, to pre-shutdown.</TD>  <TD width="20%"  ><CODE><FONT size="3" face="NSimsun" >ServletContext</FONT></CODE></TD></TR>  <TR vAlign="top" >  <TD width="25%"  ><FONT size="3" ><CODE><FONT face="NSimsun" >@Dependent</FONT></CODE> (default)</FONT></TD>  <TD width="55%"  >Controlled by the object in which it was @Injected. If <FONT size="3" ><CODE><FONT face="NSimsun" >@Injected</FONT></CODE> into a <CODE><FONT face="NSimsun" >@SessionScoped</FONT></CODE> bean, for example, the <CODE><FONT face="NSimsun" >@Dependent</FONT></CODE> bean will also be <CODE><FONT face="NSimsun" >@SessionScoped</FONT></CODE>. This means that there can be multiple separate instances of the same <CODE><FONT face="NSimsun" >@Dependent</FONT></CODE> bean that are <CODE><FONT face="NSimsun" >@RequestScoped</FONT></CODE>, or any other scope for that matter. This is similar to, but not quite the same as Spring’s <CODE><FONT face="NSimsun" >@Prototype</FONT></CODE> scope.</FONT></TD>  <TD width="20%"  >*** The bean into which this bean was injected.</TD></TR></TABLE></P>  <P>Other custom scopes can be created as needed, and some frameworks such as the <A rel="nofollow" href="http://docs.jboss.org/seam/3/faces/reference/snapshot/en-US/html_single/" ><U><FONT color="#0066cc" >Seam Faces Module</FONT></U></A> even provide additional scopes for you. But let’s look at how we inject an instance of our <CODE><FONT face="NSimsun" >UserCredentialsBean</FONT></CODE> into another bean.</P>  <DIV><STRONG>Injecting one bean into another</STRONG></DIV><PRE class="prettyprint" ><P>public class AuthorizationBean<BR>{<BR>&nbsp;&nbsp;&nbsp; @Inject<BR>&nbsp;&nbsp;&nbsp; private UserCredentialsBean credentials;<BR>} </P></PRE><PRE>These are the basics; no configuration required. We can also scope the <CODE><FONT face="NSimsun" >AuthorizationBean</FONT></CODE> in order to control how long that lives as well, but we have a very subtle issue going on here.</PRE>  <DIV><STRONG>Scoping a bean to control lifecycle</STRONG></DIV>  <DIV><PRE class="prettyprint" ><P> @ApplicationScoped<BR>public class AuthorizationBean<BR>{<BR>&nbsp;&nbsp;&nbsp; @Inject<BR>&nbsp;&nbsp;&nbsp; private UserCredentialsBean credentials;<BR>}</P></PRE><PRE>We are injecting a <CODE><FONT face="NSimsun" >@SessionScoped</FONT></CODE> bean into an <CODE><FONT face="NSimsun" >@ApplicationScoped</FONT></CODE> bean, which in Spring, might cause two problems. We’ll see, though, that these problems have already been solved in Java EE:</PRE></DIV>  <OL>  <LI>In Spring, when the the <CODE><FONT face="NSimsun" >AuthorizationBean</FONT></CODE> is created, there may not be any active user sessions, and the container may not be able to create the <CODE><FONT face="NSimsun" >UserCredentialsBean</FONT></CODE> dependency C resulting in a nasty exception.   <P>In CDI, however, the container knows that it will not be able to get a <CODE><FONT face="NSimsun" >@SessionScoped</FONT></CODE> object at that point in the life-cycle, so it waits until the credentials are accessed until it attempts to get an instance of <CODE><FONT face="NSimsun" >UserCredentialsBean</FONT></CODE>. If you access that object outside of the active scope, you’ll still get an exception, but that’s a different problem, one that can easily be solved with good application design. (In other words, “you shouldn’t be doing that.”)</P>  </LI><LI>In Spring, when the <CODE><FONT face="NSimsun" >@ApplicationScoped AuthorizationBean</FONT></CODE> is created, assuming that it can get a hold of our <CODE><FONT face="NSimsun" >@SessionScoped UserCredentialsBean</FONT></CODE>, the instance that is injected will be the instance that remains for the life of the bean into which it assigned. This means that the same <CODE><FONT face="NSimsun" >UserCredentialsBean</FONT></CODE> will be used for <EM>all </EM>invocations and processing in our single instance of the <CODE><FONT face="NSimsun" >AuthorizationBean</FONT></CODE>, and that’s most likely not what we want, there would be some pretty nasty bugs (users sharing permissions, etc.) The problem can be solved by turning the bean into a “dynamic-proxy,” in the Spring configuration.   <P>In CDI, however, this is again taken care of us already, since the container knows that <CODE><FONT face="NSimsun" >@SessionScoped</FONT></CODE> beans may not live as long as an <CODE><FONT face="NSimsun" >@ApplicationScoped</FONT></CODE> bean, and that there may be more than one active Session. CDI will actually find the correct <CODE><FONT face="NSimsun" >@SessionScoped UserCredentialsBean</FONT></CODE>, and use that when performing operations on the parent bean, automatically making sure that the right objects are used. Sweet!</P></LI></OL><A name="section-3" rel="nofollow" ></A>  <H2 id="section-3" >Interacting with Beans through Java APIs</H2>  <P>If you are trying to get a handle to a bean while working in a part of the system that does not support dependency injection for some reason (<CODE><FONT face="NSimsun" >@Inject</FONT></CODE> in CDI,<CODE><FONT face="NSimsun" > @Autowired</FONT></CODE> in Spring), it’s sometimes required to ask the framework for a bean instance manually.</P>  <P>In Spring you can ask for an instance of a bean (an object that you can actually use to do some work,) using Java APIs C this assumes you’ve set up the appropriate listeners in your <CODE><FONT face="NSimsun" >web.xml</FONT></CODE> configuration.</P>  <DIV>Bean lookup - Spring</DIV><PRE id="code_snippit_5_total_" ><CODE><SPAN><SPAN>MyBean</SPAN></SPAN><SPAN><SPAN> bean </SPAN></SPAN><SPAN><SPAN>=</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>ApplicationContext</SPAN></SPAN><SPAN><SPAN>.</SPAN></SPAN><SPAN><SPAN>getBean</SPAN></SPAN><SPAN><SPAN>(“</SPAN></SPAN><SPAN><SPAN>myBean</SPAN></SPAN><SPAN><SPAN>”);</SPAN></SPAN></CODE></PRE>  <P>At first glance, you might think this is not possible using CDI, but really it would be more correct to say that it is not yet as convenient. There are technical reasons for this lack of convenience, but while I disagree with that aspect, I do understand the reason for doing things the way they were done.</P>  <P>In CDI, there is a concept of a <CODE><FONT face="NSimsun" >@Dependent</FONT></CODE> scoped bean, which adopts the scope of the bean into which it was injected. This means that when we use Java APIs to create a direct instance of a <CODE><FONT face="NSimsun" >@Dependent</FONT></CODE> scoped bean, that it will not be stored into a context object (the Request, Session, Application, or other common scope.) In other words, <CODE><FONT face="NSimsun" >@PostConstruct</FONT></CODE> methods will be called when the bean is created, but since there is no way for CDI to tell when the bean will be destroyed (because it is not stored in a context C which would normally take care of letting CDI know when to do its cleanup,) <CODE><FONT face="NSimsun" >@PreDestroy</FONT></CODE> annotated methods cannot be called automatically. You have to do this yourself, and for that reason the bean-creation process is slightly more complicated C though not that much more complicated C than in Spring; e.g: “With great power comes great responsibility.”</P>  <P>Before you read the following code, I quote from a CDI developer who agrees that things need to be simplified a little bit for convenience C so expect that in an upcoming release of CDI: “<EM>I can see that people are going to look at the instance creation code and say that CDI is too complicated. We’ve agreed that it’s lame that a utility method is not provided by CDI for those cases when the developer just has to use it.</EM>”</P>  <P>CDI’s equivalent to the <CODE><FONT face="NSimsun" >ApplicationContext</FONT></CODE> is called the <CODE><FONT face="NSimsun" >BeanManager</FONT></CODE>, and can be accessed through JNDI or several other methods (the easiest method is to use the “JBoss Solder” or “DeltaSpike” projects which provide a <CODE><FONT face="NSimsun" >BeanManagerAccessor.getBeanManager()</FONT></CODE> static method very similar (but more generic) to Spring’s <CODE><FONT face="NSimsun" >WebApplicationContext</FONT></CODE> utility class:</P>  <H4>Get <CODE><FONT face="NSimsun" >BeanManager</FONT></CODE> from Solder/DeltaSpike:</H4>  <DIV><STRONG><FONT color="#f9c" >Get BeanManager from Solder/DeltaSpike</FONT></STRONG></DIV><PRE id="code_snippit_6_total_" ><CODE><SPAN><SPAN><PRE class="prettyprint" ><P><CODE><SPAN><SPAN>public BeanManager getBeanManager()<BR>{<BR>&nbsp;&nbsp;&nbsp; return BeanManagerAccessor.getManager();<BR>}</SPAN></SPAN></CODE></P></PRE><PRE>&nbsp;</PRE></SPAN></SPAN></CODE></PRE>  <P>Note: the “<CODE><FONT face="NSimsun" >getBeanManager()</FONT></CODE>” function is provided by the base class <CODE><FONT face="NSimsun" >BeanManagerAware</FONT></CODE>. Don’t worry about how this works for now, unless you want to get into JNDI and server specific stuff. <STRONG><FONT color="red" >NOTE: </FONT>This is the recommended way of accessing the <CODE><FONT face="NSimsun" >BeanManager</FONT></CODE> if you cannot use <CODE><FONT face="NSimsun" >@Inject BeanManager</FONT></CODE> directly.</STRONG> The below options are purely for example, and should be avoided if possible.</P>  <H4>Get <CODE><FONT face="NSimsun" >BeanManager</FONT></CODE> from <CODE><FONT face="NSimsun" >ServletContext</FONT></CODE> (in a JSF request):<FONT color="red" >non-standard</FONT></H4>  <P>Right now this is non-standard, but works in most CDI implementations and is proposed for version 1.1.</P>  <DIV><STRONG>Get BeanManager in a JSF environment</STRONG></DIV><PRE id="code_snippit_7_total_" ><CODE><SPAN><SPAN><PRE class="prettyprint" ><P><CODE><SPAN><SPAN>public BeanManager getBeanManager()<BR>{<BR>&nbsp;&nbsp;&nbsp; return (BeanManager) ((ServletContext) facesContext.getExternalContext().getContext())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .getAttribute("javax.enterprise.inject.spi.BeanManager");<BR>}</SPAN></SPAN></CODE></P></PRE><PRE></PRE></SPAN></SPAN></CODE>&nbsp;</PRE><PRE>Get <CODE><FONT face="NSimsun" >BeanManager</FONT></CODE> from <CODE><FONT face="NSimsun" >ServletContext</FONT></CODE> (in any Web Servlet Request): <FONT color="red" >non-standard</FONT></PRE>  <P>Right now this is non-standard, but works in most CDI implementations and is proposed for version 1.1.</P>  <DIV><STRONG>Get BeanManager in a Servlet environment</STRONG></DIV>  <DIV><PRE class="prettyprint" ><P>public BeanManager getBeanManager(HttpServletRequest request)<BR>{<BR>&nbsp;&nbsp;&nbsp; return (BeanManager) request.getSession().getServletContext()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .getAttribute("javax.enterprise.inject.spi.BeanManager");<BR>} </P></PRE><PRE>&nbsp;</PRE></DIV>  <H4>Get <CODE><FONT face="NSimsun" >BeanManager</FONT></CODE> from JNDI (does not require a Web Request): <FONT color="green" >standard</FONT></H4>  <DIV><STRONG>Get BeanManager from JNDI</STRONG></DIV><PRE id="code_snippit_9_total_" ><CODE><SPAN><SPAN><PRE class="prettyprint" ><P><CODE><SPAN><SPAN>public BeanManager getBeanManager()<BR>{<BR>&nbsp;&nbsp;&nbsp; try {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitialContext initialContext = &lt;strong&gt;new&lt;/strong&gt; InitialContext();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (BeanManager) initialContext.lookup("java:comp/BeanManager");<BR>&nbsp;&nbsp;&nbsp; catch (NamingException e) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.error("Couldn't get BeanManager through JNDI");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return null;<BR>&nbsp;&nbsp;&nbsp; }<BR>}</SPAN></SPAN></CODE></P></PRE><PRE>&nbsp;</PRE></SPAN></SPAN></CODE></PRE>  <P>Once we have a <CODE><FONT face="NSimsun" >BeanManager</FONT></CODE>, we can ask the container to give us an instance of a bean. This is the slightly more complicated part, but that complication is necessary; again, “with great power comes great responsibility.”</P>  <H4>Instantiating a Bean using the BeanManager:</H4>  <P>Don’t get scared, you only need to write this once and put it in a utility class (or use WeldX which provides this functionality already.)</P>  <DIV><STRONG>Get a bean instance</STRONG></DIV><PRE class="prettyprint" ><P>@SuppressWarnings("unchecked")<BR>public static &lt;T&gt; T getContextualInstance(final BeanManager manager, final Class&lt;T&gt; type)<BR>{<BR>&nbsp;&nbsp;&nbsp; T result = null;<BR>&nbsp;&nbsp;&nbsp; Bean&lt;T&gt; bean = (Bean&lt;T&gt;) manager.resolve(manager.getBeans(type));<BR>&nbsp;&nbsp;&nbsp; if (bean != &lt;strong&gt;null&lt;/strong&gt;)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CreationalContext&lt;T&gt; context = manager.createCreationalContext(bean);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (context != null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = (T) manager.getReference(bean, type, context);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; return result;<BR>} </P></PRE><PRE><BR></PRE>  <P>Take warning, though, that the <CODE><FONT face="NSimsun" >CreationalContext</FONT></CODE> object this method creates before we can get a reference to the bean is the object that must be used when “cleaning up” or “destroying” the bean, thus invoking any <CODE><FONT face="NSimsun" >@PreDestroy</FONT></CODE> methods. (Note, because the method above is actually losing the handle to the <CODE><FONT face="NSimsun" >CreationalContext</FONT></CODE> object, it will not be possible to call <CODE><FONT face="NSimsun" >@PreDestroy</FONT></CODE> methods on <CODE><FONT face="NSimsun" >@Dependent</FONT></CODE> scoped objects, and there-in lies the reason why creating beans in CDI is slightly more involved, and why this convenience was omitted C in order to force people to decide for themselves how to handle behavior that might be very important architecturally.) This is the same issue that I mentioned above, when discussing cleaning up bean scopes.</P><A name="section-4" rel="nofollow" ></A>  <H2 id="section-4" >Interacting with Beans through Custom Scopes</H2>  <P>The best way to manage instances of objects is to access them via injection, not through the Java API; in fact, any time you find yourself needing access to a bean through a Java API, you should ask yourself why you are not operating within the realm of dependency management via <CODE><FONT face="NSimsun" >@Inject</FONT></CODE>. Frequently, you can fix the problem at the root C just like <A rel="nofollow" href="http://seamframework.org/Seam3/FacesModule" >Seam Faces Module</A> does for Java Server Faces (JSF) C by adding injection support in other user-objects such as validators, converters, and more, so that you can use injection with ubiquity. Or the Seam Wicket, Seam Servlet, Seam JMS, and other <A rel="nofollow" href="http://seamframework.org/Seam3" >Seam modules</A>.</P>  <P>Sometimes adding injection support this means registering a custom scope, which can sound complex, but is frequently as simple as attaching a bean scope to an existing contextual object such as the <CODE><FONT face="NSimsun" >HttpSession</FONT></CODE> for <CODE><FONT face="NSimsun" >@SessionScoped</FONT></CODE>, or the JSF <CODE><FONT face="NSimsun" >UIViewRoot</FONT></CODE>, for <CODE><FONT face="NSimsun" >@ViewScoped</FONT></CODE> in Seam Faces.</P><A name="section-5" rel="nofollow" ></A>  <H2 id="section-5" >The “Java Persistence API” vs. “the Spring way”</H2>  <P>Spring: First you set up a data-source in <CODE><FONT face="NSimsun" >applicationContext.xml</FONT></CODE>, then you set up a connection pool, then you configure Hibernate to use that connection pool as a data source, then you tell Hibernate where to get its transaction manager, then you need to set up a byte-code assist library (AoP) in order to enable cross-bean transactionality and security via annotations.</P>  <P>Not only is that a good bit confusing to work through (unless you’ve already done it a few times,) but when I started using the actual Spring setup, I got <CODE><FONT face="NSimsun" >LazyInitializationExceptions</FONT></CODE> all over the place because I didn’t first understand what a Hibernate session was, which took another few days to understand and get working C I’ll get back to that in a bit when I talk about Extended Persistence Contexts in Java EE C something you <EM>should be using</EM> if you can. In my opinion Spring did a tremendous disservice by trying to hide the persistence context as though it were just an adapter. The persistence context is crucial to how the ORM model works; you need both the entities and the persistence context in your toolbox in order to be successful.</P>  <P>Put the Spring configuration aside for a moment; now let’s talk about Java EE C all you need is <CODE><FONT face="NSimsun" >/META-INF/persistence.xml</FONT></CODE>, of which I’ve provided a quick working example below.</P>  <P>For the purposes of these examples, I’m going to assume that you are using <A rel="nofollow" href="http://www.jboss.org/jbossas/downloads/" >JBoss AS 6</A>, or have already <A rel="nofollow" href="http://blogs.sun.com/GlassFishPersistence/entry/use_hibernate_as_a_persistence" >installed Hibernate on GlassFish</A> (which is very easy to do, and I recommend since trying to get my application to run on the default EclipseLink has given me a lot of problems when attempting to migrate from Hibernate; Hibernate is still the industry leader in terms of stability and functionality, in my opinion.)</P>  <DIV><STRONG>/META-INF/persistence.xml</STRONG></DIV><PRE id="code_snippit_11_total_" ><CODE><SPAN><SPAN><PRE class="prettyprint" ><P><CODE><SPAN><SPAN>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<BR>&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence"<BR>xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<BR>xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"<BR>version="2.0"&gt;<BR>&lt;persistence-unit name="example"&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;jta-data-source&gt; java:/DefaultDS &lt;/jta-data-source&gt; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Data source for GlassFish if you aren't using JBoss AS 6.0...<BR>&lt;jta-data-source&gt; jdbc/__default &lt;/jta-data-source&gt; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --&gt;<BR>&lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;<BR>&lt;properties&gt;<BR>&lt;!-- Properties for Hibernate (default provider for JBoss AS, must be installed on GlassFish) --&gt;<BR>&lt;property name="hibernate.hbm2ddl.auto" value="create-drop"/&gt;<BR>&lt;property name="hibernate.show_sql" value="true"/&gt;<BR>&lt;property name="hibernate.format_sql" value="false"/&gt;<BR>&lt;/properties&gt;<BR>&lt;/persistence-unit&gt;<BR>&lt;/persistence&gt;</SPAN></SPAN></CODE></P></PRE><PRE><BR></PRE></SPAN></SPAN></CODE></PRE>  <P>But where’s the configuration for transactions? Where do you set up database connections and connection pools? Well, transactions just work automatically if you are using a JTA data-source (more on that in a bit,) you can set up data-sources (and should set them up) in your application server configuration (meaning that since your data source configuration is not stored in the application itself, when your application is deployed it will use the data-source that is available on that server automatically,) and yes: “it’s that simple.” The mentality is a little different, but the end product is a much smaller, “weightless” application. You can set up data sources yourself, but for that you’ll need to read the <A rel="nofollow" href="http://docs.jboss.org/jbossas/docs/Installation_And_Getting_Started_Guide/5/html/Using_other_Databases.html#Using_other_Databases-DataSource_Configuration_Files" >documentation</A> about your web application server. These files are typically kept separate in order to keep passwords out of your application source code or version control repository.</P>  <P>So great, we have persistence set up; but what about those Hibernate <CODE><FONT face="NSimsun" >LazyInitializationExceptions</FONT></CODE> that we all love to hate? We’ll talk about that in the next section, but this is where EJB’s come in, and again, don’t get scared. It’s really very simple to make an EJB, and once you learn what they actually do for you, I’d be surprised if you want to go back.</P>  <P>Here I’d like to mention that with the addition of a tool such as <A rel="nofollow" href="http://seamframework.org/Seam3" >Seam 3</A>‘s Persistence Module, you can use JPA and the <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> in standard CDI beans without EJB C Seam 3 also provides the same consolidated support for managed transactions, security, remoting, and messaging that is provided when you use EJB. Seam 3′s mission is to provide a unified programming model (standardized on CDI) to the Java Enterprise Framework.</P>  <P>As we continue, I’m going to assume a little familiarity with Object Relational Mapping in general, that you know you need to configure your data entities with annotations(or XML) so that the system knows how to map your data to the database. If you are familiar with <A rel="nofollow" href="http://docs.jboss.org/hibernate/stable/entitymanager/reference/en/html/index.html" >Hibernate</A>, then JPA should be no stretch by any means of imagination because Hibernate is a JPA implementation. In fact, you can use most of the <A rel="nofollow" href="http://docs.jboss.org/hibernate/stable/annotations/reference/en/html/index.html" >same annotations</A>!</P>  <DIV><STRONG>A simple EJB</STRONG></DIV><PRE id="code_snippit_12_total_" ><CODE><SPAN><SPAN>@Stateful</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>public</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>class</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>Service</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>{</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>}</SPAN></SPAN></CODE></PRE>  <DIV><STRONG>This is an EJB with Persistence (that doesn't do anything)</STRONG></DIV><PRE id="code_snippit_13_total_" ><CODE><SPAN><SPAN><PRE class="prettyprint" ><P><CODE><SPAN><SPAN>@Stateful<BR>public class Service<BR>{<BR>&nbsp;&nbsp;&nbsp; @PersistenceContext(type = PersistenceContextType.EXTENDED)<BR>&nbsp;&nbsp;&nbsp; private EntityManager em;<BR>}</SPAN></SPAN></CODE></P></PRE><PRE><BR></PRE></SPAN></SPAN></CODE></PRE>  <DIV><STRONG>This is an EJB that can save JPA entities to a database (a DAO)</STRONG></DIV><PRE id="code_snippit_14_total_" ><CODE><SPAN><SPAN><PRE class="prettyprint" ><P><CODE><SPAN><SPAN>@Stateful<BR>public class Service<BR>{<BR>&nbsp;&nbsp;&nbsp; @PersistenceContext(type = PersistenceContextType.EXTENDED)<BR>&nbsp;&nbsp;&nbsp; private EntityManager em;<BR>&nbsp;&nbsp;&nbsp; public &lt;T&gt; void create(final T entity)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; em.persist(entity);<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; public &lt;T&gt; void delete(final T entity)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; em.remove(entity);<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; public &lt;T&gt; T findById(final Class&lt;T&gt; type, final Long id)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Class&lt;?&gt; clazz = getObjectClass(type);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return result = (T) em.find(clazz, id);<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; public &lt;T&gt; void save(final T entity)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; em.merge(entity);<BR>&nbsp;&nbsp;&nbsp; }<BR>}</SPAN></SPAN></CODE></P></PRE><PRE><BR></PRE></SPAN></SPAN></CODE></PRE>  <P>That’s all it takes to create a service class that knows how to interact with the database, so assuming that you have a few <CODE><FONT face="NSimsun" >@Entity</FONT></CODE> classes defined, you’ll be good to go. If you want more information on getting started with Hibernate and JPA, you can <A rel="nofollow" href="http://docs.jboss.org/hibernate/stable/entitymanager/reference/en/html/configuration.html" >start here</A>. But wasn’t that simple? About 10 real lines of code and you’ve got a fully functional database access object. You do need to create actual <CODE><FONT face="NSimsun" >@Entity</FONT></CODE> objects to save to the database, but that’s for a separate tutorial.</P>  <DIV>  <DIV>Thanks to <A rel="nofollow" href="http://community.jboss.org/people/dan.j.allen" >Dan Allen</A>, I’ve attached a <A rel="nofollow" href="http://maven.apache.org/" >Maven</A> project that includes an <A rel="nofollow" href="http://jboss.org/arquillian" >Arquillian</A>-based test suite that you can study to get a greater handle on exactly what occurs when using a persistence context, both one that is transaction-scoped and one that is extended. This is exactly where Arquillian fills in nicely as a teaching tool. You can quickly make changes to the code and see how it affects the result…all in-container. You might want to take a look at this before continuing. You can download the lab <A rel="nofollow" href="http://ocpsoft.com/wp-content/uploads/2010/10/jpalab.zip" >here</A>, unzip, open a terminal, and type: <STRONG>mvn test</STRONG>.   <P></P>  <P>You can also import the project into your IDE and debug to get a visual sense of what’s going on, otherwise, the tests should be pretty revealing!</P>  <P>&nbsp;</P></DIV></DIV>  <H2>What about <A name="section-6" rel="nofollow" ></A><CODE id="section-6" ><FONT face="NSimsun" >LazyInitializationException</FONT></CODE>? (Persistence, Transactions, and the Conversation Scope)</H2>  <P>The first thing you need to know about <CODE><FONT face="NSimsun" >LazyInitializationException</FONT></CODE> is that they occur when Hibernate (or another JPA-style ORM) attempts to load a collection or related data from an <CODE><FONT face="NSimsun" >@Entity</FONT></CODE> object that is no longer “managed.” What is a “managed” object?</P>  <P>To understand this term, we need to look back at how Hibernate and JPA work under the covers. Each time you ask for an object from the database, the system has some form of <CODE><FONT face="NSimsun" >Session</FONT></CODE> (Hibernate) or <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> (JPA) that is used to open connections, manage results, and decide whether or not the objects have been modified (which allows for clean/dirty state to determine when or when not to save objects back to the database.)</P>  <H4>Introducing a failure situation:</H4>  <P>Consider the scenario when an object is loaded from the database. This object has an ID, and holds a list of addresses that are associated with it.</P>  <DIV>Loading our person</DIV><PRE id="code_snippit_15_total_" ><CODE><SPAN><SPAN>Person</SPAN></SPAN><SPAN><SPAN> person </SPAN></SPAN><SPAN><SPAN>=</SPAN></SPAN><SPAN><SPAN> service</SPAN></SPAN><SPAN><SPAN>.</SPAN></SPAN><SPAN><SPAN>getPerson</SPAN></SPAN><SPAN><SPAN>(</SPAN></SPAN><SPAN><SPAN>1</SPAN></SPAN><SPAN><SPAN>);</SPAN></SPAN></CODE></PRE>  <P>Person is loaded from the database using a select statement like this:</P>  <DIV>The executed SQL</DIV><PRE id="code_snippit_16_total_" ><CODE><SPAN><SPAN>select</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>from</SPAN></SPAN><SPAN><SPAN> persons p </SPAN></SPAN><SPAN><SPAN>where</SPAN></SPAN><SPAN><SPAN> p</SPAN></SPAN><SPAN><SPAN>.</SPAN></SPAN><SPAN><SPAN>id </SPAN></SPAN><SPAN><SPAN>=</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>?</SPAN></SPAN></CODE></PRE>  <P>But as you can see by the SQL query, we have not let loaded the addresses since associations and collections are typically be selected only when something attempts to access them, otherwise known as “Lazy” initialization:</P>  <DIV>Loading addresses</DIV><PRE id="code_snippit_17_total_" ><CODE><SPAN><SPAN>List</SPAN></SPAN><SPAN><SPAN>&lt;</SPAN></SPAN><SPAN><SPAN>Address</SPAN></SPAN><SPAN><SPAN>&gt;</SPAN></SPAN><SPAN><SPAN> addresses </SPAN></SPAN><SPAN><SPAN>=</SPAN></SPAN><SPAN><SPAN> person</SPAN></SPAN><SPAN><SPAN>.</SPAN></SPAN><SPAN><SPAN>getAddresses</SPAN></SPAN><SPAN><SPAN>();</SPAN></SPAN></CODE></PRE>  <P>Here is when you have the chance for a <CODE><FONT face="NSimsun" >LazyInitializationException</FONT></CODE>, because this method call actually makes a secondary query to the database, requiring an open connection:</P>  <DIV>The executed SQL</DIV><PRE id="code_snippit_18_total_" ><CODE><SPAN><SPAN>select</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>from</SPAN></SPAN><SPAN><SPAN> addresses a </SPAN></SPAN><SPAN><SPAN>where</SPAN></SPAN><SPAN><SPAN> address</SPAN></SPAN><SPAN><SPAN>.</SPAN></SPAN><SPAN><SPAN>person_id </SPAN></SPAN><SPAN><SPAN>=</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>?</SPAN></SPAN></CODE></PRE>  <P>That sounds fine, but let’s say for instance that a user does something on your website that triggers a <CODE><FONT face="NSimsun" >Person</FONT></CODE> object to be loaded from the database. Nothing special happens with this object, the application just loads it, reads some fields out of it, and goes on to the next page. When that next page is requested, we grab that same <CODE><FONT face="NSimsun" >Person</FONT></CODE> object that we loaded on the last page, try to pull more information out of it C for instance, the list of addresses that was not previously loaded, and oops! We got a <CODE><FONT face="NSimsun" >LazyInitializationException - “Entity is not associated with a known PersistenceContext”</FONT></CODE> What happened?</P>  <P>My object was just loaded, can’t the <CODE><FONT face="NSimsun" >Session</FONT></CODE> or <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> object just open a new connection to the database and get the information that I need? C The answer is “yes” it can, but not if that Session or <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> has already been destroyed, and the object is no longer associated with it! You are probably not using an “extended” persistence context. We need to dig deeper…</P>  <H2>Understanding <CODE><FONT face="NSimsun" >LazyInitializationException</FONT></CODE> and the <A name="section-7" rel="nofollow" ></A><SPAN id="section-7" >Extended <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE></SPAN></H2>  <P>First, we need to know a few things about “extended” Persistence Contexts:</P>  <UL>  <LI>They live as long as the bean they are scoped to.   </LI><LI>Objects with dirty changes queued up in the context until a the transaction with which a persistence context is associated is committed. If a context is destroyed outside of the transaction, the changes are never propagated to the database. It’s the transaction that triggers the session flushing. Flushing can also happen in the middle of a transaction if Hibernate/JPA needs to run a query against the database based on the state of a managed entity (e.g., a where clause)   </LI><LI>Changes made to objects associated with the context are deferred from flushing if an un-handled exception is encountered. The changes will be flushed the next time a flush is attempted.   </LI><LI>While the extended <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> is alive, you will <EM>never</EM> get a <CODE><FONT face="NSimsun" >LazyInitializationException</FONT></CODE> from objects associated with that context, <EM>ever!</EM></LI></UL>  <P>PersistenceContexts can be injected into <CODE><FONT face="NSimsun" >@Stateless</FONT></CODE> or <CODE><FONT face="NSimsun" >@Stateful</FONT></CODE> EJBs via the following annotation:</P>  <DIV><STRONG>A stateful EJB with normal PersistenceContext</STRONG></DIV><PRE id="code_snippit_19_total_" ><CODE><SPAN><SPAN>@Stateful</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>public</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>class</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>Service</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>{</SPAN></SPAN><SPAN><SPAN>      </SPAN></SPAN><SPAN><SPAN>@PersistenceContext</SPAN></SPAN><SPAN><SPAN>      </SPAN></SPAN><SPAN><SPAN>private</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>EntityManager</SPAN></SPAN><SPAN><SPAN> em</SPAN></SPAN><SPAN><SPAN>;</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>}</SPAN></SPAN></CODE></PRE>  <P>By default, this <CODE><FONT face="NSimsun" >EntityManager</FONT></CODE> (persistence context) will be scoped to the length of the transaction (which can be controlled by getting a handle to the user transaction and manually calling <CODE><FONT face="NSimsun" >tx.begin()</FONT></CODE> and <CODE><FONT face="NSimsun" >tx.end()</FONT></CODE>; however, if we add <CODE><FONT face="NSimsun" >(type = PersistenceContextType.EXTENDED)</FONT></CODE> to our injection point, we are now using extended persistence contexts, and that is what we probably wanted all along.</P>  <DIV><STRONG>A stateful EJB with extended PersistenceContext</STRONG></DIV><PRE id="code_snippit_20_total_" ><CODE><SPAN><SPAN>@Stateful</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>public</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>class</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>Service</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>{</SPAN></SPAN><SPAN><SPAN>      </SPAN></SPAN><SPAN><SPAN>@PersistenceContext</SPAN></SPAN><SPAN><SPAN>(</SPAN></SPAN><SPAN><SPAN>type </SPAN></SPAN><SPAN><SPAN>=</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>PersistenceContextType</SPAN></SPAN><SPAN><SPAN>.</SPAN></SPAN><SPAN><SPAN>EXTENDED</SPAN></SPAN><SPAN><SPAN>)</SPAN></SPAN><SPAN><SPAN>      </SPAN></SPAN><SPAN><SPAN>private</SPAN></SPAN><SPAN><SPAN> </SPAN></SPAN><SPAN><SPAN>EntityManager</SPAN></SPAN><SPAN><SPAN> em</SPAN></SPAN><SPAN><SPAN>;</SPAN></SPAN><SPAN><SPAN>  </SPAN></SPAN><SPAN><SPAN>}</SPAN></SPAN></CODE></PRE>  <H4>Use case: the @ApplicationScoped PersistenceContext <FONT color="red" >(Bad practice)</FONT></H4>  <P>Lets imagine for a moment that one single <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> is created for our entire application; the context is started when the server starts up, the context is never destroyed until the server shuts down, and all objects are held within that context. In other words, you’ll never get a <CODE><FONT face="NSimsun" >LazyInitializationException</FONT></CODE>, ever, because the context will always survive, and <CODE><FONT face="NSimsun" >@Entity</FONT></CODE> objects never lose their reference to it.</P>  <P>But also consider that you are running this as a web-application, multi-threaded, that services multiple users at the same time. Changes made by each user are queued in our extended context until the next transaction boundary, which might be as long as until the application shuts down (destroying the extended context,) at which point all changes made by all users are saved to the database and the transaction is committed. </P>  <P>That sounds pretty dangerous… and that’s what happens if you use an Extended <CODE><FONT face="NSimsun" >PersitenceContext</FONT></CODE> in an <CODE><FONT face="NSimsun" >@ApplicationScoped</FONT></CODE> bean. Objects associated with that <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> will stay around for the life the context itself, so obviously we <EM>must</EM> (sarcasm) need a <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> for each user, since we don’t want all changes being queued up and saved when the application shuts down C too many things could go wrong with that scenario.</P>  <P>The <CODE><FONT face="NSimsun" >@ApplicationScoped</FONT></CODE> Persistence Context will start when the application starts up, and it will be destroyed when the application shuts down. There may be multiple transactions (bound to the EJB business methods) that occur within the lifespan of this context.</P>  <H4>Use case: the @SessionScoped PersistenceContext</H4>  <P>Let’s now create a <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> for each user session. Not a horrible concept, and does actually have applicable uses! Each user gets their own <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> that holds <CODE><FONT face="NSimsun" >@Entity</FONT></CODE> references to objects from the moment the session is created until the moment the session is destroyed. They can interact with these objects, save, update change and delete objects without fear of stomping on anyone else’s changes, and their queued changes are saved when the transaction is committed at the end of the session (or any other time a transaction is committed).</P>  <P>The <CODE><FONT face="NSimsun" >@SessionScoped</FONT></CODE> persistence context will be created when the user’s session begins, and it will be destroyed when the user’s session is destroyed. There may be multiple transactions (bound to the EJB business methods) that occur within the lifespan of this context.</P>  <P>But what if you want more fine-grained control over transactions? What if session scope is too long? We don’t want our users making changes on the site that won’t be saved until they log out or their session expires! Can’t we control transaction boundaries ourselves? I want a the context be created when they click “Add to Cart,” continue queuing up more changes, and finally I want a transaction to be committed when they click “Confirm.” We need to look at <CODE><FONT face="NSimsun" >@ConversationScoped</FONT></CODE> persistence contexts.</P>  <P>But first, in your head, separate the idea of a persistence context and a transaction, since they are orthogonal. They work together, but the transaction is <STRONG>when</STRONG> the persistence context performs operations (sometimes automatically, like flushing); the persistence context is just a monitor and cache.</P>  <P>Also, think of an extended persistence context like a @Dependent object (except it is uses a proxy). It is bound to the lifetime of the EJB into which it is injected. A transaction-scoped (default) persistence context, in contrast, lives and dies by the transaction. So you get a new one each time a business method is invoked (basically, every time you use the EJB C stateless in a sense).</P>  <H4>Use case: the @ConversationScoped PersistenceContext</H4>  <P>Conversation scope provides exactly what we’re looking for, and the way this works might be bit scary at first, “you’ll think, how can the system possibly do all of this for me?” To which I’ll answer, the magic of using a <CODE><FONT face="NSimsun" >@ConversationScoped</FONT></CODE> extended <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE>, is that your users’ data, and your users’ saved state as they navigate between pages are living in the same place, and for the same length of time. A match made in heaven!</P>  <DIV><STRONG>Using the conversation scoped PersistenceContext</STRONG></DIV><PRE id="code_snippit_21_total_" ><CODE><SPAN><SPAN><PRE class="prettyprint" ><P><CODE><SPAN><SPAN>@Stateful<BR>@ConversationScoped<BR>public class Service<BR>{<BR>&nbsp;&nbsp;&nbsp; @PersistenceContext(type = PersistenceContextType.EXTENDED)<BR>&nbsp;&nbsp;&nbsp; private EntityManager em;<BR>}</SPAN></SPAN></CODE></P></PRE><PRE><BR></PRE></SPAN></SPAN></CODE></PRE>  <P>The first thing to know about <CODE><FONT face="NSimsun" >@ConversationScoped</FONT></CODE> beans is that by default, conversation scope beings when the request begins, and ends when the request ends and the conversation is not in a long-running state. The call to <CODE><FONT face="NSimsun" >converstation.begin()</FONT></CODE> only states intent for the scope to perpetuate. This means that a <CODE><FONT face="NSimsun" >PersistenceContext</FONT></CODE> injected into a conversation scoped bean will live by default for one request, but of the conversation is started, it will live until the end of the request when the conversation ends. (The reason it is kept alive until the end of the request is because usually the end of the request is when rendering is completed, and destroying information prematurely could result in errors during that render.) </P>  <P>The <CODE><FONT face="NSimsun" >@ConversationScoped</FONT></CODE> persistence context will be created with <CODE><FONT face="NSimsun" >conversation.begin()</FONT></CODE>, and will be destroyed <EM>at the end of the request </EM>on which <CODE><FONT face="NSimsun" >conversation.end()</FONT></CODE> is called. There may be multiple transactions (bound to the EJB business methods) that occur within the lifespan of this context.</P>  <H4>Use case: the @RequestScoped and custom scoped PersistenceContext</H4>  <P>It stands to be mentioned that an extended persistence context can be injected into a bean of any scope, and the same rules will apply. If <CODE><FONT face="NSimsun" >@RequestScoped</FONT></CODE>, for example, the context is created when the request begins, and is destroyed when the request ends; if custom scoped, the same is true: There may be multiple transactions (bound to the EJB business methods) that occur within the lifespan of any context, and when using an extended persistence context.</P>  <H4>Going beyond EJB/JTA with Seam Persistence Module:</H4>  <P>Seam 3 provides a Persistence module which provides a programming API for short-lived persistence contexts (not extended contexts,) much like what you would find in Spring. You can use declarative <CODE><FONT face="NSimsun" >@Transactional(BEGIN)</FONT></CODE> and <CODE><FONT face="NSimsun" >@Transactional(END)</FONT></CODE> methods, and the like, in addition to tying in extra security features, and the power of CDI extensions, interceptors and more. Check back on this blog or on <A rel="nofollow" href="http://seamframework.org/" >Seam Framework.ORG</A> for more updates on this module.</P>  <H2>EJB C Why are my thrown <A name="section-8" rel="nofollow" ></A><SPAN id="section-8" >Exceptions wrapped in an <CODE><FONT face="NSimsun" >EJBException</FONT></CODE></SPAN>?</H2>  <P>Systems using an ORM like hibernate will frequently utilize a Data Access Object (DAO) layer in which standard exceptions are used to reflect the outcome of common operations. Exceptions such as, <CODE><FONT face="NSimsun" >NoSuchObjectException</FONT></CODE>, or <CODE><FONT face="NSimsun" >DuplicateObjectException</FONT></CODE>, are common place. If the system relies on catching these exceptions to recover appropriately and continue functioning, developers switching to EJB may be surprised when it comes time to run their application; it quickly becomes apparent that the exceptions being thrown are not the exceptions that are expected C everything is wrapped in <CODE><FONT face="NSimsun" >EJBException</FONT></CODE>.</P>  <P>At first, you might think, “This is invasive, and tight coupling!” but you have to think about this from the perspective of a transaction-aware system. EJB handles JTA for you, meaning that if you get an exception, EJB needs to know when to roll back the transaction, and when not to; in order to facilitate this decision, EJB has the concept of an <CODE><FONT face="NSimsun" >@ApplicationException</FONT></CODE>.</P>  <H4>“Application” exceptions versus “System” exceptions:</H4>  <UL>  <LI>An application exception is one that has meaning to the client/consumer of the services, and may affect error recovery, flow of logic, navigation, or any other use within the app.   </LI><LI>A system exception is one that represents a failure in the underlying services that cannot be recovered from, and should never be handled by the client/consumer (aside from very basic error handling like printing “500 C Something horrible just happened.”)</LI></UL>  <P>By default, every unchecked/<CODE><FONT face="NSimsun" >RuntimeException</FONT></CODE> thrown from an EJB service will be treated as a “System” exception, meaning that the transaction should be rolled back, and a complete failure has occurred; you cannot recover, and you should never catch an <CODE><FONT face="NSimsun" >EJBException</FONT></CODE> in order to make a decision, other than very basic error recovery C sending a user to a generic error page, for example, or restarting a web-flow / wizard.</P>  <P>So what about the exceptions that we <EM>do</EM> want to recover from, exceptions that we know should not affect the state of the current transaction? Well, in order for EJB to respect your wishes, you must tell it which exceptions have meaning in your application; therefore, the exception classes must either be annotated with <CODE><FONT face="NSimsun" >@ApplicationException</FONT></CODE>, or if you cannot chance the Exception source itself, you must list your exceptions in<CODE><FONT face="NSimsun" > /WEB-INF/ejb-jar.xml</FONT></CODE> (example below.)</P>  <P>Don’t worry, this doesn’t take too long if you have a good exception hierarchy; only the top-level exception must be configured because exception subclasses automatically inherit the configuration from their parent exception types.</P>  <DIV><STRONG>/WEB-INF/ejb-jar.xml</STRONG></DIV><PRE id="code_snippit_22_total_" ><CODE><SPAN><SPAN><PRE class="prettyprint" ><P><CODE><SPAN><SPAN>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<BR>&lt;ejb-jar xmlns="http://java.sun.com/xml/ns/javaee" version="3.1"<BR>&nbsp;&nbsp; xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<BR>&nbsp;&nbsp; xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"&gt;<BR>&nbsp;&nbsp; <BR>&nbsp;&nbsp; &lt;assembly-descriptor&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;application-exception&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;exception-class&gt;javax.persistence.PersistenceException&lt;/exception-class&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;rollback&gt;true&lt;/rollback&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/application-exception&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;application-exception&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;exception-class&gt;com.example.exceptions.DataException&lt;/exception-class&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;rollback&gt;true&lt;/rollback&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/application-exception&gt;<BR>&nbsp;&nbsp; &lt;/assembly-descriptor&gt;<BR>&lt;/ejb-jar&gt;</SPAN></SPAN></CODE></P></PRE><PRE><BR></PRE></SPAN></SPAN></CODE></PRE>  <P>Now your exceptions will be treated as transaction boundaries, or ignored depending on how you need your system configured. This prevents things like partial-commits, and combined with the conversation-scope (next section,) also prevents things like partial-commits from wizard interfaces.</P><A name="section-9" rel="nofollow" ></A>  <H1 id="section-9" >Conclusion</H1>  <P>Does it all make sense now? Do you know how to solve every problem? Probably not, but when it comes right down to it, using Java EE can be even simpler than using Spring, and take much less time. You just have to find the right guides and the right <A rel="nofollow" href="http://ocpsoft.com/opensource/the-problem-is-not-the-system-the-problem-is-education/" >documentation</A> (which is admittedly a severe <A rel="nofollow" href="http://ocpsoft.com/opensource/the-problem-is-not-the-system-the-problem-is-education/" >sore-spot of Java EE</A>; the documentation is still a work in progress, but is getting much better, save blogs like this one.) You have to turn to a vendor like JBoss, or IBM in order to get the use-case driven documentation you need, and they <EM>do </EM>have documentation, it’s just a matter of finding it.</P>  <P><A rel="nofollow" href="http://seamframework.org/Seam3" >Seam 3</A> in particular strives to give <A rel="nofollow" href="http://docs.jboss.org/seam/3/" >extensive user-documentation</A>, hopefully making things much simpler to adopt, and easier to extend.</P>  <P>The main purpose of this article was not to bash Spring, although I may have taken that tone on occasion just for contrast and a little bit of fun. Both Spring and Java EE are strongly engineered and have strong foundations in practical use, but if you want a clean programming experience right out of the box C use Java EE 6 on JBoss Application Server 6 C JBoss Tools C and Eclipse. I will say, though, that the feeling I’ve gotten from the Spring forums vs the Java EE forums, is that there are far many more people willing to help you work through Java EE issues, and more available developers of the frameworks themselves to actually help you than there are on the Spring side. The community for Java EE is much larger, and much more supportive (from my personal experience.)</P>  <P>In the end, I did get <A rel="nofollow" href="http://ocpsoft.org/socialpm/" >my application</A> migrated successfully, and despite these issues (from which I learned a great deal,) I am still happy with Java EE, and would not go back to Spring! But I do look forward to further enhancements from the JBoss Seam project, which continue to make developing for Java EE simpler and more fun.</P>  <P>Don’t believe me? Try it out. Find something wrong? Tell me. Want more? Let me know what you want to hear.</P>  <H2>If you want more information about Java EE and the topics I have discussed above</H2>  <P>Then I recommend some books written by my colleagues and peers. (Note, you will need to disable any ad-block programs in order to see these links.)</P>  <P></P>  <CENTER><BR>  <DIV></DIV><BR></CENTER>  <P></P>  <DIV style="POSITION: fixed; LINE-HEIGHT: 1; HEIGHT: 681px; TOP: 300px; LEFT: -250px;"  >  <DIV><A style="POSITION: absolute; TEXT-INDENT: -99999px; DISPLAY: block; RIGHT: -40px; TOP: 0px" target="_blank" rel="nofollow" href="http://ocpsoft.org/java/spring-to-java-ee-a-migration-guide-cdi-jsf-jpa-jta-ejb/#" ></A>  <DIV>  <CENTER>Need more info?</CENTER></DIV>  <CENTER>  <H3>Read one of these highly-recommended books:</H3>  <P><BR></P>  <CENTER>Written by JBoss Software Engineers and Experts.</CENTER><BR>  <DIV></DIV><BR>  <P></P></CENTER>  <DIV></DIV></DIV></DIV>  <H3>Shameless plugs for some other projects that I think you’ll find useful:</H3>  <P>OcpSoft PrettyFaces C our own open-source tool for controlling the URL of your application, making pretty, bookmarkable URLs. The easiest (if I don’t mind saying, and I don’t) way of controlling URL parameters, query-parameters, and validating input that comes into your application through the URL.<BR>JBoss <A rel="nofollow" href="http://jboss.org/arquillian" >Arquillian</A> C the single most inclusive and best Unit/Integration testing experience you will find in any application framework. Not only that, but it actually runs your code IN the container, so it’s being tested like it’ll actually be run in production.</P></div>
        <div class="nbw-blog-end"></div>

        <div>
		</div>

        <div>
		</div>

		<div>
      	  <div >
		  	<script type="text/javascript" id="wumiiRelatedItems"></script>
		  </div>
		</div>

        <div class="ptc phide ztag">
          <span class="ptcp">
            <span class="iblock bcmimg">&nbsp;</span>
            <span class="nbc-0 nbc-0-40 ptcmt ptcmt-2">评论这张</span>
          </span>
        </div>
		<div style="display:none" class="ptc phide ztag">
          <span class="ptcp">
            <span class="nbc-0 nbc-0-40 ptcmi">
              <img src="http://b.bst.126.net/newpage/images/microblog.png?1" />
            </span>
            <span class="nbc-0 nbc-0-40 ptcmt">转发至微博</span>
          </span>
        </div>
        <div class="ptc phide">
          <a id="publishtolofter" class="toLofter" title="发布到LOFTER" target="_blank" hidefocus="true">&nbsp;</a>
        </div>
        
        <div style="display:none" class="ptc phide ztag">
          <span class="ptcp">
            <span class="nbc-0 nbc-0-40 ptcmi">
              <img src="http://b.bst.126.net/newpage/images/microblog.png?1" />
            </span>
            <span class="nbc-0 nbc-0-40 ptcmt">转发至微博</span>
          </span>
        </div>

        <div style="width:290px;" class="phide"><iframe id="$_mblogcardf" allowTransparency="true" frameborder="0" scrolling="no" width="100%" height="133"></iframe></div>

        <div class="nbw-act tbar fc03 clearfix">
         <div style="height:24px;line-height:24px;">
          <div class="pleft rdif">
	          <span class="pnt pleft" id="$_spanRecommend"><img class="pclass" src="http://b.bst.126.net/style/common/tuijian.png"/></span>
	        <span id="$_spanShowRecommend" class="pleft rdct  phide">
	          <span class="pleft ul fc03"><span id="$_spanRecommendCount">0</span>人</span><span class="pleft iblock icn0 icn0-722 nbw-tgl1 nas-icn0fix">&nbsp;</span><span class="pleft iblock icn0 icn0-621 nbw-tgl0 nas-icn0fix">&nbsp;</span><span class="fc07"></span>|&nbsp;
	        </span>
	        <span id="$_shareToSites" class="fc07 pleft nas-tofix">分享到：</span><span class="nas-wrap pleft"><span id="$_shareBtn_163weibo" title="分享到网易微博" class="nas-itm nas-itm0">&nbsp;</span><span id="$_shareBtn_sinaweibo" title="分享到新浪微博" class="nas-itm nas-itm6">&nbsp;</span><span id="$_shareBtn_qqweibo" title="分享到腾讯微博" class="nas-itm nas-itm9">&nbsp;</span><span class="nas-itm nas-itm7" title="分享到MSN" id="$_shareBtn_msn">&nbsp;</span><span class="nas-itm nas-itm3" title="分享到QQ空间" id="$_shareBtn_qq">&nbsp;</span><span class="nas-itm nas-itm1" title="分享到人人网" id="$_shareBtn_renren">&nbsp;</span><span class="nas-itm nas-itm2" title="分享到开心网" id="$_shareBtn_kaixin">&nbsp;</span><span class="nas-itm nas-itm4" title="分享到豆瓣" id="$_shareBtn_douban">&nbsp;</span></span></span>
          </div>
          <div class="pright">
              <span class="fc07">阅读(<span id="$_spaniReadCount">272</span>)</span><span class="sep fc07">|</span>
              <span class="fc07">评论(<span id="$_spaniCommentCount">0</span>)</span><span class="sep fc07">|</span>
              <span class="m2a" id="$_spanCite">转载</span> <span class="m2a" id="$_spanCiteCount">(0)</span>
              <span class="sep fc07">|</span><span id="$_spanReport" class="m2a">举报</span>
          </div>
         </div>
        </div>
      </div>
      <div class="snl">
        <div class="phide bdwb bds2 bdc0 rdcnt" id="$_divRecommendContent"></div>
        <div id="yodaoad" class="bdwb bds2 bdc0" style="display:none;_zoom:1;">&nbsp;</div>
        <div id="$_newOldBlogLinkBottomDiv" class='top fc03 clearfix'>
	     </div>
	    <div class="relateblog phide">
          <h4 class="bdwb bds2 bdc0 fc07 fs0">历史上的今天</h4>
          <div class="cnt ztag clearfix"></div>
        </div>
	    <div class="author">
	      <h4 class="bdwb bds2 bdc0 fc07 fs0">最近读者</h4>
	      <div class="cnt ztag clearfix"></div>
	    </div>
	    <div class="phide" id="yodaoad_1" style="_zoom:1;"></div>
	    <div class="comment">
	      <h4 class="bdwb bds2 bdc0 fc07 fs0">评论</h4>
	      <a name="blogComment" id="blogComment"></a>
	      <div class="ztag"></div>
	    </div>
	    <div class="phide" id="yodaoad_3" style="_zoom:1;"></div>
      </div>
      <div class="cite ztag fc03"></div>
    </div>
   </div>
  </div>
</div>
<div class="phide nb-init">
  <textarea name="js">
    this.p={  m:2,
              b:2,
              id:'fks_087066087085081064084086087068072082085066092087080067093',
              blogTitle:'Spring to Java EE C A Migration Experience(收藏)',
              blogAbstract:'  <P\>该文是PrettyFaces的Leader，让我们看看牛人对Java EE的理解，看了后忍不住收藏了。</P\>  <P\>网易的编辑器太垃圾了，建议大家看原文。</P\>  <P\>&nbsp;</P\>  <P\>原文地址：<A rel=\"nofollow\" href=\"http://ocpsoft.org/java/spring-to-java-ee-a-migration-guide-cdi-jsf-jpa-jta-ejb/\" \>http://ocpsoft.org/java/spring-to-java-ee-a-migration-guide-cdi-jsf-jpa-jta-ejb/</A\></P\>  <P\>So Java EE 6 is out, and you’ve decided to give it a go. You’re trying to port an existing</P\>',
              blogTag:'javaee,spring,opensessioninconvers,jpa,cdi',
              blogUrl:'blog/static/44181609201242991241541',
              isPublished:1,
              istop:false,
              type:2,
              modifyTime:1338303790945,
              publishTime:1338297523936,
              permalink:'blog/static/44181609201242991241541',
              commentCount:0,
              mainCommentCount:0,
              recommendCount:0,
              bsrk:-100,
              publisherId:0,
              recomBlogHome:false,
              currentRecomBlog:false,
              attachmentsFileIds:[],
              vote:{},
              groupInfo:{},
              friendstatus:'none',
              followstatus:'unFollow',
              pubSucc:'',
              visitorProvince:'',
              visitorCity:'',
              visitorNewUser:false,
              postAddInfo:{},
              mset:'000',
              mcon:'',
              srk:-100,
              remindgoodnightblog:false,
              isBlackVisitor:false,
              isShowYodaoAd:true,
              hostIntro:'',
              hmcon:'1',
              selfRecomBlogCount:'0',
              lofter_single:'<iframe width="140" height="560" style="overflow:hidden;" src="http://www.lofter.com/mailEntry.do?blogad=1&blog" frameBorder="0"></iframe>'
            }
  </textarea>
  <textarea name="jst" id="m-3-jst-1">
    {list a as x}
    {if !!x}
    <div class="iblock nbw-fce nbw-f40">
      <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/">
      {if x.visitorName==visitor.userName}
      <img alt="${x.visitorNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}&r=${visitor.imageUpdateTime}"/>
      {else}
      <img alt="${x.visitorNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}"/>
      {/if}
      </a>
      <div class="cwd vname thide">
        {if x.moveFrom=='wap'}
          <a class="noul pnt" target="_blank" href="http://blog.163.com/services/wapblog.html?frompersonalbloghome"><span title="来自网易手机博客" class="iblock wapIcon">&nbsp;</span></a>
        {elseif x.moveFrom=='iphone'}
          <a class="noul pnt" target="_blank"><span title="来自iPhone客户端" class="iblock iphoneIcon">&nbsp;</span></a>
        {elseif x.moveFrom=='android'}
          <a class="noul pnt" target="_blank"><span title="来自Android客户端" class="iblock androidIcon">&nbsp;</span></a>
        {elseif x.moveFrom=='mobile'}
          <a class="noul pnt" target="_blank" href="http://blog.163.com/services/emsblog.html?frompersonalbloghome"><span title="来自网易短信写博" class="iblock wapIcon">&nbsp;</span></a>
        {/if}
        <a class="fc03 m2a"  target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/">
          ${fn(x.visitorNickname,8)|escape}
        </a>
      </div>
    </div>
    {/if}
    {/list}
  </textarea>
  <textarea name="jst" id="m-3-jst-2">
    {if !!a}
    <a target="_blank" href="http://blog.163.com/${a.userName}/"><img class="bdwa bdc0 pnt" onerror="this.src=location.f60" src="${fn1(a.userName)}"/></a>
    <a target="_blank" class="fc03 m2a" href="http://blog.163.com/${a.userName}/">${fn(a.nickname,8)|escape}</a>
    <div class="intro fc05">${a.selfIntro|escape}{if great260}${suplement}{/if}</div>
	    <div class="acts ztag"></div>
	  <div class="mbga phide xtag">
        <div class="mbgai">&nbsp;</div>
        <a class="fc03 xtag m2a" href="#" target="_blank"></a>
      </div>
    {/if}
  </textarea>
  <#--最新日志，群博日志-->
  <textarea name="jst" id="m-3-jst-3">
    {list a as x}
    {if !!x}
    <li class="thide"><a target="_blank" class="fc03 m2a" href="${furl()}${x.permalink}/?latestBlog">${fn(x.title,26)|escape}</a></li>
    {/if}
    {/list}
  </textarea>
  <#--推荐日志-->
  <textarea name="jst" id="m-3-jst-4">
    <p class="fc06">推荐过这篇日志的人：</p>
    <div>
      {list a as x}
      {if !!x}
      <div class="iblock nbw-fce nbw-f40">
        <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/">
        <img alt="${x.recommenderNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.recommenderName)}"/>
        </a>
        <div class="cwd thide">
          <a class="fc03 m2a" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/">
            ${fn(x.recommenderNickname,6)|escape}
          </a>
        </div>
      </div>
      {/if}
      {/list}
    </div>
    {if !!b&&b.length>0}
    <p  class="fc06">他们还推荐了：</p>
    <ul>
    {list b as y}
      {if !!y}
        <li class="rrb"><span class="iblock">&#183;</span><a class="fc03 m2a" target="_blank" href="http://blog.163.com/${y.recommendBlogPermalink}/?from=blog/static/44181609201242991241541">${y.recommendBlogTitle|escape}</a></li>
      {/if}
    {/list}
    </ul>
    {/if}
  </textarea>
  <#--引用记录-->
  <textarea name="jst" id="m-3-jst-5">
    <span class="pleft fc07">转载记录：</span>
    <ul class="tbac">
    {list d as x}
      <li class="clearfix">
        <span class="pleft iblock">&#183;</span>
        <div class="tbl thide pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referBlogUrl}">${x.referBlogTitle|escape}</a></span></div>
        <div class="tbr pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referHomePage}">${x.referUserName|escape}</a></span></div>
      </li>
    {/list}
    </ul>
  </textarea>
  <#--博主推荐-->
  <textarea name="jst" id="m-3-jst-6">
    {list a as x}
    {if !!x}
    <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?recommendBlog" title="${x.title|default:""|escape}">${x.title|default:""|escape}</a></li>
    {/if}
    {/list}
  </textarea>
  <#--随机阅读-->
  <textarea name="jst" id="m-3-jst-7">
    {list a as x}
    {if !!x}
    <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?personalRecomBlog" title="${x.title|default:""|escape}">${x.title|default:""|escape}</a></li>
    {/if}
    {/list}
  </textarea>
  <#--首页推荐-->
  <textarea name="jst" id="m-3-jst-8">
    {list a as x}
    {if !!x}
    <li class="thide"><a target="_blank" class="fc03 m2a" target="_blank" href="${x.blogUrl|default:""|escape}?recommendReader" title="${x.blogTile|default:""|escape}">${x.blogTile|default:""|escape}</a></li>
    {/if}
    {/list}
  </textarea>
  <#--历史上的今天-->
  <textarea name="jst" id="m-3-jst-10">
    <ul>
      {list a as x}
      {if x_index>4}{break}{/if}
      {if !!x}
        <li class="thide fc03">
          <a class="m2a" target="_blank"  href="http://blog.163.com/${x.userName}/${x.permalink|default:""}"  title="${x.title|default:""|escape}">${fn1(x.title,60)|escape}</a><span class="fc07">${fn2(x.publishTime,'yyyy-MM-dd HH:mm:ss')}</span>
        </li>
      {/if}
      {/list}
    </ul>
  </textarea>
  <#--被推荐日志-->
  <textarea name="jst" id="m-3-jst-11">
    {list a as x}
    {if !!x}
    <li class="thide"><a target="_blank" class="fc03 m2a" href="${furl()}${x.permalink}/">${fn(x.title,26)|escape}</a></li>
    {/if}
    {/list}
  </textarea>
    <#--上一篇，下一篇-->
  <textarea name="jst" id="m-3-jst-12">
     {if !!(blogDetail.preBlogPermalink)}
       <span class="ilft iblock icn0 icn0-620">&nbsp;</span>
       <div class="pleft thide"><a class="m2a"  href="http://yyq2007aa.blog.163.com/${blogDetail.preBlogPermalink}/">${blogDetail.preBlogTitle|escape}</a></div>
     {/if}
     {if !!(blogDetail.nextBlogPermalink)}
       <span class="irgt iblock icn0 icn0-619">&nbsp;</span>
       <div class="pright thide"><a class="m2a" href="http://yyq2007aa.blog.163.com/${blogDetail.nextBlogPermalink}/">${blogDetail.nextBlogTitle|escape}</a></div>
     {/if}
  </textarea>
  <#--右边模块结构-->
  <textarea name="txt" id="m-3-txt-0">
    <div class="uinfo ztag"></div>
    <h4 class="fc07 fs0 ltt phide ztag">被推荐日志</h4>
    <ul class="ztag blst"></ul>
    <h4 class="fc07 fs0 ltt phide ztag">最新日志</h4>
    <ul class="ztag blst"></ul>
    <h4 class="fc07 fs0 ltt phide ztag">该作者的其他文章</h4>
    <ul class="ztag blst"></ul>
    <h4 class="fc07 fs0 ltt phide ztag">博主推荐</h4>
    <ul class="ztag blst"></ul>
    <h4 class="fc07 fs0 ltt phide ztag">随机阅读</h4>
    <ul class="ztag blst"></ul>
    <h4 class="fc07 fs0 ltt phide ztag">首页推荐</h4>
    <ul class="ztag blst"></ul>
    <div class="more"><a target="_blank" class="fc03 m2a" href="http://blog.163.com">更多&gt;&gt;</a></div>
    <br/><br/>
    <div id="yodaoad_r" style="display:none;_zoom:1;"></div>
    <div id="lofter_single"></div>
  </textarea>
  <#--评论模块结构-->
  <textarea name="txt" id="m-3-txt-1">
    <div class="publish ztag"></div>
    <div class="bdwt bds2 bdc0 phide" id="yodaoad_2" style="_zoom:1;"></div>
    <div class="ztag bdwt bds2 bdc0">
      <div class="case"></div>
      <div class="clearfix"></div>
    </div>
  </textarea>
  <#--引用模块结构-->
  <textarea name="jst" id="m-3-txt-2">
     <div class="close">
       <span class="ztag iblock icn0 icn0-57">&nbsp;</span>
     </div>
	 <div class="ztag phide"></div>
  </textarea>
    <#--博主发起的投票-->
  <textarea name="jst" id="m-3-txt-3">
    {list a as x}
    {if !!x}
      <li>
      <a href="http://blog.163.com/${x.userName}/" target="_blank" class="m2a fc03">${x.nickName|escape}</a>&nbsp;&nbsp;投票给
        {var first_option = true;}
        {list x.voteDetailList as voteToOption}
            {if voteToOption==1}
              {if first_option==false},{/if}&nbsp;&nbsp;“${b[voteToOption_index]}”&nbsp;&nbsp;
            {/if}
        {/list}
        {if (x.role!="-1") },“我是${c[x.role]}”&nbsp;&nbsp;{/if}
        &nbsp;&nbsp;&nbsp;&nbsp;<span class="fc07">&nbsp;&nbsp;&nbsp;&nbsp;${fn1(x.voteTime)}</span>
        {if x.userName==''}{/if}
    {/if}
    {/list}
  </textarea>
</div>

<script type="text/javascript">
var wumiiPermaLink = "http://blog.163.com/yyq2007aa/blog/static/44181609201242991241541/"; //文章的永久链接，作为文章的唯一标识
var wumiiTags = "javaee,spring,opensessioninconvers,jpa,cdi"; //文章标签，以英文逗号分隔，如："标签1,标签2"
var wumiiSitePrefix = "http://blog.163.com/yyq2007aa/"; //博客的主页地址，作为博客的唯一标识
var wumiiParams = "&num=5&mode=3&pf=blog163"; //num为默认显示的相关文章数目，mode为默认的显示模式（1为文字，2为图片，3为自动）
</script>
<script type="text/javascript" src="http://widget.wumii.com/ext/relatedItemsWidget.htm"></script>
</div>
      <div class="l cl h100">&nbsp;</div>
      <div class="r cr h100">&nbsp;</div>
    </div>
    <div class="nb-mb lcr bh space">
      <div class="l bl bh">&nbsp;</div>
      <div class="r br bh">&nbsp;</div>
      <div class="c bc bh lcr">&nbsp;</div>
    </div>
  </div>

</div>
      <div class="l wl g lg h100">&nbsp;</div>
      <div class="l wl t lt">&nbsp;</div>
      <div class="l wl b lb">&nbsp;</div>
      <div class="r wr g rg h100">&nbsp;</div>
      <div class="r wr t rt">&nbsp;</div>
      <div class="r wr b rb">&nbsp;</div>
    </div>
  </div>
  <div class="nb-are nb-smb"><div class="wkg h space"><div class="l h">&nbsp;</div><div class="r h">&nbsp;</div><div class="c h">&nbsp;</div></div></div>
<div class="nb-are nb-fot">
  <div class="wkg h">
    <h2>页脚</h2>
    <div class="k">      <a rel="nofollow" class="m2a fc08" target="_blank" href="http://corp.163.com/index_gb.html">公司简介</a>
      <span class="p fc10">-</span>
      <a rel="nofollow" class="m2a fc08" target="_blank" href="http://gb.corp.163.com/gb/contactus.html">联系方法</a>
      <span class="p fc10">-</span>
      <a rel="nofollow" class="m2a fc08" target="_blank" href="http://corp.163.com/gb/job/job.html">招聘信息</a>
      <span class="p fc10">-</span>
      <a rel="nofollow" class="m2a fc08" target="_blank" href="http://help.163.com/?b13abk1">客户服务</a>
      <span class="p fc10">-</span>
      <a rel="nofollow" class="m2a fc08" target="_blank" href="http://corp.163.com/gb/legal/legal.html">隐私政策</a>
      <span class="p fc10">-</span>
      <a rel="nofollow" class="m2a fc08" target="_blank" href="http://blog.163.com/public/theme/">博客风格</a>
      <span class="p fc10">-</span>
      <a rel="nofollow" class="m2a fc08" target="_blank" href="http://blog.163.com/services/wapblog.html">手机博客</a>
      <span class="p fc10">-</span>
      <a rel="nofollow" class="m2a fc08" target="_blank" href="http://blog.163.com/vip.do">VIP博客</a>
      
      <link rel="alternate" type="application/rss+xml" title="RSS" href="http://yyq2007aa.blog.163.com/rss/"/>
      <span class="p fc10">-</span><span class="fc08" id="$_foot_subscribe"><span class="iblock m2a icn0 icn0-919">&nbsp;</span><a class="m2a fc08">订阅此博客</a></span>
    </div>
    <p class="fc08">网易公司版权所有&nbsp;&copy;1997-2013</p>
  </div>
</div></div>
    <!--[if lte IE 6]></div><![endif]-->
  <!--[if lte IE 6]></div><![endif]-->
  <div class="nb-layer" id="blog-163-com-layer"></div>
  <div class="nb-tpl nb-init phide" id="blog-163-com-template" style="display:none;">  <textarea rows="1" cols="1" name="jst" id="nb-jst-a1">  <a rel="nofollow" class="pr" target="_blank" href="http://help.163.com/special/007525FT/blog.html?b13aze1">帮助</a>
  <span class="fr iblock space icn1 icn1-4">&nbsp;</span>
  <a class="pr" target="_blank" href="http://blog.163.com/activation.do?host=activation&&username=${u}">${u}</a>
</textarea>
  <textarea rows="1" cols="1" name="jst" id="nb-jst-d0">      {list wl as x}
        <div class="grp">${x.g}</div>
        {list x.l as y}
        <a class="itm noul" href="#" hidefocus="true" name="{if typeof(y.v)=='string'}${y.v}{else}${y_index}{/if}">${y.n}</a>
        {/list}
      {/list}
</textarea>
  <textarea rows="1" cols="1" name="jst" id="nb-jst-d1">	{if defined('wl')}
        {list wl as x}<a class="itm noul" href="#" hidefocus="true" name="${x.v}">${x.n}</a>{/list}
    {/if}
</textarea>
</div>
<script type="text/javascript">
  window.N = {tm:{'zbtn':'nbtn',
                  'bdc0':'bdc0','bdc2':'bdc1',
				  'bgc0':'bgc0','bgc1':'bgc1','bgc2':'bgc2','bgh0':'bgc9',
				  'fc00':'fc03','fc01':'fc04','fc02':'fc05','fc03':'fc06','fc04':'fc07','fc05':'fc09'}};
  Date.servTime = '12/14/2013 07:36:10';
  location.api = 'http://api.blog.163.com/';
  location.msg = 'http://api.blog.163.com/msg/dwr';
  location.dwr = 'http://api.blog.163.com/yyq2007aa/dwr';
  location.vcd = 'http://api.blog.163.com/cap/captcha.jpgx?parentId=44181609&r=';
  location.mrt = 'http://b.bst.126.net/newpage/style/mbox/';
  location.fce = 'http://os.blog.163.com/common/ava.s?host=';
  location.fce2= 'http://os.blog.163.com/common/ava.s?host=';
  location.passportfce = 'http://os.blog.163.com/common/ava.s?passport=';
  location.fpr = 'http://b.bst.126.net/common/portrait/face/preview/';
  location.f60 = 'http://b.bst.126.net/common/face60.png';
  location.f140= 'http://b.bst.126.net/common/face140.png';
  location.f40 = location.f140;
  location.adf140= 'http://b.bst.126.net/common/admireface140.png';
  location.ept = 'http://b.bst.126.net/common/empty.png';
  location.guide_profile_add= 'http://b.bst.126.net/common/guide_profile_add.gif';
  location.phtoto_dream = 'http://photo.dream.163.com/blog/writeBlogCallback.do';
  window.CF = {
    ca:false
   ,cb:''
   ,cc:false
   ,cd:false
   ,ce:'-3'
   ,ck:0
   ,ci:['api.blog.163.com'
       ,'http://photo.163.com/photo/html/crossdomain.html?t=20100205'
        
        ,'ud.blog.163.com'
        
        
        
        ]
   ,cj:[-3]
   ,cl:''
   ,cm:["","blog/","album/","music/","collection/","friends/","profile/","pprank/"]
   ,cf:0
   ,co:{pv:false
       ,ti:4040
       ,tn:''
       ,tc:0
       ,tl:3
       ,ut:0
       ,un:''
       ,um:''
       ,ui:0
       ,ud:false}
   ,cp:{nr:0
       ,cr:0
       ,vr:-100
       ,fr:0}
   ,cs:0
   ,ct:{'nav':['首页','日志','相册','音乐','收藏','博友','关于我'],'enabled':[0,1,6],'defaultnav':parseInt('1111111',2)}
   ,cu:false
   ,cv:false
   ,cw:false
  };
  window.UD = {};
  UD.host = {
      userId:44181609
     ,userName:'yyq2007aa'
     ,nickName:'yyq2007aa'
     ,imageUpdateTime:-1
     ,baseUrl:'http://yyq2007aa.blog.163.com/'
     ,gender:'他'
     ,email:'yyq2007aa@163.com'
     ,photo163Name:'yyq2007aa'
     ,photo163HostName:'yyq2007aa'
     ,TOKEN_HTMLMODULE:''
     ,isMultiUserBlog:false
     ,isWumiUser:true
     ,sRank:-100
  };
</script>
    <script type="text/javascript" src="http://b1.bst.126.net/newpage/r/j/pc.js?v=1386211381284"></script>
    <script type="text/javascript" src="http://b1.bst.126.net/newpage/r/j/m/m-3/pm.js?v=1386211381284"></script>
  <script src="http://analytics.163.com/ntes.js" type="text/javascript"></script>
  <script type="text/javascript">
    _ntes_nacc='blog';neteaseTracker();
    
    new Image().src = 'http://blog.163.com/newpage/images/analyse.png?s=p&t='+new Date().getTime();
  </script>

<script type="text/javascript">
    window.setTimeout(function(){
			J.loadScript('http://music.ph.126.net/ph.js?001');
			
			J.postDataByDWR(location.dwr,'MusicBeanNew','setCopyrightMusicSessionToken',false);
	},1000);
</script>

    <script type="text/javascript" src="/newpage/prettycode/prettify.js"></script>
</body>
</html>
